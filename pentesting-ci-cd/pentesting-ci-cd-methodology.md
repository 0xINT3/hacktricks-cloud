---
description: >-
  En la metodolog√≠a de pentesting de CI/CD de HackTricks encontrar√°s c√≥mo hacer pentesting a la infraestructura relacionada con las actividades de CI/CD.
---

# Metodolog√≠a de Pentesting de CI/CD

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**, ¬°consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de Github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/CLOUD-logo-letters.svg" alt=""><figcaption></figcaption></figure>

## Introducci√≥n

Los entornos de desarrollo se han convertido en una parte importante de la superficie de ataque actual. Y dentro de ellos, los activos m√°s lucrativos son los sistemas responsables de **CI y CD** ‚Äîaquellos que construyen, prueban e implementan c√≥digo‚Äî y que t√≠picamente poseen los **secretos y el acceso** a los activos m√°s cr√≠ticos de la organizaci√≥n. Por lo tanto, es natural que los atacantes est√©n continuamente buscando nuevas formas de acceder a estos sistemas.

### VCS

VCS significa **Sistema de Control de Versiones**, estos sistemas permiten a los desarrolladores **administrar su c√≥digo fuente**. El m√°s com√∫n es **git** y generalmente encontrar√°s empresas que lo usan en una de las siguientes **plataformas**:

* Github
* Gitlab
* Bitbucket
* Gitea
* Proveedores de la nube (ofrecen sus propias plataformas VCS)

### Pipelines

Los pipelines permiten a los desarrolladores **automatizar la ejecuci√≥n de c√≥digo** (para fines de construcci√≥n, prueba, implementaci√≥n, etc.) despu√©s de que ocurren ciertas acciones: un push, una PR, cron... Son muy √∫tiles para **automatizar todos los pasos desde el desarrollo hasta la producci√≥n**.

Sin embargo, estos sistemas necesitan ser **ejecutados en alg√∫n lugar** y generalmente con **credenciales privilegiadas para implementar c√≥digo**.

## Metodolog√≠a de Pentesting de VCS

{% hint style="info" %}
Incluso si algunas plataformas VCS permiten crear pipelines, en esta secci√≥n analizaremos solo los posibles ataques al control del c√≥digo fuente.
{% endhint %}

Las plataformas que contienen el c√≥digo fuente de tu proyecto contienen informaci√≥n sensible y las personas deben tener mucho cuidado con los permisos otorgados dentro de esta plataforma. Estos son algunos problemas comunes en las plataformas VCS que un atacante podr√≠a aprovechar:

* **Fugas**: Si tu c√≥digo contiene fugas en los commits y el atacante puede acceder al repositorio (porque es p√∫blico o porque tiene acceso), podr√≠a descubrir las fugas.
* **Acceso**: Si un atacante puede **acceder a una cuenta dentro de la plataforma VCS**, podr√≠a obtener **m√°s visibilidad y permisos**.
  * **Registro**: Algunas plataformas solo permitir√°n a los usuarios externos crear una cuenta.
  * **SSO**: Algunas plataformas no permitir√°n a los usuarios registrarse, pero permitir√°n a cualquiera acceder con un SSO v√°lido (por lo que un atacante podr√≠a usar su cuenta de github para ingresar, por ejemplo).
  * **Credenciales**: Nombre de usuario + contrase√±a, tokens personales, claves ssh, tokens Oauth, cookies... hay varios tipos de tokens que un usuario podr√≠a robar para acceder de alguna manera a un repositorio.
* **Webhooks**: Las plataformas VCS permiten generar webhooks. Si no est√°n **protegidos** con secretos no visibles, un **atacante podr√≠a abusar de ellos**.
  * Si no hay secreto en su lugar, el atacante podr√≠a abusar del webhook de la plataforma de terceros.
  * Si el secreto est√° en la URL, lo mismo sucede y el atacante tambi√©n tiene el secreto.
* **Compromiso de c√≥digo**: Si un actor malintencionado tiene alg√∫n tipo de acceso de **escritura** sobre los repositorios, podr√≠a intentar **inyectar c√≥digo malicioso**. Para tener √©xito, es posible que deba **burlar las protecciones de la rama**. Estas acciones se pueden realizar con diferentes objetivos en mente:
  * Comprometer la rama principal para **comprometer la producci√≥n**.
  * Comprometer la rama principal (u otras ramas) para **comprometer las m√°quinas de los desarrolladores** (ya que generalmente ejecutan pruebas, terraform o otras cosas dentro del repositorio en sus m√°quinas).
  * **Comprometer el pipeline** (ver la siguiente secci√≥n)

## Metodolog√≠a de Pentesting de Pipelines

La forma m√°s com√∫n de definir un pipeline es mediante el uso de un **archivo de configuraci√≥n de CI alojado en el repositorio** que construye el pipeline. Este archivo describe el orden de los trabajos ejecutados, las condiciones que afectan el flujo y la configuraci√≥n del entorno de construcci√≥n.\
Estos archivos suelen tener un nombre y formato consistentes, por ejemplo ‚Äî Jenkinsfile (Jenkins), .gitlab-ci.yml (GitLab), .circleci/config.yml (CircleCI) y los archivos YAML de GitHub Actions ubicados en .github/workflows. Cuando se activa, el trabajo del pipeline **extrae el c√≥digo** de la fuente seleccionada (por ejemplo, confirmaci√≥n / rama) y **ejecuta los comandos especificados en el archivo de configuraci√≥n de CI** contra ese c√≥digo.

Por lo tanto, el objetivo final del atacante es de alguna manera **comprometer esos archivos de configuraci√≥n** o los **comandos que ejecutan**.

### PPE - Ejecuci√≥n de Pipeline Envenenado

El vector de Ejecuci√≥n de Pipeline Envenenado (PPE) **abusa de los permisos contra un repositorio SCM**, de tal manera que hace que un pipeline de CI ejecute comandos maliciosos. Los usuarios que tienen permisos para **manipular los archivos de configuraci√≥n de CI o otros archivos en los que el trabajo del pipeline de CI depende**, pueden modificarlos para contener **comandos maliciosos**, en √∫ltima instancia "envenenando" el pipeline de CI que ejecuta estos comandos.

Para que un actor malintencionado tenga √©xito al realizar un ataque PPE, debe ser capaz de:

* Tener **acceso de escritura a la plataforma VCS**, ya que generalmente los pipelines se activan cuando se realiza un push o una solicitud de extracci√≥n. (Consulte la metodolog√≠a de pentesting de VCS para obtener un resumen de las formas de obtener acceso).
  * Tenga en cuenta que a veces una **PR externa cuenta como "acceso de escritura"**.
* Incluso si tiene permisos de escritura, debe asegurarse de que puede **modificar el archivo de configuraci√≥n de CI o otros archivos en los que se basa la configuraci√≥n**.
  * Para esto, es posible que deba ser capaz de **burlar las protecciones de la rama**.

Hay 3 sabores de PPE:

* **D-PPE**: Un ataque **Directo P
## Informaci√≥n relevante

### Herramientas y CIS Benchmark

* \*\*\*\*[**Chain-bench**](https://github.com/aquasecurity/chain-bench) es una herramienta de c√≥digo abierto para auditar su pila de cadena de suministro de software para el cumplimiento de seguridad basado en un nuevo [**CIS Software Supply Chain benchmark**](https://github.com/aquasecurity/chain-bench/blob/main/docs/CIS-Software-Supply-Chain-Security-Guide-v1.0.pdf). La auditor√≠a se centra en todo el proceso de SDLC, donde puede revelar riesgos desde el tiempo de c√≥digo hasta el tiempo de implementaci√≥n.

### Los 10 principales riesgos de seguridad de CI/CD

Consulte este interesante art√≠culo sobre los 10 principales riesgos de CI/CD seg√∫n Cider: [https://www.cidersecurity.io/top-10-cicd-security-risks/](https://www.cidersecurity.io/top-10-cicd-security-risks/)

### Laboratorios

* En cada plataforma que se puede ejecutar localmente, encontrar√° c√≥mo lanzarla localmente para que pueda configurarla como desee para probarla.
* Laboratorio de Gitea + Jenkins: [https://github.com/cider-security-research/cicd-goat](https://github.com/cider-security-research/cicd-goat)

### Herramientas autom√°ticas

* \*\*\*\*[**Checkov**](https://github.com/bridgecrewio/checkov): **Checkov** es una herramienta de an√°lisis de c√≥digo est√°tico para infraestructura como c√≥digo.

## Referencias

* [https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422](https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422)

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si desea ver su **empresa anunciada en HackTricks** o si desea acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**, ¬°consulte los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obtenga el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PR a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>