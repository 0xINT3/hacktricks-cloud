---
description: >-
  Dans la m√©thodologie de pentesting CI/CD de HackTricks, vous trouverez comment tester la s√©curit√© de l'infrastructure li√©e aux activit√©s CI/CD.
---

# M√©thodologie de Pentesting CI/CD

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts Github**.

</details>

<figure><img src="../.gitbook/assets/CLOUD-logo-letters.svg" alt=""><figcaption></figcaption></figure>

## Introduction

Les environnements de d√©veloppement sont devenus une partie importante de la surface d'attaque d'aujourd'hui. Et parmi eux, les actifs les plus lucratifs sont les syst√®mes responsables de **CI et CD** - ceux qui construisent, testent et d√©ploient du code - et qui poss√®dent g√©n√©ralement les **secrets et l'acc√®s** aux actifs les plus critiques de l'organisation. Il est donc naturel que les attaquants soient continuellement √† la recherche de nouvelles fa√ßons d'acc√©der √† ces syst√®mes.

### VCS

VCS signifie **Version Control System**, ces syst√®mes permettent aux d√©veloppeurs de **g√©rer leur code source**. Le plus courant est **git** et vous trouverez g√©n√©ralement des entreprises l'utilisant sur l'une des **plateformes** suivantes :

* Github
* Gitlab
* Bitbucket
* Gitea
* Fournisseurs de cloud (ils offrent leurs propres plateformes VCS)

### Pipelines

Les pipelines permettent aux d√©veloppeurs d'**automatiser l'ex√©cution du code** (√† des fins de construction, de test, de d√©ploiement, etc.) apr√®s certaines actions : un push, une PR, un cron... Ils sont tr√®s utiles pour **automatiser toutes les √©tapes du d√©veloppement √† la production**.

Cependant, ces syst√®mes doivent √™tre **ex√©cut√©s quelque part** et g√©n√©ralement avec des **privil√®ges pour d√©ployer du code**.

## M√©thodologie de Pentesting VCS

{% hint style="info" %}
M√™me si certaines plateformes VCS permettent de cr√©er des pipelines, dans cette section, nous allons analyser uniquement les attaques potentielles sur le contr√¥le du code source.
{% endhint %}

Les plateformes qui contiennent le code source de votre projet contiennent des informations sensibles et les personnes doivent √™tre tr√®s prudentes avec les autorisations accord√©es √† l'int√©rieur de cette plateforme. Voici quelques probl√®mes courants sur les plateformes VCS que l'attaquant pourrait exploiter :

* **Fuites** : Si votre code contient des fuites dans les commits et que l'attaquant peut acc√©der au d√©p√¥t (car il est public ou parce qu'il a acc√®s), il pourrait d√©couvrir les fuites.
* **Acc√®s** : Si un attaquant peut **acc√©der √† un compte √† l'int√©rieur de la plateforme VCS**, il pourrait obtenir **plus de visibilit√© et d'autorisations**.
  * **Inscription** : Certaines plateformes permettront simplement aux utilisateurs externes de cr√©er un compte.
  * **SSO** : Certaines plateformes n'autorisent pas les utilisateurs √† s'inscrire, mais permettent √† quiconque d'acc√©der avec un SSO valide (ainsi, un attaquant pourrait utiliser son compte github pour entrer, par exemple).
  * **Identifiants** : Nom d'utilisateur + mot de passe, jetons personnels, cl√©s ssh, jetons Oauth, cookies... il existe plusieurs types de jetons qu'un utilisateur pourrait voler pour acc√©der d'une mani√®re ou d'une autre √† un d√©p√¥t.
* **Webhooks** : Les plateformes VCS permettent de g√©n√©rer des webhooks. S'ils ne sont **pas prot√©g√©s** par des secrets invisibles, un **attaquant pourrait les exploiter**.
  * Si aucun secret n'est en place, l'attaquant pourrait exploiter le webhook de la plateforme tierce.
  * Si le secret est dans l'URL, il se passe la m√™me chose et l'attaquant a √©galement le secret.
* **Compromission du code** : Si un acteur malveillant a une sorte d'acc√®s **en √©criture** sur les d√©p√¥ts, il pourrait essayer d'**injecter du code malveillant**. Pour r√©ussir, il pourrait avoir besoin de **contourner les protections de branche**. Ces actions peuvent √™tre effectu√©es avec diff√©rents objectifs en t√™te :
  * Compromettre la branche principale pour **compromettre la production**.
  * Compromettre la branche principale (ou d'autres branches) pour **compromettre les machines des d√©veloppeurs** (car ils ex√©cutent g√©n√©ralement des tests, terraform ou d'autres choses √† l'int√©rieur du d√©p√¥t sur leurs machines).
  * **Compromettre le pipeline** (voir la section suivante)

## M√©thodologie de Pentesting Pipelines

La fa√ßon la plus courante de d√©finir un pipeline est d'utiliser un **fichier de configuration CI h√©berg√© dans le d√©p√¥t** que le pipeline construit. Ce fichier d√©crit l'ordre des travaux ex√©cut√©s, les conditions qui affectent le flux et les param√®tres de l'environnement de construction.\
Ces fichiers ont g√©n√©ralement un nom et un format coh√©rents, par exemple - Jenkinsfile (Jenkins), .gitlab-ci.yml (GitLab), .circleci/config.yml (CircleCI), et les fichiers YAML GitHub Actions situ√©s sous .github/workflows. Lorsqu'il est d√©clench√©, le travail de pipeline **tire le code** de la source s√©lectionn√©e (par exemple, commit / branche) et **ex√©cute les commandes sp√©cifi√©es dans le fichier de configuration CI** contre ce code.

Par cons√©quent, l'objectif ultime de l'attaquant est de **compromettre d'une mani√®re ou d'une autre ces fichiers de configuration** ou les **commandes qu'ils ex√©cutent**.

### PPE - Poisoned Pipeline Execution

Le vecteur Poisoned Pipeline Execution (PPE) **exploite les autorisations contre un r√©f√©rentiel SCM**, de mani√®re √† ce qu'un pipeline CI ex√©cute des commandes malveillantes. Les utilisateurs qui ont des autorisations pour **manipuler les fichiers de configuration CI ou d'autres fichiers sur lesquels le travail de pipeline CI d√©pend**, peuvent les modifier pour contenir des **commandes malveillantes**, empoisonnant ainsi le pipeline CI qui ex√©cute ces commandes.

Pour qu'un acteur malveillant r√©ussisse √† effectuer une attaque PPE, il doit √™tre capable de :

* Avoir **un acc√®s en √©criture √† la plateforme VCS**, car les pipelines sont g√©n√©ralement d√©clench√©s lorsqu'un push ou une pull request est effectu√©. (Voir
## Informations suppl√©mentaires

### Outils et CIS Benchmark

* \*\*\*\*[**Chain-bench**](https://github.com/aquasecurity/chain-bench) est un outil open-source pour auditer votre pile d'approvisionnement logiciel pour la conformit√© de s√©curit√© bas√©e sur un nouveau [**CIS Software Supply Chain benchmark**](https://github.com/aquasecurity/chain-bench/blob/main/docs/CIS-Software-Supply-Chain-Security-Guide-v1.0.pdf). L'audit se concentre sur l'ensemble du processus SDLC, o√π il peut r√©v√©ler les risques du temps de code au temps de d√©ploiement.

### Top 10 des risques de s√©curit√© CI/CD

Consultez cet article int√©ressant sur les 10 principaux risques CI/CD selon Cider: [https://www.cidersecurity.io/top-10-cicd-security-risks/](https://www.cidersecurity.io/top-10-cicd-security-risks/)

### Laboratoires

* Sur chaque plateforme que vous pouvez ex√©cuter localement, vous trouverez comment la lancer localement afin de la configurer comme vous le souhaitez pour la tester.
* Laboratoire Gitea + Jenkins: [https://github.com/cider-security-research/cicd-goat](https://github.com/cider-security-research/cicd-goat)

### Outils automatiques

* \*\*\*\*[**Checkov**](https://github.com/bridgecrewio/checkov): **Checkov** est un outil d'analyse de code statique pour l'infrastructure en tant que code.

## R√©f√©rences

* [https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422](https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422)

<details>

<summary><strong>Soutenez HackTricks et obtenez des avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs.
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts github.**

</details>