---
description: >-
  Na metodologia de pentesting CI/CD do HackTricks, voc√™ encontrar√° como testar a infraestrutura relacionada √†s atividades de CI/CD.
---

# Metodologia de Pentesting CI/CD

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) **e** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **reposit√≥rios do github.**

</details>

<figure><img src="../.gitbook/assets/CLOUD-logo-letters.svg" alt=""><figcaption></figcaption></figure>

## Introdu√ß√£o

Os ambientes de desenvolvimento se tornaram uma parte importante da superf√≠cie de ataque atual. E dentro deles, os ativos mais lucrativos s√£o os sistemas respons√°veis pelo **CI e CD** - aqueles que constroem, testam e implantam c√≥digo - e geralmente possuem os **segredos e acesso** aos ativos mais cr√≠ticos da organiza√ß√£o. Portanto, √© natural que os atacantes estejam continuamente procurando novas maneiras de acessar esses sistemas.

### VCS

VCS significa **Version Control System**, esses sistemas permitem que os desenvolvedores **gerenciem seu c√≥digo-fonte**. O mais comum √© o **git** e voc√™ geralmente encontrar√° empresas usando-o em uma das seguintes **plataformas**:

* Github
* Gitlab
* Bitbucket
* Gitea
* Provedores de nuvem (eles oferecem suas pr√≥prias plataformas VCS)

### Pipelines

As pipelines permitem que os desenvolvedores **automatizem a execu√ß√£o de c√≥digo** (para fins de constru√ß√£o, teste, implanta√ß√£o, etc.) ap√≥s determinadas a√ß√µes ocorrerem: um push, um PR, cron... Elas s√£o extremamente √∫teis para **automatizar todos os passos do desenvolvimento √† produ√ß√£o**.

No entanto, esses sistemas precisam ser **executados em algum lugar** e geralmente com **credenciais privilegiadas para implantar c√≥digo**.

## Metodologia de Pentesting VCS

{% hint style="info" %}
Mesmo que algumas plataformas VCS permitam criar pipelines para esta se√ß√£o, vamos analisar apenas ataques potenciais ao controle do c√≥digo-fonte.
{% endhint %}

As plataformas que cont√™m o c√≥digo-fonte do seu projeto cont√™m informa√ß√µes confidenciais e as pessoas precisam ter muito cuidado com as permiss√µes concedidas dentro desta plataforma. Esses s√£o alguns problemas comuns em plataformas VCS que um atacante pode explorar:

* **Vazamentos**: Se o seu c√≥digo cont√©m vazamentos nos commits e o atacante pode acessar o reposit√≥rio (porque √© p√∫blico ou porque ele tem acesso), ele pode descobrir os vazamentos.
* **Acesso**: Se um atacante pode **acessar uma conta dentro da plataforma VCS**, ele pode obter **mais visibilidade e permiss√µes**.
  * **Registro**: Algumas plataformas permitir√£o que usu√°rios externos criem uma conta.
  * **SSO**: Algumas plataformas n√£o permitir√£o que os usu√°rios se registrem, mas permitir√£o que qualquer pessoa acesse com um SSO v√°lido (ent√£o um atacante pode usar sua conta do github para entrar, por exemplo).
  * **Credenciais**: Nome de usu√°rio + senha, tokens pessoais, chaves ssh, tokens Oauth, cookies... existem v√°rios tipos de tokens que um usu√°rio pode roubar para acessar de alguma forma um reposit√≥rio.
* **Webhooks**: As plataformas VCS permitem gerar webhooks. Se eles n√£o estiverem **protegidos** com segredos n√£o vis√≠veis, um **atacante pode explor√°-los**.
  * Se nenhum segredo estiver em vigor, o atacante pode explorar o webhook da plataforma de terceiros.
  * Se o segredo estiver na URL, o mesmo acontece e o atacante tamb√©m tem o segredo.
* **Comprometimento de c√≥digo**: Se um ator mal-intencionado tiver algum tipo de acesso de **escrita** sobre os reposit√≥rios, ele poder√° tentar **injetar c√≥digo malicioso**. Para ter sucesso, ele pode precisar **burlar as prote√ß√µes de branch**. Essas a√ß√µes podem ser realizadas com diferentes objetivos em mente:
  * Comprometer o branch principal para **comprometer a produ√ß√£o**.
  * Comprometer o branch principal (ou outros branches) para **comprometer as m√°quinas dos desenvolvedores** (j√° que eles geralmente executam testes, terraform ou outras coisas dentro do reposit√≥rio em suas m√°quinas).
  * **Comprometer a pipeline** (ver pr√≥xima se√ß√£o)

## Metodologia de Pentesting Pipelines

A maneira mais comum de definir uma pipeline √© usando um **arquivo de configura√ß√£o CI hospedado no reposit√≥rio** que a pipeline constr√≥i. Este arquivo descreve a ordem dos trabalhos executados, as condi√ß√µes que afetam o fluxo e as configura√ß√µes do ambiente de constru√ß√£o.\
Esses arquivos geralmente t√™m um nome e formato consistentes, por exemplo - Jenkinsfile (Jenkins), .gitlab-ci.yml (GitLab), .circleci/config.yml (CircleCI) e os arquivos YAML do GitHub Actions localizados em .github/workflows. Quando acionado, o trabalho da pipeline **extrai o c√≥digo** da fonte selecionada (por exemplo, commit / branch) e **executa os comandos especificados no arquivo de configura√ß√£o CI** contra esse c√≥digo.

Portanto, o objetivo final do atacante √© de alguma forma **comprometer esses arquivos de configura√ß√£o** ou os **comandos que eles executam**.

### PPE - Execu√ß√£o de Pipeline Envenenada

O vetor de Execu√ß√£o de Pipeline Envenenada (PPE) **abusa das permiss√µes contra um reposit√≥rio SCM**, de uma maneira que faz com que uma pipeline CI execute comandos maliciosos. Usu√°rios que t√™m permiss√µes para **manipular os arquivos de configura√ß√£o CI ou outros arquivos nos quais o trabalho da pipeline CI depende**, podem modific√°-los para conter **comandos maliciosos**, "envenenando" a pipeline CI que executa esses comandos.

Para que um ator mal-intencionado tenha sucesso em realizar um ataque PPE, ele precisa ser capaz de:

* Ter **acesso de escrita √† plataforma VCS**, j√° que as pipelines geralmente s√£o acionadas quando um push ou uma solicita√ß√£o de pull √© realizada. (Verifique a metodologia de pentesting VCS para um resumo das maneiras de obter acesso).
  * Observe que √†s vezes um **PR externo conta como "acesso de escrita"**.
* Mesmo que tenha permiss√µes de escrita, ele precisa ter certeza de que pode **modificar o arquivo de configura√ß√£o CI ou outros arquivos nos quais a configura√ß√£o depend
## Mais informa√ß√µes relevantes

### Ferramentas e CIS Benchmark

* \*\*\*\*[**Chain-bench**](https://github.com/aquasecurity/chain-bench) √© uma ferramenta de c√≥digo aberto para auditoria da sua pilha de cadeia de suprimentos de software para conformidade de seguran√ßa com base em um novo [**CIS Software Supply Chain benchmark**](https://github.com/aquasecurity/chain-bench/blob/main/docs/CIS-Software-Supply-Chain-Security-Guide-v1.0.pdf). A auditoria se concentra em todo o processo SDLC, onde pode revelar riscos desde o tempo de codifica√ß√£o at√© o tempo de implanta√ß√£o.

### Principais 10 riscos de seguran√ßa CI/CD

Confira este artigo interessante sobre os 10 principais riscos de CI/CD de acordo com a Cider: [https://www.cidersecurity.io/top-10-cicd-security-risks/](https://www.cidersecurity.io/top-10-cicd-security-risks/)

### Laborat√≥rios

* Em cada plataforma que voc√™ pode executar localmente, voc√™ encontrar√° como inici√°-la localmente para que possa configur√°-la como desejar para test√°-la.
* Laborat√≥rio Gitea + Jenkins: [https://github.com/cider-security-research/cicd-goat](https://github.com/cider-security-research/cicd-goat)

### Ferramentas Autom√°ticas

* \*\*\*\*[**Checkov**](https://github.com/bridgecrewio/checkov): **Checkov** √© uma ferramenta de an√°lise de c√≥digo est√°tico para infraestrutura como c√≥digo.

## Refer√™ncias

* [https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422](https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422)

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>