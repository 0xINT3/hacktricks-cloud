---
description: >-
HackTricks CI/CDメソドロジーでは、CI/CDアクティビティに関連するインフラストラクチャのペンテスト方法を説明します。
---

# CI/CDペンテストメソドロジー

<details>

<summary><strong>ハックトリックスをサポートして特典を受け取る！</strong></summary>

* **ハックトリックスで会社を宣伝**したい場合や、**最新バージョンのPEASSを入手**したい場合、または**HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をご確認ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションをご覧ください
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

<figure><img src="../.gitbook/assets/CLOUD-logo-letters.svg" alt=""><figcaption></figcaption></figure>

## はじめに

開発環境は、現代の攻撃対象の主要な部分となっています。そして、その中でも最も収益性の高い資産は、コードのビルド、テスト、デプロイを担当するシステムであり、通常は組織の最も重要な資産へのアクセス権限を持っています。そのため、攻撃者はこれらのシステムへのアクセス手段を常に探し続けています。

### VCS

VCSは**バージョン管理システム**の略で、開発者が**ソースコードを管理**するためのシステムです。最も一般的なものは**git**であり、以下のいずれかの**プラットフォーム**で使用されていることが一般的です。

* Github
* Gitlab
* Bitbucket
* Gitea
* クラウドプロバイダ（独自のVCSプラットフォームを提供している）

### パイプライン

パイプラインは、開発者が特定のアクションが発生した後にコードの実行を**自動化する**ためのものです。プッシュ、PR、cronなどが発生した後に、コードのビルド、テスト、デプロイなどの目的でパイプラインが実行されます。これらのシステムは、通常は**特権のある資格情報でコードをデプロイする**ため、非常に便利です。

## VCSペンテストメソドロジー

{% hint style="info" %}
一部のVCSプラットフォームでは、このセクションでパイプラインを作成できる場合がありますが、ここではソースコードの制御に対する潜在的な攻撃のみを分析します。
{% endhint %}

プロジェクトのソースコードを含むプラットフォームには、機密情報が含まれており、このプラットフォーム内で許可される権限には非常に注意する必要があります。攻撃者が悪用できる可能性のあるVCSプラットフォーム全般の一般的な問題は次のとおりです。

* **情報漏洩**: コードに情報漏洩が含まれており、攻撃者がリポジトリにアクセスできる場合（公開されているか、アクセス権限を持っている場合）、情報漏洩を発見することができます。
* **アクセス**: 攻撃者がVCSプラットフォーム内のアカウントに**アクセスできる**場合、**より多くの可視性と権限**を取得することができます。
* **登録**: 一部のプラットフォームでは、外部ユーザーがアカウントを作成できるようになっています。
* **SSO**: 一部のプラットフォームでは、ユーザーが登録できない場合でも、有効なSSOでアクセスできるようになっています（したがって、攻撃者は自分のGitHubアカウントを使用してアクセスできます）。
* **資格情報**: ユーザーが盗むことができるユーザー名+パスワード、パーソナルトークン、SSHキー、OAuthトークン、クッキーなど、さまざまな種類のトークンがあります。これらのトークンを盗んでリポジトリにあるいくつかの方法でアクセスすることができます。
* **Webフック**: VCSプラットフォームでは、Webフックを生成することができます。これらが**非表示のシークレットで保護されていない**場合、**攻撃者はこれらを悪用**することができます。
* シークレットが設定されていない場合、攻撃者はサードパーティプラットフォームのWebフックを悪用することができます。
* シークレットがURLに含まれている場合、同じことが起こり、攻撃者はシークレットも持っています。
* **コードの侵害**: 悪意のあるアクターがリポジトリ上である種の**書き込み**アクセス権を持っている場合、**悪意のあるコードを注入**しようとすることができます。成功するためには、**ブランチの保護をバイパス**する必要がある場合があります。これらのアクションは、さまざまな目的で実行できます。
* メインブランチを侵害して**本番環境を侵害**する。
* メインブランチ（または他のブランチ）を侵害して、開発者のマシンを侵害する（通常、開発者はリポジトリ内でテスト、Terraformなどの他の作業を実行します）。
* パイプラインを侵害する（次のセクションを参照）

## パイプラインペンテストメソドロジー

パイプラインを定義する最も一般的な方法は、パイプラインをビルドするリポジトリにホストされた**CI設定ファイルを使用する**ことです。このファイルは、実行されるジョブの順序、フローに影響を与える条件、およびビルド環境の設定を記述します。\
これらのファイルには、一貫した名前と形式があります。たとえば、Jenkinsfile（Jenkins）、.gitlab-ci.yml（GitLab）、.circleci/config.yml（CircleCI）、および.github/workflows以下にあるGitHub Actions YAMLファイルなどです。パイプラインジョブがトリガーされると、パイプラインは選択したソース（コミット/ブランチな
### Exploitation Benefits

3つのパイプラインを汚染する方法を知ったら、攻撃者が成功した後に得られるものを確認しましょう：

- **シークレット**：前述のように、パイプラインはジョブのために**特権**を必要とします（コードの取得、ビルド、デプロイなど...）そして、これらの特権は通常**シークレットで付与**されます。これらのシークレットは通常、**環境変数やシステム内のファイル**を介してアクセス可能です。したがって、攻撃者はできるだけ多くのシークレットを外部に持ち出そうとします。
- パイプラインプラットフォームによっては、攻撃者は**構成ファイルでシークレットを指定する必要がある**場合があります。これは、攻撃者がCI構成パイプライン（たとえばI-PPE）を変更できない場合、**そのパイプラインにあるシークレットのみを外部に持ち出す**ことができることを意味します。
- **計算**：コードはどこかで実行されますが、実行場所によっては、攻撃者がさらに進行することができる場合があります。
- **オンプレミス**：パイプラインがオンプレミスで実行される場合、攻撃者は**より多くのリソースにアクセスできる内部ネットワーク**に入る可能性があります。
- **クラウド**：攻撃者は**クラウド内の他のマシンにアクセス**することができますが、IAMロール/サービスアカウント**トークン**を**クラウド内でさらなるアクセスを得るために外部に持ち出す**こともできます。
- **プラットフォームのマシン**：ジョブは**パイプラインプラットフォームのマシン**で実行されることがあり、通常は**それ以上のアクセス権限はありません**。
- **選択する**：**パイプラインプラットフォームには複数のマシンが構成されている**場合があり、**CI構成ファイルを変更できる**場合は、**悪意のあるコードを実行する場所を指定**することができます。この状況では、攻撃者はおそらく各可能なマシンで逆シェルを実行してさらなる攻撃を試みるでしょう。
- **本番環境の侵害**：パイプライン内にいて、最終バージョンがビルドされ、デプロイされるコードを侵害することができます。

## より関連性の高い情報

### ツールとCISベンチマーク

- [**Chain-bench**](https://github.com/aquasecurity/chain-bench)は、新しい[**CISソフトウェアサプライチェーンベンチマーク**](https://github.com/aquasecurity/chain-bench/blob/main/docs/CIS-Software-Supply-Chain-Security-Guide-v1.0.pdf)に基づいて、ソフトウェアサプライチェーンスタックのセキュリティコンプライアンスを監査するためのオープンソースツールです。監査は、コードの時間からデプロイの時間までのSDLCプロセス全体に焦点を当ててリスクを明らかにすることができます。

### Top 10 CI/CDセキュリティリスク

Ciderによると、次の記事にはCI/CDのトップ10のセキュリティリスクについて興味深い情報があります：[https://www.cidersecurity.io/top-10-cicd-security-risks/](https://www.cidersecurity.io/top-10-cicd-security-risks/)

### ラボ

- ローカルで実行できる各プラットフォームについては、テストするために自分で構成できるようにする方法が記載されています。
- Gitea + Jenkinsラボ：[https://github.com/cider-security-research/cicd-goat](https://github.com/cider-security-research/cicd-goat)

### 自動ツール

- [**Checkov**](https://github.com/bridgecrewio/checkov)：**Checkov**は、インフラストラクチャコードの静的コード解析ツールです。

## 参考文献

- [https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422](https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422)

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

- **HackTricksで会社を宣伝**したい場合や、**最新バージョンのPEASSを入手**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れましょう
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[NFT](https://opensea.io/collection/the-peass-family)のコレクションをご覧ください
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
- **ハッキングのトリックを共有する**ために、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
