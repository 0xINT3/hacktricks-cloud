# Informa√ß√µes B√°sicas sobre Jenkins

<details>

<summary><strong>Aprenda hacking em AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Acesso

### Usu√°rio + Senha

A forma mais comum de fazer login no Jenkins √© com um usu√°rio ou senha.

### Cookie

Se um **cookie autorizado for roubado**, ele pode ser usado para acessar a sess√£o do usu√°rio. O cookie geralmente √© chamado de `JSESSIONID.*`. (Um usu√°rio pode encerrar todas as suas sess√µes, mas ele precisaria descobrir primeiro que um cookie foi roubado).

### SSO/Plugins

O Jenkins pode ser configurado usando plugins para ser **acess√≠vel via SSO de terceiros**.

### Tokens

**Os usu√°rios podem gerar tokens** para dar acesso a aplica√ß√µes para se passarem por eles via CLI ou REST API.

### Chaves SSH

Este componente fornece um servidor SSH embutido para o Jenkins. √â uma interface alternativa para o [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), e comandos podem ser invocados desta forma usando qualquer cliente SSH. (Da [documenta√ß√£o](https://plugins.jenkins.io/sshd/))

## Autoriza√ß√£o

Em `/configureSecurity` √© poss√≠vel **configurar o m√©todo de autoriza√ß√£o do Jenkins**. Existem v√°rias op√ß√µes:

* **Qualquer um pode fazer qualquer coisa**: At√© o acesso an√¥nimo pode administrar o servidor.
* **Modo legado**: Igual ao Jenkins <1.164. Se voc√™ tem o **papel de "admin"**, voc√™ ter√° **controle total** sobre o sistema, e **caso contr√°rio** (incluindo usu√°rios **an√¥nimos**) voc√™ ter√° acesso **somente leitura**.
* **Usu√°rios logados podem fazer qualquer coisa**: Neste modo, todo **usu√°rio logado tem controle total** do Jenkins. O √∫nico usu√°rio que n√£o ter√° controle total √© o **usu√°rio an√¥nimo**, que s√≥ tem acesso **somente leitura**.
* **Seguran√ßa baseada em matriz**: Voc√™ pode configurar **quem pode fazer o qu√™** em uma tabela. Cada **coluna** representa uma **permiss√£o**. Cada **linha** **representa** um **usu√°rio ou um grupo/papel**. Isso inclui um usu√°rio especial '**an√¥nimo**', que representa **usu√°rios n√£o autenticados**, bem como '**autenticado**', que representa **todos os usu√°rios autenticados**.

![](<../../.gitbook/assets/image (40).png>)

* **Estrat√©gia de Autoriza√ß√£o Baseada em Matriz de Projeto:** Este modo √© uma **extens√£o** da "**seguran√ßa baseada em matriz**" que permite uma matriz ACL adicional ser **definida para cada projeto separadamente**.
* **Estrat√©gia Baseada em Pap√©is:** Permite definir autoriza√ß√µes usando uma **estrat√©gia baseada em pap√©is**. Gerencie os pap√©is em `/role-strategy`.

## **Dom√≠nio de Seguran√ßa**

Em `/configureSecurity` √© poss√≠vel **configurar o dom√≠nio de seguran√ßa**. Por padr√£o, o Jenkins inclui suporte para alguns Dom√≠nios de Seguran√ßa diferentes:

* **Delegar ao cont√™iner de servlet**: Para **delegar a autentica√ß√£o a um cont√™iner de servlet que executa o controlador do Jenkins**, como [Jetty](https://www.eclipse.org/jetty/).
* **Pr√≥prio banco de dados de usu√°rios do Jenkins:** Use **o pr√≥prio armazenamento de dados de usu√°rios integrado do Jenkins** para autentica√ß√£o em vez de delegar a um sistema externo. Isso √© ativado por padr√£o.
* **LDAP**: Delega toda a autentica√ß√£o a um servidor LDAP configurado, incluindo usu√°rios e grupos.
* **Banco de dados de usu√°rios/grupos Unix**: **Delega a autentica√ß√£o ao banco de dados de usu√°rios do Unix** no n√≠vel do sistema operacional no controlador do Jenkins. Este modo tamb√©m permitir√° a reutiliza√ß√£o de grupos Unix para autoriza√ß√£o.

Plugins podem fornecer dom√≠nios de seguran√ßa adicionais que podem ser √∫teis para incorporar o Jenkins em sistemas de identidade existentes, como:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [Autentica√ß√£o GitHub](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## N√≥s, Agentes e Executores do Jenkins

Defini√ß√µes da [documenta√ß√£o](https://www.jenkins.io/doc/book/managing/nodes/):

**N√≥s** s√£o as **m√°quinas** nas quais os **agentes de build executam**. O Jenkins monitora cada n√≥ anexado para espa√ßo em disco, espa√ßo livre tempor√°rio, swap livre, sincroniza√ß√£o/hora do rel√≥gio e tempo de resposta. Um n√≥ √© retirado de linha se algum desses valores sair do limite configurado.

**Agentes** **gerenciam** a **execu√ß√£o de tarefas** em nome do controlador do Jenkins **usando executores**. Um agente pode usar qualquer sistema operacional que suporte Java. Ferramentas necess√°rias para builds e testes s√£o instaladas no n√≥ onde o agente executa; elas podem **ser instaladas diretamente ou em um cont√™iner** (Docker ou Kubernetes). Cada **agente √© efetivamente um processo com seu pr√≥prio PID** na m√°quina host.

Um **executor** √© um **espa√ßo para execu√ß√£o de tarefas**; efetivamente, √© **uma thread no agente**. O **n√∫mero de executores** em um n√≥ define o n√∫mero de **tarefas concorrentes** que podem ser executadas naquele n√≥ ao mesmo tempo. Em outras palavras, isso determina o **n√∫mero de `stages` de Pipeline concorrentes** que podem ser executados naquele n√≥ ao mesmo tempo.

## Segredos do Jenkins

### Criptografia de Segredos e Credenciais

Defini√ß√£o da [documenta√ß√£o](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials):
O Jenkins usa **AES para criptografar e proteger segredos**, credenciais e suas respectivas chaves de criptografia. Essas chaves de criptografia s√£o armazenadas em `$JENKINS_HOME/secrets/` junto com a chave mestra usada para proteger as referidas chaves. Este diret√≥rio deve ser configurado para que apenas o usu√°rio do sistema operacional em que o controlador do Jenkins est√° executando tenha acesso de leitura e escrita a este diret√≥rio (ou seja, um valor de `chmod` de `0700` ou usando atributos de arquivo apropriados). A **chave mestra** (√†s vezes referida como "chave de criptografia de chave" em criptojarg√£o) √© **armazenada** _**sem criptografia**_ no sistema de arquivos do controlador do Jenkins em **`$JENKINS_HOME/secrets/master.key`** o que n√£o protege contra atacantes com acesso direto a esse arquivo. A maioria dos usu√°rios e desenvolvedores usar√° essas chaves de criptografia indiretamente atrav√©s da API [Secret](https://javadoc.jenkins.io/byShortName/Secret) para criptografar dados secretos gen√©ricos ou atrav√©s da API de credenciais. Para os criptocuriosos, o Jenkins usa AES no modo de encadeamento de blocos de cifra (CBC) com preenchimento PKCS#5 e IVs aleat√≥rios para criptografar inst√¢ncias de [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) que s√£o armazenadas em `$JENKINS_HOME/secrets/` com um nome de arquivo correspondente ao seu id `CryptoConfidentialKey`. Ids de chave comuns incluem:

* `hudson.util.Secret`: usado para segredos gen√©ricos;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: usado para alguns tipos de credenciais;
* `jenkins.model.Jenkins.crumbSalt`: usado pelo [mecanismo de prote√ß√£o CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); e

### Acesso √†s Credenciais

As credenciais podem ser **escopadas para provedores globais** (`/credentials/`) que podem ser acessados por qualquer projeto configurado, ou podem ser escopadas para **projetos espec√≠ficos** (`/job/<nome-do-projeto>/configure`) e, portanto, acess√≠veis apenas a partir do projeto espec√≠fico.

De acordo com [**a documenta√ß√£o**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Credenciais que est√£o no escopo s√£o disponibilizadas ao pipeline sem limita√ß√£o. Para **evitar exposi√ß√£o acidental no log de build**, as credenciais s√£o **mascaradas** da sa√≠da regular, ent√£o uma invoca√ß√£o de `env` (Linux) ou `set` (Windows), ou programas imprimindo seu ambiente ou par√¢metros **n√£o revelar√£o** no log de build para usu√°rios que de outra forma n√£o teriam acesso √†s credenciais.

**√â por isso que, para exfiltrar as credenciais, um atacante precisa, por exemplo, codific√°-las em base64.**

## Refer√™ncias

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

<details>

<summary><strong>Aprenda hacking em AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
