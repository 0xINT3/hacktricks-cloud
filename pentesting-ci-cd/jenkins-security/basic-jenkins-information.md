# Informa√ß√µes B√°sicas do Jenkins

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Acesso

### Nome de Usu√°rio + Senha

A forma mais comum de fazer login no Jenkins √© com um nome de usu√°rio ou uma senha.

### Cookie

Se um **cookie autorizado for roubado**, ele pode ser usado para acessar a sess√£o do usu√°rio. O cookie geralmente √© chamado de `JSESSIONID.*`. (Um usu√°rio pode encerrar todas as suas sess√µes, mas primeiro precisaria descobrir que um cookie foi roubado).

### SSO/Plugins

O Jenkins pode ser configurado usando plugins para ser **acess√≠vel via SSO de terceiros**.

### Tokens

**Usu√°rios podem gerar tokens** para dar acesso a aplicativos para se passarem por eles via CLI ou REST API.

### Chaves SSH

Este componente fornece um servidor SSH integrado para o Jenkins. √â uma interface alternativa para o [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), e comandos podem ser invocados dessa maneira usando qualquer cliente SSH. (Dos [documentos](https://plugins.jenkins.io/sshd/))

## Autoriza√ß√£o

Em `/configureSecurity` √© poss√≠vel **configurar o m√©todo de autoriza√ß√£o do Jenkins**. Existem v√°rias op√ß√µes:

* **Qualquer um pode fazer qualquer coisa**: Mesmo o acesso an√¥nimo pode administrar o servidor.
* **Modo legado**: O mesmo que o Jenkins <1.164. Se voc√™ tiver a fun√ß√£o de **"admin"**, ter√° **controle total** sobre o sistema, e **caso contr√°rio** (incluindo usu√°rios **an√¥nimos**), ter√° acesso **somente leitura**.
* **Usu√°rios logados podem fazer qualquer coisa**: Neste modo, cada **usu√°rio logado tem controle total** do Jenkins. O √∫nico usu√°rio que n√£o ter√° controle total √© o **usu√°rio an√¥nimo**, que ter√° apenas acesso **somente leitura**.
* **Seguran√ßa baseada em matriz**: Voc√™ pode configurar **quem pode fazer o qu√™** em uma tabela. Cada **coluna** representa uma **permiss√£o**. Cada **linha** **representa** um **usu√°rio ou um grupo/papel**. Isso inclui um usu√°rio especial '**an√¥nimo**', que representa **usu√°rios n√£o autenticados**, bem como '**autenticado**', que representa **todos os usu√°rios autenticados**.

![](<../../.gitbook/assets/image (149).png>)

* **Estrat√©gia de Autoriza√ß√£o de Matriz Baseada em Projeto:** Este modo √© uma **extens√£o** da "**seguran√ßa baseada em matriz**" que permite definir matrizes ACL adicionais para cada projeto separadamente.
* **Estrat√©gia Baseada em Fun√ß√£o:** Permite definir autoriza√ß√µes usando uma **estrat√©gia baseada em fun√ß√£o**. Gerencie as fun√ß√µes em `/role-strategy`.

## **Reino de Seguran√ßa**

Em `/configureSecurity` √© poss√≠vel **configurar o reino de seguran√ßa**. Por padr√£o, o Jenkins inclui suporte para alguns Reinos de Seguran√ßa diferentes:

* **Delegar ao cont√™iner servlet**: Para **delegar autentica√ß√£o a um cont√™iner servlet executando o controlador Jenkins**, como [Jetty](https://www.eclipse.org/jetty/).
* **Banco de dados de usu√°rios pr√≥prio do Jenkins:** Use o **banco de dados de usu√°rios integrado do Jenkins** para autentica√ß√£o em vez de delegar para um sistema externo. Isso √© habilitado por padr√£o.
* **LDAP**: Delega toda a autentica√ß√£o para um servidor LDAP configurado, incluindo usu√°rios e grupos.
* **Banco de dados de usu√°rios/grupos Unix**: **Delega a autentica√ß√£o para o banco de dados de usu√°rios do Unix** no n√≠vel do sistema operacional subjacente no controlador Jenkins. Este modo tamb√©m permitir√° o reuso de grupos Unix para autoriza√ß√£o.

Os plugins podem fornecer reinos de seguran√ßa adicionais que podem ser √∫teis para incorporar o Jenkins em sistemas de identidade existentes, como:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [Autentica√ß√£o GitHub](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## N√≥s, Agentes e Executores do Jenkins

Defini√ß√µes dos [documentos](https://www.jenkins.io/doc/book/managing/nodes/):

**N√≥s** s√£o as **m√°quinas** em que os **agentes de build s√£o executados**. O Jenkins monitora cada n√≥ anexado quanto ao espa√ßo em disco, espa√ßo tempor√°rio livre, swap livre, tempo/sincroniza√ß√£o do rel√≥gio e tempo de resposta. Um n√≥ √© retirado offline se algum desses valores ultrapassar o limite configurado.

**Agentes** **gerenciam** a **execu√ß√£o de tarefas** em nome do controlador Jenkins **usando executores**. Um agente pode usar qualquer sistema operacional que suporte Java. As ferramentas necess√°rias para builds e testes s√£o instaladas no n√≥ onde o agente √© executado; elas podem **ser instaladas diretamente ou em um cont√™iner** (Docker ou Kubernetes). Cada **agente √© efetivamente um processo com seu pr√≥prio PID** na m√°quina host.

Um **executor** √© um **slot para a execu√ß√£o de tarefas**; efetivamente, √© **uma thread no agente**. O **n√∫mero de executores** em um n√≥ define o n√∫mero de **tarefas concorrentes** que podem ser executadas nesse n√≥ ao mesmo tempo. Em outras palavras, isso determina o **n√∫mero de `est√°gios` de Pipeline concorrentes** que podem ser executados nesse n√≥ ao mesmo tempo.

## Segredos do Jenkins

### Criptografia de Segredos e Credenciais

Defini√ß√£o dos [documentos](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): O Jenkins usa **AES para criptografar e proteger segredos**, credenciais e suas respectivas chaves de criptografia. Essas chaves de criptografia s√£o armazenadas em `$JENKINS_HOME/secrets/` juntamente com a chave mestra usada para proteger tais chaves. Este diret√≥rio deve ser configurado para que apenas o usu√°rio do sistema operacional no qual o controlador Jenkins est√° sendo executado tenha acesso de leitura e grava√ß√£o a este diret√≥rio (ou seja, um valor `chmod` de `0700` ou usando atributos de arquivo apropriados). A **chave mestra** (√†s vezes referida como "chave de criptografia de chave" em jarg√£o criptogr√°fico) √© **armazenada \_n√£o criptografada**\_ no sistema de arquivos do controlador Jenkins em **`$JENKINS_HOME/secrets/master.key`** o que n√£o protege contra atacantes com acesso direto a esse arquivo. A maioria dos usu√°rios e desenvolvedores usar√° essas chaves de criptografia indiretamente por meio da [API Secret](https://javadoc.jenkins.io/byShortName/Secret) para criptografar dados secretos gen√©ricos ou por meio da API de credenciais. Para os curiosos sobre criptografia, o Jenkins usa AES no modo de encadeamento de blocos (CBC) com preenchimento PKCS#5 e IVs aleat√≥rios para criptografar inst√¢ncias de [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) que s√£o armazenadas em `$JENKINS_HOME/secrets/` com um nome de arquivo correspondente ao seu id `CryptoConfidentialKey`. Os ids de chave comuns incluem:

* `hudson.util.Secret`: usado para segredos gen√©ricos;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: usado para alguns tipos de credenciais;
* `jenkins.model.Jenkins.crumbSalt`: usado pelo [mecanismo de prote√ß√£o CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); e
### Acesso a Credenciais

As credenciais podem ser **limitadas a provedores globais** (`/credentials/`) que podem ser acessadas por qualquer projeto configurado, ou podem ser limitadas a **projetos espec√≠ficos** (`/job/<nome-do-projeto>/configure`) e, portanto, s√≥ acess√≠veis a partir do projeto espec√≠fico.

De acordo com [**a documenta√ß√£o**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): As credenciais que est√£o no escopo s√£o disponibilizadas para o pipeline sem limita√ß√µes. Para **evitar exposi√ß√£o acidental no log de compila√ß√£o**, as credenciais s√£o **mascaradas** na sa√≠da regular, ent√£o uma invoca√ß√£o de `env` (Linux) ou `set` (Windows), ou programas que imprimem seu ambiente ou par√¢metros **n√£o as revelariam no log de compila√ß√£o** para usu√°rios que n√£o teriam acesso √†s credenciais de outra forma.

**Por isso, para extrair as credenciais, um atacante precisa, por exemplo, codific√°-las em base64.**

## Refer√™ncias

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
