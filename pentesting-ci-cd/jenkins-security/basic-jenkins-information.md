# 基本的 Jenkins 信息

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 **HackTricks 中看到您的公司广告** 或 **下载 HackTricks 的 PDF 版本**，请查看 [**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方的 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上 **关注** 我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>

## 访问

### 用户名 + 密码

登录 Jenkins 最常见的方式是使用用户名或密码。

### Cookie

如果 **授权的 cookie 被盗**，它可以被用来访问用户的会话。Cookie 通常被称为 `JSESSIONID.*`。（用户可以终止他的所有会话，但他需要首先发现 cookie 被盗）。

### SSO/插件

Jenkins 可以使用插件配置，通过第三方 SSO **可访问**。

### 令牌

**用户可以生成令牌**，以便通过 CLI 或 REST API 授权应用程序模拟他们。

### SSH 密钥

此组件为 Jenkins 提供了内置的 SSH 服务器。它是 [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/) 的另一种接口，可以使用任何 SSH 客户端以这种方式调用命令。（来自 [文档](https://plugins.jenkins.io/sshd/)）

## 授权

在 `/configureSecurity` 中，可以 **配置 Jenkins 的授权方法**。有几个选项：

* **任何人都可以做任何事**：即使是匿名访问也可以管理服务器
* **传统模式**：与 Jenkins <1.164 相同。如果您拥有 **"admin" 角色**，您将被授予对系统的 **完全控制**，**否则**（包括 **匿名** 用户）您将拥有 **读取** 权限。
* **登录用户可以做任何事**：在此模式下，每个 **登录用户都获得对 Jenkins 的完全控制**。唯一没有完全控制权的用户是 **匿名用户**，他只获得 **读取权限**。
* **基于矩阵的安全性**：您可以在表格中配置 **谁可以做什么**。每个 **列** 代表一个 **权限**。每个 **行** **代表** 一个 **用户或一个组/角色**。这包括一个特殊用户 '**anonymous**'，代表 **未经认证的用户**，以及 '**authenticated**'，代表 **所有经过认证的用户**。

![](<../../.gitbook/assets/image (40).png>)

* **基于项目的矩阵授权策略**：这种模式是对 "**基于矩阵的安全性**" 的 **扩展**，允许为每个项目单独定义额外的 ACL 矩阵。
* **基于角色的策略**：使用 **基于角色的策略** 定义授权。在 `/role-strategy` 管理角色。

## **安全领域**

在 `/configureSecurity` 中，可以 **配置安全领域**。默认情况下，Jenkins 支持几种不同的安全领域：

* **委托给 servlet 容器**：用于 **将身份验证委托给运行 Jenkins 控制器的 servlet 容器**，例如 [Jetty](https://www.eclipse.org/jetty/)。
* **Jenkins 自己的用户数据库**：使用 **Jenkins 自己的内置用户数据存储** 进行身份验证，而不是委托给外部系统。默认情况下启用此功能。
* **LDAP**：将所有身份验证委托给配置的 LDAP 服务器，包括用户和组。
* **Unix 用户/组数据库**： **将身份验证委托给 Jenkins 控制器上的底层 Unix** 操作系统级用户数据库。这种模式还允许重用 Unix 组进行授权。

插件可以提供额外的安全领域，这可能有助于将 Jenkins 集成到现有的身份系统中，例如：

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub 认证](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins 节点、代理和执行器

**节点** 是 **机器**，构建 **代理运行** 在其上。Jenkins 监控每个连接的节点的磁盘空间、临时空间、交换空间、时钟时间/同步和响应时间。如果这些值中的任何一个超出配置的阈值，节点将被脱机。

**代理** **管理** 代表 Jenkins 控制器的 **任务执行**，**使用执行器**。代理可以使用支持 Java 的任何操作系统。构建和测试所需的工具安装在代理运行的节点上；它们可以 **直接安装或在容器中安装**（Docker 或 Kubernetes）。每个 **代理实际上是宿主机上拥有自己 PID 的进程**。

**执行器** 是 **执行任务的插槽**；实际上，它是 **代理中的线程**。节点上的 **执行器数量** 定义了可以同时在该节点上执行的 **并发任务数量**。换句话说，这决定了可以同时在该节点上执行的 **并发 Pipeline `stages` 的数量**。

## Jenkins 秘密

### 秘密和凭据的加密

Jenkins 使用 **AES 加密和保护秘密**、凭据及其各自的加密密钥。这些加密密钥存储在 `$JENKINS_HOME/secrets/` 中，连同用于保护这些密钥的主密钥。应配置此目录，以便只有 Jenkins 控制器运行的操作系统用户具有对此目录的读写权限（即，`chmod` 值为 `0700` 或使用适当的文件属性）。**主密钥**（在加密术语中有时被称为 "密钥加密密钥"）**未加密地存储** 在 Jenkins 控制器文件系统中的 **`$JENKINS_HOME/secrets/master.key`**，这不会防止直接访问该文件的攻击者。大多数用户和开发人员将通过 [Secret](https://javadoc.jenkins.io/byShortName/Secret) API 间接使用这些加密密钥，用于加密通用秘密数据，或通过凭据 API。对于对加密感兴趣的人，Jenkins 使用 AES 的密码块链接（CBC）模式、PKCS#5 填充和随机 IV 来加密 [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) 的实例，这些实例存储在 `$JENKINS_HOME/secrets/` 中，文件名对应于它们的 `CryptoConfidentialKey` id。常见的密钥 id 包括：

* `hudson.util.Secret`：用于通用秘密；
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`：用于某些凭据类型；
* `jenkins.model.Jenkins.crumbSalt`：由 [CSRF 保护机制](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery) 使用；
### 凭证访问

凭证可以**限定为全局提供者**(`/credentials/`)，任何配置的项目都可以访问，或者可以限定为**特定项目**(`/job/<project-name>/configure`)，因此只能从特定项目访问。

根据[**文档**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)：在范围内的凭证可供流水线无限制地使用。为了**防止在构建日志中意外暴露**，凭证会从常规输出中**掩码**，因此调用`env`（Linux）或`set`（Windows），或者打印其环境或参数的程序将**不会在构建日志中显示它们**，对于那些本来无法访问凭证的用户来说。

**这就是为什么攻击者要窃取凭证时需要，例如，对它们进行base64编码。**

## 参考资料

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>从零开始学习AWS黑客攻击！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方的PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在**Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
