# Informations de base sur Jenkins

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PRs aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Acc√®s

### Nom d'utilisateur + Mot de passe

La mani√®re la plus courante de se connecter √† Jenkins est avec un nom d'utilisateur ou un mot de passe.

### Cookie

Si un **cookie autoris√© est vol√©**, il peut √™tre utilis√© pour acc√©der √† la session de l'utilisateur. Le cookie est g√©n√©ralement appel√© `JSESSIONID.*`. (Un utilisateur peut terminer toutes ses sessions, mais il doit d'abord d√©couvrir qu'un cookie a √©t√© vol√©).

### SSO/Plugins

Jenkins peut √™tre configur√© √† l'aide de plugins pour √™tre **accessible via un SSO tiers**.

### Tokens

**Les utilisateurs peuvent g√©n√©rer des tokens** pour donner acc√®s √† des applications pour les imiter via CLI ou REST API.

### Cl√©s SSH

Ce composant fournit un serveur SSH int√©gr√© pour Jenkins. C'est une interface alternative pour le [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), et les commandes peuvent √™tre invoqu√©es de cette mani√®re en utilisant n'importe quel client SSH. (Depuis la [documentation](https://plugins.jenkins.io/sshd/))

## Autorisation

Dans `/configureSecurity`, il est possible de **configurer la m√©thode d'autorisation de Jenkins**. Il existe plusieurs options :

* **Tout le monde peut faire n'importe quoi** : M√™me l'acc√®s anonyme peut administrer le serveur.
* **Mode h√©rit√©** : Identique √† Jenkins <1.164. Si vous avez le **r√¥le "admin"**, vous aurez **le plein contr√¥le** du syst√®me, et **sinon** (y compris les utilisateurs **anonymes**), vous aurez **un acc√®s en lecture**.
* **Les utilisateurs connect√©s peuvent tout faire** : Dans ce mode, chaque **utilisateur connect√© obtient le plein contr√¥le** de Jenkins. Le seul utilisateur qui n'aura pas le plein contr√¥le est l'**utilisateur anonyme**, qui n'obtient qu'un **acc√®s en lecture**.
* **S√©curit√© bas√©e sur une matrice** : Vous pouvez configurer **qui peut faire quoi** dans un tableau. Chaque **colonne** repr√©sente une **permission**. Chaque **ligne** **repr√©sente** un **utilisateur ou un groupe/r√¥le**. Cela inclut un utilisateur sp√©cial '**anonyme**', qui repr√©sente les **utilisateurs non authentifi√©s**, ainsi que '**authentifi√©**', qui repr√©sente **tous les utilisateurs authentifi√©s**.

![](<../../.gitbook/assets/image (40).png>)

* **Strat√©gie d'autorisation bas√©e sur le projet** : Ce mode est une **extension** de la "**s√©curit√© bas√©e sur une matrice**" qui permet de d√©finir une matrice ACL suppl√©mentaire pour **chaque projet s√©par√©ment**.
* **Strat√©gie bas√©e sur les r√¥les** : Permet de d√©finir les autorisations en utilisant une **strat√©gie bas√©e sur les r√¥les**. G√©rez les r√¥les dans `/role-strategy`.

## **Royaume de s√©curit√©**

Dans `/configureSecurity`, il est possible de **configurer le royaume de s√©curit√©**. Par d√©faut, Jenkins inclut le support pour quelques Royaumes de s√©curit√© diff√©rents :

* **D√©l√©guer au conteneur de servlet** : Pour **d√©l√©guer l'authentification √† un conteneur de servlet ex√©cutant le contr√¥leur Jenkins**, tel que [Jetty](https://www.eclipse.org/jetty/).
* **Base d'utilisateurs propre √† Jenkins** : Utilisez **la propre base de donn√©es d'utilisateurs int√©gr√©e de Jenkins** pour l'authentification au lieu de d√©l√©guer √† un syst√®me externe. Cela est activ√© par d√©faut.
* **LDAP** : D√©l√®gue toute l'authentification √† un serveur LDAP configur√©, y compris les utilisateurs et les groupes.
* **Base de donn√©es utilisateur/groupe Unix** : **D√©l√®gue l'authentification √† la base de donn√©es utilisateur Unix** au niveau du syst√®me d'exploitation sur le contr√¥leur Jenkins. Ce mode permettra √©galement de r√©utiliser les groupes Unix pour l'autorisation.

Les plugins peuvent fournir des royaumes de s√©curit√© suppl√©mentaires qui peuvent √™tre utiles pour int√©grer Jenkins dans des syst√®mes d'identit√© existants, tels que :

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [Authentification GitHub](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## N≈ìuds, Agents et Ex√©cuteurs Jenkins

D√©finitions de la [documentation](https://www.jenkins.io/doc/book/managing/nodes/) :

Les **N≈ìuds** sont les **machines** sur lesquelles les **agents de build s'ex√©cutent**. Jenkins surveille chaque n≈ìud attach√© pour l'espace disque, l'espace temporaire libre, l'espace d'√©change libre, l'heure/synchronisation de l'horloge et le temps de r√©ponse. Un n≈ìud est mis hors ligne si l'une de ces valeurs d√©passe le seuil configur√©.

Les **Agents** **g√®rent** l'**ex√©cution des t√¢ches** pour le compte du contr√¥leur Jenkins en **utilisant des ex√©cuteurs**. Un agent peut utiliser n'importe quel syst√®me d'exploitation qui prend en charge Java. Les outils n√©cessaires pour les builds et les tests sont install√©s sur le n≈ìud o√π l'agent s'ex√©cute ; ils peuvent **√™tre install√©s directement ou dans un conteneur** (Docker ou Kubernetes). Chaque **agent est effectivement un processus avec son propre PID** sur la machine h√¥te.

Un **ex√©cuteur** est un **emplacement pour l'ex√©cution des t√¢ches** ; en fait, c'est **un thread dans l'agent**. Le **nombre d'ex√©cuteurs** sur un n≈ìud d√©finit le nombre de **t√¢ches concurrentes** qui peuvent √™tre ex√©cut√©es sur ce n≈ìud en m√™me temps. En d'autres termes, cela d√©termine le **nombre de `stages` de Pipeline concurrents** qui peuvent s'ex√©cuter sur ce n≈ìud en m√™me temps.

## Secrets Jenkins

### Chiffrement des Secrets et des Identifiants

D√©finition de la [documentation](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials) :
Jenkins utilise **AES pour chiffrer et prot√©ger les secrets**, les identifiants et leurs cl√©s de chiffrement respectives. Ces cl√©s de chiffrement sont stock√©es dans `$JENKINS_HOME/secrets/` avec la cl√© principale utilis√©e pour prot√©ger ces cl√©s. Ce r√©pertoire doit √™tre configur√© de sorte que seul l'utilisateur du syst√®me d'exploitation sous lequel le contr√¥leur Jenkins s'ex√©cute ait un acc√®s en lecture et en √©criture √† ce r√©pertoire (c'est-√†-dire, une valeur `chmod` de `0700` ou en utilisant les attributs de fichier appropri√©s). La **cl√© principale** (parfois appel√©e "cl√© de chiffrement de cl√©" en jargon cryptographique) est **stock√©e** _**non chiffr√©e**_ sur le syst√®me de fichiers du contr√¥leur Jenkins dans **`$JENKINS_HOME/secrets/master.key`** ce qui ne prot√®ge pas contre les attaquants ayant un acc√®s direct √† ce fichier. La plupart des utilisateurs et d√©veloppeurs utiliseront ces cl√©s de chiffrement indirectement via soit l'API [Secret](https://javadoc.jenkins.io/byShortName/Secret) pour chiffrer des donn√©es secr√®tes g√©n√©riques, soit via l'API des identifiants. Pour les cryptocurieux, Jenkins utilise AES en mode de cha√Ænage de blocs de chiffrement (CBC) avec un padding PKCS#5 et des IV al√©atoires pour chiffrer les instances de [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) qui sont stock√©es dans `$JENKINS_HOME/secrets/` avec un nom de fichier correspondant √† leur id `CryptoConfidentialKey`. Les ids de cl√©s communs incluent :

* `hudson.util.Secret` : utilis√© pour les secrets g√©n√©riques ;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY` : utilis√© pour certains types d'identifiants ;
* `jenkins.model.Jenkins.crumbSalt` : utilis√© par le [m√©canisme de protection CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery) ; et

### Acc√®s aux Identifiants

Les identifiants peuvent √™tre **limit√©s aux fournisseurs globaux** (`/credentials/`) qui peuvent √™tre accessibles par tout projet configur√©, ou peuvent √™tre limit√©s √† **des projets sp√©cifiques** (`/job/<nom-du-projet>/configure`) et donc uniquement accessibles depuis le projet sp√©cifique.

Selon [**la documentation**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/) : Les identifiants qui sont dans le champ d'application sont mis √† disposition du pipeline sans limitation. Pour **√©viter une exposition accidentelle dans le journal de build**, les identifiants sont **masqu√©s** de la sortie r√©guli√®re, de sorte qu'une invocation de `env` (Linux) ou `set` (Windows), ou des programmes imprimant leur environnement ou leurs param√®tres **ne les r√©v√©leront pas dans le journal de build** aux utilisateurs qui n'auraient autrement pas acc√®s aux identifiants.

**C'est pourquoi pour exfiltrer les identifiants, un attaquant doit, par exemple, les encoder en base64.**

## R√©f√©rences

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PRs aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
