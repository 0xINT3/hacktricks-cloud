# Información Básica de Jenkins

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Acceso

### Nombre de Usuario + Contraseña

La forma más común de iniciar sesión en Jenkins es con un nombre de usuario o una contraseña.

### Cookie

Si se **roba una cookie autorizada**, se puede usar para acceder a la sesión del usuario. La cookie normalmente se llama `JSESSIONID.*`. (Un usuario puede terminar todas sus sesiones, pero necesitaría descubrir primero que se robó una cookie).

### SSO/Plugins

Jenkins puede configurarse mediante plugins para ser **accesible a través de SSO de terceros**.

### Tokens

**Los usuarios pueden generar tokens** para dar acceso a aplicaciones para suplantarlos a través de CLI o REST API.

### Claves SSH

Este componente proporciona un servidor SSH integrado para Jenkins. Es una interfaz alternativa para el [CLI de Jenkins](https://www.jenkins.io/doc/book/managing/cli/), y los comandos pueden invocarse de esta manera utilizando cualquier cliente SSH. (De la [documentación](https://plugins.jenkins.io/sshd/))

## Autorización

En `/configureSecurity` es posible **configurar el método de autorización de Jenkins**. Hay varias opciones:

* **Cualquiera puede hacer cualquier cosa**: Incluso el acceso anónimo puede administrar el servidor.
* **Modo legado**: Igual que Jenkins <1.164. Si tienes el **rol de "admin"**, se te otorgará **control total** sobre el sistema, y **de lo contrario** (incluyendo usuarios **anónimos**) tendrás acceso **de lectura**.
* **Usuarios registrados pueden hacer cualquier cosa**: En este modo, cada **usuario registrado obtiene control total** de Jenkins. El único usuario que no tendrá control total es el **usuario anónimo**, que solo obtiene acceso **de lectura**.
* **Seguridad basada en matriz**: Puedes configurar **quién puede hacer qué** en una tabla. Cada **columna** representa un **permiso**. Cada **fila** **representa** a un **usuario o un grupo/rol**. Esto incluye un usuario especial '**anónimo**', que representa a **usuarios no autenticados**, así como '**autenticados**', que representa a **todos los usuarios autenticados**.

![](<../../.gitbook/assets/image (40).png>)

* **Estrategia de Autorización Basada en Proyectos con Matriz**: Este modo es una **extensión** de la "**seguridad basada en matriz**" que permite una matriz de ACL adicional **definida para cada proyecto por separado**.
* **Estrategia Basada en Roles**: Permite definir autorizaciones utilizando una **estrategia basada en roles**. Administra los roles en `/role-strategy`.

## **Reino de Seguridad**

En `/configureSecurity` es posible **configurar el reino de seguridad**. Por defecto, Jenkins incluye soporte para algunos Reinos de Seguridad diferentes:

* **Delegar al contenedor de servlet**: Para **delegar la autenticación a un contenedor de servlet que ejecuta el controlador de Jenkins**, como [Jetty](https://www.eclipse.org/jetty/).
* **Base de usuarios propia de Jenkins**: Utilizar **la propia tienda de datos de usuarios integrada de Jenkins** para la autenticación en lugar de delegar a un sistema externo. Esto está habilitado por defecto.
* **LDAP**: Delegar toda la autenticación a un servidor LDAP configurado, incluyendo tanto usuarios como grupos.
* **Base de datos de usuario/grupo Unix**: **Delega la autenticación a la base de datos de usuario de Unix** a nivel del sistema operativo en el controlador de Jenkins. Este modo también permitirá reutilizar grupos Unix para la autorización.

Los plugins pueden proporcionar reinos de seguridad adicionales que pueden ser útiles para incorporar Jenkins en sistemas de identidad existentes, como:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [Autenticación de GitHub](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Nodos, Agentes y Ejecutores de Jenkins

**Los nodos** son las **máquinas** en las que se ejecutan los **agentes de construcción**. Jenkins monitorea cada nodo adjunto para espacio en disco, espacio libre temporal, swap libre, hora/sincronización del reloj y tiempo de respuesta. Un nodo se pone fuera de línea si cualquiera de estos valores sale fuera del umbral configurado.

**Los agentes** **gestionan** la **ejecución de tareas** en nombre del controlador de Jenkins **utilizando ejecutores**. Un agente puede usar cualquier sistema operativo que soporte Java. Las herramientas requeridas para las construcciones y pruebas se instalan en el nodo donde se ejecuta el agente; pueden **instalarse directamente o en un contenedor** (Docker o Kubernetes). Cada **agente es efectivamente un proceso con su propio PID** en la máquina anfitriona.

Un **ejecutor** es un **espacio para la ejecución de tareas**; efectivamente, es **un hilo en el agente**. El **número de ejecutores** en un nodo define el número de **tareas concurrentes** que pueden ejecutarse en ese nodo al mismo tiempo. En otras palabras, esto determina el **número de etapas `stages` de Pipeline concurrentes** que pueden ejecutarse en ese nodo al mismo tiempo.

## Secretos de Jenkins

### Encriptación de Secretos y Credenciales

Jenkins utiliza **AES para encriptar y proteger secretos**, credenciales y sus respectivas claves de encriptación. Estas claves de encriptación se almacenan en `$JENKINS_HOME/secrets/` junto con la clave maestra utilizada para proteger dichas claves. Este directorio debe configurarse para que solo el usuario del sistema operativo bajo el cual se ejecuta el controlador de Jenkins tenga acceso de lectura y escritura a este directorio (es decir, un valor de `chmod` de `0700` o utilizando atributos de archivo apropiados). La **clave maestra** (a veces referida como "clave de encriptación de claves" en criptojerga) se **almacena** _**sin encriptar**_ en el sistema de archivos del controlador de Jenkins en **`$JENKINS_HOME/secrets/master.key`** lo que no protege contra atacantes con acceso directo a ese archivo. La mayoría de los usuarios y desarrolladores utilizarán estas claves de encriptación indirectamente a través de la API [Secret](https://javadoc.jenkins.io/byShortName/Secret) para encriptar datos secretos genéricos o a través de la API de credenciales. Para los criptocuriosos, Jenkins utiliza AES en modo de encadenamiento de bloques de cifrado (CBC) con relleno PKCS#5 y IVs aleatorios para encriptar instancias de [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) que se almacenan en `$JENKINS_HOME/secrets/` con un nombre de archivo correspondiente a su id de `CryptoConfidentialKey`. Los ids de claves comunes incluyen:

* `hudson.util.Secret`: utilizado para secretos genéricos;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: utilizado para algunos tipos de credenciales;
* `jenkins.model.Jenkins.crumbSalt`: utilizado por el [mecanismo de protección CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); y
### Acceso a Credenciales

Las credenciales pueden estar **limitadas a proveedores globales** (`/credentials/`) a los que cualquier proyecto configurado puede acceder, o pueden estar limitadas a **proyectos específicos** (`/job/<nombre-del-proyecto>/configure`) y por lo tanto solo accesibles desde el proyecto específico.

Según [**la documentación**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Las credenciales que están en el ámbito se ponen a disposición del pipeline sin limitación. Para **evitar la exposición accidental en el registro de construcción**, las credenciales están **ocultas** en la salida regular, por lo que una invocación de `env` (Linux) o `set` (Windows), o programas que impriman su entorno o parámetros **no las revelarán en el registro de construcción** a usuarios que de otro modo no tendrían acceso a las credenciales.

**Es por eso que para exfiltrar las credenciales, un atacante necesita, por ejemplo, codificarlas en base64.**

## Referencias

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
