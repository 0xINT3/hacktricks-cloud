# 基本的Jenkins信息

<details>

<summary><strong>支持HackTricks并获得好处！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版本的HackTricks，请查看[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的账号 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## 访问

### 用户名 + 密码

登录Jenkins最常见的方式是使用用户名或密码。

### Cookie

如果一个**授权的Cookie被窃取**，它可以被用来访问用户的会话。Cookie通常被称为`JSESSIONID.*`。（用户可以终止所有会话，但他首先需要发现Cookie被盗）。

### SSO/插件

可以使用插件配置Jenkins以通过第三方SSO进行访问。

### 令牌

**用户可以生成令牌**，以便通过CLI或REST API让应用程序模拟他们进行访问。

### SSH密钥

该组件为Jenkins提供了一个内置的SSH服务器。它是[Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/)的替代接口，可以使用任何SSH客户端来调用命令。（来自[文档](https://plugins.jenkins.io/sshd/)）

## 授权

在`/configureSecurity`中，可以**配置Jenkins的授权方法**。有几个选项：

* **任何人都可以做任何事情**：即使是匿名访问也可以管理服务器。
* **传统模式**：与Jenkins <1.164相同。如果您拥有**"admin"角色**，您将被授予对系统的**完全控制**，否则（包括**匿名**用户）您将只有**读取访问权限**。
* **已登录用户可以做任何事情**：在此模式下，每个**已登录用户都可以完全控制**Jenkins。唯一没有完全控制权的用户是**匿名用户**，他们只有**读取访问权限**。
* **基于矩阵的安全性**：可以在表格中配置**谁可以做什么**。每个**列**代表一个**权限**。每个**行**代表一个**用户或组/角色**。这包括一个特殊用户'**anonymous**'，代表**未经身份验证的用户**，以及'**authenticated**'，代表**所有经过身份验证的用户**。

![](<../../.gitbook/assets/image (40).png>)

* **基于项目的矩阵授权策略**：此模式是对“基于矩阵的安全性”的**扩展**，允许为每个项目单独定义附加的ACL矩阵。
* **基于角色的策略**：使用**基于角色的策略**来定义授权。在`/role-strategy`中管理角色。

## 安全领域

在`/configureSecurity`中，可以**配置安全领域**。默认情况下，Jenkins包含对几种不同安全领域的支持：

* **委托给Servlet容器**：用于将身份验证委托给运行Jenkins控制器的Servlet容器，例如[Jetty](https://www.eclipse.org/jetty/)。
* **Jenkins自己的用户数据库**：使用Jenkins自己内置的用户数据存储库进行身份验证，而不是委托给外部系统。默认情况下启用此选项。
* **LDAP**：将所有身份验证委托给配置的LDAP服务器，包括用户和组。
* **Unix用户/组数据库**：将身份验证委托给Jenkins控制器上的底层Unix操作系统级用户数据库。此模式还允许重用Unix组进行授权。

插件可以提供其他安全领域，这些领域对于将Jenkins整合到现有身份系统中可能很有用，例如：

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub身份验证](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins节点、代理和执行器

**节点**是运行**代理**的**机器**。Jenkins监视每个连接的节点的磁盘空间、临时空间、交换空间、时钟时间/同步和响应时间。如果这些值中的任何一个超出了配置的阈值，节点将被下线。

**代理**代表Jenkins控制器**管理任务执行**，通过使用执行器。代理可以使用支持Java的任何操作系统。构建和测试所需的工具安装在代理运行的节点上；它们可以直接安装或安装在容器中（Docker或Kubernetes）。每个代理实际上是主机机器上具有自己PID的进程。

**执行器**是**任务执行的插槽**；实际上，它是代理中的一个线程。节点上的执行器数量定义了可以同时在该节点上执行的并发任务数量。换句话说，这确定了可以同时在该节点上执行的并发Pipeline `stages`的数量。

## Jenkins Secrets

### 加密秘密和凭据

Jenkins使用AES加密和保护秘密、凭据及其相应的加密密钥。这些加密密钥存储在`$JENKINS_HOME/secrets/`目录中，与用于保护这些密钥的主密钥一起。此目录应配置为只有Jenkins控制器正在运行的操作系统用户对该目录具有读写访问权限（即`chmod`值为`0700`或使用适当的文件属性）。主密钥（有时在密码术中称为“密钥加密密钥”）以**未加密的形式存储**在Jenkins控制器文件系统中的**`$JENKINS_HOME/secrets/master.key`**中，这不会防止直接访问该文件的攻击者。大多数用户和开发人员将间接使用这些加密密钥，通过[Secret](https://javadoc.jenkins.io/byShortName/Secret) API加密通用秘密数据或通过凭据API使用。对于对加密技术感兴趣的人，Jenkins使用AES以密码块链接（CBC）模式、PKCS#5填充和随机IV来加密[CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey)的实例，这些实例存储在`$JENKINS_HOME/secrets/`中，文件名与其`CryptoConfidentialKey` id对应。常见的密钥id包括：

* `hudson.util.Secret`：用于通用秘密；
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`：用于某些凭据类型；
* `jenkins.model.Jenkins.crumbSalt`：由[CSRF保护机制](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)使用；和
### 凭证访问

凭证可以**针对全局提供者**（`/credentials/`）进行范围限定，这样可以被任何配置的项目访问，或者可以针对**特定项目**（`/job/<project-name>/configure`）进行范围限定，因此只能从特定项目访问。

根据[**文档**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)：在范围内的凭证可以在流水线中无限制地使用。为了**防止在构建日志中意外暴露**，凭证会从常规输出中进行**掩码处理**，因此在构建日志中，使用`env`（Linux）或`set`（Windows）命令，或者打印其环境或参数的程序，都不会将凭证透露给其他没有访问凭证权限的用户。

**这就是为什么攻击者为了窃取凭证，例如需要对其进行base64编码。**

## 参考资料

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的**公司广告**，或者如果您想访问**PEASS的最新版本或下载PDF格式的 HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>
