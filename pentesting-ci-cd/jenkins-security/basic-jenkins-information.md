# Basic Jenkins Information

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **あなたのハッキングのコツを共有する**ために、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出してください。

</details>

## アクセス

### ユーザー名 + パスワード

Jenkinsにログインする最も一般的な方法は、ユーザー名またはパスワードを使用することです。

### Cookie

**承認されたCookieが盗まれた場合**、それを使用してユーザーのセッションにアクセスすることができます。Cookieは通常`JSESSIONID.*`と呼ばれます。（ユーザーはすべてのセッションを終了させることができますが、まずCookieが盗まれたことを知る必要があります）。

### SSO/プラグイン

Jenkinsはプラグインを使用して設定され、**サードパーティのSSOを介してアクセス可能**になります。

### トークン

**ユーザーはトークンを生成**して、CLIまたはREST APIを介してアプリケーションが自分を偽装するためのアクセスを与えることができます。

### SSHキー

このコンポーネントはJenkins用の組み込みSSHサーバーを提供します。これは[Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/)の代替インターフェースであり、任意のSSHクライアントを使用してこの方法でコマンドを呼び出すことができます。（[ドキュメント](https://plugins.jenkins.io/sshd/)より）

## 認可

`/configureSecurity`では、**Jenkinsの認可方法を設定**することができます。いくつかのオプションがあります：

* **誰でも何でもできる**: 匿名アクセスでもサーバーを管理できます
* **レガシーモード**: Jenkins <1.164と同じです。**"admin"ロール**を持っている場合は、システム全体を**完全に制御**でき、**それ以外**（**匿名**ユーザーを含む）は**読み取り**アクセスのみを持ちます。
* **ログインユーザーは何でもできる**: このモードでは、**ログインしているすべてのユーザーがJenkinsの完全な制御**を持ちます。唯一完全な制御を持たないユーザーは**匿名ユーザー**で、**読み取りアクセス**のみを持ちます。
* **マトリックスベースのセキュリティ**: テーブルで**誰が何をできるかを設定**できます。各**列**は**権限**を表し、各**行**は**ユーザーまたはグループ/ロール**を**表します**。これには、**認証されていないユーザー**を表す特別なユーザー「**anonymous**」や、**すべての認証されたユーザー**を表す「**authenticated**」が含まれます。

![](<../../.gitbook/assets/image (40).png>)

* **プロジェクトベースのマトリックス認可戦略:** このモードは「**マトリックスベースのセキュリティ**」の**拡張**であり、追加のACLマトリックスを**各プロジェクトごとに別々に定義**することができます。
* **ロールベースの戦略:** **ロールベースの戦略**を使用して認可を定義することができます。`/role-strategy`でロールを管理します。

## **セキュリティレルム**

`/configureSecurity`では、**セキュリティレルムを設定**することが可能です。デフォルトでは、Jenkinsはいくつかの異なるセキュリティレルムをサポートしています：

* **サーブレットコンテナに委任**: **Jenkinsコントローラーを実行しているサーブレットコンテナーに認証を委任**するために使用します。例えば[Jetty](https://www.eclipse.org/jetty/)などです。
* **Jenkins自身のユーザーデータベース**: 認証を外部システムに委任する代わりに、**Jenkinsの組み込みのユーザーデータストア**を使用します。これはデフォルトで有効になっています。
* **LDAP**: すべての認証を設定されたLDAPサーバーに委任します。これにはユーザーとグループの両方が含まれます。
* **Unixユーザー/グループデータベース**: **Jenkinsコントローラー上のUnix OSレベルのユーザーデータベースに認証を委任**します。このモードでは、Unixグループを認可に再利用することも可能です。

プラグインは、Jenkinsを既存のアイデンティティシステムに組み込むのに役立つ追加のセキュリティレルムを提供することができます。例えば：

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkinsノード、エージェント & エグゼキューター

**ノード**はビルド**エージェントが実行されるマシン**です。Jenkinsは各接続されたノードをディスクスペース、空き一時スペース、空きスワップ、時計時間/同期、応答時間について監視します。これらの値のいずれかが設定されたしきい値を超えると、ノードはオフラインになります。

**エージェント**は**エグゼキューターを使用して**Jenkinsコントローラーに代わって**タスク実行を管理**します。エージェントはJavaをサポートする任意のオペレーティングシステムを使用できます。ビルドやテストに必要なツールは、エージェントが実行されるノードにインストールされます。これらは**直接またはコンテナ内**（DockerまたはKubernetes）にインストールすることができます。各**エージェントは、ホストマシン上で独自のPIDを持つプロセスです**。

**エグゼキューター**は**タスクの実行スロット**です。実質的には、**エージェント内のスレッド**です。ノード上の**エグゼキューターの数**は、そのノードで同時に実行できる**並行タスクの数**を定義します。言い換えると、これはそのノードで同時に実行できる**並行Pipeline `stages`の数**を決定します。

## Jenkinsシークレット

### シークレットとクレデンシャルの暗号化

Jenkinsは**AESを使用してシークレット、クレデンシャル、およびそれらの暗号化キーを暗号化して保護**します。これらの暗号化キーは`$JENKINS_HOME/secrets/`に保存され、そこには当該キーを保護するためのマスターキーも保存されています。このディレクトリは、Jenkinsコントローラーが実行されているオペレーティングシステムユーザーのみがこのディレクトリへの読み書きアクセスを持つように設定されるべきです（つまり、`chmod`値が`0700`であるか、適切なファイル属性を使用します）。**マスターキー**（暗号用語では「キー暗号化キー」とも呼ばれます）は、**`$JENKINS_HOME/secrets/master.key`**に**暗号化されていない状態**でJenkinsコントローラーファイルシステムに保存されており、そのファイルへの直接アクセスを持つ攻撃者からは保護されません。ほとんどのユーザーや開発者は、[Secret](https://javadoc.jenkins.io/byShortName/Secret) APIを通じて一般的な秘密データを暗号化するか、またはクレデンシャルAPIを通じてこれらの暗号化キーを間接的に使用します。暗号に興味がある人のために、JenkinsはAESを暗号ブロック連鎖（CBC）モードでPKCS#5パディングとランダムIVを使用して、`$JENKINS_HOME/secrets/`に保存された[CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey)のインスタンスを暗号化します。これらは`CryptoConfidentialKey`のIDに対応するファイル名で保存されます。一般的なキーIDには以下が含まれます：

* `hudson.util.Secret`: 一般的なシークレットに使用されます；
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: 一部のクレデンシャルタイプに使用されます；
* `jenkins.model.Jenkins.crumbSalt`: [CSRF保護メカニズム](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)に使用されます；と
### 資格情報アクセス

資格情報は、任意のプロジェクトがアクセス可能な**グローバルプロバイダーにスコープされる** (`/credentials/`) か、**特定のプロジェクトにスコープされる** (`/job/<project-name>/configure`) ため、特定のプロジェクトからのみアクセス可能です。

[**ドキュメントによると**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)：スコープ内の資格情報は、制限なくパイプラインで利用可能です。**ビルドログでの偶発的な露出を防ぐために**、資格情報は通常の出力から**マスクされ**、`env`（Linux）や`set`（Windows）の呼び出し、または環境やパラメータを印刷するプログラムでは、資格情報をビルドログに**表示されない**ようにしています。

**そのため、攻撃者が資格情報を盗み出すには、例えば、それらをbase64でエンコードする必要があります。**

## 参考文献

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
