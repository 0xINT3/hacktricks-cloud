# Informations de base sur Jenkins

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert Red Team AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## Acc√®s

### Nom d'utilisateur + Mot de passe

La mani√®re la plus courante de se connecter √† Jenkins est avec un nom d'utilisateur ou un mot de passe.

### Cookie

Si un **cookie autoris√© est vol√©**, il peut √™tre utilis√© pour acc√©der √† la session de l'utilisateur. Le cookie est g√©n√©ralement appel√© `JSESSIONID.*`. (Un utilisateur peut mettre fin √† toutes ses sessions, mais il devrait d'abord d√©couvrir qu'un cookie a √©t√© vol√©).

### SSO/Plugins

Jenkins peut √™tre configur√© √† l'aide de plugins pour √™tre **accessible via un SSO tiers**.

### Jetons

**Les utilisateurs peuvent g√©n√©rer des jetons** pour donner acc√®s aux applications pour les impersonner via CLI ou REST API.

### Cl√©s SSH

Ce composant fournit un serveur SSH int√©gr√© pour Jenkins. C'est une interface alternative pour le [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), et les commandes peuvent √™tre invoqu√©es de cette mani√®re en utilisant n'importe quel client SSH. (√Ä partir de la [documentation](https://plugins.jenkins.io/sshd/))

## Autorisation

Dans `/configureSecurity`, il est possible de **configurer la m√©thode d'autorisation de Jenkins**. Il existe plusieurs options :

* **Tout le monde peut tout faire** : M√™me l'acc√®s anonyme peut administrer le serveur.
* **Mode h√©rit√©** : Identique √† Jenkins <1.164. Si vous avez le r√¥le **"admin"**, vous aurez un **contr√¥le total** sur le syst√®me, et **sinon** (y compris les utilisateurs **anonymes**), vous aurez un acc√®s en **lecture**.
* **Les utilisateurs connect√©s peuvent tout faire** : Dans ce mode, chaque **utilisateur connect√© a un contr√¥le total** sur Jenkins. Le seul utilisateur qui n'aura pas un contr√¥le total est l'utilisateur **anonyme**, qui a seulement un acc√®s en **lecture**.
* **S√©curit√© bas√©e sur une matrice** : Vous pouvez configurer **qui peut faire quoi** dans un tableau. Chaque **colonne** repr√©sente une **autorisation**. Chaque **ligne** **repr√©sente** un **utilisateur ou un groupe/r√¥le**. Cela inclut un utilisateur sp√©cial '**anonyme**', qui repr√©sente les **utilisateurs non authentifi√©s**, ainsi que '**authentifi√©**', qui repr√©sente **tous les utilisateurs authentifi√©s**.

![](<../../.gitbook/assets/image (149).png>)

* **Strat√©gie d'autorisation bas√©e sur une matrice bas√©e sur le projet** : Ce mode est une **extension** de la "**s√©curit√© bas√©e sur une matrice**" qui permet de d√©finir des ACL suppl√©mentaires pour chaque projet s√©par√©ment.
* **Strat√©gie bas√©e sur les r√¥les** : Permet de d√©finir des autorisations en utilisant une **strat√©gie bas√©e sur les r√¥les**. G√©rez les r√¥les dans `/role-strategy`.

## **Royaume de s√©curit√©**

Dans `/configureSecurity`, il est possible de **configurer le royaume de s√©curit√©**. Par d√©faut, Jenkins inclut la prise en charge de quelques royaumes de s√©curit√© diff√©rents :

* **D√©l√©guer au conteneur servlet** : Pour **d√©l√©guer l'authentification √† un conteneur servlet ex√©cutant le contr√¥leur Jenkins**, tel que [Jetty](https://www.eclipse.org/jetty/).
* **Base de donn√©es utilisateur propre √† Jenkins** : Utilise le **magasin de donn√©es utilisateur int√©gr√© de Jenkins** pour l'authentification au lieu de d√©l√©guer √† un syst√®me externe. C'est activ√© par d√©faut.
* **LDAP** : D√©l√®gue toute l'authentification √† un serveur LDAP configur√©, y compris les utilisateurs et les groupes.
* **Base de donn√©es utilisateur/groupe Unix** : **D√©l√®gue l'authentification √† la base de donn√©es utilisateur de niveau Unix sous-jacente** sur le contr√¥leur Jenkins. Ce mode permet √©galement la r√©utilisation des groupes Unix pour l'autorisation.

Les plugins peuvent fournir des royaumes de s√©curit√© suppl√©mentaires qui peuvent √™tre utiles pour incorporer Jenkins dans des syst√®mes d'identit√© existants, tels que :

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [Authentification GitHub](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Noeuds, Agents & Ex√©cuteurs Jenkins

D√©finitions de la [documentation](https://www.jenkins.io/doc/book/managing/nodes/) :

Les **noeuds** sont les **machines** sur lesquelles les **agents de construction s'ex√©cutent**. Jenkins surveille chaque noeud attach√© pour l'espace disque, l'espace temporaire libre, l'espace d'√©change libre, l'heure de l'horloge/synchronisation et le temps de r√©ponse. Un noeud est mis hors ligne si l'une de ces valeurs d√©passe le seuil configur√©.

Les **agents** **g√®rent** l'**ex√©cution des t√¢ches** au nom du contr√¥leur Jenkins en **utilisant des ex√©cuteurs**. Un agent peut utiliser n'importe quel syst√®me d'exploitation prenant en charge Java. Les outils requis pour les constructions et les tests sont install√©s sur le noeud o√π l'agent s'ex√©cute ; ils peuvent **√™tre install√©s directement ou dans un conteneur** (Docker ou Kubernetes). Chaque **agent est en fait un processus avec son propre PID** sur la machine h√¥te.

Un **ex√©cuteur** est un **emplacement pour l'ex√©cution des t√¢ches** ; en fait, c'est **un thread dans l'agent**. Le **nombre d'ex√©cuteurs** sur un noeud d√©finit le nombre de **t√¢ches concurrentes** qui peuvent √™tre ex√©cut√©es sur ce noeud en m√™me temps. En d'autres termes, cela d√©termine le **nombre de `stages` de Pipeline concurrents** qui peuvent s'ex√©cuter sur ce noeud en m√™me temps.

## Secrets Jenkins

### Chiffrement des Secrets et des Informations d'Identification

D√©finition de la [documentation](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials) : Jenkins utilise **AES pour chiffrer et prot√©ger les secrets**, les informations d'identification et leurs cl√©s de chiffrement respectives. Ces cl√©s de chiffrement sont stock√©es dans `$JENKINS_HOME/secrets/` avec la cl√© principale utilis√©e pour prot√©ger lesdites cl√©s. Ce r√©pertoire doit √™tre configur√© de sorte que seul l'utilisateur du syst√®me d'exploitation sous lequel le contr√¥leur Jenkins s'ex√©cute ait un acc√®s en lecture et en √©criture √† ce r√©pertoire (c'est-√†-dire une valeur `chmod` de `0700` ou en utilisant des attributs de fichier appropri√©s). La **cl√© principale** (parfois appel√©e "cl√© de chiffrement de cl√©" dans le jargon cryptographique) est **stock√©e \_non chiffr√©e**\_ sur le syst√®me de fichiers du contr√¥leur Jenkins dans **`$JENKINS_HOME/secrets/master.key`** ce qui ne prot√®ge pas contre les attaquants ayant un acc√®s direct √† ce fichier. La plupart des utilisateurs et d√©veloppeurs utiliseront ces cl√©s de chiffrement indirectement via soit l'API [Secret](https://javadoc.jenkins.io/byShortName/Secret) pour chiffrer des donn√©es secr√®tes g√©n√©riques, soit √† travers l'API des informations d'identification. Pour les curieux de la cryptographie, Jenkins utilise AES en mode de cha√Ænage de blocs (CBC) avec un rembourrage PKCS#5 et des IV al√©atoires pour chiffrer les instances de [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) qui sont stock√©es dans `$JENKINS_HOME/secrets/` avec un nom de fichier correspondant √† leur ID `CryptoConfidentialKey`. Les ID de cl√© courants incluent :

* `hudson.util.Secret` : utilis√© pour les secrets g√©n√©riques ;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY` : utilis√© pour certains types d'informations d'identification ;
* `jenkins.model.Jenkins.crumbSalt` : utilis√© par le [m√©canisme de protection CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery) ; et
### Acc√®s aux identifiants

Les identifiants peuvent √™tre **restreints aux fournisseurs globaux** (`/credentials/`) accessibles par tout projet configur√©, ou peuvent √™tre restreints √† des **projets sp√©cifiques** (`/job/<nom-du-projet>/configure`) et donc uniquement accessibles depuis le projet sp√©cifique.

Selon [**la documentation**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Les identifiants qui sont dans le champ d'application sont rendus disponibles au pipeline sans limitation. Pour **√©viter une exposition accidentelle dans le journal de construction**, les identifiants sont **masqu√©s** dans la sortie r√©guli√®re, donc une invocation de `env` (Linux) ou `set` (Windows), ou des programmes imprimant leur environnement ou leurs param√®tres ne les **r√©v√©leraient pas dans le journal de construction** aux utilisateurs qui n'auraient pas autrement acc√®s aux identifiants.

**C'est pourquoi pour exfiltrer les identifiants, un attaquant doit, par exemple, les encoder en base64.**

## R√©f√©rences

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
