# Jenkinsの基本情報

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を通じて、ゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝**したい場合や**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[Telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**する
- **ハッキングテクニックを共有する**には、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## アクセス

### ユーザー名 + パスワード

Jenkinsにログインする最も一般的な方法は、ユーザー名またはパスワードを使用することです。

### Cookie

**認証済みのCookieが盗まれた**場合、そのCookieを使用してユーザーのセッションにアクセスできます。Cookieは通常`JSESSIONID.*`と呼ばれます。（ユーザーはすべてのセッションを終了できますが、最初にCookieが盗まれたことを見つける必要があります）。

### SSO/プラグイン

Jenkinsは、サードパーティSSOを介してアクセス可能にするためにプラグインを使用して構成できます。

### トークン

**ユーザーはトークンを生成**して、CLIやREST APIを介してアプリケーションに自分を偽装させるためのアクセスを与えることができます。

### SSHキー

このコンポーネントは、Jenkins用の組み込みSSHサーバーを提供します。これは[Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/)の代替インターフェースであり、SSHクライアントを使用してこの方法でコマンドを呼び出すことができます。（[ドキュメント](https://plugins.jenkins.io/sshd/)より）

## 認可

`/configureSecurity`でJenkinsの認可方法を**構成**することができます。いくつかのオプションがあります：

- **誰でも何でもできる**：匿名アクセスでもサーバーを管理できます
- **レガシーモード**：Jenkins <1.164と同じ。**"admin"ロール**がある場合、システム全体を**完全に制御**できます。それ以外の場合（**匿名**ユーザーを含む）、**読み取り**アクセスしかありません。
- **ログインユーザーは何でもできる**：このモードでは、**ログインユーザー全員がJenkinsを完全に制御**できます。唯一のユーザーである**匿名ユーザー**は、**読み取り**アクセスのみを取得します。
- **Matrix-based security**：表で**誰が何を行うか**を構成できます。各**列**は**権限**を表し、各**行**は**ユーザーまたはグループ/ロール**を表します。これには、**未認証ユーザー**を表す特別なユーザー '**anonymous**' と、**すべての認証済みユーザー**を表す '**authenticated**' が含まれます。

![](<../../.gitbook/assets/image (149).png>)

- **Project-based Matrix Authorization Strategy:** このモードは、各プロジェクトに対して追加のACLマトリックスを**個別に定義**できる "**Matrix-based security**" の**拡張**です。
- **Role-Based Strategy:** **役割ベースの戦略**を使用して認可を定義できるようにします。`/role-strategy`で役割を管理します。

## **セキュリティレルム**

`/configureSecurity`で**セキュリティレルムを構成**することができます。デフォルトでは、Jenkinsにはいくつかの異なるセキュリティレルムのサポートが含まれています：

- **サーブレットコンテナに委任**：Jenkinsコントローラーを実行しているサーブレットコンテナ（[Jetty](https://www.eclipse.org/jetty/)など）に**認証を委任**するためのもの。
- **Jenkins独自のユーザーデータベース**：外部システムに委任する代わりに、認証にJenkins独自の組み込みユーザーデータストアを使用します。これはデフォルトで有効です。
- **LDAP**：ユーザーとグループの両方を含む構成済みのLDAPサーバーにすべての認証を委任します。
- **Unixユーザー/グループデータベース**：Jenkinsコントローラーの基礎となるUnix OSレベルのユーザーデータベースに認証を委任します。このモードでは、Unixグループを認可に再利用できます。

プラグインは、Jenkinsを既存のアイデンティティシステムに組み込むのに役立つ追加のセキュリティレルムを提供できます：

- [Active Directory](https://plugins.jenkins.io/active-directory)
- [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
- [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkinsノード、エージェント＆実行エージェント

[ドキュメント](https://www.jenkins.io/doc/book/managing/nodes/)からの定義：

**ノード**はビルド**エージェントが実行されるマシン**です。Jenkinsは、各接続されたノードをディスクスペース、空き一時スペース、空きスワップ、クロック時間/同期、応答時間について監視します。これらの値のいずれかが構成されたしきい値を超えると、ノードはオフラインになります。

**エージェント**は、**エグゼクターを使用して**Jenkinsコントローラーの代理でタスクの実行を管理します。エージェントはJavaをサポートする任意のオペレーティングシステムを使用できます。ビルドやテストに必要なツールは、エージェントが実行されるノードにインストールされます。これらは**直接インストールするか、コンテナ（DockerまたはKubernetes）にインストール**できます。各**エージェントは、ホストマシン上で独自のPIDを持つプロセス**です。

**エグゼクター**は、タスクの実行のための**スロット**であり、実質的にはエージェント内の**スレッド**です。ノード上のエグゼクターの数は、そのノードで同時に実行できる**並行タスクの数**を定義します。言い換えれば、これはそのノードで同時に実行できる**並行Pipeline `ステージ`の数**を決定します。

## Jenkinsの秘密

### 秘密と資格情報の暗号化

[ドキュメント](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)からの定義：Jenkinsは、秘密、資格情報、およびそれらの暗号化キーを暗号化および保護するために**AESを使用**します。これらの暗号化キーは、それらを保護するために使用されるマスターキーとともに`$JENKINS_HOME/secrets/`に保存されます。このディレクトリは、Jenkinsコントローラーが実行されているオペレーティングシステムユーザーだけがこのディレクトリに読み取りおよび書き込みアクセス権を持つように構成する必要があります（つまり、`chmod`値が`0700`であるか、適切なファイル属性を使用します）。マスターキー（暗号ジャーゴンでは「キー暗号化キー」とも呼ばれる）は、Jenkinsコントローラーファイルシステム上の**`$JENKINS_HOME/secrets/master.key`**に**暗号化されていない状態で**保存されており、そのファイルに直接アクセスできる攻撃者に対しては保護されません。ほとんどのユーザーと開発者は、これらの暗号化キーを間接的に使用し、一般的な秘密データを暗号化するための[Secret](https://javadoc.jenkins.io/byShortName/Secret) APIまたは資格情報APIを介して使用します。暗号に興味がある方のために、Jenkinsは、ランダムIVを使用してAESを暗号化モードで使用し、PKCS#5パディングとCBCモードでAESを使用して、`CryptoConfidentialKey`のインスタンスを暗号化するために使用される[**CryptoConfidentialKey**](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey)が`$JENKINS_HOME/secrets/`に保存され、その`CryptoConfidentialKey` IDに対応するファイル名が付けられます。一般的なキーIDには次のものがあります：

- `hudson.util.Secret`：一般的な秘密に使用されます。
- `com.cloudbees.plugins.credentials.SecretBytes.KEY`：一部の資格情報タイプに使用されます。
- `jenkins.model.Jenkins.crumbSalt`：[CSRF保護メカニズム](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)で使用されます。
### 資格情報アクセス

資格情報は、**グローバルプロバイダ** (`/credentials/`) にスコープを設定して、構成された任意のプロジェクトからアクセスできるようにするか、**特定のプロジェクト** (`/job/<project-name>/configure`) にスコープを設定して、その特定のプロジェクトからのみアクセスできるようにすることができます。

[**ドキュメント**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)によると、スコープ内の資格情報は制限なくパイプラインで利用可能になります。**ビルドログでの誤公開を防ぐ**ために、資格情報は通常の出力から**マスク**され、したがって、`env` (Linux) や `set` (Windows) の呼び出し、または環境やパラメータを出力するプログラムによって、それらがビルドログでユーザーに公開されることはありません。

**そのため、攻撃者が資格情報を外部に持ち出すためには、例えば、それらをbase64でエンコードする必要があります。**

## 参考文献

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
