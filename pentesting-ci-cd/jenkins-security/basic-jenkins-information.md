# Informaci√≥n b√°sica de Jenkins

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Acceso

### Nombre de usuario + Contrase√±a

La forma m√°s com√∫n de iniciar sesi√≥n en Jenkins es con un nombre de usuario o una contrase√±a.

### Cookie

Si se roba una **cookie autorizada**, se puede usar para acceder a la sesi√≥n del usuario. La cookie suele llamarse `JSESSIONID.*`. (Un usuario puede terminar todas sus sesiones, pero primero tendr√≠a que descubrir que se rob√≥ una cookie).

### SSO/Plugins

Jenkins se puede configurar mediante plugins para ser **accesible a trav√©s de SSO de terceros**.

### Tokens

**Los usuarios pueden generar tokens** para dar acceso a las aplicaciones a suplantarlos a trav√©s de CLI o REST API.

### Claves SSH

Este componente proporciona un servidor SSH incorporado para Jenkins. Es una interfaz alternativa para la [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), y los comandos se pueden invocar de esta manera usando cualquier cliente SSH. (De los [documentos](https://plugins.jenkins.io/sshd/))

## Autorizaci√≥n

En `/configureSecurity` es posible **configurar el m√©todo de autorizaci√≥n de Jenkins**. Hay varias opciones:

* **Cualquiera puede hacer cualquier cosa**: incluso el acceso an√≥nimo puede administrar el servidor.
* **Modo heredado**: igual que Jenkins <1.164. Si tienes el rol de **"admin"**, se te otorgar√° **control total** sobre el sistema, y **de lo contrario** (incluidos los usuarios **an√≥nimos**) tendr√°s **acceso de lectura**.
* **Los usuarios registrados pueden hacer cualquier cosa**: en este modo, cada **usuario registrado obtiene control total** de Jenkins. El √∫nico usuario que no tendr√° control total es el **usuario an√≥nimo**, que solo obtiene **acceso de lectura**.
* **Seguridad basada en matriz**: se puede configurar **qui√©n puede hacer qu√©** en una tabla. Cada **columna** representa un **permiso**. Cada **fila** **representa** un **usuario o un grupo/rol**. Esto incluye un usuario especial '**an√≥nimo**', que representa a los **usuarios no autenticados**, as√≠ como '**autenticado**', que representa a **todos los usuarios autenticados**.

![](<../../.gitbook/assets/image (40).png>)

* **Estrategia de autorizaci√≥n de matriz basada en proyectos:** este modo es una **extensi√≥n** de la "**seguridad basada en matriz**" que permite definir matrices ACL adicionales para cada proyecto por separado.
* **Estrategia basada en roles:** permite definir autorizaciones utilizando una **estrategia basada en roles**. Administra los roles en `/role-strategy`.

## **Security Realm**

En `/configureSecurity` es posible **configurar el √°mbito de seguridad**. Por defecto, Jenkins incluye soporte para algunos √°mbitos de seguridad diferentes:

* **Delegar al contenedor servlet**: para **delegar la autenticaci√≥n a un contenedor servlet que ejecuta el controlador Jenkins**, como [Jetty](https://www.eclipse.org/jetty/).
* **Base de datos de usuario propia de Jenkins:** utiliza **la propia base de datos de usuario integrada de Jenkins** para la autenticaci√≥n en lugar de delegar en un sistema externo. Esto est√° habilitado por defecto.
* **LDAP**: delega toda la autenticaci√≥n a un servidor LDAP configurado, incluyendo tanto usuarios como grupos.
* **Base de datos de usuario/grupo de Unix**: **delega la autenticaci√≥n en el nivel del sistema operativo Unix subyacente** en el controlador Jenkins. Este modo tambi√©n permitir√° la reutilizaci√≥n de grupos Unix para la autorizaci√≥n.

Los plugins pueden proporcionar √°mbitos de seguridad adicionales que pueden ser √∫tiles para incorporar Jenkins en sistemas de identidad existentes, como:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Nodos, Agentes y Ejecutores de Jenkins

Los **nodos** son las **m√°quinas** en las que se ejecutan los **agentes de construcci√≥n**. Jenkins monitorea cada nodo adjunto para el espacio en disco, el espacio temporal libre, el intercambio libre, el tiempo/sincronizaci√≥n del reloj y el tiempo de respuesta. Se desconecta un nodo si alguno de estos valores sale del umbral configurado.

Los **agentes** **gestionan** la **ejecuci√≥n de tareas** en nombre del controlador Jenkins mediante **el uso de ejecutores**. Un agente puede usar cualquier sistema operativo que admita Java. Las herramientas necesarias para las construcciones y pruebas se instalan en el nodo donde se ejecuta el agente; se pueden **instalar directamente o en un contenedor** (Docker o Kubernetes). Cada **agente es efectivamente un proceso con su propio PID** en la m√°quina host.

Un **ejecutor** es una **ranura para la ejecuci√≥n de tareas**; efectivamente, es **un hilo en el agente**. El **n√∫mero de ejecutores** en un nodo define el n√∫mero de **tareas concurrentes** que se pueden ejecutar en ese nodo al mismo tiempo. En otras palabras, esto determina el **n√∫mero de `stages` de Pipeline concurrentes** que se pueden ejecutar en ese nodo al mismo tiempo.

## Secretos de Jenkins

### Cifrado de secretos y credenciales

Jenkins utiliza **AES para cifrar y proteger secretos**, credenciales y sus respectivas claves de cifrado. Estas claves de cifrado se almacenan en `$JENKINS_HOME/secrets/` junto con la clave maestra utilizada para proteger dichas claves. Este directorio debe configurarse de manera que solo el usuario del sistema operativo que ejecuta el controlador Jenkins tenga acceso de lectura y escritura a este directorio (es decir, un valor `chmod` de `0700` o utilizando atributos de archivo apropiados). La **clave maestra** (a veces denominada "clave de cifrado de clave" en la jerga criptogr√°fica) se **almacena sin cifrar** en el sistema de archivos del controlador Jenkins en **`$JENKINS_HOME/secrets/master.key`** lo que no protege contra atacantes con acceso directo a ese archivo. La mayor√≠a de los usuarios y desarrolladores utilizar√°n estas claves de cifrado indirectamente a trav√©s de la API [Secret](https://javadoc.jenkins.io/byShortName/Secret) para cifrar datos secretos gen√©ricos o a trav√©s de la API de credenciales. Para los curiosos de la criptograf√≠a, Jenkins utiliza AES en modo de cifrado por bloques en cadena (CBC) con relleno PKCS#5 e IV aleatorios para cifrar instancias de [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) que se almacenan en `$JENKINS_HOME/secrets/` con un nombre de archivo correspondiente a su id de `CryptoConfidentialKey`. Los ids de clave comunes incluyen:

* `hudson.util.Secret`: utilizado para secretos gen√©ricos;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: utilizado para algunos tipos de credenciales;
* `jenkins.model.Jenkins.crumbSalt`: utilizado por el [mecanismo de protecci√≥n CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); y

### Acceso a credenciales

Las credenciales se pueden **limitar a proveedores globales** (`/credentials/`) a los que se puede acceder desde cualquier proyecto configurado, o se pueden limitar a **proyectos espec√≠ficos** (`/job/<nombre-del-proyecto>/configure`) y, por lo tanto, solo accesibles desde el proyecto espec√≠fico.

Seg√∫n [**la documentaci√≥n**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Las credenciales que est√°n en
## Referencias

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>