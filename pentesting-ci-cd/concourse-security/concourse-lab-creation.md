# Concourse Laboratorium Skepping

<details>

<summary><strong>Leer AWS hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking truuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Toetsomgewing

### Uitvoer van Concourse

#### Met Docker-Compose

Hierdie docker-compose l√™er vereenvoudig die installasie om toetse met concourse te doen:
```bash
wget https://raw.githubusercontent.com/starkandwayne/concourse-tutorial/master/docker-compose.yml
docker-compose up -d
```
Jy kan die opdraglyn `fly` vir jou bedryfstelsel aflaai van die web by `127.0.0.1:8080`

#### Met Kubernetes (Aanbeveel)

Jy kan maklik Concourse in **Kubernetes** (in **minikube** byvoorbeeld) implementeer deur die helm-grafiek te gebruik: [**concourse-chart**](https://github.com/concourse/concourse-chart).
```bash
brew install helm
helm repo add concourse https://concourse-charts.storage.googleapis.com/
helm install concourse-release concourse/concourse
# concourse-release will be the prefix name for the concourse elements in k8s
# After the installation you will find the indications to connect to it in the console

# If you need to delete it
helm delete concourse-release
```
Nadat die Concourse-omgewing gegenereer is, kan jy 'n geheim skep en toegang gee aan die SA wat in die Concourse-web hardloop om toegang tot K8s-geheime te verkry:
```yaml
echo 'apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: read-secrets
rules:
- apiGroups: [""]
resources: ["secrets"]
verbs: ["get"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
name: read-secrets-concourse
roleRef:
apiGroup: rbac.authorization.k8s.io
kind: ClusterRole
name: read-secrets
subjects:
- kind: ServiceAccount
name: concourse-release-web
namespace: default

---

apiVersion: v1
kind: Secret
metadata:
name: super
namespace: concourse-release-main
type: Opaque
data:
secret: MWYyZDFlMmU2N2Rm

' | kubectl apply -f -
```
### Skep Pyplyn

'n Pyplyn bestaan uit 'n lys van [Take](https://concourse-ci.org/jobs.html) wat 'n geordende lys van [Stappe](https://concourse-ci.org/steps.html) bevat.

### Stappe

Verskeie verskillende tipes stappe kan gebruik word:

* **die** [**`task` stap**](https://concourse-ci.org/task-step.html) **voer 'n** [**taak**](https://concourse-ci.org/tasks.html) **uit**
* die [`get` stap](https://concourse-ci.org/get-step.html) haal 'n [hulpbron](https://concourse-ci.org/resources.html) op
* die [`put` stap](https://concourse-ci.org/put-step.html) werk 'n [hulpbron](https://concourse-ci.org/resources.html) by
* die [`set_pipeline` stap](https://concourse-ci.org/set-pipeline-step.html) stel 'n [pyplyn](https://concourse-ci.org/pipelines.html) in
* die [`load_var` stap](https://concourse-ci.org/load-var-step.html) laai 'n waarde in 'n [plaaslike var](https://concourse-ci.org/vars.html#local-vars)
* die [`in_parallel` stap](https://concourse-ci.org/in-parallel-step.html) voer stappe parallel uit
* die [`do` stap](https://concourse-ci.org/do-step.html) voer stappe in volgorde uit
* die [`across` stap wysiger](https://concourse-ci.org/across-step.html#schema.across) voer 'n stap verskeie kere uit; een keer vir elke kombinasie van veranderlike waardes
* die [`try` stap](https://concourse-ci.org/try-step.html) probeer om 'n stap uit te voer en slaag selfs as die stap misluk

Elke [stap](https://concourse-ci.org/steps.html) in 'n [werkplan](https://concourse-ci.org/jobs.html#schema.job.plan) loop in sy **eie houer**. Jy kan enigiets binne die houer uitvoer _(d.w.s. voer my toetse uit, voer hierdie bash-skrip uit, bou hierdie prentjie, ens.)_. As jy dus 'n taak met vyf stappe het, sal Concourse vyf houers skep, een vir elke stap.

Daarom is dit moontlik om die tipe houer aan te dui waarin elke stap moet loop.

### Eenvoudige Pyplyn Voorbeeld
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
sleep 1000
echo "$SUPER_SECRET"
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial set-pipeline -p pipe-name -c hello-world.yml
# pipelines are paused when first created
fly -t tutorial unpause-pipeline -p pipe-name
# trigger the job and watch it run to completion
fly -t tutorial trigger-job --job pipe-name/simple --watch
# From another console
fly -t tutorial intercept --job pipe-name/simple
```
Kyk na **127.0.0.1:8080** om die pyplynvloei te sien.

### Bash-skrip met uitvoer/invoer-pyplyn

Dit is moontlik om **die resultate van een taak in 'n l√™er te stoor** en aan te dui dat dit 'n uitvoer is, en dan die invoer van die volgende taak aan te dui as die uitvoer van die vorige taak. Wat Concourse doen, is om **die gids van die vorige taak in die nuwe taak te monteer waar jy toegang kan verkry tot die l√™ers wat deur die vorige taak geskep is**.

### Aanwysers

Jy hoef nie die take handmatig te aktiveer elke keer as jy hulle wil uitvoer nie, jy kan hulle ook programmeer om elke keer uitgevoer te word:

* 'n Sekere tyd verloop: [Tydbron](https://github.com/concourse/time-resource/)
* Met nuwe toewysings aan die hooftak: [Gitbron](https://github.com/concourse/git-resource)
* Nuwe PR's: [Github-PR-bron](https://github.com/telia-oss/github-pr-resource)
* Haal die nuutste prentjie van jou program af of stuur dit: [Registreerbeeldbron](https://github.com/concourse/registry-image-resource/)

Kyk na 'n YAML-pyplynvoorbeeld wat geaktiveer word met nuwe toewysings aan die hooftak in [https://concourse-ci.org/tutorial-resources.html](https://concourse-ci.org/tutorial-resources.html)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks-uitrusting**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFT's**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslagplekke.

</details>
