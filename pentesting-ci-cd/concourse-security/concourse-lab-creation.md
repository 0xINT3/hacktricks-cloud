# Concourse Lab Oluşturma

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek paylaşın**.

</details>

## Test Ortamı

### Concourse Çalıştırma

#### Docker-Compose ile

Bu docker-compose dosyası, concourse ile bazı testler yapmak için kurulumu basitleştirir:
```bash
wget https://raw.githubusercontent.com/starkandwayne/concourse-tutorial/master/docker-compose.yml
docker-compose up -d
```
Komut satırı `fly`'ı işletim sisteminize `127.0.0.1:8080` adresinden web üzerinden indirebilirsiniz.

#### Kubernetes ile (Tavsiye Edilen)

Helm-chart kullanarak **Kubernetes** üzerinde (örneğin **minikube** üzerinde) concourse'u kolayca dağıtabilirsiniz: [**concourse-chart**](https://github.com/concourse/concourse-chart).
```bash
brew install helm
helm repo add concourse https://concourse-charts.storage.googleapis.com/
helm install concourse-release concourse/concourse
# concourse-release will be the prefix name for the concourse elements in k8s
# After the installation you will find the indications to connect to it in the console

# If you need to delete it
helm delete concourse-release
```
Concourse ortamını oluşturduktan sonra, bir sır oluşturabilir ve concourse web'de çalışan SA'ya K8s sırlarına erişim izni verebilirsiniz:
```yaml
echo 'apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: read-secrets
rules:
- apiGroups: [""]
resources: ["secrets"]
verbs: ["get"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
name: read-secrets-concourse
roleRef:
apiGroup: rbac.authorization.k8s.io
kind: ClusterRole
name: read-secrets
subjects:
- kind: ServiceAccount
name: concourse-release-web
namespace: default

---

apiVersion: v1
kind: Secret
metadata:
name: super
namespace: concourse-release-main
type: Opaque
data:
secret: MWYyZDFlMmU2N2Rm

' | kubectl apply -f -
```
### Pipeline Oluşturma

Bir pipeline, sıralı adımların (Steps) bir listesinden oluşur ve her bir adım bir işi (Job) temsil eder.

### Adımlar

Farklı türde adımlar kullanılabilir:

* **[**`task` adımı**](https://concourse-ci.org/task-step.html)** bir görevi (task) çalıştırır**
* [`get` adımı](https://concourse-ci.org/get-step.html) bir kaynağı (resource) alır
* [`put` adımı](https://concourse-ci.org/put-step.html) bir kaynağı (resource) günceller
* [`set_pipeline` adımı](https://concourse-ci.org/set-pipeline-step.html) bir pipeline'ı (pipeline) yapılandırır
* [`load_var` adımı](https://concourse-ci.org/load-var-step.html) bir değeri bir yerel değişkene (local var) yükler
* [`in_parallel` adımı](https://concourse-ci.org/in-parallel-step.html) adımları paralel olarak çalıştırır
* [`do` adımı](https://concourse-ci.org/do-step.html) adımları sırayla çalıştırır
* [`across` adım değiştirici](https://concourse-ci.org/across-step.html#schema.across) bir adımı birden fazla kez çalıştırır; her bir değişken değeri kombinasyonu için bir kez çalıştırır
* [`try` adımı](https://concourse-ci.org/try-step.html) bir adımı çalıştırmaya çalışır ve adım başarısız olsa bile başarılı olur

Her [adım](https://concourse-ci.org/steps.html), bir [iş planında](https://concourse-ci.org/jobs.html#schema.job.plan) kendi **konteynerında** çalışır. Konteyner içinde istediğiniz her şeyi çalıştırabilirsiniz _(örneğin testlerimi çalıştır, bu bash betiğini çalıştır, bu imajı oluştur, vb.)_. Bu nedenle, beş adımlı bir işiniz varsa, Concourse her adım için bir konteyner oluşturur.

Bu nedenle, her adımın hangi türde bir konteyner içinde çalışması gerektiğini belirtebilirsiniz.

### Basit Pipeline Örneği
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
sleep 1000
echo "$SUPER_SECRET"
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial set-pipeline -p pipe-name -c hello-world.yml
# pipelines are paused when first created
fly -t tutorial unpause-pipeline -p pipe-name
# trigger the job and watch it run to completion
fly -t tutorial trigger-job --job pipe-name/simple --watch
# From another console
fly -t tutorial intercept --job pipe-name/simple
```
Pipeline akışını görmek için **127.0.0.1:8080** adresini kontrol edin.

### Çıktı/Giriş boru hattıyla Bash komut dosyası

Bir görevin sonuçlarını bir dosyada kaydetmek ve bunun bir çıktı olduğunu belirtmek, ardışık bir görevin girişini önceki görevin çıktısı olarak belirtmek mümkündür. Concourse, önceki görevin dizinini yeni göreve bağlar ve böylece önceki görev tarafından oluşturulan dosyalara erişebilirsiniz.

### Tetikleyiciler

İşleri her seferinde manuel olarak tetiklemeniz gerekmez, aynı zamanda onları her seferinde çalıştırılacak şekilde programlayabilirsiniz:

* Belirli bir süre geçtiğinde: [Zaman kaynağı](https://github.com/concourse/time-resource/)
* Ana dalda yeni taahhütler olduğunda: [Git kaynağı](https://github.com/concourse/git-resource)
* Yeni PR'lar: [Github-PR kaynağı](https://github.com/telia-oss/github-pr-resource)
* Uygulamanızın en son görüntüsünü alın veya gönderin: [Kayıt defteri görüntüsü kaynağı](https://github.com/concourse/registry-image-resource/)

Yeni taahhütlerde tetiklenen bir YAML boru hattı örneğini [https://concourse-ci.org/tutorial-resources.html](https://concourse-ci.org/tutorial-resources.html) adresinde kontrol edin.

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **tanıtmak** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimizi**](https://opensea.io/collection/the-peass-family) görün
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>
