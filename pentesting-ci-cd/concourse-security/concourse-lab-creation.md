# Δημιουργία Εργαστηρίου Concourse

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Περιβάλλον Δοκιμής

### Εκτέλεση του Concourse

#### Με το Docker-Compose

Αυτό το αρχείο docker-compose απλοποιεί την εγκατάσταση για να κάνετε μερικές δοκιμές με το concourse:
```bash
wget https://raw.githubusercontent.com/starkandwayne/concourse-tutorial/master/docker-compose.yml
docker-compose up -d
```
Μπορείτε να κατεβάσετε τη γραμμή εντολών `fly` για το λειτουργικό σύστημά σας από τον ιστό στη διεύθυνση `127.0.0.1:8080`

#### Με το Kubernetes (Συνιστάται)

Μπορείτε εύκολα να αναπτύξετε το concourse στο **Kubernetes** (για παράδειγμα στο **minikube**) χρησιμοποιώντας το helm-chart: [**concourse-chart**](https://github.com/concourse/concourse-chart).
```bash
brew install helm
helm repo add concourse https://concourse-charts.storage.googleapis.com/
helm install concourse-release concourse/concourse
# concourse-release will be the prefix name for the concourse elements in k8s
# After the installation you will find the indications to connect to it in the console

# If you need to delete it
helm delete concourse-release
```
Μετά τη δημιουργία του περιβάλλοντος concourse, μπορείτε να δημιουργήσετε ένα μυστικό και να δώσετε πρόσβαση στον SA που εκτελείται στον ιστό του concourse για να έχει πρόσβαση σε μυστικά του K8s:
```yaml
echo 'apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: read-secrets
rules:
- apiGroups: [""]
resources: ["secrets"]
verbs: ["get"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
name: read-secrets-concourse
roleRef:
apiGroup: rbac.authorization.k8s.io
kind: ClusterRole
name: read-secrets
subjects:
- kind: ServiceAccount
name: concourse-release-web
namespace: default

---

apiVersion: v1
kind: Secret
metadata:
name: super
namespace: concourse-release-main
type: Opaque
data:
secret: MWYyZDFlMmU2N2Rm

' | kubectl apply -f -
```
### Δημιουργία Αγωγού

Ένας αγωγός αποτελείται από μια λίστα από [Εργασίες](https://concourse-ci.org/jobs.html) που περιέχει μια ταξινομημένη λίστα από [Βήματα](https://concourse-ci.org/steps.html).

### Βήματα

Μπορούν να χρησιμοποιηθούν διάφορα είδη βημάτων:

* **το** [**`task` βήμα**](https://concourse-ci.org/task-step.html) **εκτελεί μια** [**εργασία**](https://concourse-ci.org/tasks.html)
* το [`get` βήμα](https://concourse-ci.org/get-step.html) ανακτά ένα [πόρο](https://concourse-ci.org/resources.html)
* το [`put` βήμα](https://concourse-ci.org/put-step.html) ενημερώνει έναν [πόρο](https://concourse-ci.org/resources.html)
* το [`set_pipeline` βήμα](https://concourse-ci.org/set-pipeline-step.html) ρυθμίζει έναν [αγωγό](https://concourse-ci.org/pipelines.html)
* το [`load_var` βήμα](https://concourse-ci.org/load-var-step.html) φορτώνει μια τιμή σε μια [τοπική μεταβλητή](https://concourse-ci.org/vars.html#local-vars)
* το [`in_parallel` βήμα](https://concourse-ci.org/in-parallel-step.html) εκτελεί βήματα παράλληλα
* το [`do` βήμα](https://concourse-ci.org/do-step.html) εκτελεί βήματα σε ακολουθία
* ο τροποποιητής βήματος [`across`](https://concourse-ci.org/across-step.html#schema.across) εκτελεί ένα βήμα πολλές φορές, μία για κάθε συνδυασμό τιμών μεταβλητών
* το [`try` βήμα](https://concourse-ci.org/try-step.html) προσπαθεί να εκτελέσει ένα βήμα και επιτυγχάνει ακόμα κι αν το βήμα αποτύχει

Κάθε [βήμα](https://concourse-ci.org/steps.html) σε ένα [σχέδιο εργασίας](https://concourse-ci.org/jobs.html#schema.job.plan) εκτελείται σε **δικό του δοχείο**. Μπορείτε να εκτελέσετε οτιδήποτε θέλετε μέσα στο δοχείο _(π.χ. να εκτελέσετε τις δοκιμές μου, να εκτελέσετε αυτό το bash script, να κατασκευάσετε αυτήν την εικόνα, κλπ.)_. Έτσι, αν έχετε μια εργασία με πέντε βήματα, το Concourse θα δημιουργήσει πέντε δοχεία, ένα για κάθε βήμα.

Επομένως, είναι δυνατό να υποδείξετε τον τύπο του δοχείου που χρειάζεται κάθε βήμα να εκτελεστεί. 

### Παράδειγμα Απλού Αγωγού
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
sleep 1000
echo "$SUPER_SECRET"
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial set-pipeline -p pipe-name -c hello-world.yml
# pipelines are paused when first created
fly -t tutorial unpause-pipeline -p pipe-name
# trigger the job and watch it run to completion
fly -t tutorial trigger-job --job pipe-name/simple --watch
# From another console
fly -t tutorial intercept --job pipe-name/simple
```
Ελέγξτε το **127.0.0.1:8080** για να δείτε τη ροή του pipeline.

### Σενάριο Bash με ροή εισόδου/εξόδου

Είναι δυνατόν να **αποθηκεύσετε τα αποτελέσματα μιας εργασίας σε ένα αρχείο** και να υποδείξετε ότι αυτό είναι ένα αποτέλεσμα και στη συνέχεια να υποδείξετε την είσοδο της επόμενης εργασίας ως το αποτέλεσμα της προηγούμενης εργασίας. Αυτό που κάνει το concourse είναι να **προσαρτά τον κατάλογο της προηγούμενης εργασίας στη νέα εργασία όπου μπορείτε να έχετε πρόσβαση στα αρχεία που δημιουργήθηκαν από την προηγούμενη εργασία**.

### Ενεργοποιητές

Δεν χρειάζεται να ενεργοποιείτε τις εργασίες χειροκίνητα κάθε φορά που θέλετε να τις εκτελέσετε, μπορείτε επίσης να τις προγραμματίσετε να εκτελούνται αυτόματα:

* Όταν περνάει κάποιο χρονικό διάστημα: [Πόρος χρόνου](https://github.com/concourse/time-resource/)
* Σε νέες δεσμεύσεις στο κύριο κλαδί: [Πόρος Git](https://github.com/concourse/git-resource)
* Νέα αιτήματα ενσωμάτωσης (PR): [Πόρος Github-PR](https://github.com/telia-oss/github-pr-resource)
* Ανάκτηση ή αποστολή της τελευταίας εικόνας της εφαρμογής σας: [Πόρος εικόνας καταχώρησης](https://github.com/concourse/registry-image-resource/)

Ελέγξτε ένα παράδειγμα YAML pipeline που ενεργοποιείται σε νέες δεσμεύσεις στον κύριο κλαδί στο [https://concourse-ci.org/tutorial-resources.html](https://concourse-ci.org/tutorial-resources.html)

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
