# 基本的なTravisCI情報

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォロー**する
* **ハッキングトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のgithubリポジトリに提出**してください。

</details>

## アクセス

TravisCIは、Github、Bitbucket、Assembla、Gitlabなどの異なるgitプラットフォームと直接統合されます。TravisCIは、TravisCIと統合したいリポジトリにアクセス権を与えるようユーザーに求めます。

例えば、Githubでは以下の権限を求めます:

* `user:email`（読み取り専用）
* `read:org`（読み取り専用）
* `repo`: パブリックおよびプライベートのリポジトリと組織に対するコード、コミットステータス、共同作業者、デプロイメントステータスへの読み取りおよび書き込みアクセスを付与します。

## 暗号化されたシークレット

### 環境変数

TravisCIでは、他のCIプラットフォームと同様に、**リポジトリレベルのシークレット**を保存し、**暗号化されて保存**され、**ビルドを実行するマシンの環境変数に復号化されてプッシュ**されることが可能です。

![](<../../.gitbook/assets/image (203).png>)

**シークレットが利用可能になるブランチ**を指定することが可能です（デフォルトはすべて）し、またTravisCIが**ログに表示される場合にその値を非表示にすべきかどうか**も指定できます（デフォルトでは非表示になります）。

### カスタム暗号化されたシークレット

**各リポジトリ**に対してTravisCIは**RSAキーペア**を生成し、**プライベート**なものを保持し、リポジトリに**アクセス権**を持つ人にはリポジトリの**公開鍵を利用可能**にします。

1つのリポジトリの公開鍵にアクセスすることができます。
```
travis pubkey -r <owner>/<repo_name>
travis pubkey -r carlospolop/t-ci-test
```
次に、このセットアップを使用して**シークレットを暗号化し、`.travis.yaml` に追加**できます。シークレットは**ビルド実行時に復号**され、**環境変数**でアクセス可能になります。

![](<../../.gitbook/assets/image (139).png>)

この方法で暗号化されたシークレットは、設定の環境変数にリストされることはありません。

### カスタム暗号化ファイル

以前と同様に、TravisCI では**ファイルを暗号化してからビルド中に復号**することも可能です。
```
travis encrypt-file super_secret.txt -r carlospolop/t-ci-test

encrypting super_secret.txt for carlospolop/t-ci-test
storing result as super_secret.txt.enc
storing secure env variables for decryption

Please add the following to your build script (before_install stage in your .travis.yml, for instance):

openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d

Pro Tip: You can add it automatically by running with --add.

Make sure to add super_secret.txt.enc to the git repository.
Make sure not to add super_secret.txt to the git repository.
Commit all changes to your .travis.yml.
```
## TravisCIエンタープライズ

Travis CI Enterpriseは、**Travis CIのオンプレミスバージョン**であり、**自分のインフラストラクチャに展開**できます。Travis CIの「サーバー」バージョンと考えてください。Travis CIを使用すると、簡単に構成およびセキュリティを設定できる環境で、継続的インテグレーション/継続的デプロイメント（CI/CD）システムを有効にできます。

**Travis CI Enterpriseには、次の2つの主要な部分があります:**

1. TCI **サービス**（またはTCIコアサービス）は、バージョン管理システムとの統合、ビルドの承認、ビルドジョブのスケジューリングなどを担当します。
2. TCI **Worker**およびビルド環境イメージ（OSイメージ）。

**TCIコアサービスには、次のものが必要です:**

1. **PostgreSQL11**（以降のバージョン）データベース。
2. Kubernetesクラスタを展開するインフラストラクチャ。必要に応じて、サーバークラスタに展開するか、単一のマシンに展開することができます。
3. セットアップに応じて、RabbitMQなどのコンポーネントを自分で展開および構成することができます。詳細については、[Travis CI Enterpriseのセットアップ](https://docs.travis-ci.com/user/enterprise/tcie-3.x-setting-up-travis-ci-enterprise/)を参照してください。

**TCI Workerには、次のものが必要です:**

1. **Workerとリンクしたビルドイメージを含むDockerイメージを展開できるインフラストラクチャ**。
2. 特定のTravis CIコアサービスコンポーネントへの接続。詳細については、[Workerのセットアップ](https://docs.travis-ci.com/user/enterprise/setting-up-worker/)を参照してください。

展開されたTCI Workerおよびビルド環境OSイメージの数によって、Travis CI Enterpriseのインフラストラクチャでの総同時容量が決まります。
