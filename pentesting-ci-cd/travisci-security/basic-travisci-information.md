# 基本的なTravisCI情報

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もし **HackTricksであなたの会社を宣伝したい** または **PEASSの最新バージョンにアクセスしたい** または **HackTricksをPDFでダウンロードしたい** 場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけましょう。これは私たちの独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、私を **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で **フォロー**してください。
* **ハッキングのトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のgithubリポジトリに提出してください。**

</details>

## アクセス

TravisCIはGithub、Bitbucket、Assembla、Gitlabなどの異なるgitプラットフォームと直接統合されています。ユーザーには、TravisCIがTravisCIと統合するリポジトリにアクセスするための許可を求めます。

例えば、Githubでは以下の許可を求めます：

* `user:email` (読み取り専用)
* `read:org` (読み取り専用)
* `repo`: 公開および非公開のリポジトリと組織のコード、コミットステータス、共同作業者、デプロイステータスに対する読み取りおよび書き込みアクセスを許可します。

## 暗号化されたシークレット

### 環境変数

TravisCIでは、他のCIプラットフォームと同様に、リポジトリレベルで**暗号化され保存されるシークレット**を保存し、ビルドを実行するマシンの**環境変数に復号化してプッシュ**することができます。

![](<../../.gitbook/assets/image (44).png>)

シークレットが利用可能になる**ブランチ**（デフォルトではすべて）と、TravisCIが**ログに表示される場合にその値を非表示にするかどうか**を指定することができます（デフォルトでは非表示になります）。

### カスタム暗号化されたシークレット

**各リポジトリ**ごとに、TravisCIは**RSAキーペア**を生成し、**プライベート**なキーを保持し、リポジトリに**アクセス権限**を持つ人々にリポジトリの**公開鍵を利用可能にします**。

リポジトリの公開鍵には以下でアクセスできます：
```
travis pubkey -r <owner>/<repo_name>
travis pubkey -r carlospolop/t-ci-test
```
次に、このセットアップを使用して**シークレットを暗号化し、`.travis.yaml`に追加**することができます。ビルドが実行されると、シークレットは**環境変数**でアクセス可能な状態で**復号化**されます。

![](<../../.gitbook/assets/image (2) (2) (1) (1).png>)

この方法で暗号化されたシークレットは、設定の環境変数にリストされることはありません。

### カスタム暗号化ファイル

前述の方法と同様に、TravisCIでは**ファイルを暗号化し、ビルド中に復号化**することもできます。
```
travis encrypt-file super_secret.txt -r carlospolop/t-ci-test

encrypting super_secret.txt for carlospolop/t-ci-test
storing result as super_secret.txt.enc
storing secure env variables for decryption

Please add the following to your build script (before_install stage in your .travis.yml, for instance):

openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d

Pro Tip: You can add it automatically by running with --add.

Make sure to add super_secret.txt.enc to the git repository.
Make sure not to add super_secret.txt to the git repository.
Commit all changes to your .travis.yml.
```
注意：ファイルを暗号化する際には、リポジトリ内に2つの環境変数が設定されます。

![](<../../.gitbook/assets/image (23).png>)

## TravisCI Enterprise

Travis CI Enterpriseは、インフラストラクチャ内に展開できるTravis CIのオンプレミスバージョンです。Travis CIの「サーバー」バージョンと考えてください。Travis CIを使用すると、環境を自由に設定および保護できる簡単に使用できる継続的インテグレーション/継続的デプロイメント（CI/CD）システムを有効にできます。

**Travis CI Enterpriseは、次の2つの主要な部分で構成されています：**

1. TCIサービス（またはTCIコアサービス）：バージョン管理システムとの統合、ビルドの承認、ビルドジョブのスケジュールなどを担当します。
2. TCIワーカーおよびビルド環境イメージ（またはOSイメージ）。

**TCIコアサービスには、次のものが必要です：**

1. PostgreSQL11（またはそれ以降）のデータベース。
2. Kubernetesクラスタを展開するためのインフラストラクチャ。必要に応じて、サーバクラスタまたは単一のマシンに展開できます。
3. セットアップに応じて、RabbitMQなどのコンポーネントを独自に展開および設定することもできます。詳細については、[Travis CI Enterpriseのセットアップ](https://docs.travis-ci.com/user/enterprise/tcie-3.x-setting-up-travis-ci-enterprise/)を参照してください。

**TCIワーカーには、次のものが必要です：**

1. ワーカーとリンクされたビルドイメージを含むDockerイメージを展開できるインフラストラクチャ。
2. 特定のTravis CIコアサービスコンポーネントへの接続。詳細については、[ワーカーのセットアップ](https://docs.travis-ci.com/user/enterprise/setting-up-worker/)を参照してください。

展開されたTCIワーカーとビルド環境OSイメージの数によって、インフラストラクチャ内のTravis CI Enterprise展開の総同時容量が決まります。

![](<../../.gitbook/assets/image (8) (1) (1).png>)

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* **HackTricksのスポンサーになって、会社を広告しましょう**または**最新バージョンのPEASSを入手**または**HackTricksをPDFでダウンロード**するには、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしましょう 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して、あなたのハッキングトリックを共有しましょう。

</details>
