# TravisCI基本信息

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

- 如果您想在HackTricks中看到您的**公司广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
- 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
- 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[NFT收藏品](https://opensea.io/collection/the-peass-family)
- **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
- 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 访问

TravisCI直接集成了不同的git平台，如Github、Bitbucket、Assembla和Gitlab。它将要求用户授予TravisCI访问他想要与TravisCI集成的存储库的权限。

例如，在Github中，它将要求以下权限：

- `user:email`（只读）
- `read:org`（只读）
- `repo`：为公共和私有存储库和组织授予对代码、提交状态、协作者和部署状态的读写访问权限。

## 加密的秘密

### 环境变量

在TravisCI中，与其他CI平台一样，可以**在存储库级别保存秘密**，这些秘密将被加密保存，并**在执行构建的机器的环境变量中解密和推送**。

![](<../../.gitbook/assets/image (203).png>)

可以指定**将这些秘密可用于的分支**（默认为全部），还可以指示TravisCI**是否应该隐藏其值**，如果它出现在**日志中**（默认情况下会隐藏）。

### 自定义加密的秘密

对于**每个存储库**，TravisCI生成一个**RSA密钥对**，**保留**私钥，并使存储库的**公钥可供**那些**访问**存储库的人使用。

您可以通过以下方式访问一个存储库的公钥：
```
travis pubkey -r <owner>/<repo_name>
travis pubkey -r carlospolop/t-ci-test
```
然后，您可以使用此设置来**加密秘密信息并将其添加到您的`.travis.yaml`**文件中。这些秘密信息将在构建运行时**解密**，并可在**环境变量**中访问。

![](<../../.gitbook/assets/image (139).png>)

请注意，以这种方式加密的秘密信息不会显示在设置的环境变量列表中。

### 自定义加密文件

与之前一样，TravisCI还允许**加密文件，然后在构建过程中解密**：
```
travis encrypt-file super_secret.txt -r carlospolop/t-ci-test

encrypting super_secret.txt for carlospolop/t-ci-test
storing result as super_secret.txt.enc
storing secure env variables for decryption

Please add the following to your build script (before_install stage in your .travis.yml, for instance):

openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d

Pro Tip: You can add it automatically by running with --add.

Make sure to add super_secret.txt.enc to the git repository.
Make sure not to add super_secret.txt to the git repository.
Commit all changes to your .travis.yml.
```
请注意，加密文件时，将在存储库中配置2个环境变量，如下所示：

![](<../../.gitbook/assets/image (170).png>)

## TravisCI企业版

Travis CI企业版是Travis CI的**本地版本**，可以部署在**您的基础设施**中。可以将其视为Travis CI的“服务器”版本。使用Travis CI可以在您想要的环境中启用易于使用的持续集成/持续部署（CI/CD）系统，并进行配置和安全设置。

**Travis CI企业版由两个主要部分组成：**

1. TCI **服务**（或TCI核心服务），负责与版本控制系统集成，授权构建，调度构建作业等。
2. TCI **Worker**和构建环境镜像（也称为操作系统镜像）。

**TCI核心服务需要以下内容：**

1. **PostgreSQL11**（或更高版本）数据库。
2. 部署Kubernetes集群的基础设施；如果需要，可以在服务器集群或单台机器上部署
3. 根据您的设置，可能需要自行部署和配置某些组件，例如RabbitMQ - 有关更多详细信息，请参阅[设置Travis CI企业版](https://docs.travis-ci.com/user/enterprise/tcie-3.x-setting-up-travis-ci-enterprise/)。

**TCI Worker需要以下内容：**

1. 一个基础设施，可以部署包含**Worker和链接的构建镜像**的docker镜像。
2. 与某些Travis CI核心服务组件的连接性 - 有关更多详细信息，请参阅[设置Worker](https://docs.travis-ci.com/user/enterprise/setting-up-worker/)。

部署的TCI Worker和构建环境操作系统镜像数量将确定Travis CI企业版在您的基础设施中的总并发容量。

![](<../../.gitbook/assets/image (199).png>)
