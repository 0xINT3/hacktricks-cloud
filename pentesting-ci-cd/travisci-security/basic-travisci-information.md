# TravisCIの基本情報

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加する、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>

## アクセス

TravisCIはGithub、Bitbucket、Assembla、Gitlabなどの異なるgitプラットフォームと直接統合します。ユーザーに対して、TravisCIと統合したいリポジトリへのアクセス許可を与えるよう求めます。

例えば、Githubでは以下のアクセス許可を求めます：

* `user:email` (読み取り専用)
* `read:org` (読み取り専用)
* `repo`: 公開および非公開のリポジトリと組織のコード、コミットステータス、コラボレーター、デプロイステータスへの読み書きアクセスを許可します。

## 暗号化されたシークレット

### 環境変数

TravisCIをはじめとする他のCIプラットフォームでは、**リポジトリレベルでシークレットを保存**することが可能です。これらは暗号化されて保存され、ビルドを実行するマシンの**環境変数に復号されてプッシュされます**。

![](<../../.gitbook/assets/image (44).png>)

シークレットが利用可能になる**ブランチを指定**することができます（デフォルトではすべてのブランチ）、またTravisCIがログに表示された場合にその**値を隠すべきかどうか**も指定できます（デフォルトでは隠します）。

### カスタム暗号化シークレット

**各リポジトリ**に対して、TravisCIは**RSAキーペア**を生成し、**プライベート**キーを**保持**し、リポジトリの**公開キーをアクセス権**を持つ人に**利用可能にします**。

リポジトリの公開キーにアクセスするには：
```
travis pubkey -r <owner>/<repo_name>
travis pubkey -r carlospolop/t-ci-test
```
その後、このセットアップを使用して**シークレットを暗号化し、`.travis.yaml`に追加する**ことができます。シークレットは**ビルド実行時に復号化され**、**環境変数**でアクセス可能になります。

![](<../../.gitbook/assets/image (2) (2) (1) (1).png>)

この方法で暗号化されたシークレットは、設定の環境変数にリストされていないことに注意してください。

### カスタム暗号化ファイル

前と同じように、TravisCIは**ファイルを暗号化し、ビルド中にそれらを復号化する**ことも可能です：
```
travis encrypt-file super_secret.txt -r carlospolop/t-ci-test

encrypting super_secret.txt for carlospolop/t-ci-test
storing result as super_secret.txt.enc
storing secure env variables for decryption

Please add the following to your build script (before_install stage in your .travis.yml, for instance):

openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d

Pro Tip: You can add it automatically by running with --add.

Make sure to add super_secret.txt.enc to the git repository.
Make sure not to add super_secret.txt to the git repository.
Commit all changes to your .travis.yml.
```
ファイルを暗号化する際、リポジトリ内に2つの環境変数が設定されることに注意してください。

![](<../../.gitbook/assets/image (23).png>)

## TravisCI Enterprise

Travis CI Enterpriseは、**自社インフラ内にデプロイ可能なTravis CIのオンプレミスバージョン**です。Travis CIの「サーバー」バージョンと考えてください。Travis CIを使用することで、自由に設定しセキュリティを確保できる環境に、使いやすいContinuous Integration/Continuous Deployment (CI/CD) システムを実現できます。

**Travis CI Enterpriseは主に2つの部分から構成されます：**

1. TCI **サービス**（またはTCIコアサービス）、バージョン管理システムとの統合、ビルドの認証、ビルドジョブのスケジューリングなどを担当。
2. TCI **ワーカー**とビルド環境イメージ（OSイメージとも呼ばれる）。

**TCIコアサービスには以下が必要です：**

1. **PostgreSQL11**（またはそれ以降のバージョン）データベース。
2. Kubernetesクラスタをデプロイするためのインフラ；サーバークラスタまたは必要に応じて単一マシンにデプロイ可能。
3. セットアップに応じて、RabbitMQなどのコンポーネントを自分でデプロイ・設定することが望ましい場合があります - 詳細は[Setting up Travis CI Enterprise](https://docs.travis-ci.com/user/enterprise/tcie-3.x-setting-up-travis-ci-enterprise/)を参照してください。

**TCIワーカーには以下が必要です：**

1. **ワーカーとリンクされたビルドイメージを含むdockerイメージをデプロイできる**インフラ。
2. 特定のTravis CIコアサービスコンポーネントへの接続性 - 詳細は[Setting Up Worker](https://docs.travis-ci.com/user/enterprise/setting-up-worker/)を参照してください。

デプロイされたTCIワーカーとビルド環境OSイメージの量が、自社インフラ内のTravis CI Enterpriseデプロイメントの合計同時処理能力を決定します。

![](<../../.gitbook/assets/image (8) (1) (1) (1).png>)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**telegramグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)や[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
