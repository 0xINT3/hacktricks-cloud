# 基本的 TravisCI 信息

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为英雄</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 **HackTricks 中看到您的公司广告** 或 **下载 HackTricks 的 PDF**，请查看 [**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方的 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFT 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上 **关注** 我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>

## 访问

TravisCI 直接与不同的 git 平台集成，如 Github、Bitbucket、Assembla 和 Gitlab。它会要求用户授权 TravisCI 访问他想要与 TravisCI 集成的仓库。

例如，在 Github 中，它会要求以下权限：

* `user:email`（只读）
* `read:org`（只读）
* `repo`：授予对公共和私有仓库及组织的代码、提交状态、协作者和部署状态的读写权限。

## 加密的秘密

### 环境变量

在 TravisCI 中，与其他 CI 平台一样，可以**在仓库级别保存秘密**，这些秘密将被加密保存，并在执行构建的机器的环境变量中**解密并推送**。

![](<../../.gitbook/assets/image (44).png>)

可以指定**秘密可用的分支**（默认为所有分支），以及 TravisCI 是否应该**隐藏其值**，如果它出现**在日志中**（默认情况下会隐藏）。

### 自定义加密的秘密

对于**每个仓库**，TravisCI 生成一个**RSA 密钥对**，**保留** **私钥**，并使仓库的**公钥**对有**访问权限**的人可用。

您可以使用以下方式访问某个仓库的公钥：
```
travis pubkey -r <owner>/<repo_name>
travis pubkey -r carlospolop/t-ci-test
```
然后，您可以使用此设置来**加密秘密并将它们添加到您的 `.travis.yaml`** 中。构建运行时将**解密秘密**，并且可以在**环境变量**中访问。

![](<../../.gitbook/assets/image (2) (2) (1) (1).png>)

请注意，以这种方式加密的秘密不会显示在设置的环境变量列表中。

### 自定义加密文件

与前面相同，TravisCI 也允许**加密文件，然后在构建期间解密它们**：
```
travis encrypt-file super_secret.txt -r carlospolop/t-ci-test

encrypting super_secret.txt for carlospolop/t-ci-test
storing result as super_secret.txt.enc
storing secure env variables for decryption

Please add the following to your build script (before_install stage in your .travis.yml, for instance):

openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d

Pro Tip: You can add it automatically by running with --add.

Make sure to add super_secret.txt.enc to the git repository.
Make sure not to add super_secret.txt to the git repository.
Commit all changes to your .travis.yml.
```
请注意，加密文件时，将在仓库中配置2个环境变量，如下：

![](<../../.gitbook/assets/image (23).png>)

## TravisCI 企业版

Travis CI 企业版是 Travis CI 的**本地部署版本**，您可以在**自己的基础设施中部署**。可以将其视为 Travis CI 的‘服务器’版本。使用 Travis CI 可以在您可以配置和保护的环境中启用易于使用的持续集成/持续部署（CI/CD）系统。

**Travis CI 企业版由两个主要部分组成：**

1. TCI **服务**（或 TCI 核心服务），负责与版本控制系统集成、授权构建、调度构建作业等。
2. TCI **Worker** 和构建环境镜像（也称为操作系统镜像）。

**TCI 核心服务需要以下内容：**

1. 一个 **PostgreSQL11**（或更高版本）数据库。
2. 用于部署 Kubernetes 集群的基础设施；如果需要，可以在服务器集群或单台机器中部署
3. 根据您的设置，您可能需要自行部署和配置某些组件，例如 RabbitMQ - 有关更多详细信息，请参阅[设置 Travis CI 企业版](https://docs.travis-ci.com/user/enterprise/tcie-3.x-setting-up-travis-ci-enterprise/)。

**TCI Worker 需要以下内容：**

1. 可以部署包含 **Worker 和关联构建镜像的 docker 镜像**的基础设施。
2. 与某些 Travis CI 核心服务组件的连接性 - 有关更多详细信息，请参阅[设置 Worker](https://docs.travis-ci.com/user/enterprise/setting-up-worker/)。

部署的 TCI Worker 和构建环境操作系统镜像的数量将决定 Travis CI 企业版在您基础设施中的总并发容量。

![](<../../.gitbook/assets/image (8) (1) (1) (1) (1).png>)

<details>

<summary><strong>从零到英雄学习 AWS 黑客技术，通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 HackTricks 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs**](https://opensea.io/collection/the-peass-family)系列
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>
