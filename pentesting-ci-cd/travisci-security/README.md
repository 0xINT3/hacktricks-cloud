# TravisCI セキュリティ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) で AWS ハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks にあなたの会社を広告したい**、または **HackTricks を PDF でダウンロードしたい** 場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式 PEASS & HackTricks グッズ**](https://peass.creator-spring.com) を入手する
* [**PEASS ファミリー**](https://opensea.io/collection/the-peass-family) を発見する、私たちの独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクション
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) に **参加する** か、[**テレグラムグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) を **フォローする**。
* **HackTricks** の GitHub リポジトリ [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) に PR を提出して、あなたのハッキングのコツを共有する。

</details>

## TravisCI とは

**Travis CI** は、複数の **異なる git プラットフォーム** にホストされているソフトウェアプロジェクトをビルドおよびテストするために使用される **ホストされた** または **オンプレミス** の **継続的インテグレーション** サービスです。

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## 攻撃

### トリガー

攻撃を開始するには、まずビルドをトリガーする方法を知る必要があります。デフォルトでは、TravisCI は **プッシュとプルリクエストにビルドをトリガーします**：

![](<../../.gitbook/assets/image (19) (1).png>)

#### Cron ジョブ

Web アプリケーションにアクセスできる場合は、**ビルドを実行するための cron を設定** できます。これは、永続性を持たせたり、ビルドをトリガーするために役立つかもしれません：

![](<../../.gitbook/assets/image (42).png>)

{% hint style="info" %}
`.travis.yml` 内で cron を設定することはできないようです。[こちら](https://github.com/travis-ci/travis-ci/issues/9162)を参照してください。
{% endhint %}

### サードパーティ PR

TravisCI はデフォルトでサードパーティからの PR に環境変数を共有することを無効にしていますが、誰かがそれを有効にすると、リポジトリに PR を作成してシークレットを抽出することができます：

![](<../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png>)

### シークレットのダンプ

[**基本情報**](basic-travisci-information.md) ページで説明されているように、2 種類のシークレットがあります。**環境変数シークレット**（Web ページにリストされています）と **カスタム暗号化シークレット**（`.travis.yml` ファイル内に base64 として格納されていますが、両方とも暗号化されて最終的なマシンで環境変数になります）。

* **環境変数として設定されたシークレットを列挙する** には、**プロジェクトの設定** に移動し、リストを確認します。ただし、ここで設定されたすべてのプロジェクト環境変数はビルドをトリガーすると表示されることに注意してください。
* **カスタム暗号化シークレットを列挙する** 最善の方法は、**`.travis.yml` ファイルをチェックする** ことです。
* **暗号化されたファイルを列挙する** には、リポジトリ内の **`.enc` ファイル** をチェックするか、設定ファイル内で `openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d` といった行を探すか、**環境変数** 内の **暗号化された iv とキー** を探します：

![](<../../.gitbook/assets/image (71).png>)

### TODO:

* Windows/Mac/Linux でリバースシェルを実行するビルドの例
* ログに base64 エンコードされた env をリークするビルドの例

### TravisCI Enterprise

攻撃者が **TravisCI エンタープライズ** を使用している環境に終わる場合（これが何であるかについての詳細は [**基本情報**](basic-travisci-information.md#travisci-enterprise) で説明されています）、攻撃者は **Worker でビルドをトリガーする** ことができます。これは、攻撃者が次のことを可能にするそのサーバーに横移動することができることを意味します：

* ホストに脱出する？
* Kubernetes を侵害する？
* 同じネットワークで実行されている他のマシンを侵害する？
* 新しいクラウド資格情報を侵害する？

## 参考文献

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) で AWS ハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks にあなたの会社を広告したい**、または **HackTricks を PDF でダウンロードしたい** 場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式 PEASS & HackTricks グッズ**](https://peass.creator-spring.com) を入手する
* [**PEASS ファミリー**](https://opensea.io/collection/the-peass-family) を発見する、私たちの独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクション
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) に **参加する** か、[**テレグラムグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) を **フォローする**。
* **HackTricks** の GitHub リポジトリ [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) に PR を提出して、あなたのハッキングのコツを共有する。

</details>
