# TravisCIセキュリティ

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricks**であなたの**会社を広告掲載**したい場合や、**PEASSの最新バージョンにアクセス**したい場合、または**HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をご確認ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## TravisCIとは

**Travis CI**は、**ホストされた**または**オンプレミス**の**継続的な統合**サービスであり、さまざまな**異なるGitプラットフォーム**にホストされたソフトウェアプロジェクトのビルドとテストに使用されます。

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## 攻撃

### トリガー

攻撃を開始するには、まずビルドをトリガーする方法を知る必要があります。デフォルトでは、TravisCIは**プッシュとプルリクエストでビルドをトリガー**します。

![](<../../.gitbook/assets/image (19) (1).png>)

#### クーロンジョブ

Webアプリケーションにアクセスできる場合、ビルドを実行するために**クーロンを設定**することができます。これは持続性やビルドのトリガーに役立つ場合があります。

![](<../../.gitbook/assets/image (42).png>)

{% hint style="info" %}
[こちら](https://github.com/travis-ci/travis-ci/issues/9162)によると、`.travis.yml`内でクーロンを設定することはできないようです。
{% endhint %}

### サードパーティのプルリクエスト

TravisCIはデフォルトで、サードパーティからのプルリクエストと環境変数の共有を無効にしていますが、誰かが有効にしている可能性があり、その場合はリポジトリにプルリクエストを作成してシークレット情報を外部に漏洩させることができます。

![](<../../.gitbook/assets/image (1) (1) (1) (1).png>)

### シークレットのダンプ

[**基本情報**](basic-travisci-information.md)ページで説明されているように、2種類のシークレットがあります。**環境変数シークレット**（ウェブページにリストされている）と**カスタム暗号化シークレット**（`.travis.yml`ファイルにbase64で保存されることに注意してください。両方とも暗号化されているため、最終的なマシンでは環境変数として表示されます）。

* **環境変数として設定されたシークレット**を列挙するには、**プロジェクトの設定**に移動してリストを確認します。ただし、ここで設定されたすべてのプロジェクト環境変数は、ビルドをトリガーすると表示されます。
* **カスタム暗号化シークレット**を列挙するためには、**`.travis.yml`ファイル**を確認することが最善です。
* **暗号化されたファイル**を列挙するには、リポジトリ内の**`.enc`ファイル**をチェックするか、設定ファイル内の`openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d`のような行をチェックするか、**環境変数**内の**暗号化されたivとキー**をチェックします。

![](<../../.gitbook/assets/image (71).png>)

### TODO:

* Windows/Mac/Linuxで実行される逆シェルを使用したビルドの例
* ログにエンコードされた環境変数を漏洩させるビルドの例

### TravisCI Enterprise

攻撃者が**TravisCI Enterprise**を使用している環境に入ると（これについての詳細は[**基本情報**](basic-travisci-information.md#travisci-enterprise)を参照）、攻撃者は**ワーカーでビルドをトリガー**することができます。これは、攻撃者がそのサーバーに横断的に移動できることを意味し、次のことができるかもしれません：

* ホストからの脱出？
* Kubernetesの侵害？
* 同じネットワークで実行されている他のマシンの侵害？
* 新しいクラウドの資格情報の侵害？

## 参考文献

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricks**であなたの**会社を広告掲載**したい場合や、**PEASSの最新バージョンにアクセス**したい場合、または**HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をご確認ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見しましょう。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
