# TravisCI 安全

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS 红队专家）</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 HackTricks 中看到您的 **公司广告** 或 **下载 PDF 版本的 HackTricks**，请查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 探索 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家 [**NFT**](https://opensea.io/collection/the-peass-family) 收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或 **关注** 我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>

## 什么是 TravisCI

**Travis CI** 是一个用于构建和测试托管在多个 **不同的 git 平台** 上的软件项目的 **托管** 或 **本地** **持续集成** 服务。

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## 攻击

### 触发器

要发动攻击，首先需要了解如何触发构建。默认情况下，TravisCI 将在推送和拉取请求时 **触发构建**：

![](<../../.gitbook/assets/image (19) (1).png>)

#### 定时任务

如果您可以访问 Web 应用程序，您可以 **设置定时任务来运行构建**，这对于持久性或触发构建可能很有用：

![](<../../.gitbook/assets/image (42).png>)

{% hint style="info" %}
根据 [此链接](https://github.com/travis-ci/travis-ci/issues/9162)，似乎无法在 `.travis.yml` 中设置定时任务。
{% endhint %}

### 第三方拉取请求

默认情况下，TravisCI 禁用与来自第三方的拉取请求共享环境变量，但某人可能启用它，然后您可以向存储库创建拉取请求并外泄秘密：

![](<../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png>)

### 泄露秘密

如 [**基本信息**](basic-travisci-information.md) 页面所述，有两种类型的秘密。**环境变量秘密**（列在网页上）和 **自定义加密秘密**，存储在 `.travis.yml` 文件中作为 base64（请注意，加密后的两者最终都将作为环境变量出现在最终的机器上）。

* 要 **枚举配置为环境变量的秘密**，请转到 **项目** 的 **设置** 并检查列表。但是，请注意，设置在此处的所有项目环境变量将在触发构建时显示。
* 要枚举 **自定义加密秘密**，最好的方法是 **检查 `.travis.yml` 文件**。
* 要 **枚举加密文件**，您可以在存储库中查找 **`.enc` 文件**，在配置文件中查找类似于 `openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d` 的行，或在 **环境变量** 中查找 **加密的 iv 和密钥**，例如：

![](<../../.gitbook/assets/image (71).png>)

### 待办事项：

* 在 Windows/Mac/Linux 上运行反向 shell 的示例构建
* 在日志中泄露以 base64 编码的环境示例构建

### TravisCI 企业版

如果攻击者进入使用 **TravisCI 企业版** 的环境（有关此内容的更多信息，请参阅 [**基本信息**](basic-travisci-information.md#travisci-enterprise)），他将能够在 **Worker** 中 **触发构建**。这意味着攻击者将能够从那台服务器横向移动，从而可能：

* 逃逸到主机？
* 危害 kubernetes？
* 危害运行在同一网络中的其他计算机？
* 危害新的云凭证？

## 参考资料

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS 红队专家）</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 HackTricks 中看到您的 **公司广告** 或 **下载 PDF 版本的 HackTricks**，请查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 探索 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家 [**NFT**](https://opensea.io/collection/the-peass-family) 收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或 **关注** 我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>
