# TravisCI セキュリティ

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**PEASSファミリー**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **ハッキングのコツを共有するために、** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のgithubリポジトリにPRを提出する。

</details>

## TravisCIとは

**Travis CI**は、複数の**異なるgitプラットフォーム**にホストされているソフトウェアプロジェクトをビルドおよびテストするために使用される**ホストされた**または**オンプレミス**の**継続的インテグレーション**サービスです。

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## 攻撃

### トリガー

攻撃を開始するには、まずビルドをトリガーする方法を知る必要があります。デフォルトではTravisCIは**プッシュとプルリクエストにビルドをトリガーします**：

![](<../../.gitbook/assets/image (19) (1).png>)

#### Cronジョブ

Webアプリケーションにアクセスできる場合は、**ビルドを実行するためにcronを設定**することができます。これは、永続性を持たせるためやビルドをトリガーするために役立つかもしれません：

![](<../../.gitbook/assets/image (42).png>)

{% hint style="info" %}
`.travis.yml`内でcronを設定することはできないようです。[こちら](https://github.com/travis-ci/travis-ci/issues/9162)を参照してください。
{% endhint %}

### サードパーティPR

TravisCIはデフォルトでサードパーティからのPRに環境変数を共有することを無効にしていますが、誰かがそれを有効にすると、リポジトリにPRを作成してシークレットを抽出することができます：

![](<../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png>)

### シークレットのダンプ

[**基本情報**](basic-travisci-information.md)のページで説明されているように、2種類のシークレットがあります。**環境変数シークレット**（Webページにリストされています）と**カスタム暗号化シークレット**で、これは`.travis.yml`ファイル内にbase64として格納されています（両方とも暗号化されて最終的なマシンで環境変数になります）。

* **環境変数として設定されたシークレットを列挙する**には、**プロジェクトの設定**に移動し、リストを確認します。ただし、ここで設定されたすべてのプロジェクト環境変数はビルドをトリガーすると表示されることに注意してください。
* **カスタム暗号化シークレットを列挙する**には、**`.travis.yml`ファイルをチェックする**のが最善です。
* **暗号化されたファイルを列挙する**には、リポジトリ内の**`.enc`ファイル**をチェックするか、設定ファイル内で`openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d`のような行を探すか、**環境変数**内の**暗号化されたivとキー**を探します：

![](<../../.gitbook/assets/image (71).png>)

### TODO:

* Windows/Mac/Linuxでリバースシェルを実行するビルドの例
* ログにbase64エンコードされたenvをリークするビルドの例

### TravisCIエンタープライズ

攻撃者が**TravisCIエンタープライズ**を使用している環境に終わる場合（これについての詳細は[**基本情報**](basic-travisci-information.md#travisci-enterprise)で説明されています）、攻撃者は**ワーカーでビルドをトリガーする**ことができます。これは、攻撃者が以下のことを可能にするそのサーバーに横移動できることを意味します：

* ホストに脱出する？
* Kubernetesを危険にさらす？
* 同じネットワークで実行されている他のマシンを危険にさらす？
* 新しいクラウド資格情報を危険にさらす？

## 参考文献

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**PEASSファミリー**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **ハッキングのコツを共有するために、** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のgithubリポジトリにPRを提出する。

</details>
