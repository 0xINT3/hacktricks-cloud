# TravisCI 安全性

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为英雄</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 HackTricks 中看到您的**公司广告**或**下载 HackTricks 的 PDF 版本**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>

## 什么是 TravisCI

**Travis CI** 是一个**托管的**或**内部部署的** **持续集成**服务，用于构建和测试托管在多个**不同 git 平台**上的软件项目。

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## 攻击

### 触发器

要发起攻击，首先需要知道如何触发构建。默认情况下，TravisCI 会在**推送和拉取请求时触发构建**：

![](<../../.gitbook/assets/image (19) (1).png>)

#### 定时任务

如果您可以访问 Web 应用程序，您可以**设置定时任务来运行构建**，这对于持久性或触发构建可能很有用：

![](<../../.gitbook/assets/image (42).png>)

{% hint style="info" %}
看起来在 `.travis.yml` 中设置定时任务是不可能的，根据[这里](https://github.com/travis-ci/travis-ci/issues/9162)的信息。
{% endhint %}

### 第三方 PR

TravisCI 默认禁止与来自第三方的 PR 共享环境变量，但有人可能会启用它，然后您可以创建 PR 到仓库并泄露秘密：

![](<../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png>)

### 泄露秘密

如[**基本信息**](basic-travisci-information.md)页面所解释的，有两种类型的秘密。**环境变量秘密**（在网页上列出）和**自定义加密秘密**，这些秘密存储在 `.travis.yml` 文件中为 base64（注意，两者都存储为加密的最终将作为环境变量出现在最终机器中）。

* 要**枚举配置为环境变量的秘密**，请转到**项目的设置**并检查列表。但是，请注意，这里设置的所有项目环境变量在触发构建时都会显示。
* 要枚举**自定义加密秘密**，最好的方法是**检查 `.travis.yml` 文件**。
* 要**枚举加密文件**，您可以在仓库中检查**`.enc` 文件**，在配置文件中寻找类似 `openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d` 的行，或者在**环境变量**中寻找**加密的 iv 和密钥**，例如：

![](<../../.gitbook/assets/image (71).png>)

### 待办事项：

* 示例构建在 Windows/Mac/Linux 上运行的反向 shell
* 示例构建在日志中泄露 base64 编码的环境

### TravisCI 企业版

如果攻击者最终进入使用**TravisCI 企业版**的环境（更多关于这是什么的信息在[**基本信息**](basic-travisci-information.md#travisci-enterprise)），他将能够**在 Worker 中触发构建**。这意味着攻击者将能够横向移动到那台服务器，从那里他可能能够：

* 逃逸到宿主机？
* 危害 Kubernetes？
* 危害在同一网络中运行的其他机器？
* 危害新的云凭证？

## 参考资料

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为英雄</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 HackTricks 中看到您的**公司广告**或**下载 HackTricks 的 PDF 版本**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>
