# TravisCI セキュリティ

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を通じてゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい**または **HackTricks をPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見る
* **Discordグループ**に**参加**💬(https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦で私たちをフォローする [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks**（https://github.com/carlospolop/hacktricks）と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出して、あなたのハッキングテクニックを共有してください。

</details>

## TravisCI とは

**Travis CI** は、複数の **異なるgitプラットフォーム** にホストされているソフトウェアプロジェクトをビルドおよびテストするために使用される **ホスト型**または **オンプレミス**の **継続的インテグレーション** サービスです。

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## 攻撃

### トリガー

攻撃を開始するには、まずビルドをトリガーする方法を知る必要があります。デフォルトでは、TravisCI は **プッシュやプルリクエストでビルドをトリガー**します。

![](<../../.gitbook/assets/image (19) (1).png>)

#### クーロンジョブ

Webアプリケーションにアクセスできる場合、**クーロンを設定してビルドを実行**することができます。これは持続性のために便利であり、ビルドをトリガーするために使用できます。

![](<../../.gitbook/assets/image (42).png>)

{% hint style="info" %}
[こちら](https://github.com/travis-ci/travis-ci/issues/9162)によると、`.travis.yml`内でクーロンを設定することはできないようです。
{% endhint %}

### サードパーティのPR

TravisCI はデフォルトで、サードパーティからのPRと環境変数の共有を無効にしていますが、誰かが有効にしている可能性があり、その場合、リポジトリにPRを作成してシークレットを外部に持ち出すことができます。

![](<../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png>)

### シークレットのダンプ

[**基本情報**](basic-travisci-information.md)ページで説明されているように、2種類のシークレットがあります。**環境変数シークレット**（Webページにリストされている）と **カスタム暗号化されたシークレット** です。これらは `.travis.yml` ファイルにbase64として格納されます（両方とも暗号化されているため、最終的なマシンでは環境変数として表示されます）。

* **環境変数として構成されたシークレット**を列挙するには、**プロジェクト**の **設定**に移動してリストを確認します。ただし、ここで設定されたすべてのプロジェクト環境変数は、ビルドをトリガーするときに表示されます。
* **カスタム暗号化されたシークレット**を列挙するには、**`.travis.yml`ファイル**を確認するのが最善です。
* **暗号化されたファイル**を列挙するには、リポジトリ内の **`.enc`ファイル**、設定ファイル内の `openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d` に類似した行、または **環境変数**内の **暗号化されたivとキー**を確認できます。

![](<../../.gitbook/assets/image (71).png>)

### TODO:

* Windows/Mac/Linux で実行される逆シェルを使用したビルドの例
* ログにエンコードされた環境ベース64を漏洩させるビルドの例

### TravisCI Enterprise

攻撃者が **TravisCI Enterprise** を使用する環境に入ると（これについての詳細は[**基本情報**](basic-travisci-information.md#travisci-enterprise)にあります）、**Workerでビルドをトリガー**することができます。これは、攻撃者がそのサーバーに横断的に移動できることを意味し、その後、次のことができる可能性があります：

* ホストから脱出する？
* Kubernetes を危険にさらす？
* 同じネットワーク内で実行されている他のマシンを危険にさらす？
* 新しいクラウド資格情報を危険にさらす？

## 参考文献

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を通じてゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい**または **HackTricks をPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見る
* **Discordグループ**に**参加**💬(https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦で私たちをフォローする [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks**（https://github.com/carlospolop/hacktricks）と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出して、あなたのハッキングテクニックを共有してください。

</details>
