# TravisCI 安全

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 来**分享您的黑客技巧**。

</details>

## 什么是 TravisCI

**Travis CI** 是一个用于构建和测试托管在多个**不同 git 平台**上的软件项目的**托管**或**本地****持续集成**服务。

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## 攻击

### 触发器

要发动攻击，首先需要知道如何触发构建。默认情况下，TravisCI 会在推送和拉取请求时**触发构建**：

![](<../../.gitbook/assets/image (19) (1).png>)

#### 定时任务

如果您可以访问 Web 应用程序，可以**设置定时任务来运行构建**，这对于持久性或触发构建可能很有用：

![](<../../.gitbook/assets/image (42).png>)

{% hint style="info" %}
根据[此](https://github.com/travis-ci/travis-ci/issues/9162)问题，似乎无法在 `.travis.yml` 中设置定时任务。
{% endhint %}

### 第三方拉取请求

TravisCI 默认情况下禁用与来自第三方的拉取请求共享环境变量，但某些人可能会启用它，然后您可以为仓库创建拉取请求并窃取密钥：

![](<../../.gitbook/assets/image (1) (1) (1) (1) (1) (1).png>)

### 密钥泄露

如[**基本信息**](basic-travisci-information.md)页面所述，有两种类型的密钥。**环境变量密钥**（列在网页上）和**自定义加密密钥**，它们以 base64 的形式存储在 `.travis.yml` 文件中（请注意，无论是存储加密的还是未加密的，最终机器上都会以环境变量的形式出现）。

* 要**枚举配置为环境变量的密钥**，请转到**项目**的**设置**并检查列表。但是，请注意，设置在此处的所有项目环境变量在触发构建时都会出现。
* 要枚举**自定义加密密钥**，您最好的选择是**检查 `.travis.yml` 文件**。
* 要枚举**加密文件**，您可以检查仓库中的**`.enc` 文件**，检查配置文件中类似于 `openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d` 的行，或者检查**环境变量**中的**加密 iv 和密钥**，例如：

![](<../../.gitbook/assets/image (71).png>)

### 待办事项：

* 在 Windows/Mac/Linux 上运行反向 shell 的示例构建
* 在日志中泄露以 base64 编码的环境变量的示例构建

### TravisCI 企业版

如果攻击者进入使用**TravisCI 企业版**的环境（有关此内容的更多信息，请参见[**基本信息**](basic-travisci-information.md#travisci-enterprise)），他将能够在 Worker 中**触发构建**。这意味着攻击者将能够从中横向移动到该服务器，从而可能能够：

* 逃逸到主机？
* 危害 Kubernetes？
* 危害运行在同一网络中的其他机器？
* 危害新的云凭据？

## 参考资料

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 来**分享您的黑客技巧**。

</details>
