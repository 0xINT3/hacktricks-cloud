# Seguridad en TravisCI

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Red Team de HackTricks para AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## ¿Qué es TravisCI?

**Travis CI** es un servicio de **integración continua** **alojado** o en **premisas** utilizado para construir y probar proyectos de software alojados en varias **plataformas git diferentes**.

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## Ataques

### Disparadores

Para lanzar un ataque primero necesitas saber cómo disparar una construcción. Por defecto, TravisCI **disparará una construcción con pushes y pull requests**:

![](<../../.gitbook/assets/image (19) (1).png>)

#### Tareas Programadas

Si tienes acceso a la aplicación web, puedes **configurar tareas programadas para ejecutar la construcción**, esto podría ser útil para persistencia o para disparar una construcción:

![](<../../.gitbook/assets/image (42).png>)

{% hint style="info" %}
Parece que no es posible configurar tareas programadas dentro del archivo `.travis.yml` según [esto](https://github.com/travis-ci/travis-ci/issues/9162).
{% endhint %}

### PR de Terceros

Por defecto, TravisCI deshabilita compartir variables de entorno con PRs provenientes de terceros, pero alguien podría habilitarlo y entonces podrías crear PRs al repositorio y exfiltrar los secretos:

![](<../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1).png>)

### Volcado de Secretos

Como se explica en la página de [**información básica**](basic-travisci-information.md), hay 2 tipos de secretos. **Secretos de Variables de Entorno** (que se listan en la página web) y **secretos encriptados personalizados**, que se almacenan dentro del archivo `.travis.yml` como base64 (nota que ambos almacenados encriptados terminarán como variables de entorno en las máquinas finales).

* Para **enumerar secretos** configurados como **Variables de Entorno** ve a los **ajustes** del **proyecto** y revisa la lista. Sin embargo, ten en cuenta que todas las variables de entorno del proyecto configuradas aquí aparecerán al disparar una construcción.
* Para enumerar los **secretos encriptados personalizados** lo mejor que puedes hacer es **revisar el archivo `.travis.yml`**.
* Para **enumerar archivos encriptados** puedes buscar **archivos `.enc`** en el repositorio, por líneas similares a `openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d` en el archivo de configuración, o por **iv y claves encriptadas** en las **Variables de Entorno** como:

![](<../../.gitbook/assets/image (71).png>)

### POR HACER:

* Ejemplo de construcción con shell inversa ejecutándose en Windows/Mac/Linux
* Ejemplo de construcción filtrando el env codificado en base64 en los registros

### TravisCI Enterprise

Si un atacante termina en un entorno que utiliza **TravisCI Enterprise** (más información sobre qué es esto en la página de [**información básica**](basic-travisci-information.md#travisci-enterprise)), será capaz de **disparar construcciones en el Worker.** Esto significa que un atacante podrá moverse lateralmente a ese servidor desde el cual podría ser capaz de:

* ¿escapar al host?
* ¿comprometer kubernetes?
* ¿comprometer otras máquinas que se ejecutan en la misma red?
* ¿comprometer nuevas credenciales en la nube?

## Referencias

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Red Team de HackTricks para AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
