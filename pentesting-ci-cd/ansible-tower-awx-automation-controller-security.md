# Ansible Tower / AWX / Automation controller セキュリティ

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もし **HackTricks であなたの会社を宣伝したい**場合や、**PEASS の最新バージョンにアクセスしたい**場合、または HackTricks を PDF でダウンロードしたい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式の PEASS & HackTricks スワッグ**](https://peass.creator-spring.com) を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) を見つけてください。これは私たちの独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクションです
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) または [**telegram グループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) をフォローしてください。
* **HackTricks** と **HackTricks Cloud** の github リポジトリに PR を提出して、あなたのハッキングテクニックを共有しましょう。

</details>

## 基本情報

**Ansible Tower** またはそのオープンソース版である [**AWX**](https://github.com/ansible/awx) は、**Ansible のユーザーインターフェース、ダッシュボード、および REST API** としても知られています。**役割ベースのアクセス制御**、ジョブスケジューリング、およびグラフィカルなインベントリ管理により、Ansible インフラストラクチャをモダンな UI から管理することができます。Tower の REST API とコマンドラインインターフェースを使用すると、現在のツールやワークフローに簡単に統合することができます。

**Automation Controller は、より高機能な** Ansible Tower の新しいバージョンです。

### 違い

[**こちら**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00)によると、Ansible Tower と AWS の主な違いは、受け取るサポートと Ansible Tower が役割ベースのアクセス制御、カスタム API のサポート、およびユーザー定義のワークフローなどの追加機能を持っていることです。

### 技術スタック

* **Web インターフェース**: これはユーザーがインベントリ、資格情報、テンプレート、ジョブを管理するためのグラフィカルインターフェースです。直感的に設計されており、自動化ジョブの状態と結果を理解するのに役立つ視覚化機能を提供します。
* **REST API**: Web インターフェースで行えることはすべて、REST API を介しても行うことができます。これにより、AWX/Tower を他のシステムと統合したり、通常インターフェースで実行するアクションをスクリプト化することができます。
* **データベース**: AWX/Tower は、設定、ジョブの結果、その他の必要な運用データを保存するためにデータベース（通常は PostgreSQL）を使用します。
* **RabbitMQ**: これは AWX/Tower が異なるコンポーネント間で通信するために使用するメッセージングシステムです。特に Web サービスとタスクランナー間の通信に使用されます。
* **Redis**: Redis はキャッシュとタスクキューのバックエンドとして機能します。

### 論理コンポーネント

* **インベントリ**: インベントリは、**ホスト（またはノード）のコレクション**であり、**ジョブ**（Ansible プレイブック）を**実行**するためのものです。AWX/Tower では、インベントリを定義してグループ化することができ、AWS、Azure などの他のシステムからホストリストを**取得**することもサポートしています。
* **プロジェクト**: プロジェクトは、最新のプレイブックを必要な時に取得するために、**バージョン管理システム**（Git のような）から取得した Ansible プレイブックの**コレクション**です。
* **テンプレート**: ジョブテンプレートは、特定のプレイブックがどのように実行されるかを定義し、ジョブのための**インベントリ**、**資格情報**、および他の**パラメータ**を指定します。
* **資格情報**: AWX/Tower は、SSH キー、パスワード、API トークンなどの秘密を**管理**および**保存**する安全な方法を提供します。これらの資格情報は、プレイブックが実行される際に必要なアクセス権限を持つように、ジョブテンプレートに関連付けることができます。
* **タスクエンジン**: ここで魔法が起こります。タスクエンジンは Ansible 上に構築され、プレイブックの実行を担当します。ジョブはタスクエンジンにディスパッチされ、指定されたインベントリと指定された資格情報を使用して、Ansible プレイブックを実行します。
* **スケジューラとコールバック**: これらは AWX/Tower の高度な機能であり、ジョブを特定の時間にスケジュール実行したり、外部イベントによってトリガーされたりすることができます。
* **通知**: AWX/Tower は、ジョブの成功または失敗に基づいて通知を送信することができます。メール、Slack メッセージ、Webhook など、さまざまな通知手段をサポートしています。
* **Ansible プレイブック**: Ansible プレイブックは、設定、デプロイメント、オーケストレーションツールです。自動化された、繰り返し可能な方法でシステムの望ましい状態を記述します。YAML で記述され、プレイブックは Ansible の宣言型の自動化言語を使用して、実行する必要のある設定、タスク、および手順を記述します。

### ジョブの実行フロー

1. **ユーザーの操作**: ユーザーは AWX/Tower に対して **Web インターフェース** または **REST API** を介して操作することができます。これらは AWX/Tower が提供するすべての機能にフロントエンドアクセスを提供します。
2. **ジョブの開始**:
* ユーザーは、Web インターフェースまたは API を介して、**ジョブテンプレート**に基づいてジョブを開始します。
* ジョブテンプレートには、**インベントリ**、**プロジェクト**（プレイブックを含む）、および**資格情報**への参照が含まれます。
* ジョブの開始時に、AWX/Tower バックエンドにジョブを実行するためのリクエストが送信されます。
3. **ジョブのキューイング**:
* **RabbitMQ** は、Web コンポーネントとタスクランナー間のメッセージングを処理します。ジョブが開始されると、RabbitMQ を使用してタスクエンジンにメッセージが送信されます。
* **Redis** はタスクキューのバックエンドとして機能し、実行待ちのジョブを管理します。
4.
### テスト用のAWXラボの作成

[**ドキュメントに従って**](https://github.com/ansible/awx/blob/devel/tools/docker-compose/README.md)、docker-composeを使用してAWXを実行することができます：

{% code overflow="wrap" %}
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### サポートされている役割

最も特権のある役割は**システム管理者**と呼ばれます。この役割を持つ人は**何でも変更できます**。

**ホワイトボックスセキュリティ**のレビューから、**システム監査役の役割**が必要です。これにより、**すべてのシステムデータを表示**することができますが、変更はできません。別のオプションとして、**組織監査役の役割**を取得することもできますが、前者の方が良いでしょう。

<details>

<summary>利用可能な役割の詳細な説明を表示するにはここを展開</summary>

1. **システム管理者**:
* これはシステム内の任意のリソースにアクセスして変更する権限を持つスーパーユーザーの役割です。
* 彼らはすべての組織、チーム、プロジェクト、在庫、ジョブテンプレートなどを管理できます。
2. **システム監査役**:
* この役割を持つユーザーはすべてのシステムデータを表示できますが、変更はできません。
* この役割はコンプライアンスと監視のために設計されています。
3. **組織の役割**:
* **管理者**: 組織のリソースを完全に制御できます。
* **監査役**: 組織のリソースに対して表示専用のアクセス権を持ちます。
* **メンバー**: 特定の権限を持たない組織の基本的なメンバーシップです。
* **実行**: 組織内でジョブテンプレートを実行できます。
* **読み取り**: 組織のリソースを表示できます。
4. **プロジェクトの役割**:
* **管理者**: プロジェクトを管理および変更できます。
* **使用**: ジョブテンプレートでプロジェクトを使用できます。
* **更新**: SCM（ソースコントロール）を使用してプロジェクトを更新できます。
5. **在庫の役割**:
* **管理者**: 在庫を管理および変更できます。
* **アドホック**: 在庫でアドホックコマンドを実行できます。
* **更新**: 在庫ソースを更新できます。
* **使用**: ジョブテンプレートで在庫を使用できます。
* **読み取り**: 表示専用アクセスです。
6. **ジョブテンプレートの役割**:
* **管理者**: ジョブテンプレートを管理および変更できます。
* **実行**: ジョブを実行できます。
* **読み取り**: 表示専用アクセスです。
7. **資格情報の役割**:
* **管理者**: 資格情報を管理および変更できます。
* **使用**: ジョブテンプレートや他の関連リソースで資格情報を使用できます。
* **読み取り**: 表示専用アクセスです。
8. **チームの役割**:
* **メンバー**: 特定の権限を持たないチームの一員です。
* **管理者**: チームのメンバーと関連するリソースを管理できます。
9. **ワークフローの役割**:
* **管理者**: ワークフローを管理および変更できます。
* **実行**: ワークフローを実行できます。
* **読み取り**: 表示専用アクセスです。

</details>

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もしもあなたの**会社をHackTricksで宣伝したい**場合や、**PEASSの最新バージョンにアクセスしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **HackTricks**と**HackTricks Cloud**のgithubリポジトリにPRを提出して、あなたのハッキングトリックを共有しましょう。

</details>
