# Ansible Tower / AWX / Automation Controller Sicherheit

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## Grundlegende Informationen

**Ansible Tower** oder seine Open-Source-Version [**AWX**](https://github.com/ansible/awx) ist auch als **Benutzeroberfl√§che, Dashboard und REST-API von Ansible** bekannt. Mit **rollenbasierter Zugriffskontrolle**, Jobplanung und grafischem Bestandsmanagement k√∂nnen Sie Ihre Ansible-Infrastruktur √ºber eine moderne Benutzeroberfl√§che verwalten. Towers REST-API und Befehlszeilenschnittstelle machen es einfach, sie in aktuelle Tools und Workflows zu integrieren.

**Automation Controller ist eine neuere** Version von Ansible Tower mit mehr Funktionen.

### Unterschiede

Laut [**diesem**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00) sind die Hauptunterschiede zwischen Ansible Tower und AWS der erhaltene Support und die zus√§tzlichen Funktionen von Ansible Tower wie rollenbasierte Zugriffskontrolle, Unterst√ºtzung f√ºr benutzerdefinierte APIs und benutzerdefinierte Workflows.

### Technologie-Stack

* **Webinterface**: Dies ist die grafische Benutzeroberfl√§che, √ºber die Benutzer Best√§nde, Anmeldeinformationen, Vorlagen und Jobs verwalten k√∂nnen. Es ist so konzipiert, dass es intuitiv ist und Visualisierungen bietet, um das Verst√§ndnis des Zustands und der Ergebnisse Ihrer Automatisierungsjobs zu erleichtern.
* **REST-API**: Alles, was Sie im Webinterface tun k√∂nnen, k√∂nnen Sie auch √ºber die REST-API tun. Dies bedeutet, dass Sie AWX/Tower mit anderen Systemen integrieren oder Aktionen skripten k√∂nnen, die Sie normalerweise in der Benutzeroberfl√§che ausf√ºhren w√ºrden.
* **Datenbank**: AWX/Tower verwendet eine Datenbank (typischerweise PostgreSQL), um die Konfiguration, Jobergebnisse und andere erforderliche Betriebsdaten zu speichern.
* **RabbitMQ**: Dies ist das Nachrichtensystem, das von AWX/Tower verwendet wird, um zwischen den verschiedenen Komponenten zu kommunizieren, insbesondere zwischen dem Webdienst und den Task-Runnern.
* **Redis**: Redis dient als Cache und Backend f√ºr die Task-Warteschlange.

### Logische Komponenten

* **Best√§nde**: Ein Bestand ist eine **Sammlung von Hosts (oder Knoten)**, gegen die **Jobs** (Ansible-Playbooks) ausgef√ºhrt werden k√∂nnen. AWX/Tower erm√∂glicht es Ihnen, Ihre Best√§nde zu definieren und zu gruppieren und unterst√ºtzt auch dynamische Best√§nde, die Hostlisten von anderen Systemen wie AWS, Azure usw. **abrufen k√∂nnen**.
* **Projekte**: Ein Projekt ist im Wesentlichen eine **Sammlung von Ansible-Playbooks**, die aus einem **Versionskontrollsystem** (wie Git) stammen, um die neuesten Playbooks bei Bedarf abzurufen.
* **Vorlagen**: Jobvorlagen definieren, **wie ein bestimmtes Playbook ausgef√ºhrt wird**, und geben die **Bestandsaufnahme**, **Anmeldeinformationen** und andere **Parameter** f√ºr den Job an.
* **Anmeldeinformationen**: AWX/Tower bietet eine sichere M√∂glichkeit, **Geheimnisse zu verwalten und zu speichern, wie SSH-Schl√ºssel, Passw√∂rter und API-Token**. Diese Anmeldeinformationen k√∂nnen mit Jobvorlagen verkn√ºpft werden, damit Playbooks den erforderlichen Zugriff haben, wenn sie ausgef√ºhrt werden.
* **Task-Engine**: Hier passiert die Magie. Die Task-Engine basiert auf Ansible und ist daf√ºr verantwortlich, **die Playbooks auszuf√ºhren**. Jobs werden an die Task-Engine √ºbergeben, die dann die Ansible-Playbooks gegen den festgelegten Bestand unter Verwendung der angegebenen Anmeldeinformationen ausf√ºhrt.
* **Scheduler und Callbacks**: Dies sind erweiterte Funktionen in AWX/Tower, die es erm√∂glichen, **Jobs zu planen**, um zu bestimmten Zeiten ausgef√ºhrt zu werden oder durch externe Ereignisse ausgel√∂st zu werden.
* **Benachrichtigungen**: AWX/Tower kann Benachrichtigungen basierend auf dem Erfolg oder dem Misserfolg von Jobs senden. Es unterst√ºtzt verschiedene Arten von Benachrichtigungen wie E-Mails, Slack-Nachrichten, Webhooks usw.
* **Ansible-Playbooks**: Ansible-Playbooks sind Konfigurations-, Bereitstellungs- und Orchestrierungstools. Sie beschreiben den gew√ºnschten Zustand von Systemen auf automatisierte, wiederholbare Weise. In YAML geschrieben, verwenden Playbooks Ansibles deklarative Automatisierungssprache, um Konfigurationen, Aufgaben und Schritte zu beschreiben, die ausgef√ºhrt werden m√ºssen.

### Job-Ausf√ºhrungsfluss

1. **Benutzerinteraktion**: Ein Benutzer kann mit AWX/Tower entweder √ºber das **Webinterface** oder die **REST-API** interagieren. Diese bieten einen Front-End-Zugriff auf alle von AWX/Tower angebotenen Funktionen.
2. **Job-Initiierung**:
* Der Benutzer initiiert √ºber das Webinterface oder die API einen Job basierend auf einer **Jobvorlage**.
* Die Jobvorlage enth√§lt Verweise auf den **Bestand**, das **Projekt** (das Playbook enth√§lt) und die **Anmeldeinformationen**.
* Bei der Job-Initiierung wird eine Anforderung an das AWX/Tower-Backend gesendet, um den Job zur Ausf√ºhrung in die Warteschlange zu stellen.
3. **Job-Warteschlange**:
* **RabbitMQ** behandelt die Kommunikation zwischen dem Webkomponenten und den Task-Runnern. Sobald ein Job initiiert wird, wird √ºber RabbitMQ eine Nachricht an die Task-Engine gesendet.
* **Redis** fungiert als Backend f√ºr die Task-Warteschlange und verwaltet wartende Jobs, die auf ihre Ausf√ºhrung warten.
4. **Job-Ausf√ºhrung**:
* Die **Task-Engine** nimmt den in die Warteschlange gestellten Job auf. Sie ruft die erforderlichen Informationen aus der **Datenbank** √ºber das mit dem Job verkn√ºpfte Playbook, den Bestand und die Anmeldeinformationen ab.
* Mit dem abgerufenen Ansible-Playbook aus dem zugeh√∂rigen **Projekt** f√ºhrt die Task-Engine das Playbook gegen die angegebenen **Bestandsknoten** unter Verwendung der bereitgestellten **Anmeldeinformationen** aus.
* W√§hrend das Playbook ausgef√ºhrt wird, werden dessen Ausf√ºhrungsergebnisse (Protokolle, Fakten usw.) erfasst und in der **Datenbank** gespeichert.
5. **Job-Ergebnisse**:
* Sobald das Playbook fertig ausgef√ºhrt ist, werden die Ergebnisse (Erfolg, Fehler, Protokolle) in der **Datenbank** gespeichert.
* Benutzer k√∂nnen die Ergebnisse dann √ºber das Webinterface anzeigen oder √ºber die REST-API abfragen.
* Basierend auf den Jobergebnissen k√∂nnen **Benachrichtigungen** versendet werden, um Benutzer oder externe Systeme √ºber den Status des Jobs zu informieren. Benachrichtigungen k√∂nnen E-Mails, Slack-Nachrichten, Webhooks usw. sein.
6. **Integration externer Systeme**:
* **Best√§nde** k√∂nnen dynamisch aus externen Systemen bezogen werden, sodass AWX/Tower Hosts aus Quellen wie AWS, Azure, VMware und mehr einbeziehen kann.
* **Projekte** (Playbooks) k√∂nnen aus Versionskontrollsystemen abgerufen werden, um die Verwendung aktueller Playbooks w√§hrend der Jobausf√ºhrung sicherzustellen.
* **Scheduler und Callbacks** k√∂nnen verwendet werden, um mit anderen Systemen oder Tools zu integrieren, sodass AWX/Tower auf externe Ausl√∂ser reagieren oder Jobs zu vorbestimmten Zeiten ausf√ºhren kann.

### AWX-Laborerstellung f√ºr Tests

[**Gem√§√ü der Dokumentation**](https://github.com/ansible/awx/blob/devel/tools/docker-compose/README.md) ist es m√∂glich, Docker-Compose zu verwenden, um AWX auszuf√ºhren:

{% code overflow="wrap" %}
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### Unterst√ºtzte Rollen

Die privilegierteste Rolle wird als **Systemadministrator** bezeichnet. Jeder mit dieser Rolle kann **alles √§ndern**.

Bei einer **White-Box-Sicherheits√ºberpr√ºfung** ben√∂tigen Sie die Rolle des **Systempr√ºfers**, die es erm√∂glicht, **alle Systemdaten anzuzeigen**, aber keine √Ñnderungen vornehmen kann. Eine andere Option w√§re die Rolle des **Organisationspr√ºfers**, aber es w√§re besser, die andere zu w√§hlen.

<details>

<summary>Hier klicken, um eine detaillierte Beschreibung der verf√ºgbaren Rollen zu erhalten</summary>

1. **Systemadministrator**:
* Dies ist die Superuser-Rolle mit Berechtigungen zum Zugriff und zur √Ñnderung aller Ressourcen im System.
* Sie k√∂nnen alle Organisationen, Teams, Projekte, Bestandslisten, Jobvorlagen usw. verwalten.
2. **Systempr√ºfer**:
* Benutzer mit dieser Rolle k√∂nnen alle Systemdaten anzeigen, aber keine √Ñnderungen vornehmen.
* Diese Rolle ist f√ºr Compliance und √úberwachung vorgesehen.
3. **Organisationsrollen**:
* **Admin**: Vollst√§ndige Kontrolle √ºber die Ressourcen der Organisation.
* **Pr√ºfer**: Nur-Lese-Zugriff auf die Ressourcen der Organisation.
* **Mitglied**: Grundlegende Mitgliedschaft in einer Organisation ohne spezifische Berechtigungen.
* **Ausf√ºhren**: Kann Jobvorlagen innerhalb der Organisation ausf√ºhren.
* **Lesen**: Kann die Ressourcen der Organisation anzeigen.
4. **Projektrollen**:
* **Admin**: Kann das Projekt verwalten und √§ndern.
* **Verwenden**: Kann das Projekt in einer Jobvorlage verwenden.
* **Aktualisieren**: Kann das Projekt unter Verwendung von SCM (Source Control) aktualisieren.
5. **Bestandslistenrollen**:
* **Admin**: Kann den Bestand verwalten und √§ndern.
* **Ad-hoc**: Kann Ad-hoc-Befehle auf dem Bestand ausf√ºhren.
* **Aktualisieren**: Kann die Bestandsquelle aktualisieren.
* **Verwenden**: Kann den Bestand in einer Jobvorlage verwenden.
* **Lesen**: Nur-Lese-Zugriff.
6. **Jobvorlagenrollen**:
* **Admin**: Kann die Jobvorlage verwalten und √§ndern.
* **Ausf√ºhren**: Kann den Job ausf√ºhren.
* **Lesen**: Nur-Lese-Zugriff.
7. **Anmeldeinformationsrollen**:
* **Admin**: Kann die Anmeldeinformationen verwalten und √§ndern.
* **Verwenden**: Kann die Anmeldeinformationen in Jobvorlagen oder anderen relevanten Ressourcen verwenden.
* **Lesen**: Nur-Lese-Zugriff.
8. **Teamrollen**:
* **Mitglied**: Teil des Teams, aber ohne spezifische Berechtigungen.
* **Admin**: Kann die Mitglieder des Teams und zugeh√∂rige Ressourcen verwalten.
9. **Workflow-Rollen**:
* **Admin**: Kann den Workflow verwalten und √§ndern.
* **Ausf√ºhren**: Kann den Workflow ausf√ºhren.
* **Lesen**: Nur-Lese-Zugriff.

</details>
