# Bezbednost Ansible Tower / AWX / Automation kontrolera

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** me na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

**Ansible Tower** ili njegova open source verzija [**AWX**](https://github.com/ansible/awx) je takođe poznata kao **Ansible-ov korisnički interfejs, kontrolna tabla i REST API**. Sa **kontrolom pristupa zasnovanom na ulogama**, planiranjem poslova i grafičkim upravljanjem inventarom, možete upravljati svojom Ansible infrastrukturom putem modernog korisničkog interfejsa. REST API i komandna linija Tower-a omogućavaju jednostavnu integraciju u postojeće alate i radne tokove.

**Automation Controller je novija** verzija Ansible Tower-a sa više mogućnosti.

### Razlike

Prema [**ovome**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00), glavne razlike između Ansible Tower-a i AWS-a su podrška koju dobijaju i Ansible Tower ima dodatne funkcionalnosti kao što su kontrola pristupa zasnovana na ulogama, podrška za prilagođene API-je i korisnički definisani radni tokovi.

### Tehnički skup

* **Veb interfejs**: Ovo je grafički interfejs gde korisnici mogu upravljati inventarima, akreditivima, šablonima i poslovima. Dizajniran je da bude intuitivan i pruža vizualizacije koje pomažu u razumevanju stanja i rezultata vaših automatizovanih poslova.
* **REST API**: Sve što možete uraditi u veb interfejsu, možete uraditi i putem REST API-ja. To znači da možete integrisati AWX/Tower sa drugim sistemima ili skriptovati akcije koje obično izvršavate u interfejsu.
* **Baza podataka**: AWX/Tower koristi bazu podataka (obično PostgreSQL) za skladištenje konfiguracije, rezultata poslova i ostalih neophodnih operativnih podataka.
* **RabbitMQ**: Ovo je sistem za razmenu poruka koji koristi AWX/Tower za komunikaciju između različitih komponenti, posebno između veb servisa i izvršilaca zadataka.
* **Redis**: Redis služi kao keš i pozadina za red zadataka.

### Logičke komponente

* **Inventari**: Inventar je **kolekcija čvorova (ili čvorova)** protiv kojih se mogu **pokrenuti poslovi** (Ansible playbook-ovi). AWX/Tower vam omogućava da definišete i grupišete inventare, a takođe podržava dinamičke inventare koji mogu **dobavljati liste čvorova iz drugih sistema** kao što su AWS, Azure, itd.
* **Projekti**: Projekat je suštinski **kolekcija Ansible playbook-ova** izvorno iz **sistema za kontrolu verzija** (kao što je Git) kako bi se povukli najnoviji playbook-ovi kada je to potrebno.
* **Šabloni**: Šabloni poslova definišu **kako će se određeni playbook pokrenuti**, navodeći **inventar**, **akreditive** i druge **parametre** za posao.
* **Akreditivi**: AWX/Tower pruža siguran način za **upravljanje i čuvanje tajni, kao što su SSH ključevi, lozinke i API tokeni**. Ovi akreditivi mogu biti povezani sa šablonima poslova kako bi playbook-ovi imali neophodan pristup prilikom izvršavanja.
* **Task Engine**: Ovde se dešava magija. Task engine je izgrađen na Ansible-u i odgovoran je za **pokretanje playbook-ova**. Poslovi se šalju task engine-u, koji zatim pokreće Ansible playbook-ove protiv određenog inventara koristeći navedene akreditive.
* **Planeri i povratni pozivi**: Ovo su napredne funkcionalnosti u AWX/Tower-u koje omogućavaju **planiranje poslova** za pokretanje u određeno vreme ili pokretanje spoljašnjim događajima.
* **Obaveštenja**: AWX/Tower može slati obaveštenja na osnovu uspeha ili neuspeha poslova. Podržava različite načine obaveštavanja kao što su e-pošta, Slack poruke, webhooks, itd.
* **Ansible playbook-ovi**: Ansible playbook-ovi su alati za konfiguraciju, implementaciju i orkestraciju. Oni opisuju željeno stanje sistema na automatizovan, ponovljiv način. Napisani u YAML-u, playbook-ovi koriste Ansible-ov deklarativni jezik automatizacije za opisivanje konfiguracija, zadataka i koraka koji treba da se izvrše.

### Tok izvršavanja posla

1. **Interakcija korisnika**: Korisnik može da interaguje sa AWX/Tower-om putem **veb interfejsa** ili **REST API-ja**. Oni omogućavaju pristup svim funkcionalnostima koje nudi AWX/Tower.
2. **Pokretanje posla**:
* Korisnik, putem veb interfejsa ili API-ja, pokreće posao na osnovu **šablona posla**.
* Šablon posla uključuje reference na **inventar**, **projekat** (koji sadrži playbook) i **akreditive**.
* Prilikom pokretanja posla, zahtev se šalje AWX/Tower backend-u da bi se posao stavio u red za izvršavanje.
3. **Stavljanje posla u red**:
* **RabbitMQ** upravlja razmenom poruka između veb komponente i izvršilaca zadataka. Kada se posao pokrene, poruka se šalje task engine-u koristeći RabbitMQ.
* **Redis** služi kao pozadina za red zadataka, upravljajući poslovima koji čekaju izvršavanje.
4. **Izvršavanje posla**:
* **Task Engine** preuzima posao iz reda. On dobavlja neophodne informacije iz **baze podataka** o povezanom playbook-u, inventaru i akreditivima posla.
* Koristeći dobijeni Ansible playbook iz povezanog **projekta**, Task Engine pokreće playbook protiv određenih čvorova **inventara** koristeći pružene **akreditive**.
* Dok playbook radi, njegov izlaz izvršavanja (logovi, činjenice, itd.) se beleže i čuvaju u **bazi podataka**.
5. **Rezultati posla**:
* Kada playbook završi sa izvršavanjem, rezultati (uspeh, neuspeh, logovi) se čuvaju u **bazi podataka**.
* Korisnici mogu zatim pregledati rezultate putem veb interfejsa ili ih pretraživati putem REST API-ja.
* Na osnovu rezultata posla, mogu se slati **obaveštenja** koja informišu kor
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### Podržane uloge

Najprivilegovanija uloga se naziva **Sistemski administrator**. Svi sa ovom ulogom mogu **izmeniti bilo šta**.

Iz perspektive **bele kutije bezbednosti**, trebali biste imati ulogu **Sistemskog revizora**, koja omogućava **pregled svih podataka sistema**, ali ne može vršiti nikakve promene. Druga opcija bila bi uloga **Revizora organizacije**, ali bilo bi bolje dobiti prvu.

<details>

<summary>Proširite ovo da biste dobili detaljan opis dostupnih uloga</summary>

1. **Sistemski administrator**:
* Ovo je superkorisnička uloga sa dozvolama za pristup i izmenu svih resursa u sistemu.
* Mogu upravljati svim organizacijama, timovima, projektima, inventarima, šablonima poslova, itd.
2. **Sistemski revizor**:
* Korisnici sa ovom ulogom mogu pregledati sve podatke sistema, ali ne mogu vršiti nikakve promene.
* Ova uloga je dizajnirana za usklađenost i nadzor.
3. **Uloge organizacije**:
* **Admin**: Potpuna kontrola nad resursima organizacije.
* **Revizor**: Samo pregled pristupa resursima organizacije.
* **Član**: Osnovno članstvo u organizaciji bez posebnih dozvola.
* **Izvrši**: Može pokretati šablone poslova unutar organizacije.
* **Pročitaj**: Može pregledati resurse organizacije.
4. **Uloge projekta**:
* **Admin**: Može upravljati i izmeniti projekat.
* **Koristi**: Može koristiti projekat u šablonu posla.
* **Ažuriraj**: Može ažurirati projekat koristeći SCM (izvor kontrola).
5. **Uloge inventara**:
* **Admin**: Može upravljati i izmeniti inventar.
* **Ad Hoc**: Može pokretati ad hoc komande na inventaru.
* **Ažuriraj**: Može ažurirati izvor inventara.
* **Koristi**: Može koristiti inventar u šablonu posla.
* **Pročitaj**: Samo pregled pristupa.
6. **Uloge šablona posla**:
* **Admin**: Može upravljati i izmeniti šablon posla.
* **Izvrši**: Može pokrenuti posao.
* **Pročitaj**: Samo pregled pristupa.
7. **Uloge akreditacija**:
* **Admin**: Može upravljati i izmeniti akreditacije.
* **Koristi**: Može koristiti akreditacije u šablonima poslova ili drugim relevantnim resursima.
* **Pročitaj**: Samo pregled pristupa.
8. **Uloge tima**:
* **Član**: Deo tima, ali bez posebnih dozvola.
* **Admin**: Može upravljati članovima tima i povezanim resursima.
9. **Uloge radnog toka**:
* **Admin**: Može upravljati i izmeniti radni tok.
* **Izvrši**: Može pokrenuti radni tok.
* **Pročitaj**: Samo pregled pristupa.

</details>

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite videti **oglašavanje vaše kompanije na HackTricks-u** ili **preuzeti HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
