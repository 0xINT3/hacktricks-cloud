# Ansible Tower / AWX / 자동화 컨트롤러 보안

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>

## 기본 정보

**Ansible Tower** 또는 그 오픈소스 버전인 [**AWX**](https://github.com/ansible/awx)는 **Ansible의 사용자 인터페이스, 대시보드 및 REST API**로 알려져 있습니다. **역할 기반의 액세스 제어**, 작업 스케줄링 및 그래픽 인벤토리 관리를 통해 Ansible 인프라를 현대적인 UI에서 관리할 수 있습니다. Tower의 REST API 및 명령줄 인터페이스를 사용하면 현재 도구 및 워크플로에 쉽게 통합할 수 있습니다.

**자동화 컨트롤러**는 더 많은 기능을 갖춘 Ansible Tower의 최신 버전입니다.

### 차이점

[**이**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00)에 따르면, Ansible Tower와 AWS의 주요 차이점은 지원을 받는 것과 Ansible Tower가 역할 기반의 액세스 제어, 사용자 정의 API 지원 및 사용자 정의 워크플로우와 같은 추가 기능을 갖추고 있다는 것입니다.

### 기술 스택

* **웹 인터페이스**: 사용자가 인벤토리, 자격 증명, 템플릿 및 작업을 관리할 수 있는 그래픽 인터페이스입니다. 직관적으로 설계되어 자동화 작업의 상태와 결과를 이해하는 데 도움이 되는 시각화를 제공합니다.
* **REST API**: 웹 인터페이스에서 수행할 수 있는 모든 작업은 REST API를 통해 수행할 수도 있습니다. 이는 AWX/Tower를 다른 시스템과 통합하거나 일반적으로 인터페이스에서 수행하는 작업을 스크립트화할 수 있음을 의미합니다.
* **데이터베이스**: AWX/Tower는 구성, 작업 결과 및 기타 필요한 운영 데이터를 저장하기 위해 데이터베이스(일반적으로 PostgreSQL)를 사용합니다.
* **RabbitMQ**: AWX/Tower가 웹 서비스와 작업 실행자 간에 통신하는 데 사용하는 메시징 시스템입니다.
* **Redis**: Redis는 캐시 및 작업 대기열의 백엔드로 사용됩니다.

### 논리적 구성 요소

* **인벤토리**: 인벤토리는 **호스트(또는 노드)의 모음**으로, **작업**(Ansible 플레이북)을 **실행**할 수 있습니다. AWX/Tower를 사용하면 인벤토리를 정의하고 그룹화할 수 있으며, AWS, Azure 등과 같은 다른 시스템에서 호스트 목록을 가져올 수 있는 동적 인벤토리도 지원합니다.
* **프로젝트**: 프로젝트는 필요할 때 최신 플레이북을 가져오기 위해 **버전 관리 시스템**(예: Git)에서 가져온 **Ansible 플레이북의 모음**입니다.
* **템플릿**: 작업 템플릿은 특정 플레이북이 어떻게 실행될지를 정의하며, 작업에 대한 **인벤토리**, **자격 증명** 및 기타 **매개 변수**를 지정합니다.
* **자격 증명**: AWX/Tower는 SSH 키, 비밀번호, API 토큰과 같은 비밀을 **안전하게 관리하고 저장**할 수 있는 방법을 제공합니다. 이러한 자격 증명은 작업 템플릿과 연결할 수 있으므로 플레이북이 실행될 때 필요한 액세스 권한을 갖게 됩니다.
* **작업 엔진**: 이곳에서 마법이 일어납니다. 작업 엔진은 Ansible을 기반으로 구축되며, 지정된 인벤토리와 지정된 자격 증명을 사용하여 플레이북을 실행합니다. 작업은 작업 엔진에게 전달되고, 작업 엔진은 지정된 인벤토리를 사용하여 Ansible 플레이북을 실행합니다.
* **스케줄러 및 콜백**: 이는 AWX/Tower의 고급 기능으로, 작업을 특정 시간에 예약하거나 외부 이벤트에 의해 트리거할 수 있습니다.
* **알림**: AWX/Tower는 작업의 성공 또는 실패에 따라 알림을 보낼 수 있습니다. 이메일, Slack 메시지, 웹훅 등 다양한 수단의 알림을 지원합니다.
* **Ansible 플레이북**: Ansible 플레이북은 구성, 배포 및 오케스트레이션 도구입니다. 자동화된 반복 가능한 방식으로 시스템의 원하는 상태를 설명합니다. YAML로 작성된 플레이북은 Ansible의 선언적 자동화 언어를 사용하여 구성, 작업 및 실행해야 할 단계를 설명합니다.

### 작업 실행 흐름

1. **사용자 상호 작용**: 사용자는 AWX/Tower와 **웹 인터페이스** 또는 **REST API**를 통해 상호 작용할 수 있습니다. 이를 통해 AWX/Tower가 제공하는 모든 기능에 대한 프론트엔드 액세스가 가능합니다.
2. **작업 시작**:
* 사용자는 웹 인터페이스 또는 API를 통해 **작업 템플릿**을 기반으로 작업을 시작합니다.
* 작업 템플릿에는 **인벤토리**, **프로젝트**(플레이북이 포함된) 및 **자격 증명**에 대한 참조가 포함됩니다.
* 작업 시작 시, 작업을 실행하기 위해 AWX/Tower 백엔드로 요청이 전송됩니다.
3. **작업 대기열**:
* **RabbitMQ**는 웹 구성 요소와 작업 실행자 간의 메시징을 처리합니다. 작업이 시작되면 RabbitMQ를 사용하여 작업 엔진으로 메시지가 전송됩니다.
* **Redis**는 작업 대기열의 백엔드로 작동하여 실행 대기 중인 작업을 관리합니다.
4. **작업 실행**:
* **작업 엔진**은 대기 중인 작업을
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### 지원되는 역할

가장 권한이 있는 역할은 **시스템 관리자(System Administrator)**입니다. 이 역할을 가진 사람은 **모든 것을 수정**할 수 있습니다.

**화이트 박스 보안** 검토에서는 **시스템 감사자(System Auditor) 역할**이 필요합니다. 이 역할은 **시스템 데이터를 모두 볼 수는 있지만 변경할 수는 없습니다**. 다른 옵션으로는 **조직 감사자(Organization Auditor) 역할**을 얻을 수도 있지만, 앞선 역할을 얻는 것이 좋습니다.

<details>

<summary>자세한 역할 설명을 보려면 여기를 펼쳐주세요</summary>

1. **시스템 관리자(System Administrator)**:
* 이 역할은 시스템의 모든 리소스에 대한 액세스 및 수정 권한을 가진 슈퍼유저 역할입니다.
* 모든 조직, 팀, 프로젝트, 인벤토리, 작업 템플릿 등을 관리할 수 있습니다.
2. **시스템 감사자(System Auditor)**:
* 이 역할을 가진 사용자는 모든 시스템 데이터를 볼 수 있지만 변경할 수는 없습니다.
* 이 역할은 규정 준수 및 감사를 위해 설계되었습니다.
3. **조직 역할(Organization Roles)**:
* **관리자(Admin)**: 조직의 리소스에 대한 완전한 제어 권한을 가집니다.
* **감사자(Auditor)**: 조직의 리소스에 대한 읽기 전용 액세스 권한을 가집니다.
* **멤버(Member)**: 특정 권한이 없는 조직의 기본 멤버십을 가집니다.
* **실행(Execute)**: 조직 내에서 작업 템플릿을 실행할 수 있습니다.
* **읽기(Read)**: 조직의 리소스를 볼 수 있습니다.
4. **프로젝트 역할(Project Roles)**:
* **관리자(Admin)**: 프로젝트를 관리하고 수정할 수 있습니다.
* **사용(Use)**: 작업 템플릿에서 프로젝트를 사용할 수 있습니다.
* **업데이트(Update)**: 소스 컨트롤을 사용하여 프로젝트를 업데이트할 수 있습니다.
5. **인벤토리 역할(Inventory Roles)**:
* **관리자(Admin)**: 인벤토리를 관리하고 수정할 수 있습니다.
* **Ad Hoc**: 인벤토리에서 Ad Hoc 명령을 실행할 수 있습니다.
* **업데이트(Update)**: 인벤토리 소스를 업데이트할 수 있습니다.
* **사용(Use)**: 작업 템플릿에서 인벤토리를 사용할 수 있습니다.
* **읽기(Read)**: 읽기 전용 액세스입니다.
6. **작업 템플릿 역할(Job Template Roles)**:
* **관리자(Admin)**: 작업 템플릿을 관리하고 수정할 수 있습니다.
* **실행(Execute)**: 작업을 실행할 수 있습니다.
* **읽기(Read)**: 읽기 전용 액세스입니다.
7. **자격 증명 역할(Credential Roles)**:
* **관리자(Admin)**: 자격 증명을 관리하고 수정할 수 있습니다.
* **사용(Use)**: 작업 템플릿이나 다른 관련 리소스에서 자격 증명을 사용할 수 있습니다.
* **읽기(Read)**: 읽기 전용 액세스입니다.
8. **팀 역할(Team Roles)**:
* **멤버(Member)**: 특정 권한이 없는 팀의 일원입니다.
* **관리자(Admin)**: 팀의 구성원과 관련 리소스를 관리할 수 있습니다.
9. **워크플로우 역할(Workflow Roles)**:
* **관리자(Admin)**: 워크플로우를 관리하고 수정할 수 있습니다.
* **실행(Execute)**: 워크플로우를 실행할 수 있습니다.
* **읽기(Read)**: 읽기 전용 액세스입니다.

</details>

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 제로에서 영웅까지 AWS 해킹을 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왑**](https://peass.creator-spring.com)을 구매하세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 **자신의 해킹 기법을 공유**하세요.

</details>
