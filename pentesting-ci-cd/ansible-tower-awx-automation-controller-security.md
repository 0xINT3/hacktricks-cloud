# Sicurezza di Ansible Tower / AWX / Automation controller

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di github.

</details>

## Informazioni di base

**Ansible Tower** o la sua versione open source [**AWX**](https://github.com/ansible/awx) √® anche conosciuto come **interfaccia utente di Ansible, dashboard e REST API**. Con il controllo degli accessi basato sui ruoli, la pianificazione dei lavori e la gestione grafica dell'inventario, √® possibile gestire l'infrastruttura di Ansible da un'interfaccia utente moderna. L'API REST e l'interfaccia a riga di comando di Tower semplificano l'integrazione con gli strumenti e i flussi di lavoro attuali.

**Automation Controller √® una versione pi√π recente** di Ansible Tower con funzionalit√† aggiuntive.

### Differenze

Secondo [**questo**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00), le principali differenze tra Ansible Tower e AWS sono il supporto ricevuto e il fatto che Ansible Tower ha funzionalit√† aggiuntive come il controllo degli accessi basato sui ruoli, il supporto per API personalizzate e i flussi di lavoro definiti dall'utente.

### Stack tecnologico

* **Interfaccia Web**: questa √® l'interfaccia grafica in cui gli utenti possono gestire inventari, credenziali, modelli e lavori. √à progettata per essere intuitiva e fornisce visualizzazioni per aiutare a comprendere lo stato e i risultati dei lavori di automazione.
* **API REST**: tutto ci√≤ che √® possibile fare nell'interfaccia web, √® possibile farlo anche tramite l'API REST. Ci√≤ significa che √® possibile integrare AWX/Tower con altri sistemi o eseguire azioni di script che normalmente si eseguirebbero nell'interfaccia.
* **Database**: AWX/Tower utilizza un database (tipicamente PostgreSQL) per archiviare la configurazione, i risultati dei lavori e altri dati operativi necessari.
* **RabbitMQ**: questo √® il sistema di messaggistica utilizzato da AWX/Tower per comunicare tra i diversi componenti, in particolare tra il servizio web e i task runner.
* **Redis**: Redis funge da cache e backend per la coda dei task.

### Componenti logici

* **Inventari**: un inventario √® una **raccolta di host (o nodi)** su cui possono essere eseguiti **lavori** (playbook di Ansible). AWX/Tower consente di definire e raggruppare gli inventari e supporta anche inventari dinamici che possono **recuperare elenchi di host da altri sistemi** come AWS, Azure, ecc.
* **Progetti**: un progetto √® essenzialmente una **raccolta di playbook di Ansible** provenienti da un **sistema di controllo delle versioni** (come Git) per estrarre i playbook pi√π recenti quando necessario.
* **Modelli**: i modelli di lavoro definiscono **come verr√† eseguito un determinato playbook**, specificando l'**inventario**, le **credenziali** e altri **parametri** per il lavoro.
* **Credenziali**: AWX/Tower fornisce un modo sicuro per **gestire e archiviare segreti, come chiavi SSH, password e token API**. Queste credenziali possono essere associate ai modelli di lavoro in modo che i playbook abbiano l'accesso necessario quando vengono eseguiti.
* **Motore di esecuzione dei task**: qui avviene la magia. Il motore dei task √® basato su Ansible ed √® responsabile dell'**esecuzione dei playbook**. I lavori vengono inviati al motore dei task, che quindi esegue i playbook di Ansible sull'inventario designato utilizzando le credenziali specificate.
* **Pianificatori e Callback**: queste sono funzionalit√† avanzate in AWX/Tower che consentono di **pianificare l'esecuzione dei lavori** in determinati momenti o di attivarli mediante eventi esterni.
* **Notifiche**: AWX/Tower pu√≤ inviare notifiche in base al successo o al fallimento dei lavori. Supporta vari mezzi di notifica come email, messaggi Slack, webhook, ecc.
* **Playbook di Ansible**: i playbook di Ansible sono strumenti di configurazione, distribuzione e orchestrazione. Descrivono lo stato desiderato dei sistemi in modo automatizzato e ripetibile. Scritti in YAML, i playbook utilizzano il linguaggio di automazione dichiarativo di Ansible per descrivere configurazioni, attivit√† e passaggi che devono essere eseguiti.

### Flusso di esecuzione dei lavori

1. **Interazione dell'utente**: un utente pu√≤ interagire con AWX/Tower tramite l'**interfaccia web** o l'**API REST**. Questi forniscono l'accesso front-end a tutte le funzionalit√† offerte da AWX/Tower.
2. **Avvio del lavoro**:
* L'utente, tramite l'interfaccia web o l'API, avvia un lavoro basato su un **Modello di lavoro**.
* Il Modello di lavoro include riferimenti all'**Inventario**, al **Progetto** (contenente il playbook) e alle **Credenziali**.
* All'avvio del lavoro, viene inviata una richiesta al backend di AWX/Tower per accodare il lavoro per l'esecuzione.
3. **Accodamento del lavoro**:
* **RabbitMQ** gestisce la messaggistica tra il componente web e i task runner. Una volta avviato un lavoro, viene inviato un messaggio al motore dei task tramite RabbitMQ.
* **Redis** funge da backend per la coda dei task, gestendo i lavori in coda in attesa di esecuzione.
4. **Esecuzione del lavoro**:
* Il **Motore dei task** prende il lavoro in coda. Recupera le informazioni necessarie dal **Database** sul playbook, l'inventario e le credenziali associate al lavoro.
* Utilizzando il playbook di Ansible recuperato dal **Progetto** associato, il Motore dei task esegue il playbook sui nodi specificati dell'**Inventario** utilizzando le **Credenziali** fornite.
* Durante l'esecuzione del playbook, il suo output di esecuzione (log, fatti, ecc.) viene catturato e archiviato nel **Database**.
5. **Risultati del lavoro**:
* Una volta terminata l'esecuzione del playbook, i risultati (successo, fallimento, log) vengono salvati nel **Database**.
* Gli utenti possono quindi visualizzare i risultati tramite l'interfaccia web o interrogarli tramite l'API REST.
* In base all'esito del lavoro, possono essere inviate **Notifiche** per informare gli utenti o i sistemi esterni dello stato del lavoro. Le notifiche possono essere email, messaggi Slack, webhook, ecc.
6. **Integrazione con sistemi esterni**:
* Gli **Inventari** possono essere recuperati dinamicamente da sistemi esterni, consentendo ad AWX/Tower di importare host da fonti come AWS, Azure, VMware e altro.
* I **Progetti** (playbook) possono essere recuperati dai sistemi di controllo delle versioni, garantendo l'utilizzo di playbook aggiornati durante l'esecuzione dei lavori.
* I **Pianificatori e Callback** possono essere utilizzati per integrarsi con altri sistemi o strumenti, consentendo ad AWX/Tower di reagire a trigger esterni o eseguire lavori in tempi prestabiliti.

### Creazione di un laboratorio AWX per scopi di test

[**Seguendo la documentazione**](https://github.com/ansible/awx/blob/devel/tools/docker-compose/README.md) √® possibile utilizzare docker-compose per eseguire AWX:

{% code overflow="wrap" %}
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### Ruoli supportati

Il ruolo pi√π privilegiato √® chiamato **Amministratore di sistema**. Chiunque con questo ruolo pu√≤ **modificare qualsiasi cosa**.

Da una revisione di sicurezza **white box**, avresti bisogno del ruolo di **Auditor di sistema**, che consente di **visualizzare tutti i dati di sistema** ma non pu√≤ apportare modifiche. Un'altra opzione sarebbe ottenere il ruolo di **Auditor dell'organizzazione**, ma sarebbe meglio ottenere l'altro.

<details>

<summary>Espandi per ottenere una descrizione dettagliata dei ruoli disponibili</summary>

1. **Amministratore di sistema**:
* Questo √® il ruolo di superutente con le autorizzazioni per accedere e modificare qualsiasi risorsa nel sistema.
* Possono gestire tutte le organizzazioni, i team, i progetti, gli inventari, i modelli di lavoro, ecc.
2. **Auditor di sistema**:
* Gli utenti con questo ruolo possono visualizzare tutti i dati di sistema ma non possono apportare modifiche.
* Questo ruolo √® progettato per la conformit√† e la supervisione.
3. **Ruoli dell'organizzazione**:
* **Admin**: Controllo completo sulle risorse dell'organizzazione.
* **Auditor**: Accesso in sola lettura alle risorse dell'organizzazione.
* **Membro**: Appartenenza di base a un'organizzazione senza autorizzazioni specifiche.
* **Esecuzione**: Pu√≤ eseguire modelli di lavoro all'interno dell'organizzazione.
* **Lettura**: Pu√≤ visualizzare le risorse dell'organizzazione.
4. **Ruoli del progetto**:
* **Admin**: Pu√≤ gestire e modificare il progetto.
* **Utilizzo**: Pu√≤ utilizzare il progetto in un modello di lavoro.
* **Aggiornamento**: Pu√≤ aggiornare il progetto utilizzando il controllo di origine (source control).
5. **Ruoli dell'inventario**:
* **Admin**: Pu√≤ gestire e modificare l'inventario.
* **Ad Hoc**: Pu√≤ eseguire comandi ad hoc sull'inventario.
* **Aggiornamento**: Pu√≤ aggiornare la fonte dell'inventario.
* **Utilizzo**: Pu√≤ utilizzare l'inventario in un modello di lavoro.
* **Lettura**: Accesso in sola lettura.
6. **Ruoli del modello di lavoro**:
* **Admin**: Pu√≤ gestire e modificare il modello di lavoro.
* **Esecuzione**: Pu√≤ eseguire il lavoro.
* **Lettura**: Accesso in sola lettura.
7. **Ruoli delle credenziali**:
* **Admin**: Pu√≤ gestire e modificare le credenziali.
* **Utilizzo**: Pu√≤ utilizzare le credenziali nei modelli di lavoro o in altre risorse pertinenti.
* **Lettura**: Accesso in sola lettura.
8. **Ruoli del team**:
* **Membro**: Parte del team ma senza autorizzazioni specifiche.
* **Admin**: Pu√≤ gestire i membri del team e le risorse associate.
9. **Ruoli del flusso di lavoro**:
* **Admin**: Pu√≤ gestire e modificare il flusso di lavoro.
* **Esecuzione**: Pu√≤ eseguire il flusso di lavoro.
* **Lettura**: Accesso in sola lettura.

</details>

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
