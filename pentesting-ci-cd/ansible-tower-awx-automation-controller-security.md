# Ansible Tower / AWX / Otomasyon Denetleyici Güvenliği

<details>

<summary><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimizden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı takip edin.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## Temel Bilgiler

**Ansible Tower** veya açık kaynak versiyonu olan [**AWX**](https://github.com/ansible/awx), aynı zamanda **Ansible'ın kullanıcı arayüzü, gösterge tablosu ve REST API'si** olarak da bilinir. **Rol tabanlı erişim kontrolü**, iş zamanlaması ve grafik tabanlı envanter yönetimi ile Ansible altyapınızı modern bir kullanıcı arayüzünden yönetebilirsiniz. Tower'ın REST API'si ve komut satırı arayüzü, mevcut araçlar ve iş akışlarına kolayca entegre etmenizi sağlar.

**Otomasyon Denetleyici**, daha fazla yeteneğe sahip olan Ansible Tower'ın daha yeni bir sürümüdür.

### Farklılıklar

[**Bu**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00) kaynağa göre, Ansible Tower ile AWS arasındaki temel farklar, aldığı destek ve Ansible Tower'ın rol tabanlı erişim kontrolü, özel API'lar için destek ve kullanıcı tanımlı iş akışları gibi ek özelliklere sahip olmasıdır.

### Teknoloji Yığını

* **Web Arayüzü**: Bu, kullanıcıların envanterleri, kimlik bilgilerini, şablonları ve işleri yönetebileceği grafik arayüzdür. Kullanımı kolay olacak şekilde tasarlanmıştır ve otomasyon işlerinin durumunu ve sonuçlarını anlamaya yardımcı olacak görselleştirmeler sunar.
* **REST API**: Web arayüzünde yapabileceğiniz her şeyi REST API üzerinden de yapabilirsiniz. Bu, AWX/Tower'ı diğer sistemlerle entegre etmenizi veya genellikle arayüzde gerçekleştireceğiniz eylemleri betiklemeyi sağlar.
* **Veritabanı**: AWX/Tower, yapılandırmasını, iş sonuçlarını ve diğer gerekli işletme verilerini depolamak için bir veritabanı (genellikle PostgreSQL) kullanır.
* **RabbitMQ**: AWX/Tower'ın farklı bileşenler arasında iletişim kurmak için kullandığı mesajlaşma sistemidir, özellikle web hizmeti ile görev çalıştırıcıları arasında.
* **Redis**: Redis, bir önbellek ve görev kuyruğu için bir arka uç olarak hizmet verir.

### Mantıksal Bileşenler

* **Envanterler**: Bir envanter, **işlerin** (Ansible playbook'ları) **çalıştırılabileceği ana bilgisayarların (veya düğümlerin)** bir **koleksiyonudur**. AWX/Tower, envanterlerinizi tanımlamanıza ve gruplandırmanıza olanak tanır ve AWS, Azure vb. gibi diğer sistemlerden ana bilgisayar listelerini **alabilen dinamik envanterleri** destekler.
* **Projeler**: Bir proje, ihtiyaç duyulduğunda en son playbook'ları çekmek için bir **sürüm kontrol sistemi**nden (Git gibi) alınan Ansible playbook'larının bir **koleksiyonu**dur.
* **Şablonlar**: İş şablonları, belirli bir playbook'un nasıl çalıştırılacağını belirler ve iş için envanter, kimlik bilgileri ve diğer parametreleri belirtir.
* **Kimlik Bilgileri**: AWX/Tower, SSH anahtarları, şifreler ve API belirteçleri gibi sırları **güvenli bir şekilde yönetmek ve depolamak** için bir yöntem sağlar. Bu kimlik bilgileri, playbook'ların çalıştırıldığında gerekli erişimi sağlamak için iş şablonlarıyla ilişkilendirilebilir.
* **Görev Motoru**: İşte sihir burada gerçekleşir. Görev motoru, Ansible üzerine kurulmuştur ve playbook'ları **çalıştırmaktan sorumludur**. İşler, görev motoruna gönderilir, ardından belirtilen kimlik bilgilerini kullanarak belirtilen envanter üzerindeki Ansible playbook'larını çalıştırır.
* **Zamanlayıcılar ve Geri Çağrılar**: Bunlar, AWX/Tower'da işlerin belirli zamanlarda çalıştırılması veya harici olaylar tarafından tetiklenmesine izin veren gelişmiş özelliklerdir.
* **Bildirimler**: AWX/Tower, işlerin başarı veya başarısızlık durumuna bağlı olarak bildirimler gönderebilir. E-postalar, Slack mesajları, web kancaları vb. gibi çeşitli bildirim yöntemlerini destekler.
* **Ansible Playbook'ları**: Ansible playbook'ları, yapılandırma, dağıtım ve orkestrasyon araçlarıdır. Otomatik, tekrarlanabilir bir şekilde sistemlerin istenen durumunu tanımlarlar. YAML'de yazılan playbook'lar, yapılandırmaları, görevleri ve adımları tanımlamak için Ansible'ın deklaratif otomasyon dilini kullanır.

### İş Yürütme Akışı

1. **Kullanıcı Etkileşimi**: Bir kullanıcı, AWX/Tower ile **Web Arayüzü** veya **REST API** aracılığıyla etkileşimde bulunabilir. Bu, AWX/Tower tarafından sunulan tüm işlevlere ön uç erişimi sağlar.
2. **İş Başlatma**:
* Kullanıcı, Web Arayüzü veya API aracılığıyla, bir **İş Şablonu**na dayalı olarak bir iş başlatır.
* İş Şablonu, **Envanter**, **Proje** (playbook'ı içeren) ve **Kimlik Bilgileri**ne referanslar içerir.
* İş başlatıldığında, işin yürütülmesi için bir istek AWX/Tower arka uçuna gönderilir.
3. **İş Kuyruğa Alma**:
* **RabbitMQ**, web bileşeni ile görev çalıştırıcıları arasındaki iletişimi yönetir. Bir iş başlatıldığında, RabbitMQ kullanarak bir mesaj görev motoruna gönderilir.
* **Redis**, bekleyen işleri yöneten görev kuyruğu için bir arka uç olarak hizmet verir.
4. **İş Yürütme**:
* **Görev Motoru**, kuyruğa alınan işi alır. İşin ilişkili playbook, envanter ve kimlik bilgileri hakkındaki gerekli bilgileri Veritabanından alır.
* İlişkili **Proje**den alınan Ansible playbook'u kullanarak Görev Motoru, belirtilen **Envanter** düğümleri üzerinde belirtilen **Kimlik Bilgileri**ni kullanarak playbook'u çalıştırır.
* Playbook çalıştırıldıkça, yürütme çıktısı (günlükler, gerçekler vb.) yakalanır ve Veritabanında depolanır.
5. **İş Sonuçları**:
* Playbook çalışması tamamlandığında, sonuçlar (başarı, başarısızlık, günlükler) Veritabanına kaydedilir.
* Kullanıcılar sonuçları Web Aray
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### Desteklenen roller

En ayrıcalıklı rol **Sistem Yöneticisi** olarak adlandırılır. Bu role sahip olan herkes **herhangi bir değişiklik yapabilir**.

**Beyaz kutu güvenliği** incelemesinden, **Sistem Denetçisi rolüne** ihtiyacınız olacaktır. Bu rol, **tüm sistem verilerini görüntülemeye** izin verir, ancak herhangi bir değişiklik yapamaz. Başka bir seçenek **Organizasyon Denetçisi rolü** olabilir, ancak diğerini almak daha iyi olur.

<details>

<summary>Detaylı rol açıklamasını almak için burayı genişletin</summary>

1. **Sistem Yöneticisi**:
* Bu, sistemdeki herhangi bir kaynağa erişim ve değişiklik yapma izinlerine sahip olan süper kullanıcı rolüdür.
* Tüm organizasyonları, ekipleri, projeleri, envanterleri, iş şablonlarını vb. yönetebilirler.
2. **Sistem Denetçisi**:
* Bu role sahip kullanıcılar tüm sistem verilerini görüntüleyebilir, ancak herhangi bir değişiklik yapamazlar.
* Bu rol, uyumluluk ve denetim için tasarlanmıştır.
3. **Organizasyon Roller**:
* **Yönetici**: Organizasyonun kaynakları üzerinde tam kontrol sahibi olur.
* **Denetçi**: Organizasyonun kaynaklarına yalnızca görüntüleme erişimi sağlar.
* **Üye**: Belirli izinlere sahip olmadan bir organizasyonun temel üyeliği.
* **Çalıştır**: Organizasyon içinde iş şablonlarını çalıştırabilir.
* **Oku**: Organizasyonun kaynaklarını görüntüleyebilir.
4. **Proje Roller**:
* **Yönetici**: Projeyi yönetebilir ve değiştirebilir.
* **Kullan**: Projeyi bir iş şablonunda kullanabilir.
* **Güncelle**: Kaynak kontrolünü kullanarak projeyi güncelleyebilir.
5. **Envanter Roller**:
* **Yönetici**: Envanteri yönetebilir ve değiştirebilir.
* **Ad Hoc**: Envanter üzerinde anlık komutlar çalıştırabilir.
* **Güncelle**: Envanter kaynağını güncelleyebilir.
* **Kullan**: Envanteri bir iş şablonunda kullanabilir.
* **Oku**: Yalnızca görüntüleme erişimi.
6. **İş Şablonu Roller**:
* **Yönetici**: İş şablonunu yönetebilir ve değiştirebilir.
* **Çalıştır**: İşi çalıştırabilir.
* **Oku**: Yalnızca görüntüleme erişimi.
7. **Kimlik Bilgisi Roller**:
* **Yönetici**: Kimlik bilgilerini yönetebilir ve değiştirebilir.
* **Kullan**: Kimlik bilgilerini iş şablonlarında veya diğer ilgili kaynaklarda kullanabilir.
* **Oku**: Yalnızca görüntüleme erişimi.
8. **Ekip Roller**:
* **Üye**: Ekip üyesi, ancak belirli izinlere sahip değil.
* **Yönetici**: Ekip üyelerini ve ilişkili kaynakları yönetebilir.
9. **İş Akışı Roller**:
* **Yönetici**: İş akışını yönetebilir ve değiştirebilir.
* **Çalıştır**: İş akışını çalıştırabilir.
* **Oku**: Yalnızca görüntüleme erişimi.

</details>

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahramana kadar AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **tanıtmak** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'i **takip edin**.
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github reposuna PR göndererek paylaşın.

</details>
