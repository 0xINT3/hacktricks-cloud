# Bezpieczeństwo Ansible Tower / AWX / Automation Controller

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

**Ansible Tower** lub jego wersja open source [**AWX**](https://github.com/ansible/awx) jest również znany jako **interfejs użytkownika, panel sterowania i REST API Ansible**. Dzięki **kontroli dostępu opartej na rolach**, harmonogramowi zadań i graficznemu zarządzaniu inwentarzem, można zarządzać infrastrukturą Ansible za pomocą nowoczesnego interfejsu użytkownika. REST API i interfejs wiersza poleceń Tower umożliwiają łatwe zintegrowanie go z obecnymi narzędziami i procesami.

**Automation Controller to nowsza** wersja Ansible Tower z większymi możliwościami.

### Różnice

Według [**tego**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00), główne różnice między Ansible Tower a AWS to otrzymywane wsparcie oraz dodatkowe funkcje Ansible Tower, takie jak kontrola dostępu oparta na rolach, obsługa niestandardowych interfejsów API i zdefiniowane przez użytkownika przepływy pracy.

### Stos technologiczny

* **Interfejs sieciowy**: Jest to interfejs graficzny, w którym użytkownicy mogą zarządzać inwentarzami, poświadczeniami, szablonami i zadaniami. Został zaprojektowany tak, aby był intuicyjny i zapewniał wizualizacje, które pomagają zrozumieć stan i wyniki zadań automatyzacji.
* **REST API**: Wszystko, co można zrobić w interfejsie sieciowym, można również zrobić za pomocą REST API. Oznacza to, że można zintegrować AWX/Tower z innymi systemami lub skryptować działania, które zwykle wykonuje się w interfejsie.
* **Baza danych**: AWX/Tower korzysta z bazy danych (zwykle PostgreSQL) do przechowywania konfiguracji, wyników zadań i innych niezbędnych danych operacyjnych.
* **RabbitMQ**: Jest to system komunikacji używany przez AWX/Tower do komunikacji między różnymi komponentami, zwłaszcza między usługą sieciową a wykonawcami zadań.
* **Redis**: Redis służy jako pamięć podręczna i backend dla kolejki zadań.

### Składniki logiczne

* **Inwentarze**: Inwentarz to **zbiór hostów (lub węzłów)**, na których można **uruchamiać zadania** (playbooki Ansible). AWX/Tower pozwala na definiowanie i grupowanie inwentarzy oraz obsługuje dynamiczne inwentarze, które mogą **pobierać listy hostów z innych systemów**, takich jak AWS, Azure itp.
* **Projekty**: Projekt to w zasadzie **zbiór playbooków Ansible** pobieranych z **systemu kontroli wersji** (takiego jak Git), aby pobierać najnowsze playbooki w razie potrzeby.
* **Szablony**: Szablony zadań definiują, **jak będzie uruchamiany określony playbook**, określając **inwentarz**, **poświadczenia** i inne **parametry** dla zadania.
* **Poświadczenia**: AWX/Tower zapewnia bezpieczny sposób **zarządzania i przechowywania sekretów, takich jak klucze SSH, hasła i tokeny API**. Te poświadczenia mogą być powiązane z szablonami zadań, aby playbooks miały niezbędny dostęp podczas ich uruchamiania.
* **Silnik zadań**: To tutaj dzieje się magia. Silnik zadań jest oparty na Ansible i jest odpowiedzialny za **uruchamianie playbooków**. Zadania są wysyłane do silnika zadań, który następnie uruchamia playbooki Ansible na wyznaczonym inwentarzu, korzystając z określonych poświadczeń.
* **Planistyczki i wywołania zwrotne**: Są to zaawansowane funkcje w AWX/Tower, które pozwalają **planować zadania** do uruchomienia o określonych godzinach lub wywoływane przez zewnętrzne zdarzenia.
* **Powiadomienia**: AWX/Tower może wysyłać powiadomienia na podstawie sukcesu lub niepowodzenia zadań. Obsługuje różne sposoby powiadamiania, takie jak e-maile, wiadomości Slack, webhooki itp.
* **Playbooki Ansible**: Playbooki Ansible to narzędzia konfiguracji, wdrażania i orkiestracji. Opisują one pożądany stan systemów w sposób zautomatyzowany i powtarzalny. Napisane w formacie YAML, playbooki używają deklaratywnego języka automatyzacji Ansible do opisania konfiguracji, zadań i kroków, które należy wykonać.

### Przebieg wykonania zadania

1. **Interakcja użytkownika**: Użytkownik może korzystać z AWX/Tower za pomocą **interfejsu sieciowego** lub **REST API**. Zapewniają one dostęp do wszystkich funkcji oferowanych przez AWX/Tower.
2. **Inicjowanie zadania**:
* Użytkownik za pomocą interfejsu sieciowego lub API inicjuje zadanie na podstawie **szablonu zadania**.
* Szablon zadania zawiera odwołania do **inwentarza**, **projektu** (zawierającego playbook) i **poświadczeń**.
* Po inicjacji zadania wysyłane jest żądanie do backendu AWX/Tower w celu umieszczenia zadania w kolejce do wykonania.
3. **Umieszczanie zadania w kolejce**:
* **RabbitMQ** obsługuje komunikację między komponentem sieciowym a wykonawcami zadań. Po zainicjowaniu zadania wysyłana jest wiadomość do silnika zadań za pomocą RabbitMQ.
* **Redis** działa jako backend dla kolejki zadań, zarządzając zadaniami oczekującymi na wykonanie.
4. **Wykonanie zadania**:
* **Silnik zadań** pobiera zadanie z kolejki. Pobiera niezbędne informacje z **bazy danych** dotyczące powiązanego playbooka, inwentarza i poświadczeń.
* Korzystając z pobranego playbooka Ansible z powiązanego **projektu**, silnik zadań uruchamia playbook na określonych węzłach **inwentarza** przy użyciu podanych **poświadczeń**.
* Podczas uruchamiania playbooka jego wynik wykonania (logi, fakty itp.) jest przechwytywany i przechowywany w **bazie danych**.
5. **Wyniki zadania**:
* Po zakończeniu uruchamiania playbooka wyniki (sukces, niepowodzenie, logi) są zapisywane w **bazie danych**.
* Użytkownicy mogą następnie przeglądać wyniki za pomocą interfejsu sieciowego lub zapytywać o nie za pomocą REST API.
* Na podstawie wyników zadania mogą być wysyłane **powiadomienia**, informują
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### Obsługiwane role

Najbardziej uprzywilejowaną rolą jest **Administrator systemu**. Osoba posiadająca tę rolę może **modyfikować wszystko**.

Podczas przeglądu **bezpieczeństwa białej skrzynki** potrzebujesz roli **Audytora systemu**, który pozwala na **wyświetlanie wszystkich danych systemowych**, ale nie może dokonywać żadnych zmian. Inną opcją jest uzyskanie roli **Audytora organizacji**, ale lepiej jest uzyskać tę pierwszą.

<details>

<summary>Rozwiń, aby uzyskać szczegółowy opis dostępnych ról</summary>

1. **Administrator systemu**:
* Jest to rola superużytkownika z uprawnieniami do dostępu i modyfikowania dowolnego zasobu w systemie.
* Mogą zarządzać wszystkimi organizacjami, zespołami, projektami, inwentarzami, szablonami zadań, itp.
2. **Audytor systemu**:
* Użytkownicy posiadający tę rolę mogą wyświetlać wszystkie dane systemowe, ale nie mogą dokonywać żadnych zmian.
* Rola ta jest przeznaczona do celów zgodności i nadzoru.
3. **Role organizacji**:
* **Admin**: Pełna kontrola nad zasobami organizacji.
* **Auditor**: Dostęp tylko do odczytu do zasobów organizacji.
* **Member**: Podstawowe członkostwo w organizacji bez określonych uprawnień.
* **Execute**: Może uruchamiać szablony zadań w ramach organizacji.
* **Read**: Może wyświetlać zasoby organizacji.
4. **Role projektu**:
* **Admin**: Może zarządzać i modyfikować projekt.
* **Use**: Może używać projektu w szablonie zadania.
* **Update**: Może aktualizować projekt za pomocą SCM (kontroli źródła).
5. **Role inwentarza**:
* **Admin**: Może zarządzać i modyfikować inwentarz.
* **Ad Hoc**: Może uruchamiać polecenia ad hoc na inwentarzu.
* **Update**: Może aktualizować źródło inwentarza.
* **Use**: Może używać inwentarza w szablonie zadania.
* **Read**: Dostęp tylko do odczytu.
6. **Role szablonu zadania**:
* **Admin**: Może zarządzać i modyfikować szablon zadania.
* **Execute**: Może uruchamiać zadanie.
* **Read**: Dostęp tylko do odczytu.
7. **Role poświadczeń**:
* **Admin**: Może zarządzać i modyfikować poświadczenia.
* **Use**: Może używać poświadczeń w szablonach zadań lub innych powiązanych zasobach.
* **Read**: Dostęp tylko do odczytu.
8. **Role zespołu**:
* **Member**: Część zespołu, ale bez określonych uprawnień.
* **Admin**: Może zarządzać członkami zespołu i powiązanymi zasobami.
9. **Role przepływu pracy**:
* **Admin**: Może zarządzać i modyfikować przepływ pracy.
* **Execute**: Może uruchamiać przepływ pracy.
* **Read**: Dostęp tylko do odczytu.

</details>

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
