# Cloudflare ドメイン

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でAWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝**したい場合や **HackTricks をPDFでダウンロード**したい場合は [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式PEASS＆HackTricksスウォッグ**](https://peass.creator-spring.com)を入手
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)** に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦 で **@hacktricks\_live** をフォローする
* **ハッキングトリックを共有**するには、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

Cloudflare で構成された各TLDには、構成できる **一般設定とサービス** があります。このページでは、各セクションの **セキュリティ関連設定** を分析します。

<figure><img src="../../.gitbook/assets/image (101).png" alt=""><figcaption></figcaption></figure>

## 概要

* [ ] アカウントのサービスの **使用状況** を把握する
* [ ] **ゾーンID** と **アカウントID** も見つける

## アナリティクス

* [ ] **`セキュリティ`** で **レート制限** があるかどうかを確認する

## DNS

* [ ] DNS **レコード** に **興味深い**（機密性の高い？）データがないかをチェックする
* [ ] 名前に基づいて **機密情報** を含む可能性がある **サブドメイン** をチェックする（例：admin173865324.domin.com）
* [ ] **プロキシされていない** ウェブページをチェックする
* [ ] **プロキシされたウェブページ** が CNAME またはIPアドレスで **直接アクセス** できるかをチェックする
* [ ] **DNSSEC** が **有効** であることを確認する
* [ ] すべてのCNAMEで **CNAMEフラットニング** が **使用** されていることを確認する
* これは **サブドメイン乗っ取りの脆弱性を隠す** ために役立つ可能性があり、読み込み時間を改善する
* [ ] ドメインが **スプーフィングに脆弱でない** ことを確認する

## **Email**

TODO

## Spectrum

TODO

## SSL/TLS

### **概要**

* [ ] **SSL/TLS暗号化** は **Full** または **Full (Strict)** である必要があります。それ以外の場合、ある時点で **クリアテキストトラフィック** が送信されます。
* [ ] **SSL/TLS推奨** が有効になっていることを確認する

### エッジ証明書

* [ ] **常にHTTPSを使用** する必要があります
* [ ] **HTTP Strict Transport Security (HSTS)** が **有効** である必要があります
* [ ] **最小TLSバージョン** は 1.2 である必要があります
* [ ] **TLS 1.3** が有効になっている必要があります
* [ ] **自動HTTPSリライト** が **有効** である必要があります
* [ ] **証明書透明性モニタリング** が **有効** である必要があります

## **セキュリティ**

* [ ] **`WAF`** セクションでは、 **ファイアウォール** と **レート制限ルール** が **悪用を防ぐために使用** されているかを確認することが重要です。
* **`バイパス`** アクションはリクエストのために **Cloudflareセキュリティ機能を無効** にします。使用しないでください。
* [ ] **`ページシールド`** セクションでは、 **ページが使用されている場合に有効** であることを確認することが推奨されます
* [ ] **`APIシールド`** セクションでは、 **CloudflareでAPIが公開されている場合に有効** であることを確認することが推奨されます
* [ ] **`DDoS`** セクションでは、 **DDoS保護を有効** にすることが推奨されます
* [ ] **`設定`** セクションでは:
* [ ] **`セキュリティレベル`** が **中程度以上** であることを確認する
* [ ] **`チャレンジパッセージ`** が最大1時間であることを確認する
* [ ] **`ブラウザインテグリティチェック`** が **有効** であることを確認する
* [ ] **`プライバシーパスサポート`** が **有効** であることを確認する

### **CloudFlare DDoS保護**

* 可能であれば、**Bot Fight Mode** または **Super Bot Fight Mode** を有効にします。例えば、JSフロントエンドページからプログラム的にアクセスされるAPIを保護している場合、この設定を有効にできない場合があります。
* **WAF** では、 **URLパスごとのレート制限** や **検証済みボット** によるレート制限ルールを作成したり、IP、Cookie、リファラに基づいてアクセスを **ブロック** したりすることができます。したがって、Webページからのリクエストでない場合やCookieがない場合などのリクエストをブロックできます。
* 攻撃が **検証済みボット** からの場合、少なくともボットに **レート制限** を追加します。
* 攻撃が **特定のパス** に対して行われる場合、このパスに **レート制限** を追加することで予防策として追加できます。
* **ツール** のWAFからIPアドレス、IP範囲、国、ASNを **ホワイトリスト** に登録できます。
* **管理されたルール** が脆弱性の悪用を防ぐのに役立つかどうかを確認できます。
* **ツール** セクションでは、特定のIPアドレスやユーザーエージェントに **ブロックまたはチャレンジ** を与えることができます。
* DDoSでは、一部のルールをより制限的にするために **一部のルールをオーバーライド** することができます。
* **設定**: **セキュリティレベル** を **高** に設定し、攻撃を受けている場合は **攻撃中** に設定し、 **ブラウザインテグリティチェックが有効** であることを確認します。
* Cloudflare ドメイン -> アナリティクス -> セキュリティ -> **レート制限** が有効になっているかを確認します
* Cloudflare ドメイン -> セキュリティ -> イベント -> **検出された悪意のあるイベント** を確認します

## アクセス

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## 速度

_セキュリティに関連するオプションは見つかりませんでした_

## キャッシュ

* [ ] **`構成`** セクションで **CSAMスキャンツール** を有効にすることを検討してください

## **ワーカールート**

_すでに [cloudflare workers](./#workers) をチェックしているはずです_

## ルール

TODO

## ネットワーク

* [ ] **`HTTP/2`** が **有効** になっている場合、**`HTTP/2 to Origin`** も **有効** にする必要があります
* [ ] **`HTTP/3（QUICを使用）`** が **有効** になっている必要があります
* ユーザーの **プライバシー** が重要な場合は、 **`Onion Routing`** が **有効** であることを確認してください

## **トラフィック**

TODO

## カスタムページ

* [ ] セキュリティに関連するエラーがトリガーされた場合にカスタムページを構成することがオプションです（ブロック、レート制限、攻撃中モードなど）

## アプリ

TODO
## スクレイプシールド

* [ ] **メールアドレスの曖昧化** が **有効** であることを確認する
* [ ] **サーバーサイド除外** が **有効** であることを確認する

## **Zaraz**

TODO

## **Web3**

TODO

<details>

<summary><strong>**htARTE (HackTricks AWS Red Team Expert)** でAWSハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksで企業を宣伝したい** または **HackTricksをPDFでダウンロードしたい** 場合は [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクションを見つける
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f) に参加するか、[**telegramグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) をフォローする
* **ハッキングトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のGitHubリポジトリにPRを提出してください。

</details>
