# Cloudflare 域名

<details>

<summary><strong>从零开始学习 AWS 黑客攻击直到成为英雄</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 **HackTricks 中看到您的公司广告** 或 **下载 HackTricks 的 PDF 版本**，请查看 [**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFT 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上 **关注** 我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>

在 Cloudflare 中配置的每个顶级域名（TLD）都有一些**通用设置和服务**可以配置。在这个页面，我们将**分析每个部分的与安全相关的设置：**

<figure><img src="../../.gitbook/assets/image (2) (4).png" alt=""><figcaption></figcaption></figure>

## 概览

* [ ] 了解账户服务的**使用程度**
* [ ] 找到**区域 ID** 和 **账户 ID**

## 分析

* [ ] 在 **`Security`** 中检查是否有任何**速率限制**

## DNS

* [ ] 检查 DNS **记录**中的**有趣**（敏感？）数据
* [ ] 检查可能包含**敏感信息**的**子域名**，仅基于**名称**（如 admin173865324.domin.com）
* [ ] 检查**未被代理**的网页
* [ ] 检查可以通过 CNAME 或 IP 地址**直接访问**的**代理网页**
* [ ] 检查**DNSSEC**是否**启用**
* [ ] 检查是否在**所有 CNAME**中使用了**CNAME 展平**
* 这可能有助于**隐藏子域接管漏洞**并提高加载时间
* [ ] 检查域名[**是否容易受到欺骗**](https://book.hacktricks.xyz/network-services-pentesting/pentesting-smtp#mail-spoofing)

## **电子邮件**

待办事项

## Spectrum

待办事项

## SSL/TLS

### **概览**

* [ ] **SSL/TLS 加密**应为**完全**或**完全（严格）**。其他任何设置都会在某些时候发送**明文流量**。
* [ ] 应启用 **SSL/TLS 推荐器**

### 边缘证书

* [ ] 应**始终使用 HTTPS**
* [ ] 应启用 **HTTP 严格传输安全（HSTS）**
* [ ] **最低 TLS 版本应为 1.2**
* [ ] 应启用 **TLS 1.3**
* [ ] 应启用 **自动 HTTPS 重写**
* [ ] 应启用 **证书透明度监控**

## **安全**

* [ ] 在 **`WAF`** 部分，检查是否使用了**防火墙**和**速率限制规则**以防止滥用。
* **`Bypass`** 动作将为请求**禁用 Cloudflare 安全**功能。不应使用它。
* [ ] 在 **`Page Shield`** 部分，建议检查是否**启用**了它，如果有页面在使用
* [ ] 在 **`API Shield`** 部分，建议检查是否**启用**了它，如果有 API 在 Cloudflare 中暴露
* [ ] 在 **`DDoS`** 部分，建议启用**DDoS 保护**
* [ ] 在 **`Settings`** 部分：
* [ ] 检查**`Security Level`** 是否为**中等**或更高
* [ ] 检查**`Challenge Passage`** 最长为 1 小时
* [ ] 检查**`Browser Integrity Check`** 是否**启用**
* [ ] 检查**`Privacy Pass Support`** 是否**启用**

### **CloudFlare DDoS 保护**

* 如果可以，请启用**Bot Fight Mode** 或 **Super Bot Fight Mode**。如果您保护的是某些以编程方式访问的 API（例如来自 JS 前端页面）。您可能无法启用此功能，而不会破坏该访问。
* 在 **WAF** 中：您可以创建**按 URL 路径的速率限制**或对**已验证的机器人**（速率限制规则），或者基于 IP、Cookie、引用来源等**阻止访问**。因此，您可以阻止不来自网页或没有 Cookie 的请求。
* 如果攻击来自**已验证的机器人**，至少要**对机器人添加速率限制**。
* 如果攻击针对**特定路径**，作为预防机制，在此路径中添加**速率限制**。
* 您还可以从 WAF 中的**工具**中**白名单** IP 地址、IP 范围、国家或 ASN。
* 检查**托管规则**是否也有助于防止漏洞利用。
* 在**工具**部分，您可以**阻止或对特定 IP 和用户代理发出挑战**。
* 在 DDoS 中，您可以**覆盖某些规则使其更加严格**。
* **设置**：将**安全级别**设置为**高**，如果您正在受到攻击，则设置为**受到攻击**，并确保**浏览器完整性检查已启用**。
* 在 Cloudflare 域名 -> 分析 -> 安全 -> 检查是否启用了**速率限制**
* 在 Cloudflare 域名 -> 安全 -> 事件 -> 检查是否检测到**恶意事件**

## 访问

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}
## 速度

_我没有找到任何与安全相关的选项_

## 缓存

* [ ] 在 **`配置`** 部分考虑启用 **CSAM 扫描工具**

## **Workers 路由**

_你应该已经检查过_ [_cloudflare workers_](./#workers)

## 规则

待办

## 网络

* [ ] 如果 **`HTTP/2`** 已**启用**，应该**启用** **`HTTP/2 到源站`**
* [ ] 应该**启用** **`HTTP/3 (使用 QUIC)`**
* [ ] 如果你的**用户** **隐私**很重要，请确保**启用** **`洋葱路由`**

## **流量**

待办

## 自定义页面

* [ ] 当触发与安全相关的错误时（如阻止、速率限制或我正受到攻击模式），可以选择配置自定义页面

## 应用程序

待办

## Scrape Shield

* [ ] 检查**电子邮件地址混淆**是否**启用**
* [ ] 检查**服务器端排除**是否**启用**

## **Zaraz**

待办

## **Web3**

待办

<details>

<summary><strong>从零开始学习 AWS 黑客攻击直到成为英雄，通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

其他支持 HackTricks 的方式：

* 如果你想在 **HackTricks** 中看到你的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享你的黑客技巧**。

</details>
