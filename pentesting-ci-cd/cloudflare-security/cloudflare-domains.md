# Cloudflare Domains

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* HackTricksに**会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**PEASSファミリー**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、ハッキングのコツを**共有する**。

</details>

Cloudflareで設定された各TLDには、設定可能な**一般的な設定とサービス**があります。このページでは、各セクションのセキュリティ関連設定を**分析します**：

<figure><img src="../../.gitbook/assets/image (2) (4).png" alt=""><figcaption></figcaption></figure>

## 概要

* [ ] アカウントのサービスが**どの程度使用されているか**の感覚を得る
* [ ] **ゾーンID**と**アカウントID**も見つける

## アナリティクス

* [ ] **`セキュリティ`**で**レート制限**があるかどうかを確認する

## DNS

* [ ] DNS**レコード**内の**興味深い**（機密性の高い？）データをチェックする
* [ ] 名前だけで機密情報を含む可能性がある**サブドメイン**をチェックする（例：admin173865324.domin.com）
* [ ] **プロキシされていない**ウェブページをチェックする
* [ ] CNAMEまたはIPアドレスで**直接アクセス**できる**プロキシ化されたウェブページ**をチェックする
* [ ] **DNSSEC**が**有効**になっていることを確認する
* [ ] **CNAME Flattening**が**すべてのCNAMEで使用**されていることを確認する
* これは、サブドメイン乗っ取りの脆弱性を**隠す**のに役立ち、ロード時間を改善する可能性があります
* [ ] ドメインが[**スプーフィングに弱い**](https://book.hacktricks.xyz/network-services-pentesting/pentesting-smtp#mail-spoofing)ことがないように確認する

## **メール**

TODO

## Spectrum

TODO

## SSL/TLS

### **概要**

* [ ] **SSL/TLS暗号化**は**Full**または**Full (Strict)**であるべきです。それ以外は、ある時点で**平文のトラフィック**を送信します。
* [ ] **SSL/TLS Recommender**が有効になっていること

### エッジ証明書

* [ ] **常にHTTPSを使用する**が**有効**になっていること
* [ ] **HTTP Strict Transport Security (HSTS)**が**有効**になっていること
* [ ] **最小TLSバージョンは1.2であること**
* [ ] **TLS 1.3が有効**になっていること
* [ ] **自動HTTPS書き換え**が**有効**になっていること
* [ ] **Certificate Transparency Monitoring**が**有効**になっていること

## **セキュリティ**

* [ ] **`WAF`**セクションでは、**ファイアウォール**と**レート制限ルール**が乱用を防ぐために使用されているかどうかを確認することが興味深いです。
* **`Bypass`**アクションは、リクエストに対してCloudflareのセキュリティ機能を**無効にします**。使用すべきではありません。
* [ ] **`Page Shield`**セクションでは、使用されているページがある場合は**有効**になっていることを確認することをお勧めします
* [ ] **`API Shield`**セクションでは、Cloudflareで公開されているAPIがある場合は**有効**になっていることを確認することをお勧めします
* [ ] **`DDoS`**セクションでは、**DDoS保護**を有効にすることをお勧めします
* [ ] **`設定`**セクションでは：
* [ ] **`セキュリティレベル`**が**中**以上であることを確認する
* [ ] **`チャレンジパッセージ`**が最大1時間であることを確認する
* [ ] **`ブラウザの整合性チェック`**が**有効**になっていることを確認する
* [ ] **`プライバシーパスサポート`**が**有効**になっていることを確認する

### **CloudFlare DDoS保護**

* 可能であれば、**Bot Fight Mode**または**Super Bot Fight Mode**を有効にします。プログラム的にアクセスされるAPI（例えばJSフロントエンドページから）を保護している場合、これを有効にするとそのアクセスが壊れる可能性があります。
* **WAF**では、URLパスごとに**レート制限**を作成するか、**検証済みのボット**に対して（レート制限ルール）、またはIP、Cookie、リファラーなどに基づいてアクセスを**ブロック**することができます。したがって、ウェブページから来ないリクエストやCookieを持たないリクエストをブロックできます。
* 攻撃が**検証済みのボット**からの場合、少なくともボットに**レート制限**を追加します。
* 攻撃が**特定のパス**に対して行われている場合、予防策として、このパスに**レート制限**を追加します。
* **ツール**セクションでは、IPアドレス、IP範囲、国、またはASNを**ホワイトリスト**に登録できます。
* **管理されたルール**も脆弱性の悪用を防ぐのに役立つかもしれません。
* **ツール**セクションでは、特定のIPや**ユーザーエージェントにブロックまたはチャレンジを与える**ことができます。
* DDoSでは、一部のルールをより制限的にする**オーバーライド**ができます。
* **設定**：**セキュリティレベル**を**高**に設定し、攻撃を受けている場合は**攻撃下**に設定し、**ブラウザの整合性チェックが有効**になっていることを確認します。
* Cloudflare Domains -> アナリティクス -> セキュリティ -> **レート制限**が有効になっているかを確認する
* Cloudflare Domains -> セキュリティ -> イベント -> **検出された悪意のあるイベント**をチェックする

## アクセス

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}
## 速度

_セキュリティに関連するオプションは見つかりませんでした_

## キャッシング

* [ ] **`Configuration`** セクションで **CSAM Scanning Tool** を有効にすることを検討してください

## **Workers Routes**

_すでに_ [_cloudflare workers_](./#workers) _をチェックしているはずです_

## ルール

TODO

## ネットワーク

* [ ] **`HTTP/2`** が **有効** であれば、**`HTTP/2 to Origin`** も **有効** にすべきです
* [ ] **`HTTP/3 (with QUIC)`** は **有効** にすべきです
* [ ] ユーザーの **プライバシー** が重要であれば、**`Onion Routing`** が **有効** であることを確認してください

## **トラフィック**

TODO

## カスタムページ

* [ ] セキュリティに関連するエラーが発生したとき（ブロック、レート制限、または攻撃下にあるモードなど）にカスタムページを設定することは任意です

## アプリ

TODO

## スクレイプシールド

* [ ] **Email Address Obfuscation** が **有効** であることを確認してください
* [ ] **Server-side Excludes** が **有効** であることを確認してください

## **Zaraz**

TODO

## **Web3**

TODO

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) で</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または **HackTricksをPDFでダウンロードしたい** 場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com) を入手してください
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)、私たちの独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) コレクションを発見してください
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f) に **参加するか**、[**telegramグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) を **フォローしてください**。
* **HackTricks** の [**githubリポジトリ**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) にPRを提出して、あなたのハッキングのコツを共有してください。

</details>
