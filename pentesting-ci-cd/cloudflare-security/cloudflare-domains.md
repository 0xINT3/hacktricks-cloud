# Cloudflare ドメイン

<details>

<summary><strong>ハックトリックスをサポートして特典を得る！</strong></summary>

* **HackTricks** で **会社の広告を見たい**場合や、**PEASSの最新バージョンをダウンロードしたり、PDFでHackTricksを入手**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つけましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしましょう 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **ハッキングのトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

Cloudflareで構成された各TLDには、設定できるいくつかの**一般的な設定とサービス**があります。このページでは、各セクションの**セキュリティ関連の設定**を分析します。

<figure><img src="../../.gitbook/assets/image (2) (4).png" alt=""><figcaption></figcaption></figure>

## 概要

* [ ] アカウントのサービスの使用状況を把握する
* [ ] ゾーンIDとアカウントIDも取得する

## アナリティクス

* [ ] **`セキュリティ`** で **レート制限**が設定されているか確認する

## DNS

* [ ] DNSの **レコード** には、**興味深い**（機密情報？）データが含まれていないか確認する
* [ ] 名前に基づいて、**機密情報**を含む可能性のある **サブドメイン** をチェックする（例：admin173865324.domin.com）
* [ ] **プロキシされていない** ウェブページをチェックする
* [ ] CNAMEまたはIPアドレスで **直接アクセスできるプロキシされたウェブページ** をチェックする
* [ ] **DNSSEC** が **有効** になっているか確認する
* [ ] **CNAMEフラットニング** が **すべてのCNAMEで使用されている** か確認する
* これは、**サブドメインの乗っ取りの脆弱性を隠す**のに役立ち、読み込み時間を改善することができます
* [ ] ドメインが [**スプーフィングの脆弱性に対して脆弱ではない**](https://book.hacktricks.xyz/network-services-pentesting/pentesting-smtp#mail-spoofing) ことを確認する

## **Email**

TODO

## Spectrum

TODO

## SSL/TLS

### **概要**

* [ ] **SSL/TLS暗号化** は **Full** または **Full (Strict)** に設定する必要があります。それ以外の設定では、ある時点で **クリアテキストトラフィック** が送信されます。
* [ ] **SSL/TLS推奨者** が有効になっていることを確認する

### エッジ証明書

* [ ] **常にHTTPSを使用** するように設定する
* [ ] **HTTP Strict Transport Security (HSTS)** を **有効** にする
* [ ] **最小TLSバージョン** は1.2に設定する
* [ ] **TLS 1.3** を有効にする
* [ ] **自動HTTPSリライト** を **有効** にする
* [ ] **証明書透明性モニタリング** を **有効** にする

## **セキュリティ**

* [ ] **`WAF`** セクションでは、**ファイアウォール**と**レート制限ルール**が使用されているか確認することが重要です。
* **`バイパス`** アクションは、リクエストのためにCloudflareのセキュリティ機能を **無効** にします。使用しないでください。
* [ ] **`ページシールド`** セクションでは、ページが使用されている場合に **有効** になっているか確認することをお勧めします。
* [ ] **`APIシールド`** セクションでは、CloudflareでAPIが公開されている場合に **有効** になっているか確認することをお勧めします。
* [ ] **`DDoS`** セクションでは、**DDoS保護** を有効にすることをお勧めします。
* [ ] **`設定`** セクションでは：
* [ ] **`セキュリティレベル`** が **中程度以上** であることを確認する
* [ ] **`チャレンジパッセージ`** が最大1時間であることを確認する
* [ ] **`ブラウザの整合性チェック`** が **有効** になっていることを確認する
* [ ] **`プライバシーパスサポート`** が **有効** になっていることを確認する

### **CloudFlare DDoS Protection**

* 可能であれば、**Bot Fight Mode** または **Super Bot Fight Mode** を有効にします。プログラムからアクセスされるAPI（たとえばJSフロントエンドページから）を保護している場合、これを有効にすることはできません。
* **WAF**：URLパスまたは**検証済みボット**（レート制限ルール）による**レート制限**、またはIP、Cookie、リファラに基づいて**アクセスをブロック**することができます。したがって、ウェブページからのリクエストでない場合や、Cookieがない場合のリクエストをブロックできます。
* 攻撃が**検証済みボット**からの場合、ボットに対して少なくとも**レート制限**を追加します。
* 攻撃が**特定のパス**に対して行われる場合、予防策として、このパスに**レート制限**を追加します。
* **ツール**のWAFでは、IPアドレス、IP範囲、国、またはASNを**ホワイトリスト**に登録することもできます。
* **管理されたルール**が脆弱性の悪用を防ぐのに役立つ場合もあります。
* **ツール**セクションでは、特定のIPやユーザーエージェントに対して**ブロックまたはチャレンジ**を与えることができます。
* DDoSでは、いくつかのルールを**より制限的にオーバーライド**することができます。
* **設定**：**セキュリティレベル**を**High**に設定し、攻撃を受けている場合は**Under Attack**に設定し、**ブラウザの整合性チェックが有効**になっていることを確認します。
* Cloudflareドメイン->アナリティクス->セキュリティ->**レート制限**が有効になっているか確認します
* Cloudflareドメイン->セキュリティ->イベント->**検出された悪意のあるイベント**を確認します

## アクセス

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## 速度

_セキュリティに関連するオプションは見つかりませんでした_

## キャッシュ

* [ ] **`構成`** セクションで **CSAMスキャンツール** を有効にすることを検討してください
## **Workersのルート**

_すでに_ [_cloudflare workers_](./#workers) _をチェックしているはずです_

## ルール

TODO

## ネットワーク

* [ ] **`HTTP/2`** が **有効**であることを確認する
* [ ] **`HTTP/2 to Origin`** が **有効**であることを確認する
* [ ] **`HTTP/3 (with QUIC)`** が **有効**であることを確認する
* [ ] ユーザーの **プライバシー** が重要な場合は、**`Onion Routing`** が **有効**であることを確認する

## **トラフィック**

TODO

## カスタムページ

* [ ] セキュリティに関連するエラーが発生した場合（ブロック、レート制限、攻撃モードなど）、カスタムページを設定することができます（オプション）

## アプリ

TODO

## スクレイプシールド

* [ ] **Email Address Obfuscation** が **有効**であることを確認する
* [ ] **Server-side Excludes** が **有効**であることを確認する

## **Zaraz**

TODO

## **Web3**

TODO

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もし **HackTricksであなたの会社を宣伝したい** または **PEASSの最新バージョンにアクセスしたい** または **HackTricksをPDFでダウンロードしたい** 場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com) を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) を見つける。独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクションです
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f) または [**telegramグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) をフォローする
* **ハッキングのトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリにPRを提出してください**

</details>
