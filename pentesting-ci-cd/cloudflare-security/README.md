# Cloudflare安全

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧**。

</details>

在Cloudflare帐户中，有一些可以配置的**常规设置和服务**。在本页面中，我们将**分析每个部分的安全相关设置**：

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## 网站

使用以下内容检查每个网站：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### 域名注册

* [ ] 在**`Transfer Domains`**中检查是否无法转移任何域名。

使用以下内容检查每个网站：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## 分析

_我找不到任何需要进行配置安全审查的内容。_

## 页面

在每个Cloudflare页面上：

* [ ] 检查**`Build log`**中是否存在**敏感信息**。
* [ ] 检查分配给页面的**Github存储库**中是否存在**敏感信息**。
* [ ] 检查通过**工作流命令注入**或**`pull_request_target`**入侵来检查潜在的Github存储库妥协。更多信息请参见[**Github安全页面**](../github-security/)。
* [ ] 检查`/fuctions`目录（如果有）中的**易受攻击的函数**，检查`_redirects`文件（如果有）中的**重定向**，以及`_headers`文件（如果有）中的**配置错误的标头**。
* [ ] 如果可以**访问代码**，通过**黑盒**或**白盒**方式检查**网页**中的**漏洞**
* [ ] 在每个页面的详细信息中检查`/<page_id>/pages/view/blocklist/settings/functions`。检查**`环境变量`**中是否存在**敏感信息**。
* [ ] 在详细信息页面中还检查**构建命令**和**根目录**，以查找**潜在的注入**来妥协页面。

## **Workers**

在每个Cloudflare的worker上检查：

* [ ] 触发器：是什么触发了worker？用户是否可以发送数据供worker使用？
* [ ] 在**`Settings`**中，检查是否有包含**敏感信息**的**`Variables`**
* [ ] 检查worker的代码并搜索**漏洞**（特别是用户可以管理输入的地方）
* 检查返回您可以控制的指定页面的SSRF
* 检查执行JS的XSS是否在svg图像中

{% hint style="warning" %}
请注意，默认情况下，**Worker会被分配一个URL**，例如`<worker-name>.<account>.workers.dev`。用户可以将其设置为**子域**，但如果您知道原始URL，您始终可以使用该**原始URL**访问它。
{% endhint %}

## R2

待办事项

## Stream

待办事项

## 图像

待办事项

## 安全中心

* [ ] 如果可能，请运行**`Security Insights`**扫描和**`Infrastructure`**扫描，因为它们将从安全角度**突出显示**有趣的信息。
* [ ] 仅出于安全配置错误和有趣信息的目的，**检查此信息**

## 转门

待办事项

## **零信任**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## 批量重定向

{% hint style="info" %}
与[动态重定向](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/)不同，[**批量重定向**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/)基本上是静态的 - 它们**不支持任何字符串替换**操作或正则表达式。但是，您可以配置影响其URL匹配行为和运行时行为的URL重定向参数。
{% endhint %}

* [ ] 检查重定向的**表达式**和**要求**是否合理。
* [ ] 还要检查是否存在包含有趣信息的**敏感隐藏端点**。

## 通知

* [ ] 检查**通知**。以下通知对于安全性是推荐的：
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] 检查所有**目标**，因为Webhook URL中可能包含**敏感信息**（基本HTTP身份验证）。还要确保Webhook URL使用**HTTPS**
* [ ] 作为额外的检查，您可以尝试向第三方**冒充Cloudflare通知**，也许您可以以某种方式**注入危险内容**
## 管理账户

* [ ] 可以在**`Billing` -> `Payment info`**中查看信用卡的**最后4位数字**，**到期时间**和**账单地址**。
* [ ] 可以在**`Billing` -> `Subscriptions`**中查看账户使用的**计划类型**。
* [ ] 在**`Members`**中可以查看账户的所有成员及其**角色**。请注意，如果计划类型不是企业版，则只有两个角色：管理员和超级管理员。但如果使用的是**企业版计划**，可以使用[**更多角色**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/)来遵循最小权限原则。
* 因此，尽可能使用**企业版计划**是**推荐的**。
* [ ] 在成员中可以检查哪些成员已启用**双重身份验证（2FA）**。**每个**用户都应该启用它。

{% hint style="info" %}
请注意，幸运的是，**`管理员`**角色不具备管理成员的权限（**无法提升权限或邀请**新成员）
{% endhint %}

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的**公司广告**，或者如果您想访问**PEASS的最新版本或下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>
