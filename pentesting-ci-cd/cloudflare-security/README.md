# Seguridad de Cloudflare

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

En una cuenta de Cloudflare hay algunas **configuraciones y servicios generales** que se pueden configurar. En esta página vamos a **analizar las configuraciones relacionadas con la seguridad de cada sección:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Sitios web

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Registro de dominios

* [ ] En **`Transferir dominios`** verifica que no sea posible transferir ningún dominio.

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analíticas

_No pude encontrar nada para revisar en una revisión de seguridad de la configuración._

## Páginas

En cada página de Cloudflare:

* [ ] Verifica la presencia de **información sensible** en el **`Registro de construcción`**.
* [ ] Verifica la presencia de **información sensible** en el **repositorio de Github** asignado a las páginas.
* [ ] Verifica la posible compromisión del repositorio de Github a través de **inyección de comandos en el flujo de trabajo** o compromiso de `pull_request_target`. Más información en la [**página de Seguridad de Github**](../github-security/).
* [ ] Verifica la presencia de **funciones vulnerables** en el directorio `/fuctions` (si hay), verifica los **redireccionamientos** en el archivo `_redirects` (si hay) y los **encabezados mal configurados** en el archivo `_headers` (si hay).
* [ ] Verifica las **vulnerabilidades** en la **página web** a través de **blackbox** o **whitebox** si puedes **acceder al código**
* [ ] En los detalles de cada página `/<page_id>/pages/view/blocklist/settings/functions`. Verifica la presencia de **información sensible** en las **`Variables de entorno`**.
* [ ] En la página de detalles, verifica también el **comando de construcción** y el **directorio raíz** para **inyecciones potenciales** que comprometan la página.

## **Workers**

En cada worker de Cloudflare verifica:

* [ ] Los desencadenantes: ¿Qué hace que el worker se active? ¿Puede un **usuario enviar datos** que serán **utilizados** por el worker?
* [ ] En la **`Configuración`**, verifica las **`Variables`** que contienen **información sensible**
* [ ] Verifica el **código del worker** y busca **vulnerabilidades** (especialmente en lugares donde el usuario puede gestionar la entrada)
* Verifica SSRFs que devuelvan la página indicada que puedas controlar
* Verifica XSSs ejecutando JS dentro de una imagen svg

{% hint style="warning" %}
Ten en cuenta que por defecto a un **Worker se le asigna una URL** como `<nombre-worker>.<cuenta>.workers.dev`. El usuario puede configurarlo como un **subdominio** pero siempre puedes acceder a él con esa **URL original** si la conoces.
{% endhint %}

## R2

POR HACER

## Stream

POR HACER

## Imágenes

POR HACER

## Centro de Seguridad

* [ ] Si es posible, ejecuta un **escaneo de** **`Security Insights`** y un **escaneo de** **`Infraestructura`**, ya que resaltarán información interesante en términos de **seguridad**.
* [ ] Simplemente **verifica esta información** en busca de configuraciones de seguridad incorrectas e información interesante

## Turnstile

POR HACER

## **Confianza Cero**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Redirecciones Masivas

{% hint style="info" %}
A diferencia de [Redirecciones Dinámicas](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Redirecciones Masivas**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) son esencialmente estáticas, no admiten operaciones de **reemplazo de cadenas** ni expresiones regulares. Sin embargo, puedes configurar parámetros de redirección de URL que afectan su comportamiento de coincidencia de URL y su comportamiento en tiempo de ejecución.
{% endhint %}

* [ ] Verifica que las **expresiones** y **requisitos** para las redirecciones tengan **sentido**.
* [ ] Verifica también la presencia de **puntos finales ocultos sensibles** que contengan información interesante.

## Notificaciones

* [ ] Verifica las **notificaciones**. Estas notificaciones son recomendadas para la seguridad:
* `Facturación basada en uso`
* `Alerta de Ataque DDoS HTTP`
* `Alerta de Ataque DDoS de Capa 3/4`
* `Alerta de Ataque DDoS HTTP Avanzado`
* `Alerta de Ataque DDoS de Capa 3/4 Avanzado`
* `Monitoreo basado en flujo: Ataque volumétrico`
* `Alerta de Detección de Fuga de Rutas`
* `Alerta de Expiración de Certificado mTLS de Acceso`
* `Alerta de Hostnames Personalizados SSL para SaaS`
* `Alerta de SSL Universal`
* `Alerta de Detección de Cambio de Código Nuevo en Monitor de Scripts`
* `Alerta de Nuevo Dominio en Monitor de Scripts`
* `Alerta de Nuevo Dominio Malicioso en Monitor de Scripts`
* `Alerta de Nuevo Script Malicioso en Monitor de Scripts`
* `Alerta de Nueva URL Maliciosa en Monitor de Scripts`
* `Alerta de Nuevos Scripts en Monitor de Scripts`
* `Alerta de Nuevo Script que Excede la Longitud Máxima de URL en Monitor de Scripts`
* `Alerta de Eventos de Seguridad Avanzados`
* `Alerta de Eventos de Seguridad`
* [ ] Verifica todos los **destinos**, ya que podría haber **información sensible** (autenticación básica http) en las URL de webhook. Asegúrate también de que las URL de webhook utilicen **HTTPS**
* [ ] Como verificación adicional, podrías intentar **suplantar una notificación de Cloudflare** a un tercero, tal vez puedas de alguna manera **inyectar algo peligroso**

## Administrar Cuenta

* [ ] Es posible ver los **últimos 4 dígitos de la tarjeta de crédito**, la **fecha de vencimiento** y la **dirección de facturación** en **`Facturación` -> `Información de pago`**.
* [ ] Es posible ver el **tipo de plan** utilizado en la cuenta en **`Facturación` -> `Suscripciones`**.
* [ ] En **`Miembros`** es posible ver todos los miembros de la cuenta y su **rol**. Ten en cuenta que si el tipo de plan no es Enterprise, solo existen 2 roles: Administrador y Super Administrador. Pero si se utiliza un **plan Enterprise**, se pueden utilizar [**más roles**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) para seguir el principio de privilegio mínimo.
* Por lo tanto, siempre que sea posible es **recomendable** utilizar el **plan Enterprise**.
* [ ] En Miembros es posible verificar qué **miembros** tienen habilitado el **2FA**. **Cada** usuario debería tenerlo habilitado.

{% hint style="info" %}
Ten en cuenta que afortunadamente el rol **`Administrador`** no otorga permisos para gestionar membresías (**no puede escalar privilegios o invitar** nuevos miembros)
{% endhint %}
## Investigación de DDoS

[Ver esta sección](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
