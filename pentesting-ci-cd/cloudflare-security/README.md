# Seguridad en Cloudflare

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

En una cuenta de Cloudflare hay algunos **ajustes generales y servicios** que se pueden configurar. En esta p√°gina vamos a **analizar los ajustes relacionados con la seguridad de cada secci√≥n:**

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## Sitios web

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Registro de Dominio

* [ ] En **`Transferir Dominios`** verifica que no sea posible transferir ning√∫n dominio.

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## An√°lisis

_No pude encontrar nada que revisar para una revisi√≥n de seguridad de configuraci√≥n._

## P√°ginas

En cada p√°gina de Cloudflare:

* [ ] Busca **informaci√≥n sensible** en el **`Registro de construcci√≥n`**.
* [ ] Busca **informaci√≥n sensible** en el **repositorio de Github** asignado a las p√°ginas.
* [ ] Busca posibles compromisos del repositorio de github a trav√©s de **inyecci√≥n de comandos en el flujo de trabajo** o compromiso de `pull_request_target`. M√°s informaci√≥n en la [**p√°gina de Seguridad de Github**](../github-security/).
* [ ] Busca **funciones vulnerables** en el directorio `/functions` (si las hay), revisa los **redireccionamientos** en el archivo `_redirects` (si los hay) y **encabezados mal configurados** en el archivo `_headers` (si los hay).
* [ ] Busca **vulnerabilidades** en la **p√°gina web** a trav√©s de **blackbox** o **whitebox** si puedes **acceder al c√≥digo**
* [ ] En los detalles de cada p√°gina `/<page_id>/pages/view/blocklist/settings/functions`. Busca **informaci√≥n sensible** en las **`Variables de entorno`**.
* [ ] En la p√°gina de detalles revisa tambi√©n el **comando de construcci√≥n** y el **directorio ra√≠z** para **posibles inyecciones** que comprometan la p√°gina.

## **Workers**

En cada worker de Cloudflare revisa:

* [ ] Los disparadores: ¬øQu√© hace que se active el worker? ¬øPuede un **usuario enviar datos** que ser√°n **utilizados** por el worker?
* [ ] En los **`Ajustes`**, busca **`Variables`** que contengan **informaci√≥n sensible**
* [ ] Revisa el **c√≥digo del worker** y busca **vulnerabilidades** (especialmente en lugares donde el usuario puede manejar la entrada)
* Busca SSRFs que devuelvan la p√°gina indicada que puedes controlar
* Busca XSSs ejecutando JS dentro de una imagen svg

{% hint style="warning" %}
Ten en cuenta que por defecto a un **Worker se le asigna una URL** como `<worker-name>.<account>.workers.dev`. El usuario puede configurarlo a un **subdominio** pero siempre puedes acceder a √©l con esa **URL original** si la conoces.
{% endhint %}

## R2

TODO

## Stream

TODO

## Im√°genes

TODO

## Centro de Seguridad

* [ ] Si es posible, realiza un **escaneo de `Insights de Seguridad`** y un **escaneo de `Infraestructura`**, ya que resaltar√°n informaci√≥n interesante desde el punto de vista de la **seguridad**.
* [ ] Simplemente **revisa esta informaci√≥n** en busca de configuraciones de seguridad incorrectas e informaci√≥n interesante

## Turnstile

TODO

## **Confianza Cero**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Redirecciones Masivas

{% hint style="info" %}
A diferencia de las [Redirecciones Din√°micas](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), las [**Redirecciones Masivas**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) son esencialmente est√°ticas ‚Äî no admiten operaciones de reemplazo de cadenas ni expresiones regulares. Sin embargo, puedes configurar par√°metros de redirecci√≥n de URL que afectan su comportamiento de coincidencia de URL y su comportamiento en tiempo de ejecuci√≥n.
{% endhint %}

* [ ] Verifica que las **expresiones** y **requisitos** para las redirecciones **tengan sentido**.
* [ ] Revisa tambi√©n en busca de **puntos finales ocultos sensibles** que contengan informaci√≥n interesante.

## Notificaciones

* [ ] Revisa las **notificaciones.** Se recomiendan estas notificaciones para la seguridad:
* `Facturaci√≥n Basada en Uso`
* `Alerta de Ataque DDoS HTTP`
* `Alerta de Ataque DDoS de Capa 3/4`
* `Alerta de Ataque DDoS HTTP Avanzado`
* `Alerta de Ataque DDoS de Capa 3/4 Avanzado`
* `Monitoreo Basado en Flujo: Ataque Volum√©trico`
* `Alerta de Detecci√≥n de Fuga de Rutas`
* `Alerta de Expiraci√≥n de Certificado mTLS de Acceso`
* `Alerta de Hostnames Personalizados para SSL para SaaS`
* `Alerta de SSL Universal`
* `Alerta de Detecci√≥n de Cambio de C√≥digo Nuevo en Monitor de Scripts`
* `Alerta de Nuevo Dominio en Monitor de Scripts`
* `Alerta de Nuevo Dominio Malicioso en Monitor de Scripts`
* `Alerta de Nuevo Script Malicioso en Monitor de Scripts`
* `Alerta de Nueva URL Maliciosa en Monitor de Scripts`
* `Alerta de Nuevos Scripts en Monitor de Scripts`
* `Alerta de Nuevo Script que Excede la Longitud M√°xima de URL en Monitor de Scripts`
* `Alerta de Eventos de Seguridad Avanzados`
* `Alerta de Eventos de Seguridad`
* [ ] Revisa todos los **destinos**, ya que podr√≠a haber **informaci√≥n sensible** (autenticaci√≥n http b√°sica) en las URLs de los webhooks. Aseg√∫rate tambi√©n de que las URLs de los webhooks usen **HTTPS**
* [ ] Como revisi√≥n adicional, podr√≠as intentar **suplantar una notificaci√≥n de Cloudflare** a un tercero, tal vez puedas **inyectar algo peligroso**
## Administrar Cuenta

* [ ] Es posible ver los **√∫ltimos 4 d√≠gitos de la tarjeta de cr√©dito**, la **fecha de expiraci√≥n** y la **direcci√≥n de facturaci√≥n** en **`Facturaci√≥n` -> `Informaci√≥n de pago`**.
* [ ] Es posible ver el **tipo de plan** utilizado en la cuenta en **`Facturaci√≥n` -> `Suscripciones`**.
* [ ] En **`Miembros`** es posible ver todos los miembros de la cuenta y su **rol**. Nota que si el tipo de plan no es Enterprise, solo existen 2 roles: Administrador y Super Administrador. Pero si el **plan utilizado es Enterprise**, [**m√°s roles**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) pueden ser utilizados para seguir el principio de m√≠nimo privilegio.
* Por lo tanto, siempre que sea posible se **recomienda** utilizar el **plan Enterprise**.
* [ ] En Miembros es posible verificar qu√© **miembros** tienen **2FA activado**. **Cada** usuario deber√≠a tenerlo activado.

{% hint style="info" %}
Nota que afortunadamente el rol de **`Administrador`** no otorga permisos para gestionar membres√≠as (**no puede escalar privilegios o invitar** a nuevos miembros)
{% endhint %}

## Investigaci√≥n de DDoS

[Revisa esta parte](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
