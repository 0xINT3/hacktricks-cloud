# Cloudflareセキュリティ

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **会社をHackTricksで宣伝したい**場合や、**最新バージョンのPEASSをダウンロードしたり、HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をご確認ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。これは、私たちの独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**または[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **ハッキングのトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

Cloudflareアカウントには、設定できる**一般的な設定とサービス**があります。このページでは、各セクションの**セキュリティ関連の設定**を分析します。

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## ウェブサイト

それぞれを確認してください：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### ドメイン登録

* [ ] **`Transfer Domains`**で、どのドメインも転送できないことを確認してください。

それぞれを確認してください：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## アナリティクス

_構成セキュリティレビューのためのチェック項目は見つかりませんでした。_

## ページ

各Cloudflareのページで：

* [ ] **`Build log`**に**機密情報**がないか確認してください。
* [ ] ページに割り当てられた**Githubリポジトリ**に**機密情報**がないか確認してください。
* [ ] **ワークフローコマンドインジェクション**または**`pull_request_target`**の侵害を通じた、**潜在的なGithubリポジトリの侵害**を確認してください。詳細は[**Githubセキュリティページ**](../github-security/)を参照してください。
* [ ] `/fuctions`ディレクトリ（存在する場合）の**脆弱な関数**、`_redirects`ファイル（存在する場合）の**リダイレクト**、`_headers`ファイル（存在する場合）の**設定ミスのヘッダー**を確認してください。
* [ ] **ウェブページ**の**ブラックボックス**または**ホワイトボックス**を使用して、**コードにアクセスできる場合**に**脆弱性**を確認してください。
* [ ] 各ページの詳細で`/<page_id>/pages/view/blocklist/settings/functions`を確認してください。**`Environment variables`**に**機密情報**がないか確認してください。
* [ ] 詳細ページで**ビルドコマンド**と**ルートディレクトリ**も確認し、ページを侵害するための**潜在的なインジェクション**を確認してください。

## **ワーカー**

各Cloudflareのワーカーで確認してください：

* [ ] トリガー：ワーカーをトリガーするものは何ですか？ユーザーがワーカーによって**使用されるデータ**を送信できますか？
* [ ] **`Settings`**で、**機密情報を含む** **`Variables`**を確認してください。
* [ ] ワーカーのコードをチェックし、**脆弱性**を検索してください（特にユーザーが入力を管理できる場所）。
* 指定したページを返すSSRFをチェックしてください
* SVGイメージ内でJSを実行するXSSをチェックしてください

{% hint style="warning" %}
デフォルトでは、**ワーカーにはURL**が割り当てられます。たとえば、`<worker-name>.<account>.workers.dev`のようなURLです。ユーザーはそれを**サブドメイン**に設定できますが、その**元のURL**を知っていれば常にアクセスできます。
{% endhint %}

## R2

TODO

## Stream

TODO

## Images

TODO

## セキュリティセンター

* [ ] 可能であれば、**`Security Insights`**の**スキャン**と**`Infrastructure`**の**スキャン**を実行し、セキュリティに関連する興味深い情報を**ハイライト**します。
* [ ] セキュリティのミス構成と興味深い情報を確認してください

## Turnstile

TODO

## **ゼロトラスト**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## バルクリダイレクト

{% hint style="info" %}
[**バルクリダイレクト**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/)は、[ダイナミックリダイレクト](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/)とは異なり、基本的には静的です。つまり、文字列の置換操作や正規表現は**サポートされていません**。ただし、URLの一致動作と実行時の動作に影響を与えるURLリダイレクトパラメータを構成できます。
{% endhint %}

* [ ] リダイレクトの**式**と**要件**が**意味をなしているか**確認してください。
* [ ] また、興味深い情報を含む**機密の隠されたエンドポイント**も確認してください。

## 通知

* [ ] **通知**を確認してください。これらの通知はセキュリティ上推奨されます：
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] **宛先**をすべて確認し、ウェブフックURLに**機密情報**（基本的なHTTP認証）が含まれていないことを確認してください。また、ウェブフックURLが**HTTPS**を使用していることも確認してください。
* [ ] 追加のチェックとして、クラウドフレアの通知を第三者に**なりすます**ことができるかどうかを試してみることもできます。おそらく、何か危険なものを**注入**する方法があるかもしれません。
## アカウントの管理

* [ ] **`Billing` -> `Payment info`** で、クレジットカードの**最後の4桁**、**有効期限**、**請求先住所**を確認することができます。
* [ ] **`Billing` -> `Subscriptions`** で、アカウントで使用されている**プランの種類**を確認することができます。
* [ ] **`Members`** では、アカウントのすべてのメンバーとその**役割**を確認することができます。ただし、プランの種類がEnterpriseでない場合、管理者とスーパー管理者の2つの役割しか存在しません。しかし、使用されている**プランがEnterprise**の場合、[**さらに多くの役割**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/)を使用して、最小特権の原則に従うことができます。
* したがって、可能な限り**Enterpriseプラン**を使用することが**推奨**されます。
* [ ] Membersでは、**2FAが有効**になっている**メンバー**を確認することができます。**すべての**ユーザーはそれを有効にする必要があります。

{% hint style="info" %}
幸いなことに、**`Administrator`** の役割はメンバーシップの管理権限を与えません（特権のエスカレーションや新しいメンバーの招待はできません）
{% endhint %}

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* **HackTricksで企業の広告を見たい**場合や、**PEASSの最新バージョンにアクセスしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をご確認ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを楽しみましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**してください。
* **HackTricks**と**HackTricks Cloud**のgithubリポジトリにPRを提出して、あなたのハッキングトリックを共有してください。

</details>
