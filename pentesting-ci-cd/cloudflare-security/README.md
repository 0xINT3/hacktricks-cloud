# Seguridad de Cloudflare

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de Github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

En una cuenta de Cloudflare hay algunas **configuraciones y servicios generales** que se pueden configurar. En esta página vamos a **analizar las configuraciones relacionadas con la seguridad de cada sección:**

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## Sitios web

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Registro de dominios

* [ ] En **`Transferir dominios`** comprueba que no sea posible transferir ningún dominio.

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Análisis

_No pude encontrar nada para revisar en una revisión de seguridad de configuración._

## Páginas

En cada página de Cloudflare:

* [ ] Comprueba si hay **información sensible** en el **`Registro de compilación`**.
* [ ] Comprueba si hay **información sensible** en el **repositorio de Github** asignado a las páginas.
* [ ] Comprueba si hay una posible **compromiso del repositorio de Github** a través de la **inyección de comandos de flujo de trabajo** o el compromiso de **`pull_request_target`**. Más información en la [**página de seguridad de Github**](../github-security/).
* [ ] Comprueba si hay **funciones vulnerables** en el directorio `/fuctions` (si lo hay), comprueba las **redirecciones** en el archivo `_redirects` (si lo hay) y las **cabeceras mal configuradas** en el archivo `_headers` (si lo hay).
* [ ] Comprueba si hay **vulnerabilidades** en la **página web** a través de **blackbox** o **whitebox** si puedes **acceder al código**.
* [ ] En los detalles de cada página \*\*\*\* `/<page_id>/pages/view/blocklist/settings/functions`. Comprueba si hay **información sensible** en las **`Variables de entorno`**.
* [ ] En la página de detalles, comprueba también el **comando de compilación** y el **directorio raíz** para **posibles inyecciones** para comprometer la página.

## **Workers**

En cada worker de Cloudflare, comprueba:

* [ ] Los desencadenantes: ¿Qué hace que el trabajador se active? ¿Puede un **usuario enviar datos** que serán **utilizados** por el trabajador?
* [ ] En **`Configuración`**, comprueba si hay **`Variables`** que contengan **información sensible**.
* [ ] Comprueba el **código del trabajador** y busca **vulnerabilidades** (especialmente en lugares donde el usuario puede gestionar la entrada).
  * Comprueba si hay SSRFs que devuelvan la página indicada que puedes controlar.
  * Comprueba si hay XSSs que ejecuten JS dentro de una imagen svg.

{% hint style="warning" %}
Ten en cuenta que por defecto se le da a un **Worker una URL** como `<worker-name>.<account>.workers.dev`. El usuario puede establecerlo en un **subdominio**, pero siempre puedes acceder a él con esa **URL original** si la conoces.
{% endhint %}

## R2

POR HACER

## Stream

POR HACER

## Imágenes

POR HACER

## Centro de seguridad

* [ ] Si es posible, ejecuta un **análisis de `Security Insights`** y un **análisis de `Infraestructura`**, ya que **destacarán** información interesante en cuanto a **seguridad**.
  * [ ] Solo **comprueba esta información** para las configuraciones de seguridad y la información interesante.

## Turnstile

POR HACER

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Redirecciones masivas

{% hint style="info" %}
A diferencia de las [Redirecciones dinámicas](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Redirecciones masivas**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) son esencialmente estáticas, no admiten ninguna operación de **reemplazo de cadena** ni expresiones regulares. Sin embargo, puede configurar parámetros de redireccionamiento de URL que afectan su comportamiento de coincidencia de URL y su comportamiento en tiempo de ejecución.
{% endhint %}

* [ ] Comprueba que las **expresiones** y los **requisitos** para las redirecciones **tengan sentido**.
* [ ] Comprueba también si hay **puntos finales ocultos sensibles** que contengan información interesante.

## Notificaciones

* [ ] Comprueba las **notificaciones**. Estas notificaciones son recomendadas para la seguridad:
  * `Facturación basada en el uso`
  * `Alerta de ataque HTTP DDoS`
  * `Alerta de ataque de capa 3/4 DDoS`
  * `Alerta de ataque HTTP DDoS avanzado`
  * `Alerta de ataque de capa 3/4 DDoS avanzado`
  * `Monitorización basada en el flujo: Ataque volumétrico`
  * `Alerta de detección de fuga de ruta`
  * `Alerta de caducidad del certificado mTLS de acceso`
  * `Alerta de nombres de host personalizados SSL para SaaS`
  * `Alerta de SSL universal`
  * `Alerta de detección de cambio de código nuevo del monitor de scripts`
  * `Alerta de nuevo dominio del monitor de scripts`
  * `Alerta de nuevo dominio malicioso del monitor de scripts`
  * `Alerta de nuevo script malicioso del monitor de scripts`
  * `Alerta de nueva URL maliciosa del monitor de scripts`
  * `Alerta de nuevos scripts del monitor de scripts`
  * `Alerta de nuevo script que excede la longitud máxima de URL del monitor de scripts`
  * `Alerta de eventos de seguridad avanzados`
  * `Alerta de eventos de seguridad`
* [ ] Comprueba todos los **destinos**, ya que puede haber **información sensible** (autenticación básica http) en las URL de webhook. Asegúrate también de que las URL de webhook usen **HTTPS**.
  * [ ] Como comprobación adicional, podrías intentar **suplantar una notificación de Cloudflare** a un tercero, tal vez puedas **inyectar algo peligroso**.

## Administrar cuenta

* [ ] Es posible ver los **últimos 4 dígitos de la tarjeta de crédito**, la **fecha de caducidad** y la **dirección de facturación** en **`Facturación` -> `Información de pago`**.
* [ ] Es posible ver el **tipo de plan