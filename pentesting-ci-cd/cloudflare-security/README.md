# Cloudflare セキュリティ

<details>

<summary><strong>AWS ハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* HackTricks にあなたの**会社を広告したい**、または**HackTricks を PDF でダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式 PEASS & HackTricks グッズ**](https://peass.creator-spring.com)を入手する
* [**PEASS ファミリー**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクション
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) に**参加する**か、[**テレグラムグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) の github リポジトリに PR を提出して、あなたのハッキングのコツを**共有する**。

</details>

Cloudflare アカウントには、設定可能な**一般的な設定とサービス**がいくつかあります。このページでは、各セクションのセキュリティ関連の設定を**分析します**：

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## ウェブサイト

以下で各項目をレビューしてください：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### ドメイン登録

* [ ] **`ドメインの移管`** で、ドメインを移管できないことを確認してください。

以下で各項目をレビューしてください：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## アナリティクス

_設定のセキュリティレビューにチェックする項目は見つかりませんでした。_

## ページ

Cloudflare の各ページで：

* [ ] **`ビルドログ`** に**機密情報**がないかチェックしてください。
* [ ] ページに割り当てられた **Github リポジトリ** に**機密情報**がないかチェックしてください。
* [ ] **ワークフローコマンドインジェクション**または `pull_request_target` の妥協を介した潜在的な github リポジトリの妥協をチェックしてください。詳細は [**Github セキュリティページ**](../github-security/) を参照してください。
* [ ] `/functions` ディレクトリ内の**脆弱な関数**（ある場合）、`_redirects` ファイル内の**リダイレクト**（ある場合）、および `_headers` ファイル内の**誤設定されたヘッダー**（ある場合）をチェックしてください。
* [ ] **ウェブページ**の**脆弱性**を、コードに**アクセスできる**場合は**ブラックボックス**または**ホワイトボックス**でチェックしてください。
* [ ] 各ページの詳細 `/<page_id>/pages/view/blocklist/settings/functions` で、**`環境変数`** に**機密情報**がないかチェックしてください。
* [ ] 詳細ページでも、ページを妥協する可能性のある**ビルドコマンド**と**ルートディレクトリ**をチェックしてください。

## **ワーカー**

Cloudflare の各ワーカーでチェックしてください：

* [ ] トリガー：何がワーカーをトリガーしますか？ユーザーはワーカーが**使用する**データを**送信**できますか？
* [ ] **`設定`** で、**機密情報**を含む**`変数`** をチェックしてください。
* [ ] ワーカーの**コード**をチェックし、ユーザーが入力を管理できる場所で**脆弱性**を探してください。
* 制御できる指定されたページを返す SSRF をチェックしてください。
* SVG 画像内で JS を実行する XSS をチェックしてください。

{% hint style="warning" %}
デフォルトでは、**ワーカーには** `<worker-name>.<account>.workers.dev` のような**URL が与えられます**。ユーザーはそれを**サブドメイン**に設定できますが、それを知っていれば、常にその**元の URL**でアクセスできます。
{% endhint %}

## R2

TODO

## ストリーム

TODO

## イメージ

TODO

## セキュリティセンター

* [ ] 可能であれば、**`セキュリティインサイト`** **スキャン**と**`インフラ`** **スキャン**を実行してください。これらはセキュリティ面で興味深い情報を**強調表示**します。
* [ ] この情報をセキュリティの誤設定と興味深い情報について**チェックしてください**

## ターンスタイル

TODO

## **ゼロトラスト**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## バルクリダイレクト

{% hint style="info" %}
[ダイナミックリダイレクト](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/)とは異なり、[**バルクリダイレクト**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/)は基本的に静的です — 文字列の置換操作や正規表現は**サポートしていません**。ただし、URL マッチングの動作とランタイムの動作に影響を与える URL リダイレクトパラメータを設定できます。
{% endhint %}

* [ ] リダイレクトのための**表現**と**要件**が**意味をなしている**ことを確認してください。
* [ ] 興味深い情報を含む可能性のある**機密の隠されたエンドポイント**もチェックしてください。

## 通知

* [ ] **通知**をチェックしてください。これらの通知はセキュリティに推奨されます：
* `使用量ベースの課金`
* `HTTP DDoS 攻撃アラート`
* `レイヤー 3/4 DDoS 攻撃アラート`
* `高度な HTTP DDoS 攻撃アラート`
* `高度なレイヤー 3/4 DDoS 攻撃アラート`
* `フローベースの監視：ボリューメトリックアタック`
* `ルートリーク検出アラート`
* `アクセス mTLS 証明書の有効期限アラート`
* `SSL for SaaS カスタムホスト名アラート`
* `ユニバーサル SSL アラート`
* `スクリプトモニター新しいコード変更検出アラート`
* `スクリプトモニター新しいドメインアラート`
* `スクリプトモニター新しい悪意のあるドメインアラート`
* `スクリプトモニター新しい悪意のあるスクリプトアラート`
* `スクリプトモニター新しい悪意のある URL アラート`
* `スクリプトモニター新しいスクリプトアラート`
* `スクリプトモニター新しいスクリプトが最大 URL 長を超えるアラート`
* `高度なセキュリティイベントアラート`
* `セキュリティイベントアラート`
* [ ] すべての**宛先**をチェックしてください。webhook の URL に**機密情報**（基本的な http 認証）が含まれている可能性があります。webhook の URL が**HTTPS**を使用していることも確認してください。
* [ ] さらなるチェックとして、第三者に対して**cloudflare 通知を偽装**しようとすることができます。何らかの形で**危険なものを注入**できるかもしれません。
## アカウント管理

* [ ] **`Billing` -> `Payment info`** で、クレジットカードの**最後の4桁**、**有効期限**、および**請求先住所**を確認できます。
* [ ] **`Billing` -> `Subscriptions`** で、アカウントで使用されている**プランの種類**を確認できます。
* [ ] **`Members`** では、アカウントの全メンバーと彼らの**役割**を確認できます。プランの種類がEnterpriseでない場合、存在する役割はAdministratorとSuper Administratorのみです。しかし、使用されている**プランがEnterprise**の場合、[**さらに多くの役割**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/)が利用可能で、最小権限の原則に従うことができます。
* したがって、可能な限り**Enterpriseプラン**の使用を**推奨**します。
* [ ] Membersでは、**2FAを有効にしているメンバー**を確認できます。**すべての**ユーザーがそれを有効にしているべきです。

{% hint style="info" %}
幸いなことに、**`Administrator`** の役割はメンバーシップの管理権限を与えないため（**権限の昇格や新メンバーの招待ができない**）、注意してください。
{% endhint %}

## DDoS調査

[この部分を確認してください](cloudflare-domains.md#cloudflare-ddos-protection)。

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)で<strong>ゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手してください。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見してください。私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションです。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加するか**、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォロー**してください。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有**してください。

</details>
