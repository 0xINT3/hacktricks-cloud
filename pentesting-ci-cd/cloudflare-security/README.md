# Seguridad de Cloudflare

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop).
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>

En una cuenta de Cloudflare, hay algunas **configuraciones y servicios generales** que se pueden configurar. En esta página vamos a **analizar las configuraciones relacionadas con la seguridad de cada sección**:

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## Sitios web

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Registro de dominios

* [ ] En **`Transfer Domains`**, verifica que no sea posible transferir ningún dominio.

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analíticas

_No pude encontrar nada para revisar la configuración de seguridad._

## Páginas

En cada página de Cloudflare:

* [ ] Verifica si hay **información sensible** en el **`Registro de compilación`**.
* [ ] Verifica si hay **información sensible** en el **repositorio de Github** asignado a las páginas.
* [ ] Verifica si hay una posible compromiso del repositorio de Github a través de una **inyección de comandos de flujo de trabajo** o una compromiso de `pull_request_target`. Más información en la [**página de seguridad de Github**](../github-security/).
* [ ] Verifica si hay **funciones vulnerables** en el directorio `/fuctions` (si existe), verifica las **redirecciones** en el archivo `_redirects` (si existe) y las **cabeceras mal configuradas** en el archivo `_headers` (si existe).
* [ ] Verifica si hay **vulnerabilidades** en la **página web** a través de **blackbox** o **whitebox** si puedes **acceder al código**.
* [ ] En los detalles de cada página `/<page_id>/pages/view/blocklist/settings/functions`, verifica si hay **información sensible** en las **`Variables de entorno`**.
* [ ] En la página de detalles, verifica también el **comando de compilación** y el **directorio raíz** para **posibles inyecciones** que comprometan la página.

## **Workers**

En cada worker de Cloudflare, verifica:

* [ ] Los desencadenantes: ¿Qué hace que el worker se active? ¿Un **usuario puede enviar datos** que serán **utilizados** por el worker?
* [ ] En **`Configuración`**, verifica si hay **`Variables`** que contengan **información sensible**.
* [ ] Verifica el **código del worker** y busca **vulnerabilidades** (especialmente en lugares donde el usuario puede gestionar la entrada).
* Verifica SSRFs que devuelvan la página indicada que puedes controlar.
* Verifica XSSs ejecutando JS dentro de una imagen svg.

{% hint style="warning" %}
Ten en cuenta que de forma predeterminada, a un **Worker se le asigna una URL** como `<nombre-del-worker>.<cuenta>.workers.dev`. El usuario puede configurarlo como un **subdominio**, pero siempre puedes acceder a él con esa **URL original** si la conoces.
{% endhint %}

## R2

POR HACER

## Stream

POR HACER

## Imágenes

POR HACER

## Centro de seguridad

* [ ] Si es posible, ejecuta un **escaneo de** **`Security Insights`** y un **escaneo de** **`Infraestructura`**, ya que resaltarán información interesante en términos de seguridad.
* [ ] Solo **verifica esta información** en busca de configuraciones de seguridad incorrectas e información interesante.

## Turnstile

POR HACER

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Redirecciones masivas

{% hint style="info" %}
A diferencia de las [Redirecciones dinámicas](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), las [**Redirecciones masivas**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) son esencialmente estáticas, no admiten ninguna operación de reemplazo de cadenas ni expresiones regulares. Sin embargo, puedes configurar parámetros de redirección de URL que afectan su comportamiento de coincidencia de URL y su comportamiento en tiempo de ejecución.
{% endhint %}

* [ ] Verifica que las **expresiones** y **requisitos** para las redirecciones **tengan sentido**.
* [ ] Verifica también si hay **puntos finales ocultos sensibles** que contengan información interesante.

## Notificaciones

* [ ] Verifica las **notificaciones**. Estas notificaciones se recomiendan para la seguridad:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Verifica todos los **destinos**, ya que puede haber **información sensible** (autenticación básica HTTP) en las URL de webhook. Asegúrate también de que las URL de webhook usen **HTTPS**.
* [ ] Como verificación adicional, podrías intentar **suplantar una notificación de Cloudflare** a un tercero, tal vez puedas **inyectar algo peligroso** de alguna manera.
## Administrar cuenta

* [ ] Es posible ver los **últimos 4 dígitos de la tarjeta de crédito**, la **fecha de vencimiento** y la **dirección de facturación** en **`Facturación` -> `Información de pago`**.
* [ ] Es posible ver el **tipo de plan** utilizado en la cuenta en **`Facturación` -> `Suscripciones`**.
* [ ] En **`Miembros`** es posible ver todos los miembros de la cuenta y su **rol**. Tenga en cuenta que si el tipo de plan no es Enterprise, solo existen 2 roles: Administrador y Superadministrador. Pero si se utiliza un **plan Enterprise**, se pueden utilizar [**más roles**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) para seguir el principio de privilegio mínimo.
* Por lo tanto, siempre que sea posible, se **recomienda** utilizar el **plan Enterprise**.
* [ ] En Miembros es posible verificar qué **miembros** tienen habilitada la **autenticación de dos factores (2FA)**. **Todos** los usuarios deberían tenerla habilitada.

{% hint style="info" %}
Tenga en cuenta que afortunadamente el rol **`Administrador`** no otorga permisos para administrar membresías (**no puede aumentar privilegios ni invitar** nuevos miembros).
{% endhint %}

## Investigación de DDoS

[Ver esta parte](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF**, ¡consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PR a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
