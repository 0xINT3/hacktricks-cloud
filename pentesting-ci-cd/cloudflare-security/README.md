# Cloudflare 安全性

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为英雄</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 **HackTricks 中看到您的公司广告** 或 **下载 HackTricks 的 PDF**，请查看 [**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上 **关注** 我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>

在 Cloudflare 账户中，可以配置一些**通用设置和服务**。在此页面中，我们将**分析每个部分的与安全相关的设置**：

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## 网站

使用以下内容进行审查：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### 域名注册

* [ ] 在 **`Transfer Domains`** 中检查是否不可能转移任何域名。

使用以下内容进行审查：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## 分析

_我找不到任何配置安全审查的内容。_

## 页面

在每个 Cloudflare 的页面上：

* [ ] 在 **`Build log`** 中检查**敏感信息**。
* [ ] 在分配给页面的 **Github 仓库** 中检查**敏感信息**。
* [ ] 通过 **workflow 命令注入** 或 `pull_request_target` 妥协检查潜在的 github 仓库妥协。更多信息请参见 [**Github 安全页面**](../github-security/)。
* [ ] 在 `/functions` 目录中检查**易受攻击的函数**（如果有），检查 `_redirects` 文件中的**重定向**（如果有）和 `_headers` 文件中的**配置错误的头部**（如果有）。
* [ ] 如果您可以**访问代码**，通过**黑盒**或**白盒**检查**网页**中的**漏洞**。
* [ ] 在每个页面的详细信息 `/<page_id>/pages/view/blocklist/settings/functions` 中，检查**`环境变量`**中的**敏感信息**。
* [ ] 在详细信息页面还要检查**构建命令**和**根目录**，以寻找**潜在注入**，可能会妥协页面。

## **Workers**

在每个 Cloudflare 的 worker 上检查：

* [ ] 触发器：是什么让 worker 触发？用户能否发送将被 worker **使用**的**数据**？
* [ ] 在 **`设置`** 中，检查是否有包含**敏感信息**的**`变量`**。
* [ ] 检查 worker 的**代码**并搜索**漏洞**（特别是在用户可以管理输入的地方）
* 检查 SSRFs 是否返回您可以控制的指定页面
* 检查 XSSs 是否在 svg 图像内执行 JS

{% hint style="warning" %}
请注意，默认情况下，**Worker 会被赋予一个 URL**，例如 `<worker-name>.<account>.workers.dev`。用户可以将其设置为**子域名**，但如果您知道它，您始终可以使用该**原始 URL**访问它。
{% endhint %}

## R2

待办事项

## 流

待办事项

## 图片

待办事项

## 安全中心

* [ ] 如果可能，运行**`安全洞察`** **扫描**和**`基础设施`** **扫描**，因为它们会**突出显示**与**安全**相关的有趣信息。
* [ ] 只需**检查这些信息**是否有安全配置错误和有趣的信息

## Turnstile

待办事项

## **零信任**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## 批量重定向

{% hint style="info" %}
与[动态重定向](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/)不同，[**批量重定向**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/)本质上是静态的 — 它们**不支持任何字符串替换**操作或正则表达式。但是，您可以配置影响其 URL 匹配行为和运行时行为的 URL 重定向参数。
{% endhint %}

* [ ] 检查重定向的**表达式**和**要求**是否**合理**。
* [ ] 还要检查是否有**隐藏的敏感端点**，您可能包含有趣的信息。

## 通知

* [ ] 检查**通知**。这些通知对于安全来说是推荐的：
* `基于使用量的计费`
* `HTTP DDoS 攻击警报`
* `第 3/4 层 DDoS 攻击警报`
* `高级 HTTP DDoS 攻击警报`
* `高级第 3/4 层 DDoS 攻击警报`
* `基于流量的监控：体量攻击`
* `路由泄露检测警报`
* `访问 mTLS 证书到期警报`
* `SSL for SaaS 自定义主机名警报`
* `通用 SSL 警报`
* `脚本监控新代码变更检测警报`
* `脚本监控新域名警报`
* `脚本监控新恶意域名警报`
* `脚本监控新恶意脚本警报`
* `脚本监控新恶意 URL 警报`
* `脚本监控新脚本警报`
* `脚本监控新脚本超过最大 URL 长度警报`
* `高级安全事件警报`
* `安全事件警报`
* [ ] 检查所有**目的地**，因为 webhook urls 中可能有**敏感信息**（基本 http 认证）。还要确保 webhook urls 使用**HTTPS**
* [ ] 作为额外检查，您可以尝试**冒充 Cloudflare 通知**给第三方，也许您可以以某种方式**注入危险的东西**
## 管理账户

* [ ] 可以在 **`Billing` -> `Payment info`** 中看到**信用卡的最后4位数字**、**有效期**和**账单地址**。
* [ ] 可以在 **`Billing` -> `Subscriptions`** 中看到账户使用的**套餐类型**。
* [ ] 在 **`Members`** 中可以看到所有账户成员及其**角色**。注意，如果套餐类型不是企业版，只存在2种角色：管理员和超级管理员。但如果使用的**套餐是企业版**，可以使用[**更多角色**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/)来遵循最小权限原则。
* 因此，建议尽可能使用**企业版套餐**。
* [ ] 在 Members 中可以检查哪些**成员**启用了**双因素认证**。**每个**用户都应该启用它。

{% hint style="info" %}
注意，幸运的是角色 **`Administrator`** 不授予管理成员资格的权限（**不能升级权限或邀请**新成员）
{% endhint %}

## DDoS 调查

[查看这部分](cloudflare-domains.md#cloudflare-ddos-protection)。

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> 从零到英雄学习 AWS 黑客攻击！</strong></summary>

支持 HackTricks 的其他方式：

* 如果你想在 HackTricks 中看到你的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs**](https://opensea.io/collection/the-peass-family) 收藏
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享你的黑客技巧。

</details>
