# S√©curit√© Cloudflare

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs exclusifs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

Dans un compte Cloudflare, il existe certains **param√®tres g√©n√©raux et services** qui peuvent √™tre configur√©s. Sur cette page, nous allons **analyser les param√®tres li√©s √† la s√©curit√© de chaque section :**

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## Sites Web

Examinez chacun avec :

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Enregistrement de Domaine

* [ ] Dans **`Transfer Domains`**, v√©rifiez qu'il n'est pas possible de transf√©rer un domaine.

Examinez chacun avec :

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytique

_Je n'ai rien trouv√© √† v√©rifier pour une revue de s√©curit√© de configuration._

## Pages

Sur chaque page de Cloudflare :

* [ ] V√©rifiez la pr√©sence d'**informations sensibles** dans le **`Build log`**.
* [ ] V√©rifiez la pr√©sence d'**informations sensibles** dans le **d√©p√¥t Github** associ√© aux pages.
* [ ] V√©rifiez un √©ventuel compromis du d√©p√¥t github via **l'injection de commande dans le workflow** ou un compromis `pull_request_target`. Plus d'infos sur la [**page S√©curit√© Github**](../github-security/).
* [ ] V√©rifiez les **fonctions vuln√©rables** dans le r√©pertoire `/functions` (le cas √©ch√©ant), v√©rifiez les **redirections** dans le fichier `_redirects` (le cas √©ch√©ant) et les **en-t√™tes mal configur√©s** dans le fichier `_headers` (le cas √©ch√©ant).
* [ ] V√©rifiez les **vuln√©rabilit√©s** sur la **page web** via **blackbox** ou **whitebox** si vous pouvez **acc√©der au code**
* [ ] Dans les d√©tails de chaque page `/<page_id>/pages/view/blocklist/settings/functions`. V√©rifiez la pr√©sence d'**informations sensibles** dans les **`Variables d'environnement`**.
* [ ] Dans la page de d√©tails, v√©rifiez √©galement la **commande de build** et le **r√©pertoire racine** pour d'√©ventuelles **injections** pouvant compromettre la page.

## **Workers**

Sur chaque worker de Cloudflare, v√©rifiez :

* [ ] Les d√©clencheurs : Qu'est-ce qui active le worker ? Un **utilisateur peut-il envoyer des donn√©es** qui seront **utilis√©es** par le worker ?
* [ ] Dans les **`Param√®tres`**, v√©rifiez les **`Variables`** contenant des **informations sensibles**
* [ ] V√©rifiez le **code du worker** et recherchez des **vuln√©rabilit√©s** (surtout dans les endroits o√π l'utilisateur peut g√©rer l'entr√©e)
* V√©rifiez les SSRFs renvoyant la page indiqu√©e que vous pouvez contr√¥ler
* V√©rifiez les XSS ex√©cutant du JS √† l'int√©rieur d'une image svg

{% hint style="warning" %}
Notez que par d√©faut, un **Worker se voit attribuer une URL** telle que `<worker-name>.<account>.workers.dev`. L'utilisateur peut le configurer sur un **sous-domaine** mais vous pouvez toujours y acc√©der avec cette **URL originale** si vous la connaissez.
{% endhint %}

## R2

TODO

## Stream

TODO

## Images

TODO

## Centre de S√©curit√©

* [ ] Si possible, effectuez un **scan `Security Insights`** et un **scan `Infrastructure`**, car ils mettront en √©vidence des informations int√©ressantes du point de vue de la **s√©curit√©**.
* [ ] V√©rifiez simplement ces informations pour des mauvaises configurations de s√©curit√© et des infos int√©ressantes

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Redirections en Masse

{% hint style="info" %}
Contrairement aux [Redirections Dynamiques](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), les [**Redirections en Masse**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) sont essentiellement statiques ‚Äî elles ne **supportent aucune op√©ration de remplacement de cha√Æne** ou expressions r√©guli√®res. Cependant, vous pouvez configurer des param√®tres de redirection d'URL qui affectent leur comportement de correspondance d'URL et leur comportement d'ex√©cution.
{% endhint %}

* [ ] V√©rifiez que les **expressions** et les **exigences** pour les redirections **sont logiques**.
* [ ] V√©rifiez √©galement la pr√©sence d'**extr√©mit√©s cach√©es sensibles** qui pourraient contenir des informations int√©ressantes.

## Notifications

* [ ] V√©rifiez les **notifications.** Ces notifications sont recommand√©es pour la s√©curit√© :
* `Facturation Bas√©e sur l'Utilisation`
* `Alerte d'Attaque DDoS HTTP`
* `Alerte d'Attaque DDoS de Couche 3/4`
* `Alerte d'Attaque DDoS HTTP Avanc√©e`
* `Alerte d'Attaque DDoS de Couche 3/4 Avanc√©e`
* `Surveillance Bas√©e sur le Flux : Attaque Volum√©trique`
* `Alerte de D√©tection de Fuite de Route`
* `Alerte d'Expiration de Certificat mTLS d'Acc√®s`
* `Alerte de Noms d'H√¥te Personnalis√©s SSL pour SaaS`
* `Alerte SSL Universel`
* `Alerte de D√©tection de Changement de Code de Moniteur de Script`
* `Alerte de Nouveau Domaine de Moniteur de Script`
* `Alerte de Nouveau Domaine Malveillant de Moniteur de Script`
* `Alerte de Nouveau Script Malveillant de Moniteur de Script`
* `Alerte de Nouvelle URL Malveillante de Moniteur de Script`
* `Alerte de Nouveaux Scripts de Moniteur de Script`
* `Alerte de Script de Moniteur de Script D√©passant la Longueur Maximale d'URL`
* `Alerte d'√âv√©nements de S√©curit√© Avanc√©s`
* `Alerte d'√âv√©nements de S√©curit√©`
* [ ] V√©rifiez toutes les **destinations**, car il pourrait y avoir des **informations sensibles** (authentification http de base) dans les URL de webhook. Assurez-vous √©galement que les URL de webhook utilisent **HTTPS**
* [ ] Comme v√©rification suppl√©mentaire, vous pourriez essayer d'**usurper une notification cloudflare** √† un tiers, peut-√™tre pouvez-vous **injecter quelque chose de dangereux**
## G√©rer le compte

* [ ] Il est possible de voir les **4 derniers chiffres de la carte de cr√©dit**, la date d'**expiration** et l'**adresse de facturation** dans **`Facturation` -> `Informations de paiement`**.
* [ ] Il est possible de voir le **type d'abonnement** utilis√© dans le compte dans **`Facturation` -> `Abonnements`**.
* [ ] Dans **`Membres`**, il est possible de voir tous les membres du compte et leur **r√¥le**. Notez que si le type d'abonnement n'est pas Entreprise, seulement 2 r√¥les existent : Administrateur et Super Administrateur. Mais si l'**abonnement utilis√© est Entreprise**, [**plus de r√¥les**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) peuvent √™tre utilis√©s pour suivre le principe du moindre privil√®ge.
* Par cons√©quent, il est **recommand√©** d'utiliser l'**abonnement Entreprise** lorsque c'est possible.
* [ ] Dans Membres, il est possible de v√©rifier quels **membres** ont **l'authentification √† deux facteurs (2FA) activ√©e**. **Chaque** utilisateur devrait l'avoir activ√©e.

{% hint style="info" %}
Notez que, heureusement, le r√¥le **`Administrateur`** ne donne pas les permissions de g√©rer les adh√©sions (**ne peut pas augmenter les privil√®ges ou inviter** de nouveaux membres)
{% endhint %}

## Enqu√™te DDoS

[Consultez cette partie](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
