# Seguran√ßa do Cloudflare

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no Github.

</details>

Em uma conta do Cloudflare, existem algumas **configura√ß√µes e servi√ßos gerais** que podem ser configurados. Nesta p√°gina, vamos **analisar as configura√ß√µes relacionadas √† seguran√ßa de cada se√ß√£o:**

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## Websites

Revise cada um com:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Registro de dom√≠nio

* [ ] Em **`Transfer Domains`**, verifique se n√£o √© poss√≠vel transferir nenhum dom√≠nio.

Revise cada um com:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_N√£o encontrei nada para verificar em uma revis√£o de seguran√ßa de configura√ß√£o._

## Pages

Em cada p√°gina do Cloudflare:

* [ ] Verifique se h√° **informa√ß√µes confidenciais** no **`Build log`**.
* [ ] Verifique se h√° **informa√ß√µes confidenciais** no **reposit√≥rio Github** atribu√≠do √†s p√°ginas.
* [ ] Verifique se h√° comprometimento potencial do reposit√≥rio Github por meio de **inje√ß√£o de comando de fluxo de trabalho** ou comprometimento de **`pull_request_target`**. Mais informa√ß√µes na [**p√°gina de seguran√ßa do Github**](../github-security/).
* [ ] Verifique se h√° **fun√ß√µes vulner√°veis** no diret√≥rio `/fuctions` (se houver), verifique os **redirecionamentos** no arquivo `_redirects` (se houver) e **cabe√ßalhos mal configurados** no arquivo `_headers` (se houver).
* [ ] Verifique se h√° **vulnerabilidades** na **p√°gina da web** por meio de **blackbox** ou **whitebox** se voc√™ puder **acessar o c√≥digo**
* [ ] Nos detalhes de cada p√°gina \*\*\*\* `/<page_id>/pages/view/blocklist/settings/functions`. Verifique se h√° **informa√ß√µes confidenciais** nas **`Vari√°veis de ambiente`**.
* [ ] Na p√°gina de detalhes, verifique tamb√©m o **comando de constru√ß√£o** e o **diret√≥rio raiz** para **inje√ß√µes potenciais** para comprometer a p√°gina.

## **Workers**

Em cada worker do Cloudflare, verifique:

* [ ] Os gatilhos: o que faz o worker disparar? Um **usu√°rio pode enviar dados** que ser√£o **usados** pelo worker?
* [ ] Em **`Configura√ß√µes`**, verifique se h√° **`Vari√°veis`** contendo **informa√ß√µes confidenciais**
* [ ] Verifique o **c√≥digo do worker** e procure por **vulnerabilidades** (especialmente em lugares onde o usu√°rio pode gerenciar a entrada)
  * Verifique SSRFs que retornam a p√°gina indicada que voc√™ pode controlar
  * Verifique XSSs executando JS dentro de uma imagem svg

{% hint style="warning" %}
Observe que, por padr√£o, um **Worker √© fornecido com um URL** como `<worker-name>.<account>.workers.dev`. O usu√°rio pode definir um **subdom√≠nio**, mas voc√™ sempre pode acess√°-lo com esse **URL original** se souber.
{% endhint %}

## R2

TODO

## Stream

TODO

## Images

TODO

## Security Center

* [ ] Se poss√≠vel, execute uma **verifica√ß√£o de** **`Security Insights`** e uma **verifica√ß√£o de** **`Infraestrutura`**, pois elas destacar√£o informa√ß√µes interessantes relacionadas √† **seguran√ßa**.
  * [ ] Apenas **verifique essas informa√ß√µes** para configura√ß√µes de seguran√ßa incorretas e informa√ß√µes interessantes

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
Ao contr√°rio dos [Redirecionamentos Din√¢micos](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Redirecionamentos em Massa**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) s√£o essencialmente est√°ticos - eles **n√£o suportam nenhuma opera√ß√£o de substitui√ß√£o de string** ou express√µes regulares. No entanto, voc√™ pode configurar par√¢metros de redirecionamento de URL que afetam seu comportamento de correspond√™ncia de URL e seu comportamento em tempo de execu√ß√£o.
{% endhint %}

* [ ] Verifique se as **express√µes** e **requisitos** para redirecionamentos **fazem sentido**.
* [ ] Verifique tamb√©m se h√° **pontos finais ocultos confidenciais** que contenham informa√ß√µes interessantes.

## Notifica√ß√µes

* [ ] Verifique as **notifica√ß√µes**. Essas notifica√ß√µes s√£o recomendadas para seguran√ßa:
  * `Uso baseado em faturamento`
  * `Alerta de ataque HTTP DDoS`
  * `Alerta de ataque de camada 3/4 DDoS`
  * `Alerta de ataque HTTP DDoS avan√ßado`
  * `Alerta de ataque de camada 3/4 DDoS avan√ßado`
  * `Monitoramento baseado em fluxo: Ataque volum√©trico`
  * `Alerta de detec√ß√£o de vazamento de rota`
  * `Alerta de expira√ß√£o de certificado mTLS de acesso`
  * `Alerta de nomes de host personalizados SSL para SaaS`
  * `Alerta SSL universal`
  * `Alerta de detec√ß√£o de nova altera√ß√£o de c√≥digo do monitor de script`
  * `Alerta de novo dom√≠nio do monitor de script`
  * `Alerta de novo dom√≠nio malicioso do monitor de script`
  * `Alerta de novo script malicioso do monitor de script`
  * `Alerta de novo URL malicioso do monitor de script`
  * `Alerta de novos scripts do monitor de script`
  * `Alerta de novo script que excede o comprimento m√°ximo de URL do monitor de script`
  * `Alerta de eventos de seguran√ßa avan√ßados`
  * `Alerta de eventos de seguran√ßa`
* [ ] Verifique todos os **destinos**, pois pode haver **informa√ß√µes confidenciais** (autentica√ß√£o b√°sica http) nos URLs de webhook. Certifique-se tamb√©m de que os URLs de webhook usem **HTTPS**
  * [ ] Como verifica√ß√£o extra, voc√™ pode tentar **se passar por uma notifica√ß√£o do Cloudflare** para um terceiro, talvez voc√™ possa de alguma forma **injetar algo perigoso**

## Gerenciar conta

* [ ] √â poss√≠vel ver os **√∫ltimos 4 d√≠gitos do cart√£o de cr√©dito**, o **tempo de expira√ß√£o** e