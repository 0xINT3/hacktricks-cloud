# Cloudflareセキュリティ

<details>

<summary><strong>HackTricksをサポートして特典を受け取る！</strong></summary>

* **HackTricksで会社を宣伝**したい場合や、**最新バージョンのPEASSを入手**したい場合、またはHackTricksをPDFでダウンロードしたい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をご確認ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有する**ために、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

Cloudflareアカウントには、設定できる**一般的な設定とサービス**があります。このページでは、各セクションの**セキュリティ関連の設定**を分析します。

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## ウェブサイト

それぞれを確認してください：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### ドメイン登録

* [ ] **`Transfer Domains`**で、どのドメインも転送できないことを確認してください。

それぞれを確認してください：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## アナリティクス

_構成セキュリティレビューのためのチェック項目は見つかりませんでした。_

## ページ

各Cloudflareのページで以下を確認してください：

* [ ] **`Build log`**に**機密情報**がないか確認してください。
* [ ] ページに割り当てられた**Githubリポジトリ**に**機密情報**がないか確認してください。
* [ ] **ワークフローコマンドインジェクション**または`pull_request_target`の侵害を通じた**潜在的なGithubリポジトリの侵害**を確認してください。詳細は[**Githubセキュリティページ**](../github-security/)を参照してください。
* [ ] `/fuctions`ディレクトリ（存在する場合）の**脆弱な関数**、`_redirects`ファイル（存在する場合）の**リダイレクト**、`_headers`ファイル（存在する場合）の**設定ミスのヘッダー**を確認してください。
* [ ] **ウェブページ**の**ブラックボックス**または**ホワイトボックス**を使用して、**コードにアクセスできる場合**に**脆弱性**を確認してください。
* [ ] 各ページの詳細`/<page_id>/pages/view/blocklist/settings/functions`で、**`Environment variables`**に**機密情報**がないか確認してください。
* [ ] 詳細ページで**ビルドコマンド**と**ルートディレクトリ**も確認し、ページを侵害するための**潜在的なインジェクション**を確認してください。

## **ワーカー**

各Cloudflareのワーカーで以下を確認してください：

* [ ] トリガー：ワーカーをトリガーするものは何ですか？ユーザーがワーカーによって**使用されるデータ**を送信できますか？
* [ ] **`Settings`**で、**機密情報を含む****`Variables`**を確認してください。
* [ ] ワーカーの**コード**を確認し、**脆弱性**を検索してください（特にユーザーが入力を管理できる場所）。
* 指定したページを返すSSRFをチェックしてください
* SVGイメージ内でJSを実行するXSSをチェックしてください

{% hint style="warning" %}
デフォルトでは、**ワーカーにはURL**が割り当てられます（例：`<worker-name>.<account>.workers.dev`）。ユーザーは**サブドメイン**に設定できますが、その**元のURL**を知っていれば常にアクセスできます。
{% endhint %}

## R2

TODO

## Stream

TODO

## Images

TODO

## セキュリティセンター

* [ ] 可能な場合は、**`Security Insights`**の**スキャン**と**`Infrastructure`**の**スキャン**を実行し、セキュリティに関連する興味深い情報を**強調表示**します。
* [ ] セキュリティのミス構成と興味深い情報を確認してください

## Turnstile

TODO

## **ゼロトラスト**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## バルクリダイレクト

{% hint style="info" %}
[**バルクリダイレクト**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/)は、[ダイナミックリダイレクト](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/)とは異なり、基本的には静的です。文字列の置換操作や正規表現は**サポートされていません**。ただし、URLの一致動作と実行時の動作に影響を与えるURLリダイレクトパラメータを設定できます。
{% endhint %}

* [ ] リダイレクトの**式**と**要件**が**意味をなしているか**確認してください。
* [ ] また、興味深い情報を含む**機密の隠されたエンドポイント**も確認してください。

## 通知

* [ ] **通知**を確認してください。以下の通知はセキュリティ上推奨されます：
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] **宛先**をすべて確認し、ウェブフックURLに**機密情報**（基本的なHTTP認証）が含まれていないことを確認してください。また、ウェブフックURLが**HTTPS**を使用していることも確認してください。
* [ ] 追加のチェックとして、クラウドフレアの通知を第三者に**なりすます**ことができるかどうかを試してみることもできます。何らかの危険なものを**注入**する方法があるかもしれません。
## アカウントの管理

* [ ] **クレジットカードの最後の4桁**、**有効期限**、**請求先住所**を**`Billing` -> `Payment info`**で確認できます。
* [ ] アカウントで使用されている**プランタイプ**を**`Billing` -> `Subscriptions`**で確認できます。
* [ ] **`Members`**では、アカウントのすべてのメンバーとその**役割**を確認できます。ただし、プランタイプがEnterpriseでない場合、管理者とスーパー管理者の2つの役割しか存在しません。しかし、使用されている**プランがEnterprise**の場合、[**さらに多くの役割**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/)を使用して最小特権の原則に従うことができます。
* したがって、可能な限り**Enterpriseプラン**を使用することが**推奨**されます。
* [ ] Membersでは、**2FAが有効**になっている**メンバー**を確認できます。**すべての**ユーザーはそれを有効にする必要があります。

{% hint style="info" %}
幸いなことに、**`Administrator`**の役割はメンバーシップの管理（特権のエスカレーションや新しいメンバーの招待）を許可しません。
{% endhint %}

## DDoS調査

[この部分を確認してください](cloudflare-domains.md#cloudflare-ddos-protection).

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* **HackTricksで会社の宣伝を見たい**場合や、**PEASSの最新バージョンにアクセスしたい**場合、または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をご覧ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)、私たちの独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)**または**[**telegramグループ**](https://t.me/peass)**に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**をフォローしてください。**
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)**と**[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)**のgithubリポジトリにPRを提出してください。

</details>
