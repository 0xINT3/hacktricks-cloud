# Bezpieczeństwo Cloudflare

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

W koncie Cloudflare można skonfigurować kilka **ogólnych ustawień i usług**. Na tej stronie przeanalizujemy **ustawienia związane z bezpieczeństwem w każdej sekcji:**

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

## Strony internetowe

Przejrzyj każdą z nich:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Rejestracja domen

* [ ] W **`Transfer Domains`** sprawdź, czy nie można przenieść żadnej domeny.

Przejrzyj każdą z nich:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analiza

_Nie znalazłem niczego, co można by sprawdzić pod kątem bezpieczeństwa konfiguracji._

## Strony

Na każdej stronie Cloudflare:

* [ ] Sprawdź, czy nie ma **wrażliwych informacji** w **`Build log`**.
* [ ] Sprawdź, czy nie ma **wrażliwych informacji** w repozytorium **Github** przypisanym do stron.
* [ ] Sprawdź, czy nie ma możliwości **kompromitacji repozytorium Github** za pomocą **wstrzyknięcia poleceń workflow** lub **kompromitacji pull_request_target**. Więcej informacji na stronie [**Bezpieczeństwo Github**](../github-security/).
* [ ] Sprawdź, czy nie ma **podatnych funkcji** w katalogu `/fuctions` (jeśli istnieją), sprawdź **przekierowania** w pliku `_redirects` (jeśli istnieją) i **błędnie skonfigurowane nagłówki** w pliku `_headers` (jeśli istnieją).
* [ ] Sprawdź, czy nie ma **podatności** na **stronie internetowej** za pomocą **blackbox** lub **whitebox**, jeśli masz **dostęp do kodu**
* [ ] W szczegółach każdej strony `/<page_id>/pages/view/blocklist/settings/functions`. Sprawdź, czy nie ma **wrażliwych informacji** w **`Zmiennych środowiskowych`**.
* [ ] Na stronie szczegółów sprawdź również **polecenie budowania** i **katalog główny** w celu **potencjalnych wstrzyknięć** w celu skompromitowania strony.

## **Pracownicy**

Na każdym pracowniku Cloudflare sprawdź:

* [ ] Wyzwalacze: Co powoduje uruchomienie pracownika? Czy użytkownik może przesłać dane, które będą używane przez pracownika?
* [ ] W **`Ustawieniach`** sprawdź, czy są **`Zmienne`** zawierające **wrażliwe informacje**
* [ ] Sprawdź kod pracownika i wyszukaj **podatności** (szczególnie w miejscach, gdzie użytkownik może zarządzać danymi wejściowymi)
* Sprawdź SSRF zwracającą wskazaną stronę, którą można kontrolować
* Sprawdź XSS wykonujący JS wewnątrz obrazu svg

{% hint style="warning" %}
Należy zauważyć, że domyślnie **Pracownikowi przypisywany jest adres URL** taki jak `<worker-name>.<account>.workers.dev`. Użytkownik może ustawić go jako **poddomenę**, ale zawsze można do niego uzyskać dostęp za pomocą tego **oryginalnego adresu URL**, jeśli go znasz.
{% endhint %}

## R2

TODO

## Stream

TODO

## Obrazy

TODO

## Centrum bezpieczeństwa

* [ ] Jeśli to możliwe, uruchom **skanowanie** **`Security Insights`** i **`Infrastructure`**, ponieważ wyświetlą one interesujące informacje związane z bezpieczeństwem.
* [ ] Sprawdź te informacje pod kątem nieprawidłowej konfiguracji bezpieczeństwa i interesujących informacji

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Przekierowania masowe

{% hint style="info" %}
W przeciwieństwie do [Przekierowań dynamicznych](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Przekierowania masowe**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) są w zasadzie statyczne - **nie obsługują żadnych operacji zastępowania ciągów znaków** ani wyrażeń regularnych. Jednak można skonfigurować parametry przekierowania URL, które wpływają na ich zachowanie w czasie wykonywania i dopasowywanie do adresów URL.
{% endhint %}

* [ ] Sprawdź, czy **wyrażenia** i **wymagania** dla przekierowań mają **sens**.
* [ ] Sprawdź również, czy nie ma **ukrytych punktów końcowych** zawierających interesujące informacje.

## Powiadomienia

* [ ] Sprawdź **powiadomienia**. Następujące powiadomienia są zalecane pod kątem bezpieczeństwa:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Sprawdź wszystkie **miejsca docelowe**, ponieważ mogą zawierać **wrażliwe informacje** (podstawowa autoryzacja HTTP) w adresach URL webhooków. Upewnij się również, że adresy URL webhooków używają **protokołu HTTPS**
* [ ] Dodatkowo, można spróbować **udawać powiadomienie Cloudflare** do strony trzeciej, być może można w jakiś sposób **wstrzyknąć coś niebezpiecznego**

## Zarządzanie kontem

* [ ] Można zobaczyć **ostatnie 4 cyfry karty kredytowej**, **termin ważności** i **adres rozliczeniowy** w **`Billing` -> `Payment info`**.
* [ ] Można zobaczyć **typ planu** używanego w koncie w **`Billing` -> `Subscriptions`**.
* [ ] W **`Members`** można zobaczyć wszystkich członków konta i ich **rolę**. N
## Śledztwo w sprawie ataku DDoS

[Sprawdź tę część](cloudflare-domains.md#ochrona-przed-atakami-ddos-w-cloudflare).

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć **reklamę swojej firmy w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na GitHubie.

</details>
