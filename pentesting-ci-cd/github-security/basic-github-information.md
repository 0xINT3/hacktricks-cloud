# Información básica de Github

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## Estructura básica

La estructura básica del entorno de Github de una **empresa** grande es poseer una **empresa** que posee **varias organizaciones** y cada una de ellas puede contener **varios repositorios** y **varios equipos**. Las empresas más pequeñas pueden tener solo **una organización y no tener empresas**.

Desde el punto de vista del usuario, un **usuario** puede ser **miembro** de **diferentes empresas y organizaciones**. Dentro de ellas, el usuario puede tener **diferentes roles de empresa, organización y repositorio**.

Además, un usuario puede ser **parte de diferentes equipos** con diferentes roles de empresa, organización o repositorio.

Y finalmente, **los repositorios pueden tener mecanismos de protección especiales**.

## Privilegios

### Roles de empresa

* **Propietario de la empresa**: Las personas con este rol pueden **administrar administradores, administrar organizaciones dentro de la empresa, administrar la configuración de la empresa, hacer cumplir la política en todas las organizaciones**. Sin embargo, **no pueden acceder a la configuración o contenido de la organización** a menos que se les haga propietario de la organización o se les dé acceso directo a un repositorio propiedad de la organización.
* **Miembros de la empresa**: Los miembros de las organizaciones propiedad de su empresa también son **automáticamente miembros de la empresa**.

### Roles de organización

En una organización, los usuarios pueden tener diferentes roles:

* **Propietarios de la organización**: Los propietarios de la organización tienen **acceso administrativo completo a su organización**. Este rol debe ser limitado, pero no a menos de dos personas, en su organización.
* **Miembros de la organización**: El **rol predeterminado**, no administrativo, para **las personas en una organización** es el miembro de la organización. Por defecto, los miembros de la organización **tienen varios permisos**.
* **Administradores de facturación**: Los administradores de facturación son usuarios que pueden **administrar la configuración de facturación de su organización**, como la información de pago.
* **Administradores de seguridad**: Es un rol que los propietarios de la organización pueden asignar a cualquier equipo en una organización. Cuando se aplica, otorga a cada miembro del equipo permisos para **administrar alertas y configuraciones de seguridad en toda su organización, así como permisos de lectura para todos los repositorios** de la organización.
  * Si su organización tiene un equipo de seguridad, puede usar el rol de administrador de seguridad para dar a los miembros del equipo el menor acceso que necesitan a la organización.
* **Administradores de aplicaciones de Github**: Para permitir que usuarios adicionales **administren aplicaciones de GitHub propiedad de una organización**, un propietario puede otorgarles permisos de administrador de aplicaciones de GitHub.
* **Colaboradores externos**: Un colaborador externo es una persona que tiene **acceso a uno o más repositorios de la organización pero no es explícitamente un miembro** de la organización.

Puede **comparar los permisos** de estos roles en esta tabla: [https://docs.github.com/en/organizations/managing-peoples-access-to-your-organization-with-roles/roles-in-an-organization#permissions-for-organization-roles](https://docs.github.com/en/organizations/managing-peoples-access-to-your-organization-with-roles/roles-in-an-organization#permissions-for-organization-roles)

### Privilegios de miembros

En _https://github.com/organizations/\<org\_name>/settings/member\_privileges_ puede ver los **permisos que tendrán los usuarios solo por ser parte de la organización**.

La configuración aquí configurada indicará los siguientes permisos de los miembros de la organización:

* Ser administrador, escritor, lector o sin permiso sobre todos los repositorios de la organización.
* Si los miembros pueden crear repositorios privados, internos o públicos.
* Si es posible bifurcar repositorios
* Si es posible invitar colaboradores externos
* Si se pueden publicar sitios públicos o privados
* Los permisos que tienen los administradores sobre los repositorios
* Si los miembros pueden crear nuevos equipos

### Roles de repositorio

Por defecto, se crean roles de repositorio:

* **Lectura**: recomendado para **contribuyentes no relacionados con el código** que desean ver o discutir su proyecto
* **Triage**: recomendado para **contribuyentes que necesitan administrar proactivamente problemas y solicitudes de extracción** sin acceso de escritura
* **Escritura**: recomendado para contribuyentes que **empujan activamente su proyecto**
* **Mantenimiento**: recomendado para **gerentes de proyectos que necesitan administrar el repositorio** sin acceso a acciones sensibles o destructivas
* **Administrador**: recomendado para personas que necesitan **acceso completo al proyecto**, incluidas acciones sensibles y destructivas como administrar la seguridad o eliminar un repositorio

Puede **comparar los permisos** de cada rol en esta tabla [https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization#permissions-for-each-role](https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization#permissions-for-each-role)

También puede **crear sus propios roles** en _https://github.com/organizations/\<org\_name>/settings/roles_

### Equipos

Puede **listar los equipos creados en una organización** en _https://github.com/orgs/\<org\_name>/teams_. Tenga en cuenta que para ver los equipos que son hijos de otros equipos, debe acceder a cada equipo principal.

### Usuarios

Los usuarios de una organización se pueden **listar** en _https://github.com/orgs/\<org\_name>/people._

En la información de cada usuario, puede ver los **equipos de los que es miembro el usuario** y los **repositorios a los que el usuario tiene acceso**.

## Autenticación de Github

Github ofrece diferentes formas de autenticarse en su cuenta y realizar acciones en su nombre.

### Acceso web

Al acceder a **github.com**, puede iniciar sesión con su **nombre de usuario y contraseña** (y un **2FA potencialmente**).

### **Claves SSH**

Puede configurar su cuenta con una o varias claves públicas que permiten que la **clave privada relacionada realice acciones en su nombre**. [https://github.com/settings/keys](https://github.com/settings/keys)

#### **Claves GPG**

**No puede hacerse pasar por el usuario con estas claves**, pero si no lo usa, es posible que **se descubra que envía confirmaciones sin una firma**. Obtenga más información sobre [el modo vigilante aquí](https://docs.github.com/en/authentication/managing-commit-signature-verification/displaying-verification-statuses-for-all-of-your-commits#about-vigilant-mode).

### **Tokens de acceso personal**

Puede generar un token de acceso personal para **dar acceso a una aplicación a
### Aplicaciones de Github

Las aplicaciones de Github pueden solicitar permisos para **acceder a su información de Github o suplantar su identidad** para realizar acciones específicas sobre recursos específicos. En las aplicaciones de Github, debe especificar los repositorios a los que la aplicación tendrá acceso.

* Para instalar una aplicación de GitHub, debe ser un **propietario de la organización o tener permisos de administrador** en un repositorio.
* La aplicación de GitHub debe **conectarse a una cuenta personal o a una organización**.
* Puede crear su propia aplicación de Github en [https://github.com/settings/apps](https://github.com/settings/apps)
* Puede ver todas las **aplicaciones de Github que tienen acceso a su cuenta** en [https://github.com/settings/apps/authorizations](https://github.com/settings/apps/authorizations)
* Estos son los **puntos finales de API para aplicaciones de Github** [https://docs.github.com/en/rest/overview/endpoints-available-for-github-app](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps). Dependiendo de los permisos de la aplicación, podrá acceder a algunos de ellos.
* Puede ver las aplicaciones instaladas en una **organización** en _https://github.com/organizations/\<org\_name>/settings/installations_

Algunas recomendaciones de seguridad:

* Una aplicación de GitHub debe **tomar acciones independientes de un usuario** (a menos que la aplicación esté utilizando un token [de usuario a servidor](https://docs.github.com/en/apps/building-github-apps/identifying-and-authorizing-users-for-github-apps#user-to-server-requests)). Para mantener los tokens de acceso de usuario a servidor más seguros, puede usar tokens de acceso que caducarán después de 8 horas y un token de actualización que se puede intercambiar por un nuevo token de acceso. Para obtener más información, consulte "[Actualización de tokens de acceso de usuario a servidor](https://docs.github.com/en/apps/building-github-apps/refreshing-user-to-server-access-tokens)."
* Asegúrese de que la aplicación de GitHub se integre con **repositorios específicos**.
* La aplicación de GitHub debe **conectarse a una cuenta personal o a una organización**.
* No espere que la aplicación de GitHub conozca y haga todo lo que un usuario puede hacer.
* **No use una aplicación de GitHub si solo necesita un servicio "Iniciar sesión con GitHub"**. Pero una aplicación de GitHub puede usar un [flujo de identificación de usuario](https://docs.github.com/en/apps/building-github-apps/identifying-and-authorizing-users-for-github-apps) para iniciar sesión en los usuarios _y_ hacer otras cosas.
* No cree una aplicación de GitHub si _solo_ desea actuar como un usuario de GitHub y hacer todo lo que ese usuario puede hacer.
* Si está utilizando su aplicación con Acciones de GitHub y desea modificar archivos de flujo de trabajo, debe autenticarse en nombre del usuario con un token OAuth que incluya el ámbito `workflow`. El usuario debe tener permiso de administrador o escritura en el repositorio que contiene el archivo de flujo de trabajo. Para obtener más información, consulte "[Comprensión de los ámbitos de las aplicaciones OAuth](https://docs.github.com/en/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/#available-scopes)."
* **Más** en [aquí](https://docs.github.com/en/developers/apps/getting-started-with-apps/about-apps#about-github-apps).

### Acciones de Github

Esto **no es una forma de autenticarse en Github**, pero una Acción de Github **malintencionada** podría obtener **acceso no autorizado a Github** y **dependiendo** de los **privilegios** otorgados a la Acción, se podrían realizar **ataques diferentes**. Vea a continuación para obtener más información.

## Acciones de Git

Las acciones de Git permiten automatizar la **ejecución de código cuando ocurre un evento**. Por lo general, el código ejecutado está **relacionado de alguna manera con el código del repositorio** (tal vez construir un contenedor Docker o verificar que la PR no contenga secretos).

### Configuración

En _https://github.com/organizations/\<org\_name>/settings/actions_ es posible verificar la **configuración de las acciones de Github** para la organización.

Es posible **prohibir completamente el uso de las acciones de Github**, **permitir todas las acciones de Github**, o simplemente permitir ciertas acciones.

También es posible configurar **quién necesita aprobación para ejecutar una Acción de Github** y los **permisos del TOKEN DE GITHUB** de una Acción de Github cuando se ejecuta.

### Secretos de Git

Las acciones de Github generalmente necesitan algún tipo de secretos para interactuar con Github o aplicaciones de terceros. Para **evitar ponerlos en texto claro** en el repositorio, Github permite ponerlos como **Secretos**.

Estos secretos se pueden configurar **para el repositorio o para toda la organización**. Luego, para que la **Acción pueda acceder al secreto**, debe declararlo así:

```yaml
steps:
  - name: Hello world action
    with: # Establecer el secreto como entrada
      super_secret: ${{ secrets.SuperSecret }}
    env: # O como variable de entorno
      super_secret: ${{ secrets.SuperSecret }}
```

#### Ejemplo usando Bash <a href="#example-using-bash" id="example-using-bash"></a>

```yaml
steps:
  - shell: bash
    env:
      SUPER_SECRET: ${{ secrets.SuperSecret }}
    run: |
      example-command "$SUPER_SECRET"
```

{% hint style="warning" %}
Los secretos **solo se pueden acceder desde las Acciones de Github** que los tienen declarados.

Una vez configurados en el repositorio o en las organizaciones, **los usuarios de Github no podrán acceder a ellos nuevamente**, solo podrán **cambiarlos**.
{% endhint %}

Por lo tanto, la **única forma de robar secretos de Github es poder acceder a la máquina que está ejecutando la Acción de Github** (en ese escenario, solo podrá acceder a los secretos declarados para la Acción).

### Entornos de Git

Github permite crear **entornos** donde puede guardar **secretos**. Luego, puede dar acceso a la acción de Github a los secretos dentro del entorno con algo como:

```yaml
jobs:
  deployment:
    runs-on: ubuntu-latest
    environment: env_name
```

Puede configurar un entorno para que sea **accedido** por **todas las ramas** (predeterminado), **solo ramas protegidas** o **especificar** qué ramas pueden acceder a él.\
También puede establecer un **número de revisiones requeridas** antes de **ejecutar** una **acción** utilizando un **entorno** o **esperar** algún **tiempo** antes de permitir que las implementaciones continúen.

### Ejecutor de Acciones de Git

Una Acción de Github puede ser **ejecutada dentro del entorno de Github** o puede ser ejecutada en una **infraestructura de terceros** configurada por el usuario.

Varias organizaciones permitirán ejecutar Acciones de Github en una **infraestructura de terceros** ya que suele ser **más barato**.

Puede **listar los ejecutores de acciones autohospedados** de una organización en _https://github.com/organizations/\<org\_name>/settings/actions/runners_

La forma de encontrar qué **Acciones de Github se están ejecutando en una infraestructura que no es de Github** es buscar `runs-on: self-hosted` en el archivo de configuración yaml de la Acción de Github.

**No es posible ejecutar una Acción de Github de una organización dentro de una caja autohospedada** de una organización diferente porque **se genera un token único para el Ejecutor** al configurarlo para saber dónde pertenece el Ejecutor.

Si el **Ejecutor personalizado de Github está configurado en una máquina dentro de AWS o GCP**, por ejemplo, la Acción **podría tener acceso al punto final de metadatos** y **robar el token de la cuenta de servicio** con el que se está ejecutando la máquina.

### Compromiso de Acción de Git

Si se permiten todas las acciones (o una acción malintencionada), un usuario podría usar una **Acción de Github** que es **malintencionada** y **comprometerá** el **contenedor** donde se está ejecutando.

{% hint style="danger" %}
Una **Acción de Github malintencionada** se puede **abusar** por el atacante para:

* **Robar todos los secretos** a los que la Acción tiene acceso.
* **Moverse lateralmente** si la Acción se ejecuta dentro de una **infraestructura de terceros** donde se puede acceder al token SA utilizado para ejecutar la máquina (probablemente a través del servicio de metadatos).
* **Abusar del token** utilizado por el **flujo de trabajo** para **robar el código del repositorio** donde se está ejecutando la Acción de Github o **incluso modificarlo**.
{% endhint %}
## Protecciones de rama

Las protecciones de rama están diseñadas para **no dar control completo de un repositorio** a los usuarios. El objetivo es **poner varios métodos de protección antes de poder escribir código dentro de alguna rama**.

Las **protecciones de rama de un repositorio** se pueden encontrar en _https://github.com/\<orgname>/\<reponame>/settings/branches_

{% hint style="info" %}
No es **posible establecer una protección de rama a nivel de organización**. Por lo tanto, todas deben declararse en cada repositorio.
{% endhint %}

Se pueden aplicar diferentes protecciones a una rama (como a la rama principal):

* Puede **requerir una solicitud de extracción antes de la fusión** (por lo que no se puede fusionar directamente el código en la rama). Si se selecciona esto, se pueden aplicar diferentes protecciones:
  * **Requerir un número de aprobaciones**. Es muy común requerir que 1 o 2 personas más aprueben su solicitud de extracción para que un solo usuario no sea capaz de fusionar el código directamente.
  * **Descartar aprobaciones cuando se empujan nuevos commits**. De lo contrario, un usuario puede aprobar código legítimo y luego el usuario podría agregar código malicioso y fusionarlo.
  * **Requerir revisiones de los propietarios de código**. Al menos 1 propietario de código del repositorio debe aprobar la solicitud de extracción (para que los usuarios "aleatorios" no puedan aprobarla).
  * **Restringir quién puede descartar revisiones de solicitudes de extracción**. Puede especificar personas o equipos autorizados para descartar revisiones de solicitudes de extracción.
  * **Permitir que actores especificados eviten los requisitos de solicitud de extracción**. Estos usuarios podrán evitar las restricciones anteriores.
* **Requerir que se pasen las comprobaciones de estado antes de la fusión**. Algunas comprobaciones deben pasar antes de poder fusionar el commit (como una acción de github que comprueba que no hay secretos en texto claro).
* **Requerir la resolución de conversaciones antes de la fusión**. Todos los comentarios sobre el código deben resolverse antes de que se pueda fusionar la solicitud de extracción.
* **Requerir commits firmados**. Los commits deben estar firmados.
* **Requerir historial lineal**. Evita que se empujen commits de fusión a las ramas coincidentes.
* **Incluir administradores**. Si esto no está configurado, los administradores pueden evitar las restricciones.
* **Restringir quién puede enviar a las ramas coincidentes**. Restringir quién puede enviar una solicitud de extracción.

{% hint style="info" %}
Como se puede ver, incluso si logró obtener algunas credenciales de un usuario, **los repositorios pueden estar protegidos evitando que empuje código a la rama principal** por ejemplo para comprometer la canalización CI/CD.
{% endhint %}

## Referencias

* [https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization](https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization)
* [https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise](https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise)[https://docs.github.com/en/enterprise-server](https://docs.github.com/en/enterprise-server@3.3/admin/user-management/managing-users-in-your-enterprise/roles-in-an-enterprise)
* [https://docs.github.com/en/get-started/learning-about-github/access-permissions-on-github](https://docs.github.com/en/get-started/learning-about-github/access-permissions-on-github)
* [https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-user-account/managing-user-account-settings/permission-levels-for-user-owned-project-boards](https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-github-user-account/managing-user-account-settings/permission-levels-for-user-owned-project-boards)
* [https://docs.github.com/en/actions/security-guides/encrypted-secrets](https://docs.github.com/en/actions/security-guides/encrypted-secrets)

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) **y** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>