# S√©curit√© Github

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Qu'est-ce que Github

(D'apr√®s [ici](https://kinsta.com/knowledgebase/what-is-github/)) √Ä un niveau √©lev√©, **Github est un site web et un service bas√© sur le cloud qui aide les d√©veloppeurs √† stocker et g√©rer leur code, ainsi qu'√† suivre et contr√¥ler les modifications apport√©es √† leur code**.

### Informations de base

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Reconnaissance Externe

Les d√©p√¥ts Github peuvent √™tre configur√©s comme publics, priv√©s et internes.

* **Priv√©** signifie que **seulement** les personnes de l'**organisation** pourront y acc√©der
* **Interne** signifie que **seulement** les personnes de l'**entreprise** (une entreprise peut avoir plusieurs organisations) pourront y acc√©der
* **Public** signifie que **tout internet** pourra y acc√©der.

Si vous connaissez l'**utilisateur, le d√©p√¥t ou l'organisation que vous souhaitez cibler**, vous pouvez utiliser les **dorks Github** pour trouver des informations sensibles ou rechercher des **fuites d'informations sensibles** **dans chaque d√©p√¥t**.

### Dorks Github

Github permet de **rechercher quelque chose en sp√©cifiant comme port√©e un utilisateur, un d√©p√¥t ou une organisation**. Ainsi, avec une liste de cha√Ænes qui vont appara√Ætre pr√®s d'informations sensibles, vous pouvez facilement **rechercher des informations sensibles potentielles dans votre cible**.

Outils (chaque outil contient sa liste de dorks) :

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Liste de dorks](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Liste de dorks](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Liste de dorks](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Fuites Github

Veuillez noter que les dorks github sont √©galement destin√©s √† rechercher des fuites en utilisant les options de recherche de github. Cette section est d√©di√©e √† ces outils qui vont **t√©l√©charger chaque d√©p√¥t et rechercher des informations sensibles √† l'int√©rieur** (en v√©rifiant m√™me une certaine profondeur de commits).

Outils (chaque outil contient sa liste de regexes) :

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Lorsque vous recherchez des fuites dans un d√©p√¥t et ex√©cutez quelque chose comme `git log -p`, n'oubliez pas qu'il pourrait y avoir **d'autres branches avec d'autres commits** contenant des secrets !
{% endhint %}

### Forks Externes

Il est possible de **compromettre des d√©p√¥ts en abusant des pull requests**. Pour savoir si un d√©p√¥t est vuln√©rable, vous devez principalement lire les configurations yaml des Actions Github. [**Plus d'informations √† ce sujet ci-dessous**](./#execution-from-a-external-fork).

## Renforcement de l'Organisation

### Privil√®ges des Membres

Il existe certains **privil√®ges par d√©faut** qui peuvent √™tre attribu√©s aux **membres** de l'organisation. Ils peuvent √™tre contr√¥l√©s depuis la page `https://github.com/organizations/<org_name>/settings/member_privileges` ou depuis l'[**API des Organisations**](https://docs.github.com/en/rest/orgs/orgs).

* **Permissions de base** : Les membres auront la permission Aucune/Lecture/√âcriture/Admin sur les d√©p√¥ts de l'org. Il est recommand√© de choisir **Aucune** ou **Lecture**.
* **Fork de d√©p√¥t** : Si ce n'est pas n√©cessaire, il vaut mieux **ne pas autoriser** les membres √† forker les d√©p√¥ts de l'organisation.
* **Cr√©ation de pages** : Si ce n'est pas n√©cessaire, il vaut mieux **ne pas autoriser** les membres √† publier des pages √† partir des d√©p√¥ts de l'org. Si n√©cessaire, vous pouvez autoriser la cr√©ation de pages publiques ou priv√©es.
* **Demandes d'acc√®s √† l'int√©gration** : Avec cela activ√©, les collaborateurs ext√©rieurs pourront demander l'acc√®s pour les applications GitHub ou OAuth pour acc√©der √† cette organisation et √† ses ressources. C'est g√©n√©ralement n√©cessaire, mais si ce n'est pas le cas, il vaut mieux le d√©sactiver.
* _Je n'ai pas trouv√© cette info dans la r√©ponse de l'API, partagez si vous l'avez_
* **Changement de visibilit√© du d√©p√¥t** : Si activ√©, les **membres** avec des permissions **admin** pour le **d√©p√¥t** pourront **changer sa visibilit√©**. Si d√©sactiv√©, seuls les propri√©taires de l'organisation peuvent changer les visibilit√©s des d√©p√¥ts. Si vous **ne voulez pas** que les gens rendent les choses **publiques**, assurez-vous que cela est **d√©sactiv√©**.
* _Je n'ai pas trouv√© cette info dans la r√©ponse de l'API, partagez si vous l'avez_
* **Suppression et transfert de d√©p√¥t** : Si activ√©, les membres avec des permissions **admin** pour le d√©p√¥t pourront **supprimer** ou **transf√©rer** des **d√©p√¥ts publics et priv√©s**.
* _Je n'ai pas trouv√© cette info dans la r√©ponse de l'API, partagez si vous l'avez_
* **Autoriser les membres √† cr√©er des √©quipes** : Si activ√©, tout **membre** de l'organisation pourra **cr√©er** de nouvelles **√©quipes**. Si d√©sactiv√©, seuls les propri√©taires de l'organisation peuvent cr√©er de nouvelles √©quipes. Il est pr√©f√©rable de d√©sactiver cette option.
* _Je n'ai pas trouv√© cette info dans la r√©ponse de l'API, partagez si vous l'avez_
* **Plus de choses peuvent √™tre configur√©es** sur cette page mais les pr√©c√©dentes sont celles li√©es √† la s√©curit√©.
### Param√®tres des actions

Plusieurs param√®tres li√©s √† la s√©curit√© peuvent √™tre configur√©s pour les actions depuis la page `https://github.com/organizations/<org_name>/settings/actions`.

{% hint style="info" %}
Notez que toutes ces configurations peuvent √©galement √™tre d√©finies pour chaque d√©p√¥t de mani√®re ind√©pendante.
{% endhint %}

* **Politiques des actions Github** : Cela vous permet d'indiquer quels d√©p√¥ts peuvent ex√©cuter des workflows et quels workflows devraient √™tre autoris√©s. Il est recommand√© de **sp√©cifier quels d√©p√¥ts** devraient √™tre autoris√©s et de ne pas permettre √† toutes les actions de s'ex√©cuter.
* [**API-1**](https://docs.github.com/en/rest/actions/permissions#get-allowed-actions-and-reusable-workflows-for-an-organization)**,** [**API-2**](https://docs.github.com/en/rest/actions/permissions#list-selected-repositories-enabled-for-github-actions-in-an-organization)
* **Workflows de pull request de fork par des collaborateurs ext√©rieurs** : Il est recommand√© d'**exiger l'approbation pour tous** les collaborateurs ext√©rieurs.
* _Je n'ai pas trouv√© d'API avec cette information, partagez si vous en avez_
* **Ex√©cuter des workflows √† partir de pull requests de fork** : Il est fortement **d√©conseill√© d'ex√©cuter des workflows √† partir de pull requests** car les mainteneurs de la source du fork se verront accorder la capacit√© d'utiliser des tokens avec des permissions de lecture sur le d√©p√¥t source.
* _Je n'ai pas trouv√© d'API avec cette information, partagez si vous en avez_
* **Permissions des workflows** : Il est fortement recommand√© de **donner uniquement des permissions de lecture au d√©p√¥t**. Il est d√©conseill√© de donner des permissions d'√©criture et de cr√©er/approuver des pull requests pour √©viter l'abus du GITHUB\_TOKEN donn√© aux workflows en cours d'ex√©cution.
* [**API**](https://docs.github.com/en/rest/actions/permissions#get-default-workflow-permissions-for-an-organization)

### Int√©grations

_Faites-moi savoir si vous connaissez le point de terminaison de l'API pour acc√©der √† cette information !_

* **Politique d'acc√®s aux applications tierces** : Il est recommand√© de restreindre l'acc√®s √† chaque application et de n'autoriser que celles qui sont n√©cessaires (apr√®s les avoir examin√©es).
* **Applications GitHub install√©es** : Il est recommand√© de n'autoriser que celles qui sont n√©cessaires (apr√®s les avoir examin√©es).

## Reconnaissance & Attaques abusant des identifiants

Dans ce sc√©nario, nous allons supposer que vous avez obtenu un acc√®s √† un compte github.

### Avec les identifiants d'utilisateur

Si vous avez d√©j√† des identifiants pour un utilisateur au sein d'une organisation, vous pouvez **simplement vous connecter** et v√©rifier quels **r√¥les d'entreprise et d'organisation vous avez**, si vous √™tes un membre ordinaire, v√©rifiez quelles **permissions les membres ordinaires ont**, dans quels **groupes** vous √™tes, quelles **permissions vous avez** sur quels **d√©p√¥ts,** et **comment les d√©p√¥ts sont prot√©g√©s.**

Notez que **l'authentification √† deux facteurs peut √™tre utilis√©e** donc vous ne pourrez acc√©der √† cette information que si vous pouvez √©galement **passer cette v√©rification**.

{% hint style="info" %}
Notez que si vous **r√©ussissez √† voler le cookie `user_session`** (actuellement configur√© avec SameSite : Lax) vous pouvez **compl√®tement usurper l'identit√© de l'utilisateur** sans avoir besoin d'identifiants ou de l'authentification √† deux facteurs.
{% endhint %}

Consultez la section ci-dessous sur les [**contournements de la protection des branches**](./#branch-protection-bypass) au cas o√π cela serait utile.

### Avec la cl√© SSH de l'utilisateur

Github permet aux **utilisateurs** de d√©finir des **cl√©s SSH** qui seront utilis√©es comme **m√©thode d'authentification pour d√©ployer du code** en leur nom (aucune authentification √† deux facteurs n'est appliqu√©e).

Avec cette cl√©, vous pouvez effectuer des **changements dans les d√©p√¥ts o√π l'utilisateur a certains privil√®ges**, cependant vous ne pouvez pas l'utiliser pour acc√©der √† l'API github pour √©num√©rer l'environnement. Cependant, vous pouvez obtenir des **param√®tres locaux √©num√©r√©s** pour obtenir des informations sur les d√©p√¥ts et l'utilisateur auxquels vous avez acc√®s :
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Si l'utilisateur a configur√© son nom d'utilisateur comme son nom d'utilisateur github, vous pouvez acc√©der aux **cl√©s publiques qu'il a d√©finies** dans son compte √† _https://github.com/\<github\_username>.keys_. Vous pourriez v√©rifier cela pour confirmer que la cl√© priv√©e que vous avez trouv√©e peut √™tre utilis√©e.

Les **cl√©s SSH** peuvent √©galement √™tre d√©finies dans les d√©p√¥ts en tant que **cl√©s de d√©ploiement**. Toute personne ayant acc√®s √† cette cl√© pourra **lancer des projets √† partir d'un d√©p√¥t**. Habituellement, sur un serveur avec diff√©rentes cl√©s de d√©ploiement, le fichier local **`~/.ssh/config`** vous donnera des informations sur la cl√© associ√©e.

#### Cl√©s GPG

Comme expliqu√© [**ici**](broken-reference/) parfois il est n√©cessaire de signer les commits ou vous pourriez √™tre d√©couvert.

V√©rifiez localement si l'utilisateur actuel a une cl√© avec :
```shell
gpg --list-secret-keys --keyid-format=long
```
### Avec un jeton utilisateur

Pour une introduction sur [**les jetons utilisateur, consultez les informations de base**](basic-github-information.md#personal-access-tokens).

Un jeton utilisateur peut √™tre utilis√© **√† la place d'un mot de passe** pour Git via HTTPS, ou peut √™tre utilis√© pour [**s'authentifier via l'API avec l'authentification de base**](https://docs.github.com/v3/auth/#basic-authentication). Selon les privil√®ges qui lui sont attach√©s, vous pourriez √™tre capable d'effectuer diff√©rentes actions.

Un jeton utilisateur ressemble √† ceci : `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Avec une application Oauth

Pour une introduction sur [**les applications Github Oauth, consultez les informations de base**](basic-github-information.md#oauth-applications).

Un attaquant pourrait cr√©er une **application Oauth malveillante** pour acc√©der aux donn√©es/actions privil√©gi√©es des utilisateurs qui les acceptent, probablement dans le cadre d'une campagne de phishing.

Voici [les √©tendues qu'une application Oauth peut demander](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Un utilisateur devrait toujours v√©rifier les √©tendues demand√©es avant de les accepter.

De plus, comme expliqu√© dans les informations de base, **les organisations peuvent autoriser/refuser l'acc√®s aux applications tierces** aux informations/repos/actions li√©es √† l'organisation.

### Avec une application Github

Pour une introduction sur [**les applications Github, consultez les informations de base**](basic-github-information.md#github-applications).

Un attaquant pourrait cr√©er une **application Github malveillante** pour acc√©der aux donn√©es/actions privil√©gi√©es des utilisateurs qui les acceptent, probablement dans le cadre d'une campagne de phishing.

De plus, comme expliqu√© dans les informations de base, **les organisations peuvent autoriser/refuser l'acc√®s aux applications tierces** aux informations/repos/actions li√©es √† l'organisation.

## Compromettre et abuser de Github Action

Il existe plusieurs techniques pour compromettre et abuser d'une Github Action, consultez-les ici :

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Contournement de la protection des branches

* **Exiger un certain nombre d'approbations** : Si vous avez compromis plusieurs comptes, vous pourriez simplement accepter vos PR depuis d'autres comptes. Si vous avez seulement le compte √† partir duquel vous avez cr√©√© la PR, vous ne pouvez pas accepter votre propre PR. Cependant, si vous avez acc√®s √† un environnement **Github Action** dans le d√©p√¥t, en utilisant le **GITHUB\_TOKEN**, vous pourriez √™tre capable d'**approuver votre PR** et obtenir ainsi une approbation.
* _Notez que pour cette restriction et celle des Code Owners, normalement un utilisateur ne peut pas approuver ses propres PR, mais si c'est possible, vous pouvez en abuser pour accepter vos PR._
* **R√©voquer les approbations lorsque de nouveaux commits sont pouss√©s** : Si ce n'est pas configur√©, vous pouvez soumettre du code l√©gitime, attendre qu'il soit approuv√©, puis ins√©rer du code malveillant et le fusionner dans la branche prot√©g√©e.
* **Exiger des revues de la part des Code Owners** : Si c'est activ√© et que vous √™tes un Code Owner, vous pourriez faire en sorte qu'une **Github Action cr√©e votre PR puis l'approuver vous-m√™me**.
* Lorsqu'un fichier **CODEOWNER est mal configur√©**, Github ne se plaint pas mais ne l'utilise pas. Par cons√©quent, si c'est mal configur√©, la protection **Code Owners n'est pas appliqu√©e**.
* **Permettre √† des acteurs sp√©cifi√©s de contourner les exigences de pull request** : Si vous √™tes l'un de ces acteurs, vous pouvez contourner les protections de pull request.
* **Inclure les administrateurs** : Si ce n'est pas configur√© et que vous √™tes administrateur du d√©p√¥t, vous pouvez contourner ces protections de branche.
* **D√©tournement de PR (PR Hijacking)** : Vous pourriez √™tre capable de **modifier la PR de quelqu'un d'autre** en ajoutant du code malveillant, en approuvant la PR r√©sultante vous-m√™me et en fusionnant le tout.
* **Suppression des protections de branche** : Si vous √™tes **administrateur du d√©p√¥t, vous pouvez d√©sactiver les protections**, fusionner votre PR et remettre les protections en place.
* **Contournement des protections de push** : Si un d√©p√¥t **n'autorise que certains utilisateurs** √† envoyer des push (fusionner du code) dans des branches (la protection de branche peut prot√©ger toutes les branches en sp√©cifiant le joker `*`).
* Si vous avez **un acc√®s en √©criture sur le d√©p√¥t mais que vous n'√™tes pas autoris√© √† pousser du code** √† cause de la protection de branche, vous pouvez toujours **cr√©er une nouvelle branche** et y cr√©er une **github action qui se d√©clenche lorsqu'un code est pouss√©**. Comme la **protection de branche ne prot√®ge pas la branche tant qu'elle n'est pas cr√©√©e**, ce premier push de code sur la branche va **ex√©cuter l'action github**.

## Contourner les protections des environnements

Pour une introduction sur [**l'environnement Github, consultez les informations de base**](basic-github-information.md#git-environments).

Dans le cas o√π un environnement peut √™tre **accessible depuis toutes les branches**, il **n'est pas prot√©g√©** et vous pouvez facilement acc√©der aux secrets √† l'int√©rieur de l'environnement. Notez que vous pourriez trouver des d√©p√¥ts o√π **toutes les branches sont prot√©g√©es** (en sp√©cifiant leurs noms ou en utilisant `*`), dans ce sc√©nario, **trouvez une branche o√π vous pouvez pousser du code** et vous pouvez **exfiltrer** les secrets en cr√©ant une nouvelle action github (ou en modifiant une existante).

Notez que vous pourriez rencontrer le cas particulier o√π **toutes les branches sont prot√©g√©es** (via le joker `*`), il est sp√©cifi√© **qui peut pousser du code sur les branches** (_vous pouvez le sp√©cifier dans la protection de branche_) et **votre utilisateur n'est pas autoris√©**. Vous pouvez toujours ex√©cuter une action github personnalis√©e car vous pouvez cr√©er une branche et utiliser le d√©clencheur de push sur elle-m√™me. La **protection de branche permet le push sur une nouvelle branche donc l'action github sera d√©clench√©e**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Notez qu'**apr√®s la cr√©ation** de la branche, la **protection de la branche s'appliquera √† la nouvelle branche** et vous ne pourrez pas la modifier, mais √† ce moment-l√†, vous aurez d√©j√† extrait les secrets.

## Persistance

* G√©n√©rer un **jeton d'utilisateur**
* Voler des **jetons github** depuis les **secrets**
* **Suppression** des **r√©sultats** de workflow et des **branches**
* Donner **plus de permissions √† toute l'org**
* Cr√©er des **webhooks** pour exfiltrer des informations
* Inviter des **collaborateurs ext√©rieurs**
* **Supprimer** les **webhooks** utilis√©s par le **SIEM**
* Cr√©er/modifier une **Github Action** avec une **porte d√©rob√©e**
* Trouver une **Github Action vuln√©rable √† l'injection de commande** via la modification de la valeur du **secret**

### Imposter Commits - Porte d√©rob√©e via les commits de repo

Sur Github, il est possible de **cr√©er une PR sur un repo √† partir d'un fork**. M√™me si la PR n'est **pas accept√©e**, un **identifiant de commit** dans le repo original va √™tre cr√©√© pour la version fork du code. Par cons√©quent, un attaquant **pourrait se fixer pour utiliser un commit sp√©cifique d'un repo apparemment l√©gitime qui n'a pas √©t√© cr√©√© par le propri√©taire du repo**.

Comme [**cela**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e) :
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Pour plus d'informations, consultez [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-moi** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
