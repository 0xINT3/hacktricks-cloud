# Github Güvenliği

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki [**NFT'leri**](https://opensea.io/collection/the-peass-family) keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı takip edin.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR göndererek paylaşın.

</details>

## Github Nedir

([Buradan](https://kinsta.com/knowledgebase/what-is-github/) alıntıdır) Genel olarak, **GitHub, geliştiricilerin kodlarını depolamalarına ve yönetmelerine, kodlarındaki değişiklikleri takip etmelerine ve kontrol etmelerine yardımcı olan bir web sitesi ve bulut tabanlı bir hizmettir**.

### Temel Bilgiler

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Harici Keşif

Github depoları genel, özel ve iç olarak yapılandırılabilir.

* **Özel**, **sadece** kuruluşun **üyelerinin** erişebileceği anlamına gelir
* **İç**, **sadece** kuruluşun **üyelerinin** erişebileceği anlamına gelir (bir kuruluşun birden fazla üyesi olabilir)
* **Genel**, **tüm internetin** erişebileceği anlamına gelir.

Hedeflediğiniz **kullanıcıyı, depoyu veya kuruluşu** biliyorsanız, **github dorks** kullanarak hedefinizdeki hassas bilgileri bulabilir veya **her depoda hassas bilgi sızıntılarını** arayabilirsiniz.

### Github Dorks

Github, **kullanıcıyı, depoyu veya kuruluşu kapsam olarak belirterek bir şey aramaya izin verir**. Bu nedenle, hassas bilgilere yakın görünecek dize listesiyle hedefinizdeki potansiyel hassas bilgileri kolayca **aramanız mümkündür**.

Araçlar (her araç kendi dork listesini içerir):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Dork listesi](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Dork listesi](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Dork listesi](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Github Sızıntıları

Lütfen unutmayın, github dorks ayrıca github arama seçeneklerini kullanarak sızıntıları aramak için de kullanılır. Bu bölüm, bu araçların **her depoyu indirip içlerinde hassas bilgileri arayacakları** araçlara ayrılmıştır (belirli bir taahhüt derinliğini bile kontrol ederek).

Araçlar (her araç kendi regex listesini içerir):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Bir depoda sızıntı ararken `git log -p` gibi bir şey çalıştırdığınızda **diğer taahhütlerde başka dallar olabileceğini** unutmayın ve bu dallarda da gizli bilgiler olabilir!
{% endhint %}

### Harici Forklar

Bir repo, pull isteklerini kötüye kullanarak **tehlikeye atılabilir**. Bir repo'nun savunmasız olup olmadığını anlamak için genellikle Github Actions yaml yapılandırmalarını okumanız gerekmektedir. [**Daha fazla bilgi için aşağıdaki bölüme**](./#execution-from-a-external-fork) bakın.

## Kuruluş Sertleştirme

### Üye Yetkileri

Kuruluşun üyelerine atanabilecek bazı **varsayılan yetkiler** vardır. Bu yetkiler, `https://github.com/organizations/<org_name>/settings/member_privileges` sayfasından veya [**Organizations API**](https://docs.github.com/en/rest/orgs/orgs) üzerinden kontrol edilebilir.

* **Temel izinler**: Üyeler, org depoları üzerinde Hiçbiri/Oku/Yaz/Admin izinlerine sahip olacaklardır. Önerilen **Hiçbiri** veya **Oku**.
* **Repo çatallama**: Gerekli değilse, üyelerin kuruluş depolarını çatallamasına **izin verilmemesi daha iyidir**.
* **Sayfa oluşturma**: Gerekli değilse, üyelerin org depolarından sayfa yayınlamasına **izin verilmemesi daha iyidir**. Gerekliyse, genel veya özel sayfalar oluşturmaya izin verilebilir.
* **Entegrasyon erişim istekleri**: Bu etkinleştirildiğinde, dış işbirlikçiler, bu kuruluşa ve kaynaklarına erişmek için GitHub veya OAuth uygulamaları için erişim isteyebilirler. Genellikle gereklidir, ancak gerekmeyen durumlarda devre dışı bırakmak daha iyidir.
* _Bu bilgiyi API yanıtında bulamadım, bulursanız paylaşın_
* **Repo görünürlüğü değişikliği**: Etkinleştirildiğinde, **repo için admin izinlerine sahip üyeler**, **görünürlüğünü değiştirebilir**. Devre dışı bırakıldığında, yalnızca kuruluş sahipleri repo görünürlüğünü değiştirebilir. İnsanların şeyleri **genel** yapmasını **istemiyorsanız**, bunun **devre dışı** olduğundan emin olun.
* _Bu bilgiyi API yanıtında bulamadım, bul
### Entegrasyonlar

_Bu bilgilere erişmek için API uç noktasını biliyorsanız bana bildirin!_

* **Üçüncü taraf uygulama erişim politikası**: Her uygulamaya erişimi kısıtlamak ve sadece gerekli olanlara izin vermek önerilir (inceledikten sonra).
* **Yüklenmiş GitHub Uygulamaları**: İncelendikten sonra sadece gerekli olanlara izin vermek önerilir.

## Keşif ve Kimlik Bilgilerini Kötüye Kullanma Saldırıları

Bu senaryoda, bir github hesabına erişim elde ettiğinizi varsayacağız.

### Kullanıcı Kimlik Bilgileriyle

Eğer bir kullanıcının kimlik bilgilerine zaten sahipseniz, **sadece giriş yapabilirsiniz** ve hangi **kurumsal ve organizasyon rollerine sahip olduğunuzu**, bir üye olarak hangi **izinlere sahip olduğunuzu**, hangi **gruplarda** olduğunuzu, hangi **repo'lara hangi izinlere sahip olduğunuzu** ve **repo'ların nasıl korunduğunu** kontrol edebilirsiniz.

**2FA kullanılabilir** olduğunu unutmayın, bu nedenle bu bilgilere erişebilmeniz için **bu kontrolü de geçebilmeniz gerekmektedir**.

{% hint style="info" %}
Eğer **`user_session` çerezini** (şu anda SameSite: Lax ile yapılandırılmış) **çalmayı başarırsanız**, kimlik bilgileri veya 2FA'ya ihtiyaç duymadan kullanıcıyı **tamamen taklit edebilirsiniz**.
{% endhint %}

Eğer işe yararsa, [**şube korumalarını atlatma**](./#branch-protection-bypass) hakkındaki bölümü kontrol edin.

### Kullanıcı SSH Anahtarıyla

Github, **kullanıcıların** kendi adlarına kod **dağıtmak için kimlik doğrulama yöntemi olarak kullanacakları SSH anahtarlarını** ayarlamalarına izin verir (2FA uygulanmaz).

Bu anahtarla, kullanıcının bazı ayrıcalıklara sahip olduğu **repo'larda değişiklikler yapabilirsiniz**, ancak github api'ye erişmek için kullanamazsınız. Bununla birlikte, erişiminiz olan repo'lar ve kullanıcı hakkında bilgi almak için **yerel ayarları sıralayabilirsiniz**:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Eğer kullanıcı kullanıcı adını github kullanıcı adı olarak yapılandırdıysa, hesabında ayarladığı **genel anahtarları** _https://github.com/\<github\_kullanıcıadı>.keys_ adresinden erişebilirsiniz, bu şekilde bulduğunuz özel anahtarın kullanılabileceğini doğrulamak için bunu kontrol edebilirsiniz.

**SSH anahtarları**, **dağıtım anahtarları** olarak da depolarda ayarlanabilir. Bu anahtara erişimi olan herkes, bir depodan projeleri **başlatabilir**. Genellikle farklı dağıtım anahtarlarına sahip bir sunucuda, yerel **`~/.ssh/config`** dosyası size hangi anahtarın ilişkili olduğu hakkında bilgi verecektir.

#### GPG Anahtarları

[**Burada**](broken-reference/) açıklandığı gibi bazen taahhütleri imzalamak gerekebilir veya keşfedilebilirsiniz.

Mevcut kullanıcının herhangi bir anahtara sahip olup olmadığını yerel olarak kontrol edin:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Kullanıcı Token'i ile

[**Kullanıcı Token'ları hakkında temel bilgilere buradan ulaşabilirsiniz**](basic-github-information.md#personal-access-tokens).

Bir kullanıcı token'i, Git üzerinden HTTPS üzerinden şifre yerine kullanılabilir veya [**API'ye Temel Kimlik Doğrulaması ile kimlik doğrulaması yapmak için**](https://docs.github.com/v3/auth/#basic-authentication) kullanılabilir. Bağlı olan ayrıcalıklara bağlı olarak farklı işlemler gerçekleştirebilirsiniz.

Bir Kullanıcı token'i şu şekildedir: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Oauth Uygulaması ile

[**Github Oauth Uygulamaları hakkında temel bilgilere buradan ulaşabilirsiniz**](basic-github-information.md#oauth-applications).

Bir saldırgan, muhtemelen bir dolandırıcılık kampanyasının bir parçası olarak, kullanıcıların ayrıcalıklı veri/aksiyonlara erişmek için **kötü niyetli bir Oauth Uygulaması** oluşturabilir.

Bir Oauth uygulaması, [isteyebileceği kapsamlar](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps) bunlardır. Kabul etmeden önce her zaman istenen kapsamları kontrol etmelisiniz.

Ayrıca, temel bilgilerde açıklandığı gibi, **kuruluşlar üçüncü taraf uygulamalara erişimi verme/reddetme** yetkisine sahip olabilirler.

### Github Uygulaması ile

[**Github Uygulamaları hakkında temel bilgilere buradan ulaşabilirsiniz**](basic-github-information.md#github-applications).

Bir saldırgan, muhtemelen bir dolandırıcılık kampanyasının bir parçası olarak, kullanıcıların ayrıcalıklı veri/aksiyonlara erişmek için **kötü niyetli bir Github Uygulaması** oluşturabilir.

Ayrıca, temel bilgilerde açıklandığı gibi, **kuruluşlar üçüncü taraf uygulamalara erişimi verme/reddetme** yetkisine sahip olabilirler.

## Github Eylemini Kompromize Etme ve Kötüye Kullanma

Github Eylemini kompromize etmek ve kötüye kullanmak için çeşitli teknikler vardır, buradan kontrol edebilirsiniz:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Şube Koruma Atlama

* **Birkaç onay gerektir**: Birkaç hesabı ele geçirdiyseniz, diğer hesaplardan PR'lerinizi kabul edebilirsiniz. PR'yi oluşturduğunuz hesaba sahipseniz kendi PR'nizi kabul edemezsiniz. Ancak, repo içinde bir **Github Eylemi** ortamına erişiminiz varsa, **GITHUB\_TOKEN** kullanarak PR'nizi **onaylayabilir** ve bu şekilde 1 onay alabilirsiniz.
* _Bu ve Code Sahipleri kısıtlaması için genellikle bir kullanıcının kendi PR'lerini onaylayamayacağını unutmayın, ancak onaylayabiliyorsanız, PR'lerinizi kabul etmek için bunu kötüye kullanabilirsiniz._
* **Yeni taahhütler gönderildiğinde onayları reddet**: Bu ayarlanmamışsa, meşru kodu gönderebilir, birinin onaylamasını bekleyebilir ve kötü amaçlı kodu ekleyebilir ve korumalı şubeye birleştirebilirsiniz.
* **Code Sahiplerinden incelemeler gerektir**: Bu etkinleştirildiyse ve bir Code Sahibiyseniz, bir **Github Eylemi oluşturarak PR'nizi oluşturabilir ve ardından kendiniz onaylayabilirsiniz**.
* Bir **CODEOWNER dosyası yanlış yapılandırıldığında** Github şikayet etmez, ancak kullanmaz. Bu nedenle, yanlış yapılandırılmışsa, **Code Sahipleri koruması uygulanmaz**.
* **Belirli aktörlerin çekme isteği gereksinimlerini atlamasına izin ver**: Bu aktörlerden biriyseniz, çekme isteği korumalarını atlayabilirsiniz.
* **Yöneticileri dahil et**: Bu ayarlanmamışsa ve repo yöneticisiyseniz, bu şube korumalarını atlayabilirsiniz.
* **PR Kaçırma**: Başka birinin PR'sini **değiştirerek** kötü amaçlı kod ekleyebilir, sonuçta oluşan PR'yi kendiniz onaylayabilir ve her şeyi birleştirebilirsiniz.
* **Şube Korumalarını Kaldırma**: Repo yöneticisiyseniz, **korumaları devre dışı bırakabilir**, PR'nizi birleştirebilir ve korumaları tekrar ayarlayabilirsiniz.
* **İtme korumalarını atlamak**: Bir repo, belirli kullanıcılara (kod birleştirme) itme yapmalarına izin veriyorsa (şube koruması tüm şubeleri `*` joker karakterini kullanarak koruyor olabilir).
* Repo üzerinde **kod gönderme izniniz olsa da şube koruması nedeniyle kod göndermeye izin verilmiyorsanız**, yine de yeni bir şube oluşturabilir ve içinde kod gönderildiğinde tetiklenen bir **github eylemi oluşturabilirsiniz**. **Şube oluşturulana kadar şube koruması şubeyi korumayacağından**, şubeye ilk kod gönderimi **github eylemini çalıştıracaktır**.

## Ortam Korumalarını Atlama

[**Github Ortamı hakkında temel bilgilere buradan ulaşabilirsiniz**](basic-github-information.md#git-environments).

Bir ortamın **tüm şubelerden erişilebilir** olması durumunda, **korunmamıştır** ve ortamdaki gizli bilgilere kolayca erişebilirsiniz. Tüm şubelerin korunduğu (isimlerini belirterek veya `*` kullanarak) bir senaryoda, kod gönderebileceğiniz bir şube bulun ve yeni bir github eylemi oluşturarak gizli bilgileri dışarı çıkarabilirsiniz (veya mevcut birini değiştirerek).

Unutmayın, **tüm şubelerin korunduğu** (joker karakteri `*` ile) ve **hangi kullanıcıların şubelere kod gönderebileceği** belirtildiği (_şube korumasında bunu belirtebilirsiniz_) ve **kullanıcınızın izin verilmediği** bir kenar durumu bulabilirsiniz. Yine de özel bir github eylemi çalıştırabilirsiniz çünkü bir şube oluşturabilir ve kendisi üzerinde itme tetikleyicisini kullanabilirsiniz. **Şube koruması yeni bir şubeye itme izin verir, bu nedenle github eylemi tetiklenecektir**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Not: **Dallanma oluşturulduktan sonra**, dallanma koruması yeni dala uygulanacak ve değiştiremeyeceksiniz, ancak o zamana kadar zaten sırları sızdırmış olacaksınız.

## Süreklilik

* **Kullanıcı belirteci** oluşturun
* **Sırlardan** **github belirteçleri** çalın
* İş akışı **sonuçlarını** ve **dalları** **silme**
* Tüm orga **daha fazla izin verme**
* Bilgi sızdırmak için **web kancaları** oluşturun
* **Dış işbirlikçileri** davet edin
* **SIEM** tarafından kullanılan **web kancalarını kaldırma**
* **Arka kapı** ile **Github Eylemi** oluşturma/değiştirme
* **Gizli** değer değiştirme yoluyla **komut enjeksiyonu için zayıf Github Eylemi** bulma

### Sahte Taahhütler - Repo taahhütleri aracılığıyla arka kapı

Github'da bir repo için bir çataldan bir PR oluşturmak mümkündür. PR **kabul edilmese bile**, çatal sürümü için orijinal repo içinde bir taahhüt kimliği oluşturulur. Bu nedenle, bir saldırgan, **repo sahibi tarafından oluşturulmayan görünüşte meşru bir repo'dan belirli bir taahhüdü kullanmayı** hedefleyebilir.

[**Böyle**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e) gibi:
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Daha fazla bilgi için [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd) adresini kontrol edin.

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olacak şekilde öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>
