# Github Bezbednost

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini da podržite HackTricks:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Šta je Github

(Sa [ovde](https://kinsta.com/knowledgebase/what-is-github/)) Na visokom nivou, **Github je veb sajt i cloud-based servis koji pomaže programerima da skladište i upravljaju svojim kodom, kao i da prate i kontrolišu promene na svom kodu**.

### Osnovne informacije

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Spoljni Recon

Github repozitorijumi mogu biti konfigurisani kao javni, privatni i interni.

* **Privatni** znači da će **samo** ljudi iz **organizacije** moći da im pristupe
* **Interni** znači da će **samo** ljudi iz **preduzeća** (preduzeće može imati više organizacija) moći da mu pristupe
* **Javni** znači da će mu moći pristupiti **ceo internet**.

Ukoliko znate **korisnika, repozitorijum ili organizaciju koju želite da ciljate** možete koristiti **github dorks** da pronađete osetljive informacije ili tražite **curenje osetljivih informacija na svakom repozitorijumu**.

### Github Dorks

Github omogućava **pretragu nečega specificirajući korisnika, repozitorijum ili organizaciju kao opseg**. Stoga, sa listom stringova koji će se pojaviti blizu osetljivih informacija, lako možete **tražiti potencijalne osetljive informacije na svom cilju**.

Alati (svaki alat sadrži svoju listu dorkova):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Lista dorkova](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Lista dorkova](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Lista dorkova](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Github Curenja

Molim vas, imajte na umu da su github dorkovi takođe namenjeni za pretragu curenja koristeći opcije pretrage na github-u. Ova sekcija je posvećena alatima koji će **preuzeti svaki repozitorijum i tražiti osetljive informacije u njima** (čak i proveravajući određenu dubinu commit-ova).

Alati (svaki alat sadrži svoju listu regex-a):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Kada tražite curenja u repozitorijumu i pokrenete nešto poput `git log -p`, ne zaboravite da mogu postojati **druge grane sa drugim commit-ovima** koji sadrže tajne!
{% endhint %}

### Spoljni Forkovi

Moguće je **ugroziti repozitorijume zloupotrebom pull zahteva**. Da biste saznali da li je repozitorijum ranjiv, uglavnom treba da pročitate Github Actions yaml konfiguracije. [**Više informacija o tome ispod**](./#execution-from-a-external-fork).

## Jačanje Organizacije

### Privilegije Članova

Postoje neke **podrazumevane privilegije** koje se mogu dodeliti **članovima** organizacije. Ove privilegije se mogu kontrolisati sa stranice `https://github.com/organizations/<org_name>/settings/member_privileges` ili preko [**Organizations API-ja**](https://docs.github.com/en/rest/orgs/orgs).

* **Osnovna ovlašćenja**: Članovi će imati ovlašćenja None/Read/write/Admin nad repozitorijumima organizacije. Preporučuje se **None** ili **Read**.
* **Forkovanje repozitorijuma**: Ako nije neophodno, bolje je **ne dozvoliti** članovima da forkiraju repozitorijume organizacije.
* **Kreiranje stranica**: Ako nije neophodno, bolje je **ne dozvoliti** članovima da objavljuju stranice iz repozitorijuma organizacije. Ako je potrebno, možete dozvoliti kreiranje javnih ili privatnih stranica.
* **Zahtevi za pristup integracijama**: Sa ovim omogućenim, spoljni saradnici će moći da zatraže pristup GitHub ili OAuth aplikacijama za pristup ovoj organizaciji i njenim resursima. Obično je potrebno, ali ako nije, bolje je onemogućiti.
* _Nisam mogao da pronađem ove informacije u API odgovoru, podelite ako vi pronađete_
* **Promena vidljivosti repozitorijuma**: Ako je omogućeno, **članovi** sa **admin** ovlašćenjima za **repozitorijum** će moći da **promene njegovu vidljivost**. Ako je onemogućeno, samo vlasnici organizacije mogu promeniti vidljivost repozitorijuma. Ako **ne želite** da ljudi čine stvari **javno dostupnim**, pobrinite se
### Integracije

_Javite mi ako znate API endpoint za pristupanje ovim informacijama!_

* **Politika pristupa trećih aplikacija**: Preporučuje se ograničiti pristup svakoj aplikaciji i dozvoliti samo one koje su potrebne (nakon pregleda).
* **Instalirane GitHub aplikacije**: Preporučuje se dozvoliti samo one koje su potrebne (nakon pregleda).

## Recon & Napadi zloupotrebom akreditiva

Za ovaj scenario pretpostavljamo da ste već dobili pristup GitHub nalogu.

### Sa korisničkim akreditivima

Ako već imate akreditive za korisnika unutar organizacije, možete se **samo prijaviti** i proveriti koje **uloge imate u preduzeću i organizaciji**, ako ste običan član, proverite koje **dozvole imaju obični članovi**, u kojim **grupama** se nalazite, koje **dozvole imate** nad kojim **repozitorijumima**, i **kako su repozitorijumi zaštićeni**.

Imajte na umu da se može koristiti **2FA**, pa ćete moći pristupiti ovim informacijama samo ako možete **proći tu proveru**.

{% hint style="info" %}
Imajte na umu da ako **uspete da ukradete `user_session` kolačić** (trenutno konfigurisan sa SameSite: Lax), možete **potpuno se predstavljati kao korisnik** bez potrebe za akreditivima ili 2FA.
{% endhint %}

Proverite odeljak ispod o [**zaobilaženju zaštite grana**](./#zaobilaženje-zaštite-grana) ako je korisno.

### Sa korisničkim SSH ključem

Github omogućava **korisnicima** da postave **SSH ključeve** koji će se koristiti kao **metod autentifikacije za implementaciju koda** u njihovo ime (ne primenjuje se 2FA).

Sa ovim ključem možete izvršiti **promene u repozitorijumima gde korisnik ima privilegije**, međutim ne možete ga koristiti za pristupanje GitHub API-ju radi nabrojavanja okruženja. Međutim, možete **nabrojati lokalne postavke** kako biste dobili informacije o repozitorijumima i korisniku kojima imate pristup:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Ako korisnik konfiguriše svoje korisničko ime kao svoje github korisničko ime, možete pristupiti **javnom ključu koji je postavio** na svom nalogu na _https://github.com/\<github\_korisničko\_ime>.keys_, možete to proveriti da biste potvrdili da li pronađeni privatni ključ može da se koristi.

**SSH ključevi** takođe mogu biti postavljeni u repozitorijumima kao **deploy ključevi**. Svako ko ima pristup ovom ključu moći će da **pokrene projekte iz repozitorijuma**. Obično, na serveru sa različitim deploy ključevima, lokalna datoteka **`~/.ssh/config`** će vam pružiti informacije o tome koji ključ je povezan.

#### GPG Ključevi

Kao što je objašnjeno [**ovde**](broken-reference/), ponekad je potrebno potpisati komitove ili biste mogli biti otkriveni.

Lokalno proverite da li trenutni korisnik ima neki ključ sa:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Sa korisničkim tokenom

Za uvod o **Korisničkim tokenima proverite osnovne informacije**.

Korisnički token se može koristiti **umesto lozinke** za Git preko HTTPS-a, ili se može koristiti za **autentifikaciju na API-ju preko osnovne autentifikacije**. Zavisno od privilegija koje su mu dodeljene, možete izvršiti različite radnje.

Korisnički token izgleda ovako: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Sa Oauth aplikacijom

Za uvod o **Github Oauth aplikacijama proverite osnovne informacije**.

Napadač može kreirati **zlonamernu Oauth aplikaciju** kako bi pristupio privilegovanim podacima/akcijama korisnika koji ih prihvataju, verovatno kao deo kampanje phishinga.

Ovo su [oblasti koje Oauth aplikacija može zahtevati](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Uvek treba proveriti zahtevane oblasti pre nego što ih prihvatite.

Osim toga, kao što je objašnjeno u osnovnim informacijama, **organizacije mogu dozvoliti/odbijati pristup aplikacijama trećih strana** informacijama/repositorijumima/akcijama vezanim za organizaciju.

### Sa Github aplikacijom

Za uvod o **Github aplikacijama proverite osnovne informacije**.

Napadač može kreirati **zlonamernu Github aplikaciju** kako bi pristupio privilegovanim podacima/akcijama korisnika koji ih prihvataju, verovatno kao deo kampanje phishinga.

Osim toga, kao što je objašnjeno u osnovnim informacijama, **organizacije mogu dozvoliti/odbijati pristup aplikacijama trećih strana** informacijama/repositorijumima/akcijama vezanim za organizaciju.

## Kompromitacija i zloupotreba Github akcija

Postoji nekoliko tehnika za kompromitaciju i zloupotrebu Github akcija, proverite ih ovde:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Zaobilaženje zaštite grane

* **Zahtevanje određenog broja odobrenja**: Ako ste kompromitovali nekoliko naloga, možete prihvatiti svoje PR-ove sa drugih naloga. Ako imate samo nalog sa kojeg ste kreirali PR, ne možete prihvatiti svoj sopstveni PR. Međutim, ako imate pristup **Github Action** okruženju unutar repozitorijuma, koristeći **GITHUB\_TOKEN** možda ćete moći **odobriti svoj PR** i na taj način dobiti 1 odobrenje.
* _Napomena za ovo i za ograničenje vlasnika koda je da korisnik obično neće moći odobriti svoje sopstvene PR-ove, ali ako možete, možete ih zloupotrebiti da biste prihvatili svoje PR-ove._
* **Odbacivanje odobrenja kada se pošalju novi commit-ovi**: Ako ovo nije podešeno, možete poslati legitimni kod, sačekati da ga neko odobri, a zatim uneti zlonameran kod i spojiti ga na zaštićenu granu.
* **Zahtevanje odobrenja od vlasnika koda**: Ako je ovo aktivirano i vi ste vlasnik koda, možete napraviti **Github Action koji će kreirati vaš PR, a zatim ga sami odobriti**.
* Kada je **CODEOWNER fajl netačno konfigurisan**, Github ne prijavljuje grešku, ali ga ne koristi. Dakle, ako je netačno konfigurisan, **zaštita vlasnika koda se ne primenjuje**.
* **Dozvoljavanje određenim akterima da zaobiđu zahteve za pull request**: Ako ste jedan od tih aktera, možete zaobići zaštitu pull requesta.
* **Uključivanje administratora**: Ako ovo nije podešeno i vi ste administrator repozitorijuma, možete zaobići ovu zaštitu grane.
* **Hijacking PR-a**: Možete biti u mogućnosti da **izmenite PR nekog drugog** dodavanjem zlonamernog koda, odobrite rezultirajući PR sami i spojite sve.
* **Uklanjanje zaštite grane**: Ako ste **administrator repozitorijuma, možete onemogućiti zaštitu**, spojiti svoj PR i ponovo postaviti zaštitu.
* **Zaobilaženje zaštite push-ova**: Ako repozitorijum **samo određenim korisnicima dozvoljava** slanje push-ova (spajanje koda) na granama (zaštita grane može štititi sve grane koristeći wildcard `*`).
* Ako imate **pristup pisanju nad repozitorijumom, ali vam nije dozvoljeno slanje koda** zbog zaštite grane, i dalje možete **kreirati novu granu** i unutar nje kreirati **Github Action koji se pokreće kada se kod pošalje**. Pošto **zaštita grane neće štititi granu dok se ne kreira**, prvo slanje koda na granu će **pokrenuti Github Action**.

## Zaobilaženje zaštite okruženja

Za uvod o **Github okruženjima proverite osnovne informacije**.

U slučaju da se na **svim granama može pristupiti okruženju**, ono **nije zaštićeno** i lako možete pristupiti tajnama unutar okruženja. Imajte na umu da možete naići na repozitorijume gde su **sve grane zaštićene** (navođenjem njihovih imena ili korišćenjem `*`), u tom scenariju **pronađite granu na koju možete slati kod** i možete **izfiltrirati** tajne kreiranjem nove Github akcije (ili modifikacijom postojeće).

Imajte na umu da možete naići na specifičan slučaj gde su **sve grane zaštićene** (pomoću wildcard `*`) i **navedeno je ko može slati kod na grane** (_to možete specificirati u zaštiti grane_) i **vašem korisniku nije dozvoljeno**. Ipak, možete pokrenuti prilagođenu Github akciju jer možete kreirati granu i koristiti okidač za slanje koda na samu sebe. **Zaštita grane dozvoljava slanje na novu granu, pa će se Github akcija pokrenuti**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Napomena da će **nakon kreiranja** grane **zaštita grane biti primenjena na novu granu** i nećete moći da je menjate, ali do tada ćete već izvukli tajne.

## Upornost

* Generišite **korisnički token**
* Ukradite **github token-e** iz **tajni**
* **Brisanje** rezultata radnog toka i grana
* Dajte **više dozvola svim organizacijama**
* Kreirajte **webhook-ove** za izvlačenje informacija
* Pozovite **spoljne saradnike**
* **Uklonite webhook-ove** koje koristi **SIEM**
* Kreirajte/izmenite **Github Action** sa **zadnjim vratima**
* Pronađite **ranjivu Github Action za ubrizgavanje komandi** putem izmene vrednosti **tajne**

### Lažni commit-ovi - Zadnja vrata putem commit-a repozitorijuma

Na Github-u je moguće **kreirati PR za repozitorijum iz forka**. Čak i ako PR nije **prihvaćen**, id commit-a unutar originalnog repozitorijuma će biti kreiran za verziju koda iz forka. Stoga, napadač **može da se veže za određeni commit iz navodno legitimnog repozitorijuma koji nije kreirao vlasnik repozitorijuma**.

Kao [**ovde**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Za više informacija pogledajte [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju oglašenu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
