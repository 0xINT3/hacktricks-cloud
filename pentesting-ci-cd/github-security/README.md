# S√©curit√© de Github

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PRs** √† [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Qu'est-ce que Github

(D'apr√®s [ici](https://kinsta.com/knowledgebase/what-is-github/)) En gros, **Github est un site web et un service bas√© sur le cloud qui aide les d√©veloppeurs √† stocker et g√©rer leur code, ainsi qu'√† suivre et contr√¥ler les modifications apport√©es √† leur code**.

### Informations de base

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Reconnaissance externe

Les d√©p√¥ts Github peuvent √™tre configur√©s comme publics, priv√©s et internes.

* **Priv√©** signifie que seules les personnes de l'**organisation** pourront y acc√©der.
* **Interne** signifie que seules les personnes de l'**entreprise** (une entreprise peut avoir plusieurs organisations) pourront y acc√©der.
* **Public** signifie que **tout Internet** pourra y acc√©der.

Si vous connaissez l'**utilisateur, le d√©p√¥t ou l'organisation que vous souhaitez cibler**, vous pouvez utiliser des **dorks Github** pour trouver des informations sensibles ou rechercher des **fuites d'informations sensibles** **sur chaque d√©p√¥t**.

### Dorks Github

Github permet de **rechercher quelque chose en sp√©cifiant comme port√©e un utilisateur, un d√©p√¥t ou une organisation**. Par cons√©quent, avec une liste de cha√Ænes de caract√®res qui vont appara√Ætre √† proximit√© d'informations sensibles, vous pouvez facilement **rechercher des informations sensibles potentielles dans votre cible**.

Outils (chaque outil contient sa liste de dorks) :

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Liste des dorks](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Liste des dorks](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Liste des dorks](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Fuites Github

Veuillez noter que les dorks Github sont √©galement destin√©s √† rechercher des fuites en utilisant les options de recherche de Github. Cette section est d√©di√©e aux outils qui vont **t√©l√©charger chaque d√©p√¥t et rechercher des informations sensibles** (m√™me en v√©rifiant une certaine profondeur des commits).

Outils (chaque outil contient sa liste de regex) :

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Lorsque vous recherchez des fuites dans un d√©p√¥t et ex√©cutez quelque chose comme `git log -p`, n'oubliez pas qu'il peut y avoir **d'autres branches avec d'autres commits** contenant des secrets !
{% endhint %}

### Forks externes

Il est possible de **compromettre des d√©p√¥ts en abusant des pull requests**. Pour savoir si un d√©p√¥t est vuln√©rable, vous devez principalement lire les configurations yaml de Github Actions. [**Plus d'informations √† ce sujet ci-dessous**](./#execution-from-a-external-fork).

## Renforcement de l'organisation

### Privil√®ges des membres

Il existe quelques **privil√®ges par d√©faut** qui peuvent √™tre attribu√©s aux **membres** de l'organisation. Ils peuvent √™tre contr√¥l√©s depuis la page `https://github.com/organizations/<nom_org>/settings/member_privileges` ou depuis l'[**API des organisations**](https://docs.github.com/en/rest/orgs/orgs).

* **Permissions de base** : Les membres auront la permission Aucune/Lecture/√âcriture/Admin sur les d√©p√¥ts de l'organisation. Il est recommand√© de choisir **Aucune** ou **Lecture**.
* **Fork de d√©p√¥t** : S'il n'est pas n√©cessaire, il vaut mieux **ne pas autoriser** les membres √† faire des forks des d√©p√¥ts de l'organisation.
* **Cr√©ation de pages** : S'il n'est pas n√©cessaire, il vaut mieux **ne pas autoriser** les membres √† publier des pages √† partir des d√©p√¥ts de l'organisation. Si n√©cessaire, vous pouvez autoriser la cr√©ation de pages publiques ou priv√©es.
* **Demandes d'acc√®s aux int√©grations** : Avec cette option activ√©e, les collaborateurs externes pourront demander l'acc√®s aux applications GitHub ou OAuth pour acc√©der √† cette organisation et √† ses ressources. C'est g√©n√©ralement n√©cessaire, mais si ce n'est pas le cas, il vaut mieux le d√©sactiver.
* _Je n'ai pas pu trouver cette information dans la r√©ponse de l'API, partagez-la si vous la trouvez_
* **Modification de la visibilit√© du d√©p√¥t** : Si activ√©e, les **membres** ayant des **permissions d'administrateur** pour le **d√©p√¥t** pourront **modifier sa visibilit√©**. Si d√©sactiv√©e, seuls les propri√©taires de l'organisation peuvent modifier la visibilit√© des d√©p√¥ts. Si vous ne voulez pas que les choses soient **publiques**, assurez-vous que cela est **d√©sactiv√©**.
* _Je n'ai pas pu trouver cette information dans la r√©ponse de l'API, partagez-la si vous la trouvez_
* **Suppression et transfert de d√©p√¥ts** : Si activ√©e, les membres ayant des **permissions d'administrateur** pour le d√©p√¥t pourront **supprimer** ou **transf√©rer** des d√©p√¥ts publics et priv√©s.
* _Je n'ai pas pu trouver cette information dans la r√©ponse de l'API, partagez-la si vous la trouvez_
* **Autoriser les membres √† cr√©er des √©quipes** : Si activ√©e, tous les **membres** de l'organisation pourront **cr√©er** de nouvelles **√©quipes**. Si d√©sactiv√©e, seuls les propri√©taires de l'organisation peuvent cr√©er de nouvelles √©quipes. Il vaut mieux avoir cela d√©sactiv√©.
* _Je n'ai pas pu trouver cette information dans la r√©ponse de l'API, partagez-la si vous la trouvez_
* **D'autres choses peuvent √™tre configur√©es** sur cette page, mais les pr√©c√©dentes sont celles qui sont les plus li√©es √† la s√©curit√©.
### Param√®tres des actions

Plusieurs param√®tres li√©s √† la s√©curit√© peuvent √™tre configur√©s pour les actions √† partir de la page `https://github.com/organizations/<nom_org>/settings/actions`.

{% hint style="info" %}
Notez que toutes ces configurations peuvent √©galement √™tre d√©finies ind√©pendamment pour chaque d√©p√¥t.
{% endhint %}

* **Politiques des actions Github** : Cela vous permet d'indiquer quels d√©p√¥ts peuvent ex√©cuter des flux de travail et quels flux de travail doivent √™tre autoris√©s. Il est recommand√© de **sp√©cifier les d√©p√¥ts** autoris√©s et de ne pas autoriser l'ex√©cution de toutes les actions.
* [**API-1**](https://docs.github.com/en/rest/actions/permissions#get-allowed-actions-and-reusable-workflows-for-an-organization)**,** [**API-2**](https://docs.github.com/en/rest/actions/permissions#list-selected-repositories-enabled-for-github-actions-in-an-organization)
* **Flux de travail des demandes de tirage de forks provenant de collaborateurs externes** : Il est recommand√© d'**exiger une approbation pour tous** les collaborateurs externes.
* _Je n'ai pas trouv√© d'API avec ces informations, partagez si vous en trouvez une_
* **Ex√©cuter des flux de travail √† partir de demandes de tirage de forks** : Il est fortement **d√©conseill√© d'ex√©cuter des flux de travail √† partir de demandes de tirage** car les mainteneurs de l'origine du fork auront la possibilit√© d'utiliser des jetons avec des permissions de lecture sur le d√©p√¥t source.
* _Je n'ai pas trouv√© d'API avec ces informations, partagez si vous en trouvez une_
* **Permissions des flux de travail** : Il est fortement recommand√© de **ne donner que des permissions de lecture sur le d√©p√¥t**. Il est d√©conseill√© de donner des permissions d'√©criture et de cr√©ation/approbation de demandes de tirage pour √©viter les abus du GITHUB\_TOKEN donn√© aux flux de travail en cours d'ex√©cution.
* [**API**](https://docs.github.com/en/rest/actions/permissions#get-default-workflow-permissions-for-an-organization)

### Int√©grations

_Faites-moi savoir si vous connaissez le point d'API pour acc√©der √† ces informations !_

* **Politique d'acc√®s aux applications tierces** : Il est recommand√© de restreindre l'acc√®s √† chaque application et de n'autoriser que celles n√©cessaires (apr√®s les avoir examin√©es).
* **Applications GitHub install√©es** : Il est recommand√© de n'autoriser que celles n√©cessaires (apr√®s les avoir examin√©es).

## Reconnaissance et attaques exploitant des informations d'identification

Pour ce sc√©nario, supposons que vous ayez obtenu un certain acc√®s √† un compte GitHub.

### Avec les informations d'identification de l'utilisateur

Si vous disposez d√©j√† des informations d'identification d'un utilisateur au sein d'une organisation, vous pouvez simplement vous **connecter** et v√©rifier les **r√¥les d'entreprise et d'organisation que vous avez**, si vous √™tes un membre brut, v√©rifiez les **permissions des membres bruts**, dans quels **groupes** vous vous trouvez, quelles **permissions vous avez** sur quels **d√©p√¥ts**, et **comment les d√©p√¥ts sont prot√©g√©s**.

Notez que **l'authentification √† deux facteurs (2FA) peut √™tre utilis√©e**, vous ne pourrez donc acc√©der √† ces informations que si vous pouvez √©galement **passer cette v√©rification**.

{% hint style="info" %}
Notez que si vous **parvenez √† voler le cookie `user_session`** (actuellement configur√© avec SameSite: Lax), vous pouvez **vous faire passer compl√®tement pour l'utilisateur** sans avoir besoin d'informations d'identification ou de 2FA.
{% endhint %}

Consultez la section ci-dessous sur les [**contournements des protections de branche**](./#branch-protection-bypass) au cas o√π cela serait utile.

### Avec la cl√© SSH de l'utilisateur

Github permet aux **utilisateurs** de d√©finir des **cl√©s SSH** qui seront utilis√©es comme **m√©thode d'authentification pour d√©ployer du code** en leur nom (aucun 2FA n'est appliqu√©).

Avec cette cl√©, vous pouvez effectuer des **modifications dans les d√©p√¥ts o√π l'utilisateur a certains privil√®ges**, mais vous ne pouvez pas l'utiliser pour acc√©der √† l'API GitHub afin d'√©num√©rer l'environnement. Cependant, vous pouvez **√©num√©rer les param√®tres locaux** pour obtenir des informations sur les d√©p√¥ts et l'utilisateur auxquels vous avez acc√®s :
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Si l'utilisateur a configur√© son nom d'utilisateur comme son nom d'utilisateur GitHub, vous pouvez acc√©der aux **cl√©s publiques qu'il a d√©finies** dans son compte sur _https://github.com/\<github\_username>.keys_, vous pouvez v√©rifier cela pour confirmer que la cl√© priv√©e que vous avez trouv√©e peut √™tre utilis√©e.

Les **cl√©s SSH** peuvent √©galement √™tre d√©finies dans les d√©p√¥ts en tant que **cl√©s de d√©ploiement**. Toute personne ayant acc√®s √† cette cl√© pourra **lancer des projets √† partir d'un d√©p√¥t**. Habituellement, sur un serveur avec diff√©rentes cl√©s de d√©ploiement, le fichier local **`~/.ssh/config`** vous donnera des informations sur la cl√© associ√©e.

#### Cl√©s GPG

Comme expliqu√© [**ici**](broken-reference/), il est parfois n√©cessaire de signer les commits, sinon vous pourriez √™tre d√©couvert.

V√©rifiez localement si l'utilisateur actuel poss√®de une cl√© avec:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Avec un jeton d'utilisateur

Pour une introduction sur les [**jetons d'utilisateur, consultez les informations de base**](basic-github-information.md#personal-access-tokens).

Un jeton d'utilisateur peut √™tre utilis√© **√† la place d'un mot de passe** pour Git via HTTPS, ou peut √™tre utilis√© pour [**s'authentifier √† l'API via l'authentification de base**](https://docs.github.com/v3/auth/#basic-authentication). Selon les privil√®ges qui y sont attach√©s, vous pouvez effectuer diff√©rentes actions.

Un jeton d'utilisateur ressemble √† ceci : `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Avec une application Oauth

Pour une introduction sur les [**applications Oauth de Github, consultez les informations de base**](basic-github-information.md#oauth-applications).

Un attaquant pourrait cr√©er une **application Oauth malveillante** pour acc√©der aux donn√©es/actions privil√©gi√©es des utilisateurs qui les acceptent probablement dans le cadre d'une campagne de phishing.

Voici les [√©tendues qu'une application Oauth peut demander](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Vous devriez toujours v√©rifier les √©tendues demand√©es avant de les accepter.

De plus, comme expliqu√© dans les informations de base, **les organisations peuvent donner/refuser l'acc√®s aux applications tierces** aux informations/d√©p√¥ts/actions li√©es √† l'organisation.

### Avec une application Github

Pour une introduction sur les [**applications Github, consultez les informations de base**](basic-github-information.md#github-applications).

Un attaquant pourrait cr√©er une **application Github malveillante** pour acc√©der aux donn√©es/actions privil√©gi√©es des utilisateurs qui les acceptent probablement dans le cadre d'une campagne de phishing.

De plus, comme expliqu√© dans les informations de base, **les organisations peuvent donner/refuser l'acc√®s aux applications tierces** aux informations/d√©p√¥ts/actions li√©es √† l'organisation.

## Compromettre et abuser de l'action Github

Il existe plusieurs techniques pour compromettre et abuser d'une action Github, consultez-les ici :

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Contourner la protection de branche

* **Exiger un certain nombre d'approbations** : Si vous avez compromis plusieurs comptes, vous pouvez simplement accepter vos PR √† partir d'autres comptes. Si vous n'avez que le compte √† partir duquel vous avez cr√©√© la PR, vous ne pouvez pas accepter votre propre PR. Cependant, si vous avez acc√®s √† un environnement **Github Action** √† l'int√©rieur du d√©p√¥t, en utilisant le **GITHUB\_TOKEN**, vous pourrez **approuver votre PR** et obtenir une approbation de cette mani√®re.
* _Notez que pour cette restriction et pour la restriction des propri√©taires de code, un utilisateur ne pourra g√©n√©ralement pas approuver ses propres PR, mais si vous le pouvez, vous pouvez en abuser pour accepter vos propres PR._
* **Ignorer les approbations lorsque de nouveaux commits sont pouss√©s** : Si cela n'est pas activ√©, vous pouvez soumettre du code l√©gitime, attendre qu'il soit approuv√©, puis ajouter du code malveillant et le fusionner dans la branche prot√©g√©e.
* **Exiger des avis des propri√©taires de code** : Si cela est activ√© et que vous √™tes un propri√©taire de code, vous pouvez faire en sorte qu'une **action Github cr√©e votre PR et l'approuve vous-m√™me**.
* Lorsqu'un fichier **CODEOWNER est mal configur√©**, Github ne se plaint pas mais ne l'utilise pas. Par cons√©quent, si c'est mal configur√©, sa **protection des propri√©taires de code n'est pas appliqu√©e**.
* **Autoriser certains acteurs √† contourner les exigences des demandes de tirage** : Si vous √™tes l'un de ces acteurs, vous pouvez contourner les protections des demandes de tirage.
* **Inclure les administrateurs** : Si cela n'est pas activ√© et que vous √™tes administrateur du d√©p√¥t, vous pouvez contourner ces protections de branche.
* **D√©tournement de PR** : Vous pourriez √™tre en mesure de **modifier la PR de quelqu'un d'autre** en ajoutant du code malveillant, en approuvant la PR r√©sultante vous-m√™me et en fusionnant le tout.
* **Suppression des protections de branche** : Si vous √™tes un **administrateur du d√©p√¥t, vous pouvez d√©sactiver les protections**, fusionner votre PR et r√©activer les protections.
* **Contourner les protections de pouss√©e** : Si un d√©p√¥t **autorise uniquement certains utilisateurs** √† envoyer des pouss√©es (fusionner du code) dans les branches (la protection de branche peut prot√©ger toutes les branches en sp√©cifiant le joker `*`).
* Si vous avez **acc√®s en √©criture au d√©p√¥t mais que vous n'√™tes pas autoris√© √† pousser du code** en raison de la protection de branche, vous pouvez toujours **cr√©er une nouvelle branche** et y cr√©er une **action Github qui est d√©clench√©e lorsque du code est pouss√©**. Comme la **protection de branche ne prot√©gera pas la branche tant qu'elle n'est pas cr√©√©e**, cette premi√®re pouss√©e de code vers la branche **ex√©cutera l'action Github**.

## Contourner les protections d'environnement

Pour une introduction sur les [**environnements Github, consultez les informations de base**](basic-github-information.md#git-environments).

Dans le cas o√π un environnement peut √™tre **acc√©d√© depuis toutes les branches**, il n'est **pas prot√©g√©** et vous pouvez facilement acc√©der aux secrets √† l'int√©rieur de l'environnement. Notez que vous pourriez trouver des d√©p√¥ts o√π **toutes les branches sont prot√©g√©es** (en sp√©cifiant leurs noms ou en utilisant `*`) dans ce sc√©nario, **trouvez une branche o√π vous pouvez pousser du code** et vous pourrez **exfiltrer** les secrets en cr√©ant une nouvelle action Github (ou en la modifiant).

Notez que vous pourriez rencontrer le cas limite o√π **toutes les branches sont prot√©g√©es** (via le joker `*`) et il est sp√©cifi√© **qui peut pousser du code dans les branches** (_vous pouvez le sp√©cifier dans la protection de branche_) et que **votre utilisateur n'est pas autoris√©**. Vous pouvez toujours ex√©cuter une action Github personnalis√©e car vous pouvez cr√©er une branche et utiliser la d√©clencheur de pouss√©e sur elle-m√™me. La **protection de branche autorise la pouss√©e vers une nouvelle branche, donc l'action Github sera d√©clench√©e**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Notez qu'**apr√®s la cr√©ation** de la branche, la **protection de la branche s'appliquera √† la nouvelle branche** et vous ne pourrez pas la modifier, mais √† ce moment-l√†, vous aurez d√©j√† r√©cup√©r√© les secrets.

## Persistance

* G√©n√©rer un **jeton d'utilisateur**
* Voler les **jetons Github** depuis les **secrets**
* **Supprimer** les **r√©sultats** et les **branches** du flux de travail
* Donner **plus de permissions √† toute l'organisation**
* Cr√©er des **webhooks** pour exfiltrer des informations
* Inviter des **collaborateurs externes**
* **Supprimer** les **webhooks** utilis√©s par le **SIEM**
* Cr√©er/modifier une **Action Github** avec une **porte d√©rob√©e**
* Trouver une **Action Github vuln√©rable √† l'injection de commandes** via la modification de la valeur **secret**

### Commits d'usurpation - Porte d√©rob√©e via les commits du d√©p√¥t

Sur Github, il est possible de **cr√©er une demande de fusion (PR) vers un d√©p√¥t √† partir d'une bifurcation (fork)**. M√™me si la PR n'est **pas accept√©e**, un identifiant de **commit** dans le d√©p√¥t d'origine sera cr√©√© pour la version bifurqu√©e du code. Par cons√©quent, un attaquant **pourrait √©pingler l'utilisation d'un commit sp√©cifique provenant d'un d√©p√¥t apparemment l√©gitime qui n'a pas √©t√© cr√©√© par le propri√©taire du d√©p√¥t**.

Comme [**ici**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e) :
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Pour plus d'informations, consultez [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
