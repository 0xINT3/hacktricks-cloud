# Github Security

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Cos'√® Github

(A partire da [qui](https://kinsta.com/knowledgebase/what-is-github/)) A grandi linee, **Github √® un sito web e un servizio basato su cloud che aiuta gli sviluppatori a archiviare e gestire il loro codice, nonch√© a tracciare e controllare le modifiche al loro codice**.

### Informazioni di base

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Ricognizione esterna

I repository di Github possono essere configurati come pubblici, privati e interni.

* **Privato** significa che solo le persone dell'**organizzazione** potranno accedervi
* **Interno** significa che solo le persone dell'**azienda** (un'azienda pu√≤ avere diverse organizzazioni) potranno accedervi
* **Pubblico** significa che **tutti** su Internet potranno accedervi.

Nel caso in cui conosci l'**utente, il repository o l'organizzazione** che vuoi prendere di mira, puoi utilizzare **github dorks** per trovare informazioni sensibili o cercare **perdite di informazioni sensibili** **su ogni repository**.

### Github Dorks

Github consente di **cercare qualcosa specificando come ambito un utente, un repository o un'organizzazione**. Pertanto, con un elenco di stringhe che appariranno vicino a informazioni sensibili, √® possibile **cercare facilmente informazioni sensibili potenziali nel tuo obiettivo**.

Strumenti (ogni strumento contiene la sua lista di dorks):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Lista di dorks](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Lista di dorks](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Lista di dorks](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Perdite di Github

Si prega di notare che i github dorks sono anche destinati a cercare perdite utilizzando le opzioni di ricerca di github. Questa sezione √® dedicata agli strumenti che **scaricheranno ogni repository e cercheranno informazioni sensibili al loro interno** (controllando anche una certa profondit√† dei commit).

Strumenti (ogni strumento contiene la sua lista di regex):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Quando cerchi perdite in un repository e esegui qualcosa come `git log -p`, non dimenticare che potrebbero esserci **altri branch con altri commit** che contengono segreti!
{% endhint %}

### Fork esterni

√à possibile **compromettere i repository sfruttando le pull request**. Per sapere se un repository √® vulnerabile, √® necessario leggere principalmente le configurazioni yaml di Github Actions. [**Maggiori informazioni su questo di seguito**](./#execution-from-a-external-fork).

## Rafforzamento dell'organizzazione

### Privilegi dei membri

Ci sono alcuni **privilegi predefiniti** che possono essere assegnati ai **membri** dell'organizzazione. Questi possono essere controllati dalla pagina `https://github.com/organizations/<org_name>/settings/member_privileges` o dall'[**API delle organizzazioni**](https://docs.github.com/en/rest/orgs/orgs).

* **Permessi di base**: I membri avranno il permesso Nessuno/Lettura/Scrittura/Amministratore sui repository dell'organizzazione. Si consiglia di impostare **Nessuno** o **Lettura**.
* **Fork del repository**: Se non necessario, √® meglio **non consentire** ai membri di fare il fork dei repository dell'organizzazione.
* **Creazione di pagine**: Se non necessario, √® meglio **non consentire** ai membri di pubblicare pagine dai repository dell'organizzazione. Se necessario, √® possibile consentire la creazione di pagine pubbliche o private.
* **Richieste di accesso all'integrazione**: Con questa opzione abilitata, i collaboratori esterni potranno richiedere l'accesso alle app GitHub o OAuth per accedere a questa organizzazione e alle sue risorse. Di solito √® necessario, ma se non lo √®, √® meglio disabilitarlo.
* _Non ho trovato queste informazioni nella risposta delle API, condividile se le trovi_
* **Modifica della visibilit√† del repository**: Se abilitata, i **membri** con permessi di **amministratore** per il **repository** potranno **cambiare la sua visibilit√†**. Se disabilitata, solo i proprietari dell'organizzazione possono cambiare la visibilit√† del repository. Se **non** vuoi che le persone rendano le cose **pubbliche**, assicurati che questa opzione sia **disabilitata**.
* _Non ho trovato queste informazioni nella risposta delle API, condividile se le trovi_
* **Eliminazione e trasferimento del repository**: Se abilitata, i membri con permessi di **amministratore** per il repository potranno **eliminare** o **trasferire** repository pubblici e privati.
* _Non ho trovato queste informazioni nella risposta delle API, condividile se le trovi_
* **Consenti ai membri di creare team**: Se abilitata, **qualsiasi membro** dell'organizzazione potr√† **creare** nuovi **team**. Se disabilitata, solo i proprietari dell'organizzazione possono creare nuovi team. √à meglio avere questa opzione disabilitata.
* _Non ho trovato queste informazioni nella risposta delle API, condividile se le trovi_
* **Altre cose possono essere configurate** in questa pagina, ma le precedenti sono

### Integrazioni

_Fammi sapere se conosci il punto di accesso API per accedere a queste informazioni!_

* **Politica di accesso alle applicazioni di terze parti**: Si consiglia di limitare l'accesso a ogni applicazione e consentire solo quelle necessarie (dopo averle esaminate).
* **App GitHub installate**: Si consiglia di consentire solo quelle necessarie (dopo averle esaminate).

## Ricognizione e attacchi che abusano delle credenziali

Per questo scenario supponiamo che tu abbia ottenuto l'accesso a un account GitHub.

### Con le credenziali dell'utente

Se in qualche modo hai gi√† le credenziali di un utente all'interno di un'organizzazione, puoi **semplicemente effettuare il login** e verificare quali **ruoli aziendali e organizzativi hai**, se sei un membro normale, verifica quali **permessi hanno i membri normali**, a quali **gruppi** appartieni, quali **permessi hai** su quali **repository** e **come sono protetti i repository**.

Nota che potrebbe essere utilizzato **2FA**, quindi potrai accedere a queste informazioni solo se riesci anche a **superare quel controllo**.

{% hint style="info" %}
Nota che se **riesci a rubare il cookie `user_session`** (attualmente configurato con SameSite: Lax) puoi **impersonare completamente l'utente** senza aver bisogno di credenziali o 2FA.
{% endhint %}

Controlla la sezione sottostante su [**come aggirare le protezioni del branch**](./#bypass-delle-protezioni-del-branch) nel caso sia utile.

### Con la chiave SSH dell'utente

Github consente agli **utenti** di impostare **chiavi SSH** che verranno utilizzate come **metodo di autenticazione per distribuire il codice** per loro conto (non viene applicato il 2FA).

Con questa chiave puoi effettuare **modifiche nei repository in cui l'utente ha alcuni privilegi**, tuttavia non puoi usarla per accedere all'API di GitHub per enumerare l'ambiente. Tuttavia, puoi **enumerare le impostazioni locali** per ottenere informazioni sui repository e sull'utente a cui hai accesso:

```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```

Se l'utente ha configurato il suo nome utente come il suo nome utente di GitHub, √® possibile accedere alle **chiavi pubbliche che ha impostato** nel suo account su _https://github.com/\<github\_username>.keys_, √® possibile controllare questo per confermare che la chiave privata trovata possa essere utilizzata.

Le **chiavi SSH** possono anche essere impostate nei repository come **chiavi di deploy**. Chiunque abbia accesso a questa chiave sar√† in grado di **avviare progetti da un repository**. Di solito, in un server con diverse chiavi di deploy, il file locale **`~/.ssh/config`** ti fornir√† informazioni su quale chiave √® correlata.

#### Chiavi GPG

Come spiegato [**qui**](https://github.com/carlospolop/hacktricks-cloud/blob/it/pentesting-ci-cd/github-security/broken-reference/README.md), a volte √® necessario firmare i commit o potresti essere scoperto.

Controlla localmente se l'utente corrente ha una chiave con:

```shell
gpg --list-secret-keys --keyid-format=long
```

### Con Token Utente

Per una introduzione sui [**Token Utente controlla le informazioni di base**](basic-github-information.md#personal-access-tokens).

Un token utente pu√≤ essere utilizzato **al posto di una password** per Git tramite HTTPS, o pu√≤ essere utilizzato per [**autenticarsi all'API tramite Autenticazione di Base**](https://docs.github.com/v3/auth/#basic-authentication). A seconda dei privilegi ad esso associati, potresti essere in grado di eseguire diverse azioni.

Un token utente ha questo aspetto: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Con Applicazione Oauth

Per una introduzione sulle [**Applicazioni Oauth di Github controlla le informazioni di base**](basic-github-information.md#oauth-applications).

Un attaccante potrebbe creare un'**Applicazione Oauth malevola** per accedere a dati/azioni privilegiate degli utenti che li accettano probabilmente come parte di una campagna di phishing.

Questi sono gli [ambiti che un'applicazione Oauth pu√≤ richiedere](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Si dovrebbero sempre controllare gli ambiti richiesti prima di accettarli.

Inoltre, come spiegato nelle informazioni di base, **le organizzazioni possono concedere/negare l'accesso a terze parti** a informazioni/repository/azioni relative all'organizzazione.

### Con Applicazione Github

Per una introduzione sulle [**Applicazioni Github controlla le informazioni di base**](basic-github-information.md#github-applications).

Un attaccante potrebbe creare un'**Applicazione Github malevola** per accedere a dati/azioni privilegiate degli utenti che li accettano probabilmente come parte di una campagna di phishing.

Inoltre, come spiegato nelle informazioni di base, **le organizzazioni possono concedere/negare l'accesso a terze parti** a informazioni/repository/azioni relative all'organizzazione.

## Compromettere e Abusare di Github Action

Ci sono diverse tecniche per compromettere e abusare di una Github Action, controllale qui:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Bypass delle Protezioni del Branch

* **Richiedi un numero di approvazioni**: Se hai compromesso diversi account, potresti semplicemente accettare le tue PR da altri account. Se hai solo l'account da cui hai creato la PR, non puoi accettare la tua stessa PR. Tuttavia, se hai accesso a un ambiente **Github Action** all'interno del repository, utilizzando il **GITHUB\_TOKEN**, potresti essere in grado di **approvare la tua PR** e ottenere un'approvazione in questo modo.
* _Nota che di solito un utente non sar√† in grado di approvare le sue stesse PR, ma se lo sei, puoi abusarne per accettare le tue PR._
* **Ignora le approvazioni quando vengono inviati nuovi commit**: Se questa opzione non √® impostata, puoi inviare codice legittimo, aspettare che qualcuno lo approvi e inserire codice maligno e unirlo al branch protetto.
* **Richiedi revisioni dai proprietari del codice**: Se questa opzione √® attivata e sei un proprietario del codice, potresti fare in modo che una **Github Action crei la tua PR e poi la approvi tu stesso**.
* Quando un **file CODEOWNER √® configurato in modo errato**, Github non segnala l'errore ma non lo utilizza. Pertanto, se √® configurato in modo errato, la sua **protezione dei proprietari del codice non viene applicata**.
* **Consenti ad attori specificati di eludere i requisiti delle pull request**: Se sei uno di questi attori, puoi eludere le protezioni delle pull request.
* **Includi gli amministratori**: Se questa opzione non √® impostata e sei un amministratore del repository, puoi eludere queste protezioni del branch.
* **Hijacking delle PR**: Potresti essere in grado di **modificare la PR di qualcun altro** aggiungendo codice maligno, approvando la PR risultante tu stesso e unendo tutto.
* **Rimuovere le Protezioni del Branch**: Se sei un **amministratore del repository, puoi disabilitare le protezioni**, unire la tua PR e reimpostare le protezioni.
* **Eludere le protezioni di push**: Se un repository **consente solo a determinati utenti** di inviare push (unire il codice) nei branch (la protezione del branch potrebbe proteggere tutti i branch specificando il carattere jolly `*`).
* Se hai **accesso in scrittura al repository ma non ti √® consentito inviare codice** a causa della protezione del branch, puoi comunque **creare un nuovo branch** e al suo interno creare una **github action che viene attivata quando viene inviato del codice**. Poich√© la **protezione del branch non protegger√† il branch fino a quando non viene creato**, questo primo invio di codice al branch **eseguir√† la github action**.

## Eludere le Protezioni degli Ambienti

Per una introduzione sugli [**Ambienti di Github controlla le informazioni di base**](basic-github-information.md#git-environments).

Nel caso in cui un ambiente possa essere **accessibile da tutti i branch**, non √® **protetto** e puoi accedere facilmente ai segreti all'interno dell'ambiente. Tieni presente che potresti trovare repository in cui **tutti i branch sono protetti** (specificando i loro nomi o utilizzando `*`), in quel caso, **trova un branch in cui puoi inviare codice** e puoi **esfiltrare** i segreti creando una nuova github action (o modificandone una).

Tieni presente che potresti trovare il caso limite in cui **tutti i branch sono protetti** (tramite il carattere jolly `*`) e viene specificato **chi pu√≤ inviare codice ai branch** (_puoi specificarlo nella protezione del branch_) e **il tuo utente non √® autorizzato**. Puoi comunque eseguire una github action personalizzata perch√© puoi creare un branch e utilizzare il trigger di push su se stesso. La **protezione del branch consente l'invio a un nuovo branch, quindi la github action verr√† attivata**.

```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```

Nota che **dopo la creazione** del branch, le **protezioni del branch si applicheranno al nuovo branch** e non sarai in grado di modificarlo, ma nel frattempo avrai gi√† sottratto i segreti.

## Persistenza

* Generare un **token utente**
* Rubare i **token di Github** dai **secrets**
* **Cancellazione** dei **risultati del workflow** e dei **branch**
* Dare **pi√π permessi a tutta l'organizzazione**
* Creare **webhook** per esfiltrare informazioni
* Invitare **collaboratori esterni**
* **Rimuovere** i **webhook** utilizzati dal **SIEM**
* Creare/modificare una **Github Action** con una **backdoor**
* Trovare una **Github Action vulnerabile per l'iniezione di comandi** tramite la modifica del valore del **secret**

### Commit dell'impostore - Backdoor tramite commit del repository

In Github √® possibile **creare una PR per un repository da un fork**. Anche se la PR non viene **accettata**, verr√† creato un ID di **commit** all'interno del repository originale per la versione del codice del fork. Pertanto, un attaccante **potrebbe decidere di utilizzare un commit specifico da un repository apparentemente legittimo che non √® stato creato dal proprietario del repository**.

Come [**questo**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):

```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```

Per ulteriori informazioni, consulta [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF**, controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) su GitHub.

</details>
