# Bezpieczeństwo Githuba

<details>

<summary><strong>Dowiedz się, jak hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Czym jest Github

(Z [tutaj](https://kinsta.com/knowledgebase/what-is-github/)) Na wysokim poziomie, **GitHub to strona internetowa i usługa w chmurze, która pomaga programistom przechowywać i zarządzać ich kodem, a także śledzić i kontrolować zmiany w kodzie**.

### Podstawowe informacje

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Zewnętrzne rozpoznanie

Repozytoria Githuba mogą być skonfigurowane jako publiczne, prywatne i wewnętrzne.

* **Prywatne** oznacza, że będą do nich mieć dostęp tylko osoby z **organizacji**
* **Wewnętrzne** oznacza, że będą do nich mieć dostęp tylko osoby z **przedsiębiorstwa** (przedsiębiorstwo może mieć kilka organizacji)
* **Publiczne** oznacza, że będzie do nich mieć dostęp **cały internet**.

Jeśli znasz **użytkownika, repozytorium lub organizację**, którą chcesz zaatakować, możesz użyć **dorków Githuba**, aby znaleźć poufne informacje lub wyszukać **wycieki poufnych informacji w każdym repozytorium**.

### Dorki Githuba

Github umożliwia **wyszukiwanie czegoś, określając zakres użytkownika, repozytorium lub organizacji**. Dlatego, mając listę ciągów, które będą występować w pobliżu poufnych informacji, można łatwo **wyszukiwać potencjalne poufne informacje w celu ataku**.

Narzędzia (każde narzędzie zawiera swoją listę dorków):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Lista dorków](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Lista dorków](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Lista dorków](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Wycieki Githuba

Zauważ, że dorki Githuba służą również do wyszukiwania wycieków za pomocą opcji wyszukiwania Githuba. Ta sekcja jest poświęcona narzędziom, które **pobiorą każde repozytorium i wyszukają w nich poufne informacje** (nawet sprawdzając określoną głębokość commitów).

Narzędzia (każde narzędzie zawiera swoją listę wyrażeń regularnych):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Podczas szukania wycieków w repozytorium i uruchamiania czegoś takiego jak `git log -p`, nie zapomnij, że mogą istnieć **inne gałęzie z innymi commitami**, które zawierają poufne informacje!
{% endhint %}

### Zewnętrzne forki

Możliwe jest **skompromitowanie repozytoriów, wykorzystując żądania pull**. Aby dowiedzieć się, czy repozytorium jest podatne, przede wszystkim należy przeczytać konfiguracje yaml Github Actions. [**Więcej informacji na ten temat poniżej**](./#execution-from-a-external-fork).

## Utrudnianie organizacji

### Uprawnienia członków

Istnieją pewne **domyślne uprawnienia**, które można przypisać **członkom** organizacji. Można nimi zarządzać ze strony `https://github.com/organizations/<org_name>/settings/member_privileges` lub za pomocą [**API organizacji**](https://docs.github.com/en/rest/orgs/orgs).

* **Podstawowe uprawnienia**: Członkowie będą mieć uprawnienia None/Read/write/Admin wobec repozytoriów organizacji. Zalecane jest **None** lub **Read**.
* **Forkowanie repozytoriów**: Jeśli nie jest to konieczne, lepiej **nie zezwalać** członkom na forkowanie repozytoriów organizacji.
* **Tworzenie stron**: Jeśli nie jest to konieczne, lepiej **nie zezwalać** członkom na publikowanie stron z repozytoriów organizacji. Jeśli jest to konieczne, można zezwolić na tworzenie stron publicznych lub prywatnych.
* **Prośby o dostęp do integracji**: Po włączeniu tej opcji zewnętrzni współpracownicy będą mogli żądać dostępu do aplikacji GitHub lub OAuth do dostępu do tej organizacji i jej zasobów. Zazwyczaj jest to potrzebne, ale jeśli nie, lepiej to wyłączyć.
* _Nie znalazłem tych informacji w odpowiedziach API, podziel się, jeśli je znajdziesz_
* **Zmiana widoczności repozytorium**: Jeśli ta opcja jest włączona, **członkowie** z uprawnieniami **admin** dla **repozytorium** będą mogli **zmieniać jego widoczność**. Jeśli jest wyłączona, tylko właściciele organizacji mogą zmieniać widoczność repozytoriów. Jeśli nie chcesz, aby ludzie udostępn
### Integracje

_Daj mi znać, jeśli znasz punkt końcowy API, aby uzyskać dostęp do tych informacji!_

* **Polityka dostępu do aplikacji zewnętrznych**: Zaleca się ograniczenie dostępu do każdej aplikacji i zezwolenie tylko na te, które są potrzebne (po ich przeglądzie).
* **Zainstalowane aplikacje GitHub**: Zaleca się zezwolenie tylko na te, które są potrzebne (po ich przeglądzie).

## Rozpoznanie i ataki wykorzystujące poświadczenia

W tym scenariuszu załóżmy, że uzyskałeś dostęp do konta GitHub.

### Z poświadczeniami użytkownika

Jeśli w jakiś sposób masz już poświadczenia użytkownika w organizacji, możesz **po prostu się zalogować** i sprawdzić, jakie **role przedsiębiorstwa i organizacji posiadasz**, jeśli jesteś członkiem, sprawdzić, jakie **uprawnienia mają członkowie**, w jakich **grupach** się znajdujesz, jakie **uprawnienia masz** w stosunku do poszczególnych **repozytoriów** i **jak są one chronione**.

Należy zauważyć, że może być używane **2FA**, więc będziesz mógł uzyskać dostęp do tych informacji tylko wtedy, gdy będziesz w stanie **przejść tę weryfikację**.

{% hint style="info" %}
Należy zauważyć, że jeśli **uda ci się ukraść ciasteczko `user_session`** (obecnie skonfigurowane z SameSite: Lax), możesz **całkowicie podszywać się pod użytkownika** bez konieczności posiadania poświadczeń ani 2FA.
{% endhint %}

Sprawdź sekcję poniżej dotyczącą [**omijania zabezpieczeń gałęzi**](./#omijanie-zabezpieczeń-gałęzi), jeśli jest to przydatne.

### Z kluczem SSH użytkownika

Github umożliwia **użytkownikom** ustawienie **kluczy SSH**, które będą używane jako **metoda uwierzytelniania do wdrażania kodu** w ich imieniu (nie stosuje się 2FA).

Z tym kluczem możesz dokonywać **zmian w repozytoriach, w których użytkownik ma pewne uprawnienia**, jednak nie możesz go użyć do uzyskania dostępu do interfejsu API GitHub w celu wyliczenia środowiska. Możesz jednak **wyliczyć lokalne ustawienia**, aby uzyskać informacje o repozytoriach i użytkowniku, do których masz dostęp:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Jeśli użytkownik skonfigurował swoją nazwę użytkownika jako swoją nazwę użytkownika na GitHub, można uzyskać dostęp do **kluczy publicznych**, które ustawił w swoim koncie na stronie _https://github.com/\<nazwa\_użytkownika\_na\_GitHub>.keys_. Można to sprawdzić, aby potwierdzić, czy znaleziony klucz prywatny może być używany.

**Klucze SSH** mogą również być ustawiane w repozytoriach jako **klucze do wdrożeń**. Każda osoba mająca dostęp do tego klucza będzie mogła **uruchamiać projekty z repozytorium**. Zazwyczaj na serwerze z różnymi kluczami do wdrożeń plik lokalny **`~/.ssh/config`** dostarczy informacji o powiązanym kluczu.

#### Klucze GPG

Jak wyjaśniono [**tutaj**](broken-reference/), czasami konieczne jest podpisywanie commitów, aby uniknąć wykrycia.

Sprawdź lokalnie, czy bieżący użytkownik ma jakikolwiek klucz za pomocą polecenia:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Za pomocą Tokena Użytkownika

Aby uzyskać wprowadzenie do [**Tokenów Użytkownika, sprawdź podstawowe informacje**](basic-github-information.md#personal-access-tokens).

Token użytkownika może być używany **zamiast hasła** dla Git przez HTTPS lub może być używany do [**uwierzytelniania w API za pomocą podstawowego uwierzytelniania**](https://docs.github.com/v3/auth/#basic-authentication). W zależności od przywilejów przypisanych do niego, możesz wykonywać różne czynności.

Token użytkownika wygląda tak: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Za pomocą Aplikacji Oauth

Aby uzyskać wprowadzenie do [**Aplikacji Oauth Github, sprawdź podstawowe informacje**](basic-github-information.md#oauth-applications).

Atakujący może stworzyć **złośliwą aplikację Oauth**, aby uzyskać dostęp do uprzywilejowanych danych/czynności użytkowników, którzy najprawdopodobniej akceptują je jako część kampanii phishingowej.

Oto [zakresy, które aplikacja Oauth może żądać](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Zawsze należy sprawdzić żądane zakresy przed ich akceptacją.

Ponadto, jak wyjaśniono w podstawowych informacjach, **organizacje mogą udzielać/odmawiać dostępu aplikacjom innych firm** do informacji/repozytoriów/czynności związanych z organizacją.

### Za pomocą Aplikacji Github

Aby uzyskać wprowadzenie do [**Aplikacji Github, sprawdź podstawowe informacje**](basic-github-information.md#github-applications).

Atakujący może stworzyć **złośliwą aplikację Github**, aby uzyskać dostęp do uprzywilejowanych danych/czynności użytkowników, którzy najprawdopodobniej akceptują je jako część kampanii phishingowej.

Ponadto, jak wyjaśniono w podstawowych informacjach, **organizacje mogą udzielać/odmawiać dostępu aplikacjom innych firm** do informacji/repozytoriów/czynności związanych z organizacją.

## Kompromitacja i Nadużycie Github Action

Istnieje kilka technik kompromitacji i nadużywania Github Action, sprawdź je tutaj:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Ominięcie Ochrony Gałęzi

* **Wymagaj określonej liczby zatwierdzeń**: Jeśli skompromitujesz kilka kont, możesz zaakceptować swoje PR z innych kont. Jeśli masz tylko dostęp do konta, z którego utworzyłeś PR, nie możesz zaakceptować swojego własnego PR. Jednak jeśli masz dostęp do środowiska **Github Action** wewnątrz repozytorium, używając **GITHUB\_TOKEN**, możesz być w stanie **zaakceptować swój PR** i uzyskać w ten sposób 1 zatwierdzenie.
* _Uwaga: zazwyczaj użytkownik nie będzie mógł zatwierdzić swoich własnych PR, ale jeśli możesz, możesz to nadużyć, aby zaakceptować swoje PR._
* **Odrzuć zatwierdzenia po wprowadzeniu nowych zmian**: Jeśli to nie jest ustawione, możesz przesłać prawidłowy kod, poczekać, aż ktoś go zatwierdzi, a następnie dodać złośliwy kod i scalić go z chronioną gałęzią.
* **Wymagaj zatwierdzeń od właścicieli kodu**: Jeśli jest to aktywowane i jesteś właścicielem kodu, możesz **za pomocą Github Action utworzyć swój PR, a następnie go zaakceptować**.
* Gdy plik **CODEOWNER jest źle skonfigurowany**, Github nie zgłasza błędu, ale go nie używa. Dlatego jeśli jest źle skonfigurowany, **ochrona właścicieli kodu nie jest stosowana**.
* **Zezwalaj określonym podmiotom na ominięcie wymagań dotyczących żądań ściągnięcia**: Jeśli jesteś jednym z tych podmiotów, możesz ominąć ochronę żądań ściągnięcia.
* **Uwzględnij administratorów**: Jeśli to nie jest ustawione, a jesteś administratorem repozytorium, możesz ominąć ochronę gałęzi.
* **Hijacking PR**: Możesz być w stanie **zmodyfikować PR innej osoby**, dodając złośliwy kod, zatwierdzając wynikowy PR samodzielnie i scalając wszystko.
* **Usuwanie ochrony gałęzi**: Jeśli jesteś **administratorem repozytorium, możesz wyłączyć ochronę**, scalić swój PR i ponownie włączyć ochronę.
* **Ominięcie ochrony push**: Jeśli repozytorium **pozwala tylko określonym użytkownikom** na wysyłanie push (scalanie kodu) do gałęzi (ochrona gałęzi może chronić wszystkie gałęzie, określając symbol wieloznaczny `*`).
* Jeśli masz **uprawnienia do zapisu w repozytorium, ale nie możesz wysyłać kodu** z powodu ochrony gałęzi, nadal możesz **utworzyć nową gałąź** i w niej utworzyć **github action, który jest uruchamiany po wysłaniu kodu**. Ponieważ **ochrona gałęzi nie chroni gałęzi do momentu jej utworzenia**, pierwsze wysłanie kodu do gałęzi **uruchomi github action**.

## Ominięcie Ochrony Środowisk

Aby uzyskać wprowadzenie do [**Środowisk Github, sprawdź podstawowe informacje**](basic-github-information.md#git-environments).

W przypadku, gdy środowisko może być **dostępne ze wszystkich gałęzi**, nie jest **chronione**, a łatwo można uzyskać dostęp do tajemnic wewnątrz środowiska. Należy jednak pamiętać, że można znaleźć repozytoria, w których **wszystkie gałęzie są chronione** (poprzez podanie ich nazw lub za pomocą `*`), w takim przypadku należy **znaleźć gałąź, do której można wysłać kod** i można **wyciekać** tajemnice, tworząc nową akcję github (lub modyfikując istniejącą).

Należy zauważyć, że można napotkać skrajny przypadek, w którym **wszystkie gałęzie są chronione** (za pomocą symbolu wieloznacznego `*`), określono **kto może wysyłać kod do gałęzi** (_można to określić w ochronie gałęzi_) i **twoje konto nie jest dozwolone**. Nadal można uruchomić niestandardową akcję github, ponieważ można utworzyć gałąź i użyć wyzwalacza push na tej samej gałęzi. **Ochrona gałęzi pozwala na wysłanie do nowej gałęzi, więc zostanie uruchomiona akcja github**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Zauważ, że **po utworzeniu** gałęzi **ochrona gałęzi zostanie zastosowana do nowej gałęzi** i nie będziesz w stanie jej modyfikować, ale w tym czasie już wykradłeś tajemnice.

## Wytrwałość

* Wygeneruj **token użytkownika**
* Ukradnij **tokeny Githuba** z **tajemnic**
* **Usunięcie** wyników **przepływu pracy** i **gałęzi**
* Przyznaj **więcej uprawnień wszystkim organizacjom**
* Utwórz **webhooki** do wycieku informacji
* Zaproszenie **zewnętrznych współpracowników**
* **Usuń** **webhooki** używane przez **SIEM**
* Utwórz/zmodyfikuj **Akcję Githuba** z **tylnymi drzwiami**
* Znajdź **podatną Akcję Githuba na wstrzyknięcie poleceń** poprzez modyfikację wartości **tajemnicy**

### Fałszywe Commity - Tylna furtka poprzez commity repozytorium

W Githubie możliwe jest **utworzenie PR do repozytorium z forka**. Nawet jeśli PR nie zostanie **zaakceptowany**, zostanie utworzone id **commita** w oryginalnym repozytorium dla wersji kodu z forka. Dlatego atakujący **mógłby przypiąć użycie określonego commita z pozornie legalnego repozytorium, które nie zostało utworzone przez właściciela repozytorium**.

Tak jak [**tutaj**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Aby uzyskać więcej informacji, sprawdź [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów github.

</details>
