# Github 보안

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고를 게재**하거나 **PDF로 HackTricks를 다운로드**하려면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 상품**](https://peass.creator-spring.com)을 구매하세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 탐색하세요. 독점적인 [**NFT**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter**에서 **팔로우**하세요. 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>

## Github이란

([여기](https://kinsta.com/knowledgebase/what-is-github/)에서) **Github은 개발자들이 코드를 저장하고 관리하며 코드의 변경 사항을 추적하고 제어하는 데 도움을 주는 웹 사이트 및 클라우드 기반 서비스입니다**.

### 기본 정보

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## 외부 탐색

Github 저장소는 공개, 비공개 및 내부로 구성할 수 있습니다.

* **비공개**는 **조직의 사람들만** 액세스할 수 있음을 의미합니다.
* **내부**는 **기업의 사람들만** 액세스할 수 있음을 의미합니다. (기업은 여러 조직을 가질 수 있음)
* **공개**는 **인터넷의 모든 사람**이 액세스할 수 있음을 의미합니다.

**대상으로 할 사용자, 저장소 또는 조직을 알고 있다면** 각 저장소에서 민감한 정보를 찾거나 **민감한 정보 누출**을 검색하기 위해 **github dorks**를 사용할 수 있습니다.

### Github Dorks

Github는 **사용자, 저장소 또는 조직을 범위로 지정하여 검색**할 수 있습니다. 따라서 민감한 정보와 관련된 문자열 목록을 사용하여 대상에서 잠재적인 민감한 정보를 쉽게 **검색**할 수 있습니다.

도구 (각 도구에는 dorks 목록이 포함되어 있음):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Dorks 목록](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Dorks 목록](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Dorks 목록](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Github 누출

Github dorks는 또한 github 검색 옵션을 사용하여 누출을 검색하는 데 사용됩니다. 이 섹션은 **각 저장소를 다운로드하고 그 안에서 민감한 정보를 검색**하는 도구에 대해 설명합니다(커밋의 특정 깊이도 확인).

도구 (각 도구에는 정규식 목록이 포함되어 있음):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
리포지토리에서 누출을 찾고 `git log -p`와 같은 명령을 실행할 때 다른 커밋을 포함한 **다른 브랜치**가 있을 수 있음을 잊지 마세요!
{% endhint %}

### 외부 포크

**풀 리퀘스트를 악용하여 리포지토리를 침해**할 수 있습니다. 리포지토리가 취약한지 여부를 알아보려면 주로 Github Actions yaml 구성을 읽어야 합니다. [**자세한 내용은 아래에서 확인하세요**](./#execution-from-a-external-fork).

## 조직 강화

### 멤버 권한

조직의 멤버에게 할당할 수 있는 **기본 권한**이 있습니다. 이는 `https://github.com/organizations/<org_name>/settings/member_privileges` 페이지 또는 [**Organizations API**](https://docs.github.com/en/rest/orgs/orgs)에서 제어할 수 있습니다.

* **기본 권한**: 멤버는 조직 리포지토리에 대해 None/Read/write/Admin 권한을 갖게 됩니다. 권장되는 것은 **None** 또는 **Read**입니다.
* **리포지토리 포킹**: 필요하지 않다면 멤버가 조직 리포지토리를 포크할 수 없도록 하는 것이 좋습니다.
* **페이지 생성**: 필요하지 않다면 멤버가 조직 리포지토리에서 페이지를 게시하지 못하도록 하는 것이 좋습니다. 필요한 경우 공개 또는 비공개 페이지를 생성할 수 있습니다.
* **통합 액세스 요청**: 이를 활성화하면 외부 공동 작업자가 GitHub 또는 OAuth 앱에 대한 액세스 요청을 이 조직과 해당 리소스에 대해 요청할 수 있습니다. 일반적으로 필요하지만 필요하지 않은 경우 비활성화하는 것이 좋습니다.
* _API 응답에서 이 정보를 찾을 수 없었습니다. 찾으시면 공유해주세요._
* **리포지토리 가시성 변경**: 활성화되면 **관리자** 권한을 가진 **멤버**는 **리포지토리의 가시성을 변경**할 수 있습니다. 비활성화되면 조직 소유자만 리포지토리 가시성을 변경할 수 있습니다. **
### 통합

_이 정보에 액세스하기 위한 API 엔드포인트를 알고 있다면 알려주세요!_

* **타사 애플리케이션 액세스 정책**: 모든 애플리케이션의 액세스를 제한하고 검토 후 필요한 애플리케이션만 허용하는 것이 권장됩니다.
* **설치된 GitHub 앱**: 검토 후 필요한 앱만 허용하는 것이 권장됩니다.

## 정찰 및 자격증명 남용 공격

이 시나리오에서는 GitHub 계정에 대한 액세스 권한을 얻었다고 가정합니다.

### 사용자 자격 증명으로

조직 내의 사용자에 대한 자격 증명을 이미 어떻게든 획득한 경우 **로그인**하여 **기업 및 조직 역할**을 확인할 수 있습니다. 원시 구성원인 경우 **원시 구성원이 가지는 권한**, 어떤 **그룹**에 속해 있는지, 어떤 **리포지토리에 대한 권한**을 가지고 있는지, 그리고 **리포지토리가 어떻게 보호되는지** 확인할 수 있습니다.

**2FA를 사용할 수도 있으므로** 해당 확인을 통과할 수 있는 경우에만 이 정보에 액세스할 수 있습니다.

{% hint style="info" %}
현재 SameSite: Lax로 구성된 `user_session` 쿠키를 **도난**하는 데 성공한다면 자격 증명이나 2FA 없이도 **사용자를 완전히 가장할 수 있습니다**.
{% endhint %}

유용하다면 [**브랜치 보호 우회**](./#branch-protection-bypass)에 대한 아래 섹션을 확인하세요.

### 사용자 SSH 키로

Github는 **사용자가 SSH 키를 설정**할 수 있도록 허용하며, 이 키는 **코드를 배포하는 인증 방법**으로 사용됩니다(2FA가 적용되지 않음).

이 키를 사용하여 사용자가 권한을 가진 리포지토리에서 **변경 작업을 수행**할 수 있지만, github api에 액세스하여 환경을 열거할 수는 없습니다. 그러나 **로컬 설정을 열거**하여 액세스할 수 있는 리포지토리와 사용자에 대한 정보를 얻을 수 있습니다:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
만약 사용자가 자신의 github 사용자 이름으로 사용자 이름을 구성한 경우, 그 사용자의 계정에 설정된 **공개 키에 접근**할 수 있습니다. 이를 확인하여 찾은 개인 키를 사용할 수 있는지 확인할 수 있습니다.

**SSH 키**는 또한 **배포 키**로서 저장소에 설정될 수 있습니다. 이 키에 액세스 권한이 있는 사람은 해당 키를 사용하여 **저장소에서 프로젝트를 시작**할 수 있습니다. 일반적으로 서버에 여러 배포 키가 있는 경우 로컬 파일 **`~/.ssh/config`**에서 해당 키와 관련된 정보를 얻을 수 있습니다.

#### GPG 키

[**여기**](broken-reference/)에서 설명한대로 때로는 커밋에 서명해야 할 수도 있으며, 그렇지 않으면 발견될 수 있습니다.

현재 사용자에게 어떤 키가 있는지 로컬로 확인하세요:
```shell
gpg --list-secret-keys --keyid-format=long
```
### 사용자 토큰을 사용하여

[**사용자 토큰에 대한 기본 정보를 확인하려면 여기를 클릭하세요**](basic-github-information.md#personal-access-tokens).

사용자 토큰은 Git over HTTPS의 **비밀번호 대신 사용**하거나 [**기본 인증을 통해 API에 인증**](https://docs.github.com/v3/auth/#basic-authentication)하는 데 사용할 수 있습니다. 해당 토큰에 부여된 권한에 따라 다양한 작업을 수행할 수 있습니다.

사용자 토큰은 다음과 같은 형식입니다: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Oauth 애플리케이션을 사용하여

[**Github Oauth 애플리케이션에 대한 기본 정보를 확인하려면 여기를 클릭하세요**](basic-github-information.md#oauth-applications).

공격자는 피싱 캠페인의 일부로 사용자가 그들을 수락하는 악성 Oauth 애플리케이션을 생성할 수 있습니다. 이를 통해 사용자의 권한이 있는 데이터/작업에 접근할 수 있습니다.

다음은 Oauth 애플리케이션이 요청할 수 있는 [범위(scope)입니다](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). 수락하기 전에 요청된 범위를 항상 확인해야 합니다.

또한, 기본 정보에서 설명한대로 **조직은 제3자 애플리케이션에 대한 정보/저장소/작업에 대한 액세스를 허용/거부**할 수 있습니다.

### Github 애플리케이션을 사용하여

[**Github 애플리케이션에 대한 기본 정보를 확인하려면 여기를 클릭하세요**](basic-github-information.md#github-applications).

공격자는 피싱 캠페인의 일부로 사용자가 그들을 수락하는 악성 Github 애플리케이션을 생성할 수 있습니다. 이를 통해 사용자의 권한이 있는 데이터/작업에 접근할 수 있습니다.

또한, 기본 정보에서 설명한대로 **조직은 제3자 애플리케이션에 대한 정보/저장소/작업에 대한 액세스를 허용/거부**할 수 있습니다.

## Github Action의 침해 및 남용

Github Action을 침해하고 남용하는 여러 기술이 있습니다. 여기에서 확인하세요:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## 브랜치 보호 우회

* **승인 요청 수 요구**: 여러 계정을 침해한 경우 다른 계정에서 PR을 수락할 수 있습니다. PR을 생성한 계정만 가지고 있는 경우 자체 PR을 수락할 수 없습니다. 그러나 레포지토리 내의 **Github Action** 환경에 액세스할 수 있는 경우 **GITHUB\_TOKEN**을 사용하여 PR을 **승인**하고 이 방법으로 1회 승인을 받을 수 있습니다.
* _이와 코드 소유자 제한에 대해 설명할 때 일반적으로 사용자는 자체 PR을 승인할 수 없지만, 그렇다면 승인을 받기 위해 남용할 수 있습니다._
* **새로운 커밋이 푸시될 때 승인 해제**: 이 설정이 되어 있지 않은 경우, 유효한 코드를 제출하고 승인을 기다린 다음 악성 코드를 넣고 보호된 브랜치로 병합할 수 있습니다.
* **Code Owners의 검토 요구**: 이 설정이 활성화되어 있고 코드 소유자인 경우, **Github Action을 사용하여 자체 PR을 생성하고 승인**할 수 있습니다.
* **CODEOWNER 파일이 잘못 구성된 경우** Github은 경고하지 않지만 사용하지 않습니다. 따라서 잘못 구성된 경우 **Code Owners 보호가 적용되지 않습니다.**
* **지정된 사용자가 pull request 요구 사항을 우회할 수 있도록 허용**: 이러한 사용자 중 하나인 경우 pull request 보호를 우회할 수 있습니다.
* **관리자 포함**: 이 설정이 되어 있지 않고 레포지토리의 관리자인 경우, 이 브랜치 보호를 우회할 수 있습니다.
* **PR 탈취**: 다른 사람의 PR을 수정하여 악성 코드를 추가하고 생성된 PR을 스스로 승인하고 모든 것을 병합할 수 있습니다.
* **브랜치 보호 제거**: 레포지토리의 **관리자인 경우 보호를 비활성화**하고 PR을 병합한 다음 보호를 다시 설정할 수 있습니다.
* **push 보호 우회**: 레포지토리에서 푸시(코드 병합)를 보낼 수 있는 특정 사용자만 허용하는 경우 (브랜치 보호가 와일드카드 `*`를 사용하여 모든 브랜치를 보호할 수 있음).
* 레포지토리에 **쓰기 액세스 권한이 있지만 브랜치 보호로 인해 코드를 푸시할 수 없는 경우**, 여전히 **새로운 브랜치를 생성**하고 그 안에 **코드가 푸시될 때 트리거되는 github action을 생성**할 수 있습니다. **브랜치가 생성될 때까지 브랜치 보호가 적용되지 않으므로** 브랜치로의 첫 번째 코드 푸시는 **github action을 실행**할 것입니다.

## 환경 보호 우회

[**Github 환경에 대한 기본 정보를 확인하려면 여기를 클릭하세요**](basic-github-information.md#git-environments).

환경이 **모든 브랜치에서 액세스 가능**한 경우, 해당 환경은 **보호되지 않으며** 환경 내의 비밀 정보에 쉽게 액세스할 수 있습니다. 모든 브랜치가 보호되는 경우 (이름을 지정하거나 `*`를 사용하여) 해당 시나리오에서 코드를 푸시할 수 있는 브랜치를 찾아서 새로운 github action을 생성하거나 수정하여 비밀 정보를 유출할 수 있습니다.

참고로, 모든 브랜치가 보호되는 특수한 경우를 찾을 수 있습니다. (와일드카드 `*`를 사용하여) **브랜치에 코드를 푸시할 수 있는 사용자**를 지정하는 경우 (_브랜치 보호에서 지정할 수 있음_) **사용자가 허용되지 않는 경우**에도 사용자 정의 github action을 실행할 수 있습니다. 브랜치 보호는 새로운 브랜치로의 푸시를 허용하므로 github action이 트리거될 것입니다.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
## 지속성

* **사용자 토큰** 생성
* **비밀**에서 **Github 토큰** 도용
* 워크플로우 **결과** 및 **브랜치** 삭제
* 모든 조직에게 **더 많은 권한 부여**
* 정보 유출을 위해 **웹훅** 생성
* 외부 협력자 초대
* **SIEM**에서 사용하는 **웹훅** 제거
* **백도어**가 있는 **Github Action** 생성/수정
* **비밀** 값 수정을 통한 취약한 **Github Action에서 명령 주입** 찾기

### 위장 커밋 - 저장소 커밋을 통한 백도어

Github에서는 **포크된 저장소로부터 저장소에 PR을 생성**할 수 있습니다. PR이 **수락되지 않더라도**, 원본 저장소의 커밋 ID가 코드의 포크 버전을 위해 생성됩니다. 따라서, 공격자는 **저장소 소유자가 생성하지 않은 것처럼 보이는 특정 커밋을 사용**할 수 있습니다.

예를 들면 [**이렇게**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
자세한 내용은 [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)를 확인하세요.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>
