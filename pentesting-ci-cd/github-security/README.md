# Sicurezza di Github

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>

## Cos'√® Github

(Da [qui](https://kinsta.com/knowledgebase/what-is-github/)) A un livello elevato, **GitHub √® un sito web e un servizio basato su cloud che aiuta gli sviluppatori a memorizzare e gestire il loro codice, nonch√© a tracciare e controllare le modifiche al loro codice**.

### Informazioni di base

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Ricognizione Esterna

I repository di Github possono essere configurati come pubblici, privati e interni.

* **Privato** significa che **solo** le persone dell'**organizzazione** potranno accedervi
* **Interno** significa che **solo** le persone dell'**azienda** (un'azienda pu√≤ avere diverse organizzazioni) potranno accedervi
* **Pubblico** significa che **tutto Internet** potr√† accedervi.

Nel caso in cui conosci l'**utente, il repository o l'organizzazione che vuoi mirare** puoi utilizzare **dork di github** per trovare informazioni sensibili o cercare **perdite di informazioni sensibili** **su ciascun repository**.

### Dork di Github

Github consente di **cercare qualcosa specificando come ambito un utente, un repository o un'organizzazione**. Pertanto, con un elenco di stringhe che appariranno vicino a informazioni sensibili, puoi facilmente **cercare potenziali informazioni sensibili nel tuo obiettivo**.

Strumenti (ogni strumento contiene il suo elenco di dork):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Elenco di Dorks](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Elenco di Dorks](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Elenco di Dorks](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Perdite di Github

Si prega di notare che i dork di github sono anche destinati a cercare perdite utilizzando le opzioni di ricerca di github. Questa sezione √® dedicata agli strumenti che **scaricheranno ciascun repository e cercheranno informazioni sensibili al loro interno** (controllando anche una certa profondit√† dei commit).

Strumenti (ogni strumento contiene il suo elenco di regex):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Quando cerchi perdite in un repository e esegui qualcosa come `git log -p` non dimenticare che potrebbero esserci **altri branch con altri commit** contenenti segreti!
{% endhint %}

### Fork Esterni

√à possibile **compromettere i repository abusando delle pull requests**. Per sapere se un repository √® vulnerabile, √® necessario principalmente leggere le configurazioni yaml delle azioni di Github. [**Maggiori informazioni su questo sotto**](./#execution-from-a-external-fork).

## Rafforzamento dell'Organizzazione

### Privilegi dei Membri

Ci sono alcuni **privilegi predefiniti** che possono essere assegnati ai **membri** dell'organizzazione. Questi possono essere controllati dalla pagina `https://github.com/organizations/<org_name>/settings/member_privileges` o dall'[**API delle Organizzazioni**](https://docs.github.com/en/rest/orgs/orgs).

* **Permessi di base**: I membri avranno il permesso Nessuno/Lettura/Scrittura/Amministratore sui repository dell'organizzazione. √à consigliato **Nessuno** o **Lettura**.
* **Fork del repository**: Se non √® necessario, √® meglio **non consentire** ai membri di fare il fork dei repository dell'organizzazione.
* **Creazione di pagine**: Se non √® necessario, √® meglio **non consentire** ai membri di pubblicare pagine dai repository dell'organizzazione. Se necessario, √® possibile consentire di creare pagine pubbliche o private.
* **Richieste di accesso all'integrazione**: Con questa opzione abilitata, i collaboratori esterni potranno richiedere l'accesso per le app GitHub o OAuth per accedere a questa organizzazione e alle sue risorse. Di solito √® necessario, ma se non lo √®, √® meglio disabilitarlo.
* _Non ho trovato queste informazioni nella risposta delle API, condividi se lo fai_
* **Cambio di visibilit√† del repository**: Se abilitato, i **membri** con permessi **amministrativi** per il **repository** potranno **cambiare la sua visibilit√†**. Se disabilitato, solo i proprietari dell'organizzazione possono cambiare la visibilit√† del repository. Se **non** vuoi che le persone rendano le cose **pubbliche**, assicurati che ci√≤ sia **disabilitato**.
* _Non ho trovato queste informazioni nella risposta delle API, condividi se lo fai_
* **Cancellazione e trasferimento del repository**: Se abilitato, i membri con permessi **amministrativi** per il repository potranno **cancellare** o **trasferire** repository **pubblici** e **privati**.
* _Non ho trovato queste informazioni nella risposta delle API, condividi se lo fai_
* **Consenti ai membri di creare team**: Se abilitato, qualsiasi **membro** dell'organizzazione potr√† **creare** nuovi **team**. Se disabilitato, solo i proprietari dell'organizzazione possono creare nuovi team. √à meglio avere questo disabilitato.
* _Non ho trovato queste informazioni nella risposta delle API, condividi se lo fai_
* **Altre cose possono essere configurate** in questa pagina ma le precedenti sono quelle pi√π legate alla sicurezza.

### Impostazioni delle Azioni

Diverse impostazioni relative alla sicurezza possono essere configurate per le azioni dalla pagina `https://github.com/organizations/<org_name>/settings/actions`.

{% hint style="info" %}
Nota che tutte queste configurazioni possono essere impostate anche su ciascun repository in modo indipendente
{% endhint %}

* **Politiche delle azioni di Github**: Ti consente di indicare quali repository possono eseguire i flussi di lavoro e quali flussi di lavoro dovrebbero essere consentiti. √à consigliabile **specificare quali repository** dovrebbero essere consentiti e non consentire a tutte le azioni di eseguire.
* [**API-1**](https://docs.github.com/en/rest/actions/permissions#get-allowed-actions-and-reusable-workflows-for-an-organization)**,** [**API-2**](https://docs.github.com/en/rest/actions/permissions#list-selected-repositories-enabled-for-github-actions-in-an-organization)
* **Flussi di lavoro delle pull request dei fork dai collaboratori esterni**: √à consigliabile **richiedere l'approvazione per tutti** i collaboratori esterni.
* _Non ho trovato un'API con queste informazioni, condividi se lo fai_
* **Esegui flussi di lavoro dalle pull request dei fork**: √à **sconsigliato eseguire flussi di lavoro dalle pull request** poich√© i manutentori dell'origine del fork avranno la possibilit√† di utilizzare token con permessi di lettura sul repository di origine.
* _Non ho trovato un'API con queste informazioni, condividi se lo fai_
* **Permessi del flusso di lavoro**: √à altamente consigliabile **concedere solo permessi di lettura al repository**. √à sconsigliato concedere permessi di scrittura e creazione/approvazione di pull request per evitare abusi del GITHUB\_TOKEN fornito per l'esecuzione dei flussi di lavoro.
* [**API**](https://docs.github.com/en/rest/actions/permissions#get-default-workflow-permissions-for-an-organization)
### Integrazioni

_Fammi sapere se conosci il punto finale dell'API per accedere a queste informazioni!_

* **Politica di accesso alle applicazioni di terze parti**: Si consiglia di limitare l'accesso a ogni applicazione e consentire solo quelle necessarie (dopo averle esaminate).
* **App GitHub installate**: Si consiglia di consentire solo quelle necessarie (dopo averle esaminate).

## Ricognizione e attacchi che abusano delle credenziali

Per questo scenario supponiamo che tu abbia ottenuto un certo accesso a un account GitHub.

### Con le credenziali dell'utente

Se in qualche modo hai gi√† le credenziali di un utente all'interno di un'organizzazione, puoi **semplicemente effettuare l'accesso** e controllare quali **ruoli aziendali e organizzativi hai**, se sei un membro grezzo, controllare quali **autorizzazioni hanno i membri grezzi**, in quali **gruppi** sei, quali **autorizzazioni hai** su quali **repository** e **come sono protetti i repository**.

Tieni presente che potrebbe essere utilizzato **2FA**, quindi potrai accedere a queste informazioni solo se riesci anche a **superare tale controllo**.

{% hint style="info" %}
Nota che se **riesci a rubare il cookie `user_session`** (attualmente configurato con SameSite: Lax) puoi **impersonare completamente l'utente** senza necessit√† di credenziali o 2FA.
{% endhint %}

Controlla la sezione qui sotto riguardante i [**bypass delle protezioni del branch**](./#branch-protection-bypass) nel caso possa esserti utile.

### Con la chiave SSH dell'utente

Github consente agli **utenti** di impostare **chiavi SSH** che verranno utilizzate come **metodo di autenticazione per distribuire codice** per loro conto (nessun 2FA viene applicato).

Con questa chiave puoi effettuare **modifiche nei repository in cui l'utente ha alcuni privilegi**, tuttavia non puoi usarla per accedere all'API di GitHub per enumerare l'ambiente. Tuttavia, puoi **enumerare le impostazioni locali** per ottenere informazioni sui repository e sull'utente a cui hai accesso:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Se l'utente ha configurato il suo nome utente come il suo nome utente di GitHub, √® possibile accedere alle **chiavi pubbliche che ha impostato** nel suo account su _https://github.com/\<github\_username>.keys_, potresti controllare questo per confermare che la chiave privata che hai trovato possa essere utilizzata.

Le **chiavi SSH** possono anche essere impostate nei repository come **chiavi di deploy**. Chiunque abbia accesso a questa chiave potr√† **avviare progetti da un repository**. Di solito in un server con diverse chiavi di deploy, il file locale **`~/.ssh/config`** ti dar√† informazioni su quale chiave √® correlata.

#### Chiavi GPG

Come spiegato [**qui**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/github-security/broken-reference/README.md) a volte √® necessario firmare i commit o potresti essere scoperto.

Controlla localmente se l'utente attuale ha qualche chiave con:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Con Token Utente

Per una introduzione sui [**Token Utente controlla le informazioni di base**](basic-github-information.md#personal-access-tokens).

Un token utente pu√≤ essere utilizzato **al posto di una password** per Git su HTTPS, o pu√≤ essere utilizzato per [**autenticarsi all'API tramite Autenticazione di Base**](https://docs.github.com/v3/auth/#basic-authentication). A seconda dei privilegi ad esso associati, potresti essere in grado di eseguire azioni diverse.

Un token utente ha questo aspetto: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Con Applicazione Oauth

Per una introduzione sulle [**Applicazioni Oauth di Github controlla le informazioni di base**](basic-github-information.md#oauth-applications).

Un attaccante potrebbe creare una **Applicazione Oauth malevola** per accedere a dati/azioni privilegiate degli utenti che li accettano probabilmente come parte di una campagna di phishing.

Questi sono gli [ambiti che un'applicazione Oauth pu√≤ richiedere](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Si dovrebbe sempre controllare gli ambiti richiesti prima di accettarli.

Inoltre, come spiegato nelle informazioni di base, le **organizzazioni possono concedere/negare l'accesso alle applicazioni di terze parti** alle informazioni/repos/azioni relative all'organizzazione.

### Con Applicazione Github

Per una introduzione sulle [**Applicazioni di Github controlla le informazioni di base**](basic-github-information.md#github-applications).

Un attaccante potrebbe creare una **Applicazione Github malevola** per accedere a dati/azioni privilegiate degli utenti che li accettano probabilmente come parte di una campagna di phishing.

Inoltre, come spiegato nelle informazioni di base, le **organizzazioni possono concedere/negare l'accesso alle applicazioni di terze parti** alle informazioni/repos/azioni relative all'organizzazione.

## Compromissione e Abuso di Github Action

Ci sono diverse tecniche per compromettere e abusare di una Github Action, controllale qui:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Bypass delle Protezioni del Branch

* **Richiedere un numero di approvazioni**: Se hai compromesso diversi account potresti semplicemente accettare i tuoi PR da altri account. Se hai solo l'account da cui hai creato il PR, non puoi accettare il tuo stesso PR. Tuttavia, se hai accesso a un ambiente **Github Action** all'interno del repository, utilizzando il **GITHUB\_TOKEN** potresti essere in grado di **approvare il tuo PR** e ottenere 1 approvazione in questo modo.
* _Nota per questo e per la restrizione dei proprietari del codice che di solito un utente non potr√† approvare i propri PR, ma se sei in grado di farlo, puoi abusarne per accettare i tuoi PR._
* **Ignora le approvazioni quando vengono effettuati nuovi commit**: Se questo non √® impostato, puoi inviare codice legittimo, aspettare che qualcuno lo approvi, inserire codice dannoso e unirlo al branch protetto.
* **Richiedere recensioni dai proprietari del codice**: Se questo √® attivato e sei un proprietario del codice, potresti fare in modo che una **Github Action crei il tuo PR e poi lo approvi tu stesso**.
* Quando un **file CODEOWNER √® configurato in modo errato** Github non si lamenta ma non lo utilizza. Pertanto, se √® configurato in modo errato, la sua **protezione dei proprietari del codice non viene applicata**.
* **Consenti ad attori specifici di ignorare i requisiti del pull request**: Se sei uno di questi attori, puoi ignorare le protezioni del pull request.
* **Includi amministratori**: Se questo non √® impostato e sei un amministratore del repository, puoi ignorare queste protezioni del branch.
* **Dirottamento del PR**: Potresti essere in grado di **modificare il PR di qualcun altro** aggiungendo codice dannoso, approvando il PR risultante tu stesso e unendo tutto.
* **Rimozione delle Protezioni del Branch**: Se sei un **amministratore del repository puoi disabilitare le protezioni**, unire il tuo PR e reimpostare le protezioni.
* **Bypass delle protezioni di push**: Se un repository **consente solo a determinati utenti** di inviare push (unire codice) nei branch (la protezione del branch potrebbe proteggere tutti i branch specificando il jolly `*`).
* Se hai **accesso in scrittura al repository ma non ti √® consentito inviare codice** a causa della protezione del branch, puoi comunque **creare un nuovo branch** e al suo interno creare una **github action che viene attivata quando viene inviato del codice**. Poich√© la **protezione del branch non protegger√† il branch fino a quando non viene creato**, questo primo push di codice al branch **eseguir√† la github action**.

## Bypass delle Protezioni degli Ambienti

Per una introduzione sugli [**Ambienti di Github controlla le informazioni di base**](basic-github-information.md#git-environments).

Nel caso in cui un ambiente possa essere **acceduto da tutti i branch**, non √® **protetto** e puoi facilmente accedere ai segreti all'interno dell'ambiente. Nota che potresti trovare repository in cui **tutti i branch sono protetti** (specificando i loro nomi o utilizzando `*`), in quel caso, **trova un branch in cui puoi inviare codice** e puoi **esfiltrare** i segreti creando una nuova github action (o modificandone una).

Nota, che potresti trovare il caso limite in cui **tutti i branch sono protetti** (tramite jolly `*`) √® specificato **chi pu√≤ inviare codice ai branch** (_puoi specificarlo nella protezione del branch_) e **il tuo utente non √® autorizzato**. Puoi comunque eseguire una github action personalizzata perch√© puoi creare un branch e utilizzare il trigger di push su se stesso. La **protezione del branch consente il push a un nuovo branch quindi la github action verr√† attivata**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Nota che **dopo la creazione** del branch, la **protezione del branch si applicher√† al nuovo branch** e non sar√† possibile modificarlo, ma nel frattempo avrai gi√† estratto le informazioni segrete.

## Persistenza

* Generare un **token utente**
* Rubare i **token di Github** dalle **secrets**
* **Cancellazione** dei risultati del workflow e dei branch
* Concedere **pi√π permessi a tutta l'organizzazione**
* Creare **webhook** per esfiltrare informazioni
* Invitare **collaboratori esterni**
* **Rimuovere i webhook** utilizzati dal **SIEM**
* Creare/modificare **Github Action** con un **backdoor**
* Trovare **Github Action vulnerabile per l'iniezione di comandi** tramite modifica del valore **segreto**

### Commit dell'impostore - Backdoor tramite commit del repository

In Github √® possibile **creare una PR a un repository da un fork**. Anche se la PR non viene **accettata**, verr√† creato un **ID commit** all'interno del repository originale per la versione fork del codice. Pertanto, un attaccante **potrebbe fissare l'uso di un commit specifico da un repository apparentemente legittimo che non √® stato creato dal proprietario del repository**.

Come [**questo**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Per ulteriori informazioni consulta [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se desideri vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**Gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
