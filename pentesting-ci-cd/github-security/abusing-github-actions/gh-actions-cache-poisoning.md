# GH Actions - Poisoning du cache

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** r√©f√©rentiels GitHub [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Poisoning du cache

L'utilisation de l'action [**cache**](https://github.com/actions/cache) de Git n'importe o√π dans le CI ex√©cutera deux √©tapes : une √©tape se d√©roulera pendant le processus **run** lorsqu'elle est appel√©e et l'autre se d√©roulera apr√®s le **workflow** (si l'action run a renvoy√© un cache-miss).

* **Action run** - est utilis√©e pour rechercher et r√©cup√©rer le cache. La recherche est effectu√©e √† l'aide de la cl√© de cache, le r√©sultat √©tant soit un cache-hit (succ√®s, donn√©es trouv√©es dans le cache) ou un cache-miss. Si trouv√©, les fichiers et r√©pertoires sont r√©cup√©r√©s √† partir du cache pour une utilisation active. Si le r√©sultat est un cache-miss, les fichiers et r√©pertoires souhait√©s sont t√©l√©charg√©s comme s'il s'agissait de la premi√®re fois qu'ils sont appel√©s.
* **Action post workflow** - utilis√©e pour enregistrer le cache. Si le r√©sultat de l'appel au cache dans l'action run renvoie un cache-miss, cette action enregistrera l'√©tat actuel des r√©pertoires que nous voulons mettre en cache avec la cl√© fournie. Cette action se produit automatiquement et n'a pas besoin d'√™tre appel√©e explicitement.

Les **restrictions d'acc√®s** fournissent une **isolation du cache** et une s√©curit√© en cr√©ant une **fronti√®re logique entre les diff√©rentes branches** _(par exemple : un cache cr√©√© pour la branche **Feature-A** \[avec la base main] ne serait pas accessible √† une demande de tirage pour la branche **Feature-B** \[avec la base main])_.

L'action de cache recherche d'abord les hits de cache pour une cl√© et restaure les cl√©s dans la branche contenant l'ex√©cution du **workflow**. S'il n'y a pas de hits dans la branche actuelle, l'action de cache recherche la cl√© et restaure les cl√©s dans la branche parente et les branches en amont.

L'acc√®s √† un cache est limit√© par branche (actuelle et parente), ce qui signifie que l'acc√®s est fourni √† tous les **workflows** √† travers les **runs** de ladite branche.

Une autre note importante est que GitHub n'autorise pas les modifications une fois que les entr√©es sont pouss√©es - les entr√©es de cache sont des enregistrements en lecture seule.

Nous avons utilis√© un exemple de CI qui comprenait deux workflows. Cet exemple montre comment une attaque peut pivoter d'un workflow √† faible autorisation √† un workflow √† autorisation √©lev√©e.

* Le workflow **Unit-test** ex√©cute des tests unitaires et des outils de couverture de code. Nous supposons que l'un des outils est malveillant ou vuln√©rable √† l'ex√©cution de code √† distance. Le workflow n'a pas besoin d'utiliser l'action **cache** de Git. Tout workflow peut acc√©der au cache.
* Le workflow **Release** construit et publie l'artefact de l'application. Ce workflow utilise un cache pour optimiser l'utilisation des d√©pendances Golang.

Le workflow **unit-test** utilise une action malveillante qui ajoute une entr√©e de cache avec un contenu malveillant en modifiant une biblioth√®que de journalisation Golang (**go.uber.org/zap@v1**) pour ajouter la cha√Æne "BAD library" √† la description de l'artefact de l'application.

Ensuite, le workflow **release** utilise cette entr√©e de cache empoisonn√©e. En cons√©quence, le code malveillant est inject√© dans le binaire et l'image Golang construits. Le cache reste empoisonn√© jusqu'√† ce que la cl√© d'entr√©e soit supprim√©e (g√©n√©ralement d√©clench√©e par des mises √† jour de d√©pendances). Le m√™me cache empoisonn√© affectera tout autre **workflow**, **run** et **branche enfant** utilisant la m√™me cl√© de cache.

Dans le test que nous avons effectu√©, nous avons r√©ussi √† injecter la cha√Æne "BAD library" dans la description de l'image :

![BAD library](https://scribesecurity.com/wp-content/uploads/2022/02/BAD-library-2-300x79.jpg)

C'√©tait dans la version 0.4.1. Ensuite, nous avons mis √† jour le tag et reconstruit l'image plusieurs fois, et nous avons observ√© que "Bad library" restait dans la description.

Cette technique a √©t√© tir√©e de [https://scribesecurity.com/blog/github-cache-poisoning/](https://scribesecurity.com/blog/github-cache-poisoning/)

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** r√©f√©rentiels GitHub [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
