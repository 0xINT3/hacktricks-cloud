# Gh Actions - スクリプトインジェクション

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をご覧ください！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)や[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>

## 基本情報

PRを作成する**ユーザー**によって**制御**される値を持つ特定の[**githubコンテキスト**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context)があることに注意してください。githubアクションがその**データを実行に使用している場合**、**任意のコード実行**につながる可能性があります。これらのコンテキストは通常、`body`、`default_branch`、`email`、`head_ref`、`label`、`message`、`name`、`page_name`、`ref`、`title`で終わります。例えば（この[**ライトアップ**](https://medium.com/tinder/exploiting-github-actions-on-open-source-projects-5d93936d189f)からのリスト）:

* github.event.comment.body
* github.event.issue.body
* github.event.issue.title
* github.head\_ref
* github.pull\_request.\*
* github.\*.\*.authors.name
* github.\*.\*.authors.email

ここでは、ブランチ名やメールアドレスなど、**あまり明白でない潜在的に信頼できない入力のソース**もあることに注意してください。これらは**許可される内容の面でかなり柔軟**です。例えば、`zzz";echo${IFS}"hello";#`は有効なブランチ名であり、ターゲットリポジトリに対する攻撃ベクトルになり得ます。

### スクリプトインジェクション攻撃の例 <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

スクリプトインジェクション攻撃は、ワークフローのインラインスクリプト内で直接発生することがあります。次の例では、アクションが**プルリクエストのタイトルの妥当性をテストするための式**を使用していますが、スクリプトインジェクションのリスクも追加しています：
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
シェルスクリプトが実行される前に、`${{ }}` 内の式が**評価**され、その結果の値に置き換えられます。これにより、**シェルコマンドインジェクションの脆弱性**を引き起こす可能性があります。

攻撃者がこのワークフローにコマンドを注入するには、タイトルが **`a"; ls $GITHUB_WORKSPACE"`** のプルリクエストを作成することができます。

この例では、**`"`** 文字を使用して `title=`**`"${{ github.event.pull_request.title }}"`** ステートメントを中断し、ランナー上で `ls` コマンドを実行することを可能にします。

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をチェックしてください！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手してください。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションをチェックしてください。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加するか**、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローしてください。**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) および [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubリポジトリにPRを提出して、あなたのハッキングのコツを**共有してください。**

</details>
