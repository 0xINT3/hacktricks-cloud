# Gh Actions - 脚本注入

<details>

<summary><strong>从零到英雄学习AWS黑客攻击</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在 **HackTricks中看到您的公司广告** 或 **下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 基本信息

请注意，有一些[**github上下文**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context)的值是由创建PR的**用户** **控制**的。如果github action使用该**数据执行任何操作**，它可能导致**任意代码执行**。这些上下文通常以`body`、`default_branch`、`email`、`head_ref`、`label`、`message`、`name`、`page_name`、`ref`和`title`结尾。例如（列表来自这个[**写作**](https://medium.com/tinder/exploiting-github-actions-on-open-source-projects-5d93936d189f)）：

* github.event.comment.body
* github.event.issue.body
* github.event.issue.title
* github.head\_ref
* github.pull\_request.\*
* github.\*.\*.authors.name
* github.\*.\*.authors.email

请注意，这里还有一些**不太明显的潜在不受信任输入源**，例如分支名称和电子邮件地址，这些可以在允许的内容方面**相当灵活**。例如，`zzz";echo${IFS}"hello";#` 将是一个有效的分支名称，并且可能成为针对目标仓库的潜在攻击向量。

### 脚本注入攻击示例 <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

脚本注入攻击可以直接在工作流的内联脚本中发生。在以下示例中，一个动作使用**表达式来测试拉取请求标题的有效性**，但也增加了脚本注入的风险：
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
在运行 shell 脚本之前，`${{ }}` 内的表达式会被**评估**并替换为结果值，这可能导致**容易受到 shell 命令注入攻击**。

为了向这个工作流注入命令，攻击者可以创建一个标题为 **`a"; ls $GITHUB_WORKSPACE"`** 的拉取请求。

在这个例子中，**`"`** 字符用于中断 `title=`**`"${{ github.event.pull_request.title }}"`** 语句，允许在运行器上执行 `ls` 命令。

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果你想在 HackTricks 上看到你的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFT 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享你的黑客技巧**。

</details>
