# Gh Actions - 脚本注入

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>

## 基本信息

请注意，有一些[**github 上下文**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context)的值是由创建 PR 的**用户控制**的。如果 github action 使用该数据来执行任何操作，可能会导致**任意代码执行**。这些上下文通常以 `body`、`default_branch`、`email`、`head_ref`、`label`、`message`、`name`、`page_name`、`ref` 和 `title` 结尾。例如（来自此[**文章**](https://medium.com/tinder/exploiting-github-actions-on-open-source-projects-5d93936d189f)的列表）：

* github.event.comment.body
* github.event.issue.body
* github.event.issue.title
* github.head\_ref
* github.pull\_request.\*
* github.\*.\*.authors.name
* github.\*.\*.authors.email

请注意，还有一些**不太明显的来源**可能是不可信任的输入，例如分支名称和电子邮件地址，它们在允许的内容方面可能非常灵活。例如，`zzz";echo${IFS}"hello";#` 将是一个有效的分支名称，并且可能成为目标仓库的潜在攻击向量。

### 脚本注入攻击示例 <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

脚本注入攻击可以直接发生在工作流的内联脚本中。在下面的示例中，一个操作使用一个**表达式来测试拉取请求标题的有效性**，但也增加了脚本注入的风险：
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
在运行shell脚本之前，`${{ }}`中的表达式会被**评估**，然后用结果值进行替换，这可能导致**容易受到Shell命令注入的攻击**。

为了在这个工作流中注入命令，攻击者可以创建一个标题为**`a"; ls $GITHUB_WORKSPACE"`**的拉取请求。

在这个示例中，**`"`**字符被用来中断`title=`**`"${{ github.event.pull_request.title }}"`**语句，从而允许在运行器上执行`ls`命令。

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的**公司广告**，或者如果您想访问**PEASS的最新版本或下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass)，或者在**Twitter**上关注我 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来**分享您的黑客技巧**。

</details>
