# Configura√ß√£o do Airflow

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

## Arquivo de Configura√ß√£o

**Apache Airflow** gera um **arquivo de configura√ß√£o** em todas as m√°quinas airflow chamado **`airflow.cfg`** no diret√≥rio home do usu√°rio airflow. Este arquivo de configura√ß√£o cont√©m informa√ß√µes de configura√ß√£o e **pode conter informa√ß√µes interessantes e sens√≠veis.**

**Existem duas maneiras de acessar este arquivo: Comprometendo alguma m√°quina airflow ou acessando o console web.**

Note que os **valores dentro do arquivo de configura√ß√£o** **podem n√£o ser os utilizados**, pois voc√™ pode sobrescrev√™-los definindo vari√°veis de ambiente como `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`.

Se voc√™ tem acesso ao **arquivo de configura√ß√£o no servidor web**, voc√™ pode verificar a **configura√ß√£o real em execu√ß√£o** na mesma p√°gina em que a configura√ß√£o √© exibida.\
Se voc√™ tem **acesso a alguma m√°quina dentro do ambiente airflow**, verifique o **ambiente**.

Alguns valores interessantes para verificar ao ler o arquivo de configura√ß√£o:

### \[api]

* **`access_control_allow_headers`**: Indica os **headers permitidos** para **CORS**
* **`access_control_allow_methods`**: Indica os **m√©todos permitidos** para **CORS**
* **`access_control_allow_origins`**: Indica as **origens permitidas** para **CORS**
* **`auth_backend`**: [**De acordo com a documenta√ß√£o**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html) algumas op√ß√µes podem ser configuradas para acessar a API:
* `airflow.api.auth.backend.deny_all`: **Por padr√£o ningu√©m** pode acessar a API
* `airflow.api.auth.backend.default`: **Todos podem** acess√°-la sem autentica√ß√£o
* `airflow.api.auth.backend.kerberos_auth`: Para configurar **autentica√ß√£o kerberos**
* `airflow.api.auth.backend.basic_auth`: Para **autentica√ß√£o b√°sica**
* `airflow.composer.api.backend.composer_auth`: Usa autentica√ß√£o do composer (GCP) (de [**aqui**](https://cloud.google.com/composer/docs/access-airflow-api)).
* `composer_auth_user_registration_role`: Indica o **papel** que o **usu√°rio composer** ter√° dentro do **airflow** (**Op** por padr√£o).
* Voc√™ tamb√©m pode **criar seu pr√≥prio m√©todo de autentica√ß√£o** com python.
* **`google_key_path`:** Caminho para a **chave da conta de servi√ßo GCP**

### **\[atlas]**

* **`password`**: Senha do Atlas
* **`username`**: Usu√°rio do Atlas

### \[celery]

* **`flower_basic_auth`** : Credenciais (_user1:password1,user2:password2_)
* **`result_backend`**: URL do Postgres que pode conter **credenciais**.
* **`ssl_cacert`**: Caminho para o cacert
* **`ssl_cert`**: Caminho para o certificado
* **`ssl_key`**: Caminho para a chave

### \[core]

* **`dag_discovery_safe_mode`**: Ativado por padr√£o. Ao descobrir DAGs, ignora quaisquer arquivos que n√£o contenham as strings `DAG` e `airflow`.
* **`fernet_key`**: Chave para armazenar vari√°veis criptografadas (sim√©trica)
* **`hide_sensitive_var_conn_fields`**: Ativado por padr√£o, oculta informa√ß√µes sens√≠veis das conex√µes.
* **`security`**: Qual m√≥dulo de seguran√ßa usar (por exemplo, kerberos)

### \[dask]

* **`tls_ca`**: Caminho para o ca
* **`tls_cert`**: Caminho para o certificado
* **`tls_key`**: Caminho para a chave tls

### \[kerberos]

* **`ccache`**: Caminho para o arquivo ccache
* **`forwardable`**: Ativado por padr√£o

### \[logging]

* **`google_key_path`**: Caminho para as credenciais JSON do GCP.

### \[secrets]

* **`backend`**: Nome completo da classe do backend de segredos para ativar
* **`backend_kwargs`**: O par√¢metro backend_kwargs √© carregado em um dicion√°rio e passado para **init** da classe do backend de segredos.

### \[smtp]

* **`smtp_password`**: Senha SMTP
* **`smtp_user`**: Usu√°rio SMTP

### \[webserver]

* **`cookie_samesite`**: Por padr√£o √© **Lax**, ent√£o j√° √© o valor mais fraco poss√≠vel
* **`cookie_secure`**: Define a **flag segura** no cookie da sess√£o
* **`expose_config`**: Por padr√£o √© Falso, se verdadeiro, a **configura√ß√£o** pode ser **lida** do console **web**
* **`expose_stacktrace`**: Por padr√£o √© Verdadeiro, mostrar√° **rastreamentos de pilha python** (potencialmente √∫til para um atacante)
* **`secret_key`**: Esta √© a **chave usada pelo flask para assinar os cookies** (se voc√™ tiver isso, pode **se passar por qualquer usu√°rio no Airflow**)
* **`web_server_ssl_cert`**: **Caminho** para o **certificado SSL**
* **`web_server_ssl_key`**: **Caminho** para a **Chave SSL**
* **`x_frame_enabled`**: O padr√£o √© **Verdadeiro**, ent√£o por padr√£o o clickjacking n√£o √© poss√≠vel

### Autentica√ß√£o Web

Por padr√£o, a **autentica√ß√£o web** √© especificada no arquivo **`webserver_config.py`** e est√° configurada como
```bash
AUTH_TYPE = AUTH_DB
```
O que significa que a **autentica√ß√£o √© verificada contra o banco de dados**. No entanto, outras configura√ß√µes s√£o poss√≠veis, como
```bash
AUTH_TYPE = AUTH_OAUTH
```
Para delegar a **autentica√ß√£o a servi√ßos terceiros**.

No entanto, tamb√©m existe a op√ß√£o de **permitir acesso a usu√°rios an√¥nimos**, configurando o seguinte par√¢metro para a **fun√ß√£o desejada**:
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
