# Airflow Configuration

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**や**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**する。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)や[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>

## 設定ファイル

**Apache Airflow**は、airflowユーザーのホームに**`airflow.cfg`**という**設定ファイル**を生成します。この設定ファイルには設定情報が含まれており、**興味深く機密性の高い情報が含まれる可能性があります。**

このファイルにアクセスするには2つの方法があります：airflowマシンのいずれかを侵害するか、ウェブコンソールにアクセスするかです。

設定ファイル内の**値は使用されているものとは限らない**ことに注意してください。環境変数を設定することで上書きできます（例：`AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`）。

ウェブサーバーで**設定ファイルにアクセスできる場合**、設定が表示される同じページで**実際の実行中の設定**を確認できます。\
airflow環境内のいずれかのマシンに**アクセスできる場合**は、**環境**をチェックしてください。

設定ファイルを読む際にチェックする興味深い値：

### \[api]

* **`access_control_allow_headers`**: **CORS**に対して**許可されている** **ヘッダー**を示します
* **`access_control_allow_methods`**: **CORS**に対して**許可されているメソッド**を示します
* **`access_control_allow_origins`**: **CORS**に対して**許可されているオリジン**を示します
* **`auth_backend`**: [**ドキュメントによると**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html) APIへのアクセスを設定するためにいくつかのオプションがあります：
* `airflow.api.auth.backend.deny_all`: **デフォルトでは誰も**APIにアクセスできません
* `airflow.api.auth.backend.default`: **認証なしで誰でも**アクセスできます
* `airflow.api.auth.backend.kerberos_auth`: **kerberos認証**を設定するために
* `airflow.api.auth.backend.basic_auth`: **基本認証**のために
* `airflow.composer.api.backend.composer_auth`: コンポーザーの認証を使用します（GCP）（[**こちら**](https://cloud.google.com/composer/docs/access-airflow-api)から）。
* `composer_auth_user_registration_role`: **airflow内で** **コンポーザーユーザー**が取得する**ロール**を示します（デフォルトでは**Op**）。
* Pythonを使用して**独自の認証方法**を**作成する**こともできます。
* **`google_key_path`:** **GCPサービスアカウントキー**のパス

### **\[atlas]**

* **`password`**: Atlasのパスワード
* **`username`**: Atlasのユーザー名

### \[celery]

* **`flower_basic_auth`** : 資格情報 (_user1:password1,user2:password2_)
* **`result_backend`**: PostgresのURLで、**資格情報**が含まれる可能性があります。
* **`ssl_cacert`**: cacertへのパス
* **`ssl_cert`**: 証明書へのパス
* **`ssl_key`**: キーへのパス

### \[core]

* **`dag_discovery_safe_mode`**: デフォルトで有効。DAGを発見する際に、`DAG`と`airflow`の文字列を含まないファイルを無視します。
* **`fernet_key`**: 暗号化された変数を保存するためのキー（対称）
* **`hide_sensitive_var_conn_fields`**: デフォルトで有効で、接続の機密情報を隠します。
* **`security`**: 使用するセキュリティモジュール（例：kerberos）

### \[dask]

* **`tls_ca`**: caへのパス
* **`tls_cert`**: 証明書へのパス
* **`tls_key`**: tlsキーへのパス

### \[kerberos]

* **`ccache`**: ccacheファイルへのパス
* **`forwardable`**: デフォルトで有効

### \[logging]

* **`google_key_path`**: GCP JSONクレデンシャルへのパス。

### \[secrets]

* **`backend`**: シークレットバックエンドを有効にする完全なクラス名
* **`backend_kwargs`**: backend_kwargsパラメータは辞書にロードされ、シークレットバックエンドクラスの**init**に渡されます。

### \[smtp]

* **`smtp_password`**: SMTPのパスワード
* **`smtp_user`**: SMTPのユーザー

### \[webserver]

* **`cookie_samesite`**: デフォルトでは**Lax**なので、すでに可能な限り最弱の値です
* **`cookie_secure`**: セッションクッキーに**セキュアフラグ**を設定します
* **`expose_config`**: デフォルトではFalseですが、trueの場合、ウェブ**コンソール**から**設定**を**読む**ことができます
* **`expose_stacktrace`**: デフォルトではTrueで、**Pythonのトレースバック**を表示します（攻撃者にとって有用な可能性があります）
* **`secret_key`**: これはflaskがクッキーに署名するために使用する**キー**です（これを持っていれば、Airflowの任意のユーザーになりすますことができます）
* **`web_server_ssl_cert`**: **SSL** **証明書**への**パス**
* **`web_server_ssl_key`**: **SSL** **キー**への**パス**
* **`x_frame_enabled`**: デフォルトは**True**なので、デフォルトではクリックジャッキングは不可能です

### Web認証

デフォルトでは**ウェブ認証**は**`webserver_config.py`**ファイルで指定されており、次のように設定されています
```bash
AUTH_TYPE = AUTH_DB
```
これは、**認証がデータベースに対してチェックされる**ことを意味します。しかし、他の設定も可能です。例えば
```bash
AUTH_TYPE = AUTH_OAUTH
```
**サードパーティサービスによる認証**に委ねる。

ただし、以下のパラメータを**望ましいロール**に設定することで、**匿名ユーザーのアクセスを許可する**オプションもあります：
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**、または**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
