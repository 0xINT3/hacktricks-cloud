# Airflow配置

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版的HackTricks，请查看[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## 配置文件

**Apache Airflow**在所有的Airflow机器上生成一个名为**`airflow.cfg`**的**配置文件**，该文件位于Airflow用户的主目录中。此配置文件包含配置信息和**可能包含有趣和敏感的信息**。

**访问此文件的两种方式：通过入侵某些Airflow机器或访问Web控制台。**

请注意，**配置文件中的值可能不是实际使用的值**，因为您可以通过设置环境变量（如`AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`）来覆盖它们。

如果您可以访问**Web服务器上的配置文件**，您可以在显示配置的同一页上检查**实际运行的配置**。\
如果您可以**访问Airflow环境中的某台机器**，请检查**环境**。

阅读配置文件时要检查的一些有趣的值：

### \[api]

* **`access_control_allow_headers`**：这表示**CORS允许的标头**
* **`access_control_allow_methods`**：这表示**CORS允许的方法**
* **`access_control_allow_origins`**：这表示**CORS允许的来源**
* **`auth_backend`**：[**根据文档**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html)，可以采取一些选项来配置谁可以访问API：
* `airflow.api.auth.backend.deny_all`：**默认情况下没有人**可以访问API
* `airflow.api.auth.backend.default`：**任何人都可以**在不进行身份验证的情况下访问
* `airflow.api.auth.backend.kerberos_auth`：用于配置**Kerberos身份验证**
* `airflow.api.auth.backend.basic_auth`：用于**基本身份验证**
* `airflow.composer.api.backend.composer_auth`：使用Composer身份验证（GCP）（来自[**这里**](https://cloud.google.com/composer/docs/access-airflow-api)）。
* `composer_auth_user_registration_role`：这表示**composer用户**在**airflow**中将获得的**角色**（默认为Op）。
* 您还可以使用Python**创建自己的身份验证**方法。
* **`google_key_path`:** GCP服务帐户密钥的路径

### **\[atlas]**

* **`password`**：Atlas密码
* **`username`**：Atlas用户名

### \[celery]

* **`flower_basic_auth`**：凭据（_user1:password1,user2:password2_）
* **`result_backend`**：可能包含**凭据**的Postgres URL。
* **`ssl_cacert`**：cacert的路径
* **`ssl_cert`**：证书的路径
* **`ssl_key`**：密钥的路径

### \[core]

* **`dag_discovery_safe_mode`**：默认启用。在发现DAG时，忽略不包含字符串`DAG`和`airflow`的文件。
* **`fernet_key`**：用于存储加密变量的密钥（对称）
* **`hide_sensitive_var_conn_fields`**：默认启用，隐藏连接的敏感信息。
* **`security`**：要使用的安全模块（例如Kerberos）

### \[dask]

* **`tls_ca`**：ca的路径
* **`tls_cert`**：证书的路径
* **`tls_key`**：tls密钥的路径

### \[kerberos]

* **`ccache`**：ccache文件的路径
* **`forwardable`**：默认启用

### \[logging]

* **`google_key_path`**：GCP JSON凭据的路径。

### \[secrets]

* **`backend`**：启用的secrets后端的完整类名
* **`backend_kwargs`**：backend\_kwargs参数加载到字典中，并传递给secrets后端类的**init**方法。

### \[smtp]

* **`smtp_password`**：SMTP密码
* **`smtp_user`**：SMTP用户

### \[webserver]

* **`cookie_samesite`**：默认为**Lax**，因此已经是最弱的可能值
* **`cookie_secure`**：在会话cookie上设置**secure标志**
* **`expose_config`**：默认为False，如果为true，则可以从Web控制台**读取**配置
* **`expose_stacktrace`**：默认为True，它将显示**Python跟踪**（对攻击者可能有用）
* **`secret_key`**：这是flask用于签署cookie的**密钥**（如果您拥有此密钥，则可以**冒充Airflow中的任何用户**）
* **`web_server_ssl_cert`**：**SSL证书**的**路径**
* **`web_server_ssl_key`**：**SSL密钥**的**路径**
* **`x_frame_enabled`**：默认为**True**，因此默认情况下无法进行点击劫持

### Web身份验证

默认情况下，**Web身份验证**在文件**`webserver_config.py`**中指定，并配置为
```bash
AUTH_TYPE = AUTH_DB
```
这意味着**身份验证将与数据库进行验证**。然而，其他配置也是可能的，比如
```bash
AUTH_TYPE = AUTH_OAUTH
```
将身份验证交给第三方服务。

然而，也有一种选择允许匿名用户访问，将以下参数设置为所需的角色：
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想看到您的公司在 HackTricks 中进行广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获得[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品，[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass)，或在 **Twitter** 上 **关注** 我 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 来分享您的黑客技巧。

</details>
