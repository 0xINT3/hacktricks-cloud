# Configuración de Airflow

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Archivo de configuración

**Apache Airflow** genera un **archivo de configuración** en todas las máquinas de Airflow llamado **`airflow.cfg`** en el directorio home del usuario de Airflow. Este archivo de configuración contiene información de configuración y **puede contener información interesante y sensible.**

**Hay dos formas de acceder a este archivo:** comprometiendo alguna máquina de Airflow o accediendo a la consola web.

Tenga en cuenta que los **valores dentro del archivo de configuración** **pueden no ser los utilizados**, ya que se pueden sobrescribir configurándolos como variables de entorno, como `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`.

Si tiene acceso al **archivo de configuración en el servidor web**, puede verificar la **configuración real en ejecución** en la misma página donde se muestra la configuración.\
Si tiene **acceso a alguna máquina dentro del entorno de Airflow**, verifique el **entorno**.

Algunos valores interesantes para verificar al leer el archivo de configuración:

### \[api]

* **`access_control_allow_headers`**: Esto indica los **encabezados permitidos** para **CORS**
* **`access_control_allow_methods`**: Esto indica los **métodos permitidos** para **CORS**
* **`access_control_allow_origins`**: Esto indica los **orígenes permitidos** para **CORS**
* **`auth_backend`**: [**Según la documentación**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html), se pueden implementar algunas opciones para configurar quién puede acceder a la API:
  * `airflow.api.auth.backend.deny_all`: **Por defecto nadie** puede acceder a la API
  * `airflow.api.auth.backend.default`: **Todos pueden** acceder sin autenticación
  * `airflow.api.auth.backend.kerberos_auth`: Para configurar la **autenticación kerberos**
  * `airflow.api.auth.backend.basic_auth`: Para la **autenticación básica**
  * `airflow.composer.api.backend.composer_auth`: Utiliza la autenticación de compositores (GCP) (de [**aquí**](https://cloud.google.com/composer/docs/access-airflow-api)).
    * `composer_auth_user_registration_role`: Esto indica el **rol** que el **usuario de compositor** obtendrá dentro de **Airflow** (**Op** por defecto).
  * También puede **crear su propio método de autenticación** con python.
* **`google_key_path`:** Ruta de la **clave de cuenta de servicio de GCP**

### **\[atlas]**

* **`password`**: Contraseña de Atlas
* **`username`**: Nombre de usuario de Atlas

### \[celery]

* **`flower_basic_auth`** : Credenciales (_user1:password1,user2:password2_)
* **`result_backend`**: URL de Postgres que puede contener **credenciales**.
* **`ssl_cacert`**: Ruta al cacert
* **`ssl_cert`**: Ruta al certificado
* **`ssl_key`**: Ruta a la clave

### \[core]

* **`dag_discovery_safe_mode`**: Habilitado por defecto. Al descubrir DAG, ignora cualquier archivo que no contenga las cadenas `DAG` y `airflow`.
* **`fernet_key`**: Clave para almacenar variables cifradas (simétricas)
* **`hide_sensitive_var_conn_fields`**: Habilitado por defecto, oculta información sensible de las conexiones.
* **`security`**: Qué módulo de seguridad usar (por ejemplo, kerberos)

### \[dask]

* **`tls_ca`**: Ruta al ca
* **`tls_cert`**: Parte del certificado
* **`tls_key`**: Parte de la clave tls

### \[kerberos]

* **`ccache`**: Ruta al archivo ccache
* **`forwardable`**: Habilitado por defecto

### \[logging]

* **`google_key_path`**: Ruta de GCP JSON creds.

### \[secrets]

* **`backend`**: Nombre completo de la clase de backend de secretos para habilitar
* **`backend_kwargs`**: El parámetro backend\_kwargs se carga en un diccionario y se pasa a **init** de la clase de backend de secretos.

### \[smtp]

* **`smtp_password`**: Contraseña SMTP
* **`smtp_user`**: Usuario SMTP

### \[webserver]

* **`cookie_samesite`**: Por defecto es **Lax**, por lo que ya es el valor más débil posible
* **`cookie_secure`**: Establece la **bandera segura** en la cookie de sesión
* **`expose_config`**: Por defecto es False, si es verdadero, la **configuración** se puede **leer** desde la **consola web**
* **`expose_stacktrace`**: Por defecto es True, mostrará **rastreos de Python** (potencialmente útil para un atacante)
* **`secret_key`**: Esta es la **clave utilizada por Flask para firmar las cookies** (si la tiene, puede **suplantar a cualquier usuario en Airflow**)
* **`web_server_ssl_cert`**: **Ruta** al **certificado SSL**
* **`web_server_ssl_key`**: **Ruta** a la **clave SSL**
* **`x_frame_enabled`**: Por defecto es **True**, por lo que por defecto no es posible el clickjacking

### Autenticación web

Por defecto, la **autenticación web** se especifica en el archivo **`webserver_config.py`** y se configura como

```bash
AUTH_TYPE = AUTH_DB
```

Lo que significa que la **autenticación se verifica contra la base de datos**. Sin embargo, son posibles otras configuraciones como

```bash
AUTH_TYPE = AUTH_OAUTH
```

Para dejar la **autenticación a servicios de terceros**.

Sin embargo, también hay una opción para permitir el acceso de **usuarios anónimos**, estableciendo el siguiente parámetro en el **rol deseado**:

```bash
AUTH_ROLE_PUBLIC = 'Admin'
```

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>