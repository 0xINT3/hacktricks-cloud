# Airflowの設定

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もし **HackTricksであなたの会社を宣伝したい**場合や、**PEASSの最新バージョンやHackTricksのPDFをダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つけましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するために、PRを提出して** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに参加してください。**

</details>

## 設定ファイル

**Apache Airflow**は、すべてのAirflowマシンに**`airflow.cfg`**という名前の**設定ファイル**を生成します。この設定ファイルには、設定情報や**興味深いかつ機密性の高い情報**が含まれている可能性があります。

このファイルにアクセスする方法は2つあります: Airflowマシンを侵害するか、Webコンソールにアクセスするかです。

設定ファイル内の値は、`AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`のような環境変数を設定することで上書きできるため、**実際に使用される値とは異なる場合があります**。

Webサーバーの設定ファイルにアクセスできる場合は、設定が表示される同じページで**実際の実行設定**を確認できます。Airflow環境内のマシンにアクセスできる場合は、**環境**を確認してください。

設定ファイルを読む際にチェックすると興味深い値:

### \[api]

* **`access_control_allow_headers`**: これは**CORSの許可されたヘッダー**を示します
* **`access_control_allow_methods`**: これは**CORSの許可されたメソッド**を示します
* **`access_control_allow_origins`**: これは**CORSの許可されたオリジン**を示します
* **`auth_backend`**: [**ドキュメントによると**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html)、APIへのアクセスを許可するためにいくつかのオプションがあります:
* `airflow.api.auth.backend.deny_all`: **デフォルトでは誰も**APIにアクセスできません
* `airflow.api.auth.backend.default`: **誰でも**認証なしでアクセスできます
* `airflow.api.auth.backend.kerberos_auth`: **Kerberos認証**を設定するためのオプション
* `airflow.api.auth.backend.basic_auth`: **基本認証**のためのオプション
* `airflow.composer.api.backend.composer_auth`: コンポーザーの認証を使用します (GCP) ([**こちら**](https://cloud.google.com/composer/docs/access-airflow-api)から)
* `composer_auth_user_registration_role`: これは**composerユーザー**が**airflow**内で取得する**役割**を示します (**デフォルトではOp**)
* また、Pythonで独自の認証方法を作成することもできます。
* **`google_key_path`:** GCPサービスアカウントキーへのパス

### **\[atlas]**

* **`password`**: Atlasのパスワード
* **`username`**: Atlasのユーザー名

### \[celery]

* **`flower_basic_auth`** : 認証情報 (_user1:password1,user2:password2_)
* **`result_backend`**: **資格情報**を含むPostgresのURL
* **`ssl_cacert`**: cacertへのパス
* **`ssl_cert`**: 証明書へのパス
* **`ssl_key`**: キーへのパス

### \[core]

* **`dag_discovery_safe_mode`**: デフォルトで有効になっています。DAGを検出する際に、`DAG`と`airflow`という文字列を含まないファイルは無視されます。
* **`fernet_key`**: 暗号化された変数を保存するためのキー (対称鍵)
* **`hide_sensitive_var_conn_fields`**: デフォルトで有効になっており、接続の機密情報を非表示にします。
* **`security`**: 使用するセキュリティモジュール (例: kerberos)

### \[dask]

* **`tls_ca`**: caへのパス
* **`tls_cert`**: 証明書へのパス
* **`tls_key`**: tlsキーへのパス

### \[kerberos]

* **`ccache`**: ccacheファイルへのパス
* **`forwardable`**: デフォルトで有効になっています

### \[logging]

* **`google_key_path`**: GCP JSON認証情報へのパス

### \[secrets]

* **`backend`**: 有効にするシークレットバックエンドの完全なクラス名
* **`backend_kwargs`**: backend\_kwargsパラメータは辞書にロードされ、シークレットバックエンドクラスの**init**に渡されます。

### \[smtp]

* **`smtp_password`**: SMTPのパスワード
* **`smtp_user`**: SMTPのユーザー名

### \[webserver]

* **`cookie_samesite`**: デフォルトでは**Lax**なので、既に最も弱い値になっています
* **`cookie_secure`**: セッションクッキーに**secureフラグ**を設定します
* **`expose_config`**: デフォルトではFalseですが、trueにすると**設定**をWebコンソールから**読み取る**ことができます
* **`expose_stacktrace`**: デフォルトではTrueですが、**Pythonのトレースバック**を表示します（攻撃者にとって有用かもしれません）
* **`secret_key`**: これはFlaskがクッキーに署名するために使用する**キー**です（これがあれば、Airflowの任意のユーザーになりすますことができます）
* **`web_server_ssl_cert`**: **SSL証明書**への**パス**
* **`web_server_ssl_key`**: **SSLキー**への**パス**
* **`x_frame_enabled`**: デフォルトは**True**なので、デフォルトではクリックジャッキングは不可能です

### Web認証

デフォルトでは、**Web認証**は**`webserver_config.py`**というファイルに指定され、以下のように設定されています。
```bash
AUTH_TYPE = AUTH_DB
```
これは、**認証がデータベースに対してチェックされる**ことを意味します。ただし、他の設定も可能です。
```bash
AUTH_TYPE = AUTH_OAUTH
```
**第三者のサービスに認証を委任する**ために。

ただし、**匿名ユーザーにアクセスを許可**するオプションもあります。以下のパラメータを**所望の役割**に設定します。
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**最新バージョンのPEASSにアクセスしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしましょう 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)**と**[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)**のGitHubリポジトリにPRを提出してください。**

</details>
