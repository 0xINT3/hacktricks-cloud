# S√©curit√© d'Apache Airflow

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

</details>

## Informations de base

[**Apache Airflow**](https://airflow.apache.org) est utilis√© pour la **planification et l'orchestration de pipelines ou workflows de donn√©es**. L'orchestration de pipelines de donn√©es fait r√©f√©rence √† la s√©quence, la coordination, la planification et la gestion de **pipelines de donn√©es complexes provenant de sources diverses**. Ces pipelines de donn√©es fournissent des ensembles de donn√©es pr√™ts √† √™tre consomm√©s par des applications d'intelligence d'affaires et de science des donn√©es, des mod√®les d'apprentissage automatique qui prennent en charge les applications de donn√©es volumineuses.

Essentiellement, Apache Airflow vous permettra de **planifier l'ex√©cution de code lorsqu'un √©v√©nement ou une t√¢che cron se produit**.

## Laboratoire local

### Docker-Compose

Vous pouvez utiliser le **fichier de configuration docker-compose** de [**https://raw.githubusercontent.com/apache/airflow/main/docs/apache-airflow/start/docker-compose.yaml**](https://raw.githubusercontent.com/apache/airflow/main/docs/apache-airflow/start/docker-compose.yaml) pour lancer un environnement complet d'Apache Airflow sous Docker. (Si vous √™tes sous MacOS, assurez-vous de donner au moins 6 Go de RAM √† la machine virtuelle Docker).

### Minikube

Une fa√ßon facile de **lancer Apache Airflow** est de l'ex√©cuter **avec minikube** :

```bash
helm repo add airflow-stable https://airflow-helm.github.io/charts
helm repo update
helm install airflow-release airflow-stable/airflow
# Des informations sur la fa√ßon d'acc√©der √† la console Web appara√Ætront apr√®s cette commande

# Utilisez cette commande pour le supprimer
helm delete airflow-release
```

## Configuration d'Airflow

Airflow peut stocker des **informations sensibles** dans sa configuration ou vous pouvez trouver des configurations faibles en place :

{% content-ref url="airflow-configuration.md" %}
[airflow-configuration.md](airflow-configuration.md)
{% endcontent-ref %}

## Airflow RBAC

Avant de commencer √† attaquer Airflow, vous devez comprendre **comment fonctionnent les autorisations** :

{% content-ref url="airflow-rbac.md" %}
[airflow-rbac.md](airflow-rbac.md)
{% endcontent-ref %}

## Attaques

### √ânum√©ration de la console Web

Si vous avez **acc√®s √† la console Web**, vous pourriez √™tre en mesure d'acc√©der √† certaines ou √† toutes les informations suivantes :

* **Variables** (des informations sensibles personnalis√©es peuvent √™tre stock√©es ici)
* **Connexions** (des informations sensibles personnalis√©es peuvent √™tre stock√©es ici)
  * Acc√©dez-y √† `http://<airflow>/connection/list/`
* [**Configuration**](./#airflow-configuration) (Des informations sensibles telles que la **`secret_key`** et les mots de passe peuvent √™tre stock√©es ici)
* Liste des **utilisateurs et des r√¥les**
* **Code de chaque DAG** (qui peut contenir des informations int√©ressantes)

### R√©cup√©ration des valeurs des variables

Les variables peuvent √™tre stock√©es dans Airflow afin que les **DAGs** puissent **acc√©der** √† leurs valeurs. C'est similaire aux secrets d'autres plateformes. Si vous avez **suffisamment de permissions**, vous pouvez y acc√©der dans l'interface graphique √† `http://<airflow>/variable/list/`.\
Par d√©faut, Airflow affichera la valeur de la variable dans l'interface graphique, cependant, selon [**ceci**](https://marclamberti.com/blog/variables-with-apache-airflow/), il est possible de d√©finir une **liste de variables** dont la **valeur** appara√Ætra sous forme d'**ast√©risques** dans l'**interface graphique**.

![](<../../.gitbook/assets/image (79).png>)

Cependant, ces **valeurs** peuvent encore √™tre **r√©cup√©r√©es** via **CLI** (vous devez avoir acc√®s √† la base de donn√©es), **ex√©cution arbitraire de DAG**, **API** acc√©dant au point de terminaison des variables (l'API doit √™tre activ√©e), et **m√™me l'interface graphique elle-m√™me !**\
Pour acc√©der √† ces valeurs depuis l'interface graphique, il suffit de **s√©lectionner les variables** que vous souhaitez acc√©der et de **cliquer sur Actions -> Export**.\
Une autre fa√ßon est d'effectuer une **brute force** sur la **valeur cach√©e** en utilisant le **filtrage de recherche** jusqu'√† ce que vous l'obteniez :

![](<../../.gitbook/assets/image (30).png>)

### √âl√©vation de privil√®ges

Si la configuration **`expose_config`** est d√©finie sur **True**, √† partir du **r√¥le Utilisateur** et au-dessus, vous pouvez **lire** la **configuration dans le Web**. Dans cette configuration, la **`secret_key`** appara√Æt, ce qui signifie que tout utilisateur disposant de cette cl√© valide peut **cr√©er son propre cookie sign√©