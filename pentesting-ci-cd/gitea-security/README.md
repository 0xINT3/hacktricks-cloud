# Gitea Güvenliği

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong> öğrenin!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI'na**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek paylaşın**.

</details>

## Gitea Nedir

**Gitea**, Go dilinde yazılmış **kendine ait barındırılan topluluk yönetimli hafif kod barındırma** çözümüdür.

![](<../../.gitbook/assets/image (5) (1) (1) (1) (1) (1).png>)

### Temel Bilgiler

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Lab

Yerel bir Gitea örneğini çalıştırmak için sadece bir docker konteyneri çalıştırabilirsiniz:
```bash
docker run -p 3000:3000 gitea/gitea
```
Web sayfasına erişmek için 3000 numaralı porta bağlanın.

Ayrıca kubernetes ile çalıştırabilirsiniz:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Kimlik Doğrulaması Yapılmamış Sıralama

* Genel depolar: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Kayıtlı kullanıcılar: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Kayıtlı Organizasyonlar: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Unutmayın ki **varsayılan olarak Gitea yeni kullanıcıların kaydolmasına izin verir**. Bu, yeni kullanıcılara diğer organizasyonlar/kullanıcılar depoları üzerinde özel erişim sağlamaz, ancak **giriş yapmış bir kullanıcı** daha fazla depo veya organizasyonu **görebilir**.

## İçeriden Sızma

Bu senaryoda, bir github hesabına bazı erişimler elde ettiğinizi varsayacağız.

### Kullanıcı Kimlik Bilgileri/Web Çerezi ile

Eğer bir organizasyon içindeki bir kullanıcının kimlik bilgilerine sahipseniz (veya bir oturum çerezi çaldıysanız), **sadece giriş yapabilir** ve **hangi izinlere** sahip olduğunuzu, **hangi depolarda** olduğunuzu, **hangi takımlarda** olduğunuzu, **diğer kullanıcıları listeyebilir** ve **depoların nasıl korunduğunu** kontrol edebilirsiniz.

Unutmayın ki **2FA kullanılabilir**, bu nedenle bu bilgilere erişebilmeniz için **bu kontrolü de geçebilmeniz gerekecektir**.

{% hint style="info" %}
Unutmayın ki, `i_like_gitea` çereziyi (şu anda SameSite: Lax ile yapılandırılmış) **çalmayı başarırsanız**, kimlik bilgilerine veya 2FA'ya ihtiyaç duymadan **kullanıcıyı tamamen taklit edebilirsiniz**.
{% endhint %}

### Kullanıcı SSH Anahtarı ile

Gitea, **kullanıcıların** kimlik doğrulama yöntemi olarak kullanılacak **SSH anahtarları** belirlemelerine izin verir (2FA uygulanmaz).

Bu anahtarla, **kullanıcının bazı ayrıcalıklara sahip olduğu depolarda değişiklikler yapabilirsiniz**, ancak gitea api'ye erişmek için kullanamazsınız. Bununla birlikte, erişiminiz olan depolar ve kullanıcı hakkında bilgi almak için **yerel ayarları sıralayabilirsiniz**:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Eğer kullanıcı kullanıcı adını gitea kullanıcı adı olarak yapılandırdıysa, hesabında ayarladığı **genel anahtarları** _https://github.com/\<gitea\_kullanıcıadı>.keys_ adresinden erişebilirsiniz, bu şekilde bulduğunuz özel anahtarın kullanılabileceğini doğrulamak için bunu kontrol edebilirsiniz.

**SSH anahtarları**, **dağıtım anahtarları** olarak da depolarda ayarlanabilir. Bu anahtara erişimi olan herkes, bir depodan projeleri **başlatabilir**. Genellikle farklı dağıtım anahtarlarına sahip bir sunucuda yerel **`~/.ssh/config`** dosyası size hangi anahtarın ilişkili olduğu hakkında bilgi verecektir.

#### GPG Anahtarları

[**Burada**](broken-reference/) açıklandığı gibi bazen taahhütleri imzalamak gerekebilir veya keşfedilebilirsiniz.

Mevcut kullanıcının herhangi bir anahtara sahip olup olmadığını yerel olarak kontrol edin:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Kullanıcı Jetonu ile

[**Kullanıcı Jetonları hakkında temel bilgilere buradan bakabilirsiniz**](basic-gitea-information.md#personal-access-tokens).

Kullanıcı jetonu, Gitea sunucusuna [**API aracılığıyla**](https://try.gitea.io/api/swagger#/) kimlik doğrulaması yapmak için **bir şifre yerine** kullanılabilir. Kullanıcı üzerinde **tam erişime** sahip olacaktır.

### Oauth Uygulaması ile

[**Gitea Oauth Uygulamaları hakkında temel bilgilere buradan bakabilirsiniz**](./#with-oauth-application).

Bir saldırgan, muhtemelen bir dolandırıcılık kampanyasının bir parçası olarak, kullanıcıların ayrıcalıklı veri/aksiyonlara erişmek için **kötü niyetli bir Oauth Uygulaması** oluşturabilir.

Temel bilgilerde açıklandığı gibi, uygulama, kullanıcı hesabı üzerinde **tam erişime** sahip olacaktır.

### Şube Koruma Atlatma

Github'da, varsayılan olarak, **yazma erişimi olan bir jeton** alan **github eylemleri** bulunur ve bu, **şube korumalarını atlatmak** için kullanılabilir. Bu durumda, bu tür bir şey yok, bu yüzden atlatmalar daha sınırlıdır. Ancak, neler yapabileceğimize bir göz atalım:

* **Push Etkinleştir**: Yazma erişimi olan herhangi bir kişi şubeye itebilir, sadece itin.
* **Beyaz Liste Kısıtlı İtme**: Aynı şekilde, bu listede yer alıyorsanız, şubeye itin.
* **Birleştirme Beyaz Listesini Etkinleştir**: Bir birleştirme beyaz listesi varsa, içinde olmanız gerekiyor.
* **Onaylar 0'dan büyük olmalı**: O zaman... başka bir kullanıcıyı ele geçirmeniz gerekiyor.
* **Onayları beyaz listeye al**: Sadece beyaz listeye alınan kullanıcılar onay verebilirse... o zaman bu listede olan başka bir kullanıcıyı ele geçirmeniz gerekiyor.
* **Eski onayları reddet**: Onaylar yeni taahhütlerle kaldırılmazsa, zaten onaylanmış bir PR'yi ele geçirerek kodunuzu enjekte edebilir ve PR'yi birleştirebilirsiniz.

Unutmayın ki **bir org/repo yöneticisi** olarak korumaları atlayabilirsiniz.

### Webhook'ları Numaralandırma

**Webhook'lar**, belirli gitea bilgilerini bazı yerlere **gönderebilir**. Bu iletişimi **sömürmek** mümkün olabilir.\
Ancak genellikle, webhook'ta **alınamayan bir gizli** ayarlanır ve bu, webhook'un URL'sini bilen ancak gizliyi bilmeyen harici kullanıcıların **webhook'u sömürmesini engeller**.\
Ancak bazı durumlarda, insanlar gizliyi yerine **URL'de bir parametre olarak ayarlarlar**, bu nedenle URL'leri kontrol etmek, daha fazla sömürülebilecek gizli bilgiler ve diğer yerleri bulmanıza olanak sağlayabilir.

Webhook'lar **repo ve org düzeyinde** ayarlanabilir.

## Son Aşama Sömürüsü

### Sunucu İçinde

Herhangi bir şekilde gitea'nın çalıştığı sunucuya erişmeyi başarırsanız, gitea yapılandırma dosyasını aramalısınız. Varsayılan olarak `/data/gitea/conf/app.ini` konumunda bulunur.

Bu dosyada **anahtarlar** ve **şifreler** bulabilirsiniz.

Gitea yolunda (varsayılan olarak: /data/gitea), ayrıca aşağıdaki gibi ilginç bilgiler bulabilirsiniz:

* **sqlite** DB: Gitea, harici bir veritabanı kullanmıyorsa, bir sqlite veritabanı kullanır.
* Oturumlar oturumlar klasörü içinde: `cat sessions/*/*/*` komutunu çalıştırarak oturum açmış kullanıcıların kullanıcı adlarını görebilirsiniz (gitea oturumları ayrıca DB içinde kaydedebilir).
* jwt klasörü içindeki **jwt özel anahtarı**
* Bu klasörde daha fazla **hassas bilgi** bulunabilir

Sunucu içindeyseniz, bilgilere erişmek/değiştirmek için **`gitea` ikili dosyasını** kullanabilirsiniz:

* `gitea dump` gitea'yı döker ve bir .zip dosyası oluşturur
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` belirtilen türde bir belirteç oluşturur (kalıcılık)
* `gitea admin user change-password --username admin --password newpassword` Şifreyi değiştirir
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Yeni yönetici kullanıcı oluşturur ve bir erişim belirteci alır

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **tanıtmak veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimizi**](https://opensea.io/collection/the-peass-family) görün
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da** takip edin.
* **Hacking hilelerinizi HackTricks ve HackTricks Cloud** github depolarına **PR göndererek paylaşın**.

</details>
