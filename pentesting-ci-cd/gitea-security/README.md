# Seguran√ßa do Gitea

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegrama**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## O que √© o Gitea

**Gitea** √© uma solu√ß√£o de hospedagem de c√≥digo **leve, gerenciada pela comunidade e auto-hospedada** escrita em Go.

![](<../../.gitbook/assets/image (5) (1) (1) (1).png>)

### Informa√ß√µes b√°sicas

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Laborat√≥rio

Para executar uma inst√¢ncia do Gitea localmente, voc√™ pode simplesmente executar um cont√™iner docker:

```bash
docker run -p 3000:3000 gitea/gitea
```

Conecte-se √† porta 3000 para acessar a p√°gina da web.

Voc√™ tamb√©m pode execut√°-lo com o Kubernetes:

```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```

## Enumera√ß√£o n√£o autenticada

* Reposit√≥rios p√∫blicos: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Usu√°rios registrados: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Organiza√ß√µes registradas: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Observe que, por **padr√£o, o Gitea permite que novos usu√°rios se registrem**. Isso n√£o dar√° acesso especialmente interessante aos novos usu√°rios sobre outros reposit√≥rios de organiza√ß√µes / usu√°rios, mas um **usu√°rio conectado** pode ser capaz de **visualizar mais reposit√≥rios ou organiza√ß√µes**.

## Explora√ß√£o interna

Para este cen√°rio, vamos supor que voc√™ tenha obtido algum acesso a uma conta do Github.

### Com credenciais de usu√°rio / cookie da web

Se voc√™ j√° tiver credenciais para um usu√°rio dentro de uma organiza√ß√£o (ou roubou um cookie de sess√£o), poder√° **apenas fazer login** e verificar quais **permiss√µes voc√™ tem** sobre quais **reposit√≥rios**, em **quais equipes** voc√™ est√°, **listar outros usu√°rios** e **como os reposit√≥rios s√£o protegidos**.

Observe que **a autentica√ß√£o de dois fatores pode ser usada**, portanto, voc√™ s√≥ poder√° acessar essas informa√ß√µes se tamb√©m puder **passar por essa verifica√ß√£o**.

{% hint style="info" %}
Observe que, se voc√™ **conseguir roubar o cookie `i_like_gitea`** (atualmente configurado com SameSite: Lax), poder√° **se passar completamente pelo usu√°rio** sem precisar de credenciais ou autentica√ß√£o de dois fatores.
{% endhint %}

### Com chave SSH do usu√°rio

O Gitea permite que **usu√°rios** definam **chaves SSH** que ser√£o usadas como **m√©todo de autentica√ß√£o para implantar c√≥digo** em seu nome (nenhuma autentica√ß√£o de dois fatores √© aplicada).

Com esta chave, voc√™ pode realizar **altera√ß√µes em reposit√≥rios onde o usu√°rio tem alguns privil√©gios**, no entanto, voc√™ n√£o pode us√°-la para acessar a API do gitea para enumerar o ambiente. No entanto, voc√™ pode **enumerar as configura√ß√µes locais** para obter informa√ß√µes sobre os reposit√≥rios e usu√°rios aos quais voc√™ tem acesso:

```bash
# V√° para a pasta do reposit√≥rio
# Obtenha a configura√ß√£o do reposit√≥rio e o nome e e-mail do usu√°rio atual
git config --list
```

Se o usu√°rio tiver configurado seu nome de usu√°rio como seu nome de usu√°rio do gitea, voc√™ pode acessar as **chaves p√∫blicas que ele definiu** em sua conta em _https://github.com/\<gitea\_username>.keys_, voc√™ pode verificar isso para confirmar que a chave privada que voc√™ encontrou pode ser usada.

**Chaves SSH** tamb√©m podem ser definidas em reposit√≥rios como **chaves de implanta√ß√£o**. Qualquer pessoa com acesso a essa chave poder√° **lan√ßar projetos de um reposit√≥rio**. Normalmente, em um servidor com diferentes chaves de implanta√ß√£o, o arquivo local **`~/.ssh/config`** fornecer√° informa√ß√µes sobre qual chave est√° relacionada.

#### Chaves GPG

Como explicado [**aqui**](broken-reference/), √†s vezes √© necess√°rio assinar os commits ou voc√™ pode ser descoberto.

Verifique localmente se o usu√°rio atual tem alguma chave com:

```shell
gpg --list-secret-keys --keyid-format=long
```

### Com token de usu√°rio

Para uma introdu√ß√£o sobre [**tokens de usu√°rio, verifique as informa√ß√µes b√°sicas**](basic-gitea-information.md#personal-access-tokens).

Um token de usu√°rio pode ser usado **em vez de uma senha** para **autenticar** no servidor Gitea [**via API**](https://try.gitea.io/api/swagger#/). Ele ter√° **acesso completo** sobre o usu√°rio.

### Com aplicativo Oauth

Para uma introdu√ß√£o sobre [**aplicativos Oauth do Gitea, verifique as informa√ß√µes b√°sicas**](./#with-oauth-application).

Um invasor pode criar um **aplicativo Oauth malicioso** para acessar dados / a√ß√µes privilegiados dos usu√°rios que os aceitam, provavelmente como parte de uma campanha de phishing.

Como explicado nas informa√ß√µes b√°sicas, o aplicativo ter√° **acesso total √† conta do usu√°rio**.

### Bypass de prote√ß√£o de ramifica√ß√£o

No Github, temos **a√ß√µes do Github** que, por padr√£o, obt√™m um **token com acesso de grava√ß√£o** sobre o reposit√≥rio que pode ser usado para **burlar as prote√ß√µes de ramifica√ß√£o**. Neste caso, isso