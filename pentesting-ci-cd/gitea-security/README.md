# Sicurezza di Gitea

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## Cos'√® Gitea

**Gitea** √® una soluzione di **hosting leggera per il codice gestita dalla comunit√† e auto-ospitata** scritta in Go.

![](<../../.gitbook/assets/image (5) (1) (1) (1) (1) (1).png>)

### Informazioni di base

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Laboratorio

Per eseguire un'istanza di Gitea in locale, puoi semplicemente eseguire un container Docker:
```bash
docker run -p 3000:3000 gitea/gitea
```
Connettiti alla porta 3000 per accedere alla pagina web.

Puoi anche eseguirlo con Kubernetes:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Enumerazione non autenticata

* Repository pubblici: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Utenti registrati: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Organizzazioni registrate: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Si noti che per **default Gitea consente ai nuovi utenti di registrarsi**. Questo non dar√† accesso particolarmente interessante ai nuovi utenti rispetto ad altri repository di organizzazioni/utenti, ma un **utente connesso** potrebbe essere in grado di **visualizzare pi√π repository o organizzazioni**.

## Sfruttamento interno

Per questo scenario supponiamo che tu abbia ottenuto l'accesso a un account GitHub.

### Con credenziali utente/Cookie web

Se in qualche modo hai gi√† le credenziali per un utente all'interno di un'organizzazione (o hai rubato un cookie di sessione) puoi **effettuare il login** e controllare quali **permessi hai** su quali **repository**, in **quali team** sei, **elencare altri utenti** e **come sono protetti i repository**.

Si noti che potrebbe essere utilizzato **2FA**, quindi sarai in grado di accedere a queste informazioni solo se riesci anche a **superare quel controllo**.

{% hint style="info" %}
Si noti che se riesci a **rubare il cookie `i_like_gitea`** (attualmente configurato con SameSite: Lax) puoi **impersonare completamente l'utente** senza aver bisogno di credenziali o 2FA.
{% endhint %}

### Con chiave SSH utente

Gitea consente agli **utenti** di impostare **chiavi SSH** che verranno utilizzate come **metodo di autenticazione per distribuire il codice** per loro conto (non viene applicato il 2FA).

Con questa chiave puoi effettuare **modifiche nei repository in cui l'utente ha alcuni privilegi**, tuttavia non puoi usarla per accedere all'API di Gitea per enumerare l'ambiente. Tuttavia, puoi **enumerare le impostazioni locali** per ottenere informazioni sui repository e gli utenti a cui hai accesso:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Se l'utente ha configurato il suo nome utente come il suo nome utente gitea, √® possibile accedere alle **chiavi pubbliche che ha impostato** nel suo account su _https://github.com/\<gitea\_username>.keys_, √® possibile verificare questo per confermare che la chiave privata trovata possa essere utilizzata.

Le **chiavi SSH** possono anche essere impostate nei repository come **chiavi di deploy**. Chiunque abbia accesso a questa chiave sar√† in grado di **avviare progetti da un repository**. Di solito, in un server con diverse chiavi di deploy, il file locale **`~/.ssh/config`** ti fornir√† informazioni su quale chiave √® correlata.

#### Chiavi GPG

Come spiegato [**qui**](broken-reference/) a volte √® necessario firmare i commit o potresti essere scoperto.

Controlla localmente se l'utente corrente ha qualche chiave con:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Con Token Utente

Per una introduzione sui [**Token Utente, consulta le informazioni di base**](basic-gitea-information.md#personal-access-tokens).

Un token utente pu√≤ essere utilizzato **al posto di una password** per **autenticarsi** presso il server Gitea [**tramite API**](https://try.gitea.io/api/swagger#/). Avr√† **accesso completo** all'account dell'utente.

### Con Applicazione Oauth

Per una introduzione sulle [**Applicazioni Oauth di Gitea, consulta le informazioni di base**](./#with-oauth-application).

Un attaccante potrebbe creare un'**Applicazione Oauth malevola** per accedere a dati/azioni privilegiate degli utenti che le accettano, probabilmente come parte di una campagna di phishing.

Come spiegato nelle informazioni di base, l'applicazione avr√† **accesso completo all'account dell'utente**.

### Bypass delle Protezioni del Branch

In Github abbiamo le **azioni di Github** che di default ottengono un **token con accesso in scrittura** sul repository che pu√≤ essere utilizzato per **bypassare le protezioni del branch**. In questo caso ci√≤ **non esiste**, quindi i bypass sono pi√π limitati. Ma vediamo cosa pu√≤ essere fatto:

* **Abilita Push**: Se chiunque con accesso in scrittura pu√≤ effettuare push sul branch, basta effettuare il push.
* **Whitelist Push Restretto**: Allo stesso modo, se fai parte di questa lista, effettua il push sul branch.
* **Abilita Whitelist Merge**: Se esiste una whitelist di merge, devi farne parte.
* **Richiedi approvazioni maggiori di 0**: Allora... devi compromettere un altro utente.
* **Limita approvazioni ai whitelisted**: Se solo gli utenti in whitelist possono approvare... devi compromettere un altro utente che √® all'interno di quella lista.
* **Ignora approvazioni obsolete**: Se le approvazioni non vengono rimosse con nuovi commit, potresti dirottare una PR gi√† approvata per iniettare il tuo codice e unire la PR.

Nota che **se sei un amministratore di un'organizzazione/repo** puoi bypassare le protezioni.

### Enumera Webhooks

I **Webhook** sono in grado di **inviare informazioni specifiche di Gitea in alcuni luoghi**. Potresti essere in grado di **sfruttare quella comunicazione**.\
Tuttavia, di solito viene impostato un **segreto** che **non puoi recuperare** nel **webhook** che **impedir√†** agli utenti esterni che conoscono l'URL del webhook ma non il segreto di **sfruttare quel webhook**.\
Ma in alcune occasioni, invece di impostare il **segreto** al suo posto, viene **impostato nell'URL** come parametro, quindi **controllare gli URL** potrebbe consentirti di **trovare segreti** e altri luoghi che potresti sfruttare ulteriormente.

I webhook possono essere impostati a **livello di repo e di organizzazione**.

## Post Esploitation

### All'interno del server

Se in qualche modo sei riuscito ad accedere al server in cui √® in esecuzione Gitea, dovresti cercare il file di configurazione di Gitea. Di default si trova in `/data/gitea/conf/app.ini`

In questo file puoi trovare **chiavi** e **password**.

Nel percorso di Gitea (di default: /data/gitea) puoi trovare anche informazioni interessanti come:

* Il **database sqlite**: Se Gitea non utilizza un database esterno, utilizzer√† un database sqlite.
* Le **sessioni** all'interno della cartella delle sessioni: Eseguendo `cat sessions/*/*/*` puoi vedere i nomi utente degli utenti connessi (Gitea potrebbe anche salvare le sessioni all'interno del database).
* La **chiave privata jwt** all'interno della cartella jwt.
* Altre **informazioni sensibili** potrebbero essere trovate in questa cartella.

Se sei all'interno del server, puoi anche **utilizzare il binario `gitea`** per accedere/modificare le informazioni:

* `gitea dump` effettuer√† il dump di Gitea e generer√† un file .zip
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` generer√† un token del tipo indicato (persistenza)
* `gitea admin user change-password --username admin --password newpassword` Cambia la password
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Crea un nuovo utente amministratore e ottieni un token di accesso

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF**, controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR** a [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
