# Gitea Security

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Wat is Gitea

**Gitea** is 'n **self-gehoste gemeenskapsbestuurde ligte kodebergingsoplossing** wat in Go geskryf is.

![](<../../.gitbook/assets/image (5) (1) (1) (1) (1) (1).png>)

### Basiese Inligting

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Laboratorium

Om 'n Gitea-instansie plaaslik te hardloop, kan jy net 'n docker-houer hardloop:

```bash
docker run -p 3000:3000 gitea/gitea
```

Koppel aan poort 3000 om toegang tot die webblad te verkry.

Jy kan dit ook met kubernetes uitvoer:

```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```

## Ongeverifieerde Opsomming

* Openbare repos: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Geregistreerde gebruikers: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Geregistreerde Organisasies: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Merk op dat **Gitea standaard nieuwe gebruikers toelaat om te registreer**. Dit geeft de nieuwe gebruikers geen speciaal interessante toegang tot andere organisasies/gebruikers se repos nie, maar 'n **ingeteken gebruiker** mag dalk in staat wees om **meer repos of organisasies te sien**.

## Interne Uitbuiting

Vir hierdie scenario gaan ons aanneem dat jy toegang tot 'n github-rekening verkry het.

### Met Gebruikerslegitimasie/Web Koekie

As jy op een of ander manier al legitimasie vir 'n gebruiker binne 'n organisasie het (of jy het 'n sessiekoekie gesteel), kan jy **net inteken** en kyk watter **toestemmings jy het** oor watter **repos**, in **watter spanne** jy is, **ander gebruikers lys**, en **hoe die repos beskerm is**.

Merk op dat **2FA gebruik kan word**, so jy sal slegs toegang tot hierdie inligting h√™ as jy ook **daardie toets kan slaag**.

{% hint style="info" %}
Merk op dat as jy die `i_like_gitea` koekie **kan steel** (tans gekonfigureer met SameSite: Lax), kan jy **volledig die gebruiker voorstel** sonder om legitimasie of 2FA nodig te h√™.
{% endhint %}

### Met Gebruikers SSH-sleutel

Gitea laat **gebruikers** toe om **SSH-sleutels** in te stel wat as **verifikasiemetode gebruik sal word om kode te implementeer** namens hulle (geen 2FA word toegepas nie).

Met hierdie sleutel kan jy **veranderinge aanbring in repositoriums waar die gebruiker sekere voorregte het**, maar jy kan dit nie gebruik om toegang tot die gitea-api te verkry om die omgewing op te som nie. Jy kan egter **plaaslike instellings opnoem** om inligting oor die repos en gebruiker waarop jy toegang het, te verkry:

```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```

As die gebruiker sy gebruikersnaam as sy gitea-gebruikersnaam gekonfigureer het, kan jy die **openbare sleutels wat hy ingestel het** in sy rekening by _https://github.com/\<gitea\_gebruikersnaam>.keys_ toegang, jy kan dit nagaan om te bevestig dat die privaatsleutel wat jy gevind het, gebruik kan word.

**SSH-sleutels** kan ook in repositories as **implementeringssleutels** ingestel word. Enigeen met toegang tot hierdie sleutel sal in staat wees om projekte vanuit 'n repository te **begin**. Gewoonlik sal die plaaslike l√™er **`~/.ssh/config`** jou inligting gee oor watter sleutel verband hou.

#### GPG-sleutels

Soos [**hier**](https://github.com/carlospolop/hacktricks-cloud/blob/af/pentesting-ci-cd/gitea-security/broken-reference/README.md) verduidelik, is dit soms nodig om die commits te onderteken, anders kan jy ontdek word.

Kyk plaaslik of die huidige gebruiker enige sleutels het met:

```shell
gpg --list-secret-keys --keyid-format=long
```

### Met Gebruikerstoken

Vir 'n inleiding oor [**Gebruikerstokens, sien die basiese inligting**](basic-gitea-information.md#personal-access-tokens).

'n Gebruikerstoken kan gebruik word **in plaas van 'n wagwoord** om teen die Gitea-bediener te **verifieer** [**via API**](https://try.gitea.io/api/swagger#/). Dit sal **volledige toegang** tot die gebruiker gee.

### Met Oauth-aansoek

Vir 'n inleiding oor [**Gitea Oauth-aansoeke, sien die basiese inligting**](./#with-oauth-application).

'n Aanvaller kan 'n **boosaardige Oauth-aansoek** skep om toegang te verkry tot bevoorregte data/aksies van gebruikers wat hulle waarskynlik aanvaar as deel van 'n phising-veldtog.

Soos in die basiese inligting verduidelik, sal die aansoek **volledige toegang tot die gebruikersrekening** h√™.

### Takbeskerming omseil

In Github het ons **github-aksies** wat standaard 'n **token met skryftoegang** oor die repo kry wat gebruik kan word om **takbeskerming te omseil**. In hierdie geval bestaan dit egter nie, so die omseilings is beperk. Maar laat ons kyk na wat gedoen kan word:

* **Skryftoegang aktiveer**: As enige iemand met skryftoegang na die tak kan druk, druk dit net.
* **Witlys beperkte druk**: Op dieselfde manier, as jy deel is van hierdie lys, druk na die tak.
* **Goedkeuringswitlys aktiveer**: As daar 'n goedkeuringswitlys is, moet jy binne-in wees.
* **Vereis goedkeurings is groter as 0**: Dan... moet jy 'n ander gebruiker kompromitteer.
* **Beperk goedkeurings tot witlys**: As slegs gebruikers op die witlys kan goedkeur... moet jy 'n ander gebruiker kompromitteer wat op daardie lys is.
* **Verouderde goedkeurings verwerp**: As goedkeurings nie met nuwe commits verwyder word nie, kan jy 'n reeds goedgekeurde PR kaap om jou kode in te spuit en die PR saam te voeg.

Merk op dat **as jy 'n organisasie/repo-admin** is, jy die beskermings kan omseil.

### Enumereer Webhooks

**Webhooks** kan spesifieke Gitea-inligting na sekere plekke stuur. Jy kan dalk daardie kommunikasie **uitbuit**.\
Gewoonlik word 'n **geheim** wat jy nie kan terugkry nie, in die **webhook** ingestel om te voorkom dat eksterne gebruikers wat die URL van die webhook ken, maar nie die geheim nie, die webhook **uitbuit nie**.\
Maar in sommige gevalle stel mense dit in plaas daarvan in die **URL** as 'n parameter in, sodat **deur die URLs te ondersoek** jy geheime en ander plekke wat jy verder kan uitbuit, kan vind.

Webhooks kan op **repo- en organisasievlak** ingestel word.

## Post Exploitation

### Binne-in die bediener

As jy op een of ander manier binne-in die bediener waar Gitea loop, kon kom, moet jy soek na die Gitea-konfigurasie-l√™er. Standaard is dit gele√´ in `/data/gitea/conf/app.ini`

In hierdie l√™er kan jy **sleutels** en **wagwoorde** vind.

In die Gitea-pad (standaard: /data/gitea) kan jy ook interessante inligting vind soos:

* Die **sqlite**-databasis: As Gitea nie 'n eksterne databasis gebruik nie, sal dit 'n sqlite-databasis gebruik.
* Die **sessies** binne die sessies-vouer: Deur `cat sessions/*/*/*` uit te voer, kan jy die gebruikersname van die aangemelde gebruikers sien (Gitea kan ook die sessies binne die databasis stoor).
* Die **jwt privaat sleutel** binne die jwt-vouer.
* Meer **sensitiewe inligting** kan in hierdie vouer gevind word.

As jy binne-in die bediener is, kan jy ook die `gitea`-bin√™re l√™er gebruik om toegang tot/inligting te verkry/wysig:

* `gitea dump` sal Gitea dump en 'n .zip-l√™er genereer.
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` sal 'n token van die aangeduide tipe genereer (volharding).
* `gitea admin user change-password --username admin --password newpassword` Verander die wagwoord.
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Skep 'n nuwe admin-gebruiker en kry 'n toegangstoken.

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks in PDF aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks-uitrusting**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
