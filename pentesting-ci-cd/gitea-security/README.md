# Gitea Sicherheit

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories einreichen.

</details>

## Was ist Gitea

**Gitea** ist eine **selbstgehostete, von der Community verwaltete, leichte Code-Hosting**-L√∂sung, die in Go geschrieben ist.

![](<../../.gitbook/assets/image (5) (1) (1) (1) (1) (1).png>)

### Grundlegende Informationen

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Labor

Um eine Gitea-Instanz lokal auszuf√ºhren, k√∂nnen Sie einfach einen Docker-Container ausf√ºhren:
```bash
docker run -p 3000:3000 gitea/gitea
```
Verbinde dich mit Port 3000, um auf die Webseite zuzugreifen.

Du k√∂nntest es auch mit Kubernetes ausf√ºhren:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Nicht authentifizierte Enumeration

* √ñffentliche Repositories: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Registrierte Benutzer: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Registrierte Organisationen: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Beachten Sie, dass **standardm√§√üig Gitea neuen Benutzern erlaubt, sich zu registrieren**. Dies gibt neuen Benutzern zwar keinen besonders interessanten Zugriff auf Repositories anderer Organisationen/Benutzer, aber ein **angemeldeter Benutzer** k√∂nnte m√∂glicherweise **mehr Repositories oder Organisationen visualisieren**.

## Interne Ausnutzung

F√ºr dieses Szenario gehen wir davon aus, dass Sie Zugriff auf ein Github-Konto erhalten haben.

### Mit Benutzeranmeldeinformationen/Web-Cookie

Wenn Sie auf irgendeine Weise bereits Anmeldeinformationen f√ºr einen Benutzer innerhalb einer Organisation haben (oder Sie haben ein Sitzungscookie gestohlen), k√∂nnen Sie sich **einfach anmelden** und √ºberpr√ºfen, welche **Berechtigungen Sie √ºber welche Repositories haben**, in **welchen Teams** Sie sind, **andere Benutzer auflisten** und **wie die Repositories gesch√ºtzt sind**.

Beachten Sie, dass **2FA verwendet werden kann**, sodass Sie nur auf diese Informationen zugreifen k√∂nnen, wenn Sie auch **diese √úberpr√ºfung bestehen**.

{% hint style="info" %}
Beachten Sie, dass wenn es Ihnen gelingt, das `i_like_gitea`-Cookie zu stehlen (derzeit konfiguriert mit SameSite: Lax), k√∂nnen Sie **den Benutzer vollst√§ndig imitieren**, ohne Anmeldeinformationen oder 2FA zu ben√∂tigen.
{% endhint %}

### Mit Benutzer-SSH-Schl√ºssel

Gitea erlaubt **Benutzern**, SSH-Schl√ºssel festzulegen, die als **Authentifizierungsmethode zum Bereitstellen von Code** in ihrem Namen verwendet werden (kein 2FA wird angewendet).

Mit diesem Schl√ºssel k√∂nnen Sie **√Ñnderungen in Repositories vornehmen, in denen der Benutzer einige Berechtigungen hat**, jedoch k√∂nnen Sie ihn nicht verwenden, um auf die Gitea-API zuzugreifen und die Umgebung aufzulisten. Sie k√∂nnen jedoch **lokale Einstellungen auflisten**, um Informationen √ºber die Repositories und Benutzer zu erhalten, auf die Sie Zugriff haben:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Wenn der Benutzer seinen Benutzernamen als seinen Gitea-Benutzernamen konfiguriert hat, k√∂nnen Sie auf die **√∂ffentlichen Schl√ºssel zugreifen**, die er in seinem Konto unter _https://github.com/\<gitea\_username>.keys_ festgelegt hat. Sie k√∂nnten dies √ºberpr√ºfen, um zu best√§tigen, dass der gefundene private Schl√ºssel verwendet werden kann.

**SSH-Schl√ºssel** k√∂nnen auch in Repositories als **Deploy-Schl√ºssel** festgelegt werden. Jeder, der Zugriff auf diesen Schl√ºssel hat, kann **Projekte aus einem Repository starten**. Normalerweise wird auf einem Server mit verschiedenen Deploy-Schl√ºsseln die lokale Datei **`~/.ssh/config`** Ihnen Informationen dar√ºber geben, welcher Schl√ºssel damit verbunden ist.

#### GPG-Schl√ºssel

Wie [**hier**](broken-reference/) erkl√§rt, ist es manchmal erforderlich, die Commits zu signieren, oder Sie k√∂nnten entdeckt werden.

√úberpr√ºfen Sie lokal, ob der aktuelle Benutzer einen Schl√ºssel hat mit:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Mit Benutzertoken

F√ºr eine Einf√ºhrung zu [**Benutzertoken √ºberpr√ºfen Sie die grundlegenden Informationen**](basic-gitea-information.md#personal-access-tokens).

Ein Benutzertoken kann **anstelle eines Passworts** verwendet werden, um sich gegen den Gitea-Server [**√ºber die API**](https://try.gitea.io/api/swagger#/) zu **authentifizieren**. Es hat **vollen Zugriff** auf den Benutzer.

### Mit Oauth-Anwendung

F√ºr eine Einf√ºhrung zu [**Gitea Oauth-Anwendungen √ºberpr√ºfen Sie die grundlegenden Informationen**](./#with-oauth-application).

Ein Angreifer k√∂nnte eine **b√∂sartige Oauth-Anwendung** erstellen, um auf privilegierte Daten/Aktionen der Benutzer zuzugreifen, die sie wahrscheinlich im Rahmen einer Phishing-Kampagne akzeptieren.

Wie in den grundlegenden Informationen erkl√§rt, wird die Anwendung **vollen Zugriff auf das Benutzerkonto** haben.

### Umgehung des Branch-Schutzes

Bei Github haben wir **Github-Aktionen**, die standardm√§√üig ein **Token mit Schreibzugriff** auf das Repository erhalten, das verwendet werden kann, um **Branch-Schutzma√ünahmen zu umgehen**. In diesem Fall existiert das nicht, daher sind die Umgehungen begrenzter. Aber schauen wir uns an, was getan werden kann:

- **Push aktivieren**: Wenn jeder mit Schreibzugriff auf den Branch pushen kann, einfach pushen.
- **Whitelist f√ºr eingeschr√§nktes Pushen**: Auf die gleiche Weise, wenn Sie Teil dieser Liste sind, pushen Sie auf den Branch.
- **Merge-Whitelist aktivieren**: Wenn es eine Merge-Whitelist gibt, m√ºssen Sie darin sein.
- **Erforderliche Genehmigungen sind gr√∂√üer als 0**: Dann... m√ºssen Sie einen anderen Benutzer kompromittieren.
- **Genehmigungen auf Whitelist beschr√§nken**: Wenn nur Benutzer auf der Whitelist genehmigen k√∂nnen... m√ºssen Sie einen anderen Benutzer kompromittieren, der in dieser Liste steht.
- **Veraltete Genehmigungen ablehnen**: Wenn Genehmigungen nicht mit neuen Commits entfernt werden, k√∂nnten Sie einen bereits genehmigten PR √ºbernehmen, um Ihren Code einzuf√ºgen und den PR zu mergen.

Beachten Sie, dass **wenn Sie ein Org/Repo-Admin sind**, Sie die Schutzma√ünahmen umgehen k√∂nnen.

### Webhooks auflisten

**Webhooks** k√∂nnen **spezifische Gitea-Informationen an bestimmte Orte senden**. M√∂glicherweise k√∂nnen Sie **diese Kommunikation ausnutzen**.\
Normalerweise wird ein **Geheimnis**, das Sie **nicht abrufen k√∂nnen**, im **Webhook** festgelegt, um externe Benutzer daran zu hindern, den Webhook auszunutzen, die die URL des Webhooks kennen, aber nicht das Geheimnis.\
In einigen F√§llen setzen Personen anstelle des **Geheimnisses** an seinem Platz es **in der URL** als Parameter, sodass das **√úberpr√ºfen der URLs** Ihnen erm√∂glichen k√∂nnte, **Geheimnisse** und andere Orte zu finden, die Sie weiter ausnutzen k√∂nnten.

Webhooks k√∂nnen auf **Repo- und Org-Ebene** festgelegt werden.

## Post-Exploitation

### Innerhalb des Servers

Wenn es Ihnen irgendwie gelungen ist, in den Server zu gelangen, auf dem Gitea l√§uft, sollten Sie nach der Gitea-Konfigurationsdatei suchen. Standardm√§√üig befindet sie sich in `/data/gitea/conf/app.ini`

In dieser Datei finden Sie **Schl√ºssel** und **Passw√∂rter**.

Im Gitea-Pfad (standardm√§√üig: /data/gitea) k√∂nnen Sie auch interessante Informationen finden wie:

- Die **sqlite**-Datenbank: Wenn Gitea keine externe Datenbank verwendet, wird eine sqlite-Datenbank verwendet.
- Die **Sitzungen** im Sitzungsordner: Durch Ausf√ºhren von `cat sessions/*/*/*` k√∂nnen Sie die Benutzernamen der angemeldeten Benutzer sehen (Gitea k√∂nnte die Sitzungen auch in der Datenbank speichern).
- Der **JWT-Privatschl√ºssel** im jwt-Ordner
- Weitere **sensible Informationen** k√∂nnten in diesem Ordner gefunden werden.

Wenn Sie sich im Server befinden, k√∂nnen Sie auch das `gitea`-Bin√§rdatei verwenden, um auf Informationen zuzugreifen/Informationen zu √§ndern:

- `gitea dump` wird Gitea dumpen und eine .zip-Datei generieren
- `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` wird ein Token des angegebenen Typs generieren (Persistenz)
- `gitea admin user change-password --username admin --password newpassword` Passwort √§ndern
- `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Neuen Admin-Benutzer erstellen und ein Zugriffstoken erhalten
