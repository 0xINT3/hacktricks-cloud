# Gitea Security

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Czym jest Gitea

**Gitea** to **samodzielnie hostowane, zarządzane przez społeczność, lekkie rozwiązanie do hostowania kodu** napisane w Go.

![](<../../.gitbook/assets/image (5) (1) (1) (1) (1) (1).png>)

### Podstawowe informacje

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Laboratorium

Aby uruchomić lokalną instancję Gitea, wystarczy uruchomić kontener dockera:

```bash
docker run -p 3000:3000 gitea/gitea
```

Podłącz się do portu 3000, aby uzyskać dostęp do strony internetowej.

Możesz również uruchomić to przy użyciu kubernetes:

```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```

## Nieuwierzytelnione wyliczanie

* Publiczne repozytoria: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Zarejestrowani użytkownicy: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Zarejestrowane organizacje: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Należy zauważyć, że domyślnie Gitea pozwala nowym użytkownikom na rejestrację. To nie daje nowym użytkownikom specjalnie interesującego dostępu do repozytoriów innych organizacji/użytkowników, ale zalogowany użytkownik może mieć możliwość zobaczenia większej liczby repozytoriów lub organizacji.

## Wewnętrzne wykorzystanie

W tym scenariuszu załóżmy, że uzyskałeś dostęp do konta na GitHubie.

### Z poświadczeniami użytkownika/Ciasteczkiem sieciowym

Jeśli w jakiś sposób masz już poświadczenia dla użytkownika wewnątrz organizacji (lub ukradłeś ciasteczko sesji), możesz po prostu się zalogować i sprawdzić, jakie uprawnienia masz wobec repozytoriów, w jakich zespołach się znajdujesz, wyświetlić innych użytkowników i jak są chronione repozytoria.

Należy zauważyć, że może być używane uwierzytelnianie dwuskładnikowe, więc będziesz mógł uzyskać dostęp do tych informacji tylko wtedy, gdy będziesz w stanie przejść tę weryfikację.

{% hint style="info" %}
Należy zauważyć, że jeśli uda ci się ukraść ciasteczko `i_like_gitea` (obecnie skonfigurowane z atrybutem SameSite: Lax), możesz całkowicie podszywać się pod użytkownika bez potrzeby posiadania poświadczeń ani uwierzytelniania dwuskładnikowego.
{% endhint %}

### Z kluczem SSH użytkownika

Gitea pozwala użytkownikom na ustawienie kluczy SSH, które będą używane jako metoda uwierzytelniania do wdrażania kodu w ich imieniu (nie jest stosowane uwierzytelnianie dwuskładnikowe).

Z tym kluczem możesz dokonywać zmian w repozytoriach, w których użytkownik ma pewne uprawnienia, jednak nie możesz go użyć do uzyskania dostępu do interfejsu API Gitea w celu wyliczenia środowiska. Możesz jednak wyliczyć lokalne ustawienia, aby uzyskać informacje o repozytoriach i użytkownikach, do których masz dostęp.

```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```

Jeśli użytkownik skonfigurował swoją nazwę użytkownika jako swoją nazwę użytkownika gitea, można uzyskać dostęp do **kluczy publicznych**, które ustawił w swoim koncie na stronie _https://github.com/\<gitea\_username>.keys_. Można to sprawdzić, aby potwierdzić, czy znaleziony klucz prywatny może być używany.

**Klucze SSH** mogą również być ustawiane w repozytoriach jako **klucze do wdrożeń**. Każda osoba mająca dostęp do tego klucza będzie mogła **uruchamiać projekty z repozytorium**. Zazwyczaj na serwerze z różnymi kluczami do wdrożeń plik lokalny **`~/.ssh/config`** dostarczy informacji o powiązanym kluczu.

#### Klucze GPG

Jak wyjaśniono [**tutaj**](https://github.com/carlospolop/hacktricks-cloud/blob/pl/pentesting-ci-cd/gitea-security/broken-reference/README.md), czasami konieczne jest podpisywanie commitów, aby uniknąć wykrycia.

Lokalnie sprawdź, czy bieżący użytkownik ma jakikolwiek klucz za pomocą polecenia:

```shell
gpg --list-secret-keys --keyid-format=long
```

### Za pomocą Tokena Użytkownika

Aby uzyskać wprowadzenie do [**Tokenów Użytkownika, sprawdź podstawowe informacje**](basic-gitea-information.md#personal-access-tokens).

Token użytkownika może być używany **zamiast hasła** do **uwierzytelnienia** na serwerze Gitea [**poprzez API**](https://try.gitea.io/api/swagger#/). Będzie on miał **pełny dostęp** do konta użytkownika.

### Za pomocą Aplikacji Oauth

Aby uzyskać wprowadzenie do [**Aplikacji Oauth Gitea, sprawdź podstawowe informacje**](./#with-oauth-application).

Atakujący może stworzyć **złośliwą aplikację Oauth**, aby uzyskać dostęp do poufnych danych/akcji użytkowników, którzy najprawdopodobniej zaakceptują je jako część kampanii phishingowej.

Jak wyjaśniono w podstawowych informacjach, aplikacja będzie miała **pełny dostęp do konta użytkownika**.

### Ominięcie Ochrony Gałęzi

W Githubie mamy **działania githuba**, które domyślnie otrzymują **token z uprawnieniami do zapisu** na repozytorium, który może być używany do **ominięcia ochrony gałęzi**. W tym przypadku **nie istnieje**, więc ominięcia są bardziej ograniczone. Ale zobaczmy, co można zrobić:

* **Włączanie Push**: Jeśli ktokolwiek z uprawnieniami do zapisu może wykonać push do gałęzi, wystarczy go wykonać.
* **Whitelist Restricted Push**: W ten sam sposób, jeśli jesteś częścią tej listy, wykonaj push do gałęzi.
* **Włączanie Whitelisty Scalania**: Jeśli istnieje whitelist scalania, musisz być w nim.
* **Wymagane zatwierdzenia większe niż 0**: W takim przypadku... musisz skompromitować innego użytkownika.
* **Ograniczanie zatwierdzeń do użytkowników na liście whitelist**: Jeśli tylko użytkownicy z listy whitelist mogą zatwierdzać... musisz skompromitować innego użytkownika, który jest na tej liście.
* **Odrzucanie przestarzałych zatwierdzeń**: Jeśli zatwierdzenia nie są usuwane przy nowych commitach, możesz przejąć już zatwierdzone PR, aby wstrzyknąć swój kod i scalić PR.

Zauważ, że **jeśli jesteś administratorem org/repo**, możesz ominąć zabezpieczenia.

### Wyliczanie Webhooków

**Webhooki** są w stanie **wysyłać określone informacje z Gitea w różne miejsca**. Możesz być w stanie **wykorzystać tę komunikację**.\
Jednak zazwyczaj jest ustawiony **sekret**, którego **nie można odzyskać**, w **webhooku**, co **uniemożliwia** zewnętrznym użytkownikom, którzy znają URL webhooku, ale nie znają sekretu, **wykorzystanie tego webhooku**.\
Ale w niektórych przypadkach, zamiast ustawienia **sekretu** na swoim miejscu, ustawiają go w URL jako parametr, więc **sprawdzanie URL** może pozwolić Ci **odnaleźć sekrety** i inne miejsca, które można dalej wykorzystać.

Webhooki mogą być ustawione na **poziomie repozytorium i organizacji**.

## Po Wykorzystaniu

### Wewnątrz serwera

Jeśli udało Ci się jakoś dostać do serwera, na którym działa Gitea, powinieneś poszukać pliku konfiguracyjnego Gitea. Domyślnie znajduje się on w `/data/gitea/conf/app.ini`

W tym pliku można znaleźć **klucze** i **hasła**.

W ścieżce Gitea (domyślnie: /data/gitea) można również znaleźć interesujące informacje, takie jak:

* Baza danych **sqlite**: Jeśli Gitea nie korzysta z zewnętrznej bazy danych, używa bazy danych sqlite.
* **Sesje** w folderze sesji: Uruchomienie polecenia `cat sessions/*/*/*` pozwoli zobaczyć nazwy użytkowników zalogowanych (Gitea może również zapisywać sesje w bazie danych).
* **Prywatny klucz JWT** w folderze jwt
* W tym folderze można znaleźć więcej **wrażliwych informacji**

Jeśli jesteś wewnątrz serwera, możesz również **użyć binarnego pliku `gitea`** do dostępu/modyfikacji informacji:

* `gitea dump` spowoduje zrzut Gitea i wygeneruje plik .zip
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` wygeneruje token o wskazanym typie (trwałość)
* `gitea admin user change-password --username admin --password newpassword` Zmień hasło
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Utwórz nowego użytkownika administratora i otrzymaj token dostępu

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCYJNY**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
