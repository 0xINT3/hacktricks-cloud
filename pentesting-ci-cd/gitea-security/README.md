# Seguridad de Gitea

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## ¿Qué es Gitea?

**Gitea** es una solución de alojamiento de código **ligera, administrada por la comunidad y autohospedada** escrita en Go.

![](<../../.gitbook/assets/image (5) (1) (1) (1).png>)

### Información básica

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Laboratorio

Para ejecutar una instancia de Gitea localmente, simplemente puede ejecutar un contenedor de docker:

```bash
docker run -p 3000:3000 gitea/gitea
```

Conéctese al puerto 3000 para acceder a la página web.

También puede ejecutarlo con kubernetes:

```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```

## Enumeración sin autenticación

* Repositorios públicos: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Usuarios registrados: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Organizaciones registradas: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Tenga en cuenta que por **defecto, Gitea permite que los nuevos usuarios se registren**. Esto no dará acceso especialmente interesante a los nuevos usuarios sobre otros repositorios de organizaciones / usuarios, pero un **usuario conectado** podría ser capaz de **visualizar más repositorios u organizaciones**.

## Explotación interna

Para este escenario, vamos a suponer que ha obtenido algún acceso a una cuenta de Github.

### Con credenciales de usuario / cookie web

Si de alguna manera ya tiene credenciales para un usuario dentro de una organización (o robó una cookie de sesión), puede **iniciar sesión** y verificar qué **permisos tiene** sobre qué **repositorios**, en **qué equipos** está, **listar otros usuarios** y **cómo están protegidos los repositorios**.

Tenga en cuenta que **se puede usar la autenticación de dos factores (2FA)**, por lo que solo podrá acceder a esta información si también puede **pasar esa verificación**.

{% hint style="info" %}
Tenga en cuenta que si **logra robar la cookie `i_like_gitea`** (actualmente configurada con SameSite: Lax), puede **suplantar completamente al usuario** sin necesidad de credenciales o 2FA.
{% endhint %}

### Con clave SSH de usuario

Gitea permite que los **usuarios** establezcan **claves SSH** que se utilizarán como **método de autenticación para implementar código** en su nombre (no se aplica 2FA).

Con esta clave, puede realizar **cambios en los repositorios donde el usuario tiene algunos privilegios**, sin embargo, no puede usarla para acceder a la API de gitea para enumerar el entorno. Sin embargo, puede **enumerar la configuración local** para obtener información sobre los repositorios y el usuario al que tiene acceso:

```bash
# Ir a la carpeta del repositorio
# Obtener la configuración del repositorio y el nombre de usuario y correo electrónico actual
git config --list
```

Si el usuario ha configurado su nombre de usuario como su nombre de usuario de gitea, puede acceder a las **claves públicas que ha establecido** en su cuenta en _https://github.com/\<gitea\_username>.keys_, podría verificar esto para confirmar que la clave privada que encontró se puede usar.

Las **claves SSH** también se pueden establecer en los repositorios como **claves de implementación**. Cualquier persona con acceso a esta clave podrá **lanzar proyectos desde un repositorio**. Por lo general, en un servidor con diferentes claves de implementación, el archivo local **`~/.ssh/config`** le dará información sobre la clave relacionada.

#### Claves GPG

Como se explica [**aquí**](broken-reference/), a veces es necesario firmar los commits o puede ser descubierto.

Verifique localmente si el usuario actual tiene alguna clave con:

```shell
gpg --list-secret-keys --keyid-format=long
```

### Con token de usuario

Para una introducción sobre [**Tokens de usuario, consulte la información básica**](basic-gitea-information.md#personal-access-tokens).

Se puede usar un token de usuario **en lugar de una contraseña** para **autenticarse** contra el servidor Gitea [**a través de la API**](https://try.gitea.io/api/swagger#/). tendrá **acceso completo** sobre el usuario.

### Con aplicación Oauth

Para una introducción sobre [**Aplicaciones Oauth de Gitea, consulte la información básica**](./#with-oauth-application).

Un atacante podría crear una **aplicación Oauth maliciosa** para acceder a datos / acciones privilegiados de los usuarios que los acepten probablemente como parte de una campaña de phishing.

Como se explica en la información básica, la aplicación tendrá **acceso completo a la cuenta de usuario**.

### Bypass de protección de rama

En Github tenemos **acciones de Github** que por defecto obtienen un **token con acceso de escritura** sobre el repositorio que se puede usar para **bypass de protecciones de rama**. En este caso, eso **no existe**, por lo que los bypasses son más limitados. Pero echemos un vistazo a lo que se puede hacer:

* **Habilitar Push**: Si alguien con acceso de escritura puede hacer push a la rama, simplemente haga push a ella.
* **Lista blanca de empuje restringida**: De la misma manera, si eres parte de esta lista, haz push a la rama.
* **Habilitar lista blanca de combinación**: Si hay una lista blanca de combin