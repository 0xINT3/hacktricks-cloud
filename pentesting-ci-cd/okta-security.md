# Oktaセキュリティ

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝**したい場合や、**最新バージョンのPEASSを入手**したい場合、またはHackTricksをPDFでダウンロードしたい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するために、PRを提出して** [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリに参加する

</details>

## 基本情報

Okta, Inc.は、クラウドソフトウェアを提供して企業が現代のアプリケーションにユーザー認証を管理し、セキュリティを確保するのを支援する**アイデンティティとアクセス管理会社**です。また、開発者がアプリケーション、ウェブサービス、およびデバイスにアイデンティティコントロールを構築するのを支援します。

彼らのコアサービスであるOkta Identity Cloudは、シングルサインオン（SSO）、マルチファクタ認証（MFA）、ライフサイクル管理、ユニバーサルディレクトリ、APIアクセス管理などの製品を提供しています。これにより、企業は機密データを保護し、ユーザーアクセスを効率化することができます。これにより、従業員や顧客がアプリケーションやサービスによりアクセスしやすくなります。

Oktaのサービスは、大企業だけでなく、中小企業や開発者にも広く利用されています。それは企業がクラウドテクノロジーを安全に採用し、管理するために重要な役割を果たしています。私の知識の範囲では、2021年9月までにOktaはアイデンティティとアクセス管理（IAM）業界で重要なプレーヤーであるとされています。

{% hint style="danger" %}
Oktaの主な目標は、異なるユーザーやグループに対して外部アプリケーションへのアクセスを構成することです。もしOktaの管理者特権を侵害できれば、おそらく会社が使用している他のすべてのプラットフォームを侵害することができます。
{% endhint %}

{% hint style="success" %}
Okta環境のセキュリティレビューを実施するには、**管理者の読み取り専用アクセス**を要求する必要があります。
{% endhint %}

### 概要

**ユーザー**（Oktaに保存される、構成された**アイデンティティプロバイダ**からのログイン、または**Active Directory**またはLDAPを介して認証されることができる）があります。\
これらのユーザーは**グループ**内に存在することができます。\
また、**認証子**もあります：パスワードなどの認証方法や、WebAuthn、メール、電話、okta verifyなどのさまざまな2要素認証（有効または無効にできます）...

次に、Oktaと同期された**アプリケーション**があります。各アプリケーションはOktaとの**マッピング**を持ち、情報（電子メールアドレス、名前など）を共有します。さらに、各アプリケーションは**認証ポリシー**内にある必要な**認証子**を示します。これにより、ユーザーがアプリケーションにアクセスするために必要な認証子が指定されます。

{% hint style="danger" %}
最も強力な役割は**スーパー管理者**です。

攻撃者が管理者アクセスでOktaを侵害すると、Oktaを信頼している**すべてのアプリケーションが高い確率で侵害されます**。

各ユーザーが持つことができる属性（電子メールや名前など）を構成することができます。ユーザーが**変更できる属性**（ユーザーが**変更できる属性**としてIDが信頼されているアプリケーションがある場合、そのプラットフォームで他のユーザーになりすますことができます）。
{% endhint %}

## ディレクトリ

### 人々

攻撃者の視点からは、**登録されたすべてのユーザー**、**メール**アドレス、所属する**グループ**、**プロファイル**、さらには**デバイス**（モバイルとそれらのOS）を見ることができます。

ホワイトボックスレビューでは、「**保留中のユーザーアクション**」や「**パスワードリセット**」が複数あるかどうかを確認してください。

### グループ

ここには、Oktaで作成されたすべてのグループが表示されます。ユーザーに付与されることができる**権限のセット**である異なるグループを理解することが興味深いです。\
**グループに含まれる人々**と各グループに**割り当てられたアプリケーション**を見ることができます。

もちろん、**admin**という名前のグループは興味深いですが、特に**Global Administrators**グループは、特権を持つメンバーを知るためにメンバーをチェックしてください。

ホワイトボックスレビューでは、**5人以上のグローバル管理者は存在しないはず**です（2人または3人だけの方が良いです）。

### デバイス

すべてのユーザーのデバイスのリストがここに表示されます。アクティブに管理されているかどうかも確認できます。

### プロファイルエディター

ここでは、名前、姓、メール、ユーザー名などの重要な情報がOktaと他のアプリケーション間で共有されている方法を確認できます。これは興味深いです、なぜなら、ユーザーがOktaでフィールド（名前やメールなど）を**変更**できる場合、それが**外部アプリケーション**でユーザーを**識別**するために使用される場合、内部者が他のアカウントを**乗っ取ろうとする**可能性があるからです。

また、Oktaのプロファイル**`User (default)`**では、各**ユーザー**が持つ**フィールド**とユーザーが**書き込み可能**なフィールドが表示されます。管理パネルが表示されない場合は、**プロファイル情報を更新**して、更新できるフィールドを確認できます（メールアドレスを更新するには、確認が必要です）。

### ディレクトリ統合

ディレクトリを使用すると、既存のソースから人々をインポートできます。おそらくここでは、他のディレクトリからインポートされたユーザーを見ることができます。

私は見たことはあり
## カスタマイズ

### ブランド

このセクションの**ドメイン**タブで、メールを送信するために使用されるメールアドレスと、会社のOkta内のカスタムドメイン（おそらく既に知っているでしょう）を確認してください。

さらに、**設定**タブでは、管理者であれば「**カスタムサインアウトページを使用する**」ことができ、カスタムURLを設定することができます。

### SMS

ここには興味深いものはありません。

### エンドユーザーダッシュボード

ここには、設定されたアプリケーションが表示されますが、後で別のセクションで詳細を見ていきます。

### その他

興味深い設定ですが、セキュリティの観点からは特に興味深いものはありません。

## アプリケーション

### アプリケーション

ここでは、**設定されたアプリケーション**とその詳細を見つけることができます。誰がアクセス権を持っているか、どのように構成されているか（SAML、OPenID）、ログインするためのURL、Oktaとアプリケーション間のマッピングなどです。

**`サインオン`**タブには、アプリケーションの設定を確認するための**`パスワードの表示`**というフィールドもあります。ユーザーパネルからアプリケーションの設定を確認するには、3つのドットをクリックします。

<figure><img src="../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

そして、アプリに関する詳細（パスワードの表示機能が有効かどうかなど）をさらに確認できます。

<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### アクセス認証

アクセス認証を使用して、ユーザーのリソースへのアクセスを定期的にレビューし、必要に応じて自動的に承認または取り消す監査キャンペーンを作成できます。

まだ使用されていないようですが、防御の観点からは素晴らしい機能だと思います。

## セキュリティ

### 一般

* **セキュリティ通知メール**：すべてが有効になっているはずです。
* **CAPTCHAの統合**：少なくとも不可視のreCaptchaを設定することをお勧めします。
* **組織のセキュリティ**：すべてを有効にすることができ、アクティベーションメールの有効期間は長く続かないはずです（7日間は問題ありません）。
* **ユーザー列挙の防止**：両方を有効にする必要があります。
* ユーザー列挙の防止は、次の条件のいずれかが許可されている場合には効果がありません（詳細については、[ユーザー管理](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm)を参照してください）：
* セルフサービス登録
* メール認証を伴うJITフロー
* **Okta ThreatInsightの設定**：脅威レベルに基づいてセキュリティを記録および強制する

### HealthInsight

ここでは、正しく**危険な**設定を見つけることができます。

### 認証子

ここでは、ユーザーが使用できるすべての認証方法を見つけることができます：パスワード、電話、メール、コード、WebAuthn... パスワード認証子をクリックすると、**パスワードポリシー**を確認できます。それが強力であることを確認してください。

**登録**タブでは、必須またはオプションの認証方法を確認できます。

<figure><img src="../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

電話は無効にすることをお勧めします。最も強力なものはおそらくパスワード、メール、およびWebAuthnの組み合わせです。

### 認証ポリシー

各アプリには認証ポリシーがあります。認証ポリシーは、アプリにサインインしようとするユーザーが特定の条件を満たしているかどうかを検証し、それに基づいて要素の要件を強制します。

ここでは、**各アプリケーションへのアクセス要件**を見つけることができます。各アプリケーションに対して少なくともパスワードと別の方法を要求することをお勧めします。ただし、攻撃者としてはより弱いものを見つけることができるかもしれません。

### グローバルセッションポリシー

ここでは、さまざまなグループに割り当てられたセッションポリシーを見つけることができます。例えば：

<figure><img src="../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

MFAの要求、セッションの有効期間を数時間に制限すること、ブラウザ拡張機能間でセッションクッキーを永続化しないこと、および場所とIdentity Providerを制限すること（可能な場合）をお勧めします。たとえば、すべてのユーザーが特定の国からログインする必要がある場合、この場所のみを許可することができます。

### Identity Providers

Identity Providers（IdPs）は、ユーザーアカウントを**管理する**サービスです。OktaにIdPsを追加すると、エンドユーザーは最初にソーシャルアカウントまたはスマートカードで認証してカスタムアプリケーションに自己登録することができます。

Identity Providersページでは、ソーシャルログイン（IdPs）を追加し、受信SAMLを追加することでOktaをサービスプロバイダ（SP）として構成できます。IdPsを追加した後、ユーザーをIdPにリダイレクトするためのルーティングルールを設定することができます。ユーザーの場所、デバイス、またはメールドメインなどのコンテキストに基づいて。

**もしもどのIdentity Providerが設定されている**かを攻撃者と防御者の観点から確認し、その設定が**本当に信頼できるソース**であるかを確認してください。攻撃者がそれを侵害すると、Okta環境へのアクセスも可能になる可能性があります。

### 委任認証

委任認証により、ユーザーは組織の**Active Directory（AD）またはLDAP**サーバーの資格情報を入力することでOktaにサインインできます。

再度、これを再確認してください。組織のADを侵害すると、この設定によりOktaにピボットすることができる可能性があります。

### ネットワーク

ネットワークゾーンは、アクセスを要求している**IPアドレス**に基づいて、組織内のコンピュータやデバイスへのアクセスを許可または制限するために使用できる設定可能な境界です。個々のIPアドレス、IPアドレスの範囲、または地理的な場所を指定してネットワークゾーンを定義できます。

1つ以上のネットワークゾーンを定義した後、グローバルセッションポリシー、認証ポリシー、VPN通知、およびルーティングルールでそれらを使用することができます。

攻撃者の観点からは、許可されて
## ワークフロー

### 自動化

自動化を使用すると、エンドユーザーのライフサイクル中に発生する一連のトリガ条件に基づいて実行される自動アクションを作成できます。

たとえば、条件として「Oktaでのユーザーの非アクティブ化」や「Oktaでのユーザーパスワードの有効期限切れ」といったものがあり、アクションとして「ユーザーにメールを送信する」や「Oktaでのユーザーライフサイクルの状態を変更する」といったものがあります。

## レポート

### レポート

ログをダウンロードします。これらは現在のアカウントのメールアドレスに**送信**されます。

### システムログ

ここでは、OktaまたはOktaを介してアプリケーションにログインするなど、ユーザーによって実行されたアクションのログを詳細に確認できます。

### インポートモニタリング

これにより、Oktaでアクセスした他のプラットフォームからログを**インポート**できます。

### レート制限

APIのレート制限が達成されたかどうかを確認します。

## 設定

### アカウント

ここでは、Okta環境に関する**一般的な情報**（会社名、住所、**請求連絡先のメールアドレス**、**技術連絡先のメールアドレス**など）や、Oktaの更新を受け取るべき人物、Oktaの更新の種類などを見つけることができます。

### ダウンロード

ここでは、Oktaエージェントをダウンロードして、Oktaを他のテクノロジーと同期させることができます。

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もしもあなたの**会社をHackTricksで宣伝したい**場合や、**PEASSの最新バージョンにアクセスしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私をフォローしましょう 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するために、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
