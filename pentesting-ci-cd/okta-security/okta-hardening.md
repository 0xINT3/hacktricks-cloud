# Fortalecimiento de Okta

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Directorio

### Personas

Desde la perspectiva de un atacante, esto es super interesante ya que podr치s ver **todos los usuarios registrados**, sus direcciones de **correo electr칩nico**, los **grupos** a los que pertenecen, **perfiles** e incluso **dispositivos** (m칩viles junto con sus sistemas operativos).

En una revisi칩n de caja blanca, aseg칰rate de que no haya varios "**Acciones de usuario pendientes**" y "**Restablecimiento de contrase침a**".

### Grupos

Aqu칤 encontrar치s todos los grupos creados en Okta. Es interesante entender los diferentes grupos (conjunto de **permisos**) que podr칤an otorgarse a los **usuarios**.\
Es posible ver las **personas incluidas dentro de los grupos** y las **aplicaciones asignadas** a cada grupo.

Por supuesto, cualquier grupo con el nombre de **admin** es interesante, especialmente el grupo **Administradores Globales**; revisa los miembros para saber qui칠nes son los miembros m치s privilegiados.

Desde una revisi칩n de caja blanca, **no deber칤a haber m치s de 5 administradores globales** (mejor si solo hay 2 o 3).

### Dispositivos

Encuentra aqu칤 una **lista de todos los dispositivos** de todos los usuarios. Tambi칠n puedes ver si est치 siendo **gestionado activamente** o no.

### Editor de Perfiles

Aqu칤 es posible observar c칩mo informaci칩n clave como nombres, apellidos, correos electr칩nicos, nombres de usuario... se comparten entre Okta y otras aplicaciones. Esto es interesante porque si un usuario puede **modificar en Okta un campo** (como su nombre o correo electr칩nico) que luego es utilizado por una **aplicaci칩n externa** para **identificar** al usuario, un infiltrado podr칤a intentar **tomar control de otras cuentas**.

Adem치s, en el perfil **`Usuario (predeterminado)`** de Okta puedes ver **qu칠 campos** tiene cada **usuario** y cu치les son **editables** por los usuarios. Si no puedes ver el panel de administraci칩n, simplemente ve a **actualizar tu informaci칩n de perfil** y ver치s qu칠 campos puedes actualizar (ten en cuenta que para actualizar una direcci칩n de correo electr칩nico necesitar치s verificarla).

### Integraciones de Directorio

Los directorios te permiten importar personas de fuentes existentes. Supongo que aqu칤 ver치s los usuarios importados de otros directorios.

No lo he visto, pero supongo que esto es interesante para descubrir **otros directorios que Okta est치 usando para importar usuarios** as칤 que si **comprometes ese directorio** podr칤as establecer algunos valores de atributos en los usuarios creados en Okta y **quiz치s comprometer el entorno de Okta**.

### Fuentes de Perfil

Una fuente de perfil es una **aplicaci칩n que act칰a como fuente de verdad** para los atributos del perfil de usuario. Un usuario solo puede ser originado por una 칰nica aplicaci칩n o directorio a la vez.

No lo he visto, as칤 que cualquier informaci칩n sobre seguridad y hacking respecto a esta opci칩n es bienvenida.

## Personalizaciones

### Marcas

Revisa en la pesta침a **Dominios** de esta secci칩n las direcciones de correo electr칩nico utilizadas para enviar correos y el dominio personalizado dentro de Okta de la empresa (que probablemente ya conozcas).

Adem치s, en la pesta침a **Configuraci칩n**, si eres administrador, puedes "**Usar una p치gina de cierre de sesi칩n personalizada**" y establecer una URL personalizada.

### SMS

Nada interesante aqu칤.

### Panel de Usuario Final

Aqu칤 puedes encontrar aplicaciones configuradas, pero veremos los detalles de esas m치s adelante en una secci칩n diferente.

### Otros

Configuraci칩n interesante, pero nada super interesante desde un punto de vista de seguridad.

## Aplicaciones

### Aplicaciones

Aqu칤 puedes encontrar todas las **aplicaciones configuradas** y sus detalles: Qui칠n tiene acceso a ellas, c칩mo est치n configuradas (SAML, OPenID), URL para iniciar sesi칩n, las asignaciones entre Okta y la aplicaci칩n...

En la pesta침a **`Sign On`** tambi칠n hay un campo llamado **`Revelaci칩n de contrase침a`** que permitir칤a a un usuario **revelar su contrase침a** al revisar la configuraci칩n de la aplicaci칩n. Para revisar la configuraci칩n de una aplicaci칩n desde el Panel de Usuario, haz clic en los 3 puntos:

<figure><img src="../../.gitbook/assets/image (4) (7).png" alt=""><figcaption></figcaption></figure>

Y podr칤as ver algunos detalles m치s sobre la aplicaci칩n (como la funci칩n de revelaci칩n de contrase침a, si est치 habilitada):

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## Gobernanza de Identidad

### Certificaciones de Acceso

Utiliza Certificaciones de Acceso para crear campa침as de auditor칤a para revisar peri칩dicamente el acceso de tus usuarios a los recursos y aprobar o revocar el acceso autom치ticamente cuando sea necesario.

No lo he visto utilizado, pero supongo que desde un punto de vista defensivo es una buena caracter칤stica.

## Seguridad

### General

* **Correos electr칩nicos de notificaci칩n de seguridad**: Todos deben estar habilitados.
* **Integraci칩n CAPTCHA**: Se recomienda configurar al menos el reCaptcha invisible
* **Seguridad de la Organizaci칩n**: Todo puede estar habilitado y los correos electr칩nicos de activaci칩n no deben durar mucho (7 d칤as est치 bien)
* **Prevenci칩n de enumeraci칩n de usuarios**: Ambos deben estar habilitados
* Ten en cuenta que la Prevenci칩n de Enumeraci칩n de Usuarios no tiene efecto si se permiten alguna de las siguientes condiciones (Consulta [Gesti칩n de usuarios](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) para m치s informaci칩n):
* Registro de Autoservicio
* Flujos JIT con autenticaci칩n por correo electr칩nico
* **Configuraciones de Okta ThreatInsight**: Registrar y hacer cumplir la seguridad basada en el nivel de amenaza
### HealthInsight

Aqu칤 es posible encontrar configuraciones **peligrosas** y correctamente configuradas.

### Autenticadores

Aqu칤 puedes encontrar todos los m칠todos de autenticaci칩n que un usuario podr칤a usar: Contrase침a, tel칠fono, correo electr칩nico, c칩digo, WebAuthn... Al hacer clic en el autenticador de Contrase침a puedes ver la **pol칤tica de contrase침as**. Comprueba que sea fuerte.

En la pesta침a de **Inscripci칩n** puedes ver cu치les son obligatorios u opcionales:

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

Es recomendable desactivar Tel칠fono. Los m치s fuertes probablemente sean una combinaci칩n de contrase침a, correo electr칩nico y WebAuthn.

### Pol칤ticas de Autenticaci칩n

Cada aplicaci칩n tiene una pol칤tica de autenticaci칩n. La pol칤tica de autenticaci칩n verifica que los usuarios que intentan iniciar sesi칩n en la aplicaci칩n cumplan con condiciones espec칤ficas, y hace cumplir los requisitos de factores basados en esas condiciones.

Aqu칤 puedes encontrar los **requisitos para acceder a cada aplicaci칩n**. Se recomienda solicitar al menos una contrase침a y otro m칠todo para cada aplicaci칩n. Pero si como atacante encuentras algo m치s d칠bil, podr칤as atacarlo.

### Pol칤tica Global de Sesi칩n

Aqu칤 puedes encontrar las pol칤ticas de sesi칩n asignadas a diferentes grupos. Por ejemplo:

<figure><img src="../../.gitbook/assets/image (2) (1) (2).png" alt=""><figcaption></figcaption></figure>

Se recomienda solicitar MFA, limitar la duraci칩n de la sesi칩n a algunas horas, no persistir las cookies de sesi칩n a trav칠s de extensiones de navegador y limitar la ubicaci칩n y el Proveedor de Identidad (si esto es posible). Por ejemplo, si cada usuario debe iniciar sesi칩n desde un pa칤s, podr칤as permitir solo esta ubicaci칩n.

### Proveedores de Identidad

Los Proveedores de Identidad (IdPs) son servicios que **gestionan cuentas de usuario**. Agregar IdPs en Okta permite a tus usuarios finales **autoregistrarse** en tus aplicaciones personalizadas autentic치ndose primero con una cuenta social o una tarjeta inteligente.

En la p치gina de Proveedores de Identidad, puedes agregar inicios de sesi칩n sociales (IdPs) y configurar Okta como un proveedor de servicios (SP) agregando SAML entrante. Despu칠s de agregar IdPs, puedes configurar reglas de enrutamiento para dirigir a los usuarios a un IdP basado en el contexto, como la ubicaci칩n del usuario, el dispositivo o el dominio de correo electr칩nico.

**Si alg칰n proveedor de identidad est치 configurado**, desde el punto de vista de atacantes y defensores, verifica esa configuraci칩n y **si la fuente es realmente confiable**, ya que como atacante, comprometerla tambi칠n podr칤a dar acceso al entorno de Okta.

### Autenticaci칩n Delegada

La autenticaci칩n delegada permite a los usuarios iniciar sesi칩n en Okta ingresando credenciales para el servidor **Active Directory (AD) o LDAP** de su organizaci칩n.

Nuevamente, revisa esto, ya que como atacante, comprometer el AD de una organizaci칩n podr칤a permitirte pivotar a Okta gracias a esta configuraci칩n.

### Red

Una zona de red es un l칤mite configurable que puedes usar para **conceder o restringir el acceso a computadoras y dispositivos** en tu organizaci칩n basado en la **direcci칩n IP** que solicita acceso. Puedes definir una zona de red especificando una o m치s direcciones IP individuales, rangos de direcciones IP o ubicaciones geogr치ficas.

Despu칠s de definir una o m치s zonas de red, puedes **usarlas en Pol칤ticas Globales de Sesi칩n**, **pol칤ticas de autenticaci칩n**, notificaciones de VPN y **reglas de enrutamiento**.

Desde la perspectiva de un atacante, es interesante saber qu칠 IPs est치n permitidas (y verificar si alguna **IP tiene m치s privilegios** que otras). Desde la perspectiva de un atacante, si los usuarios deben acceder desde una direcci칩n IP o regi칩n espec칤fica, verifica que esta funci칩n se use correctamente.

### Integraciones de Dispositivos

* **Gesti칩n de Puntos Finales**: La gesti칩n de puntos finales es una condici칩n que se puede aplicar en una pol칤tica de autenticaci칩n para asegurar que los dispositivos gestionados tengan acceso a una aplicaci칩n.
* A칰n no he visto esto utilizado. TODO
* **Servicios de Notificaci칩n**: A칰n no he visto esto utilizado. TODO

### API

Puedes crear tokens de API de Okta en esta p치gina y ver los que se han **creado**, sus **privilegios**, tiempo de **expiraci칩n** y **URLs de Origen**. Ten en cuenta que los tokens de API se generan con los permisos del usuario que cre칩 el token y son v치lidos solo si el **usuario** que los cre칩 est치 **activo**.

Los **Or칤genes Confiables** otorgan acceso a sitios web que controlas y conf칤as para acceder a tu organizaci칩n de Okta a trav칠s de la API de Okta.

No deber칤a haber muchos tokens de API, ya que si los hay, un atacante podr칤a intentar acceder a ellos y usarlos.

## Flujo de Trabajo

### Automatizaciones

Las automatizaciones te permiten crear acciones automatizadas que se ejecutan en funci칩n de un conjunto de condiciones desencadenantes que ocurren durante el ciclo de vida de los usuarios finales.

Por ejemplo, una condici칩n podr칤a ser "Inactividad del usuario en Okta" o "Expiraci칩n de la contrase침a del usuario en Okta" y la acci칩n podr칤a ser "Enviar correo electr칩nico al usuario" o "Cambiar el estado del ciclo de vida del usuario en Okta".

## Informes

### Informes

Descargar registros. Se **env칤an** a la **direcci칩n de correo electr칩nico** de la cuenta actual.

### Registro del Sistema

Aqu칤 puedes encontrar los **registros de las acciones realizadas por los usuarios** con muchos detalles como iniciar sesi칩n en Okta o en aplicaciones a trav칠s de Okta.

### Monitoreo de Importaciones

Esto puede **importar registros de otras plataformas** accedidas con Okta.

### L칤mites de Tasa

Verificar los l칤mites de tasa de la API alcanzados.

## Configuraciones

### Cuenta

Aqu칤 puedes encontrar **informaci칩n gen칠rica** sobre el entorno de Okta, como el nombre de la empresa, direcci칩n, **contacto de facturaci칩n por correo electr칩nico**, **contacto t칠cnico por correo electr칩nico** y tambi칠n qui칠n debe recibir actualizaciones de Okta y qu칠 tipo de actualizaciones de Okta.

### Descargas

Aqu칤 puedes descargar agentes de Okta para sincronizar Okta con otras tecnolog칤as.

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
