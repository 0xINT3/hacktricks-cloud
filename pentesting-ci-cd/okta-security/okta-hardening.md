# Okta Hardenning

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Directory

### Persone

Dal punto di vista di un attaccante, questo √® molto interessante perch√© sarai in grado di vedere **tutti gli utenti registrati**, i loro indirizzi **email**, i **gruppi** di cui fanno parte, i **profil**i e persino i **dispositivi** (telefoni cellulari insieme ai loro sistemi operativi).

Per una revisione whitebox, controlla che non ci siano diversi "**Pending user action**" e "**Password reset**".

### Gruppi

Qui trovi tutti i gruppi creati in Okta. √à interessante capire i diversi gruppi (insieme di **permessi**) che possono essere concessi agli **utenti**.\
√à possibile vedere le **persone incluse nei gruppi** e le **app assegnate** a ciascun gruppo.

Ovviamente, qualsiasi gruppo con il nome di **admin** √® interessante, specialmente il gruppo **Global Administrators**, controlla i membri per scoprire chi sono i membri pi√π privilegiati.

Da una revisione whitebox, non **dovrebbero esserci pi√π di 5 amministratori globali** (meglio se ce ne sono solo 2 o 3).

### Dispositivi

Qui trovi un **elenco di tutti i dispositivi** di tutti gli utenti. Puoi anche vedere se √® **gestito attivamente** o no.

### Editor del profilo

Qui √® possibile osservare come le informazioni chiave come nomi, cognomi, email, nomi utente... sono condivise tra Okta e altre applicazioni. Questo √® interessante perch√© se un utente pu√≤ **modificare in Okta un campo** (come il suo nome o l'email) che viene poi utilizzato da un'**applicazione esterna** per **identificare** l'utente, un insider potrebbe cercare di **prendere il controllo di altri account**.

Inoltre, nel profilo **`User (default)`** di Okta puoi vedere **quali campi** ha ciascun **utente** e quali sono **modificabili** dagli utenti. Se non riesci a vedere il pannello di amministrazione, vai semplicemente a **aggiornare le informazioni del tuo profilo** e vedrai quali campi puoi aggiornare (nota che per aggiornare un indirizzo email dovrai verificarlo).

### Integrazioni della directory

Le directory ti consentono di importare persone da origini esistenti. Immagino che qui vedrai gli utenti importati da altre directory.

Non l'ho visto, ma immagino che sia interessante scoprire **altre directory che Okta sta utilizzando per importare utenti** in modo da poter impostare alcuni valori degli attributi negli utenti creati in Okta e **forse compromettere l'ambiente Okta** se si compromette quella directory.

### Origini del profilo

Un'origine del profilo √® un'**applicazione che agisce come una fonte di verit√†** per gli attributi del profilo dell'utente. Un utente pu√≤ essere fornito solo da un'applicazione o da una directory alla volta.

Non l'ho visto, quindi qualsiasi informazione sulla sicurezza e sull'hacking riguardo a questa opzione √® apprezzata.

## Personalizzazioni

### Marchi

Controlla nella scheda **Domini** di questa sezione gli indirizzi email utilizzati per inviare email e il dominio personalizzato all'interno di Okta dell'azienda (che probabilmente gi√† conosci).

Inoltre, nella scheda **Impostazioni**, se sei un amministratore, puoi "**Usa una pagina di logout personalizzata**" e impostare un URL personalizzato.

### SMS

Niente di interessante qui.

### Dashboard per l'utente finale

Qui puoi trovare le applicazioni configurate, ma vedremo i dettagli di queste in seguito in una sezione diversa.

### Altro

Impostazione interessante, ma niente di super interessante dal punto di vista della sicurezza.

## Applicazioni

### Applicazioni

Qui puoi trovare tutte le **applicazioni configurate** e i loro dettagli: Chi ha accesso ad esse, come √® configurata (SAML, OPenID), URL per il login, le corrispondenze tra Okta e l'applicazione...

Nella scheda **`Sign On`** c'√® anche un campo chiamato **`Password reveal`** che consentirebbe a un utente di **rivelare la sua password** quando si controllano le impostazioni dell'applicazione. Per controllare le impostazioni di un'applicazione dal Pannello utente, fai clic sui 3 punti:

<figure><img src="../../.gitbook/assets/image (4) (7).png" alt=""><figcaption></figcaption></figure>

E potresti vedere alcuni dettagli aggiuntivi sull'app (come la funzione di rivelazione della password, se √® abilitata):

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## Governance dell'identit√†

### Certificazioni di accesso

Utilizza le Certificazioni di accesso per creare campagne di audit per rivedere periodicamente l'accesso degli utenti alle risorse e approvare o revocare automaticamente l'accesso quando necessario.

Non l'ho visto usato, ma immagino che dal punto di vista difensivo sia una bella funzionalit√†.

## Sicurezza

### Generale

* **Email di notifica di sicurezza**: Tutte dovrebbero essere abilitate.
* **Integrazione CAPTCHA**: √à consigliabile impostare almeno il reCaptcha invisibile
* **Sicurezza dell'organizzazione**: Tutto pu√≤ essere abilitato e le email di attivazione non dovrebbero durare a lungo (7 giorni vanno bene)
* **Prevenzione dell'enumerazione degli utenti**: Entrambi dovrebbero essere abilitati
* Nota che la prevenzione dell'enumerazione degli utenti non ha effetto se sono consentite una delle seguenti condizioni (vedi [Gestione degli utenti](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) per ulteriori informazioni):
* Registrazione self-service
* Flussi JIT con autenticazione tramite email
* **Impostazioni Okta ThreatInsight**: Registra e applica la sicurezza in base al livello di minaccia

### HealthInsight

Qui √® possibile trovare impostazioni correttamente e **pericolosamente** configurate.

### Autenticatori

Qui puoi trovare tutti i metodi di autenticazione che un utente potrebbe utilizzare: Password, telefono, email, codice, WebAuthn... Cliccando sull'autenticatore Password puoi vedere la **politica della password**. Controlla che sia forte.

Nella scheda **Registrazione** puoi vedere quelli che sono richiesti o opzionali:

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

√à consigliabile disabilitare il telefono. I pi√π forti sono probabilmente una combinazione di password, email e WebAuthn.

### Politiche di autenticazione

Ogni app ha una politica di autenticazione. La politica di autenticazione verifica che gli utenti che cercano di accedere all'app soddisfino condizioni specifiche e applica requisiti di fattore in base a tali condizioni.

Qui puoi trovare i **requisiti per accedere a ciascuna applicazione**. √à consigliabile richiedere almeno la password e un altro metodo per ciascuna applicazione. Ma se come attaccante trovi qualcosa di pi√π debole potresti essere in grado di attaccarlo.
### Politica globale delle sessioni

Qui puoi trovare le politiche delle sessioni assegnate a diversi gruppi. Ad esempio:

<figure><img src="../../.gitbook/assets/image (2) (1) (2).png" alt=""><figcaption></figcaption></figure>

Si consiglia di richiedere l'autenticazione multifattore (MFA), limitare la durata della sessione a alcune ore, non persistere i cookie di sessione attraverso le estensioni del browser e limitare la posizione e il provider di identit√† (se possibile). Ad esempio, se ogni utente dovrebbe accedere da un determinato paese, √® possibile consentire solo a questa posizione di accedere.

### Provider di identit√†

I provider di identit√† (IdP) sono servizi che gestiscono gli account degli utenti. Aggiungere IdP in Okta consente ai tuoi utenti finali di registrarsi autonomamente alle tue applicazioni personalizzate autenticandosi prima con un account social o una smart card.

Nella pagina dei provider di identit√†, √® possibile aggiungere accessi sociali (IdP) e configurare Okta come service provider (SP) aggiungendo SAML in ingresso. Dopo aver aggiunto gli IdP, √® possibile configurare regole di routing per indirizzare gli utenti a un IdP in base al contesto, come la posizione dell'utente, il dispositivo o il dominio email.

Se √® configurato un provider di identit√†, dal punto di vista di un attaccante e di un difensore, √® necessario verificare tale configurazione e se la fonte √® davvero affidabile, poich√© un attaccante che compromette il provider potrebbe ottenere accesso anche all'ambiente Okta.

### Autenticazione delegata

L'autenticazione delegata consente agli utenti di accedere a Okta inserendo le credenziali del server **Active Directory (AD) o LDAP** della propria organizzazione.

Anche in questo caso, √® necessario verificare tale configurazione, poich√© un attaccante che compromette l'AD di un'organizzazione potrebbe essere in grado di passare a Okta grazie a questa impostazione.

### Rete

Una zona di rete √® un confine configurabile che puoi utilizzare per concedere o limitare l'accesso a computer e dispositivi nella tua organizzazione in base all'indirizzo IP che richiede l'accesso. √à possibile definire una zona di rete specificando uno o pi√π indirizzi IP individuali, intervalli di indirizzi IP o posizioni geografiche.

Dopo aver definito una o pi√π zone di rete, √® possibile utilizzarle nelle politiche globali delle sessioni, nelle politiche di autenticazione, nelle notifiche VPN e nelle regole di routing.

Dal punto di vista di un attaccante, √® interessante sapere quali provider di servizi sono consentiti (e verificare se alcuni indirizzi IP sono pi√π privilegiati di altri). Dal punto di vista di un attaccante, se gli utenti dovrebbero accedere da un indirizzo IP o una regione specifica, verificare che questa funzionalit√† sia utilizzata correttamente.

### Integrazioni dei dispositivi

* **Gestione dei dispositivi**: la gestione dei dispositivi √® una condizione che pu√≤ essere applicata in una politica di autenticazione per garantire che i dispositivi gestiti abbiano accesso a un'applicazione.
* Non ho ancora visto questo utilizzato. TODO
* **Servizi di notifica**: non ho ancora visto questo utilizzato. TODO

### API

In questa pagina √® possibile creare token API di Okta e visualizzare quelli che sono stati creati, i loro privilegi, la data di scadenza e gli URL di origine. Si noti che i token API vengono generati con i permessi dell'utente che li ha creati e sono validi solo se l'utente che li ha creati √® attivo.

Le **Origini attendibili** consentono l'accesso a siti web che controlli e di cui ti fidi per accedere alla tua organizzazione Okta tramite l'API di Okta.

Non dovrebbero esserci molti token API, poich√© se ce ne sono molti, un attaccante potrebbe cercare di accedervi e utilizzarli.

## Workflow

### Automazioni

Le automazioni consentono di creare azioni automatizzate che vengono eseguite in base a un insieme di condizioni di trigger che si verificano durante il ciclo di vita degli utenti finali.

Ad esempio, una condizione potrebbe essere "Inattivit√† dell'utente in Okta" o "Scadenza della password dell'utente in Okta" e l'azione potrebbe essere "Invia un'email all'utente" o "Cambia lo stato del ciclo di vita dell'utente in Okta".

## Report

### Report

Scarica i log. Vengono inviati all'indirizzo email dell'account corrente.

### Log di sistema

Qui puoi trovare i log delle azioni eseguite dagli utenti con molti dettagli, come l'accesso a Okta o alle applicazioni tramite Okta.

### Monitoraggio delle importazioni

Questo pu√≤ importare log dalle altre piattaforme a cui si accede con Okta.

### Limiti di velocit√†

Verifica i limiti di velocit√† dell'API raggiunti.

## Impostazioni

### Account

Qui puoi trovare informazioni generiche sull'ambiente Okta, come il nome dell'azienda, l'indirizzo, il contatto di fatturazione via email, il contatto tecnico via email e anche chi dovrebbe ricevere gli aggiornamenti di Okta e che tipo di aggiornamenti di Okta.

### Download

Qui puoi scaricare gli agenti Okta per sincronizzare Okta con altre tecnologie.

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) **e** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos.**

</details>
