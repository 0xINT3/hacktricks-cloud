# Oktaの強化

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**PEASSファミリー**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>

## ディレクトリ

### 人々

攻撃者の視点からは、**登録されている全ユーザー**、彼らの**メールアドレス**、彼らが属している**グループ**、**プロファイル**、さらには**デバイス**（OSを搭載したモバイル）を見ることができるため、非常に興味深いです。

ホワイトボックスレビューでは、"**保留中のユーザーアクション**"や"**パスワードリセット**"がいくつもないことを確認してください。

### グループ

Oktaで作成されたすべてのグループがここにあります。**ユーザー**に付与される可能性のある異なるグループ（一連の**権限**）を理解するのに興味深いです。\
グループ内に含まれる**人々**と各グループに**割り当てられたアプリ**を見ることができます。

もちろん、**admin**という名前のグループは特に興味深いです。特に**Global Administrators**グループのメンバーをチェックして、最も特権を持つメンバーが誰であるかを学びます。

ホワイトボックスレビューでは、**グローバル管理者が5人以上いてはならない**（2人または3人だけが理想的です）。

### デバイス

ここでは、すべてのユーザーの**デバイスのリスト**を見つけることができます。また、それが**アクティブに管理されている**かどうかも見ることができます。

### プロファイルエディター

ここでは、名前、姓、メール、ユーザー名などの重要な情報がOktaと他のアプリケーション間でどのように共有されているかを観察することができます。これは、ユーザーがOktaでフィールド（名前やメールなど）を**変更できる**場合、そのフィールドが**外部アプリケーション**によってユーザーを**識別する**ために使用される場合、インサイダーが他のアカウントを**乗っ取る**ことを試みる可能性があるため、興味深いです。

さらに、Oktaの**`User (default)`**プロファイルでは、各**ユーザー**が持っている**フィールド**とユーザーによって**書き込み可能**なフィールドを見ることができます。管理パネルが見えない場合は、**プロファイル情報を更新**するには、更新できるフィールドがどれかを確認してください（メールアドレスを更新するには、それを検証する必要があります）。

### ディレクトリ統合

ディレクトリを使用すると、既存のソースから人々をインポートすることができます。ここでは、他のディレクトリからインポートされたユーザーを見ることになると思います。

見たことはありませんが、Oktaがユーザーをインポートするために使用している**他のディレクトリ**を見つけるのは興味深いでしょう。そのディレクトリを**侵害する**ことができれば、Oktaで作成されたユーザーのいくつかの属性値を設定し、**Oktaの環境を侵害する**可能性があります。

### プロファイルソース

プロファイルソースは、ユーザープロファイル属性の**真実の源として機能するアプリケーション**です。ユーザーは一度に1つのアプリケーションまたはディレクトリにのみソースされます。

見たことがないので、このオプションに関するセキュリティとハッキングに関する情報があれば歓迎します。

## カスタマイズ

### ブランド

このセクションの**ドメイン**タブで、メールを送信するために使用されるメールアドレスと、会社のOkta内のカスタムドメイン（おそらくすでに知っている）を確認してください。

さらに、**設定**タブで、管理者であれば、"**カスタムサインアウトページを使用する**"を選択し、カスタムURLを設定することができます。

### SMS

ここでは特に興味深いことはありません。

### エンドユーザーダッシュボード

ここでは設定されたアプリケーションを見つけることができますが、詳細は別のセクションで後で見ます。

### その他

セキュリティの観点からは特に興味深い設定はありませんが、興味深い設定です。

## アプリケーション

### アプリケーション

ここでは、**設定されたすべてのアプリケーション**とその詳細を見つけることができます：それらにアクセスできる人、どのように設定されているか（SAML、OPenID）、ログインするためのURL、Oktaとアプリケーション間のマッピング...

**`Sign On`**タブには、ユーザーがアプリケーション設定をチェックするときに自分のパスワードを**表示できる**ようにする**`Password reveal`**というフィールドもあります。ユーザーパネルからアプリケーションの設定をチェックするには、3つのドットをクリックします：

<figure><img src="../../.gitbook/assets/image (4) (7).png" alt=""><figcaption></figcaption></figure>

そして、アプリに関するいくつかの詳細（パスワード表示機能が有効になっているかどうかなど）を見ることができます：

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## アイデンティティガバナンス

### アクセス認証

アクセス認証を使用して、定期的にユーザーのリソースへのアクセスをレビューし、必要に応じて自動的にアクセスを承認または取り消すための監査キャンペーンを作成します。

使用されているのを見たことはありませんが、防御的な観点からは良い機能だと思います。

## セキュリティ

### 一般

* **セキュリティ通知メール**: すべて有効にするべきです。
* **CAPTCHA統合**: 少なくともインビジブルreCaptchaを設定することを推奨します。
* **組織セキュリティ**: すべてを有効にすることができ、アクティベーションメールは長く続かないほうが良いです（7日間はOKです）。
* **ユーザー列挙防止**: 両方とも有効にするべきです。
* ユーザー列挙防止は、以下の条件のいずれかが許可されている場合は効果がありません（詳細は[ユーザー管理](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm)を参照）:
* セルフサービス登録
* メール認証を伴うJITフロー
* **Okta ThreatInsight設定**: 脅威レベルに基づいてセキュリティをログおよび強制します。
### HealthInsight

ここでは正しく、そして**危険な**設定された**設定**を見つけることができます。

### Authenticators

ここではユーザーが使用できるすべての認証方法を見つけることができます：パスワード、電話、メール、コード、WebAuthnなど。パスワード認証器をクリックすると、**パスワードポリシー**を確認できます。それが強力であることを確認してください。

**登録**タブでは、必須または任意のものを確認できます：

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

電話を無効にすることをお勧めします。最も強力なものは、おそらくパスワード、メール、およびWebAuthnの組み合わせです。

### 認証ポリシー

すべてのアプリには認証ポリシーがあります。認証ポリシーは、アプリにサインインしようとするユーザーが特定の条件を満たしていることを確認し、それらの条件に基づいて要素の要件を強制します。

ここでは、**各アプリケーションへのアクセス要件**を見つけることができます。各アプリケーションに対して少なくともパスワードと別の方法を要求することをお勧めします。しかし、攻撃者として何か弱いものを見つけた場合、攻撃することができるかもしれません。

### グローバルセッションポリシー

ここでは、異なるグループに割り当てられたセッションポリシーを見つけることができます。例えば：

<figure><img src="../../.gitbook/assets/image (2) (1) (2).png" alt=""><figcaption></figcaption></figure>

MFAを要求し、セッションの有効期限を数時間に制限し、ブラウザ拡張機能でセッションクッキーを持続させないようにし、場所とIdentity Provider（可能であれば）を制限することをお勧めします。例えば、すべてのユーザーが特定の国からログインする必要がある場合は、その場所のみを許可することができます。

### Identity Providers

Identity Providers（IdPs）は、**ユーザーアカウントを管理する**サービスです。OktaにIdPsを追加することで、エンドユーザーはソーシャルアカウントやスマートカードで最初に認証することにより、カスタムアプリケーションに**自己登録**することができます。

Identity Providersページでは、ソーシャルログイン（IdPs）を追加し、SAMLを追加することによってOktaをサービスプロバイダー（SP）として設定できます。IdPsを追加した後、ユーザーの場所、デバイス、またはメールドメインなどのコンテキストに基づいてユーザーをIdPに誘導するルーティングルールを設定できます。

**任意のIdentity Providerが設定されている場合**、攻撃者と防御者の観点からその設定を確認し、**ソースが本当に信頼できるかどうか**を確認してください。攻撃者としてそれを侵害することは、Okta環境へのアクセスも得ることができるかもしれません。

### Delegated Authentication

委任された認証を使用すると、ユーザーは組織の**Active Directory（AD）またはLDAP**サーバーの資格情報を入力してOktaにサインインできます。

再度、これを確認してください。攻撃者として組織のADを侵害することができれば、この設定のおかげでOktaにピボットすることができるかもしれません。

### ネットワーク

ネットワークゾーンは、アクセスを要求する**IPアドレス**に基づいて、組織内のコンピューターやデバイスへのアクセスを**許可または制限する**ために使用できる設定可能な境界です。ネットワークゾーンを定義するには、1つ以上の個々のIPアドレス、IPアドレスの範囲、または地理的な場所を指定します。

1つ以上のネットワークゾーンを定義した後、グローバルセッションポリシー、**認証ポリシー**、VPN通知、および**ルーティングルール**でそれらを使用できます。

攻撃者の観点からは、どのIPが許可されているかを知ることが興味深いです（そして、**IPが他よりも特権的であるかどうか**を確認します）。攻撃者の観点から、ユーザーが特定のIPアドレスまたは地域からアクセスする必要がある場合は、この機能が適切に使用されているかどうかを確認してください。

### Device Integrations

* **エンドポイント管理**: エンドポイント管理は、認証ポリシーに適用できる条件であり、管理されたデバイスがアプリケーションにアクセスできることを保証します。
* まだこれが使用されているのを見ていません。TODO
* **通知サービス**: まだこれが使用されているのを見ていません。TODO

### API

このページでOkta APIトークンを作成し、作成されたトークン、その**権限**、**有効期限**、および**オリジンURL**を確認できます。APIトークンは、トークンを作成したユーザーの権限で生成され、それを作成した**ユーザー**が**アクティブ**である場合にのみ有効です。

**信頼されたオリジン**は、Okta APIを介してOkta組織にアクセスするために、あなたが制御し信頼するウェブサイトへのアクセスを許可します。

APIトークンは多くないはずです。多くある場合、攻撃者はそれらにアクセスし、使用しようとするかもしれません。

## ワークフロー

### Automations

自動化は、エンドユーザーのライフサイクル中に発生する一連のトリガー条件に基づいて実行される自動化されたアクションを作成することを可能にします。

例えば、条件は「Oktaでのユーザーの非活動」または「Oktaでのユーザーパスワードの有効期限」であり、アクションは「ユーザーにメールを送信する」または「Oktaでのユーザーライフサイクル状態を変更する」などです。

## レポート

### レポート

ログをダウンロードします。これらは現在のアカウントの**メールアドレス**に**送信**されます。

### システムログ

ここでは、OktaまたはOktaを介したアプリケーションへのログインなど、ユーザーによって実行されたアクションの**ログ**を多くの詳細と共に見つけることができます。

### インポートモニタリング

これはOktaでアクセスされた他のプラットフォームからの**ログをインポート**できます。

### レートリミット

到達したAPIレートリミットを確認します。

## 設定

### アカウント

ここでは、会社名、住所、**メール請求連絡先**、**メール技術連絡先**など、Okta環境に関する**一般的な情報**を見つけることができます。また、誰がOktaの更新を受け取るべきか、どの種類のOktaの更新を受け取るべきかも見つけることができます。

### ダウンロード

ここでは、他の技術とOktaを同期するためのOktaエージェントをダウンロードできます。

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）で</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksにあなたの**会社を広告したい場合、または**HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見してください。私たちの独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションです
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォロー**してください。
* **HackTricks**の[**githubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有してください。

</details>
