# Okta 强化

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS 红队专家）</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想看到您的**公司在 HackTricks 中做广告**或**下载 PDF 版本的 HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 探索[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或**关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR** 来分享您的黑客技巧。

</details>

## 目录

### 用户

从攻击者的角度来看，这非常有趣，因为您将能够看到**所有注册用户**，他们的**电子邮件**地址，他们所属的**组**，**配置文件**甚至**设备**（包括其操作系统）。

对于白盒审查，请检查是否有多个“**待处理用户操作**”和“**密码重置**”。

### 组

这是您在 Okta 中找到的所有创建的组。了解不同组（一组**权限**）对**用户**可能授予的权限是很有趣的。\
可以查看**组内包含的人员**和每个组分配的**应用程序**。

当然，任何以**admin**命名的组都很有趣，特别是**全局管理员**组，请检查成员以了解谁是最具特权的成员。

从白盒审查的角度来看，**全局管理员不应超过 5 个**（最好只有 2 或 3 个）。

### 设备

在这里找到所有用户的**设备列表**。您还可以查看它是否正在**主动管理**。

### 配置文件编辑器

在这里，可以观察关键信息（如名字、姓氏、电子邮件、用户名等）在 Okta 和其他应用程序之间是如何共享的。这很有趣，因为如果用户可以在 Okta 中**修改字段**（例如他的姓名或电子邮件），然后外部应用程序用于**识别**用户，内部人员可能会尝试**接管其他帐户**。

此外，在 Okta 的**`用户（默认）`**配置文件中，您可以查看每个**用户**拥有哪些字段以及哪些字段是用户**可写**的。如果您无法看到管理面板，只需转到**更新您的配置文件**信息，您将看到可以更新哪些字段（请注意，要更新电子邮件地址，您需要验证它）。

### 目录集成

目录允许您从现有来源导入人员。我猜在这里您将看到从其他目录导入的用户。

我没有看到，但我猜这很有趣，可以找出 Okta 用于导入用户的**其他目录**，因此如果您**入侵该目录**，您可以在 Okta 中创建的用户中设置一些属性值，**可能会危及 Okta 环境**。

### 配置文件来源

配置文件来源是一个**作为用户配置文件属性真相来源**的应用程序。用户一次只能由一个应用程序或目录提供。

我没有看到，因此对于有关此选项的安全性和黑客信息，欢迎提供任何信息。

## 自定义

### 品牌

在此部分的**域**选项卡中检查用于发送电子邮件的电子邮件地址以及公司在 Okta 中的自定义域（您可能已经知道）。

此外，在**设置**选项卡中，如果您是管理员，可以“**使用自定义登出页面**”并设置自定义 URL。

### 短信

这里没有什么有趣的。

### 终端用户仪表板

您可以在这里找到配置的应用程序，但我们将在不同的部分中详细了解这些应用程序。

### 其他

有趣的设置，但从安全角度来看没有什么特别有趣的。

## 应用程序

### 应用程序

在这里，您可以找到所有**配置的应用程序**及其详细信息：谁可以访问它们，如何配置（SAML、OPenID），登录的 URL，Okta 和应用程序之间的映射...

在**`登录`**选项卡中，还有一个名为**`密码显示`**的字段，允许用户在检查应用程序设置时**显示密码**。要查看用户面板中应用程序的设置，请单击 3 个点：

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

然后，您可以查看有关应用程序的更多详细信息（例如密码显示功能是否已启用）：

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## 身份治理

### 访问认证

使用访问认证创建审核活动，定期审查用户对资源的访问，并在需要时自动批准或撤销访问权限。

我没有看到它被使用，但我猜从防御的角度来看，这是一个不错的功能。

## 安全

### 一般

* **安全通知电子邮件**：所有应该已启用。
* **CAPTCHA 集成**：建议至少设置不可见的 reCaptcha
* **组织安全**：可以启用所有内容，激活电子邮件不应持续太久（7 天是可以接受的）
* **用户枚举预防**：两者都应启用
* 请注意，如果允许以下任一条件，则用户枚举预防不会生效（有关更多信息，请参阅[用户管理](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm)）：
* 自助注册
* 具有电子邮件身份验证的 JIT 流
* **Okta ThreatInsight 设置**：根据威胁级别记录和强制执行安全性

### HealthInsight

在这里，可以找到正确和**危险**配置的**设置**。

### 认证器

在这里，您可以找到用户可以使用的所有身份验证方法：密码、电话、电子邮件、代码、WebAuthn... 单击“密码”认证器，您可以查看**密码策略**。确保密码强度足够。

在**注册**选项卡中，您可以查看哪些是必需的或可选的：

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

建议禁用电话。最强大的可能是密码、电子邮件和 WebAuthn 的组合。

### 认证策略

每个应用程序都有一个认证策略。认证策略验证尝试登录应用程序的用户是否满足特定条件，并根据这些条件强制执行因素要求。

在这里，您可以找到**访问每个应用程序的要求**。建议至少要求每个应用程序的密码和另一种方法。但如果作为攻击者找到了更薄弱的内容，您可能能够攻击它。
### 全局会话策略

在这里，您可以找到分配给不同组的会话策略。例如：

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

建议要求多重身份验证（MFA），将会话生命周期限制为几个小时，不要跨浏览器扩展程序保留会话cookie，并限制位置和身份提供者（如果可能的话）。例如，如果每个用户应该从一个国家登录，您可以只允许该位置。

### 身份提供者

身份提供者（IdPs）是管理用户帐户的服务。在Okta中添加IdPs可以使您的最终用户通过首先使用社交帐户或智能卡进行身份验证来自定义应用程序进行自注册。

在身份提供者页面上，您可以添加社交登录（IdPs）并通过添加入站SAML将Okta配置为服务提供者（SP）。添加IdPs后，您可以设置路由规则，根据上下文（例如用户的位置、设备或电子邮件域）将用户定向到IdP。

**如果配置了任何身份提供者**，从攻击者和防御者的角度来看，请检查该配置，并确保攻击者是否真的可信，因为攻击者入侵可能还会访问Okta环境。

### 委托认证

委托认证允许用户通过输入其组织的**Active Directory (AD)或LDAP**服务器的凭据登录到Okta。

再次检查此设置，因为攻击者入侵组织的AD可能能够通过此设置转向Okta。

### 网络

网络区域是一个可配置的边界，您可以根据请求访问的**IP地址**来使用它来**授予或限制对组织中计算机和设备的访问**。您可以通过指定一个或多个单独的IP地址、IP地址范围或地理位置来定义网络区域。

在定义一个或多个网络区域后，您可以**在全局会话策略**、**身份验证策略**、VPN通知和**路由规则**中使用它们。

从攻击者的角度来看，了解允许哪些IP，并检查是否有任何**IP比其他IP更具特权**。从攻击者的角度来看，如果用户应该从特定IP地址或区域访问，请检查此功能是否正确使用。

### 设备集成

* **终端管理**：终端管理是可以应用于身份验证策略中的条件，以确保受管理设备可以访问应用程序。
* 我还没有看到这个被使用。待办事项
* **通知服务**：我还没有看到这个被使用。待办事项

### API

您可以在此页面创建Okta API令牌，并查看已**创建**的令牌、它们的**权限**、**过期**时间和**来源URL**。请注意，API令牌是以创建令牌的用户的权限生成的，并且仅在**创建它们的用户处于活动状态**时有效。

**受信任的来源**授予访问您控制和信任的网站通过Okta API访问您的Okta组织。

不应该有大量的API令牌，因为如果有，攻击者可能会尝试访问并使用它们。

## 工作流程

### 自动化

自动化允许您创建基于一组触发条件运行的自动化操作，这些条件发生在最终用户的生命周期中。

例如，一个条件可能是“Okta中的用户不活动”或“Okta中的用户密码过期”，操作可能是“向用户发送电子邮件”或“更改Okta中的用户生命周期状态”。

## 报告

### 报告

下载日志。它们将**发送**到当前帐户的**电子邮件地址**。

### 系统日志

在这里，您可以找到用户执行的操作的日志，例如在Okta中登录或通过Okta登录应用程序的详细信息。

### 导入监控

这可以**导入从使用Okta访问的其他平台**的日志。

### 速率限制

检查已达到的API速率限制。

## 设置

### 帐户

在这里，您可以找到关于Okta环境的**通用信息**，例如公司名称、地址、**电子邮件计费联系人**、**电子邮件技术联系人**，以及谁应该接收Okta更新以及哪种类型的Okta更新。

### 下载

在这里，您可以下载Okta代理以将Okta与其他技术同步。
