# Renforcement d'Okta

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs exclusifs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Annuaire

### Personnes

Du point de vue d'un attaquant, c'est tr√®s int√©ressant car vous pourrez voir **tous les utilisateurs enregistr√©s**, leurs adresses **email**, les **groupes** auxquels ils appartiennent, **profils** et m√™me **appareils** (mobiles avec leurs syst√®mes d'exploitation).

Pour un examen en bo√Æte blanche, v√©rifiez qu'il n'y a pas plusieurs "**Action utilisateur en attente**" et "**R√©initialisation de mot de passe**".

### Groupes

C'est ici que vous trouvez tous les groupes cr√©√©s dans Okta. C'est int√©ressant pour comprendre les diff√©rents groupes (ensemble de **permissions**) qui pourraient √™tre accord√©s aux **utilisateurs**.\
Il est possible de voir les **personnes incluses dans les groupes** et les **applications attribu√©es** √† chaque groupe.

Bien s√ªr, tout groupe portant le nom d'**admin** est int√©ressant, en particulier le groupe **Administrateurs Globaux** ; v√©rifiez les membres pour savoir qui sont les membres les plus privil√©gi√©s.

D'un point de vue d'examen en bo√Æte blanche, il **ne devrait pas y avoir plus de 5 administrateurs globaux** (mieux vaut s'il n'y en a que 2 ou 3).

### Appareils

Trouvez ici une **liste de tous les appareils** de tous les utilisateurs. Vous pouvez √©galement voir s'ils sont **activement g√©r√©s** ou non.

### √âditeur de Profil

Ici, il est possible d'observer comment des informations cl√©s telles que les pr√©noms, noms, emails, noms d'utilisateur... sont partag√©es entre Okta et d'autres applications. C'est int√©ressant car si un utilisateur peut **modifier dans Okta un champ** (comme son nom ou son email) qui est ensuite utilis√© par une **application externe** pour **identifier** l'utilisateur, un initi√© pourrait essayer de **prendre le contr√¥le d'autres comptes**.

De plus, dans le profil **`Utilisateur (par d√©faut)`** d'Okta, vous pouvez voir **quels champs** chaque **utilisateur** a et lesquels sont **modifiables** par les utilisateurs. Si vous ne pouvez pas voir le panneau d'administration, allez simplement √† **mettre √† jour vos informations de profil** et vous verrez quels champs vous pouvez mettre √† jour (notez que pour mettre √† jour une adresse email, vous devrez la v√©rifier).

### Int√©grations d'Annuaire

Les annuaires vous permettent d'importer des personnes √† partir de sources existantes. Je suppose que vous verrez ici les utilisateurs import√©s d'autres annuaires.

Je ne l'ai pas vu, mais je suppose que c'est int√©ressant pour d√©couvrir **d'autres annuaires qu'Okta utilise pour importer des utilisateurs** donc si vous **compromettez cet annuaire**, vous pourriez d√©finir certaines valeurs d'attributs dans les utilisateurs cr√©√©s dans Okta et **peut-√™tre compromettre l'environnement Okta**.

### Sources de Profil

Une source de profil est une **application qui agit comme source de v√©rit√©** pour les attributs de profil d'utilisateur. Un utilisateur ne peut √™tre source que par une seule application ou annuaire √† la fois.

Je ne l'ai pas vu, donc toute information sur la s√©curit√© et le piratage concernant cette option est appr√©ci√©e.

## Personnalisations

### Marques

V√©rifiez dans l'onglet **Domaines** de cette section les adresses email utilis√©es pour envoyer des emails et le domaine personnalis√© dans Okta de l'entreprise (que vous connaissez probablement d√©j√†).

De plus, dans l'onglet **Param√®tres**, si vous √™tes administrateur, vous pouvez "**Utiliser une page de d√©connexion personnalis√©e**" et d√©finir une URL personnalis√©e.

### SMS

Rien d'int√©ressant ici.

### Tableau de Bord Utilisateur Final

Vous pouvez trouver ici des applications configur√©es, mais nous verrons les d√©tails de celles-ci plus tard dans une section diff√©rente.

### Autre

Param√®tre int√©ressant, mais rien de super int√©ressant du point de vue de la s√©curit√©.

## Applications

### Applications

Ici, vous pouvez trouver toutes les **applications configur√©es** et leurs d√©tails : Qui y a acc√®s, comment c'est configur√© (SAML, OPenID), URL pour se connecter, les mappages entre Okta et l'application...

Dans l'onglet **`Connexion`**, il y a aussi un champ appel√© **`R√©v√©lation de mot de passe`** qui permettrait √† un utilisateur de **r√©v√©ler son mot de passe** lors de la v√©rification des param√®tres de l'application. Pour v√©rifier les param√®tres d'une application depuis le Panneau Utilisateur, cliquez sur les 3 points :

<figure><img src="../../.gitbook/assets/image (4) (7).png" alt=""><figcaption></figcaption></figure>

Et vous pourriez voir plus de d√©tails sur l'application (comme la fonction de r√©v√©lation de mot de passe, si elle est activ√©e) :

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## Gouvernance d'Identit√©

### Certifications d'Acc√®s

Utilisez les Certifications d'Acc√®s pour cr√©er des campagnes d'audit pour examiner p√©riodiquement l'acc√®s de vos utilisateurs aux ressources et approuver ou r√©voquer automatiquement l'acc√®s lorsque cela est n√©cessaire.

Je ne l'ai pas vu utilis√©, mais je suppose que d'un point de vue d√©fensif, c'est une fonctionnalit√© int√©ressante.

## S√©curit√©

### G√©n√©ral

* **Emails de notification de s√©curit√©** : Tous devraient √™tre activ√©s.
* **Int√©gration CAPTCHA** : Il est recommand√© de configurer au moins le reCaptcha invisible
* **S√©curit√© de l'Organisation** : Tout peut √™tre activ√© et les emails d'activation ne devraient pas durer longtemps (7 jours c'est bien)
* **Pr√©vention de l'√©num√©ration des utilisateurs** : Les deux devraient √™tre activ√©s
* Notez que la Pr√©vention de l'√ânum√©ration des Utilisateurs n'est pas effective si l'une des conditions suivantes est autoris√©e (voir [Gestion des utilisateurs](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) pour plus d'informations) :
* Inscription en Libre-Service
* Flux JIT avec authentification par email
* **Param√®tres Okta ThreatInsight** : Enregistrer et appliquer la s√©curit√© en fonction du niveau de menace
### HealthInsight

Ici, il est possible de trouver des **param√®tres** configur√©s correctement et **dangereux**.

### Authentificateurs

Ici, vous pouvez trouver toutes les m√©thodes d'authentification qu'un utilisateur pourrait utiliser : Mot de passe, t√©l√©phone, email, code, WebAuthn... En cliquant sur l'authentificateur de mot de passe, vous pouvez voir la **politique de mot de passe**. V√©rifiez qu'elle est forte.

Dans l'onglet **Enrollment**, vous pouvez voir ceux qui sont requis ou optionnels :

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

Il est recommand√© de d√©sactiver le t√©l√©phone. Les plus solides sont probablement une combinaison de mot de passe, email et WebAuthn.

### Politiques d'authentification

Chaque application a une politique d'authentification. La politique d'authentification v√©rifie que les utilisateurs qui tentent de se connecter √† l'application r√©pondent √† des conditions sp√©cifiques, et elle impose des exigences de facteur en fonction de ces conditions.

Ici, vous pouvez trouver les **exigences pour acc√©der √† chaque application**. Il est recommand√© de demander au moins un mot de passe et une autre m√©thode pour chaque application. Mais si en tant qu'attaquant vous trouvez quelque chose de plus faible, vous pourriez √™tre capable de l'attaquer.

### Politique de session globale

Ici, vous pouvez trouver les politiques de session attribu√©es √† diff√©rents groupes. Par exemple :

<figure><img src="../../.gitbook/assets/image (2) (1) (2).png" alt=""><figcaption></figcaption></figure>

Il est recommand√© de demander MFA, de limiter la dur√©e de vie de la session √† quelques heures, de ne pas persister les cookies de session √† travers les extensions de navigateur et de limiter l'emplacement et le fournisseur d'identit√© (si cela est possible). Par exemple, si chaque utilisateur doit se connecter depuis un pays, vous pourriez autoriser uniquement cet emplacement.

### Fournisseurs d'identit√©

Les fournisseurs d'identit√© (IdPs) sont des services qui **g√®rent les comptes utilisateurs**. Ajouter des IdPs dans Okta permet √† vos utilisateurs finaux de **s'auto-enregistrer** avec vos applications personnalis√©es en s'authentifiant d'abord avec un compte social ou une carte √† puce.

Sur la page des fournisseurs d'identit√©, vous pouvez ajouter des connexions sociales (IdPs) et configurer Okta en tant que fournisseur de service (SP) en ajoutant du SAML entrant. Apr√®s avoir ajout√© des IdPs, vous pouvez configurer des r√®gles de routage pour diriger les utilisateurs vers un IdP en fonction du contexte, tel que l'emplacement de l'utilisateur, l'appareil ou le domaine de messagerie.

**Si un fournisseur d'identit√© est configur√©**, du point de vue des attaquants et des d√©fenseurs, v√©rifiez cette configuration et **si la source est vraiment fiable** car en tant qu'attaquant, la compromission pourrait √©galement donner acc√®s √† l'environnement Okta.

### Authentification d√©l√©gu√©e

L'authentification d√©l√©gu√©e permet aux utilisateurs de se connecter √† Okta en entrant les identifiants de leur serveur **Active Directory (AD) ou LDAP** de leur organisation.

Encore une fois, rev√©rifiez cela, car en tant qu'attaquant, compromettre l'AD d'une organisation pourrait permettre de pivoter vers Okta gr√¢ce √† ce param√®tre.

### R√©seau

Une zone de r√©seau est une limite configurable que vous pouvez utiliser pour **accorder ou restreindre l'acc√®s aux ordinateurs et appareils** de votre organisation en fonction de l'**adresse IP** qui demande l'acc√®s. Vous pouvez d√©finir une zone de r√©seau en sp√©cifiant une ou plusieurs adresses IP individuelles, des plages d'adresses IP ou des emplacements g√©ographiques.

Apr√®s avoir d√©fini une ou plusieurs zones de r√©seau, vous pouvez **les utiliser dans les politiques de session globales**, les **politiques d'authentification**, les notifications VPN et les **r√®gles de routage**.

Du point de vue des attaquants, il est int√©ressant de savoir quelles IPs sont autoris√©es (et v√©rifier si certaines **IPs sont plus privil√©gi√©es** que d'autres). Du point de vue des attaquants, si les utilisateurs doivent acc√©der depuis une adresse IP ou une r√©gion sp√©cifique, v√©rifiez que cette fonctionnalit√© est utilis√©e correctement.

### Int√©grations d'appareils

* **Gestion des points de terminaison** : La gestion des points de terminaison est une condition qui peut √™tre appliqu√©e dans une politique d'authentification pour garantir que les appareils g√©r√©s ont acc√®s √† une application.
* Je n'ai pas encore vu cela utilis√©. √Ä FAIRE
* **Services de notification** : Je n'ai pas encore vu cela utilis√©. √Ä FAIRE

### API

Vous pouvez cr√©er des jetons API Okta sur cette page et voir ceux qui ont √©t√© **cr√©√©s**, leurs **privil√®ges**, le temps d'**expiration** et les **URL d'origine**. Notez qu'un jeton API est g√©n√©r√© avec les permissions de l'utilisateur qui a cr√©√© le jeton et n'est valide que si l'**utilisateur** qui les a cr√©√©s est **actif**.

Les **Origines de confiance** accordent l'acc√®s aux sites Web que vous contr√¥lez et en qui vous avez confiance pour acc√©der √† votre organisation Okta via l'API Okta.

Il ne devrait pas y avoir beaucoup de jetons API, car s'il y en a, un attaquant pourrait essayer de les acc√©der et de les utiliser.

## Workflow

### Automatisations

Les automatisations vous permettent de cr√©er des actions automatis√©es qui se d√©clenchent en fonction d'un ensemble de conditions d√©clencheurs qui se produisent pendant le cycle de vie des utilisateurs finaux.

Par exemple, une condition pourrait √™tre "Inactivit√© de l'utilisateur dans Okta" ou "Expiration du mot de passe de l'utilisateur dans Okta" et l'action pourrait √™tre "Envoyer un email √† l'utilisateur" ou "Changer l'√©tat du cycle de vie de l'utilisateur dans Okta".

## Rapports

### Rapports

T√©l√©chargez les journaux. Ils sont **envoy√©s** √† l'**adresse email** du compte actuel.

### Journal syst√®me

Ici, vous pouvez trouver les **journaux des actions effectu√©es par les utilisateurs** avec beaucoup de d√©tails comme la connexion dans Okta ou dans les applications via Okta.

### Surveillance des importations

Cela peut **importer des journaux d'autres plateformes** acc√©d√©es avec Okta.

### Limites de taux

V√©rifiez les limites de taux de l'API atteintes.

## Param√®tres

### Compte

Ici, vous pouvez trouver des **informations g√©n√©riques** sur l'environnement Okta, telles que le nom de l'entreprise, l'adresse, le **contact de facturation par email**, le **contact technique par email** et √©galement qui doit recevoir les mises √† jour d'Okta et quel type de mises √† jour d'Okta.

### T√©l√©chargements

Ici, vous pouvez t√©l√©charger les agents Okta pour synchroniser Okta avec d'autres technologies.

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
