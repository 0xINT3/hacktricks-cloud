# Fortalecimiento de Okta

<details>

<summary><strong>Aprende hacking de AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Directorio

### Personas

Desde la perspectiva de un atacante, esto es muy interesante ya que podr치s ver **todos los usuarios registrados**, sus direcciones de **correo electr칩nico**, los **grupos** a los que pertenecen, **perfiles** e incluso **dispositivos** (m칩viles junto con sus sistemas operativos).

Para una revisi칩n en caja blanca, verifica que no haya varios "**Acciones de usuario pendientes**" y "**Restablecimiento de contrase침a**".

### Grupos

Aqu칤 es donde se encuentran todos los grupos creados en Okta. Es interesante entender los diferentes grupos (conjunto de **permisos**) que podr칤an otorgarse a los **usuarios**.\
Es posible ver a las **personas incluidas dentro de los grupos** y las **aplicaciones asignadas** a cada grupo.

Por supuesto, cualquier grupo con el nombre de **admin** es interesante, especialmente el grupo **Administradores Globales**, verifica los miembros para saber qui칠nes son los miembros m치s privilegiados.

Desde una revisi칩n en caja blanca, **no deber칤a haber m치s de 5 administradores globales** (mejor si solo hay 2 o 3).

### Dispositivos

Encuentra aqu칤 una **lista de todos los dispositivos** de todos los usuarios. Tambi칠n puedes ver si est치n siendo **administrados activamente** o no.

### Editor de Perfiles

Aqu칤 es posible observar c칩mo se comparten informaci칩n clave como nombres, apellidos, correos electr칩nicos, nombres de usuario, entre Okta y otras aplicaciones. Esto es interesante porque si un usuario puede **modificar en Okta un campo** (como su nombre o correo electr칩nico) que luego es utilizado por una **aplicaci칩n externa** para **identificar** al usuario, un insider podr칤a intentar **apoderarse de otras cuentas**.

Adem치s, en el perfil **`Usuario (predeterminado)`** de Okta puedes ver **qu칠 campos** tiene cada **usuario** y cu치les son **editables** por los usuarios. Si no puedes ver el panel de administraci칩n, simplemente ve a **actualizar la informaci칩n de tu perfil** y ver치s qu칠 campos puedes actualizar (nota que para actualizar una direcci칩n de correo electr칩nico necesitar치s verificarla).

### Integraciones de Directorio

Los directorios te permiten importar personas de fuentes existentes. Supongo que aqu칤 ver치s los usuarios importados de otros directorios.

No lo he visto, pero supongo que es interesante descubrir **otros directorios que Okta est치 utilizando para importar usuarios** para, si **comprometes ese directorio**, podr칤as establecer algunos valores de atributos en los usuarios creados en Okta y **quiz치s comprometer el entorno de Okta**.

### Fuentes de Perfil

Una fuente de perfil es una **aplicaci칩n que act칰a como fuente de verdad** para los atributos del perfil de usuario. Un usuario solo puede ser originado por una sola aplicaci칩n o directorio a la vez.

No lo he visto, por lo que se agradece cualquier informaci칩n sobre seguridad y hacking con respecto a esta opci칩n.

## Personalizaciones

### Marcas

Verifica en la pesta침a de **Dominios** de esta secci칩n las direcciones de correo electr칩nico utilizadas para enviar correos electr칩nicos y el dominio personalizado dentro de Okta de la empresa (que probablemente ya conozcas).

Adem치s, en la pesta침a de **Configuraci칩n**, si eres administrador, puedes "**Usar una p치gina de cierre de sesi칩n personalizada**" y establecer una URL personalizada.

### SMS

Nada interesante aqu칤.

### Panel de Usuario Final

Aqu칤 puedes encontrar aplicaciones configuradas, pero veremos los detalles de esas m치s adelante en una secci칩n diferente.

### Otros

Configuraci칩n interesante, pero nada super interesante desde un punto de vista de seguridad.

## Aplicaciones

### Aplicaciones

Aqu칤 puedes encontrar todas las **aplicaciones configuradas** y sus detalles: Qui칠n tiene acceso a ellas, c칩mo est치 configurado (SAML, OpenID), URL para iniciar sesi칩n, las asignaciones entre Okta y la aplicaci칩n...

En la pesta침a **`Inicio de sesi칩n`** tambi칠n hay un campo llamado **`Revelar contrase침a`** que permitir칤a a un usuario **revelar su contrase침a** al verificar la configuraci칩n de la aplicaci칩n. Para verificar la configuraci칩n de una aplicaci칩n desde el Panel de Usuario, haz clic en los 3 puntos:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

Y podr칤as ver m치s detalles sobre la aplicaci칩n (como la funci칩n de revelaci칩n de contrase침a, si est치 habilitada):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Gobierno de Identidad

### Certificaciones de Acceso

Utiliza las Certificaciones de Acceso para crear campa침as de auditor칤a para revisar peri칩dicamente el acceso de tus usuarios a recursos y aprobar o revocar el acceso autom치ticamente cuando sea necesario.

No lo he visto utilizado, pero supongo que desde un punto de vista defensivo es una caracter칤stica interesante.

## Seguridad

### General

* **Correos electr칩nicos de notificaci칩n de seguridad**: Todos deber칤an estar habilitados.
* **Integraci칩n de CAPTCHA**: Se recomienda configurar al menos el reCaptcha invisible.
* **Seguridad de la Organizaci칩n**: Todo se puede habilitar y los correos de activaci칩n no deber칤an durar mucho (7 d칤as est치 bien)
* **Prevenci칩n de enumeraci칩n de usuarios**: Ambos deber칤an estar habilitados
* Ten en cuenta que la Prevenci칩n de Enumeraci칩n de Usuarios no surte efecto si se permiten alguna de las siguientes condiciones (Consulta [Gesti칩n de usuarios](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) para m치s informaci칩n):
* Registro de autoservicio
* Flujos JIT con autenticaci칩n por correo electr칩nico
* **Configuraciones de Okta ThreatInsight**: Registrar y hacer cumplir la seguridad basada en el nivel de amenaza

### HealthInsight

Aqu칤 es posible encontrar configuraciones **correctas** y **peligrosas**.

### Autenticadores

Aqu칤 puedes encontrar todos los m칠todos de autenticaci칩n que un usuario podr칤a utilizar: Contrase침a, tel칠fono, correo electr칩nico, c칩digo, WebAuthn... Al hacer clic en el autenticador de Contrase침a puedes ver la **pol칤tica de contrase침a**. Verifica que sea fuerte.

En la pesta침a de **Inscripci칩n** puedes ver cu치les son los requeridos u opcionales:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Se recomienda deshabilitar el Tel칠fono. Los m치s fuertes probablemente sean una combinaci칩n de contrase침a, correo electr칩nico y WebAuthn.

### Pol칤ticas de Autenticaci칩n

Cada aplicaci칩n tiene una pol칤tica de autenticaci칩n. La pol칤tica de autenticaci칩n verifica que los usuarios que intentan iniciar sesi칩n en la aplicaci칩n cumplan condiciones espec칤ficas, y hace cumplir los requisitos de factor basados en esas condiciones.

Aqu칤 puedes encontrar los **requisitos para acceder a cada aplicaci칩n**. Se recomienda solicitar al menos una contrase침a y otro m칠todo para cada aplicaci칩n. Pero si como atacante encuentras algo m치s d칠bil, podr칤as intentar atacarlo.
### Pol칤tica de Sesi칩n Global

Aqu칤 puedes encontrar las pol칤ticas de sesi칩n asignadas a diferentes grupos. Por ejemplo:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Se recomienda solicitar MFA, limitar la duraci칩n de la sesi칩n a algunas horas, no persistir cookies de sesi칩n en extensiones de navegador y limitar la ubicaci칩n y el Proveedor de Identidad (si es posible). Por ejemplo, si cada usuario debe iniciar sesi칩n desde un pa칤s, solo podr칤as permitir esta ubicaci칩n.

### Proveedores de Identidad

Los Proveedores de Identidad (IdPs) son servicios que **gestionan cuentas de usuario**. Agregar IdPs en Okta permite que tus usuarios finales **se registren por s칤 mismos** en tus aplicaciones personalizadas autentic치ndose primero con una cuenta social o una tarjeta inteligente.

En la p치gina de Proveedores de Identidad, puedes agregar inicio de sesi칩n social (IdPs) y configurar Okta como un proveedor de servicios (SP) agregando SAML entrante. Despu칠s de haber agregado IdPs, puedes configurar reglas de enrutamiento para dirigir a los usuarios a un IdP basado en el contexto, como la ubicaci칩n del usuario, el dispositivo o el dominio de correo electr칩nico.

**Si se configura alg칰n proveedor de identidad** desde el punto de vista de atacantes y defensores, verifica esa configuraci칩n y **si la fuente es realmente confiable** ya que un atacante que la comprometa tambi칠n podr칤a acceder al entorno de Okta.

### Autenticaci칩n Delegada

La autenticaci칩n delegada permite a los usuarios iniciar sesi칩n en Okta ingresando credenciales para el **Directorio Activo (AD) o LDAP** de su organizaci칩n.

Nuevamente, verifica esto, ya que un atacante que comprometa el AD de una organizaci칩n podr칤a ser capaz de pivotar a Okta gracias a esta configuraci칩n.

### Red

Una zona de red es un l칤mite configurable que puedes usar para **conceder o restringir acceso a computadoras y dispositivos** en tu organizaci칩n basado en la **direcci칩n IP** que solicita acceso. Puedes definir una zona de red especificando una o m치s direcciones IP individuales, rangos de direcciones IP o ubicaciones geogr치ficas.

Despu칠s de definir una o m치s zonas de red, puedes **utilizarlas en las Pol칤ticas de Sesi칩n Global**, **pol칤ticas de autenticaci칩n**, notificaciones de VPN y **reglas de enrutamiento**.

Desde la perspectiva de un atacante, es interesante saber qu칠 IPs est치n permitidas (y verificar si alguna **IP tiene m치s privilegios** que otras). Desde la perspectiva de un atacante, si los usuarios deben acceder desde una direcci칩n IP o regi칩n espec칤fica, verifica que esta funci칩n se est칠 utilizando correctamente.

### Integraciones de Dispositivos

* **Gesti칩n de Puntos Finales**: La gesti칩n de puntos finales es una condici칩n que se puede aplicar en una pol칤tica de autenticaci칩n para garantizar que los dispositivos gestionados tengan acceso a una aplicaci칩n.
* No he visto esto utilizado a칰n. POR HACER
* **Servicios de Notificaci칩n**: No he visto esto utilizado a칰n. POR HACER

### API

Puedes crear tokens de API de Okta en esta p치gina y ver los que han sido **creados**, sus **privilegios**, **tiempo de expiraci칩n** y **URLs de Origen**. Ten en cuenta que los tokens de API se generan con los permisos del usuario que cre칩 el token y solo son v치lidos si el **usuario** que los cre칩 est치 **activo**.

Los **Or칤genes de Confianza** otorgan acceso a sitios web que controlas y en los que conf칤as para acceder a tu organizaci칩n de Okta a trav칠s de la API de Okta.

No deber칤a haber muchos tokens de API, ya que si hay muchos, un atacante podr칤a intentar acceder a ellos y utilizarlos.

## Flujo de Trabajo

### Automatizaciones

Las automatizaciones te permiten crear acciones automatizadas que se ejecutan en funci칩n de un conjunto de condiciones de activaci칩n que ocurren durante el ciclo de vida de los usuarios finales.

Por ejemplo, una condici칩n podr칤a ser "Inactividad del usuario en Okta" o "Caducidad de la contrase침a del usuario en Okta" y la acci칩n podr칤a ser "Enviar correo electr칩nico al usuario" o "Cambiar estado del ciclo de vida del usuario en Okta".

## Informes

### Informes

Descarga registros. Se **env칤an** a la **direcci칩n de correo electr칩nico** de la cuenta actual.

### Registro del Sistema

Aqu칤 puedes encontrar los **registros de las acciones realizadas por los usuarios** con muchos detalles como inicio de sesi칩n en Okta o en aplicaciones a trav칠s de Okta.

### Monitoreo de Importaci칩n

Esto puede **importar registros de otras plataformas** accedidas con Okta.

### L칤mites de Tasa

Verifica los l칤mites de tasa de la API alcanzados.

## Configuraciones

### Cuenta

Aqu칤 puedes encontrar **informaci칩n gen칠rica** sobre el entorno de Okta, como el nombre de la empresa, direcci칩n, **contacto de facturaci칩n por correo electr칩nico**, **contacto t칠cnico por correo electr칩nico** y tambi칠n qui칠n deber칤a recibir actualizaciones de Okta y qu칠 tipo de actualizaciones de Okta.

### Descargas

Aqu칤 puedes descargar agentes de Okta para sincronizar Okta con otras tecnolog칤as.
