# Okta 加固

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您希望在 **HackTricks** 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>

## 目录

### 人员

从攻击者的角度来看，这非常有趣，因为您可以看到**所有注册的用户**、他们的**电子邮件**地址、他们所在的**群组**、**个人资料**，甚至是**设备**（包括他们的操作系统）。

对于白盒审查，请检查是否有多个“**待处理的用户操作**”和“**密码重置**”。

### 群组

这里可以找到 Okta 中创建的所有群组。了解不同群组（一组**权限**）可能授予**用户**是很有趣的。\
可以看到**群组内包含的人员**和分配给每个群组的**应用程序**。

当然，任何名为**管理员**的群组都很有趣，特别是**全球管理员**群组，检查成员以了解谁是最有特权的成员。

从白盒审查来看，**全球管理员不应超过 5 个**（如果只有 2 或 3 个更好）。

### 设备

在这里可以找到所有用户的**设备列表**。您还可以看到它是否正在**积极管理**。

### 配置文件编辑器

在这里可以观察到诸如名字、姓氏、电子邮件、用户名等关键信息如何在 Okta 和其他应用程序之间共享。这很有趣，因为如果用户可以在 Okta 中**修改字段**（例如他的姓名或电子邮件），然后被**外部应用程序**用来**识别**用户，内部人员可能会尝试**接管其他账户**。

此外，在 Okta 的**`用户（默认）`**配置文件中，您可以看到每个**用户**拥有哪些字段以及哪些字段是**用户可写**的。如果您看不到管理面板，只需转到**更新您的个人资料**信息，您将看到您可以更新哪些字段（请注意，要更新电子邮件地址，您需要验证它）。

### 目录集成

目录允许您从现有来源导入人员。我猜在这里您会看到从其他目录导入的用户。

我还没有看到它，但我猜这对于找出 Okta 正在使用哪些**其他目录来导入用户**很有趣，所以如果您**破坏了那个目录**，您可以在 Okta 中创建的用户中设置一些属性值，并且**可能危及 Okta 环境**。

### 配置文件来源

配置文件来源是一个**应用程序，充当用户配置文件属性的真实来源**。一个用户一次只能由一个应用程序或目录来源。

我还没有看到它，所以任何关于这个选项的安全和黑客方面的信息都很受欢迎。

## 自定义

### 品牌

在此部分的**域**标签中检查用于发送电子邮件的电子邮件地址和公司内部的 Okta 自定义域（您可能已经知道）。

此外，在**设置**标签中，如果您是管理员，您可以“**使用自定义登出页面**”并设置自定义 URL。

### 短信

这里没有什么有趣的。

### 最终用户仪表板

您可以在这里找到配置的应用程序，但我们将在不同的部分中详细查看这些应用程序。

### 其他

有趣的设置，但从安全角度来看没有什么特别有趣的。

## 应用程序

### 应用程序

在这里，您可以找到所有**配置的应用程序**及其详细信息：谁可以访问它们，它们是如何配置的（SAML，OPenID），登录 URL，Okta 与应用程序之间的映射...

在**`登录`**标签中还有一个名为**`密码显示`**的字段，它允许用户在检查应用程序设置时**显示他的密码**。要从用户面板检查应用程序的设置，请点击 3 个点：

<figure><img src="../../.gitbook/assets/image (4) (7).png" alt=""><figcaption></figcaption></figure>

您可以看到有关应用程序的更多详细信息（例如密码显示功能，如果启用了）：

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## 身份治理

### 访问认证

使用访问认证创建审计活动，定期审查用户对资源的访问，并在需要时自动批准或撤销访问。

我还没有看到它被使用，但我猜从防御角度来看这是一个不错的功能。

## 安全

### 通用

* **安全通知电子邮件**：所有应该启用。
* **验证码集成**：建议至少设置不可见的 reCaptcha
* **组织安全**：一切都可以启用，激活电子邮件不应持续太久（7 天就可以）
* **用户枚举预防**：两者都应该启用
* 请注意，如果允许以下任一条件，则用户枚举预防不会生效（有关更多信息，请参见[用户管理](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm)）：
* 自助服务注册
* 使用电子邮件认证的 JIT 流程
* **Okta ThreatInsight 设置**：根据威胁级别记录并执行安全操作
### HealthInsight

在这里可以找到正确配置的和**危险**配置的**设置**。

### Authenticators

在这里，您可以找到用户可以使用的所有身份验证方法：密码、电话、电子邮件、代码、WebAuthn... 点击密码验证器，您可以看到**密码策略**。检查它是否足够强大。

在**注册**标签中，您可以看到哪些是必需的或可选的：

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

建议禁用电话。最强的可能是密码、电子邮件和WebAuthn的组合。

### Authentication policies

每个应用都有一个身份验证策略。身份验证策略验证尝试登录应用的用户是否满足特定条件，并根据这些条件强制执行因素要求。

在这里，您可以找到**访问每个应用程序的要求**。建议至少要求每个应用程序的密码和另一种方法。但是，如果作为攻击者，您发现了更弱的东西，您可能能够攻击它。

### Global Session Policy

在这里，您可以找到分配给不同组的会话策略。例如：

<figure><img src="../../.gitbook/assets/image (2) (1) (2).png" alt=""><figcaption></figcaption></figure>

建议要求MFA，将会话生命周期限制为几个小时，不要在浏览器扩展中持久化会话cookie，并限制位置和身份提供者（如果可能的话）。例如，如果每个用户都应该从一个国家登录，您可以只允许这个位置。

### Identity Providers

身份提供者（IdPs）是**管理用户帐户**的服务。在Okta中添加IdPs可以使您的最终用户通过首先使用社交帐户或智能卡进行身份验证，来**自行注册**您的自定义应用程序。

在身份提供者页面上，您可以添加社交登录（IdPs）并通过添加入站SAML将Okta配置为服务提供商（SP）。添加IdPs后，您可以设置路由规则，根据上下文将用户引导到IdP，例如用户的位置、设备或电子邮件域。

**如果配置了任何身份提供者**，从攻击者和防御者的角度检查该配置，**并确认来源是否真的可信**，因为攻击者危及它也可能获得对Okta环境的访问权限。

### Delegated Authentication

委派身份验证允许用户通过输入其组织的**Active Directory (AD) 或 LDAP**服务器的凭据来登录Okta。

同样，再次检查这一点，因为攻击者危及组织的AD可能能够借助此设置转移到Okta。

### Network

网络区域是一个可配置的边界，您可以使用它根据请求访问的**IP地址**来**授予或限制对计算机和设备的访问**。您可以通过指定一个或多个单独的IP地址、IP地址范围或地理位置来定义网络区域。

定义一个或多个网络区域后，您可以在全局会话策略、**身份验证策略**、VPN通知和**路由规则**中使用它们。

从攻击者的角度来看，了解哪些IP被允许（并检查是否有任何**IP比其他IP有更多特权**）是有趣的。从攻击者的角度来看，如果用户应该从特定的IP地址或地区访问，请检查此功能是否得到正确使用。

### Device Integrations

* **Endpoint Management**: 端点管理是可以在身份验证策略中应用的条件，以确保管理设备可以访问应用程序。
* 我还没有看到这个被使用。待办事项
* **Notification services**: 我还没有看到这个被使用。待办事项

### API

您可以在此页面创建Okta API令牌，并查看已经**创建**的令牌，它们的**权限**、**过期**时间和**来源URL**。请注意，API令牌是以创建令牌的用户的权限生成的，只有在**创建它们的用户**处于**活跃**状态时才有效。

**Trusted Origins**授予您控制并信任的网站通过Okta API访问您的Okta组织的访问权限。

不应该有很多API令牌，因为如果有，攻击者可能会尝试访问并使用它们。

## Workflow

### Automations

自动化允许您创建基于在最终用户生命周期期间发生的一组触发条件的自动化操作。

例如，条件可以是“Okta中的用户不活跃”或“Okta中的用户密码过期”，操作可以是“向用户发送电子邮件”或“更改Okta中的用户生命周期状态”。

## Reports

### Reports

下载日志。它们被**发送**到当前帐户的**电子邮件地址**。

### System Log

在这里，您可以找到用户执行的**操作日志**，包括登录Okta或通过Okta登录应用程序的详细信息。

### Import Monitoring

这可以**从其他平台导入日志**，这些平台通过Okta访问。

### Rate limits

检查已达到的API速率限制。

## Settings

### Account

在这里，您可以找到有关Okta环境的**一般信息**，例如公司名称、地址、**电子邮件账单联系人**、**电子邮件技术联系人**，以及谁应该接收Okta更新以及哪种类型的Okta更新。

### Downloads

在这里，您可以下载Okta代理以将Okta与其他技术同步。

<details>

<summary><strong>从零到英雄学习AWS黑客攻击</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**以PDF格式下载HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs**](https://opensea.io/collection/the-peass-family)系列
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
