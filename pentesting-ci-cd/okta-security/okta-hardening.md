# Zabezpieczanie Okta

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Katalog

### Osoby

Z perspektywy atakującego jest to bardzo interesujące, ponieważ będziesz mógł zobaczyć **wszystkich zarejestrowanych użytkowników**, ich **adresy e-mail**, **grupy**, do których należą, **profile** i nawet **urządzenia** (telefony komórkowe wraz z ich systemami operacyjnymi).

Podczas przeglądu whiteboxowego sprawdź, czy nie ma kilku "**Oczekujących działań użytkownika**" i "**Resetów hasła**".

### Grupy

To jest miejsce, gdzie znajdziesz wszystkie utworzone grupy w Okta. Interesujące jest zrozumienie różnych grup (zestaw **uprawnień**), które mogą być przyznane **użytkownikom**.\
Można zobaczyć **osoby zawarte w grupach** i **przypisane aplikacje** do każdej grupy.

Oczywiście, każda grupa o nazwie **admin** jest interesująca, zwłaszcza grupa **Global Administrators**, sprawdź członków, aby dowiedzieć się, kto ma największe uprawnienia.

Podczas przeglądu whiteboxowego **nie powinno być więcej niż 5 globalnych administratorów** (lepiej, jeśli jest ich tylko 2 lub 3).

### Urządzenia

Znajdź tutaj **listę wszystkich urządzeń** wszystkich użytkowników. Można również zobaczyć, czy jest ono **aktywnie zarządzane** czy nie.

### Edytor profilu

Tutaj można zobaczyć, jak kluczowe informacje, takie jak imiona, nazwiska, adresy e-mail, nazwy użytkowników... są udostępniane między Okta a innymi aplikacjami. Jest to interesujące, ponieważ jeśli użytkownik może **zmodyfikować w Okta pole** (takie jak jego imię lub adres e-mail), które następnie jest używane przez **zewnętrzną aplikację** do **identyfikacji** użytkownika, wewnętrzny użytkownik może próbować **przejąć inne konta**.

Ponadto, w profilu **`Użytkownik (domyślny)`** z Okta można zobaczyć, **jakie pola** ma każdy **użytkownik** i które z nich są **edytowalne** przez użytkowników. Jeśli nie widzisz panelu administratora, przejdź do **aktualizacji informacji o swoim profilu**, a zobaczysz, które pola możesz zaktualizować (zauważ, że aby zaktualizować adres e-mail, trzeba go zweryfikować).

### Integracje katalogów

Katalogi umożliwiają importowanie osób z istniejących źródeł. Przypuszczam, że tutaj zobaczysz użytkowników importowanych z innych katalogów.

Nie widziałem tego, ale przypuszczam, że jest to interesujące, aby dowiedzieć się, **jakie inne katalogi Okta używa do importowania użytkowników**, więc jeśli **skompromitujesz ten katalog**, możesz ustawić wartości atrybutów w użytkownikach utworzonych w Okta i **może skompromitować środowisko Okta**.

### Źródła profilu

Źródło profilu to **aplikacja, która działa jako źródło prawdy** dla atrybutów profilu użytkownika. Użytkownik może być źródłowy tylko dla jednej aplikacji lub katalogu w danym czasie.

Nie widziałem tego, więc wszelkie informacje dotyczące bezpieczeństwa i hakowania w tej opcji są mile widziane.

## Dostosowania

### Marki

Sprawdź w zakładce **Domeny** tej sekcji adresy e-mail używane do wysyłania wiadomości e-mail i niestandardową domenę wewnątrz Okta firmy (którą prawdopodobnie już znasz).

Ponadto, w zakładce **Ustawienia**, jeśli jesteś administratorem, możesz "**Użyj niestandardowej strony wylogowania**" i ustawić niestandardowy adres URL.

### SMS

Nic interesującego tutaj.

### Panel użytkownika końcowego

Tutaj można znaleźć skonfigurowane aplikacje, ale szczegóły na ich temat zobaczymy później w innej sekcji.

### Inne

Interesujące ustawienie, ale nic super interesującego z punktu widzenia bezpieczeństwa.

## Aplikacje

### Aplikacje

Tutaj można znaleźć wszystkie **skonfigurowane aplikacje** i ich szczegóły: Kto ma do nich dostęp, jak jest skonfigurowane (SAML, OPenID), URL do logowania, mapowanie między Okta a aplikacją...

W zakładce **`Logowanie`** znajduje się również pole o nazwie **`Ujawnienie hasła`**, które umożliwia użytkownikowi **ujawnienie swojego hasła** podczas sprawdzania ustawień aplikacji. Aby sprawdzić ustawienia aplikacji z panelu użytkownika, kliknij trzy kropki:

<figure><img src="../../.gitbook/assets/image (4) (7).png" alt=""><figcaption></figcaption></figure>

I można zobaczyć więcej szczegółów na temat aplikacji (takich jak funkcja ujawniania hasła, jeśli jest włączona):

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## Zarządzanie tożsamością

### Certyfikaty dostępu

Użyj Certyfikatów dostępu, aby tworzyć kampanie audytowe w celu okresowego przeglądu dostępu użytkowników do zasobów i automatycznego zatwierdzania lub cofania dostępu, gdy jest to wymagane.

Nie widziałem tego używanego, ale przypuszczam, że z perspektywy obronnej jest to przydatna funkcja.

## Bezpieczeństwo

### Ogólne

* **E-maile z powiadomieniami o bezpieczeństwie**: Wszystkie powinny być włączone.
* **Integracja CAPTCHA**: Zaleca się ustawienie co najmniej niewidocznego reCaptcha
* **Bezpieczeństwo organizacji**: Wszystko można włączyć, a e-maile aktywacyjne nie powinny być długotrwałe (7 dni jest ok)
* **Zapobieganie wyliczaniu użytkowników**: Oba powinny być włączone
* Zauważ, że Zapobieganie wyliczaniu użytkowników nie działa, jeśli dozwolone są któreś z następujących warunków (Zobacz [Zarządzanie użytkownikami](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) dla więcej informacji):
* Rejestracja samoobsługowa
* Przepływy JIT z uwierzytelnianiem e-mail
* **Ustawienia Okta ThreatInsight**: Rejestruj i egzekwuj zabezpieczenia na podstawie poziomu zagrożenia

### HealthInsight

Tutaj można znaleźć poprawnie i **niebezpiecznie** skonfigurowane **ustawienia**.

### Autentykatory

Tutaj można znaleźć wszystkie metody uwierzytelniania, które użytk
### Globalna polityka sesji

Tutaj można znaleźć polityki sesji przypisane do różnych grup. Na przykład:

<figure><img src="../../.gitbook/assets/image (2) (1) (2).png" alt=""><figcaption></figcaption></figure>

Zaleca się żądanie MFA, ograniczenie czasu trwania sesji do kilku godzin, niezachowywanie ciasteczek sesji w rozszerzeniach przeglądarki oraz ograniczenie lokalizacji i dostawcy tożsamości (jeśli to możliwe). Na przykład, jeśli każdy użytkownik powinien logować się z określonego kraju, można zezwolić tylko na tę lokalizację.

### Dostawcy tożsamości

Dostawcy tożsamości (IdP) to usługi, które **zarządzają kontami użytkowników**. Dodanie IdP w Okta umożliwia końcowym użytkownikom **samodzielne rejestrację** w Twoich niestandardowych aplikacjach, logując się najpierw za pomocą konta społecznościowego lub karty inteligentnej.

Na stronie Dostawcy tożsamości można dodać logowanie za pomocą kont społecznościowych (IdP) i skonfigurować Okta jako dostawcę usług (SP), dodając przychodzący protokół SAML. Po dodaniu IdP można skonfigurować reguły routingu, aby kierować użytkowników do IdP na podstawie kontekstu, takiego jak lokalizacja użytkownika, urządzenie lub domena e-mail.

**Jeśli skonfigurowano jakiegokolwiek dostawcę tożsamości**, z punktu widzenia atakującego i obrońcy należy sprawdzić tę konfigurację i **czy źródło jest naprawdę godne zaufania**, ponieważ atakujący, przejmując je, może uzyskać dostęp do środowiska Okta.

### Delegowane uwierzytelnianie

Delegowane uwierzytelnianie umożliwia użytkownikom logowanie się do Okta, wprowadzając dane uwierzytelniające dla **Aktywnego Katalogu (AD) lub serwera LDAP** ich organizacji.

Ponownie sprawdź to, ponieważ atakujący, przejmując AD organizacji, może uzyskać dostęp do Okta dzięki tej konfiguracji.

### Sieć

Strefa sieciowa to konfigurowalne ograniczenie, które można użyć do **udzielania lub ograniczania dostępu do komputerów i urządzeń** w Twojej organizacji na podstawie **adresu IP**, który żąda dostępu. Można zdefiniować strefę sieciową, określając jeden lub więcej indywidualnych adresów IP, zakresy adresów IP lub lokalizacje geograficzne.

Po zdefiniowaniu jednej lub więcej stref sieciowych można **używać ich w globalnych politykach sesji**, politykach uwierzytelniania, powiadomieniach VPN i regułach routingu.

Z perspektywy atakującego interesujące jest, które Ps są dozwolone (i sprawdzenie, czy jakiekolwiek **adresy IP mają większe uprawnienia** niż inne). Z perspektywy atakującego, jeśli użytkownicy powinni mieć dostęp z określonego adresu IP lub regionu, sprawdź, czy ta funkcja jest prawidłowo używana.

### Integracje urządzeń

* **Zarządzanie punktami końcowymi**: Zarządzanie punktami końcowymi to warunek, który można zastosować w polityce uwierzytelniania, aby zapewnić, że zarządzane urządzenia mają dostęp do aplikacji.
* Jeszcze nie widziałem, żeby to było używane. TODO
* **Usługi powiadomień**: Jeszcze nie widziałem, żeby to było używane. TODO

### API

Na tej stronie można tworzyć tokeny API Okta i zobaczyć te, które zostały **utworzone**, ich **uprawnienia**, **czas wygaśnięcia** i **adresy URL pochodzenia**. Należy zauważyć, że tokeny API są generowane z uprawnieniami użytkownika, który je utworzył, i są ważne tylko wtedy, gdy **użytkownik**, który je utworzył, jest **aktywny**.

**Zaufane pochodzenie** umożliwia dostęp do stron internetowych, które kontrolujesz i którym ufasz, do Twojej organizacji Okta za pośrednictwem interfejsu API Okta.

Nie powinno być zbyt wielu tokenów API, ponieważ atakujący może próbować uzyskać do nich dostęp i ich użyć.

## Workflow

### Automatyzacje

Automatyzacje umożliwiają tworzenie automatycznych działań, które są wykonywane na podstawie zestawu warunków wyzwalających, które występują podczas cyklu życia użytkowników końcowych.

Na przykład warunkiem może być "Brak aktywności użytkownika w Okta" lub "Wygaśnięcie hasła użytkownika w Okta", a działaniem może być "Wysłanie wiadomości e-mail do użytkownika" lub "Zmiana stanu cyklu życia użytkownika w Okta".

## Raporty

### Raporty

Pobierz logi. Są **wysyłane** na **adres e-mail** bieżącego konta.

### Dziennik systemowy

Tutaj można znaleźć **logi działań wykonywanych przez użytkowników** z wieloma szczegółami, takimi jak logowanie do Okta lub do aplikacji za pośrednictwem Okta.

### Monitorowanie importu

Można **importować logi z innych platform**, do których uzyskano dostęp za pomocą Okta.

### Limity szybkości

Sprawdź osiągnięte limity szybkości API.

## Ustawienia

### Konto

Tutaj można znaleźć **ogólne informacje** o środowisku Okta, takie jak nazwa firmy, adres, **kontakt rozliczeniowy e-mail**, **kontakt techniczny e-mail**, a także informacje o tym, kto powinien otrzymywać aktualizacje Okta i jakiego rodzaju aktualizacje Okta.

### Pobrania

Tutaj można pobrać agentów Okta do synchronizacji z innymi technologiami.

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
