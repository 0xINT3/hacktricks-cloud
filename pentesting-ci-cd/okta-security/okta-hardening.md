# Okta 강화

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

## 디렉터리

### 사용자

공격자의 관점에서 이는 **등록된 모든 사용자**, **이메일** 주소, **그룹**에 속한 사용자, **프로필** 및 심지어 **기기**(모바일 및 해당 운영 체제)를 볼 수 있게 해줍니다.

화이트박스 검토에서는 "**보류 중인 사용자 작업**" 및 "**비밀번호 재설정**"이 여러 개 있는지 확인하세요.

### 그룹

Okta에서 생성된 모든 그룹을 찾을 수 있습니다. **사용자**에게 부여될 수 있는 **권한 집합**인 다른 그룹을 이해하는 데 흥미로울 것입니다.\
각 그룹에 포함된 **사람들**과 각 그룹에 **할당된 앱**을 볼 수 있습니다.

물론, **admin**이라는 이름의 그룹은 흥미로울 것이며, 특히 그룹 **Global Administrators**는 특권이 있는 멤버를 확인하기 위해 구성원을 확인하세요.

화이트박스 검토에서는 **글로벌 관리자가 5명 이상이 되지 않아야** 합니다(2명 또는 3명이면 더 좋습니다).

### 기기

모든 사용자의 **기기 목록**을 여기에서 찾을 수 있습니다. 또한 **활성 관리** 여부도 확인할 수 있습니다.

### 프로필 편집기

여기에서 Okta와 다른 애플리케이션 간에 이름, 성, 이메일, 사용자 이름 등과 같은 중요한 정보가 어떻게 공유되는지 확인할 수 있습니다. 이는 사용자가 Okta에서 필드(예: 이름 또는 이메일)를 수정한 다음 외부 애플리케이션이 사용자를 식별하는 데 사용하는 경우, 내부자가 다른 계정을 탈취하려고 시도할 수 있기 때문에 흥미로울 수 있습니다.

또한, Okta의 프로필 **`User (default)`**에서 각 **사용자**가 가지고 있는 **필드**와 사용자가 **수정 가능한 필드**를 볼 수 있습니다. 관리자 패널을 볼 수 없는 경우, **프로필 정보를 업데이트**하러 가면 어떤 필드를 업데이트할 수 있는지 확인할 수 있습니다(이메일 주소를 업데이트하려면 확인해야 함을 유의하세요).

### 디렉터리 통합

디렉터리를 사용하면 기존 소스에서 사람들을 가져올 수 있습니다. 다른 디렉터리에서 가져온 사용자를 볼 수 있을 것입니다.

보지 못했지만, Okta가 사용하는 **다른 디렉터리**를 찾는 것이 흥미로울 것입니다. 디렉터리를 **침해**하면 Okta에서 생성된 사용자의 속성 값을 설정할 수 있으므로 Okta 환경을 **침해**할 수 있습니다.

### 프로필 소스

프로필 소스는 사용자 프로필 속성의 진리의 원천으로 작동하는 **애플리케이션**입니다. 사용자는 한 번에 하나의 애플리케이션 또는 디렉터리에만 소스로 사용될 수 있습니다.

보지 못했으므로 이 옵션과 관련된 보안 및 해킹 정보에 대한 모든 정보가 환영됩니다.

## 사용자 정의

### 브랜드

이 섹션의 **도메인** 탭에서 이메일을 보내는 데 사용되는 이메일 주소와 회사의 Okta 내 사용자 정의 도메인을 확인할 수 있습니다(아마 이미 알고 있을 것입니다).

또한, **설정** 탭에서 관리자인 경우 "**사용자 정의 로그아웃 페이지 사용**"을 선택하고 사용자 정의 URL을 설정할 수 있습니다.

### SMS

여기에는 흥미로운 내용이 없습니다.

### 최종 사용자 대시보드

여기에서 구성된 애플리케이션을 찾을 수 있지만, 이후에 다른 섹션에서 이에 대한 자세한 내용을 볼 것입니다.

### 기타

흥미로운 설정이지만 보안 관점에서는 특별히 흥미로운 내용은 없습니다.

## 애플리케이션

### 애플리케이션

여기에서 **구성된 모든 애플리케이션**과 그 세부 정보를 찾을 수 있습니다: 누가 액세스할 수 있는지, 어떻게 구성되어 있는지(SAML, OPenID), 로그인할 URL, Okta와 애플리케이션 간의 매핑...

**`Sign On`** 탭에서는 애플리케이션 설정을 확인할 때 사용자가 **암호를 공개**할 수 있는 **`Password reveal`**이라는 필드도 있습니다. 사용자 패널에서 애플리케이션의 설정을 확인하려면 3개의 점을 클릭하세요:

<figure><img src="../../.gitbook/assets/image (4) (7).png" alt=""><figcaption></figcaption></figure>

그리고 앱에 대한 몇 가지 추가적인 세부 정보를 볼 수 있습니다(암호 공개 기능이 활성화되어 있는지 등):

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### 액세스 인증서

액세스 인증서를 사용하여 사용자의 리소스 액세스를 주기적으로 검토하고 필요할 때 자동으로 승인 또는 취소할 수 있는 감사 캠페인을 생성할 수 있습니다.

사용하지 않은 것 같지만, 방어적인 관점에서는 좋은 기능일 것입니다.

## 보안

### 일반

* **보안 알림 이메일**: 모두 활성화되어야 합니다.
* **CAPTCHA 통합**: 적어도 보이지 않는 reCaptcha를 설정하는 것이 좋습니다.
* **조직 보안**: 모두 활성화할 수 있으며, 활성화 이메일은 오래 지속되지 않아야 합니다(7일이 적당합니다).
* **사용자 열거 방지**: 두 가지 모두 활성화해야 합니다.
* 사용자 열거 방지는 다음 조건 중 하나라도 허용되는 경우 적용되지 않습니다(자세한 내용은 [사용자 관리](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm)를 참조하세요):
* 셀프 서비스 등록
* 이메일 인증을 사용하는 JIT 플로우
* **Ok
### 전역 세션 정책

여기에서는 다른 그룹에 할당된 세션 정책을 찾을 수 있습니다. 예를 들어:

<figure><img src="../../.gitbook/assets/image (2) (1) (2).png" alt=""><figcaption></figcaption></figure>

MFA를 요청하고 세션 수명을 몇 시간으로 제한하고, 브라우저 확장 프로그램 간에 세션 쿠키를 지속하지 않도록하고, 위치와 ID 공급자를 제한하는 것이 좋습니다 (이 경우 가능한 경우). 예를 들어, 모든 사용자가 특정 국가에서 로그인해야 하는 경우 해당 위치만 허용할 수 있습니다.

### ID 공급자

ID 공급자 (IdPs)는 **사용자 계정을 관리하는 서비스**입니다. Okta에 IdP를 추가하면 사용자가 소셜 계정이나 스마트 카드로 인증한 후 사용자 정의 애플리케이션에 **자체 등록**할 수 있습니다.

ID 공급자 페이지에서 소셜 로그인 (IdP)을 추가하고 인바운드 SAML을 추가하여 Okta를 서비스 제공자 (SP)로 구성할 수 있습니다. IdP를 추가한 후에는 사용자의 위치, 장치 또는 이메일 도메인과 같은 문맥에 따라 사용자를 IdP로 이동시키기 위해 라우팅 규칙을 설정할 수 있습니다.

**만약 어떤 ID 공급자가 구성되어 있다면**, 공격자와 방어자의 관점에서 해당 구성을 확인하고 **원본이 실제로 신뢰할 수 있는지** 확인하십시오. 공격자가 해당 ID 공급자를 침해하면 Okta 환경에도 액세스할 수 있습니다.

### 위임된 인증

위임된 인증을 사용하면 사용자는 자신의 조직의 **Active Directory (AD) 또는 LDAP** 서버 자격 증명을 입력하여 Okta에 로그인할 수 있습니다.

다시 한 번, 이 설정을 확인하십시오. 공격자가 조직의 AD를 침해하면이 설정을 통해 Okta로 피벗 할 수 있을 수 있습니다.

### 네트워크

네트워크 영역은 요청하는 **IP 주소**를 기반으로 조직의 컴퓨터 및 장치에 대한 액세스를 **허용하거나 제한**할 수 있는 구성 가능한 경계입니다. 하나 이상의 개별 IP 주소, IP 주소 범위 또는 지리적 위치를 지정하여 네트워크 영역을 정의할 수 있습니다.

하나 이상의 네트워크 영역을 정의한 후에는 전역 세션 정책, 인증 정책, VPN 알림 및 라우팅 규칙에서 **사용**할 수 있습니다.

공격자의 관점에서는 허용되는 Ps를 알아내는 것이 흥미로울 것입니다 (다른 **IP가 다른 것보다 더 권한이 있는지** 확인). 사용자가 특정 IP 주소 또는 지역에서 액세스해야하는 경우 이 기능이 올바르게 사용되었는지 확인하십시오.

### 장치 통합

* **Endpoint Management**: Endpoint management은 인증 정책에 적용할 수 있는 조건으로, 관리되는 장치가 애플리케이션에 액세스 할 수 있는지 확인합니다.
* 아직 사용된 것을 보지 못했습니다. TODO
* **알림 서비스**: 아직 사용된 것을 보지 못했습니다. TODO

### API

이 페이지에서 Okta API 토큰을 생성하고 생성된 토큰, 특권, 만료 시간 및 원본 URL을 볼 수 있습니다. API 토큰은 토큰을 생성한 사용자의 권한으로 생성되며, 토큰을 생성한 **사용자**가 **활성 상태**인 경우에만 유효합니다.

**신뢰할 수 있는 원본**은 Okta API를 통해 Okta 조직에 액세스할 수 있는 웹 사이트에 액세스 권한을 부여합니다.

API 토큰이 많이 있으면 공격자가 액세스하고 사용할 수 있으므로 많은 API 토큰이 없어야 합니다.

## 워크플로우

### 자동화

자동화를 사용하면 최종 사용자의 라이프사이클 동안 발생하는 일련의 트리거 조건에 따라 실행되는 자동화된 작업을 생성할 수 있습니다.

예를 들어 "Okta에서 사용자 비활성화" 또는 "Okta에서 사용자 비밀번호 만료"와 같은 조건이 있을 수 있으며, "사용자에게 이메일 보내기" 또는 "Okta에서 사용자 라이프사이클 상태 변경"과 같은 작업을 수행할 수 있습니다.

## 보고서

### 보고서

로그를 다운로드합니다. 현재 계정의 **이메일 주소**로 **전송**됩니다.

### 시스템 로그

여기에서는 Okta 또는 Okta를 통해 애플리케이션에 로그인하는 사용자의 작업 로그를 자세히 볼 수 있습니다.

### 가져오기 모니터링

Okta로 액세스하는 다른 플랫폼에서 로그를 가져올 수 있습니다.

### 요청 제한

도달한 API 요청 제한을 확인합니다.

## 설정

### 계정

회사 이름, 주소, **이메일 청구 연락처**, **이메일 기술 연락처** 및 Okta 업데이트를 받을 사람 및 Okta 업데이트 유형과 같은 Okta 환경에 대한 **일반 정보**를 찾을 수 있습니다.

### 다운로드

Okta 에이전트를 다운로드하여 Okta를 다른 기술과 동기화할 수 있습니다.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 제로에서 영웅까지 AWS 해킹 배우기<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사를 광고**하거나 **PDF로 HackTricks를 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 구매하세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFT**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를** 팔로우하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 **자신의 해킹 기법을 공유**하세요.

</details>
