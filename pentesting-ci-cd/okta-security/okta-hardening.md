# Renforcement d'Okta

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## R√©pertoire

### Personnes

Du point de vue d'un attaquant, c'est tr√®s int√©ressant car vous pourrez voir **tous les utilisateurs enregistr√©s**, leurs adresses **e-mail**, les **groupes** auxquels ils appartiennent, les **profils** et m√™me les **appareils** (mobiles avec leurs syst√®mes d'exploitation).

Pour une revue en bo√Æte blanche, v√©rifiez qu'il n'y a pas plusieurs "**Actions utilisateur en attente**" et "**R√©initialisations de mot de passe**".

### Groupes

C'est ici que vous trouverez tous les groupes cr√©√©s dans Okta. Il est int√©ressant de comprendre les diff√©rents groupes (ensemble de **permissions**) qui pourraient √™tre accord√©s aux **utilisateurs**.\
Il est possible de voir les **personnes incluses dans les groupes** et les **applications attribu√©es** √† chaque groupe.

Bien s√ªr, tout groupe portant le nom d'**admin** est int√©ressant, en particulier le groupe **Administrateurs globaux**, v√©rifiez les membres pour savoir qui sont les membres les plus privil√©gi√©s.

Dans le cadre d'une revue en bo√Æte blanche, il **ne devrait pas y avoir plus de 5 administrateurs globaux** (mieux s'il n'y en a que 2 ou 3).

### Appareils

Trouvez ici une **liste de tous les appareils** de tous les utilisateurs. Vous pouvez √©galement voir s'ils sont **g√©r√©s activement** ou non.

### √âditeur de profil

Il est possible d'observer comment des informations cl√©s telles que les pr√©noms, noms de famille, adresses e-mail, noms d'utilisateur... sont partag√©es entre Okta et d'autres applications. C'est int√©ressant car si un utilisateur peut **modifier dans Okta un champ** (comme son nom ou son adresse e-mail) qui est ensuite utilis√© par une **application externe** pour **identifier** l'utilisateur, un initi√© pourrait essayer de **prendre le contr√¥le d'autres comptes**.

De plus, dans le profil **`Utilisateur (par d√©faut)`** d'Okta, vous pouvez voir **quels champs** chaque **utilisateur** poss√®de et lesquels sont **modifiables** par les utilisateurs. Si vous ne pouvez pas voir le panneau d'administration, il suffit de **mettre √† jour vos informations de profil** et vous verrez quels champs vous pouvez mettre √† jour (notez que pour mettre √† jour une adresse e-mail, vous devrez la v√©rifier).

### Int√©grations de r√©pertoire

Les r√©pertoires vous permettent d'importer des personnes √† partir de sources existantes. Je suppose que vous verrez ici les utilisateurs import√©s √† partir d'autres r√©pertoires.

Je ne l'ai pas vu, mais je suppose que c'est int√©ressant de d√©couvrir **d'autres r√©pertoires qu'Okta utilise pour importer des utilisateurs** afin que si vous **compromettez ce r√©pertoire**, vous pourriez d√©finir certaines valeurs d'attributs dans les utilisateurs cr√©√©s dans Okta et **peut-√™tre compromettre l'environnement Okta**.

### Sources de profil

Une source de profil est une **application qui agit comme une source de v√©rit√©** pour les attributs de profil utilisateur. Un utilisateur ne peut √™tre sourc√© que par une seule application ou un seul r√©pertoire √† la fois.

Je ne l'ai pas vu, donc toute information sur la s√©curit√© et le piratage concernant cette option est appr√©ci√©e.

## Personnalisations

### Marques

V√©rifiez dans l'onglet **Domaines** de cette section les adresses e-mail utilis√©es pour envoyer des e-mails et le domaine personnalis√© √† l'int√©rieur d'Okta de l'entreprise (que vous connaissez probablement d√©j√†).

De plus, dans l'onglet **Param√®tres**, si vous √™tes administrateur, vous pouvez "**Utiliser une page de d√©connexion personnalis√©e**" et d√©finir une URL personnalis√©e.

### SMS

Rien d'int√©ressant ici.

### Tableau de bord utilisateur final

Vous pouvez trouver ici les applications configur√©es, mais nous verrons les d√©tails de celles-ci plus tard dans une section diff√©rente.

### Autre

Param√®tre int√©ressant, mais rien de super int√©ressant d'un point de vue s√©curit√©.

## Applications

### Applications

Ici, vous pouvez trouver toutes les **applications configur√©es** et leurs d√©tails : Qui y a acc√®s, comment c'est configur√© (SAML, OPenID), URL de connexion, les correspondances entre Okta et l'application...

Dans l'onglet **`Connexion`**, il y a aussi un champ appel√© **`R√©v√©lation de mot de passe`** qui permettrait √† un utilisateur de **r√©v√©ler son mot de passe** en v√©rifiant les param√®tres de l'application. Pour v√©rifier les param√®tres d'une application √† partir du panneau utilisateur, cliquez sur les 3 points :

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

Et vous pourriez voir quelques d√©tails suppl√©mentaires sur l'application (comme la fonction de r√©v√©lation de mot de passe, si elle est activ√©e) :

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Gouvernance de l'identit√©

### Certifications d'acc√®s

Utilisez les Certifications d'acc√®s pour cr√©er des campagnes d'audit afin de revoir p√©riodiquement l'acc√®s de vos utilisateurs aux ressources et d'approuver ou de r√©voquer l'acc√®s automatiquement lorsque n√©cessaire.

Je ne l'ai pas vu utilis√©, mais je suppose que d'un point de vue d√©fensif, c'est une fonctionnalit√© int√©ressante.

## S√©curit√©

### G√©n√©ral

* **E-mails de notification de s√©curit√©** : Tout devrait √™tre activ√©.
* **Int√©gration CAPTCHA** : Il est recommand√© de d√©finir au moins le reCaptcha invisible
* **S√©curit√© de l'organisation** : Tout peut √™tre activ√© et les e-mails d'activation ne devraient pas durer longtemps (7 jours c'est bien)
* **Pr√©vention de l'√©num√©ration des utilisateurs** : Les deux devraient √™tre activ√©s
* Notez que la Pr√©vention de l'√©num√©ration des utilisateurs n'a pas d'effet si l'une des conditions suivantes est autoris√©e (Voir [Gestion des utilisateurs](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) pour plus d'informations) :
* Enregistrement en libre-service
* Flux JIT avec authentification par e-mail
* **Param√®tres Okta ThreatInsight** : Journaliser et appliquer la s√©curit√© en fonction du niveau de menace

### HealthInsight

Ici, il est possible de trouver des **param√®tres** correctement et **dangereusement** configur√©s.

### Authentificateurs

Vous pouvez trouver ici tous les m√©thodes d'authentification qu'un utilisateur pourrait utiliser : Mot de passe, t√©l√©phone, e-mail, code, WebAuthn... En cliquant sur l'authentificateur de mot de passe, vous pouvez voir la **politique de mot de passe**. V√©rifiez qu'elle est forte.

Dans l'onglet **Inscription**, vous pouvez voir celles qui sont requises ou optionnelles :

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Il est recommand√© de d√©sactiver le t√©l√©phone. Les plus forts sont probablement une combinaison de mot de passe, e-mail et WebAuthn.

### Politiques d'authentification

Chaque application a une politique d'authentification. La politique d'authentification v√©rifie que les utilisateurs qui tentent de se connecter √† l'application remplissent des conditions sp√©cifiques, et elle impose des exigences de facteur en fonction de ces conditions.

Ici, vous pouvez trouver les **exigences pour acc√©der √† chaque application**. Il est recommand√© de demander au moins un mot de passe et une autre m√©thode pour chaque application. Mais si en tant qu'attaquant vous trouvez quelque chose de plus faible, vous pourriez peut-√™tre l'attaquer.
### Politique de session globale

Ici, vous pouvez trouver les politiques de session attribu√©es √† diff√©rents groupes. Par exemple :

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Il est recommand√© de demander une authentification multifactorielle (MFA), de limiter la dur√©e de la session √† quelques heures, de ne pas persister les cookies de session √† travers les extensions de navigateur et de limiter la localisation et le fournisseur d'identit√© (si cela est possible). Par exemple, si chaque utilisateur doit se connecter depuis un pays, vous pourriez uniquement autoriser cette localisation.

### Fournisseurs d'identit√©

Les fournisseurs d'identit√© (IdPs) sont des services qui **g√®rent les comptes d'utilisateurs**. Ajouter des IdPs dans Okta permet √† vos utilisateurs finaux de **s'auto-enregistrer** avec vos applications personnalis√©es en s'authentifiant d'abord avec un compte social ou une carte √† puce.

Sur la page des fournisseurs d'identit√©, vous pouvez ajouter des connexions sociales (IdPs) et configurer Okta en tant que fournisseur de services (SP) en ajoutant du SAML entrant. Apr√®s avoir ajout√© des IdPs, vous pouvez configurer des r√®gles de routage pour diriger les utilisateurs vers un IdP en fonction du contexte, tel que la localisation de l'utilisateur, le p√©riph√©rique ou le domaine de messagerie √©lectronique.

**Si un fournisseur d'identit√© est configur√©** du point de vue des attaquants et des d√©fenseurs, v√©rifiez cette configuration et **si la source est vraiment fiable**, car un attaquant compromettant cela pourrait √©galement acc√©der √† l'environnement Okta.

### Authentification d√©l√©gu√©e

L'authentification d√©l√©gu√©e permet aux utilisateurs de se connecter √† Okta en saisissant les informations d'identification du serveur **Active Directory (AD) ou LDAP** de leur organisation.

Encore une fois, v√©rifiez ceci, car un attaquant compromettant l'AD d'une organisation pourrait √™tre en mesure de pivoter vers Okta gr√¢ce √† ce param√®tre.

### R√©seau

Une zone r√©seau est une limite configurable que vous pouvez utiliser pour **accorder ou restreindre l'acc√®s aux ordinateurs et appareils** de votre organisation en fonction de l'**adresse IP** qui demande l'acc√®s. Vous pouvez d√©finir une zone r√©seau en sp√©cifiant une ou plusieurs adresses IP individuelles, des plages d'adresses IP ou des emplacements g√©ographiques.

Apr√®s avoir d√©fini une ou plusieurs zones r√©seau, vous pouvez **les utiliser dans les politiques de session globales**, les politiques d'authentification, les notifications VPN et les r√®gles de routage.

Du point de vue des attaquants, il est int√©ressant de savoir quels IPs sont autoris√©s (et v√©rifier si certains **IPs sont plus privil√©gi√©s** que d'autres). Du point de vue des attaquants, si les utilisateurs doivent acc√©der depuis une adresse IP ou une r√©gion sp√©cifique, v√©rifiez que cette fonctionnalit√© est utilis√©e correctement.

### Int√©grations de p√©riph√©riques

* **Gestion des points de terminaison** : La gestion des points de terminaison est une condition qui peut √™tre appliqu√©e dans une politique d'authentification pour garantir que les appareils g√©r√©s ont acc√®s √† une application.
* Je n'ai pas encore vu cela utilis√©. √Ä FAIRE
* **Services de notification** : Je n'ai pas encore vu cela utilis√©. √Ä FAIRE

### API

Vous pouvez cr√©er des jetons API Okta sur cette page, et voir ceux qui ont √©t√© **cr√©√©s**, leurs **privil√®ges**, leur **expiration** et leurs **URLs d'origine**. Notez que les jetons API sont g√©n√©r√©s avec les autorisations de l'utilisateur qui a cr√©√© le jeton et ne sont valides que si l'**utilisateur** qui les a cr√©√©s est **actif**.

Les **Origines de confiance** accordent l'acc√®s √† des sites Web que vous contr√¥lez et en lesquels vous avez confiance pour acc√©der √† votre organisation Okta via l'API Okta.

Il ne devrait pas y avoir beaucoup de jetons API, car s'il y en a, un attaquant pourrait essayer d'y acc√©der et de les utiliser.

## Flux de travail

### Automatisations

Les automatisations vous permettent de cr√©er des actions automatis√©es qui s'ex√©cutent en fonction d'un ensemble de conditions de d√©clenchement qui se produisent pendant le cycle de vie des utilisateurs finaux.

Par exemple, une condition pourrait √™tre "Inactivit√© de l'utilisateur dans Okta" ou "Expiration du mot de passe de l'utilisateur dans Okta" et l'action pourrait √™tre "Envoyer un e-mail √† l'utilisateur" ou "Changer l'√©tat du cycle de vie de l'utilisateur dans Okta".

## Rapports

### Rapports

T√©l√©chargez des journaux. Ils sont **envoy√©s** √† l'**adresse e-mail** du compte actuel.

### Journal syst√®me

Ici, vous pouvez trouver les **journaux des actions effectu√©es par les utilisateurs** avec de nombreux d√©tails comme la connexion √† Okta ou aux applications via Okta.

### Surveillance des importations

Cela peut **importer des journaux √† partir d'autres plateformes** accessibles avec Okta.

### Limites de taux

V√©rifiez les limites de taux d'API atteintes.

## Param√®tres

### Compte

Ici, vous pouvez trouver des **informations g√©n√©riques** sur l'environnement Okta, telles que le nom de l'entreprise, l'adresse, le **contact de facturation par e-mail**, le **contact technique par e-mail** et aussi qui devrait recevoir les mises √† jour Okta et quel type de mises √† jour Okta.

### T√©l√©chargements

Ici, vous pouvez t√©l√©charger des agents Okta pour synchroniser Okta avec d'autres technologies.
