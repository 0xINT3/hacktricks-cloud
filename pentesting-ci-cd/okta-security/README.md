# Bezpieczeństwo Okta

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

[Okta, Inc.](https://www.okta.com/) jest uznawana w sektorze zarządzania tożsamością i dostępem za swoje rozwiązania oprogramowania oparte na chmurze. Rozwiązania te mają na celu usprawnienie i zabezpieczenie uwierzytelniania użytkowników w różnych nowoczesnych aplikacjach. Są one przeznaczone nie tylko dla firm, które chcą chronić swoje poufne dane, ale także dla programistów zainteresowanych integracją kontroli tożsamości w aplikacje, usługi internetowe i urządzenia.

Flagowym produktem firmy Okta jest **Okta Identity Cloud**. Ta platforma obejmuje zestaw produktów, w tym między innymi:

- **Single Sign-On (SSO)**: Ułatwia dostęp użytkowników, umożliwiając użycie jednego zestawu danych logowania do wielu aplikacji.
- **Multi-Factor Authentication (MFA)**: Wzmacnia bezpieczeństwo, wymagając wielu form weryfikacji.
- **Lifecycle Management**: Automatyzuje procesy tworzenia, aktualizacji i dezaktywacji kont użytkowników.
- **Universal Directory**: Umożliwia scentralizowane zarządzanie użytkownikami, grupami i urządzeniami.
- **API Access Management**: Zabezpiecza i zarządza dostępem do interfejsów API.

Te usługi mają na celu wzmocnienie ochrony danych i usprawnienie dostępu użytkowników, poprawiając zarówno bezpieczeństwo, jak i wygodę. Wielofunkcyjność rozwiązań Okta sprawia, że są one popularnym wyborem w różnych branżach, korzystnym zarówno dla dużych przedsiębiorstw, małych firm, jak i indywidualnych programistów. Według ostatniej aktualizacji z września 2021 roku, Okta jest uznawana za prominentnego gracza na rynku zarządzania tożsamością i dostępem (IAM).

{% hint style="danger" %}
Głównym celem Okta jest konfiguracja dostępu różnym użytkownikom i grupom do zewnętrznych aplikacji. Jeśli uda ci się **skompromitować uprawnienia administratora w środowisku Okta**, bardzo prawdopodobne jest, że będziesz w stanie **skompromitować wszystkie inne platformy, których firma używa**.
{% endhint %}

{% hint style="success" %}
Aby przeprowadzić przegląd bezpieczeństwa środowiska Okta, powinieneś poprosić o **tylko do odczytu uprawnienia administratora**.
{% endhint %}

### Podsumowanie

Istnieją **użytkownicy** (którzy mogą być **przechowywani w Okta**, zalogowani z **skonfigurowanych dostawców tożsamości** lub uwierzytelniani za pomocą **Active Directory** lub LDAP).\
Ci użytkownicy mogą znajdować się w **grupach**.\
Istnieją również **uwierzytelnienia**: różne opcje uwierzytelniania, takie jak hasło i kilka metod dwuskładnikowego uwierzytelniania, takich jak WebAuthn, e-mail, telefon, okta verify (mogą być włączone lub wyłączone)...

Następnie są **aplikacje** zsynchronizowane z Okta. Każda aplikacja będzie miała pewne **mapowanie z Okta**, aby udostępnić informacje (takie jak adresy e-mail, imiona...). Ponadto, każda aplikacja musi znajdować się w **polityce uwierzytelniania**, która określa **wymagane uwierzytelnienia** dla użytkownika, aby **uzyskać dostęp** do aplikacji.

{% hint style="danger" %}
Najbardziej potężną rolą jest **Super Administrator**.

Jeśli atakujący skompromituje Okta z dostępem administratora, wszystkie **aplikacje ufające Okta** będą bardzo prawdopodobnie **skompromitowane**.
{% endhint %}

## Ataki

### Lokalizowanie portalu Okta

Zwykle portal firmy będzie znajdować się pod adresem **companyname.okta.com**. Jeśli nie, spróbuj prostych **wariacji** nazwy **companyname**. Jeśli nie możesz go znaleźć, możliwe jest również, że organizacja ma rekord **CNAME** o nazwie **`okta.companyname.com`**, który wskazuje na portal Okta.

### Logowanie do Okta za pomocą Kerberos

Jeśli jest aktywny **`companyname.kerberos.okta.com`**, **Kerberos jest używany do dostępu do Okta**, co zwykle omija **MFA** dla użytkowników **Windows**. Aby znaleźć użytkowników Okta uwierzytelnianych za pomocą Kerberos w AD, uruchom **`getST.py`** z **odpowiednimi parametrami**. Po uzyskaniu **biletu użytkownika AD**, **wstrzyknij** go do kontrolowanego hosta za pomocą narzędzi takich jak Rubeus lub Mimikatz, upewniając się, że **`clientname.kerberos.okta.com` znajduje się w strefie "Intranet" w opcjach internetowych**. Otwarcie określonego adresu URL powinno zwrócić odpowiedź JSON "OK", co wskazuje na zaakceptowanie biletu Kerberos i umożliwienie dostępu do pulpitu nawigacyjnego Okta.

Skompromitowanie **konta usługi Okta z uprawnieniami delegacji SPN umożliwia atak Silver Ticket**. Jednak użycie przez Okta **AES** do szyfrowania biletów wymaga posiadania klucza AES lub hasła w postaci tekstu jawnego. Użyj **`ticketer.py`**, aby wygenerować bilet dla użytkownika ofiary i dostarcz go za pomocą przeglądarki, aby uwierzytelnić się w Okta.

**Sprawdź atak na stronie [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers).**

### Przechwytywanie agenta Okta AD

Ta technika polega na **uzyskaniu dostępu do agenta Okta AD na serwerze**, który **synchronizuje użytkowników i obsługuje uwierzytelnianie**. Analizując i odszyfrowując konfiguracje w pliku **`OktaAgentService.exe.config`**, w szczególności AgentToken za pomocą **DPAPI**, atakujący może potencjalnie **przechwytywać i manipulować danymi uwierzytelniania**. Pozwala to nie tylko na **monitorowanie** i **przechwytywanie danych uwierzytelniania** użytkowników w postaci tekstu jawnego podczas procesu uwierzytelniania w Okta, ale także na **odpowiadanie na próby uwierzytelnienia**, umożliwiając tym samym nieautoryzowany dost
### Phishing Okta Portal with Evilgnix

W [**tym wpisie na blogu**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) wyjaśniono, jak przygotować kampanię phishingową przeciwko portalowi Okta.

### Atak na podszywanie się pod kolegę

**Atrybuty, które każdy użytkownik może mieć i modyfikować** (takie jak adres e-mail czy imię) można skonfigurować w Okta. Jeśli **aplikacja** ufa **atrybutowi** jako ID, który użytkownik może **modyfikować**, będzie on mógł **udawać innych użytkowników na tej platformie**.

Dlatego jeśli aplikacja ufa polu **`userName`**, prawdopodobnie nie będziesz w stanie go zmienić (ponieważ zazwyczaj nie można zmieniać tego pola), ale jeśli ufa na przykład polu **`primaryEmail`**, możesz go **zmienić na adres e-mail kolegi** i podszywać się pod niego (będziesz musiał mieć dostęp do tego adresu e-mail i zaakceptować zmianę).

Należy zauważyć, że to podszywanie zależy od konfiguracji każdej aplikacji. Skompromitowane zostaną tylko te, które ufały zmodyfikowanemu polu i akceptowały aktualizacje.\
Dlatego aplikacja powinna mieć to pole włączone, jeśli istnieje:

<figure><img src="../../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

Zauważyłem również inne aplikacje, które były podatne, ale nie miały tego pola w ustawieniach Okta (różne aplikacje są różnie skonfigurowane).

Najlepszym sposobem, aby dowiedzieć się, czy możesz podszyć się pod kogoś w każdej aplikacji, jest to wypróbować!

## Unikanie wykrywania zachowań <a href="#id-9fde" id="id-9fde"></a>

Polityki wykrywania zachowań w Okta mogą być nieznane do momentu napotkania, ale **ominięcie** ich można osiągnąć, **celując bezpośrednio w aplikacje Okta**, omijając główny pulpit Okta. Za pomocą **tokena dostępu Okta** odtwórz token na **adresie URL aplikacji Okta** zamiast na stronie logowania.

Główne zalecenia obejmują:

* **Unikaj korzystania** z popularnych serwerów proxy i usług VPN anonimizujących podczas odtwarzania przechwyconych tokenów dostępu.
* Upewnij się, że **ciągi agentów użytkownika** są spójne między klientem a odtwarzanymi tokenami dostępu.
* **Powstrzymaj się od odtwarzania** tokenów różnych użytkowników z tego samego adresu IP.
* Ostrożnie odtwarzaj tokeny na pulpicie Okta.
* Jeśli znasz adresy IP firmy ofiary, **ogranicz ruch** do tych adresów IP lub ich zakresu, blokując cały inny ruch.

## Zabezpieczanie Okta

Okta ma wiele możliwych konfiguracji, na tej stronie dowiesz się, jak je przeglądać, aby były jak najbardziej bezpieczne:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Odnośniki

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
