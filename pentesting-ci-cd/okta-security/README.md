# Usalama wa Okta

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi mtaalamu na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalamu wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Taarifa Msingi

[Okta, Inc.](https://www.okta.com/) inatambulika katika sekta ya usimamizi wa kitambulisho na ufikiaji kwa suluhisho zake za programu zilizotegemea wingu. Suluhisho hizi zimedhamiriwa kusaidia na kusimamia uthibitishaji wa mtumiaji kwa njia salama kwenye programu za kisasa. Zinahudumia si tu kampuni zinazolenga kulinda data zao nyeti bali pia watengenezaji wanaopenda kuingiza udhibiti wa kitambulisho kwenye programu, huduma za wavuti, na vifaa.

Bidhaa kuu kutoka Okta ni **Okta Identity Cloud**. Jukwaa hili linajumuisha mkusanyiko wa bidhaa, ikiwa ni pamoja na lakini sio tu:

- **Uingiaji wa Moja (SSO)**: Unarahisisha ufikiaji wa mtumiaji kwa kuruhusu seti moja ya vitambulisho vya kuingia kwenye programu nyingi.
- **Uthibitishaji wa Faktori Mbalimbali (MFA)**: Unaboresha usalama kwa kuhitaji aina nyingi za uthibitishaji.
- **Usimamizi wa Mzunguko wa Maisha**: Unahakikisha uundaji wa akaunti ya mtumiaji, sasisha, na mchakato wa kufuta.
- **Mwongozo wa Universal**: Unawezesha usimamizi wa kati wa watumiaji, vikundi, na vifaa.
- **Usimamizi wa Ufikiaji wa API**: Unalinda na kusimamia ufikiaji wa APIs.

Huduma hizi zinalenga kufanya ulinzi wa data kuwa imara na kusaidia ufikiaji wa mtumiaji, kuboresha usalama na urahisi. Uteuzi wa suluhisho za Okta unafanya iwe chaguo maarufu katika viwanda mbalimbali, ikiwa ni faida kwa makampuni makubwa, kampuni ndogo, na watengenezaji binafsi pia. Kufikia sasisho la mwisho mwezi Septemba 2021, Okta inatambuliwa kama kampuni inayoongoza katika uga wa Usimamizi wa Kitambulisho na Ufikiaji (IAM).

{% hint style="danger" %}
Lengo kuu la Okta ni kusanidi ufikiaji kwa watumiaji na vikundi tofauti kwenye programu za nje. Ikiwa utafanikiwa **kudukua mamlaka ya msimamizi katika mazingira ya Okta**, huenda ukaweza **kudukua kwa kiwango kikubwa majukwaa mengine yote ambayo kampuni inatumia**.
{% endhint %}

{% hint style="success" %}
Kufanya ukaguzi wa usalama wa mazingira ya Okta unapaswa kuomba **ufikiaji wa kusoma tu wa msimamizi**.
{% endhint %}

### Muhtasari

Kuna **watumiaji** (ambao wanaweza **kuhifadhiwa ndani ya Okta**, kuingia kutoka **Watoa Kitambulisho walioconfigurewa** au kuthibitishwa kupitia **Active Directory** au LDAP).\
Watumiaji hawa wanaweza kuwa ndani ya **vikundi**.\
Pia kuna **uthibitishaji**: chaguzi tofauti za kuthibitisha kama nywila, na 2FA kadhaa kama WebAuthn, barua pepe, simu, okta verify (zinaweza kuwa zimeanzishwa au zimelemazwa)...

Kisha, kuna **programu** zilizosanidishwa na Okta. Kila programu itakuwa na **upatanishi na Okta** ili kushiriki habari (kama vile anwani za barua pepe, majina ya kwanza...). Zaidi ya hayo, kila programu lazima iwe ndani ya **Sera ya Uthibitishaji**, ambayo inaonyesha **uthibitishaji unaohitajika** kwa mtumiaji kufikia **programu**.

{% hint style="danger" %}
Jukumu lenye nguvu zaidi ni **Msimamizi Mkuu**.

Ikiwa mshambuliaji atadukua Okta na ufikiaji wa Msimamizi, programu zote zinazotumaini Okta zitakuwa na uwezekano mkubwa wa **kudukuliwa**.
{% endhint %}

## Mashambulizi

### Kupata Kituo cha Okta

Kawaida kituo cha kampuni kitapatikana kwenye **jina la kampuni.okta.com**. Ikiwa sivyo, jaribu **mabadiliko rahisi** ya **jina la kampuni**. Ikiwa huwezi kupata, pia inawezekana kuwa shirika lina **rekodi ya CNAME** kama **`okta.jinalakampuni.com`** inayoashiria **kituo cha Okta**.

### Kuingia kwenye Okta kupitia Kerberos

Ikiwa **`jinalakampuni.kerberos.okta.com`** iko hai, **Kerberos hutumiwa kwa ufikiaji wa Okta**, kwa kawaida ikipuuza **MFA** kwa watumiaji wa **Windows**. Ili kupata watumiaji wa Okta wanaothibitishwa na Kerberos katika AD, endesha **`getST.py`** na **parameta sahihi**. Baada ya kupata **tiketi ya mtumiaji wa AD**, **ingiza** kwenye mwenyeji uliodhibitiwa kwa kutumia zana kama Rubeus au Mimikatz, ukizingatia **`jinalamteja.kerberos.okta.com` iko kwenye "eneo la Intranet" la Chaguo za Mtandao**. Kufikia URL maalum inapaswa kurudisha majibu ya JSON "SAWA", ikionyesha kukubaliwa kwa tiketi ya Kerberos, na kutoa ufikiaji kwenye dashibodi ya Okta.

Kudukua **akaunti ya huduma ya Okta na SPN ya upelekaji huwezesha shambulio la Tiketi ya Fedha.** Hata hivyo, matumizi ya Okta ya **AES** kwa kuchakata tiketi inahitaji kuwa na ufunguo wa AES au nywila ya wazi. Tumia **`ticketer.py`** kuzalisha tiketi kwa mtumiaji wa kikosi na utoe kupitia kivinjari kuthibitisha na Okta.

**Angalia shambulio hilo katika [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers).**

### Kuteka Kituo cha Okta cha AD

Mbinu hii inahusisha **kupata Okta AD Agent kwenye seva**, ambayo **inasawazisha watumiaji na kushughulikia uthibitishaji**. Kwa kuchunguza na kufichua mipangilio katika **`OktaAgentService.exe.config`**, hasa AgentToken kutumia **DPAPI**, mshambuliaji anaweza kwa uwezekano **kukamata na kudhibiti data za uthibitishaji**. Hii inaruhusu si tu **kuangalia** na **kukamata vitambulisho vya mtumiaji** kwa maandishi wakati wa mchakato wa uthibitishaji wa Okta lakini pia **kujibu jaribio za uthibitishaji**, hivyo kuruhusu ufikiaji usiohalali au kutoa uthibitishaji wa jumla kupitia Okta (kama 'funguo wa mifupa').

**Angalia shambulio hilo katika [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers).**

### Kuteka AD Kama Msimamizi

Mbinu hii inahusisha kuteka Okta AD Agent kwa kwanza kupata Msimbo wa OAuth, kisha kuomba tokeni ya API. Tokeni inahusishwa na kikoa cha AD, na **konekta inapewa jina la kuweka wakala wa AD bandia**. Uanzishaji unaruhusu wakala **kushughulikia jaribio za uthibitishaji**, kukamata vitambulisho kupitia API ya Okta. Zana za kiotomatiki zinapatikana kusukuma mchakato huu, kutoa njia laini ya kukamata na kushughulikia data za uthibitishaji ndani ya mazingira ya Okta.

**Angalia shambulio hilo katika [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers).**

### Okta Mtoa Huduma wa SAML Bandia

**Angalia shambulio hilo katika [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers).**

Mbinu hii inahusisha **kupeleka mtoa huduma wa SAML bandia**. Kwa kuingiza Mtoa Huduma wa Kitambulisho (IdP) wa nje ndani ya mfumo wa Okta kwa kutumia akaunti ya hali ya juu, wadukuzi wanaweza **kudhibiti IdP, kuidhinisha ombi lolote la uthibitishaji kwa mapenzi**. Mchakato unajumuisha kuweka SAML 2.0 IdP kwenye Okta, kubadilisha URL ya Uingiaji wa Moja wa IdP kwa kuelekeza kupitia faili za wenyeji wa ndani, kuzalisha cheti cha kujisaini, na kusanidi mipangilio ya Okta kulingana na jina la mtumiaji au barua pepe. Kutekeleza hatua hizi kwa ufanisi kuruhusu uthibitishaji kama mtumiaji yeyote wa Okta, kupuuza haja ya vitambulisho vya mtumiaji binafsi, ikiongeza udhibiti wa ufikiaji kwa njia isiyoweza kugunduliwa kwa kiasi kikubwa.
### Kudanganya Okta Portal na Evilgnix

Katika [**chapisho hili la blogu**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) imeelezwa jinsi ya kuandaa kampeni ya kudanganya dhidi ya portal ya Okta.

### Shambulio la Kujifanya Kuwa Mwenzio

**Sifa ambazo kila mtumiaji anaweza kuwa nazo na kuhariri** (kama vile barua pepe au jina la kwanza) zinaweza kusanidiwa katika Okta. Ikiwa **programu** ina **imani** kama Kitambulisho ni **sifa** ambayo mtumiaji anaweza **kubadilisha**, ataweza **kujifanya kuwa watumiaji wengine kwenye jukwaa hilo**.

Kwa hivyo, ikiwa programu ina imani na uga wa **`userName`**, labda hautaweza kubadilisha (kwa sababu kawaida huwezi kubadilisha uga huo), lakini ikiwa ina imani kwa mfano **`primaryEmail`** unaweza kuweza **kubadilisha kuwa anwani ya barua pepe ya mwenzako** na kujifanya kuwa yeye (utahitaji kupata ufikiaji wa barua pepe na kukubali mabadiliko).

Tafadhali elewa kuwa ujifanyaji huu unategemea jinsi kila programu ilivyo sanidiwa. Ni programu zipi zinazotegemea uga uliobadilishwa na kukubali sasisho ndizo zitakazodhuriwa. Kwa hivyo, programu inapaswa kuwa na uga huu ukiwa umewezeshwa ikiwepo:

<figure><img src="../../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

Pia nimeona programu zingine zilizokuwa na mapungufu lakini hazikuwa na uga huo katika mipangilio ya Okta (mwishowe programu tofauti zinasanidiwa kwa njia tofauti).

Njia bora ya kujua ikiwa unaweza kujifanya kuwa mtu yeyote kwenye kila programu ni kujaribu!

## Kuepuka Sera za Uchunguzi wa Tabia <a href="#id-9fde" id="id-9fde"></a>

Sera za uchunguzi wa tabia katika Okta zinaweza isiweze kujulikana hadi zinapokutana, lakini **kuzipuuza** kunaweza kufanikiwa kwa **kulenga programu za Okta moja kwa moja**, kuepuka kibao kikuu cha Okta. Kwa **ishara ya ufikiaji wa Okta**, rudisha ishara hiyo kwenye **URL maalum ya Okta ya programu** badala ya ukurasa kuu wa kuingia.

Mapendekezo muhimu ni pamoja na:

* **Epuka kutumia** wakala wa siri maarufu na huduma za VPN wakati wa kurudisha ishara za ufikiaji zilizonaswa.
* Hakikisha **vitambulisho vya wakala wa mtumiaji** vinapatana kati ya mteja na ishara zilizorudiwa za ufikiaji.
* **Jizuie kurudisha** ishara kutoka kwa watumiaji tofauti kutoka kwa anwani ya IP ile ile.
* Tumia tahadhari wakati wa kurudisha ishara dhidi ya kibao kikuu cha Okta.
* Ikiwa unajua anwani za IP za kampuni ya mwathiriwa, **zuia trafiki** kwa anwani hizo au safu yao, kuzuia trafiki nyingine yote.

## Kufanya Okta Kuwa Imara

Okta ina mazingira mengi yanayowezekana, kwenye ukurasa huu utapata jinsi ya kuyakagua ili yawe salama iwezekanavyo:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Marejeo

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi mtaalamu na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
