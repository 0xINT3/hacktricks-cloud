# Okta Bezbednost

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

[Okta, Inc.](https://www.okta.com/) je prepoznata u sektoru identiteta i upravljanja pristupom zbog svojih softverskih rešenja zasnovanih na oblaku. Ova rešenja su dizajnirana da pojednostave i obezbede autentifikaciju korisnika na različitim modernim aplikacijama. Ona ne samo da služe kompanijama koje žele da zaštite svoje osetljive podatke, već i programerima koji su zainteresovani za integraciju kontrola identiteta u aplikacije, veb servise i uređaje.

Glavna ponuda od Okta-e je **Okta Identity Cloud**. Ova platforma obuhvata niz proizvoda, uključujući, ali ne ograničavajući se na:

- **Single Sign-On (SSO)**: Pojednostavljuje pristup korisnika omogućavajući jedan set prijavljivanja za više aplikacija.
- **Multi-Factor Authentication (MFA)**: Povećava bezbednost zahtevajući više oblika verifikacije.
- **Lifecycle Management**: Automatizuje procese kreiranja, ažuriranja i deaktivacije korisničkih naloga.
- **Universal Directory**: Omogućava centralizovano upravljanje korisnicima, grupama i uređajima.
- **API Access Management**: Obezbeđuje i upravlja pristupom API-ima.

Ove usluge zajedno imaju za cilj da ojačaju zaštitu podataka i pojednostave pristup korisnika, poboljšavajući i bezbednost i praktičnost. Svestranost Okta-inih rešenja čini ih popularnim izborom u različitim industrijama, korisnim za velike preduzeće, male kompanije i pojedinačne programere. Prema poslednjem ažuriranju u septembru 2021. godine, Okta je priznata kao značajna entitet u oblasti upravljanja identitetom i pristupom (IAM).

{% hint style="danger" %}
Glavni cilj Okta-e je konfiguracija pristupa različitim korisnicima i grupama za spoljne aplikacije. Ako uspete da **kompromitujete administratorske privilegije u Okta** okruženju, vrlo je verovatno da ćete moći da **kompromitujete sve druge platforme koje kompanija koristi**.
{% endhint %}

{% hint style="success" %}
Da biste izvršili sigurnosni pregled Okta okruženja, trebali biste zatražiti **administrator pristup samo za čitanje**.
{% endhint %}

### Rezime

Postoje **korisnici** (koji mogu biti **sačuvani u Okta-i**, prijavljeni iz konfigurisanih **Identity Providers** ili autentifikovani putem **Active Directory**-ja ili LDAP-a).\
Ovi korisnici mogu biti unutar **grupa**.\
Tu su i **autentifikatori**: različite opcije za autentifikaciju kao što su lozinka i nekoliko 2FA metoda kao što su WebAuthn, e-pošta, telefon, Okta Verify (mogu biti omogućeni ili onemogućeni)...

Zatim, postoje **aplikacije** sinhronizovane sa Okta-om. Svaka aplikacija će imati neko **mapiranje sa Okta-om** za deljenje informacija (kao što su adrese e-pošte, imena...). Osim toga, svaka aplikacija mora biti unutar **Authentication Policy**-ja, koji pokazuje **potrebne autentifikatore** za korisnika da **pristupi** aplikaciji.

{% hint style="danger" %}
Najmoćnija uloga je **Super Administrator**.

Ako napadač kompromituje Okta-u sa administratorskim pristupom, sve **aplikacije koje veruju Okta-i** će vrlo verovatno biti **kompromitovane**.
{% endhint %}

## Napadi

### Pronalaženje Okta Portala

Obično će portal kompanije biti smešten na **companyname.okta.com**. Ako nije, pokušajte jednostavne **varijacije** od **companyname**. Ako ga ne možete pronaći, takođe je moguće da organizacija ima **CNAME** zapis kao što je **`okta.companyname.com`** koji pokazuje na **Okta portal**.

### Prijavljivanje na Okta putem Kerberosa

Ako je **`companyname.kerberos.okta.com`** aktivan, **Kerberos se koristi za pristup Okta-i**, obično zaobilazeći **MFA** za **Windows** korisnike. Da biste pronašli korisnike Okta-e autentifikovane putem Kerberosa u AD-u, pokrenite **`getST.py`** sa **odgovarajućim parametrima**. Nakon dobijanja **AD korisničkog tiketa**, **ubacite** ga u kontrolisani host koristeći alate poput Rubeus-a ili Mimikatz-a, obezbeđujući da je **`clientname.kerberos.okta.com` u zoni "Intranet" Internet opcija**. Pristupanje određenom URL-u trebalo bi da vrati JSON "OK" odgovor, što ukazuje na prihvatanje Kerberos tiketa i omogućava pristup Okta kontrolnoj tabli.

Kompromitovanje **Okta servisnog naloga sa delegacijom SPN omogućava napad Silver Ticket**. Međutim, Okta-ino korišćenje **AES** za enkripciju tiketa zahteva posedovanje AES ključa ili šifre u obliku otvorenog teksta. Koristite **`ticketer.py`** da biste generisali tiket za korisnika žrtve i dostavite ga putem pregledača radi autentifikacije sa Okta-om.

**Proverite napad na [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers).**

### Hakovanje Okta AD Agent-a

Ova tehnika uključuje **pristupanje Okta AD Agent-u na serveru**, koji sinhronizuje korisnike i upravlja autentifikacijom. Pregledanjem i dešifrovanjem konfiguracija u **`OktaAgentService.exe.config`**, posebno AgentToken-a koristeći **DPAPI**, napadač potencijalno može **presresti i manipulisati podacima za autentifikaciju**. Ovo omogućava ne samo **praćenje** i **hvatanje korisničkih podataka za prijavljivanje** u običnom tekstu tokom Okta procesa autentifikacije, već i **odgovaranje na pokušaje autentifikacije**, čime se omogućava ne
### Fišingovanje Okta portala pomoću Evilgnix-a

U [**ovom blog postu**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) je objašnjeno kako pripremiti kampanju fišinga protiv Okta portala.

### Napad impersonacije kolege

**Atributi koje svaki korisnik može imati i menjati** (kao što su email ili ime) mogu se konfigurisati u Okta. Ako je **aplikacija** **poverljiva** prema ID-u **atributa** koji korisnik može **menjati**, on će moći **impersonirati druge korisnike na toj platformi**.

Dakle, ako aplikacija veruje polju **`userName`**, verovatno nećete moći da ga promenite (jer obično ne možete promeniti to polje), ali ako veruje, na primer, **`primaryEmail`**, možda ćete moći da ga **promenite u email adresu kolege** i impersonirate ga (morate imati pristup emailu i prihvatiti promenu).

Imajte na umu da ova impersonacija zavisi od toga kako je svaka aplikacija konfigurisana. Samo one koje veruju polju koje ste promenili i prihvataju ažuriranja će biti kompromitovane.\
Stoga, aplikacija bi trebalo da ima ovo polje omogućeno ako postoji:

<figure><img src="../../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

Takođe sam video druge aplikacije koje su bile ranjive, ali nisu imale to polje u Okta podešavanjima (na kraju različite aplikacije su različito konfigurisane).

Najbolji način da saznate da li možete impersonirati bilo koga na svakoj aplikaciji je da to pokušate!

## Izbegavanje politika za otkrivanje ponašanja <a href="#id-9fde" id="id-9fde"></a>

Politike za otkrivanje ponašanja u Okta mogu biti nepoznate sve dok se ne susretnu, ali njihovo **zaobilazno** može se postići **ciljajući Okta aplikacije direktno**, izbegavajući glavnu Okta kontrolnu tablu. Sa **Okta pristupnim tokenom**, ponovite token na **URL-u specifičnom za aplikaciju u Okta** umesto na glavnoj stranici za prijavu.

Ključne preporuke uključuju:

* **Izbegavajte korišćenje** popularnih anonimizirajućih proxy-ja i VPN usluga prilikom ponovnog reprodukovanja uhvaćenih pristupnih tokena.
* Osigurajte **konzistentne korisničke agente** između klijenta i ponovljenih pristupnih tokena.
* **Sužavajte reprodukciju** tokena sa različitih korisnika sa iste IP adrese.
* Budite oprezni prilikom reprodukovanja tokena protiv Okta kontrolne table.
* Ako znate IP adrese žrtvene kompanije, **ograničite saobraćaj** na te IP adrese ili njihov opseg, blokirajući sav ostali saobraćaj.

## Ojačavanje Okta sistema

Okta ima mnogo mogućih konfiguracija, na ovoj stranici ćete pronaći kako ih pregledati kako bi bile što sigurnije moguće:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Reference

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini da podržite HackTricks:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
