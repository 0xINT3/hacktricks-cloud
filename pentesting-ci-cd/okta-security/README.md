# Okta Sekuriteit

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Basiese Inligting

[Okta, Inc.](https://www.okta.com/) word erken in die identiteit- en toegangsbestuursektor vir sy wolkgebaseerde sagteware-oplossings. Hierdie oplossings is ontwerp om gebruikersverifikasie oor verskillende moderne toepassings te stroomlyn en te beveilig. Dit is nie net bedoel vir maatskappye wat hul sensitiewe data wil beskerm nie, maar ook vir ontwikkelaars wat belangstel om identiteitsbeheer in te skakel in toepassings, webdienste en toestelle.

Die vlagskipaanbod van Okta is die **Okta Identity Cloud**. Hierdie platform sluit 'n reeks produkte in, insluitend maar nie beperk tot:

- **Enkel Aanmelding (SSO)**: Vereenvoudig gebruikerstoegang deur een stel aanmeldingslegitimasie oor verskeie toepassings toe te laat.
- **Multi-Faktor Verifikasie (MFA)**: Verbeter veiligheid deur meervoudige vorme van verifikasie te vereis.
- **Lewensiklusbestuur**: Outomatiseer prosesse vir die skep, opdateer en deaktiveer van gebruikersrekeninge.
- **Universele Gids**: Maak gedeelde bestuur van gebruikers, groepe en toestelle moontlik.
- **API-toegangsbestuur**: Beveilig en bestuur toegang tot API's.

Hierdie dienste het gesamentlik ten doel om data beskerming te versterk en gebruikerstoegang te stroomlyn, wat beide veiligheid en gerief verbeter. Die veelsydigheid van Okta se oplossings maak dit 'n gewilde keuse in verskeie bedrywe, voordelig vir groot ondernemings, klein maatskappye en individuele ontwikkelaars. Volgens die laaste opdatering in September 2021, word Okta erken as 'n prominente entiteit in die Identiteit- en Toegangsbestuur (IAM) arena.

{% hint style="danger" %}
Die hoofdoel van Okta is om toegang tot verskillende gebruikers en groepe tot eksterne toepassings te konfigureer. As jy daarin slaag om **administratiewe voorregte in 'n Okta-omgewing te kompromitteer**, sal jy waarskynlik in staat wees om **alle ander platforms wat die maatskappy gebruik, te kompromitteer**.
{% endhint %}

{% hint style="success" %}
Om 'n sekuriteitsondersoek van 'n Okta-omgewing uit te voer, moet jy vra vir **administratiewe lees-slegs toegang**.
{% endhint %}

### Opsomming

Daar is **gebruikers** (wat **in Okta gestoor** kan word, aangemeld vanaf gekonfigureerde **Identiteitverskaffers** of geverifieer via **Active Directory** of LDAP).\
Hierdie gebruikers kan binne **groepe** wees.\
Daar is ook **verifikators**: verskillende opsies vir verifikasie soos wagwoord, en verskeie 2FA soos WebAuthn, e-pos, telefoon, Okta-verifieer (hulle kan geaktiveer of gedeaktiveer wees)...

Dan is daar **toepassings** wat gesinkroniseer is met Okta. Elke toepassing sal 'n **koppeling met Okta** h√™ om inligting te deel (soos e-posadresse, voornames...). Verder moet elke toepassing binne 'n **Verifikasiebeleid** wees, wat die **nodige verifikators** vir 'n gebruiker aandui om die toepassing te **betree**.

{% hint style="danger" %}
Die kragtigste rol is die **Superadministrateur**.

As 'n aanvaller Okta met Administrateur-toegang kompromitteer, sal al die **toepassings wat op Okta vertrou**, waarskynlik **gekompromitteer** word.
{% endhint %}

## Aanvalle

### Opsoek na Okta Portal

Gewoonlik sal die portaal van 'n maatskappy gele√´ wees op **companyname.okta.com**. As dit nie die geval is nie, probeer eenvoudige **variasies** van **companyname**. As jy dit nie kan vind nie, is dit ook moontlik dat die organisasie 'n **CNAME**-rekord het soos **`okta.companyname.com`** wat na die **Okta-portaal** verwys.

### Aanmelding by Okta via Kerberos

As **`companyname.kerberos.okta.com`** aktief is, word **Kerberos gebruik vir Okta-toegang**, wat gewoonlik **MFA** vir **Windows**-gebruikers omseil. Om Kerberos-geverifieerde Okta-gebruikers in AD te vind, voer **`getST.py`** uit met **toepaslike parameters**. Nadat 'n **AD-gebruikerstiket** verkry is, **insinueer** dit in 'n beheerde gasheer met behulp van hulpmiddels soos Rubeus of Mimikatz, en verseker dat **`clientname.kerberos.okta.com` in die "Intranet" sone van die Internet Options** is. Toegang tot 'n spesifieke URL moet 'n JSON "OK"-reaksie teruggee, wat aandui dat die Kerberos-tiket aanvaar is en toegang tot die Okta-dashboard verleen.

Die **kompromittering van die Okta-diensrekening met die delegasie SPN maak 'n Silver Ticket-aanval** moontlik. Tog vereis Okta se gebruik van **AES** vir tiketversleuteling die besit van die AES-sleutel of platte teks wagwoord. Gebruik **`ticketer.py` om 'n tiket vir die slagoffer-gebruiker** te genereer en lewer dit via die webblaaier om met Okta te verifieer.

**Kyk na die aanval by [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers).**

### Ontvoering van Okta AD Agent

Hierdie tegniek behels die **toegang tot die Okta AD Agent op 'n bediener**, wat gebruikers sinchroniseer en verifikasie hanteer. Deur die ontsluiting en dekripsie van konfigurasies in **`OktaAgentService.exe.config`**, veral die AgentToken met behulp van **DPAPI**, kan 'n aanvaller potensieel **verifikasiedata onderskep en manipuleer**. Dit maak nie net **monitering** en **vaslegging van gebruikerslegitimasie** in platte teks tydens die Okta-verifikasieproses moontlik nie, maar ook **reageer op verifikasiepogings**, wat ongemagtigde toegang moontlik maak of universele verifikasie deur Okta bied (soos 'n 'skeletsluitel').

**Kyk na die aanval by [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers).**

### Ontvoering van AD as 'n Admin

Hierdie tegniek behels die ontvoering van 'n Okta AD Agent deur eers 'n OAuth-kode te verkry en dan 'n API-token aan te vra. Die token is gekoppel aan 'n
### Phishing Okta Portal met Evilgnix

In [**hierdie blogpos**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) word verduidelik hoe om 'n phising-veldtog teen 'n Okta-portaal voor te berei.

### Kollega-impersonasie-aanval

Die **eienskappe wat elke gebruiker kan h√™ en wysig** (soos e-pos of voornaam) kan in Okta gekonfigureer word. As 'n **toepassing** 'n **eienskap** vertrou as ID wat die gebruiker kan **wysig**, sal hy in staat wees om **ander gebruikers in daardie platform te impersoneer**.

Daarom, as die toepassing die veld **`userName`** vertrou, sal jy waarskynlik nie in staat wees om dit te verander nie (omdat jy gewoonlik nie daardie veld kan verander nie), maar as dit byvoorbeeld **`primaryEmail`** vertrou, kan jy dit moontlik verander na 'n kollega se e-posadres en dit impersoneer (jy sal toegang tot die e-pos moet h√™ en die verandering aanvaar).

Let daarop dat hierdie impersonasie afhang van hoe elke toepassing gekonfigureer is. Slegs diegene wat die veld wat jy gewysig het vertrou en opdaterings aanvaar, sal gekompromitteer word.\
Daarom moet die toepassing hierdie veld geaktiveer h√™ as dit bestaan:

<figure><img src="../../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

Ek het ook ander toepassings gesien wat kwesbaar was, maar nie daardie veld in die Okta-instellings gehad het nie (uiteindelik word verskillende toepassings anders gekonfigureer).

Die beste manier om uit te vind of jy enigiemand in elke toepassing kan impersoneer, is om dit te probeer!

## Ontduiking van gedragsopsporingsbeleide <a href="#id-9fde" id="id-9fde"></a>

Gedragsopsporingsbeleide in Okta mag onbekend wees totdat dit ondervind word, maar dit kan omseil word deur Okta-toepassings direk te teiken en die hoof Okta-dashboard te vermy. Met 'n **Okta-toegangstoken**, speel die token af by die **toepassing-spesifieke Okta-URL** in plaas van die hoofaanmeldingsbladsy.

Belangrike aanbevelings sluit in:

* **Vermy die gebruik van** gewilde anonimiseerproksi's en VPN-diens wanneer jy vasgevang toegangstokens afspeel.
* Verseker **konsekwente gebruikersagentstreke** tussen die kli√´nt en die afgespeelde toegangstokens.
* **Speel nie** tokens van verskillende gebruikers van dieselfde IP-adres af nie.
* Wees versigtig wanneer jy tokens afspeel teen die Okta-dashboard.
* As jy bewus is van die IP-adresse van die slagoffermaatskappy, **beperk verkeer** tot daardie IP's of hul reeks en blokkeer alle ander verkeer.

## Okta-verharding

Okta het baie moontlike konfigurasies, op hierdie bladsy sal jy vind hoe om hulle te hersien sodat hulle so veilig as moontlik is:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Verwysings

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy in HackTricks wil adverteer** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks-uitrusting**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFT's**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
