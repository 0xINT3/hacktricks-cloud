# GCP - Escalada de privilegios en AppEngine

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos.
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

### `appengine.applications.get`, `appengine.instances.get`, `appengine.instances.list`, `appengine.operations.get`, `appengine.operations.list`, `appengine.services.get`, `appengine.services.list`, `appengine.versions.create`, `appengine.versions.get`, `appengine.versions.list`, `cloudbuild.builds.get`,`iam.serviceAccounts.actAs`, `resourcemanager.projects.get`, `storage.objects.create`, `storage.objects.list`

Estos son los permisos necesarios para **implementar una aplicación usando la CLI `gcloud`**. Tal vez los permisos **`get`** y **`list`** podrían ser **evitados**.

Puedes encontrar ejemplos de código en Python en [https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/appengine](https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/appengine)

Por defecto, el nombre del servicio de la aplicación va a ser **`default`**, y solo puede haber una instancia con el mismo nombre.\
Para cambiarlo y crear una segunda aplicación, en **`app.yaml`**, cambia el valor de la clave raíz a algo como **`service: my-second-app`**

```bash
cd python-docs-samples/appengine/flexible/hello_world
gcloud app deploy #Sube y arranca la aplicación dentro de la carpeta
```

Dale al menos 10-15 minutos, si no funciona llama a **implementar varias veces** y espera unos minutos.

{% hint style="info" %}
Es **posible indicar la Cuenta de Servicio a usar**, pero por defecto se usa la Cuenta de Servicio predeterminada de App Engine.
{% endhint %}

La URL de la aplicación es algo como `https://<nombre-proyecto>.oa.r.appspot.com/` o `https://<nombre-servicio>-dot-<nombre-proyecto>.oa.r.appspot.com`

### `logging.views.access`

Con este permiso es posible **ver los registros de la aplicación**:

```bash
gcloud app logs tail -s <nombre>
```

### `appengine.instances.enableDebug`, `appengine.instances.get`, `appengine.instances.list`, `appengine.operations.get`, `appengine.services.get`, `appengine.services.list`, `appengine.versions.get`, `appengine.versions.list`, `compute.projects.get`

Con estos permisos, es posible **iniciar sesión a través de SSH en las instancias de App Engine** de tipo **flexible** (no estándar). Algunos de los permisos **`list`** y **`get`** **podrían no ser realmente necesarios**.

```bash
gcloud app instances ssh --service <nombre-app> --version <id-version> <ID>
```

### `appengine.applications.update`, `appengine.operations.get`

Creo que esto solo cambia la Cuenta de Servicio de fondo que Google usará para configurar las aplicaciones, así que no creo que puedas abusar de esto para robar la cuenta de servicio.

{% code overflow="wrap" %}
```bash
gcloud app update --service-account=<correo_sa>
```
{% endcode %}

### `appengine.memcache.addKey`, `appengine.memcache.getKey`, `appengine.memcache.update`

Estos permisos parecen interesantes para acceder a la memoria caché de la aplicación.

### `appengine.versions.getFileContents`, `appengine.versions.update`

No estoy seguro de cómo usar estos permisos o si son útiles (nota que cuando cambias el código se crea una nueva versión, así que no sé si puedes simplemente actualizar el código o el rol de IAM de uno, pero supongo que deberías ser capaz de hacerlo, ¿tal vez cambiando el código dentro del bucket?).