# GCP - Eskalacja uprawnień w AppEngine

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## App Engine

Aby uzyskać więcej informacji na temat App Engine, sprawdź:

{% content-ref url="../gcp-services/gcp-app-engine-enum.md" %}
[gcp-app-engine-enum.md](../gcp-services/gcp-app-engine-enum.md)
{% endcontent-ref %}

### `appengine.applications.get`, `appengine.instances.get`, `appengine.instances.list`, `appengine.operations.get`, `appengine.operations.list`, `appengine.services.get`, `appengine.services.list`, `appengine.versions.create`, `appengine.versions.get`, `appengine.versions.list`, `cloudbuild.builds.get`,`iam.serviceAccounts.actAs`, `resourcemanager.projects.get`, `storage.objects.create`, `storage.objects.list`

To są wymagane uprawnienia do **wdrożenia aplikacji za pomocą polecenia `gcloud` cli**. Może być możliwe **uniknięcie** uprawnień **`get`** i **`list`**.

Przykłady kodu Python można znaleźć pod adresem [https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/appengine](https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/appengine)

Domyślnie nazwa usługi App to **`default`**, i może istnieć tylko 1 instancja o tej samej nazwie.\
Aby to zmienić i utworzyć drugą aplikację, w pliku **`app.yaml`** zmień wartość klucza głównego na coś takiego jak **`service: my-second-app`**.
```bash
cd python-docs-samples/appengine/flexible/hello_world
gcloud app deploy #Upload and start application inside the folder
```
Daj mu przynajmniej 10-15 minut, jeśli to nie zadziała, zadzwoń **i wdroż kolejny raz** i poczekaj kilka minut.

{% hint style="info" %}
**Można wskazać, które konto usługi ma być używane**, ale domyślnie używane jest domyślne konto usługi App Engine.
{% endhint %}

Adres URL aplikacji wygląda tak: `https://<nazwa-projektu>.oa.r.appspot.com/` lub `https://<nazwa-usługi>-dot-<nazwa-projektu>.oa.r.appspot.com`

### `appengine.instances.enableDebug`, `appengine.instances.get`, `appengine.instances.list`, `appengine.operations.get`, `appengine.services.get`, `appengine.services.list`, `appengine.versions.get`, `appengine.versions.list`, `compute.projects.get`

Z tymi uprawnieniami możliwe jest **logowanie się za pomocą SSH w instancjach App Engine** typu **flexible** (nie standardowego). Niektóre z uprawnień **`list`** i **`get`** **mogą nie być naprawdę potrzebne**.
```bash
gcloud app instances ssh --service <app-name> --version <version-id> <ID>
```
### `appengine.applications.update`, `appengine.operations.get`

Myślę, że to po prostu zmienia tło SA, które Google będzie używać do konfiguracji aplikacji, więc nie sądzę, że można to wykorzystać do kradzieży konta usługi.

{% code overflow="wrap" %}
```bash
gcloud app update --service-account=<sa_email>
```
{% endcode %}

### `appengine.versions.getFileContents`, `appengine.versions.update`

Nie jestem pewien, jak korzystać z tych uprawnień ani czy są one przydatne (zauważ, że gdy zmieniasz kod, tworzona jest nowa wersja, więc nie wiem, czy można po prostu zaktualizować kod lub rolę IAM jednej wersji, ale przypuszczam, że powinieneś móc to zrobić, być może zmieniając kod wewnątrz kubełka??).

### Dostęp do zapisu w kubełkach

Nawet posiadając dostęp do zapisu w kubełkach, w których znajduje się kod źródłowy, **nie było możliwe wykonanie dowolnego kodu poprzez modyfikację kodu źródłowego i pliku `manifest.json`**.\
Być może, jeśli monitorujesz kubełek i wykryjesz moment, w którym tworzona jest nowa wersja i przesyłany jest kod źródłowy i manifest, można je zmienić, aby nowa wersja korzystała z wersji z backdoorami??

Wygląda również na to, że warstwy kontenera są przechowywane w kubełku, może warto je zmienić?

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
