# GCP - Adicionar Metadados SSH Personalizados

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegrama**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## Modificando os metadados <a href="#modifying-the-metadata" id="modifying-the-metadata"></a>

Se voc√™ pode **modificar os metadados da inst√¢ncia**, h√° in√∫meras maneiras de escalar privil√©gios localmente. Existem alguns cen√°rios que podem levar a uma conta de servi√ßo com essa permiss√£o:

_**Conta de servi√ßo padr√£o**_\
Se o **escopo** de acesso da conta de servi√ßo estiver definido como **acesso total** ou pelo menos permitir explicitamente **acesso √† API de computa√ß√£o**, essa configura√ß√£o √© **vulner√°vel** √† escalada. O **escopo** **padr√£o** **n√£o √© vulner√°vel**.

_**Conta de servi√ßo personalizada**_\
Ao usar uma conta de servi√ßo personalizada, **uma** das seguintes permiss√µes do IAM **√© necess√°ria** para escalar privil√©gios:

* `compute.instances.setMetadata` (para afetar uma √∫nica inst√¢ncia)
* `compute.projects.setCommonInstanceMetadata` (para afetar todas as inst√¢ncias no projeto)

Embora o Google [recomende](https://cloud.google.com/compute/docs/access/service-accounts#associating\_a\_service\_account\_to\_an\_instance) n√£o usar escopos de acesso para contas de servi√ßo personalizadas, ainda √© poss√≠vel faz√™-lo. Voc√™ precisar√° de um dos seguintes **escopos de acesso**:

* `https://www.googleapis.com/auth/compute`
* `https://www.googleapis.com/auth/cloud-platform`

### **Adicionar chaves SSH aos metadados personalizados**

Os **sistemas** **Linux** na GCP geralmente executar√£o scripts [Python Linux Guest Environment for Google Compute Engine](https://github.com/GoogleCloudPlatform/compute