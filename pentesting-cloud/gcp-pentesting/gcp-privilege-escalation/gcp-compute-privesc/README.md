# GCP - Compute Privesc

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## Compute

GCP рдореЗрдВ Compute рдФрд░ VPC (рдиреЗрдЯрд╡рд░реНрдХ) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="../../gcp-services/gcp-compute-instances-enum/" %}
[gcp-compute-instances-enum](../../gcp-services/gcp-compute-instances-enum/)
{% endcontent-ref %}

### `compute.projects.setCommonInstanceMetadata`

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдЖрдк **рдореЗрдЯрд╛рдбреЗрдЯрд╛** рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЕрдзрд┐рдХреГрдд рдХреБрдВрдЬрд┐рдпреЛрдВ** рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ **рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ sudo** рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде **рдмрдирд╛** рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдЖрдк рдХрд┐рд╕реА рднреА VM рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ SSH рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ exec рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ GCP Service Account рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдЪрд▓ рд░рд╣рд╛ рд╣реИред\
рд╕реАрдорд╛рдПрдБ:

* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ VM рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рдЪрд▓ рд░рд╣реЗ GCP Service Accounts рдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **рдмрд╣реБрдд рд╕реАрдорд┐рдд рд╕реНрдХреЛрдк** рд╣реЛрддрд╛ рд╣реИ
* рдЖрдкрдХреЛ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **SSH рд╕рд░реНрд╡рд░ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХрд╛ рд╢реЛрд╖рдг рдХреИрд╕реЗ рдХрд░реЗрдВ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="gcp-add-custom-ssh-metadata.md" %}
[gcp-add-custom-ssh-metadata.md](gcp-add-custom-ssh-metadata.md)
{% endcontent-ref %}

### `compute.instances.setMetadata`

рдпрд╣ рдЕрдиреБрдорддрд┐ **рдкрд┐рдЫрд▓реА рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рдорд╛рди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджреЗрддреА рд╣реИ** рд▓реЗрдХрд┐рди рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдКрдкрд░ рдкреВрд░реЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рдмрдЬрд╛рдпред **рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд╢реЛрд╖рдг рдФрд░ рд╕реАрдорд╛рдПрдБ рд▓рд╛рдЧреВ рд╣реЛрддреА рд╣реИрдВ**ред

### `compute.instances.setIamPolicy`

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдЕрдиреБрдорддрд┐ рдЖрдкрдХреЛ **рдЦреБрдж рдХреЛ рдПрдХ рднреВрдорд┐рдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧреА рдЬрд┐рд╕рдореЗрдВ рдкрд┐рдЫрд▓реА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрдВ** рдФрд░ рдЙрдирдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдПрдВред

### **`compute.instances.osLogin`**

рдпрджрд┐ **OSLogin рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ**, рддреЛ рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдЖрдк рд╕рд┐рд░реНрдл **`gcloud compute ssh [INSTANCE]`** рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕реЗ рдЬреБрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдкрдХреЗ рдкрд╛рд╕ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдЕрдВрджрд░ **рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ**ред

### **`compute.instances.osAdminLogin`**

рдпрджрд┐ **OSLogin рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИ**, рддреЛ рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдЖрдк рд╕рд┐рд░реНрдл **`gcloud compute ssh [INSTANCE]`** рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕реЗ рдЬреБрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдкрдХреЗ рдкрд╛рд╕ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдЕрдВрджрд░ **рд░реВрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реЛрдВрдЧреЗ**ред

### `compute.instances.create`,`iam.serviceAccounts.actAs`

рдпрд╣ рд╡рд┐рдзрд┐ **рдПрдХ рдирд┐рд░реНрджрд┐рд╖реНрдЯ Service Account рдХреЗ рд╕рд╛рде рдПрдХ рдирдпрд╛ Compute Engine рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдмрдирд╛рддреА рд╣реИ**, рдлрд┐рд░ рдЙрд╕ Service Account рдХреЗ рдЯреЛрдХрди рдХреЛ рдПрдХ **рдмрд╛рд╣рд░реА рд╕рд░реНрд╡рд░ рдкрд░ рднреЗрдЬрддреА рд╣реИ**ред

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрддрд┐рд░рд┐рдХреНрдд **рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ**:

* _compute.disks.create_
* _compute.instances.create_
* _compute.instances.setMetadata_
* _compute.instances.setServiceAccount_
* _compute.subnetworks.use_
* _compute.subnetworks.useExternalIp_
* _iam.serviceAccounts.actAs_

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image9-750x594.png)

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рд╢реЛрд╖рдг рд╕реНрдХреНрд░рд┐рдкреНрдЯ [рдпрд╣рд╛рдБ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/compute.instances.create.py) рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред

### `osconfig.patchDeployments.create` | `osconfig.patchJobs.exec`

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **`osconfig.patchDeployments.create`** рдпрд╛ **`osconfig.patchJobs.exec`** рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ рддреЛ рдЖрдк [**рдкреИрдЪ рдЬреЙрдм рдпрд╛ рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ**](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching) рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд╕реЗ рдЖрдк рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рдмрд╛рдж рдореЗрдВ рдЪрд▓рдиреЗ рдФрд░ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рднреАрддрд░ рд╕рднреА рдХрдВрдкреНрдпреВрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗред

рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╢реЛрд╖рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдкреИрдЪ рдЬреЙрдм рдХреЗ рд▓рд┐рдП [рдкреИрдЪ рдЬреЙрдм](https://github.com/rek7/patchy/blob/main/pkg/engine/patches/patch\_job.json) рдпрд╛ [рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ](https://github.com/rek7/patchy/blob/main/pkg/engine/patches/patch\_deployment.json) рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛:

`gcloud compute os-config patch-jobs execute --file=patch.json`

рдкреИрдЪ рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

`gcloud compute os-config patch-deployments create my-update --file=patch.json`

[рдкреИрдЪреА](https://github.com/rek7/patchy) рдЬреИрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдг рдвреАрд▓реА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдмрд╛рдж рдореЗрдВ рдЪрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдореМрдЬреВрдж рд╣реИрдВред

**рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реНрдерд╛рдпрд┐рддреНрд╡ рдХреЗ рд▓рд┐рдП рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**

### `compute.machineImages.get`, (`compute.machineImages.create`)

(рдкрд░реАрдХреНрд╖рдг рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛) рдкрд╣рд▓реА рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде, рдпрд╣ рд╕рдВрднрд╡ рд╣реИ **рдорд╢реАрди рдЗрдореЗрдЬ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**ред рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде, рдЖрдк **рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреА рдЗрдореЗрдЬ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рдорд╢реАрди рдЗрдореЗрдЬ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп **рдЙрди рдкрд░ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдХреА рдЦреЛрдЬ рдХрд░рдирд╛ рд╣реИ**ред

### `compute.machineImages.setIamPolicy`

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдкрд┐рдЫрд▓реА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВред**

### `compute.snapshots.get`, (`compute.disks.createSnapshot`,`compute.snapshots.create`)

(рдкрд░реАрдХреНрд╖рдг рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛) рдкрд╣рд▓реА рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде, рдпрд╣ рд╕рдВрднрд╡ рд╣реИ **рд╕реНрдиреИрдкрд╢реЙрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**ред рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде, рдЖрдк **рдПрдХ рдбрд┐рд╕реНрдХ рдХрд╛ рд╕реНрдиреИрдкрд╢реЙрдЯ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рд╕реНрдиреИрдкрд╢реЙрдЯ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп **рдЙрди рдкрд░ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдХреА рдЦреЛрдЬ рдХрд░рдирд╛ рд╣реИ**ред

TODO: рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреМрди рд╕реА рдЕрдиреБрдорддрд┐ рд╕реНрдиреИрдкрд╢реЙрдЯ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

### `compute.snapshots.setIamPolicy`

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдкрд┐рдЫрд▓реА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВред**

### `compute.disks.use`, `compute.disks.useReadOnly`

`TOOD`

### `compute.disks.setIamPolicy`

`TODO`

### `compute.disks.addResourcePolicies`

`TODO`

### GCP Compute рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐

{% content-ref url="../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [
