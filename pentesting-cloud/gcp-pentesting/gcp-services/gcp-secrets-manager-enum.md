# GCP - Secrets Manager Enum

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Secret Manager

O [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/) do Google √© uma solu√ß√£o semelhante a um cofre para armazenar senhas, chaves de API, certificados, arquivos (m√°ximo de 64KB) e outros dados sens√≠veis.

Um segredo pode ter **diferentes vers√µes armazenando dados diferentes**.

Por **padr√£o**, os segredos s√£o **criptografados usando uma chave gerenciada pelo Google**, mas √© **poss√≠vel selecionar uma chave do KMS** para usar na criptografia do segredo.

Em rela√ß√£o √† **rota√ß√£o**, √© poss√≠vel configurar **mensagens para serem enviadas ao pub-sub a cada n√∫mero de dias**; o c√≥digo que escuta essas mensagens pode **rotacionar o segredo**.

√â poss√≠vel configurar um dia para **dele√ß√£o autom√°tica**; quando o dia indicado for **atingido**, o **segredo ser√° automaticamente deletado**.

### Enumera√ß√£o
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### Escalada de Privil√©gios

Na p√°gina a seguir, voc√™ pode verificar como **abusar das permiss√µes do secretmanager para escalar privil√©gios.**

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### P√≥s-Explora√ß√£o

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md" %}
[gcp-secretmanager-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md)
{% endcontent-ref %}

### Persist√™ncia

{% content-ref url="../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md" %}
[gcp-secret-manager-persistence.md](../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md)
{% endcontent-ref %}

### Uso indevido de Rota√ß√£o

Um atacante poderia atualizar o segredo para **parar as rota√ß√µes** (para que n√£o seja modificado), ou **fazer rota√ß√µes muito menos frequentes** (para que o segredo n√£o seja modificado) ou para **publicar a mensagem de rota√ß√£o em um pub/sub diferente**, ou modificando o c√≥digo de rota√ß√£o sendo executado (isso acontece em um servi√ßo diferente, provavelmente em uma Cloud Function, ent√£o o atacante precisar√° de acesso privilegiado sobre a Cloud Function ou qualquer outro servi√ßo)

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**merchandising oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
