# GCP - Enumera√ß√£o de Computa√ß√£o

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## GCP VPC e Rede

Saiba como isso funciona em:

{% content-ref url="gcp-vpc-and-networking.md" %}
[gcp-vpc-and-networking.md](gcp-vpc-and-networking.md)
{% endcontent-ref %}

### Enumera√ß√£o

{% code overflow="wrap" %}
```bash
# Listar redes
gcloud compute networks list
gcloud compute networks describe <network>

# Listar sub-redes
gcloud compute networks subnets list
gcloud compute networks subnets get-iam-policy <name> --region <region>
gcloud compute networks subnets describe <name> --region <region>

# Listar regras de firewall nas redes
gcloud compute firewall-rules list --format="table(
                name,
                network,
                direction,
                priority,
                sourceRanges.list():label=SRC_RANGES,
                destinationRanges.list():label=DEST_RANGES,
                allowed[].map().firewall_rule().list():label=ALLOW,
                denied[].map().firewall_rule().list():label=DENY,
                sourceTags.list():label=SRC_TAGS,
                sourceServiceAccounts.list():label=SRC_SVC_ACCT,
                targetTags.list():label=TARGET_TAGS,
                targetServiceAccounts.list():label=TARGET_SVC_ACCT,
                disabled
            )"

# Listar Firewalls Hier√°rquicos
gcloud compute firewall-policies list  (--folder <value>| --organization <value>)
gcloud compute firewall-policies describe <fw_policy>
gcloud compute firewall-policies list-rules <fw_policy>

# Obter Firewalls de cada regi√£o
gcloud compute network-firewall-policies list
## Obter FWs finais aplicados em uma regi√£o
gcloud compute network-firewall-policies get-effective-firewalls --network=<vpc_name> --region <region>
```
{% endcode %}

Voc√™ pode facilmente encontrar inst√¢ncias de computa√ß√£o com regras de firewall abertas com [https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum)

## Inst√¢ncias de Computa√ß√£o

Essas s√£o as maneiras de **executar m√°quinas virtuais dentro do GCP.**

{% content-ref url="./" %}
[.](./)
{% endcontent-ref %}

### Enumera√ß√£o

```bash
# Obter lista de zonas
# √â interessante saber quais zonas est√£o sendo usadas
gcloud compute regions list | grep -E "NAME|[^0]/"

# Listar inst√¢ncias de computa√ß√£o e obter informa√ß√µes
gcloud compute instances list
gcloud compute instances describe <instance name>
gcloud compute instances get-iam-policy <instance> --zone=ZONE
gcloud compute instances get-screenshot <instance name> # A inst√¢ncia deve ter "Display Device" habilitado
gcloud compute instances os-inventory list-instances # Obter informa√ß√µes do SO das inst√¢ncias (o agente OS Config est√° sendo executado nas inst√¢ncias)


# Enumerar discos
gcloud compute disks list
gcloud compute disks describe <disk>
gcloud compute disks get-iam-policy <disk>
```

Para obter mais informa√ß√µes sobre como **SSH** ou **modificar os metadados** de uma inst√¢ncia para **escalar privil√©gios**, consulte esta p√°gina:

{% content-ref url="../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

### Escala√ß√£o de Privil√©gios

Na seguinte p√°gina, voc√™ pode verificar como **abusar das permiss√µes de computa√ß√£o para escalar privil√©gios**:

{% content-ref url="../../gcp-privilege-escalation/gcp-compute-privesc/" %}
[gcp-compute-privesc](../../gcp-privilege-escalation/gcp-compute-privesc/)
{% endcontent-ref %}

### Logs do Console Serial

Os logs do console serial do Compute Engine s√£o um recurso que permite **visualizar e diagnosticar os logs de inicializa√ß√£o e do sistema operacional** das suas inst√¢ncias de m√°quina virtual.

Os logs do console serial fornecem uma **vis√£o de baixo n√≠vel do processo de inicializa√ß√£o da inst√¢ncia**, incluindo mensagens do kernel, scripts init e outros eventos do sistema que ocorrem durante a inicializa√ß√£o. Isso pode ser √∫til para depurar problemas de inicializa√ß√£o, identificar configura√ß√µes incorretas ou erros de software ou solucionar problemas de conectividade de rede.

Esses logs **podem expor informa√ß√µes confidenciais** dos logs do sistema que um usu√°rio com baixo privil√©gio normalmente n√£o veria, mas