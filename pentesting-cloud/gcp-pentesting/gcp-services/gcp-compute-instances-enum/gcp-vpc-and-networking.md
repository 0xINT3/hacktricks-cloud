# GCP - VPC рдФрд░ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## **GCP Compute Networking рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ**

**VPCs** рдореЗрдВ **Firewall** рдирд┐рдпрдо рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ VPC рдореЗрдВ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред VPCs рдореЗрдВ **subnetworks** рднреА рд╣реЛрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ **virtual machines** **рдЬреБрдбрд╝реА** рд╣реЛрддреА рд╣реИрдВред\
AWS рдХреА рддреБрд▓рдирд╛ рдореЗрдВ, **Firewall** **AWS** **Security Groups рдФрд░ NACLs** рдХреЗ **рд╕рдмрд╕реЗ рдХрд░реАрдмреА** рдЪреАрдЬ рд╣реЛрдЧреА, рд▓реЗрдХрд┐рди рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдпреЗ **VPC рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд** рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рдирд╣реАрдВред

## **GCP рдореЗрдВ VPC, Subnetworks рдФрд░ Firewalls**

Compute Instances **subnetworks** рд╕реЗ рдЬреБрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ **VPCs** ([Virtual Private Clouds](https://cloud.google.com/vpc/docs/vpc)) рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реЛрддреЗ рд╣реИрдВред GCP рдореЗрдВ рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдЧреНрд░реБрдкреНрд╕ рдирд╣реАрдВ рд╣реЛрддреЗ, [**VPC firewalls**](https://cloud.google.com/vpc/docs/firewalls) рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдирдХреЗ рдирд┐рдпрдо рдЗрд╕ рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрддрд░ рдкрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдкреНрд░рддреНрдпреЗрдХ VM Instance рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВред

### Subnetworks

рдПрдХ **VPC** рдореЗрдВ **рдХрдИ subnetworks** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдкреНрд░рддреНрдпреЗрдХ **subnetwork 1 рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ**ред

### Firewalls

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдкреНрд░рддреНрдпреЗрдХ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рджреЛ [**рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо**](https://cloud.google.com/vpc/docs/firewalls#default_firewall_rules) рд╣реЛрддреЗ рд╣реИрдВ: **рдмрд╛рд╣рд░реА рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЕрдиреБрдорддрд┐** рдФрд░ **рдЕрдВрджрд░реВрдиреА рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЕрд╕реНрд╡реАрдХреГрддрд┐**ред

рдЬрдм рдПрдХ GCP рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдПрдХ VPC рдЬрд┐рд╕реЗ **`default`** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рднреА рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо рд╣реЛрддреЗ рд╣реИрдВ:

* **default-allow-internal:** `default` рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдЕрдиреНрдп рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕реЗ рд╕рднреА рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЕрдиреБрдорддрд┐
* **default-allow-ssh:** рд╣рд░ рдЬрдЧрд╣ рд╕реЗ 22 рдХреА рдЕрдиреБрдорддрд┐
* **default-allow-rdp:** рд╣рд░ рдЬрдЧрд╣ рд╕реЗ 3389 рдХреА рдЕрдиреБрдорддрд┐
* **default-allow-icmp:** рд╣рд░ рдЬрдЧрд╣ рд╕реЗ рдкрд┐рдВрдЧ рдХреА рдЕрдиреБрдорддрд┐

{% hint style="warning" %}
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, **рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо** **рдЖрдВрддрд░рд┐рдХ IP рдкрддреЛрдВ** рдХреЗ рд▓рд┐рдП **рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдкреНрд░рдж** рд╣реЛрддреЗ рд╣реИрдВред рдбрд┐рдлрд╝реЙрд▓реНрдЯ VPC Compute Instances рдХреЗ рдмреАрдЪ рд╕рднреА рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
{% endhint %}

рдбрд┐рдлрд╝реЙрд▓реНрдЯ VPC рдХреЗ рд▓рд┐рдП рдФрд░ рдЕрдзрд┐рдХ **Firewall рдирд┐рдпрдо** рдмрдирд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдирдП VPCs рдХреЗ рд▓рд┐рдПред [**Firewall рдирд┐рдпрдо**](https://cloud.google.com/vpc/docs/firewalls) рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд **рддрд░реАрдХреЛрдВ** рд╕реЗ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

* [**рдиреЗрдЯрд╡рд░реНрдХ рдЯреИрдЧреНрд╕**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯреНрд╕**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **VPC рдХреЗ рднреАрддрд░ рд╕рднреА рдЗрдВрд╕реНрдЯреЗрдВрд╕**

рджреБрд░реНрднрд╛рдЧреНрдпрд╡рд╢, рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЦреБрд▓реЗ рдкреЛрд░реНрдЯреНрд╕ рдХреЗ рд╕рд╛рде рд╕рднреА Compute Instances рдХреЛ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ `gcloud` рдХрдорд╛рдВрдб рдирд╣реАрдВ рд╣реИред рдЖрдкрдХреЛ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдореЛрдВ, рдиреЗрдЯрд╡рд░реНрдХ рдЯреИрдЧреНрд╕, рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯреНрд╕, рдФрд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдз рдЬреЛрдбрд╝рдиреЗ рд╣реЛрдВрдЧреЗред

рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ [рдЗрд╕ рдкрд╛рдпрдерди рд╕реНрдХреНрд░рд┐рдкреНрдЯ](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp_firewall_enum) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдирд┐рд░реНрдпрд╛рдд рдХрд░реЗрдЧрд╛:

* CSV рдлрд╝рд╛рдЗрд▓ рдЬреЛ рдЗрдВрд╕реНрдЯреЗрдВрд╕, рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ IP, рдЕрдиреБрдордд TCP, рдЕрдиреБрдордд UDP рджрд┐рдЦрд╛рддреА рд╣реИ
* nmap рд╕реНрдХреИрди рдЬреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЗрдВрдЯрд░рдиреЗрдЯ (0.0.0.0/0) рд╕реЗ рдЗрдВрдЧреНрд░реЗрд╕ рдЕрдиреБрдордд рдкреЛрд░реНрдЯреНрд╕ рдкрд░ рд╕рднреА рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ
* masscan рдЬреЛ рдЙрди рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреА рдкреВрд░реА TCP рд░реЗрдВрдЬ рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЗрдВрдЯрд░рдиреЗрдЯ (0.0.0.0/0) рд╕реЗ рд╕рднреА TCP рдкреЛрд░реНрдЯреНрд╕ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ

### рдкрджрд╛рдиреБрдХреНрд░рдорд┐рдХ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпрд╛рдБ <a href="#hierarchical-firewall-policies" id="hierarchical-firewall-policies"></a>

_рдкрджрд╛рдиреБрдХреНрд░рдорд┐рдХ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпрд╛рдБ_ рдЖрдкрдХреЛ рдЕрдкрдиреЗ рд╕рдВрдЧрдарди рдореЗрдВ рдПрдХ рд╕реБрд╕рдВрдЧрдд рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐ рдмрдирд╛рдиреЗ рдФрд░ **рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВ**ред рдЖрдк **рд╕рдВрдЧрдарди рдХреЗ рд╕рдордЧреНрд░ рд░реВрдк рдореЗрдВ рдпрд╛ рд╡реНрдпрдХреНрддрд┐рдЧрдд **рдлрд╝реЛрд▓реНрдбрд░реНрд╕** рдХреЛ рдкрджрд╛рдиреБрдХреНрд░рдорд┐рдХ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпрд╛рдБ рдЕрд╕рд╛рдЗрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрди рдиреАрддрд┐рдпреЛрдВ рдореЗрдВ рдирд┐рдпрдо рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдпрд╛ рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЪрд░рдгреЛрдВ рдореЗрдВ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк [**рд╕рдВрд╕рд╛рдзрди рдкрджрд╛рдиреБрдХреНрд░рдо**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy) рдХреЗ **рд╕рдВрдЧрдарди рдпрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдиреЛрдбреНрд╕ рдкрд░ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпрд╛рдБ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдПрдХ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐ рдирд┐рдпрдо рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреЛ **рдЕрд╡рд░реБрджреНрдз рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдХрдиреЗрдХреНрд╢рдиреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо рдореВрд▓реНрдпрд╛рдВрдХрди** рдХреЛ рдирд┐рдЪрд▓реЗ рд╕реНрддрд░ рдХреЗ рдлрд╝реЛрд▓реНрдбрд░реНрд╕ рдпрд╛ VPC рдиреЗрдЯрд╡рд░реНрдХреНрд╕ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд VPC рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдореЛрдВ рдХреЛ рд╕реНрдердЧрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╕рднреА рдкрджрд╛рдиреБрдХреНрд░рдорд┐рдХ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐ рдирд┐рдпрдо рд╕рдВрдЧрдарди рдпрд╛ рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рддрд╣рдд рд╕рднреА рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдореЗрдВ рд╕рднреА VMs рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк [рд▓рдХреНрд╖рд┐рдд рдиреЗрдЯрд╡рд░реНрдХреНрд╕ рдпрд╛ рд▓рдХреНрд╖рд┐рдд рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯреНрд╕](https://cloud.google.com/vpc/docs/firewall-policies#targets) рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ **рдХрд┐рди VMs рдХреЛ рдПрдХ рджрд┐рдпрд╛ рдЧрдпрд╛ рдирд┐рдпрдо рдорд┐рд▓рддрд╛ рд╣реИ** рдЗрд╕реЗ рд╕реАрдорд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк рдпрд╣рд╛рдБ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ [**рдкрджрд╛рдиреБрдХреНрд░рдорд┐рдХ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐ рдХреИрд╕реЗ рдмрдирд╛рдПрдВ**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud)ред

### рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо рдореВрд▓реНрдпрд╛рдВрдХрди

<figure><img src="../../../../.gitbook/assets/image (4) (5).png" alt=""><figcaption></figcaption></figure>

## рдХреНрд╖реЗрддреНрд░реАрдп рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпрд╛рдБ

рдпреЗ **рдХреНрд╖реЗрддреНрд░ рдХреЛ рд╕реМрдВрдкреЗ рдЧрдП рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо** рд╣реИрдВред

## VPC рдиреЗрдЯрд╡рд░реНрдХ рдкреАрдпрд░рд┐рдВрдЧ

рджреЛ Virtual Private Cloud (VPC) рдиреЗрдЯрд╡рд░реНрдХреНрд╕ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рддрд╛рдХрд┐ **рдкреНрд░рддреНрдпреЗрдХ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╕рдВрд╕рд╛рдзрди рдПрдХ рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░ рд╕рдХреЗрдВ**ред\
рдкреАрдпрд░реНрдб VPC рдиреЗрдЯрд╡рд░реНрдХреНрд╕ рдПрдХ рд╣реА рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ, рдПрдХ рд╣реА рд╕рдВрдЧрдарди рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдореЗрдВ, рдпрд╛ **рд╡рд┐рднрд┐рдиреНрди рд╕рдВрдЧрдардиреЛрдВ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕
