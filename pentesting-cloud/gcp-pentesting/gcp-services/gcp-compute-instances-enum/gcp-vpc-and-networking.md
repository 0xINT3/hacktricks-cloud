# GCP - VPC & Mtandao

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## **GCP Compute Mtandao kwa Kifupi**

**VPCs** ina **mipangilio ya Firewall** kuruhusu trafiki kuingia kwenye VPC. VPCs pia ina **subnetworks** ambapo **mashine za virtual** zitakuwa **zimeunganishwa**.\
Kulinganisha na AWS, **Firewall** itakuwa kitu **karibu** na **Vikundi vya Usalama vya AWS na NACLs**, lakini katika kesi hii hizi zinapatikana **katika VPC** na sio kwa kila kifaa.

## **VPC, Subnetworks & Firewalls katika GCP**

Mifumo ya Kuhesabu imeunganishwa **subnetworks** ambazo ni sehemu ya **VPCs** ([Cloud za Kibinafsi za Virtual](https://cloud.google.com/vpc/docs/vpc)). Katika GCP hakuna vikundi vya usalama, kuna [**firewalls za VPC**](https://cloud.google.com/vpc/docs/firewalls) na sheria zilizofafanuliwa kwenye kiwango hiki cha mtandao lakini zinatumika kwa kila Kifaa cha VM.

### Subnetworks

**VPC** inaweza kuwa na **subnetworks kadhaa**. Kila **subnetwork iko katika eneo 1**.

### Firewalls

Kwa chaguo-msingi, kila mtandao una sheria mbili za [**firewall zilizopendekezwa**](https://cloud.google.com/vpc/docs/firewalls#default\_firewall\_rules): **kuruhusu kutoka nje** na **kukataa kuingia**.

Wakati mradi wa GCP unapoanzishwa, VPC inayoitwa **`default`** pia inaundwa, na sheria za firewall zifuatazo:

* **kuruhusu-ndani-ya-kawaida:** kuruhusu trafiki yote kutoka kwa vifaa vingine kwenye mtandao wa `default`
* **kuruhusu-ssh-ya-kawaida:** kuruhusu 22 kutoka kote
* **kuruhusu-rdp-ya-kawaida:** kuruhusu 3389 kutoka kote
* **kuruhusu-icmp-ya-kawaida:** kuruhusu ping kutoka kote

{% hint style="warning" %}
Kama unavyoona, **sheria za firewall** huwa **zenye kibali zaidi** kwa **anwani za IP za ndani**. VPC ya chaguo-msingi inaruhusu trafiki yote kati ya Mashine za Kuhesabu.
{% endhint %}

Sheria zaidi za **Firewall** zinaweza kuundwa kwa VPC ya chaguo-msingi au kwa VPC mpya. [**Sheria za firewall**](https://cloud.google.com/vpc/docs/firewalls) zinaweza kutumika kwa vifaa kupitia njia zifuatazo:

* [**Lebo za Mtandao**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**Akaunti za Huduma**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **Vifaa vyote ndani ya VPC**

Kwa bahati mbaya, hakuna amri rahisi ya `gcloud` ya kutoa orodha ya Mashine za Kuhesabu zilizo na bandari wazi kwenye mtandao. Lazima uunganishe alama kati ya sheria za firewall, lebo za mtandao, akaunti za huduma, na vifaa.

Mchakato huu uliwekwa kiotomatiki kwa kutumia [skripti hii ya python](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp\_firewall\_enum) ambayo itaorodhesha yafuatayo:

* Faili ya CSV inayoonyesha kifaa, IP ya umma, TCP iliyoruhusiwa, UDP iliyoruhusiwa
* Uchunguzi wa nmap kwenye vifaa vyote kwenye bandari zilizoruhusiwa kuingia kutoka kwenye mtandao wa umma (0.0.0.0/0)
* masscan kwenye safu kamili ya TCP ya vifaa hivyo vinavyoruhusu Vifaa vyote vya TCP kutoka kwenye mtandao wa umma (0.0.0.0/0)

### Sera za Firewall za Hirarkia <a href="#hierarchical-firewall-policies" id="hierarchical-firewall-policies"></a>

_Sera za firewall za hirarkia_ kuruhusu kuunda na **kutekeleza sera thabiti ya firewall kote kwa shirika lako**. Unaweza kugawa **sera za firewall za hirarkia kwa shirika** nzima au kwa **folda binafsi**. Sera hizi zina sheria ambazo zinaweza kukataa au kuruhusu wazi mawasiliano.

Unaweza kuunda na kutumia sera za firewall kama hatua tofauti. Unaweza kuunda na kutumia sera za firewall kwenye **nodes za shirika au folda** ya [**hirarkia ya rasilimali**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy). Sheria ya sera ya firewall inaweza **kuzuia mawasiliano, kuruhusu mawasiliano, au kuchelewesha tathmini ya sheria ya firewall** kwa sheria za firewall za VPC zilizofafanuliwa katika mitandao ya VPC.

Kwa chaguo-msingi, sheria zote za sera za firewall za hirarkia zinatumika kwa VM zote katika miradi yote chini ya shirika au folda ambapo sera inahusishwa. Walakini, unaweza **kizuia ni VM zipi zinapata sheria iliyopewa** kwa kufafanua [mitandao ya lengo au akaunti za huduma](https://cloud.google.com/vpc/docs/firewall-policies#targets).

Unaweza kusoma hapa jinsi ya [**kuunda Sera ya Firewall ya Hirarkia**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud).

### Tathmini ya Sheria za Firewall

<figure><img src="../../../../.gitbook/assets/image (4) (5).png" alt=""><figcaption></figcaption></figure>

## Sera za Firewall za Kikanda

Hizi ni **Sheria za Firewall zilizopewa eneo**.

## Uunganisho wa Mtandao wa VPC

Inaruhusu kuunganisha mitandao miwili ya Cloud za Kibinafsi za Virtual (VPC) ili **rasilimali katika kila mtandao ziweze kufanya mawasiliano** kati yao.\
Mitandao iliyounganishwa ya VPC inaweza kuwa katika mradi mmoja, miradi tofauti ya shirika moja, au **miradi tofauti ya mashirika tofauti**.

Hizi ni idhini zinazohitajika:

* `compute.networks.addPeering`
* `compute.networks.updatePeering`
* `compute.networks.removePeering`
* `compute.networks.listPeeringRoutes`

[Zaidi katika nyaraka](https://cloud.google.com/vpc/docs/vpc-peering).

## Marejeo

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/vpc/docs/firewall-policies-overview#rule-evaluation](https://cloud.google.com/vpc/docs/firewall-policies-overview#rule-evaluation)

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
