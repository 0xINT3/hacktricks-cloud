# GCP - VPC ve Ağ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi Twitter'da 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live) takip edin.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek paylaşın.

</details>

## **GCP Compute Ağlama Özeti**

**VPC'ler**, VPC'ye gelen trafiğe izin vermek için **Güvenlik Duvarı** kuralları içerir. VPC'ler ayrıca **sanal makinelerin bağlı olacağı alt ağları** içerir.\
AWS ile karşılaştırıldığında, **Güvenlik Duvarı**, **AWS Güvenlik Grupları ve NACL'lerine** en yakın şey olurdu, ancak bu durumda bunlar **VPC'de** ve her bir örnekte değil **tanımlanır**.

## **GCP'de VPC, Alt Ağlar ve Güvenlik Duvarları**

Bilgi İşlem Örnekleri, **VPC'ye bağlı alt ağlar** ile bağlantılıdır. GCP'de güvenlik grupları yoktur, bunun yerine her bir VM Örneğine uygulanan [**VPC güvenlik duvarları**](https://cloud.google.com/vpc/docs/firewalls) bulunur.

### Alt Ağlar

Bir **VPC**, **birkaç alt ağa** sahip olabilir. Her **alt ağ bir bölgede** bulunur.

### Güvenlik Duvarları

Her ağın varsayılan olarak iki [**varsayılan güvenlik duvarı kuralı**](https://cloud.google.com/vpc/docs/firewalls#default_firewall_rules) vardır: **giden trafiği izin ver** ve **gelen trafiği reddet**.

Bir GCP projesi oluşturulduğunda, aşağıdaki güvenlik duvarı kurallarına sahip **`varsayılan`** adında bir VPC de oluşturulur:

* **default-allow-internal:** `varsayılan` ağındaki diğer örneklerden gelen tüm trafiği izin ver
* **default-allow-ssh:** her yerden 22'ye izin ver
* **default-allow-rdp:** her yerden 3389'a izin ver
* **default-allow-icmp:** her yerden ping'e izin ver

{% hint style="warning" %}
Gördüğünüz gibi, **güvenlik duvarı kuralları** genellikle **dahili IP adresleri** için **daha izin vericidir**. Varsayılan VPC, Bilgi İşlem Örnekleri arasındaki tüm trafiğe izin verir.
{% endhint %}

Varsayılan VPC veya yeni VPC'ler için daha fazla **Güvenlik Duvarı kuralı** oluşturulabilir. [**Güvenlik Duvarı kuralları**](https://cloud.google.com/vpc/docs/firewalls), aşağıdaki **yöntemlerle** örnekler üzerine uygulanabilir:

* [**Ağ etiketleri**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**Hizmet hesapları**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **Bir VPC içindeki tüm örnekler**

Ne yazık ki, internet üzerinde açık portlara sahip tüm Bilgi İşlem Örneklerini gösteren basit bir `gcloud` komutu yoktur. Güvenlik duvarı kuralları, ağ etiketleri, hizmet hesapları ve örnekler arasındaki bağlantıları kurmanız gerekmektedir.

Bu süreç, aşağıdaki [python betiği](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp_firewall_enum) kullanılarak otomatikleştirilmiştir:

* Örneği, genel IP'si, izin verilen TCP'si ve izin verilen UDP'si gösteren CSV dosyası
* Genel internetten (0.0.0.0/0) gelen giriş izinli tüm örnekler için nmap taraması
* Genel internetten (0.0.0.0/0) TÜM TCP portlarına izin veren örneklerin tam TCP aralığına yönelik masscan taraması

### Hiyerarşik Güvenlik Duvarı Politikaları <a href="#hierarchical-firewall-policies" id="hierarchical-firewall-policies"></a>

_Hiyerarşik güvenlik duvarı politikaları_, **kuruluşunuzda tutarlı bir güvenlik duvarı politikası oluşturmanıza ve uygulamanıza** olanak tanır. Hiyerarşik güvenlik duvarı politikalarını **kuruluşun** tamamına veya **bireysel klasörlere** atayabilirsiniz. Bu politikalar, bağlantıları açıkça reddeden veya izin veren kurallar içerir.

Güvenlik duvarı politikalarını oluşturma ve uygulama ayrı adımlardır. Güvenlik duvarı politikalarını [**kaynak hiyerarşisi**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)ndeki **kuruluş veya klasör düğümlerine** oluşturabilir ve uygulayabilirsiniz. Bir güvenlik duvarı politikası kuralı, bağlantıları **engelleyebilir, izin verebilir veya VPC ağlarında tanımlanan VPC güvenlik duvarı kurallarına** bağlı olarak güvenlik duvarı kuralı değerlendirmesini **alt düzey klasörlere veya VPC güvenlik duvarı kurallarına erteleyebilir**.

Varsayılan olarak, hiyerarşik güvenlik duvarı politika kuralları, politikanın ilişkilendirildiği kuruluş veya klasör altındaki tüm projelerdeki tüm VM'ler için geçerlidir. Bununla birlikte, belirli [hedef ağlar veya hedef hizmet hesapları](https://cloud.google.com/vpc/docs/firewall-policies#targets) belirterek bir kuralın hangi VM'lerin alacağını **sınırlayabilirsiniz**.

[**Bir Hiyerarşik Güvenlik Duvarı Politikası nasıl oluşturulacağını**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud) buradan okuyabilirsiniz.

### Güvenlik Duvarı Kuralları Değerlendirmesi

<figure><img src="../../../../.gitbook/assets/image (4) (5).png" alt=""><figcaption></figcaption></figure>

## Bölgesel Güvenlik Duvarı Politikaları

Bunlar, **bir bölgeye atanan Güvenlik Duvarı kurallarıdır**.

## VPC Ağı Eşleme
