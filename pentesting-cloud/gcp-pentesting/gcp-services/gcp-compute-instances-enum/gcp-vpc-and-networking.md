# GCP - VPC i Mreže

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## **GCP Compute Mreže ukratko**

**VPC-ovi** sadrže **Firewall** pravila koja omogućavaju dolazni saobraćaj u VPC. VPC-ovi takođe sadrže **podmreže** u kojima će biti **povezane virtuelne mašine**.\
U poređenju sa AWS-om, **Firewall** bi bio **najbliža** stvar **AWS Security Groups i NACLs**, ali u ovom slučaju oni su **definisani u VPC-u** a ne u svakoj instanci.

## **VPC, Podmreže i Firewall u GCP-u**

Računarske instance su povezane **podmrežama** koje su deo **VPC-ova** ([Virtual Private Clouds](https://cloud.google.com/vpc/docs/vpc)). U GCP-u ne postoje sigurnosne grupe, već postoje [**VPC firewall-i**](https://cloud.google.com/vpc/docs/firewalls) sa pravilima definisanim na ovom nivou mreže, ali primenjenim na svaku VM instancu.

### Podmreže

Jedan **VPC** može imati **više podmreža**. Svaka **podmreža je u jednoj regiji**.

### Firewall-i

Podrazumevano, svaka mreža ima dva [**podrazumevana firewall pravila**](https://cloud.google.com/vpc/docs/firewalls#default\_firewall\_rules): **dozvoli odlazni** i **zabrani dolazni** saobraćaj.

Kada se kreira GCP projekat, takođe se kreira VPC pod nazivom **`default`**, sa sledećim firewall pravilima:

* **default-allow-internal:** dozvoljava sav saobraćaj sa drugih instanci na `default` mreži
* **default-allow-ssh:** dozvoljava 22 sa bilo kog mesta
* **default-allow-rdp:** dozvoljava 3389 sa bilo kog mesta
* **default-allow-icmp:** dozvoljava ping sa bilo kog mesta

{% hint style="warning" %}
Kao što možete videti, **firewall pravila** su obično **više dozvoljavajuća** za **interne IP adrese**. Podrazumevani VPC dozvoljava sav saobraćaj između računarskih instanci.
{% endhint %}

Više **firewall pravila** može biti kreirano za podrazumevani VPC ili za nove VPC-ove. [**Firewall pravila**](https://cloud.google.com/vpc/docs/firewalls) mogu biti primenjena na instance putem sledećih **metoda**:

* [**Mrežni tagovi**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**Servisni nalozi**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **Sve instance unutar VPC-a**

Nažalost, ne postoji jednostavna `gcloud` komanda koja će prikazati sve računarske instance sa otvorenim portovima na internetu. Morate povezati tačke između firewall pravila, mrežnih tagova, servisnih naloga i instanci.

Ovaj proces je automatizovan korišćenjem [ovog python skripta](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp\_firewall\_enum) koji će izvesti sledeće:

* CSV fajl koji prikazuje instancu, javnu IP adresu, dozvoljeni TCP, dozvoljeni UDP
* nmap skeniranje koje cilja sve instance na portovima za dolazni saobraćaj sa javnog interneta (0.0.0.0/0)
* masscan koji cilja ceo TCP opseg tih instanci koje dozvoljavaju SVE TCP portove sa javnog interneta (0.0.0.0/0)

### Hijerarhijske Firewall Politike <a href="#hierarchical-firewall-policies" id="hierarchical-firewall-policies"></a>

_Hijerarhijske firewall politike_ vam omogućavaju da kreirate i **primenite doslednu firewall politiku u celoj vašoj organizaciji**. Možete dodeliti **hijerarhijske firewall politike organizaciji** u celini ili pojedinačnim **folderima**. Ove politike sadrže pravila koja mogu eksplicitno zabraniti ili dozvoliti konekcije.

Kreirate i primenjujete firewall politike kao odvojene korake. Možete kreirati i primeniti firewall politike na **čvorovima organizacije ili foldera** u [**hijerarhiji resursa**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy). Pravilo firewall politike može **blokirati konekcije, dozvoliti konekcije ili odložiti evaluaciju pravila firewall-a** na nižim nivoima foldera ili VPC firewall pravila definisanih u VPC mrežama.

Podrazumevano, sva pravila hijerarhijske firewall politike se primenjuju na sve VM-ove u svim projektima u okviru organizacije ili foldera gde je politika povezana. Međutim, možete **ograničiti kojim VM-ovima se dodeljuje dato pravilo** tako što ćete specificirati [ciljne mreže ili ciljne servisne naloge](https://cloud.google.com/vpc/docs/firewall-policies#targets).

Ovde možete pročitati kako [**kreirati hijerarhijsku firewall politiku**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud).

### Evaluacija pravila Firewall-a

<figure><img src="../../../../.gitbook/assets/image (4) (5).png" alt=""><figcaption></figcaption></figure>

## Regionalne Firewall Politike

Ovo su **Firewall pravila dodeljena regionu**.

## Povezivanje VPC Mreža

Omogućava povezivanje dve Virtual Private Cloud (VPC) mreže tako da **resursi u svakoj mreži mogu komunicirati** međusobno.\
Povezane VPC mreže mogu biti u istom projektu, različitim projektima iste organizacije ili **različitim projektima različitih organizacija**.

Potrebne dozvole su:

* `compute.networks.addPeering`
* `compute.networks.updatePeering`
* `
