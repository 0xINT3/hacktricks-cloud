# GCP - Compute Instance

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>

### Confidential VM

Confidential VMは、AMD EPYCプロセッサの最新世代が提供する**ハードウェアベースのセキュリティ機能**を使用します。これにはメモリ暗号化とセキュア暗号化仮想化が含まれます。これらの機能により、VMはホストオペレーティングシステムやハイパーバイザーからも、処理および保存されているデータを保護することができます。

Confidential VMを実行するには、**マシンのタイプ**、ネットワーク**インターフェース**、**ブートディスクイメージ**などを**変更**する必要があるかもしれません。

### Disk & Disk Encryption

使用するディスクを**選択する**か、**新しいディスクを作成する**ことができます。新しいディスクを選択した場合、以下を行うことができます：

* ディスクの**サイズ**を選択する
* **OS**を選択する
* インスタンスが削除されたときにディスクを**削除するかどうか**を指定する
* **暗号化**：**デフォルト**では**Google管理のキー**が使用されますが、KMSからキーを**選択する**か、使用する**生のキー**を指定することもできます。

### Deploy Container

作成された仮想マシン内にコンテナをデプロイし、特権実行、stdin、擬似TTYなど、このコンテナのいくつかのオプションを設定することができます。

### Service Account

デフォルトでは、**Compute Engineデフォルトサービスアカウント**が使用されます。このSAのメールアドレスは次のようになります：`<proj-num>-compute@developer.gserviceaccount.com`\
このサービスアカウントには、プロジェクト全体に対する**Editorロール（高い権限）**があります。

そして、**デフォルトのアクセススコープ**は以下の通りです：

* **https://www.googleapis.com/auth/devstorage.read\_only** -- バケットへの読み取りアクセス :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

ただし、**`cloud-platform`をクリックで付与する**ことも、**カスタムスコープを指定する**ことも可能です。

### Firewall

HTTPおよびHTTPSトラフィックを許可することができます。

### IP Forwarding

インスタンスの作成時に**IPフォワーディングを有効にする**ことができます。

### Extra Security

これらのオプションはVMのセキュリティを**強化する**もので、推奨されます：

* **セキュアブート**
* **vTPMを有効にする**
* **完全性監視**

### VM Access

VMへのアクセスを有効にする一般的な方法は、特定のSSH公開キーを許可することです。\
しかし、IAMを使用して`os-config`サービスを介してVMへのアクセスを**有効にする**ことも可能です。さらに、このサービスを使用してVMへのアクセスに2FAを有効にすることもできます。\
この**サービスが** **有効になる**と、**SSHキーによるアクセスは無効になります。**

### Metadata

**ユーザーデータ**を定義することができます：マシンがオンになるか再起動するたびに実行される**シェルコマンド**。

また、メタデータエンドポイントからアクセス可能な**追加のメタデータキー値ペア**を追加することもできます。この情報は、環境変数や起動/シャットダウンスクリプトに一般的に使用されます。これは、列挙セクションのコマンドの**`describe`メソッド**を使用して取得することができますが、インスタンス内部からメタデータエンドポイントにアクセスして取得することもできます。
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
さらに、**添付されたサービスアカウントの認証トークン**とインスタンス、ネットワーク、プロジェクトに関する**一般情報**も、**メタデータエンドポイント**から入手可能です。詳細は以下をチェックしてください：

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)で</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加する、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
