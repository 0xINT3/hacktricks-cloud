# GCP - 计算实例

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>

### 机密 VM

机密 VM 使用最新一代 AMD EPYC 处理器提供的基于硬件的安全功能，包括内存加密和安全加密虚拟化。这些功能使得 VM 能够保护其内部处理和存储的数据，即使是来自主机操作系统和虚拟化程序的攻击也无法窃取。

要运行机密 VM，可能需要更改诸如**机器类型**、**网络接口**、**引导磁盘映像**等内容。

### 磁盘和磁盘加密

可以**选择要使用的磁盘**或**创建新的磁盘**。如果选择创建新的磁盘，您可以：

* 选择磁盘的**大小**
* 选择**操作系统**
* 指示是否在删除实例时**删除磁盘**
* **加密**：默认情况下，将使用**Google 管理的密钥**，但您也可以**选择来自 KMS 的密钥**或指定**要使用的原始密钥**。

### 部署容器

可以在创建的虚拟机中部署容器，并为该容器配置多个选项，如特权执行、标准输入、伪 TTY 等。

### 服务帐号

默认情况下，将使用**计算引擎默认服务帐号**。此服务帐号的电子邮件格式为：`<proj-num>-compute@developer.gserviceaccount.com`\
此服务帐号在整个项目中具有**编辑器角色（高权限）**。

默认的**访问范围**如下：

* **https://www.googleapis.com/auth/devstorage.read\_only** -- 读取存储桶的访问权限 :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

但是，可以通过单击**授予 `cloud-platform` 权限**或指定**自定义权限**来修改。

### 防火墙

可以允许 HTTP 和 HTTPS 流量

### IP 转发

可以在创建实例时**启用 IP 转发**。

### 额外安全性

以下选项将**增加 VM 的安全性**，建议使用：

* **安全启动**
* **启用 vTPM**
* **完整性监控**

### VM 访问

启用对 VM 的访问的常见方法是**允许特定的 SSH 公钥**以允许访问 VM。\
但是，也可以通过使用 IAM **启用通过 `os-config` 服务访问 VM**。此外，还可以通过此服务启用 2FA 来访问 VM。\
当启用此**服务**时，通过**SSH 密钥的访问将被禁用**。

### 元数据

可以定义**用户数据**：每次机器启动或重新启动时将执行的**Shell 命令**。

还可以**添加额外的元数据键值对**，这些键值对将可以从元数据端点访问。此信息通常用于环境变量和启动/关闭脚本。可以使用枚举部分中的命令的**`describe` 方法**获取此信息，但也可以从实例内部访问元数据端点来检索此信息。
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
此外，**附加服务帐户的身份验证令牌**以及有关实例、网络和项目的**常规信息**也可以从**元数据端点**获取。有关更多信息，请查看：&#x20;

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的**公司广告**，或者如果您想访问**PEASS 的最新版本或下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>
