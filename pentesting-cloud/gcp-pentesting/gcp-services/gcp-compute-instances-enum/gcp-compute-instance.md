# GCP - Instancia de C√≥mputo

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si deseas ver a tu **empresa anunciada en HackTricks** o si deseas acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

### VM Confidencial

Las VM confidenciales utilizan **caracter√≠sticas de seguridad basadas en hardware** ofrecidas por la √∫ltima generaci√≥n de procesadores AMD EPYC, que incluyen cifrado de memoria y virtualizaci√≥n cifrada segura. Estas caracter√≠sticas permiten que la VM proteja los datos procesados y almacenados en su interior incluso del sistema operativo host y del hipervisor.

Para ejecutar una VM confidencial, puede ser necesario **cambiar** cosas como el **tipo** de la **m√°quina**, la **interfaz** de red, la **imagen del disco de arranque**.

### Disco y cifrado de disco

Es posible **seleccionar el disco** a utilizar o **crear uno nuevo**. Si selecciona uno nuevo, puede:

* Seleccionar el **tama√±o** del disco
* Seleccionar el **SO**
* Indicar si desea **eliminar el disco cuando se elimine la instancia**
* **Cifrado**: Por **defecto** se usar√° una **clave administrada por Google**, pero tambi√©n puede **seleccionar una clave de KMS** o indicar una **clave sin procesar para usar**.

### Despliegue de contenedor

Es posible desplegar un contenedor dentro de la m√°quina virtual creada y configurar varias opciones para este contenedor, como ejecutarlo como privilegiado, stdin, pseudo TTY...

### Cuenta de servicio

Por defecto, se utilizar√° la **cuenta de servicio predeterminada de Compute Engine**. El correo electr√≥nico de esta SA es como: `<proj-num>-compute@developer.gserviceaccount.com`\
Esta cuenta de servicio tiene **permisos de Editor sobre todo el proyecto (altos privilegios).**

Y los **alcances de acceso predeterminados** son los siguientes:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Acceso de lectura a los buckets :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Sin embargo, es posible **concederle `cloud-platform` con un clic** o especificar **personalizados**.

### Firewall

Es posible permitir el tr√°fico HTTP y HTTPS.

### Reenv√≠o de IP

Es posible **habilitar el reenv√≠o de IP** desde la creaci√≥n de la instancia.

### Seguridad adicional

Estas opciones **aumentar√°n la seguridad** de la VM y se recomiendan:

* **Arranque seguro**
* **Habilitar vTPM**
* **Supervisi√≥n de integridad**

### Acceso a la VM

La forma com√∫n de habilitar el acceso a la VM es **permitiendo ciertas claves p√∫blicas SSH** para permitir la VM.\
Sin embargo, tambi√©n es posible **habilitar el acceso a la VM a trav√©s del servicio `os-config` usando IAM**. Adem√°s, es posible habilitar la autenticaci√≥n de dos factores para acceder a la VM mediante este servicio.\
Cuando este **servicio** est√° **habilitado**, el acceso a trav√©s de **claves SSH est√° deshabilitado**.

### Metadatos

Es posible definir **datos de usuario**: **comandos de shell** que se ejecutar√°n cada vez que la m√°quina se encienda o reinicie.

Tambi√©n es posible **agregar valores clave de metadatos adicionales** que ser√°n accesibles desde el punto final de metadatos. Esta informaci√≥n se utiliza com√∫nmente para variables de entorno y scripts de inicio/apagado. Esto se puede obtener utilizando el m√©todo **`describe`** de un comando en la secci√≥n de enumeraci√≥n, pero tambi√©n se puede recuperar desde el interior de la instancia accediendo al punto final de metadatos.

```bash
# ver metadatos del proyecto
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
    -H "Metadata-Flavor: Google"

# ver metadatos de la instancia
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
    -H "Metadata-Flavor: Google"
```

Adem√°s, el **token de autenticaci√≥n para la cuenta de servicio adjunta** y la **informaci√≥n general** sobre la instancia, la red y el proyecto tambi√©n estar√°n disponibles desde el **punto final de metadatos**. Para obtener m√°s informaci√≥n, consulte:&#x20;

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si deseas ver a tu **empresa anunciada en HackTricks** o si deseas acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>