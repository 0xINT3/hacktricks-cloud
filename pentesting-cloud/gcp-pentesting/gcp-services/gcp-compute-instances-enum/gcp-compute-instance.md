# GCP - 计算实例

<details>

<summary><strong>从零到英雄学习AWS黑客技术，参加</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**以PDF格式下载HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>

### 保密VM

保密VM使用由最新一代AMD EPYC处理器提供的**基于硬件的安全功能**，其中包括内存加密和安全加密虚拟化。这些功能使VM能够保护其内部处理和存储的数据，即使是主机操作系统和虚拟机管理程序也无法访问。

要运行保密VM，可能需要**更改**一些设置，如**机器**的**类型**、网络**接口**、**启动磁盘映像**。

### 磁盘 & 磁盘加密

可以**选择使用的磁盘**或**创建新的磁盘**。如果选择新的磁盘，您可以：

* 选择磁盘的**大小**
* 选择**操作系统**
* 指明是否希望在实例删除时**删除磁盘**
* **加密**：**默认情况下**将使用**Google管理的密钥**，但您也可以**从KMS选择密钥**或指明**要使用的原始密钥**。

### 部署容器

可以在创建的虚拟机内部部署容器，并为此容器配置多个选项，如以特权模式执行、stdin、伪TTY等。

### 服务账户

默认情况下，将使用**Compute Engine默认服务账户**。此服务账户的电子邮件格式如下：`<proj-num>-compute@developer.gserviceaccount.com`\
这个服务账户在整个项目中拥有**编辑者角色（高权限）。**

默认的访问范围如下：

* **https://www.googleapis.com/auth/devstorage.read\_only** -- 对存储桶的读取权限 :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

然而，也可以**一键授予`cloud-platform`权限**或指定**自定义权限**。

### 防火墙

可以允许HTTP和HTTPS流量。

### IP转发

可以在实例创建时**启用IP转发**。

### 额外安全性

以下选项将**提高VM的安全性**，建议启用：

* **安全启动**
* **启用vTPM**
* **完整性监督**

### VM访问

常见的启用对VM的访问方式是**允许某些SSH公钥**。\
然而，也可以通过`os-config`服务**启用对VM的访问，并使用IAM**。此外，还可以启用2FA以通过此服务访问VM。\
当此**服务**被**启用**时，通过**SSH密钥的访问将被禁用。**

### 元数据

可以定义**userdata**：**Shell命令**，每次机器开机或重启时都会执行。

还可以**添加额外的元数据键值对**，这些将可以从元数据端点访问。这些信息通常用于环境变量和启动/关闭脚本。可以使用枚举部分中命令的**`describe`方法**获取这些信息，但也可以在实例内部访问元数据端点来检索。
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
此外，**附加服务账户的认证令牌**和有关实例、网络和项目的**一般信息**也将可从**元数据端点**获取。更多信息请查看：

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

<details>

<summary><strong>从零开始学习AWS黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您希望在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF版本**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方的PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFT系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**telegram群组**](https://t.me/peass)或在**Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来**分享您的黑客技巧**。

</details>
