# GCP - 计算实例

<details>

<summary><strong>从零到英雄学习AWS黑客技术，参加</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在 **HackTricks中看到您的公司广告** 或 **下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>

## 基本信息

Google Cloud 计算实例是 **Google云基础设施上的可定制虚拟机**，为各种应用程序提供可扩展和按需计算能力。它们提供全球部署、持久存储、灵活的操作系统选择以及强大的网络和安全集成等功能，使其成为托管网站、处理数据和高效在云中运行应用程序的多功能选择。

### 保密VM

保密VM使用最新一代AMD EPYC处理器提供的**基于硬件的安全功能**，其中包括内存加密和安全加密虚拟化。这些功能使VM能够保护其内部处理和存储的数据，即使是主机操作系统和虚拟机管理程序也无法访问。

要运行保密VM，可能需要**更改**诸如**机器**类型、网络**接口**、**启动磁盘映像**等内容。

### 磁盘 & 磁盘加密

可以**选择使用的磁盘**或**创建新的磁盘**。如果选择新的磁盘，您可以：

* 选择磁盘的**大小**
* 选择**操作系统**
* 指定是否希望在实例删除时**删除磁盘**
* **加密**：默认情况下，将使用**Google管理的密钥**，但您也可以**从KMS选择密钥**或指定**使用原始密钥**。

### 部署容器

可以在虚拟机内部部署**容器**。\
可以配置要使用的**镜像**，设置在内部运行的**命令**、**参数**，挂载**卷**，以及配置容器的多个选项，如以**特权**执行、stdin和伪TTY。

### 服务账户

默认情况下，将使用**Compute Engine默认服务账户**。此服务账户的电子邮件格式如下：`<proj-num>-compute@developer.gserviceaccount.com`\
此服务账户在整个项目中具有**编辑者角色（高权限）。**

默认访问范围如下：

* **https://www.googleapis.com/auth/devstorage.read\_only** -- 对存储桶的读取访问权限 :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

然而，可以**单击一下即授予`cloud-platform`**或指定**自定义的**。

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### 防火墙

可以允许HTTP和HTTPS流量。

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### 网络

* **IP转发**：可以在实例创建时**启用IP转发**。
* **主机名**：可以给实例一个永久的主机名。
* **接口**：可以添加网络接口。

### 额外安全

这些选项将**提高VM的安全性**，建议使用：

* **安全启动**：安全启动有助于保护您的VM实例免受启动级和内核级恶意软件和rootkits的侵害。
* **启用vTPM**：虚拟可信平台模块（vTPM）验证您的来宾VM的预启动和启动完整性，并提供密钥生成和保护。
* **完整性监督**：完整性监控允许您使用Stackdriver报告监控和验证您的屏蔽VM实例的运行时启动完整性。需要启用vTPM。

### VM访问

启用对VM的访问的常见方式是**允许某些SSH公钥**访问VM。\
然而，也可以**通过`os-config`服务使用IAM启用对VM的访问**。此外，可以启用此服务的2FA以访问VM。\
当此**服务**被**启用**时，通过**SSH密钥的访问将被禁用**。

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### 元数据

可以定义**自动化**（AWS中的userdata），这些是**shell命令**，每次机器开机或重启时都会执行。

还可以**添加额外的元数据键值对**，这些将可以从元数据端点访问。这些信息通常用于环境变量和启动/关闭脚本。可以使用枚举部分中的命令的**`describe`方法**获取这些信息，但也可以从实例内部访问元数据端点来检索。
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
### 加密

默认情况下使用 Google 管理的加密密钥，但可以配置客户管理的加密密钥（CMEK）。您还可以配置当使用的 CMEK 被撤销时的操作：不执行任何操作或关闭 VM。

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

<details>

<summary><strong>从零开始学习 AWS 黑客攻击直到成为专家，通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

其他支持 HackTricks 的方式：

* 如果您希望在 HackTricks 中看到您的**公司广告**或**下载 HackTricks 的 PDF 版本**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFT 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享您的黑客技巧**。

</details>
