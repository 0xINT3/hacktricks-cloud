# GCP - Računarski instanci

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Google Cloud računarske instance su **prilagodljive virtuelne mašine na Google-ovoj cloud infrastrukturi**, koje pružaju skalabilnu i na zahtev računarsku snagu za širok spektar aplikacija. Pružaju mogućnosti kao što su globalno raspoređivanje, trajno skladištenje, fleksibilan izbor operativnih sistema i snažne integracije mreže i bezbednosti, čineći ih svestranim izborom za hosting veb sajtova, obradu podataka i efikasno pokretanje aplikacija u oblaku.

### Poverljiva VM

Poverljive VM koriste **bezbednosne funkcije zasnovane na hardveru** koje pružaju najnovije generacije AMD EPYC procesora, a koje uključuju enkripciju memorije i sigurnu enkripciju virtualizacije. Ove funkcije omogućavaju VM-u da zaštiti podatke koji se obrađuju i skladište unutar njega čak i od operativnog sistema domaćina i hipervizora.

Da biste pokrenuli poverljivu VM, možda će biti potrebno **promeniti** stvari kao što su **tip** **mašine**, **mrežni interfejs**, **slika pokretne diskete**.

### Disk i enkripcija diska

Moguće je **izabrati disk** koji će se koristiti ili **kreirati novi**. Ako izaberete novi disk, možete:

* Izabrati **veličinu** diska
* Izabrati **operativni sistem**
* Označiti da li želite da **obrišete disk kada se instanca obriše**
* **Enkripcija**: Podrazumevano će se koristiti **Google upravljani ključ**, ali možete takođe **izabrati ključ iz KMS** ili navesti **sirovi ključ koji će se koristiti**.

### Implementacija kontejnera

Moguće je implementirati **kontejner** unutar virtuelne mašine.\
Moguće je konfigurisati **sliku** koja će se koristiti, postaviti **komandu** koja će se izvršiti unutar nje, **argumente**, montirati **volume** i **env promenljive** (osetljive informacije?) i konfigurisati nekoliko opcija za ovaj kontejner kao što je izvršavanje kao **privilegovan**, stdin i pseudo TTY.

### Servisni nalog

Podrazumevano će se koristiti **servisni nalog za podrazumevanu računarsku mašinu**. E-pošta ovog servisnog naloga izgleda ovako: `<proj-br>-compute@developer.gserviceaccount.com`\
Ovaj servisni nalog ima **Uredničku ulogu nad celim projektom (visoke privilegije).**

A **podrazumevani pristupni opsezi** su sledeći:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Pristup za čitanje kofa :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Međutim, moguće je **dodeliti mu `cloud-platform` sa jednim klikom** ili specificirati **prilagođene opsege**.

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### Firewall

Moguće je dozvoliti HTTP i HTTPS saobraćaj.

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### Mrežno povezivanje

* **Prosleđivanje IP adrese**: Moguće je **omogućiti prosleđivanje IP adrese** prilikom kreiranja instance.
* **Hostname**: Moguće je dodeliti instanci trajno ime hosta.
* **Interfejs**: Moguće je dodati mrežni interfejs.

### Dodatna bezbednost

Ove opcije će **povećati bezbednost** VM-a i preporučuju se:

* **Sigurno podizanje sistema**: Sigurno podizanje sistema pomaže u zaštiti vaših VM instanci od malvera na nivou podizanja sistema i jezgra i rootkitova.
* **Omogući vTPM**: Virtuelni Trusted Platform Module (vTPM) validira pre-boot i boot integritet vašeg gostujućeg VM-a i nudi generisanje i zaštitu ključeva.
* **Nadzor integriteta**: Nadzor integriteta omogućava vam praćenje i proveru integriteta pokretanja u toku vaših VM instanci sa zaštitom pomoću Stackdriver izveštaja. Zahteva omogućen vTPM.

### Pristup VM-u

Uobičajeni način omogućavanja pristupa VM-u je **dozvoljavanje određenih SSH javnih ključeva** za pristup VM-u.\
Međutim, moguće je takođe **omogućiti pristup VM-u putem `os-config` servisa koristeći IAM**. Osim toga, moguće je omogućiti 2FA za pristup VM-u putem ovog servisa.\
Kada je ovaj **servis** **omogućen**, pristup putem **SSH ključeva je onemogućen**.

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### Metapodaci

Moguće je definisati **automatizaciju** (userdata u AWS-u) koja su **shell komande** koje će se izvršiti svaki put kada se mašina uključi ili restartuje.

Takođe je moguće **dodati dodatne metapodatke ključ-vrednost** koji će biti dostupni sa metapodatkovog endpointa. Ove informacije se obično koriste za promenljive okruženja i skripte za pokretanje/zaustavljanje. Ovo se može dobiti korišćenjem **`describe` metode** iz komande u sekciji enumeracije, ali se takođe može dobiti iznutra instance pristupanjem metapodatkovom endpointu.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Osim toga, **autentični token za pridruženi servisni nalog** i **opšte informacije** o instanci, mreži i projektu takođe će biti dostupne putem **metadata endpointa**. Za više informacija pogledajte:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Enkripcija

Podrazumevano se koristi Google-ov upravljani ključ za enkripciju, ali može se konfigurisati i korisnički upravljani ključ za enkripciju (CMEK). Takođe možete konfigurisati šta treba da se uradi kada se koristi CMEF povuče: Ništa ili isključivanje virtuelne mašine.

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini da podržite HackTricks:

* Ako želite da vidite **vašu kompaniju oglašenu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
