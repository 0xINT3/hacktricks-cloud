# GCP - Inst√¢ncia de Computa√ß√£o

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no Github.

</details>

### VM Confidencial

As VMs confidenciais usam **recursos de seguran√ßa baseados em hardware** oferecidos pela √∫ltima gera√ß√£o de processadores AMD EPYC, que incluem criptografia de mem√≥ria e virtualiza√ß√£o criptografada segura. Esses recursos permitem que a VM proteja os dados processados e armazenados dentro dela, mesmo do sistema operacional host e do hipervisor.

Para executar uma VM confidencial, pode ser necess√°rio **alterar** coisas como o **tipo** da **m√°quina**, a **interface** de rede, a **imagem do disco de inicializa√ß√£o**.

### Disco e Criptografia de Disco

√â poss√≠vel **selecionar o disco** a ser usado ou **criar um novo**. Se voc√™ selecionar um novo, poder√°:

* Selecionar o **tamanho** do disco
* Selecionar o **SO**
* Indicar se deseja **excluir o disco quando a inst√¢ncia for exclu√≠da**
* **Criptografia**: Por **padr√£o**, uma **chave gerenciada pelo Google** ser√° usada, mas voc√™ tamb√©m pode **selecionar uma chave do KMS** ou indicar **chave bruta a ser usada**.

### Implanta√ß√£o de Cont√™iner

√â poss√≠vel implantar um cont√™iner dentro da m√°quina virtual criada e configurar v√°rias op√ß√µes para este cont√™iner, como executar como privilegiado, stdin, pseudo TTY...

### Conta de Servi√ßo

Por padr√£o, a **conta de servi√ßo padr√£o do Compute Engine** ser√° usada. O e-mail deste SA √© como: `<proj-num>-compute@developer.gserviceaccount.com`\
Esta conta de servi√ßo tem **fun√ß√£o de Editor sobre todo o projeto (altos privil√©gios).**

E os **escopos de acesso padr√£o** s√£o os seguintes:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Acesso de leitura aos buckets :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

No entanto, √© poss√≠vel **conceder `cloud-platform` com um clique** ou especificar **personalizados**.

### Firewall

√â poss√≠vel permitir tr√°fego HTTP e HTTPS.

### Encaminhamento de IP

√â poss√≠vel **ativar o encaminhamento de IP** a partir da cria√ß√£o da inst√¢ncia.

### Seguran√ßa Extra

Essas op√ß√µes v√£o **aumentar a seguran√ßa** da VM e s√£o recomendadas:

* **Inicializa√ß√£o segura**
* **Ativar vTPM**
* **Supervis√£o de integridade**

### Acesso √† VM

A maneira comum de permitir o acesso √† VM √© **permitir certas chaves p√∫blicas SSH** para permitir a VM.\
No entanto, tamb√©m √© poss√≠vel **ativar o acesso √† VM via servi√ßo `os-config` usando IAM**. Al√©m disso, √© poss√≠vel ativar a autentica√ß√£o de dois fatores para acessar a VM usando este servi√ßo.\
Quando este **servi√ßo** √© **ativado**, o acesso via **chaves SSH √© desativado**.

### Metadados

√â poss√≠vel definir **dados do usu√°rio**: **comandos do shell** que ser√£o executados toda vez que a m√°quina for ligada ou reiniciada.

Tamb√©m √© poss√≠vel **adicionar valores de chave-valor de metadados extras** que ser√£o acess√≠veis a partir do endpoint de metadados. Essas informa√ß√µes s√£o comumente usadas para vari√°veis de ambiente e scripts de inicializa√ß√£o/desligamento. Isso pode ser obtido usando o **m√©todo `describe`** de um comando na se√ß√£o de enumera√ß√£o, mas tamb√©m pode ser recuperado de dentro da inst√¢ncia acessando o endpoint de metadados.

```bash
# visualizar metadados do projeto
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
    -H "Metadata-Flavor: Google"

# visualizar metadados da inst√¢ncia
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
    -H "Metadata-Flavor: Google"
```

Al√©m disso, o **token de autentica√ß√£o para a conta de servi√ßo anexada** e **informa√ß√µes gerais** sobre a inst√¢ncia, rede e projeto tamb√©m estar√£o dispon√≠veis a partir do **endpoint de metadados**. Para mais informa√ß√µes, consulte:&#x20;

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no Github.

</details>