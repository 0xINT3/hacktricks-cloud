# GCP - Cloud Run Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run은 Google의 확장 가능한 인프라 위에 직접 **컨테이너를 실행**할 수 있는 서버리스 관리형 컴퓨팅 플랫폼입니다.

Go, Node.js, Python, Java, .NET Core 또는 Ruby를 사용하는 경우 [소스 기반 배포](https://cloud.google.com/run/docs/deploying-source-code) 옵션을 사용하여 컨테이너를 **빌드**할 수 있습니다.

Google은 Cloud Run을 다른 Google Cloud 서비스와 **원활하게 연동**할 수 있도록 구축했으므로 완전한 기능을 갖춘 애플리케이션을 구축할 수 있습니다.

### 서비스 및 작업 <a href="#services-and-jobs" id="services-and-jobs"></a>

Cloud Run에서 코드는 _**서비스**_ 또는 _**작업**_으로 계속 실행되거나 종료될 수 있습니다. 서비스와 작업은 동일한 환경에서 실행되며 Google Cloud의 다른 서비스와 동일한 통합을 사용할 수 있습니다.

* **Cloud Run 서비스.** 웹 요청 또는 이벤트에 응답하는 코드를 실행하는 데 사용됩니다.
* **Cloud Run 작업.** 작업을 수행하고 작업이 완료되면 종료되는 코드를 실행하는 데 사용됩니다.

## Cloud Run 서비스

Google [Cloud Run](https://cloud.google.com/run)은 환경 변수를 검색할 수 있는 또 다른 서버리스 제공입니다. Cloud Run은 기본적으로 컨테이너 내에서 기본적으로 포트 8080에서 실행되는 작은 웹 서버를 생성하고 HTTP GET 요청을 기다립니다. 요청이 수신되면 작업이 실행되고 작업 로그가 HTTP 응답을 통해 출력됩니다.

### 관련 세부 정보

* 기본적으로 웹 서버에 대한 **액세스**는 **공개**되지만 **내부 트래픽에 제한**을 둘 수도 있습니다(VPC...).
또한, 웹 서버에 연락하기 위한 **인증**은 **모두 허용**하거나 **IAM을 통한 인증이 필요**할 수 있습니다.
* 기본적으로 **암호화**는 **Google 관리 키**를 사용하지만 **KMS**의 **CMEK**(고객 관리 암호화 키)를 선택할 수도 있습니다.
* 기본적으로 사용되는 **서비스 계정**은 프로젝트에 대한 **Editor** 액세스 권한을 갖는 **Compute Engine 기본 계정**입니다. 또한 **`cloud-platform`** 스코프를 갖습니다.
* 실행을 위해 **평문 환경 변수**를 정의하거나 **클라우드 비밀**을 **마운트**하거나 **환경 변수에 클라우드 비밀을 추가**할 수 있습니다.
* **Cloud SQL과의 연결을 추가**하거나 **파일 시스템을 마운트**할 수도 있습니다.
* 배포된 서비스의 **URL**은 **`https://<svc-name>-<random>.a.run.app`**과 유사합니다.
* Run 서비스는 **1개 이상의 버전 또는 리비전**을 가질 수 있으며 여러 리비전 사이에서 **트래픽을 분할**할 수 있습니다.

### 열거
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run 작업

Cloud Run 작업은 **완료되고 요청을 처리하지 않는 컨테이너에 더 적합**합니다. 작업은 요청을 처리하거나 포트에서 수신 대기하는 기능이 없습니다. 이는 Cloud Run 서비스와 달리 작업은 웹 서버를 번들로 포함해서는 안 된다는 것을 의미합니다. 대신, 작업 컨테이너는 완료되면 종료되어야 합니다.

### 열거
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## 권한 상승

다음 페이지에서는 **권한 상승을 위해 클라우드 런 권한을 남용하는 방법**을 확인할 수 있습니다:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## 인증되지 않은 액세스

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## 후반 작업

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## 지속성

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## 참고 자료

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 제로에서 영웅까지 AWS 해킹 배우기<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를** 팔로우하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 자신의 해킹 기법을 공유하세요.

</details>
