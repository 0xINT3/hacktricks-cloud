# GCP - Cloud Run Enum

<details>

<summary><strong>рдмрдврд╝рд┐рдпрд╛ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣ рдЕрдирдиреНрдп [**NFTs**](https://opensea.io/collection/the-peass-family)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ рдореБрдЭреЗ **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Google [Cloud Run](https://cloud.google.com/run) рдПрдХ рдФрд░ рд╕рд░реНрд╡рд░рд▓реЗрд╕ рдкреНрд░рд╕реНрддрд╛рд╡ рд╣реИ рдЬрд╣рд╛рдВ рдЖрдк env variables рднреА рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред Cloud Run рдПрдХ рдЫреЛрдЯрд╛ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдмрдирд╛рддрд╛ рд╣реИ, рдЬреЛ рдкреЛрд░реНрдЯ 8080 рдкрд░ рдЪрд▓рддрд╛ рд╣реИ, рдЬреЛ рдПрдХ HTTP GET рдЕрдиреБрд░реЛрдз рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИред рдЬрдм рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдПрдХ рдиреМрдХрд░реА рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдиреМрдХрд░реА рд▓реЙрдЧ HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдЙрдЯрдкреБрдЯ рд╣реЛрддреА рд╣реИред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд░реВрдк рд╕реЗ, рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХрд╛ **рдкрд╣реБрдБрдЪ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ** рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ **рдЖрдВрддрд░рд┐рдХ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЗ рд▓рд┐рдП рд╕реАрдорд┐рдд** рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (VPC...)\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╡реЗрдм рд╕рд░реНрд╡рд░ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХреЛ **рд╕рднреА рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ** рдпрд╛ **IAM рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛** рд╣реЛ рд╕рдХрддреА рд╣реИред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, **рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди** рдПрдХ **Google рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХреБрдВрдЬреА** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди **KMS** рд╕реЗ **CMEK** (рдЧреНрд░рд╛рд╣рдХ рдкреНрд░рдмрдВрдзрд┐рдд рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА) рднреА **рдЪреБрдиреА рдЬрд╛ рд╕рдХрддреА рд╣реИ**ред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА **рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛** рдХрдВрдкреНрдпреВрдЯ рдЗрдВрдЬрди рдХреА **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдПрдХ** рд╣реЛрддреА рд╣реИ рдФрд░ рдЗрд╕рдореЗрдВ **scope `cloud-platform`** рд╣реЛрддрд╛ рд╣реИред

рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП **рд╕реНрдкрд╖реНрдЯ-рдкрд╛рда рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░** рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдХреНрд▓рд╛рдЙрдб рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рдирд╛** рдпрд╛ **рдХреНрд▓рд╛рдЙрдб рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рд╡рд╛рддрд╛рд╡рд░рдг рдЪрд░ рдореЗрдВ рдЬреЛрдбрд╝рдирд╛** рднреА рд╕рдВрднрд╡ рд╣реИред

рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **Cloud SQL рдХреЗ рд╕рд╛рде рдХрдиреЗрдХреНрд╢рди рдЬреЛрдбрд╝рдирд╛** рднреА рд╕рдВрднрд╡ рд╣реИред

рдбрд┐рдкреНрд▓реЙрдп рдХреА рдЧрдИ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ **URL** `https://<svc-name>-<random>.a.run.app` рдХреЗ рд╕рдорд╛рди рд╣реЛрддреЗ рд╣реИрдВ

### рдЬрд╛рдБрдЪ
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдореЗрдВ, рдЖрдк рдХреИрд╕реЗ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЙрдб рд░рди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЗрд╕реЗ рдХреИрд╕реЗ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

### рдЦреБрд▓реЗ рдХреНрд▓рд╛рдЙрдб рд░рди рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб [рдпрд╣рд╛рдВ рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_misc/-/blob/master/find\_open\_cloudrun.sh) рдЖрдк рдРрд╕реЗ рдХреНрд▓рд╛рдЙрдб рд░рди рд╕реЗрд╡рд╛рдПрдВ рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдЖрд╣реНрд╡рд╛рдиреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВред
```bash
#!/bin/bash

############################
# Run this tool to find Cloud Run services that permit unauthenticated
# invocations anywhere in your GCP organization.
# Enjoy!
############################

for proj in $(gcloud projects list --format="get(projectId)"); do
echo "[*] scraping project $proj"

enabled=$(gcloud services list --project "$proj" | grep "Cloud Run API")

if [ -z "$enabled" ]; then
continue
fi


for run in $(gcloud run services list --platform managed --quiet --project $proj --format="get(name)"); do
ACL="$(gcloud run services get-iam-policy $run --platform managed --project $proj)"

all_users="$(echo $ACL | grep allUsers)"
all_auth="$(echo $ACL | grep allAuthenticatedUsers)"

if [ -z "$all_users" ]
then
:
else
echo "[!] Open to all users: $proj: $run"
fi

if [ -z "$all_auth" ]
then
:
else
echo "[!] Open to all authenticated users: $proj: $run"
fi
done
done
```
## Cloud Run рдиреМрдХрд░рд┐рдпрд╛рдВ

Cloud Run рдиреМрдХрд░рд┐рдпрд╛рдВ **рдРрд╕реЗ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЗ рд▓рд┐рдП рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддреА рд╣реИрдВ рдЬреЛ рдкреВрд░реНрдгрддрд╛ рддрдХ рдЪрд▓рддреЗ рд╣реИрдВ рдФрд░ рдЕрдиреБрд░реЛрдз рд╕реЗрд╡рд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ**ред рдиреМрдХрд░рд┐рдпреЛрдВ рдХреЗ рдкрд╛рд╕ рдЕрдиреБрд░реЛрдз рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдпрд╛ рдкреЛрд░реНрдЯ рдкрд░ рд╕реБрдирдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ Cloud Run рд╕реЗрд╡рд╛рдУрдВ рдХреА рддрд░рд╣, рдиреМрдХрд░рд┐рдпреЛрдВ рдХреЛ рдПрдХ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдирд╣реАрдВ рдмрдВрдбрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдмрдЬрд╛рдп рдЗрд╕рдХреЗ, рдиреМрдХрд░рд┐рдпреЛрдВ рдХреЗ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЛ рдЙрдирдХреЗ рдХрд╛рдо рдкреВрд░реЗ рд╣реЛрдиреЗ рдкрд░ рдмрдВрдж рдХрд░ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред

### рдЬрд╛рдБрдЪ
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
<details>

<summary><strong>рдмрдврд╝рд┐рдпрд╛ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣ рдЕрдирдиреНрдп [**NFTs**](https://opensea.io/collection/the-peass-family)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ рдореБрдЭреЗ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
