# GCP - Cloud Run Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahramana kadar AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonunu
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek paylaşın**.

</details>

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run, Google'ın ölçeklenebilir altyapısı üzerinde doğrudan **konteynerleri çalıştırmanıza** olanak tanıyan bir sunucusuz yönetilen hesaplama platformudur.

Konteynerinizi çalıştırabilir veya Go, Node.js, Python, Java, .NET Core veya Ruby kullanıyorsanız, **sizin için konteyneri oluşturan** [kaynak tabanlı dağıtım](https://cloud.google.com/run/docs/deploying-source-code) seçeneğini kullanabilirsiniz.

Google, Cloud Run'ı **Google Cloud'daki diğer hizmetlerle iyi çalışacak şekilde tasarlamıştır**, böylece tam özellikli uygulamalar oluşturabilirsiniz.

### Hizmetler ve işler <a href="#services-and-jobs" id="services-and-jobs"></a>

Cloud Run'da kodunuz ya bir _**hizmet**_ olarak sürekli çalışabilir ya da bir _**iş**_ olarak çalışabilir. Hem hizmetler hem de işler aynı ortamda çalışır ve Google Cloud'daki diğer hizmetlerle aynı entegrasyonları kullanabilir.

* **Cloud Run hizmetleri.** Web isteklerine veya olaylara yanıt veren kodu çalıştırmak için kullanılır.
* **Cloud Run işleri.** Bir işi gerçekleştiren (bir iş) ve iş tamamlandığında sona eren kodu çalıştırmak için kullanılır.

## Cloud Run Hizmeti

Google [Cloud Run](https://cloud.google.com/run), env değişkenlerini arayabileceğiniz başka bir sunucusuz tekliftir. Cloud Run, varsayılan olarak konteyner içinde 8080 numaralı bağlantı noktasında çalışan küçük bir web sunucusu oluşturur ve HTTP GET isteği bekler. İstek alındığında, bir iş yürütülür ve iş günlüğü bir HTTP yanıtı aracılığıyla çıktılanır.

### İlgili ayrıntılar

* Varsayılan olarak, web sunucusuna **erişim** **genel**dir, ancak **sınırlı iç trafiğe** (VPC...) de **sınırlanabilir**.\
Ayrıca, web sunucusuna ulaşmak için **kimlik doğrulaması**, **tümüne izin verme** veya **IAM aracılığıyla kimlik doğrulama gerektirme** şeklinde olabilir.
* Varsayılan olarak, **şifreleme** bir **Google tarafından yönetilen anahtar** kullanır, ancak **KMS** tarafından bir **CMEK** (Müşteri Yönetimli Şifreleme Anahtarı) de **seçilebilir**.
* Varsayılan olarak, kullanılan **hizmet hesabı** proje üzerinde **Editör** erişimine sahip olan **Compute Engine varsayılan hesabıdır** ve **`cloud-platform`** kapsamına sahiptir.
* Yürütme için **açık metin ortam değişkenleri** tanımlanabilir ve hatta **bulut sırlarını bağlamak** veya **bulut sırlarını ortam değişkenlerine eklemek** mümkündür.
* Ayrıca, **Cloud SQL ile bağlantılar eklemek** ve **bir dosya sistemi bağlamak** mümkündür.
* Dağıtılan hizmetlerin **URL'leri**, **`https://<svc-name>-<random>.a.run.app`** şeklinde benzerdir.
* Bir Run Hizmeti, **1'den fazla sürüm veya revizyon** içerebilir ve çeşitli revizyonlar arasında **trafiği bölebilir**.

### Enumerasyon
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run İşleri

Cloud Run işleri, **tamamlanma süresi olan ve istekleri karşılamayan konteynerler için daha uygun** olabilir. İşler, istekleri karşılamak veya bir bağlantı noktasında dinlemek gibi bir yeteneğe sahip değildir. Bu, Cloud Run hizmetlerinin aksine, işlerin bir web sunucusu içermemesi gerektiği anlamına gelir. Bunun yerine, iş konteynerleri tamamlandığında sonlanmalıdır.

### Sıralama
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Ayrıcalık Yükseltme

Aşağıdaki sayfada, **ayrıcalıkları yükseltmek için bulut çalıştırma izinlerinin nasıl kötüye kullanılabileceğini** kontrol edebilirsiniz:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Kimlik Doğrulamasız Erişim

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Saldırı Sonrası

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Kalıcılık

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da** takip edin.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek** paylaşın.

</details>
