# GCP - Cloud Run 枚举

<details>

<summary><strong>从零开始学习AWS黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**以PDF格式下载HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在**Twitter**上**关注**我 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run是一个无服务器托管计算平台，允许您直接在Google的可扩展基础设施上**运行容器**。

您可以运行您的容器，或者如果您使用Go、Node.js、Python、Java、.NET Core或Ruby，您可以使用[基于源代码的部署](https://cloud.google.com/run/docs/deploying-source-code)选项，它会为您**构建容器**。

Google构建了Cloud Run，以便与Google Cloud上的其他服务**良好协作**，因此您可以构建功能齐全的应用程序。

### 服务和作业 <a href="#services-and-jobs" id="services-and-jobs"></a>

在Cloud Run上，您的代码可以作为_**服务**_持续运行，也可以作为_**作业**_运行。服务和作业都在相同的环境中运行，并且可以使用与Google Cloud上的其他服务相同的集成。

* **Cloud Run服务。** 用于运行响应网络请求或事件的代码。
* **Cloud Run作业。** 用于运行执行工作（一个作业）并在工作完成时退出的代码。

## Cloud Run 服务

Google [Cloud Run](https://cloud.google.com/run) 是另一种无服务器服务，您也可以在其中搜索环境变量。Cloud Run默认在容器内部的8080端口上创建一个小型Web服务器，等待HTTP GET请求。收到请求后，执行作业，并通过HTTP响应输出作业日志。

### 相关细节

* **默认情况下**，对Web服务器的**访问**是**公开的**，但也可以**限制为内部流量**（VPC...）\
此外，与Web服务器联系的**认证**可以是**允许所有**，或**要求通过IAM进行认证**。
* 默认情况下，**加密**使用的是**Google管理的密钥**，但也可以**选择**使用**KMS**的**CMEK**（客户管理加密密钥）。
* **默认情况下**，使用的**服务账户**是具有项目**编辑器**访问权限的**Compute Engine默认账户**，其范围为`cloud-platform`。
* 可以为执行定义**明文环境变量**，甚至**挂载云秘密**或**将云秘密添加到环境变量**。
* 还可以**添加与Cloud SQL的连接**和**挂载文件系统**。
* 部署的服务的**URL**类似于**`https://<svc-name>-<random>.a.run.app`**
* Run服务可以有**多个版本或修订版**，并且可以在几个修订版之间**分流流量**。

### 枚举
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run 作业

Cloud Run 作业更适合**运行至完成且不处理请求的容器**。作业无法处理请求或监听端口。这意味着与 Cloud Run 服务不同，作业不应包含 Web 服务器。相反，作业容器在完成后应退出。

### 枚举
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## 权限提升

在以下页面中，您可以检查如何**滥用 Cloud Run 权限以提升权限**：

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## 未经认证的访问

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## 后期利用

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## 持久性

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## 参考资料

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>从零开始学习 AWS 黑客攻击！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 HackTricks 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享您的黑客技巧**。

</details>
