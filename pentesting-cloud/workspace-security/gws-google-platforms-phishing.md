# GWS - Phishing en Plataformas de Google

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Metodolog칤a Gen칠rica de Phishing

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Phishing en Google Groups

Al parecer, por defecto, en Workspace los miembros [**pueden crear grupos**](https://groups.google.com/all-groups) **e invitar a personas a ellos**. Luego puedes modificar el correo electr칩nico que se enviar치 al usuario **a침adiendo algunos enlaces**. El **correo electr칩nico vendr치 de una direcci칩n de Google**, por lo que parecer치 **leg칤timo** y la gente podr칤a hacer clic en el enlace.

Tambi칠n es posible configurar la direcci칩n **FROM** como el **correo electr칩nico del grupo de Google** para enviar **m치s correos electr칩nicos a los usuarios dentro del grupo**, como en la siguiente imagen donde se cre칩 el grupo **`google--support@googlegroups.com`** y se **envi칩 un correo electr칩nico a todos los miembros** del grupo (que fueron a침adidos sin ning칰n consentimiento)

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

## Phishing en Google Chat

Podr칤as ser capaz de **iniciar un chat** con una persona solo teniendo su direcci칩n de correo electr칩nico o enviar una **invitaci칩n para hablar**. Adem치s, es posible **crear un Espacio** que puede tener cualquier nombre (por ejemplo, "Soporte de Google") e **invitar** a miembros a 칠l. Si aceptan, podr칤an pensar que est치n hablando con el Soporte de Google:

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**Sin embargo, en mis pruebas, los miembros invitados ni siquiera recibieron una invitaci칩n.**
{% endhint %}

Puedes comprobar c칩mo funcion칩 esto en el pasado en: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Phishing en Google Docs

En el pasado era posible crear un **documento aparentemente leg칤timo** y luego en un comentario **mencionar alg칰n correo electr칩nico (como @user@gmail.com)**. Google **enviaba un correo electr칩nico a esa direcci칩n** notificando que fueron mencionados en el documento.\
Hoy en d칤a, esto no funciona pero si **das acceso al documento al correo electr칩nico de la v칤ctima** Google enviar치 un correo electr칩nico indic치ndolo. Este es el mensaje que aparece cuando mencionas a alguien:

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Las v칤ctimas podr칤an tener mecanismos de protecci칩n que impidan que los correos electr칩nicos que indican que un documento externo fue compartido con ellos lleguen a su correo.
{% endhint %}

## Phishing en Google Calendar

Puedes **crear un evento en el calendario** y a침adir tantas direcciones de correo electr칩nico de la empresa que est치s atacando como tengas. Programa este evento en el calendario en **5 o 15 minutos** a partir del momento actual. Haz que el evento parezca leg칤timo y **pon un comentario y un t칤tulo indicando que necesitan leer algo** (con el **enlace de phishing**).

Esta es la alerta que aparecer치 en el navegador con un t칤tulo de reuni칩n "Despidiendo a la Gente", por lo que podr칤as establecer un t칤tulo m치s parecido al phishing (e incluso cambiar el nombre asociado con tu correo electr칩nico).

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Para que parezca menos sospechoso:

* Config칰ralo para que los **receptores no puedan ver a las otras personas invitadas**
* **NO env칤es correos electr칩nicos notificando sobre el evento**. Entonces, la gente solo ver치 su advertencia sobre una reuni칩n en 5 minutos y que necesitan leer ese enlace.
* Al parecer, usando la API puedes configurar en **Verdadero** que las **personas** han **aceptado** el evento e incluso crear **comentarios en su nombre**.

## Phishing con Aplicaciones OAuth

Cualquiera de las t칠cnicas anteriores podr칤a usarse para hacer que el usuario acceda a una **aplicaci칩n Google OAuth** que **solicitar치** al usuario alg칰n **acceso**. Si el usuario **conf칤a** en la **fuente**, podr칤a **confiar** en la **aplicaci칩n** (incluso si est치 pidiendo permisos de alto privilegio).

{% hint style="info" %}
Ten en cuenta que Google presenta un aviso feo advirtiendo que la aplicaci칩n no es de confianza en varios casos y los administradores de Workspace incluso pueden evitar que las personas acepten aplicaciones OAuth.
{% endhint %}

**Google** permite crear aplicaciones que pueden **interactuar en nombre de los usuarios** con varios **servicios de Google**: Gmail, Drive, GCP...

Al crear una aplicaci칩n para **actuar en nombre de otros usuarios**, el desarrollador necesita crear una **aplicaci칩n OAuth dentro de GCP** e indicar los 치mbitos (permisos) a los que la aplicaci칩n necesita acceder a los datos de los usuarios.\
Cuando un **usuario** quiere **usar** esa **aplicaci칩n**, se le **pedir치** que **acepte** que la aplicaci칩n tendr치 acceso a sus datos especificados en los 치mbitos.

Esta es una forma muy jugosa de **phishing** para usuarios no t칠cnicos para usar **aplicaciones que acceden a informaci칩n sensible** porque podr칤an no entender las consecuencias. Sin embargo, en cuentas de organizaciones, hay formas de prevenir que esto suceda.

### Aviso de Aplicaci칩n No Verificada

Como se mencion칩, Google siempre presentar치 un **aviso al usuario para aceptar** los permisos que est치n otorgando a la aplicaci칩n en su nombre. Sin embargo, si la aplicaci칩n se considera **peligrosa**, Google mostrar치 **primero** un **aviso** indicando que es **peligrosa** y **haciendo m치s dif칤cil** para el usuario otorgar los permisos a la app.

Este aviso aparece en aplicaciones que:

* Usan cualquier 치mbito que pueda acceder a datos privados (Gmail, Drive, GCP, BigQuery...)
* Aplicaciones con menos de 100 usuarios (las apps > 100 tambi칠n necesitan un proceso de revisi칩n para dejar de mostrar el aviso de no verificada)

### 츼mbitos Interesantes

[**Aqu칤**](https://developers.google.com/identity/protocols/oauth2/scopes) puedes encontrar una lista de todos los 치mbitos de OAuth de Google.

* **cloud-platform**: Ver y gestionar tus datos a trav칠s de los servicios de **Google Cloud Platform**. Puedes suplantar al usuario en GCP.
* **directory.readonly**: Ver y descargar el directorio de GSuite de tu organizaci칩n. Obtener nombres, tel칠fonos, URLs de calendario de todos los usuarios.

## Referencias

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch and Beau Bullock - OK Google, How do I Red Team GSuite?

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
