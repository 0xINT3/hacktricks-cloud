# GWS - Googleプラットフォームのフィッシング

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>

## 一般的なフィッシング手法

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Googleグループのフィッシング

デフォルトでは、Workspaceのメンバーは[**グループを作成**](https://groups.google.com/all-groups)し、**人々を招待することができます**。その後、ユーザーに送信されるメールを変更し、**リンクを追加することができます**。**メールはGoogleのアドレスから送信される**ので、正当に見え、人々はリンクをクリックするかもしれません。

また、**FROM**アドレスを**Googleグループのメール**として設定し、グループ内のユーザーに**さらにメールを送信する**ことも可能です。以下の画像のように、**`google--support@googlegroups.com`**というグループが作成され、グループのメンバー全員（同意なしに追加された）に**メールが送信されました**。

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

## Googleチャットのフィッシング

メールアドレスを知っているだけで**チャットを開始**するか、**トークへの招待**を送ることができるかもしれません。さらに、任意の名前（例えば「Googleサポート」）を持つ**スペースを作成**し、メンバーを招待することができます。彼らが受け入れた場合、Googleサポートと話していると思うかもしれません：

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**ただし、私のテストでは招待されたメンバーは招待を受け取っていませんでした。**
{% endhint %}

過去にこれがどのように機能していたかは、以下をチェックしてください：[https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Googleドキュメントのフィッシング

過去には、**一見正当なドキュメント**を作成し、コメントで**メールアドレス（例：@user@gmail.com）**を**言及する**ことが可能でした。Googleはそのメールアドレスにメールを送信し、ドキュメントで言及されたことを通知しました。\
現在では、これは機能しませんが、**被害者のメールにドキュメントへのアクセスを与える**と、Googleはそのようなメールを送信します。これは、誰かを言及したときに表示されるメッセージです：

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
被害者には、外部ドキュメントが共有されたことを示すメールがメールに届かないようにする保護メカニズムがあるかもしれません。
{% endhint %}

## Googleカレンダーのフィッシング

**カレンダーイベントを作成**し、攻撃している会社のできるだけ多くのメールアドレスを追加します。このカレンダーイベントを現在時刻から**5分または15分後**にスケジュールします。イベントを正当に見せ、**何かを読む必要があることを示すコメントとタイトルを入れます**（**フィッシングリンク**付き）。

これは、「Firing People」という会議タイトルのブラウザに表示されるアラートです。したがって、よりフィッシングのようなタイトルを設定し、メールに関連付けられた名前を変更することもできます。

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

それを怪しまれないようにするために：

* 受信者が他の招待された人々を見ることができないように設定します
* イベントについてのメール通知を**送らない**。その後、人々は5分後の会議についての警告と、そのリンクを読む必要があることだけを見るでしょう。
* APIを使用すると、人々がイベントを**受け入れた**と**True**に設定し、さらに彼らに代わって**コメントを作成する**ことができるようです。

## OAuthアプリのフィッシング

前述の技術のいずれかを使用して、ユーザーが**Google OAuthアプリケーション**にアクセスし、ユーザーにいくつかの**アクセスを要求する**ことができます。ユーザーが**ソースを信頼している**場合、彼は**アプリケーションを信頼する**かもしれません（たとえそれが高い権限の許可を求めていても）。

{% hint style="info" %}
Googleは、アプリケーションが信頼されていないと警告する醜いプロンプトをいくつかのケースで提示し、Workspaceの管理者はOAuthアプリケーションを受け入れることを人々が防ぐことさえできることに注意してください。
{% endhint %}

**Google**は、開発者が**GCP内でOAuthアプリを作成**し、アプリがユーザーデータにアクセスするために必要なスコープ（権限）を指定する必要がある、ユーザーに代わっていくつかの**Googleサービス**と**対話する**アプリケーションを作成することを許可しています。\
**ユーザー**がその**アプリケーションを使用**したい場合、彼らはスコープで指定されたデータへのアクセスをアプリケーションに許可するよう**促されます**。

これは、**機密情報にアクセスするアプリケーション**を使用するように非技術的なユーザーを**フィッシング**する非常に魅力的な方法です。なぜなら、彼らは結果を理解していないかもしれないからです。ただし、組織アカウントでは、これが起こらないようにする方法があります。

### 未検証アプリのプロンプト

前述のように、googleは常にユーザーにアプリケーションに彼らの代わりに与える権限を受け入れるよう**プロンプトを表示します**。ただし、アプリケーションが**危険と見なされる**場合、googleは**最初に**、それが**危険である**ことを示す**プロンプト**を表示し、ユーザーがアプリに権限を付与することをより困難にします。

このプロンプトは、以下のアプリで表示されます：

* プライベートデータにアクセスできるスコープを使用するアプリ（Gmail、Drive、GCP、BigQuery...）
* 100ユーザー未満のアプリ（100ユーザーを超えるアプリには、未検証プロンプトを表示しないようにするためのレビュープロセスも必要です）

### 興味深いスコープ

[**ここ**](https://developers.google.com/identity/protocols/oauth2/scopes)で、すべてのGoogle OAuthスコープのリストを見つけることができます。

* **cloud-platform**: **Google Cloud Platform**サービス全体でデータを表示および管理します。GCPでユーザーになりすますことができます。
* **directory.readonly**: 組織のGSuiteディレクトリを表示およびダウンロードします。すべてのユーザーの名前、電話、カレンダーURLを取得します。

## 参考文献

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - G Suiteのハッキング：ダークApps Script Magicの力
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch and Beau Bullock - OK Google, GSuiteのレッドチームはどうやって？

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>
