# GWS - Persistenza

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>

{% hint style="danger" %}
Tutte le azioni menzionate in questa sezione che modificano le impostazioni genereranno un **allarme di sicurezza via email e persino una notifica push a qualsiasi dispositivo mobile sincronizzato** con l'account.
{% endhint %}

## **Persistenza in Gmail**

* Puoi creare **filtri per nascondere** le notifiche di sicurezza da Google
* `from: (no-reply@accounts.google.com) "Security Alert"`
* Questo impedir√† alle email di sicurezza di raggiungere la casella di posta (ma non impedir√† le notifiche push al dispositivo mobile)

<details>

<summary>Passaggi per creare un filtro Gmail</summary>

(Istruzioni da [**qui**](https://support.google.com/mail/answer/6579))

1. Apri [Gmail](https://mail.google.com/).
2. Nella casella di ricerca in alto, fai clic su Mostra opzioni di ricerca ![photos tune](https://lh3.googleusercontent.com/cD6YR_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36) .
3. Inserisci i tuoi criteri di ricerca. Se vuoi verificare che la tua ricerca abbia funzionato correttamente, guarda quali email compaiono facendo clic su **Cerca**.&#x20;
4. In fondo alla finestra di ricerca, fai clic su **Crea filtro**.
5. Scegli cosa vuoi che faccia il filtro.
6. Fai clic su **Crea filtro**.

Controlla i tuoi filtri attuali (per eliminarli) su [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (331).png" alt=""><figcaption></figcaption></figure>

* Crea un **indirizzo di inoltro per inoltrare informazioni sensibili** (o tutto) - Hai bisogno di accesso manuale.
* Crea un indirizzo di inoltro su [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* L'indirizzo di ricezione dovr√† confermare questo
* Quindi, impostalo per inoltrare tutte le email mantenendo una copia (ricorda di fare clic su salva modifiche):

<figure><img src="../../.gitbook/assets/image (332).png" alt=""><figcaption></figcaption></figure>

√à anche possibile creare filtri e inoltrare solo email specifiche all'altro indirizzo email.

## Password dell'applicazione

Se sei riuscito a **compromettere una sessione utente di Google** e l'utente aveva **2FA**, puoi **generare** una [**password dell'applicazione**](https://support.google.com/accounts/answer/185833?hl=it) (segui il link per vedere i passaggi). Nota che le **password dell'applicazione non sono pi√π raccomandate da Google e vengono revocate** quando l'utente **cambia la password del suo account Google.**

**Anche se hai una sessione aperta, dovrai conoscere la password dell'utente per creare una password dell'applicazione.**

{% hint style="info" %}
Le password dell'applicazione possono essere utilizzate **solo con account che hanno attivata la verifica in due passaggi**.
{% endhint %}

## Cambia 2-FA e simili

√à anche possibile **disattivare la 2-FA o iscrivere un nuovo dispositivo** (o numero di telefono) in questa pagina [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**.**\
**√à anche possibile generare passkey (aggiungere il proprio dispositivo), cambiare la password, aggiungere numeri di telefono per la verifica dei telefoni e il recupero, cambiare l'email di recupero e cambiare le domande di sicurezza).**

{% hint style="danger" %}
Per **evitare che le notifiche push di sicurezza** raggiungano il telefono dell'utente, potresti **disconnettere il suo smartphone** (anche se sarebbe strano) perch√© non puoi riconnetterlo da qui.

√à anche possibile **individuare il dispositivo.**
{% endhint %}

**Anche se hai una sessione aperta, dovrai conoscere la password dell'utente per modificare queste impostazioni.**

## Persistenza tramite App OAuth

Se hai **compromesso l'account di un utente**, puoi semplicemente **accettare** di concedere tutte le possibili autorizzazioni a un **App OAuth**. L'unico problema √® che Workspace pu√≤ essere configurato per **non consentire app OAuth esterne e/o interne non verificate.**\
√à abbastanza comune per le Organizzazioni di Workspace di non fidarsi per impostazione predefinita delle app OAuth esterne ma fidarsi di quelle interne, quindi se hai **abbastanza autorizzazioni per generare una nuova applicazione OAuth** all'interno dell'organizzazione e le app esterne sono disabilitate, generane una e **utilizza quella nuova app OAuth interna per mantenere la persistenza**.

Controlla la seguente pagina per ulteriori informazioni sulle App OAuth:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Persistenza tramite delega

Puoi semplicemente **delegare l'account** a un account diverso controllato dall'attaccante (se ti √® consentito farlo). Nelle **Organizzazioni** di Workspace questa opzione deve essere **abilitata**. Pu√≤ essere disabilitata per tutti, abilitata per alcuni utenti/gruppi o per tutti (di solito √® abilitata solo per alcuni utenti/gruppi o completamente disabilitata).

<details>

<summary>Se sei un amministratore di Workspace controlla questo per abilitare la funzionalit√†</summary>

(Informazioni [copiate dalla documentazione](https://support.google.com/a/answer/7223765))

Come amministratore della tua organizzazione (ad esempio, il tuo lavoro o la tua scuola), controlli se gli utenti possono delegare l'accesso al proprio account Gmail. Puoi permettere a tutti di avere l'opzione di delegare il proprio account. Oppure, permettere solo alle persone in determinati dipartimenti di configurare la delega. Ad esempio, puoi:

* Aggiungere un assistente amministrativo come delegato sul tuo account Gmail in modo che possa leggere e inviare email per tuo conto.&#x20;
* Aggiungere un gruppo, come il tuo reparto vendite, in Gruppi come delegato per dare a tutti accesso a un account Gmail.

Gli utenti possono delegare l'accesso solo a un altro utente nella stessa organizzazione, indipendentemente dal loro dominio o dall'unit√† organizzativa.

### Limiti e restrizioni della delega&#x20;

* Opzione **Consenti agli utenti di concedere l'accesso alla propria casella di posta a un gruppo Google**: Per utilizzare questa opzione, deve essere abilitata per l'OU dell'account delegato e per ciascun OU dei membri del gruppo. I membri del gruppo che appartengono a un'OU senza questa opzione abilitata non possono accedere all'account delegato.
* Con un uso tipico, 40 utenti delegati possono accedere contemporaneamente a un account Gmail. Un uso sopra la media da parte di uno o pi√π delegati potrebbe ridurre questo numero.&#x20;
* I processi automatizzati che accedono frequentemente a Gmail potrebbero ridurre anche il numero di delegati che possono accedere a un account contemporaneamente. Questi processi includono API o estensioni del browser che accedono frequentemente a Gmail.
* Un singolo account Gmail supporta fino a 1.000 delegati unici. Un gruppo in Gruppi conta come un delegato verso il limite.
* La delega non aumenta i limiti per un account Gmail. Gli account Gmail con utenti delegati hanno i limiti e le politiche standard degli account Gmail. Per ulteriori dettagli, visita [Limiti e politiche di Gmail](https://support.google.com/a/topic/28609).
### Passo 1: Attiva la delega Gmail per i tuoi utenti&#x20;

**Prima di iniziare:** Per applicare l'impostazione per determinati utenti, metti i loro account in un'[unit√† organizzativa](https://support.google.com/a/topic/1227584).

1. [Accedi](https://admin.google.com/) alla tua [Console di amministrazione Google](https://support.google.com/a/answer/182076).

Accedi utilizzando un _account amministratore_, non il tuo account attuale CarlosPolop@gmail.com
2. Nella Console di amministrazione, vai al Menu ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![e poi](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **App**![e poi](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![e poi](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![e poi](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Impostazioni utente**.
3. Per applicare l'impostazione a tutti, lascia selezionata l'unit√† organizzativa principale. Altrimenti, seleziona un'[unit√† organizzativa figlia](https://support.google.com/a/topic/1227584).
4. Clicca su **Delega posta**.
5. Seleziona la casella **Consenti agli utenti di delegare l'accesso alla propria casella di posta ad altri utenti del dominio**.
6. (Opzionale) Per consentire agli utenti di specificare quali informazioni sul mittente sono incluse nei messaggi delegati inviati dal loro account, seleziona la casella **Consenti agli utenti di personalizzare questa impostazione**.
7. Seleziona un'opzione per le informazioni predefinite sul mittente incluse nei messaggi inviati dai delegati:&#x20;
* **Mostra il proprietario dell'account e il delegato che ha inviato l'email**‚ÄîI messaggi includono gli indirizzi email del proprietario dell'account Gmail e del delegato.
* **Mostra solo il proprietario dell'account**‚ÄîI messaggi includono solo l'indirizzo email del proprietario dell'account Gmail. L'indirizzo email del delegato non √® incluso.
8. (Opzionale) Per consentire agli utenti di aggiungere un gruppo in Gruppi come delegato, seleziona la casella **Consenti agli utenti di concedere l'accesso alla propria casella di posta a un gruppo Google**.
9. Clicca su **Salva**. Se hai configurato un'unit√† organizzativa figlia, potresti poter **Ereditare** o **Sovrascrivere** le impostazioni di un'unit√† organizzativa principale.
10. (Opzionale) Per attivare la delega Gmail per altre unit√† organizzative, ripeti i passaggi da 3 a 9.

Le modifiche possono richiedere fino a 24 ore ma di solito avvengono pi√π rapidamente. [Ulteriori informazioni](https://support.google.com/a/answer/7514107)

### Passo 2: Fai in modo che gli utenti configurino i delegati per i loro account

Dopo aver attivato la delega, i tuoi utenti vanno nelle impostazioni di Gmail per assegnare i delegati. I delegati possono quindi leggere, inviare e ricevere messaggi per conto dell'utente. &#x20;

Per ulteriori dettagli, indirizza gli utenti a [Delegare e collaborare via email](https://support.google.com/a/users/answer/138350).

</details>

<details>

<summary>Da un utente regolare, controlla qui le istruzioni per provare a delegare il tuo accesso</summary>

(Informazioni copiate [**dalla documentazione**](https://support.google.com/mail/answer/138350))

Puoi aggiungere fino a 10 delegati.

Se stai utilizzando Gmail tramite il lavoro, la scuola o un'altra organizzazione:

* Puoi aggiungere fino a 1000 delegati all'interno della tua organizzazione.
* Con un uso tipico, 40 delegati possono accedere contemporaneamente a un account Gmail.&#x20;
* Se utilizzi processi automatizzati, come API o estensioni del browser, alcuni delegati possono accedere contemporaneamente a un account Gmail.

1. Sul tuo computer, apri [Gmail](https://mail.google.com/). Non puoi aggiungere delegati dall'app Gmail.
2. In alto a destra, clicca su Impostazioni ![Impostazioni](https://lh3.googleusercontent.com/p3J-ZSPOLtuBBR\_ofWTFDfdgAYQgi8mR5c76ie8XQ2wjegk7-yyU5zdRVHKybQgUlQ=w36-h36) ![e poi](https://lh3.googleusercontent.com/3\_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36) **Visualizza tutte le impostazioni**.
3. Clicca sulla scheda **Account e importazione** o **Account**.
4. Nella sezione "Concedi accesso al tuo account", clicca su **Aggiungi un altro account**. Se stai utilizzando Gmail tramite il lavoro o la scuola, la tua organizzazione potrebbe limitare la delega dell'email. Se non vedi questa impostazione, contatta il tuo amministratore.
* Se non vedi Concedi accesso al tuo account, allora √® limitato.
5. Inserisci l'indirizzo email della persona che desideri aggiungere. Se stai utilizzando Gmail tramite il lavoro, la scuola o un'altra organizzazione, e il tuo amministratore lo consente, puoi inserire l'indirizzo email di un gruppo. Questo gruppo deve avere lo stesso dominio della tua organizzazione. Ai membri esterni del gruppo viene negato l'accesso alla delega. \
\
**Importante:** Se l'account che delega √® un nuovo account o la password √® stata reimpostata, l'amministratore deve disattivare l'obbligo di cambiare la password quando accedi per la prima volta.

* [Scopri come un amministratore pu√≤ creare un utente](https://support.google.com/a/answer/33310).
* [Scopri come un amministratore pu√≤ reimpostare le password](https://support.google.com/a/answer/33319).

6\. Clicca su **Passaggio successivo** ![e poi](https://lh3.googleusercontent.com/QbWcYKta5vh\_4-OgUeFmK-JOB0YgLLoGh69P478nE6mKdfpWQniiBabjF7FVoCVXI0g=h36) **Invia email per concedere l'accesso**.

La persona che hai aggiunto ricever√† un'email che chiede di confermare. L'invito scade dopo una settimana.

Se hai aggiunto un gruppo, tutti i membri del gruppo diventeranno delegati senza dover confermare.&#x20;

Nota: Potrebbero essere necessarie fino a 24 ore affinch√© la delega inizi ad avere effetto.

</details>

## Persistenza tramite App Android

Se hai una **sessione all'interno dell'account Google delle vittime** puoi navigare nel **Play Store** e potresti essere in grado di **installare malware** che hai gi√† caricato direttamente nello store **sul telefono** per mantenere la persistenza e accedere al telefono delle vittime.

## **Persistenza tramite** App Scripts

Puoi creare **trigger basati sul tempo** in App Scripts, quindi se lo script dell'app √® accettato dall'utente, verr√† **attivato** anche **senza che l'utente vi acceda**. Per ulteriori informazioni su come fare ci√≤, controlla:

{% content-ref url="gws-google-platforms-phishing/gws-app-scripts.md" %}
[gws-app-scripts.md](gws-google-platforms-phishing/gws-app-scripts.md)
{% endcontent-ref %}

## Riferimenti

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch e Beau Bullock - OK Google, How do I Red Team GSuite?

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se desideri vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository di** [**HackTricks**](https://github.com/carlospolop/hacktricks) **e** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **su GitHub.**

</details>
