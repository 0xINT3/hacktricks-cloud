# GWS - Persistence

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

{% hint style="danger" %}
Tutte le azioni menzionate in questa sezione che modificano le impostazioni genereranno un **avviso di sicurezza via email e persino una notifica push su qualsiasi dispositivo mobile sincronizzato** con l'account.
{% endhint %}

## **Persistenza in Gmail**

* Puoi creare **filtri per nascondere** le notifiche di sicurezza da Google
* `from: (no-reply@accounts.google.com) "Security Alert"`
* Questo impedir√† che le email di sicurezza raggiungano la casella di posta (ma non impedir√† le notifiche push sul dispositivo mobile)

<details>

<summary>Passaggi per creare un filtro Gmail</summary>

(Istruzioni da [**qui**](https://support.google.com/mail/answer/6579))

1. Apri [Gmail](https://mail.google.com/).
2. Nella casella di ricerca in alto, fai clic su Mostra opzioni di ricerca ![photos tune](https://lh3.googleusercontent.com/cD6YR\_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1\_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36) .
3. Inserisci i tuoi criteri di ricerca. Se vuoi verificare che la ricerca abbia funzionato correttamente, verifica quali email vengono visualizzate facendo clic su **Cerca**.
4. In fondo alla finestra di ricerca, fai clic su **Crea filtro**.
5. Scegli cosa vuoi che il filtro faccia.
6. Fai clic su **Crea filtro**.

Verifica i tuoi filtri attuali (per eliminarli) su [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (142).png" alt=""><figcaption></figcaption></figure>

* Crea un **indirizzo di inoltro per inoltrare informazioni sensibili** (o tutto) - Hai bisogno di accesso manuale.
* Crea un indirizzo di inoltro su [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* L'indirizzo di ricezione dovr√† confermare questo
* Quindi, impostalo per inoltrare tutte le email mantenendo una copia (ricorda di fare clic su salva modifiche):

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

√à anche possibile creare filtri e inoltrare solo email specifiche all'altro indirizzo email.

## Password dell'app

Se sei riuscito a **compromettere una sessione utente di Google** e l'utente aveva **2FA**, puoi **generare** una [**password dell'app**](https://support.google.com/accounts/answer/185833?hl=en) (segui il link per vedere i passaggi). Nota che **le password dell'app non sono pi√π consigliate da Google e vengono revocate** quando l'utente **cambia la password del suo account Google.**

**Anche se hai una sessione aperta, dovrai conoscere la password dell'utente per creare una password dell'app.**

{% hint style="info" %}
Le password dell'app possono essere utilizzate **solo con account che hanno attivata la verifica in due passaggi**.
{% endhint %}

## Cambia 2-FA e simili

√à anche possibile **disattivare la 2-FA o iscrivere un nuovo dispositivo** (o numero di telefono) in questa pagina [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**.**\
**√à anche possibile generare passkey (aggiungere il proprio dispositivo), cambiare la password, aggiungere numeri di telefono per la verifica dei telefoni e il recupero, cambiare l'email di recupero e cambiare le domande di sicurezza).**

{% hint style="danger" %}
Per **evitare che le notifiche push di sicurezza** raggiungano il telefono dell'utente, potresti **disconnettere il suo smartphone** (anche se sarebbe strano) perch√© non puoi accedere di nuovo da qui.

√à anche possibile **individuare il dispositivo.**
{% endhint %}

**Anche se hai una sessione aperta, dovrai conoscere la password dell'utente per modificare queste impostazioni.**

## Persistenza tramite applicazioni OAuth

Se hai **compromesso l'account di un utente**, puoi semplicemente **accettare** di concedere tutte le possibili autorizzazioni a un'**app OAuth**. L'unico problema √® che Workspace pu√≤ essere configurato per **non consentire app OAuth esterne e/o interne non verificate.**\
√à abbastanza comune che le organizzazioni di Workspace non si fidino di default delle app OAuth esterne ma si fidino di quelle interne, quindi se hai **abbastanza autorizzazioni per generare una nuova applicazione OAuth** all'interno dell'organizzazione e le app esterne sono disabilitate, generane una e **usa quella nuova app OAuth interna per mantenere la persistenza**.

Controlla la seguente pagina per ulteriori informazioni sulle app OAuth:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Persistenza tramite delega

Puoi semplicemente **delegare l'account** a un account diverso controllato dall'attaccante (se ti √® consentito farlo). Nelle **organizzazioni** di Workspace questa opzione deve essere **abilitata**. Pu√≤ essere disabilitata per tutti, abilitata per alcuni utenti/gruppi o per tutti (di solito √® abilitata solo per alcuni utenti/gruppi o completamente disabilitata).

<details>

<summary>Se sei un amministratore di Workspace, controlla questo per abilitare la funzione</summary>

(Informazioni [copiate dalla documentazione](https://support.google.com/a/answer/7223765))

Come amministratore per la tua organizzazione (ad esempio, il tuo lavoro o la tua scuola), controlli se gli utenti possono delegare l'accesso al proprio account Gmail. Puoi consentire a tutti di avere l'opzione di delegare il proprio account. Oppure, consentire solo alle persone in determinati dipartimenti di configurare la delega. Ad esempio, puoi:

* Aggiungi un assistente amministrativo come delegato al tuo account Gmail in modo che possano leggere e inviare email per tuo conto.
* Aggiungi un gruppo, come il tuo dipartimento vendite, in Gruppi come delegato per dare a tutti accesso a un account Gmail.

Gli utenti possono delegare l'accesso solo a un altro utente nella stessa organizzazione, indipendentemente dal dominio o dall'unit√† organizzativa.

#### Limiti e restrizioni della delega

* Opzione **Consenti agli utenti di concedere l'accesso alla propria casella di posta a un gruppo Google**: Per utilizzare questa opzione, deve essere abilitata per l'OU dell'account delegato e per l'OU di ciascun membro del gruppo. I membri del gruppo che appartengono a un'OU senza questa opzione abilitata non possono accedere all'account delegato.
* Con un

#### Passaggio 1: Attiva la delega di Gmail per i tuoi utenti

**Prima di iniziare:** Per applicare l'impostazione per determinati utenti, inserisci i loro account in un [unit√† organizzativa](https://support.google.com/a/topic/1227584).

1. [Accedi](https://admin.google.com/) alla tua [console di amministrazione di Google](https://support.google.com/a/answer/182076).

Accedi utilizzando un _account amministratore_, non il tuo account attuale CarlosPolop@gmail.com 2. Nella console di amministrazione, vai al Menu ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![e poi](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **App**![e poi](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![e poi](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![e poi](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Impostazioni utente**. 3. Per applicare l'impostazione a tutti, lascia selezionata l'unit√† organizzativa principale. Altrimenti, seleziona un'unit√† organizzativa figlia [organizational unit](https://support.google.com/a/topic/1227584). 4. Fai clic su **Delega posta**. 5. Seleziona la casella **Consenti agli utenti di delegare l'accesso alla propria casella di posta ad altri utenti del dominio**. 6. (Opzionale) Per consentire agli utenti di specificare quali informazioni del mittente sono incluse nei messaggi delegati inviati dal loro account, seleziona la casella **Consenti agli utenti di personalizzare questa impostazione**. 7. Seleziona un'opzione per le informazioni predefinite del mittente incluse nei messaggi inviati dai delegati:

* **Mostra il proprietario dell'account e il delegato che ha inviato l'email** - I messaggi includono gli indirizzi email del proprietario dell'account Gmail e del delegato.
* **Mostra solo il proprietario dell'account** - I messaggi includono solo l'indirizzo email del proprietario dell'account Gmail. L'indirizzo email del delegato non √® incluso.

8. (Opzionale) Per consentire agli utenti di aggiungere un gruppo in Gruppi come delegato, seleziona la casella **Consenti agli utenti di concedere l'accesso alla propria casella di posta a un gruppo Google**.
9. Fai clic su **Salva**. Se hai configurato un'unit√† organizzativa figlia, potresti essere in grado di **Ereditare** o **Sovrascrivere** le impostazioni di un'unit√† organizzativa principale.
10. (Opzionale) Per attivare la delega di Gmail per altre unit√† organizzative, ripeti i passaggi da 3 a 9.

Le modifiche possono richiedere fino a 24 ore, ma di solito avvengono pi√π rapidamente. [Ulteriori informazioni](https://support.google.com/a/answer/7514107)

#### Passaggio 2: Fai in modo che gli utenti impostino i delegati per i loro account

Dopo aver attivato la delega, gli utenti devono andare alle impostazioni di Gmail per assegnare i delegati. I delegati possono quindi leggere, inviare e ricevere messaggi per conto dell'utente.

Per ulteriori dettagli, indirizza gli utenti a [Delega e collaborazione tramite email](https://support.google.com/a/users/answer/138350).

</details>

<details>

<summary>Da un utente normale, controlla qui le istruzioni per cercare di delegare l'accesso</summary>

(Informazioni copiate [**dalla documentazione**](https://support.google.com/mail/answer/138350))

√à possibile aggiungere fino a 10 delegati.

Se stai utilizzando Gmail tramite il tuo lavoro, scuola o un'altra organizzazione:

* Puoi aggiungere fino a 1000 delegati all'interno della tua organizzazione.
* Con un uso tipico, 40 delegati possono accedere contemporaneamente a un account Gmail.
* Se si utilizzano processi automatizzati, come API o estensioni del browser, alcuni delegati possono accedere contemporaneamente a un account Gmail.

1. Sul tuo computer, apri [Gmail](https://mail.google.com/). Non √® possibile aggiungere delegati dall'app Gmail.
2. In alto a destra, fai clic su Impostazioni ![Impostazioni](https://lh3.googleusercontent.com/p3J-ZSPOLtuBBR\_ofWTFDfdgAYQgi8mR5c76ie8XQ2wjegk7-yyU5zdRVHKybQgUlQ=w36-h36) ![e poi](https://lh3.googleusercontent.com/3\_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36) **Visualizza tutte le impostazioni**.
3. Fai clic sulla scheda **Account e importazione** o **Account**.
4. Nella sezione "Concedi accesso al tuo account", fai clic su **Aggiungi un altro account**. Se stai utilizzando Gmail tramite il tuo lavoro o la tua scuola, la tua organizzazione potrebbe limitare la delega delle email. Se non vedi questa impostazione, contatta l'amministratore.

* Se non vedi Concedi accesso al tuo account, allora √® limitato.

5. Inserisci l'indirizzo email della persona che desideri aggiungere. Se stai utilizzando Gmail tramite il tuo lavoro, la scuola o un'altra organizzazione e l'amministratore lo consente, puoi inserire l'indirizzo email di un gruppo. Questo gruppo deve avere lo stesso dominio della tua organizzazione. Ai membri esterni del gruppo viene negato l'accesso alla delega.\
   \
   **Importante:** Se l'account che delega √® un nuovo account o la password √® stata reimpostata, l'amministratore deve disattivare l'obbligo di cambiare la password quando si accede per la prima volta.

* [Scopri come un amministratore pu√≤ creare un utente](https://support.google.com/a/answer/33310).
* [Scopri come un amministratore pu√≤ reimpostare le password](https://support.google.com/a/answer/33319).

6. Fai clic su **Passaggio successivo** ![e poi](https://lh3.googleusercontent.com/QbWcYKta5vh\_4-OgUeFmK-JOB0YgLLoGh69P478nE6mKdfpWQniiBabjF7FVoCVXI0g=h36) **Invia email per concedere l'accesso**.

La persona che hai aggiunto ricever√† un'email che chiede di confermare. L'invito scade dopo una settimana.

Se hai aggiunto un gruppo, tutti i membri del gruppo diventeranno delegati senza dover confermare.

Nota: Potrebbe essere necessario fino a 24 ore affinch√© la delega abbia effetto.

</details>

## Persistenza tramite app Android

Se hai una **sessione all'interno dell'account Google delle vittime**, puoi navigare su **Play Store** e potresti essere in grado di **installare malware** che hai gi√† caricato sullo store direttamente **sul telefono** per mantenere la persistenza e accedere al telefono delle vittime.

## **Persistenza tramite** App Scripts

* **Condividi i tuoi trucchi di hacking inviando PR ai repository** [**HackTricks**](https://github.com/carlospolop/hacktricks) **e** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **su Github.**
