# GWS - Persistence

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter**에서 저를 **팔로우**하세요. 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

{% hint style="danger" %}
이 섹션에서 언급된 설정 변경 작업은 **보안 경고 이메일을 생성**하며, 계정과 동기화된 모바일에는 **푸시 알림**이 전송됩니다.
{% endhint %}

## **Gmail에서의 지속성**

* Google의 **보안 알림을 숨기기 위한 필터**를 생성할 수 있습니다.
* `from: (no-reply@accounts.google.com) "Security Alert"`
* 이렇게 하면 보안 이메일이 이메일에 도달하지 않지만 모바일로의 푸시 알림은 방지되지 않습니다.

<details>

<summary>Gmail 필터 생성 단계</summary>

([**여기**](https://support.google.com/mail/answer/6579)의 지침을 따랐습니다.)

1. [Gmail](https://mail.google.com/)을 엽니다.
2. 상단의 검색 상자에서 **검색 옵션 표시**를 클릭합니다. ![photos tune](https://lh3.googleusercontent.com/cD6YR\_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1\_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36) .
3. 검색 기준을 입력합니다. 검색이 올바르게 작동하는지 확인하려면 **검색**을 클릭하여 표시되는 이메일을 확인하세요.
4. 검색 창의 하단에서 **필터 생성**을 클릭합니다.
5. 필터가 수행할 작업을 선택합니다.
6. **필터 생성**을 클릭합니다.

현재 필터를 확인하려면 [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)에서 확인하세요.

</details>

<figure><img src="../../.gitbook/assets/image (142).png" alt=""><figcaption></figcaption></figure>

* 민감한 정보(또는 모든 정보)를 전달하기 위해 **전달 주소를 생성**할 수 있습니다. - 수동 액세스가 필요합니다.
* [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)에서 전달 주소를 생성하세요.
* 수신 주소는 이를 확인해야 합니다.
* 그런 다음, 모든 이메일을 전달하면서 사본을 유지하도록 설정하세요(변경 사항 저장을 클릭하는 것을 잊지 마세요):

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

특정 이메일만 다른 이메일 주소로 전달하기 위해 필터를 생성하고 전달할 수도 있습니다.

## 앱 비밀번호

Google 사용자 세션을 **침해**하고 사용자가 **2FA**를 사용하는 경우 [**앱 비밀번호**](https://support.google.com/accounts/answer/185833?hl=en)를 **생성**할 수 있습니다(단계를 보려면 링크를 따르세요). **Google에서는 더 이상 앱 비밀번호를 권장하지 않으며** 사용자가 **Google 계정 비밀번호를 변경**할 때 앱 비밀번호가 **취소**됩니다.

**열린 세션이 있더라도 사용자의 비밀번호를 알아야 앱 비밀번호를 생성할 수 있습니다.**

{% hint style="info" %}
앱 비밀번호는 **2단계 인증이 활성화된 계정에서만 사용**할 수 있습니다.
{% endhint %}

## 2-FA 및 유사한 설정 변경

이 페이지 [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**에서 2-FA를 해제하거나 새로운 장치**(또는 전화번호)를 등록할 수 있습니다.\
**장치를 찾을 수도 있습니다.**

{% hint style="danger" %}
사용자의 휴대폰으로 **보안 푸시 알림이 전송되는 것을 방지**하려면 사용자의 스마트폰에서 **로그아웃**할 수 있습니다(비록 이상할 수 있지만) 여기서 다시 로그인할 수는 없습니다.

또한 **장치의 위치를 확인**할 수도 있습니다.
{% endhint %}

**열린 세션이 있더라도 사용자의 비밀번호를 알아야 이러한 설정을 변경할 수 있습니다.**

## OAuth 앱을 통한 지속성

사용자의 계정을 **침해**한 경우 가능한 모든 권한을 **OAuth 앱**에 부여하기만 하면 됩니다. 유일한 문제는 Workspace가 **검토되지 않은 외부 및/또는 내부 OAuth 앱을 허용하지 않도록 구성**될 수 있다는 것입니다.\
일반적으로 Workspace 조직은 기본적으로 외부 OAuth 앱을 신뢰하지 않지만 내부 앱은 신뢰합니다. 따라서 조직 내에서 새로운 OAuth 애플리케이션을 생성할 수 있는 **충분한 권한**이 있다면 외부 앱이 허용되지 않는 경우에도 생성하고 **새로운 내부 OAuth 앱을 사용하여 지속성을 유지**할 수 있습니다.

OAuth 앱에 대한 자세한 내용은 다음 페이지를 참조하세요:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## 위임을 통한 지속성

공격자가 사용자의 계정을 **위임**할 수 있습니다(이를 허용하는 경우). Workspace **조직**에서는 이 옵션이 **활성화**되어야 합니다. 모든 사람에 대해 비활성화되거나 일부 사용자/그룹에 대해 활성화되거나 모든 사람에 대해 비활성화되는 경우가 일반적입니다.

<details>

<summary>작업 공간 관리자인 경우 이를 활성화하려면 이를 확인하세요</summary>

(문서에서 [복사한 정보](https://support.google.com/a/answer/7223765))

조직(예: 직장 또는 학교)의 관리자로서 Gmail 계정에 대한 액세스 위임을 사용자가 할 수 있는지 여부를 제어할 수 있습니다. 모든 사람이 계정을 위임할 수 있도록 할 수도 있고, 특정 부서의 사람들만 위임 설정을 할 수 있도록 할 수도 있습니다

#### 단계 1: 사용자의 Gmail 위임 활성화하기

**시작하기 전에:** 특정 사용자에게 설정을 적용하려면, 그들의 계정을 [조직 단위](https://support.google.com/a/topic/1227584)에 넣으세요.

1. [Google 관리 콘솔](https://support.google.com/a/answer/182076)에 [로그인](https://admin.google.com/)하세요.

현재 계정 CarlosPolop@gmail.com이 아닌 \_관리자 계정\_으로 로그인하세요. 2. 관리 콘솔에서, 메뉴로 이동하세요 ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![그리고](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **앱**![그리고](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![그리고](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![그리고](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**사용자 설정**. 3. 설정을 모든 사용자에게 적용하려면, 최상위 조직 단위를 선택한 채로 두세요. 그렇지 않으면, 하위 [조직 단위](https://support.google.com/a/topic/1227584)를 선택하세요. 4. **메일 위임**을 클릭하세요. 5. **도메인 내 다른 사용자에게 메일함 액세스 위임을 허용** 상자를 선택하세요. 6. (선택 사항) 사용자가 계정에서 전송된 위임 메시지에 포함되는 발신자 정보를 지정할 수 있도록 하려면, **사용자가 이 설정을 사용자 정의할 수 있도록 허용** 상자를 선택하세요. 7. 대리인이 전송한 이메일에 포함되는 기본 발신자 정보를 위해 옵션을 선택하세요:

* **계정 소유자와 대리인의 이메일 주소 표시** - 메시지에는 Gmail 계정 소유자와 대리인의 이메일 주소가 포함됩니다.
* **계정 소유자만 표시** - 메시지에는 Gmail 계정 소유자의 이메일 주소만 포함됩니다. 대리인의 이메일 주소는 포함되지 않습니다.

8. (선택 사항) 사용자가 그룹을 대리인으로 추가할 수 있도록 하려면, **사용자가 Google 그룹에 메일함 액세스를 부여할 수 있도록 허용** 상자를 선택하세요.
9. **저장**을 클릭하세요. 하위 조직 단위를 구성한 경우, 상위 조직 단위의 설정을 **상속**하거나 **재정의**할 수 있습니다.
10. (선택 사항) 다른 조직 단위에 대해 Gmail 위임을 활성화하려면, 단계 3-9를 반복하세요.

변경 사항은 최대 24시간이 소요될 수 있지만, 일반적으로 더 빨리 적용됩니다. [자세히 알아보기](https://support.google.com/a/answer/7514107)

#### 단계 2: 사용자가 계정에 대리인 설정하기

위임을 활성화한 후, 사용자는 Gmail 설정으로 이동하여 대리인을 지정할 수 있습니다. 대리인은 사용자를 대신하여 메시지를 읽고, 보내고, 받을 수 있습니다.

자세한 내용은 [이메일 위임 및 공동 작업](https://support.google.com/a/users/answer/138350)을 사용자에게 안내하세요.

</details>

<details>

<summary>일반 사용자로부터, 액세스 위임을 시도하기 위한 지침은 여기에서 확인하세요</summary>

(문서에서 [**복사한 정보**](https://support.google.com/mail/answer/138350))

최대 10명의 대리인을 추가할 수 있습니다.

귀하의 회사, 학교 또는 기타 조직을 통해 Gmail을 사용하는 경우:

* 조직 내에서 최대 1000명의 대리인을 추가할 수 있습니다.
* 일반적인 사용에서, 40명의 대리인이 동시에 Gmail 계정에 액세스할 수 있습니다.
* API 또는 브라우저 확장 프로그램과 같은 자동화된 프로세스를 사용하는 경우, 일부 대리인만 Gmail 계정에 동시에 액세스할 수 있습니다.

1. 컴퓨터에서 [Gmail](https://mail.google.com/)을 엽니다. Gmail 앱에서는 대리인을 추가할 수 없습니다.
2. 오른쪽 상단에서 설정을 클릭하세요 ![설정](https://lh3.googleusercontent.com/p3J-ZSPOLtuBBR\_ofWTFDfdgAYQgi8mR5c76ie8XQ2wjegk7-yyU5zdRVHKybQgUlQ=w36-h36) ![그리고](https://lh3.googleusercontent.com/3\_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36) **모든 설정 보기**를 클릭하세요.
3. **계정 및 가져오기** 또는 **계정** 탭을 클릭하세요.
4. "계정에 액세스 권한 부여" 섹션에서 **다른 계정 추가**를 클릭하세요. 귀하의 회사나 학교를 통해 Gmail을 사용하는 경우, 조직에서 이메일 위임을 제한할 수 있습니다. 이 설정이 표시되지 않는 경우, 관리자에게 문의하세요.

* 계정에 액세스 권한 부여가 표시되지 않으면, 제한되었습니다.

5. 추가할 사람의 이메일 주소를 입력하세요. 귀하의 회사, 학교 또는 기타 조직을 통해 Gmail을 사용하는 경우, 동일한 도메인을 가진 그룹의 이메일 주소를 입력할 수 있습니다. 이 그룹의 외부 구성원은 액세스 권한을 받지 못합니다.\
   \
   **중요:** 위임할 계정이 새 계정이거나 비밀번호가 재설정된 경우, 관리자는 처음 로그인할 때 비밀번호 변경 요구 사항을 해제해야 합니다.

* [관리자가 사용자를 생성하는 방법 알아보기](https://support.google.com/a/answer/33310).
* [관리자가 비밀번호를 재설정하는 방법 알아보기](https://support.google.com/a/answer/33319).

6\. **다음 단계**를 클릭하세요 !\[그리고]\(https://lh3.googleusercontent.com/QbWcYKta5vh\_4-Og

* **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 해킹 기법을 공유하세요.

</details>
