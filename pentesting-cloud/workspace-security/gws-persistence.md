# GWS - Persistence

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PRs aux** d√©p√¥ts github [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

{% hint style="danger" %}
Toutes les actions mentionn√©es dans cette section qui changent les param√®tres g√©n√©reront une **alerte de s√©curit√© √† l'email et m√™me une notification push sur tout mobile synchronis√©** avec le compte.
{% endhint %}

## **Persistance dans Gmail**

* Vous pouvez cr√©er **des filtres pour cacher** les notifications de s√©curit√© de Google
* `from: (no-reply@accounts.google.com) "Alerte de s√©curit√©"`
* Cela emp√™chera les emails de s√©curit√© d'atteindre l'email (mais n'emp√™chera pas les notifications push sur le mobile)

<details>

<summary>√âtapes pour cr√©er un filtre gmail</summary>

(Instructions de [**ici**](https://support.google.com/mail/answer/6579))

1. Ouvrez [Gmail](https://mail.google.com/).
2. Dans la bo√Æte de recherche en haut, cliquez sur Afficher les options de recherche ![photos tune](https://lh3.googleusercontent.com/cD6YR\_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1\_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36) .
3. Entrez vos crit√®res de recherche. Si vous voulez v√©rifier que votre recherche a fonctionn√© correctement, voyez quels emails apparaissent en cliquant sur **Rechercher**.
4. En bas de la fen√™tre de recherche, cliquez sur **Cr√©er un filtre**.
5. Choisissez ce que vous souhaitez que le filtre fasse.
6. Cliquez sur **Cr√©er un filtre**.

V√©rifiez votre filtre actuel (pour les supprimer) sur [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (142).png" alt=""><figcaption></figcaption></figure>

* Cr√©ez **une adresse de transfert pour transf√©rer des informations sensibles** (ou tout) - Vous avez besoin d'un acc√®s manuel.
* Cr√©ez une adresse de transfert sur [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* L'adresse de r√©ception devra confirmer cela
* Ensuite, r√©glez pour transf√©rer tous les emails tout en gardant une copie (n'oubliez pas de cliquer sur enregistrer les modifications) :

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Il est √©galement possible de cr√©er des filtres et de transf√©rer uniquement certains emails √† l'autre adresse email.

## Mots de passe d'application

Si vous avez r√©ussi √† **compromettre une session utilisateur Google** et que l'utilisateur avait **2FA**, vous pouvez **g√©n√©rer** un [**mot de passe d'application**](https://support.google.com/accounts/answer/185833?hl=en) (suivez le lien pour voir les √©tapes). Notez que **les mots de passe d'application ne sont plus recommand√©s par Google et sont r√©voqu√©s** lorsque l'utilisateur **change son mot de passe de compte Google.**

**M√™me si vous avez une session ouverte, vous aurez besoin de conna√Ætre le mot de passe de l'utilisateur pour cr√©er un mot de passe d'application.**

{% hint style="info" %}
Les mots de passe d'application peuvent **uniquement √™tre utilis√©s avec des comptes qui ont la v√©rification en deux √©tapes** activ√©e.
{% endhint %}

## Changer 2-FA et similaire

Il est √©galement possible de **d√©sactiver 2-FA ou d'enregistrer un nouvel appareil** (ou num√©ro de t√©l√©phone) sur cette page [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**.**\
**Il est √©galement possible de g√©n√©rer des cl√©s d'acc√®s (ajouter votre propre appareil), changer le mot de passe, ajouter des num√©ros de mobile pour les t√©l√©phones de v√©rification et de r√©cup√©ration, changer l'email de r√©cup√©ration et changer les questions de s√©curit√©).**

{% hint style="danger" %}
Pour **emp√™cher les notifications push de s√©curit√©** d'atteindre le t√©l√©phone de l'utilisateur, vous pourriez **d√©connecter son smartphone** (bien que cela serait √©trange) car vous ne pouvez pas le reconnecter √† partir d'ici.

Il est √©galement possible de **localiser l'appareil.**
{% endhint %}

**M√™me si vous avez une session ouverte, vous aurez besoin de conna√Ætre le mot de passe de l'utilisateur pour changer ces param√®tres.**

## Persistance via les applications OAuth

Si vous avez **compromis le compte d'un utilisateur,** vous pouvez simplement **accepter** d'accorder toutes les permissions possibles √† une **application OAuth**. Le seul probl√®me est que Workspace peut √™tre configur√© pour **interdire les applications OAuth externes et/ou internes non examin√©es.**\
Il est assez courant que les organisations Workspace ne fassent pas confiance par d√©faut aux applications OAuth externes mais fassent confiance √† celles internes, donc si vous avez **suffisamment de permissions pour g√©n√©rer une nouvelle application OAuth** √† l'int√©rieur de l'organisation et que les applications externes sont interdites, g√©n√©rez-la et **utilisez cette nouvelle application OAuth interne pour maintenir la persistance**.

Consultez la page suivante pour plus d'informations sur les applications OAuth :

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Persistance via d√©l√©gation

Vous pouvez simplement **d√©l√©guer le compte** √† un autre compte contr√¥l√© par l'attaquant (si vous √™tes autoris√© √† le faire). Dans les organisations Workspace, cette option doit √™tre **activ√©e**. Elle peut √™tre d√©sactiv√©e pour tout le monde, activ√©e pour certains utilisateurs/groupes ou pour tout le monde (g√©n√©ralement, elle n'est activ√©e que pour certains utilisateurs/groupes ou compl√®tement d√©sactiv√©e).

<details>

<summary>Si vous √™tes un administrateur Workspace, v√©rifiez ici pour activer la fonctionnalit√©</summary>

(Information [copi√©e de la documentation](https://support.google.com/a/answer/7223765))

En tant qu'administrateur de votre organisation (par exemple, votre travail ou √©cole), vous contr√¥lez si les utilisateurs peuvent d√©l√©guer l'acc√®s √† leur compte Gmail. Vous pouvez permettre √† tout le monde d'avoir l'option de d√©l√©guer leur compte. Ou, permettre seulement aux personnes de certains d√©partements de configurer la d√©l√©gation. Par exemple, vous pouvez :

* Ajouter un assistant administratif en tant que d√©l√©gu√© sur votre compte Gmail afin qu'ils puissent lire et envoyer des emails en votre nom.
* Ajouter un groupe, tel que votre d√©partement des ventes, dans Groups en tant que d√©l√©gu√© pour donner √† tout le monde l'acc√®s √† un compte Gmail.

Les utilisateurs ne peuvent d√©l√©guer l'acc√®s qu'√† un autre utilisateur de la m√™me organisation, ind√©pendamment de leur domaine ou de leur unit√© organisationnelle.

#### Limites et restrictions de d√©l√©gation

* Option **Permettre aux utilisateurs d'accorder l'acc√®s √† leur bo√Æte aux lettres √† un groupe Google** : Pour utiliser cette option, elle doit √™tre activ√©e pour l'OU du compte d√©l√©gu√© et pour l'OU de chaque membre du groupe. Les membres du groupe appartenant √† un OU sans cette option activ√©e ne peuvent pas acc√©der au compte d√©l√©gu√©.
* Avec une utilisation typique, 40 utilisateurs d√©l√©gu√©s peuvent acc√©der √† un compte Gmail en m√™me temps. Une utilisation sup√©rieure √† la moyenne par un ou plusieurs d√©l√©gu√©s pourrait r√©duire ce nombre.
* Les processus automatis√©s qui acc√®dent fr√©quemment √† Gmail peuvent √©galement r√©duire le nombre de d√©l√©gu√©s pouvant acc√©der √† un compte en m√™me temps. Ces processus incluent les API ou les extensions de navigateur qui acc√®dent fr√©quemment √† Gmail.
* Un seul compte Gmail prend en charge jusqu'√† 1 000 d√©l√©gu√©s uniques. Un groupe dans Groups compte comme un d√©l√©gu√© unique pour la limite.
* La d√©l√©gation n'augmente pas les limites d'un compte Gmail. Les comptes Gmail avec des utilisateurs d√©l√©gu√©s ont les limites et politiques standard d'un compte Gmail. Pour plus de d√©tails, visitez [Limites et politiques Gmail](https://support.google.com/a/topic/28609).

#### √âtape 1 : Activer la d√©l√©gation Gmail pour vos utilisateurs

**Avant de commencer :** Pour appliquer le param√®tre √† certains utilisateurs, placez leurs comptes dans une [unit√© organisationnelle](https://support.google.com/a/topic/1227584).

1. [Connectez-vous](https://admin.google.com/) √† votre [console d'administration Google](https://support.google.com/a/answer/182076).

Connectez-vous en utilisant un _compte administrateur_, pas votre compte actuel CarlosPolop@gmail.com 2. Dans la console d'administration, allez dans Menu ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![et ensuite](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **Applications**![et ensuite](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![et ensuite](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![et ensuite](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Param√®tres utilisateur**. 3. Pour appliquer le param√®tre √† tout le monde, laissez l'unit√© organisationnelle sup√©rieure s√©lectionn√©e. Sinon, s√©lectionnez une unit√© organisationnelle enfant. 4. Cliquez sur **D√©l√©gation de courrier**. 5. Cochez la case **Permettre aux utilisateurs de d√©l√©guer l'acc√®s √† leur bo√Æte aux lettres √† d'autres utilisateurs dans le domaine**. 6. (Facultatif) Pour permettre aux utilisateurs de sp√©cifier quelles informations de l'exp√©diteur sont incluses dans les messages d√©l√©gu√©s envoy√©s depuis leur compte, cochez la case **Permettre aux utilisateurs de personnaliser ce param√®tre**. 7. S√©lectionnez une option pour les informations de l'exp√©diteur par d√©faut incluses dans les messages envoy√©s par les d√©l√©gu√©s :

* **Afficher le propri√©taire du compte et le d√©l√©gu√© qui a envoy√© l'email**‚ÄîLes messages incluent les adresses email du propri√©taire du compte Gmail et du d√©l√©gu√©.
* **Afficher uniquement le propri√©taire du compte**‚ÄîLes messages incluent l'adresse email uniquement du propri√©taire du compte Gmail. L'adresse email du d√©l√©gu√© n'est pas incluse.

8. (Facultatif) Pour permettre aux utilisateurs d'ajouter un groupe dans Groups en tant que d√©l√©gu√©, cochez la case **Permettre aux utilisateurs d'accorder l'acc√®s √† leur bo√Æte aux lettres √† un groupe Google**.
9. Cliquez sur **Enregistrer**. Si vous avez configur√© une unit√© organisationnelle enfant, vous pourriez √™tre en mesure de **H√©riter** ou de **Remplacer** les param√®tres d'une unit√© organisationnelle parente.
10. (Facultatif) Pour activer la d√©l√©gation Gmail pour d'autres unit√©s organisationnelles, r√©p√©tez les √©tapes 3‚Äì9.

Les changements peuvent prendre jusqu'√† 24 heures mais se produisent g√©n√©ralement plus rapidement. [En savoir plus](https://support.google.com/a/answer/7514107)

#### √âtape 2 : Demandez aux utilisateurs de configurer des d√©l√©gu√©s pour leurs comptes

Apr√®s avoir activ√© la d√©l√©gation, vos utilisateurs se rendent dans leurs param√®tres Gmail pour attribuer des d√©l√©gu√©s. Les d√©l√©gu√©s peuvent alors lire, envoyer et recevoir des messages au nom de l'utilisateur.

Pour plus de d√©tails, dirigez les utilisateurs vers [D√©l√©guer et collaborer sur les emails](https://support.google.com/a/users/answer/138350).

</details>

<details>

<summary>Pour un utilisateur r√©gulier, v√©rifiez ici les instructions pour essayer de d√©l√©guer votre acc√®s</summary>

(Info copi√©e [**de la documentation**](https://support.google.com/mail/answer/138350))

Vous pouvez ajouter jusqu'√† 10 d√©l√©gu√©s.

Si vous utilisez Gmail via votre travail, √©cole ou autre organisation :

* Vous pouvez ajouter jusqu'√† 1000 d√©l√©gu√©s au sein de votre organisation.
* Avec une utilisation typique, 40 d√©l√©gu√©s peuvent acc√©der √† un compte Gmail en m√™me temps.
* Si vous utilisez des processus automatis√©s, tels que des API ou des extensions de navigateur, quelques d√©l√©gu√©s peuvent acc√©der √† un compte Gmail en m√™me temps.

1. Sur votre ordinateur, ouvrez [Gmail](https://mail.google.com/). Vous ne pouvez pas ajouter de d√©l√©gu√©s depuis l'application Gmail.
2. En haut √† droite, cliquez sur Param√®tres ![Param√®tres](https://lh3.googleusercontent.com/p3J-ZSPOLtuBBR\_ofWTFDfdgAYQgi8mR5c76ie8XQ2wjegk7-yyU5zdRVHKybQgUlQ=w36-h36) ![et ensuite](https://lh3.googleusercontent.com/3\_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36) **Voir tous les param√®tres**.
3. Cliquez sur l'onglet **Comptes et importation** ou **Comptes**.
4. Dans la section "Accorder l'acc√®s √† votre compte", cliquez sur **Ajouter un autre compte**. Si vous utilisez Gmail via votre travail ou √©cole, votre organisation peut restreindre la d√©l√©gation d'email. Si vous ne voyez pas ce param√®tre, contactez votre administrateur.

* Si vous ne voyez pas Accorder l'acc√®s √† votre compte, alors c'est restreint.

5. Entrez l'adresse email de la personne que vous souhaitez ajouter. Si vous utilisez Gmail via votre travail, √©cole ou autre organisation, et que votre administrateur le permet, vous pouvez entrer l'adresse email d'un groupe. Ce groupe doit avoir le m√™me domaine que votre organisation. Les membres externes du groupe se voient refuser l'acc√®s √† la d√©l√©gation.\
   \
   **Important :** Si le compte que vous d√©l√©guez est un nouveau compte ou si le mot de passe a √©t√© r√©initialis√©, l'administrateur doit d√©sactiver l'exigence de changer le mot de passe lors de la premi√®re connexion.

* [Apprenez comment un administrateur peut cr√©er un utilisateur](https://support.google.com/a/answer/33310).
* [Apprenez comment un administrateur peut r√©initialiser les mots de passe](https://support.google.com/a/answer/33319).

6\. Cliquez sur **√âtape suivante** !\[et ensuite]\(https://lh3.googleusercontent.com/QbWcYKta5vh\_4-OgUeFmK-JOB0YgLLoGh69P478nE6mKdfpWQniiBabj

</details>
