# GWS - Persistence

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks in PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositorys einreichen.

</details>

{% hint style="danger" %}
Alle in diesem Abschnitt erw√§hnten Aktionen, die Einstellungen √§ndern, generieren eine **Sicherheitswarnung an die E-Mail und sogar eine Push-Benachrichtigung an jedes synchronisierte Mobilger√§t** mit dem Konto.
{% endhint %}

## **Persistenz in Gmail**

* Sie k√∂nnen **Filter erstellen, um** Sicherheitsbenachrichtigungen von Google zu verbergen
* `from: (no-reply@accounts.google.com) "Sicherheitswarnung"`
* Dies verhindert, dass Sicherheits-E-Mails die E-Mail erreichen (verhindert jedoch nicht, dass Push-Benachrichtigungen auf dem Mobilger√§t ankommen)

<details>

<summary>Schritte zum Erstellen eines Gmail-Filters</summary>

(Anweisungen von [**hier**](https://support.google.com/mail/answer/6579))

1. √ñffnen Sie [Gmail](https://mail.google.com/).
2. Klicken Sie oben im Suchfeld auf Optionen anzeigen ![photos tune](https://lh3.googleusercontent.com/cD6YR\_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1\_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36).
3. Geben Sie Ihre Suchkriterien ein. Wenn Sie √ºberpr√ºfen m√∂chten, ob Ihre Suche korrekt funktioniert hat, sehen Sie sich die angezeigten E-Mails an, indem Sie auf **Suchen** klicken.
4. Klicken Sie unten im Suchfenster auf **Filter erstellen**.
5. W√§hlen Sie aus, was der Filter tun soll.
6. Klicken Sie auf **Filter erstellen**.

√úberpr√ºfen Sie Ihre aktuellen Filter (zum L√∂schen) unter [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (142).png" alt=""><figcaption></figcaption></figure>

* Erstellen Sie eine **Weiterleitungsadresse, um sensible Informationen** (oder alles) weiterzuleiten - Sie ben√∂tigen manuellen Zugriff.
* Erstellen Sie eine Weiterleitungsadresse unter [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* Die empfangende Adresse muss dies best√§tigen
* Dann setzen Sie alle E-Mails weiter, w√§hrend Sie eine Kopie behalten (denken Sie daran, auf √Ñnderungen speichern zu klicken):

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Es ist auch m√∂glich, Filter zu erstellen und nur bestimmte E-Mails an die andere E-Mail-Adresse weiterzuleiten.

## App-Passw√∂rter

Wenn es Ihnen gelungen ist, **eine Google-Benutzersitzung zu kompromittieren** und der Benutzer **2FA** hatte, k√∂nnen Sie ein [**App-Passwort generieren**](https://support.google.com/accounts/answer/185833?hl=de) (folgen Sie dem Link, um die Schritte zu sehen). Beachten Sie, dass **App-Passw√∂rter von Google nicht mehr empfohlen werden und widerrufen werden**, wenn der Benutzer **sein Google-Konto-Passwort √§ndert.**

**Auch wenn Sie eine offene Sitzung haben, m√ºssen Sie das Passwort des Benutzers kennen, um ein App-Passwort zu erstellen.**

{% hint style="info" %}
App-Passw√∂rter k√∂nnen **nur mit Konten verwendet werden, bei denen die Zwei-Schritt-Verifizierung** aktiviert ist.
{% endhint %}

## 2-FA und √§hnliches √§ndern

Es ist auch m√∂glich, **die 2-FA auszuschalten oder ein neues Ger√§t** (oder Telefonnummer) auf dieser Seite zu registrieren [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**.**\
**Es ist auch m√∂glich, Passw√∂rter zu generieren (f√ºgen Sie Ihr eigenes Ger√§t hinzu), das Passwort zu √§ndern, Mobilnummern f√ºr Verifizierungs- und Wiederherstellungs-Telefone hinzuzuf√ºgen, die Wiederherstellungs-E-Mail zu √§ndern und die Sicherheitsfragen zu √§ndern).**

{% hint style="danger" %}
Um zu verhindern, dass Sicherheits-Push-Benachrichtigungen das Telefon des Benutzers erreichen, k√∂nnten Sie sein Smartphone **abmelden** (obwohl das seltsam w√§re), da Sie ihn nicht von hier aus wieder anmelden k√∂nnen.

Es ist auch m√∂glich, das Ger√§t **zu lokalisieren**.
{% endhint %}

**Auch wenn Sie eine offene Sitzung haben, m√ºssen Sie das Passwort des Benutzers kennen, um diese Einstellungen zu √§ndern.**

## Persistenz √ºber OAuth-Apps

Wenn Sie **das Konto eines Benutzers kompromittiert haben**, k√∂nnen Sie einfach zustimmen, alle m√∂glichen Berechtigungen an eine **OAuth-App** zu erteilen. Das einzige Problem ist, dass Workspace so konfiguriert werden kann, dass **nicht √ºberpr√ºfte externe und/oder interne OAuth-Apps nicht zugelassen sind.**\
Es ist ziemlich √ºblich, dass Workspace-Organisationen standardm√§√üig externen OAuth-Apps nicht vertrauen, internen jedoch vertrauen. Wenn Sie also **ausreichende Berechtigungen haben, um eine neue OAuth-Anwendung** innerhalb der Organisation zu generieren und externe Apps nicht zugelassen sind, generieren Sie diese und **verwenden Sie diese neue interne OAuth-App, um die Persistenz aufrechtzuerhalten**.

√úberpr√ºfen Sie die folgende Seite f√ºr weitere Informationen zu OAuth-Apps:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Persistenz √ºber Delegation

Sie k√∂nnen einfach das Konto an ein anderes Konto delegieren, das vom Angreifer kontrolliert wird (sofern dies erlaubt ist). In Workspace **Organisationen** muss diese Option **aktiviert** sein. Sie kann f√ºr alle deaktiviert, f√ºr einige Benutzer/Gruppen aktiviert oder f√ºr alle (normalerweise nur f√ºr einige Benutzer/Gruppen oder vollst√§ndig deaktiviert) aktiviert sein.

<details>

<summary>Wenn Sie ein Workspace-Administrator sind, √ºberpr√ºfen Sie dies, um die Funktion zu aktivieren</summary>

(Informationen [aus den Dokumenten kopiert](https://support.google.com/a/answer/7223765))

Als Administrator f√ºr Ihre Organisation (z. B. Ihr Unternehmen oder Ihre Schule) kontrollieren Sie, ob Benutzer den Zugriff auf ihr Gmail-Konto delegieren k√∂nnen. Sie k√∂nnen allen die M√∂glichkeit geben, ihr Konto zu delegieren. Oder nur Personen in bestimmten Abteilungen die Einrichtung der Delegation erlauben. Zum Beispiel k√∂nnen Sie:

* Einen Verwaltungsassistenten als Delegierten in Ihrem Gmail-Konto hinzuf√ºgen, damit er E-Mails in Ihrem Auftrag lesen und senden kann.
* Eine Gruppe, wie z. B. Ihre Verkaufsabteilung, in Gruppen als Delegierten hinzuf√ºgen, um allen Zugriff auf ein Gmail-Konto zu gew√§hren.

Benutzer k√∂nnen nur einem anderen Benutzer in derselben Organisation Zugriff delegieren, unabh√§ngig von ihrer Domain oder ihrer organisatorischen Einheit.

#### Delegationsgrenzen & Einschr√§nkungen

* **Benutzern erlauben, ihrem Postfachzugriff auf eine Google-Gruppe zu gew√§hren**-Option: Um diese Option zu verwenden, muss sie f√ºr die OU des delegierten Kontos und f√ºr die OU jedes Gruppenmitglieds aktiviert sein. Gruppenmitglieder, die zu einer OU geh√∂ren, in der diese Option nicht aktiviert ist, k√∂nnen nicht auf das delegierte Konto zugreifen.
* Bei typischer Verwendung k√∂nnen 40 delegierte Benutzer gleichzeitig auf ein Gmail-Konto zugreifen. √úberdurchschnittliche Nutzung durch einen oder mehrere Delegierte kann diese Zahl reduzieren.
* Automatisierte Prozesse, die h√§ufig auf Gmail zugreifen, k√∂nnen ebenfalls die Anzahl der Delegierten reduzieren, die gleichzeitig auf ein Konto zugreifen k√∂nnen. Diese Prozesse umfassen APIs oder Browsererweiterungen, die h√§ufig auf Gmail zugreifen.
* Ein einzelnes Gmail-Konto unterst√ºtzt bis zu 1.000 eindeutige Delegierte. Eine Gruppe in Gruppen z√§hlt als ein Delegierter f√ºr das Limit.
* Delegation erh√∂ht nicht die Grenzen f√ºr ein Gmail-Konto. Gmail-Konten mit delegierten Benutzern haben die standardm√§√üigen Gmail-Kontogrenzen und -richtlinien. Weitere Informationen finden Sie unter [Gmail-Grenzen und -Richtlinien](https://support.google.com/a/topic/28609).

#### Schritt 1: Aktivieren Sie die Gmail-Delegation f√ºr Ihre Benutzer

**Bevor Sie beginnen:** Um die Einstellung f√ºr bestimmte Benutzer anzuwenden, platzieren Sie ihre Konten in einer [organisatorischen Einheit](https://support.google.com/a/topic/1227584).

1. Melden Sie sich in Ihrem [Google Admin-Konsole](https://admin.google.com/) an.
2. Gehen Sie in der Admin-Konsole zu Men√º ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **Apps**![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Benutzereinstellungen**.
3. Um die Einstellung auf alle anzuwenden, lassen Sie die oberste organisatorische Einheit ausgew√§hlt. Andernfalls w√§hlen Sie eine untergeordnete [organisatorische Einheit](https://support.google.com/a/topic/1227584).
4. Klicken Sie auf **Maildelegation**.
5. Aktivieren Sie das Kontrollk√§stchen **Benutzern erlauben, anderen Benutzern in der Dom√§ne den Zugriff auf ihr Postfach zu delegieren**.
6. (Optional) Um Benutzern zu erlauben, anzugeben, welche Absenderinformationen in delegierten Nachrichten enthalten sind, aktivieren Sie das Kontrollk√§stchen **Benutzern erlauben, diese Einstellung anzupassen**.
7. W√§hlen Sie eine Option f√ºr die standardm√§√üigen Absenderinformationen, die in von Delegierten gesendeten Nachrichten enthalten sind:

* **Zeigen Sie den Kontoinhaber und den Delegierten, der die E-Mail gesendet hat**‚ÄîNachrichten enthalten die E-Mail-Adressen des Gmail-Kontoinhabers und des Delegierten.
* **Zeigen Sie nur den Kontoinhaber**‚ÄîNachrichten enthalten nur die E-Mail-Adresse des Gmail-Kontoinhabers. Die E-Mail-Adresse des Delegierten ist nicht enthalten.

8. (Optional) Um Benutzern das Hinzuf√ºgen einer Gruppe in Gruppen als Delegierten zu erm√∂glichen, aktivieren Sie das Kontrollk√§stchen **Benutzern erlauben, ihrem Postfach Zugriff auf eine Google-Gruppe zu gew√§hren**.
9. Klicken Sie auf **Speichern**. Wenn Sie eine untergeordnete organisatorische Einheit konfiguriert haben, k√∂nnen Sie m√∂glicherweise die Einstellungen einer √ºbergeordneten organisatorischen Einheit **vererben** oder **√ºberschreiben**.
10. (Optional) Um die Gmail-Delegation f√ºr andere organisatorische Einheiten zu aktivieren, wiederholen Sie die Schritte 3‚Äì9.

√Ñnderungen k√∂nnen bis zu 24 Stunden dauern, erfolgen jedoch normalerweise schneller. [Weitere Informationen](https://support.google.com/a/answer/7514107)

#### Schritt 2: Benutzer zur Einrichtung von Delegierten f√ºr ihre Konten anleiten

Nachdem Sie die Delegation aktiviert haben, gehen Ihre Benutzer zu ihren Gmail-Einstellungen, um Delegierte zuzuweisen. Delegierte k√∂nnen dann Nachrichten im Auftrag des Benutzers lesen, senden und empfangen.

Weisen Sie Benutzer f√ºr weitere Details auf [Delegieren und Zusammenarbeiten bei E-Mails](https://support.google.com/a/users/answer/138350) hin.

</details>

\* \*\*Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die\*\* \[\*\*HackTricks\*\*]\(https://github.com/carlospolop/hacktricks) \*\*und\*\* \[\*\*HackTricks Cloud\*\*]\(https://github.com/carlospolop/hacktricks-cloud) \*\*GitHub-Repositorys senden.\*\*
