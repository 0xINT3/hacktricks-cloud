# GWS - Persistence

<details>

<summary><strong>Dowiedz się, jak hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów GitHub.

</details>

{% hint style="danger" %}
Wszystkie działania wymienione w tej sekcji, które zmieniają ustawienia, spowodują **alert bezpieczeństwa wysłany na adres e-mail i nawet powiadomienie push na dowolne zsynchronizowane urządzenie mobilne**.
{% endhint %}

## **Trwałość w Gmailu**

* Możesz tworzyć **filtry, aby ukryć** powiadomienia o bezpieczeństwie od Google
* `from: (no-reply@accounts.google.com) "Security Alert"`
* Spowoduje to, że wiadomości o bezpieczeństwie nie dotrą na skrzynkę e-mailową (ale nie uniemożliwi powiadomień push na urządzeniu mobilnym)

<details>

<summary>Kroki do utworzenia filtra w Gmailu</summary>

(Instrukcje z [**tutaj**](https://support.google.com/mail/answer/6579))

1. Otwórz [Gmail](https://mail.google.com/).
2. W polu wyszukiwania na górze kliknij opcje wyszukiwania ![photos tune](https://lh3.googleusercontent.com/cD6YR\_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1\_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36) .
3. Wprowadź kryteria wyszukiwania. Jeśli chcesz sprawdzić, czy wyszukiwanie działa poprawnie, zobacz, jakie wiadomości się pojawiają, klikając **Szukaj**.
4. Na dole okna wyszukiwania kliknij **Utwórz filtr**.
5. Wybierz, co chcesz, aby filtr robił.
6. Kliknij **Utwórz filtr**.

Sprawdź swoje obecne filtry (aby je usunąć) pod adresem [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (142).png" alt=""><figcaption></figcaption></figure>

* Utwórz **adres przekierowania do przekazywania wrażliwych informacji** (lub wszystkiego) - wymaga ręcznego dostępu.
* Utwórz adres przekierowania na stronie [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* Adres odbiorcy musi potwierdzić to przekierowanie
* Następnie ustaw przekierowanie wszystkich wiadomości, zachowując kopię (pamiętaj, aby kliknąć Zapisz zmiany):

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Można również tworzyć filtry i przekazywać tylko określone wiadomości na inny adres e-mail.

## Hasła aplikacji

Jeśli udało ci się **zakraść do sesji użytkownika Google** i użytkownik miał **2FA**, możesz **wygenerować** [**hasło aplikacji**](https://support.google.com/accounts/answer/185833?hl=en) (kliknij link, aby zobaczyć kroki). Należy jednak zauważyć, że **hasła aplikacji nie są już zalecane przez Google i są unieważniane**, gdy użytkownik **zmienia hasło do konta Google.**

**Nawet jeśli masz otwartą sesję, będziesz musiał znać hasło użytkownika, aby utworzyć hasło aplikacji.**

{% hint style="info" %}
Hasła aplikacji można **używać tylko z kontami, na których włączona jest weryfikacja dwuetapowa**.
{% endhint %}

## Zmiana 2-FA i podobne

Możliwe jest również **wyłączenie 2-FA lub zarejestrowanie nowego urządzenia** (lub numeru telefonu) na tej stronie [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**.**\
**Możliwe jest również generowanie kluczy dostępu (dodawanie własnego urządzenia), zmiana hasła, dodawanie numerów telefonów do weryfikacji i odzyskiwania, zmiana adresu e-mail do odzyskiwania i zmiana pytań zabezpieczających).**

{% hint style="danger" %}
Aby **zapobiec dotarciu powiadomień push o bezpieczeństwie** do telefonu użytkownika, można go **wylogować z jego smartfona** (choć byłoby to dziwne), ponieważ nie można go ponownie zalogować stąd.

Możliwe jest również **lokalizowanie urządzenia**.
{% endhint %}

**Nawet jeśli masz otwartą sesję, będziesz musiał znać hasło użytkownika, aby zmienić te ustawienia.**

## Trwałość za pomocą aplikacji OAuth

Jeśli **zakraść się do konta użytkownika**, możesz po prostu **zaakceptować** udzielenie wszystkich możliwych uprawnień **aplikacji OAuth**. Jedynym problemem jest to, że Workspace może być skonfigurowane tak, aby **nie zezwalać na niezweryfikowane zewnętrzne i/lub wewnętrzne aplikacje OAuth.**\
Jest dość powszechne, że Organizacje Workspace domyślnie nie ufają zewnętrznym aplikacjom OAuth, ale ufają wewnętrznym, więc jeśli masz **wystarczające uprawnienia do wygenerowania nowej aplikacji OAuth** wewnątrz organizacji i zewnętrzne aplikacje są niedozwolone, wygeneruj ją i **użyj tej nowej wewnętrznej aplikacji OAuth do utrzymania trwałości**.

Sprawdź następującą stronę, aby uzyskać więcej informacji na temat aplikacji OAuth:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Trwałość za pomocą delegacji

Możesz po prostu **delegować konto** do innego konta kontrolowanego przez atakującego (jeśli masz do tego uprawnienia). W organizacjach Workspace ta opcja musi być **włączona**. Może być wyłączona dla wszystkich, włączona dla niektórych użytkowników/grup lub dla wszystkich (zwykle jest włączona tylko dla niektórych użytkowników/grup lub całkowicie wyłączona).

<details>

<summary>Jeśli jesteś administratorem Workspace, sprawdź to, aby włączyć tę funkcję</summary>

(Informacje [skopiowane z dokumentacji](https://support.google.com/a/answer/7223765))

Jako administrator Twojej organizacji (na przykład

#### Krok 1: Włącz delegację Gmail dla swoich użytkowników

**Przed rozpoczęciem:** Aby zastosować ustawienie dla określonych użytkowników, umieść ich konta w [jednostce organizacyjnej](https://support.google.com/a/topic/1227584).

1. [Zaloguj się](https://admin.google.com/) do [konsoli administratora Google](https://support.google.com/a/answer/182076).

Zaloguj się za pomocą konta _administratora_, a nie swojego bieżącego konta CarlosPolop@gmail.com. 2. W konsoli administratora przejdź do Menu ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![a następnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **Aplikacje**![a następnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![a następnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![a następnie](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Ustawienia użytkownika**. 3. Aby zastosować ustawienie dla wszystkich, pozostaw wybraną najwyższą jednostkę organizacyjną. W przeciwnym razie wybierz podrzędną [jednostkę organizacyjną](https://support.google.com/a/topic/1227584). 4. Kliknij **Delegacja poczty**. 5. Zaznacz pole **Pozwól użytkownikom delegować dostęp do swojej skrzynki pocztowej innym użytkownikom w domenie**. 6. (Opcjonalnie) Aby umożliwić użytkownikom określanie informacji nadawcy, które są zawarte w delegowanych wiadomościach wysyłanych z ich konta, zaznacz pole **Pozwól użytkownikom dostosować to ustawienie**. 7. Wybierz opcję dla domyślnych informacji nadawcy, które są zawarte w wiadomościach wysyłanych przez delegatów:

* **Pokaż właściciela konta i delegata, który wysłał wiadomość** - Wiadomości zawierają adresy e-mail właściciela konta Gmail i delegata.
* **Pokaż tylko właściciela konta** - Wiadomości zawierają tylko adres e-mail właściciela konta Gmail. Adres e-mail delegata nie jest uwzględniony.

8. (Opcjonalnie) Aby umożliwić użytkownikom dodanie grupy w Grupach jako delegata, zaznacz pole **Pozwól użytkownikom udzielić dostępu do swojej skrzynki pocztowej grupie Google**.
9. Kliknij **Zapisz**. Jeśli skonfigurowałeś podrzędną jednostkę organizacyjną, możesz **dziedziczyć** lub **nadpisać** ustawienia jednostki organizacyjnej nadrzędnej.
10. (Opcjonalnie) Aby włączyć delegację Gmail dla innych jednostek organizacyjnych, powtórz kroki 3-9.

Zmiany mogą zajmować do 24 godzin, ale zazwyczaj następują szybciej. [Dowiedz się więcej](https://support.google.com/a/answer/7514107)

#### Krok 2: Użytkownicy ustawiają delegatów dla swoich kont

Po włączeniu delegacji, użytkownicy przechodzą do ustawień Gmail, aby przypisać delegatów. Delegaci mogą następnie czytać, wysyłać i odbierać wiadomości w imieniu użytkownika.

Aby uzyskać szczegółowe informacje, skieruj użytkowników do [Delegowanie i współpraca w e-mailach](https://support.google.com/a/users/answer/138350).

</details>

<details>

<summary>Dla zwykłego użytkownika, sprawdź tutaj instrukcje, jak spróbować przekazać dostęp</summary>

(Informacje skopiowane [**z dokumentacji**](https://support.google.com/mail/answer/138350))

Możesz dodać do 10 delegatów.

Jeśli korzystasz z Gmaila w ramach swojej pracy, szkoły lub innej organizacji:

* Możesz dodać do 1000 delegatów w ramach swojej organizacji.
* Przy typowym użytkowaniu, 40 delegatów może mieć dostęp do konta Gmail jednocześnie.
* Jeśli korzystasz z procesów automatycznych, takich jak interfejsy API lub rozszerzenia przeglądarki, kilku delegatów może mieć dostęp do konta Gmail jednocześnie.

1. Na swoim komputerze otwórz [Gmail](https://mail.google.com/). Nie możesz dodawać delegatów z aplikacji Gmail.
2. W prawym górnym rogu kliknij Ustawienia ![Ustawienia](https://lh3.googleusercontent.com/p3J-ZSPOLtuBBR\_ofWTFDfdgAYQgi8mR5c76ie8XQ2wjegk7-yyU5zdRVHKybQgUlQ=w36-h36) ![a następnie](https://lh3.googleusercontent.com/3\_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36) **Zobacz wszystkie ustawienia**.
3. Kliknij zakładkę **Konta i import** lub **Konta**.
4. W sekcji "Udziel dostępu do swojego konta" kliknij **Dodaj inne konto**. Jeśli korzystasz z Gmaila w ramach swojej pracy lub szkoły, twoja organizacja może ograniczać delegację e-maili. Jeśli nie widzisz tej opcji, skontaktuj się z administratorem.

* Jeśli nie widzisz opcji Udziel dostępu do swojego konta, oznacza to, że jest ona ograniczona.

5. Wprowadź adres e-mail osoby, którą chcesz dodać. Jeśli korzystasz z Gmaila w ramach swojej pracy, szkoły lub innej organizacji, i administrator na to pozwala, możesz wprowadzić adres e-mail grupy. Ta grupa musi mieć taką samą domenę jak twoja organizacja. Zewnętrzni członkowie grupy są pozbawieni dostępu do delegacji.\
   \
   **Ważne:** Jeśli konto, które delegujesz, jest nowe lub hasło zostało zresetowane, administrator musi wyłączyć wymaganie zmiany hasła przy pierwszym logowaniu.

* [Dowiedz się, jak administrator może utworzyć użytkownika](https://support.google.com/a/answer/33310).
* [Dowiedz się, jak administrator może zresetować hasła](https://support.google.com/a/answer/33319).

6. Kliknij **Następny krok** ![a następnie](https://lh3.googleusercontent.com/QbWcYKta5vh\_4-OgUeFmK-JOB0YgLLoGh69P478nE6mKdfpWQniiBabjF7FVoCVXI0g=h36) \*\*Wyślij e-mail w celu udzielen

* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do repozytoriów** [**HackTricks**](https://github.com/carlospolop/hacktricks) **i** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **na GitHubie.**

</details>
