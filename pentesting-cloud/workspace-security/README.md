# GWS - Workspace ペネトレーションテスト

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) で AWS ハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks にあなたの会社を広告したい**、または **HackTricks を PDF でダウンロードしたい** 場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式 PEASS & HackTricks グッズ**](https://peass.creator-spring.com) を入手する
* [**PEASS ファミリー**](https://opensea.io/collection/the-peass-family) を発見する、私たちの独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクション
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) に **参加する** か、[**telegram グループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) を **フォローする**。
* **HackTricks** の GitHub リポジトリ [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) に PR を提出して、あなたのハッキングのコツを共有する。

</details>

## Google プラットフォームと OAuth アプリのフィッシング

Drive、Chat、Groups などの異なる Google プラットフォームを使用して被害者にフィッシングリンクを送信する方法と、Google OAuth フィッシングを実行する方法を確認してください:

{% content-ref url="gws-google-platforms-phishing.md" %}
[gws-google-platforms-phishing.md](gws-google-platforms-phishing.md)
{% endcontent-ref %}

## パスワードスプレー

見つけたメールアドレス（または発見した可能性のあるメール名パターンに基づいて生成したメールアドレス）でパスワードをテストするために、IP アドレスを変更するために AWS ラムダを使用する [**https://github.com/ustayready/CredKing**](https://github.com/ustayready/CredKing) のようなツールを使用できます（メンテナンスされていないように見えます）。

## アプリスクリプト

開発者はアプリスクリプトを作成し、それをスタンドアロンプロジェクトとして設定するか、Google Docs/Sheets/Slides/Forms にバインドすることができます。アプリスクリプトは、編集権限を持つユーザーがドキュメントにアクセスしたとき（OAuth プロンプトを受け入れた後）にトリガーされるコードです。

ただし、アプリが検証されていなくても、そのプロンプトを表示しない方法がいくつかあります:

* アプリの発行者がアクセスしているユーザーと同じ Workspace にいる場合
* スクリプトがユーザーのドライブ内にある場合

### コピー文書未検証プロンプトバイパス

ドキュメントを共有するリンクを作成すると、このようなリンクが作成されます: `https://docs.google.com/spreadsheets/d/1i5[...]aIUD/edit`\
**"/edit"** の終わりを **"/copy"** に **変更する** と、Google はアクセスする代わりにドキュメントの **コピーを生成するかどうか** 尋ねます。

{% hint style="warning" %}
誰かがその **ドキュメントのコピー** を作成した場合、**アプリスクリプトもコピー** されます。したがって、コピーされた **スプレッドシートを開く** と、**通常の OAuth プロンプト** が表示され、**未検証プロンプトをバイパス** します。なぜなら、**ユーザーはコピーされたファイルのアプリスクリプトの著者になるから** です。
{% endhint %}

この方法は Workspace 管理者の制限もバイパスできますが、以下の方法で防止できます:

### 共有文書未検証プロンプトバイパス

さらに、編集アクセス権を持つドキュメントを誰かが **共有** した場合、ドキュメント内に **アプリスクリプトを生成** することができ、ドキュメントの **所有者（作成者）がアプリスクリプトの所有者** になります。

{% hint style="warning" %}
これは、編集アクセス権を持つ人がそれに内蔵された任意のアプリスクリプトを作成すると、**ドキュメントの作成者がアプリスクリプトの作成者として表示される** ことを意味します。

これはまた、**アプリスクリプトがドキュメントの作成者の Workspace 環境によって信頼される** ことを意味します。
{% endhint %}

{% hint style="danger" %}
これはまた、**アプリスクリプトが既に存在** しており、人々が **アクセスを許可** している場合、ドキュメントに **編集** 権限を持つ人はそれを **変更してそのアクセスを悪用する** ことができることを意味します。\
これを悪用するには、人々がアプリスクリプトをトリガーする必要があります。そして、一つの巧妙なトリックは、**スクリプトをウェブアプリとして公開する** ことです。アプリスクリプトに **アクセスを許可** した **人々** がウェブページにアクセスすると、**アプリスクリプトをトリガー** します（これは `<img>` タグを使用しても機能します）。
{% endhint %}

## 侵害後の対応

ユーザーの資格情報またはセッションを侵害した場合、ユーザーの潜在的に機密性の高い情報にアクセスし、権限をエスカレートしようとするためにいくつかのアクションを実行できます:

{% content-ref url="gws-post-exploitation.md" %}
[gws-post-exploitation.md](gws-post-exploitation.md)
{% endcontent-ref %}

### GWS <-->GCP ピボット

{% content-ref url="../gcp-security/gcp-to-workspace-pivoting/" %}
[gcp-to-workspace-pivoting](../gcp-security/gcp-to-workspace-pivoting/)
{% endcontent-ref %}

## 持続性

ユーザーの資格情報またはセッションを侵害した場合、それを維持するためのこれらのオプションを確認してください:

{% content-ref url="gws-persistence.md" %}
[gws-persistence.md](gws-persistence.md)
{% endcontent-ref %}

## アカウント侵害回復

* すべてのセッションからログアウトする
* ユーザーパスワードを変更する
* 新しい 2FA バックアップコードを生成する
* アプリパスワードを削除する
* OAuth アプリを削除する
* 2FA デバイスを削除する
* メール転送設定を削除する
* メールフィルターを削除する
* 回復用メール/電話を削除する
* 悪質な Android アプリを削除する
* 悪質なアカウント委任を削除する

## 参考文献

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - G Suite をハッキングする: Dark Apps Script Magic の力
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch and Beau Bullock - OK Google, GSuite のレッドチームはどうやって行うの？

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) で AWS ハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks にあなたの会社を広告したい**、または **HackTricks を PDF でダウンロードしたい** 場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式 PEASS & HackTricks グッズ**](https://peass.creator-spring.com) を入手する
* [**PEASS ファミリー**](https://opensea.io/collection/the-peass-family) を発見する、私たちの独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクション
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) に **参加する** か、[**telegram グループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) を **フォローする**。
* **HackTricks** の GitHub リポジトリ [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) に PR を提出して、あなたのハッキングのコツを共有する。

</details>
