# GWS - Pentesting de Workspace

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Phishing sur les plateformes Google et les applications OAuth

V√©rifiez comment vous pourriez utiliser diff√©rentes plateformes Google telles que Drive, Chat, Groups... pour envoyer √† la victime un lien de phishing et comment effectuer un phishing Google OAuth dans :

{% content-ref url="gws-google-platforms-phishing.md" %}
[gws-google-platforms-phishing.md](gws-google-platforms-phishing.md)
{% endcontent-ref %}

## Password Spraying

Pour tester les mots de passe avec tous les emails que vous avez trouv√©s (ou que vous avez g√©n√©r√©s en vous basant sur un mod√®le de nom d'email que vous pourriez avoir d√©couvert), vous pourriez utiliser un outil comme [**https://github.com/ustayready/CredKing**](https://github.com/ustayready/CredKing) (bien qu'il semble ne plus √™tre maintenu) qui utilisera des lambdas AWS pour changer d'adresse IP.

## App Scripts

Les d√©veloppeurs peuvent cr√©er des App Scripts et les configurer comme un projet autonome ou les lier √† Google Docs/Sheets/Slides/Forms. App Scripts est un code qui sera d√©clench√© lorsqu'un utilisateur avec la permission d'√©diteur acc√®de au document (et apr√®s avoir accept√© l'invite OAuth)

Cependant, m√™me si l'application n'est pas v√©rifi√©e, il existe quelques moyens de ne pas afficher cette invite :

* Si l'√©diteur de l'application est dans le m√™me Workspace que l'utilisateur y acc√©dant
* Si le script est dans un drive de l'utilisateur

### Contournement de l'invite non v√©rifi√©e par copie de document

Lorsque vous cr√©ez un lien pour partager un document, un lien similaire √† celui-ci est cr√©√© : `https://docs.google.com/spreadsheets/d/1i5[...]aIUD/edit`\
Si vous **changez** la fin **"/edit"** par **"/copy"**, au lieu d'y acc√©der, Google vous demandera si vous voulez **g√©n√©rer une copie du document.**

{% hint style="warning" %}
Si quelqu'un cr√©e une **copie** de ce **document** qui **contenait l'App Script**, il copiera √©galement l'App Script, donc lorsqu'il **ouvrira** la feuille de calcul copi√©e, l'**invite OAuth r√©guli√®re** appara√Ætra **en contournant l'invite non v√©rifi√©e**, car **l'utilisateur est maintenant l'auteur de l'App Script du fichier copi√©**.
{% endhint %}

Cette m√©thode pourra √©galement contourner la restriction de l'administrateur Workspace :

Mais peut √™tre emp√™ch√©e avec :

### Contournement de l'invite non v√©rifi√©e par document partag√©

De plus, si quelqu'un **partage** avec vous un document avec **acc√®s √©diteur**, vous pouvez g√©n√©rer **des App Scripts √† l'int√©rieur du document** et le **PROPRI√âTAIRE (cr√©ateur) du document sera le propri√©taire de l'App Script**.

{% hint style="warning" %}
Cela signifie que le **cr√©ateur du document appara√Ætra comme cr√©ateur de tout App Script** que toute personne avec acc√®s √©diteur cr√©e √† l'int√©rieur de celui-ci.

Cela signifie √©galement que l'**App Script sera approuv√© par l'environnement Workspace** du cr√©ateur du document.
{% endhint %}

{% hint style="danger" %}
Cela signifie aussi que si un **App Script existait d√©j√†** et que les gens ont **accord√© l'acc√®s**, toute personne avec la permission **√âditeur** sur le document peut **le modifier et abuser de cet acc√®s.**\
Pour abuser de cela, vous avez √©galement besoin que les gens d√©clenchent l'App Script. Et une astuce int√©ressante est de **publier le script en tant qu'application web**. Lorsque les **personnes** qui ont d√©j√† accord√© **l'acc√®s** √† l'App Script acc√®dent √† la page web, elles **d√©clencheront l'App Script** (cela fonctionne aussi en utilisant des balises `<img>`).
{% endhint %}

## Post-Exploitation

Si vous avez compromis des identifiants ou la session de l'utilisateur, vous pouvez effectuer plusieurs actions pour acc√©der √† des informations potentiellement sensibles de l'utilisateur et essayer d'escalader les privil√®ges :

{% content-ref url="gws-post-exploitation.md" %}
[gws-post-exploitation.md](gws-post-exploitation.md)
{% endcontent-ref %}

### Pivotement GWS <-->GCP

{% content-ref url="../gcp-security/gcp-to-workspace-pivoting/" %}
[gcp-to-workspace-pivoting](../gcp-security/gcp-to-workspace-pivoting/)
{% endcontent-ref %}

## Persistance

Si vous avez compromis des identifiants ou la session de l'utilisateur, v√©rifiez ces options pour maintenir la persistance :

{% content-ref url="gws-persistence.md" %}
[gws-persistence.md](gws-persistence.md)
{% endcontent-ref %}

## R√©cup√©ration de compte compromis

* Se d√©connecter de toutes les sessions
* Changer le mot de passe de l'utilisateur
* G√©n√©rer de nouveaux codes de sauvegarde 2FA
* Supprimer les mots de passe d'application
* Supprimer les applications OAuth
* Supprimer les dispositifs 2FA
* Supprimer les transferts d'email
* Supprimer les filtres d'email
* Supprimer l'email/les t√©l√©phones de r√©cup√©ration
* Supprimer les mauvaises applications Android
* Supprimer les mauvaises d√©l√©gations de compte

## R√©f√©rences

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Piratage de G Suite : Le Pouvoir de la Magie des App Scripts Obscurs
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch et Beau Bullock - OK Google, Comment faire du Red Team sur GSuite ?

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
