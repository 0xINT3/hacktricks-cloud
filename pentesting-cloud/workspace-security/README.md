# GWS - Pentesting no Workspace

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**merchandising oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Phishing em Plataformas Google e Aplicativos OAuth

Verifique como voc√™ pode usar diferentes plataformas Google como Drive, Chat, Groups... para enviar um link de phishing √† v√≠tima e como realizar um Phishing Google OAuth em:

{% content-ref url="gws-google-platforms-phishing.md" %}
[gws-google-platforms-phishing.md](gws-google-platforms-phishing.md)
{% endcontent-ref %}

## Password Spraying

Para testar senhas com todos os emails que voc√™ encontrou (ou que voc√™ gerou baseado em um padr√£o de nome de email que voc√™ pode ter descoberto) voc√™ pode usar uma ferramenta como [**https://github.com/ustayready/CredKing**](https://github.com/ustayready/CredKing) (embora pare√ßa n√£o ser mantida) que usar√° lambdas AWS para mudar o endere√ßo IP.

## App Scripts

Desenvolvedores podem criar App Scripts e configur√°-los como um projeto independente ou vincul√°-los ao Google Docs/Sheets/Slides/Forms. App Scripts √© c√≥digo que ser√° acionado quando um usu√°rio com permiss√£o de editor acessar o documento (e ap√≥s aceitar o prompt OAuth)

No entanto, mesmo que o aplicativo n√£o seja verificado, existem algumas maneiras de n√£o mostrar esse prompt:

* Se o publicador do aplicativo estiver no mesmo Workspace que o usu√°rio acessando-o
* Se o script estiver em um drive do usu√°rio

### Bypass de Prompt N√£o Verificado ao Copiar Documento

Quando voc√™ cria um link para compartilhar um documento, um link semelhante a este √© criado: `https://docs.google.com/spreadsheets/d/1i5[...]aIUD/edit`\
Se voc√™ **mudar** o final **"/edit"** para **"/copy"**, em vez de acess√°-lo, o Google perguntar√° se voc√™ quer **gerar uma c√≥pia do documento.**

{% hint style="warning" %}
Se algu√©m criar uma **c√≥pia** desse **documento** que **continha o App Script**, ele tamb√©m estar√° **copiando o App Script**, portanto, quando ele **abrir** a planilha copiada, o **prompt OAuth regular** aparecer√° **bypassando o prompt n√£o verificado**, porque **o usu√°rio √© agora o autor do App Script do arquivo copiado**.
{% endhint %}

Este m√©todo tamb√©m ser√° capaz de contornar a restri√ß√£o do administrador do Workspace:

Mas pode ser prevenido com:

### Bypass de Prompt N√£o Verificado em Documento Compartilhado

Al√©m disso, se algu√©m **compartilhou** com voc√™ um documento com **acesso de editor**, voc√™ pode gerar **App Scripts dentro do documento** e o **PROPRIET√ÅRIO (criador) do documento ser√° o dono do App Script**.

{% hint style="warning" %}
Isso significa que o **criador do documento aparecer√° como criador de qualquer App Script** que qualquer pessoa com acesso de editor criar dentro dele.

Isso tamb√©m significa que o **App Script ser√° confi√°vel pelo ambiente Workspace** do criador do documento.
{% endhint %}

{% hint style="danger" %}
Isso tamb√©m significa que se um **App Script j√° existia** e as pessoas **concederam acesso**, qualquer pessoa com permiss√£o de **Editor** no documento pode **modific√°-lo e abusar desse acesso.**\
Para abusar disso, voc√™ tamb√©m precisa que as pessoas acionem o App Script. E um truque interessante √© **publicar o script como um aplicativo web**. Quando as **pessoas** que j√° concederam **acesso** ao App Script acessarem a p√°gina web, elas **acionar√£o o App Script** (isso tamb√©m funciona usando tags `<img>`.
{% endhint %}

## P√≥s-Explora√ß√£o

Se voc√™ comprometeu algumas credenciais ou a sess√£o do usu√°rio, voc√™ pode realizar v√°rias a√ß√µes para acessar informa√ß√µes potencialmente sens√≠veis do usu√°rio e tentar escalar privil√©gios:

{% content-ref url="gws-post-exploitation.md" %}
[gws-post-exploitation.md](gws-post-exploitation.md)
{% endcontent-ref %}

### Pivoting GWS <-->GCP

{% content-ref url="../gcp-security/gcp-to-workspace-pivoting/" %}
[gcp-to-workspace-pivoting](../gcp-security/gcp-to-workspace-pivoting/)
{% endcontent-ref %}

## Persist√™ncia

Se voc√™ comprometeu algumas credenciais ou a sess√£o do usu√°rio, verifique estas op√ß√µes para manter a persist√™ncia sobre ela:

{% content-ref url="gws-persistence.md" %}
[gws-persistence.md](gws-persistence.md)
{% endcontent-ref %}

## Recupera√ß√£o de Conta Comprometida

* Sair de todas as sess√µes
* Mudar a senha do usu√°rio
* Gerar novos c√≥digos de backup 2FA
* Remover senhas de aplicativos
* Remover aplicativos OAuth
* Remover dispositivos 2FA
* Remover encaminhadores de email
* Remover filtros de emails
* Remover email/telefones de recupera√ß√£o
* Remover aplicativos Android ruins
* Remover delega√ß√µes de conta ruins

## Refer√™ncias

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch and Beau Bullock - OK Google, How do I Red Team GSuite?

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**merchandising oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
