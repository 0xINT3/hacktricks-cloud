# GWS - Pentesting en Workspace

<details>

<summary><strong>Aprende a hackear AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Phishing en Plataformas de Google y Aplicaciones OAuth

Revisa c√≥mo podr√≠as usar diferentes plataformas de Google como Drive, Chat, Groups... para enviar a la v√≠ctima un enlace de phishing y c√≥mo realizar un Phishing de Google OAuth en:

{% content-ref url="gws-google-platforms-phishing.md" %}
[gws-google-platforms-phishing.md](gws-google-platforms-phishing.md)
{% endcontent-ref %}

## Password Spraying

Para probar contrase√±as con todos los correos que has encontrado (o que has generado bas√°ndote en un patr√≥n de nombre de correo que podr√≠as haber descubierto), podr√≠as usar una herramienta como [**https://github.com/ustayready/CredKing**](https://github.com/ustayready/CredKing) (aunque parece que no se mantiene) que usar√° lambdas de AWS para cambiar la direcci√≥n IP.

## App Scripts

Los desarrolladores pueden crear App Scripts y configurarlos como un proyecto independiente o vincularlos a Google Docs/Sheets/Slides/Forms. App Scripts es c√≥digo que se activar√° cuando un usuario con permiso de editor acceda al documento (y despu√©s de aceptar el aviso de OAuth)

Sin embargo, incluso si la aplicaci√≥n no est√° verificada, hay un par de formas de no mostrar ese aviso:

* Si el publicador de la aplicaci√≥n est√° en el mismo Workspace que el usuario que accede a ella
* Si el script est√° en un drive del usuario

### M√©todo para Evitar el Aviso de Copia de Documento No Verificado

Cuando creas un enlace para compartir un documento se crea un enlace similar a este: `https://docs.google.com/spreadsheets/d/1i5[...]aIUD/edit`\
Si **cambias** el final **"/edit"** por **"/copy"**, en lugar de acceder, Google te preguntar√° si quieres **generar una copia del documento.**

{% hint style="warning" %}
Si alguien crea una **copia** de ese **documento** que **conten√≠a el App Script**, tambi√©n estar√° **copiando el App Script**, por lo tanto, cuando **abra** la hoja de c√°lculo copiada, aparecer√° el **aviso regular de OAuth** **evitando el aviso no verificado**, porque **el usuario es ahora el autor del App Script del archivo copiado**.
{% endhint %}

Este m√©todo tambi√©n podr√° evitar la restricci√≥n del administrador de Workspace:

Pero se puede prevenir con:

### M√©todo para Evitar el Aviso de Documento Compartido No Verificado

Adem√°s, si alguien **comparti√≥** contigo un documento con **acceso de editor**, puedes generar **App Scripts dentro del documento** y el **PROPIETARIO (creador) del documento ser√° el due√±o del App Script**.

{% hint style="warning" %}
Esto significa que el **creador del documento aparecer√° como creador de cualquier App Script** que cualquier persona con acceso de editor cree dentro de √©l.

Esto tambi√©n significa que el **App Script ser√° confiable por el entorno de Workspace** del creador del documento.
{% endhint %}

{% hint style="danger" %}
Esto tambi√©n significa que si un **App Script ya exist√≠a** y la gente ha **concedido acceso**, cualquier persona con permiso de **Editor** en el documento puede **modificarlo y abusar de ese acceso.**\
Para abusar de esto tambi√©n necesitas que la gente active el App Script. Y un truco interesante es **publicar el script como una aplicaci√≥n web**. Cuando la **gente** que ya concedi√≥ **acceso** al App Script acceda a la p√°gina web, **activar√°n el App Script** (esto tambi√©n funciona usando etiquetas `<img>`).
{% endhint %}

## Post-Explotaci√≥n

Si has comprometido algunas credenciales o la sesi√≥n del usuario, puedes realizar varias acciones para acceder a informaci√≥n potencialmente sensible del usuario y tratar de escalar privilegios:

{% content-ref url="gws-post-exploitation.md" %}
[gws-post-exploitation.md](gws-post-exploitation.md)
{% endcontent-ref %}

### Pivoteo entre GWS y GCP

{% content-ref url="../gcp-security/gcp-to-workspace-pivoting/" %}
[gcp-to-workspace-pivoting](../gcp-security/gcp-to-workspace-pivoting/)
{% endcontent-ref %}

## Persistencia

Si has comprometido algunas credenciales o la sesi√≥n del usuario, revisa estas opciones para mantener la persistencia sobre ella:

{% content-ref url="gws-persistence.md" %}
[gws-persistence.md](gws-persistence.md)
{% endcontent-ref %}

## Recuperaci√≥n de Cuenta Comprometida

* Cerrar sesi√≥n en todas las sesiones
* Cambiar la contrase√±a del usuario
* Generar nuevos c√≥digos de respaldo para 2FA
* Eliminar contrase√±as de App
* Eliminar aplicaciones OAuth
* Eliminar dispositivos de 2FA
* Eliminar reenviadores de correo
* Eliminar filtros de correo
* Eliminar correos/telefonos de recuperaci√≥n
* Eliminar malas aplicaciones de Android
* Eliminar malas delegaciones de cuenta

## Referencias

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch and Beau Bullock - OK Google, How do I Red Team GSuite?

<details>

<summary><strong>Aprende a hackear AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
