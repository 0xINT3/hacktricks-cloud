# GWS - Workspace 渗透测试

<details>

<summary><strong>从零开始学习 AWS 黑客攻击成为英雄</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 HackTricks 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>

## Google 平台和 OAuth 应用程序钓鱼

查看您如何使用不同的 Google 平台，例如 Drive、Chat、Groups... 向受害者发送钓鱼链接，以及如何执行 Google OAuth 钓鱼：

{% content-ref url="gws-google-platforms-phishing.md" %}
[gws-google-platforms-phishing.md](gws-google-platforms-phishing.md)
{% endcontent-ref %}

## 密码喷涂

为了测试您找到的（或您根据可能发现的电子邮件名称模式生成的）所有电子邮件的密码，您可以使用像 [**https://github.com/ustayready/CredKing**](https://github.com/ustayready/CredKing) 这样的工具（尽管它看起来没有维护），它将使用 AWS lambdas 更改 IP 地址。

## 应用程序脚本

开发人员可以创建应用程序脚本，并将其设置为独立项目或绑定到 Google Docs/Sheets/Slides/Forms。应用程序脚本是当具有编辑权限的用户访问文档时（并在接受 OAuth 提示后）将触发的代码。

然而，即使应用程序未经验证，也有几种方法可以不显示该提示：

* 如果应用程序的发布者与访问它的用户在同一个 Workspace 中
* 如果脚本在用户的驱动器中

### 复制文档未验证提示绕过

当您创建一个共享文档的链接时，会创建类似这样的链接：`https://docs.google.com/spreadsheets/d/1i5[...]aIUD/edit`\
如果您**更改**结尾的 **"/edit"** 为 **"/copy"**，Google 将询问您是否要**生成文档的副本**，而不是访问它。

{% hint style="warning" %}
如果有人**复制**了**包含应用程序脚本**的**文档**，他也将**复制应用程序脚本**，因此当他**打开**复制的**电子表格**时，**常规的 OAuth 提示**将出现，**绕过未验证的提示**，因为**用户现在是复制文件的应用程序脚本的作者**。
{% endhint %}

这种方法也能绕过 Workspace 管理员限制：

但可以通过以下方式预防：

### 共享文档未验证提示绕过

此外，如果有人与您**共享**了具有**编辑权限**的文档，您可以在文档内生成**应用程序脚本**，并且**文档的所有者（创建者）将成为应用程序脚本的所有者**。

{% hint style="warning" %}
这意味着，文档的**创建者将出现为任何有编辑权限的人在其中创建的任何应用程序脚本的创建者**。

这也意味着**应用程序脚本将被文档创建者的 Workspace 环境信任**。
{% endhint %}

{% hint style="danger" %}
这也意味着，如果一个**应用程序脚本已经存在**并且人们已经**授予访问权限**，任何拥有文档**编辑**权限的人都可以**修改它并滥用该访问权限**。\
要滥用这一点，您还需要人们触发应用程序脚本。一个巧妙的技巧是将脚本**发布为网络应用程序**。当已经授予对应用程序脚本访问权限的**人们**访问网页时，他们将**触发应用程序脚本**（使用 `<img>` 标签也有效）。
{% endhint %}

## 事后利用

如果您已经窃取了一些凭据或用户的会话，您可以执行几项操作来访问用户的潜在敏感信息并尝试提升权限：

{% content-ref url="gws-post-exploitation.md" %}
[gws-post-exploitation.md](gws-post-exploitation.md)
{% endcontent-ref %}

### GWS <-->GCP 旁路

{% content-ref url="../gcp-security/gcp-to-workspace-pivoting/" %}
[gcp-to-workspace-pivoting](../gcp-security/gcp-to-workspace-pivoting/)
{% endcontent-ref %}

## 持久性

如果您已经窃取了一些凭据或用户的会话，请检查这些选项以保持对它的持久性：

{% content-ref url="gws-persistence.md" %}
[gws-persistence.md](gws-persistence.md)
{% endcontent-ref %}

## 账户被盗恢复

* 注销所有会话
* 更改用户密码
* 生成新的 2FA 备份代码
* 删除应用程序密码
* 删除 OAuth 应用程序
* 删除 2FA 设备
* 删除电子邮件转发器
* 删除电子邮件过滤器
* 删除恢复电子邮件/电话
* 删除不良 Android 应用程序
* 删除不良账户委托

## 参考资料

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - 黑客攻击 G Suite：暗黑 Apps Script 魔法的力量
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch 和 Beau Bullock - OK Google，我如何红队 GSuite？

<details>

<summary><strong>从零开始学习 AWS 黑客攻击成为英雄</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 HackTricks 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>
