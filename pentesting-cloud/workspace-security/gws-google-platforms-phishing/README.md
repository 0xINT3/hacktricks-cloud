# GWS - Google Platforms Phishing

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien jou **maatskappy geadverteer in HackTricks** of **HackTricks aflaai in PDF-formaat** Kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** my op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Generiese Phishing Metodologie

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Google Groups Phishing

Blykbaar kan lede in Workspace [**groepe skep**](https://groups.google.com/all-groups) **en mense uitnooi** om by hulle aan te sluit. Jy kan dan die e-pos wysig wat na die gebruiker gestuur sal word **deur 'n paar skakels by te voeg.** Die **e-pos sal van 'n Google-adres afkomstig wees**, so dit sal **geldig lyk** en mense mag op die skakel klik.

Dit is ook moontlik om die **VAN**-adres as die **Google-groepse-posadres** in te stel om **meer e-posse na die gebruikers binne die groep** te stuur, soos in die volgende prentjie waar die groep **`google--support@googlegroups.com`** geskep is en 'n **e-pos na al die lede** van die groep gestuur is (wat sonder enige toestemming bygevoeg is)

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Google Chat Phishing

Jy kan dalk 'n **gesprek begin** met 'n persoon deur net hul e-posadres te h√™ of 'n **uitnodiging stuur** om te gesels. Verder is dit moontlik om 'n **Spasie te skep** wat enige naam kan h√™ (bv. "Google-ondersteuning") en **lede** daarvoor **uit te nooi**. As hulle dit aanvaar, mag hulle dink dat hulle met Google-ondersteuning praat:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**In my toetsing het die uitgenooide lede egter nie eers 'n uitnodiging ontvang nie.**
{% endhint %}

Jy kan sien hoe dit in die verlede gewerk het by: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Google Doc Phishing

In die verlede was dit moontlik om 'n **skynbaar geldige dokument** te skep en in 'n kommentaar **'n e-pos te noem (soos @user@gmail.com)**. Google **het 'n e-pos na daardie e-posadres gestuur** om te laat weet dat hulle in die dokument genoem is.\
Tans werk dit nie, maar as jy die slagoffer e-pos toegang tot die dokument gee nie, sal Google 'n e-pos stuur om dit aan te dui. Dit is die boodskap wat verskyn wanneer jy iemand noem:

<figure><img src="../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Slagoffers mag 'n beskermingsmeganisme h√™ wat nie toelaat dat e-posse wat aandui dat 'n eksterne dokument met hulle gedeel is, hul e-pos bereik nie.
{% endhint %}

## Google Calendar Phishing

Jy kan 'n **kalendergebeurtenis skep** en soveel e-posadresse van die maatskappy wat jy aanval het, byvoeg as wat jy het. Skeduleer hierdie kalendergebeurtenis in **5 of 15 minute** vanaf die huidige tyd. Maak die gebeurtenis geldig en **plaas 'n kommentaar en 'n titel wat aandui dat hulle iets moet lees** (met die **phishing-skakel**).

Dit is die waarskuwing wat in die blaaier sal verskyn met 'n vergaderingstitel "Firing People", so jy kan 'n meer phishingagtige titel instel (en selfs die naam wat met jou e-pos geassosieer word, verander).

<figure><img src="../../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Om dit minder verdag te laat lyk:

* Stel dit so in dat **ontvangers nie die ander uitgenooide mense kan sien nie**
* **Stuur GEEN e-posse wat die gebeurtenis aandui nie**. Dan sal die mense slegs hul waarskuwing sien oor 'n vergadering in 5 minute en dat hulle daardie skakel moet lees.
* Blykbaar kan jy met die API instel dat **mense** die gebeurtenis **aanvaar** het en selfs **kommentaar namens hulle skep**.

## App Scripts Redirect Phishing

Dit is moontlik om 'n skripsie te skep in [https://script.google.com/](https://script.google.com/) en dit **bloot te stel as 'n webtoepassing wat deur almal toeganklik is** en wat die geldige domein **`script.google.com`** gebruik.  \
Met 'n bietjie kode soos die volgende kan 'n aanvaller die skripsie laai met willekeurige inhoud op hierdie bladsy sonder om die toegang tot die domein te stop:

{% code overflow="wrap" %}
```javascript
function doGet() {
return HtmlService.createHtmlOutput('<meta http-equiv="refresh" content="0;url=https://cloud.hacktricks.xyz/pentesting-cloud/workspace-security/gws-google-platforms-phishing#app-scripts-redirect-phishing">')
.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```
{% endcode %}

Byvoorbeeld, as jy [https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec](https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec) toegang gee, sal jy sien:

<figure><img src="../../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Let daarop dat 'n waarskuwing sal verskyn omdat die inhoud binne 'n iframe gelaai word.
{% endhint %}

## App Scripts OAuth Phishing

Dit is moontlik om App Scripts aan dokumente te heg om toegang tot 'n slagoffer se OAuth-token te probeer kry. Vir meer inligting, kyk:

{% content-ref url="gws-app-scripts.md" %}
[gws-app-scripts.md](gws-app-scripts.md)
{% endcontent-ref %}

## OAuth Apps Phishing

Enige van die vorige tegnieke kan gebruik word om die gebruiker te laat toegang verkry tot 'n **Google OAuth-toepassing** wat die gebruiker **toegang** sal **vereis**. As die gebruiker die **bron** **vertrou**, kan hy die **toepassing** **vertrou** (selfs as dit ho√´ bevoorregte toestemmings vra).

{% hint style="info" %}
Let daarop dat Google 'n lelike waarskuwing wys wat aandui dat die toepassing onbetroubaar is in verskeie gevalle en dat Workspace-administrateurs selfs kan voorkom dat mense OAuth-toepassings aanvaar.
{% endhint %}

**Google** maak dit moontlik om toepassings te skep wat namens gebruikers kan **interaksie h√™ met verskeie Google-diens**: Gmail, Drive, GCP...

Wanneer 'n toepassing geskep word om **namens ander gebruikers op te tree**, moet die ontwikkelaar 'n **OAuth-toepassing binne GCP** skep en die scopes (toestemmings) aandui wat die toepassing nodig het om toegang tot die gebruikersdata te verkry.\
Wanneer 'n **gebruiker** daardie **toepassing** wil **gebruik**, sal hulle **gevra word** om **te aanvaar** dat die toepassing toegang tot hul data sal h√™ soos gespesifiseer in die scopes.

Dit is 'n baie aantreklike manier om nie-tegniese gebruikers te **phish** om **toepassings wat sensitiewe inligting toegang** verkry, te gebruik omdat hulle dalk nie die gevolge verstaan nie. Daar is egter maniere om dit in organisasie-rekeninge te voorkom.

### Onbevestigde toepassing-waarskuwing

Soos genoem, sal Google altyd 'n **waarskuwing aan die gebruiker wys om die toestemmings te aanvaar** wat hulle namens die toepassing gee. As die toepassing egter as **gevaarlik** beskou word, sal Google **eerstens** 'n **waarskuwing** wys wat aandui dat dit **gevaarlik** is en dit **moeilik maak** vir die gebruiker om die toestemmings aan die toepassing te verleen.

Hierdie waarskuwing verskyn in toepassings wat:

* Enige scope gebruik wat privaat data kan ontsluit (Gmail, Drive, GCP, BigQuery...)
* Toepassings met minder as 100 gebruikers (toepassings > 100 vereis ook 'n hersieningsproses om die onbevestigde waarskuwing te stop)

### Interessante Scopes

[**Hier**](https://developers.google.com/identity/protocols/oauth2/scopes) kan jy 'n lys van al die Google OAuth-scopes vind.

* **cloud-platform**: Sien en bestuur jou data oor **Google Cloud Platform**-dienste. Jy kan die gebruiker in GCP voorstel.
* **admin.directory.user.readonly**: Sien en laai jou organisasie se GSuite-gids af. Kry name, telefoonnommers, kalender-URL's van al die gebruikers.

### Skep 'n OAuth-toepassing

**Begin deur 'n OAuth Client ID te skep**

1. Gaan na [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) en klik op die konfigureer die toestemmingskerm.
2. Dan sal jy gevra word of die **gebruikertipe** **intern** is (slegs vir mense in jou organisasie) of **ekstern**. Kies die een wat by jou behoeftes pas
* Intern mag interessant wees as jy reeds 'n gebruiker van die organisasie gekompromitteer het en jy hierdie toepassing skep om 'n ander een te phish.
3. Gee 'n **naam** aan die toepassing, 'n **ondersteunings-e-pos** (let daarop dat jy 'n googlegroup-e-pos kan instel om jouself bietjie meer anoniem te maak), 'n **logo**, **geoorloofde domeine** en 'n ander **e-pos** vir **opdaterings**.
4. **Kies** die **OAuth-scopes**.
* Hierdie bladsy is verdeel in nie-sensitiewe toestemmings, sensitiewe toestemmings en beperkte toestemmings. Elke keer as jy 'n nuwe toestemming byvoeg, word dit by sy kategorie gevoeg. Afhangende van die gevraagde toestemmings, sal verskillende waarskuwings aan die gebruiker verskyn wat aandui hoe sensitief hierdie toestemmings is.
* Beide **`admin.directory.user.readonly`** en **`cloud-platform`** is sensitiewe toestemmings.
5. **Voeg die toetsgebruikers by.** Solank die status van die toepassing toetsing is, sal slegs hierdie gebruikers toegang tot die toepassing h√™, so maak seker dat jy die e-pos wat jy gaan phish, byvoeg.

Nou gaan ons **legitimasie vir 'n webtoepassing kry** deur die **voorheen geskepte OAuth Client ID** te gebruik:

1. Gaan terug na [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient), 'n ander opsie sal hierdie keer verskyn.
2. Kies om **legitimasie vir 'n webtoepassing te skep**
3. Stel die nodige **Javascript-oorspronge** en **omleidings-URI's** in
* Jy kan in beide iets soos **`http://localhost:8000/callback`** vir toetsing instel
4. Kry jou toepassing se **legitimasie**

Laastens, laat ons 'n **webtoepassing uitvoer wat die OAuth-toepassingslegitimasie** sal gebruik. Jy kan 'n voorbeeld vind by [https://github.com/carlospolop/gcp\_oauth\_phishing\_example](https://github.com/carlospolop/gcp\_oauth\_phishing\_example).
```bash
git clone ttps://github.com/carlospolop/gcp_oauth_phishing_example
cd gcp_oauth_phishing_example
pip install flask requests google-auth-oauthlib
python3 app.py --client-id "<client_id>" --client-secret "<client_secret>"
```
Gaan na **`http://localhost:8000`** en klik op die Aanmeld met Google-knoppie, jy sal **genooi** word met 'n boodskap soos hierdie:

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

Die aansoek sal die **toegangs- en verfrissingsleutel** wys wat maklik gebruik kan word. Vir meer inligting oor **hoe om hierdie sleutels te gebruik, kyk**:

{% content-ref url="../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

#### Gebruik `glcoud`

Dit is moontlik om iets te doen met behulp van gcloud in plaas van die webkonsol, kyk:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md" %}
[gcp-clientauthconfig-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md)
{% endcontent-ref %}

## Verwysings

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch en Beau Bullock - OK Google, How do I Red Team GSuite?

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** my op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>
