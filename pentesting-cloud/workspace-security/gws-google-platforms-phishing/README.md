# GWS - Google Platforme Ribarenje

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** me na **Twitteru** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Generička Metodologija Ribarenja

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Google Grupno Ribarenje

Izgleda da, prema podrazumevanim podešavanjima, u workspace-u članovi **mogu kreirati grupe** i **pozivati ljude u njih**. Zatim možete izmeniti email koji će biti poslat korisniku **dodavanjem nekih linkova**. **Email će doći sa google adrese**, pa će izgledati **legitimno** i ljudi bi mogli kliknuti na link.

Takođe je moguće postaviti **FROM** adresu kao **Google grupnu email** da bi se poslalo **više emailova korisnicima unutar grupe**, kao na sledećoj slici gde je grupa **`google--support@googlegroups.com`** kreirana i **email je poslat svim članovima** grupe (koji su dodati bez ikakvog pristanka)

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Google Chat Ribarenje

Možda ćete moći ili **zapoceti chat** sa osobom samo imajući njihovu email adresu ili poslati **poziv za razgovor**. Osim toga, moguće je **kreirati Prostor** koji može imati bilo koje ime (npr. "Google Podrška") i **pozvati** članove u njega. Ako prihvate, mogu pomisliti da razgovaraju sa Google podrškom:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**Međutim, u mom testiranju pozvani članovi čak nisu dobili pozivnicu.**
{% endhint %}

Možete proveriti kako je ovo funkcionisalo u prošlosti na: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Google Doc Ribarenje

Ranije je bilo moguće kreirati **navodno legitimni dokument** i onda u komentaru **pomenuti neki email (kao @korisnik@gmail.com)**. Google bi **poslao email na tu email adresu** obaveštavajući ih da su pomenuti u dokumentu.\
Danas ovo ne funkcioniše, ali ako **date pristup žrtvi emailu dokumentu** Google će poslati email koji to pokazuje. Ovo je poruka koja se pojavi kada nekoga pomenete:

<figure><img src="../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Žrtve mogu imati mehanizam zaštite koji ne dozvoljava da emailovi koji ukazuju da je spoljni dokument podeljen sa njima stignu na njihov email.
{% endhint %}

## Google Kalendar Ribarenje

Možete **kreirati događaj u kalendaru** i dodati koliko god email adresa kompanije koju napadate imate. Zakazati ovaj događaj u **5 ili 15 min** od trenutnog vremena. Učiniti da događaj izgleda legitimno i **dodati komentar i naslov koji ukazuju da treba da pročitaju nešto** (sa **phishing linkom**).

Ovo je upozorenje koje će se pojaviti u pretraživaču sa naslovom sastanka "Otpuštanje ljudi", pa možete postaviti naslov koji više podseća na ribarenje (čak i promeniti ime povezano sa vašim emailom).

<figure><img src="../../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Da izgleda manje sumnjivo:

* Podesite tako da **primaoci ne mogu videti druge pozvane ljude**
* **NE šaljite emailove obaveštavajući o događaju**. Tada će ljudi videti samo upozorenje o sastanku za 5 minuta i da treba da pročitaju taj link.
* Navodno, korišćenjem API-ja možete postaviti da **ljudi** su **prihvatili** događaj i čak kreirati **komentare u njihovo ime**.

## Skripte Aplikacija Preusmeravanje Ribarenje

Moguće je kreirati skriptu na [https://script.google.com/](https://script.google.com/) i **izložiti je kao web aplikaciju dostupnu svima** koja će koristiti legitimnu domenu **`script.google.com`**.  \
Zatim, sa nekim kodom poput sledećeg, napadač može napraviti skriptu koja će učitati proizvoljan sadržaj na ovoj stranici bez prestanka pristupa domenu:

{% code overflow="wrap" %}
```javascript
function doGet() {
return HtmlService.createHtmlOutput('<meta http-equiv="refresh" content="0;url=https://cloud.hacktricks.xyz/pentesting-cloud/workspace-security/gws-google-platforms-phishing#app-scripts-redirect-phishing">')
.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```
{% endcode %}

Na primer, pristupanjem [https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec](https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec) videćete:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Imajte na umu da će se upozorenje pojaviti jer se sadržaj učitava unutar iframe-a.
{% endhint %}

## App Scripts OAuth Phishing

Moguće je kreirati App Scripts povezane sa dokumentima kako bi se pokušalo dobiti pristup žrtvinom OAuth token-u, za više informacija pogledajte:

{% content-ref url="gws-app-scripts.md" %}
[gws-app-scripts.md](gws-app-scripts.md)
{% endcontent-ref %}

## OAuth Aplikacije Phishing

Bilo koja od prethodnih tehnika može se koristiti kako bi se korisnik naterao da pristupi **Google OAuth aplikaciji** koja će zatražiti od korisnika neki **pristup**. Ako korisnik **veruje** **izvoru**, može **verovati** **aplikaciji** (čak i ako traži visoko privilegovane dozvole).

{% hint style="info" %}
Imajte na umu da Google prikazuje ružno upozorenje koje upozorava da aplikacija nije pouzdana u nekoliko slučajeva, a administratori Workspace-a čak mogu sprečiti ljude da prihvate OAuth aplikacije.
{% endhint %}

**Google** omogućava kreiranje aplikacija koje mogu **interagovati u ime korisnika** sa različitim **Google uslugama**: Gmail, Drive, GCP...

Prilikom kreiranja aplikacije da **deluje u ime drugih korisnika**, programer mora kreirati **OAuth aplikaciju unutar GCP-a** i naznačiti opsege (dozvole) koje aplikacija treba da ima pristup podacima korisnika.\
Kada **korisnik** želi da **koristi** tu **aplikaciju**, biće im **zatraženo** da **prihvate** da će aplikacija imati pristup njihovim podacima navedenim u opsezima.

Ovo je veoma primamljiv način da se **fisira** korisnike koji nisu tehnički pismeni da koriste **aplikacije koje pristupaju osetljivim informacijama** jer možda ne razumeju posledice. Međutim, u organizacijama postoje načini da se spreči da se ovo dogodi.

### Upit za neproverenu aplikaciju

Kao što je pomenuto, Google će uvek prikazati **upit korisniku da prihvati** dozvole koje daju aplikaciji u njihovo ime. Međutim, ako se smatra da je aplikacija **opasna**, Google će prvo prikazati **upit** koji ukazuje da je **opasna** i **čini teže** korisniku da odobri dozvole aplikaciji.

Ovaj upit se pojavljuje u aplikacijama koje:

* Koriste bilo koji opseg koji može pristupiti privatnim podacima (Gmail, Drive, GCP, BigQuery...)
* Aplikacije sa manje od 100 korisnika (aplikacije sa više od 100 korisnika zahtevaju i proces pregleda kako bi se prestalo sa prikazivanjem upita za neproverenu aplikaciju)

### Zanimljivi Opsezi

[**Ovde**](https://developers.google.com/identity/protocols/oauth2/scopes) možete pronaći listu svih Google OAuth opsega.

* **cloud-platform**: Pregledajte i upravljajte svojim podacima preko **Google Cloud Platform** usluga. Možete se predstavljati kao korisnik u GCP-u.
* **admin.directory.user.readonly**: Pogledajte i preuzmite direktorijum GSuite organizacije. Dobijte imena, telefone, URL-ove kalendara svih korisnika.

### Kreiranje OAuth Aplikacije

**Započnite kreiranje OAuth Client ID-a**

1. Idite na [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) i kliknite na konfigurišite ekran saglasnosti.
2. Zatim će vam biti postavljeno pitanje da li je **tip korisnika** **interni** (samo za ljude u vašoj organizaciji) ili **eksterni**. Izaberite onaj koji odgovara vašim potrebama
* Interni može biti interesantan ako ste već kompromitovali korisnika organizacije i kreirate ovu aplikaciju da biste fislali drugog.
3. Dajte **ime** aplikaciji, **podršku putem e-pošte** (imajte na umu da možete postaviti googlegroup e-poštu da biste pokušali da se malo više anonimizujete), **logo**, **ovlašćene domene** i još jednu **e-poštu** za **ažuriranja**.
4. **Izaberite** **OAuth opsege**.
* Ova stranica je podeljena na neosetljive dozvole, osetljive dozvole i ograničene dozvole. Svaki put kada dodate novu dozvolu, dodaje se u svoju kategoriju. Zavisno od zahtevanih dozvola, korisniku će se pojaviti različiti upiti koji ukazuju na to koliko su osetljive te dozvole.
* Obe **`admin.directory.user.readonly`** i **`cloud-platform`** su osetljive dozvole.
5. **Dodajte test korisnike.** Dok je status aplikacije u testiranju, samo ovi korisnici će moći da pristupe aplikaciji, pa se pobrinite da **dodate e-poštu koju ćete fisliti**.

Sada da dobijemo **poverilačke podatke za veb aplikaciju** koristeći **prethodno kreirani OAuth Client ID**:

1. Vratite se na [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient), ovog puta će se pojaviti drugačija opcija.
2. Izaberite da **kreirate poverilačke podatke za veb aplikaciju**
3. Postavite potrebne **Javascript origin-e** i **preusmerene URI-je**
* Možete postaviti u oba nešto poput **`http://localhost:8000/callback`** za testiranje
4. Dobijte poverilačke podatke za vašu aplikaciju

Na kraju, **pokrenimo veb aplikaciju koja će koristiti poverilačke podatke OAuth aplikacije**. Primer možete pronaći na [https://github.com/carlospolop/gcp\_oauth\_phishing\_example](https://github.com/carlospolop/gcp\_oauth\_phishing\_example).
```bash
git clone ttps://github.com/carlospolop/gcp_oauth_phishing_example
cd gcp_oauth_phishing_example
pip install flask requests google-auth-oauthlib
python3 app.py --client-id "<client_id>" --client-secret "<client_secret>"
```
Idite na **`http://localhost:8000`** kliknite na dugme Prijavi se sa Google-om, bićete **upitani** sa porukom poput ove:

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

Aplikacija će prikazati **pristupni i osvežavajući token** koji se lako može koristiti. Za više informacija o **kako koristiti ove tokene pogledajte**:

{% content-ref url="../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

#### Korišćenje `gcloud`

Moguće je nešto uraditi korišćenjem gcloud umesto web konzole, proverite:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md" %}
[gcp-clientauthconfig-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md)
{% endcontent-ref %}

## Reference

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hakovanje G Suite: Moć Dark Apps Script Magije
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch i Beau Bullock - OK Google, Kako da Red Timujem GSuite?

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** me na **Twitteru** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
