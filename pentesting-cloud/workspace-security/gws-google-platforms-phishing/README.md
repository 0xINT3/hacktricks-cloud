# GWS - Απάτη σε Πλατφόρμες της Google

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Γενική Μεθοδολογία Απάτης

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Απάτη στα Google Groups

Φαίνεται ότι από προεπιλογή, στα μέλη του workspace [**μπορούν να δημιουργήσουν ομάδες**](https://groups.google.com/all-groups) **και να προσκαλέσουν ανθρώπους σε αυτές**. Στη συνέχεια, μπορείτε να τροποποιήσετε το email που θα σταλεί στον χρήστη **προσθέτοντας μερικούς συνδέσμους**. Το **email θα προέρχεται από μια διεύθυνση της Google**, οπότε θα φαίνεται **αξιόπιστο** και οι άνθρωποι μπορεί να κάνουν κλικ στον σύνδεσμο.

Είναι επίσης δυνατό να ορίσετε τη διεύθυνση **FROM** ως το **email της ομάδας της Google** για να στείλετε **περισσότερα emails στα μέλη της ομάδας**, όπως στην παρακάτω εικόνα όπου δημιουργήθηκε η ομάδα **`google--support@googlegroups.com`** και στάλθηκε ένα **email σε όλα τα μέλη** της ομάδας (που προστέθηκαν χωρίς καμία συναίνεση)

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Απάτη στο Google Chat

Μπορείτε είτε να **ξεκινήσετε μια συνομιλία** με ένα άτομο απλά έχοντας τη διεύθυνση email τους, είτε να στείλετε μια **πρόσκληση για συνομιλία**. Επιπλέον, είναι δυνατό να **δημιουργήσετε έναν χώρο** που μπορεί να έχει οποιοδήποτε όνομα (π.χ. "Υποστήριξη Google") και να **προσκαλέσετε** μέλη σε αυτόν. Εάν το αποδεχτούν, μπορεί να νομίζουν ότι συνομιλούν με την Υποστήριξη της Google:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**Ωστόσο, στις δοκιμές μου, τα μέλη που προσκλήθηκαν δεν έλαβαν καν πρόσκληση.**
{% endhint %}

Μπορείτε να ελέγξετε πώς λειτούσε αυτό στο παρελθόν στο: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Απάτη στο Google Doc

Στο παρελθόν ήταν δυνατό να δημιουργήσετε ένα **φαινομενικά νόμιμο έγγραφο** και σε ένα σχόλιο **να αναφέρετε κάποιο email (όπως @user@gmail.com)**. Η Google **έστελνε ένα email σε αυτήν τη διεύθυνση email** ειδοποιώντας ότι αναφέρθηκαν στο έγγραφο.\
Σήμερα, αυτό δεν λειτουργεί, αλλά εάν **δώσετε πρόσβαση στο έγγραφο στο θύμα** η Google θα στείλει ένα email που το αναφέρει. Αυτό είναι το μήνυμα που εμφανίζεται όταν αναφέρετε κάποιον:

<figure><img src="../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Τα θύματα μπορεί να έχουν μηχανισμό προστασίας που δεν επιτρέπει την αποστολή email που υποδηλώνει ότι ένα εξωτερικό έγγραφο κοινοποιήθηκε με αυτούς στο email τους.
{% endhint %}

## Απάτη στο Google Calendar

Μπορείτε να **δημιουργήσετε ένα γεγονός στο ημερολόγιο** και να προσθέσετε όσες διευθύνσεις email της εταιρείας που επιτίθεστε θέλετε. Προγραμματίστε αυτό το γεγονός στα **5 ή 15 λεπτά** από την τρέχουσα ώρα. Κάντε το γεγονός να φαίνεται αξιόπιστο και **βάλτε ένα σχόλιο και έναν τίτλο που υποδηλώνει ότι πρέπει να διαβάσουν κάτι** (με τον **σύνδεσμο
```javascript
function doGet() {
return HtmlService.createHtmlOutput('<meta http-equiv="refresh" content="0;url=https://cloud.hacktricks.xyz/pentesting-cloud/workspace-security/gws-google-platforms-phishing#app-scripts-redirect-phishing">')
.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```
{% endcode %}

Για παράδειγμα, αν έχετε πρόσβαση στο [https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec](https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec), θα δείτε:

<figure><img src="../../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Σημειώστε ότι θα εμφανιστεί ένα προειδοποιητικό μήνυμα καθώς το περιεχόμενο φορτώνεται μέσα σε ένα iframe.
{% endhint %}

## Απάτη με το App Scripts OAuth

Είναι δυνατόν να δημιουργηθούν App Scripts που συνδέονται με έγγραφα για να προσπαθήσουν να αποκτήσουν πρόσβαση στο OAuth τοκέν ενός θύματος, για περισσότερες πληροφορίες δείτε:

{% content-ref url="gws-app-scripts.md" %}
[gws-app-scripts.md](gws-app-scripts.md)
{% endcontent-ref %}

## Απάτη με OAuth Apps

Οποιαδήποτε από τις προηγούμενες τεχνικές μπορεί να χρησιμοποιηθεί για να κάνει τον χρήστη να έχει πρόσβαση σε μια **εφαρμογή Google OAuth** που θα ζητήσει από τον χρήστη κάποια πρόσβαση. Αν ο χρήστης εμπιστεύεται την πηγή, μπορεί να εμπιστευτεί και την εφαρμογή (ακόμα κι αν ζητάει προνομιακές άδειες).

{% hint style="info" %}
Σημειώστε ότι η Google παρουσιάζει ένα άσχημο προειδοποιητικό μήνυμα που ρωτάει αν η εφαρμογή είναι μη αξιόπιστη σε πολλές περιπτώσεις και οι διαχειριστές του Workspace μπορούν ακόμα και να εμποδίσουν τους ανθρώπους να αποδεχτούν τις εφαρμογές OAuth.
{% endhint %}

Η Google επιτρέπει τη δημιουργία εφαρμογών που μπορούν να αλληλεπιδρούν εξ ονόματος των χρηστών με πολλές υπηρεσίες της Google: Gmail, Drive, GCP...

Όταν δημιουργείτε μια εφαρμογή για να λειτουργήσει εξ ονόματος άλλων χρηστών, ο προγραμματιστής πρέπει να δημιουργήσει μια εφαρμογή OAuth μέσα στο GCP και να υποδείξει τις εμβέλειες (άδειες) που η εφαρμογή χρειάζεται για να έχει πρόσβαση στα δεδομένα των χρηστών.\
Όταν ένας χρήστης θέλει να χρησιμοποιήσει αυτήν την εφαρμογή, θα του ζητηθεί να αποδεχτεί ότι η εφαρμογή θα έχει πρόσβαση στα δεδομένα του που έχουν καθοριστεί στις εμβέλειες.

Αυτός είναι ένας πολύ ελκυστικός τρόπος για να παραπλανήσετε μη τεχνικούς χρήστες να χρησιμοποιήσουν εφαρμογές που έχουν πρόσβαση σε ευαίσθητες πληροφορίες, επειδή μπορεί να μην κατανοήσουν τις συνέπειες. Ωστόσο, στους λογαριασμούς των οργανισμών, υπάρχουν τρόποι για να αποτραπεί αυτό.

### Προειδοποίηση μη αξιόπιστης εφαρμογής

Όπως αναφέρθηκε, η Google θα εμφανίσει πάντα ένα προειδοποιητικό μήνυμα στον χρήστη για να αποδεχτεί τις άδειες που δίνει στην εφαρμογή εξ ονόματος του. Ωστόσο, αν η εφαρμογή θεωρείται επικίνδυνη, η Google θα εμφανίσει πρώτα ένα προειδοποιητικό μήνυμα που υποδεικνύει ότι είναι επικίνδυνη και καθιστά πιο δύσκολο για τον χρήστη να χορηγήσει τις άδειες στην εφαρμογή.

Αυτό το προειδοποιητικό εμφανίζεται σε εφαρμογές που:

* Χρησιμοποιούν οποιαδήποτε εμβέλεια που μπορεί να έχει πρόσβαση σε ιδιωτικά δεδομένα (Gmail, Drive, GCP, BigQuery...)
* Εφαρμογές με λιγότερους από 100 χρήστες (για εφαρμογές > 100 απαιτείται επίσης διαδικασία αξιολόγησης για να σταματήσει η εμφάνιση του μη αξιόπιστου προειδοποιητικού)

### Ενδιαφέρουσες εμβέλειες

[**Εδώ**](https://developers.google.com/identity/protocols/oauth2/scopes) μπορείτε να βρείτε μια λίστα με όλες τις εμβέλειες του Google OAuth.

* **cloud-platform**: Προβολή και διαχείριση των δεδομένων σας σε όλες τις υπηρεσίες του **Google Cloud Platform**. Μπορείτε να προσωποποιήσετε τον χρήστη στο GCP.
* **admin.directory.user.readonly**: Δείτε και κατεβάστε τον κατάλογο GSuite του οργανισμού σας. Πάρτε ονόματα, τηλέφωνα, URL ημερολογίου όλων των χρηστών.

### Δημιουργία μιας εφαρμογής OAuth

**Ξεκινήστ
```bash
git clone ttps://github.com/carlospolop/gcp_oauth_phishing_example
cd gcp_oauth_phishing_example
pip install flask requests google-auth-oauthlib
python3 app.py --client-id "<client_id>" --client-secret "<client_secret>"
```
Πηγαίνετε στο **`http://localhost:8000`**, κάντε κλικ στο κουμπί Σύνδεση με το Google, θα σας ζητηθεί ένα μήνυμα όπως αυτό:

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

Η εφαρμογή θα εμφανίσει το **access και το refresh token** που μπορούν να χρησιμοποιηθούν εύκολα. Για περισσότερες πληροφορίες σχετικά με **πώς να χρησιμοποιήσετε αυτά τα tokens**, ανατρέξτε στο:

{% content-ref url="../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

#### Χρησιμοποιώντας το `glcoud`

Είναι δυνατόν να γίνει κάτι χρησιμοποιώντας το gcloud αντί για την ιστοσελίδα του περιβάλλοντος εργασίας, ελέγξτε:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md" %}
[gcp-clientauthconfig-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md)
{% endcontent-ref %}

## Αναφορές

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: Η Δύναμη της Σκοτεινής Εφαρμογής Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch και Beau Bullock - OK Google, Πώς να Κόκκινη Ομάδα GSuite;

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
