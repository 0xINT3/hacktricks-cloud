# GWS - Google Platformlarına Yönelik Kimlik Avı

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki özel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>

## Genel Kimlik Avı Metodolojisi

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Google Grupları Kimlik Avı

Görünüşe göre, varsayılan olarak, çalışma alanı üyeleri [**gruplar oluşturabilir**](https://groups.google.com/all-groups) **ve insanları bu gruplara davet edebilir**. Ardından, kullanıcıya gönderilecek e-postayı **bazı bağlantılar ekleyerek** değiştirebilirsiniz. **E-posta, bir Google adresinden** geleceği için **gerçek gibi** görünecek ve insanlar bağlantıya tıklayabilir.

Ayrıca, **GÖNDEREN** adresini **Google grup e-postası** olarak ayarlayarak, grup içindeki kullanıcılara **daha fazla e-posta göndermek** mümkündür. Aşağıdaki resimde olduğu gibi grup **`google--support@googlegroups.com`** oluşturuldu ve grup üyelerine (herhangi bir onay olmaksızın eklenen) bir **e-posta gönderildi**.

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Google Sohbet Kimlik Avı

Bir kişiyle **sohbet başlatabilir** veya **konuşma daveti** gönderebilirsiniz. Dahası, herhangi bir adı (örneğin "Google Destek") olabilen bir **Alan** oluşturmak ve üyelerini davet etmek mümkündür. Kabul ederlerse, Google Destek ile konuştuğunu düşünebilirler:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Ancak, testlerimde davet edilen üyeler davet bile almadı.
{% endhint %}

Bu, geçmişte nasıl çalıştığınızı kontrol edebileceğiniz bir videoda gösterilmiştir: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Google Doküman Kimlik Avı

Geçmişte, **görünüşte meşru bir belge** oluşturmak ve bir yorumda **@user@gmail.com gibi bir e-postayı** belirtmek mümkündü. Google, bu e-posta adresine belgede bahsedildiğini bildiren bir e-posta gönderdi.\
Günümüzde bu işe yaramaz, ancak **kurbanın belgeye erişim izni verirseniz** Google bir e-posta gönderecektir. Birini bahsettiğinizde görünen mesaj budur:

<figure><img src="../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Kurbanların, dışarıdan bir belgenin kendileriyle paylaşıldığını bildiren e-postaların e-postalarına ulaşmasına izin vermeyen bir koruma mekanizması olabilir.
{% endhint %}

## Google Takvim Kimlik Avı

Şirketi hedef alan herhangi bir kişinin e-posta adresini **ekleyebileceğiniz kadar çok e-posta adresini içeren bir takvim etkinliği oluşturabilirsiniz**. Bu takvim etkinliğini mevcut zamandan **5 veya 15 dakika** sonra planlayın. Etkinliği gerçek gibi gösterin ve **okunması gereken bir şey olduğunu belirten bir yorum ve başlık ekleyin** (kimlik avı bağlantısıyla).

Bu, tarayıcıda "İnsanları İşten Çıkarma" başlıklı bir toplantıyla ilgili olarak görünecek bir uyarıdır, bu nedenle daha fazla kimlik avı gibi bir başlık belirleyebilirsiniz (ve hatta e-postanıza ilişkilendirilen adı değiştirebilirsiniz).

<figure><img src="../../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

Daha az şüpheli görünmesi için:

* Alıcıların **davet edilen diğer kişileri görememesini** sağlayın
* **Etkinlikle ilgili e-postalar göndermeyin**. Bu durumda, insanlar sadece 5 dakika içinde bir toplantı uyarısı ve o bağlantıyı okumaları gerektiği konusunda bir uyarı görecekler.
* API kullanarak, **kişilerin** etkinliği **kabul ettiğini** ve hatta **onların adına yorumlar oluşturabileceğinizi** belirtebilirsiniz.

## Uygulama Komut Dosyası Yönlendirme Kimlik Avı

[https://script.google.com/](https://script.google.com/) adresinde bir komut dosyası oluşturabilir ve herkesin erişebileceği şekilde **web uygulaması olarak açığa çıkarabilirsiniz**. Bu, meşru alan **`script.google.com`** kullanacaktır.  \
Aşağıdaki gibi bazı kodlarla saldırgan, bu sayfada durmadan herhangi bir içeriği yükleyebilir:

{% code overflow="wrap" %}
```javascript
function doGet() {
return HtmlService.createHtmlOutput('<meta http-equiv="refresh" content="0;url=https://cloud.hacktricks.xyz/pentesting-cloud/workspace-security/gws-google-platforms-phishing#app-scripts-redirect-phishing">')
.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```
{% endcode %}

Örneğin [https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec](https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec) adresine eriştiğinizde:

<figure><img src="../../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
İçerik bir iframe içinde yüklendiği için bir uyarı görünecektir.
{% endhint %}

## App Scripts OAuth Phishing

Kurbanın OAuth belirteci üzerinde erişim elde etmek için belgelere bağlı App Scripts oluşturmak mümkündür. Daha fazla bilgi için kontrol edin:

{% content-ref url="gws-app-scripts.md" %}
[gws-app-scripts.md](gws-app-scripts.md)
{% endcontent-ref %}

## OAuth Uygulamaları Phishing

Önceki tekniklerden herhangi biri, kullanıcının **Google OAuth uygulamasına** erişmesini sağlamak için kullanılabilir. Kullanıcı **kaynağa** güveniyorsa, **uygulamaya** güvenebilir (yüksek ayrıcalıklı izinler istese bile).

{% hint style="info" %}
Google, uygulamanın güvenilmez olduğunu belirten çirkin bir uyarı sunar ve Workspace yöneticileri OAuth uygulamalarını kabul etmeyi engelleyebilir.
{% endhint %}

**Google**, birçok **Google hizmetiyle** kullanıcılar adına etkileşimde bulunabilen uygulamalar oluşturmanıza izin verir: Gmail, Drive, GCP...

**Diğer kullanıcılar adına hareket etmek için** bir uygulama oluşturulduğunda, geliştiricinin **GCP içinde OAuth uygulaması oluşturması** ve uygulamanın kullanıcı verilerine erişmesi gereken kapsamları (izinleri) belirtmesi gerekir.\
Bir **kullanıcı**, **uygulamayı kullanmak** istediğinde, kapsamlarda belirtilen verilere erişimin uygulamaya **kabul edilmesi** istenecektir.

Bu, teknik olmayan kullanıcıları **hassas bilgilere erişen uygulamaları kullanmaya** ikna etmek için çok cazip bir yöntemdir çünkü sonuçları anlamayabilirler. Bununla birlikte, kuruluş hesaplarında bunun önlenmesi için yöntemler vardır.

### Doğrulanmamış Uygulama uyarısı

Bahsedildiği gibi, Google her zaman kullanıcının uygulamaya verdikleri izinleri kabul etmeleri için bir **uyarıyı kullanıcıya sunar**. Ancak, uygulama **tehlikeli** olarak kabul edilirse, Google, kullanıcının uygulamaya izinleri vermesini **daha zorlaştıran** ve **tehlikeli olduğunu belirten bir uyarıyı ilk olarak gösterecektir**.

Bu uyarı, aşağıdaki uygulamalarda görünür:

* Özel verilere erişebilen herhangi bir kapsam kullanır (Gmail, Drive, GCP, BigQuery...)
* 100'den az kullanıcısı olan uygulamalar (100'den fazla uygulama için doğrulanmamış uyarıyı göstermeyi durdurmak için bir inceleme süreci de gereklidir)

### İlginç Kapsamlar

[**Burada**](https://developers.google.com/identity/protocols/oauth2/scopes) Google OAuth kapsamlarının bir listesini bulabilirsiniz.

* **cloud-platform**: Google Cloud Platform hizmetlerindeki verilerinizi görüntüleyin ve yönetin. GCP'de kullanıcıyı taklit edebilirsiniz.
* **admin.directory.user.readonly**: Kuruluşunuzun GSuite dizinini görüntüleyin ve indirin. Tüm kullanıcıların adlarını, telefonlarını, takvim URL'lerini alın.

### Bir OAuth Uygulaması Oluşturma

**Önce bir OAuth İstemci Kimliği oluşturmaya başlayalım**

1. [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) adresine gidin ve onay ekranını yapılandırmak için tıklayın.
2. Ardından, **kullanıcı türü**nün **içsel** (yalnızca kuruluşunuzdaki kişiler için) veya **harici** olduğu sorulacaktır. İhtiyaçlarınıza uygun olanı seçin
* İçsel, zaten bir kuruluş kullanıcısını etkilemişseniz ve başka birini avlamak için bu Uygulamayı oluşturuyorsanız ilginç olabilir.
3. Uygulamaya bir **ad**, bir **destek e-postası** (daha fazla anonimleşmek için bir googlegroup e-postası ayarlayabilirsiniz), bir **logo**, **yetkilendirilmiş alanlar** ve diğer bir **e-posta** için **güncellemeler** verin.
4. **OAuth kapsamlarını seçin**.
* Bu sayfa, hassas olmayan izinler, hassas izinler ve kısıtlı izinler olmak üzere üçe ayrılmıştır. Yeni bir izin eklediğinizde, kategorisine eklenir. İstenen izinlere bağlı olarak, kullanıcıya bu izinlerin ne kadar hassas olduğunu belirten farklı bir uyarı görünecektir.
* **`admin.directory.user.readonly`** ve **`cloud-platform`** izinleri hassas izinlerdir.
5. **Test kullanıcılarını ekleyin**. Uygulamanın durumu test olduğu sürece, yalnızca bu kullanıcılar uygulamaya erişebileceğinden, **avlamayı planladığınız e-postayı eklemeyi unutmayın**.

Şimdi, **önceden oluşturulan OAuth İstemci Kimliği** kullanarak bir **web uygulaması için kimlik bilgileri alalım**:

1. [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) adresine geri dönün, bu sefer farklı bir seçenek görünecektir.
2. **Web uygulaması için kimlik bilgileri oluşturmayı** seçin
3. Gerekli **Javascript kökenlerini** ve **yönlendirme URI'lerini** ayarlayın
* Test için **`http://localhost:8000/callback`** gibi bir şey ayarlayabilirsiniz
4. Uygulama **kimlik bilgilerinizi** alın

Son olarak, OAuth uygulama kimlik bilgilerini kullanan bir web uygulaması çalıştıralım. Bir örneği [https://github.com/carlospolop/gcp\_oauth\_phishing\_example](https://github.com/carlospolop/gcp\_oauth\_phishing\_example) adresinde bulabilirsiniz.
```bash
git clone ttps://github.com/carlospolop/gcp_oauth_phishing_example
cd gcp_oauth_phishing_example
pip install flask requests google-auth-oauthlib
python3 app.py --client-id "<client_id>" --client-secret "<client_secret>"
```
**`http://localhost:8000`** adresine gidin ve Google ile Giriş Yap düğmesine tıklayın, aşağıdaki gibi bir mesajla karşılaşacaksınız:

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

Uygulama, kolayca kullanılabilecek **erişim ve yenileme belirteçlerini** gösterecektir. Bu belirteçleri nasıl kullanacağınız hakkında daha fazla bilgi için şu adrese bakın:

{% content-ref url="../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

#### `glcoud` Kullanarak

Web konsolu yerine gcloud kullanarak da bir şeyler yapmak mümkündür, şu adrese bakın:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md" %}
[gcp-clientauthconfig-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md)
{% endcontent-ref %}

## Referanslar

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - G Suite Hackleme: Kötü Amaçlı Uygulama Komut Dosyası Sihirbazının Gücü
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch ve Beau Bullock - Tamam Google, GSuite'i Nasıl Kırmalıyım?

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı yapmak veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek paylaşın**.

</details>
