# GCP - Artifact Registry 持久性

<details>

<summary><strong>从零开始学习AWS黑客技术直到成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在HackTricks中看到您的**公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>

## Artifact Registry

有关Artifact Registry的更多信息，请查看：

{% content-ref url="../gcp-services/gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](../gcp-services/gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### 依赖混淆

* 如果**远程和标准**仓库在一个虚拟仓库中**混合**，并且两者都存在同一个包会发生什么？
* 在虚拟仓库中设置了**最高优先级**的包会被使用
* 如果**优先级相同**：
* 如果**版本**也**相同**，则使用虚拟仓库中**按字母顺序**排在前面的**策略名称**
* 如果不同，则使用**最高版本**

{% hint style="danger" %}
因此，如果远程仓库的优先级更高或相同，可以**滥用最高版本（依赖混淆）**在公共包注册中
{% endhint %}

这项技术对于**持久性**和**无认证访问**很有用，因为滥用它只需要**知道Artifact Registry中存储的库名**，并在公共仓库中（例如Python的PyPi）**创建同名库**并使用更高的版本。

对于持久性，您需要遵循以下步骤：

* **要求**：必须**存在**并使用一个**虚拟仓库**，一个在**公共仓库**中不存在的**内部包**必须被使用。
* 如果远程仓库不存在，则创建一个
* 将远程仓库添加到虚拟仓库
* 编辑虚拟仓库的策略，给予远程仓库更高（或相同）的优先级。\
运行类似以下命令：
* [gcloud artifacts repositories update --upstream-policy-file ...](https://cloud.google.com/sdk/gcloud/reference/artifacts/repositories/update#--upstream-policy-file)
* 下载合法包，添加您的恶意代码，并在公共仓库中以相同版本注册。每次开发者安装它时，他们将安装您的版本！

有关依赖混淆的更多信息，请查看：

{% embed url="https://book.hacktricks.xyz/pentesting-web/dependency-confusion" %}

<details>

<summary><strong>从零开始学习AWS黑客技术直到成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在HackTricks中看到您的**公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>
