# GCP - Artifact Registry 지속성

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* 독점적인 [**NFT**](https://opensea.io/collection/the-peass-family) 컬렉션인 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>

## Artifact Registry

Artifact Registry에 대한 자세한 정보는 다음을 참조하세요:

{% content-ref url="../gcp-services/gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](../gcp-services/gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### 의존성 혼동

* **원격 및 표준** 저장소가 **가상** 저장소에 **혼합**되고 패키지가 둘 다 존재하는 경우에는 어떻게 될까요?
* **가상 저장소에서 설정된 가장 높은 우선순위**를 가진 것이 사용됩니다.
* 우선순위가 **동일한 경우**:
* **버전**이 **동일**한 경우, 가상 저장소에서 알파벳순으로 가장 먼저 나오는 정책 이름이 사용됩니다.
* 그렇지 않으면 **가장 높은 버전**이 사용됩니다.

{% hint style="danger" %}
따라서, 원격 저장소의 우선순위가 더 높거나 동일한 경우, 공개 패키지 레지스트리에서 **가장 높은 버전 (의존성 혼동)**을 악용할 수 있습니다.
{% endhint %}

이 기술은 **지속성**과 **인증되지 않은 액세스**에 유용할 수 있으며, 이를 악용하기 위해서는 Artifact Registry에 저장된 **라이브러리 이름을 알아야 하고 (예: Python의 PyPi)** 동일한 버전으로 **공개 저장소에 해당 라이브러리를 생성**하면 됩니다.

지속성을 위해 다음 단계를 따르세요:

* **요구 사항**: **가상 저장소**가 **존재**하고 사용되어야 하며, **공개 저장소**에 존재하지 않는 **이름을 가진 내부 패키지**를 사용해야 합니다.
* 원격 저장소를 생성하려면 존재하지 않는 경우
* 원격 저장소를 가상 저장소에 추가합니다.
* 가상 레지스트리의 정책을 편집하여 원격 저장소에 더 높은 우선순위 (또는 동일한 우선순위)를 부여합니다.\
다음과 같이 실행하세요:
* [gcloud artifacts repositories update --upstream-policy-file ...](https://cloud.google.com/sdk/gcloud/reference/artifacts/repositories/update#--upstream-policy-file)
* 정품 패키지를 다운로드하고 악성 코드를 추가하여 동일한 버전으로 공개 저장소에 등록합니다. 개발자가 설치할 때마다 그의 것이 설치됩니다!

의존성 혼동에 대한 자세한 정보는 다음을 참조하세요:

{% embed url="https://book.hacktricks.xyz/pentesting-web/dependency-confusion" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* 독점적인 [**NFT**](https://opensea.io/collection/the-peass-family) 컬렉션인 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
