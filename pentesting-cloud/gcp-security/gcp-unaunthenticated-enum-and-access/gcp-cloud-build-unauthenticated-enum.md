# GCP - Cloud Build Unauthenticated Enum

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスウォッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬** [**Discordグループ**](https://discord.gg/hRep4RUj7f)**に参加するか、**[**telegramグループ**](https://t.me/peass)**に参加するか、Twitterで私をフォローする 🐦** [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **ハッキングトリックを共有するために** [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する。

</details>

## Cloud Build

Cloud Buildに関する詳細情報は次を確認してください：

{% content-ref url="../gcp-services/gcp-cloud-build-enum.md" %}
[gcp-cloud-build-enum.md](../gcp-services/gcp-cloud-build-enum.md)
{% endcontent-ref %}

### cloudbuild.yml

**`cloudbuild.yml`というファイルを含むリポジトリで書き込みアクセスを妥協した場合、Cloud Build内で実行されるコマンドを指定する**このファイルに**バックドア**を仕込んで、秘密情報を外部に持ち出し、実行内容を妥協し、**Cloud Buildサービスアカウントを妥協**することができます。

{% hint style="info" %}
GCPには、管理者が外部PRからのビルドシステムの実行を制御できるようにするオプションがあります。コメント制御は、共同作業者/プロジェクト所有者が**ビルドをトリガーするために“/gcbrun”とコメントする必要がある**という機能であり、この機能を使用すると、インターネット上の誰もがビルドシステムをトリガーできなくなります。
{% endhint %}

関連情報については、GitHub Actionsを攻撃する方法についてのページを確認できます（これに類似）：

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

### PR承認

トリガーがPRの場合、**誰でもパブリックリポジトリにPRを行うことができる**ため、**どんなPRでもトリガーの実行を許可する**のは非常に危険です。そのため、デフォルトでは、実行は**所有者と共同作業者に対してのみ自動的**に行われ、他のユーザーのPRでトリガーを実行するには、所有者または共同作業者が`/gcbrun`とコメントする必要があります。

<figure><img src="../../../.gitbook/assets/image (150).png" alt="" width="563"><figcaption></figcaption></figure>

{% hint style="danger" %}
したがって、これが\*\*`Not required`**に設定されている場合、攻撃者は**トリガーを起動するために“cloudbuild.yml”ファイルに悪意のあるコード実行を追加する**PRをブランチに行い、cloudbuildの実行を妥協させることができます（cloudbuildはPRからコードをダウンロードするため、悪意のある**`cloudbuild.yml`\*\*を実行します）。
{% endhint %}

さらに、PRを送信すると、Githubに**実行する必要のあるcloudbuild実行**が表示されるため、簡単に確認できます：

<figure><img src="../../../.gitbook/assets/image (151).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
そのため、cloudbuildが実行されなくても、攻撃者は**企業に属するGCPプロジェクトのプロジェクト名**を見ることができます。
{% endhint %}

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスウォッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬** [**Discordグループ**](https://discord.gg/hRep4RUj7f)**に参加するか、**[**telegramグループ**](https://t.me/peass)**に参加するか、Twitterで私をフォローする 🐦** [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **ハッキングトリックを共有するために** [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する。

</details>
