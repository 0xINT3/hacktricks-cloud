# GCP - 云构建未经身份验证的枚举

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在HackTricks中看到您的**公司广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS＆HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 云构建

有关云构建的更多信息，请查看：

{% content-ref url="../../gcp-pentesting/gcp-services/gcp-cloud-build-enum.md" %}
[gcp-cloud-build-enum.md](../../gcp-pentesting/gcp-services/gcp-cloud-build-enum.md)
{% endcontent-ref %}

### cloudbuild.yml

如果您获得了包含名为**`cloudbuild.yml`**的文件的存储库的写入访问权限，您可以在该文件中**植入后门**，该文件指定了将在Cloud Build中执行的**命令**，并窃取秘密、妥协所做的事情以及妥协**Cloud Build服务帐户**。

{% hint style="info" %}
请注意，GCP有选项允许管理员通过“评论控制”控制来自外部PR的构建系统的执行。评论控制是一个功能，协作者/项目所有者**需要评论“/gcbrun”来触发构建**以针对PR执行此功能，使用此功能固有地防止任何互联网用户触发您的构建系统。
{% endhint %}

有关一些相关信息，您可以查看有关如何攻击Github Actions的页面（类似于此）：

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

### PR批准

当触发器为PR时，因为**任何人都可以对公共存储库执行PR**，所以仅**允许使用任何PR执行触发器**将非常危险。因此，默认情况下，只有**所有者和协作者**可以自动执行触发器，为了使用其他用户的PR执行触发器，所有者或协作者必须评论`/gcbrun`。

<figure><img src="../../../.gitbook/assets/image (150).png" alt="" width="563"><figcaption></figcaption></figure>

{% hint style="danger" %}
因此，如果设置为**`Not required`**，攻击者可以对将触发执行的分支执行**PR**，添加恶意代码执行到**`cloudbuild.yml`**文件中，并妥协cloudbuild执行（请注意，cloudbuild将从PR下载代码，因此将执行恶意**`cloudbuild.yml`**）。
{% endhint %}

此外，当您发送PR时，很容易看到是否需要执行某些cloudbuild执行，因为它会出现在Github中：

<figure><img src="../../../.gitbook/assets/image (151).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
因此，即使cloudbuild未执行，攻击者也将能够看到属于公司的GCP项目的**项目名称**。
{% endhint %}

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在HackTricks中看到您的**公司广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS＆HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
