# GCP - Cloud Build Unauthenticated Enum

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスウェグ**](https://peass.creator-spring.com)を手に入れる
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter**で私をフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
- **ハッキングトリックを共有するために、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する。**

</details>

## Cloud Build

Cloud Buildに関する詳細情報は次を参照してください：

{% content-ref url="../gcp-services/gcp-cloud-build-enum.md" %}
[gcp-cloud-build-enum.md](../gcp-services/gcp-cloud-build-enum.md)
{% endcontent-ref %}

### cloudbuild.yml

リポジトリに**`cloudbuild.yml`**というファイルが含まれている場合、書き込みアクセスを侵害すると、このファイルに**バックドア**を仕込むことができます。これはCloud Build内で実行される**コマンドを指定**し、秘密情報を外部に持ち出し、実行内容を妨害し、**Cloud Buildサービスアカウントを侵害**する可能性があります。

{% hint style="info" %}
GCPには、管理者が外部PRからのビルドシステムの実行を制御できるようにするオプションがあります。コメント制御は、共同作業者/プロジェクト所有者がビルドをトリガーするために「/gcbrun」とコメントする必要がある機能です。この機能を使用すると、インターネット上の誰もがビルドシステムをトリガーできなくなります。
{% endhint %}

関連情報については、GitHub Actionsを攻撃する方法についてのページを参照できます（これに類似）：

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

### PR承認

トリガーがPRの場合、**誰でもパブリックリポジトリにPRを行うことができる**ため、**どんなPRでもトリガーの実行を許可する**のは非常に危険です。そのため、デフォルトでは、実行は**所有者と共同作業者に対してのみ自動的**に行われ、他のユーザーのPRでトリガーを実行するには、所有者または共同作業者が「/gcbrun」とコメントする必要があります。

<figure><img src="../../../.gitbook/assets/image (339).png" alt="" width="563"><figcaption></figcaption></figure>

{% hint style="danger" %}
したがって、これが**`Not required`**に設定されている場合、攻撃者は**ブランチにPRを行い**、悪意のあるコード実行を**`cloudbuild.yml`**ファイルに追加してトリガーの実行を妨害し、cloudbuildの実行を侵害する可能性があります（cloudbuildはPRからコードをダウンロードするため、悪意のある**`cloudbuild.yml`**を実行します）。
{% endhint %}

さらに、PRを送信するときにcloudbuildの実行が必要かどうかは簡単に確認できます。GitHubに表示されます：

<figure><img src="../../../.gitbook/assets/image (340).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
そのため、cloudbuildが実行されなくても、攻撃者は会社に属するGCPプロジェクトの**プロジェクト名**を見ることができます。
{% endhint %}

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスウェグ**](https://peass.creator-spring.com)を手に入れる
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter**で私をフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
- **ハッキングトリックを共有するために、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する。**

</details>
