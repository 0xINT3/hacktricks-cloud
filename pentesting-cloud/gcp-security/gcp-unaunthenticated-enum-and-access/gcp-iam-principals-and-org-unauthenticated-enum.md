# GCP - IAM, Prinzipale & Org Unauthenticated Enum

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **einreichen.**
*
*
* &#x20;GitHub-Repositories.

</details>

## Iam & GCP Prinzipale&#x20;

F√ºr weitere Informationen siehe:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### Wird die Domain in Workspace verwendet?

1. **√úberpr√ºfen Sie DNS-Eintr√§ge**

Wenn es einen **`google-site-verification`**-Eintrag gibt, ist es wahrscheinlich, dass es Workspace verwendet hat (oder verwendet).
```
dig txt hacktricks.xyz

[...]
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=2mWyPXMPXEEy6QqWbCfWkxFTcQhyYdwHrOxee1Yeo-0"
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=C19PtLcZ1EGyzUYYJTX1Tp6bOGessxzN9gqE-SVKhRA"
hacktricks.xyz.		300	IN	TXT	"v=spf1 include:usb._netblocks.mimecast.com include:_spf.google.com include:_spf.psm.knowbe4.com include:_spf.salesforce.com include:spf.mandrillapp.com ~all"
```
Wenn etwas wie **`include:_spf.google.com`** erscheint, best√§tigt es dies (beachten Sie, dass es dies nicht verneint, da eine Domain in Workspace sein kann, ohne Gmail als E-Mail-Anbieter zu verwenden).

2. **Versuchen Sie, ein Workspace mit dieser Domain einzurichten**

Eine weitere Option besteht darin, zu versuchen, einen Workspace mit der Domain einzurichten. Wenn es **beanstandet, dass die Domain bereits verwendet wird** (wie im Bild), wissen Sie, dass sie bereits verwendet wird!

Um zu versuchen, eine Workspace-Domain einzurichten, folgen Sie: [https://workspace.google.com/business/signup/welcome](https://workspace.google.com/business/signup/welcome)

<figure><img src="../../../.gitbook/assets/image (141).png" alt=""><figcaption></figcaption></figure>

3. **Versuchen Sie, das Passwort einer E-Mail mit dieser Domain wiederherzustellen**

Wenn Sie eine g√ºltige E-Mail-Adresse kennen, die in dieser Domain verwendet wird (z. B .: admin@email.com oder info@email.com), k√∂nnen Sie versuchen, das Konto unter [https://accounts.google.com/signin/v2/recoveryidentifier](https://accounts.google.com/signin/v2/recoveryidentifier) wiederherzustellen. Wenn kein Fehler angezeigt wird, der darauf hinweist, dass Google keine Ahnung von diesem Konto hat, wird Workspace verwendet.

### E-Mails und Dienstkonten auflisten

Es ist m√∂glich, **g√ºltige E-Mails einer Workspace-Domain und SA-E-Mails** zu enumerieren, indem Sie versuchen, ihnen Berechtigungen zuzuweisen und die Fehlermeldungen zu √ºberpr√ºfen. Dazu ben√∂tigen Sie lediglich Berechtigungen, um einem Projekt Berechtigungen zuzuweisen (das m√∂glicherweise nur Ihnen geh√∂rt).

Beachten Sie, dass Sie sie √ºberpr√ºfen k√∂nnen, aber selbst wenn sie existieren, ihnen keine Berechtigung erteilen k√∂nnen. Verwenden Sie den Typ **`serviceAccount`**, wenn es sich um einen **`Benutzer`** handelt, und **`Benutzer`**, wenn es sich um ein **`SA`** handelt:

{% code overflow="wrap" %}
```bash
# Try to assign permissions to user 'unvalid-email-34r434f@hacktricks.xyz'
# but indicating it's a service account
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:unvalid-email-34r434f@hacktricks.xyz' \
--role='roles/viewer'
## Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User unvalid-email-34r434f@hacktricks.xyz does not exist.

# Now try with a valid email
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:support@hacktricks.xyz' \
--role='roles/viewer'
# Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal support@hacktricks.xyz is of type "user". The principal should appear as "user:support@hacktricks.xyz". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

Beachten Sie, dass, wenn die Benutzer-E-Mail g√ºltig war, die Fehlermeldung darauf hinwies, dass der Typ nicht stimmt. So konnten wir herausfinden, dass die E-Mail support@hacktricks.xyz existiert, ohne ihr irgendwelche Berechtigungen zu gew√§hren.

Sie k√∂nnen dasselbe mit Dienstkonten tun, indem Sie den Typ **`user:`** anstelle von **`serviceAccount:`** verwenden:

{% code overflow="wrap" %}
```bash
# Non existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User <invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com does not exist.

# Existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal testing@digital-bonfire-410512.iam.gserviceaccount.com is of type "serviceAccount". The principal should appear as "serviceAccount:testing@digital-bonfire-410512.iam.gserviceaccount.com". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
*
*
* &#x20;github Repos.

</details>
