# GCP - IAM, 주체 및 조직 인증되지 않은 열거

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고되거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**을** **팔로우**하세요.
* **Hacking 트릭을 공유하려면 PR을** [**HackTricks**](https://github.com/carlospolop/hacktricks) **및** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **에 제출**하세요.
*
*
* &#x20;github 저장소.

</details>

## Iam & GCP 주체

자세한 정보는 다음을 확인하세요:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### Workspace에서 도메인을 사용하고 있습니까?

1. **DNS 레코드 확인**

**`google-site-verification`** 레코드가 있다면 (또는 사용했을 가능성이 있다면) Workspace를 사용하고 있는 것입니다.
```
dig txt hacktricks.xyz

[...]
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=2mWyPXMPXEEy6QqWbCfWkxFTcQhyYdwHrOxee1Yeo-0"
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=C19PtLcZ1EGyzUYYJTX1Tp6bOGessxzN9gqE-SVKhRA"
hacktricks.xyz.		300	IN	TXT	"v=spf1 include:usb._netblocks.mimecast.com include:_spf.google.com include:_spf.psm.knowbe4.com include:_spf.salesforce.com include:spf.mandrillapp.com ~all"
```
만약 **`include:_spf.google.com`**과 같은 것이 나타나면, 이것을 확인합니다 (참고로, 나타나지 않는다면 gmail을 메일 제공자로 사용하지 않고도 Workspace에 도메인이 있을 수 있습니다).

2. 해당 도메인으로 Workspace를 설정해 보세요

다른 옵션은 해당 도메인을 사용하여 Workspace를 설정해 보는 것입니다. 만약 이미 사용 중인 도메인이라고 **에러가 발생한다면** (이미지와 같이), 이미 사용 중인 것을 알 수 있습니다!

Workspace 도메인을 설정해 보려면 다음을 따르세요: [https://workspace.google.com/business/signup/welcome](https://workspace.google.com/business/signup/welcome)

<figure><img src="../../../.gitbook/assets/image (141).png" alt=""><figcaption></figcaption></figure>

3. 해당 도메인을 사용하는 이메일의 비밀번호를 복구해 보세요

해당 도메인에서 사용되는 유효한 이메일 주소를 알고 있다면 (예: admin@email.com 또는 info@email.com), [https://accounts.google.com/signin/v2/recoveryidentifier](https://accounts.google.com/signin/v2/recoveryidentifier)에서 계정을 복구해 볼 수 있습니다. 만약 에러가 발생하지 않고 Google이 해당 계정에 대해 아무런 정보를 가지고 있지 않다는 메시지가 나타난다면, 해당 도메인은 Workspace를 사용하고 있습니다.

### 이메일과 서비스 계정 열거하기

Workspace 도메인과 SA(Servie Account) 이메일의 유효성을 확인하기 위해 권한을 할당하고 에러 메시지를 확인하는 것이 가능합니다. 이를 위해서는 프로젝트에 권한을 할당할 수 있는 권한이 있어야 합니다 (이 프로젝트는 단지 당신이 소유한 것일 수도 있습니다).

참고로, 존재 여부를 확인하기 위해 권한을 부여하지 않고 확인할 수 있으며, **`user`**인 경우 **`serviceAccount`** 유형을 사용하고, **`SA`**인 경우 **`user`** 유형을 사용할 수 있습니다:

{% code overflow="wrap" %}
```bash
# Try to assign permissions to user 'unvalid-email-34r434f@hacktricks.xyz'
# but indicating it's a service account
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:unvalid-email-34r434f@hacktricks.xyz' \
--role='roles/viewer'
## Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User unvalid-email-34r434f@hacktricks.xyz does not exist.

# Now try with a valid email
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:support@hacktricks.xyz' \
--role='roles/viewer'
# Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal support@hacktricks.xyz is of type "user". The principal should appear as "user:support@hacktricks.xyz". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

사용자 이메일이 유효한 경우 오류 메시지가 입력한 타입이 아니라고 나타나는 것을 확인할 수 있습니다. 따라서 우리는 권한을 부여하지 않고도 이메일 support@hacktricks.xyz가 존재하는 것을 발견할 수 있었습니다.

**서비스 계정**에 대해서도 동일한 작업을 수행할 수 있으며, **`serviceAccount:`** 대신 **`user:`** 유형을 사용합니다:

{% code overflow="wrap" %}
```bash
# Non existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User <invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com does not exist.

# Existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal testing@digital-bonfire-410512.iam.gserviceaccount.com is of type "serviceAccount". The principal should appear as "serviceAccount:testing@digital-bonfire-410512.iam.gserviceaccount.com". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)을 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud**에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.
*
*
* &#x20;github 저장소.

</details>
