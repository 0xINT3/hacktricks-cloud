# GCP - IAM, Αρχές και Ανεξουσιοδότητη Απαρίθμηση Οργανισμού

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στο** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
*
*
* &#x20;αποθετήρια github.

</details>

## Iam & Αρχές GCP&#x20;

Για περισσότερες πληροφορίες ελέγξτε:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### Χρησιμοποιείται το domain στο Workspace;

1. **Έλεγχος εγγραφών DNS**

Εάν έχει μια εγγραφή **`google-site-verification`** είναι πιθανό ότι χρησιμοποιεί (ή χρησιμοποιούσε) το Workspace:
```
dig txt hacktricks.xyz

[...]
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=2mWyPXMPXEEy6QqWbCfWkxFTcQhyYdwHrOxee1Yeo-0"
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=C19PtLcZ1EGyzUYYJTX1Tp6bOGessxzN9gqE-SVKhRA"
hacktricks.xyz.		300	IN	TXT	"v=spf1 include:usb._netblocks.mimecast.com include:_spf.google.com include:_spf.psm.knowbe4.com include:_spf.salesforce.com include:spf.mandrillapp.com ~all"
```
Εάν εμφανίζεται κάτι σαν **`include:_spf.google.com`**, τότε επιβεβαιώνεται (σημειώστε ότι εάν δεν εμφανίζεται, δεν αποκλείεται να είναι ένας τομέας στο Workspace χωρίς να χρησιμοποιεί το gmail ως πάροχος ηλεκτρονικού ταχυδρομείου).

2. **Προσπαθήστε να δημιουργήσετε ένα Workspace με αυτόν τον τομέα**

Μια άλλη επιλογή είναι να προσπαθήσετε να δημιουργήσετε ένα Workspace χρησιμοποιώντας τον τομέα. Εάν **διαμαρτύρεται ότι ο τομέας χρησιμοποιείται ήδη** (όπως στην εικόνα), τότε ξέρετε ότι χρησιμοποιείται ήδη!

Για να προσπαθήσετε να δημιουργήσετε έναν τομέα Workspace, ακολουθήστε: [https://workspace.google.com/business/signup/welcome](https://workspace.google.com/business/signup/welcome)

<figure><img src="../../../.gitbook/assets/image (141).png" alt=""><figcaption></figcaption></figure>

3. **Προσπαθήστε να ανακτήσετε τον κωδικό πρόσβασης ενός ηλεκτρονικού ταχυδρομείου που χρησιμοποιεί αυτόν τον τομέα**

Εάν γνωρίζετε οποιαδήποτε έγκυρη διεύθυνση ηλεκτρονικού ταχυδρομείου που χρησιμοποιείται σε αυτόν τον τομέα (π.χ. admin@email.com ή info@email.com), μπορείτε να προσπαθήσετε να **ανακτήσετε τον λογαριασμό** στη διεύθυνση [https://accounts.google.com/signin/v2/recoveryidentifier](https://accounts.google.com/signin/v2/recoveryidentifier), και εάν δεν εμφανίζει σφάλμα που υποδεικνύει ότι η Google δεν έχει ιδέα για αυτόν τον λογαριασμό, τότε χρησιμοποιείται το Workspace.

### Απαρίθμηση ηλεκτρονικών ταχυδρομείων και λογαριασμών υπηρεσίας

Είναι δυνατόν να **απαριθμήσετε έγκυρες διευθύνσεις ηλεκτρονικού ταχυδρομείου ενός τομέα Workspace και διευθύνσεις ηλεκτρονικού ταχυδρομείου υπηρεσίας** δοκιμάζοντας να τους αναθέσετε δικαιώματα και ελέγχοντας τα μηνύματα σφάλματος. Για αυτό, απλά χρειάζεστε δικαιώματα για να αναθέσετε δικαιώματα σε ένα έργο (το οποίο μπορεί να είναι απλά στην κυριολεξία σας).

Σημειώστε ότι για να τα ελέγξετε, αλλά ακόμα και αν υπάρχουν, να μην τους χορηγήσετε δικαίωμα, μπορείτε να χρησιμοποιήσετε τον τύπο **`serviceAccount`** όταν είναι **`user`** και **`user`** όταν είναι **`SA`**:

{% code overflow="wrap" %}
```bash
# Try to assign permissions to user 'unvalid-email-34r434f@hacktricks.xyz'
# but indicating it's a service account
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:unvalid-email-34r434f@hacktricks.xyz' \
--role='roles/viewer'
## Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User unvalid-email-34r434f@hacktricks.xyz does not exist.

# Now try with a valid email
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:support@hacktricks.xyz' \
--role='roles/viewer'
# Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal support@hacktricks.xyz is of type "user". The principal should appear as "user:support@hacktricks.xyz". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

Παρατηρήστε πώς όταν το ηλεκτρονικό ταχυδρομείο του χρήστη ήταν έγκυρο, το μήνυμα σφάλματος υποδήλωνε ότι ο τύπος δεν είναι έγκυρος, έτσι καταφέραμε να ανακαλύψουμε ότι το ηλεκτρονικό ταχυδρομείο support@hacktricks.xyz υπάρχει χωρίς να του δοθούν κανένα προνόμια.

Μπορείτε να κάνετε το **ίδιο με τους Λογαριασμούς Υπηρεσίας** χρησιμοποιώντας τον τύπο **`user:`** αντί για τον **`serviceAccount:`**:

{% code overflow="wrap" %}
```bash
# Non existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User <invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com does not exist.

# Existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal testing@digital-bonfire-410512.iam.gserviceaccount.com is of type "serviceAccount". The principal should appear as "serviceAccount:testing@digital-bonfire-410512.iam.gserviceaccount.com". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
*
*
* &#x20;αποθετήρια github.

</details>
