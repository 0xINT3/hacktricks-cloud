# GCP - 공개 버킷 권한 상승

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**을** **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

## 버킷 권한 상승

만약 버킷 정책이 "allUsers" 또는 "allAuthenticatedUsers"에게 **버킷 정책을 쓰는 권한**(**storage.buckets.setIamPolicy** 권한)을 허용한다면, 누구나 버킷 정책을 수정하고 자신에게 완전한 액세스 권한을 부여할 수 있습니다.

### 권한 확인

버킷의 권한을 확인하는 방법은 2가지입니다. 첫 번째 방법은 `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam`으로 요청을 보내거나 `gsutil iam get gs://BUCKET_NAME`을 실행하여 권한을 요청하는 것입니다.

하지만, 사용자(잠재적으로 allUsers 또는 allAuthenticatedUsers에 속하는 사용자)가 버킷의 iam 정책을 읽는 권한(storage.buckets.getIamPolicy)을 가지고 있지 않은 경우에는 작동하지 않습니다.

다른 옵션은 항상 작동하는 버킷의 testPermissions 엔드포인트를 사용하여 지정된 권한을 확인하는 것입니다. 예를 들어 다음에 접근하는 것입니다: `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### 상승

`Storage Admin` 권한을 `allAuthenticatedUsers`에게 부여하려면 다음을 실행할 수 있습니다:
```
gsutil iam ch group:allAuthenticatedUsers:admin gs://BUCKET_NAME
```
다른 공격 방법은 **버킷을 제거하고 소유권을 훔쳐서 자신의 계정에 다시 생성하는 것**입니다.

## 참고 자료

* [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왑**](https://peass.creator-spring.com)을 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**을** **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>
