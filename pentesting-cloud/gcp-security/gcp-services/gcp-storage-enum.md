# GCP - Wyliczanie magazynu

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów github.

</details>

## Magazyn

Google Cloud Platform (GCP) Storage to **rozwiązanie magazynowania w chmurze**, które zapewnia wysoką trwałość i dostępność magazynu obiektowego dla danych bez struktury. Oferuje **różne klasy magazynowania** oparte na wydajności, dostępności i kosztach, w tym Standard, Nearline, Coldline i Archive. GCP Storage zapewnia również zaawansowane funkcje, takie jak **polityki cyklu życia, wersjonowanie i kontrola dostępu**, umożliwiające skuteczne zarządzanie i zabezpieczanie danych.

Kubełek może być przechowywany w regionie, w 2 regionach lub **w wielu regionach (domyślnie)**.

### Rodzaje magazynu

* **Standardowe magazynowanie**: Jest to domyślna opcja magazynowania, która **oferuje wysoką wydajność i niski czas dostępu do często używanych danych**. Nadaje się do szerokiego zakresu zastosowań, w tym do udostępniania treści witryny, strumieniowania multimediów i hostowania potoków analizy danych.
* **Magazynowanie Nearline**: Ta klasa magazynowania oferuje **niższe koszty magazynowania** i **nieco wyższe koszty dostępu** niż Standardowe magazynowanie. Jest zoptymalizowana dla danych używanych rzadko, z minimalnym czasem przechowywania wynoszącym 30 dni. Nadaje się do celów tworzenia kopii zapasowych i archiwizacji.
* **Magazynowanie Coldline**: Ta klasa magazynowania jest zoptymalizowana dla **długoterminowego przechowywania danych używanych rzadko**, z minimalnym czasem przechowywania wynoszącym 90 dni. Oferuje **niższe koszty magazynowania** niż Magazynowanie Nearline, ale z **wyższymi kosztami dostępu**.
* **Magazynowanie Archive**: Ta klasa magazynowania jest przeznaczona dla zimnych danych, które są **bardzo rzadko używane**, z minimalnym czasem przechowywania wynoszącym 365 dni. Oferuje **najniższe koszty magazynowania spośród wszystkich opcji magazynowania GCP**, ale z **najwyższymi kosztami dostępu**. Nadaje się do długoterminowego przechowywania danych, które muszą być przechowywane ze względów zgodności lub regulacyjnych.
* **Autoklasa**: Jeśli **nie wiesz, jak często będziesz korzystać** z danych, możesz wybrać Autoklasę, a GCP **automatycznie zmieni rodzaj magazynu, aby zminimalizować koszty**.

### Kontrola dostępu

Domyślnie **zaleca się** kontrolowanie dostępu za pomocą **IAM**, ale można również **włączyć korzystanie z list ACL**.\
Jeśli wybierzesz korzystanie tylko z IAM (domyślnie) i **upłynie 90 dni**, nie będziesz mógł włączyć list ACL dla kubełka.

### Wersjonowanie

Możliwe jest włączenie wersjonowania, co spowoduje **zapisanie starych wersji plików wewnątrz kubełka**. Można skonfigurować **liczbę wersji, które chcesz zachować**, a nawet **jak długo** chcesz, aby **nieaktualne** wersje (stare wersje) były przechowywane. Zalecane jest **7 dni dla typu Standard**.

**Metadane nieaktualnej wersji są przechowywane**. Ponadto, **listy ACL nieaktualnych wersji są również przechowywane**, więc starsze wersje mogą mieć inne listy ACL niż bieżąca wersja.

Dowiedz się więcej w [**dokumentacji**](https://cloud.google.com/storage/docs/object-versioning).

### Polityka retencji

Określ, jak **długo** chcesz **zabronić usuwanie obiektów wewnątrz kubełka** (bardzo przydatne przynajmniej dla celów zgodności).\
Tylko jedno z **wersjonowania lub polityki retencji może być włączone w tym samym czasie**.

### Szyfrowanie

Domyślnie obiekty są **szyfrowane za pomocą zarządzanych przez Google kluczy**, ale można również użyć **klucza z KMS**.

### Publiczny dostęp

Możliwe jest udostępnienie **zewnętrznym użytkownikom** (zalogowanym do GCP lub nie) **dostępu do zawartości kubełka**. \
Domyślnie, po utworzeniu kubełka, opcja publicznego udostępniania kubełka będzie **wyłączona**, ale z wystarczającymi uprawnieniami można ją zmienić.

**Format URL** do dostępu do kubełka to **`https://storage.googleapis.com/<nazwa-kubełka>` lub `https://<nazwa-kubełka>.storage.googleapis.com`** (oba są poprawne).

### Klucze HMAC

Klucz HMAC to rodzaj _poświadczenia_ i może być **powiązany z kontem usługi lub kontem użytkownika w Cloud Storage**. Używasz klucza HMAC do tworzenia _podpisów_, które są następnie dołączane do żądań do Cloud Storage. Podpisy pokazują, że **dane żądanie jest autoryzowane przez użytkownika lub konto usługi**.

Klucze HMAC mają dwie podstawowe części: _identyfikator dostępu_ i _sekret_.

*   **Identyfikator dostępu**: Alfanumeryczny ciąg powiązany z określonym kontem usługi lub użytkownika. Gdy jest powiązany z kontem usługi, ciąg ma długość 61 znaków, a gdy jest powiązany z kontem użytkownika, ciąg ma długość 24 znaków. Poniżej przedstawiono przykład identyfikatora dostępu:

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **Sekret**: 40-znakowy ciąg zakodowany w Base-64, który jest powiązany z określonym identyfikatorem dostępu. Sekret to klucz wcześniej udostępniony, który znają tylko ty i Cloud Storage. Używasz swojego sekretu do tworzenia podpisów w ramach procesu uwierzytelniania. Poniżej przedstawiono przykład sekretu:

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

Zarówno **identyfikator dostępu, jak i sekret jednoznacznie identyfikują klucz HMAC**, ale sekret jest znacznie bardziej poufną informacją, ponieważ jest używany do **tworzenia podpisów**.

### Wyliczanie
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list
```
Jeśli otrzymasz błąd o odmowie dostępu podczas wyświetlania kubełków, możesz nadal mieć dostęp do ich zawartości. Teraz, gdy znasz konwencję nazewnictwa kubełków, możesz wygenerować listę możliwych nazw i spróbować uzyskać do nich dostęp:
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
### Eskalacja uprawnień

Na następnej stronie możesz sprawdzić, jak **wykorzystać uprawnienia do przechowywania danych w celu eskalacji uprawnień**:

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### Enumeracja bez uwierzytelnienia

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### Po eksploatacji

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### Trwałość

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
