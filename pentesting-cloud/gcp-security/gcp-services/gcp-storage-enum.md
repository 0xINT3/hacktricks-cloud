# GCP - Kuchunguza Uhifadhi

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi mtaalamu na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalamu wa Timu Nyekundu ya HackTricks AWS)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **nifuata** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Uhifadhi

Uhifadhi wa Google Cloud Platform (GCP) ni **ufumbuzi wa uhifadhi wa wingu** ambao hutoa uhifadhi wa vitu wenye nguvu na upatikanaji kwa data isiyo na muundo. Inatoa **darasa tofauti za uhifadhi** kulingana na utendaji, upatikanaji, na gharama, ikiwa ni pamoja na Standard, Nearline, Coldline, na Archive. Uhifadhi wa GCP pia hutoa vipengele vya juu kama vile **sera za maisha, ufuatiliaji wa toleo, na udhibiti wa ufikiaji** kusimamia na kuhakikisha data kwa ufanisi.

Kisanduku kinaweza kuhifadhiwa katika eneo, katika mikoa 2 au **mikoa mingi (chaguo-msingi)**.

### Aina za Uhifadhi

* **Uhifadhi wa Kawaida**: Hii ni chaguo la uhifadhi la msingi linalotoa **upatikanaji wa utendaji wa hali ya juu, upatikanaji wa chini wa kuchelewa kwa data inayotumiwa mara kwa mara**. Ni sahihi kwa anuwai ya matumizi, ikiwa ni pamoja na kutumikia yaliyomo kwenye wavuti, kusambaza media, na kuhifadhi mifumo ya uchambuzi wa data.
* **Uhifadhi wa Nearline**: Darasa hili la uhifadhi lina **gharama za chini za uhifadhi** na **gharama za ufikiaji kidogo zaidi** kuliko Uhifadhi wa Kawaida. Limeboreshwa kwa data inayotumiwa mara chache, na muda wa chini wa uhifadhi wa siku 30. Ni bora kwa madhumuni ya nakala rudufu na kuhifadhi kumbukumbu.
* **Uhifadhi wa Coldline**: Darasa hili la uhifadhi limeboreshwa kwa **uhifadhi wa muda mrefu wa data inayotumiwa mara chache**, na muda wa chini wa uhifadhi wa siku 90. Inatoa **gharama za chini za uhifadhi** kuliko Uhifadhi wa Nearline, lakini na **gharama za ufikiaji zaidi**.
* **Uhifadhi wa Archive**: Darasa hili la uhifadhi limeundwa kwa data baridi ambayo ina **ufikiaji wa nadra sana**, na muda wa chini wa uhifadhi wa siku 365. Inatoa **gharama za chini kabisa za uhifadhi kati ya chaguzi zote za uhifadhi wa GCP** lakini na **gharama kubwa za ufikiaji**. Ni sahihi kwa kuhifadhi data kwa muda mrefu inayohitaji kuhifadhiwa kwa sababu za kufuata au za kisheria.
* **Autoclass**: Ikiwa **hujui kiwango cha ufikiaji** wa data unaweza kuchagua Autoclass na GCP itabadilisha **aina ya uhifadhi kiotomatiki** ili kupunguza gharama.

### Udhibiti wa Ufikiaji

Kwa **chaguo-msingi** ni **inashauriwa** kudhibiti ufikiaji kupitia **IAM**, lakini pia ni **kutumia ACLs**.\
Ikiwa unachagua kutumia IAM pekee (chaguo-msingi) na **siku 90 zinapita**, **hutaweza kuwezesha ACLs** kwa kisanduku.

### Ufuatiliaji wa Toleo

Inawezekana kuwezesha ufuatiliaji wa toleo, hii ita **hifadhi matoleo ya zamani ya faili ndani ya kisanduku**. Inawezekana kusanidi **idadi ya matoleo unayotaka kuhifadhi** na hata **muda gani** unataka **matoleo yasiyokuwa ya sasa** (matoleo ya zamani) yaishi. Inapendekezwa ni **siku 7 kwa aina ya Kawaida**.

**Metadata ya toleo lisilokuwa la sasa inahifadhiwa**. Zaidi ya hayo, **ACLs za matoleo yasiyokuwa ya sasa pia zinahifadhiwa**, kwa hivyo matoleo ya zamani yanaweza kuwa na ACLs tofauti na toleo la sasa.

Jifunze zaidi katika [**nyaraka**](https://cloud.google.com/storage/docs/object-versioning).

### Sera ya Kudumisha

Taja kwa muda gani unataka **kuzuia kufutwa kwa Vitu ndani ya kisanduku** (yenye manufaa kwa kufuata angalau).\
Moja tu ya **ufuatiliaji au sera ya kudumisha inaweza kuwezeshwa wakati mmoja**.

### Ufichaji

Kwa chaguo-msingi vitu vinakuwa **vimefichwa kwa kutumia funguo zilizosimamiwa na Google**, lakini unaweza pia kutumia **funguo kutoka KMS**.

### Ufikiaji wa Umma

Inawezekana kumpa **watumiaji wa nje** (walioingia kwenye GCP au la) **ufikiaji wa yaliyomo kwenye visanduku**. \
Kwa chaguo-msingi, wakati kisanduku kinavyoundwa, itakuwa na **chaguo lililozimwa la kuweka hadharani** kisanduku, lakini kwa idhini ya kutosha inaweza kubadilishwa.

**Muundo wa URL** wa kufikia kisanduku ni **`https://storage.googleapis.com/<jina-la-kisanduku>` au `https://<jina-la-kisanduku>.storage.googleapis.com`** (zote mbili ni halali).

### Vipande vya HMAC

Kipande cha HMAC ni aina ya _thibitisho_ na inaweza **kuhusishwa na akaunti ya huduma au akaunti ya mtumiaji katika Uhifadhi wa Wingu**. Unatumia kipande cha HMAC kuunda _saini_ ambazo kisha zinaletwa katika maombi kwa Uhifadhi wa Wingu. Saini zinaonyesha kwamba **ombi lililopewa ruhusa na mtumiaji au akaunti ya huduma**.

Vipande vya HMAC vina sehemu mbili kuu, _kitambulisho cha ufikiaji_ na _siri_.

*   **Kitambulisho cha Ufikiaji**: Mnyororo wa alfanumeriki unaoambatishwa na huduma au akaunti ya mtumiaji maalum. Inapounganishwa na akaunti ya huduma, mnyororo ni urefu wa wahusika 61, na inapounganishwa na akaunti ya mtumiaji, mnyororo ni urefu wa wahusika 24. Mfano wa kitambulisho cha ufikiaji ni kama ifuatavyo:

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **Siri**: Mnyororo wa msingi wa 64 wa wahusika ambao unaambatishwa na kitambulisho maalum cha ufikiaji. Siri ni ufunguo uliopangwa mapema ambao wewe na Uhifadhi wa Wingu mnajua tu. Unatumia siri yako kuunda saini kama sehemu ya mchakato wa uthibitisho. Mfano wa siri ni kama ifuatavyo:

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

Zote **kitambulisho cha ufikiaji na siri zinautambulisha kipekee kipande cha HMAC**, lakini siri ni habari nyeti zaidi, kwa sababu inatumika kuunda saini. 

### Uchunguzi
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list
```
Ikiwa unapata kosa la kukataa ruhusa wakati unapopata orodha ya vikombe unaweza bado kuwa na ufikiaji wa yaliyomo. Kwa hivyo, sasa unapojua juu ya mkataba wa majina ya vikombe unaweza kuzalisha orodha ya majina yanayowezekana na kujaribu kuyafikia:
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
### Upandishaji wa Mamlaka

Kwenye ukurasa ufuatao unaweza kuangalia jinsi ya **kutumia ruhusa za uhifadhi kwa kusonga mamlaka**:

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### Upimaji wa Bila Kuidhinishwa

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### Baada ya Kudukuliwa

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### Uimara

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **nifuata** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
