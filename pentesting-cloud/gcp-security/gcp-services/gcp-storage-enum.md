# GCP - √ânum√©ration de stockage

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts Github.**

</details>

## Stockage

Google Cloud Platform (GCP) Storage est une **solution de stockage bas√©e sur le cloud** qui offre un stockage d'objets hautement durable et disponible pour les donn√©es non structur√©es. Il offre **diverses classes de stockage** bas√©es sur les performances, la disponibilit√© et le co√ªt, notamment Standard, Nearline, Coldline et Archive. GCP Storage offre √©galement des fonctionnalit√©s avanc√©es telles que **les strat√©gies de cycle de vie, la versioning et le contr√¥le d'acc√®s** pour g√©rer et s√©curiser efficacement les donn√©es.

Le bucket peut √™tre stock√© dans une r√©gion, dans 2 r√©gions ou **multi-r√©gion (par d√©faut)**.

### Types de stockage

* **Stockage standard** : il s'agit de l'option de stockage par d√©faut qui **offre un acc√®s haute performance et √† faible latence aux donn√©es fr√©quemment consult√©es**. Il convient √† un large √©ventail de cas d'utilisation, notamment la diffusion de contenu de site Web, le streaming multim√©dia et l'h√©bergement de pipelines d'analyse de donn√©es.
* **Stockage Nearline** : cette classe de stockage offre des **co√ªts de stockage inf√©rieurs** et des **co√ªts d'acc√®s l√©g√®rement plus √©lev√©s** que le stockage standard. Il est optimis√© pour les donn√©es consult√©es de mani√®re peu fr√©quente, avec une dur√©e de stockage minimale de 30 jours. Il est id√©al pour les sauvegardes et les archives.
* **Stockage Coldline** : cette classe de stockage est optimis√©e pour le **stockage √† long terme de donn√©es consult√©es de mani√®re peu fr√©quente**, avec une dur√©e de stockage minimale de 90 jours. Il offre les **co√ªts de stockage les plus bas** parmi les options de stockage GCP, mais avec des **co√ªts d'acc√®s plus √©lev√©s**.
* **Stockage Archive** : cette classe de stockage est con√ßue pour les donn√©es froides qui sont consult√©es **tr√®s rarement**, avec une dur√©e de stockage minimale de 365 jours. Il offre les **co√ªts de stockage les plus bas de toutes les options de stockage GCP**, mais avec les **co√ªts d'acc√®s les plus √©lev√©s**. Il convient √† la conservation √† long terme de donn√©es qui doivent √™tre stock√©es pour des raisons de conformit√© ou r√©glementaires.
* **Autoclass** : si vous **ne savez pas combien vous allez acc√©der** aux donn√©es, vous pouvez s√©lectionner Autoclass et GCP **changera automatiquement le type de stockage pour vous minimiser les co√ªts**.

### Contr√¥le d'acc√®s

Par **d√©faut**, il est **recommand√©** de contr√¥ler l'acc√®s via **IAM**, mais il est √©galement possible d'**activer l'utilisation des ACL**.\
Si vous choisissez d'utiliser uniquement IAM (par d√©faut) et **90 passes**, vous **ne pourrez pas activer les ACL** pour le bucket.

### Protection des objets de stockage

### Versioning

Il est possible d'activer la versioning, cela **sauvegardera les anciennes versions du fichier √† l'int√©rieur du bucket**. Il est possible de configurer le **nombre de versions que vous souhaitez conserver** et m√™me **pendant combien de temps** vous souhaitez que les versions **non courantes** (anciennes versions) restent en vie. La recommandation est de **7 jours pour le type Standard**.

Les **m√©tadonn√©es d'une version non courante sont conserv√©es**. De plus, **les ACL des versions non courantes sont √©galement conserv√©es**, de sorte que la version en direct peut avoir des ACL diff√©rentes de la version actuelle.&#x20;

En savoir plus dans la [**documentation**](https://cloud.google.com/storage/docs/object-versioning).

### Politique de r√©tention

Indiquez combien de temps vous souhaitez **interdire la suppression des objets √† l'int√©rieur du bucket** (tr√®s utile pour la conformit√© au moins).\
Seule l'une des **versions ou de la politique de r√©tention peut √™tre activ√©e √† la fois**.

### Chiffrement

Par d√©faut, les objets sont **chiffr√©s √† l'aide de cl√©s g√©r√©es par Google**, mais vous pouvez √©galement utiliser une **cl√© de KMS**.

### √ânum√©ration

```bash
# Liste tous les buckets de stockage dans le projet
gsutil ls

# Obtenir la configuration de chaque bucket (protections, CLs, temps, configurations...)
gsutil ls -L

# Liste le contenu d'un bucket sp√©cifique
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # R√©cursif
gsutil ls -a gs://bucket-name/ # Obtenir TOUTES les versions des objets

# Afficher le contenu d'un fichier sans le copier localement
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # Afficher une version sp√©cifique

# Copier un objet du bucket vers votre stockage local pour examen
gsutil cp gs://bucket-name/folder/object ~/

# Liste en utilisant un jeton OAuth brut
## Utile car "CLOUDSDK_AUTH_ACCESS_TOKEN" et "gcloud config set auth/access_token_file" ne fonctionnent pas avec gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# T√©l√©charger le contenu du fichier √† partir du bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -
```

Si vous obtenez une erreur de permission refus√©e lors de la liste des buckets, vous pouvez toujours avoir acc√®s au contenu. Maintenant que vous connaissez la convention de nom