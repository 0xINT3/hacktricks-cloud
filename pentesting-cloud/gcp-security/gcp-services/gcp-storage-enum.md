# GCP - Enumerazione dello Storage

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di github.

</details>

## Storage

Google Cloud Platform (GCP) Storage √® una **soluzione di storage basata su cloud** che fornisce uno storage di oggetti altamente durevole e disponibile per dati non strutturati. Offre **diverse classi di storage** basate su prestazioni, disponibilit√† e costo, tra cui Standard, Nearline, Coldline e Archive. GCP Storage fornisce anche funzionalit√† avanzate come **policy di ciclo di vita, versioning e controllo degli accessi** per gestire e proteggere i dati in modo efficace.

Il bucket pu√≤ essere archiviato in una regione, in 2 regioni o **multi-regione (predefinito)**.

### Tipi di Storage

* **Standard Storage**: Questa √® l'opzione di storage predefinita che **offre un accesso ad alta performance e a bassa latenza ai dati frequentemente accessibili**. √à adatto a una vasta gamma di casi d'uso, tra cui la fornitura di contenuti per siti web, lo streaming di media e l'hosting di pipeline di analisi dei dati.
* **Nearline Storage**: Questa classe di storage offre **costi di storage inferiori** e **costi di accesso leggermente pi√π alti** rispetto allo Standard Storage. √à ottimizzato per i dati a cui si accede raramente, con una durata di archiviazione minima di 30 giorni. √à ideale per scopi di backup e archiviazione.
* **Coldline Storage**: Questa classe di storage √® ottimizzata per lo **storage a lungo termine di dati a cui si accede raramente**, con una durata di archiviazione minima di 90 giorni. Offre **costi di storage inferiori** rispetto al Nearline Storage, ma con **costi di accesso pi√π alti**.
* **Archive Storage**: Questa classe di storage √® progettata per dati freddi a cui si accede **molto raramente**, con una durata di archiviazione minima di 365 giorni. Offre i **costi di storage pi√π bassi tra tutte le opzioni di storage di GCP**, ma con i **costi di accesso pi√π alti**. √à adatto per la conservazione a lungo termine di dati che devono essere archiviati per motivi di conformit√† o regolamentari.
* **Autoclass**: Se **non sai quanto accederai** ai dati, puoi selezionare Autoclass e GCP **cambier√† automaticamente il tipo di storage per minimizzare i costi**.

### Controllo degli Accessi

Per impostazione **predefinita** √® **consigliato** controllare l'accesso tramite **IAM**, ma √® anche possibile **abilitare l'uso delle ACL**.\
Se si seleziona di utilizzare solo IAM (predefinito) e **passano 90 giorni**, non sar√† possibile abilitare le ACL per il bucket.

### Versioning

√à possibile abilitare il versioning, questo **salver√† le vecchie versioni del file all'interno del bucket**. √à possibile configurare il **numero di versioni che si desidera mantenere** e anche **per quanto tempo** si desidera che le versioni non correnti (vecchie versioni) rimangano. La durata consigliata √® di **7 giorni per il tipo Standard**.

I **metadati di una versione non corrente vengono conservati**. Inoltre, **le ACL delle versioni non correnti vengono anche conservate**, quindi le versioni pi√π vecchie potrebbero avere ACL diverse dalla versione corrente.

Per saperne di pi√π nella [**documentazione**](https://cloud.google.com/storage/docs/object-versioning).

### Politica di Conservazione

Indica per quanto **tempo** si desidera **impedire la cancellazione degli oggetti all'interno del bucket** (molto utile per la conformit√† almeno).\
Solo una delle **versioning o politica di conservazione pu√≤ essere abilitata contemporaneamente**.

### Crittografia

Per impostazione predefinita, gli oggetti vengono **criptati utilizzando chiavi gestite da Google**, ma √® anche possibile utilizzare una **chiave da KMS**.

### Accesso Pubblico

√à possibile dare **accesso ai contenuti dei bucket a utenti esterni** (loggati o meno in GCP). \
Per impostazione predefinita, quando viene creato un bucket, l'opzione di **esporre pubblicamente** il bucket sar√† **disabilitata**, ma con le autorizzazioni sufficienti pu√≤ essere modificata.

Il **formato di un URL** per accedere a un bucket √® **`https://storage.googleapis.com/<nome-bucket>` o `https://<nome-bucket>.storage.googleapis.com`** (entrambi sono validi).

### Chiavi HMAC

Una chiave HMAC √® un tipo di _credenziale_ e pu√≤ essere **associata a un account di servizio o a un account utente in Cloud Storage**. Si utilizza una chiave HMAC per creare _firme_ che vengono quindi incluse nelle richieste a Cloud Storage. Le firme mostrano che una **data richiesta √® autorizzata dall'utente o dall'account di servizio**.

Le chiavi HMAC hanno due componenti principali, un _ID di accesso_ e un _segreto_.

*   **ID di accesso**: Una stringa alfanumerica collegata a un determinato account di servizio o utente. Quando collegato a un account di servizio, la stringa √® lunga 61 caratteri, mentre quando collegato a un account utente, la stringa √® lunga 24 caratteri. Di seguito viene mostrato un esempio di ID di accesso:

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **Segreto**: Una stringa codificata in Base-64 di 40 caratteri che √® collegata a un determinato ID di accesso. Un segreto √® una chiave precondivisa che solo tu e Cloud Storage conoscete. Utilizzi il tuo segreto per creare firme come parte del processo di autenticazione. Di seguito viene mostrato un esempio di segreto:

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

Sia l'**ID di accesso che il segreto identificano univocamente una chiave HMAC**, ma il segreto √® un'informazione molto pi√π sensibile, perch√© viene utilizzato per **creare firme**.

### Enumerazione
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list
```
Se ricevi un errore di permesso negato durante l'elenco dei bucket, potresti comunque avere accesso ai contenuti. Quindi, ora che conosci la convenzione di denominazione dei bucket, puoi generare un elenco di possibili nomi e provare ad accedervi:
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
### Escalazione dei privilegi

Nella seguente pagina puoi verificare come **abusare dei permessi di archiviazione per escalare i privilegi**:

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### Enumerazione non autenticata

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### Post Esploitation

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### Persistenza

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
