# GCP - Enumera√ß√£o de Armazenamento

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

## Armazenamento

O Google Cloud Platform (GCP) Storage √© uma **solu√ß√£o de armazenamento baseada em nuvem** que fornece armazenamento de objetos altamente dur√°vel e dispon√≠vel para dados n√£o estruturados. Ele oferece **v√°rios tipos de armazenamento** com base em desempenho, disponibilidade e custo, incluindo Standard, Nearline, Coldline e Archive. O GCP Storage tamb√©m fornece recursos avan√ßados, como **pol√≠ticas de ciclo de vida, versionamento e controle de acesso** para gerenciar e proteger dados de forma eficaz.

O bucket pode ser armazenado em uma regi√£o, em 2 regi√µes ou **multi-regi√£o (padr√£o)**.

### Tipos de Armazenamento

* **Armazenamento Padr√£o**: esta √© a op√ß√£o de armazenamento padr√£o que **oferece acesso de alta performance e baixa lat√™ncia a dados acessados com frequ√™ncia**. √â adequado para uma ampla gama de casos de uso, incluindo servir conte√∫do de site, streaming de m√≠dia e hospedagem de pipelines de an√°lise de dados.
* **Armazenamento Nearline**: esta classe de armazenamento oferece **custos de armazenamento mais baixos** e **custos de acesso ligeiramente mais altos** do que o Armazenamento Padr√£o. √â otimizado para dados acessados com pouca frequ√™ncia, com uma dura√ß√£o m√≠nima de armazenamento de 30 dias. √â ideal para fins de backup e arquivamento.
* **Armazenamento Coldline**: esta classe de armazenamento √© otimizada para **armazenamento de longo prazo de dados acessados com pouca frequ√™ncia**, com uma dura√ß√£o m√≠nima de armazenamento de 90 dias. Oferece os **custos de armazenamento mais baixos** do que o Armazenamento Nearline, mas com **custos de acesso mais altos**.
* **Armazenamento de Arquivo**: esta classe de armazenamento √© projetada para dados frios que s√£o acessados **muito raramente**, com uma dura√ß√£o m√≠nima de armazenamento de 365 dias. Oferece os **custos de armazenamento mais baixos de todas as op√ß√µes de armazenamento do GCP**, mas com os **custos de acesso mais altos**. √â adequado para reten√ß√£o de dados de longo prazo que precisam ser armazenados por motivos de conformidade ou regulamentares.
* **Autoclass**: se voc√™ **n√£o sabe quanto vai acessar** os dados, pode selecionar Autoclass e o GCP **mudar√° automaticamente o tipo de armazenamento para minimizar os custos**.

### Controle de Acesso

Por **padr√£o**, √© **recomendado** controlar o acesso por meio do **IAM**, mas tamb√©m √© poss√≠vel **ativar o uso de ACLs**.\
Se voc√™ selecionar usar apenas IAM (padr√£o) e **90 dias se passarem**, voc√™ **n√£o poder√° habilitar ACLs** para o bucket.

### Prote√ß√£o de Objetos de Armazenamento

### Versionamento

√â poss√≠vel habilitar o versionamento, isso ir√° **salvar vers√µes antigas do arquivo dentro do bucket**. √â poss√≠vel configurar o **n√∫mero de vers√µes que voc√™ deseja manter** e at√© mesmo **por quanto tempo** voc√™ deseja que as vers√µes **n√£o atuais** (vers√µes antigas) permane√ßam. O recomendado √© **7 dias para o tipo Standard**.

Os **metadados de uma vers√£o n√£o atual s√£o mantidos**. Al√©m disso, **as ACLs das vers√µes n√£o atuais tamb√©m s√£o mantidas**, ent√£o a vers√£o mais recente pode ter ACLs diferentes da vers√£o atual.&#x20;

Saiba mais na [**documenta√ß√£o**](https://cloud.google.com/storage/docs/object-versioning).

### Pol√≠tica de Reten√ß√£o

Indique por quanto tempo voc√™ deseja **proibir a exclus√£o de objetos dentro do bucket** (muito √∫til para conformidade, pelo menos).\
Apenas um dos **versionamento ou pol√≠tica de reten√ß√£o pode ser habilitado ao mesmo tempo**.

### Criptografia

Por padr√£o, os objetos s√£o **criptografados usando chaves gerenciadas pelo Google**, mas voc√™ tamb√©m pode usar uma **chave do KMS**.

### Enumera√ß√£o

```bash
# Listar todos os buckets de armazenamento no projeto
gsutil ls

# Obter a configura√ß√£o de cada bucket (prote√ß√µes, CLs, tempos, configura√ß√µes...)
gsutil ls -L

# Listar o conte√∫do de um bucket espec√≠fico
gsutil ls gs://nome-do-bucket/
gsutil ls -r gs://nome-do-bucket/ # Recursivo
gsutil ls -a gs://nome-do-bucket/ # Obter TODAS as vers√µes de objetos

# Exibir o conte√∫do de um arquivo sem copi√°-lo localmente
gsutil cat 'gs://nome-do-bucket/pasta/objeto'
gsutil cat 'gs://nome-do-bucket/pasta/objeto#<num>' # exibir vers√£o espec√≠fica

# Copiar um objeto do bucket para o seu armazenamento local para revis√£o
gsutil cp gs://nome-do-bucket/pasta/objeto ~/

# Listar usando um token OAuth bruto
## √ötil porque "CLOUDSDK_AUTH_ACCESS_TOKEN" e "gcloud config set auth/access_token_file" n√£o funcionam com gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<nome-do-armazenamento>/o"
# Baixar o conte√∫do do arquivo do bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -
```

Se voc√™ receber um erro de permiss√£o negada ao listar buckets, ainda poder√° ter acesso ao conte√∫do. Ent√£o, agora que voc√™ conhece a conven√ß√£o de nomenclatura dos buckets,