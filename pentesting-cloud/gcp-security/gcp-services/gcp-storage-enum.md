# GCP - Depolama Enumerasyonu

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki özel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>

## Depolama

Google Cloud Platform (GCP) Depolama, yapılandırılmamış veriler için **yüksek dayanıklılığa ve kullanılabilirliğe sahip bulut tabanlı bir depolama çözümü** sağlar. Standart, Nearline, Coldline ve Archive olmak üzere performans, kullanılabilirlik ve maliyet temelinde çeşitli depolama sınıfları sunar. GCP Depolama, verileri etkili bir şekilde yönetmek ve güvence altına almak için **yaşam döngüsü politikaları, sürümleme ve erişim kontrolü** gibi gelişmiş özellikler de sunar.

Kova bir bölgede, 2 bölgede veya **çoklu bölgede (varsayılan olarak)** depolanabilir.

### Depolama Türleri

* **Standart Depolama**: Bu, sık erişilen verilere **yüksek performanslı, düşük gecikmeli erişim** sunan varsayılan depolama seçeneğidir. Web sitesi içeriği sunma, medya akışı ve veri analitiği boru hatları barındırma gibi geniş bir kullanım durumu için uygundur.
* **Nearline Depolama**: Bu depolama sınıfı, Standart Depolama'ya göre **daha düşük depolama maliyetleri** ve **biraz daha yüksek erişim maliyetleri** sunar. En az 30 günlük bir depolama süresiyle seyrek erişilen veriler için optimize edilmiştir. Yedekleme ve arşivleme amaçları için uygundur.
* **Coldline Depolama**: Bu depolama sınıfı, **seyrek erişilen verilerin uzun süreli depolanması** için optimize edilmiştir ve en az 90 günlük bir depolama süresine sahiptir. Nearline Depolama'ya göre **daha düşük depolama maliyetleri**, ancak **daha yüksek erişim maliyetleri** sunar.
* **Archive Depolama**: Bu depolama sınıfı, **çok seyrek erişilen soğuk veriler** için tasarlanmış olup, en az 365 günlük bir depolama süresine sahiptir. Tüm GCP depolama seçeneklerinin **en düşük depolama maliyetlerini** sunar, ancak **en yüksek erişim maliyetleri** ile birlikte gelir. Uyumluluk veya düzenleyici gereksinimler nedeniyle uzun süreli veri saklama için uygundur.
* **Otomatik Sınıflandırma**: Veriye ne kadar erişeceğinizi **bilmiyorsanız**, Otomatik Sınıflandırmayı seçebilir ve GCP, maliyetleri en aza indirmek için **otomatik olarak depolama türünü değiştirir**.

### Erişim Kontrolü

**Varsayılan olarak**, erişimi **IAM** aracılığıyla kontrol etmek **önerilir**, ancak **ACL'leri etkinleştirmek de mümkündür**.\
Yalnızca IAM kullanmayı seçerseniz (varsayılan olarak) ve **90 gün geçerse**, kovada **ACL'leri etkinleştiremezsiniz**.

### Sürümleme

Sürümleme etkinleştirilebilir, bu durumda **kova içindeki eski sürümler kaydedilir**. **Saklamak istediğiniz sürüm sayısını** ve hatta **eski sürümlerin (eski sürümler) ne kadar süreyle yaşayacağını** yapılandırmanız mümkündür. Önerilen, **Standart tür için 7 gün**'dür.

**Eski bir sürümün meta verileri saklanır**. Dahası, **eski sürümlerin ACL'leri de saklanır**, bu nedenle eski sürümler mevcut sürümden farklı ACL'lere sahip olabilir.

Daha fazlasını [**belgelerde**](https://cloud.google.com/storage/docs/object-versioning) öğrenin.

### Saklama Politikası

Kovadaki Nesnelerin **silinmesini ne kadar süreyle yasaklamak istediğinizi** belirtin (en azından uyumluluk için çok kullanışlı).\
**Sürümleme veya saklama politikasından yalnızca biri aynı anda etkinleştirilebilir**.

### Şifreleme

Varsayılan olarak, nesneler **Google tarafından yönetilen anahtarlar kullanılarak şifrelenir**, ancak aynı zamanda bir **KMS anahtarı** da kullanabilirsiniz.

### Genel Erişim

**Harici kullanıcılara** (GCP'ye giriş yapmış veya yapmamış) **kova içeriğine erişim** vermek mümkündür. \
Bir kova oluşturulduğunda, kovanın **genel olarak açığa çıkarılma seçeneği devre dışı bırakılmış** olacaktır, ancak yeterli izinlerle değiştirilebilir.

Bir kovaya erişmek için bir URL'nin **biçimi** **`https://storage.googleapis.com/<bucket-name>` veya `https://<bucket_name>.storage.googleapis.com`**'dur (her ikisi de geçerlidir).

### HMAC Anahtarları

Bir HMAC anahtarı, bir hizmet hesabı veya Cloud Storage'da bir kullanıcı hesabıyla ilişkilendirilebilen bir tür _kimlik bilgisidir_. Bir HMAC anahtarı, Cloud Storage'a yapılan isteklere dahil edilen _imzaları_ oluşturmak için kullanılır. İmzalar, bir **belirli isteğin kullanıcı veya hizmet hesabı tarafından yetkilendirildiğini gösterir**.

HMAC anahtarlarının iki temel parçası vardır, bir _erişim kimliği_ ve bir _gizli_.

*   **Erişim Kimliği**: Bir hizmet veya kullanıcı hesabına bağlı olan alfasayısal bir dizedir. Bir hizmet hesabına bağlandığında, dize 61 karakter uzunluğundadır ve bir kullanıcı hesabına bağlandığında, dize 24 karakter uzunluğundadır. Aşağıda bir erişim kimliği örneği gösterilmektedir:

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **Gizli**: Bir 40 karakterlik Base-64 kodlanmış dizedir ve belirli bir erişim kimliğiyle ilişkilidir. Gizli, yalnızca sizin ve Cloud Storage tarafından bilinen bir önceden paylaşılmış anahtardır. Kimlik doğrulama sürecinin bir parçası olarak imzalar oluşturmak için gizliyi kullanırsınız. Aşağıda bir gizli örneği gösterilmektedir:

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

**Erişim kimliği ve gizli, bir HMAC anahtarını benzersiz bir şekilde tanımlar**, ancak gizli, imzalar oluşturmak için kullanıldığı için çok daha hassas bilgidir.

### Enumerasyon
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list
```
Eğer kovaları listelerken izin reddedildi hatası alırsanız, içeriğe hala erişiminiz olabilir. Bu yüzden, kovaların adlandırma kuralını bildiğiniz için olası adlar listesi oluşturabilir ve bunlara erişmeyi deneyebilirsiniz:
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
### Yetki Yükseltme

Aşağıdaki sayfada, **yetki yükseltmek için depolama izinlerini kötüye kullanma** yöntemlerini kontrol edebilirsiniz:

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### Kimlik Doğrulamasız Sorgulama

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### Saldırı Sonrası

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>
