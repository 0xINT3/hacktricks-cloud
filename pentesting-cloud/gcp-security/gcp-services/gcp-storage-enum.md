# GCP - Speicher Enumeration

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys einreichen.

</details>

## Speicher

Google Cloud Platform (GCP) Storage ist eine **cloud-basierte Speicherl√∂sung**, die hochdauerhaften und verf√ºgbaren Objektspeicher f√ºr unstrukturierte Daten bietet. Es bietet **verschiedene Speicherklassen** basierend auf Leistung, Verf√ºgbarkeit und Kosten, einschlie√ülich Standard, Nearline, Coldline und Archive. GCP Storage bietet auch erweiterte Funktionen wie **Lebenszyklusrichtlinien, Versionierung und Zugriffskontrolle**, um Daten effektiv zu verwalten und zu sichern.

Der Bucket kann in einer Region, in 2 Regionen oder **Multi-Region (Standard)** gespeichert werden.

### Speichertypen

* **Standard-Speicher**: Dies ist die Standard-Speicheroption, die **einen leistungsstarken, latenzarmen Zugriff auf h√§ufig abgerufene Daten** bietet. Es eignet sich f√ºr eine Vielzahl von Anwendungsf√§llen, einschlie√ülich Bereitstellung von Website-Inhalten, Streaming-Medien und Hosting von Datenanalyse-Pipelines.
* **Nearline-Speicher**: Diese Speicherkategorie bietet **niedrigere Speicherkosten** und **etwas h√∂here Zugriffskosten** als Standard-Speicher. Es ist optimiert f√ºr selten abgerufene Daten, mit einer Mindestspeicherdauer von 30 Tagen. Es eignet sich ideal f√ºr Backup- und Archivierungszwecke.
* **Coldline-Speicher**: Diese Speicherkategorie ist optimiert f√ºr **Langzeitspeicherung selten abgerufener Daten**, mit einer Mindestspeicherdauer von 90 Tagen. Es bietet **niedrigere Speicherkosten** als Nearline-Speicher, aber mit **h√∂heren Zugriffskosten**.
* **Archive-Speicher**: Diese Speicherkategorie ist f√ºr kalte Daten konzipiert, die **sehr selten abgerufen werden**, mit einer Mindestspeicherdauer von 365 Tagen. Es bietet die **niedrigsten Speicherkosten aller GCP-Speicheroptionen**, aber mit den **h√∂chsten Zugriffskosten**. Es eignet sich f√ºr die langfristige Aufbewahrung von Daten, die aus Compliance- oder regulatorischen Gr√ºnden gespeichert werden m√ºssen.
* **Autoklasse**: Wenn Sie **nicht wissen, wie oft Sie auf die Daten zugreifen werden**, k√∂nnen Sie Autoklasse ausw√§hlen, und GCP wird **automatisch den Speichertyp √§ndern, um Kosten zu minimieren**.

### Zugriffskontrolle

Es wird **standardm√§√üig** empfohlen, den Zugriff √ºber **IAM** zu steuern, aber es ist auch m√∂glich, die Verwendung von ACLs zu **aktivieren**.\
Wenn Sie sich daf√ºr entscheiden, nur IAM zu verwenden (Standard) und **90 Tage vergangen sind**, k√∂nnen Sie **ACLs nicht f√ºr den Bucket aktivieren**.

### Versionierung

Es ist m√∂glich, die Versionierung zu aktivieren, dies wird **alte Versionen der Datei im Bucket speichern**. Es ist m√∂glich, die **Anzahl der Versionen, die Sie behalten m√∂chten**, zu konfigurieren und sogar **wie lange** Sie m√∂chten, dass **nicht aktuelle** Versionen (alte Versionen) bestehen bleiben. Empfohlen sind **7 Tage f√ºr den Standardtyp**.

Die **Metadaten einer nicht aktuellen Version werden beibehalten**. Dar√ºber hinaus werden auch **ACLs nicht aktueller Versionen beibehalten**, sodass √§ltere Versionen m√∂glicherweise unterschiedliche ACLs von der aktuellen Version haben.

Erfahren Sie mehr in der [**Dokumentation**](https://cloud.google.com/storage/docs/object-versioning).

### Aufbewahrungsrichtlinie

Geben Sie an, wie **lange** Sie die **L√∂schung von Objekten im Bucket verbieten** m√∂chten (sehr n√ºtzlich f√ºr die Einhaltung von Vorschriften).\
Nur eine von **Versionierung oder Aufbewahrungsrichtlinie kann gleichzeitig aktiviert sein**.

### Verschl√ºsselung

Standardm√§√üig werden Objekte **mit von Google verwalteten Schl√ºsseln verschl√ºsselt**, aber Sie k√∂nnten auch einen **Schl√ºssel von KMS** verwenden.

### √ñffentlicher Zugriff

Es ist m√∂glich, **externen Benutzern** (angemeldet in GCP oder nicht) **Zugriff auf den Inhalt von Buckets zu gew√§hren**. \
Standardm√§√üig wird bei der Erstellung eines Buckets die Option, den Bucket √∂ffentlich freizugeben, **deaktiviert**, aber mit ausreichenden Berechtigungen kann dies ge√§ndert werden.

Das **Format einer URL** zum Zugriff auf einen Bucket lautet **`https://storage.googleapis.com/<bucket-name>` oder `https://<bucket_name>.storage.googleapis.com`** (beide sind g√ºltig).

### HMAC-Schl√ºssel

Ein HMAC-Schl√ºssel ist ein Typ von _Anmeldeinformation_ und kann mit einem Dienstkonto oder einem Benutzerkonto in Cloud Storage **verkn√ºpft werden**. Sie verwenden einen HMAC-Schl√ºssel, um _Signaturen_ zu erstellen, die dann in Anfragen an Cloud Storage enthalten sind. Signaturen zeigen, dass eine **bestimmte Anfrage vom Benutzer oder Dienstkonto autorisiert ist**.

HMAC-Schl√ºssel haben zwei Hauptbestandteile, eine _Zugriffs-ID_ und ein _Geheimnis_.

*   **Zugriffs-ID**: Eine alphanumerische Zeichenfolge, die mit einem bestimmten Dienst- oder Benutzerkonto verkn√ºpft ist. Wenn sie mit einem Dienstkonto verkn√ºpft ist, betr√§gt die Zeichenfolge 61 Zeichen, und wenn sie mit einem Benutzerkonto verkn√ºpft ist, betr√§gt die Zeichenfolge 24 Zeichen. Im Folgenden wird ein Beispiel f√ºr eine Zugriffs-ID gezeigt:

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **Geheimnis**: Eine 40 Zeichen lange Base-64-codierte Zeichenfolge, die mit einer bestimmten Zugriffs-ID verkn√ºpft ist. Ein Geheimnis ist ein vorab freigegebener Schl√ºssel, den nur Sie und Cloud Storage kennen. Sie verwenden Ihr Geheimnis, um Signaturen im Rahmen des Authentifizierungsprozesses zu erstellen. Im Folgenden wird ein Beispiel f√ºr ein Geheimnis gezeigt:

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

Sowohl die **Zugriffs-ID als auch das Geheimnis identifizieren einen HMAC-Schl√ºssel eindeutig**, aber das Geheimnis ist wesentlich sensiblere Information, da es verwendet wird, um **Signaturen zu erstellen**.

### Enumeration
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list
```
Wenn Sie beim Auflisten von Buckets einen Berechtigungsfehler erhalten, haben Sie m√∂glicherweise immer noch Zugriff auf den Inhalt. Jetzt, da Sie √ºber die Namenskonvention der Buckets Bescheid wissen, k√∂nnen Sie eine Liste m√∂glicher Namen generieren und versuchen, auf sie zuzugreifen:
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
Mit den Berechtigungen `storage.objects.list` und `storage.objects.get` sollten Sie in der Lage sein, alle Ordner und Dateien aus dem Bucket aufzulisten, um sie herunterzuladen. Dies kann mit diesem Python-Skript erreicht werden:
```python
import requests
import xml.etree.ElementTree as ET

def list_bucket_objects(bucket_name, prefix='', marker=None):
url = f"https://storage.googleapis.com/{bucket_name}?prefix={prefix}"
if marker:
url += f"&marker={marker}"
response = requests.get(url)
xml_data = response.content
root = ET.fromstring(xml_data)
ns = {'ns': 'http://doc.s3.amazonaws.com/2006-03-01'}
for contents in root.findall('.//ns:Contents', namespaces=ns):
key = contents.find('ns:Key', namespaces=ns).text
print(key)
next_marker = root.find('ns:NextMarker', namespaces=ns)
if next_marker is not None:
next_marker_value = next_marker.text
list_bucket_objects(bucket_name, prefix, next_marker_value)

list_bucket_objects('<storage-name>')
```
### Privilege Escalation

Auf der folgenden Seite k√∂nnen Sie nachschauen, wie Sie **Speicherberechtigungen missbrauchen, um Privilegien zu eskalieren**:

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### Unauthenticated Enum

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Heldenniveau mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
