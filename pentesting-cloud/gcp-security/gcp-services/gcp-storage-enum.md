# GCP - 스토리지 열거

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)을 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

## 스토리지

Google Cloud Platform (GCP) 스토리지는 구조화되지 않은 데이터를 위한 **고도로 내구성이 있고 사용 가능한 객체 스토리지**를 제공하는 **클라우드 기반 스토리지 솔루션**입니다. 이는 성능, 가용성 및 비용을 기반으로 하는 **다양한 스토리지 클래스**를 제공하며, 표준, Nearline, Coldline 및 Archive를 포함합니다. GCP 스토리지는 또한 **라이프사이클 정책, 버전 관리 및 액세스 제어**와 같은 고급 기능을 제공하여 데이터를 효과적으로 관리하고 보안할 수 있습니다.

버킷은 **지역, 2개의 지역 또는 다중 지역 (기본값)**에 저장될 수 있습니다.

### 스토리지 유형

* **표준 스토리지**: 이는 **빈번하게 액세스되는 데이터에 대한 고성능 및 낮은 대기 시간 액세스**를 제공하는 기본 스토리지 옵션입니다. 웹 사이트 콘텐츠 제공, 미디어 스트리밍 및 데이터 분석 파이프라인 호스팅을 포함한 다양한 사용 사례에 적합합니다.
* **Nearline 스토리지**: 이 스토리지 클래스는 표준 스토리지보다 **낮은 스토리지 비용**과 **약간 더 높은 액세스 비용**을 제공합니다. 최소 스토리지 기간은 30일이며, 드물게 액세스되는 데이터에 최적화되어 있습니다. 백업 및 보관용으로 이상적입니다.
* **Coldline 스토리지**: 이 스토리지 클래스는 **드물게 액세스되는 데이터의 장기 저장**에 최적화되어 있으며, 최소 스토리지 기간은 90일입니다. Nearline 스토리지보다 **낮은 스토리지 비용**을 제공하지만 **더 높은 액세스 비용**이 있습니다.
* **Archive 스토리지**: 이 스토리지 클래스는 **매우 드물게 액세스되는 차가운 데이터**에 대해 설계되었으며, 최소 스토리지 기간은 365일입니다. 모든 GCP 스토리지 옵션 중 **가장 낮은 스토리지 비용**을 제공하지만 **가장 높은 액세스 비용**이 있습니다. 규정 준수 또는 규제 요건을 충족해야 하는 데이터의 장기 보존에 적합합니다.
* **Autoclass**: 데이터에 대한 액세스 양을 **정확히 모르는 경우** Autoclass를 선택하고 GCP가 **비용을 최소화하기 위해 스토리지 유형을 자동으로 변경**합니다.

### 액세스 제어

기본적으로 액세스는 **IAM을 통해 제어하는 것이 권장**되지만, **ACL의 사용을 활성화**할 수도 있습니다.\
IAM만 사용하도록 선택하고 **90일이 지나면** 버킷에 대해 **ACL을 활성화할 수 없습니다**.

### 버전 관리

버전 관리를 활성화할 수 있으며, 이는 **버킷 내부에 파일의 이전 버전을 저장**합니다. **유지할 버전 수**를 구성하고 심지어 **비현재 버전** (이전 버전)이 유지될 **기간**을 구성할 수 있습니다. 표준 유형의 경우 **7일을 권장**합니다.

**비현재 버전의 메타데이터는 유지**됩니다. 또한, **비현재 버전의 ACL도 유지**되므로 이전 버전은 현재 버전과 다른 ACL을 가질 수 있습니다.

자세한 내용은 [**문서**](https://cloud.google.com/storage/docs/object-versioning)를 참조하세요.

### 보존 정책

버킷 내부의 객체 삭제를 **금지할 기간**을 지정합니다 (최소한 규정 준수에 매우 유용).\
**버전 관리 또는 보존 정책 중 하나만 활성화**할 수 있습니다.

### 암호화

기본적으로 객체는 **Google 관리 키를 사용하여 암호화**됩니다. 그러나 **KMS의 키**를 사용할 수도 있습니다.

### 공개 액세스

외부 사용자 (GCP에 로그인한 경우 또는 그렇지 않은 경우)에게 **버킷 콘텐츠에 대한 액세스 권한을 부여**할 수 있습니다.\
기본적으로 버킷이 생성될 때는 **공개로 노출하는 옵션이 비활성화**되지만, 충분한 권한이 있는 경우 변경할 수 있습니다.

버킷에 액세스하기 위한 **URL 형식**은 **`https://storage.googleapis.com/<bucket-name>` 또는 `https://<bucket_name>.storage.googleapis.com`** (둘 다 유효)입니다.

### HMAC 키

HMAC 키는 Cloud Storage의 서비스 계정이나 사용자 계정과 **연결**될 수 있는 **인증 정보** 유형 중 하나입니다. HMAC 키를 사용하여 Cloud Storage에 대한 요청에 포함되는 **서명**을 생성합니다. 서명은 **주어진 요청이 사용자 또는 서비스 계정에 의해 인증**된 것을 나타냅니다.

HMAC 키에는 **액세스 ID**와 **비밀**이라는 두 가지 주요 요소가 있습니다.

*   **액세스 ID**: 특정 서비스 또는 사용자 계정에 연결된 영숫자 문자열입니다. 서비스 계정에 연결된 경우 문자열은 61자이며, 사용자 계정에 연결된 경우 문자열은 24자입니다. 다음은 액세스 ID의 예시입니다:

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **비밀**: 특정 액세스 ID에 연결된 40자리 Base-64 인코딩된 문자열입니다. 비밀은 당신과 Cloud Storage만 알고 있는 사전 공유 키입니다. 인증 프로세스의 일부로 서명을 생성하는 데 비밀을 사용합니다. 다음은 비밀의 예시입니다:

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

**액세스 ID와 비밀은 HMAC 키를 고유하게 식별**하지만, 비밀은 서명 생성에 사용되기 때문에 훨씬 더 민감한 정보입니다.

### 열거
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list
```
만약 버킷을 나열할 때 권한 거부 오류가 발생하면 여전히 콘텐츠에 액세스할 수 있을 수 있습니다. 그래서 이제 버킷의 이름 규칙에 대해 알게 되었으므로 가능한 이름 목록을 생성하고 액세스를 시도해 볼 수 있습니다:
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
### 권한 상승

다음 페이지에서는 **권한 상승을 위해 저장소 권한을 남용하는 방법**을 확인할 수 있습니다:

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### 인증되지 않은 열거

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### 후반 공격

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### 지속성

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* 회사를 **HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 상품**](https://peass.creator-spring.com)을 구매하세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFT**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)을 **팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 **해킹 기법을 공유**하세요.

</details>
