# GCP - Enumeraci칩n de almacenamiento

<details>

<summary><strong>춰Apoya a HackTricks y obt칠n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **칰ltima versi칩n de PEASS o descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Almacenamiento

Google Cloud Platform (GCP) Storage es una soluci칩n de almacenamiento basada en la nube que proporciona almacenamiento de objetos altamente duradero y disponible para datos no estructurados. Ofrece varias clases de almacenamiento basadas en el rendimiento, la disponibilidad y el costo, incluyendo Standard, Nearline, Coldline y Archive. GCP Storage tambi칠n proporciona caracter칤sticas avanzadas como pol칤ticas de ciclo de vida, versionado y control de acceso para administrar y asegurar los datos de manera efectiva.

El bucket se puede almacenar en una regi칩n, en 2 regiones o **multi-regi칩n (predeterminado)**.

### Tipos de almacenamiento

* **Almacenamiento est치ndar**: esta es la opci칩n de almacenamiento predeterminada que **ofrece acceso de alta velocidad y baja latencia a datos de acceso frecuente**. Es adecuado para una amplia gama de casos de uso, incluyendo la entrega de contenido de sitios web, la transmisi칩n de medios y el alojamiento de canalizaciones de an치lisis de datos.
* **Almacenamiento Nearline**: esta clase de almacenamiento ofrece **costos de almacenamiento m치s bajos** y **costos de acceso ligeramente m치s altos** que el almacenamiento est치ndar. Est치 optimizado para datos de acceso poco frecuente, con una duraci칩n m칤nima de almacenamiento de 30 d칤as. Es ideal para fines de copia de seguridad y archivo.
* **Almacenamiento Coldline**: esta clase de almacenamiento est치 optimizada para el **almacenamiento a largo plazo de datos de acceso poco frecuente**, con una duraci칩n m칤nima de almacenamiento de 90 d칤as. Ofrece los **costos de almacenamiento m치s bajos** que el almacenamiento Nearline, pero con **costos de acceso m치s altos**.
* **Almacenamiento de archivo**: esta clase de almacenamiento est치 dise침ada para datos fr칤os que se acceden **muy raramente**, con una duraci칩n m칤nima de almacenamiento de 365 d칤as. Ofrece los **costos de almacenamiento m치s bajos de todas las opciones de almacenamiento de GCP**, pero con los **costos de acceso m치s altos**. Es adecuado para la retenci칩n a largo plazo de datos que deben almacenarse por motivos de cumplimiento o regulaci칩n.
* **Autoclass**: si **no sabes cu치nto vas a acceder** a los datos, puedes seleccionar Autoclass y GCP **cambiar치 autom치ticamente el tipo de almacenamiento para minimizar los costos**.

### Control de acceso

Por **defecto**, se **recomienda** controlar el acceso a trav칠s de **IAM**, pero tambi칠n es posible **habilitar el uso de ACL**.\
Si selecciona usar solo IAM (predeterminado) y **90 pases**, **no podr치s habilitar ACL** para el bucket.

### Protecci칩n de objetos de almacenamiento

### Versionado

Es posible habilitar el versionado, esto **guardar치 las versiones antiguas del archivo dentro del bucket**. Es posible configurar el **n칰mero de versiones que deseas mantener** e incluso **cu치nto tiempo** deseas que las versiones **no actuales** (versiones antiguas) vivan. Se recomienda **7 d칤as para el tipo Standard**.

Se mantiene el **metadata de una versi칩n no actual**. Adem치s, **se mantienen los ACL de las versiones no actuales**, por lo que la versi칩n en vivo puede tener ACL diferentes de la versi칩n actual.&#x20;

Obt칠n m치s informaci칩n en la [**documentaci칩n**](https://cloud.google.com/storage/docs/object-versioning).

### Pol칤tica de retenci칩n

Indica cu치nto tiempo deseas **prohibir la eliminaci칩n de objetos dentro del bucket** (muy 칰til para el cumplimiento al menos).\
Solo se puede habilitar **versionado o pol칤tica de retenci칩n al mismo tiempo**.

### Encriptaci칩n

Por defecto, los objetos se **encriptan utilizando claves administradas por Google**, pero tambi칠n se puede usar una **clave de KMS**.

### Enumeraci칩n

```bash
# Listar todos los buckets de almacenamiento en el proyecto
gsutil ls

# Obtener la configuraci칩n de cada bucket (protecciones, CLs, tiempos, configuraciones...)
gsutil ls -L

# Listar el contenido de un bucket espec칤fico
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursivo
gsutil ls -a gs://bucket-name/ # Obtener TODAS las versiones de objetos

# Mostrar el contenido de un archivo sin copiarlo localmente
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # Mostrar una versi칩n espec칤fica

# Copiar un objeto del bucket a tu almacenamiento local para revisi칩n
gsutil cp gs://bucket-name/folder/object ~/

# Listar usando un token OAuth sin procesar
## 칔til porque "CLOUDSDK_AUTH_ACCESS_TOKEN" y "gcloud config set auth/access_token_file" no funcionan con gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Descargar el contenido del archivo del bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -
```

Si obtienes un error de permiso denegado al listar los buckets, es posible que a칰n tengas acceso al contenido. Entonces, ahora que conoces la convenci칩n de nombres de los buckets, puedes generar una lista de nombres posibles e intentar acceder a ellos:

```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```

### Acceso p칰blico

Es posible dar acceso a los usuarios externos (con sesi칩n iniciada en GCP o no) al contenido de los buckets. Sin embargo, por defecto, el bucket tendr치 deshabilitada la opci칩n de exponer p칰blicamente un bucket:

```bash
# Deshabilitar la prevenci칩n p칰blica
gcloud storage buckets update gs://BUCKET_NAME --no-public-access-prevention

# Hacer que todos los objetos de un bucket sean p칰blicos
gcloud storage