# GCP - Pub/Sub Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>

## Pub/Sub <a href="#reviewing-cloud-pubsub" id="reviewing-cloud-pubsub"></a>

Google [**Cloud Pub/Sub**](https://cloud.google.com/pubsub/)は、独立したアプリケーションがメッセージを行き来させるサービスです。基本的に、アプリケーションがメッセージの送受信を行うために**購読**する**トピック**があります（メッセージは内容といくつかのメタデータで構成されます）。

**トピックはメッセージが送信されるキュー**であり、**サブスクリプション**はユーザーが**トピック内のメッセージにアクセスするために使用するオブジェクト**です。1つのトピックに対して複数のサブスクリプションが存在することができ、サブスクリプションには4種類があります：

* **Pull**: このサブスクリプションのユーザーはメッセージをプルする必要があります。
* **Push**: URLエンドポイントが指定され、メッセージは直ちにそこに送信されます。
* **Big query table**: Pushと同様ですが、メッセージをBig queryテーブル内に設定します。
* **Cloud Storage**: メッセージを既存のバケットに直接配信します。

**デフォルト**では、**サブスクリプションは31日後に期限切れ**になりますが、期限切れにならないように設定することもできます。

**デフォルト**では、メッセージは**7日間保持されます**が、この時間は**最大31日まで延長**することができます。また、10秒以内に**ACKed**されない場合はキューに戻ります。ACKedされたメッセージが引き続き保存されるように設定することもできます。

トピックはデフォルトで**Google管理の暗号化キー**を使用して暗号化されます。しかし、KMSからの**CMEK**（Customer Managed Encryption Key）も選択できます。

**Dead letter**: サブスクリプションは**最大配信試行回数**を設定することができます。メッセージが配信できない場合は、**指定されたデッドレタートピックに再公開されます**。

### スナップショット & スキーマ

スナップショットは、特定の時点でのサブスクリプションの状態を**キャプチャする機能**です。これは基本的に、サブスクリプション内の未確認メッセージの一貫した**バックアップ**です。スナップショットを作成することで、サブスクリプションのメッセージ確認状態を保存し、元のメッセージが削除された後でも、スナップショットが取られた時点からメッセージの消費を再開することができます。\
非常に運が良ければ、スナップショットにはスナップショットが取られた時点の**古い機密情報**が含まれている可能性があります。

トピックを作成する際に、**トピックメッセージがスキーマに従う必要がある**と指示することができます。

### 列挙
```bash
# Get a list of topics in the project
gcloud pubsub topics list
gcloud pubsub topics describe <topic>
gcloud pubsub topics list-subscriptions <topic>
gcloud pubsub topics get-iam-policy <topic>

# Get a list of subscriptions across all topics
gcloud pubsub subscriptions list
gcloud pubsub subscriptions describe <subscription>
gcloud pubsub subscriptions get-iam-policy <subscription>

# Get list of schemas
gcloud pubsub schemas list
gcloud pubsub schemas describe <schema>
gcloud pubsub schemas list-revisions <schema>

# Get list of snapshots
gcloud pubsub snapshots list
gcloud pubsub snapshots describe <snapshot>
```
ただし、古いメッセージを含む[**より大きなデータセットを要求する**](https://cloud.google.com/pubsub/docs/replay-overview)ことで、より良い結果が得られる場合があります。これにはいくつかの前提条件があり、アプリケーションに影響を与える可能性があるので、実際に何をしているのかを確実に理解してください。

### 権限昇格 & 攻撃後の活動

{% content-ref url="../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md" %}
[gcp-pub-sub-post-exploitation.md](../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md)
{% endcontent-ref %}

## Pub/Sub Lite

[**Pub/Sub Lite**](https://cloud.google.com/pubsub/docs/choosing-pubsub-or-lite)は**ゾーンストレージ**を持つメッセージングサービスです。Pub/Sub LiteはPub/Subの**一部のコスト**であり、低コストが主要な考慮事項である**高ボリュームストリーミング**（秒間最大1000万メッセージ）パイプラインやイベント駆動型システムに適しています。

PubSub Liteには**トピック**と**サブスクリプション**がありますが、**スナップショット**と**スキーマ**はありません。また、以下があります：

* **リザベーション**: Pub/Sub Liteリザベーションは、ユーザーが特定のリージョンでメッセージストリームの容量を予約する機能です。
* **オペレーション**: Pub/Sub Liteの管理と運用に関わるアクションとタスクを指します。

### 列挙
```bash
# lite-topics
gcloud pubsub lite-topics list
gcloud pubsub lite-topics describe <topic>
gcloud pubsub lite-topics list-subscriptions <topic>

# lite-subscriptions
gcloud pubsub lite-subscriptions list
gcloud pubsub lite-subscriptions describe <subscription>

# lite-reservations
gcloud pubsub lite-reservations list
gcloud pubsub lite-reservations describe <topic>
gcloud pubsub lite-reservations list-topics <topic>

# lite-operations
gcloud pubsub lite-operations list
gcloud pubsub lite-operations describe <topic>
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでのAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**や**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
