# GCP - Enumeraci칩n de Pub/Sub

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Pub/Sub <a href="#reviewing-cloud-pubsub" id="reviewing-cloud-pubsub"></a>

Google [**Cloud Pub/Sub**](https://cloud.google.com/pubsub/) es un servicio que permite a aplicaciones independientes **enviar mensajes** entre s칤. B치sicamente, existen **temas** a los cuales las aplicaciones pueden **suscribirse** para enviar y recibir **mensajes** (que est치n compuestos por el contenido del mensaje y algunos metadatos).

El **tema es la cola** donde se enviar치n los mensajes, mientras que las **suscripciones** son los **objetos** que los usuarios utilizar치n para **acceder a los mensajes en los temas**. Puede haber m치s de **1 suscripci칩n por tema** y existen 4 tipos de suscripciones:

* **Pull**: El(los) usuario(s) de esta suscripci칩n necesita(n) solicitar los mensajes.
* **Push**: Se indica un endpoint URL y los mensajes se enviar치n inmediatamente a este.
* **Tabla de Big Query**: Como push pero configurando los mensajes dentro de una tabla de Big Query.
* **Cloud Storage**: Entrega mensajes directamente a un bucket existente.

Por **defecto**, una **suscripci칩n expira despu칠s de 31 d칤as**, aunque se puede configurar para que nunca expire.

Por **defecto**, un mensaje se **conserva durante 7 d칤as**, pero este tiempo puede ser **aumentado hasta 31 d칤as**. Adem치s, si no se **ACKed en 10s** vuelve a la cola. Tambi칠n se puede configurar para que los mensajes ACKed contin칰en almacen치ndose.

Un tema est치 por defecto encriptado usando una **clave de encriptaci칩n gestionada por Google**. Pero tambi칠n se puede seleccionar una **CMEK** (Clave de Encriptaci칩n Gestionada por el Cliente) de KMS.

**Dead letter**: Las suscripciones pueden configurar un **n칰mero m치ximo de intentos de entrega**. Cuando un mensaje no puede ser entregado, se **republica en el tema de dead letter especificado**.

### Snapshots & Esquemas

Un snapshot es una caracter칤stica que **captura el estado de una suscripci칩n en un punto espec칤fico en el tiempo**. Es esencialmente una **copia de seguridad consistente de los mensajes no reconocidos en una suscripci칩n**. Al crear un snapshot, preservas el estado de reconocimiento de mensajes de la suscripci칩n, permiti칠ndote reanudar el consumo de mensajes desde el punto en que se tom칩 el snapshot, incluso despu칠s de que los mensajes originales hubieran sido eliminados de otra manera.\
Si tienes mucha suerte, un snapshot podr칤a contener **informaci칩n sensible antigua** de cuando se tom칩 el snapshot.

Al crear un tema, puedes indicar que los **mensajes del tema deben seguir un esquema**.

### Enumeraci칩n
```bash
# Get a list of topics in the project
gcloud pubsub topics list
gcloud pubsub topics describe <topic>
gcloud pubsub topics list-subscriptions <topic>
gcloud pubsub topics get-iam-policy <topic>

# Get a list of subscriptions across all topics
gcloud pubsub subscriptions list
gcloud pubsub subscriptions describe <subscription>
gcloud pubsub subscriptions get-iam-policy <subscription>

# Get list of schemas
gcloud pubsub schemas list
gcloud pubsub schemas describe <schema>
gcloud pubsub schemas list-revisions <schema>

# Get list of snapshots
gcloud pubsub snapshots list
gcloud pubsub snapshots describe <snapshot>
```
Sin embargo, podr칤as obtener mejores resultados [**solicitando un conjunto de datos m치s amplio**](https://cloud.google.com/pubsub/docs/replay-overview), incluyendo mensajes m치s antiguos. Esto tiene algunos prerrequisitos y podr칤a impactar las aplicaciones, as칤 que aseg칰rate de saber realmente lo que est치s haciendo.

### Escalada de Privilegios y Post Explotaci칩n

{% content-ref url="../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md" %}
[gcp-pub-sub-post-exploitation.md](../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md)
{% endcontent-ref %}

## Pub/Sub Lite

[**Pub/Sub Lite**](https://cloud.google.com/pubsub/docs/choosing-pubsub-or-lite) es un servicio de mensajer칤a con **almacenamiento zonal**. Pub/Sub Lite **cuesta una fracci칩n** de Pub/Sub y est치 destinado para **transmisi칩n de alto volumen** (hasta 10 millones de mensajes por segundo) en pipelines y sistemas impulsados por eventos donde el bajo costo es la consideraci칩n principal.

En PubSub Lite hay **temas** y **suscripciones**, no hay **instant치neas** ni **esquemas** y hay:

* **Reservas**: Las Reservas de Pub/Sub Lite es una caracter칤stica que permite a los usuarios reservar capacidad en una regi칩n espec칤fica para sus flujos de mensajes.
* **Operaciones**: Se refiere a las acciones y tareas involucradas en la gesti칩n y administraci칩n de Pub/Sub Lite.

### Enumeraci칩n
```bash
# lite-topics
gcloud pubsub lite-topics list
gcloud pubsub lite-topics describe <topic>
gcloud pubsub lite-topics list-subscriptions <topic>

# lite-subscriptions
gcloud pubsub lite-subscriptions list
gcloud pubsub lite-subscriptions describe <subscription>

# lite-reservations
gcloud pubsub lite-reservations list
gcloud pubsub lite-reservations describe <topic>
gcloud pubsub lite-reservations list-topics <topic>

# lite-operations
gcloud pubsub lite-operations list
gcloud pubsub lite-operations describe <topic>
```
<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
