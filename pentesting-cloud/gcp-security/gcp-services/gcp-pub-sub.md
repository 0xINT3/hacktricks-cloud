# GCP - Pub/Sub

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) を使って AWS ハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks にあなたの会社を広告したい**、または **HackTricks を PDF でダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式の PEASS & HackTricks グッズ**](https://peass.creator-spring.com) を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) を発見し、独占的な [**NFT**](https://opensea.io/collection/the-peass-family) コレクションをチェックする
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) に**参加する**か、[**テレグラムグループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) を**フォローする**。
* **HackTricks** の GitHub リポジトリ [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) に PR を提出して、あなたのハッキングのコツを共有する。

</details>

## Pub/Sub <a href="#reviewing-cloud-pubsub" id="reviewing-cloud-pubsub"></a>

Google [**Cloud Pub/Sub**](https://cloud.google.com/pubsub/) は、独立したアプリケーションがメッセージを行き来させるサービスです。基本的に、アプリケーションがメッセージの送受信を行うために**購読**する**トピック**があります（メッセージは内容といくつかのメタデータで構成されています）。

**トピックはメッセージが送信されるキュー**であり、**サブスクリプション**はユーザーが**トピック内のメッセージにアクセスするために使用するオブジェクト**です。トピックごとに**1つ以上のサブスクリプション**が存在し、サブスクリプションには3種類があります：

* **Pull**: このサブスクリプションのユーザーはメッセージをプルする必要があります。
* **Push**: URL エンドポイントが指定され、メッセージは直ちにそこに送信されます。
* **Big query table**: Push と同様ですが、メッセージを Big query テーブル内に設定します。

**デフォルト**では、メッセージは**7日間保持されます**が、この時間は**最大31日まで延長可能**です。また、10秒以内に**ACKされない場合**はキューに戻ります。

トピックはデフォルトで**Google 管理の暗号化キー**を使用して暗号化されます。しかし、KMS の**CMEK**（Customer Managed Encryption Key）も選択できます。

**デッドレター**: サブスクリプションは**最大配信試行回数**を設定できます。メッセージが配信できない場合、**指定されたデッドレタートピックに再公開されます**。

### バックアップとスキーマ

トピックには**バックアップ**が存在することがあり、そこにはより多くの**古い機密情報**が見つかる可能性があります。バックアップは、取得された時点の**未ACKのメッセージ**とその後のメッセージを保持し、デフォルトでは1週間生存します。

トピックを作成する際に、**トピックメッセージがスキーマに従う必要がある**と指定できます。

### 列挙
```bash
# Get a list of topics in the project
gcloud pubsub topics list
gcloud pubsub topics describe <topic>
gcloud pubsub topics list-subscriptions <topic>
gcloud pubsub topics get-iam-policy <topic>

# Get a list of subscriptions across all topics
gcloud pubsub subscriptions list
gcloud pubsub subscriptions describe <subscription>
gcloud pubsub subscriptions get-iam-policy <subscription>

# Get list of schemas
gcloud pubsub schemas list
gcloud pubsub schemas describe <snapshot>

# Get list of snapshots
gcloud pubsub snapshots list
gcloud pubsub snapshots describe <snapshot>
```
### ポストエクスプロイト

{% code overflow="wrap" %}
```bash
# Publish a message in a topic
gcloud pubsub topics publish <topic_name> --message "Hello!"

# This will retrive a non ACKed message (and won't ACK it)
gcloud pubsub subscriptions create my_subscription --topic <topic_name>
gcloud pubsub subscriptions pull <FULL SUBSCRIPTION NAME>

# Crete push subscription and recieve all the messages instantly in your web server
gcloud pubsub subscriptions create <subscription name> --topic <topic name> --push-endpoint <URL to push to>
```
{% endcode %}

## Pub/Sub Lite

[**Pub/Sub Lite**](https://cloud.google.com/pubsub/docs/choosing-pubsub-or-lite)は、**ゾーンストレージ**を持つメッセージングサービスです。Pub/Sub LiteのコストはPub/Subの**一部**であり、低コストが主要な考慮事項である**高ボリュームストリーミング**（秒間最大1000万メッセージ）パイプラインやイベント駆動型システムに適しています。

PubSub Liteには**トピック**と**サブスクリプション**がありますが、**バックアップ**や**スキーマ**はありません。以下の機能があります：

* **リザベーション**: Pub/Sub Liteリザベーションは、ユーザーが特定のリージョンでメッセージストリームの容量を予約する機能です。
* **オペレーション**: Pub/Sub Liteの管理と運用に関わるアクションやタスクを指します。

### 列挙
```bash
# lite-topics
gcloud pubsub lite-topics list
gcloud pubsub lite-topics describe <topic>
gcloud pubsub lite-topics list-subscriptions <topic>

# lite-subscriptions
gcloud pubsub lite-subscriptions list
gcloud pubsub lite-subscriptions describe <subscription>

# lite-reservations
gcloud pubsub lite-reservations list
gcloud pubsub lite-reservations describe <topic>
gcloud pubsub lite-reservations list-topics <topic>

# lite-operations
gcloud pubsub lite-operations list
gcloud pubsub lite-operations describe <topic>
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでのAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**や**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**telegramグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
