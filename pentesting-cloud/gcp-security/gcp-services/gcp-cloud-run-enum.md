# GCP - Wyliczanie usługi Cloud Run

<details>

<summary><strong>Dowiedz się, jak hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run to zarządzana platforma obliczeniowa typu serverless, która umożliwia **uruchamianie kontenerów** bezpośrednio na skalowalnej infrastrukturze Google.

Możesz uruchamiać swój kontener lub jeśli używasz Go, Node.js, Pythona, Javy, .NET Core lub Ruby'ego, możesz skorzystać z opcji [wdrożenia opartego na źródle](https://cloud.google.com/run/docs/deploying-source-code), która **buduje kontener za Ciebie.**

Google stworzył Cloud Run, aby **dobrze współpracować z innymi usługami w Google Cloud**, dzięki czemu możesz budować pełnowartościowe aplikacje.

### Usługi i zadania <a href="#services-and-jobs" id="services-and-jobs"></a>

Na Cloud Run Twój kod może działać ciągle jako _**usługa**_ lub jako _**zadanie**_. Zarówno usługi, jak i zadania działają w tym samym środowisku i mogą korzystać z tych samych integracji z innymi usługami w Google Cloud.

* **Usługi Cloud Run.** Służą do uruchamiania kodu, który odpowiada na żądania sieciowe lub zdarzenia.
* **Zadania Cloud Run.** Służą do uruchamiania kodu, który wykonuje pracę (zadanie) i kończy działanie, gdy praca zostanie wykonana.

## Usługa Cloud Run

Google [Cloud Run](https://cloud.google.com/run) to kolejna oferowana usługa typu serverless, w której można wyszukiwać zmienne środowiskowe. Cloud Run tworzy mały serwer sieciowy, domyślnie działający na porcie 8080 wewnątrz kontenera, który czeka na żądanie HTTP GET. Po otrzymaniu żądania uruchamiane jest zadanie, a dziennik zadania jest wyświetlany za pomocą odpowiedzi HTTP.

### Istotne szczegóły

* Domyślnie **dostęp** do serwera sieciowego jest **publiczny**, ale można go również **ograniczyć do ruchu wewnętrznego** (VPC...)\
Ponadto, **uwierzytelnienie** do kontaktu z serwerem sieciowym może być **zezwala na wszystkich** lub **wymagać uwierzytelnienia za pomocą IAM**.
* Domyślnie **szyfrowanie** korzysta z **zarządzanego przez Google klucza**, ale można również wybrać **CMEK** (Customer Managed Encryption Key) z **KMS**.
* Domyślnie używane jest **konto usługi** Compute Engine, które ma dostęp **Edytora** do projektu i ma zakres `cloud-platform`.
* Można zdefiniować **zmienne środowiskowe w postaci tekstu jawnego** dla wykonania, a nawet **montować tajemnice chmury** lub **dodawać tajemnice chmury do zmiennych środowiskowych.**
* Możliwe jest również **dodawanie połączeń z Cloud SQL** i **montowanie systemu plików.**
* **Adresy URL** wdrożonych usług mają postać **`https://<nazwa-usługi>-<losowy>.a.run.app`**
* Usługa Run może mieć **więcej niż 1 wersję lub rewizję** i **rozdzielać ruch** między kilkoma rewizjami.

### Wyliczanie
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Zadania w chmurze Cloud Run

Zadania w chmurze Cloud Run są lepszym rozwiązaniem dla **kontenerów, które działają do zakończenia i nie obsługują żądań**. Zadania nie mają możliwości obsługi żądań ani nasłuchiwania na porcie. Oznacza to, że w przeciwieństwie do usług Cloud Run, zadania nie powinny zawierać serwera sieciowego. Zamiast tego, kontenery z zadaniami powinny zakończyć działanie po wykonaniu swojego zadania.

### Wyliczanie
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Eskalacja uprawnień

Na następnej stronie możesz sprawdzić, jak **wykorzystać uprawnienia Cloud Run do eskalacji uprawnień**:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Nieuwierzytelniony dostęp

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Po eksploatacji

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Trwałość

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Odwołania

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
