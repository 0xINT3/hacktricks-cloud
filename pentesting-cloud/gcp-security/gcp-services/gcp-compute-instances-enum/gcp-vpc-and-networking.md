# GCP - VPC рдФрд░ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде рдЬреАрд░реЛ рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [SUBSCRIPTION PLANS](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [NFTs](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, The PEASS Family рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **Join the** ЁЯТм [Discord рд╕рдореВрд╣](https://discord.gg/hRep4RUj7f) рдпрд╛ [telegram рд╕рдореВрд╣](https://t.me/peass) рд╕реЗ рдЬреБрдбрд╝реЗрдВ рдпрд╛ рд╣рдореЗрдВ Twitter рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж [@hacktricks_live](https://twitter.com/hacktricks_live)ред
* **HackTricks** рдФрд░ **HackTricks Cloud** github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## **GCP Compute Networking рдХреА рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ**

**VPCs** рдореЗрдВ **Firewall** рдирд┐рдпрдо рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рд╡реАрдкреАрд╕реА рдореЗрдВ рдЖрдиреЗ рд╡рд╛рд▓реА рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддреЗ рд╣реИрдВред VPCs рдореЗрдВ **subnetworks** рднреА рд╣реЛрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ **рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди** рдХрдиреЗрдХреНрдЯ рдХреА рдЬрд╛рдПрдЧреАред\
AWS рдХреА рддреБрд▓рдирд╛ рдореЗрдВ, **Firewall** AWS **рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдЧреНрд░реБрдкреНрд╕ рдФрд░ NACLs** рдХреЗ **рдирд┐рдХрдЯрддрдо** рдЪреАрдЬ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдпреЗ **VPC рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд** рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рд╣рд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рдирд╣реАрдВред

## **GCP рдореЗрдВ VPC, Subnetworks рдФрд░ Firewalls**

рдХрдВрдкреНрдпреВрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ **subnetworks** рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрддреА рд╣реИрдВ рдЬреЛ **VPCs** ([рд╡рд░реНрдЪреБрдЕрд▓ рдкреНрд░рд╛рдЗрд╡реЗрдЯ рдХреНрд▓рд╛рдЙрдб](https://cloud.google.com/vpc/docs/vpc)) рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реЛрддреА рд╣реИрдВред GCP рдореЗрдВ рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдЧреНрд░реБрдкреНрд╕ рдирд╣реАрдВ рд╣реИрдВ, рдпрд╣рд╛рдВ [**VPC рдлрд╝рд╛рдпрд░рд╡реЙрд▓**](https://cloud.google.com/vpc/docs/firewalls) рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдирдХреЗ рдирд┐рдпрдо рдЗрд╕ рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрддрд░ рдкрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рд╣рд░ VM рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВред

### Subnetworks

рдПрдХ **VPC** рдореЗрдВ **рдХрдИ рд╕рдмрдиреЗрдЯрд╡рд░реНрдХ** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдкреНрд░рддреНрдпреЗрдХ **рд╕рдмрдиреЗрдЯрд╡рд░реНрдХ 1 рдХреНрд╖реЗрддреНрд░ рдореЗрдВ** рд╣реЛрддрд╛ рд╣реИред

### Firewalls

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╣рд░ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рджреЛ [**рд╢рд╛рдорд┐рд▓ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо**](https://cloud.google.com/vpc/docs/firewalls#default_firewall_rules) рд╣реЛрддреЗ рд╣реИрдВ: **рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдХреА рдЕрдиреБрдорддрд┐** рдФрд░ **рдЗрдирдмрд╛рдЙрдВрдб рдХреА рдирд┐рд╖реЗрдз**ред

рдЬрдм рдПрдХ GCP рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдПрдХ VPC рднреА рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо **`default`** рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо рд╣реЛрддреЗ рд╣реИрдВ:

* **default-allow-internal:** `default` рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдЕрдиреНрдп рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рд╕реЗ рд╕рднреА рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЕрдиреБрдорддрд┐
* **default-allow-ssh:** рд╣рд░ рдЬрдЧрд╣ рд╕реЗ 22 рдХреА рдЕрдиреБрдорддрд┐
* **default-allow-rdp:** рд╣рд░ рдЬрдЧрд╣ рд╕реЗ 3389 рдХреА рдЕрдиреБрдорддрд┐
* **default-allow-icmp:** рд╣рд░ рдЬрдЧрд╣ рд╕реЗ рдкрд┐рдВрдЧ рдХреА рдЕрдиреБрдорддрд┐

{% hint style="warning" %}
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, **рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо** **рдЕрдВрджрд░реВрдиреА рдЖрдИрдкреА рдкрддреЛрдВ** рдХреЗ рд▓рд┐рдП **рдЕрдзрд┐рдХ рдкрд░рд╡рд╛рд╣реАрдкреВрд░реНрдг** рд╣реЛрддреЗ рд╣реИрдВред рдбрд┐рдлрд╝реЙрд▓реНрдЯ VPC рдХрд┐рд╕реА рднреА рдХрдВрдкреНрдпреВрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдХреЗ рдмреАрдЪ рд╕рднреА рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
{% endhint %}

рдбрд┐рдлрд╝реЙрд▓реНрдЯ VPC рдпрд╛ рдирдП VPCs рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ **рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо** рдмрдирд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред [**рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо**](https://cloud.google.com/vpc/docs/firewalls) рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд **рддрд░реАрдХреЛрдВ** рд╕реЗ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* [**рдиреЗрдЯрд╡рд░реНрдХ рдЯреИрдЧ**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯреНрд╕**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **рдПрдХ VPC рдХреЗ рд╕рднреА рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕**

рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЦреБрд▓реЗ рдкреЛрд░реНрдЯреНрд╕ рд╡рд╛рд▓реА рд╕рднреА рдХрдВрдкреНрдпреВрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдХреЛ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ `gcloud` рдХрдорд╛рдВрдб рдирд╣реАрдВ рд╣реИред рдЖрдкрдХреЛ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо, рдиреЗрдЯрд╡рд░реНрдХ рдЯреИрдЧ, рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯреНрд╕ рдФрд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдХреЗ рдмреАрдЪ рдбреЙрдЯреНрд╕ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рд╣реЛрдВрдЧреЗред

рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ [рдЗрд╕ рдкрд╛рдпрдерди рд╕реНрдХреНрд░рд┐рдкреНрдЯ](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp_firewall_enum) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдирд┐рд░реНрдпрд╛рдд рдХрд░реЗрдЧрд╛:

* рдЗрдВрд╕реНрдЯреЗрдВрд╕, рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЖрдИрдкреА, рдЕрдиреБрдордд TCP, рдЕрдиреБрдордд UDP рджрд┐рдЦрд╛рдиреЗ рд╡рд╛рд▓реА CSV рдлрд╝рд╛рдЗрд▓
* рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реА рд╕рднреА рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдкрд░ рдирд┐рд╢рд╛рди рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП nmap рд╕реНрдХреИрди (0.0.0.0/0)
* рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рд╕рднреА TCP рдкреЛрд░реНрдЯреНрд╕ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реА рдЙрди рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрдг TCP рд░реЗрдВрдЬ рдХрд╛ masscan рд▓рдХреНрд╖реНрдп рдмрдирд╛рдирд╛

### рд╡рд░реНрдЪрд╕реНрд╡реАрдп рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпрд╛рдБ <a href="#hierarchical-firewall-policies" id="hierarchical-firewall-policies"></a>

_рд╡рд░реНрдЪрд╕реНрд╡реАрдп рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпрд╛рдБ_ рдЖрдкрдХреЛ рдЕрдкрдиреЗ рд╕рдВрдЧрдарди рдореЗрдВ рдПрдХ рд╕рдВрдЧрдд рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐ рдмрдирд╛рдиреЗ рдФрд░ рдкреНрд░рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВред рдЖрдк **рд╕рдВрдЧрдарди рдХреЛ рдкреВрд░реЗ** рдпрд╛ **рд╡реНрдпрдХреНрддрд┐рдЧрдд рдлреЛрд▓реНрдбрд░реНрд╕** рдХреЛ рдЗрд╕ рдиреАрддрд┐ рд╕реЗ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдЗрди рдиреАрддрд┐рдпреЛрдВ рдореЗрдВ рдирд┐рдпрдо рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдХрдиреЗрдХреНрд╢рди рдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдирдХрд╛рд░рдиреЗ рдпрд╛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред

рдЖрдк рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХрджрдореЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк [**рд╕рдВрд╕рд╛рдзрди рд╡рд░реНрдЪрд╕реНрд╡**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy) рдХреЗ **рд╕рдВрдЧрдарди рдпрд╛ рдлреЛрд▓реНрдбрд░ рдиреЛрдбреНрд╕** рдкрд░ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпрд╛рдБ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдПрдХ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐ рдирд┐рдпрдо **рдХрдиреЗрдХреНрд╢рди рдХреЛ рдмреНрд▓реЙрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдХрдиреЗрдХреНрд╢рди рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛ рдирд┐рдЪрд▓реЗ рд╕реНрддрд░ рдХреЗ рдлреЛрд▓реНрдбрд░реНрд╕ рдпрд╛ VPC рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдореЛрдВ рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛ рд╕рдХрддрд╛ рд╣реИ**ред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╕рднреА рд╡рд░реНрдЪрд╕реНрд╡реАрдп рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпрд╛рдБ рд╕рдВрдЧрдарди рдпрд╛ рдлреЛрд▓реНрдбрд░ рдХреЗ рддрд╣рдд рд╕рднреА рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдореЗрдВ рд╕рднреА рд╡реАрдПрдореНрд╕ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреА рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк **рдХрд┐рд╕ рд╡реАрдПрдореНрд╕ рдХреЛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдирд┐рдпрдо рдорд┐рд▓рддрд╛ рд╣реИ** рдЗрд╕реЗ [рдЯрд╛рд░реНрдЧреЗрдЯ рдиреЗрдЯрд╡рд░реНрдХреНрд╕ рдпрд╛ рдЯрд╛рд░реНрдЧреЗрдЯ рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯреНрд╕](https://cloud.google.com/vpc/docs/firewall-policies#targets) рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк рдпрд╣рд╛рдВ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ [**рд╣рд╛рдпрд░рд╛рд░реНрдХрд┐рдХрд▓ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐ рдХреИрд╕реЗ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud)ред

### рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдореЛрдВ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди

<figure><img src="../../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

1. рд╕рдВрдЧрдарди: рд╕рдВрдЧрдарди рдХреЛ рд╕реМрдВрдкреА рдЧрдИ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпрд╛рдБ
2. рдлреЛрд▓реНрдбрд░: рдлреЛрд▓реНрдбрд░ рдХреЛ рд╕реМрдВрдкреА рдЧрдИ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдиреАрддрд┐рдпрд╛рдБ
3. VPC: VPC рдХреЛ рд╕реМрдВрдкреА рдЧрдИ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо
4. рдЧреНрд▓реЛрдмрд▓: рдПрдХ рдФрд░ рдкреНрд░рдХрд╛рд░ рдХреЗ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдо рдЬреЛ VPCs рдХреЛ рд╕реМрдВрдкреЗ рдЧрдП рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ
5. рдХреНрд╖реЗрддреНрд░реАрдп: рд╡реАрдПрдо рдХреЗ рдПрдирдЖрдИрд╕реА рдФрд░ рд╡реАрдПрдо рдХреЗ рдХреНрд╖реЗрддреНрд░ рдХреЗ VPC рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд╕рд╛рде рд╕рдВрдмрдВрдзрд┐рдд рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдирд┐рдпрдоред

## VPC рдиреЗрдЯрд╡рд░реНрдХ рдкреАрд░рд┐рдВрдЧ

рджреЛ рд╡рд░реНрдЪреБрдЕрд▓ рдкреНрд░рд╛рдЗрд╡реЗрдЯ рдХреНрд▓рд╛рдЙрдб (V
