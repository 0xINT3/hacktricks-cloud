# GCP - Hesaplama Sınıflandırması

<details>

<summary><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı **takip edin**.
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github depolarına PR göndererek paylaşın.

</details>

## GCP VPC ve Ağ

Bunun nasıl çalıştığını öğrenin:

{% content-ref url="gcp-vpc-and-networking.md" %}
[gcp-vpc-and-networking.md](gcp-vpc-and-networking.md)
{% endcontent-ref %}

### Sınıflandırma

{% code overflow="wrap" %}
```bash
# List networks
gcloud compute networks list
gcloud compute networks describe <network>

# List subnetworks
gcloud compute networks subnets list
gcloud compute networks subnets get-iam-policy <name> --region <region>
gcloud compute networks subnets describe <name> --region <region>

# List FW rules in networks
gcloud compute firewall-rules list --format="table(
name,
network,
direction,
priority,
sourceRanges.list():label=SRC_RANGES,
destinationRanges.list():label=DEST_RANGES,
allowed[].map().firewall_rule().list():label=ALLOW,
denied[].map().firewall_rule().list():label=DENY,
sourceTags.list():label=SRC_TAGS,
sourceServiceAccounts.list():label=SRC_SVC_ACCT,
targetTags.list():label=TARGET_TAGS,
targetServiceAccounts.list():label=TARGET_SVC_ACCT,
disabled
)"

# List Hierarchical Firewalls
gcloud compute firewall-policies list  (--folder <value>| --organization <value>)
gcloud compute firewall-policies describe <fw_policy>
gcloud compute firewall-policies list-rules <fw_policy>

# Get Firewalls of each region
gcloud compute network-firewall-policies list
## Get final FWs applied in a region
gcloud compute network-firewall-policies get-effective-firewalls --network=<vpc_name> --region <region>
```
{% endcode %}

Açık güvenlik duvarı kurallarına sahip hesaplama örneklerini [https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum) adresinden kolayca bulabilirsiniz.

## Hesaplama örnekleri

Bu, **GCP içinde sanal makineleri çalıştırabileceğiniz bir yol**dur. Daha fazla bilgi için bu sayfayı kontrol edin:

{% content-ref url="gcp-compute-instance.md" %}
[gcp-compute-instance.md](gcp-compute-instance.md)
{% endcontent-ref %}

### Numaralandırma
```bash
# Get list of zones
# It's interesting to know which zones are being used
gcloud compute regions list | grep -E "NAME|[^0]/"

# List compute instances & get info
gcloud compute instances list
gcloud compute instances describe <instance name>
gcloud compute instances get-iam-policy <instance> --zone=ZONE
gcloud compute instances get-screenshot <instance name> # Instace must have "Display Device" enabled
gcloud compute instances os-inventory list-instances # Get OS info of instances (OS Config agent is running on instances)


# Enumerate disks
gcloud compute disks list
gcloud compute disks describe <disk>
gcloud compute disks get-iam-policy <disk>
```
Daha fazla bilgi için, bir örneğin **SSH'ye** veya **metadata'yı değiştirmeye** yönelik ayrıcalıkları **yükseltmek** için bu sayfayı kontrol edin:

{% content-ref url="../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

### Ayrıcalık Yükseltme

Aşağıdaki sayfada, **ayrıcalıkları yükseltmek** için hesaplama izinlerini **kötüye kullanmanın** nasıl yapılacağını kontrol edebilirsiniz:

{% content-ref url="../../gcp-privilege-escalation/gcp-compute-privesc/" %}
[gcp-compute-privesc](../../gcp-privilege-escalation/gcp-compute-privesc/)
{% endcontent-ref %}

### Kimlik Doğrulamasız Sorgulama

{% content-ref url="../../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md" %}
[gcp-compute-unauthenticated-enum.md](../../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md)
{% endcontent-ref %}

### Saldırı Sonrası

{% content-ref url="../../../gcp-security/gcp-post-exploitation/gcp-compute-post-exploitation.md" %}
[gcp-compute-post-exploitation.md](../../../gcp-security/gcp-post-exploitation/gcp-compute-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../../../gcp-security/gcp-persistence/gcp-compute-persistence.md" %}
[gcp-compute-persistence.md](../../../gcp-security/gcp-persistence/gcp-compute-persistence.md)
{% endcontent-ref %}

## Seri Konsol Günlükleri

Compute Engine Seri Konsol Günlükleri, sanal makine örneklerinizin **önyükleme ve işletim sistemi günlüklerini görüntülemenizi ve teşhis etmenizi** sağlayan bir özelliktir.

Seri Konsol Günlükleri, önyükleme işlemi sırasında meydana gelen çekirdek mesajları, başlatma komut dosyaları ve diğer sistem olaylarını içeren örneğin **düşük seviyeli bir görünümünü** sağlar. Bu, önyükleme sorunlarını gidermek, yanlış yapılandırmaları veya yazılım hatalarını belirlemek veya ağ bağlantısı sorunlarını gidermek için kullanışlı olabilir.

Bu günlükler, düşük ayrıcalıklı kullanıcının genellikle göremeyeceği sistem günlüklerinden **hassas bilgileri ortaya çıkarabilir**, ancak uygun IAM izinleriyle bunları okuyabilirsiniz.

Aşağıdaki [gcloud komutunu](https://cloud.google.com/sdk/gcloud/reference/compute/instances/get-serial-port-output) kullanarak seri port günlüklerini sorgulayabilirsiniz (gereken izin `compute.instances.getSerialPortOutput`):
```bash
gcloud compute instances get-serial-port-output <instance-name>
```
## İşletim Sistemi Yapılandırma Yöneticisi

İşletim sistemi yapılandırma yönetimi hizmetini kullanarak, sanal makine (VM) örneğiniz için tutarlı yapılandırmaları (istenen durum ve yazılım) **dağıtabilir, sorgulayabilir ve sürdürebilirsiniz**. Compute Engine üzerinde, VM'lerinizde tutarlı yazılım yapılandırmalarını sürdürmek için [konuk politikalarını](https://cloud.google.com/compute/docs/os-config-management#guest-policy) kullanmanız gerekmektedir.

İşletim Sistemi Yapılandırma yönetimi özelliği, VM'lerinizde hangi yazılım paketlerinin kurulması gerektiğini, hangi hizmetlerin etkinleştirilmesi gerektiğini ve hangi dosyaların veya yapılandırmaların VM'lerinizde bulunması gerektiğini belirleyen yapılandırma politikalarını tanımlamanıza olanak sağlar. VM'lerinizin yazılım yapılandırmasını yönetmek için deklaratif bir yaklaşım kullanabilirsiniz, bu da yapılandırma yönetimi sürecinizi daha kolay otomatikleştirmenize ve ölçeklendirmenize olanak tanır.

Bu ayrıca IAM izinleri aracılığıyla örneklerde oturum açmanıza olanak sağlar, bu nedenle **hak yükseltme ve geçiş yapma** için çok **faydalıdır**.

{% hint style="warning" %}
Tüm bir projede veya bir örnekte **os-config'i etkinleştirmek** için, istenen düzeyde **metadata** anahtarını **`enable-oslogin`** olarak ayarlamanız yeterlidir ve değeri **`true`** olmalıdır.\
Ayrıca, 2fa'yı etkinleştirmek için metadata **`enable-oslogin-2fa`**'yı **`true`** olarak ayarlayabilirsiniz.

Bir örnek oluştururken etkinleştirdiğinizde, metadata anahtarları otomatik olarak ayarlanır.
{% endhint %}

**OS-config'de 2fa hakkında daha fazla bilgi**, kullanıcı bir kullanıcı ise uygulanır, SA gibi bir kullanıcı değilse (örneğin compute SA), ekstra bir şey gerektirmez.

### Sıralama
```bash
gcloud compute os-config patch-deployments list
gcloud compute os-config patch-deployments describe <patch-deployment>

gcloud compute os-config patch-jobs list
gcloud compute os-config patch-jobs describe <patch-job>
```
## Görüntüler

### Özel Görüntüler

**Özel hesaplama görüntüleri hassas ayrıntılar** veya sömürülebilecek diğer zayıf yapılandırmalar içerebilir.

Bir görüntü oluşturulduğunda, **3 tür şifreleme seçeneği** arasından seçim yapabilirsiniz: **Google tarafından yönetilen anahtar** (varsayılan), KMS'den bir **anahtar** veya müşteri tarafından verilen bir **ham anahtar**.

#### Sıralama

Aşağıdaki komutla bir projedeki standart olmayan görüntülerin listesini sorgulayabilirsiniz:

{% code overflow="wrap" %}
```bash
gcloud compute machine-images list
gcloud compute machine-images describe <name>
gcloud compute machine-images get-iam-policy <name>
```
{% endcode %}

Daha sonra, herhangi bir görüntüden sanal diskleri çeşitli formatlarda [**dışa aktarabilirsiniz**](https://cloud.google.com/sdk/gcloud/reference/compute/images/export). Aşağıdaki komut, `test-image` görüntüsünü qcow2 formatında dışa aktarır ve dosyayı indirerek daha fazla inceleme için yerel olarak bir sanal makine oluşturmanıza olanak tanır:
```bash
gcloud compute images export --image test-image \
--export-format qcow2 --destination-uri [BUCKET]

# Execute container inside a docker
docker run --rm -ti gcr.io/<project-name>/secret:v1 sh
```
#### Yetki Yükseltme

Bilgisayar Örnekleri yetki yükseltme bölümünü kontrol edin.

### Özel Örnek Şablonları

Bir [**örnek şablonu**](https://cloud.google.com/compute/docs/instance-templates/), tutarlı yapılandırmaları dağıtmaya yardımcı olmak için örnek özelliklerini tanımlar. Bunlar, çalışan bir örneğin özel meta verileri gibi hassas veri türlerini içerebilir. Aşağıdaki komutları kullanarak araştırma yapabilirsiniz:
```bash
# List the available templates
gcloud compute instance-templates list

# Get the details of a specific template
gcloud compute instance-templates describe [TEMPLATE NAME]
```
## Anılar

**Anılar disklerin yedeklemeleridir**. Unutmayın ki bu, bir diski klonlamakla (başka bir mevcut özellik) aynı şey değildir.\
**Anı**, ondan alınan diskin **aynı şifrelemeyi kullanır**.

### Numaralandırma
```bash
gcloud compute snapshots list
gcloud compute snapshots describe <snapshot>
gcloud compute snapshots get-iam-policy <snapshot>
```
### Yetki Yükseltme

Compute Instances yetki yükseltme bölümünü kontrol edin.

## Referanslar

* [https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'da takip edin.
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github reposuna PR göndererek paylaşın.

</details>
