# GCP - Istanze di calcolo

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informazioni di base

Le istanze di calcolo di Google Cloud sono **macchine virtuali personalizzabili** sull'infrastruttura cloud di Google, offrendo potenza di calcolo scalabile e on-demand per una vasta gamma di applicazioni. Forniscono funzionalit√† come il deployment globale, lo storage persistente, scelte flessibili del sistema operativo e integrazioni di rete e sicurezza avanzate, rendendole una scelta versatile per l'hosting di siti web, l'elaborazione dei dati e l'esecuzione efficiente di applicazioni nel cloud.

### VM confidenziali

Le VM confidenziali utilizzano **funzionalit√† di sicurezza basate sull'hardware** offerte dalla generazione pi√π recente di processori AMD EPYC, che includono la crittografia della memoria e la virtualizzazione crittografata sicura. Queste funzionalit√† consentono alla VM di proteggere i dati elaborati e memorizzati al suo interno persino dal sistema operativo host e dall'ipervisore.

Per eseguire una VM confidenziale potrebbe essere necessario **modificare** cose come il **tipo** della **macchina**, l'**interfaccia** di rete, l'**immagine del disco di avvio**.

### Disco e crittografia del disco

√à possibile **selezionare il disco** da utilizzare o **crearne uno nuovo**. Se si seleziona un nuovo disco, √® possibile:

* Selezionare la **dimensione** del disco
* Selezionare il **sistema operativo**
* Indicare se si desidera **eliminare il disco quando l'istanza viene eliminata**
* **Crittografia**: Per **default** verr√† utilizzata una **chiave gestita da Google**, ma √® anche possibile **selezionare una chiave da KMS** o indicare una **chiave raw da utilizzare**.

### Deploy del container

√à possibile distribuire un **container** all'interno della macchina virtuale.\
√à possibile configurare l'**immagine** da utilizzare, impostare il **comando** da eseguire all'interno, gli **argomenti**, montare un **volume** e le **variabili d'ambiente** (informazioni sensibili?) e configurare diverse opzioni per questo container come l'esecuzione come **privileged**, stdin e pseudo TTY.

### Account del servizio

Per default, verr√† utilizzato l'**account del servizio predefinito di Compute Engine**. L'email di questo SA √® del tipo: `<proj-num>-compute@developer.gserviceaccount.com`\
Questo account del servizio ha il **ruolo di Editor sull'intero progetto (alti privilegi).**

E gli **ambiti di accesso predefiniti** sono i seguenti:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Accesso in lettura ai bucket :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Tuttavia, √® possibile **concedere l'accesso a `cloud-platform` con un clic** o specificare **ambiti personalizzati**.

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### Firewall

√à possibile consentire il traffico HTTP e HTTPS.

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### Networking

* **Inoltro IP**: √à possibile **abilitare l'inoltro IP** dalla creazione dell'istanza.
* **Hostname**: √à possibile assegnare all'istanza un hostname permanente.
* **Interfaccia**: √à possibile aggiungere un'interfaccia di rete.

### Sicurezza aggiuntiva

Queste opzioni **aumenteranno la sicurezza** della VM e sono consigliate:

* **Secure boot:** Secure boot aiuta a proteggere le istanze VM contro malware e rootkit a livello di avvio e kernel.
* **Abilita vTPM:** Il modulo di piattaforma fidata virtuale (vTPM) convalida l'integrit√† di pre-avvio e avvio della VM guest e offre la generazione e la protezione delle chiavi.
* **Supervisione dell'integrit√†:** Il monitoraggio dell'integrit√† consente di monitorare e verificare l'integrit√† di avvio in esecuzione delle istanze VM protette utilizzando i report di Stackdriver. Richiede l'abilitazione di vTPM.

### Accesso alla VM

Il modo comune per abilitare l'accesso alla VM √® **consentire l'accesso tramite determinate chiavi pubbliche SSH** alla VM.\
Tuttavia, √® anche possibile **abilitare l'accesso alla VM tramite il servizio `os-config` utilizzando IAM**. Inoltre, √® possibile abilitare l'autenticazione a due fattori per accedere alla VM utilizzando questo servizio.\
Quando questo **servizio** √® **abilitato**, l'accesso tramite **chiavi SSH √® disabilitato**.

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### Metadati

√à possibile definire **automazioni** (userdata in AWS) che sono **comandi shell** che verranno eseguiti ogni volta che la macchina si accende o si riavvia.

√à anche possibile **aggiungere valori chiave-valore di metadati extra** che saranno accessibili dall'endpoint dei metadati. Queste informazioni vengono comunemente utilizzate per le variabili d'ambiente e gli script di avvio/arresto. Questo pu√≤ essere ottenuto utilizzando il **metodo `describe`** da un comando nella sezione di enumerazione, ma potrebbe anche essere recuperato dall'interno dell'istanza accedendo all'endpoint dei metadati.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Inoltre, il **token di autenticazione per il service account allegato** e le **informazioni generali** sull'istanza, sulla rete e sul progetto saranno disponibili anche dal **punto di accesso dei metadati**. Per ulteriori informazioni, consulta:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Crittografia

Per impostazione predefinita, viene utilizzata una chiave di crittografia gestita da Google, ma √® possibile configurare una chiave di crittografia gestita dal cliente (CMEK). √à anche possibile configurare cosa fare quando la CMEK utilizzata viene revocata: nulla o spegnere la VM.

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF**, controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
