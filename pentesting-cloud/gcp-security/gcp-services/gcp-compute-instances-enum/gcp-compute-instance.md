# GCP - Vifaa vya Kuhesabu

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Taarifa Msingi

Vifaa vya Kuhesabu vya Google Cloud ni **mashine za kawaida za kisasa kwenye miundombinu ya wingu la Google**, zinazotoa nguvu ya kuhesabu inayoweza kupanuliwa na inayohitajika kwa aina mbalimbali za matumizi. Zinatoa huduma kama kupelekwa kwa ulimwengu mzima, uhifadhi endelevu, chaguzi za OS za kubadilika, na ushirikiano imara wa mitandao na usalama, hivyo kuifanya chaguo la kipekee kwa kuhifadhi tovuti, kusindika data, na kukimbia programu kwa ufanisi kwenye wingu.

### VM ya Siri

VM za Siri hutumia **vipengele vya usalama vilivyowekwa kwenye vifaa** vinavyotolewa na michakato ya AMD EPYC ya kizazi kipya, ambayo ni pamoja na kifaa cha kusimbua kumbukumbu na uthibitishaji salama wa uthabiti wa vitengo vya kisasa. Vipengele hivi huruhusu VM kulinda data inayosindika na kuhifadhiwa ndani yake hata kutoka kwa mfumo wa uendeshaji wa mwenyeji na hypervisor.

Ili kuendesha VM ya Siri inaweza kuhitaji **kubadilisha** mambo kama **aina** ya **mashine**, **interface ya mtandao**, **picha ya diski ya kuanzisha**.

### Diski & Ufichaji wa Diski

Inawezekana **kuchagua diski** itakayotumiwa au **kuunda mpya**. Ikiwa unachagua mpya unaweza:

* Chagua **ukubwa** wa diski
* Chagua **OS**
* Eleza ikiwa unataka **kufuta diski wakati kifaa kinapofutwa**
* **Ufichaji**: Kwa **chaguo-msingi** itatumika **ufunguo uliosimamiwa na Google**, lakini unaweza pia **kuchagua ufunguo kutoka KMS** au eleza **ufunguo wa moja kwa moja utakaotumika**.

### Kupeleka Kontena

Inawezekana kupeleka **kontena** ndani ya mashine ya kisasa.\
Inawezekana kusanidi **picha** itakayotumiwa, weka **amri** itakayotekelezwa ndani, **vigezo**, pima **kiasi**, na **mazingira ya env** (habari nyeti?) na kusanidi chaguo kadhaa kwa kontena kama kutekeleza kama **mwenye haki**, stdin na pseudo TTY.

### Akaunti ya Huduma

Kwa chaguo-msingi, **akaunti ya huduma ya kawaida ya Compute Engine** itatumika. Barua pepe ya SA hii ni kama: `<proj-num>-compute@developer.gserviceaccount.com`\
Akaunti hii ya huduma ina **jukumu la Mhariri kwenye mradi mzima (mamlaka kubwa).**

Na **mizizi ya ufikiaji ya chaguo-msingi** ni kama ifuatavyo:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Upatikanaji wa kusoma kwa vikapu :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Hata hivyo, inawezekana **kumpa `cloud-platform` kwa kubofya** au kufafanua **zile za desturi**.

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### Kizuizi cha Moto

Inawezekana kuruhusu trafiki ya HTTP na HTTPS.

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### Uunganishaji wa Mtandao

* **Uendeshaji wa IP**: Inawezekana **kuwezesha uendeshaji wa IP** tangu kuanzishwa kwa kifaa.
* **Jina la Mwenyeji**: Inawezekana kumpa kifaa jina la mwenyeji wa kudumu.
* **Interface**: Inawezekana kuongeza kiolesura cha mtandao

### Usalama wa Ziada

Chaguo hizi zitakuwa **ongeza usalama** wa VM na zinapendekezwa:

* **Kuanzisha boot salama:** Kuanzisha boot salama husaidia kulinda mifano yako ya VM dhidi ya zisizo za kiwango cha boot na rootkits za kernel.
* **Wezesha vTPM:** Moduli ya Jukwaa Iliyothibitishwa Kivituali (vTPM) inathibitisha uthabiti wa mbele na wa boot wa mgeni wako wa VM, na inatoa uundaji na ulinzi wa funguo.
* **Usimamizi wa Uadilifu:** Ufuatiliaji wa uadilifu huruhusu kufuatilia na kuthibitisha uadilifu wa boot wa muda wa mifano yako ya VM iliyolindwa kwa kutumia ripoti za Stackdriver. Inahitaji vTPM kuwezeshwa.

### Upatikanaji wa VM

Njia ya kawaida ya kuwezesha upatikanaji wa VM ni kwa **kuruhusu funguo za umma za SSH fulani** kupata VM.\
Hata hivyo, pia inawezekana **kuwezesha upatikanaji wa VM kupitia huduma ya `os-config` kwa kutumia IAM**. Zaidi ya hayo, inawezekana kuwezesha 2FA kupata VM kwa kutumia huduma hii.\
Wakati hii **huduma** inapokuwa **imezimwa**, upatikanaji kupitia **funguo za SSH unazimwa.**

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### Metadata

Inawezekana kufafanua **utomatiki** (data ya mtumiaji katika AWS) ambayo ni **amri za shell** ambazo zitatekelezwa kila wakati mashine inapoanza au kuanza upya.

Pia inawezekana **kuongeza thamani za ufunguo-ufunguo za metadata za ziada** ambazo zitapatikana kutoka kwa mwisho wa metadata. Taarifa hii mara nyingi hutumiwa kwa mazingira ya mazingira na hati za kuanza/kuzima. Hii inaweza kupatikana kwa kutumia **`mueleze` mbinu** kutoka kwa amri katika sehemu ya uchunguzi, lakini pia inaweza kupatikana kutoka ndani ya kifaa kwa kufikia mwisho wa metadata.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Zaidi ya hayo, **tokeni ya uthibitishaji kwa akaunti ya huduma iliyowekwa** na **maelezo ya jumla** kuhusu kifaa, mtandao na mradi pia yatakuwa yanapatikana kutoka kwa **kituo cha metadata**. Kwa maelezo zaidi angalia:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Ufichaji

Ufunguo wa kufichamishwa uliyoandaliwa na Google hutumiwa kwa chaguo-msingi lakini ufunguo wa kufichamishwa ulioandaliwa na Mteja (CMEK) unaweza kusanidiwa. Unaweza pia kusanidi ni nini cha kufanya wakati ufunguo wa CMEF uliotumiwa unafutiliwa mbali: Kutoweka au kuzima VM.

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
