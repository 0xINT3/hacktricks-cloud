# GCP - 计算实例

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 基本信息

Google Cloud计算实例是**Google云基础设施上的可定制虚拟机**，为各种应用程序提供可扩展和按需计算能力。它们提供全球部署、持久存储、灵活的操作系统选择以及强大的网络和安全集成功能，使其成为在云中高效托管网站、处理数据和运行应用程序的多功能选择。

### 保密VM

保密VM使用最新一代AMD EPYC处理器提供的**基于硬件的安全功能**，包括内存加密和安全加密虚拟化。这些功能使VM能够保护其中处理和存储的数据，甚至可以抵御主机操作系统和虚拟化程序的攻击。

要运行保密VM，可能需要**更改**诸如**机器类型**、网络**接口**、**引导磁盘映像**等内容。

### 磁盘和磁盘加密

可以**选择要使用的磁盘**或**创建新磁盘**。如果选择创建新磁盘，可以：

* 选择磁盘的**大小**
* 选择**操作系统**
* 指示是否希望在删除实例时**删除磁盘**
* **加密**：**默认**情况下将使用**Google管理的密钥**，但也可以**选择来自KMS的密钥**或指定**要使用的原始密钥**。

### 部署容器

可以在虚拟机内部部署**容器**。\
可以配置要使用的**镜像**，设置要在内部运行的**命令**，**参数**，挂载**卷**和**环境变量**（敏感信息？），并为此容器配置多个选项，如以**特权模式**执行，标准输入输出和伪TTY。

### 服务账号

默认情况下，将使用**Compute Engine默认服务账号**。此SA的电子邮件格式如下：`<proj-num>-compute@developer.gserviceaccount.com`\
此服务账号在整个项目中具有**编辑器角色（高权限）**。

默认访问范围包括以下内容：

* **https://www.googleapis.com/auth/devstorage.read\_only** -- 读取存储桶的访问权限 :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

但是，可以通过一键单击**授予`cloud-platform`**或指定**自定义访问范围**。

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### 防火墙

可以允许HTTP和HTTPS流量。

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### 网络

* **IP转发**：可以从创建实例时**启用IP转发**。
* **主机名**：可以为实例指定永久主机名。
* **接口**：可以添加网络接口

### 额外安全性

这些选项将**增强VM的安全性**，建议使用：

* **安全引导**：安全引导有助于保护您的VM实例免受引导级和内核级恶意软件和rootkit的攻击。
* **启用vTPM**：虚拟可信平台模块（vTPM）验证您的客户VM的预引导和引导完整性，并提供密钥生成和保护。
* **完整性监控**：完整性监控允许您使用Stackdriver报告监视和验证您的受保护VM实例的运行时引导完整性。需要启用vTPM。

### VM访问

启用VM访问的常见方法是**允许特定SSH公钥**访问VM。\
但是，也可以通过**使用IAM启用VM访问`os-config`服务**来启用对VM的访问。此外，还可以通过此服务启用对VM的访问使用2FA。\
启用此**服务**后，通过**SSH密钥的访问将被禁用**。

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### 元数据

可以定义**自动化**（在AWS中为用户数据），这些是每次机器启动或重新启动时将执行的**shell命令**。

还可以**添加额外的元数据键值对**，这些将可以从元数据端点访问。这些信息通常用于环境变量和启动/关闭脚本。可以使用枚举部分中的**`describe`方法**获取此信息，但也可以从实例内部访问元数据端点获取此信息。
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
此外，**附加服务账户的身份验证令牌**和有关**实例、网络和项目的一般信息**也将从**元数据端点**中获取。有关更多信息，请查看：

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### 加密

默认情况下使用Google管理的加密密钥，但可以配置客户管理的加密密钥（CMEK）。您还可以配置在使用的CMEF被吊销时要采取的措施：记录或关闭虚拟机。

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上**关注**我们 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
