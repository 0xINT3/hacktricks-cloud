# GCP - Instancje obliczeniowe

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

Instancje obliczeniowe Google Cloud to **dostosowywalne wirtualne maszyny na infrastrukturze chmurowej Google**, oferujące skalowalną i elastyczną moc obliczeniową dla szerokiego zakresu aplikacji. Zapewniają funkcje takie jak globalne wdrożenie, trwałe przechowywanie, elastyczny wybór systemu operacyjnego oraz integracje z siecią i zabezpieczeniami, co czyni je wszechstronnym wyborem do hostowania witryn, przetwarzania danych i efektywnego uruchamiania aplikacji w chmurze.

### Poufne VM

Poufne VM wykorzystują **funkcje bezpieczeństwa oparte na sprzęcie** oferowane przez najnowszą generację procesorów AMD EPYC, które obejmują szyfrowanie pamięci i bezpieczną wirtualizację zaszyfrowaną. Te funkcje umożliwiają VM ochronę przetwarzanych i przechowywanych w nim danych nawet przed systemem operacyjnym hosta i hipernadzorcą.

Aby uruchomić poufną VM, może być konieczne **zmienienie** takich rzeczy jak **typ** **maszyny**, **interfejs sieciowy**, **obraz dysku rozruchowego**.

### Dysk i szyfrowanie dysku

Możliwe jest **wybranie dysku** do użycia lub **utworzenie nowego**. Jeśli wybierzesz nowy, możesz:

* Wybrać **rozmiar** dysku
* Wybrać **system operacyjny**
* Wskazać, czy chcesz **usunąć dysk po usunięciu instancji**
* **Szyfrowanie**: Domyślnie zostanie użyty **zarządzany przez Google klucz**, ale można również **wybrać klucz z KMS** lub wskazać **klucz do użycia**.

### Wdrożenie kontenera

Możliwe jest wdrożenie **kontenera** wewnątrz wirtualnej maszyny.\
Można skonfigurować **obraz**, który ma być używany, ustawić **polecenie** do uruchomienia wewnątrz, **argumenty**, zamontować **wolumin** i **zmienne środowiskowe** (informacje poufne?) oraz skonfigurować wiele opcji dla tego kontenera, takich jak wykonanie jako **uprzywilejowany**, stdin i pseudo TTY.

### Konto usługi

Domyślnie będzie używane **domyślne konto usługi Compute Engine**. Adres e-mail tego konta usługi wygląda tak: `<proj-num>-compute@developer.gserviceaccount.com`\
To konto usługi ma **rolę Edytora w całym projekcie (wysokie uprawnienia).**

Domyślne zakresy dostępu to:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Dostęp do odczytu do kubełków :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Jednak możliwe jest **przyznanie mu uprawnień `cloud-platform` jednym kliknięciem** lub określenie **niestandardowych uprawnień**.

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### Zapora sieciowa

Możliwe jest zezwolenie na ruch HTTP i HTTPS.

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### Sieciowanie

* **Przekazywanie IP**: Możliwe jest **włączenie przekazywania IP** już podczas tworzenia instancji.
* **Nazwa hosta**: Możliwe jest nadanie instancji stałej nazwy hosta.
* **Interfejs**: Możliwe jest dodanie interfejsu sieciowego.

### Dodatkowe zabezpieczenia

Te opcje **zwiększą bezpieczeństwo** VM i są zalecane:

* **Bezpieczne uruchamianie**: Bezpieczne uruchamianie pomaga chronić twoje instancje VM przed złośliwym oprogramowaniem na poziomie rozruchu i jądra oraz rootkitami.
* **Włącz vTPM**: Wirtualny moduł platformy zaufanej (vTPM) sprawdza integralność rozruchu i uruchamiania gościa VM oraz oferuje generowanie i ochronę kluczy.
* **Nadzór integralności**: Monitorowanie integralności umożliwia monitorowanie i weryfikację integralności rozruchu w czasie rzeczywistym twoich instancji VM zabezpieczonych za pomocą raportów Stackdriver. Wymaga włączonego vTPM.

### Dostęp do VM

Najczęstszym sposobem umożliwienia dostępu do VM jest **zezwolenie na dostęp do VM za pomocą określonych kluczy publicznych SSH**.\
Jednak możliwe jest również **włączenie dostępu do VM za pomocą usługi `os-config` przy użyciu IAM**. Ponadto, możliwe jest włączenie uwierzytelniania dwuskładnikowego (2FA) do dostępu do VM za pomocą tej usługi.\
Gdy ta **usługa** jest **włączona**, dostęp za pomocą **kluczy SSH jest wyłączony**.

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### Metadane

Możliwe jest zdefiniowanie **automatyzacji** (userdata w AWS), które są **poleceniami powłoki**, które będą wykonywane za każdym razem, gdy maszyna zostanie włączona lub zrestartowana.

Możliwe jest również **dodanie dodatkowych metadanych klucz-wartość**, które będą dostępne z punktu końcowego metadanych. Te informacje są często używane do zmiennych środowiskowych i skryptów uruchamiania/zamykania. Można to uzyskać za pomocą **metody `describe`** z polecenia w sekcji wyliczania, ale można je również pobrać z wnętrza instancji, uzyskując dostęp do punktu końcowego metadanych.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Ponadto, **token autoryzacyjny dla przypisanego konta usługi** oraz **ogólne informacje** o instancji, sieci i projekcie będą dostępne z **punktu końcowego metadanych**. Aby uzyskać więcej informacji, sprawdź:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Szyfrowanie

Domyślnie używany jest zarządzany przez Google klucz szyfrowania, ale można skonfigurować klucz szyfrowania zarządzany przez klienta (CMEK). Można również skonfigurować, co zrobić, gdy używany klucz CMEF zostanie wycofany: Nic lub wyłączenie maszyny wirtualnej.

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
