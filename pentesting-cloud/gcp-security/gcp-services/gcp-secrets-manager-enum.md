# GCP - Secrets Manager Enum

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

其他支持HackTricks的方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## Secret Manager

Google [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/) 是一个类似保险库的解决方案，用于存储密码、API密钥、证书、文件（最大64KB）和其他敏感数据。

一个秘密可以有**存储不同数据的不同版本**。

**默认情况下**，秘密是**使用Google托管密钥加密**的，但可以**选择来自KMS的密钥**来加密秘密。

关于**轮换**，可以配置**每隔一定天数发送消息到pub-sub**，监听这些消息的代码可以**轮换秘密**。

可以配置一个**自动删除的日期**，当达到指定日期时，**秘密将被自动删除**。

### 枚举
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### 提权

在下面的页面中，您可以查看如何**滥用secretmanager权限来提升特权。**

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### 漏洞利用后期

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md" %}
[gcp-secretmanager-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-secretmanager-post-exploitation.md)
{% endcontent-ref %}

### 持久性

{% content-ref url="../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md" %}
[gcp-secret-manager-persistence.md](../../gcp-security/gcp-persistence/gcp-secret-manager-persistence.md)
{% endcontent-ref %}

### 旋转误用

攻击者可以更新秘密以**停止旋转**（因此不会被修改），或者**减少旋转频率**（因此秘密不会被修改），或者**将旋转消息发布到不同的pub/sub**，或修改正在执行的旋转代码（这发生在不同的服务中，可能是在Clound Function中，因此攻击者将需要对Cloud Function或任何其他服务具有特权访问）
