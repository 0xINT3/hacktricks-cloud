# GCP - KMS Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamını görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki özel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## KMS

[**Cloud Key Management Service (Bulut Anahtar Yönetimi Hizmeti)**](https://cloud.google.com/kms/docs/), **şifreleme ve hassas verilerin şifrelenmesi** gibi işlemler için **şifreleme anahtarlarının güvenli depolama alanı** olarak hizmet verir. Bu anahtarlar, yapılandırılmış yönetim imkanı sağlayan anahtar halkaları içinde düzenlenir. Ayrıca, erişim kontrolü, izinlerin güvenlik gereksinimleriyle tam olarak uyumlu olmasını sağlamak için, bireysel anahtar düzeyinde veya tüm anahtar halkası için ayrıntılı olarak yapılandırılabilir.

KMS anahtar halkaları, **varsayılan olarak küresel olarak oluşturulur**, bu da o anahtar halkasındaki anahtarların herhangi bir bölgeden erişilebilir olduğu anlamına gelir. Bununla birlikte, belirli bölgelerde **belirli anahtar halkaları oluşturmak mümkündür**.

### Anahtar Koruma Seviyesi

* **Yazılım anahtarları**: Yazılım anahtarları, **tamamen yazılım aracılığıyla KMS tarafından oluşturulur ve yönetilir**. Bu anahtarlar, **herhangi bir donanım güvenlik modülü (HSM) tarafından korunmaz** ve **test ve geliştirme amaçları** için kullanılabilir. Yazılım anahtarları, düşük güvenlik sağladığı ve saldırılara karşı hassas olduğu için **üretimde önerilmez**.
* **Bulut barındırılan anahtarlar**: Bulut barındırılan anahtarlar, KMS tarafından bulutta **yüksek kullanılabilirlik ve güvenilir bir altyapı kullanılarak oluşturulur ve yönetilir**. Bu anahtarlar, **HSM'ler tarafından korunur**, ancak HSM'ler **belirli bir müşteriye özel değildir**. Bulut barındırılan anahtarlar, çoğu üretim kullanım durumu için uygundur.
* **Harici anahtarlar**: Harici anahtarlar, KMS dışında **oluşturulur ve yönetilir** ve şifreleme işlemlerinde kullanılmak üzere KMS'ye aktarılır. Harici anahtarlar, müşterinin tercihine bağlı olarak **bir donanım güvenlik modülünde (HSM) veya bir yazılım kitaplığında** saklanabilir.

### Anahtar Amaçları

* **Simetrik şifreleme/şifre çözme**: Hem şifreleme hem de şifre çözme işlemleri için **tek bir anahtar kullanılarak verilerin şifrelenmesi ve şifre çözülmesi** için kullanılır. Simetrik anahtarlar, büyük veri hacimlerinin şifrelenmesi ve şifre çözülmesi için hızlı ve verimlidir.
* **Desteklenen**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Asimetrik İmzalama**: Anahtar paylaşımı olmadan iki taraf arasında güvenli iletişim için kullanılır. Asimetrik anahtarlar, bir **genel anahtar ve bir özel anahtar** çiftinden oluşur. Genel anahtar başkalarıyla paylaşılırken, özel anahtar gizli tutulur.
* **Desteklenen**: [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Asimetrik Şifre Çözme**: Bir ileti veya verinin doğruluğunu doğrulamak için kullanılır. Bir dijital imza, bir özel anahtar kullanılarak oluşturulur ve karşılık gelen genel anahtar kullanılarak doğrulanabilir.
* **Desteklenen**: [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **MAC İmzalama**: Bir gizli anahtar kullanılarak **veri bütünlüğünü ve doğruluğunu sağlamak için bir mesaj kimlik doğrulama kodu (MAC) oluşturulması** için kullanılır. HMAC, ağ protokollerinde ve yazılım uygulamalarında mesaj kimlik doğrulaması için yaygın olarak kullanılır.
* **Desteklenen**: [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### Dönüşüm Süresi ve Programlanmış Yok Etme Süresi

**Varsayılan olarak**, her **90 gün** ancak **kolayca** ve **tamamen özelleştirilebilir**.

"Programlanmış yok etme" süresi, kullanıcının anahtarı **silme talep ettiği andan** anahtarın **silindiği ana kadar geçen süredir**. Anahtar oluşturulduktan sonra değiştirilemez (varsayılan 1 gün).

### Birincil Sürüm

Her KMS anahtarının birden fazla sürümü olabilir, bunlardan biri **varsayılan** olmalıdır, bu, KMS anahtarıyla etkileşimde **sürüm belirtilmediğinde kullanılacak olan sürüm** olacaktır.

### Numaralandırma

**Anahtarları listeleme izinlerine sahipseniz**, bunlara nasıl erişebileceğinizi aşağıdaki gibi yapabilirsiniz:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Yetki Yükseltme

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Saldırı Sonrası

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>
