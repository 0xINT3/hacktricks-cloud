# GCP - KMS Enum

<details>

<summary><strong>Jifunze kuhack AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **nifuata** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Shiriki mbinu zako za kuhack kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## KMS

[**Huduma ya Usimamizi wa Kufunguo cha Google Cloud**](https://cloud.google.com/kms/docs/) inatumika kama uhifadhi salama wa **funguo za kryptografia**, ambazo ni muhimu kwa shughuli kama **kuficha na kufichua data nyeti**. Funguo hizi zimepangwa ndani ya pete za funguo, kuruhusu usimamizi ulio na muundo. Zaidi ya hayo, udhibiti wa ufikiaji unaweza kuwekwa kwa umakini, iwe kwa kiwango cha funguo binafsi au kwa pete nzima ya funguo, kuhakikisha kuwa ruhusa zinaendana kikamilifu na mahitaji ya usalama.

Pete za funguo za KMS kwa **kawaida huanzishwa kama za ulimwengu**, maana kwamba funguo ndani ya pete hiyo ya funguo inaweza kufikiwa kutoka eneo lolote. Hata hivyo, niwezekanavyo kuunda pete za funguo maalum katika **mikoa maalum**.

### Kiwango cha Kulinda Funguo

* **Funguo za programu**: Funguo za programu zinaundwa na kusimamiwa na KMS kabisa kwa programu. Funguo hizi **hazilindwi na moduli ya usalama ya vifaa (HSM)** na zinaweza kutumika kwa **madhumuni ya majaribio na maendeleo**. Funguo za programu **si zinashauriwa kwa matumizi ya uzalishaji** kwa sababu zinatoa usalama mdogo na zinaweza kushambuliwa.
* **Funguo zilizohifadhiwa kwenye wingu**: Funguo zilizohifadhiwa kwenye wingu zinaundwa na kusimamiwa na KMS kwenye wingu kwa kutumia miundombinu inayopatikana na ya kuaminika. Funguo hizi **zinalindwa na HSMs**, lakini HSMs **si maalum kwa mteja fulani**. Funguo zilizohifadhiwa kwenye wingu ni nzuri kwa matumizi mengi ya uzalishaji.
* **Funguo za nje**: Funguo za nje zinaundwa na kusimamiwa nje ya KMS, na kuingizwa kwenye KMS kwa matumizi katika shughuli za kryptografia. Funguo za nje **zinaweza kuhifadhiwa kwenye moduli ya usalama ya vifaa (HSM) au maktaba ya programu, kulingana na upendeleo wa mteja**.

### Madhumuni ya Funguo

* **Kuficha/kufululiza kwa usawa**: Hutumika kuficha na kufichua data kwa kutumia funguo moja kwa shughuli zote mbili. Funguo za usawa ni haraka na ufanisi kwa kuficha na kufichua kiasi kikubwa cha data.
* **Inayoungwa mkono**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Kusaini kwa upande mmoja**: Hutumika kwa mawasiliano salama kati ya pande mbili bila kushiriki funguo. Funguo za upande mmoja huja kwa jozi, ikiwa na **funguo ya umma na funguo ya siri**. Funguo ya umma inashirikiwa na wengine, wakati funguo ya siri inabaki siri.
* **Inayoungwa mkono:** [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Kufichua kwa upande mmoja**: Hutumika kuthibitisha uhalali wa ujumbe au data. Saini ya kidijitali inaundwa kwa kutumia funguo ya siri na inaweza kuthibitishwa kwa kutumia funguo ya umma inayolingana.
* **Inayoungwa mkono:** [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Kusaini MAC**: Hutumika kuhakikisha **ukamilifu na uhalali wa data kwa kuunda nambari ya uthibitisho wa ujumbe (MAC) kwa kutumia funguo ya siri**. HMAC mara nyingi hutumika kwa uthibitisho wa ujumbe katika itifaki za mtandao na programu za programu.
* **Inayoungwa mkono:** [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### Kipindi cha Kubadilisha & Kipindi cha Kupangwa kwa Uharibifu

Kwa **kawaida**, kila **siku 90** lakini inaweza **kubadilishwa kwa urahisi** na **kikamilifu**.

Kipindi cha "Kupangwa kwa uharibifu" ni **muda tangu mtumiaji aombe kufuta funguo** hadi funguo **kufutwa**. Haiwezi kubadilishwa baada ya funguo kuundwa (kawaida siku 1).

### Toleo Kuu

Kila funguo la KMS linaweza kuwa na matoleo kadhaa, mojawapo lazima iwe **toleo la msingi**, hili litatumika wakati **toleo halijaainishwa wakati wa kuingiliana na funguo za KMs**.

### Uorodheshaji

Ukiwa na **ruhusa ya kuorodhesha funguo** hivi ndivyo unavyoweza kuzifikia:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Upandishaji wa Mamlaka

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Baada ya Uvamizi

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Marejeo

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **fuata** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
