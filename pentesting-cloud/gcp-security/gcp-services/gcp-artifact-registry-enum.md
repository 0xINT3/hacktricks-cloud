# GCP - Enumeraci칩n de Artifact Registry

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
* de github.

</details>

## Informaci칩n B치sica

Google Cloud Artifact Registry es un servicio completamente gestionado que te permite **administrar, almacenar y asegurar tus artefactos de software**. Es esencialmente un repositorio para **almacenar dependencias de compilaci칩n**, como im치genes de **Docker**, **Maven**, paquetes npm y otros tipos de artefactos. Se utiliza **com칰nmente en pipelines de CI/CD** para almacenar y versionar los artefactos producidos durante el proceso de desarrollo de software.

Las caracter칤sticas clave de Artifact Registry incluyen:

1. **Repositorio Unificado**: Admite **m칰ltiples tipos de artefactos**, permiti칠ndote tener un 칰nico repositorio para im치genes de Docker, paquetes de lenguajes (como Maven de Java, npm de Node.js) y otros tipos de artefactos, lo que permite controles de acceso consistentes y una vista unificada de todos tus artefactos.
2. **Completamente Gestionado**: Como un servicio gestionado, se encarga de la infraestructura subyacente, escalabilidad y seguridad, reduciendo la carga de mantenimiento para los usuarios.
3. **Control de Acceso Granular**: Se integra con la Gesti칩n de Identidad y Acceso (IAM) de Google Cloud, permiti칠ndote definir qui칠n puede acceder, subir o descargar artefactos en tus repositorios.
4. **Geo-replicaci칩n**: Admite la replicaci칩n de artefactos a trav칠s de m칰ltiples regiones, mejorando la velocidad de descargas y asegurando la disponibilidad.
5. **Integraci칩n con Servicios de Google Cloud**: Funciona sin problemas con **otros servicios de GCP como Cloud Build, Kubernetes Engine y Compute Engine**, lo que lo convierte en una opci칩n conveniente para equipos que ya trabajan dentro del ecosistema de Google Cloud.
6. **Seguridad**: Ofrece caracter칤sticas como **an치lisis de vulnerabilidades y an치lisis de contenedores** para ayudar a asegurar que los artefactos almacenados est칠n seguros y libres de problemas de seguridad conocidos.

### Formatos y Modos

Al crear un nuevo repositorio es posible **seleccionar el formato/tipo** del repositorio entre varios como Docker, Maven, npm, Python... y el modo, que generalmente puede ser uno de estos tres:

* **Repositorio Est치ndar**: Modo predeterminado para **almacenar tus propios artefactos** (como im치genes de Docker, paquetes Maven) directamente en GCP. Es seguro, escalable e integra bien dentro del ecosistema de Google Cloud.
* **Repositorio Remoto** (si est치 disponible): Act칰a como un proxy para **almacenar en cach칠 artefactos de repositorios externos**, p칰blicos. Ayuda a prevenir problemas de cambios en las dependencias aguas arriba y reduce la latencia al almacenar en cach칠 artefactos de acceso frecuente.
* **Repositorio Virtual** (si est치 disponible): Proporciona una **interfaz unificada para acceder a m칰ltiples repositorios (est치ndar o remoto)** a trav칠s de un 칰nico punto final, simplificando la configuraci칩n del lado del cliente y la gesti칩n de acceso para artefactos distribuidos en varios repositorios.
* Para un repositorio virtual necesitar치s **seleccionar repositorios y asignarles una prioridad** (el repositorio con la mayor prioridad ser치 utilizado).
* Puedes **mezclar repositorios remotos y est치ndar** en uno **virtual**, si la **prioridad** del **remoto** es **mayor** que la del est치ndar, **se utilizar치n paquetes del remoto (por ejemplo, PyPi)**. Esto podr칤a llevar a una **Confusi칩n de Dependencia.**

Nota que en la **versi칩n Remota de Docker** es posible dar un nombre de usuario y token para acceder a Docker Hub. El **token se almacena entonces en el Secret Manager**.

### Encriptaci칩n

Como se espera, por defecto se utiliza una clave gestionada por Google pero se puede indicar una clave gestionada por el cliente (CMEK).

### Pol칤ticas de Limpieza

* **Eliminar artefactos:** Los artefactos ser치n **eliminados de acuerdo a los criterios de la pol칤tica de limpieza**.
* **Ejecuci칩n en seco:** (La opci칩n predeterminada) Los artefactos **no ser치n eliminados**. Las pol칤ticas de limpieza ser치n evaluadas y se enviar치n eventos de eliminaci칩n de prueba al Registro de Auditor칤a de Cloud.

### An치lisis de Vulnerabilidades

Es posible habilitar el **esc치ner de vulnerabilidades** que comprobar치 la existencia de vulnerabilidades dentro de **im치genes de contenedores**.

### Enumeraci칩n
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### Escalaci칩n de Privilegios

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### Acceso No Autenticado

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### Post-Explotaci칩n

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
