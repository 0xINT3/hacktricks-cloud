# GCP - Enumera√ß√£o do Artifact Registry

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
* no GitHub.

</details>

## Informa√ß√µes B√°sicas

O Google Cloud Artifact Registry √© um servi√ßo totalmente gerenciado que permite **gerenciar, armazenar e proteger seus artefatos de software**. √â basicamente um reposit√≥rio para **armazenar depend√™ncias de constru√ß√£o**, como imagens **Docker**, **Maven**, pacotes npm e outros tipos de artefatos. √â **comumente usado em pipelines CI/CD** para armazenar e versionar os artefatos produzidos durante o processo de desenvolvimento de software.

Principais caracter√≠sticas do Artifact Registry incluem:

1. **Reposit√≥rio Unificado**: Suporta **v√°rios tipos de artefatos**, permitindo que voc√™ tenha um √∫nico reposit√≥rio para imagens Docker, pacotes de linguagens (como Maven do Java, npm do Node.js) e outros tipos de artefatos, possibilitando controles de acesso consistentes e uma vis√£o unificada de todos os seus artefatos.
2. **Totalmente Gerenciado**: Como um servi√ßo gerenciado, cuida da infraestrutura subjacente, escalabilidade e seguran√ßa, reduzindo a sobrecarga de manuten√ß√£o para os usu√°rios.
3. **Controle de Acesso Granular**: Integra-se com o Gerenciamento de Identidade e Acesso (IAM) do Google Cloud, permitindo que voc√™ defina quem pode acessar, fazer upload ou baixar artefatos em seus reposit√≥rios.
4. **Geo-replica√ß√£o**: Suporta a replica√ß√£o de artefatos em v√°rias regi√µes, melhorando a velocidade de downloads e garantindo disponibilidade.
5. **Integra√ß√£o com Servi√ßos do Google Cloud**: Funciona de forma integrada com **outros servi√ßos do GCP como Cloud Build, Kubernetes Engine e Compute Engine**, tornando-se uma escolha conveniente para equipes que j√° trabalham dentro do ecossistema do Google Cloud.
6. **Seguran√ßa**: Oferece recursos como **varredura de vulnerabilidades e an√°lise de cont√™ineres** para ajudar a garantir que os artefatos armazenados sejam seguros e livres de problemas de seguran√ßa conhecidos.

### Formatos e Modos

Ao criar um novo reposit√≥rio √© poss√≠vel **selecionar o formato/tipo** do reposit√≥rio entre v√°rios, como Docker, Maven, npm, Python... e o modo, que geralmente pode ser um dos tr√™s:

* **Reposit√≥rio Padr√£o**: Modo padr√£o para **armazenar seus pr√≥prios artefatos** (como imagens Docker, pacotes Maven) diretamente no GCP. √â seguro, escal√°vel e integra-se bem ao ecossistema do Google Cloud.
* **Reposit√≥rio Remoto** (se dispon√≠vel): Atua como um proxy para **armazenar em cache artefatos de reposit√≥rios p√∫blicos externos**. Ajuda a prevenir problemas com mudan√ßas nas depend√™ncias a montante e reduz a lat√™ncia ao armazenar em cache artefatos frequentemente acessados.
* **Reposit√≥rio Virtual** (se dispon√≠vel): Fornece uma **interface unificada para acessar m√∫ltiplos reposit√≥rios (padr√£o ou remoto)** atrav√©s de um √∫nico ponto de acesso, simplificando a configura√ß√£o do lado do cliente e o gerenciamento de acesso para artefatos distribu√≠dos em v√°rios reposit√≥rios.
* Para um reposit√≥rio virtual, voc√™ precisar√° **selecionar reposit√≥rios e dar-lhes uma prioridade** (o reposit√≥rio com a maior prioridade ser√° utilizado).
* Voc√™ pode **misturar reposit√≥rios remotos e padr√£o** em um **virtual**, se a **prioridade** do **remoto** for **maior** que a do padr√£o, **pacotes do remoto (PyPi, por exemplo) ser√£o utilizados**. Isso pode levar a uma **Confus√£o de Depend√™ncia.**

Note que na **vers√£o Remota do Docker** √© poss√≠vel fornecer um nome de usu√°rio e token para acessar o Docker Hub. O **token √© ent√£o armazenado no Secret Manager**.

### Criptografia

Como esperado, por padr√£o √© utilizado uma chave gerenciada pelo Google, mas pode ser indicada uma chave gerenciada pelo cliente (CMEK).

### Pol√≠ticas de Limpeza

* **Excluir artefatos:** Artefatos ser√£o **exclu√≠dos de acordo com crit√©rios de pol√≠tica de limpeza**.
* **Execu√ß√£o de teste:** (Padr√£o) Artefatos **n√£o ser√£o exclu√≠dos**. Pol√≠ticas de limpeza ser√£o avaliadas, e eventos de exclus√£o de teste enviados para o Cloud Audit Logging.

### Varredura de Vulnerabilidades

√â poss√≠vel ativar o **scanner de vulnerabilidades** que verificar√° a exist√™ncia de vulnerabilidades dentro de **imagens de cont√™ineres**.

### Enumera√ß√£o
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### Escalada de Privil√©gios

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### Acesso N√£o Autenticado

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### P√≥s-Explora√ß√£o

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### Persist√™ncia

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Aprenda hacking em AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Participe do grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou do grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
