# GCP - Artifact Registry 枚举

<details>

<summary><strong>从零开始学习AWS黑客攻击到成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在 **HackTricks中看到您的公司广告** 或 **下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享您的黑客技巧**
* &#x20;github仓库。

</details>

## 基本信息

Google Cloud Artifact Registry 是一个完全托管的服务，允许您**管理、存储和保护您的软件工件**。它本质上是一个**存储构建依赖项**的仓库，例如 **Docker** 镜像、**Maven**、npm包和其他类型的工件。它**通常用于CI/CD管道**中，用于存储和版本控制软件开发过程中产生的工件。

Artifact Registry的关键特性包括：

1. **统一仓库**：它支持**多种类型的工件**，允许您为Docker镜像、语言包（如Java的Maven、Node.js的npm）和其他类型的工件使用单一仓库，实现一致的访问控制和跨所有工件的统一视图。
2. **完全托管**：作为托管服务，它负责底层基础设施、扩展和安全性，减少了用户的维护负担。
3. **细粒度访问控制**：它与Google Cloud的身份和访问管理（IAM）集成，允许您定义谁可以访问、上传或下载您仓库中的工件。
4. **地理复制**：它支持跨多个区域复制工件，提高下载速度并确保可用性。
5. **与Google Cloud服务集成**：它与**其他GCP服务如Cloud Build、Kubernetes Engine和Compute Engine**无缝工作，对于已经在Google Cloud生态系统中工作的团队来说是一个方便的选择。
6. **安全性**：提供**漏洞扫描和容器分析**等功能，以帮助确保存储的工件安全且没有已知的安全问题。

### 格式和模式

创建新仓库时，可以**选择仓库的格式/类型**，如Docker、Maven、npm、Python...以及通常可以是以下三种之一的模式：

* **标准仓库**：默认模式，用于**直接在GCP中存储您自己的工件**（如Docker镜像、Maven包）。它安全、可扩展，并且在Google Cloud生态系统中集成良好。
* **远程仓库**（如果可用）：作为代理，用于**缓存来自外部**、公共仓库的工件。它有助于防止上游依赖项变化引起的问题，并通过缓存频繁访问的工件来减少延迟。
* **虚拟仓库**（如果可用）：提供**统一接口访问多个（标准或远程）仓库**，通过单一端点简化客户端配置和对分散在各个仓库的工件的访问管理。
* 对于虚拟仓库，您需要**选择仓库并给它们设置优先级**（具有最大优先级的仓库将被使用）。
* 您可以在**虚拟**仓库中**混合远程和标准**仓库，如果**远程**的**优先级**比标准的**大**，**将使用来自远程（例如PyPi）的包**。这可能导致**依赖混淆**。

请注意，在**Docker的远程版本**中，可以提供用户名和令牌以访问Docker Hub。然后**令牌存储在Secret Manager中**。

### 加密

正如预期的那样，默认情况下使用Google管理的密钥，但可以指定客户管理的密钥（CMEK）。

### 清理策略

* **删除工件**：工件将根据清理策略标准**被删除**。
* **干运行**：（默认）工件**不会被删除**。将评估清理策略，并向Cloud Audit Logging发送测试删除事件。

### 漏洞扫描

可以启用**漏洞扫描器**，它将检查**容器镜像**内的漏洞。

### 枚举
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### 权限提升

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### 未经认证的访问

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### 后期利用

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### 持久性

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>从零开始学习 AWS 黑客攻击！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您希望在 **HackTricks** 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFT 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享您的黑客技巧**。

</details>
