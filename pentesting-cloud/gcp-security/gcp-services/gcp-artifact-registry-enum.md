# GCP - Enumerazione di Artifact Registry

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
* &#x20;repository di github.

</details>

## Informazioni di base

Google Cloud Artifact Registry √® un servizio completamente gestito che consente di **gestire, archiviare e proteggere i tuoi artefatti software**. √à essenzialmente un repository per **archiviare le dipendenze di compilazione**, come immagini **Docker**, pacchetti **Maven**, pacchetti npm e altri tipi di artefatti. Viene **comunemente utilizzato nelle pipeline CI/CD** per archiviare e versionare gli artefatti prodotti durante il processo di sviluppo del software.

Le caratteristiche principali di Artifact Registry includono:

1. **Repository unificato**: supporta **diversi tipi di artefatti**, consentendo di avere un singolo repository per immagini Docker, pacchetti di linguaggio (come Maven di Java, npm di Node.js) e altri tipi di artefatti, consentendo controlli di accesso coerenti e una vista unificata di tutti gli artefatti.
2. **Completamente gestito**: essendo un servizio gestito, si occupa dell'infrastruttura sottostante, della scalabilit√† e della sicurezza, riducendo l'onere di manutenzione per gli utenti.
3. **Controllo degli accessi dettagliato**: si integra con Identity and Access Management (IAM) di Google Cloud, consentendo di definire chi pu√≤ accedere, caricare o scaricare artefatti nei tuoi repository.
4. **Replicazione geografica**: supporta la replica degli artefatti su pi√π regioni, migliorando la velocit√† di download e garantendo la disponibilit√†.
5. **Integrazione con i servizi di Google Cloud**: funziona in modo trasparente con **altri servizi GCP come Cloud Build, Kubernetes Engine e Compute Engine**, rendendolo una scelta conveniente per i team che gi√† lavorano nell'ecosistema di Google Cloud.
6. **Sicurezza**: offre funzionalit√† come **scansione delle vulnerabilit√† e analisi dei contenitori** per garantire che gli artefatti archiviati siano sicuri e privi di problemi di sicurezza noti.

### Formati e modalit√†

Durante la creazione di un nuovo repository √® possibile **selezionare il formato/tipo** del repository tra diversi come Docker, Maven, npm, Python... e la modalit√† che di solito pu√≤ essere una di queste tre:

* **Repository standard**: modalit√† predefinita per **archiviare i propri artefatti** (come immagini Docker, pacchetti Maven) direttamente in GCP. √à sicuro, scalabile e si integra bene nell'ecosistema di Google Cloud.
* **Repository remoto** (se disponibile): funge da proxy per **memorizzare nella cache artefatti da repository esterni** e pubblici. Aiuta a prevenire problemi derivanti da modifiche alle dipendenze a monte e riduce la latenza memorizzando nella cache gli artefatti frequentemente accessati.
* **Repository virtuale** (se disponibile): fornisce un'**interfaccia unificata per accedere a pi√π repository (standard o remoti)** tramite un singolo punto di accesso, semplificando la configurazione lato client e la gestione dell'accesso per gli artefatti distribuiti in vari repository.
* Per un repository virtuale sar√† necessario **selezionare i repository e assegnare loro una priorit√†** (il repository con la priorit√† pi√π alta verr√† utilizzato).
* √à possibile **mixare repository remoti e standard** in uno **virtuale**, se la **priorit√†** del **repository remoto** √® **maggiore** di quella dello standard, **verranno utilizzati i pacchetti dal repository remoto (ad esempio PyPi)**. Ci√≤ potrebbe portare a una **Confusione delle Dipendenze**.

Si noti che nella **versione remota di Docker** √® possibile fornire un nome utente e un token per accedere a Docker Hub. Il **token viene quindi archiviato nel Secret Manager**.

### Crittografia

Come previsto, di default viene utilizzata una chiave gestita da Google, ma √® possibile indicare una chiave gestita dal cliente (CMEK).

### Politiche di pulizia

* **Elimina artefatti:** gli artefatti verranno **eliminati in base ai criteri di pulizia**.
* **Prova a secco:** (predefinita) gli artefatti **non verranno eliminati**. Le politiche di pulizia verranno valutate e gli eventi di eliminazione di prova verranno inviati a Cloud Audit Logging.

### Scansione delle vulnerabilit√†

√à possibile abilitare lo **scanner delle vulnerabilit√†** che controller√† la presenza di vulnerabilit√† all'interno delle **immagini dei contenitori**.

### Enumerazione
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### Escalazione dei privilegi

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### Accesso non autenticato

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### Post-Esploitation

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### Persistenza

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
