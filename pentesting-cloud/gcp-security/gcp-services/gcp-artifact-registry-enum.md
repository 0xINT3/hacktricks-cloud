# GCP - √ânum√©ration du registre d'artefacts

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs exclusifs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)
* github.

</details>

## Informations de base

Google Cloud Artifact Registry est un service enti√®rement g√©r√© qui vous permet de **g√©rer, stocker et s√©curiser vos artefacts logiciels**. C'est essentiellement un d√©p√¥t pour **stocker les d√©pendances de construction**, telles que les images **Docker**, **Maven**, les paquets npm et d'autres types d'artefacts. Il est **couramment utilis√© dans les pipelines CI/CD** pour stocker et versionner les artefacts produits pendant le processus de d√©veloppement logiciel.

Les caract√©ristiques cl√©s de Artifact Registry incluent :

1. **D√©p√¥t unifi√©** : Il prend en charge **plusieurs types d'artefacts**, vous permettant d'avoir un seul d√©p√¥t pour les images Docker, les paquets de langage (comme Maven de Java, npm de Node.js) et d'autres types d'artefacts, permettant des contr√¥les d'acc√®s coh√©rents et une vue unifi√©e sur tous vos artefacts.
2. **Enti√®rement g√©r√©** : En tant que service g√©r√©, il s'occupe de l'infrastructure sous-jacente, de l'√©chelle et de la s√©curit√©, r√©duisant la charge de maintenance pour les utilisateurs.
3. **Contr√¥le d'acc√®s granulaire** : Il s'int√®gre √† la gestion des identit√©s et des acc√®s (IAM) de Google Cloud, vous permettant de d√©finir qui peut acc√©der, t√©l√©charger ou t√©l√©verser des artefacts dans vos d√©p√¥ts.
4. **G√©o-r√©plication** : Il prend en charge la r√©plication des artefacts sur plusieurs r√©gions, am√©liorant la vitesse des t√©l√©chargements et assurant la disponibilit√©.
5. **Int√©gration avec les services Google Cloud** : Il fonctionne de mani√®re transparente avec **d'autres services GCP comme Cloud Build, Kubernetes Engine et Compute Engine**, ce qui en fait un choix pratique pour les √©quipes travaillant d√©j√† dans l'√©cosyst√®me Google Cloud.
6. **S√©curit√©** : Offre des fonctionnalit√©s comme **l'analyse de vuln√©rabilit√© et l'analyse de conteneurs** pour aider √† garantir que les artefacts stock√©s sont s√©curis√©s et exempts de probl√®mes de s√©curit√© connus.

### Formats et Modes

Lors de la cr√©ation d'un nouveau d√©p√¥t, il est possible de **s√©lectionner le format/type** du d√©p√¥t parmi plusieurs, comme Docker, Maven, npm, Python... et le mode qui peut g√©n√©ralement √™tre l'un de ces trois :

* **D√©p√¥t standard** : Mode par d√©faut pour **stocker vos propres artefacts** (comme les images Docker, les paquets Maven) directement dans GCP. Il est s√©curis√©, √©volutif et s'int√®gre bien dans l'√©cosyst√®me Google Cloud.
* **D√©p√¥t distant** (si disponible) : Agit comme un proxy pour **mettre en cache les artefacts de d√©p√¥ts publics externes**. Cela aide √† pr√©venir les probl√®mes li√©s aux changements de d√©pendances en amont et r√©duit la latence en mettant en cache les artefacts fr√©quemment acc√©d√©s.
* **D√©p√¥t virtuel** (si disponible) : Fournit une **interface unifi√©e pour acc√©der √† plusieurs d√©p√¥ts (standard ou distant)** via un seul point de terminaison, simplifiant la configuration c√¥t√© client et la gestion de l'acc√®s pour les artefacts r√©partis dans divers d√©p√¥ts.
* Pour un d√©p√¥t virtuel, vous devrez **s√©lectionner des d√©p√¥ts et leur attribuer une priorit√©** (le d√©p√¥t avec la plus grande priorit√© sera utilis√©).
* Vous pouvez **m√©langer des d√©p√¥ts distants et standard** dans un d√©p√¥t **virtuel**, si la **priorit√©** du d√©p√¥t **distant** est **plus grande** que celle du standard, **les paquets du d√©p√¥t distant (PyPi par exemple) seront utilis√©s**. Cela pourrait conduire √† une **Confusion de D√©pendance.**

Notez que dans la **version distante de Docker**, il est possible de donner un nom d'utilisateur et un jeton pour acc√©der √† Docker Hub. Le **jeton est alors stock√© dans le Secret Manager**.

### Chiffrement

Comme pr√©vu, par d√©faut une cl√© g√©r√©e par Google est utilis√©e mais une cl√© g√©r√©e par le client peut √™tre indiqu√©e (CMEK).

### Politiques de nettoyage

* **Supprimer les artefacts :** Les artefacts seront **supprim√©s selon les crit√®res de la politique de nettoyage**.
* **Essai √† blanc :** (Celui par d√©faut) Les artefacts **ne seront pas supprim√©s**. Les politiques de nettoyage seront √©valu√©es et des √©v√©nements de suppression de test seront envoy√©s au Cloud Audit Logging.

### Analyse de vuln√©rabilit√©

Il est possible d'activer le **scanner de vuln√©rabilit√©** qui v√©rifiera la pr√©sence de vuln√©rabilit√©s dans les **images de conteneurs**.

### √ânum√©ration
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### √âl√©vation de privil√®ges

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### Acc√®s non authentifi√©

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### Post-exploitation

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### Persistance

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> !</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-moi** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
