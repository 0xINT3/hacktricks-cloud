# GCP - Filestore 枚举

<details>

<summary><strong>从零到英雄学习 AWS 黑客技术，通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 **HackTricks 中看到您的公司广告** 或 **下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现 [**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFT 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来分享您的黑客技巧。

</details>

## 基本信息

Google Cloud Filestore 是一种托管文件存储服务，适用于需要**文件系统接口和共享文件系统进行数据**处理的应用程序。Filestore 提供高性能的文件共享，您可以将其挂载到不同的 GCP 服务上。它特别适用于依赖传统文件系统接口和语义的应用程序和工作流程，如媒体处理、内容管理和数据库备份。

您可以将其视为任何其他**NFS** **共享文档存储库** - 潜在的敏感信息来源。

### 连接

创建 Filestore 实例时，可以**选择它将可访问的网络**。

此外，默认情况下，所选 VPC 网络和区域中的所有客户端都将能够访问它，但也可以**通过 IP 地址**或范围**限制访问**，并指示客户端将获得的访问权限（管理员、管理员查看者、编辑者、查看者）**取决于 IP 地址。**

它还可以通过**私有服务访问连接**访问：

* 是每个 VPC 网络特有的，可以跨所有托管服务（如 Memorystore、Tensorflow 和 SQL）使用。
* 是**您的 VPC 网络和 Google 所拥有的网络之间使用 VPC 对等连接**，使您的实例和服务能够专门通过**使用内部 IP 地址**进行通信。
* 为您在服务提供方侧创建一个隔离的项目，意味着没有其他客户共享它。您只需为您配置的资源付费。
* VPC 对等连接将向您的 VPC 导入新路由

### 备份

可以创建**文件共享的备份**。这些备份可以稍后在**原始**新 Fileshare 实例或**新实例**中**恢复**。

### 加密

默认情况下，将使用**Google 管理的加密密钥**来加密数据，但可以选择**客户管理的加密密钥（CMEK）**。

### 枚举

如果您发现项目中有可用的 filestore，您可以从您受损的 Compute 实例中**挂载**它。使用以下命令查看是否存在。

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
请注意，filestore 服务可能位于为其**新创建的完全新的子网**中（位于私有服务访问连接内，这是一个**VPC 对等连接**）。\
因此，您可能需要**枚举 VPC 对等连接**，也要在这些网络范围内运行 nmap。

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### 权限提升 & 后期利用

在 GCP 中直接滥用此服务并没有提升权限的方法，但使用一些**后期利用技巧可以访问数据**，也许你可以找到一些凭据来提升权限：

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### 持久性

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>从零开始学习 AWS 黑客攻击！</strong></summary>

支持 HackTricks 的其他方式：

* 如果你想在 HackTricks 中看到你的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFT 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享你的黑客技巧。

</details>
