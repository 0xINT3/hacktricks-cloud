# GCP - √ânum√©ration de Filestore

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-moi** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informations de base

Google Cloud Filestore est un service de stockage de fichiers g√©r√© pour les applications qui n√©cessitent une **interface de syst√®me de fichiers et un syst√®me de fichiers partag√© pour les donn√©es**. Filestore fournit des partages de fichiers haute performance que vous pouvez monter sur diff√©rents services GCP. C'est particuli√®rement utile pour les applications et les flux de travail qui d√©pendent des interfaces et s√©mantiques de syst√®me de fichiers traditionnels, comme le traitement de m√©dias, la gestion de contenu et les sauvegardes de bases de donn√©es.

Vous pouvez le consid√©rer comme tout autre **r√©pertoire de documents partag√©s NFS** - une source potentielle d'informations sensibles.

### Connexions

Lors de la cr√©ation d'une instance Filestore, il est possible de **s√©lectionner le r√©seau o√π elle sera accessible**.

De plus, par **d√©faut, tous les clients sur le r√©seau VPC s√©lectionn√© et la r√©gion pourront y acc√©der**, cependant, il est possible de **restreindre l'acc√®s √©galement par adresse IP** ou plage et d'indiquer le privil√®ge d'acc√®s (Admin, Admin Viewer, Editor, Viewer) que le client obtiendra **en fonction de l'adresse IP.**

Il peut √©galement √™tre accessible via une **connexion Private Service Access :**

* Sont par r√©seau VPC et peuvent √™tre utilis√©s √† travers tous les services g√©r√©s tels que Memorystore, Tensorflow et SQL.
* Sont **entre votre r√©seau VPC et un r√©seau d√©tenu par Google en utilisant un peering VPC**, permettant √† vos instances et services de communiquer exclusivement en **utilisant des adresses IP internes**.
* Cr√©ent un projet isol√© pour vous du c√¥t√© du fournisseur de service, ce qui signifie qu'aucun autre client ne le partage. Vous serez factur√© uniquement pour les ressources que vous provisionnez.
* Le peering VPC importera de nouvelles routes vers votre VPC

### Sauvegardes

Il est possible de cr√©er des **sauvegardes des partages de fichiers**. Celles-ci peuvent √™tre plus tard **restaur√©es dans l'instance Fileshare d'origine** ou dans de **nouvelles instances**.

### Chiffrement

Par d√©faut, une **cl√© de chiffrement g√©r√©e par Google** sera utilis√©e pour chiffrer les donn√©es, mais il est possible de s√©lectionner une **cl√© de chiffrement g√©r√©e par le client (CMEK)**.

### √ânum√©ration

Si vous trouvez un Filestore disponible dans le projet, vous pouvez le **monter** depuis votre instance Compute compromise. Utilisez la commande suivante pour voir s'il en existe.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Notez qu'un service filestore pourrait se trouver dans un **sous-r√©seau enti√®rement nouveau cr√©√© pour celui-ci** (√† l'int√©rieur d'une connexion d'acc√®s aux services priv√©s, qui est un **pairage VPC**).\
Il se peut donc que vous deviez **√©num√©rer les pairages VPC** pour √©galement ex√©cuter nmap sur ces plages de r√©seaux.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
```markdown
{% endcode %}
{% endhint %}

### √âl√©vation de privil√®ges & Post-exploitation

Il n'existe pas de m√©thodes pour √©lever les privil√®ges dans GCP en abusant directement de ce service, mais en utilisant certaines astuces de **Post-exploitation, il est possible d'acc√©der aux donn√©es** et peut-√™tre trouverez-vous des identifiants pour √©lever les privil√®ges :

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Persistance

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-moi** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```
