# GCP - Filestore Enum

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## Grundlegende Informationen

Google Cloud Filestore ist ein **verwalteter Dateispeicherdienst**, der f√ºr Anwendungen entwickelt wurde, die sowohl eine **Dateisystem-Schnittstelle als auch ein gemeinsames Dateisystem f√ºr Daten** ben√∂tigen. Dieser Dienst zeichnet sich durch die Bereitstellung von leistungsstarken Dateifreigaben aus, die mit verschiedenen GCP-Diensten integriert werden k√∂nnen. Sein Nutzen zeigt sich in Szenarien, in denen traditionelle Dateisystem-Schnittstellen und Semantik entscheidend sind, z. B. bei der Medienverarbeitung, dem Content-Management und der Sicherung von Datenbanken.

Sie k√∂nnen dies wie ein beliebiges **NFS** **gemeinsames Dokumenten-Repository** betrachten - eine potenzielle Quelle f√ºr sensible Informationen.

### Verbindungen

Beim Erstellen einer Filestore-Instanz ist es m√∂glich, **das Netzwerk auszuw√§hlen, √ºber das es erreichbar sein soll**.

Dar√ºber hinaus k√∂nnen **standardm√§√üig alle Clients im ausgew√§hlten VPC-Netzwerk und in der Region darauf zugreifen**, es ist jedoch m√∂glich, **den Zugriff auch nach IP-Adresse** oder Bereich einzuschr√§nken und die Zugriffsrechte (Admin, Admin Viewer, Editor, Viewer) f√ºr den Client **je nach IP-Adresse anzugeben**.

Es kann auch √ºber eine **Private Service Access-Verbindung** erreichbar sein:

* Sind pro VPC-Netzwerk und k√∂nnen f√ºr alle verwalteten Dienste wie Memorystore, Tensorflow und SQL verwendet werden.
* Befinden sich **zwischen Ihrem VPC-Netzwerk und einem von Google besessenen Netzwerk unter Verwendung einer VPC-Peering-Verbindung**, wodurch Ihre Instanzen und Dienste ausschlie√ülich √ºber **interne IP-Adressen kommunizieren** k√∂nnen.
* Erstellen ein isoliertes Projekt f√ºr Sie auf der Dienstanbieterseite, was bedeutet, dass es von keinen anderen Kunden geteilt wird. Sie werden nur f√ºr die Ressourcen abgerechnet, die Sie bereitstellen.
* Das VPC-Peering wird neue Routen in Ihr VPC importieren

### Backups

Es ist m√∂glich, **Backups der Dateifreigaben zu erstellen**. Diese k√∂nnen sp√§ter **im Ursprung** der neuen Fileshare-Instanz oder in **neuen Instanzen** wiederhergestellt werden.

### Verschl√ºsselung

Standardm√§√üig wird ein **von Google verwalteter Verschl√ºsselungsschl√ºssel** verwendet, aber es ist m√∂glich, einen **kundenverwalteten Verschl√ºsselungsschl√ºssel (CMEK)** auszuw√§hlen.

### Enumeration

Wenn Sie eine verf√ºgbare Filestore-Instanz im Projekt finden, k√∂nnen Sie diese von Ihrer kompromittierten Compute-Instanz aus **einbinden**. Verwenden Sie den folgenden Befehl, um zu sehen, ob welche vorhanden sind.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Beachten Sie, dass ein Filestore-Dienst sich m√∂glicherweise in einem **v√∂llig neuen Subnetz** befindet, das speziell f√ºr ihn erstellt wurde (innerhalb einer Verbindung f√ºr privaten Dienstzugriff, die ein **VPC-Peer** ist).\
Daher m√ºssen Sie m√∂glicherweise auch **VPC-Peers aufz√§hlen**, um nmap √ºber diese Netzwerkbereiche auszuf√ºhren.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Privilege Escalation & Post Exploitation

Es gibt keine direkten M√∂glichkeiten, Berechtigungen in GCP zu eskalieren, indem dieser Dienst missbraucht wird, aber mit einigen **Post-Exploitation-Tricks ist es m√∂glich, Zugriff auf die Daten zu erhalten** und m√∂glicherweise k√∂nnen Sie einige Anmeldeinformationen finden, um Berechtigungen zu eskalieren:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Persistenz

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks in PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
