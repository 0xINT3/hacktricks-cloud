# GCP - Filestore Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

## 基本情報

Google Cloud Filestoreは、**ファイルシステムインターフェースとデータ用の共有ファイルシステムが必要なアプリケーション**向けの管理されたファイルストレージサービスです。Filestoreは、異なるGCPサービスにマウントできる高性能なファイル共有を提供します。これは、メディア処理、コンテンツ管理、データベースバックアップなど、従来のファイルシステムインターフェースとセマンティクスに依存するアプリケーションやワークフローに特に有用です。

これを**NFS** **共有ドキュメントリポジトリ**のように考えることができます - 機密情報の潜在的な情報源です。

### 接続

Filestoreインスタンスを作成する際には、**アクセス可能なネットワークを選択することができます**。

さらに、**デフォルトでは選択されたVPCネットワークとリージョンのすべてのクライアントがアクセスできるようになりますが**、**IPアドレス**または範囲によってアクセスを制限し、クライアントが取得するアクセス権限（管理者、管理者ビューアー、エディター、ビューアー）を指定することも可能です**IPアドレスに応じて**。

また、**プライベートサービスアクセス接続**を介してアクセスすることもできます：

* VPCネットワークごとにあり、Memorystore、Tensorflow、SQLなどのすべての管理サービスで使用できます。
* **VPCピアリングを使用して、Googleが所有するネットワークとの間にあるVPCネットワークとの間のものであり**、インスタンスとサービスが**内部IPアドレスを使用してのみ通信する**ことを可能にします。
* サービスプロバイダー側であなたのために分離されたプロジェクトを作成し、他の顧客とは共有されません。プロビジョニングしたリソースのみが請求されます。
* VPCピアリングは、VPCに新しいルートをインポートします

### バックアップ

**ファイル共有のバックアップ**を作成することができます。これらは後で**元の**新しいFileshareインスタンスまたは**新しいもの**に**復元**することができます。

### 暗号化

デフォルトでは**Google管理の暗号化キー**がデータの暗号化に使用されますが、**顧客管理の暗号化キー（CMEK）**を選択することも可能です。

### 列挙

プロジェクトで利用可能なfilestoreを見つけた場合、侵害されたComputeインスタンスから**マウント**することができます。存在するかどうかを確認するには、以下のコマンドを使用します。

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
ファイルストアサービスは、それ専用に作成された**完全に新しいサブネットワーク**（プライベートサービスアクセス接続内の**VPCピア**）にある可能性があります。
したがって、それらのネットワーク範囲に対してnmapを実行するためには、**VPCピアを列挙する**必要があるかもしれません。

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### 権限昇格 & ポストエクスプロイト

GCPでこのサービスを直接悪用して権限を昇格する方法はありませんが、**ポストエクスプロイトのテクニックを使用してデータにアクセスすることが可能**で、権限を昇格させるためのクレデンシャルが見つかるかもしれません：

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### 永続性

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加する、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングテクニックを共有する。

</details>
