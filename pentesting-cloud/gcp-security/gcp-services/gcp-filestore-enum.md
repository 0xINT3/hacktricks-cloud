# GCP - Enumera√ß√£o de Filestore

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informa√ß√µes B√°sicas

O Google Cloud Filestore √© um servi√ßo gerenciado de armazenamento de arquivos para aplica√ß√µes que requerem uma **interface de sistema de arquivos e um sistema de arquivos compartilhado para dados**. O Filestore fornece compartilhamentos de arquivos de alto desempenho que voc√™ pode montar em diferentes servi√ßos do GCP. √â particularmente √∫til para aplica√ß√µes e fluxos de trabalho que dependem de interfaces e sem√¢nticas de sistema de arquivos tradicionais, como processamento de m√≠dia, gerenciamento de conte√∫do e backups de banco de dados.

Voc√™ pode pensar nisso como qualquer outro **reposit√≥rio de documentos compartilhados NFS** - uma fonte potencial de informa√ß√µes sens√≠veis.

### Conex√µes

Ao criar uma inst√¢ncia do Filestore, √© poss√≠vel **selecionar a rede onde ela ser√° acess√≠vel**.

Al√©m disso, por **padr√£o, todos os clientes na rede VPC selecionada e regi√£o poder√£o acess√°-la**, no entanto, √© poss√≠vel **restringir o acesso tamb√©m por endere√ßo IP** ou intervalo e indicar o privil√©gio de acesso (Admin, Admin Viewer, Editor, Viewer) que o cliente ter√° **dependendo do endere√ßo IP.**

Tamb√©m pode ser acess√≠vel via uma **Conex√£o de Acesso ao Servi√ßo Privado:**

* S√£o por rede VPC e podem ser usadas em todos os servi√ßos gerenciados, como Memorystore, Tensorflow e SQL.
* S√£o **entre sua rede VPC e rede de propriedade do Google usando um VPC peering**, permitindo que suas inst√¢ncias e servi√ßos se comuniquem exclusivamente por **usar endere√ßos IP internos**.
* Criam um projeto isolado para voc√™ no lado do produtor do servi√ßo, o que significa que nenhum outro cliente o compartilha. Voc√™ ser√° cobrado apenas pelos recursos que provisionar.
* O VPC peering importar√° novas rotas para o seu VPC

### Backups

√â poss√≠vel criar **backups dos compartilhamentos de arquivos**. Estes podem ser posteriormente **restaurados na origem** nova inst√¢ncia de Fileshare ou em **novas**.

### Criptografia

Por padr√£o, uma **chave de criptografia gerenciada pelo Google** ser√° usada para criptografar os dados, mas √© poss√≠vel selecionar uma **chave de criptografia gerenciada pelo cliente (CMEK)**.

### Enumera√ß√£o

Se voc√™ encontrar um filestore dispon√≠vel no projeto, voc√™ pode **mont√°-lo** a partir de sua inst√¢ncia de Compute comprometida. Use o seguinte comando para ver se algum existe.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Observe que um servi√ßo de filestore pode estar em uma **sub-rede completamente nova criada para ele** (dentro de uma Conex√£o de Acesso a Servi√ßo Privado, que √© um **parceiro VPC**).\
Portanto, voc√™ pode precisar **enumerar parceiros VPC** para tamb√©m executar nmap sobre esses intervalos de rede.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Escalonamento de Privil√©gios & P√≥s-Explora√ß√£o

N√£o existem maneiras de escalar privil√©gios no GCP diretamente abusando deste servi√ßo, mas utilizando algumas **t√©cnicas de P√≥s-Explora√ß√£o √© poss√≠vel obter acesso aos dados** e talvez voc√™ possa encontrar algumas credenciais para escalar privil√©gios:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Persist√™ncia

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
