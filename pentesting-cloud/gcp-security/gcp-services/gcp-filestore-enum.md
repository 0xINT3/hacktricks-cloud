# GCP - Filestore Enum

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

Google Cloud Filestore jest opisany jako **zarządzana usługa przechowywania plików** dostosowana do aplikacji, które potrzebują zarówno **interfejsu systemu plików, jak i współdzielonego systemu plików dla danych**. Ta usługa wyróżnia się oferowaniem wysokowydajnych udziałów plików, które można zintegrować z różnymi usługami GCP. Jej użyteczność przejawia się w scenariuszach, gdzie tradycyjne interfejsy i semantyki systemu plików są kluczowe, takich jak przetwarzanie mediów, zarządzanie treścią i tworzenie kopii zapasowych baz danych.

Można to porównać do dowolnego innego **repozytorium dokumentów współdzielonych NFS** - potencjalnego źródła poufnych informacji.

### Połączenia

Podczas tworzenia instancji Filestore możliwe jest **wybranie sieci, z której będzie dostępna**.

Ponadto, **domyślnie wszystkie klienty w wybranej sieci VPC i regionie będą miały do niej dostęp**, jednak możliwe jest **ograniczenie dostępu również przez adres IP** lub zakres oraz wskazanie uprawnień dostępu (Administrator, Przeglądający administratora, Edytor, Przeglądający) w zależności od adresu IP klienta.

Można również uzyskać do niej dostęp za pośrednictwem **połączenia z prywatnym dostępem do usługi:**

* Dotyczą sieci VPC i mogą być używane we wszystkich zarządzanych usługach, takich jak Memorystore, Tensorflow i SQL.
* Są **między twoją siecią VPC a siecią należącą do Google, używając połączenia VPC peering**, umożliwiając twoim instancjom i usługom komunikację wyłącznie za pomocą **adresów IP wewnętrznych**.
* Tworzą izolowany projekt dla ciebie po stronie dostawcy usługi, co oznacza, że nie jest on udostępniany innym klientom. Będziesz płacić tylko za zasoby, które udostępnisz.
* Połączenie VPC peering importuje nowe trasy do twojej sieci VPC

### Kopie zapasowe

Możliwe jest tworzenie **kopii zapasowych udziałów plików**. Mogą one być później **przywracane w oryginalnej** nowej instancji Fileshare lub w **nowych**.

### Szyfrowanie

Domyślnie używany jest **zarządzany przez Google klucz szyfrowania**, ale możliwe jest wybranie **klienta zarządzanego klucza szyfrowania (CMEK)**.

### Wyliczanie

Jeśli znajdziesz dostępną instancję Filestore w projekcie, możesz ją **zamontować** wewnątrz skompromitowanej instancji Compute. Użyj poniższej komendy, aby sprawdzić, czy istnieją jakiekolwiek instancje.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Należy pamiętać, że usługa filestore może znajdować się w **całkowicie nowej podsieci utworzonej dla niej** (w ramach połączenia dostępu do prywatnej usługi, które jest **pełnoprawnym VPC**).\
Dlatego może być konieczne **przeanalizowanie pełnoprawnych VPC** w celu uruchomienia nmap na tych zakresach sieciowych.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Eskalacja uprawnień i post-eksploatacja

Nie ma bezpośrednich sposobów eskalacji uprawnień w GCP, nadużywając tej usługi, ale za pomocą niektórych **trików post-eksploatacyjnych można uzyskać dostęp do danych** i być może można znaleźć pewne poświadczenia do eskalacji uprawnień:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Trwałość

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel się swoimi trikami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
