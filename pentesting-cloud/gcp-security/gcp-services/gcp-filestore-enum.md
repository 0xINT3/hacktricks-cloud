# GCP - Enum√©ration de Filestore

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

- Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
- D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
- **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
- **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informations de base

Google Cloud Filestore est un **service de stockage de fichiers g√©r√©** con√ßu pour les applications ayant besoin √† la fois d'une **interface de syst√®me de fichiers et d'un syst√®me de fichiers partag√© pour les donn√©es**. Ce service se distingue en offrant des partages de fichiers haute performance, qui peuvent √™tre int√©gr√©s √† divers services GCP. Son utilit√© se manifeste dans des sc√©narios o√π des interfaces et s√©mantiques de syst√®me de fichiers traditionnels sont cruciaux, tels que le traitement des m√©dias, la gestion de contenu et la sauvegarde de bases de donn√©es.

Vous pouvez le consid√©rer comme tout autre **d√©p√¥t de documents partag√©s NFS** - une source potentielle d'informations sensibles.

### Connexions

Lors de la cr√©ation d'une instance Filestore, il est possible de **s√©lectionner le r√©seau sur lequel elle sera accessible**.

De plus, par **d√©faut, tous les clients sur le r√©seau VPC et la r√©gion s√©lectionn√©s pourront y acc√©der**, cependant, il est possible de **restreindre l'acc√®s √©galement par adresse IP** ou plage et indiquer le privil√®ge d'acc√®s (Administrateur, Administrateur Viewer, √âditeur, Viewer) que l'utilisateur du client va obtenir **en fonction de l'adresse IP**.

Il peut √©galement √™tre accessible via une **connexion d'acc√®s √† un service priv√© :**

- Sont par r√©seau VPC et peuvent √™tre utilis√©s avec tous les services g√©r√©s tels que Memorystore, Tensorflow et SQL.
- Sont **entre votre r√©seau VPC et le r√©seau d√©tenu par Google en utilisant un couplage VPC**, permettant √† vos instances et services de communiquer exclusivement en **utilisant des adresses IP internes**.
- Cr√©e un projet isol√© pour vous du c√¥t√© du producteur de services, ce qui signifie qu'aucun autre client ne le partage. Vous serez factur√© uniquement pour les ressources que vous provisionnez.
- Le couplage VPC importera de nouvelles routes dans votre VPC.

### Sauvegardes

Il est possible de cr√©er des **sauvegardes des partages de fichiers**. Celles-ci peuvent √™tre ensuite **restaur√©es dans l'instance d'origine** du nouveau partage de fichiers ou dans **de nouveaux**.

### Chiffrement

Par d√©faut, une **cl√© de chiffrement g√©r√©e par Google** sera utilis√©e pour chiffrer les donn√©es, mais il est possible de s√©lectionner une **cl√© de chiffrement g√©r√©e par le client (CMEK)**.

### √ânum√©ration

Si vous trouvez un filestore disponible dans le projet, vous pouvez le **monter** depuis votre instance Compute compromise. Utilisez la commande suivante pour voir s'il en existe.
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Notez qu'un service de stockage de fichiers pourrait se trouver dans un **tout nouveau sous-r√©seau cr√©√© pour lui** (√† l'int√©rieur d'une connexion d'acc√®s √† un service priv√©, qui est un **pair de VPC**).\
Vous pourriez donc avoir besoin de **√©num√©rer les pairs de VPC** pour √©galement ex√©cuter nmap sur ces plages r√©seau.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### √âl√©vation de privil√®ges et post-exploitation

Il n'y a pas de moyens d'escalader les privil√®ges dans GCP en abusant directement de ce service, mais en utilisant quelques **astuces de post-exploitation, il est possible d'acc√©der aux donn√©es** et peut-√™tre trouver des identifiants pour escalader les privil√®ges :

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Persistance

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
