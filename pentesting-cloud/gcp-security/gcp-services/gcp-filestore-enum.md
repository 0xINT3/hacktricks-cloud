# GCP - Filestore Enum

<details>

<summary><strong>ゼロからヒーローまでAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションを見つける
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**または[telegramグループ](https://t.me/peass)に**参加**するか、**Twitter** 🐦で私をフォローする：[**@carlospolopm**](https://twitter.com/carlospolopm)。
- **HackTricks**および**HackTricks Cloud**のgithubリポジトリにPRを提出して、あなたのハッキングトリックを共有してください。

</details>

## 基本情報

Google Cloud Filestoreは、**ファイルシステムインターフェースとデータの共有ファイルシステムの両方を必要とするアプリケーション向けに設計された** **管理されたファイルストレージサービス**です。このサービスは、高性能のファイル共有を提供することで優れており、さまざまなGCPサービスと統合できます。従来のファイルシステムインターフェースとセマンティクスが重要なシナリオ、例えばメディア処理、コンテンツ管理、およびデータベースのバックアップなどで、その有用性が光ります。

これは、他の**NFS** **共有ドキュメントリポジトリ**のように考えることができます - 機密情報の潜在的なソースです。

### 接続

Filestoreインスタンスを作成する際には、**アクセス可能なネットワークを選択**することができます。

さらに、**デフォルトでは選択したVPCネットワークとリージョンのすべてのクライアントがアクセスできる**が、**IPアドレスまたは範囲によるアクセス制限**も可能であり、クライアントが**IPアドレスに応じて取得するアクセス権限（管理者、管理者ビューア、エディタ、ビューア）**を示すことができます。

また、**プライベートサービスアクセス接続**を介してアクセスすることもできます：

- VPCネットワークごとにあり、Memorystore、Tensorflow、SQLなどのすべての管理されたサービスで使用できます。
- **VPCピアリングを使用してGoogleが所有するネットワークとの間で**、内部IPアドレスを使用して**インスタンスとサービスが通信できるようにする**ことができます。
- サービスプロデューサー側であなたのために孤立したプロジェクトを作成し、他の顧客と共有されないことを意味します。提供したリソースのみが請求されます。
- VPCピアリングは、VPCに新しいルートをインポートします

### バックアップ

**ファイル共有のバックアップ**を作成することができます。これらは後で**元の**新しいFileshareインスタンスまたは**新しいインスタンス**に**復元**できます。

### 暗号化

デフォルトでは、データを暗号化するために**Google管理の暗号化キー**が使用されますが、**顧客管理型暗号化キー（CMEK）**を選択することも可能です。

### 列挙

プロジェクトで利用可能なファイルストアを見つけた場合、侵害されたComputeインスタンス内から**マウント**することができます。次のコマンドを使用して存在するかどうかを確認します。

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
ファイルストアサービスは、それ専用に作成された**完全に新しいサブネット**内にある可能性があることに注意してください（VPCピア内のプライベートサービスアクセス接続）。\
そのため、**VPCピアを列挙**して、それらのネットワーク範囲に対してnmapを実行する必要があるかもしれません。

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
### 特権昇格とポストエクスプロイテーション

GCPを直接悪用して特権を昇格させる方法はありませんが、**ポストエクスプロイテーションのトリックを使用するとデータにアクセスできる可能性があり、特権を昇格させるための資格情報を見つけることができるかもしれません**：

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### 永続性

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）でAWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい場合は**、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォロー**する。
* **ハッキングトリックを共有するために、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。**

</details>
