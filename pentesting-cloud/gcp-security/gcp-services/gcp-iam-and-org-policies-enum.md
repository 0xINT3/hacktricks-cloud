# GCP - IAM, Ppals & Org Policies Enum

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**d√©p√¥ts Github HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Comptes de service

Pour une introduction sur ce qu'est un compte de service, consultez :

{% content-ref url="../gcp-basic-information.md" %}
[gcp-basic-information.md](../gcp-basic-information.md)
{% endcontent-ref %}

### √ânum√©ration

Un compte de service appartient toujours √† un projet :

```bash
gcloud iam service-accounts list --project <project>
```

## Utilisateurs et groupes

Pour une introduction sur la fa√ßon dont les utilisateurs et les groupes fonctionnent dans GCP, consultez :

{% content-ref url="../gcp-basic-information.md" %}
[gcp-basic-information.md](../gcp-basic-information.md)
{% endcontent-ref %}

### √ânum√©ration

Avec les autorisations **`serviceusage.services.enable`** et **`serviceusage.services.use`**, il est possible d'**activer des services** dans un projet et de les utiliser.

Si vous pouvez **activer le service `admin`** et si votre utilisateur a **suffisamment de privil√®ges dans l'espace de travail**, vous pouvez **√©num√©rer tous les groupes et utilisateurs** avec les lignes suivantes.\
M√™me s'il est indiqu√© **`identity groups`**, cela renvoie √©galement **les utilisateurs sans aucun groupe** :

```bash
# Activer admin
gcloud services enable admin.googleapis.com
# Liste de tous les utilisateurs et groupes
gcloud organizations list # Le DIRECTORY_CUSTOMER_ID est l'ID de l'espace de travail
gcloud beta identity groups preview --customer <workspace-id>
## Membres du groupe
gcloud identity groups memberships search-transitive-memberships --group-email=email@group.com
```

M√™me avec le service admin activ√©, il est possible que vous obteniez une erreur lors de l'√©num√©ration car votre utilisateur de l'espace de travail compromis n'a pas suffisamment de privil√®ges :

<figure><img src="../../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

Si vous pouvez activer le service **`cloudidentity.googleapli.com`** s'il est d√©sactiv√©, vous pouvez l'utiliser pour **√©num√©rer les groupes** (comme dans PurplePanda [ici](https://github.com/carlospolop/PurplePanda/blob/master/intel/google/discovery/disc\_groups\_users.py)) :

```
gcloud services enable cloudidentity.googleapis.com
```

## IAM

Consultez [**ceci pour des informations de base sur IAM**](../gcp-basic-information.md#iam-roles).

### Autorisations par d√©faut

D'apr√®s la [**documentation**](https://cloud.google.com/resource-manager/docs/default-access-control) : Lorsqu'une ressource d'organisation est cr√©√©e, tous les utilisateurs de votre domaine se voient accorder les r√¥les de **Cr√©ateur de compte de facturation** et de **Cr√©ateur de projet** par d√©faut. Ces r√¥les par d√©faut permettent √† vos utilisateurs de commencer √† utiliser Google Cloud imm√©diatement, mais ne sont pas destin√©s √† √™tre utilis√©s dans le fonctionnement r√©gulier de votre ressource d'organisation.

Ces **r√¥les** accordent les **autorisations** suivantes :

* `billing.accounts.create` et `resourcemanager.organizations.get`
* `resourcemanager.organizations.get` et `resourcemanager.projects.create`

{% hint style="danger" %}
Le privil√®ge le plus √©lev√© dans une organisation GCP est le r√¥le d'**administrateur d'organisation**.
{% endhint %}

### √ânum√©ration

```bash
# R√¥les
## Liste des r√¥les
gcloud iam roles list --project $PROJECT_ID # Liste uniquement des r√¥les personnalis√©s
gcloud iam roles list --filter='etag:AA=='

## Obtenir les autorisations et la description du r√¥le
gcloud iam roles describe roles/container.admin
gcloud iam roles describe --project <proj-name> <role-name>

# Politiques
gcloud organizations get-iam-policy <org_id>
gcloud resource-manager folders get-iam-policy <folder-id>
gcloud projects get-iam-policy <project-id>

# DIVERS
## Autorisations testables dans la ressource
gcloud iam list-testable-permissions --filter "NOT apiDisabled