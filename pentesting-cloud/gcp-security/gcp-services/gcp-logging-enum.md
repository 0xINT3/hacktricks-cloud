# GCP - Günlük Sorgulama

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek paylaşın.

</details>

## Temel Bilgiler

Bu hizmet, kullanıcıların GCP'den **günlük verilerini ve olaylarını** depolamasına, aramasına, analiz etmesine, izlemesine ve uyarı almasına olanak tanır.

Cloud Logging, diğer GCP hizmetleriyle tam entegre olup, GCP kaynaklarınızdan gelen günlükleri merkezi bir depo olarak sağlar. Otomatik olarak App Engine, Compute Engine ve Cloud Functions gibi çeşitli GCP hizmetlerinden günlükleri toplayabilirsiniz. Ayrıca, Cloud Logging ajanını veya API'sını kullanarak yerinde veya diğer bulutlarda çalışan uygulamalar için de Cloud Logging'i kullanabilirsiniz.

Ana Özellikler:

* **Günlük Verilerinin Merkezileştirilmesi:** Uygulamalarınızın ve altyapınızın bütünsel bir görünümünü sunan çeşitli kaynaklardan günlük verilerini birleştirin.
* **Gerçek Zamanlı Günlük Yönetimi:** Hızlı analiz ve yanıt için günlükleri gerçek zamanlı olarak akış halinde tutun.
* **Güçlü Veri Analizi:** Büyük miktardaki günlük verilerini hızlı bir şekilde süzerek gelişmiş filtreleme ve arama yeteneklerini kullanın.
* **BigQuery ile Entegrasyon:** Ayrıntılı analiz ve sorgulama için günlükleri BigQuery'ye aktarın.
* **Günlük Tabanlı Metrikler:** Günlük verilerinizden ölçüm ve uyarılar için özel metrikler oluşturun.

### Günlük Akışı

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption><p><a href="https://betterstack.com/community/guides/logging/gcp-logging/">https://betterstack.com/community/guides/logging/gcp-logging/</a></p></figcaption></figure>

Temel olarak, sinkler ve günlük tabanlı metrikler bir günlüğün nereye depolanacağını belirler.

### GCP Logging Tarafından Desteklenen Yapılandırmalar

Cloud Logging, çeşitli işletme ihtiyaçlarına uyacak şekilde yüksek düzeyde yapılandırılabilir:

1. **Günlük Kovaları (Web'deki günlük depolama):** Günlük saklama süresini yönetmek için Cloud Logging'de kovalar tanımlayın, böylece günlük girişlerinizin ne kadar süreyle saklanacağı konusunda kontrol sağlayabilirsiniz.
* Varsayılan olarak, `_Default` ve `_Required` adında kovalar oluşturulur (bir tanesi diğerinin olmayanı kaydeder).
*   **\_Required** şu şekildedir:

{% code overflow="wrap" %}
```bash
LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
```
{% endcode %}
* Verilerin **saklama süresi** kova başına yapılandırılır ve en az **1 gün olmalıdır**. Ancak, **\_Required'in saklama süresi 400 gün** olarak yapılandırılmıştır ve değiştirilemez.
* Günlük Kovaları'nın **Cloud Storage'da görünmediğini** unutmayın.
2. **Günlük Sinkleri (Web'deki günlük yönlendirici):** Filtreye dayalı olarak günlük girişlerini Pub/Sub, BigQuery veya Cloud Storage gibi çeşitli hedeflere **dışa aktarmak** için sinkler oluşturun.
* Varsayılan olarak, `_Default` ve `_Required` için sinkler oluşturulur:
* ```bash
_Required  logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Required  LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
_Default   logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Default   NOT LOG_ID("cloudaudit.googleapis.com/activity") AND NOT LOG_ID("externalaudit.googleapis.com/activity") AND NOT LOG_ID("cloudaudit.googleapis.com/system_event") AND NOT LOG_ID("externalaudit.googleapis.com/system_event") AND NOT LOG_ID("cloudaudit.googleapis.com/access_transparency") AND NOT LOG_ID("externalaudit.googleapis.com/access_transparency")
```
* **Dışlama Filtreleri:** Belirli günlük girişlerinin alınmasını önlemek için **dışlama filtreleri** ayarlamak mümkündür, bu da maliyetleri düşürür ve gereksiz gürültüyü azaltır.
3. **Günlük Tabanlı Metrikler:** Günlük içeriğine dayalı olarak **özel metrikler** yapılandırarak günlük verilerine dayalı uyarı ve izleme yapın.
4. **Günlük görünümleri:** Günlük görünümleri, günlük kovalarınız içindeki günlüklere kimin erişimi olduğu konusunda gelişmiş ve ayrıntılı kontrol sağlar.
* Cloud Logging, her kova için otomatik olarak `_AllLogs` görünümünü oluşturur, bu görünüm tüm günlükleri gösterir. Cloud Logging ayrıca `_Default` kovası için `_Default` adında bir görünüm oluşturur. `_Default` kovası için `_Default` görünümü, Veri Erişim denetim günlüklerini hariç tutarak tüm günlükleri gösterir. `_AllLogs` ve `_Default` görünümleri düzenlenemez.

Bir kimseye yalnızca belirli bir Günlük görünümünü kullanma izni vermek için aşağıdaki gibi bir IAM politikası kullanmak mümkündür:
```json
{
"bindings": [
{
"members": [
"user:username@gmail.com"
],
"role": "roles/logging.viewAccessor",
"condition": {
"title": "Bucket reader condition example",
"description": "Grants logging.viewAccessor role to user username@gmail.com for the VIEW_ID log view.",
"expression":
"resource.name == \"projects/PROJECT_ID/locations/LOCATION/buckets/BUCKET_NAME/views/VIEW_ID\""
}
}
],
"etag": "BwWd_6eERR4=",
"version": 3
}
```
### Saptama

`gcloud` komut satırı aracı, kaynaklarınızı ve hizmetlerinizi yönetmenize olanak sağlayan GCP ekosisteminin ayrılmaz bir parçasıdır. İşte `gcloud`'u kullanarak günlük yapılandırmalarınızı ve erişim günlüklerinizi nasıl yönetebileceğinizi gösteren bir örnek.

{% code overflow="wrap" %}
```bash
# List buckets
gcloud logging buckets list
gcloud logging buckets describe <bucket-name> --location <location>

# List log entries: only logs that contain log entries are listed.
gcloud logging logs list

# Get log metrics
gcloud logging metrics list
gcloud logging metrics describe <metric-name>

# Get log sinks
gcloud logging sinks list
gcloud logging sinks describe <sink-name>

# Get log views
gcloud logging views list --bucket <bucket> --location global
gcloud logging views describe --bucket <bucket> --location global <view-id> # view-id is usually the same as the bucket name

# Get log links
gcloud logging links list --bucket _Default --location global
gcloud logging links describe <link-id> --bucket _Default --location global
```
{% endcode %}

**`cloudresourcemanager`**'ın günlüklerini kontrol etmek için bir örnek (izinleri BF için kullanılan): [https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512](https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512)

**`testIamPermissions`**'ın günlükleri yok:

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

### Son Aşama Saldırısı

{% content-ref url="../gcp-post-exploitation/gcp-logging-post-exploitation.md" %}
[gcp-logging-post-exploitation.md](../gcp-post-exploitation/gcp-logging-post-exploitation.md)
{% endcontent-ref %}

### Süreklilik

{% content-ref url="../gcp-persistence/gcp-logging-persistence.md" %}
[gcp-logging-persistence.md](../gcp-persistence/gcp-logging-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://cloud.google.com/logging/docs/logs-views#gcloud](https://cloud.google.com/logging/docs/logs-views#gcloud)
* [https://betterstack.com/community/guides/logging/gcp-logging/](https://betterstack.com/community/guides/logging/gcp-logging/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>
