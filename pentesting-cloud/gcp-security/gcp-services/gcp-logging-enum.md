# GCP - Logboek Enum

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat** Kontroleer die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS-familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFT's**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** my op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>

## Basiese Inligting

Hierdie diens stel gebruikers in staat om **logdata en gebeure** van GCP te stoor, soek, analiseer, monitor, en waarsku.

Cloud Logging is ten volle ge√Øntegreer met ander GCP-diens, wat 'n gesentraliseerde bewaarplek vir logboeke van al jou GCP-hulpbronne bied. Dit **versamel outomaties logboeke van verskeie GCP-diens** soos App Engine, Compute Engine, en Cloud Functions. Jy kan ook Cloud Logging gebruik vir toepassings wat op perseel of in ander wolke hardloop deur die Cloud Logging-agent of API te gebruik.

Kernkenmerke:

* **Logdata-sentralisasie:** Aggregeer logdata van verskeie bronne, wat 'n holistiese siening van jou toepassings en infrastruktuur bied.
* **Re√´le-tyd Logbestuur:** Stroom logboeke in re√´le tyd vir onmiddellike analise en reaksie.
* **Kragtige Data-analise:** Gebruik gevorderde filter- en soekvermo√´ns om deur groot volumes logdata vinnig te sif.
* **Integrasie met BigQuery:** Voer logboeke na BigQuery uit vir gedetailleerde analise en navrae.
* **Loggebaseerde Metriek:** Skep aangepaste metrieke van jou logdata vir monitering en waarskuwing.

### Logvloei

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption><p><a href="https://betterstack.com/community/guides/logging/gcp-logging/">https://betterstack.com/community/guides/logging/gcp-logging/</a></p></figcaption></figure>

Basies sal die opvangs en loggebaseerde metrieke bepaal waar 'n log gestoor moet word.

### Konfigurasies Ondersteun deur GCP Logging

Cloud Logging is hoogs konfigureerbaar om uiteenlopende operasionele behoeftes te pas:

1. **Logemmers (Logbewaring in die web):** Definieer emmers in Cloud Logging om **logbewaring** te bestuur, wat beheer bied oor hoe lank jou loginskrywings behou word.
* Standaard word die emmers `_Default` en `_Required` geskep (een log wat die ander nie is nie).
*   **\_Required** is:

{% code overflow="wrap" %}
```bash
LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
```
{% endcode %}
* Die **bewaringsperiode** van die data word per emmer gekonfigureer en moet **minstens 1 dag wees.** Die **bewaringsperiode van \_Required is egter 400 dae** en kan nie gewysig word nie.
* Let daarop dat Logemmers **nie sigbaar is in Cloud Storage nie.**
2. **Logopvangers (Logroeteerder in die web):** Skep opvangers om loginskrywings na verskeie bestemmings soos Pub/Sub, BigQuery, of Cloud Storage te **uitvoer** op grond van 'n **filter**.
* Standaard word opvangers vir die emmers `_Default` en `_Required` geskep:
* ```bash
_Required  logging.googleapis.com/projects/<proj-naam>/locations/global/buckets/_Required  LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
_Default   logging.googleapis.com/projects/<proj-naam>/locations/global/buckets/_Default   NOT LOG_ID("cloudaudit.googleapis.com/activity") AND NOT LOG_ID("externalaudit.googleapis.com/activity") AND NOT LOG_ID("cloudaudit.googleapis.com/system_event") AND NOT LOG_ID("externalaudit.googleapis.com/system_event") AND NOT LOG_ID("cloudaudit.googleapis.com/access_transparency") AND NOT LOG_ID("externalaudit.googleapis.com/access_transparency")
```
* **Uitsluitingsfilters:** Dit is moontlik om **uitsluitings op te stel om te voorkom dat spesifieke loginskrywings** ingesluk word, wat koste bespaar en onnodige geraas verminder.
3. **Loggebaseerde Metrieke:** Konfigureer **aangepaste metrieke** gebaseer op die inhoud van logboeke, wat waarskuwing en monitering op grond van logdata moontlik maak.
4. **Logaansigte:** Logaansigte gee gevorderde en **fynbeheer oor wie toegang het** tot die logboeke binne jou logemmers.&#x20;
* Cloud Logging **skep outomaties die `_AllLogs`-aansig vir elke emmer**, wat alle logboeke wys. Cloud Logging skep ook 'n aansig vir die `_Default`-emmer genaamd `_Default`. Die `_Default`-aansig vir die `_Default`-emmer wys alle logboeke behalwe Data-toegang-auditlogboeke. Die `_AllLogs`- en `_Default`-aansigte is nie wysigbaar nie.



Dit is moontlik om 'n hoof **alleenlik toe te laat om 'n spesifieke Logaansig** te gebruik met 'n IAM-beleid soos:
```json
{
"bindings": [
{
"members": [
"user:username@gmail.com"
],
"role": "roles/logging.viewAccessor",
"condition": {
"title": "Bucket reader condition example",
"description": "Grants logging.viewAccessor role to user username@gmail.com for the VIEW_ID log view.",
"expression":
"resource.name == \"projects/PROJECT_ID/locations/LOCATION/buckets/BUCKET_NAME/views/VIEW_ID\""
}
}
],
"etag": "BwWd_6eERR4=",
"version": 3
}
```
### Standaard Logs

Standaard word **Admin Write**-operasies (ook bekend as Admin Aktiwiteit ouditlogs) gelog (skryf metadata of konfigurasie-inligting) en **kan nie uitgeskakel word nie**.

Daarna kan die gebruiker **Data Toegang ouditlogs** aktiveer, dit is **Admin Lees, Data Skryf en Data Skryf**.

Meer inligting oor elke tipe log kan gevind word in die dokumentasie: [https://cloud.google.com/iam/docs/audit-logging](https://cloud.google.com/iam/docs/audit-logging)

Let egter daarop dat dit beteken dat standaard **`GetIamPolicy`**-aksies en ander leesaksies **nie gelog word nie**. Dus, standaard sal 'n aanvaller wat probeer om die omgewing te ontsluit nie gevang word as die stelseladministrateur nie opsetlik meer logs genereer nie.

Om meer logs in die konsole te aktiveer, moet die stelseladministrateur na [https://console.cloud.google.com/iam-admin/audit](https://console.cloud.google.com/iam-admin/audit) gaan en dit aktiveer. Daar is 2 verskillende opsies:

* **Standaard Konfigurasie**: Dit is moontlik om 'n standaard konfigurasie te skep en al die Admin Lees en/of Data Lees en/of Data Skryf logs te log en selfs vrygestelde hoofde:

<figure><img src="../../../.gitbook/assets/image (149).png" alt=""><figcaption></figcaption></figure>

* **Kies die dienste**: Of net **kies die dienste** waarvoor jy logs wil genereer en die tipe logs en die vrygestelde hoofde vir daardie spesifieke diens.

Let ook daarop dat slegs daardie logs standaard gegenereer word omdat die generering van meer logs die koste sal verhoog.

### Enumerasie

Die `gcloud`-opdraglynwerktuig is 'n integrale deel van die GCP-ekosisteem wat jou in staat stel om jou bronne en dienste te bestuur. Hier is hoe jy `gcloud` kan gebruik om jou logging-konfigurasies en toegangslogs te bestuur.

{% code overflow="wrap" %}
```bash
# List buckets
gcloud logging buckets list
gcloud logging buckets describe <bucket-name> --location <location>

# List log entries: only logs that contain log entries are listed.
gcloud logging logs list

# Get log metrics
gcloud logging metrics list
gcloud logging metrics describe <metric-name>

# Get log sinks
gcloud logging sinks list
gcloud logging sinks describe <sink-name>

# Get log views
gcloud logging views list --bucket <bucket> --location global
gcloud logging views describe --bucket <bucket> --location global <view-id> # view-id is usually the same as the bucket name

# Get log links
gcloud logging links list --bucket _Default --location global
gcloud logging links describe <link-id> --bucket _Default --location global
```
{% endcode %}

Voorbeeld om die logboeke van **`cloudresourcemanager`** (die een wat gebruik word om BF-toestemmings te) te kontroleer: [https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512](https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512)

Daar is nie logboeke van **`testIamPermissions`** nie:

<figure><img src="../../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

### Post Exploitation

{% content-ref url="../gcp-post-exploitation/gcp-logging-post-exploitation.md" %}
[gcp-logging-post-exploitation.md](../gcp-post-exploitation/gcp-logging-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../gcp-persistence/gcp-logging-persistence.md" %}
[gcp-logging-persistence.md](../gcp-persistence/gcp-logging-persistence.md)
{% endcontent-ref %}

## Verwysings

* [https://cloud.google.com/logging/docs/logs-views#gcloud](https://cloud.google.com/logging/docs/logs-views#gcloud)
* [https://betterstack.com/community/guides/logging/gcp-logging/](https://betterstack.com/community/guides/logging/gcp-logging/)

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat** Kontroleer die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS-familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFT's**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** my op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
