# GCP - Απαρίθμηση Καταγραφής

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Μοιραστείτε τα χάκινγκ τρικς σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Βασικές Πληροφορίες

Αυτή η υπηρεσία επιτρέπει στους χρήστες να αποθηκεύουν, να αναζητούν, να αναλύουν, να παρακολουθούν και να ειδοποιούνται για **δεδομένα καταγραφής και γεγονότα** από το GCP.

Η Cloud Logging είναι πλήρως ενσωματωμένη με άλλες υπηρεσίες του GCP, παρέχοντας ένα κεντρικό αποθετήριο για καταγραφές από όλους τους πόρους του GCP σας. Αυτή **συλλέγει αυτόματα καταγραφές από διάφορες υπηρεσίες του GCP** όπως η App Engine, η Compute Engine και οι Cloud Functions. Μπορείτε επίσης να χρησιμοποιήσετε την Cloud Logging για εφαρμογές που εκτελούνται είτε σε τοπικό περιβάλλον είτε σε άλλα cloud χρησιμοποιώντας τον πράκτορα ή το API της Cloud Logging.

Βασικά Χαρακτηριστικά:

* **Κεντρική Αποθήκευση Καταγραφών:** Συγκεντρώστε δεδομένα καταγραφής από διάφορες πηγές, προσφέροντας μια ολιστική άποψη των εφαρμογών και της υποδομής σας.
* **Διαχείριση Καταγραφών σε Πραγματικό Χρόνο:** Ροή καταγραφών σε πραγματικό χρόνο για άμεση ανάλυση και ανταπόκριση.
* **Ισχυρή Ανάλυση Δεδομένων:** Χρησιμοποιήστε προηγμένες δυνατότητες φιλτραρίσματος και αναζήτησης για γρήγορη αναζήτηση μεγάλου όγκου δεδομένων καταγραφής.
* **Ενσωμάτωση με το BigQuery:** Εξαγωγή καταγραφών στο BigQuery για λεπτομερή ανάλυση και ερωτήματα.
* **Καταγραφή βασισμένη σε μετρικές:** Δημιουργία προσαρμοσμένων μετρικών από τα δεδομένα καταγραφής σας για παρακολούθηση και ειδοποίηση.

### Ροή Καταγραφών

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption><p><a href="https://betterstack.com/community/guides/logging/gcp-logging/">https://betterstack.com/community/guides/logging/gcp-logging/</a></p></figcaption></figure>

Βασικά, οι απορροφητήρες και οι μετρικές βασισμένες σε καταγραφές θα καθορίσουν πού θα αποθηκευτεί μια καταγραφή.

### Διαμορφώσεις που υποστηρίζονται από το GCP Logging

Η Cloud Logging είναι υψηλά παραμετροποιήσιμη για να ανταποκριθεί σε διάφορες λειτουργικές ανάγκες:

1. **Κάδοι Καταγραφών (Αποθήκευση καταγραφών στον ιστό):** Ορίστε κάδους στο Cloud Logging για να διαχειρίζεστε τη **διατήρηση των καταχωρήσεων καταγραφής**, παρέχοντας έλεγχο για το πόσο καιρό διατηρούνται οι καταχωρήσεις καταγραφής σας.
* Από προεπιλογή δημιουργούνται οι κάδοι `_Default` και `_Required` (ο ένας καταγράφει αυτό που ο άλλος όχι).
*   Ο **\_Required** είναι:

{% code overflow="wrap" %}
```bash
LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
```
{% endcode %}
* Η **περίοδος διατήρησης** των δεδομένων ρυθμίζεται ανά κάδο και πρέπει να είναι **τουλάχιστον 1 ημέρα**. Ωστόσο, η **περίοδος διατήρησης του \_Required είναι 400 ημέρες** και δεν μπορεί να τροποποιηθεί.
* Σημειώστε ότι οι Κάδοι Καταγρ
```json
{
"bindings": [
{
"members": [
"user:username@gmail.com"
],
"role": "roles/logging.viewAccessor",
"condition": {
"title": "Bucket reader condition example",
"description": "Grants logging.viewAccessor role to user username@gmail.com for the VIEW_ID log view.",
"expression":
"resource.name == \"projects/PROJECT_ID/locations/LOCATION/buckets/BUCKET_NAME/views/VIEW_ID\""
}
}
],
"etag": "BwWd_6eERR4=",
"version": 3
}
```
### Απαρίθμηση

Το εργαλείο γραμμής εντολών `gcloud` είναι ένα αναπόσπαστο μέρος του οικοσυστήματος του GCP, που σας επιτρέπει να διαχειρίζεστε τους πόρους και τις υπηρεσίες σας. Εδώ είναι πώς μπορείτε να χρησιμοποιήσετε το `gcloud` για να διαχειριστείτε τις ρυθμίσεις καταγραφής και τα αρχεία καταγραφής πρόσβασης σας.

{% code overflow="wrap" %}
```bash
# List buckets
gcloud logging buckets list
gcloud logging buckets describe <bucket-name> --location <location>

# List log entries: only logs that contain log entries are listed.
gcloud logging logs list

# Get log metrics
gcloud logging metrics list
gcloud logging metrics describe <metric-name>

# Get log sinks
gcloud logging sinks list
gcloud logging sinks describe <sink-name>

# Get log views
gcloud logging views list --bucket <bucket> --location global
gcloud logging views describe --bucket <bucket> --location global <view-id> # view-id is usually the same as the bucket name

# Get log links
gcloud logging links list --bucket _Default --location global
gcloud logging links describe <link-id> --bucket _Default --location global
```
{% endcode %}

Παράδειγμα για να ελέγξετε τα logs του **`cloudresourcemanager`** (αυτό που χρησιμοποιείται για την επίθεση BF permissions): [https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512](https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512)

Δεν υπάρχουν logs για το **`testIamPermissions`**:

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

### Post Exploitation

{% content-ref url="../gcp-post-exploitation/gcp-logging-post-exploitation.md" %}
[gcp-logging-post-exploitation.md](../gcp-post-exploitation/gcp-logging-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../gcp-persistence/gcp-logging-persistence.md" %}
[gcp-logging-persistence.md](../gcp-persistence/gcp-logging-persistence.md)
{% endcontent-ref %}

## Αναφορές

* [https://cloud.google.com/logging/docs/logs-views#gcloud](https://cloud.google.com/logging/docs/logs-views#gcloud)
* [https://betterstack.com/community/guides/logging/gcp-logging/](https://betterstack.com/community/guides/logging/gcp-logging/)

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
