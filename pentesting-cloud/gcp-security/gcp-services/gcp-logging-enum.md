# GCP - Enumeracija logova

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Ova usluga omoguƒáava korisnicima da skladi≈°te, pretra≈æuju, analiziraju, nadgledaju i upozoravaju na **log podatke i dogaƒëaje** sa GCP-a.

Cloud Logging je potpuno integrisan sa drugim GCP uslugama, pru≈æajuƒái centralizovano skladi≈°te za logove sa svih va≈°ih GCP resursa. Automatski prikuplja logove iz razliƒçitih GCP usluga kao ≈°to su App Engine, Compute Engine i Cloud Functions. Takoƒëe mo≈æete koristiti Cloud Logging za aplikacije koje se izvr≈°avaju na lokaciji ili u drugim oblakama koristeƒái Cloud Logging agenta ili API.

Kljuƒçne funkcionalnosti:

* **Centralizacija log podataka:** Agregirajte log podatke sa razliƒçitih izvora, pru≈æajuƒái holistiƒçki pregled va≈°ih aplikacija i infrastrukture.
* **Upravljanje logovima u realnom vremenu:** Strimujte logove u realnom vremenu radi trenutne analize i reakcije.
* **Moƒána analiza podataka:** Koristite napredne moguƒánosti filtriranja i pretrage za brzo pretra≈æivanje velikih koliƒçina log podataka.
* **Integracija sa BigQuery-om:** Izvozite logove u BigQuery radi detaljne analize i upita.
* **Log-based metrike:** Kreirajte prilagoƒëene metrike na osnovu va≈°ih log podataka radi nadgledanja i upozoravanja.

### Protok logova

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption><p><a href="https://betterstack.com/community/guides/logging/gcp-logging/">https://betterstack.com/community/guides/logging/gcp-logging/</a></p></figcaption></figure>

U osnovi, sinkovi i metrike zasnovane na logovima odreƒëuju gde ƒáe log biti skladi≈°ten.

### Konfiguracije podr≈æane od strane GCP Logging-a

Cloud Logging je visoko konfigurabilan kako bi odgovarao razliƒçitim operativnim potrebama:

1. **Log Buckets (Skladi≈°tenje logova na vebu):** Defini≈°ite buckete u Cloud Logging-u radi upravljanja **zadr≈æavanjem logova**, pru≈æajuƒái kontrolu nad vremenom zadr≈æavanja va≈°ih log unosa.
* Podrazumevano su kreirani bucketi `_Default` i `_Required` (jedan bele≈æi ono ≈°to drugi ne bele≈æi).
*   **\_Required** je:

{% code overflow="wrap" %}
```bash
LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
```
{% endcode %}
* **Period zadr≈æavanja** podataka je konfigurisan po bucketu i mora biti **najmanje 1 dan.** Meƒëutim, **period zadr≈æavanja \_Required je 400 dana** i ne mo≈æe se menjati.
* Imajte na umu da Log Buckets **nisu vidljivi u Cloud Storage-u.**
2. **Log Sinks (Rutiranje logova na vebu):** Kreirajte sinkove za **izvoz log unosa** ka razliƒçitim odredi≈°tima kao ≈°to su Pub/Sub, BigQuery ili Cloud Storage na osnovu **filtera**.
* Podrazumevano su kreirani sinkovi za buckete `_Default` i `_Required`:
* ```bash
_Required  logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Required  LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
_Default   logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Default   NOT LOG_ID("cloudaudit.googleapis.com/activity") AND NOT LOG_ID("externalaudit.googleapis.com/activity") AND NOT LOG_ID("cloudaudit.googleapis.com/system_event") AND NOT LOG_ID("externalaudit.googleapis.com/system_event") AND NOT LOG_ID("cloudaudit.googleapis.com/access_transparency") AND NOT LOG_ID("externalaudit.googleapis.com/access_transparency")
```
* **Filteri iskljuƒçenja:** Moguƒáe je postaviti **iskljuƒçenja kako bi se spreƒçilo uno≈°enje odreƒëenih log unosa**, ƒçime se ≈°tedi tro≈°ak i smanjuje nepotrebna buka.
3. **Metrike zasnovane na logovima:** Konfiguri≈°ite **prilagoƒëene metrike** na osnovu sadr≈æaja logova, omoguƒáavajuƒái upozoravanje i nadgledanje na osnovu log podataka.
4. **Pregledi logova:** Pregledi logova pru≈æaju naprednu i **detaljnu kontrolu nad pristupom** logovima unutar va≈°ih log bucket-a.
* Cloud Logging **automatski kreira pregled `_AllLogs` za svaki bucket**, koji prikazuje sve logove. Cloud Logging takoƒëe kreira pregled za bucket `_Default` nazvan `_Default`. Pregled `_Default` za bucket `_Default` prikazuje sve logove osim logova za pristup podacima. Pregledi `_AllLogs` i `_Default` nisu izmenjivi.

Moguƒáe je dozvoliti principalu **samo kori≈°ƒáenje odreƒëenog pregleda logova** pomoƒáu IAM politike kao ≈°to je:
```json
{
"bindings": [
{
"members": [
"user:username@gmail.com"
],
"role": "roles/logging.viewAccessor",
"condition": {
"title": "Bucket reader condition example",
"description": "Grants logging.viewAccessor role to user username@gmail.com for the VIEW_ID log view.",
"expression":
"resource.name == \"projects/PROJECT_ID/locations/LOCATION/buckets/BUCKET_NAME/views/VIEW_ID\""
}
}
],
"etag": "BwWd_6eERR4=",
"version": 3
}
```
### Enumeracija

`gcloud` alat za komandnu liniju je integralni deo GCP ekosistema, koji vam omoguƒáava upravljanje resursima i uslugama. Evo kako mo≈æete koristiti `gcloud` za upravljanje konfiguracijama bele≈æenja i pristupom zapisima.

{% code overflow="wrap" %}
```bash
# List buckets
gcloud logging buckets list
gcloud logging buckets describe <bucket-name> --location <location>

# List log entries: only logs that contain log entries are listed.
gcloud logging logs list

# Get log metrics
gcloud logging metrics list
gcloud logging metrics describe <metric-name>

# Get log sinks
gcloud logging sinks list
gcloud logging sinks describe <sink-name>

# Get log views
gcloud logging views list --bucket <bucket> --location global
gcloud logging views describe --bucket <bucket> --location global <view-id> # view-id is usually the same as the bucket name

# Get log links
gcloud logging links list --bucket _Default --location global
gcloud logging links describe <link-id> --bucket _Default --location global
```
{% endcode %}

Primer za proveru logova **`cloudresourcemanager`** (onaj koji se koristi za BF dozvole): [https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512](https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512)

Nema logova za **`testIamPermissions`**:

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

### Post Eksploatacija

{% content-ref url="../gcp-post-exploitation/gcp-logging-post-exploitation.md" %}
[gcp-logging-post-exploitation.md](../gcp-post-exploitation/gcp-logging-post-exploitation.md)
{% endcontent-ref %}

### Upornost

{% content-ref url="../gcp-persistence/gcp-logging-persistence.md" %}
[gcp-logging-persistence.md](../gcp-persistence/gcp-logging-persistence.md)
{% endcontent-ref %}

## Reference

* [https://cloud.google.com/logging/docs/logs-views#gcloud](https://cloud.google.com/logging/docs/logs-views#gcloud)
* [https://betterstack.com/community/guides/logging/gcp-logging/](https://betterstack.com/community/guides/logging/gcp-logging/)

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju ogla≈°enu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
