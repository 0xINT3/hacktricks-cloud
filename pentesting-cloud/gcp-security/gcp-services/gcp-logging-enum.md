# GCP - Logging Enum

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** my op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Basiese Inligting

Hierdie diens stel gebruikers in staat om **logdata en gebeure** van GCP te stoor, soek, analiseer, monitor en waarsku.

Cloud Logging is ten volle ge√Øntegreer met ander GCP-dienste en bied 'n gesentraliseerde bewaarplek vir logdata van al jou GCP-hulpbronne. Dit versamel outomaties logdata van verskeie GCP-dienste soos App Engine, Compute Engine en Cloud Functions. Jy kan ook Cloud Logging gebruik vir toepassings wat op jou eie perseel of in ander wolke hardloop deur die Cloud Logging-agent of API te gebruik.

Kernkenmerke:

* **Sentralisering van Logdata:** Aggregeer logdata van verskillende bronne en bied 'n holistiese siening van jou toepassings en infrastruktuur.
* **Real-time Logbestuur:** Stroom logdata in werklike tyd vir onmiddellike analise en reaksie.
* **Kragtige Data-analise:** Gebruik gevorderde filter- en soekfunksies om deur groot hoeveelhede logdata vinnig te sif.
* **Integrasie met BigQuery:** Voer logdata uit na BigQuery vir gedetailleerde analise en navrae.
* **Loggebaseerde Metriek:** Skep aangepaste metriek op grond van jou logdata vir monitering en waarskuwing.

### Logvloei

<figure><img src="../../../.gitbook/assets/image (1).png" alt=""><figcaption><p><a href="https://betterstack.com/community/guides/logging/gcp-logging/">https://betterstack.com/community/guides/logging/gcp-logging/</a></p></figcaption></figure>

Basies sal die sinks en loggebaseerde metriek bepaal waar 'n log gestoor moet word.

### Konfigurasies wat deur GCP Logging ondersteun word

Cloud Logging is hoogs konfigureerbaar om diverse operasionele behoeftes te pas:

1. **Logemmers (Logbewaring op die web):** Definieer emmers in Cloud Logging om **logbewaring** te bestuur en sodoende beheer te h√™ oor hoe lank jou loginskrywings bewaar word.
* Standaard word die emmers `_Default` en `_Required` geskep (een log wat die ander nie doen nie).
*   **\_Required** is:

{% code overflow="wrap" %}
```bash
LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
```
{% endcode %}
* Die **bewaringsperiode** van die data word per emmer gekonfigureer en moet **ten minste 1 dag wees**. Die **bewaringsperiode van \_Required is egter 400 dae** en kan nie gewysig word nie.
* Let daarop dat Logemmers **nie sigbaar is in Cloud Storage nie.**
2. **Log-sinks (Logroeteerder op die web):** Skep sinks om loginskrywings na verskillende bestemmings te **uit te voer**, soos Pub/Sub, BigQuery of Cloud Storage, gebaseer op 'n **filter**.
* Standaard word sinks vir die emmers `_Default` en `_Required` geskep:
* ```bash
_Required  logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Required  LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
_Default   logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Default   NOT LOG_ID("cloudaudit.googleapis.com/activity") AND NOT LOG_ID("externalaudit.googleapis.com/activity") AND NOT LOG_ID("cloudaudit.googleapis.com/system_event") AND NOT LOG_ID("externalaudit.googleapis.com/system_event") AND NOT LOG_ID("cloudaudit.googleapis.com/access_transparency") AND NOT LOG_ID("externalaudit.googleapis.com/access_transparency")
```
* **Uitsluitingsfilters:** Dit is moontlik om **uitsluitings in te stel om te voorkom dat spesifieke loginskrywings** ingesluit word, wat koste bespaar en onnodige geraas verminder.
3. **Loggebaseerde Metriek:** Konfigureer **aangepaste metriek** gebaseer op die inhoud van loginskrywings, wat waarskuwings en monitering op grond van logdata moontlik maak.
4. **Log-aansigte:** Log-aansigte bied gevorderde en **fynkontrole oor wie toegang** het tot die loginskrywings binne jou logemmers.&#x20;
* Cloud Logging **skep outomaties die `_AllLogs`-aansig vir elke emmer**, wat alle loginskrywings wys. Cloud Logging skep ook 'n aansig vir die `_Default`-emmer genaamd `_Default`. Die `_Default`-aansig vir die `_Default`-emmer wys alle loginskrywings behalwe Data Access-auditlogs. Die `_AllLogs`- en `_Default`-aansigte kan nie gewysig word nie.



Dit is moontlik om 'n hoof **slegs toe te laat om 'n spesifieke Log-aansig** te gebruik met 'n IAM-beleid soos:
```json
{
"bindings": [
{
"members": [
"user:username@gmail.com"
],
"role": "roles/logging.viewAccessor",
"condition": {
"title": "Bucket reader condition example",
"description": "Grants logging.viewAccessor role to user username@gmail.com for the VIEW_ID log view.",
"expression":
"resource.name == \"projects/PROJECT_ID/locations/LOCATION/buckets/BUCKET_NAME/views/VIEW_ID\""
}
}
],
"etag": "BwWd_6eERR4=",
"version": 3
}
```
### Opname

Die `gcloud` opdraglyn-hulpmiddel is 'n integrale deel van die GCP-ekosisteem, wat jou in staat stel om jou hulpbronne en dienste te bestuur. Hier is hoe jy `gcloud` kan gebruik om jou opnamekonfigurasies en toegangsopnames te bestuur.

{% code overflow="wrap" %}
```bash
# List buckets
gcloud logging buckets list
gcloud logging buckets describe <bucket-name> --location <location>

# List log entries: only logs that contain log entries are listed.
gcloud logging logs list

# Get log metrics
gcloud logging metrics list
gcloud logging metrics describe <metric-name>

# Get log sinks
gcloud logging sinks list
gcloud logging sinks describe <sink-name>

# Get log views
gcloud logging views list --bucket <bucket> --location global
gcloud logging views describe --bucket <bucket> --location global <view-id> # view-id is usually the same as the bucket name

# Get log links
gcloud logging links list --bucket _Default --location global
gcloud logging links describe <link-id> --bucket _Default --location global
```
{% endcode %}

Voorbeeld om die logboeke van **`cloudresourcemanager`** (die een wat gebruik word om toestemmings te BF) te kontroleer: [https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512](https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512)

Daar is geen logboeke van **`testIamPermissions`** nie:

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

### Post Exploitation

{% content-ref url="../gcp-post-exploitation/gcp-logging-post-exploitation.md" %}
[gcp-logging-post-exploitation.md](../gcp-post-exploitation/gcp-logging-post-exploitation.md)
{% endcontent-ref %}

### Volharding

{% content-ref url="../gcp-persistence/gcp-logging-persistence.md" %}
[gcp-logging-persistence.md](../gcp-persistence/gcp-logging-persistence.md)
{% endcontent-ref %}

## Verwysings

* [https://cloud.google.com/logging/docs/logs-views#gcloud](https://cloud.google.com/logging/docs/logs-views#gcloud)
* [https://betterstack.com/community/guides/logging/gcp-logging/](https://betterstack.com/community/guides/logging/gcp-logging/)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** my op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
