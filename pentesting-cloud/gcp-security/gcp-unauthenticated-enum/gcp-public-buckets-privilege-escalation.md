# GCP - 公开存储桶特权升级

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>

## 存储桶特权升级

如果存储桶策略允许“allUsers”或“allAuthenticatedUsers”**写入其存储桶策略**（**storage.buckets.setIamPolicy** 权限），那么任何人都可以修改存储桶策略并授予自己完全访问权限。

### 检查权限

有两种方法可以检查存储桶的权限。第一种方法是通过向 `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam` 发出请求或运行 `gsutil iam get gs://BUCKET_NAME` 来询问权限。

然而，如果您的用户（可能属于 allUsers 或 allAuthenticatedUsers）没有权限读取存储桶的 iam 策略（storage.buckets.getIamPolicy），那么这种方法将不起作用。

另一个始终有效的选项是使用存储桶的 testPermissions 端点来确定您是否具有指定的权限，例如访问：`https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### 特权升级

使用“gsutil” Google Storage CLI 程序，我们可以运行以下命令将“allAuthenticatedUsers”访问权限提升为“Storage Admin”角色，从而**升级我们被授予的存储桶特权**：
```
gsutil iam ch group:allAuthenticatedUsers:admin gs://BUCKET_NAME
```
升级为Storage Admin的主要吸引力之一是可以使用"storage.buckets.delete"权限。理论上，你可以**在升级权限后删除存储桶，然后在自己的账户中创建该存储桶以窃取名称**。

## 参考资料

* [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的**公司广告**，或者如果您想访问**PEASS的最新版本或下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>
