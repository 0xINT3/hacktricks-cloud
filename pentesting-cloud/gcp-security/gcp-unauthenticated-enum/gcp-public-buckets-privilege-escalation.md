# GCP - √âl√©vation de privil√®ges de seaux publics

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## √âl√©vation de privil√®ges de seaux

Si la politique de seau permettait √† "allUsers" ou "allAuthenticatedUsers" d'**√©crire dans leur politique de seau** (la permission **storage.buckets.setIamPolicy**), alors n'importe qui peut modifier la politique de seau et s'accorder un acc√®s complet.

### V√©rification des autorisations

Il y a 2 fa√ßons de v√©rifier les autorisations sur un seau. La premi√®re consiste √† les demander en faisant une demande √† `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam` ou en ex√©cutant `gsutil iam get gs://BUCKET_NAME`.

Cependant, si votre utilisateur (appartenant potentiellement √† allUsers ou allAuthenticatedUsers") n'a pas les autorisations pour lire la politique iam du seau (storage.buckets.getIamPolicy), cela ne fonctionnera pas.

L'autre option qui fonctionnera toujours est d'utiliser le point de terminaison testPermissions du seau pour d√©terminer si vous avez la permission sp√©cifi√©e, par exemple en acc√©dant √† : `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### √âl√©vation de privil√®ges

Avec le programme CLI Google Storage "gsutil", nous pouvons ex√©cuter la commande suivante pour accorder l'acc√®s "allAuthenticatedUsers" au r√¥le "Storage Admin", **ce qui permet d'√©lever les privil√®ges qui nous ont √©t√© accord√©s** pour le seau :

```
gsutil iam ch group:allAuthenticatedUsers:admin gs://BUCKET_NAME
```

L'un des principaux avantages de l'√©l√©vation d'un LegacyBucketOwner √† Storage Admin est la possibilit√© d'utiliser le privil√®ge "storage.buckets.delete". En th√©orie, vous pourriez **supprimer le seau apr√®s avoir √©lev√© vos privil√®ges, puis vous pourriez cr√©er le seau dans votre propre compte pour voler le nom**.

## R√©f√©rences

* [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>