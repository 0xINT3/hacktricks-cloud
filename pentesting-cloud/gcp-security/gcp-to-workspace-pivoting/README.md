# GCP <--> –†–æ–±–æ—á–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –ü–µ—Ä–µ—Ö—ñ–¥

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>

## **–ó GCP –¥–æ GWS**

### **–û—Å–Ω–æ–≤–∏ –¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è –Ω–∞ —Ä—ñ–≤–Ω—ñ –¥–æ–º–µ–Ω—É**

–î–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è –Ω–∞ —Ä—ñ–≤–Ω—ñ –¥–æ–º–µ–Ω—É Google Workspace –¥–æ–∑–≤–æ–ª—è—î –æ–±'—î–∫—Ç—É —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ, –±—É–¥—å —Ç–æ **–∑–æ–≤–Ω—ñ—à–Ω—ñ–π –¥–æ–¥–∞—Ç–æ–∫** –∑ Google Workspace Marketplace –∞–±–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π **–°–µ—Ä–≤—ñ—Å–Ω–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å GCP**, **–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö –ø–æ –≤—Å—å–æ–º—É –†–æ–±–æ—á–æ–º—É –ø—Ä–æ—Å—Ç–æ—Ä—É –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**.

{% hint style="info" %}
–¶–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –æ–∑–Ω–∞—á–∞—î, —â–æ **—Å–µ—Ä–≤—ñ—Å–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—Ä–æ–µ–∫—Ç—ñ–≤ GCP –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –º–æ–∂—É—Ç—å **–≤–∏–¥–∞–∞–≤–∞—Ç–∏ —Å–µ–±–µ –∑–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –†–æ–±–æ—á–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É** —Ü—ñ—î—ó –∂ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó (–∞–±–æ –Ω–∞–≤—ñ—Ç—å –∑ —ñ–Ω—à–æ—ó).
{% endhint %}

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ç–µ, —è–∫ —Å–∞–º–µ —Ü–µ –ø—Ä–∞—Ü—é—î, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

{% content-ref url="gcp-understanding-domain-wide-delegation.md" %}
[gcp-understanding-domain-wide-delegation.md](gcp-understanding-domain-wide-delegation.md)
{% endcontent-ref %}

### –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—è —ñ—Å–Ω—É—é—á–æ–≥–æ –¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è

–Ø–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ **–æ—Ç—Ä–∏–º–∞–≤ –¥–æ—Å—Ç—É–ø –¥–æ GCP** —ñ **–∑–Ω–∞—î –¥—ñ–π—Å–Ω—É –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –∞–¥—Ä–µ—Å—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –†–æ–±–æ—á–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É** (–Ω–∞–π–∫—Ä–∞—â–µ **—Å—É–ø–µ—Ä–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞**), –≤—ñ–Ω –º–æ–∂–µ **–ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –≤—Å—ñ –ø—Ä–æ–µ–∫—Ç–∏**, –¥–æ —è–∫–∏—Ö –≤—ñ–Ω –º–∞—î –¥–æ—Å—Ç—É–ø, **–ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –≤—Å—ñ –°–û** –ø—Ä–æ–µ–∫—Ç—ñ–≤, –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, –¥–æ —è–∫–∏—Ö **—Å–µ—Ä–≤—ñ—Å–Ω–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –≤—ñ–Ω –º–∞—î –¥–æ—Å—Ç—É–ø**, —ñ **–ø–æ–≤—Ç–æ—Ä–∏—Ç–∏** –≤—Å—ñ —Ü—ñ –∫—Ä–æ–∫–∏ –∑ –∫–æ–∂–Ω–∏–º –°–û, —è–∫–∏–º –≤—ñ–Ω –º–æ–∂–µ –≤–∏–¥–∞–∞–≤–∞—Ç–∏ —Å–µ–±–µ.\
–ó—ñ **—Å–ø–∏—Å–∫–æ–º –≤—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å–Ω–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤**, –¥–æ —è–∫–∏—Ö –≤—ñ–Ω –º–∞—î **–¥–æ—Å—Ç—É–ø**, —ñ —Å–ø–∏—Å–∫–æ–º **–µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏—Ö –∞–¥—Ä–µ—Å –†–æ–±–æ—á–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É**, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–≤–∏–¥–∞–∞–≤–∞—Ç–∏ —Å–µ–±–µ –∑–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –∫–æ–∂–Ω–∏–º —Å–µ—Ä–≤—ñ—Å–Ω–∏–º –æ–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–æ–º**.

{% hint style="danger" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –ø—Ä–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ –¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è –Ω–∞ —Ä—ñ–≤–Ω—ñ –¥–æ–º–µ–Ω—É –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –†–æ–±–æ—á–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É, —Ç–æ–º—É –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∑–Ω–∞—Ç–∏ **–æ–¥–Ω–æ–≥–æ –¥—ñ–π—Å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —â–æ —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º –¥–ª—è –≤–∏–¥–∞—á—ñ —Å–µ–±–µ –∑–∞ –Ω—å–æ–≥–æ**.\
–û–¥–Ω–∞–∫ **–ø—Ä–∏–≤—ñ–ª–µ—ó –≤–∏–¥–∞–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –±—É–¥—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ**, —Ç–æ–º—É —è–∫—â–æ —Ü–µ –°—É–ø–µ—Ä–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—å–æ–≥–æ. –Ø–∫—â–æ —É –Ω—å–æ–≥–æ –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É, —Ü–µ –±—É–¥–µ –Ω–µ–∫–æ—Ä–∏—Å–Ω–æ.
{% endhint %}

#### [GCP Generate Delegation Token](https://github.com/carlospolop/gcp\_gen\_delegation\_token)

–¶–µ–π –ø—Ä–æ—Å—Ç–∏–π —Å–∫—Ä–∏–ø—Ç **–≥–µ–Ω–µ—Ä—É—î —Ç–æ–∫–µ–Ω OAuth –≤ —è–∫–æ—Å—Ç—ñ –¥–µ–ª–µ–≥–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞**, —è–∫–∏–π –≤–∏ –ø–æ—Ç—ñ–º –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —ñ–Ω—à–∏—Ö Google API –∑ –∞–±–æ –±–µ–∑ `gcloud`:
```bash
# Impersonate indicated user
python3 gen_delegation_token.py --user-email <user-email> --key-file <path-to-key-file>

# Impersonate indicated user and add additional scopes
python3 gen_delegation_token.py --user-email <user-email> --key-file <path-to-key-file> --scopes "https://www.googleapis.com/auth/userinfo.email, https://www.googleapis.com/auth/cloud-platform, https://www.googleapis.com/auth/admin.directory.group, https://www.googleapis.com/auth/admin.directory.user, https://www.googleapis.com/auth/admin.directory.domain, https://mail.google.com/, https://www.googleapis.com/auth/drive, openid"
```
#### [**DeleFriend**](https://github.com/axon-git/DeleFriend)

–¶–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —è–∫–∏–π –º–æ–∂–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∞—Ç–∞–∫—É, –≤–∏–∫–æ–Ω—É—é—á–∏ —Ü—ñ –∫—Ä–æ–∫–∏:

1. **–ü–µ—Ä–µ–ª—ñ—á—ñ—Ç—å –ø—Ä–æ–µ–∫—Ç–∏ GCP**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ API Resource Manager.
2. –ü–µ—Ä–µ–±–∏—Ä–∞–π—Ç–µ –∫–æ–∂–Ω–∏–π —Ä–µ—Å—É—Ä—Å –ø—Ä–æ–µ–∫—Ç—É —Ç–∞ **–ø–µ—Ä–µ–ª—ñ—á—ñ—Ç—å —Ä–µ—Å—É—Ä—Å–∏ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Å–ª—É–∂–± GCP**, –¥–æ —è–∫–∏—Ö –º–∞—î –¥–æ—Å—Ç—É–ø –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á IAM, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ _GetIAMPolicy_.
3. –ü–µ—Ä–µ–±–∏—Ä–∞–π—Ç–µ **–∫–æ–∂–Ω—É —Ä–æ–ª—å –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏** —Ç–∞ –∑–Ω–∞—Ö–æ–¥—å—Ç–µ –≤–±—É–¥–æ–≤–∞–Ω—ñ, –±–∞–∑–æ–≤—ñ —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ —Ä–æ–ª—ñ –∑ –¥–æ–∑–≤–æ–ª–æ–º _**serviceAccountKeys.create**_ –Ω–∞ —Ü—ñ–ª—å–æ–≤–æ–º—É —Ä–µ—Å—É—Ä—Å—ñ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏. –°–ª—ñ–¥ –∑–∞—É–≤–∞–∂–∏—Ç–∏, —â–æ —Ä–æ–ª—å –†–µ–¥–∞–∫—Ç–æ—Ä–∞ —ñ–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω–æ –º–∞—î —Ü–µ–π –¥–æ–∑–≤—ñ–ª.
4. –°—Ç–≤–æ—Ä—ñ—Ç—å **–Ω–æ–≤–∏–π –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á `KEY_ALG_RSA_2048`** –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å—É –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏, —è–∫–∏–π –∑–Ω–∞–π–¥–µ–Ω–æ –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º –¥–æ–∑–≤–æ–ª–æ–º –≤ –ø–æ–ª—ñ IAM.
5. –ü–µ—Ä–µ–±–∏—Ä–∞–π—Ç–µ **–∫–æ–∂–µ–Ω –Ω–æ–≤–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏ —Ç–∞ —Å—Ç–≤–æ—Ä—ñ—Ç—å `JWT`** **–æ–±'—î–∫—Ç** –¥–ª—è –Ω—å–æ–≥–æ, —è–∫–∏–π —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ SA —Ç–∞ –æ–±–ª–∞—Å—Ç—ñ OAuth. –ü—Ä–æ—Ü–µ—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ _JWT_ –æ–±'—î–∫—Ç–∞ –±—É–¥–µ **–ø–µ—Ä–µ–±–∏—Ä–∞—Ç–∏ –≤—Å—ñ —ñ—Å–Ω—É—é—á—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –æ–±–ª–∞—Å—Ç–µ–π OAuth** –∑—ñ —Å–ø–∏—Å–∫—É **oauth\_scopes.txt**, —â–æ–± –∑–Ω–∞–π—Ç–∏ –≤—Å—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –¥–µ–ª–µ–≥—É–≤–∞–Ω–Ω—è. –°–ø–∏—Å–æ–∫ **oauth\_scopes.txt** –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤—Å—ñ–º–∞ –æ–±–ª–∞—Å—Ç—è–º–∏ OAuth, —è–∫—ñ –º–∏ –≤–≤–∞–∂–∞—î–º–æ –≤–∞–∂–ª–∏–≤–∏–º–∏ –¥–ª—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—è–º–∏ Workspace.
6. –ú–µ—Ç–æ–¥ `_make_authorization_grant_assertion` –ø–æ–∫–∞–∑—É—î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å –≤–∫–∞–∑–∞—Ç–∏ **—Ü—ñ–ª—å–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ä–æ–±–æ—á–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É**, —è–∫–∏–π –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è _subject_, –¥–ª—è –≥–µ–Ω–µ—Ä—É–≤–∞–Ω–Ω—è JWT –ø—ñ–¥ DWD. –•–æ—á–∞ —Ü–µ –º–æ–∂–µ –∑–¥–∞—Ç–∏—Å—è –≤–∏–º–∞–≥–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –≤–∞–∂–ª–∏–≤–æ —É—Å–≤—ñ–¥–æ–º–∏—Ç–∏, —â–æ **DWD –≤–ø–ª–∏–≤–∞—î –Ω–∞ –∫–æ–∂–Ω—É —ñ–¥–µ–Ω—Ç–∏—á–Ω—ñ—Å—Ç—å –≤ –¥–æ–º–µ–Ω—ñ**. –í—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è JWT –¥–ª—è **–±—É–¥—å-—è–∫–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ–º–µ–Ω—É** –≤–ø–ª–∏–≤–∞—î –Ω–∞ –≤—Å—ñ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ –≤ —Ü—å–æ–º—É –¥–æ–º–µ–Ω—ñ, –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –Ω–∞—à–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–µ—Ä–µ–ª—ñ–∫—É –∫–æ–º–±—ñ–Ω–∞—Ü—ñ–π. –ü—Ä–æ—Å—Ç–æ –∫–∞–∂—É—á–∏, –æ–¥–∏–Ω –¥—ñ–π—Å–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á Workspace —î –¥–æ—Å—Ç–∞—Ç–Ω—ñ–º –¥–ª—è –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è.\
–¶—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –º–æ–∂–Ω–∞ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –≤ —Ñ–∞–π–ª—ñ _config.yaml_ DeleFriend. –Ø–∫—â–æ —Ü—ñ–ª—å–æ–≤–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ä–æ–±–æ—á–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É –≤–∂–µ –Ω–µ –≤—ñ–¥–æ–º–∏–π, —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–ø—Ä–∏—è—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–º—É –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—é –¥—ñ–π—Å–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ä–æ–±–æ—á–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É —à–ª—è—Ö–æ–º —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ–º–µ–Ω—É –∑ —Ä–æ–ª—è–º–∏ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö GCP. –í–∞–∂–ª–∏–≤–æ –∑–∞—É–≤–∞–∂–∏—Ç–∏ (–∑–Ω–æ–≤—É), —â–æ JWT —î —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–º–∏ –¥–ª—è –¥–æ–º–µ–Ω—É —ñ –Ω–µ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞; –æ—Ç–∂–µ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø—Ä–æ—Ü–µ—Å —Å–ø—Ä—è–º–æ–≤–∞–Ω–∏–π –Ω–∞ –æ–¥–Ω—É —É–Ω—ñ–∫–∞–ª—å–Ω—É —ñ–¥–µ–Ω—Ç–∏—á–Ω—ñ—Å—Ç—å –Ω–∞ –¥–æ–º–µ–Ω.
7. **–ü–µ—Ä–µ–ª—ñ—á—Ç–µ —Ç–∞ —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É –¥–æ –Ω–æ—Å—ñ—è** –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ JWT —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–æ–∫–µ–Ω –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é API tokeninfo.

#### [Python-—Å–∫—Ä–∏–ø—Ç Gitlab](https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp\_misc/-/blob/master/gcp\_delegation.py)

Gitlab —Å—Ç–≤–æ—Ä–∏–≤ [—Ü–µ–π Python-—Å–∫—Ä–∏–ø—Ç](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp\_misc/blob/master/gcp\_delegation.py), —è–∫–∏–π –º–æ–∂–µ —Ä–æ–±–∏—Ç–∏ –¥–≤—ñ —Ä–µ—á—ñ - –ø–µ—Ä–µ–ª—ñ–∫ –∫–∞—Ç–∞–ª–æ–≥—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –≤–∫–∞–∑—É—é—á–∏ json –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ SA —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –¥–ª—è –ø—ñ–¥—Ä–æ–±–ª–µ–Ω–Ω—è. –û—Å—å —è–∫ –≤–∏ –π–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ—Ç–µ:
```bash
# Install requirements
pip install --upgrade --user oauth2client

# Validate access only
./gcp_delegation.py --keyfile ./credentials.json \
--impersonate steve.admin@target-org.com \
--domain target-org.com

# List the directory
./gcp_delegation.py --keyfile ./credentials.json \
--impersonate steve.admin@target-org.com \
--domain target-org.com \
--list

# Create a new admin account
./gcp_delegation.py --keyfile ./credentials.json \
--impersonate steve.admin@target-org.com \
--domain target-org.com \
--account pwned
```
### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –¥–µ–ª–µ–≥–∞—Ü—ñ—ó (–ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å)

–ú–æ–∂–ª–∏–≤–æ **–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–µ–ª–µ–≥–∞—Ü—ñ—ó –Ω–∞ —Ä—ñ–≤–Ω—ñ –¥–æ–º–µ–Ω—É** –≤ [**https://admin.google.com/u/1/ac/owl/domainwidedelegation**](https://admin.google.com/u/1/ac/owl/domainwidedelegation)**.**

–ê—Ç–∞–∫—É—é—á–∏–π –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é **—Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å–ª—É–∂–± –≤ –ø—Ä–æ–µ–∫—Ç—ñ GCP** —Ç–∞ **—Å—É–ø–µ—Ä–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ –¥–æ GWS –º–æ–∂–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É –¥–µ–ª–µ–≥–∞—Ü—ñ—é, —â–æ –¥–æ–∑–≤–æ–ª–∏—Ç—å –æ–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–∞–º —Å–ª—É–∂–± –ø—ñ–¥–¥–∞–≤–∞—Ç–∏—Å—è –ø—ñ–¥ –≤–ø–ª–∏–≤–æ–º –¥–µ—è–∫–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ GWS:**

1. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—ó –ø–∞—Ä–∏ –∫–ª—é—á—ñ–≤:** –ù–∞ GCP —Ä–µ—Å—É—Ä—Å–∏ –Ω–æ–≤–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω—ñ –∞–±–æ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å, –∞–±–æ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—Ä—è–º–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤ API —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞. –¶–µ –≤–∏–º–∞–≥–∞—î **—Ä–æ–ª—ñ `iam.serviceAccountAdmin`** –∞–±–æ –±—É–¥—å-—è–∫–æ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–æ—ó —Ä–æ–ª—ñ, –æ–±–ª–∞–¥–Ω–∞–Ω–æ—ó –¥–æ–∑–≤–æ–ª–æ–º **`iam.serviceAccounts.create`**. –ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ –º–∏ –ø–µ—Ä–µ–π–¥–µ–º–æ –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è **–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—ó –ø–∞—Ä–∏ –∫–ª—é—á—ñ–≤** (**–¥–æ–∑–≤—ñ–ª `iam.serviceAccountKeys.create`**).
2. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –¥–µ–ª–µ–≥–∞—Ü—ñ—ó**: –í–∞–∂–ª–∏–≤–æ —Ä–æ–∑—É–º—ñ—Ç–∏, —â–æ **–ª–∏—à–µ —Ä–æ–ª—å –°—É–ø–µ—Ä–∞–¥–º—ñ–Ω–∞ –º–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω—É –¥–µ–ª–µ–≥–∞—Ü—ñ—é –Ω–∞ —Ä—ñ–≤–Ω—ñ –¥–æ–º–µ–Ω—É –≤ Google Workspace** —ñ –¥–µ–ª–µ–≥–∞—Ü—ñ—é –Ω–∞ —Ä—ñ–≤–Ω—ñ –¥–æ–º–µ–Ω—É **–Ω–µ –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ,** –á—ó –º–æ–∂–Ω–∞ –ª–∏—à–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ **–≤—Ä—É—á–Ω—É** —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å Google Workspace.
* –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª–∞ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ **–ö–µ—Ä—É–≤–∞–Ω–Ω—è API ‚Üí –ö–µ—Ä—É–≤–∞–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–æ—é –¥–µ–ª–µ–≥–∞—Ü—ñ—î—é –Ω–∞ —Ä—ñ–≤–Ω—ñ –¥–æ–º–µ–Ω—É –≤ –∫–æ–Ω—Å–æ–ª—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Google Workspace**.
3. **–ù–∞–¥–∞–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –æ–±–ª–∞—Å—Ç–µ–π OAuth**: –ü—Ä–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ –Ω–æ–≤–æ—ó –¥–µ–ª–µ–≥–∞—Ü—ñ—ó Google –≤–∏–º–∞–≥–∞—î –ª–∏—à–µ 2 –ø–∞—Ä–∞–º–µ—Ç—Ä–∏, –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–ª—ñ—î–Ω—Ç–∞, —è–∫–∏–π —î **OAuth ID —Ä–µ—Å—É—Ä—Å—É –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ GCP**, —Ç–∞ **–æ–±–ª–∞—Å—Ç—ñ OAuth**, —è–∫—ñ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å, —è–∫—ñ –≤–∏–∫–ª–∏–∫–∏ API –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–ª—è –¥–µ–ª–µ–≥–∞—Ü—ñ—ó.
* **–ü–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ –æ–±–ª–∞—Å—Ç–µ–π OAuth** –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ [**—Ç—É—Ç**](https://developers.google.com/identity/protocols/oauth2/scopes), –∞–ª–µ –æ—Å—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è: `https://www.googleapis.com/auth/userinfo.email, https://www.googleapis.com/auth/cloud-platform, https://www.googleapis.com/auth/admin.directory.group, https://www.googleapis.com/auth/admin.directory.user, https://www.googleapis.com/auth/admin.directory.domain, https://mail.google.com/, https://www.googleapis.com/auth/drive, openid`
4. **–î—ñ—è –≤—ñ–¥ —ñ–º–µ–Ω—ñ —Ü—ñ–ª—å–æ–≤–æ—ó –æ—Å–æ–±–∏:** –ù–∞ —Ü–µ–π –º–æ–º–µ–Ω—Ç —É –Ω–∞—Å —î –ø—Ä–∞—Ü—é—é—á–∏–π –¥–µ–ª–µ–≥–æ–≤–∞–Ω–∏–π –æ–±'—î–∫—Ç –≤ GWS. –¢–µ–ø–µ—Ä, **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ GCP, –º–∏ –º–æ–∂–µ–º–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –≤–∏–∫–ª–∏–∫–∏ API** (–≤ –æ–±–ª–∞—Å—Ç—ñ, –≤–∏–∑–Ω–∞—á–µ–Ω—ñ–π –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ –æ–±–ª–∞—Å—Ç—ñ OAuth) –¥–ª—è –π–æ–≥–æ –∑–∞–ø—É—Å–∫—É —Ç–∞ **–¥—ñ—è—Ç–∏ –≤—ñ–¥ —ñ–º–µ–Ω—ñ –±—É–¥—å-—è–∫–æ—ó –æ—Å–æ–±–∏, —è–∫–∞ —ñ—Å–Ω—É—î –≤ Google Workspace**. –Ø–∫ –º–∏ –≤–∏–≤—á–∏–ª–∏, –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏ –±—É–¥–µ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ —Å–≤–æ—ó—Ö –ø–æ—Ç—Ä–µ–± —Ç–∞ –∑–≥—ñ–¥–Ω–æ –∑ –¥–æ–∑–≤–æ–ª–æ–º, —è–∫–∏–π –≤—ñ–Ω –º–∞—î –¥–æ –¥–æ–¥–∞—Ç–∫—ñ–≤ REST API.
* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **–ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑–¥—ñ–ª** –¥–ª—è –¥–µ—è–∫–∏—Ö **—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤**, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è —Ü—ñ—î—ó –¥–µ–ª–µ–≥–∞—Ü—ñ—ó.

#### –ú—ñ–∂–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π–Ω–∞ –¥–µ–ª–µ–≥–∞—Ü—ñ—è

–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä OAuth SA —î –≥–ª–æ–±–∞–ª—å–Ω–∏–º —ñ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è **–º—ñ–∂–æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π–Ω–æ—ó –¥–µ–ª–µ–≥–∞—Ü—ñ—ó**. –ù–∞—Ä–∞–∑—ñ –Ω–µ –±—É–ª–æ –≤–≤–µ–¥–µ–Ω–æ –æ–±–º–µ–∂–µ–Ω—å –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –º—ñ–∂–≥–ª–æ–±–∞–ª—å–Ω—ñ–π –¥–µ–ª–µ–≥–∞—Ü—ñ—ó. –ü—Ä–æ—Å—Ç–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, **–æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å–ª—É–∂–± –∑ —Ä—ñ–∑–Ω–∏—Ö –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π GCP –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–æ—ó –¥–µ–ª–µ–≥–∞—Ü—ñ—ó –Ω–∞ —Ä—ñ–≤–Ω—ñ –¥–æ–º–µ–Ω—É –≤ —ñ–Ω—à–∏—Ö –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è—Ö Workspace**. –¶–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ —Ç–æ–≥–æ, —â–æ **–¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ Workspace –ø–æ—Ç—Ä—ñ–±–Ω–æ –ª–∏—à–µ —Å—É–ø–µ—Ä–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø**, –∞ –Ω–µ –¥–æ—Å—Ç—É–ø –¥–æ —Ç–æ–≥–æ –∂ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É GCP, –æ—Å–∫—ñ–ª—å–∫–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å–ª—É–∂–± —Ç–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ñ –∫–ª—é—á—ñ –Ω–∞ —Å–≤–æ—î–º—É –æ—Å–æ–±–∏—Å—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ–º—É –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ GCP.

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É –¥–ª—è –ø–µ—Ä–µ–ª—ñ–∫—É Workspace

–ó–∞ **–∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ Workspace –º–∞—é—Ç—å –¥–æ–∑–≤—ñ–ª –Ω–∞ **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –ø—Ä–æ–µ–∫—Ç—ñ–≤**, —ñ –∫–æ–ª–∏ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∏–π –ø—Ä–æ–µ–∫—Ç, **—Ç–≤–æ—Ä–µ—Ü—å –æ—Ç—Ä–∏–º—É—î —Ä–æ–ª—å –í–ª–∞—Å–Ω–∏–∫–∞** –Ω–∞–¥ –Ω–∏–º.

–û—Ç–∂–µ, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ–µ–∫—Ç**, **–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏** **API**, —â–æ–± –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ Workspace —É —Å–≤–æ—î–º—É –Ω–æ–≤–æ–º—É –ø—Ä–æ–µ–∫—Ç—ñ —Ç–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏** –π–æ–≥–æ.

{% hint style="danger" %}
–î–ª—è —Ç–æ–≥–æ, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º—ñ–≥ –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ Workspace, –π–æ–º—É —Ç–∞–∫–æ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–æ–∑–≤–æ–ª—ñ–≤ Workspace (–Ω–µ –∫–æ–∂–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–º–æ–∂–µ –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥).
{% endhint %}

{% code overflow="wrap" %}
```bash
# Create project
gcloud projects create <uniq-projec-name> --name=proj-name
# Set project
gcloud config set project <uniq-projec-name>
# Enable svcs
gcloud services enable admin.googleapis.com
gcloud services enable cloudidentity.googleapis.com
# Get org ID
gcloud organizations list
# Get currents email user groups (at least you can check the groups and members of the groups you belong to)
gcloud identity groups memberships search-transitive-groups --member-email <email> --labels=cloudidentity.googleapis.com/groups.discussion_forum
gcloud identity groups memberships list --group-email=g<group-email>

# FROM HERE THE USER NEEDS TO HAVE ENOUGH WORKSPACE ACCESS
gcloud beta identity groups preview --customer <org-cust-id>
```
{% endcode %}

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **–¥–æ–¥–∞—Ç–∫–æ–≤–µ –≤–∏–≤—á–µ–Ω–Ω—è** –≤:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### –ó–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è Gcloud

–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ—Ç—ñ–∫ `gcloud` –¥–ª—è –≤—Ö–æ–¥—É –≤ —Å–∏—Å—Ç–µ–º—É:

{% content-ref url="../gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

–Ø–∫ –ø–æ—è—Å–Ω–µ–Ω–æ —Ç–∞–º, gcloud –º–æ–∂–µ –∑–∞–ø–∏—Ç–∞—Ç–∏ –æ–±–ª–∞—Å—Ç—å `https://www.googleapis.com/auth/drive`, —â–æ –¥–æ–∑–≤–æ–ª–∏—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –¥–∏—Å–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.\
–Ø–∫ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫, —è–∫—â–æ –≤–∏ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞–ª–∏ **—Ñ—ñ–∑–∏—á–Ω–æ** –∫–æ–º–ø'—é—Ç–µ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —ñ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—Å–µ —â–µ —É–≤—ñ–π—à–æ–≤** —É —Å–≤—ñ–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å, –≤–∏ –º–æ–∂–µ—Ç–µ —É–≤—ñ–π—Ç–∏, —Å—Ç–≤–æ—Ä–∏–≤—à–∏ —Ç–æ–∫–µ–Ω –∑ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ –¥–∏—Å–∫–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
gcloud auth login --enable-gdrive-access
```
–Ø–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞–≤ –∫–æ–º–ø'—é—Ç–µ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –≤—ñ–Ω —Ç–∞–∫–æ–∂ –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ñ–∞–π–ª `google-cloud-sdk/lib/googlecloudsdk/core/config.py` —Ç–∞ –¥–æ–¥–∞—Ç–∏ –≤ **`CLOUDSDK_SCOPES`** –æ–±–ª–∞—Å—Ç—å **`'https://www.googleapis.com/auth/drive'`**:

<figure><img src="../../../.gitbook/assets/image (153).png" alt="" width="563"><figcaption></figcaption></figure>

{% hint style="warning" %}
–û—Ç–∂–µ, –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–≤—ñ–π–¥–µ –≤ —Å–∏—Å—Ç–µ–º—É, –≤—ñ–Ω —Å—Ç–≤–æ—Ä–∏—Ç—å **—Ç–æ–∫–µ–Ω –∑ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ –¥–∏—Å–∫–∞**, —è–∫–∏–π –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∏—Å–∫–∞. –û—á–µ–≤–∏–¥–Ω–æ, —â–æ –±—Ä–∞—É–∑–µ—Ä –≤–∫–∞–∑—É–≤–∞—Ç–∏–º–µ, —â–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω –º–∞—Ç–∏–º–µ –¥–æ—Å—Ç—É–ø –¥–æ –¥–∏—Å–∫–∞, –∞–ª–µ –æ—Å–∫—ñ–ª—å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–∫–ª–∏—á–µ **`gcloud auth login`**, –≤—ñ–Ω, –π–º–æ–≤—ñ—Ä–Ω–æ, **–Ω–µ –ø—ñ–¥–æ–∑—Ä—é–≤–∞—Ç–∏–º–µ –Ω—ñ—á–æ–≥–æ.**

–î–ª—è –ø–µ—Ä–µ–ª—ñ–∫—É —Ñ–∞–π–ª—ñ–≤ –Ω–∞ –¥–∏—Å–∫—É: **`curl -H "Authorization: Bearer $(gcloud auth print-access-token)" "https://www.googleapis.com/drive/v3/files"`**
{% endhint %}

## –í—ñ–¥ GWS –¥–æ GCP

### –î–æ—Å—Ç—É–ø –¥–æ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ GCP

–Ø–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–∞—î –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ GWS, –≤—ñ–Ω –∑–º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –≥—Ä—É–ø –∑ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–º –¥–æ—Å—Ç—É–ø–æ–º –¥–æ GCP –∞–±–æ –Ω–∞–≤—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —Ç–æ–º—É –ø–µ—Ä–µ—Ö—ñ–¥ –≤—ñ–¥ GWS –¥–æ GCP –∑–∞–∑–≤–∏—á–∞–π —î –±—ñ–ª—å—à "–ø—Ä–æ—Å—Ç–∏–º", –æ—Å–∫—ñ–ª—å–∫–∏ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –≤ GWS –º–∞—é—Ç—å –≤–∏—Å–æ–∫—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó –≤ GCP**.

### –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ Google Groups

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å **–≤—ñ–ª—å–Ω–æ –ø—Ä–∏—î–¥–Ω—É–≤–∞—Ç–∏—Å—è –¥–æ –≥—Ä—É–ø Workspace –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó**, —ñ —Ü—ñ –≥—Ä—É–ø–∏ **–º–æ–∂—É—Ç—å –º–∞—Ç–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ GCP** (–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–≤–æ—ó –≥—Ä—É–ø–∏ –∑–∞ –∞–¥—Ä–µ—Å–æ—é [https://groups.google.com/](https://groups.google.com/)).

–ó–ª–æ–≤–∂–∏–≤–∞—é—á–∏ **–ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è–º –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ google groups**, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–¥–∞—Ç–∏ –¥–æ –≥—Ä—É–ø–∏ –∑ –ø–µ–≤–Ω–∏–º –ø—Ä–∏–≤—ñ–ª–µ—î–º –¥–æ—Å—Ç—É–ø—É –¥–æ GCP.

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover](https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
