# GCP - Serviceusage特权升级

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版本的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## serviceusage

以下权限对于创建和窃取API密钥非常有用，不是来自文档的内容：_API密钥是一个简单的加密字符串，**用于标识应用程序而没有任何主体**。它们用于匿名访问**公共数据**，并用于将API请求与您的项目关联以进行配额和**计费**。_

因此，使用API密钥可以让公司为您使用API付费，但您将无法提升特权。

### `serviceusage.apiKeys.create`

还有一种与GCP API进行身份验证的方法称为API密钥。默认情况下，它们没有任何限制，这意味着它们可以访问它们所在的整个GCP项目。我们可以利用这一事实，创建一个新的API密钥，该密钥可能比我们自己的用户具有更多的特权。这没有官方的API，因此需要向_https://apikeys.clients6.google.com/_（或_https://apikeys.googleapis.com/_）发送自定义HTTP请求。这是通过在浏览GCP Web控制台时监视HTTP请求和响应来发现的。有关与API密钥相关的限制的文档，请访问[此链接](https://cloud.google.com/docs/authentication/api-keys)。

下图显示了如何在Web控制台中创建API密钥。

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image6-1.png)

通过发现的未记录的API，我们还可以通过API本身创建API密钥。

上面的截图显示了发送POST请求以检索项目的新API密钥。

此方法的利用脚本可以在[此处](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.create.py)找到。

### `serviceusage.apiKeys.list`

还发现了另一个未记录的API，用于列出已创建的API密钥（这也可以在Web控制台中完成）。因为在创建API密钥后仍然可以看到其值，所以我们可以获取项目中的所有API密钥。

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image4-1.png)

上面的截图显示了请求与之前完全相同，只是将POST请求更改为GET请求。这只显示了一个密钥，但如果项目中有其他密钥，它们也会被列出。

此方法的利用脚本可以在[此处](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.list.py)找到。

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

您在**网络安全公司**工作吗？您想在HackTricks中看到您的**公司广告**吗？或者您想获得PEASS的**最新版本或下载PDF版本的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！

发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品

获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)

**加入** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**.**

**通过向** [**hacktricks github仓库**](https://github.com/carlospolop/hacktricks) **提交PR来分享您的黑客技巧。**

**.**

</details>
