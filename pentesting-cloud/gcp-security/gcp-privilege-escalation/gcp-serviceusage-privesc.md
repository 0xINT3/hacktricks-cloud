# GCP - Privil√®ge d'escalade de serviceusage

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** r√©f√©rentiels github [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## serviceusage

Les autorisations suivantes sont utiles pour cr√©er et voler des cl√©s API, mais pas celles des docs : _Une cl√© API est une cha√Æne chiffr√©e simple qui **identifie une application sans aucun principal**. Elles sont utiles pour acc√©der √† des **donn√©es publiques de mani√®re anonyme**, et sont utilis√©es pour **associer** les demandes d'API √† votre projet pour le quota et la **facturation**._

Par cons√©quent, avec une cl√© API, vous pouvez faire payer cette entreprise pour votre utilisation de l'API, mais vous ne pourrez pas escalader les privil√®ges.

### `serviceusage.apiKeys.create`

Il existe une autre m√©thode d'authentification avec les API GCP connue sous le nom de cl√©s API. Par d√©faut, elles sont cr√©√©es sans restrictions, ce qui signifie qu'elles ont acc√®s √† l'ensemble du projet GCP dans lequel elles ont √©t√© cr√©√©es. Nous pouvons tirer parti de ce fait en cr√©ant une nouvelle cl√© API qui peut avoir plus de privil√®ges que notre propre utilisateur. Il n'y a pas d'API officielle pour cela, donc une requ√™te HTTP personnalis√©e doit √™tre envoy√©e √† _https://apikeys.clients6.google.com/_ (ou _https://apikeys.googleapis.com/_). Cela a √©t√© d√©couvert en surveillant les requ√™tes et r√©ponses HTTP lors de la navigation dans la console web GCP. Pour la documentation sur les restrictions associ√©es aux cl√©s API, visitez [ce lien](https://cloud.google.com/docs/authentication/api-keys).

La capture d'√©cran suivante montre comment vous pouvez cr√©er une cl√© API dans la console web.

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image6-1.png)

Avec l'API non document√©e qui a √©t√© d√©couverte, nous pouvons √©galement cr√©er des cl√©s API via l'API elle-m√™me.

La capture d'√©cran ci-dessus montre une requ√™te POST envoy√©e pour r√©cup√©rer une nouvelle cl√© API pour le projet.

Le script d'exploitation pour cette m√©thode peut √™tre trouv√© [ici](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.create.py).

### `serviceusage.apiKeys.list`

Une autre API non document√©e a √©t√© trouv√©e pour r√©pertorier les cl√©s API qui ont d√©j√† √©t√© cr√©√©es (cela peut √©galement √™tre fait dans la console web). Parce que vous pouvez toujours voir la valeur de la cl√© API apr√®s sa cr√©ation, nous pouvons extraire toutes les cl√©s API du projet.

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image4-1.png)

La capture d'√©cran ci-dessus montre que la requ√™te est exactement la m√™me qu'auparavant, elle est juste une requ√™te GET au lieu d'une requ√™te POST. Cela ne montre qu'une seule cl√©, mais s'il y avait d'autres cl√©s dans le projet, elles seraient √©galement r√©pertori√©es.

Le script d'exploitation pour cette m√©thode peut √™tre trouv√© [ici](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.list.py).

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs

Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

**Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm).

**Partagez vos astuces de piratage en soumettant des PR aux** r√©f√©rentiels github [**hacktricks**](https://github.com/carlospolop/hacktricks)\*\*\*\*

**.**

</details>