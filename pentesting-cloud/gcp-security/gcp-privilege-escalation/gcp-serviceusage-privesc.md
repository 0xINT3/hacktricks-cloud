```markdown
# GCP - Serviceusage Privesc

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

他のサポート方法:

* **HackTricksに広告を掲載したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手してください
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)をチェックしてください
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローしてください。**
* **ハッキングのコツを共有するために、** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubリポジトリにPRを提出してください。**

</details>

## serviceusage

以下の権限は、APIキーを作成し盗むのに役立ちます。ドキュメントからのこの情報に注意してください：_APIキーは、**任意のプリンシパルなしにアプリケーションを識別する**単純な暗号化された文字列です。これらは、**公開データに匿名でアクセスする**ために役立ち、APIリクエストをクォータと**請求**のためにプロジェクトに**関連付ける**ために使用されます。_

したがって、APIキーを使用すると、APIの使用料金をその会社に支払わせることができますが、権限を昇格させることはできません。

### `serviceusage.apiKeys.create`

GCP APIで認証する別の方法としてAPIキーがあります。デフォルトでは、制限なしで作成されるため、作成されたGCPプロジェクト全体にアクセスできます。私たちは、自分のユーザーよりも多くの権限を持つ新しいAPIキーを作成することでこれを利用できます。これには公式のAPIがないため、カスタムHTTPリクエストを _https://apikeys.clients6.google.com/_ （または _https://apikeys.googleapis.com/_ ）に送信する必要があります。これは、GCPウェブコンソールをブラウジングしながらHTTPリクエストとレスポンスを監視することで発見されました。APIキーに関連する制限のドキュメントについては、[このリンク](https://cloud.google.com/docs/authentication/api-keys)を訪れてください。

以下のスクリーンショットは、ウェブコンソールでAPIキーを作成する方法を示しています。

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image6-1.png)

発見された公式でないAPIを使用して、API自体を通じてAPIキーを作成することもできます。

上のスクリーンショットは、プロジェクトの新しいAPIキーを取得するために送信されたPOSTリクエストを示しています。

この方法のエクスプロイトスクリプトは[こちら](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.create.py)で見つけることができます。

### `serviceusage.apiKeys.list`

既に作成されたAPIキーをリストするための別の公式でないAPIが見つかりました（これもウェブコンソールで行うことができます）。APIキーの値は作成後も見ることができるため、プロジェクト内のすべてのAPIキーを引き出すことができます。

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image4-1.png)

上のスクリーンショットは、リクエストが前と全く同じであることを示しており、POSTリクエストではなくGETリクエストになっています。これは単一のキーを示していますが、プロジェクトに追加のキーがあれば、それらもリストされます。

この方法のエクスプロイトスクリプトは[こちら](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.list.py)で見つけることができます。

### **`serviceusage.services.enable`** , **`serviceusage.services.use`**

これらの権限を持つ攻撃者は、プロジェクトで新しいサービスを有効にして使用することができます。これにより、攻撃者はWorkspace情報にアクセスするためにadminやcloudidentityのようなサービスを有効にしたり、興味深いデータにアクセスするために他のサービスを有効にすることができます。

## **参考文献**

* [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/#:\~:text=apiKeys.-,create,privileges%20than%20our%20own%20user.](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/)

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

**サイバーセキュリティ会社**で働いていますか？ **HackTricksに広告を掲載したい**ですか？ または、**最新版のPEASSを入手したり、HackTricksをPDFでダウンロードしたい**ですか？ [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！

[**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)をチェックしてください

[**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手してください

[**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** [**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローしてください。**

**ハッキングのコツを共有するために、** [**hacktricks githubリポジトリ**](https://github.com/carlospolop/hacktricks)にPRを提出してください**。**

</details>
```
