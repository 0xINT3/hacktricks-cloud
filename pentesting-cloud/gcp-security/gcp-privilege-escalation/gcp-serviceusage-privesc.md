# GCP - Privesc de Serviceusage

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

## serviceusage

As seguintes permiss√µes s√£o √∫teis para criar e roubar chaves de API, n√£o isso dos documentos: _Uma chave de API √© uma string simples criptografada que **identifica um aplicativo sem nenhum principal**. Eles s√£o √∫teis para acessar **dados p√∫blicos anonimamente**, e s√£o usados para **associar** solicita√ß√µes de API com seu projeto para cota e **faturamento**._

Portanto, com uma chave de API, voc√™ pode fazer com que a empresa pague pelo uso da API, mas n√£o poder√° escalar privil√©gios.

### `serviceusage.apiKeys.create`

Existe outro m√©todo de autentica√ß√£o com as APIs do GCP conhecido como chaves de API. Por padr√£o, elas s√£o criadas sem restri√ß√µes, o que significa que t√™m acesso a todo o projeto GCP em que foram criadas. Podemos aproveitar esse fato criando uma nova chave de API que pode ter mais privil√©gios do que nosso pr√≥prio usu√°rio. N√£o h√° uma API oficial para isso, portanto, √© necess√°rio enviar uma solicita√ß√£o HTTP personalizada para _https://apikeys.clients6.google.com/_ (ou _https://apikeys.googleapis.com/_). Isso foi descoberto monitorando as solicita√ß√µes e respostas HTTP enquanto navegava no console da web do GCP. Para documenta√ß√£o sobre as restri√ß√µes associadas √†s chaves de API, visite [este link](https://cloud.google.com/docs/authentication/api-keys).

A captura de tela a seguir mostra como voc√™ criaria uma chave de API no console da web.

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image6-1.png)

Com a API n√£o documentada que foi descoberta, tamb√©m podemos criar chaves de API por meio da pr√≥pria API.

A captura de tela acima mostra uma solicita√ß√£o POST sendo enviada para recuperar uma nova chave de API para o projeto.

O script de explora√ß√£o para este m√©todo pode ser encontrado [aqui](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.create.py).

### `serviceusage.apiKeys.list`

Outra API n√£o documentada foi encontrada para listar as chaves de API que j√° foram criadas (isso tamb√©m pode ser feito no console da web). Como voc√™ ainda pode ver o valor da chave de API ap√≥s sua cria√ß√£o, podemos recuperar todas as chaves de API no projeto.

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image4-1.png)

A captura de tela acima mostra que a solicita√ß√£o √© exatamente a mesma que antes, apenas √© uma solicita√ß√£o GET em vez de uma solicita√ß√£o POST. Isso mostra apenas uma chave, mas se houver chaves adicionais no projeto, elas tamb√©m ser√£o listadas.

O script de explora√ß√£o para este m√©todo pode ser encontrado [aqui](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.list.py).

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

**Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm).

**Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio do hacktricks**](https://github.com/carlospolop/hacktricks)\*\*\*\*

**.**

</details>