# GCP - Serviceusage Privesc

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos.
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## serviceusage

Los siguientes permisos son √∫tiles para crear y robar claves API, no esto de los documentos: _Una clave API es una cadena cifrada simple que **identifica una aplicaci√≥n sin ning√∫n principal**. Son √∫tiles para acceder a **datos p√∫blicos de forma an√≥nima**, y se utilizan para **asociar** las solicitudes de API con tu proyecto para la **cuota** y la **facturaci√≥n**._

Por lo tanto, con una clave API puedes hacer que la empresa pague por tu uso de la API, pero no podr√°s escalar privilegios.

### `serviceusage.apiKeys.create`

Hay otro m√©todo de autenticaci√≥n con las API de GCP conocido como claves API. Por defecto, se crean sin restricciones, lo que significa que tienen acceso a todo el proyecto de GCP en el que se crearon. Podemos aprovechar ese hecho creando una nueva clave API que pueda tener m√°s privilegios que nuestro propio usuario. No hay una API oficial para esto, por lo que se necesita enviar una solicitud HTTP personalizada a _https://apikeys.clients6.google.com/_ (o _https://apikeys.googleapis.com/_). Esto se descubri√≥ mediante la monitorizaci√≥n de las solicitudes y respuestas HTTP mientras se navegaba por la consola web de GCP. Para obtener documentaci√≥n sobre las restricciones asociadas con las claves API, visita [este enlace](https://cloud.google.com/docs/authentication/api-keys).

La siguiente captura de pantalla muestra c√≥mo crear√≠as una clave API en la consola web.

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image6-1.png)

Con la API no documentada que se descubri√≥, tambi√©n podemos crear claves API a trav√©s de la API en s√≠.

La captura de pantalla anterior muestra una solicitud POST que se env√≠a para recuperar una nueva clave API para el proyecto.

El script de explotaci√≥n para este m√©todo se puede encontrar [aqu√≠](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.create.py).

### `serviceusage.apiKeys.list`

Se encontr√≥ otra API no documentada para listar las claves API que ya se han creado (esto tambi√©n se puede hacer en la consola web). Debido a que a√∫n puedes ver el valor de la clave API despu√©s de su creaci√≥n, podemos extraer todas las claves API del proyecto.

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image4-1.png)

La captura de pantalla anterior muestra que la solicitud es exactamente la misma que antes, solo que es una solicitud GET en lugar de una solicitud POST. Esto solo muestra una clave, pero si hubiera claves adicionales en el proyecto, tambi√©n se listar√≠an.

El script de explotaci√≥n para este m√©todo se puede encontrar [aqu√≠](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.list.py).

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver a tu **empresa anunciada en HackTricks**? ¬øo quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!

Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos.

Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)

**√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm).

**Comparte tus trucos de hacking enviando PRs a los repositorios de** [**hacktricks github repo**](https://github.com/carlospolop/hacktricks)\*\*\*\*

**.**

</details>