# GCP - Serviceusage Privesc

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## serviceusage

As seguintes permiss√µes s√£o √∫teis para criar e roubar chaves de API, note isto dos documentos: _Uma chave de API √© uma string criptografada simples que **identifica uma aplica√ß√£o sem qualquer principal**. Elas s√£o √∫teis para acessar **dados p√∫blicos anonimamente**, e s√£o usadas para **associar** solicita√ß√µes de API ao seu projeto para cota e **faturamento**._

Portanto, com uma chave de API, voc√™ pode fazer com que a empresa pague pelo seu uso da API, mas voc√™ n√£o ser√° capaz de escalar privil√©gios.

### `serviceusage.apiKeys.create`

Existe outro m√©todo de autentica√ß√£o com as APIs do GCP conhecido como chaves de API. Por padr√£o, elas s√£o criadas sem restri√ß√µes, o que significa que t√™m acesso a todo o projeto GCP no qual foram criadas. Podemos capitalizar esse fato criando uma nova chave de API que pode ter mais privil√©gios do que nosso pr√≥prio usu√°rio. N√£o existe uma API oficial para isso, ent√£o uma solicita√ß√£o HTTP personalizada precisa ser enviada para _https://apikeys.clients6.google.com/_ (ou _https://apikeys.googleapis.com/_). Isso foi descoberto monitorando as solicita√ß√µes e respostas HTTP enquanto navegava no console web do GCP. Para documenta√ß√£o sobre as restri√ß√µes associadas √†s chaves de API, visite [este link](https://cloud.google.com/docs/authentication/api-keys).

A captura de tela a seguir mostra como voc√™ criaria uma chave de API no console web.

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image6-1.png)

Com a API n√£o documentada que foi descoberta, tamb√©m podemos criar chaves de API atrav√©s da pr√≥pria API.

A captura de tela acima mostra uma solicita√ß√£o POST sendo enviada para recuperar uma nova chave de API para o projeto.

O script de explora√ß√£o para este m√©todo pode ser encontrado [aqui](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.create.py).

### `serviceusage.apiKeys.list`

Outra API n√£o documentada foi encontrada para listar chaves de API que j√° foram criadas (isso tamb√©m pode ser feito no console web). Como voc√™ ainda pode ver o valor da chave de API ap√≥s sua cria√ß√£o, podemos puxar todas as chaves de API do projeto.

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image4-1.png)

A captura de tela acima mostra que a solicita√ß√£o √© exatamente a mesma de antes, apenas √© uma solicita√ß√£o GET em vez de uma solicita√ß√£o POST. Isso mostra apenas uma √∫nica chave, mas se houvesse chaves adicionais no projeto, essas tamb√©m seriam listadas.

O script de explora√ß√£o para este m√©todo pode ser encontrado [aqui](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.list.py).

### **`serviceusage.services.enable`** , **`serviceusage.services.use`**

Com essas permiss√µes, um atacante pode habilitar e usar novos servi√ßos no projeto. Isso poderia permitir que um atacante habilitasse servi√ßos como admin ou cloudidentity para acessar informa√ß√µes do Workspace, ou outros servi√ßos para acessar dados interessantes.&#x20;

## **Refer√™ncias**

* [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/#:\~:text=apiKeys.-,create,privileges%20than%20our%20own%20user.](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/)

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso √† **vers√£o mais recente do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos

Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)

**Junte-se ao grupo** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**.**

**Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio github do hacktricks**](https://github.com/carlospolop/hacktricks)\*\*\*\*

**.**

</details>
