# GCP - Serviceusage Privesc

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**最新版のPEASSを入手したり、HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **ハックトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

## serviceusage

次の権限は、APIキーの作成と盗み出しに役立ちます。ドキュメントには次のように記載されています: _APIキーは、**主体なしでアプリケーションを識別する**ための単純な暗号化された文字列です。これらは**公開データに匿名でアクセスする**ために役立ち、クォータと**請求**のためにAPIリクエストをプロジェクトに**関連付ける**ために使用されます。_

したがって、APIキーを使用すると、その会社にAPIの使用料を支払わせることができますが、特権をエスカレートすることはできません。

### `serviceusage.apiKeys.create`

APIキーとして知られるGCP APIとの認証方法の別の方法があります。デフォルトでは、制限がない状態で作成されるため、作成されたGCPプロジェクト全体にアクセスできます。これを利用して、自分自身のユーザーよりも特権のある新しいAPIキーを作成することができます。公式のAPIは存在しないため、カスタムのHTTPリクエストを _https://apikeys.clients6.google.com/_ (または _https://apikeys.googleapis.com/_ ) に送信する必要があります。これは、GCPのWebコンソールをブラウズしながらHTTPリクエストとレスポンスを監視することで発見されました。APIキーに関連する制限のドキュメントについては、[このリンク](https://cloud.google.com/docs/authentication/api-keys)を参照してください。

以下のスクリーンショットは、WebコンソールでAPIキーを作成する方法を示しています。

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image6-1.png)

発見された非公開のAPIを使用して、API自体を介してAPIキーを作成することもできます。

上記のスクリーンショットは、プロジェクトの新しいAPIキーを取得するために送信されるPOSTリクエストを示しています。

この方法のエクスプロイトスクリプトは[こちら](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.create.py)で見つけることができます。

### `serviceusage.apiKeys.list`

APIキーの一覧を表示するための別の非公開のAPIが見つかりました（これはWebコンソールでも行うことができます）。APIキーの値を作成後も表示できるため、プロジェクト内のすべてのAPIキーを取得することができます。

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image4-1.png)

上記のスクリーンショットは、リクエストが前とまったく同じであることを示していますが、POSTリクエストではなくGETリクエストです。これは単一のキーのみを表示していますが、プロジェクトに追加のキーがある場合はそれらも表示されます。

この方法のエクスプロイトスクリプトは[こちら](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/serviceusage.apiKeys.list.py)で見つけることができます。

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

**サイバーセキュリティ企業で働いていますか？** **HackTricksで会社を宣伝**したいですか？または、**最新版のPEASSを入手**したり、HackTricksを**PDFでダウンロード**したいですか？[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！

[**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう

[**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう

[**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/carlospolopm)**。**

**ハックトリックを共有するために、PRを** [**hacktricks github repo**](https://github.com/carlospolop/hacktricks) **に提出してください。**

**.**

</details>
