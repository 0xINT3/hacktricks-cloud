# GCP - рдиреЗрдЯрд╡рд░реНрдХ рдбреЙрдХрд░ рдПрд╕реНрдХреЗрдк

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**рдж рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **рдореЗрд░рд╛** рдЯреНрд╡рд┐рдЯрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб рдЧрд┐рдЯрд╣рдм рд░реЗрдкреЛ рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ред

</details>

## рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕реНрдерд┐рддрд┐

рдЬрд╣рд╛рдВ рдЗрд╕ рддрдХрдиреАрдХ рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЙрд╕рдореЗрдВ рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ GCP рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдПрдХ **Docker** рдХрдВрдЯреЗрдирд░ рдореЗрдВ **рд░реВрдЯ** рдПрдХреНрд╕реЗрд╕ рдкреНрд░рд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╣реЛрд╕реНрдЯ рдиреЗрдЯрд╡рд░реНрдХ (рдФрд░ **`CAP_NET_ADMIN`** рдФрд░ **`CAP_NET_RAW`** рдХреНрд╖рдорддрд╛рдПрдВ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

## рд╣рдорд▓рд╛

рдЬрдм рдЖрдк рдПрдХ рд╕рд╛рдзрд╛рд░рд┐рдд Google Compute Engine рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░ рдиреЗрдЯрд╡рд░реНрдХ рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ **рд╕рд╛рджрд╛ HTTP рдЕрдиреБрд░реЛрдз** рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВ рдЬреЛ **рдореЗрдЯрд╛рдбреЗрдЯрд╛** рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░ **`169.254.169.254`** рдкрддреЗ рдкрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рдРрд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рд╡рд╛рд▓реА рдПрдХ рд╕реЗрд╡рд╛ рд╣реИ [**Google Guest Agent**](https://github.com/GoogleCloudPlatform/guest-agent) рдЬреЛ рдЦреБрд▓рд╛ рд╕реНрд░реЛрдд рд╕рдВрд╕реНрдХрд░рдг рд╣реИред рдЕрдиреБрд░реЛрдз рдЙрджрд╛рд╣рд░рдг:

<figure><img src="../../../.gitbook/assets/image (1) (4).png" alt=""><figcaption></figcaption></figure>

рдпрд╣ рдПрдЬреЗрдВрдЯ **рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЛ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдореЙрдирд┐рдЯрд░ рдХрд░рддрд╛ рд╣реИред** рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдореЗрдВ рдПрдХ **рдлрд╝реАрд▓реНрдб** рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЕрдзрд┐рдХреГрдд **SSH рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ** рдХреБрдВрдЬреА рд╣реЛрддреА рд╣реИред\
рдЗрд╕рд▓рд┐рдП, рдЬрдм рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдореЗрдВ рдПрдХ рдирдИ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ SSH рдХреБрдВрдЬреА рдкреНрд░рдХрдЯ рд╣реЛрддреА рд╣реИ, рддреЛ рдПрдЬреЗрдВрдЯ рдЗрд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ `.authorized_key` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **рдЕрдзрд┐рдХреГрдд** рдХрд░реЗрдЧрд╛ рдФрд░ рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ рдПрдХ рдирдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдПрдЧрд╛ рдФрд░ рдЗрд╕реЗ **sudoers** рдореЗрдВ рдЬреЛрдбрд╝реЗрдЧрд╛ред

Google Guest Agent рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдореЙрдирд┐рдЯрд░ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдПрдХ рдХреЙрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрддрд╛ рд╣реИ **рд╕рднреА рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдорд╛рдиреЛрдВ рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** (`GET /computeMetadata/v1/?recursive=true`), рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╕рд░реНрд╡рд░ рдХреЛ рд╕рдВрдХреЗрдд рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдХреЗрд╡рд▓ рдЬрдм рдкрд┐рдЫрд▓реЗ рдкреНрд░рд╛рдкреНрдд рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдорд╛рдиреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдХреЛрдИ рдкрд░рд┐рд╡рд░реНрддрди рд╣реЛ, рддрдм рд╣реА рдПрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рднреЗрдЬреЗрдВ, рдЬрд┐рд╕реЗ рдЗрд╕рдХреЗ Etag рджреНрд╡рд╛рд░рд╛ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ (`wait_for_change=true&last_etag=`)ред

рдЗрд╕ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдПрдХ **рдЯрд╛рдЗрдордЖрдЙрдЯ** (`timeout_sec=`) рднреА рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕рдордпрд╛рдВрддрд░ рдореЗрдВ рдХреЛрдИ **рдкрд░рд┐рд╡рд░реНрддрди рдирд╣реАрдВ** рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╕рд░реНрд╡рд░ рдЙрдиреНрдЪрд╛рдВрдЧреЗ рдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрддрд╛ рд╣реИред

рдЗрд╕рд╕реЗ **IMDS** рдХреЛ **60 рд╕реЗрдХрдВрдб** рдХреЗ рдмрд╛рдж рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдпрджрд┐ рдЙрд╕ рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ рдХреЛрдИ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкрд░рд┐рд╡рд░реНрддрди рдирд╣реАрдВ рд╣реБрдЖ рд╣реИ, рдЬреЛ IMDS рд╕реЗ рдореЗрдЬрдмрд╛рди рдПрдЬреЗрдВрдЯ рдХреЛ рдПрдХ рдирдХрд▓реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рдЦрд┐рдбрд╝рдХреА** рдЦреЛрд▓рддрд╛ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **MitM** рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ IMDS рд╕рд░реНрд╡рд░ рд╕реЗ рдПрдХ рдЬрд╡рд╛рдм рдХреЛ **рдЬрд╛рд▓реАрдХрд░рдг** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдПрдХ рдирдП рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХреЛ рд╕реНрдерд╛рдиреАрдп рдореЗрдЬрдмрд╛рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **SSH** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдПред

### рдПрд╕реНрдХреЗрдк

Google Compute Engine рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ ARP рд╕реНрдкреВрдлрд┐рдВрдЧ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐, [**Ezequiel**](https://www.ezequiel.tech/2020/08/dropping-shell-in.html) рдиреЗ рдЗрд╕ **рд╕рдВрд╢реЛрдзрд┐рдд рд╕рдВрд╕реНрдХрд░рдг рдХреЛ** [**rshijack**](https://github.com/ezequielpereira/rshijack) **** рдмрдирд╛рдпрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ SSH рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдЪрд╛рд░ рдореЗрдВ рдПрдХ рдкреИрдХреЗрдЯ рдбрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

rshijack рдХрд╛ рдпрд╣ рд╕рдВрд╢реЛрдзрд┐рдд рд╕рдВрд╕реНрдХрд░рдг **ACK рдФрд░ SEQ рдирдВрдмрд░реНрд╕ рдХреЛ рдХрдорд╛рдВрдб-рд▓рд╛рдЗрди** рдЖрд░реНрдЧреНрдпреВрдореЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд╕рдордп рдмрдЪрд╛рддреЗ рд╣реИрдВ рдФрд░ рд╣рдореЗрдВ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЖрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ **рдЬрд╛рд▓реАрдХрд░рдг рдЬрд╡рд╛рдм** рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣
```
<TIME> IP <LOCAL_IP>.<PORT> > 169.254.169.254.80: Flags [P.], seq <NUM>:<TARGET_ACK>, ack <TARGET_SEQ>, win <NUM>, length <NUM>: HTTP: GET /computeMetadata/v1/?timeout_sec=<SECONDS>&last_etag=<ETAG>&alt=json&recursive=True&wait_for_change=True HTTP/1.1
```
{% endcode %}

рдЬрдм рдЖрдк рдЙрд╕ рдорд╛рдиреНрдпрддрд╛ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ **рд╕рд╣реА ETAG рдХреЗ рд╕рд╛рде рдирдХрд▓реА рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдбреЗрдЯрд╛ рдХреЛ `rshijack` рдХреЛ рднреЗрдЬреЗрдВ**:

**`fakeData.sh <ETAG> | rshijack -q eth0 169.254.169.254:80 <LOCAL_IP>:<PORT> <TARGET_SEQ> <TARGET_ACK>; ssh -i id_rsa -o StrictHostKeyChecking=no wouter@localhost`**

рдФрд░ рдЗрд╕рд╕реЗ рдПрдЬреЗрдВрдЯ рдХреЛ **рдЙрд╕ рдкрдмреНрд▓рд┐рдХ рдХреБрдВрдЬреА рдХреЛ рдЕрдзрд┐рдХреГрдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдПрдВрдЧреЗ рдЬреЛ рдЖрдкрдХреЛ **SSH** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдирд┐рдЬреА** рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде **рдХрдиреЗрдХреНрдЯ** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧреАред

## рд╕рдВрджрд░реНрдн

* [https://www.ezequiel.tech/2020/08/dropping-shell-in.html](https://www.ezequiel.tech/2020/08/dropping-shell-in.html)
* [https://www.wiz.io/blog/the-cloud-has-an-isolation-problem-postgresql-vulnerabilities](https://www.wiz.io/blog/the-cloud-has-an-isolation-problem-postgresql-vulnerabilities)

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХрд╛ рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред**

</details>
