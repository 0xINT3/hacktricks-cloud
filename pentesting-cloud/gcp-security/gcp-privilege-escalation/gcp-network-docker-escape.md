# GCP - –í—Ç–µ—á–∞ –∑ Docker —á–µ—Ä–µ–∑ –º–µ—Ä–µ–∂—É

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–ì—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>

## –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω

–£ –æ–±–æ—Ö –æ–ø–∏—Å–∞—Ö, –¥–µ —Ü—è —Ç–µ—Ö–Ω—ñ–∫–∞ –≤–∫–∞–∑–∞–Ω–∞, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –∑–º–æ–≥–ª–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø **root** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ **Docker**, –∫–µ—Ä–æ–≤–∞–Ω–æ–≥–æ GCP –∑ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ –º–µ—Ä–µ–∂—ñ —Ö–æ—Å—Ç–∞ (—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏ **`CAP_NET_ADMIN`** —Ç–∞ **`CAP_NET_RAW`**).

## –ü–æ—è—Å–Ω–µ–Ω–Ω—è –∞—Ç–∞–∫–∏

–ù–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ Google Compute Engine, —Ä–µ–≥—É–ª—è—Ä–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–µ—Ä–µ–∂–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ—ñ–∫—É –ø–æ–∫–∞–∑—É—î —á–∏—Å–ª–µ–Ω–Ω—ñ **–∑–∞–ø–∏—Ç–∏ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ HTTP** –¥–æ **–µ–∫–∑–µ–º–ø–ª—è—Ä–∞ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö** –∑–∞ –∞–¥—Ä–µ—Å–æ—é `169.254.169.254`. [**Google Guest Agent**](https://github.com/GoogleCloudPlatform/guest-agent), –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —Å–µ—Ä–≤—ñ—Å, —á–∞—Å—Ç–æ —Ä–æ–±–∏—Ç—å —Ç–∞–∫—ñ –∑–∞–ø–∏—Ç–∏.

–¶–µ–π –∞–≥–µ–Ω—Ç –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è **–≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω —É –º–µ—Ç–∞–¥–∞–Ω–∏—Ö**. –ó–æ–∫—Ä–µ–º–∞, –º–µ—Ç–∞–¥–∞–Ω—ñ –≤–∫–ª—é—á–∞—é—Ç—å **–ø–æ–ª–µ –¥–ª—è –ø—É–±–ª—ñ—á–Ω–∏—Ö –∫–ª—é—á—ñ–≤ SSH**. –ö–æ–ª–∏ –¥–æ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –¥–æ–¥–∞—î—Ç—å—Å—è –Ω–æ–≤–∏–π –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á SSH, –∞–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ **–∞–≤—Ç–æ—Ä–∏–∑—É—î** –π–æ–≥–æ –≤ —Ñ–∞–π–ª—ñ `.authorized_key`. –í—ñ–Ω —Ç–∞–∫–æ–∂ –º–æ–∂–µ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** —Ç–∞ –¥–æ–¥–∞—Ç–∏ –π–æ–≥–æ –¥–æ **sudoers**, —è–∫—â–æ —Ü–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

–ê–≥–µ–Ω—Ç –≤—ñ–¥—Å—Ç–µ–∂—É—î –∑–º—ñ–Ω–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ –∑–∞–ø–∏—Ç –¥–ª—è **–æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤—Å—ñ—Ö –∑–Ω–∞—á–µ–Ω—å –º–µ—Ç–∞–¥–∞–Ω–∏—Ö —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ** (`GET /computeMetadata/v1/?recursive=true`). –¶–µ–π –∑–∞–ø–∏—Ç –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Å–µ—Ä–≤–µ—Ä –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ª–∏—à–µ —É –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ –≤ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –≤—ñ–¥–±—É–ª–∞—Å—è –∑–º—ñ–Ω–∞ –∑ –º–æ–º–µ–Ω—Ç—É –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è, –≤–∏–∑–Ω–∞—á–µ–Ω–æ–≥–æ Etag (`wait_for_change=true&last_etag=`). –î–æ–¥–∞—Ç–∫–æ–≤–æ –≤–∫–ª—é—á–µ–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä **—Ç–∞–π–º-–∞—É—Ç—É** (`timeout_sec=`). –Ø–∫—â–æ –∑–º—ñ–Ω –Ω–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø—Ä–æ—Ç—è–≥–æ–º –≤–∫–∞–∑–∞–Ω–æ–≥–æ —Ç–∞–π–º-–∞—É—Ç—É, —Å–µ—Ä–≤–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î **–Ω–µ–∑–º—ñ–Ω–µ–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏**.

–¶–µ–π –ø—Ä–æ—Ü–µ—Å –¥–æ–∑–≤–æ–ª—è—î **IMDS** (–°–ª—É–∂–±–∞ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –µ–∫–∑–µ–º–ø–ª—è—Ä–∞) –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ —á–µ—Ä–µ–∑ **60 —Å–µ–∫—É–Ω–¥**, —è–∫—â–æ –Ω–µ –≤—ñ–¥–±—É–ª–∞—Å—è –∂–æ–¥–Ω–∞ –∑–º—ñ–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, —Å—Ç–≤–æ—Ä—é—é—á–∏ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–µ **–≤—ñ–∫–Ω–æ –¥–ª—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è —Ñ–∞–ª—å—à–∏–≤–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó** –¥–ª—è –≥–æ—Å—Ç—å–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞.

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü–µ, –≤–∏–∫–æ–Ω–∞–≤—à–∏ –∞—Ç–∞–∫—É **Man-in-the-Middle (MitM)**, –ø—ñ–¥—Ä–æ–±–∏–≤—à–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞ IMDS —Ç–∞ **–¥–æ–¥–∞–≤—à–∏ –Ω–æ–≤–∏–π –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á**. –¶–µ –º–æ–∂–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø SSH –¥–æ —Ö–æ—Å—Ç–∞.

### –¢–µ—Ö–Ω—ñ–∫–∞ –≤—Ç–µ—á—ñ

–•–æ—á–∞ ARP-–ø—ñ–¥—Ä–æ–±–∫–∞ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –≤ –º–µ—Ä–µ–∂–∞—Ö Google Compute Engine, [**–º–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∞ –≤–µ—Ä—Å—ñ—è rshijack**](https://github.com/ezequielpereira/rshijack), —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∞ [**Ezequiel**](https://www.ezequiel.tech/2020/08/dropping-shell-in.html), –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∞ –¥–ª—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –ø–∞–∫–µ—Ç—ñ–≤ —É –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—é –¥–ª—è –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ SSH.

–¶—è –≤–µ—Ä—Å—ñ—è rshijack –¥–æ–∑–≤–æ–ª—è—î –≤–≤–µ–¥–µ–Ω–Ω—è –Ω–æ–º–µ—Ä—ñ–≤ ACK —Ç–∞ SEQ —è–∫ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞, —Å–ø—Ä–æ—â—É—é—á–∏ –ø—ñ–¥—Ä–æ–±–∫—É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª—å–Ω–æ—é –≤—ñ–¥–ø–æ–≤—ñ–¥–¥—é —Å–µ—Ä–≤–µ—Ä–∞ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö. –î–æ–¥–∞—Ç–∫–æ–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è [**–Ω–µ–≤–µ–ª–∏–∫–∏–π Shell-—Å–∫—Ä–∏–ø—Ç**](https://gist.github.com/ezequielpereira/914c2aae463409e785071213b059f96c#file-fakedata-sh) –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è **—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**. –¶–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–æ–Ω—É–∫–∞—î Google Guest Agent **—Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ `wouter`** –∑ –≤–∫–∞–∑–∞–Ω–∏–º –ø—É–±–ª—ñ—á–Ω–∏–º –∫–ª—é—á–µ–º —É —Ñ–∞–π–ª—ñ `.authorized_keys`.

–°–∫—Ä–∏–ø—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç–æ–π —Å–∞–º–∏–π ETag, —â–æ–± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ —Å–µ—Ä–≤–µ—Ä—É –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –Ω–µ–≥–∞–π–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª—è—Ç–∏ Google Guest Agent –ø—Ä–æ —Ä—ñ–∑–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö, —Ç–∏–º —Å–∞–º–∏–º –∑–∞—Ç—Ä–∏–º—É—é—á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å.

–î–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—ñ–¥—Ä–æ–±–∫–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:

1. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **tcpdump**:
```bash
tcpdump -S -i eth0 'host 169.254.169.254 and port 80' &
```
–®—É–∫–∞–π—Ç–µ —Ä—è–¥–æ–∫, —Å—Ö–æ–∂–∏–π –∑:
```
<TIME> IP <LOCAL_IP>.<PORT> > 169.254.169.254.80: Flags [P.], seq <NUM>:<TARGET_ACK>, ack <TARGET_SEQ>, win <NUM>, length <NUM>: HTTP: GET /computeMetadata/v1/?timeout_sec=<SECONDS>&last_etag=<ETAG>&alt=json&recursive=True&wait_for_change=True HTTP/1.1
```
2. –ù–∞–¥—ñ—à–ª—ñ—Ç—å —Ñ–∞–ª—å—à–∏–≤—ñ –º–µ—Ç–∞–¥–∞–Ω—ñ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º ETAG –Ω–∞ rshijack:
```bash
fakeData.sh <ETAG> | rshijack -q eth0 169.254.169.254:80 <LOCAL_IP>:<PORT> <TARGET_SEQ> <TARGET_ACK>; ssh -i id_rsa -o StrictHostKeyChecking=no wouter@localhost
```
–¶–µ–π –∫—Ä–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑—É—î –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á, –¥–æ–∑–≤–æ–ª—è—é—á–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø–æ SSH –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º –ø—Ä–∏–≤–∞—Ç–Ω–∏–º –∫–ª—é—á–µ–º.


## References

* [https://www.ezequiel.tech/2020/08/dropping-shell-in.html](https://www.ezequiel.tech/2020/08/dropping-shell-in.html)
* [https://www.wiz.io/blog/the-cloud-has-an-isolation-problem-postgresql-vulnerabilities](https://www.wiz.io/blog/the-cloud-has-an-isolation-problem-postgresql-vulnerabilities)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>
