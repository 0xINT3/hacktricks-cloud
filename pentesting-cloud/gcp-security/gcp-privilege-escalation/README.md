# GCP - √âl√©vation de privil√®ges

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts Github.**

</details>

## Introduction √† l'√©l√©vation de privil√®ges GCP <a href="#introduction-to-gcp-privilege-escalation" id="introduction-to-gcp-privilege-escalation"></a>

GCP, comme tout autre cloud, a des **principaux**: des utilisateurs, des groupes et des comptes de service, et des **ressources** comme Compute Engine, Cloud Functions...\
Ensuite, via des r√¥les, **des autorisations sont accord√©es √† ces principaux sur les ressources**. C'est la fa√ßon de sp√©cifier les autorisations qu'un principal a sur une ressource dans GCP.\
Il existe certaines autorisations qui permettront √† un utilisateur d'**obtenir encore plus d'autorisations** sur la ressource ou sur des ressources tierces, et c'est ce qu'on appelle **l'√©l√©vation de privil√®ges** (√©galement, l'exploitation des vuln√©rabilit√©s pour obtenir plus d'autorisations).

Par cons√©quent, je voudrais s√©parer les techniques d'√©l√©vation de privil√®ges GCP en **2 groupes** :

* **Privesc vers un principal**: Cela vous permettra de **vous faire passer pour un autre principal**, et donc d'agir comme lui avec toutes ses autorisations. Par exemple : Abuser de _getAccessToken_ pour se faire passer pour un compte de service.
* **Privesc sur la ressource**: Cela vous permettra d'**obtenir plus d'autorisations sur la ressource sp√©cifique**. Par exemple : vous pouvez abuser de l'autorisation _setIamPolicy_ sur Cloud Functions pour vous permettre de d√©clencher la fonction.
  * Notez que certaines **autorisations de ressources vous permettront √©galement d'attacher un compte de service arbitraire** √† la ressource. Cela signifie que vous pourrez lancer une ressource avec un compte de service, entrer dans la ressource et **voler le jeton du compte de service**. Par cons√©quent, cela permettra d'escalader vers un principal via une √©l√©vation de privil√®ges de ressource. Cela s'est produit dans plusieurs ressources auparavant, mais maintenant c'est moins fr√©quent (mais cela peut encore arriver).

De toute √©vidence, les techniques d'√©l√©vation de privil√®ges les plus int√©ressantes sont celles du **deuxi√®me groupe** car cela vous permettra d'**obtenir plus de privil√®ges en dehors des ressources sur lesquelles vous avez d√©j√† des privil√®ges**. Cependant, notez que **l'escalade dans les ressources** peut √©galement vous donner acc√®s √† des **informations sensibles** ou m√™me √† d'autres principaux (peut-√™tre via la lecture d'un secret qui contient un jeton d'un compte de service).

{% hint style="warning" %}
Il est √©galement important de noter que dans **GCP, les comptes de service sont √† la fois des principaux et des autorisations**, donc l'√©l√©vation de privil√®ges dans un compte de service vous permettra √©galement de vous faire passer pour lui.
{% endhint %}

{% hint style="info" %}
Les autorisations entre parenth√®ses indiquent les autorisations n√©cessaires pour exploiter la vuln√©rabilit√© avec `gcloud`. Elles peuvent ne pas √™tre n√©cessaires si elle est exploit√©e via l'API.
{% endhint %}

## Autorisations pour la m√©thodologie d'√©l√©vation de privil√®ges

Voici comment je **teste des autorisations sp√©cifiques** pour effectuer des actions sp√©cifiques dans GCP.

1. T√©l√©chargez le d√©p√¥t Github [https://github.com/carlospolop/gcp\_privesc\_scripts](https://github.com/carlospolop/gcp\_privesc\_scripts)
2. Ajoutez dans tests/ le nouveau script

## Techniques d'√©l√©vation de privil√®ges

La fa√ßon d'escalader vos privil√®ges dans GCP est d'avoir suffisamment d'autorisations pour pouvoir, d'une mani√®re ou d'une autre, acc√©der aux privil√®ges d'autres comptes de service/utilisateurs/groupes. Encha√Æner les √©l√©vations jusqu'√† ce que vous ayez un acc√®s administrateur sur l'organisation.

{% hint style="warning" %}
GCP a **des centaines** (voire des milliers) de **permissions** qu'une entit√© peut se voir accorder. Dans ce livre, vous pouvez trouver **toutes les autorisations que je connais** que vous pouvez abuser pour **escalader les privil√®ges**, mais si vous **connaissez un chemin** qui n'est pas mentionn√© ici, **veuillez le partager**.
{% endhint %}

Vous pouvez trouver tous les **chemins de privil√®ges divis√©s par services** :

* [**Apikeys Privesc**](gcp-apikeys-privesc.md)
* [**Cloudbuild Privesc**](gcp-cloudbuild-privesc.md)
* [**Cloudfunctions Privesc**](gcp-cloudfunctions-privesc.md)
* [**Cloudscheduler Privesc**](gcp-cloudscheduler-privesc.md)
* [**Compute Privesc**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/)
* [**Composer Privesc**](gcp-composer-privesc.md)
* [**Container Privesc**](gcp-container-privesc.md)
* [**Deploymentmanager Privesc**](gcp-deploymentmaneger-privesc.md)
* [**IAM Privesc**](gcp-iam-privesc.md)
* [**KMS Privesc**](gcp-kms-privesc.md)
* [**Orgpolicy Privesc**](gcp-orgpolicy-privesc.md)
* [**Pubsub Privesc**](gcp-pubsub-privesc.md)
* [**Resourcemanager Privesc**](gcp-resourcemanager-privesc.md)
* [**Run Privesc**](gcp-run-privesc.md)
* [**Secretmanager Privesc**](gcp-secretmanager-privesc.md)
* [**Serviceusage Privesc**](gcp-serviceusage-privesc.md)
* [**Source Repos Privesc**](gcp-sourcerepos-privesc.md)
* [**Storage Privesc**](gcp-storage-privesc.md)
* [**Misc Privesc**](gcp-misc-perms-privesc.md)

### Abus de GCP pour l'√©l√©vation de privil√®ges localement

Si vous √™tes √† l'int√©rieur d'une machine dans GCP, vous pourriez √™tre en mesure d'abuser des autorisations pour escalader les privil√®ges m√™me localement :

{% content-ref url="gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)
* [https://rhinosecuritylabs.com/cloud-security/