# GCP - рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ**.
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рддрд░рдХреАрдмреЗрдВ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ.

</details>

## GCP рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдкрд░рд┐рдЪрдп <a href="#introduction-to-gcp-privilege-escalation" id="introduction-to-gcp-privilege-escalation"></a>

GCP, рдЕрдиреНрдп рдХреНрд▓рд╛рдЙрдб рдХреА рддрд░рд╣, рдХреБрдЫ **рдореБрдЦреНрдп рддрддреНрд╡** рд╣реЛрддреЗ рд╣реИрдВ: рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рд╕рдореВрд╣ рдФрд░ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ, рдФрд░ рдХреБрдЫ **рд╕рдВрд╕рд╛рдзрди** рдЬреИрд╕реЗ рдХрдВрдкреНрдпреВрдЯ рдЗрдВрдЬрди, рдХреНрд▓рд╛рдЙрдб рдлрдВрдХреНрд╢рдиреНрд╕...
рдлрд┐рд░, рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, **рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ рдЙрди рдореБрдЦреНрдп рддрддреНрд╡реЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИрдВ**. рдпрд╣ GCP рдореЗрдВ рдХрд┐рд╕реА рд╕рдВрд╕рд╛рдзрди рдкрд░ рдореБрдЦреНрдп рддрддреНрд╡ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ.
рдХреБрдЫ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рдВрд╕рд╛рдзрди рдкрд░ рдпрд╛ рддреГрддреАрдп рдкрдХреНрд╖ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ **рдФрд░ рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреА**, рдФрд░ рдЗрд╕реЗ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ (рд╕рд╛рде рд╣реА, рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рднреА).

рдЗрд╕рд▓рд┐рдП, рдореИрдВ GCP рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рддрдХрдиреАрдХреЛрдВ рдХреЛ **2 рд╕рдореВрд╣реЛрдВ** рдореЗрдВ рдЕрд▓рдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдБ:

* **рдореБрдЦреНрдп рддрддреНрд╡ рдХреЗ рд▓рд┐рдП Privesc**: рдпрд╣ рдЖрдкрдХреЛ **рджреВрд╕рд░реЗ рдореБрдЦреНрдп рддрддреНрд╡ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛**, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЙрд╕рдХреА рд╕рднреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдп рдХрд░реЗрдВ. рдЙрджрд╛рд╣рд░рдг: _getAccessToken_ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░реЗрдВ.
* **рд╕рдВрд╕рд╛рдзрди рдкрд░ Privesc**: рдпрд╣ рдЖрдкрдХреЛ **рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрд╕рд╛рдзрди рдкрд░ рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛**. рдЙрджрд╛рд╣рд░рдг: рдЖрдк cloudfunctions рдкрд░ _setIamPolicy_ рдЕрдиреБрдорддрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рдлрдВрдХреНрд╢рди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХреЗрдВ.
* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреБрдЫ **рд╕рдВрд╕рд╛рдзрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЖрдкрдХреЛ рдПрдХ рдордирдорд╛рдиреЗ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЛ рд╕рдВрд╕рд╛рдзрди рд╕реЗ рдЬреЛрдбрд╝рдиреЗ рдХреА рднреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреА**. рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдПрдХ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд╕рд╛рде рдПрдХ SA рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ, рд╕рдВрд╕рд╛рдзрди рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░реЗрдВ, рдФрд░ **SA рдЯреЛрдХрди рдЪреБрд░рд╛ рд▓реЗрдВ**. рдЗрд╕рд▓рд┐рдП, рдпрд╣ рдЖрдкрдХреЛ рд╕рдВрд╕рд╛рдзрди рд╡реГрджреНрдзрд┐ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдореБрдЦреНрдп рддрддреНрд╡ рддрдХ рд╡реГрджреНрдзрд┐ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛. рдпрд╣ рдХрдИ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдореЗрдВ рдкрд╣рд▓реЗ рд╣реЛ рдЪреБрдХрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдм рдпрд╣ рдХрдо рдЖрдо рд╣реИ (рд▓реЗрдХрд┐рди рдЕрднреА рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ).

рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ, рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рддрдХрдиреАрдХреЗрдВ **рджреВрд╕рд░реЗ рд╕рдореВрд╣** рдХреА рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЖрдкрдХреЛ **рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рдмрд╛рд╣рд░ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ рдЬрд┐рди рдкрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ**. рд╣рд╛рд▓рд╛рдВрдХрд┐, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдореЗрдВ рд╡реГрджреНрдзрд┐** рдЖрдкрдХреЛ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** рддрдХ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдЕрдиреНрдп рдореБрдЦреНрдп рддрддреНрд╡реЛрдВ** рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреА рд╣реИ (рд╢рд╛рдпрдж рдПрдХ рдЧреБрдкреНрдд рдХреЛ рдкрдврд╝рдХрд░ рдЬрд┐рд╕рдореЗрдВ рдПрдХ SA рдХрд╛ рдЯреЛрдХрди рд╣реЛрддрд╛ рд╣реИ).

{% hint style="warning" %}
рдпрд╣ рднреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **GCP рдореЗрдВ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рджреЛрдиреЛрдВ рдореБрдЦреНрдп рддрддреНрд╡ рдФрд░ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ**, рдЗрд╕рд▓рд┐рдП рдПрдХ SA рдореЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХрд░рдиреЗ рд╕реЗ рдЖрдкрдХреЛ рдЗрд╕реЗ рднреА рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реЗрдЧреА.
{% endhint %}

{% hint style="info" %}
рдХреЛрд╖реНрдардХреЛрдВ рдХреЗ рдмреАрдЪ рдЕрдиреБрдорддрд┐рдпрд╛рдБ `gcloud` рдХреЗ рд╕рд╛рде рдХрдордЬреЛрд░реА рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреА рд╣реИрдВ. рдпреЗ API рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕рдХрд╛ рд╢реЛрд╖рдг рдХрд░рддреЗ рд╕рдордп рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ.
{% endhint %}

## рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдкрджреНрдзрддрд┐ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рдпрд╣ рд╣реИ рдХрд┐ рдореИрдВ GCP рдХреЗ рдЕрдВрджрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХреИрд╕реЗ рдХрд░рддрд╛ рд╣реВрдБ**.

1. github repo рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ [https://github.com/carlospolop/gcp\_privesc\_scripts](https://github.com/carlospolop/gcp\_privesc\_scripts)
2. tests/ рдореЗрдВ рдирдИ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЬреЛрдбрд╝реЗрдВ

## рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреЛрдкреНрд╕ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ <a href="#bypassing-access-scopes" id="bypassing-access-scopes"></a>

рдЬрдм [рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреЛрдкреНрд╕](https://cloud.google.com/compute/docs/access/service-accounts#accesscopesiam) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХрдВрдкреНрдпреВрдЯрд┐рдВрдЧ рдЗрдВрд╕реНрдЯреЗрдВрд╕ (VM) рдХреЗ рд▓рд┐рдП рдЙрддреНрдкрдиреНрди OAuth рдЯреЛрдХрди рдореЗрдВ **рд╕реНрдХреЛрдк** [**рд╕реАрдорд╛ рд╢рд╛рдорд┐рд▓ рд╣реЛрдЧреА**](https://oauth.net/2/scope/). рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдЦрд╛рддреЗ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рд╕реАрдорд╛ рдХреЛ **рдмрд╛рдпрдкрд╛рд╕** рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ.

рдЗрд╕ рдкреНрд░рддрд┐рдмрдВрдз рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ **рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛** рдпрд╛ рддреЛ **рдирдИ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЦреЛрдЬрдирд╛** рд╣реИ рдЬреЛ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рд╣реЛрд╕реНрдЯ рдореЗрдВ рд╣реЛ, рдпрд╛ **рд╕реЗрд╡рд╛ рдХреБрдВрдЬреА рдЦреЛрдЬрдирд╛ рдЬрд┐рд╕рд╕реЗ рдмрд┐рдирд╛ рдкреНрд░рддрд┐рдмрдВрдз рдХреЗ OAuth рдЯреЛрдХрди рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ** рдпрд╛ **рдХрдо рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдЕрд▓рдЧ VM рдкрд░ рдЬрд╛рдирд╛**.

**рджреВрд╕рд░рд╛ рдмреЙрдХреНрд╕ рдкреЙрдк рдХрд░реЗрдВ**

рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рдХрдо рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреЛрдкреНрд╕ рд╡рд╛рд▓рд╛ рджреВрд╕рд░рд╛ рдмреЙрдХреНрд╕ рдореМрдЬреВрдж рд╣реЛ. рдпрджрд┐ рдЖрдк `gcloud compute instances list --quiet --format=json` рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЙрди рдЗрдВрд╕реНрдЯреЗрдВрд╕реЛрдВ рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВ рдЬрд┐рдирдореЗрдВ рдпрд╛ рддреЛ рдЖрдкрдХреА рд╡рд╛рдВрдЫрд┐рдд рд╕реНрдХреЛрдк рд╣реЛ рдпрд╛ **`auth/cloud-platform`** рд╕рд░реНрд╡-рд╕рдорд╛рд╡реЗрд╢реА рд╕реНрдХреЛрдк рд╣реЛ.

рд╕рд╛рде рд╣реА, рдЙрди рдЗрдВрд╕реНрдЯреЗрдВрд╕реЛрдВ рдХреЗ рд▓рд┐рдП рднреА рджреЗрдЦреЗрдВ рдЬрд┐рдирдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ (`PROJECT_NUMBER-compute@developer.gserviceaccount.com`).

**рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ**

Google рдмрд╣реБрдд рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдХрд╣рддрд╛ рд╣реИ [**"рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреЛрдкреНрд╕ рдХреЛрдИ рд╕реБрд░рдХреНрд╖рд╛ рддрдВрддреНрд░ рдирд╣реАрдВ рд╣реИрдВ... рд╡реЗ OAuth рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдирд╣реАрдВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдкрд░ рдХреЛрдИ рдкреНрд░рднрд╛рд╡ рдирд╣реАрдВ рдбрд╛рд▓рддреЗ рд╣реИрдВ"**](https://cloud.google.com/compute/docs/access/service-accounts#accesscopesiam).

рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд [**рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдХреБрдВрдЬреА**](https://cloud.google.com/iam/docs/creating-managing-service-account-keys) рдкрд╛рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рд╕реАрдорд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ. рдпреЗ **RSA рдирд┐рдЬреА рдХреБрдВрдЬрд┐рдпрд╛рдБ** рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ Google Cloud API рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдФрд░ **рдмрд┐рдирд╛ рд╕реНрдХ
```bash
for i in $(gcloud iam service-accounts list --format="table[no-heading](email)"); do
echo "Looking for keys for $i:"
gcloud iam service-accounts keys list --iam-account $i
done
```
рдпреЗ рдлрд╛рдЗрд▓реЗрдВ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХрдВрдкреНрдпреВрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рд╣реИрдВ**, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрдиреНрд╣реЗрдВ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рднрд╛рдЧреНрдпрд╢рд╛рд▓реА рд╣реЛрдирд╛ рдкрдбрд╝реЗрдЧрд╛ред рдлрд╛рдЗрд▓ рдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдирд╛рдо `[project-id]-[portion-of-key-id].json` рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдЕрдЧрд░ рдЖрдкрдХрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдирд╛рдо `test-project` рд╣реИ рддреЛ рдЖрдк **рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ `test-project*.json` рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЗрд╕ рдХреА рдлрд╛рдЗрд▓ рдХреЛ рдвреВрдВрдврдиреЗ рдХреЗ рд▓рд┐рдПред

рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддреА рд╣реИ:
```json
{
"type": "service_account",
"project_id": "[PROJECT-ID]",
"private_key_id": "[KEY-ID]",
"private_key": "-----BEGIN PRIVATE KEY-----\n[PRIVATE-KEY]\n-----END PRIVATE KEY-----\n",
"client_email": "[SERVICE-ACCOUNT-EMAIL]",
"client_id": "[CLIENT-ID]",
"auth_uri": "https://accounts.google.com/o/oauth2/auth",
"token_uri": "https://accounts.google.com/o/oauth2/token",
"auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
"client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/[SERVICE-ACCOUNT-EMAIL]"
}
```
рдпрд╛, рдпрджрд┐ **CLI рд╕реЗ рдЬрдирд░реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛** рддреЛ рд╡реЗ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдВрдЧреЗ:
```json
{
"name": "projects/[PROJECT-ID]/serviceAccounts/[SERVICE-ACCOUNT-EMAIL]/keys/[KEY-ID]",
"privateKeyType": "TYPE_GOOGLE_CREDENTIALS_FILE",
"privateKeyData": "[PRIVATE-KEY]",
"validAfterTime": "[DATE]",
"validBeforeTime": "[DATE]",
"keyAlgorithm": "KEY_ALG_RSA_2048"
}
```
рдпрджрд┐ рдЖрдк рдЗрдирдореЗрдВ рд╕реЗ рдХреЛрдИ рдлрд╝рд╛рдЗрд▓ рдкрд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **`gcloud` рдХрдорд╛рдВрдб рдХреЛ рдЗрд╕ рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯ рдХреЗ рд╕рд╛рде рдкреБрдирдГ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЖрдк рдпрд╣ рдХрд╛рд░реНрдп рдЙрд╕ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░, рдпрд╛ рдХрд┐рд╕реА рднреА рдорд╢реАрди рдкрд░ рдЬрд┐рд╕ рдкрд░ рдЯреВрд▓реНрд╕ рдЗрдВрд╕реНрдЯреЙрд▓ рд╣реЛрдВ, рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
gcloud auth activate-service-account --key-file [FILE]
```
рдЕрдм рдЖрдк рдЕрдкрдиреЗ рдирдП OAuth рдЯреЛрдХрди рдХрд╛ **рдкрд░реАрдХреНрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЗрд╕ рдкреНрд░рдХрд╛рд░:
```bash
TOKEN=`gcloud auth print-access-token`
curl https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=$TOKEN
```
рдЖрдкрдХреЛ `https://www.googleapis.com/auth/cloud-platform` рд╕реНрдХреЛрдкреНрд╕ рдореЗрдВ рд╕реВрдЪреАрдмрджреНрдз рджрд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдЖрдк **рдХрд┐рд╕реА рднреА рдЗрдВрд╕реНрдЯреЗрдВрд╕-рд╕реНрддрд░ рдХреЗ рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреЛрдкреНрд╕ рд╕реЗ рд╕реАрдорд┐рдд рдирд╣реАрдВ рд╣реИрдВ**ред рдЕрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдЕрдкрдиреЗ рд╕рднреА рдЖрд╡рдВрдЯрд┐рдд IAM рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдкреВрд░реНрдг рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдкреВрд░реА рд╢рдХреНрддрд┐ рд╣реИред

## рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рддрдХрдиреАрдХреЗрдВ

AWS рдореЗрдВ рдЖрдкрдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдВ рд╣реЛрдВ рдЬрд┐рд╕рд╕реЗ рдЖрдк, рдХрд┐рд╕реА рддрд░рд╣, рдЕрдиреНрдп рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛/рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рд╕рдореВрд╣реЛрдВ рдХреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХреЗрдВред рдПрд╕реНрдХреЗрд▓реЗрд╢рдиреНрд╕ рдХреЛ рдЪреЗрди рдХрд░рдирд╛ рдЬрдм рддрдХ рдЖрдкрдХреЛ рд╕рдВрдЧрдарди рдкрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдкрд╣реБрдБрдЪ рди рдорд┐рд▓ рдЬрд╛рдПред

{% hint style="warning" %}
GCP рдореЗрдВ **рд╕реИрдХрдбрд╝реЛрдВ** (рдпрджрд┐ рд╣рдЬрд╛рд░реЛрдВ рдирд╣реАрдВ) **рдЕрдиреБрдорддрд┐рдпрд╛рдВ** рд╣реЛрддреА рд╣реИрдВ рдЬреЛ рдПрдХ рдЗрдХрд╛рдИ рдХреЛ рджреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдЗрд╕ рдкреБрд╕реНрддрдХ рдореЗрдВ рдЖрдк **рд╕рднреА рдЕрдиреБрдорддрд┐рдпрд╛рдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдореИрдВ рдЬрд╛рдирддрд╛ рд╣реВрдБ** рдЬрд┐рдирдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк **рдХреЛрдИ рдкрде рдЬрд╛рдирддреЗ рд╣реИрдВ** рдЬреЛ рдпрд╣рд╛рдБ рдЙрд▓реНрд▓реЗрдЦрд┐рдд рдирд╣реАрдВ рд╣реИ, рддреЛ **рдХреГрдкрдпрд╛ рдЙрд╕реЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ**ред
{% endhint %}

рдЖрдк рд╕рднреА **privesc рдкрдереЛрдВ рдХреЛ рд╕реЗрд╡рд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рднрд╛рдЬрд┐рдд** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

* [**Apikeys Privesc**](gcp-apikeys-privesc.md)
* [**Cloudbuild Privesc**](gcp-cloudbuild-privesc.md)
* [**Cloudfunctions Privesc**](gcp-cloudfunctions-privesc.md)
* [**Cloudscheduler Privesc**](gcp-cloudscheduler-privesc.md)
* [**Compute Privesc**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/)
* [**Composer Privesc**](gcp-composer-privesc.md)
* [**Container Privesc**](gcp-container-privesc.md)
* [**Deploymentmanager Privesc**](gcp-deploymentmaneger-privesc.md)
* [**IAM Privesc**](gcp-iam-privesc.md)
* [**KMS Privesc**](gcp-kms-privesc.md)
* [**Orgpolicy Privesc**](gcp-orgpolicy-privesc.md)
* [**Pubsub Privesc**](gcp-pubsub-privesc.md)
* [**Resourcemanager Privesc**](gcp-resourcemanager-privesc.md)
* [**Run Privesc**](gcp-run-privesc.md)
* [**Secretmanager Privesc**](gcp-secretmanager-privesc.md)
* [**Serviceusage Privesc**](gcp-serviceusage-privesc.md)
* [**Source Repos Privesc**](gcp-sourcerepos-privesc.md)
* [**Storage Privesc**](gcp-storage-privesc.md)
* [**Misc Privesc**](gcp-misc-perms-privesc.md)

### GCP рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХрд░рдирд╛

рдпрджрд┐ рдЖрдк GCP рдореЗрдВ рдХрд┐рд╕реА рдорд╢реАрди рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ рддреЛ рдЖрдк рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рднреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)
* [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/#gcp-privesc-scanner)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**
* **HackTricks** рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
