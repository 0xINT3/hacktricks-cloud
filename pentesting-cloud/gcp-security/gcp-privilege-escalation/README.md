# GCP - Ανέβασμα Προνομίων

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Εισαγωγή στο Ανέβασμα Προνομίων στο GCP <a href="#introduction-to-gcp-privilege-escalation" id="introduction-to-gcp-privilege-escalation"></a>

Το GCP, όπως και οποιοδήποτε άλλο cloud, έχει κάποιους **κύριους χρήστες**: χρήστες, ομάδες και λογαριασμούς υπηρεσίας, και κάποιους **πόρους** όπως μηχανή υπολογισμού, λειτουργίες cloud...\
Στη συνέχεια, μέσω των ρόλων, **παρέχονται άδειες σε αυτούς τους κύριους χρήστες για τους πόρους**. Αυτός είναι ο τρόπος να καθορίσετε τις άδειες που έχει ένας κύριος χρήστης για έναν πόρο στο GCP.\
Υπάρχουν ορισμένες άδειες που θα επιτρέψουν σε έναν χρήστη να **αποκτήσει ακόμα περισσότερες άδειες** για τον πόρο ή για πόρους τρίτων, και αυτό αποκαλείται **ανέβασμα προνομίων** (επίσης, η εκμετάλλευση των ευπαθειών για να αποκτήσετε περισσότερες άδειες).

Για τον λόγο αυτό, θα ήθελα να χωρίσω τις τεχνικές ανέβασης προνομίων του GCP σε **2 ομάδες**:

* **Ανέβασμα προνομίων σε έναν κύριο χρήστη**: Αυτό θα σας επιτρέψει να **προσωποποιήσετε έναν άλλον κύριο χρήστη**, και επομένως να ενεργήσετε ως αυτός με όλες τις άδειές του. π.χ.: Κατάχρηση της _getAccessToken_ για να προσωποποιήσετε έναν λογαριασμό υπηρεσίας.
* **Ανέβασμα προνομίων στον πόρο**: Αυτό θα σας επιτρέψει να **αποκτήσετε περισσότερες άδειες για τον συγκεκριμένο πόρο**. π.χ.: μπορείτε να καταχραστείτε την άδεια _setIamPolicy_ για τις cloud functions για να σας επιτρέψει να ενεργοποιήσετε τη λειτουργία.
* Σημειώστε ότι ορισμένες **άδειες πόρων θα σας επιτρέψουν επίσης να συνδέσετε έναν αυθαίρετο λογαριασμό υπηρεσίας** στον πόρο. Αυτό σημαίνει ότι θα μπορείτε να ξεκινήσετε έναν πόρο με έναν SA, να μπείτε στον πόρο και να **κλέψετε το διακριτικό του SA**. Επομένως, αυτό θα σας επιτρέψει να ανεβείτε σε έναν κύριο χρήστη μέσω ανέβασμα προνομίων σε πόρο. Αυτό έχει συμβεί σε αρκετούς πόρους προηγουμένως, αλλά τώρα συμβαίνει λιγότερο συχνά (αλλά μπορεί ακόμα να συμβεί).

Φυσικά, οι πιο ενδιαφέρουσες τεχνικές ανέβασης προνομίων είναι αυτές της **δεύτερης ομάδας**, επειδή θα σας επιτρέψουν να **αποκτήσετε περισσότερα προνόμια έξω από τους πόρους για τους οποίους ήδη έχετε κάποια προνόμια**. Ωστόσο, σημειώστε ότι η **ανέβαση σε πόρους** μπορεί επίσης να σας δώσει πρόσβαση σε **ευαίσθητες πληροφορίες** ή ακόμα και σε **άλλους κύριους χρήστες** (ίσως μέσω της ανάγνωσης ενός μυστικού που περιέχει ένα διακριτικό ενός SA).

{% hint style="warning" %}
Είναι σημαντικό να σημειωθεί επίσης ότι στο **GCP οι λογαριασμοί υπηρεσίας είναι ταυτόχρονα κ
```bash
for i in $(gcloud iam service-accounts list --format="table[no-heading](email)"); do
echo "Looking for keys for $i:"
gcloud iam service-accounts keys list --iam-account $i
done
```
## Τεχνικές Ανέλιξης Προνομίων

Ο τρόπος για να αναβαθμίσετε τα προνόμιά σας στο GCP είναι να έχετε αρκετές άδειες για να μπορείτε, κατά κάποιον τρόπο, να έχετε πρόσβαση στα προνόμια άλλων λογαριασμών/χρηστών/ομάδων. Αλυσιδώνοντας τις αναβαθμίσεις μέχρι να έχετε διαχειριστική πρόσβαση στον οργανισμό.

{% hint style="warning" %}
Το GCP έχει **εκατοντάδες** (αν όχι χιλιάδες) **άδειες** που μπορεί να χορηγηθεί σε ένα οντότητα. Σε αυτό το βιβλίο μπορείτε να βρείτε **όλες τις άδειες που γνωρίζω** που μπορείτε να καταχραστείτε για να **αναβαθμίσετε προνόμια**, αλλά αν **γνωρίζετε κάποιον άλλον τρόπο** που δεν αναφέρεται εδώ, **μοιραστείτε τον**.
{% endhint %}

**Οι υποσελίδες αυτής της ενότητας είναι ταξινομημένες ανά υπηρεσίες. Μπορείτε να βρείτε σε κάθε υπηρεσία διάφορους τρόπους για να αναβαθμίσετε προνόμια στις υπηρεσίες.**

### Κατάχρηση του GCP για την αναβάθμιση προνομίων τοπικά

Αν βρίσκεστε μέσα σε μια μηχανή στο GCP, μπορεί να μπορείτε να καταχραστείτε άδειες για να αναβαθμίσετε προνόμια ακόμα και τοπικά:

{% content-ref url="gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

## Αναφορές

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)
* [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/#gcp-privesc-scanner)
* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
