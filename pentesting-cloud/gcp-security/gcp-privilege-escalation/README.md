# GCP - 特权升级

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 PDF 版的 HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>

## GCP 特权升级简介 <a href="#introduction-to-gcp-privilege-escalation" id="introduction-to-gcp-privilege-escalation"></a>

GCP，像其他任何云服务一样，有一些**主体**：用户、组和服务帐户，以及一些**资源**，如计算引擎、云函数...\
然后，通过角色，**为这些主体授予资源上的权限**。这是在 GCP 中指定主体对资源拥有的权限的方式。\
有一些权限将允许用户在资源或第三方资源上**获得更多权限**，这就是所谓的**特权升级**（还有利用漏洞获得更多权限的行为）。

因此，我想将 GCP 特权升级技术分为**两组**：

* **升级到主体**：这将允许您**冒充另一个主体**，从而以其所有权限行事。例如：滥用 _getAccessToken_ 以冒充服务帐户。
* **升级到资源**：这将允许您**获得对特定资源的更多权限**。例如：您可以滥用云函数上的 _setIamPolicy_ 权限，以允许您触发该函数。
* 请注意，某些**资源权限还将允许您将任意服务帐户附加到资源**上。这意味着您将能够使用 SA 启动资源，进入资源，并**窃取 SA 令牌**。因此，这将允许通过资源升级升级到主体。这在以前的几个资源中发生过，但现在发生的频率较低（但仍然可能发生）。

显然，最有趣的特权升级技术是**第二组**的技术，因为它将允许您在**已经拥有某些权限的资源之外获得更多特权**。但是，请注意，**升级资源**可能还会让您访问**敏感信息**，甚至访问**其他主体**（可能通过读取包含 SA 令牌的密钥）。

{% hint style="warning" %}
还要注意，在**GCP 服务帐户既是主体又是权限**，因此在 SA 中提升权限也将允许您冒充它。
{% endhint %}

{% hint style="info" %}
括号中的权限指示使用 `gcloud` 漏洞利用所需的权限。如果通过 API 利用，则可能不需要这些权限。
{% endhint %}

## 特权升级方法的权限

这是我在 GCP 中**测试特定权限**以执行特定操作的方法。

1. 下载 github 仓库 [https://github.com/carlospolop/gcp\_privesc\_scripts](https://github.com/carlospolop/gcp\_privesc\_scripts)
2. 在 tests/ 中添加新的脚本&#x20;

## 特权升级技术

在 AWS 中，提升特权的方法是拥有足够的权限，以便以某种方式访问其他服务帐户/用户/组的权限。链接升级，直到您对组织拥有管理员访问权限。

{% hint style="warning" %}
GCP 有**数百**（如果不是数千）个**权限**可以授予实体。在本书中，您可以找到我所知道的所有可以滥用以**提升特权**的权限，但如果您**知道一些未在此处提及**的路径，请**分享出来**。
{% endhint %}

您可以按服务找到所有**特权升级路径**：

* [**Apikeys 特权升级**](gcp-apikeys-privesc.md)
* [**Cloudbuild 特权升级**](gcp-cloudbuild-privesc.md)
* [**Cloudfunctions 特权升级**](gcp-cloudfunctions-privesc.md)
* [**Cloudscheduler 特权升级**](gcp-cloudscheduler-privesc.md)
* [**Compute 特权升级**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/)
* [**Composer 特权升级**](gcp-composer-privesc.md)
* [**Container 特权升级**](gcp-container-privesc.md)
* [**Deploymentmanager 特权升级**](gcp-deploymentmaneger-privesc.md)
* [**IAM 特权升级**](gcp-iam-privesc.md)
* [**KMS 特权升级**](gcp-kms-privesc.md)
* [**Orgpolicy 特权升级**](gcp-orgpolicy-privesc.md)
* [**Pubsub 特权升级**](gcp-pubsub-privesc.md)
* [**Resourcemanager 特权升级**](gcp-resourcemanager-privesc.md)
* [**Run 特权升级**](gcp-run-privesc.md)
* [**Secretmanager 特权升级**](gcp-secretmanager-privesc.md)
* [**Serviceusage 特权升级**](gcp-serviceusage-privesc.md)
* [**Source Repos 特权升级**](gcp-sourcerepos-privesc.md)
* [**Storage 特权升级**](gcp-storage-privesc.md)
* [**Misc 特权升级**](gcp-misc-perms-privesc.md)
### 滥用GCP以本地提升权限

如果您在GCP中的一台机器上，您可能能够滥用权限以在本地提升权限：

{% content-ref url="gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

## 参考资料

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)
* [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/#gcp-privesc-scanner)

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版本的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的动态 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>
