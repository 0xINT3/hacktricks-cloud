# GCP - Cloudfunctions Privesc

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ рдлрд╝реЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>

## cloudfunctions

### `cloudfunctions.functions.create` , `iam.serviceAccounts.actAs`

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ **рдПрдХ рдирдпрд╛ рдХреНрд▓рд╛рдЙрдб рдлрдВрдХреНрд╢рди рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛** рд╣реИ рдЬрд┐рд╕реЗ рд╣рдо рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред рдХреНрдпреЛрдВрдХрд┐ рдХреНрд▓рд╛рдЙрдб рдлрдВрдХреНрд╢рди рдЕрд╡рд╛рд╣рдиреЛрдВ рдХреЗ **рдореЗрдЯрд╛рдбреЗрдЯрд╛ API рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛрддреА рд╣реИ**, рд╣рдо рдЗрд╕рд╕реЗ рд╕реАрдзреЗ рдПрдХ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рдХрдВрдкреНрдпреВрдЯ рдЗрдВрдЬрди рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд░ред

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП **рдЖрд╡рд╢реНрдпрдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИрдВ:

* _cloudfunctions.functions.call_ **рдпрд╛** _cloudfunctions.functions.setIamPolicy_
* _cloudfunctions.functions.create_
* _cloudfunctions.functions.sourceCodeSet_
* _iam.serviceAccounts.actAs_

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкрд╣рд▓реЗ рд╕реЗ рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рдХреНрд▓рд╛рдЙрдб рдлрдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ GitHub рдкрд░ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рд╕рдВрдмрдВрдзрд┐рдд .zip рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рдиреА рд╣реЛрдЧреА рдФрд░ рдЗрд╕реЗ рдХреНрд▓рд╛рдЙрдб рд╕реНрдЯреЛрд░реЗрдЬ рдкрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ (рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЙрддреНрдкрд╛рджрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреЗрдЦреЗрдВ)ред рдПрдХ рдмрд╛рд░ рдлрд╝рдВрдХреНрд╢рди рдмрдирд╛рдпрд╛ рдФрд░ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЖрдк рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕реАрдзреЗ рдЕрд╡рд╛рд╣рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЖрдк рдЗрд╕реЗ рдЕрд╡рд╛рд╣рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП IAM рдиреАрддрд┐ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЙрд╕ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП рд░рдЦреЗ рдЧрдП рдкрд╣реБрдВрдЪ рдЯреЛрдХрди рд╢рд╛рдорд┐рд▓ рд╣реЛрдЧрд╛ред

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image12-750x618.png)

рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдлрд╝рдВрдХреНрд╢рди рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдбрд┐рдкреНрд▓реЙрдп рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ, рдлрд┐рд░ рдЗрд╕реЗ рдЪрд▓рд╛рддрд╛ рд╣реИ рдФрд░ рдкрд╣реБрдВрдЪ рдЯреЛрдХрди рд╡рд╛рдкрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдЙрддреНрдкрд╛рджрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ [рдпрд╣рд╛рдВ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.create-call.py) рдФрд░ [рдпрд╣рд╛рдВ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.create-setIamPolicy.py) рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдкрд╣рд▓реЗ рд╕реЗ рддреИрдпрд╛рд░ .zip рдлрд╝рд╛рдЗрд▓ [рдпрд╣рд╛рдВ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/tree/master/ExploitScripts/CloudFunctions) рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

### `cloudfunctions.functions.update` , `iam.serviceAccounts.actAs`

_cloudfunctions.functions.create_ рдХреА рддрд░рд╣, рдЗрд╕ рд╡рд┐рдзрд┐ рдореЗрдВ **рдПрдХ рдореМрдЬреВрджрд╛ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЕрджреНрдпрддрди (рдЕрдзрд┐рд▓реЗрдЦрд┐рдд) рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдмрдЬрд╛рдп рдПрдХ рдирдпрд╛ рдмрдирд╛рдиреЗ рдХреЗ**ред рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЕрджреНрдпрддрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА API рдЖрдкрдХреЛ **рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдиреНрдп рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рднреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ**ред рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд▓рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХреЛ рджреБрд╖реНрдкреНрд░рднрд╛рд╡реА рдХреЛрдб рдХреЗ рд╕рд╛рде рдЕрджреНрдпрддрди рдХрд░реЗрдЧрд╛, рдлрд┐рд░ рдЗрд╕реЗ рдбрд┐рдкреНрд▓реЙрдп рд╣реЛрдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдЧрд╛, рдФрд░ рдЕрдВрдд рдореЗрдВ рдЗрд╕реЗ рдЕрд╡рд╛рд╣рди рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдкрд╣реБрдВрдЪ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗред

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд **рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЖрд╡рд╢реНрдпрдХ** рд╣реИрдВ:

* _cloudfunctions.functions.sourceCodeSet_
* _cloudfunctions.functions.update_
* _iam.serviceAccounts.actAs_

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдЙрддреНрдкрд╛рджрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ [рдпрд╣рд╛рдВ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.update.py) рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИред

### `cloudfunctions.functions.setIamPolicy` , `iam.serviceAccounts.actAs`

рдкрд╣рд▓реЗ .update рдпрд╛ .create рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рднреА рдХреЛ рдЦреБрдж рдХреЛ рдЙрдиреНрдирдпрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреЗрдВред

### рдмрдХреЗрдЯ рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рдХреНрд▓рд╛рдЙрдб рдлрдВрдХреНрд╢рди рдХреЛрдб рд╕рдВрдЧреНрд░рд╣ рдХреЗ рдмрдХреЗрдЯ рдкрд░ **рд▓реЗрдЦрди рдЕрдиреБрдорддрд┐** рд╡рд╛рд▓реЗ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдпрд╣ рдХреНрд╖рдорддрд╛ рд╣реЛрдЧреА рдХрд┐ рд╡рд╣ рдХреЛрдб рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ `function_code.zip` рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░ рд╕рдХреЗ рдФрд░ рдПрдХ рдмрд╛рд░ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП, рд╡рд╣ рдЗрдЪреНрдЫрд╛рдиреБрд╕рд╛рд░ рдХреЛрдб **рдЕрднрд┐рдкреНрд░реЗрдд** рдХрд░ рд╕рдХреЗрдЧрд╛ред

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░
