# GCP - Ανέβασμα Προνομιακών Δικαιωμάτων στις Cloud Functions

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## cloudfunctions

Περισσότερες πληροφορίες για τις Cloud Functions:

{% content-ref url="../../gcp-pentesting/gcp-services/gcp-cloud-functions-enum.md" %}
[gcp-cloud-functions-enum.md](../../gcp-pentesting/gcp-services/gcp-cloud-functions-enum.md)
{% endcontent-ref %}

### `cloudfunctions.functions.create` , `cloudfunctions.functions.sourceCodeSet`_,_ `iam.serviceAccounts.actAs`

Ένας επιτιθέμενος με αυτά τα προνόμια μπορεί να **δημιουργήσει μια νέα Cloud Function με αυθαίρετο (κακόβουλο) κώδικα και να της αναθέσει έναν Λογαριασμό Υπηρεσίας**. Στη συνέχεια, μπορεί να διαρρεύσει το διακριτικό του Λογαριασμού Υπηρεσίας από τα μεταδεδομένα για να αναβαθμίσει τα προνόμιά του σε αυτόν.\
Μπορεί να απαιτηθούν κάποια προνόμια για να ενεργοποιηθεί η συνάρτηση.

Τα scripts εκμετάλλευσης για αυτήν τη μέθοδο μπορούν να βρεθούν [εδώ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.create-call.py) και [εδώ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.create-setIamPolicy.py) και το προεγκατεσκευασμένο αρχείο .zip μπορεί να βρεθεί [εδώ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/tree/master/ExploitScripts/CloudFunctions).

### `cloudfunctions.functions.update` , `cloudfunctions.functions.sourceCodeSet`_,_ `iam.serviceAccounts.actAs`

Ένας επιτιθέμενος με αυτά τα προνόμια μπορεί να **τροποποιήσει τον κώδικα μιας Συνάρτησης και ακόμα και να τροποποιήσει τον συνδεδεμένο λογαριασμό υπηρεσίας** με σκοπό τη διαρροή του διακριτικού.\
Μπορεί να απαιτηθούν κάποια προνόμια για να ενεργοποιηθεί η συνάρτηση.

Το script εκμετάλλευσης για αυτήν τη μέθοδο μπορεί να βρεθεί [εδώ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.update.py).

### `cloudfunctions.functions.sourceCodeSet`

Με αυτήν την άδεια μπορείτε να λάβετε ένα **υπογεγραμμένο URL για να μπορείτε να ανεβάσετε ένα αρχείο σε ένα κάδο συνάρτησης (αλλά ο κώδικας της συνάρτησης δεν θα αλλάξει, πρέπει ακόμα να τον ενημερώσετε)**

{% code overflow="wrap" %}
```bash
# Generate the URL
curl -X POST https://cloudfunctions.googleapis.com/v2/projects/{project-id}/locations/{location}/functions:generateUploadUrl \
-H "Authorization: Bearer $(gcloud auth application-default print-access-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
{% endcode %}

Δεν είμαι σίγουρος πόσο χρήσιμη είναι αυτή η άδεια από την οπτική γωνία του επιτιθέμενου, αλλά είναι καλό να το γνωρίζετε.

### `cloudfunctions.functions.setIamPolicy`, `iam.serviceAccounts.actAs`

Δώστε στον εαυτό σας οποιαδήποτε από τις προηγούμενες προνομιούχες **`.update`** ή **`.create`** για να αναβαθμίσετε.

### `cloudfunctions.functions.update`

Έχοντας μόνο τα δικαιώματα **`cloudfunctions`**, χωρίς το **`iam.serviceAccounts.actAs`**, δεν θα μπορείτε να ενημερώσετε τη λειτουργία, οπότε αυτό δεν είναι έγκυρο προνόμιο.

### Δικαιώματα Εγγραφής Κάδου

Ένας επιτιθέμενος με **δικαιώματα εγγραφής στον κάδο** όπου αποθηκεύεται ο κώδικας των Cloud Functions θα μπορεί να τροποποιήσει τον κώδικα αντικαθιστώντας το `function_code.zip` και θα μπορεί να εκτελέσει **οποιονδήποτε κώδικα** μόλις αυτός εκτελεστεί.

## Αναφορές

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
