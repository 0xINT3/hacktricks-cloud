# GCP - Ukarabati wa Mamlaka ya Cloudfunctions

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## cloudfunctions

Maelezo zaidi kuhusu Cloud Functions:

{% content-ref url="../../gcp-pentesting/gcp-services/gcp-cloud-functions-enum.md" %}
[gcp-cloud-functions-enum.md](../../gcp-pentesting/gcp-services/gcp-cloud-functions-enum.md)
{% endcontent-ref %}

### `cloudfunctions.functions.create` , `cloudfunctions.functions.sourceCodeSet`_,_ `iam.serviceAccounts.actAs`

Mshambuliaji mwenye mamlaka hizi anaweza **kuunda Cloud Function mpya na nambari (malicious) isiyojulikana na kumwidhinisha Akaunti ya Huduma**. Kisha, kuvuja kwa token ya Akaunti ya Huduma kutoka kwa metadata kuongeza mamlaka kwake.\
Baadhi ya mamlaka ya kuzindua kazi inaweza kuhitajika.

Mipango ya kudukua kwa njia hii inaweza kupatikana [hapa](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.create-call.py) na [hapa](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.create-setIamPolicy.py) na faili ya .zip iliyoundwa mapema inaweza kupatikana [hapa](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/tree/master/ExploitScripts/CloudFunctions).

### `cloudfunctions.functions.update` , `cloudfunctions.functions.sourceCodeSet`_,_ `iam.serviceAccounts.actAs`

Mshambuliaji mwenye mamlaka hizi anaweza **kurekebisha nambari ya Kazi na hata kurekebisha akaunti ya huduma iliyowekwa** lengo likiwa ni kuvuja kwa token.\
Baadhi ya mamlaka ya kuzindua kazi inaweza kuhitajika.

Mipango ya kudukua kwa njia hii inaweza kupatikana [hapa](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.update.py).

### `cloudfunctions.functions.sourceCodeSet`

Kwa idhini hii unaweza kupata **URL iliyosainiwa ili uweze kupakia faili kwenye sanduku la kazi (lakini nambari ya kazi haitabadilishwa, bado unahitaji kuisasisha)**

{% code overflow="wrap" %}
```bash
# Generate the URL
curl -X POST https://cloudfunctions.googleapis.com/v2/projects/{project-id}/locations/{location}/functions:generateUploadUrl \
-H "Authorization: Bearer $(gcloud auth application-default print-access-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
{% endcode %}

Si hakika jinsi idhini hii pekee inavyoweza kuwa muhimu kutoka mtazamo wa mshambuliaji, lakini ni vizuri kujua.

### `cloudfunctions.functions.setIamPolicy`, `iam.serviceAccounts.actAs`

Jipatie mojawapo ya **idhini za awali za `.update`** au **`.create`** kwa kujipandisha cheo.

### `cloudfunctions.functions.update`

Kwa kuwa na idhini za **`cloudfunctions`** pekee, bila **`iam.serviceAccounts.actAs`** hutaweza **kusasisha kazi HIVYO HII SI KUJIPANDISHA CHEO KWA HALALI.**

### Idhini za Kuandika Kwenye Bucket

Mshambuliaji mwenye **idhini za kuandika kwenye bucket** ambapo msimbo wa Cloud Functions unahifadhiwa ataweza **kurekebisha msimbo kwa kuandika juu** ya `function_code.zip` na ataweza **kutekeleza msimbo wa aina yoyote** mara tu unapotekelezwa.

## Marejeo

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi mtaalamu na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
