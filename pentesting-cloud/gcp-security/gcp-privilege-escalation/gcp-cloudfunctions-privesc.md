# GCP - Cloudfunksies Privesc

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat** Kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## cloudfunksies

Meer inligting oor Cloudfunksies:

{% content-ref url="../../gcp-pentesting/gcp-services/gcp-cloud-functions-enum.md" %}
[gcp-cloud-functions-enum.md](../../gcp-pentesting/gcp-services/gcp-cloud-functions-enum.md)
{% endcontent-ref %}

### `cloudfunksies.funksies.skep` , `cloudfunksies.funksies.bronKodeStel`_,_ `iam.serviceAccounts.optreeAs`

'n Aanvaller met hierdie bevoegdhede kan **'n nuwe Cloudfunksie met willekeurige (skadelike) kode skep en dit 'n Diensrekening toewys**. Vervolgens kan die Diensrekening-token uit die metadata gelek word om voorregte daaraan te verhoog.\
Sommige voorregte om die funksie te aktiveer, mag vereis word.

Exploit-skripte vir hierdie metode kan [hier](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.create-call.py) en [hier](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.create-setIamPolicy.py) gevind word en die voorafgeboude .zip-l√™er kan [hier](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/tree/master/ExploitScripts/CloudFunctions) gevind word.

### `cloudfunksies.funksies.opdateer` , `cloudfunksies.funksies.bronKodeStel`_,_ `iam.serviceAccounts.optreeAs`

'n Aanvaller met hierdie bevoegdhede kan **die kode van 'n Funksie wysig en selfs die diensrekening wat daaraan geheg is, wysig** met die doel om die token uit te lek.\
Sommige voorregte om die funksie te aktiveer, mag vereis word.

Die exploit-skrip vir hierdie metode kan [hier](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudfunctions.functions.update.py) gevind word.

### `cloudfunksies.funksies.bronKodeStel`

Met hierdie toestemming kan jy 'n **ondertekende URL kry om 'n l√™er na 'n funksie-emmer te kan oplaai (maar die kode van die funksie sal nie verander word nie, jy moet dit steeds opdateer)**

{% code overflow="wrap" %}
```bash
# Generate the URL
curl -X POST https://cloudfunctions.googleapis.com/v2/projects/{project-id}/locations/{location}/functions:generateUploadUrl \
-H "Authorization: Bearer $(gcloud auth application-default print-access-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
{% endcode %}

Nie seker hoe nuttig hierdie toestemming is vanuit 'n aanvaller se perspektief nie, maar goed om te weet.

### `cloudfunctions.functions.setIamPolicy`, `iam.serviceAccounts.actAs`

Gee jouself enige van die vorige **`.update`** of **`.create`** voorregte om te eskaleer.

### `cloudfunctions.functions.update`

Slegs die besit van **`cloudfunctions`** toestemmings, sonder **`iam.serviceAccounts.actAs`**, sal jy **nie in staat wees om die funksie by te werk NIE DIT IS NIE 'N GELDIGE PRIVILEGE-ESKALASIE NIE.**

### Emmertoegangsregte

'n Aanvaller met **skryftoestemmings oor die emmer** waar die Cloud Functions-kode gestoor word, sal in staat wees om die kode te **verander deur die `function_code.zip` te oorskryf** en sal in staat wees om **arbitr√™re** kode uit te voer sodra dit uitgevoer word.

## Verwysings

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien jou **maatskappy geadverteer in HackTricks** of **HackTricks aflaai in PDF-formaat** Kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
