# GCP - IAM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХрд╛ рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos** рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>

## IAM

### `iam.roles.update` (`iam.roles.get`)

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ, рддреЛ рдЖрдк рдЕрдкрдиреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реБрдкрд┐рдд рдПрдХ рднреВрдорд┐рдХрд╛ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХреЗрдВрдЧреЗ рдФрд░ рдЖрдкрдХреЛ рдЕрдиреНрдп рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗ рд╕рдХреЗрдВрдЧреЗ, рдЬреИрд╕реЗ:
```bash
gcloud iam roles update <rol name> --project <project> --add-permissions <permission>
```
рдЖрдк рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдпрд╣рд╛рдБ рдкрд╛рдПрдВрдЧреЗ рдЬреЛ рдПрдХ vuln environment рдХреЗ рдирд┐рд░реНрдорд╛рдг, рдЙрдкрдпреЛрдЧ рдФрд░ рд╕рдлрд╛рдИ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ python рд╕реНрдХреНрд░рд┐рдкреНрдЯ [рдпрд╣рд╛рдБ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.roles.update.py) рдкрд╛рдПрдВрдЧреЗред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [рдореВрд▓ рд╢реЛрдз](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/) рджреЗрдЦреЗрдВред

### `iam.serviceAccounts.getAccessToken` (`iam.serviceAccounts.get`)

рдпрд╣ рдЕрдиреБрдорддрд┐ рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдорд╛рд░реЗ рд╕реЗ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рд╡рд╛рд▓реЗ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХрд╛ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдЕрдиреБрд░реЛрдз рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИред

рдЖрдк рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдпрд╣рд╛рдБ рдкрд╛рдПрдВрдЧреЗ рдЬреЛ рдПрдХ vuln environment рдХреЗ рдирд┐рд░реНрдорд╛рдг, рдЙрдкрдпреЛрдЧ рдФрд░ рд╕рдлрд╛рдИ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ [рдпрд╣рд╛рдБ](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/4-iam.serviceAccounts.getAccessToken.sh) рдФрд░ рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ python рд╕реНрдХреНрд░рд┐рдкреНрдЯ [рдпрд╣рд╛рдБ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.getAccessToken.py) рдкрд╛рдПрдВрдЧреЗред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [рдореВрд▓ рд╢реЛрдз](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/) рджреЗрдЦреЗрдВред

### `iam.serviceAccountKeys.create`

рдпрд╣ рдЕрдиреБрдорддрд┐ рд╣рдореЗрдВ рдкрд┐рдЫрд▓реА рд╡рд┐рдзрд┐ рдХреЗ рддреБрд▓рдирд╛ рдореЗрдВ рдХреБрдЫ рд╕рдорд╛рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХреА рдмрдЬрд╛рдп рд╣рдо рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рдкреНрд░рдмрдВрдзрд┐рдд рдХреБрдВрдЬреА рдмрдирд╛ рд░рд╣реЗ рд╣реИрдВ, рдЬреЛ рд╣рдореЗрдВ рдЙрд╕ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд░реВрдк рдореЗрдВ GCP рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧреАред
```bash
gcloud iam service-accounts keys create --iam-account <name> /tmp/key.json

gcloud auth activate-service-account --key-file=sa_cred.json
```
рдЖрдк рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдпрд╣рд╛рдБ рд╕реЗ рд╡рдиреНрдп рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд╕реГрдЬрди, рдЙрдкрдпреЛрдЧ рдФрд░ рд╕рдлрд╛рдИ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ [**рдпрд╣рд╛рдБ**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/3-iam.serviceAccountKeys.create.sh) рдФрд░ рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрд╛рдпрдерди рд╕реНрдХреНрд░рд┐рдкреНрдЯ [**рдпрд╣рд╛рдБ**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccountKeys.create.py)ред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд╢реЛрдз**](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/) рджреЗрдЦреЗрдВред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`iam.serviceAccountKeys.update`** рдПрдХ рдПрд╕рдП рдХреА рдХреБрдВрдЬреА рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ `iam.serviceAccountKeys.create` рднреА рдЪрд╛рд╣рд┐рдП рд╣реЛрддреА рд╣реИред

### `iam.serviceAccounts.implicitDelegation`

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдкрд░ **`iam.serviceAccounts.getAccessToken`** рдЕрдиреБрдорддрд┐ рд╡рд╛рд▓реЗ рддреАрд╕рд░реЗ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдкрд░ **`iam.serviceAccounts.implicitDelegation`** рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рдЖрдк implicitDelegation рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЙрд╕ рддреАрд╕рд░реЗ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП рдЯреЛрдХрди рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдпрд╣рд╛рдБ рдПрдХ рдЖрд░реЗрдЦ рд╣реИ рдЬреЛ рд╕реНрдкрд╖реНрдЯ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image2-500x493.png)

рдЖрдк рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдпрд╣рд╛рдБ рд╕реЗ рд╡рдиреНрдп рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд╕реГрдЬрди, рдЙрдкрдпреЛрдЧ рдФрд░ рд╕рдлрд╛рдИ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ [**рдпрд╣рд╛рдБ**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/5-iam.serviceAccounts.implicitDelegation.sh) рдФрд░ рдЗрд╕ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрд╛рдпрдерди рд╕реНрдХреНрд░рд┐рдкреНрдЯ [**рдпрд╣рд╛рдБ**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.implicitDelegation.py)ред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рд╢реЛрдз**](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/) рджреЗрдЦреЗрдВред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ [**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг**](https://cloud.google.com/iam/docs/understanding-service-accounts) рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдзреНрдпрд╛рди
```bash
gcloud iam service-accounts add-iam-policy-binding "${VICTIM_SA}@${PROJECT_ID}.iam.gserviceaccount.com" \
--member="user:username@domain.com" \
--role="roles/iam.serviceAccountTokenCreator"
```
рдЖрдк рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ vuln environment рдХреЗ рдирд┐рд░реНрдорд╛рдг, рдЙрдкрдпреЛрдЧ рдФрд░ рд╕рдлрд╛рдИ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдВ рд╣реИред

### `iam.serviceAccounts.actAs`

рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХреБрдЫ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рджреМрд░рд╛рди, рдЖрдкрдХреЛ рдХреЙрд▓ рдХреЛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд░реВрдк рдореЗрдВ "actAs" рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдирдпрд╛ Compute Engine рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╢реБрд░реВ рдХрд░рддреЗ рд╕рдордп рдПрдХ рд╕рдВрд▓рдЧреНрди рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд╕рд╛рде, рдЖрдкрдХреЛ рдЙрд╕ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдкрд░ **`iam.serviceAccounts.actAs`** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЗрд╕рд▓рд┐рдП рдмрд┐рдирд╛ рдЙрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрдо рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред

**рдЗрд╕рдореЗрдВ рдХрдИ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╡рд┐рдзрд┐рдпрд╛рдБ рд╣реИрдВ рдЬреЛ \_iam.serviceAccounts.actAs**\_** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреА рдЕрдкрдиреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдХреЗрд╡рд▓ рдЗрдирдореЗрдВ рд╕реЗ рдПрдХ (рдпрд╛ рдЕрдзрд┐рдХ) рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдпреЗ рд╡рд┐рдзрд┐рдпрд╛рдБ рдереЛрдбрд╝реА рдЕрд▓рдЧ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдЗрдиреНрд╣реЗрдВ **рдПрдХрд▓ рдЕрдиреБрдорддрд┐ рдХреА рдмрдЬрд╛рдп рдХрдИ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ** рдЬреИрд╕реЗ рдХрд┐ рдкрд┐рдЫрд▓реА рд╡рд┐рдзрд┐рдпреЛрдВ рдореЗрдВред

### `iam.serviceAccounts.getOpenIdToken`

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ OpenID JWT рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпреЗ рдкрд╣рдЪрд╛рди рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдХрд┐рд╕реА рд╕рдВрд╕рд╛рдзрди рдХреЗ рдкреНрд░рддрд┐ рдХреЛрдИ рд╢рд░реНрддрдореБрдХреНрдд рдЕрдзрд┐рдХрд╛рд░рдг рдирд╣реАрдВ рд▓реЗрддреЗ рд╣реИрдВред

рдЗрд╕ [**рджрд┐рд▓рдЪрд╕реНрдк рдкреЛрд╕реНрдЯ**](https://medium.com/google-cloud/authenticating-using-google-openid-connect-tokens-e7675051213b) рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рджрд░реНрд╢рдХ (рд╕реЗрд╡рд╛ рдЬрд╣рд╛рдВ рдЖрдк рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ) рдХреА рд╕реВрдЪрдирд╛ рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдФрд░ рдЖрдкрдХреЛ рдЧреВрдЧрд▓ рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдПрдХ JWT рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдФрд░ JWT рдХреЗ рджрд░реНрд╢рдХ рдХреА рд╕реВрдЪрдирд╛ рд╣реЛрдЧреАред

рдЖрдк рдПрдХ OpenIDToken рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд╣реБрдВрдЪ рд╣реИ) рдЗрд╕рдХреЗ рд╕рд╛рде:
```bash
# First activate the SA with iam.serviceAccounts.getOpenIdToken over the other SA
gcloud auth activate-service-account --key-file=/path/to/svc_account.json
# Then, generate token
gcloud auth print-identity-token "${ATTACK_SA}@${PROJECT_ID}.iam.gserviceaccount.com" --audiences=https://example.com
```
рддрдм рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реЗрд╡рд╛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
curl -v -H "Authorization: Bearer id_token" https://some-cloud-run-uc.a.run.app
```
рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЯреЛрдХрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рдорд░реНрдерд┐рдд рдХреБрдЫ рд╕реЗрд╡рд╛рдПрдВ рд╣реИрдВ:

* [Google Cloud Run](https://cloud.google.com/run/)
* [Google Cloud Functions](https://cloud.google.com/functions/docs/)
* [Google Identity Aware Proxy](https://cloud.google.com/iap/docs/authentication-howto)
* [Google Cloud Endpoints](https://cloud.google.com/endpoints/docs/openapi/authenticating-users-google-id) (рдпрджрд┐ Google OIDC рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ)

рдЖрдк рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдХреЗ рд▓рд┐рдП OpenID рдЯреЛрдХрди рдХреИрд╕реЗ рдмрдирд╛рдПрдВрдЧреЗ рдХрд╛ рдЙрджрд╛рд╣рд░рдг [**рдпрд╣рд╛рдВ**](https://github.com/carlospolop-forks/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.getOpenIdToken.py) рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ рдЯреНрд╡рд┐рдЯрд░ рдкрд░ рдлрд╝реЙрд▓реЛ рдХрд░реЗрдВ** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
