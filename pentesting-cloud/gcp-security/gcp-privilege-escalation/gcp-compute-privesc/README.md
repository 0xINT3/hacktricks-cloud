# GCP - Compute Privilege Escalation

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı takip edin**
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR göndererek paylaşın.

</details>

## Compute

Daha fazla bilgi için GCP'deki Compute ve VPC (ağ) hakkında kontrol edin:

{% content-ref url="../../gcp-services/gcp-compute-instances-enum/" %}
[gcp-compute-instances-enum](../../gcp-services/gcp-compute-instances-enum/)
{% endcontent-ref %}

### `compute.projects.setCommonInstanceMetadata`

Bu izinle bir **örneğin** **metadata** bilgisini **değiştirebilir** ve bir kullanıcının **yetkilendirilmiş anahtarlarını değiştirebilir** veya **sudo yetkilerine sahip yeni bir kullanıcı oluşturabilirsiniz**. Bu nedenle, herhangi bir VM örneğine SSH üzerinden erişebilir ve örneğin çalıştığı GCP Hizmet Hesabını çalabilirsiniz.\
Sınırlamalar:

* VM örneklerinde varsayılan olarak çalışan GCP Hizmet Hesapları **çok sınırlı bir kapsama sahiptir**
* Giriş yapmak için SSH sunucusuna **ulaşabilme yeteneğine sahip olmanız gerekecektir**

Bu izni nasıl sömüreceğiniz hakkında daha fazla bilgi için kontrol edin:

{% content-ref url="gcp-add-custom-ssh-metadata.md" %}
[gcp-add-custom-ssh-metadata.md](gcp-add-custom-ssh-metadata.md)
{% endcontent-ref %}

### `compute.instances.setMetadata`

Bu izin, bir bütün projeye değil, belirli bir örneğe yönelik olarak **önceki izinlerle aynı yetkileri** verir. **Önceki bölümdeki sömürüler ve sınırlamalar geçerlidir**.

### `compute.instances.setIamPolicy`

Bu tür bir izin, **önceki izinlere sahip bir rolü kendinize atama** ve bu izinleri kötüye kullanarak ayrıcalıkları yükseltme olanağı sağlar.

### **`compute.instances.osLogin`**

Eğer örnekte **OSLogin etkinse**, bu izinle sadece **`gcloud compute ssh [INSTANCE]`** komutunu çalıştırarak örneğe bağlanabilirsiniz. Örneğin içinde **root yetkilerine sahip olmayacaksınız**.

### **`compute.instances.osAdminLogin`**

Eğer örnekte **OSLogin etkinse**, bu izinle sadece **`gcloud compute ssh [INSTANCE]`** komutunu çalıştırarak örneğe bağlanabilirsiniz. Örneğin içinde **root yetkilerine sahip olacaksınız**.

### `compute.instances.create`,`iam.serviceAccounts.actAs, compute.disks.create`, `compute.instances.create`, `compute.instances.setMetadata`, `compute.instances.setServiceAccount`, `compute.subnetworks.use`, `compute.subnetworks.useExternalIp`

Bir atanmış Hizmet Hesabı olan bir sanal makine oluşturabilir ve ayrıcalıkları yükseltmek için hizmet hesabının belirteçlerini çalmak için metadata'ya erişebilirsiniz.

Bu yöntemin sömürü betiği [burada](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/compute.instances.create.py) bulunabilir.

### `osconfig.patchDeployments.create` | `osconfig.patchJobs.exec`

**`osconfig.patchDeployments.create`** veya **`osconfig.patchJobs.exec`** izinlerine sahipseniz, [**yama işi veya dağıtımı**](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching) oluşturabilirsiniz. Bu, ortamda yanal hareket etmenizi ve bir projedeki tüm hesaplama örneklerinde kod yürütme yetkisi elde etmenizi sağlar.

Bunu manuel olarak sömürmek isterseniz, ya bir [yama işi](https://github.com/rek7/patchy/blob/main/pkg/engine/patches/patch\_job.json) veya [dağıtım](https://github.com/rek7/patchy/blob/main/pkg/engine/patches/patch\_deployment.json) oluşturmanız gerekecektir:

`gcloud compute os-config patch-jobs execute --file=patch.json`

Bir yama dağıtımı dağıtmak için:

`gcloud compute os-config patch-deployments create my-update --file=patch.json`

[patchy](https://github.com/rek7/patchy) gibi otomatik araçlar, gevşek izinleri tespit etmek ve otomatik olarak yanal hareket etmek için mevcuttur.

**Bu ayrıca kalıcılık için kötüye kullanılabilir.**

### `compute.machineImages.setIamPolicy`

Bilgisayara Ekstra İzinler **verin**.

### `compute.snapshots.setIamPolicy`

Disk snapshot'a Ekstra İzinler **verin**.

### `compute.disks.setIamPolicy`

Diske Ekstra İzinler **verin**.

### Erişim Kapsamlarını Geçme

Bu bağlantıyı takip ederek [**erişim kapsamlarını geçmek için deneyebileceğiniz bazı fikirler**](../../../gcp-security/gcp-privilege-escalation/) bulabilirsiniz.

### Yerel Ayrıcalık Yükseltme GCP Compute örneğinde

{% content-ref url="../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

## Referanslar

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı takip edin**
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR göndererek paylaşın.

</details>
