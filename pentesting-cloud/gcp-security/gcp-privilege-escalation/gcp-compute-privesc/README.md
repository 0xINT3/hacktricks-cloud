# GCP - Rekenaarvoorregverhoging

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy in HackTricks wil adverteer** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-opslagplekke.

</details>

## Rekenaar

Vir meer inligting oor Rekenaars en VPC (netwerk) in GCP, kyk:

{% content-ref url="../../gcp-services/gcp-compute-instances-enum/" %}
[gcp-compute-instances-enum](../../gcp-services/gcp-compute-instances-enum/)
{% endcontent-ref %}

### `compute.projects.setCommonInstanceMetadata`

Met hierdie toestemming kan jy die **metadata-inligting** van 'n **instansie wysig** en die **gemagtigde sleutels van 'n gebruiker verander**, of 'n **nuwe gebruiker met sudo-regte skep**. Jy sal dus in staat wees om via SSH na enige VM-instansie uit te voer en die GCP-diensrekening te steel waarop die instansie loop.\
Beperkings:

* Let daarop dat GCP-diensrekeninge wat standaard in VM-instansies loop, 'n **baie beperkte omvang** het
* Jy sal **in staat moet wees om die SSH-bediener te kontak** om aan te meld

Vir meer inligting oor hoe om hierdie toestemming uit te buit, kyk:

{% content-ref url="gcp-add-custom-ssh-metadata.md" %}
[gcp-add-custom-ssh-metadata.md](gcp-add-custom-ssh-metadata.md)
{% endcontent-ref %}

### `compute.instances.setMetadata`

Hierdie toestemming gee dieselfde voorregte as die vorige toestemming, maar oor 'n spesifieke instansie in plaas van 'n hele projek. Dieselfde uitbuitings en beperkings as vir die vorige afdeling is van toepassing.

### `compute.instances.setIamPolicy`

Hierdie soort toestemming sal jou in staat stel om jouself 'n rol met die vorige toestemmings te **gee en voorregte te verhoog deur dit te misbruik**.

### **`compute.instances.osLogin`**

As **OSLogin geaktiveer is in die instansie**, kan jy met hierdie toestemming eenvoudig **`gcloud compute ssh [INSTANSIE]`** uitvoer en aan die instansie koppel. Jy sal **nie root-voorregte** binne die instansie h√™ nie.

### **`compute.instances.osAdminLogin`**

As **OSLogin geaktiveer is in die instansie**, kan jy met hierdie toestemming eenvoudig **`gcloud compute ssh [INSTANSIE]`** uitvoer en aan die instansie koppel. Jy sal **root-voorregte** binne die instansie h√™.

### `compute.instances.create`,`iam.serviceAccounts.actAs, compute.disks.create`, `compute.instances.create`, `compute.instances.setMetadata`, `compute.instances.setServiceAccount`, `compute.subnetworks.use`, `compute.subnetworks.useExternalIp`

Dit is moontlik om 'n virtuele masjien te **skep met 'n toegewysde Diensrekening en die token daarvan te steel** deur toegang tot die metadata te verkry om voorregte daaraan te verhoog.

Die uitbuitingskrips vir hierdie metode kan [hier](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/compute.instances.create.py) gevind word.

### `osconfig.patchDeployments.create` | `osconfig.patchJobs.exec`

As jy die **`osconfig.patchDeployments.create`** of **`osconfig.patchJobs.exec`** toestemmings het, kan jy 'n [**patch-werk of -implementering**](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching) skep. Dit sal jou in staat stel om lateraal in die omgewing te beweeg en kode-uitvoering op al die rekenaarinstansies binne 'n projek te verkry.

As jy dit handmatig wil uitbuit, moet jy 'n [patch-werk](https://github.com/rek7/patchy/blob/main/pkg/engine/patches/patch\_job.json) of [implementering](https://github.com/rek7/patchy/blob/main/pkg/engine/patches/patch\_deployment.json) vir 'n patch-werk skep:

`gcloud compute os-config patch-jobs execute --file=patch.json`

Om 'n patch-implementering te implementeer:

`gcloud compute os-config patch-deployments create my-update --file=patch.json`

Geoutomatiseerde hulpmiddels soos [patchy](https://github.com/rek7/patchy) bestaan om lakse toestemmings op te spoor en outomaties lateraal te beweeg.

**Jy kan dit ook misbruik vir volharding.**

### `compute.machineImages.setIamPolicy`

**Gee jouself ekstra toestemmings** vir rekenaarbeeld.

### `compute.snapshots.setIamPolicy`

**Gee jouself ekstra toestemmings** vir 'n skyf-snapshot.

### `compute.disks.setIamPolicy`

**Gee jouself ekstra toestemmings** vir 'n skyf.

### Deur toegangsbereike te omseil

Volg hierdie skakel om 'n paar [**idees te vind om toegangsbereike te omseil**](../../../gcp-security/gcp-privilege-escalation/).

### Plaaslike voorregverhoging in GCP Rekenaarinstansie

{% content-ref url="../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

## Verwysings

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy in HackTricks wil adverteer** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-opslagplekke.

</details>
