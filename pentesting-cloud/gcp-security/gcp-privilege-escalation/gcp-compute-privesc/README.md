# GCP - Kuboresha Mamlaka ya Kompyuta

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi kuwa shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Kuboresha Mamlaka ya Kompyuta

Kwa habari zaidi kuhusu Kompyuta na VPC (mtandao) katika GCP angalia:

{% content-ref url="../../gcp-services/gcp-compute-instances-enum/" %}
[gcp-compute-instances-enum](../../gcp-services/gcp-compute-instances-enum/)
{% endcontent-ref %}

### `compute.projects.setCommonInstanceMetadata`

Kwa idhini hiyo unaweza **kurekebisha** habari ya **metadata** ya **mfano** na kubadilisha **funguo zilizoidhinishwa za mtumiaji**, au **kuunda** **mtumiaji mpya na ruhusa za sudo**. Hivyo, utaweza kutekeleza kupitia SSH kwenye kifaa chochote cha VM na kuiba Akaunti ya Huduma ya GCP Mfano unayoendesha nayo.\
Vikwazo:

* Tafadhali kumbuka kuwa Akaunti za Huduma za GCP zinazoendesha katika mifano ya VM kwa chaguo-msingi zina **wigo mdogo sana**
* Utahitaji kuwa **na uwezo wa kuwasiliana na seva ya SSH** ili kuingia

Kwa habari zaidi kuhusu jinsi ya kutumia idhini hii angalia:

{% content-ref url="gcp-add-custom-ssh-metadata.md" %}
[gcp-add-custom-ssh-metadata.md](gcp-add-custom-ssh-metadata.md)
{% endcontent-ref %}

### `compute.instances.setMetadata`

Idhini hii inatoa **madaraka sawa na idhini iliyopita** lakini kwa mifano maalum badala ya mradi mzima. **Mbinu na vikwazo sawa kama kwa sehemu iliyopita** zinatumika.

### `compute.instances.setIamPolicy`

Aina hii ya idhini itakuruhusu **kujipatia jukumu lenye idhini za awali** na kuboresha mamlaka kwa kuzitumia vibaya.

### **`compute.instances.osLogin`**

Ikiwa **OSLogin imezimwa kwenye mfano**, na idhini hii unaweza tu kukimbia **`gcloud compute ssh [MFANO]`** na kuunganisha kwenye mfano. **Hautakuwa na mamlaka ya msingi** ndani ya mfano.

### **`compute.instances.osAdminLogin`**

Ikiwa **OSLogin imezimwa kwenye mfano**, na idhini hii unaweza tu kukimbia **`gcloud compute ssh [MFANO]`** na kuunganisha kwenye mfano. Utakuwa na **mamlaka ya msingi** ndani ya mfano.

### `compute.instances.create`,`iam.serviceAccounts.actAs, compute.disks.create`, `compute.instances.create`, `compute.instances.setMetadata`, `compute.instances.setServiceAccount`, `compute.subnetworks.use`, `compute.subnetworks.useExternalIp`

Inawezekana **kuunda mashine ya virtuali na Akaunti ya Huduma iliyopewa na kuiba token** ya akaunti ya huduma kwa kupata metadata kuongeza mamlaka kwake.

Skripti ya kudukua kwa njia hii inaweza kupatikana [hapa](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/compute.instances.create.py).

### `osconfig.patchDeployments.create` | `osconfig.patchJobs.exec`

Ikiwa una **`osconfig.patchDeployments.create`** au **`osconfig.patchJobs.exec`** idhini unaweza kuunda [**kazi au upelekaji wa kurekebisha**](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching). Hii itawezesha kuhamia kwa upande katika mazingira na kupata utekelezaji wa nambari kwenye mifano yote ya kompyuta ndani ya mradi.

Ikiwa unataka kutumia hii kwa mikono utahitaji kuunda au [kazi ya kurekebisha](https://github.com/rek7/patchy/blob/main/pkg/engine/patches/patch\_job.json) au [upelekaji](https://github.com/rek7/patchy/blob/main/pkg/engine/patches/patch\_deployment.json) kwa kazi ya kurekebisha endesha:

`gcloud compute os-config patch-jobs execute --file=patch.json`

Kwa kupeleka upelekaji wa kurekebisha:

`gcloud compute os-config patch-deployments create my-update --file=patch.json`

Zana za kiotomatiki kama [patchy](https://github.com/rek7/patchy) zipo kugundua idhini dhaifu na kuhamia kwa upande kiotomatiki.

**Unaweza pia kutumia hii kwa uthabiti.**

### `compute.machineImages.setIamPolicy`

**Jipatie idhini ziada** kwa Picha ya Kompyuta.

### `compute.snapshots.setIamPolicy`

**Jipatie idhini ziada** kwa picha ya diski.

### `compute.disks.setIamPolicy`

**Jipatie idhini ziada** kwa diski.

### Kupuuza Vipimo vya Kufikia

Kufuata kiungo hiki utapata [**mawazo ya jaribu kupuuza vipimo vya kufikia**](../../../gcp-security/gcp-privilege-escalation/).

### Kuboresha Mamlaka ya Kienyeji kwenye Mfano wa Kompyuta wa GCP

{% content-ref url="../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](../../../gcp-security/gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

## Marejeo

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi kuwa shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
