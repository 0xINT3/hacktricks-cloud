# GCP - Ukarabati wa Hifadhi ya Sanaa

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Hifadhi ya Sanaa

Kwa habari zaidi kuhusu Hifadhi ya Sanaa angalia:

{% content-ref url="../gcp-services/gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](../gcp-services/gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### artifactregistry.repositories.uploadArtifacts

Kwa kibali hiki, muhusika anaweza kupakia toleo mpya la sanaa na nambari ya malicious kama picha za Docker:

{% code overflow="wrap" %}
```bash
# Configure docker to use gcloud to authenticate with Artifact Registry
gcloud auth configure-docker <location>-docker.pkg.dev

# tag the image to upload it
docker tag <local-img-name>:<local-tag> <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>

# Upload it
docker push <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
{% endcode %}

{% hint style="danger" %}
Ilithibitishwa kwamba **inawezekana kupakia picha mpya ya docker yenye nia mbaya** yenye jina na lebo ile ile kama ile iliyopo, hivyo **ile ya zamani itapoteza lebo** na wakati ijayo picha hiyo na lebo hiyo inapokuwa **pakuliwa picha yenye nia mbaya** itapakuliwa.
{% endhint %}

<details>

<summary>Pakia maktaba ya Python</summary>

**Anza kwa kuunda maktaba ya kupakia** (ikiwa unaweza kupakua toleo la hivi karibuni kutoka kwenye usajili unaweza kuepuka hatua hii):

1.  **Sanidi muundo wa mradi wako**:

* Unda saraka mpya kwa ajili ya maktaba yako, k.m., `hello_world_library`.
* Ndani ya saraka hii, unda saraka nyingine na jina la pakiti yako, k.m., `hello_world`.
* Ndani ya saraka yako ya pakiti, unda faili ya `__init__.py`. Faili hii inaweza kuwa tupu au inaweza kuwa na uanzishaji kwa ajili ya pakiti yako.

```bash
mkdir hello_world_library
cd hello_world_library
mkdir hello_world
touch hello_world/__init__.py
```
2.  **Andika nambari ya maktaba yako**:

* Ndani ya saraka ya `hello_world`, unda faili mpya ya Python kwa ajili ya moduli yako, k.m., `greet.py`.
* Andika kazi yako ya "Hello, World!":

```python
# hello_world/greet.py
def say_hello():
return "Hello, World!"
```
3.  **Unda faili ya `setup.py`**:

* Katika mzizi wa saraka yako ya `hello_world_library`, unda faili ya `setup.py`.
* Faili hii ina maelezo kuhusu maktaba yako na inaambia Python jinsi ya kuaisilisha.

```python
# setup.py
from setuptools import setup, find_packages

setup(
name='hello_world',
version='0.1',
packages=find_packages(),
install_requires=[
# Mahitaji yoyote ya maktaba yako
],
)
```



**Sasa, pakia maktaba:**

1.  **Jenga pakiti yako**:

* Kutoka kwenye mzizi wa saraka yako ya `hello_world_library`, endesha:

```sh
python3 setup.py sdist bdist_wheel
```
2.  **Sanidi uthibitishaji kwa twine** (inayotumika kupakia pakiti yako):

* Hakikisha una `twine` imewekwa (`pip install twine`).
* Tumia `gcloud` kuweka mamlaka:

{% code overflow="wrap" %}
```sh
twine upload --username 'oauth2accesstoken' --password "$(gcloud auth print-access-token)" --repository-url https://<location>-python.pkg.dev/<project-id>/<repo-name>/ dist/*
```
{% endcode %}

<!---->

3. **Safisha ujenzi**
```bash
rm -rf dist build hello_world.egg-info
```
</details>

{% hint style="danger" %}
Haiwezekani kupakia maktaba ya python yenye toleo sawa na ile iliyopo tayari, lakini inawezekana kupakia **toleo kubwa zaidi** (au kuongeza **`.0` ziada mwishoni** mwa toleo ikiwa inafanya kazi -sio kwa python hata hivyo-), au **kufuta toleo la mwisho na kupakia jipya** (inahitaji `artifactregistry.versions.delete)`**:**

{% code overflow="wrap" %}
```sh
gcloud artifacts versions delete <version> --repository=<repo-name> --location=<location> --package=<lib-name>
```
{% endcode %}
{% endhint %}

### `artifactregistry.repositories.downloadArtifacts`

Kwa kibali hiki unaweza **kupakua vitu** na kutafuta **habari nyeti** na **mapungufu**.

Pakua picha ya **Docker**:
```sh
# Configure docker to use gcloud to authenticate with Artifact Registry
gcloud auth configure-docker <location>-docker.pkg.dev

# Dowload image
docker pull <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
Pakua maktaba ya **python**:

{% code overflow="wrap" %}
```bash
pip install <lib-name> --index-url "https://oauth2accesstoken:$(gcloud auth print-access-token)@<location>-python.pkg.dev/<project-id>/<repo-name>/simple/" --trusted-host <location>-python.pkg.dev --no-cache-dir
```
{% endcode %}

* Kipi kitatokea ikiwa registries ya mbali na ya kawaida zimechanganywa katika moja ya kubuniwa na pakiti ipo katika zote? Angalia ukurasa huu:

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

### `artifactregistry.tags.delete`, `artifactregistry.versions.delete`, `artifactregistry.packages.delete`, (`artifactregistry.repositories.get`, `artifactregistry.tags.get`, `artifactregistry.tags.list`)

Futa vitu kutoka kwenye registry, kama picha za docker:

{% code overflow="wrap" %}
```bash
# Delete a docker image
gcloud artifacts docker images delete <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
### `artifactregistry.repositories.delete`

Futa hifadhi kamili (hata kama ina maudhui):

{% code overflow="wrap" %}
```
gcloud artifacts repositories delete <repo-name> --location=<location>
```
### `artifactregistry.repositories.setIamPolicy`

Mshambuliaji mwenye ruhusa hii anaweza kujipa ruhusa za kufanya baadhi ya mashambulizi ya hifadhi yaliyotajwa hapo awali.

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka mwanzo hadi mtaalamu na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalamu wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
