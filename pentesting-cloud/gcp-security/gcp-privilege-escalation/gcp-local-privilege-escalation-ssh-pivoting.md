# GCP - рд╕реНрдерд╛рдиреАрдп рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди ssh рдкрд┐рд╡рдЯрд┐рдВрдЧ

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ рдлрд╝реЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>

рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ рд╣рдо рдорд╛рдиреЗрдВрдЧреЗ рдХрд┐ рдЖрдкрдиреЗ рдПрдХ рдХрдВрдкреНрдпреВрдЯ рдЗрдВрдЬрди рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдПрдХ рдЧреИрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЦрд╛рддрд╛ рдХреЛ **рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝** рдХрд░ рд▓рд┐рдпрд╛ рд╣реИред

рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд░реВрдк рд╕реЗ, рдЖрдкрдХреЗ рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП GPC рдЕрдиреБрдорддрд┐рдпрд╛рдВ рдЖрдкрдХреЛ **рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреА рд╣реИрдВ**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рд╣рдореЗрд╢рд╛ рдПрдХ рдХреНрд▓рд╛рдЙрдб рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рдмрд╣реБрдд рдорджрджрдЧрд╛рд░ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдЬрд╛рдирдирд╛ рдЕрдЪреНрдЫрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕рдВрднрд╡ рд╣реИред

## рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкрдврд╝реЗрдВ <a href="#follow-the-scripts" id="follow-the-scripts"></a>

**рдХрдВрдкреНрдпреВрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрдЬ** рд╢рд╛рдпрдж рд╡рд╣рд╛рдВ рд╣реЛрдВрдЧреЗ рддрд╛рдХрд┐ **рдХреБрдЫ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ** рдФрд░ рдЙрдирдХреЗ рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░реЗрдВред

IAM рдмрд╣реБрдд рд╡рд┐рд╕реНрддрд╛рд░рд╢реАрд▓ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рдПрдХ рдЦрд╛рддрд╛ рдХреЗ рдкрд╛рд╕ рдПрдХ рд╕рдВрд╕рд╛рдзрди рдкрд░ **рдкрдврд╝рдиреЗ/рд▓рд┐рдЦрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИ рд▓реЗрдХрд┐рди **рд╕реВрдЪреА рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ** рд╣реЛ рд╕рдХрддреА рд╣реИред

рдЗрд╕рдХрд╛ рдПрдХ рдорд╣рд╛рди рдХрд▓реНрдкрдирд╛рд╢реАрд▓ рдЙрджрд╛рд╣рд░рдг рдПрдХ рдХрдВрдкреНрдпреВрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╣реИ рдЬрд┐рд╕рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ рдХрд┐ рд╡рд╣ рдПрдХ рд╕рдВрдЧреНрд░рд╣ рд╕рдВрдЧреНрд░рд╣ рдХреЗ рд▓рд┐рдП рдмреИрдХрдЕрдк рдкрдврд╝/рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо `instance82736-long-term-xyz-archive-0332893` рд╣реИред

рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рд╕реЗ `gsutil ls` рдЪрд▓рд╛рдиреЗ рдкрд░ рдХреБрдЫ рдирд╣реАрдВ рд▓реМрдЯрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдореЗрдВ `storage.buckets.list` IAM рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдЖрдк `gsutil ls gs://instance82736-long-term-xyz-archive-0332893` рдЪрд▓рд╛рдПрдВ, рддреЛ рдЖрдкрдХреЛ рдПрдХ рдкреВрд░реНрдг рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдмреИрдХрдЕрдк рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЖрдкрдХреЛ рд╕реНрдерд╛рдиреАрдп Linux рдЦрд╛рддреЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рд╕рд╛рдл-рд╕реБрдерд░рд╛ рдкрд╣реБрдВрдЪ рдорд┐рд▓рддреА рд╣реИред

рдЖрдк рдЗрд╕ рдмрд╛рд▓реНрдЯреА рдХрд╛ рдирд╛рдо рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ (рдмреИрд╢, рдкрд╛рдпрдерди, рд░реВрдмреА рдореЗрдВ) рдореЗрдВ рдвреВрдВрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред

## рдХрд╕реНрдЯрдо рдореЗрдЯрд╛рдбреЗрдЯрд╛

рдкреНрд░рд╢рд╛рд╕рдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдФрд░ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕реНрддрд░ рдкрд░ [рдХрд╕реНрдЯрдо рдореЗрдЯрд╛рдбреЗрдЯрд╛](https://cloud.google.com/compute/docs/storing-retrieving-metadata#custom) рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдмрд╕ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ **рдПрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдХреБрдВрдЬреА/рдорд╛рди рдЬреЛрдбрд╝рдиреЗ рдХрд╛**, рдФрд░ рдЖрдорддреМрд░ рдкрд░ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдФрд░ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк/рд╢рдЯрдбрд╛рдЙрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛** рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рд╣рд░ рдмрд╛рд░ рдорд╢реАрди рд╢реБрд░реВ рдпрд╛ рдкреБрдирд░рд╛рд░рдВрдн рд╣реЛрдиреЗ рдкрд░ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ рдФрд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реЗ рднреА рдкрд╣реБрдВрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред**

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

## **IAM рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ**

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдореЗрдВ рд╕реЗ рдЕрдзрд┐рдХрд╛рдВрд╢ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХрдВрдкреНрдпреВрдЯ SA рдХреЛ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ,** рдХреЗрд╡рд▓ рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдПрдХреНрд╕реЗрд╕ рд╕реНрдХреЛрдк рд╕реЗ SA рдХреЛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ **`cloud-platform`** **рд╕реНрдХреЛрдк** рд╕рдХреНрд╖рдо рд╣реИ рдпрд╛ рдХреЗрд╡рд▓ **`compute`** **рд╕реНрдХреЛрдк** рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ рдЖрдк рдЗрдирдХрд╛ **рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдВрдЧреЗ**ред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

* ****[**compute.instances.osLogin**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/#compute.instances.oslogin)****
* ****[**compute.instances.osAdminLogin**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/#compute.instances.osadminlogin)****
* ****[**compute.projects.setCommonInstanceMetadata**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/#compute.projects.setcommoninstancemetadata)****
* ****[**compute.instances.setMetadata**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/#compute.instances.setmetadata)****
* ****[**compute.instances.setIamPolicy**](../../gcp-pentesting/gcp-privilege-escalation/gcp-compute-privesc/#compute.instances.setiampolicy)****

## рдлрд╝рд╛рдЗрд▓рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдХреБрдВрдЬреАрдпреЛрдВ рдХреА рдЦреЛрдЬ

рдпрд╣ рдХрд╛рдлреА рд╕рдВрднрд╛рд╡рд┐рдд рд╣реИ рдХрд┐ **рдПрдХ рд╣реА рдмреЙрдХреНрд╕ рдкрд░ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдкрдХреЗ рдЕрдкрдиреЗ рд╕реЗ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдЦ
```
sudo find / -name "gcloud"
```
рдЖрдк рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдореИрдиреНрдпреБрдЕрд▓реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдорддреМрд░ рдкрд░ рдпреЗ рд╡реЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣реЛрддреА рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдЧреБрдкреНрдд рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ:

* \~/.config/gcloud/credentials.db
* \~/.config/gcloud/legacy\_credentials/\[рдЦрд╛рддрд╛]/adc.json
* \~/.config/gcloud/legacy\_credentials/\[рдЦрд╛рддрд╛]/.boto
* \~/.credentials.json

рдЕрдм, рдЖрдкрдХреЗ рдкрд╛рд╕ рдпреЗ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ рдХрд┐ рдЖрдк рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╕рд╛рдлрд╝-рд╕рд╛рдлрд╝ рдЬрд╛рдирдХрд╛рд░реА рдЦреЛрдЬреЗрдВ рдпрд╛ рдмрд╕ рдкреВрд░реЗ `gcloud` рдлрд╝реЛрд▓реНрдбрд░ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдЕрдкрдиреЗ рдХрдВрдЯреНрд░реЛрд▓ рд╡рд╛рд▓реА рдорд╢реАрди рдкрд░ рдХреЙрдкреА рдХрд░реЗрдВ рдФрд░ `gcloud auth list` рдЪрд▓рд╛рдПрдВ рддрд╛рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЕрдм рдХреМрди рд╕реЗ рдЦрд╛рддреЗ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рджреЗрдЦ рд╕рдХреЗрдВред

### рдЕрдзрд┐рдХ API рдХреБрдВрдЬреА рд░реЗрдЬреЗрдХреНрд╕
```bash
TARGET_DIR="/path/to/whatever"

# Service account keys
grep -Pzr "(?s){[^{}]*?service_account[^{}]*?private_key.*?}" \
"$TARGET_DIR"

# Legacy GCP creds
grep -Pzr "(?s){[^{}]*?client_id[^{}]*?client_secret.*?}" \
"$TARGET_DIR"

# Google API keys
grep -Pr "AIza[a-zA-Z0-9\\-_]{35}" \
"$TARGET_DIR"

# Google OAuth tokens
grep -Pr "ya29\.[a-zA-Z0-9_-]{100,200}" \
"$TARGET_DIR"

# Generic SSH keys
grep -Pzr "(?s)-----BEGIN[ A-Z]*?PRIVATE KEY[a-zA-Z0-9/\+=\n-]*?END[ A-Z]*?PRIVATE KEY-----" \
"$TARGET_DIR"

# Signed storage URLs
grep -Pir "storage.googleapis.com.*?Goog-Signature=[a-f0-9]+" \
"$TARGET_DIR"

# Signed policy documents in HTML
grep -Pzr '(?s)<form action.*?googleapis.com.*?name="signature" value=".*?">' \
"$TARGET_DIR"
```
<details>

<summary><strong>рдмрдврд╝рд┐рдпрд╛ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХрд╛ рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ рдореБрдЭреЗ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
