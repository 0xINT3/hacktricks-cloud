# GCP - Cloudbuild Privesc

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**telegramグループ**](https://t.me/peass)に**参加する**、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

## cloudbuild

### `cloudbuild.builds.create`

この権限を持っていると、**クラウドビルドを提出**することができます。cloudbuildマシンには、デフォルトで強力なcloudbuildサービスアカウントの**トークンがファイルシステムに含まれています**：`<PROJECT_NUMBER>@cloudbuild.gserviceaccount.com`。しかし、cloudbuildの設定で**プロジェクト内の任意のサービスアカウントを指定**することができます。\
したがって、マシンにトークンをあなたのサーバーに流出させるか、**リバースシェルを取得して自分でトークンを取得**することができます（トークンが含まれているファイルは変更される可能性があります）。

オリジナルのエクスプロイトスクリプトは[**GitHub上でこちら**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudbuild.builds.create.py)にあります（しかし、トークンの場所は私には機能しませんでした）。したがって、[**脆弱な環境の作成、エクスプロイト、クリーニングを自動化するスクリプトはこちら**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/f-cloudbuild.builds.create.sh)と、cloudbuildマシン内でリバースシェルを取得し[**ここで盗むPythonスクリプト**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/f-cloudbuild.builds.create.py)をチェックしてください（コード内で他のサービスアカウントを指定する方法が見つかります）。

より詳細な説明については、[https://rhinosecuritylabs.com/gcp/iam-privilege-escalation-gcp-cloudbuild/](https://rhinosecuritylabs.com/gcp/iam-privilege-escalation-gcp-cloudbuild/)を訪れてください。

### `cloudbuild.builds.update`

**潜在的に**この権限を持っていると、前の権限で行われたように**クラウドビルドを更新してサービスアカウントトークンを盗む**ことができるかもしれません（しかし、残念ながらこの記事を書いている時点ではそのAPIを呼び出す方法を見つけることができませんでした）。

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**telegramグループ**](https://t.me/peass)に**参加する**、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>
