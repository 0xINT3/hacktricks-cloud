# GCP - Escalada de privilegios en Cloudscheduler

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## cloudscheduler

### `cloudscheduler.jobs.create`, `iam.serviceAccounts.actAs`

Cloud Scheduler te permite configurar trabajos cron que apunten a puntos finales HTTP arbitrarios. **Si ese punto final es un punto final \*.googleapis.com**, entonces tambi√©n puedes decirle a Scheduler que quieres autenticar la solicitud **como una cuenta de servicio espec√≠fica**, que es exactamente lo que queremos.

Como controlamos todos los aspectos de la solicitud HTTP que se realiza desde Cloud Scheduler, podemos configurarlo para que golpee otro punto final de la API de Google. Por ejemplo, si quisi√©ramos crear un nuevo trabajo que use una cuenta de servicio espec√≠fica para crear un nuevo bucket de almacenamiento en nuestro nombre, podr√≠amos ejecutar el siguiente comando:

{% code overflow="wrap" %}
```
gcloud scheduler jobs create http test ‚Äìschedule=‚Äô* * * * *‚Äô ‚Äìuri=‚Äôhttps://storage.googleapis.com/storage/v1/b?project=<PROJECT-ID>‚Äô ‚Äìmessage-body ‚Äú{‚Äòname‚Äô:‚Äônew-bucket-name‚Äô}‚Äù ‚Äìoauth-service-account-email 111111111111-compute@developer.gserviceaccount.com ‚Äìheaders Content-Type=application/json
```
{% endcode %}

Este comando programar√≠a una solicitud POST HTTP para cada minuto que se autentique como _111111111111-compute@developer.gserviceaccount.com_. La solicitud golpear√° el punto final de la API de Cloud Storage y crear√° un nuevo bucket con el nombre "new-bucket-name".

Se requieren los **siguientes permisos adicionales** para este m√©todo:

* _cloudscheduler.jobs.create_
* _cloudscheduler.locations.list_
* _iam.serviceAccounts.actAs_

Para escalar nuestros privilegios con este m√©todo, solo necesitamos **crear la solicitud HTTP de la API que queremos golpear como la cuenta de servicio que pasamos**. En lugar de un script, puedes usar el comando gcloud anterior.

Un m√©todo similar puede ser posible con Cloud Tasks, pero no pudimos hacerlo en nuestras pruebas.

## Referencias

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>