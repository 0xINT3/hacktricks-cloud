# GCP - Privil√®ge d'escalade Cloudscheduler

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## cloudscheduler

### `cloudscheduler.jobs.create`, `iam.serviceAccounts.actAs`

Cloud Scheduler vous permet de configurer des t√¢ches cron ciblant des points de terminaison HTTP arbitraires. **Si ce point de terminaison est un point de terminaison \*.googleapis.com**, vous pouvez √©galement indiquer √† Scheduler que vous souhaitez qu'il authentifie la demande **en tant que compte de service sp√©cifique**, ce que nous voulons exactement.

Comme nous contr√¥lons tous les aspects de la demande HTTP effectu√©e √† partir de Cloud Scheduler, nous pouvons la configurer pour frapper un autre point de terminaison de l'API Google. Par exemple, si nous voulions cr√©er une nouvelle t√¢che qui utilisera un compte de service sp√©cifique pour cr√©er un nouveau bucket de stockage en notre nom, nous pourrions ex√©cuter la commande suivante :

{% code overflow="wrap" %}
```
gcloud scheduler jobs create http test ‚Äìschedule=‚Äô* * * * *‚Äô ‚Äìuri=‚Äôhttps://storage.googleapis.com/storage/v1/b?project=<PROJECT-ID>‚Äô ‚Äìmessage-body ‚Äú{‚Äòname‚Äô:‚Äônew-bucket-name‚Äô}‚Äù ‚Äìoauth-service-account-email 111111111111-compute@developer.gserviceaccount.com ‚Äìheaders Content-Type=application/json
```
{% endcode %}

Cette commande planifierait une demande POST HTTP pour chaque minute qui s'authentifierait en tant que _111111111111-compute@developer.gserviceaccount.com_. La demande frappera le point de terminaison de l'API Cloud Storage et cr√©era un nouveau bucket avec le nom "new-bucket-name".

Les **autorisations suppl√©mentaires suivantes** sont requises pour cette m√©thode :

* _cloudscheduler.jobs.create_
* _cloudscheduler.locations.list_
* _iam.serviceAccounts.actAs_

Pour escalader nos privil√®ges avec cette m√©thode, nous devons simplement **cr√©er la demande HTTP de l'API que nous voulons frapper en tant que compte de service que nous passons**. Au lieu d'un script, vous pouvez simplement utiliser la commande gcloud ci-dessus.

Une m√©thode similaire peut √™tre possible avec Cloud Tasks, mais nous n'avons pas pu le faire lors de nos tests.

## R√©f√©rences

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>