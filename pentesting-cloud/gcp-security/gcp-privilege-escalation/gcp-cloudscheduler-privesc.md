# GCP - Cloudscheduler Privesc

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**PEASSの最新バージョンを見たい**場合、または**HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

## cloudscheduler

### `cloudscheduler.jobs.create` , `iam.serviceAccounts.actAs`

Cloud Schedulerを使用すると、任意のHTTPエンドポイントをターゲットにしたcronジョブを設定できます。**エンドポイントが\*.googleapis.comエンドポイントである場合**、Schedulerに対してリクエストを**特定のサービスアカウントとして認証するように指示**することもできます。

Cloud Schedulerから行われるHTTPリクエストのすべての側面を制御しているため、別のGoogle APIエンドポイントにアクセスするように設定することができます。たとえば、特定のサービスアカウントを使用して私たちの代わりに新しいストレージバケットを作成する新しいジョブを作成したい場合、次のコマンドを実行できます：

{% code overflow="wrap" %}
```
gcloud scheduler jobs create http test –schedule=’* * * * *’ –uri=’https://storage.googleapis.com/storage/v1/b?project=<PROJECT-ID>’ –message-body “{‘name’:’new-bucket-name’}” –oauth-service-account-email 111111111111-compute@developer.gserviceaccount.com –headers Content-Type=application/json
```
{% endcode %}

このコマンドは、_111111111111-compute@developer.gserviceaccount.com_として認証されるHTTP POSTリクエストを毎分スケジュールします。リクエストはCloud Storage APIエンドポイントに到達し、「new-bucket-name」という名前の新しいバケットを作成します。

この方法には、次の追加の権限が必要です：

* _cloudscheduler.jobs.create_
* _cloudscheduler.locations.list_
* _iam.serviceAccounts.actAs_

この方法で特権をエスカレーションするには、渡すサービスアカウントとしてAPIをヒットするためのHTTPリクエストを作成するだけです。スクリプトの代わりに、上記のgcloudコマンドを使用することもできます。

Cloud Tasksでも同様の方法が可能かもしれませんが、私たちはテストでそれを行うことができませんでした。

## 参考文献

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* **HackTricksの広告を掲載したい場合や、PEASSの最新バージョンにアクセスしたい場合は、[SUBSCRIPTION PLANS](https://github.com/sponsors/carlospolop)をご確認ください！**
* [公式PEASS＆HackTricksグッズ](https://peass.creator-spring.com)を手に入れましょう。
* [The PEASS Family](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[NFT](https://opensea.io/collection/the-peass-family)を手に入れましょう。
* 💬 [Discordグループ](https://discord.gg/hRep4RUj7f)または[Telegramグループ](https://t.me/peass)に参加するか、Twitterで私をフォローしてください🐦 [@carlospolopm](https://twitter.com/carlospolopm)。
* ハッキングのトリックを共有するために、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
