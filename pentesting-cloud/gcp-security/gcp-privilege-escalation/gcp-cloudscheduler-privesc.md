# GCP - Escala√ß√£o de Privil√©gios do Cloudscheduler

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

## cloudscheduler

### `cloudscheduler.jobs.create`, `iam.serviceAccounts.actAs`

O Cloud Scheduler permite que voc√™ configure cron jobs que visam endpoints HTTP arbitr√°rios. **Se esse endpoint for um endpoint \*.googleapis.com**, voc√™ tamb√©m pode informar ao Scheduler que deseja autenticar a solicita√ß√£o **como uma conta de servi√ßo espec√≠fica**, que √© exatamente o que queremos.

Como controlamos todos os aspectos da solicita√ß√£o HTTP feita pelo Cloud Scheduler, podemos configur√°-lo para atingir outro endpoint da API do Google. Por exemplo, se quisermos criar um novo trabalho que usar√° uma conta de servi√ßo espec√≠fica para criar um novo bucket de armazenamento em nosso nome, poder√≠amos executar o seguinte comando:

{% code overflow="wrap" %}
```
gcloud scheduler jobs create http test ‚Äìschedule=‚Äô* * * * *‚Äô ‚Äìuri=‚Äôhttps://storage.googleapis.com/storage/v1/b?project=<PROJECT-ID>‚Äô ‚Äìmessage-body ‚Äú{‚Äòname‚Äô:‚Äônew-bucket-name‚Äô}‚Äù ‚Äìoauth-service-account-email 111111111111-compute@developer.gserviceaccount.com ‚Äìheaders Content-Type=application/json
```
{% endcode %}

Este comando agendar√° uma solicita√ß√£o POST HTTP para cada minuto que autentica como _111111111111-compute@developer.gserviceaccount.com_. A solicita√ß√£o atingir√° o endpoint da API do Cloud Storage e criar√° um novo bucket com o nome "new-bucket-name".

As **seguintes permiss√µes adicionais** s√£o necess√°rias para este m√©todo:

* _cloudscheduler.jobs.create_
* _cloudscheduler.locations.list_
* _iam.serviceAccounts.actAs_

Para escalar nossos privil√©gios com este m√©todo, precisamos apenas **criar a solicita√ß√£o HTTP da API que queremos atingir como a conta de servi√ßo que passamos**. Em vez de um script, voc√™ pode usar o comando gcloud acima.

Um m√©todo semelhante pode ser poss√≠vel com Cloud Tasks, mas n√£o conseguimos faz√™-lo em nossos testes.

## Refer√™ncias

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>