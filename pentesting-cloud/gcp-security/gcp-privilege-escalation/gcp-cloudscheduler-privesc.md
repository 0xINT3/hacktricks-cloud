# GCP - Cloudscheduler Privesc

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-moi** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## cloudscheduler

### `cloudscheduler.jobs.create` , `iam.serviceAccounts.actAs`

Cloud Scheduler vous permet de configurer des t√¢ches cron ciblant des points de terminaison HTTP arbitraires. **Si ce point de terminaison est un point de terminaison \*.googleapis.com**, alors vous pouvez √©galement dire √† Scheduler que vous voulez qu'il authentifie la requ√™te **en tant que Service Account sp√©cifique**, ce qui est exactement ce que nous voulons.

Puisque nous contr√¥lons tous les aspects de la requ√™te HTTP effectu√©e √† partir de Cloud Scheduler, nous pouvons le configurer pour qu'il atteigne un autre point de terminaison de l'API Google. Par exemple, si nous voulions cr√©er une nouvelle t√¢che qui utilisera un Service Account sp√©cifique pour cr√©er un nouveau bucket Storage en notre nom, nous pourrions ex√©cuter la commande suivante :

{% code overflow="wrap" %}
```
gcloud scheduler jobs create http test ‚Äìschedule=‚Äô* * * * *‚Äô ‚Äìuri=‚Äôhttps://storage.googleapis.com/storage/v1/b?project=<PROJECT-ID>‚Äô ‚Äìmessage-body ‚Äú{‚Äòname‚Äô:‚Äônew-bucket-name‚Äô}‚Äù ‚Äìoauth-service-account-email 111111111111-compute@developer.gserviceaccount.com ‚Äìheaders Content-Type=application/json
```
{% endcode %}

Cette commande programmerait une requ√™te HTTP POST toutes les minutes qui s'authentifie en tant que _111111111111-compute@developer.gserviceaccount.com_. La requ√™te ciblera le point de terminaison de l'API Cloud Storage et cr√©era un nouveau seau avec le nom "new-bucket-name".

Les **permissions suppl√©mentaires suivantes** sont requises pour cette m√©thode :

* _cloudscheduler.jobs.create_
* _cloudscheduler.locations.list_
* _iam.serviceAccounts.actAs_

Pour augmenter nos privil√®ges avec cette m√©thode, nous devons simplement **concevoir la requ√™te HTTP de l'API que nous voulons atteindre en tant que le Service Account que nous transmettons**. Au lieu d'un script, vous pouvez simplement utiliser la commande gcloud ci-dessus.

Une m√©thode similaire pourrait √™tre possible avec Cloud Tasks, mais nous n'avons pas r√©ussi √† le faire lors de nos tests.

## R√©f√©rences

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> !</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
