# GCP - Cloudscheduler Privesc

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## cloudscheduler

### `cloudscheduler.jobs.create` , `iam.serviceAccounts.actAs`

O Cloud Scheduler permite configurar cron jobs direcionados a endpoints HTTP arbitr√°rios. **Se esse endpoint for um endpoint \*.googleapis.com**, ent√£o voc√™ tamb√©m pode instruir o Scheduler a autenticar a solicita√ß√£o **como uma Conta de Servi√ßo espec√≠fica**, que √© exatamente o que queremos.

Como controlamos todos os aspectos da solicita√ß√£o HTTP feita pelo Cloud Scheduler, podemos configur√°-lo para atingir outro endpoint da API do Google. Por exemplo, se quis√©ssemos criar um novo job que usar√° uma Conta de Servi√ßo espec√≠fica para criar um novo bucket de Storage em nosso nome, poder√≠amos executar o seguinte comando:

{% code overflow="wrap" %}
```
gcloud scheduler jobs create http test ‚Äìschedule=‚Äô* * * * *‚Äô ‚Äìuri=‚Äôhttps://storage.googleapis.com/storage/v1/b?project=<PROJECT-ID>‚Äô ‚Äìmessage-body ‚Äú{‚Äòname‚Äô:‚Äônew-bucket-name‚Äô}‚Äù ‚Äìoauth-service-account-email 111111111111-compute@developer.gserviceaccount.com ‚Äìheaders Content-Type=application/json
```
{% endcode %}

Este comando agendar√° uma solicita√ß√£o HTTP POST para cada minuto que se autentica como _111111111111-compute@developer.gserviceaccount.com_. A solicita√ß√£o atingir√° o endpoint da API do Cloud Storage e criar√° um novo bucket com o nome "new-bucket-name".

As **permiss√µes adicionais seguintes** s√£o necess√°rias para este m√©todo:

* _cloudscheduler.jobs.create_
* _cloudscheduler.locations.list_
* _iam.serviceAccounts.actAs_

Para escalar nossos privil√©gios com este m√©todo, precisamos apenas **criar a solicita√ß√£o HTTP da API que queremos atingir como a Conta de Servi√ßo que passamos**. Em vez de um script, voc√™ pode usar o comando gcloud acima.

Um m√©todo semelhante pode ser poss√≠vel com o Cloud Tasks, mas n√£o conseguimos faz√™-lo em nossos testes.

## Refer√™ncias

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
