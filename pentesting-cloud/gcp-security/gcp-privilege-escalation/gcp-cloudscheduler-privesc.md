# GCP - Cloudscheduler Privesc

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## cloudscheduler

### `cloudscheduler.jobs.create` , `iam.serviceAccounts.actAs`

Cloud Scheduler te permite configurar trabajos cron que apuntan a endpoints HTTP arbitrarios. **Si ese endpoint es un endpoint de \*.googleapis.com**, entonces tambi√©n puedes indicarle a Scheduler que quieres que autentique la solicitud **como una Cuenta de Servicio espec√≠fica**, que es exactamente lo que queremos.

Dado que controlamos todos los aspectos de la solicitud HTTP que se realiza desde Cloud Scheduler, podemos configurarlo para que acceda a otro endpoint de la API de Google. Por ejemplo, si quisi√©ramos crear un nuevo trabajo que utilice una Cuenta de Servicio espec√≠fica para crear un nuevo bucket de Storage en nuestro nombre, podr√≠amos ejecutar el siguiente comando:

{% code overflow="wrap" %}
```
gcloud scheduler jobs create http test ‚Äìschedule=‚Äô* * * * *‚Äô ‚Äìuri=‚Äôhttps://storage.googleapis.com/storage/v1/b?project=<PROJECT-ID>‚Äô ‚Äìmessage-body ‚Äú{‚Äòname‚Äô:‚Äônew-bucket-name‚Äô}‚Äù ‚Äìoauth-service-account-email 111111111111-compute@developer.gserviceaccount.com ‚Äìheaders Content-Type=application/json
```
{% endcode %}

Este comando programar√≠a una solicitud HTTP POST cada minuto que se autentica como _111111111111-compute@developer.gserviceaccount.com_. La solicitud llegar√° al punto final de la API de Cloud Storage y crear√° un nuevo bucket con el nombre "new-bucket-name".

Los **permisos adicionales siguientes** son necesarios para este m√©todo:

* _cloudscheduler.jobs.create_
* _cloudscheduler.locations.list_
* _iam.serviceAccounts.actAs_

Para escalar nuestros privilegios con este m√©todo, solo necesitamos **crear la solicitud HTTP de la API que queremos alcanzar como la Cuenta de Servicio que pasamos**. En lugar de un script, puedes usar simplemente el comando gcloud mencionado anteriormente.

Un m√©todo similar podr√≠a ser posible con Cloud Tasks, pero no pudimos hacerlo en nuestras pruebas.

## Referencias

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
