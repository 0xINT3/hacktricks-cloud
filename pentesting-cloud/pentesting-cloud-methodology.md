# 클라우드 펜테스팅 방법론

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를** 팔로우하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

<figure><img src="../.gitbook/assets/CLOUD-logo-letters.svg" alt=""><figcaption></figcaption></figure>

## 기본적인 방법론

각 클라우드에는 고유한 특징이 있지만, 일반적으로 클라우드 환경을 테스트할 때 **펜테스터가 확인해야 할 몇 가지 공통 사항**이 있습니다:

* **벤치마크 확인**
* 이를 통해 환경의 **크기**와 **사용되는 서비스**를 이해할 수 있습니다.
* 대부분의 이러한 테스트를 **자동화된 도구**를 사용하여 수행할 수 있으므로 **빠른 잘못된 구성**을 찾을 수도 있습니다.
* **서비스 열거**
* 벤치마크 테스트를 올바르게 수행했다면 여기에서는 크게 더 많은 잘못된 구성을 찾지 못할 수도 있지만, 벤치마크 테스트에서 찾지 못한 일부를 찾을 수도 있습니다.
* 이를 통해 클라우드 환경에서 **정확히 무엇이 사용되고 있는지**를 알 수 있습니다.
* 다음 단계에서 많은 도움이 될 것입니다.
* **노출된 자산 확인**
* 이는 이전 섹션에서 수행할 수 있으며, 어떤 자산이 어떻게 인터넷에 노출되는지 **파악**해야 합니다.
* 여기에서는 웹 페이지나 다른 포트가 노출된 인스턴스와 같은 **수동으로 노출된 인프라**와 노출될 수 있는 **다른 클라우드 관리 서비스**(예: DB 또는 버킷)에 대해 이야기합니다.
* 그런 다음 해당 리소스가 노출될 수 있는지 여부를 확인해야 합니다(기밀 정보? 취약점? 노출된 서비스의 잘못된 구성?).
* **권한 확인**
* 여기에서는 클라우드 내의 각 역할/사용자의 **모든 권한**과 그 사용 방법을 알아내야 합니다.
* **모든 것을 제어**할 수 있는 **너무 많은 권한**이 있는 계정? 사용되지 않는 생성된 키?... 이러한 대부분의 확인은 이미 벤치마크 테스트에서 수행되어야 합니다.
* 클라이언트가 OpenID 또는 SAML 또는 기타 **페더레이션**을 사용하는 경우 각 역할이 **어떻게 할당되는지에 대한 자세한 정보**를 요청해야 할 수도 있습니다(관리자 역할이 1명 또는 100명에게 할당되는 것은 같지 않습니다).
* **관리자** 권한 "\*:\*"을 가진 사용자를 찾는 것만으로는 충분하지 않습니다. 사용되는 서비스에 따라 매우 **민감한** 다른 권한이 많이 있습니다.
* 게다가 권한을 남용할 수 있는 **잠재적인 권한 상승** 경로도 있습니다. 이러한 모든 사항을 고려해야 하며, **가능한 많은 권한 상승 경로**를 보고해야 합니다.
* **통합 확인**
* 클라우드 환경 내에서 **다른 클라우드 또는 SaaS와의 통합**이 사용되고 있을 확률이 매우 높습니다.
* 감사 중인 클라우드의 **다른 플랫폼과의 통합**에 대해 (남용할 수 있는) **누가 액세스**할 수 있는지 알려주어야 하며 수행되는 작업이 **얼마나 민감한지** 물어봐야 합니다.\
예를 들어, GCP가 데이터를 가져오는 AWS 버킷에 쓸 수 있는 사람은 누구인지 (GCP에서 그 데이터를 처리할 때 그 작업이 얼마나 민감한지) 물어봐야 합니다.
* 외부 플랫폼에서 감사 중인 클라우드 내의 **통합**에 대해, 외부에서 (남용할 수 있는) **누가 액세스**할 수 있는지 알아보고 해당 데이터가 어떻게 사용되는지 확인해야 합니다.\
예를 들어, 서비스가 GCR에 호스팅된 Docker 이미지를 사용하는 경우 해당 이미지를 수정할 수 있는 사람과 해당 이미지가 AWS 클라우드 내에서 실행될 때 어떤 민감한 정보와 액세스가 제공되는지 확인해야 합니다.

## Multi-Cloud 도구

다양한 클라우드 환경을 테스트하는 데 사용할 수 있는 여러 도구가 있습니다. 설치 단계와 링크는 이 섹션에서 나와 있습니다.

### [PurplePanda](https://github.com/carlospolop/purplepanda)

클라우드 및 클라우드/SaaS 간의 **잘못된 구성 및 권한 상승 경로를 식별**하는 도구입니다.

{% tabs %}
{% tab title="설치" %}
```bash
# You need to install and run neo4j also
git clone https://github.com/carlospolop/PurplePanda
cd PurplePanda
python3 -m venv .
source bin/activate
python3 -m pip install -r requirements.txt
export PURPLEPANDA_NEO4J_URL="bolt://neo4j@localhost:7687"
export PURPLEPANDA_PWD="neo4j_pwd_4_purplepanda"
python3 main.py -h # Get help
```
{% endtab %}

{% tab title="GCP" %}GCP (Google Cloud Platform)은 Google의 클라우드 컴퓨팅 서비스입니다. GCP는 다양한 클라우드 기반 서비스를 제공하며, 기업 및 개발자들이 애플리케이션을 개발, 배포 및 관리할 수 있도록 도와줍니다.

GCP 펜테스팅 방법론은 다음과 같습니다:

1. 정보 수집: GCP 환경에 대한 정보를 수집합니다. 이는 도메인, IP 주소, 서비스 및 애플리케이션의 구성 요소, 엑세스 제어 및 인증 방법 등을 포함합니다.

2. 인증 및 권한 부여: GCP 환경에서 사용되는 인증 및 권한 부여 메커니즘을 이해하고 분석합니다. 이는 IAM (Identity and Access Management) 권한, 서비스 계정, 역할 및 권한 부여 정책 등을 포함합니다.

3. 네트워크 스캐닝: GCP 환경의 네트워크 구성을 스캔하여 취약점을 식별합니다. 이는 포트 스캐닝, 서비스 및 애플리케이션의 구성 요소 분석, 보안 그룹 및 방화벽 설정 등을 포함합니다.

4. 애플리케이션 스캐닝: GCP 환경에서 실행되는 애플리케이션을 스캔하여 취약점을 식별합니다. 이는 웹 애플리케이션 취약점, API 취약점, 데이터 노출 등을 포함합니다.

5. 데이터 스캐닝: GCP 환경에서 저장되는 데이터를 스캔하여 민감한 정보 노출을 식별합니다. 이는 데이터베이스, 스토리지 및 로그 파일 등을 포함합니다.

6. 악용 및 권한 상승: 식별된 취약점을 악용하여 GCP 환경에 대한 권한 상승을 시도합니다. 이는 악용 가능한 취약점, 권한 상승 기술 및 테스트 계획을 포함합니다.

7. 후속 조치 및 보고서 작성: 펜테스팅 결과를 문서화하고 보고서를 작성합니다. 이는 취약점 설명, 영향도 평가, 권장 사항 및 보안 강화 조치 등을 포함합니다.

GCP 펜테스팅은 클라우드 환경에서의 보안 취약점을 식별하고 해결하기 위한 중요한 단계입니다. 이를 통해 기업 및 개발자들은 GCP 환경을 안전하게 운영할 수 있습니다.
```bash
export GOOGLE_DISCOVERY=$(echo 'google:
- file_path: ""

- file_path: ""
service_account_id: "some-sa-email@sidentifier.iam.gserviceaccount.com"' | base64)

python3 main.py -a -p google #Get basic info of the account to check it's correctly configured
python3 main.py -e -p google #Enumerate the env
```
{% endtab %}
{% endtabs %}

### [Prowler](https://github.com/prowler-cloud/prowler)

**AWS, GCP & Azure**를 지원합니다. 각 공급자를 구성하는 방법은 [https://docs.prowler.cloud/en/latest/#aws](https://docs.prowler.cloud/en/latest/#aws)에서 확인하세요.
```bash
# Install
pip install prowler
prowler -v

# Run
prowler <provider>
# Example
prowler aws --profile custom-profile [-M csv json json-asff html]

# Get info about checks & services
prowler <provider> --list-checks
prowler <provider> --list-services
```
### [CloudSploit](https://github.com/aquasecurity/cloudsploit)

AWS, Azure, Github, Google, Oracle, Alibaba

{% tabs %}
{% tab title="설치" %}
```bash
# Install
git clone https://github.com/aquasecurity/cloudsploit.git
cd cloudsploit
npm install
./index.js -h
## Docker instructions in github
```
{% endtab %}

{% tab title="GCP" %}GCP (Google Cloud Platform)은 Google의 클라우드 컴퓨팅 서비스입니다. GCP는 다양한 클라우드 기반 서비스를 제공하며, 기업 및 개발자들이 애플리케이션을 개발, 배포 및 관리할 수 있도록 도와줍니다.

GCP 펜테스팅 방법론은 다음과 같습니다.

1. 정보 수집: GCP 인스턴스, 서비스 및 구성 요소에 대한 정보를 수집합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Google Cloud SDK: GCP 리소스에 대한 명령줄 인터페이스를 제공합니다.
   - GCP 콘솔: GCP 리소스를 관리하기 위한 웹 기반 인터페이스입니다.
   - GCP API: GCP 리소스에 대한 프로그래밍 방식의 액세스를 제공합니다.

2. 서비스 및 구성 요소 분석: GCP에서 사용되는 서비스 및 구성 요소를 분석하여 취약점을 식별합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Google Cloud Security Scanner: 웹 애플리케이션의 취약점을 자동으로 탐지합니다.
   - Google Cloud IAM: GCP 리소스에 대한 액세스 권한을 관리합니다.
   - GCP 로깅 및 모니터링: GCP 리소스의 로그 및 모니터링 데이터를 분석합니다.

3. 인스턴스 및 서비스 테스트: GCP 인스턴스 및 서비스에 대한 테스트를 수행하여 취약점을 확인합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Nmap: 네트워크 스캐닝 및 서비스 탐지 도구입니다.
   - Nessus: 취약점 스캐너로서 GCP 리소스에 대한 취약점을 식별합니다.
   - Burp Suite: 웹 애플리케이션의 보안 취약점을 검사하는 도구입니다.

4. 권한 상승 및 데이터 누출: GCP 인스턴스 및 서비스에서 권한 상승 및 데이터 누출을 시도합니다. 이를 위해 다음과 같은 기술을 사용할 수 있습니다.
   - 권한 상승: 악용 가능한 권한을 활용하여 더 높은 권한을 얻습니다.
   - 데이터 누출: GCP 리소스에서 민감한 데이터를 누출합니다.

5. 후속 조치: 펜테스팅 후에는 취약점을 보고하고 조치를 취해야 합니다. 이를 위해 다음과 같은 절차를 따를 수 있습니다.
   - 취약점 보고서 작성: 발견된 취약점에 대한 상세한 보고서를 작성합니다.
   - 보안 패치 및 구성 변경: 취약점을 해결하기 위해 보안 패치를 적용하고 구성을 변경합니다.
   - 보안 교육 및 인식: 직원들에게 보안 교육을 제공하고 보안 인식을 높입니다.

GCP 펜테스팅 방법론을 따르면 GCP 환경에서 취약점을 식별하고 보안을 강화할 수 있습니다.
```bash
## You need to have creds for a service account and set them in config.js file
./index.js --cloud google --config </abs/path/to/config.js>
```
{% endtab %}
{% endtabs %}

### [ScoutSuite](https://github.com/nccgroup/ScoutSuite)

AWS, Azure, GCP, Alibaba Cloud, Oracle Cloud Infrastructure

{% tabs %}
{% tab title="설치" %}
```bash
mkdir scout; cd scout
virtualenv -p python3 venv
source venv/bin/activate
pip install scoutsuite
scout --help
## Using Docker: https://github.com/nccgroup/ScoutSuite/wiki/Docker-Image
```
{% endtab %}

{% tab title="GCP" %}GCP (Google Cloud Platform)은 Google의 클라우드 컴퓨팅 서비스입니다. GCP는 다양한 클라우드 기반 서비스를 제공하며, 기업 및 개발자들이 애플리케이션을 개발, 배포 및 관리할 수 있도록 도와줍니다.

GCP 펜테스팅 방법론은 다음과 같습니다.

1. 정보 수집: GCP 인스턴스, 서비스 및 구성 요소에 대한 정보를 수집합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Google Cloud SDK: GCP 리소스에 대한 명령줄 인터페이스를 제공합니다.
   - GCP 콘솔: GCP 리소스를 관리하기 위한 웹 기반 인터페이스입니다.
   - GCP API: GCP 리소스에 대한 프로그래밍 방식의 액세스를 제공합니다.

2. 서비스 및 구성 요소 분석: GCP에서 사용되는 서비스 및 구성 요소를 분석하여 취약점을 식별합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Google Cloud Security Scanner: 웹 애플리케이션의 취약점을 자동으로 탐지합니다.
   - Google Cloud IAM: GCP 리소스에 대한 액세스 권한을 관리합니다.
   - GCP 로깅 및 모니터링: GCP 리소스의 로그 및 모니터링 데이터를 분석합니다.

3. 인스턴스 및 서비스 테스트: GCP 인스턴스 및 서비스에 대한 테스트를 수행하여 취약점을 확인합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Nmap: 네트워크 스캐닝 및 서비스 탐지 도구입니다.
   - Nessus: 취약점 스캐너로서 GCP 리소스에 대한 취약점을 식별합니다.
   - Burp Suite: 웹 애플리케이션의 보안 취약점을 검사하는 도구입니다.

4. 권한 상승 및 데이터 누출: GCP 인스턴스 및 서비스에서 권한 상승 및 데이터 누출을 시도합니다. 이를 위해 다음과 같은 기술을 사용할 수 있습니다.
   - 권한 상승: 악용 가능한 권한을 활용하여 더 높은 권한을 얻습니다.
   - 데이터 누출: GCP 리소스에서 민감한 데이터를 누출합니다.

5. 후속 조치: 펜테스팅 후에는 취약점을 보고하고 조치를 취해야 합니다. 이를 위해 다음과 같은 절차를 따를 수 있습니다.
   - 취약점 보고서 작성: 발견된 취약점에 대한 상세한 보고서를 작성합니다.
   - 보안 패치 및 구성 변경: 취약점을 해결하기 위해 보안 패치를 적용하고 구성을 변경합니다.
   - 보안 교육 및 인식: 직원들에게 보안 교육을 제공하고 보안 인식을 높입니다.

이러한 GCP 펜테스팅 방법론을 따르면 GCP 환경에서의 취약점을 식별하고 보안을 강화할 수 있습니다.
```bash
scout gcp --report-dir /tmp/gcp --user-account --all-projects
## use "--service-account KEY_FILE" instead of "--user-account" to use a service account

SCOUT_FOLDER_REPORT="/tmp"
for pid in $(gcloud projects list --format="value(projectId)"); do
echo "================================================"
echo "Checking $pid"
mkdir "$SCOUT_FOLDER_REPORT/$pid"
scout gcp --report-dir "$SCOUT_FOLDER_REPORT/$pid" --no-browser --user-account --project-id "$pid"
done
```
{% endtab %}
{% endtabs %}

### [Steampipe](https://github.com/turbot)

{% tabs %}
{% tab title="설치" %}
Steampipe를 다운로드하고 설치하세요 ([https://steampipe.io/downloads](https://steampipe.io/downloads)). 또는 Brew를 사용하세요:
```
brew tap turbot/tap
brew install steampipe
```
{% endtab %}

{% tab title="GCP" %}GCP (Google Cloud Platform)은 Google의 클라우드 컴퓨팅 서비스입니다. GCP는 다양한 클라우드 기반 서비스를 제공하며, 기업 및 개발자들이 애플리케이션을 개발, 배포 및 관리할 수 있도록 도와줍니다.

GCP 펜테스팅 방법론은 다음과 같습니다:

1. 정보 수집: GCP 환경에 대한 정보를 수집합니다. 이는 도메인, IP 주소, 서비스 및 애플리케이션의 구성 요소, 엑세스 제어 및 인증 방법 등을 포함합니다.

2. 인증 및 권한 부여: GCP 환경에서 사용되는 인증 및 권한 부여 메커니즘을 이해하고 분석합니다. 이는 IAM (Identity and Access Management) 권한, 서비스 계정, 역할 및 권한 부여 정책 등을 포함합니다.

3. 네트워크 스캐닝: GCP 환경의 네트워크 구성을 스캔하여 취약점을 식별합니다. 이는 포트 스캐닝, 서비스 및 애플리케이션의 구성 요소 분석, 보안 그룹 및 방화벽 설정 등을 포함합니다.

4. 애플리케이션 스캐닝: GCP 환경에서 실행되는 애플리케이션을 스캔하여 취약점을 식별합니다. 이는 웹 애플리케이션 취약점, API 취약점, 데이터 노출 등을 포함합니다.

5. 데이터 스캐닝: GCP 환경에서 저장되는 데이터를 스캔하여 민감한 정보 노출을 식별합니다. 이는 데이터베이스, 스토리지 및 로그 파일 등을 포함합니다.

6. 악용 및 권한 상승: 식별된 취약점을 악용하여 GCP 환경에 대한 권한 상승을 시도합니다. 이는 악용 가능한 취약점, 권한 상승 기술 및 테스트 계획을 포함합니다.

7. 후속 조치 및 보고서 작성: 펜테스팅 결과를 문서화하고 보고서를 작성합니다. 이는 취약점 설명, 영향도 평가, 권장 사항 및 보안 강화 조치 등을 포함합니다.

GCP 펜테스팅은 클라우드 환경에서의 보안 취약점을 식별하고 해결하기 위한 중요한 단계입니다. 이를 통해 기업 및 개발자들은 GCP 환경을 안전하게 운영할 수 있습니다.
```bash
# Install gcp plugin
steampipe plugin install gcp

# Use https://github.com/turbot/steampipe-mod-gcp-compliance.git
git clone https://github.com/turbot/steampipe-mod-gcp-compliance.git
cd steampipe-mod-gcp-compliance
# To run all the checks from the dashboard
steampipe dashboard
# To run all the checks from rhe cli
steampipe check all
```
<details>

<summary>모든 프로젝트 확인하기</summary>

모든 프로젝트를 확인하려면 테스트할 모든 프로젝트를 지정하는 `gcp.spc` 파일을 생성해야 합니다. 다음 스크립트의 지시에 따라 진행할 수 있습니다.
```bash
FILEPATH="/tmp/gcp.spc"
rm -rf "$FILEPATH" 2>/dev/null

# Generate a json like object for each project
for pid in $(gcloud projects list --format="value(projectId)"); do
echo "connection \"gcp_$(echo -n $pid | tr "-" "_" )\" {
plugin  = \"gcp\"
project = \"$pid\"
}" >> "$FILEPATH"
done

# Generate the aggragator to call
echo 'connection "gcp_all" {
plugin      = "gcp"
type        = "aggregator"
connections = ["gcp_*"]
}' >> "$FILEPATH"

echo "Copy $FILEPATH in ~/.steampipe/config/gcp.spc if it was correctly generated"
```
</details>

**다른 GCP 인사이트**를 확인하려면 (서비스 열거에 유용함) 다음을 사용하십시오: [https://github.com/turbot/steampipe-mod-gcp-insights](https://github.com/turbot/steampipe-mod-gcp-insights)

Terraform GCP 코드를 확인하려면: [https://github.com/turbot/steampipe-mod-terraform-gcp-compliance](https://github.com/turbot/steampipe-mod-terraform-gcp-compliance)

Steampipe의 추가 GCP 플러그인: [https://github.com/turbot?q=gcp](https://github.com/turbot?q=gcp)
{% endtab %}

{% tab title="AWS" %}
```bash
# Install aws plugin
steampipe plugin install aws

# Modify the spec indicating in "profile" the profile name to use
nano ~/.steampipe/config/aws.spc

# Get some info on how the AWS account is being used
git clone https://github.com/turbot/steampipe-mod-aws-insights.git
cd steampipe-mod-aws-insights
steampipe dashboard

# Get the services exposed to the internet
git clone https://github.com/turbot/steampipe-mod-aws-perimeter.git
cd steampipe-mod-aws-perimeter
steampipe dashboard

# Run the benchmarks
git clone https://github.com/turbot/steampipe-mod-aws-compliance
cd steampipe-mod-aws-compliance
steampipe dashboard # To see results in browser
steampipe check all --export=/tmp/output4.json
```
Terraform AWS 코드를 확인하려면: [https://github.com/turbot/steampipe-mod-terraform-aws-compliance](https://github.com/turbot/steampipe-mod-terraform-aws-compliance)

Steampipe의 추가 AWS 플러그인: [https://github.com/orgs/turbot/repositories?q=aws](https://github.com/orgs/turbot/repositories?q=aws)
{% endtab %}
{% endtabs %}

### [~~cs-suite~~](https://github.com/SecurityFTW/cs-suite)

AWS, GCP, Azure, DigitalOcean.\
python2.7이 필요하며 유지보수되지 않는 것 같습니다.

### Nessus

Nessus는 AWS, Azure, Office 365, Rackspace, Salesforce를 지원하는 _**Audit Cloud Infrastructure**_ 스캔을 제공합니다. **Azure**에서는 **Client Id**를 얻기 위해 추가 구성이 필요합니다.

### [**cloudlist**](https://github.com/projectdiscovery/cloudlist)

Cloudlist는 클라우드 제공업체에서 자산(호스트명, IP 주소)을 가져오기 위한 **멀티 클라우드 도구**입니다.

{% tabs %}
{% tab title="Cloudlist" %}
```bash
cd /tmp
wget https://github.com/projectdiscovery/cloudlist/releases/latest/download/cloudlist_1.0.1_macOS_arm64.zip
unzip cloudlist_1.0.1_macOS_arm64.zip
chmod +x cloudlist
sudo mv cloudlist /usr/local/bin
```
{% endtab %}

{% tab title="두 번째 탭" %}
```bash
## For GCP it requires service account JSON credentials
cloudlist -config </path/to/config>
```
{% endtab %}
{% endtabs %}

### [**cartography**](https://github.com/lyft/cartography)

Cartography는 Neo4j 데이터베이스를 기반으로 한 직관적인 그래프 뷰에서 인프라 자산과 그들 간의 관계를 통합하는 파이썬 도구입니다.

{% tabs %}
{% tab title="설치" %}
```bash
# Installation
docker image pull ghcr.io/lyft/cartography
docker run --platform linux/amd64 ghcr.io/lyft/cartography cartography --help
## Install a Neo4j DB version 3.5.*
```
{% endtab %}

{% tab title="GCP" %}GCP (Google Cloud Platform)은 Google의 클라우드 컴퓨팅 서비스입니다. GCP는 다양한 클라우드 기반 서비스를 제공하며, 기업 및 개발자들이 애플리케이션을 개발, 배포 및 관리할 수 있도록 도와줍니다.

GCP 펜테스팅 방법론은 다음과 같습니다.

1. 정보 수집: GCP 인스턴스, 서비스 및 구성 요소에 대한 정보를 수집합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Google Cloud SDK: GCP 리소스에 대한 명령줄 인터페이스를 제공합니다.
   - GCP 콘솔: GCP 리소스를 관리하기 위한 웹 기반 인터페이스입니다.
   - GCP API: GCP 리소스에 대한 프로그래밍 방식의 액세스를 제공합니다.

2. 서비스 및 구성 요소 분석: GCP에서 사용되는 서비스 및 구성 요소를 분석하여 취약점을 식별합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Google Cloud Security Scanner: 웹 애플리케이션의 취약점을 자동으로 탐지합니다.
   - Google Cloud IAM: GCP 리소스에 대한 액세스 권한을 관리합니다.
   - GCP 로깅 및 모니터링: GCP 리소스의 로그 및 모니터링 데이터를 분석합니다.

3. 인스턴스 및 서비스 테스트: GCP 인스턴스 및 서비스에 대한 테스트를 수행하여 취약점을 확인합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Nmap: 네트워크 스캐닝 및 서비스 탐지 도구입니다.
   - Nessus: 취약점 스캐너로서 GCP 리소스에 대한 취약점을 식별합니다.
   - Burp Suite: 웹 애플리케이션의 보안 취약점을 검사하는 도구입니다.

4. 권한 상승 및 데이터 누출: GCP 인스턴스 및 서비스에서 권한 상승 및 데이터 누출을 시도합니다. 이를 위해 다음과 같은 기술을 사용할 수 있습니다.
   - 권한 상승: 악용 가능한 권한을 활용하여 더 높은 권한을 얻습니다.
   - 데이터 누출: GCP 리소스에서 민감한 데이터를 누출합니다.

5. 후속 조치: 펜테스팅 후에는 취약점을 보고하고 조치를 취해야 합니다. 이를 위해 다음과 같은 절차를 따를 수 있습니다.
   - 취약점 보고서 작성: 발견된 취약점에 대한 상세한 보고서를 작성합니다.
   - 보안 패치 및 구성 변경: 취약점을 해결하기 위해 보안 패치를 적용하고 구성을 변경합니다.
   - 보안 교육 및 인식: 직원들에게 보안 교육을 제공하고 보안 인식을 높입니다.

이러한 GCP 펜테스팅 방법론을 따르면 GCP 환경에서의 취약점을 식별하고 보안을 강화할 수 있습니다.
```bash
docker run --platform linux/amd64 \
--volume "$HOME/.config/gcloud/application_default_credentials.json:/application_default_credentials.json" \
-e GOOGLE_APPLICATION_CREDENTIALS="/application_default_credentials.json" \
-e NEO4j_PASSWORD="s3cr3t" \
ghcr.io/lyft/cartography  \
--neo4j-uri bolt://host.docker.internal:7687 \
--neo4j-password-env-var NEO4j_PASSWORD \
--neo4j-user neo4j


# It only checks for a few services inside GCP (https://lyft.github.io/cartography/modules/gcp/index.html)
## Cloud Resource Manager
## Compute
## DNS
## Storage
## Google Kubernetes Engine
### If you can run starbase or purplepanda you will get more info
```
{% endtab %}
{% endtabs %}

### [**starbase**](https://github.com/JupiterOne/starbase)

Starbase는 클라우드 인프라, SaaS 애플리케이션, 보안 제어 등의 서비스 및 시스템에서 자산과 관계를 수집하여 Neo4j 데이터베이스를 기반으로 직관적인 그래프 뷰로 표시합니다.

{% tabs %}
{% tab title="설치" %}
```bash
# You are going to need Node version 14, so install nvm following https://tecadmin.net/install-nvm-macos-with-homebrew/
npm install --global yarn
nvm install 14
git clone https://github.com/JupiterOne/starbase.git
cd starbase
nvm use 14
yarn install
yarn starbase --help
# Configure manually config.yaml depending on the env to analyze
yarn starbase setup
yarn starbase run

# Docker
git clone https://github.com/JupiterOne/starbase.git
cd starbase
cp config.yaml.example config.yaml
# Configure manually config.yaml depending on the env to analyze
docker build --no-cache -t starbase:latest .
docker-compose run starbase setup
docker-compose run starbase run
```
{% endtab %}

{% tab title="GCP" %}GCP (Google Cloud Platform)은 Google의 클라우드 컴퓨팅 서비스입니다. GCP는 다양한 클라우드 기반 서비스를 제공하며, 기업 및 개발자들이 애플리케이션을 개발, 배포 및 관리할 수 있도록 도와줍니다.

GCP 펜테스팅 방법론은 다음과 같습니다.

1. 정보 수집: GCP 인스턴스, 서비스 및 구성 요소에 대한 정보를 수집합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Google Cloud SDK: GCP 리소스에 대한 명령줄 인터페이스를 제공합니다.
   - GCP 콘솔: GCP 리소스를 관리하기 위한 웹 기반 인터페이스입니다.
   - GCP API: GCP 리소스에 대한 프로그래밍 방식의 액세스를 제공합니다.

2. 서비스 및 구성 요소 분석: GCP에서 사용되는 서비스 및 구성 요소를 분석하여 취약점을 식별합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Google Cloud Security Scanner: 웹 애플리케이션의 취약점을 자동으로 탐지합니다.
   - Google Cloud IAM: GCP 리소스에 대한 액세스 권한을 관리합니다.
   - GCP 로깅 및 모니터링: GCP 리소스의 로그 및 모니터링 데이터를 분석합니다.

3. 인스턴스 및 서비스 테스트: GCP 인스턴스 및 서비스에 대한 테스트를 수행하여 취약점을 확인합니다. 이를 위해 다음과 같은 도구를 사용할 수 있습니다.
   - Nmap: 네트워크 스캐닝 및 서비스 탐지 도구입니다.
   - Burp Suite: 웹 애플리케이션 보안 테스트 도구입니다.
   - Nessus: 취약점 스캐너 도구입니다.

4. 권한 상승 및 데이터 유출: GCP 인스턴스 및 서비스에서 권한 상승 및 데이터 유출을 시도합니다. 이를 위해 다음과 같은 기술을 사용할 수 있습니다.
   - 권한 상승: 악용 가능한 권한을 활용하여 더 높은 권한을 얻습니다.
   - 데이터 유출: 민감한 데이터를 탈취하거나 노출합니다.

5. 후속 조치: 펜테스팅 후에는 취약점을 보고하고 조치를 취해야 합니다. 이를 위해 다음과 같은 절차를 따를 수 있습니다.
   - 취약점 보고서 작성: 발견된 취약점에 대한 상세한 보고서를 작성합니다.
   - 취약점 해결: 발견된 취약점을 해결하고 보안 조치를 적용합니다.
   - 보안 감사: 보안 감사를 수행하여 취약점이 완전히 해결되었는지 확인합니다.

GCP 펜테스팅 방법론을 따르면 GCP 환경에서 취약점을 식별하고 보안을 강화할 수 있습니다.
```yaml
## Config for GCP
### Check out: https://github.com/JupiterOne/graph-google-cloud/blob/main/docs/development.md
### It requires service account credentials

integrations:
-
name: graph-google-cloud
instanceId: testInstanceId
directory: ./.integrations/graph-google-cloud
gitRemoteUrl: https://github.com/JupiterOne/graph-google-cloud.git
config:
SERVICE_ACCOUNT_KEY_FILE: '{Check https://github.com/JupiterOne/graph-google-cloud/blob/main/docs/development.md#service_account_key_file-string}'
PROJECT_ID: ""
FOLDER_ID: ""
ORGANIZATION_ID: ""
CONFIGURE_ORGANIZATION_PROJECTS: false

storage:
engine: neo4j
config:
username: neo4j
password: s3cr3t
uri: bolt://localhost:7687
#Consider using host.docker.internal if from docker
```
{% endtab %}
{% endtabs %}

### [**SkyArk**](https://github.com/cyberark/SkyArk)

스캔된 AWS 또는 Azure 환경에서 가장 권한이 있는 사용자를 발견하십시오. 이는 powershell을 사용합니다.
```powershell
Import-Module .\SkyArk.ps1 -force
Start-AzureStealth

# in the Cloud Console
IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/cyberark/SkyArk/master/AzureStealth/AzureStealth.ps1')
Scan-AzureAdmins
```
### [Cloud Brute](https://github.com/0xsha/CloudBrute)

회사(대상)의 인프라, 파일 및 앱을 주요 클라우드 제공업체(Amazon, Google, Microsoft, DigitalOcean, Alibaba, Vultr, Linode)에서 찾는 도구입니다.

### [CloudFox](https://github.com/BishopFox/cloudfox)

* CloudFox는 클라우드 인프라에서 취약한 공격 경로를 찾는 도구입니다(현재 AWS 및 Azure만 지원하며 GCP도 곧 지원될 예정입니다).
* 이는 수동 펜테스팅을 보완하기 위한 열거 도구입니다.
* 클라우드 환경 내에서 데이터를 생성하거나 수정하지 않습니다.

### 클라우드 보안 도구 목록

* [https://github.com/RyanJarv/awesome-cloud-sec](https://github.com/RyanJarv/awesome-cloud-sec)

## Google

### GCP

{% content-ref url="gcp-security/" %}
[gcp-security](gcp-security/)
{% endcontent-ref %}

### Workspace

{% content-ref url="workspace-security/" %}
[workspace-security](workspace-security/)
{% endcontent-ref %}

## AWS

{% content-ref url="aws-security/" %}
[aws-security](aws-security/)
{% endcontent-ref %}

## Azure

{% content-ref url="azure-security/" %}
[azure-security](azure-security/)
{% endcontent-ref %}

### 공격 그래프

[**Stormspotter** ](https://github.com/Azure/Stormspotter)는 Azure 구독의 리소스를 "공격 그래프"로 생성합니다. 이를 통해 레드 팀 및 펜테스터는 테넌트 내의 공격 표면과 피벗 기회를 시각화할 수 있으며, 수비자는 사고 대응 작업을 신속하게 정렬하고 우선순위를 지정할 수 있습니다.

### Office365

**Global Admin** 또는 적어도 **Global Admin Reader** 권한이 필요합니다(단, Global Admin Reader는 약간 제한적입니다). 그러나 이러한 제한은 일부 PS 모듈에서 나타나며, 웹 응용 프로그램을 통해 기능에 접근하여 우회할 수 있습니다.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사를 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
