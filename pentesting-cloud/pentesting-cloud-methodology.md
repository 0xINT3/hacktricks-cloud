## M√©thodologie de test de p√©n√©tration Cloud

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'exclusifs [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../.gitbook/assets/CLOUD-logo-letters.svg" alt=""><figcaption></figcaption></figure>

## M√©thodologie de base

Chaque cloud a ses propres particularit√©s, mais en g√©n√©ral, il y a quelques **choses communes qu'un testeur de p√©n√©tration devrait v√©rifier** lors du test d'un environnement cloud :

* **V√©rifications de r√©f√©rence**
  * Cela vous aidera √† **comprendre la taille** de l'environnement et les **services utilis√©s**
  * Cela vous permettra √©galement de trouver rapidement certaines **mauvaises configurations** car vous pouvez effectuer la plupart de ces tests avec des outils **automatis√©s**
* **√ânum√©ration des services**
  * Vous ne trouverez probablement pas beaucoup plus de mauvaises configurations ici si vous avez correctement effectu√© les tests de r√©f√©rence, mais vous pourriez en trouver certaines qui n'ont pas √©t√© recherch√©es dans le test de r√©f√©rence.
  * Cela vous permettra de savoir **ce qui est exactement utilis√©** dans l'environnement cloud
  * Cela aidera beaucoup dans les √©tapes suivantes
* **V√©rifier les actifs expos√©s**
  * Cela peut √™tre fait pendant la section pr√©c√©dente, vous devez **d√©couvrir tout ce qui est potentiellement expos√©** √† Internet d'une mani√®re ou d'une autre et comment y acc√©der.
    * Ici, je prends **l'infrastructure expos√©e manuellement** comme des instances avec des pages Web ou d'autres ports expos√©s, et aussi sur d'autres **services g√©r√©s dans le cloud qui peuvent √™tre configur√©s** pour √™tre expos√©s (comme les bases de donn√©es ou les compartiments)
  * Ensuite, vous devez v√©rifier **si cette ressource peut √™tre expos√©e ou non** (informations confidentielles ? vuln√©rabilit√©s ? mauvaises configurations dans le service expos√© ?)
* **V√©rifier les autorisations**
  * Ici, vous devriez **d√©couvrir toutes les autorisations de chaque r√¥le / utilisateur** √† l'int√©rieur du cloud et comment elles sont utilis√©es
    * Trop **de comptes hautement privil√©gi√©s** (contr√¥le de tout) ? Cl√©s g√©n√©r√©es non utilis√©es ?... La plupart de ces v√©rifications devraient d√©j√† avoir √©t√© effectu√©es dans les tests de r√©f√©rence
    * Si le client utilise OpenID ou SAML ou d'autres **f√©d√©rations**, vous devrez peut-√™tre leur demander des **informations** suppl√©mentaires sur **comment chaque r√¥le est attribu√©** (ce n'est pas la m√™me chose que le r√¥le d'administrateur est attribu√© √† 1 utilisateur ou √† 100)
  * Il **n'est pas suffisant de trouver** quels utilisateurs ont des autorisations **d'administrateur** "\*:\*". Il y a beaucoup d'**autres autorisations** qui, selon les services utilis√©s, peuvent √™tre tr√®s **sensibles**.
    * De plus, il y a des **moyens potentiels de privesc** √† suivre en abusant des autorisations. Toutes ces choses doivent √™tre prises en compte et **autant de chemins de privesc que possible** doivent √™tre signal√©s.
* **V√©rifier les int√©grations**
  * Il est tr√®s probable que **des int√©grations avec d'autres clouds ou SaaS** soient utilis√©es dans l'environnement cloud.
    * Pour les **int√©grations du cloud que vous auditez** avec d'autres plateformes, vous devez notifier **qui a acc√®s √† (ab)user cette int√©gration** et vous devez demander **√† quel point l'action effectu√©e est sensible**.\
      Par exemple, qui peut √©crire dans un compartiment AWS o√π GCP r√©cup√®re des donn√©es (demandez √† quel point l'action est sensible dans GCP traitant ces donn√©es).
    * Pour les **int√©grations √† l'int√©rieur du cloud que vous auditez** √† partir de plates-formes externes, vous devez demander **qui a acc√®s de mani√®re externe √† (ab)user cette int√©gration** et v√©rifier comment ces donn√©es sont utilis√©es.\
      Par exemple, si un service utilise une image Docker h√©berg√©e dans GCR, vous devez demander qui a acc√®s pour la modifier et quelles informations sensibles et acc√®s obtiendra cette image lorsqu'elle sera ex√©cut√©e √† l'int√©rieur d'un cloud AWS.

## Outils multi-cloud

Il existe plusieurs outils qui peuvent √™tre utilis√©s pour tester diff√©rents environnements cloud. Les √©tapes d'installation et les liens seront indiqu√©s dans cette section.

### [PurplePanda](https://github.com/carlospolop/purplepanda)

Un outil pour **identifier les mauvaises configurations et les chemins de privesc dans les clouds et entre les clouds / SaaS.** 

{% tabs %}
{% tab title="Installer" %}
```bash
# You need to install and run neo4j also
git clone https://github.com/carlospolop/PurplePanda
cd PurplePanda
python3 -m venv .
source bin/activate
python3 -m pip install -r requirements.txt
export PURPLEPANDA_NEO4J_URL="bolt://neo4j@localhost:7687"
export PURPLEPANDA_PWD="neo4j_pwd_4_purplepanda"
python3 main.py -h # Get help
```
{% endtab %}

{% tab title="GCP" %}
## M√©thodologie de test de p√©n√©tration pour GCP

La m√©thodologie de test de p√©n√©tration pour GCP est similaire √† celle d'AWS. Les √©tapes sont les suivantes :

1. **Collecte d'informations** : collectez des informations sur la cible, telles que les adresses IP, les noms de domaine, les sous-domaines, les enregistrements DNS, les certificats SSL, les adresses e-mail, les noms d'utilisateur, les num√©ros de t√©l√©phone, etc.

2. **Recherche de vuln√©rabilit√©s** : utilisez des outils automatis√©s pour rechercher des vuln√©rabilit√©s connues, telles que les vuln√©rabilit√©s de syst√®me d'exploitation, les vuln√©rabilit√©s de serveur Web, les vuln√©rabilit√©s de base de donn√©es, etc.

3. **Test d'authentification** : testez l'authentification de la cible en essayant de deviner les noms d'utilisateur et les mots de passe, en utilisant des attaques de force brute, des attaques de dictionnaire, des attaques de phishing, etc.

4. **Test d'autorisation** : testez l'autorisation de la cible en essayant d'acc√©der √† des ressources qui ne devraient pas √™tre accessibles, en utilisant des attaques de contournement d'autorisation, des attaques de divulgation d'informations, etc.

5. **Test de configuration** : testez la configuration de la cible en v√©rifiant si les param√®tres de s√©curit√© sont correctement configur√©s, tels que les pare-feu, les listes de contr√¥le d'acc√®s, les politiques de s√©curit√©, etc.

6. **Test de fuite d'informations** : testez la cible pour les fuites d'informations en recherchant des informations sensibles qui pourraient √™tre expos√©es, telles que les informations d'identification, les informations de carte de cr√©dit, les informations de sant√©, etc.

7. **Test de s√©curit√© des applications** : testez les applications h√©berg√©es sur la cible pour les vuln√©rabilit√©s de s√©curit√©, telles que les injections SQL, les attaques XSS, les attaques CSRF, etc.

8. **Test de s√©curit√© du r√©seau** : testez la s√©curit√© du r√©seau de la cible en recherchant des vuln√©rabilit√©s telles que les ports ouverts, les services vuln√©rables, les attaques de d√©ni de service, etc.

9. **Test de s√©curit√© physique** : testez la s√©curit√© physique de la cible en essayant d'acc√©der aux locaux de la cible, en utilisant des techniques telles que le social engineering, le vol de badge, etc.

10. **Rapport de r√©sultats** : compilez les r√©sultats des tests de p√©n√©tration dans un rapport d√©taill√©, y compris les vuln√©rabilit√©s trouv√©es, les risques associ√©s, les recommandations de correction, etc.

Il est important de noter que la m√©thodologie de test de p√©n√©tration doit √™tre adapt√©e √† chaque cible sp√©cifique, en fonction de ses caract√©ristiques et de ses exigences de s√©curit√©.
```bash
export GOOGLE_DISCOVERY=$(echo 'google:
- file_path: ""

- file_path: ""
  service_account_id: "some-sa-email@sidentifier.iam.gserviceaccount.com"' | base64)

python3 main.py -a -p google #Get basic info of the account to check it's correctly configured
python3 main.py -e -p google #Enumerate the env
```
### [CloudSploit](https://github.com/aquasecurity/cloudsploit)

AWS, Azure, Github, Google, Oracle, Alibaba

{% tabs %}
{% tab title="Installer" %}
### Installation

```bash
git clone https://github.com/aquasecurity/cloudsploit.git
cd cloudsploit
./install.sh
```

### Configuration

```bash
cp config.json.example config.json
```

Edit `config.json` with your AWS credentials.

### Usage

```bash
./cloudsploit.sh
```
{% endtab %}
{% endtabs %}
```bash
# Install
git clone https://github.com/aquasecurity/cloudsploit.git
cd cloudsploit
npm install
./index.js -h
## Docker instructions in github
```
{% endtab %}

{% tab title="GCP" %}
## M√©thodologie de test de p√©n√©tration pour GCP

### 1. Collecte d'informations

La collecte d'informations est la premi√®re √©tape de tout test de p√©n√©tration. Les informations collect√©es peuvent √™tre utilis√©es pour identifier les vuln√©rabilit√©s et les points faibles du syst√®me. Les informations peuvent √™tre collect√©es √† partir de sources telles que :

- Enregistrements DNS
- Enregistrements WHOIS
- Enregistrements de certificats SSL
- Enregistrements de domaine
- Enregistrements de sous-domaine
- Enregistrements de serveur de messagerie
- Enregistrements de serveur de noms

### 2. Analyse des vuln√©rabilit√©s

L'analyse des vuln√©rabilit√©s est la deuxi√®me √©tape de tout test de p√©n√©tration. Cette √©tape consiste √† identifier les vuln√©rabilit√©s et les points faibles du syst√®me. Les vuln√©rabilit√©s peuvent √™tre identifi√©es √† l'aide d'outils tels que :

- Nmap
- Nessus
- OpenVAS
- Metasploit

### 3. Exploitation des vuln√©rabilit√©s

L'exploitation des vuln√©rabilit√©s est la troisi√®me √©tape de tout test de p√©n√©tration. Cette √©tape consiste √† exploiter les vuln√©rabilit√©s identifi√©es pour acc√©der au syst√®me. Les vuln√©rabilit√©s peuvent √™tre exploit√©es √† l'aide d'outils tels que :

- Metasploit
- ExploitDB
- SearchSploit

### 4. √âlaboration de rapports

L'√©laboration de rapports est la derni√®re √©tape de tout test de p√©n√©tration. Cette √©tape consiste √† documenter les r√©sultats du test de p√©n√©tration et √† fournir des recommandations pour am√©liorer la s√©curit√© du syst√®me. Les rapports peuvent √™tre √©labor√©s √† l'aide d'outils tels que :

- Dradis
- Metasploit
- Nessus
- OpenVAS

Une fois que les rapports ont √©t√© √©labor√©s, ils doivent √™tre pr√©sent√©s aux parties prenantes pour discuter des r√©sultats et des recommandations.
```bash
## You need to have creds for a service account and set them in config.js file
./index.js --cloud google --config </abs/path/to/config.js>
```
### [ScoutSuite](https://github.com/nccgroup/ScoutSuite)

AWS, Azure, GCP, Alibaba Cloud, Oracle Cloud Infrastructure

{% tabs %}
{% tab title="Installer" %}
```bash
pip install scoutsuite
```
{% endtab %}

{% tab title="Ex√©cuter" %}
```bash
scout aws -a <ACCESS_KEY> -s <SECRET_KEY> -r <REGION>
```
{% endtab %}
{% endtabs %}

ScoutSuite est un outil open source qui permet de r√©aliser des audits de s√©curit√© sur les plateformes cloud telles que AWS, Azure, GCP, Alibaba Cloud et Oracle Cloud Infrastructure. Il est facile √† installer en utilisant la commande `pip install scoutsuite`. Pour l'ex√©cuter, il suffit de lancer la commande `scout aws -a <ACCESS_KEY> -s <SECRET_KEY> -r <REGION>` en rempla√ßant les valeurs `<ACCESS_KEY>`, `<SECRET_KEY>` et `<REGION>` par les informations d'identification et la r√©gion appropri√©es.
```bash
mkdir scout; cd scout
virtualenv -p python3 venv
source venv/bin/activate
pip install scoutsuite
scout --help
## Using Docker: https://github.com/nccgroup/ScoutSuite/wiki/Docker-Image
```
{% endtab %}

{% tab title="GCP" %}
## M√©thodologie de test de p√©n√©tration pour GCP

La m√©thodologie de test de p√©n√©tration pour GCP est similaire √† celle d'AWS. Les √©tapes sont les suivantes :

1. **Collecte d'informations** : collectez des informations sur la cible, telles que les adresses IP, les noms de domaine, les sous-domaines, les enregistrements DNS, les certificats SSL, les adresses e-mail, les noms d'utilisateur, les mots de passe, etc.

2. **Recherche de vuln√©rabilit√©s** : utilisez des outils automatis√©s pour rechercher des vuln√©rabilit√©s connues, telles que les vuln√©rabilit√©s de syst√®me d'exploitation, les vuln√©rabilit√©s de serveur Web, les vuln√©rabilit√©s de base de donn√©es, etc.

3. **Test d'authentification** : testez l'authentification de la cible en essayant de deviner les noms d'utilisateur et les mots de passe, en utilisant des attaques de force brute, des attaques de dictionnaire, des attaques de phishing, etc.

4. **Test d'autorisation** : testez l'autorisation de la cible en essayant d'acc√©der √† des ressources qui ne devraient pas √™tre accessibles, en utilisant des attaques de manipulation de param√®tres, des attaques de contournement d'autorisation, etc.

5. **Test de configuration** : testez la configuration de la cible en v√©rifiant si les param√®tres de s√©curit√© sont correctement configur√©s, tels que les pare-feu, les listes de contr√¥le d'acc√®s, les politiques de s√©curit√©, etc.

6. **Test de fuite d'informations** : testez la cible pour les fuites d'informations en cherchant des informations sensibles qui pourraient √™tre expos√©es, telles que les informations d'identification, les informations de carte de cr√©dit, les informations de sant√©, etc.

7. **Test de d√©ni de service** : testez la cible pour les vuln√©rabilit√©s de d√©ni de service en essayant de surcharger les ressources de la cible, telles que la bande passante, la m√©moire, le processeur, etc.

8. **Test de s√©curit√© physique** : testez la s√©curit√© physique de la cible en essayant d'acc√©der physiquement aux locaux de la cible, en utilisant des techniques telles que le vol de badge, le vol de poubelle, etc.

9. **Rapport de r√©sultats** : compilez un rapport d√©taill√© des r√©sultats du test de p√©n√©tration, y compris les vuln√©rabilit√©s trouv√©es, les risques associ√©s, les recommandations de correction, etc.

Il est important de noter que la m√©thodologie de test de p√©n√©tration doit √™tre adapt√©e √† chaque environnement de cloud sp√©cifique, en fonction des caract√©ristiques et des fonctionnalit√©s de la plateforme.
```bash
scout gcp --report-dir /tmp/gcp --user-account --all-projects
## use "--service-account KEY_FILE" instead of "--user-account" to use a service account

SCOUT_FOLDER_REPORT="/tmp"
for pid in $(gcloud projects list --format="value(projectId)"); do
    echo "================================================"
    echo "Checking $pid"
    mkdir "$SCOUT_FOLDER_REPORT/$pid"
    scout gcp --report-dir "$SCOUT_FOLDER_REPORT/$pid" --no-browser --user-account --project-id "$pid"
done
```
{% endtab %}
{% endtabs %}

### [Steampipe](https://github.com/turbot)

{% tabs %}
{% tab title="Installer" %}
T√©l√©chargez et installez Steampipe ([https://steampipe.io/downloads](https://steampipe.io/downloads)). Ou utilisez Brew:
```
brew tap turbot/tap
brew install steampipe
```
{% endtab %}

{% tab title="GCP" %}
## M√©thodologie de test de p√©n√©tration pour GCP

### 1. Collecte d'informations

La collecte d'informations est la premi√®re √©tape de tout test de p√©n√©tration. Les informations collect√©es peuvent √™tre utilis√©es pour identifier les vuln√©rabilit√©s et les points faibles du syst√®me. Les informations peuvent √™tre collect√©es √† partir de sources telles que :

- Enregistrements DNS
- Enregistrements WHOIS
- Sites Web publics
- Outils de reconnaissance de port
- Outils de reconnaissance de vuln√©rabilit√©s

### 2. Analyse des vuln√©rabilit√©s

Une fois que les informations ont √©t√© collect√©es, la prochaine √©tape consiste √† analyser les vuln√©rabilit√©s. Les vuln√©rabilit√©s peuvent √™tre identifi√©es √† l'aide d'outils de num√©risation de vuln√©rabilit√©s tels que Nessus, OpenVAS, etc. Les vuln√©rabilit√©s peuvent √©galement √™tre identifi√©es manuellement en examinant les configurations de s√©curit√© et les param√®tres du syst√®me.

### 3. Exploitation des vuln√©rabilit√©s

Une fois que les vuln√©rabilit√©s ont √©t√© identifi√©es, la prochaine √©tape consiste √† les exploiter. Les vuln√©rabilit√©s peuvent √™tre exploit√©es √† l'aide d'outils d'exploitation tels que Metasploit, Nmap, etc. Les vuln√©rabilit√©s peuvent √©galement √™tre exploit√©es manuellement en utilisant des scripts personnalis√©s.

### 4. √âl√©vation de privil√®ges

Une fois que l'acc√®s initial a √©t√© obtenu, la prochaine √©tape consiste √† √©lever les privil√®ges. Les privil√®ges peuvent √™tre √©lev√©s en exploitant des vuln√©rabilit√©s du syst√®me ou en utilisant des techniques d'ing√©nierie sociale pour obtenir des informations d'identification.

### 5. Maintien de l'acc√®s

Une fois que l'acc√®s a √©t√© obtenu et les privil√®ges ont √©t√© √©lev√©s, la prochaine √©tape consiste √† maintenir l'acc√®s. Cela peut √™tre fait en installant des backdoors ou en cr√©ant des comptes d'utilisateur suppl√©mentaires.

### 6. Effacement des traces

La derni√®re √©tape consiste √† effacer les traces de l'attaque. Cela peut √™tre fait en supprimant les journaux d'activit√© et en supprimant les fichiers compromis. Il est important de noter que l'effacement des traces est ill√©gal dans de nombreux pays et peut entra√Æner des poursuites judiciaires.
```bash
# Install gcp plugin
steampipe plugin install gcp

# Use https://github.com/turbot/steampipe-mod-gcp-compliance.git
git clone https://github.com/turbot/steampipe-mod-gcp-compliance.git
cd steampipe-mod-gcp-compliance
# To run all the checks from the dashboard
steampipe dashboard
# To run all the checks from rhe cli
steampipe check all
```
<details>

<summary>V√©rifier tous les projets</summary>

Afin de v√©rifier tous les projets, vous devez g√©n√©rer le fichier `gcp.spc` indiquant tous les projets √† tester. Vous pouvez simplement suivre les indications du script suivant.
```bash
FILEPATH="/tmp/gcp.spc"
rm -rf "$FILEPATH" 2>/dev/null

# Generate a json like object for each project
for pid in $(gcloud projects list --format="value(projectId)"); do
echo "connection \"gcp_$(echo -n $pid | tr "-" "_" )\" {
    plugin  = \"gcp\"
    project = \"$pid\"
}" >> "$FILEPATH"
done

# Generate the aggragator to call
echo 'connection "gcp_all" {
  plugin      = "gcp" 
  type        = "aggregator"
  connections = ["gcp_*"]
}' >> "$FILEPATH"

echo "Copy $FILEPATH in ~/.steampipe/config/gcp.spc if it was correctly generated"
```
</details>

Pour v√©rifier **d'autres informations AWS** (utiles pour l'√©num√©ration des services), utilisez : [https://github.com/turbot/steampipe-mod-aws-insights](https://github.com/turbot/steampipe-mod-aws-insights)

Pour v√©rifier le code Terraform AWS : [https://github.com/turbot/steampipe-mod-terraform-aws-compliance](https://github.com/turbot/steampipe-mod-terraform-aws-compliance)

Plus de plugins AWS de Steampipe : [https://github.com/turbot?q=aws](https://github.com/turbot?q=aws)
{% endtab %}

{% tab title="GCP" %}
```bash
# Install aws plugin
steampipe plugin install aws

# Modify the spec indicating in "profile" the profile name to use
nano ~/.steampipe/config/aws.spc

# Get some info on how the AWS account is being used
git clone https://github.com/turbot/steampipe-mod-aws-insights.git
cd steampipe-mod-aws-insights
steampipe dashboard

# Get the services exposed to the internet
git clone https://github.com/turbot/steampipe-mod-aws-perimeter.git
cd steampipe-mod-aws-perimeter
steampipe dashboard

# Run the benchmarks
git clone https://github.com/turbot/steampipe-mod-aws-compliance
cd steampipe-mod-aws-compliance
steampipe dashboard # To see results in browser
steampipe check all --export=/tmp/output4.json
```
Pour v√©rifier le code Terraform AWS : [https://github.com/turbot/steampipe-mod-terraform-aws-compliance](https://github.com/turbot/steampipe-mod-terraform-aws-compliance)

Plus de plugins AWS de Steampipe : [https://github.com/orgs/turbot/repositories?q=aws](https://github.com/orgs/turbot/repositories?q=aws)
{% endtab %}
{% endtabs %}

### [~~cs-suite~~](https://github.com/SecurityFTW/cs-suite)

AWS, GCP, Azure, DigitalOcean.\
Il n√©cessite python2.7 et semble ne plus √™tre maintenu.

### Nessus

Nessus a une analyse _**Audit Cloud Infrastructure**_ prenant en charge : AWS, Azure, Office 365, Rackspace, Salesforce. Certaines configurations suppl√©mentaires dans **Azure** sont n√©cessaires pour obtenir un **Client Id**.

### [**cloudlist**](https://github.com/projectdiscovery/cloudlist)

Cloudlist est un outil **multi-cloud pour obtenir des actifs** (noms d'h√¥tes, adresses IP) √† partir de fournisseurs de cloud.
```bash
cd /tmp
wget https://github.com/projectdiscovery/cloudlist/releases/latest/download/cloudlist_1.0.1_macOS_arm64.zip
unzip cloudlist_1.0.1_macOS_arm64.zip
chmod +x cloudlist
sudo mv cloudlist /usr/local/bin
```
{% endtab %}

{% tab title="M√©thodologie de Pentesting Cloud" %}

# M√©thodologie de Pentesting Cloud

## Introduction

Le pentesting cloud est une m√©thode de test de s√©curit√© qui vise √† identifier les vuln√©rabilit√©s dans les environnements cloud. Cette m√©thode est utilis√©e pour tester la s√©curit√© des applications cloud, des services cloud et des infrastructures cloud.

Le pentesting cloud est diff√©rent du pentesting traditionnel car il se concentre sur les environnements cloud. Les environnements cloud sont diff√©rents des environnements traditionnels car ils sont bas√©s sur des technologies de virtualisation et de conteneurisation.

## √âtape 1 : Collecte d'informations

La premi√®re √©tape de la m√©thodologie de pentesting cloud consiste √† collecter des informations sur l'environnement cloud. Cette √©tape comprend la collecte d'informations sur les applications cloud, les services cloud et les infrastructures cloud.

Les informations collect√©es peuvent inclure des informations sur les adresses IP, les noms de domaine, les ports ouverts, les services en cours d'ex√©cution, les versions de logiciels, les configurations de s√©curit√©, les politiques de s√©curit√©, les certificats SSL, les informations d'identification et les donn√©es sensibles.

## √âtape 2 : Analyse des vuln√©rabilit√©s

La deuxi√®me √©tape de la m√©thodologie de pentesting cloud consiste √† analyser les vuln√©rabilit√©s dans l'environnement cloud. Cette √©tape comprend l'utilisation d'outils d'analyse de vuln√©rabilit√©s pour identifier les vuln√©rabilit√©s dans les applications cloud, les services cloud et les infrastructures cloud.

Les vuln√©rabilit√©s identifi√©es peuvent inclure des vuln√©rabilit√©s de s√©curit√©, des vuln√©rabilit√©s de configuration, des vuln√©rabilit√©s de logiciel, des vuln√©rabilit√©s de r√©seau et des vuln√©rabilit√©s de donn√©es.

## √âtape 3 : Exploitation des vuln√©rabilit√©s

La troisi√®me √©tape de la m√©thodologie de pentesting cloud consiste √† exploiter les vuln√©rabilit√©s identifi√©es dans l'environnement cloud. Cette √©tape comprend l'utilisation d'outils d'exploitation de vuln√©rabilit√©s pour exploiter les vuln√©rabilit√©s identifi√©es dans les applications cloud, les services cloud et les infrastructures cloud.

L'exploitation des vuln√©rabilit√©s peut inclure l'ex√©cution de code malveillant, l'obtention d'acc√®s non autoris√©, la modification de donn√©es, la suppression de donn√©es et la fuite de donn√©es.

## √âtape 4 : √âvaluation de l'impact

La quatri√®me √©tape de la m√©thodologie de pentesting cloud consiste √† √©valuer l'impact des vuln√©rabilit√©s exploit√©es dans l'environnement cloud. Cette √©tape comprend l'√©valuation de l'impact sur les applications cloud, les services cloud et les infrastructures cloud.

L'√©valuation de l'impact peut inclure l'√©valuation de l'impact sur la confidentialit√©, l'int√©grit√© et la disponibilit√© des donn√©es.

## √âtape 5 : Rapport et recommandations

La cinqui√®me et derni√®re √©tape de la m√©thodologie de pentesting cloud consiste √† produire un rapport de test de s√©curit√© et √† fournir des recommandations pour am√©liorer la s√©curit√© de l'environnement cloud. Le rapport de test de s√©curit√© doit inclure une description d√©taill√©e des vuln√©rabilit√©s identifi√©es, des exploits utilis√©s, de l'impact √©valu√© et des recommandations pour am√©liorer la s√©curit√©.

Les recommandations peuvent inclure des recommandations pour am√©liorer la s√©curit√© des applications cloud, des services cloud et des infrastructures cloud. Les recommandations peuvent √©galement inclure des recommandations pour am√©liorer les politiques de s√©curit√©, les configurations de s√©curit√© et les pratiques de s√©curit√©.

## Conclusion

La m√©thodologie de pentesting cloud est une m√©thode efficace pour tester la s√©curit√© des environnements cloud. Cette m√©thodologie permet d'identifier les vuln√©rabilit√©s dans les applications cloud, les services cloud et les infrastructures cloud, et de fournir des recommandations pour am√©liorer la s√©curit√©.
```bash
## For GCP it requires service account JSON credentials
cloudlist -config </path/to/config>
```
### [**cartographie**](https://github.com/lyft/cartography)

Cartographie est un outil Python qui consolide les actifs d'infrastructure et les relations entre eux dans une vue graphique intuitive aliment√©e par une base de donn√©es Neo4j.

{% tabs %}
{% tab title="Installer" %}
```bash
# Installation
docker image pull ghcr.io/lyft/cartography
docker run --platform linux/amd64 ghcr.io/lyft/cartography cartography --help
## Install a Neo4j DB version 3.5.*
```
{% endtab %}

{% tab title="GCP" %}
## M√©thodologie de test de p√©n√©tration pour GCP

### 1. Collecte d'informations

La collecte d'informations est la premi√®re √©tape de tout test de p√©n√©tration. Les informations collect√©es peuvent √™tre utilis√©es pour identifier les vuln√©rabilit√©s et les points faibles du syst√®me. Les informations peuvent √™tre collect√©es √† partir de sources telles que :

- Enregistrements DNS
- Enregistrements WHOIS
- Enregistrements de certificats SSL
- Enregistrements de domaine
- Enregistrements de sous-domaine
- Enregistrements de serveur de messagerie
- Enregistrements de serveur de noms

### 2. Analyse des vuln√©rabilit√©s

L'analyse des vuln√©rabilit√©s est la deuxi√®me √©tape de tout test de p√©n√©tration. Cette √©tape consiste √† identifier les vuln√©rabilit√©s et les points faibles du syst√®me. Les vuln√©rabilit√©s peuvent √™tre identifi√©es √† l'aide d'outils tels que :

- Nmap
- Nessus
- OpenVAS
- Metasploit

### 3. Exploitation des vuln√©rabilit√©s

L'exploitation des vuln√©rabilit√©s est la troisi√®me √©tape de tout test de p√©n√©tration. Cette √©tape consiste √† exploiter les vuln√©rabilit√©s identifi√©es pour acc√©der au syst√®me. Les vuln√©rabilit√©s peuvent √™tre exploit√©es √† l'aide d'outils tels que :

- Metasploit
- ExploitDB
- SearchSploit

### 4. √âlaboration de rapports

L'√©laboration de rapports est la derni√®re √©tape de tout test de p√©n√©tration. Cette √©tape consiste √† documenter les r√©sultats du test de p√©n√©tration et √† fournir des recommandations pour am√©liorer la s√©curit√© du syst√®me. Les rapports peuvent √™tre √©labor√©s √† l'aide d'outils tels que :

- Dradis
- Metasploit
- Nessus
- OpenVAS

### 5. R√©p√©ter le processus

Le processus de test de p√©n√©tration doit √™tre r√©p√©t√© r√©guli√®rement pour garantir que le syst√®me reste s√©curis√©. Les tests de p√©n√©tration doivent √™tre effectu√©s chaque fois qu'il y a des modifications importantes apport√©es au syst√®me.
```bash
docker run --platform linux/amd64 \
     --volume "$HOME/.config/gcloud/application_default_credentials.json:/application_default_credentials.json" \
     -e GOOGLE_APPLICATION_CREDENTIALS="/application_default_credentials.json" \
     -e NEO4j_PASSWORD="s3cr3t" \
     ghcr.io/lyft/cartography  \
     --neo4j-uri bolt://host.docker.internal:7687 \
     --neo4j-password-env-var NEO4j_PASSWORD \
     --neo4j-user neo4j


# It only checks for a few services inside GCP (https://lyft.github.io/cartography/modules/gcp/index.html)
## Cloud Resource Manager
## Compute
## DNS
## Storage
## Google Kubernetes Engine
### If you can run starbase or purplepanda you will get more info
```
### Installation

1. Clone the repository:

   ```bash
   git clone https://github.com/JupiterOne/starbase.git
   ```

2. Install dependencies:

   ```bash
   cd starbase
   npm install
   ```

3. Set environment variables:

   ```bash
   export J1_ACCESS_TOKEN=<your JupiterOne access token>
   export J1_ACCOUNT_ID=<your JupiterOne account ID>
   ```

4. Start the server:

   ```bash
   npm start
   ```

5. Open the web interface at `http://localhost:3000`.

### Usage

1. Add a new data source by clicking the `+` button in the top right corner of the web interface.

2. Select the type of data source you want to add (e.g. AWS, GCP, Okta, etc.) and follow the prompts to authenticate and authorize access.

3. Once the data source is added, Starbase will automatically begin collecting and visualizing data in the graph view.

4. Use the search bar at the top of the web interface to search for specific assets or relationships.

5. Click on an asset or relationship in the graph view to view more details and explore related assets and relationships.
```bash
# You are going to need Node version 14, so install nvm following https://tecadmin.net/install-nvm-macos-with-homebrew/
npm install --global yarn
nvm install 14
git clone https://github.com/JupiterOne/starbase.git
cd starbase
nvm use 14
yarn install
yarn starbase --help
# Configure manually config.yaml depending on the env to analyze
yarn starbase setup
yarn starbase run

# Docker
git clone https://github.com/JupiterOne/starbase.git
cd starbase
cp config.yaml.example config.yaml
# Configure manually config.yaml depending on the env to analyze
docker build --no-cache -t starbase:latest .
docker-compose run starbase setup
docker-compose run starbase run
```
{% endtab %}

{% tab title="GCP" %}
## M√©thodologie de test de p√©n√©tration pour GCP

### 1. Collecte d'informations

La collecte d'informations est la premi√®re √©tape de tout test de p√©n√©tration. Les informations collect√©es peuvent √™tre utilis√©es pour identifier les vuln√©rabilit√©s et les points faibles du syst√®me. Les informations peuvent √™tre collect√©es √† partir de sources telles que :

- Enregistrements DNS
- Enregistrements WHOIS
- Enregistrements de certificats SSL
- Enregistrements de domaine
- Enregistrements de sous-domaine
- Enregistrements de serveur de messagerie
- Enregistrements de serveur de noms

### 2. Analyse des vuln√©rabilit√©s

L'analyse des vuln√©rabilit√©s est la deuxi√®me √©tape de tout test de p√©n√©tration. Cette √©tape consiste √† identifier les vuln√©rabilit√©s et les points faibles du syst√®me. Les vuln√©rabilit√©s peuvent √™tre identifi√©es √† l'aide d'outils tels que :

- Nmap
- Nessus
- OpenVAS
- Metasploit

### 3. Exploitation des vuln√©rabilit√©s

L'exploitation des vuln√©rabilit√©s est la troisi√®me √©tape de tout test de p√©n√©tration. Cette √©tape consiste √† exploiter les vuln√©rabilit√©s identifi√©es pour acc√©der au syst√®me. Les vuln√©rabilit√©s peuvent √™tre exploit√©es √† l'aide d'outils tels que :

- Metasploit
- ExploitDB
- SearchSploit

### 4. √âlaboration de rapports

L'√©laboration de rapports est la derni√®re √©tape de tout test de p√©n√©tration. Cette √©tape consiste √† documenter les r√©sultats du test de p√©n√©tration et √† fournir des recommandations pour am√©liorer la s√©curit√© du syst√®me. Les rapports peuvent √™tre √©labor√©s √† l'aide d'outils tels que :

- Dradis
- Metasploit
- Nessus
- OpenVAS

### 5. R√©p√©ter le processus

Le processus de test de p√©n√©tration doit √™tre r√©p√©t√© r√©guli√®rement pour garantir que le syst√®me reste s√©curis√©. Les tests de p√©n√©tration doivent √™tre effectu√©s chaque fois qu'il y a des modifications importantes apport√©es au syst√®me.
```yaml
## Config for GCP
### Check out: https://github.com/JupiterOne/graph-google-cloud/blob/main/docs/development.md
### It requires service account credentials
 
integrations:
  -
    name: graph-google-cloud
    instanceId: testInstanceId
    directory: ./.integrations/graph-google-cloud
    gitRemoteUrl: https://github.com/JupiterOne/graph-google-cloud.git
    config:
      SERVICE_ACCOUNT_KEY_FILE: '{Check https://github.com/JupiterOne/graph-google-cloud/blob/main/docs/development.md#service_account_key_file-string}'
      PROJECT_ID: ""
      FOLDER_ID: ""
      ORGANIZATION_ID: ""
      CONFIGURE_ORGANIZATION_PROJECTS: false

storage:
  engine: neo4j
  config: 
    username: neo4j
    password: s3cr3t
    uri: bolt://localhost:7687
    #Consider using host.docker.internal if from docker
```
{% endtab %}
{% endtabs %}

### [**SkyArk**](https://github.com/cyberark/SkyArk)

D√©couvrez les utilisateurs les plus privil√©gi√©s dans l'environnement AWS ou Azure analys√©, y compris les administrateurs Shadow AWS. Il utilise PowerShell.
```powershell
Import-Module .\SkyArk.ps1 -force
Start-AzureStealth

# in the Cloud Console
IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/cyberark/SkyArk/master/AzureStealth/AzureStealth.ps1')  
Scan-AzureAdmins  
```
### [Cloud Brute](https://github.com/0xsha/CloudBrute)

Un outil pour trouver l'infrastructure, les fichiers et les applications d'une entreprise (cible) sur les principaux fournisseurs de cloud (Amazon, Google, Microsoft, DigitalOcean, Alibaba, Vultr, Linode).

### [CloudFox](https://github.com/BishopFox/cloudfox)

* CloudFox est un outil pour trouver des chemins d'attaque exploitables dans l'infrastructure cloud (actuellement seulement AWS et Azure sont pris en charge avec GCP √† venir).
* C'est un outil d'√©num√©ration qui est destin√© √† compl√©ter le pentesting manuel.
* Il ne cr√©e ni ne modifie aucune donn√©e dans l'environnement cloud.

### Plus de listes d'outils de s√©curit√© cloud

* [https://github.com/RyanJarv/awesome-cloud-sec](https://github.com/RyanJarv/awesome-cloud-sec)

## Google

### GCP

{% content-ref url="gcp-security/" %}
[gcp-security](gcp-security/)
{% endcontent-ref %}

### Workspace

{% content-ref url="workspace-security.md" %}
[workspace-security.md](workspace-security.md)
{% endcontent-ref %}

## AWS

{% content-ref url="aws-security/" %}
[aws-security](aws-security/)
{% endcontent-ref %}

## Azure

Acc√©dez au portail ici: [http://portal.azure.com/](http://portal.azure.com)\
Pour commencer les tests, vous devez avoir acc√®s avec un utilisateur disposant des **permissions Reader sur l'abonnement** et du **r√¥le Global Reader dans AzureAD**. Si m√™me dans ce cas, vous **n'√™tes pas en mesure d'acc√©der au contenu des comptes de stockage**, vous pouvez le corriger avec le **r√¥le Storage Account Contributor**.

Il est recommand√© d'**installer azure-cli** dans une machine virtuelle **linux** et **windows** (pour pouvoir ex√©cuter des scripts powershell et python): [https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest)\
Ensuite, ex√©cutez `az login` pour vous connecter. Notez que les **informations de compte** et le **jeton** seront **enregistr√©s** dans _\<HOME>/.azure_ (√† la fois dans Windows et Linux).

N'oubliez pas que si le **niveau de tarification Security Centre Standard** est utilis√© et **non** le niveau **gratuit**, vous pouvez **g√©n√©rer** un **rapport d'analyse de conformit√© CIS** √† partir du portail Azure. Allez √† _Policy & Compliance-> Regulatory Compliance_ (ou essayez d'acc√©der √† [https://portal.azure.com/#blade/Microsoft\_Azure\_Security/SecurityMenuBlade/22](https://portal.azure.com/#blade/Microsoft\_Azure\_Security/SecurityMenuBlade/22)).\
\_\_Si l'entreprise ne paie pas pour un compte Standard, vous devrez peut-√™tre examiner le **CIS Microsoft Azure Foundations Benchmark** "√† la main" (vous pouvez obtenir de l'aide en utilisant les outils suivants). T√©l√©chargez-le √† partir de [**ici**](https://www.newnettechnologies.com/cis-benchmark.html?keyword=\&gclid=Cj0KCQjwyPbzBRDsARIsAFh15JYSireQtX57C6XF8cfZU3JVjswtaLFJndC3Hv45YraKpLVDgLqEY6IaAhsZEALw\_wcB#microsoft-azure).

### Ex√©cuter des scanners

Ex√©cutez les scanners pour rechercher des **vuln√©rabilit√©s** et **comparer** les mesures de s√©curit√© mises en place avec **CIS**.
```bash
pip install scout
scout azure --cli --report-dir <output_dir>

#Fix azureaudit.py before launching cs.py
#Adding "j_res = {}" on line 1074
python cs.py -env azure

#Azucar is an Azure security scanner for PowerShell (https://github.com/nccgroup/azucar)
#Run it from its folder
.\Azucar.ps1 -AuthMode Interactive -ForceAuth -ExportTo EXCEL

#Azure-CIS-Scanner,CIS scanner for Azure (https://github.com/kbroughton/azure_cis_scanner)
pip3 install azure-cis-scanner #Install
azscan #Run, login before with `az login`
```
### Graphe d'attaque

[**Stormspotter**](https://github.com/Azure/Stormspotter) cr√©e un "graphe d'attaque" des ressources dans un abonnement Azure. Il permet aux √©quipes rouges et aux pentesteurs de visualiser la surface d'attaque et les opportunit√©s de pivotement au sein d'un locataire, et renforce vos d√©fenseurs pour orienter rapidement et prioriser le travail de r√©ponse aux incidents.

### Plus de v√©rifications

* V√©rifiez un **nombre √©lev√© d'administrateurs globaux** (entre 2 et 4 sont recommand√©s). Acc√©dez √†: [https://portal.azure.com/#blade/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/Overview](https://portal.azure.com/#blade/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/Overview)
* Les administrateurs globaux doivent avoir MFA activ√©. Allez dans Utilisateurs et cliquez sur le bouton Authentification multifacteur.
* Le compte administrateur d√©di√© ne doit pas avoir de bo√Ætes aux lettres (ils ne peuvent avoir de bo√Ætes aux lettres que s'ils ont Office 365).
* L'AD local ne doit pas √™tre synchronis√© avec Azure AD s'il n'est pas n√©cessaire ([https://portal.azure.com/#blade/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/AzureADConnect](https://portal.azure.com/#blade/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/AzureADConnect)). Et si la synchronisation est activ√©e, Password Hash Sync doit √™tre activ√© pour la fiabilit√©. Dans ce cas, il est d√©sactiv√©:
* Les **administrateurs globaux** ne doivent pas √™tre synchronis√©s √† partir d'un AD local. V√©rifiez si les e-mails des administrateurs globaux utilisent le domaine **onmicrosoft.com**. Sinon, v√©rifiez la source de l'utilisateur, la source doit √™tre Azure Active Directory, si elle provient de Windows Server AD, signalez-le.
* Le **niveau standard** est recommand√© au lieu du niveau gratuit (voir le niveau utilis√© dans _Tarification et param√®tres_ ou dans [https://portal.azure.com/#blade/Microsoft\_Azure\_Security/SecurityMenuBlade/24](https://portal.azure.com/#blade/Microsoft\_Azure\_Security/SecurityMenuBlade/24))
*   **Scans p√©riodiques des serveurs SQL**:

    _S√©lectionnez le serveur SQL_ --> _Assurez-vous que "Advanced data security" est activ√©_ --> _Sous "Param√®tres d'√©valuation de la vuln√©rabilit√©", activez "Scans p√©riodiques r√©currents" et configurez un compte de stockage pour stocker les r√©sultats de l'√©valuation de la vuln√©rabilit√©_ --> _Cliquez sur Enregistrer_
* **Absence de restrictions des services d'application**: Recherchez "Services d'application" dans Azure ([https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Web%2Fsites](https://portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Web%2Fsites)) et v√©rifiez si quelqu'un les utilise. Dans ce cas, v√©rifiez chaque application pour voir si des "Restrictions d'acc√®s" sont en place, et signalez-le s'il n'y a pas de r√®gles. L'acc√®s au service d'application doit √™tre restreint en fonction des besoins.

### Office365

Vous avez besoin d'un **administrateur global** ou au moins d'un **lecteur d'administrateur global** (mais notez que les limitations apparaissent dans certains modules PS et peuvent √™tre contourn√©es en acc√©dant aux fonctionnalit√©s **via l'application web**).

## Autres guides de pentesting cloud

* [**https://hackingthe.cloud**](https://hackingthe.cloud)

<details>

<summary><strong>Soutenez HackTricks et obtenez des avantages !</strong></summary>

* Si vous voulez voir votre **entreprise annonc√©e dans HackTricks** ou si vous voulez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts github.**

</details>
