# Cognito рдпреВрдЬрд░ рдкреВрд▓реНрд╕

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВ.

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

рдПрдХ рдпреВрдЬрд░ рдкреВрд▓ Amazon Cognito рдореЗрдВ рдПрдХ рдпреВрдЬрд░ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╣реИред рдПрдХ рдпреВрдЬрд░ рдкреВрд▓ рдХреЗ рд╕рд╛рде, рдЖрдкрдХреЗ рдпреВрдЬрд░реНрд╕ Amazon Cognito рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдкрдХреЗ рд╡реЗрдм рдпрд╛ рдореЛрдмрд╛рдЗрд▓ рдРрдк рдореЗрдВ **рд╕рд╛рдЗрди рдЗрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдпрд╛ рдПрдХ **рддреГрддреАрдп-рдкрдХреНрд╖** рдЖрдЗрдбреЗрдВрдЯрд┐рдЯреА рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ (IdP) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдлреЗрдбрд░реЗрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЪрд╛рд╣реЗ рдЖрдкрдХреЗ рдпреВрдЬрд░реНрд╕ рд╕реАрдзреЗ рд╕рд╛рдЗрди рдЗрди рдХрд░реЗрдВ рдпрд╛ рддреГрддреАрдп рдкрдХреНрд╖ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдпреВрдЬрд░ рдкреВрд▓ рдХреЗ рд╕рднреА рд╕рджрд╕реНрдпреЛрдВ рдХреА рдПрдХ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдкреНрд░реЛрдлрд╛рдЗрд▓ рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рдПрдХ SDK рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпреВрдЬрд░ рдкреВрд▓реНрд╕ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ:

* рд╕рд╛рдЗрди-рдЕрдк рдФрд░ рд╕рд╛рдЗрди-рдЗрди рд╕реЗрд╡рд╛рдПрдВред
* рдпреВрдЬрд░реНрд╕ рдХреЛ рд╕рд╛рдЗрди рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд┐рд▓реНрдЯ-рдЗрди, рдХрд╕реНрдЯрдорд╛рдЗрдЬрд╝реЗрдмрд▓ рд╡реЗрдм UIред
* Facebook, Google, Login with Amazon, рдФрд░ Sign in with Apple рдХреЗ рд╕рд╛рде рд╕реЛрд╢рд▓ рд╕рд╛рдЗрди-рдЗрди, рдФрд░ рдЖрдкрдХреЗ рдпреВрдЬрд░ рдкреВрд▓ рд╕реЗ SAML рдФрд░ OIDC рдЖрдЗрдбреЗрдВрдЯрд┐рдЯреА рдкреНрд░реЛрд╡рд╛рдЗрдбрд░реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред
* рдпреВрдЬрд░ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдкреНрд░рдмрдВрдзрди рдФрд░ рдпреВрдЬрд░ рдкреНрд░реЛрдлрд╛рдЗрд▓реНрд╕ред
* рдорд▓реНрдЯреА-рдлреИрдХреНрдЯрд░ рдСрдереЗрдВрдЯрд┐рдХреЗрд╢рди (MFA), рдХрдореНрдкреНрд░реЛрдорд╛рдЗрдЬреНрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рдЪреЗрдХреНрд╕, рдЕрдХрд╛рдЙрдВрдЯ рдЯреЗрдХрдУрд╡рд░ рдкреНрд░реЛрдЯреЗрдХреНрд╢рди, рдФрд░ рдлреЛрди рдФрд░ рдИрдореЗрд▓ рд╡реЗрд░рд┐рдлрд┐рдХреЗрд╢рди рдЬреИрд╕реА рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛рдПрдВред
* AWS Lambda рдЯреНрд░рд┐рдЧрд░реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд╕реНрдЯрдорд╛рдЗрдЬреНрдб рд╡рд░реНрдХрдлреНрд▓реЛ рдФрд░ рдпреВрдЬрд░ рдорд╛рдЗрдЧреНрд░реЗрд╢рдиред

**рд╕реЛрд░реНрд╕ рдХреЛрдб** рдореЗрдВ рдЖрдорддреМрд░ рдкрд░ **рдпреВрдЬрд░ рдкреВрд▓ ID** рдФрд░ **рдХреНрд▓рд╛рдЗрдВрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди ID**, (рдФрд░ рдХрднреА-рдХрднреА **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реАрдХреНрд░реЗрдЯ**?) рднреА рд╣реЛрддреЗ рд╣реИрдВ, рдЬреЛ Cognito рдпреВрдЬрд░ рдкреВрд▓ рдореЗрдВ **рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдпреВрдЬрд░ рдХреЛ рдЖрд╡рд╢реНрдпрдХ** рд╣реЛрддреЗ рд╣реИрдВред

### рд╕рдВрднрд╛рд╡рд┐рдд рд╣рдорд▓реЗ

* **рд░рдЬрд┐рд╕реНрдЯреНрд░реЗрд╢рди**: рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рдпреВрдЬрд░ рдЦреБрдж рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд╣ рдЦреБрдж рдХреЗ рд▓рд┐рдП рдПрдХ рдпреВрдЬрд░ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред
* **рдпреВрдЬрд░ рдПрдиреНрдпреБрдорд░реЗрд╢рди**: рд░рдЬрд┐рд╕реНрдЯреНрд░реЗрд╢рди рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рдпреВрдЬрд░рдиреЗрдореНрд╕ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИред
* **рд▓реЙрдЧрд┐рди рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕**: [**Authentication**](cognito-user-pools.md#authentication) рд╕реЗрдХреНрд╢рди рдореЗрдВ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╕рднреА **рддрд░реАрдХреЗ** рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдпреВрдЬрд░ **рд▓реЙрдЧрд┐рди** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЖрдк рдЙрдиреНрд╣реЗрдВ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдХреЗ **рд╡реИрдз рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

### рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЯреВрд▓реНрд╕

* [Pacu](https://github.com/RhinoSecurityLabs/pacu), AWS рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди рдлреНрд░реЗрдорд╡рд░реНрдХ, рдЕрдм "cognito\_\_enum" рдФрд░ "cognito\_\_attack" рдореЙрдбреНрдпреВрд▓реНрд╕ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдЕрдХрд╛рдЙрдВрдЯ рдореЗрдВ рд╕рднреА Cognito рдПрд╕реЗрдЯреНрд╕ рдХрд╛ рдПрдиреНрдпреБрдорд░реЗрд╢рди рдФрд░ рдХрдордЬреЛрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди, рдПрдХреНрд╕реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЧрдП рдпреВрдЬрд░ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕ рдЖрджрд┐ рдХреЛ рдлреНрд▓реИрдЧ рдХрд░рдиреЗ рдФрд░ рдпреВрдЬрд░ рдХреНрд░рд┐рдПрд╢рди (MFA рд╕рдкреЛрд░реНрдЯ рд╕рд╣рд┐рдд) рдФрд░ рдкреНрд░рд┐рд╡рд┐рд▓реЗрдЬ рдПрд╕реНрдХреЗрд▓реЗрд╢рди рдХреЛ рдСрдЯреЛрдореЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЬреЛ рдореЙрдбрд┐рдлрд╛рдЗрдПрдмрд▓ рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕, рдпреВрдЬрд╝реЗрдмрд▓ рдЖрдЗрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕, рдЖрдЗрдбреА рдЯреЛрдХрдиреНрд╕ рдореЗрдВ рдЕрд╕реНрдпреВрдореЗрдмрд▓ рд░реЛрд▓реНрд╕ рдЖрджрд┐ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИрдВред

рдореЙрдбреНрдпреВрд▓реНрд╕ рдХреЗ рдлрдВрдХреНрд╢рдиреНрд╕ рдХрд╛ рд╡рд┐рд╡рд░рдг рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП [рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2) рдХреЗ рднрд╛рдЧ 2 рдХреЛ рджреЗрдЦреЗрдВред рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдореБрдЦреНрдп [Pacu](https://github.com/RhinoSecurityLabs/pacu) рдкреЗрдЬ рджреЗрдЦреЗрдВред

#### рдЙрдкрдпреЛрдЧ

рдПрдХ рджрд┐рдП рдЧрдП рдЖрдЗрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓ рдФрд░ рдпреВрдЬрд░ рдкреВрд▓ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рдпреВрдЬрд░ рдХреНрд░рд┐рдПрд╢рди рдФрд░ рд╕рднреА рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рд╡реЗрдХреНрдЯрд░реНрд╕ рдХреЛ рдЖрдЬрд╝рдорд╛рдиреЗ рдХреЗ рд▓рд┐рдП cognito\_\_attack рдХрд╛ рдирдореВрдирд╛ рдЙрдкрдпреЛрдЧ:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
рдирдореВрдирд╛ cognito\_\_enum рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд░реНрддрдорд╛рди AWS рдЦрд╛рддреЗ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рдпреВрдЬрд░ рдкреВрд▓реНрд╕, рдпреВрдЬрд░ рдкреВрд▓ рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕, рдЖрдЗрдбреЗрдВрдЯрд┐рдЯреА рдкреВрд▓реНрд╕, рдпреВрдЬрд░реНрд╕ рдЖрджрд┐ рдХреЛ рдПрдХрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
Pacu (new:test) > run cognito__enum
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner) рдПрдХ CLI рдЯреВрд▓ рд╣реИ рдЬреЛ python рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ Cognito рдкрд░ рд╡рд┐рднрд┐рдиреНрди рд╣рдорд▓реЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЕрдирдЪрд╛рд╣реЗ рдЦрд╛рддрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдЦрд╛рддрд╛ рдСрд░реЗрдХрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

#### рд╕реНрдерд╛рдкрдирд╛
```bash
$ pip install cognito-scanner
```
#### рдкреНрд░рдпреЛрдЧ
```bash
$ cognito-scanner --help
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП https://github.com/padok-team/cognito-scanner рджреЗрдЦреЗрдВ

## рдкрдВрдЬреАрдХрд░рдг

User Pools **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд░реВрдк рд╕реЗ **рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдкрдВрдЬреАрдХрд░рдг** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
```bash
aws cognito-idp sign-up --client-id <client-id> \
--username <username> --password <password> \
--region <region> --no-sign-request
```
#### рдпрджрд┐ рдХреЛрдИ рднреА рдкрдВрдЬреАрдХрд░рдг рдХрд░ рд╕рдХрддрд╛ рд╣реИ

рдЖрдкрдХреЛ рдПрдХ рддреНрд░реБрдЯрд┐ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рд╕рдВрдХреЗрдд рджреЗрддреА рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ **рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛** рд╣реИ:
```
An error occurred (InvalidParameterException) when calling the SignUp operation: Attributes did not conform to the schema: address: The attribute is required
```
рдЖрдк рдЬрд░реВрд░реА рд╡рд┐рд╡рд░рдг JSON рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐:
```json
--user-attributes '[{"Name": "email", "Value": "carlospolop@gmail.com"}, {"Name":"gender", "Value": "M"}, {"Name": "address", "Value": "street"}, {"Name": "custom:custom_name", "Value":"supername&\"*$"}]'
```
рдЖрдк рдЗрд╕ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЬрдм рдЙрд╕ рдирд╛рдо рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореМрдЬреВрдж рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрддрд╛ рд╣реИ:
```
An error occurred (UsernameExistsException) when calling the SignUp operation: User already exists
```
{% hint style="info" %}
рдкрд┐рдЫрд▓реЗ рдХрдорд╛рдВрдб рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕ "custom:" рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВ**ред\
рд╕рд╛рде рд╣реА рдЬрд╛рди рд▓реЗрдВ рдХрд┐ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░рддреЗ рд╕рдордп рдЖрдк **рдпреВрдЬрд░ рдХреЗ рд▓рд┐рдП рдирдП рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕ рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрддреЗ**ред рдЖрдк рдХреЗрд╡рд▓ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕** рдХреЛ рдорд╛рди рджреЗ рд╕рдХрддреЗ рд╣реИрдВ (рднрд▓реЗ рд╣реА рд╡реЗ рдЖрд╡рд╢реНрдпрдХ рди рд╣реЛрдВ) рдФрд░ **рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕**ред
{% endhint %}

рдпрд╛ рд╕рд┐рд░реНрдл рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрд▓рд╛рдЗрдВрдЯ рдЖрдИрдбреА рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВред рдпрд╣ рддреНрд░реБрдЯрд┐ рд╣реИ рдЕрдЧрд░ рдХреНрд▓рд╛рдЗрдВрдЯ-рдЖрдИрдбреА рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ:
```
An error occurred (ResourceNotFoundException) when calling the SignUp operation: User pool client 3ig612gjm56p1ljls1prq2miut does not exist.
```
#### рдХреЗрд╡рд▓ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╣реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

рдЖрдкрдХреЛ рдпрд╣ рддреНрд░реБрдЯрд┐ рдорд┐рд▓реЗрдЧреА рдФрд░ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдпрд╛ рдЧрдгрдирд╛ рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ:
```
An error occurred (NotAuthorizedException) when calling the SignUp operation: SignUp is not permitted for this user pool
```
### рдкрдВрдЬреАрдХрд░рдг рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдирд╛

Cognito **рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкреБрд╖реНрдЯрд┐ рдЙрд╕рдХреЗ рдИрдореЗрд▓ рдпрд╛ рдлреЛрди рдирдВрдмрд░ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдХреЗ** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдЬрдм рдЖрдк рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рддреЗ рд╣реИрдВ рддреЛ рдЖрдорддреМрд░ рдкрд░ рдЖрдкрд╕реЗ рдХрдо рд╕реЗ рдХрдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ **рдИрдореЗрд▓ рдФрд░/рдпрд╛ рдЯреЗрд▓реАрдлреЛрди рдирдВрдмрд░** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдмрд╕ рдПрдХ **рдЖрдкрдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ** рд╕реЗрдЯ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдирд╡ рдирд┐рд░реНрдорд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдЦрд╛рддреЗ** рдХреА рдкреБрд╖реНрдЯрд┐ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рд╣реЛ рд╕рдХреЗ, рдЗрд╕ рдкреНрд░рдХрд╛рд░:
```bash
aws cognito-idp confirm-sign-up --client-id <cliet_id> \
--username aasdasd2 --confirmation-code <conf_code> \
--no-sign-request --region us-east-1
```
{% hint style="warning" %}
рднрд▓реЗ рд╣реА **рдЖрдк рдПрдХ рд╣реА рдИрдореЗрд▓** рдФрд░ рдлреЛрди рдирдВрдмрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрдм рдЖрдкрдХреЛ рдмрдирд╛рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, Cognito рдПрдХ рд╣реА рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╢рд┐рдХрд╛рдпрдд рдХрд░реЗрдЧрд╛ рдФрд░ **рдЦрд╛рддреЗ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрдЧрд╛**ред
{% endhint %}

### Privilege Escalation / Updating Attributes

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдкрдиреЗ рдЧреБрдгреЛрдВ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ **рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ**:
```bash
aws cognito-idp update-user-attributes \
--region us-east-1 --no-sign-request \
--user-attributes Name=address,Value=street \
--access-token <access token>
```
#### рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдкреНрд░рд┐рд╡реЗрд╕реНрдХ

{% hint style="danger" %}
рдЖрдкрдХреЛ **рдХрд╕реНрдЯрдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддреЗ рд╣реБрдП рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдХрд┐ `isAdmin`), рдЪреВрдВрдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЖрдк рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ **рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ**, рдЖрдк рд╕реНрд╡рдпрдВ рдореВрд▓реНрдп рдмрджрд▓рдХрд░ **рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ!
{% endhint %}

#### рдИрдореЗрд▓/рдпреВрдЬрд░рдиреЗрдо рд╕рдВрд╢реЛрдзрди рдкреНрд░рд┐рд╡реЗрд╕реНрдХ

рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ **рдИрдореЗрд▓ рдФрд░ рдлреЛрди рдирдВрдмрд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдлрд┐рд░, рднрд▓реЗ рд╣реА рдЦрд╛рддрд╛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХреЗ рд░реВрдк рдореЗрдВ рд░рд╣рддрд╛ рд╣реИ, рдЙрди рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯреНрд╕ рдХреЛ **рдЕрд╕рддреНрдпрд╛рдкрд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╕реЗрдЯ** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рдлрд┐рд░ рд╕реЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛)ред

{% hint style="warning" %}
рдЖрдк **рдИрдореЗрд▓ рдпрд╛ рдлреЛрди рдирдВрдмрд░ рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ** рдЬрдм рддрдХ рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╕рддреНрдпрд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ, рд▓реЗрдХрд┐рди рдЖрдк **рдпреВрдЬрд░рдиреЗрдо рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ**ред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдИрдореЗрд▓ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рд╕рддреНрдпрд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рддреЛ рд╡рд╣ **`email`** **рдлреАрд▓реНрдб** рдореЗрдВ ID рдЯреЛрдХрди рдХреЗ рдЕрдВрджрд░ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ рдФрд░ **`email_verified`** рдлреАрд▓реНрдб **рдЭреВрдард╛** рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдРрдк **рдЗрд╕реЗ рдЬрд╛рдВрдЪ рдирд╣реАрдВ рд░рд╣рд╛ рд╣реИ рддреЛ рдЖрдк рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдирдХрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк **`name`** рдлреАрд▓реНрдб рдХреЗ рдЕрдВрджрд░ рдХреБрдЫ рднреА рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдмрд╕ **рдирд╛рдо рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рдХреЗред рдЕрдЧрд░ рдХреЛрдИ рдРрдк **рдЙрд╕** рдлреАрд▓реНрдб рдХреА **рдЬрд╛рдВрдЪ рдХрд░ рд░рд╣рд╛ рд╣реИ** рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ **`email`** рдХреЗ рдмрдЬрд╛рдп (рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдХреЗ) рддреЛ рдЖрдк **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдирдХрд▓ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

рд╡реИрд╕реЗ рднреА, рдЕрдЧрд░ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рдЖрдкрдиреЗ рдЕрдкрдирд╛ рдИрдореЗрд▓ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдирдП рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдк **рдЙрд╕ рдИрдореЗрд▓ рдкрддреЗ рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХреЛрдб рдХреЗ рд╕рд╛рде рдИрдореЗрд▓ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:
```bash
aws cognito-idp verify-user-attribute \
--access-token <access_token> \
--attribute-name email --code <code> \
--region <region> --no-sign-request
```
**`phone_number`** рдХрд╛ рдЙрдкрдпреЛрдЧ **`email`** рдХреЗ рдмрдЬрд╛рдп **рдирдП рдлреЛрди рдирдВрдмрд░** рдХреЛ рдмрджрд▓рдиреЗ/рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВред

{% hint style="info" %}
рдПрдбрдорд┐рди **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╕рдВрджреАрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рднреА рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк рдЗрд╕ рдорд╛рди рдХреЛ **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдпрд╛ рдкрд╕рдВрджреАрджрд╛_рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдореЗрдВ рдирд╣реАрдВ рдмрджрд▓ рдкрд╛рдПрдВрдЧреЗ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рдЙрдкрдпреЛрдЧ рдореЗрдВ рд╣реИ** рддрд╛рдХрд┐ рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдирдХрд▓ рдХрд░рдиреЗ рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗред
{% endhint %}

### рдкрд╛рд╕рд╡рд░реНрдб рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд/рдмрджрд▓реЗрдВ

рдХреЗрд╡рд▓ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЬрд╛рдирдХрд░** (рдпрд╛ рдИрдореЗрд▓ рдпрд╛ рдлреЛрди рд╕реНрд╡реАрдХрд╛рд░реНрдп рд╣реИ) рдФрд░ рдЙрд╕ рддрдХ рдкрд╣реБрдБрдЪ рд╣реЛрдиреЗ рдкрд░ рдкрд╛рд╕рд╡рд░реНрдб рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╡рд╣рд╛рдБ рдПрдХ рдХреЛрдб рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛:
```bash
aws cognito-idp forgot-password \
--client-id <client_id> \
--username <username/email/phone> --region <region>
```
{% hint style="info" %}
рд╕рд░реНрд╡рд░ рдХрд╛ рдкреНрд░рддрд┐рд╕рд╛рдж рд╣рдореЗрд╢рд╛ рд╕рдХрд╛рд░рд╛рддреНрдордХ рд╣реЛрдЧрд╛, рдорд╛рдиреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдореМрдЬреВрдж рд╣реЛред рдЖрдк рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рд╕реВрдЪреА рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрддреЗред
{% endhint %}

рдЗрд╕ рдХреЛрдб рдХреЗ рд╕рд╛рде рдЖрдк рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
aws cognito-idp confirm-forgot-password \
--client-id <client_id> \
--username <username> \
--confirmation-code <conf_code> \
--password <pwd> --region <region>
```
рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдкрд┐рдЫрд▓рд╛ рдкрд╛рд╕рд╡рд░реНрдб рдорд╛рд▓реВрдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП**:
```bash
aws cognito-idp change-password \
--previous-password <value> \
--proposed-password <value> \
--access-token <value>
```
## рдкреНрд░рдорд╛рдгреАрдХрд░рдг

рдПрдХ рдпреВрдЬрд░ рдкреВрд▓ **рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб** рд╣реИрдВ, рддреЛ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА **рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ** рд╕рдорд░реНрдерд┐рдд рд╣реИрдВред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХреГрдд рд╣реЛрддрд╛ рд╣реИ рддреЛ **3 рдкреНрд░рдХрд╛рд░ рдХреЗ рдЯреЛрдХрди рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**: **ID рдЯреЛрдХрди**, **рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди** рдФрд░ **рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди**ред

* [**ID рдЯреЛрдХрди**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-id-token.html): рдЗрд╕рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА **рдкрд╣рдЪрд╛рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рджрд╛рд╡реЗ** рд╣реЛрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ `name`, `email`, рдФрд░ `phone_number`ред ID рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдкрдХреЗ рд╕рдВрд╕рд╛рдзрди рд╕рд░реНрд╡рд░реЛрдВ рдпрд╛ рд╕рд░реНрд╡рд░ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдкреНрд░рдорд╛рдгреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдмрд╛рд╣рд░реА рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ ID рдЯреЛрдХрди рдХреЗ **рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдЖрдк ID рдЯреЛрдХрди рдХреЗ рдЕрдВрджрд░ рдХрд┐рд╕реА рднреА рджрд╛рд╡реЗ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░ рд╕рдХреЗрдВред
* ID рдЯреЛрдХрди рд╡рд╣ рдЯреЛрдХрди рд╣реИ рдЬреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЧреБрдгреЛрдВ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рд╕рдорд╛рд╣рд┐рдд рдХрд░рддрд╛ рд╣реИ**, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдХрд╕реНрдЯрдо рд╡рд╛рд▓реЗ рднреАред
* [**рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html): рдЗрд╕рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рджрд╛рд╡реЗ, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рдореВрд╣реЛрдВ рдХреА рд╕реВрдЪреА, рдФрд░ рд╕реНрдХреЛрдкреНрд╕ рдХреА рд╕реВрдЪреА** рд╣реЛрддреА рд╣реИред рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдпреВрдЬрд░ рдкреВрд▓ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ **API рдСрдкрд░реЗрд╢рдиреНрд╕ рдХреЛ рдЕрдзрд┐рдХреГрдд рдХрд░рдирд╛** рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧреБрдгреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ, рдмрджрд▓рдиреЗ рдпрд╛ рд╣рдЯрд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред
* [**рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html): рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХреЗ рд╕рд╛рде рдЖрдк **рдирдП ID рдЯреЛрдХрди рдФрд░ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрдм рддрдХ рдХрд┐ **рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдЕрдорд╛рдиреНрдп рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддрд╛**ред **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ**, рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдЖрдкрдХреЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЖрдкрдХреЗ рдпреВрдЬрд░ рдкреВрд▓ рдореЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░рдиреЗ рдХреЗ **30 рджрд┐рдиреЛрдВ рдХреЗ рдмрд╛рдж рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЬрдм рдЖрдк рдЕрдкрдиреЗ рдпреВрдЬрд░ рдкреВрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЗ рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рд╕рдорд╛рдкреНрддрд┐ рдХреЛ **60 рдорд┐рдирдЯ рд╕реЗ 10 рд╡рд░реНрд╖реЛрдВ рдХреЗ рдмреАрдЪ рдХрд┐рд╕реА рднреА рдорд╛рди рдкрд░ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

### ADMIN\_NO\_SRP\_AUTH & ADMIN\_USER\_PASSWORD\_AUTH

рдпрд╣ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣ рд╣реИ:

* рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдЕрдиреБрдкреНрд░рдпреЛрдЧ **`AdminInitiateAuth` API рдСрдкрд░реЗрд╢рди** рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ (рдЗрд╕рдХреЗ рдмрдЬрд╛рдп `InitiateAuth` рдХрд╛ рдирд╣реАрдВ)ред рдЗрд╕ рдСрдкрд░реЗрд╢рди рдХреЛ **`cognito-idp:AdminInitiateAuth`** рдФрд░ **`cognito-idp:AdminRespondToAuthChallenge`** рд╕рд╣рд┐рдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рд╡рд╛рд▓реЗ AWS рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдСрдкрд░реЗрд╢рди рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рд╡рд╛рдкрд╕ рдХрд░рддрд╛ рд╣реИред
* рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЗ рдкрд╛рд╕ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреИрд░рд╛рдореАрдЯрд░реНрд╕** рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдпрд╣ **`AdminRespondToAuthChallenge` API рдСрдкрд░реЗрд╢рди** рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред `AdminRespondToAuthChallenge` API рдСрдкрд░реЗрд╢рди рдХреЗрд╡рд▓ рддрднреА рд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдЖрдк AWS рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред

рдпрд╣ **рддрд░реАрдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ**ред

рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**:

* рдпреВрдЬрд░ рдкреВрд▓ рдЖрдИрдбреА
* рдХреНрд▓рд╛рдЗрдВрдЯ рдЖрдИрдбреА
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо
* рдкрд╛рд╕рд╡рд░реНрдб
* рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реАрдХреНрд░реЗрдЯ (рдХреЗрд╡рд▓ рдпрджрд┐ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЛ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)

{% hint style="info" %}
рдЗрд╕ рддрд░реАрдХреЗ рд╕реЗ **рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП** рдЙрд╕ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЛ `ALLOW_ADMIN_USER_PASSWORD_AUTH` рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреА рдЪрд╛рд╣рд┐рдПред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **`cognito-idp:AdminInitiateAuth`** рдФрд░ **`cognito-idp:AdminRespondToAuthChallenge`** рдЕрдиреБрдорддрд┐рдпреЛрдВ рд╡рд╛рд▓реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред
{% endhint %}
```python
aws cognito-idp admin-initiate-auth \
--client-id <client-id> \
--auth-flow ADMIN_USER_PASSWORD_AUTH \
--region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'
--user-pool-id "<pool-id>"

# Check the python code to learn how to generate the hsecret_hash
```
<details>

<summary>рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.admin_initiate_auth(
UserPoolId=user_pool_id,
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
<details>

### USER\_PASSWORD\_AUTH

рдпрд╣ рд╡рд┐рдзрд┐ рдПрдХ рдФрд░ рд╕рд░рд▓ рдФрд░ **рдкрд╛рд░рдВрдкрд░рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдкреНрд░рд╡рд╛рд╣ рд╣реИред рдпрд╣ **рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рдкрд╛рд░рдВрдкрд░рд┐рдХ** рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐ рдХреЛ **Cognito рдореЗрдВ рдорд╛рдЗрдЧреНрд░реЗрдЯ** рдХрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ **рдирд┐рд╖реНрдХреНрд░рд┐рдп** рдХрд░ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдлрд┐рд░ **ALLOW\_USER\_SRP\_AUTH** рд╡рд┐рдзрд┐ рдХрд╛ **рдЙрдкрдпреЛрдЧ** рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП (рдХреНрдпреЛрдВрдХрд┐ рдЙрд╕ рд╡рд┐рдзрд┐ рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб рдХрднреА рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдирд╣реАрдВ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ)ред\
рдпрд╣ **рд╡рд┐рдзрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ**ред

рдХреЛрдб рдХреЗ рдЕрдВрджрд░ **рдкрд┐рдЫрд▓реА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐** рдХреЗ рд╕рд╛рде рдореБрдЦреНрдп **рдЕрдВрддрд░** рдпрд╣ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ ID рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ** рдФрд░ рдЖрдкрдХреЛ Cognito User Pool рдореЗрдВ **рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ**ред

**рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рд┐рдП:

* client id
* username
* password
* client secret (рдХреЗрд╡рд▓ рдпрджрд┐ рдРрдк рдХреЛ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)

{% hint style="info" %}
рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд╕рд╛рде **рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП** рдЙрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ ALLOW\_USER\_PASSWORD\_AUTH рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреА рдЪрд╛рд╣рд┐рдПред
{% endhint %}</details>
```python
aws cognito-idp initiate-auth  --client-id <client-id> \
--auth-flow USER_PASSWORD_AUTH --region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'

# Check the python code to learn how to generate the secret_hash
```
<details>

<summary>рдкрд╛рдпрдерди рдХреЛрдб рд▓реЙрдЧрд┐рди рдХреЗ рд▓рд┐рдП</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_SRP\_AUTH

рдпрд╣ рдкрд░рд┐рджреГрд╢реНрдп рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓реЗ рдХреЗ рд╕рдорд╛рди рд╣реИ рд▓реЗрдХрд┐рди **рдкрд╛рд╕рд╡рд░реНрдб рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреЗрдЬрдиреЗ рдХреЗ рдмрдЬрд╛рдп** рдПрдХ **рдЪреБрдиреМрддреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** (рдЗрд╕рд▓рд┐рдП рдХреЛрдИ рдкрд╛рд╕рд╡рд░реНрдб рдиреЗрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рднреА рдирд╣реАрдВ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ)ред\
рдпрд╣ **рддрд░реАрдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ**ред

**рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЬрд╛рдирдирд╛ **рдЖрд╡рд╢реНрдпрдХ** рд╣реИ:

* user pool id
* client id
* username
* password
* client secret (рдХреЗрд╡рд▓ рдпрджрд┐ рдРрдк рдХреЛ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ)

<details>

<summary>рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб</summary>
```python
from warrant.aws_srp import AWSSRP
import os

USERNAME='xxx'
PASSWORD='yyy'
POOL_ID='us-east-1_zzzzz'
CLIENT_ID = '12xxxxxxxxxxxxxxxxxxxxxxx'
CLIENT_SECRET = 'secreeeeet'
os.environ["AWS_DEFAULT_REGION"] = "<region>"

aws = AWSSRP(username=USERNAME, password=PASSWORD, pool_id=POOL_ID,
client_id=CLIENT_ID, client_secret=CLIENT_SECRET)
tokens = aws.authenticate_user()
id_token = tokens['AuthenticationResult']['IdToken']
refresh_token = tokens['AuthenticationResult']['RefreshToken']
access_token = tokens['AuthenticationResult']['AccessToken']
token_type = tokens['AuthenticationResult']['TokenType']
```
<details>

### REFRESH\_TOKEN\_AUTH & REFRESH\_TOKEN

рдпрд╣ **рд╡рд┐рдзрд┐ рд╣рдореЗрд╢рд╛ рдорд╛рдиреНрдп рд░рд╣реЗрдЧреА** (рдЗрд╕реЗ рдЕрдХреНрд╖рдо рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛) рд▓реЗрдХрд┐рди рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдорд╛рдиреНрдп рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред
```bash
aws cognito-idp initiate-auth \
--client-id 3ig6h5gjm56p1ljls1prq2miut \
--auth-flow REFRESH_TOKEN_AUTH \
--region us-east-1 \
--auth-parameters 'REFRESH_TOKEN=<token>'
```
<details>

<summary>рдХреЛрдб рдХреЛ рддрд╛рдЬрд╝рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64

client_id = "<client-id>"
token = '<token>'

boto_client = boto3.client('cognito-idp', region_name='<region>')

def refresh(client_id, refresh_token):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='REFRESH_TOKEN_AUTH',
AuthParameters={
'REFRESH_TOKEN': refresh_token
}
)
except botocore.exceptions.ClientError as e:
return e.response


print(refresh(client_id, token))
```
<details>

### CUSTOM_AUTH

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** **рд▓реИрдореНрдмреНрдбрд╛ рдлрдВрдХреНрд╢рди рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

## рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛

### рдЙрдиреНрдирдд рд╕реБрд░рдХреНрд╖рд╛

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрд╣ рдЕрдХреНрд╖рдо рд╣реИ, рд▓реЗрдХрд┐рди рдпрджрд┐ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ Cognito **рдЦрд╛рддрд╛ рдЕрдзрд┐рдЧреНрд░рд╣рдг рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддрд╛ рд╣реИ**ред рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдПрдХ рд╣реА рд╢рд╣рд░ рдХреЗ рдЕрдВрджрд░ рдХреЗ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ, рдПрдХ рд╣реА рдпреВрдЬрд░ рдПрдЬреЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ** (рдФрд░ рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рддреЛ IP рдХрд╛ рднреА) **рд▓реЙрдЧрд┐рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред**

### **MFA рдбрд┐рд╡рд╛рдЗрд╕ рдпрд╛рдж рд░рдЦреЗрдВ**

рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рд╣реА рдбрд┐рд╡рд╛рдЗрд╕ рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рддрд╛ рд╣реИ, рддреЛ MFA рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ рд╣реА рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реЗ рдПрдХ рд╣реА рдореЗрдЯрд╛рдбреЗрдЯрд╛ (IP?) рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рддрд╛рдХрд┐ MFA рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

## рдпреВрдЬрд░ рдкреВрд▓ рдЧреНрд░реБрдкреНрд╕ IAM рд░реЛрд▓реНрд╕

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **User Pool** рдЧреНрд░реБрдкреНрд╕ рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЬреЛ рдПрдХ **IAM рд░реЛрд▓реНрд╕** рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИрдВред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдХреЛ **рд╡рд┐рднрд┐рдиреНрди IAM рд░реЛрд▓реНрд╕** рд╕реЗ рдЬреБрдбрд╝реЗ **1 рд╕реЗ рдЕрдзрд┐рдХ рд╕рдореВрд╣реЛрдВ рдореЗрдВ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдПрдХ рд╕рдореВрд╣ рдХрд┐рд╕реА IAM рд░реЛрд▓ рд╕реЗ рдЬреБрдбрд╝реЗ рд╕рдореВрд╣ рдХреЗ рдЕрдВрджрд░ рд╣реИ, рддреЛ рдЙрд╕ рд╕рдореВрд╣ рдХреЗ IAM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ **User Pool рдХреЛ рдПрдХ Identity Pool рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ** (рдФрд░ рдЙрд╕ Identity Pool рдХрд╛ рд╡рд┐рд╡рд░рдг рдЬрд╛рдирддреЗ рд╣реЛрдВ)ред

рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ User Pool рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛрддрд╛ рд╣реИ (`aws cognito-idp initiate-auth...`) рддреЛ **IdToken рдореЗрдВ рджрд░реНрд╢рд╛рдП рдЧрдП IAM рд░реЛрд▓** рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдпрд╣ рд╣реИ рдХрд┐ **Identity Provider Authentication provider** рдХреЛ рдпрд╣ рд╕рдВрдХреЗрдд рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ **рд░реЛрд▓ рдХреЛ рдЯреЛрдХрди рд╕реЗ рдЪреБрдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред**

<figure><img src="../../../../.gitbook/assets/image (7) (1) (2).png" alt=""><figcaption></figcaption></figure>

рдЬрд┐рди **рд░реЛрд▓реНрд╕** рддрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╣реБрдБрдЪ рд╣реИ рд╡реЗ **`IdToken` рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ**, рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **`--custom-role-arn`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **aws cognito-identity get-credentials-for-identity** рд╕реЗ рдЙрд╕ рд░реЛрд▓ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЪреБрди рд╕рдХрддрд╛ рд╣реИред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡рд┐рдХрд▓реНрдк** рд╡рд╣реА рд╣реИ рдЬреЛ **рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** (`use default role`), рдФрд░ рдЖрдк IdToken рд╕реЗ рдПрдХ рд░реЛрд▓ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ **рддреНрд░реБрдЯрд┐** рдорд┐рд▓реЗрдЧреА (рдЗрд╕реАрд▓рд┐рдП рдкрд┐рдЫрд▓рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЖрд╡рд╢реНрдпрдХ рд╣реИ):

{% code overflow="wrap" %}
```
An error occurred (InvalidParameterException) when calling the GetCredentialsForIdentity operation: Only SAML providers and providers with RoleMappings support custom role ARN.
```
{% endcode %}

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **User Pool Group** рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рднреВрдорд┐рдХрд╛ **Identity Provider рджреНрд╡рд╛рд░рд╛ рд╕реБрд▓рдн рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП** рдЬреЛ **User Pool рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИ** (рдХреНрдпреЛрдВрдХрд┐ IAM рднреВрдорд┐рдХрд╛ **рд╕рддреНрд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЗрд╕рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ**).
{% endhint %}
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"Federated": "cognito-identity.amazonaws.com"
},
"Action": "sts:AssumeRoleWithWebIdentity",
"Condition": {
"StringEquals": {
"cognito-identity.amazonaws.com:aud": "us-east-1:2361092e-9db6-a876-1027-10387c9de439"
},
"ForAnyValue:StringLike": {
"cognito-identity.amazonaws.com:amr": "authenticated"
}
}
}
]
}js
```
<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
