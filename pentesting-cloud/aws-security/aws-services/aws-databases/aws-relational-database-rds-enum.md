# AWS - Enumera√ß√£o de Banco de Dados Relacional (RDS)

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## Informa√ß√µes B√°sicas

**Relational Database Service (RDS)** √© um servi√ßo de banco de dados gerenciado que simplifica o processo de configura√ß√£o, opera√ß√£o e dimensionamento de um **banco de dados relacional na nuvem**. O AWS RDS fornece capacidade escal√°vel e com custo eficiente, e automatiza tarefas de administra√ß√£o demoradas, como provisionamento de hardware, configura√ß√£o de banco de dados, patching e backups.

O AWS RDS suporta **v√°rios motores de banco de dados relacionais populares**: MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server e Amazon Aurora compat√≠vel com MySQL ou com PostgreSQL.

Com o RDS, voc√™ pode gerenciar facilmente inst√¢ncias de banco de dados, criar **r√©plicas de leitura** para aumentar o **desempenho de leitura** e configurar implanta√ß√µes de **multi-Availability Zone (AZ)** para alta disponibilidade e suporte a failover. Al√©m disso, o RDS **se integra** a outros servi√ßos da AWS, como o AWS Identity and Access Management (**IAM**) para **controle de acesso**, o AWS **CloudWatch** para monitoramento e m√©tricas e o AWS Key Management Service (**KMS**) para criptografia em repouso.

## Credenciais

Ao criar o cluster de banco de dados, o **nome de usu√°rio do mestre** pode ser configurado (**`admin`** por padr√£o). Para gerar a senha deste usu√°rio, voc√™ pode:

* **Indicar** uma **senha** voc√™ mesmo
* Dizer ao RDS para **gerar automaticamente** a senha
* Dizer ao RDS para gerenci√°-la no **AWS Secret Manager** criptografado com uma chave KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Autentica√ß√£o

Existem 3 tipos de op√ß√µes de autentica√ß√£o, mas usar a **senha mestre √© sempre permitido**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Acesso P√∫blico e VPC

Por padr√£o, **nenhum acesso p√∫blico √© concedido** aos bancos de dados, no entanto, **pode ser concedido**. Portanto, por padr√£o, apenas m√°quinas da mesma VPC poder√£o acess√°-lo se o **grupo de seguran√ßa** selecionado (armazenado em EC2 SG) permitir.

Em vez de expor uma inst√¢ncia de banco de dados, √© poss√≠vel criar um **RDS Proxy** que **melhora** a **escalabilidade** e **disponibilidade** do cluster de banco de dados.

Al√©m disso, a **porta do banco de dados pode ser modificada** tamb√©m.

### Criptografia

A **criptografia √© habilitada por padr√£o** usando uma chave gerenciada pela AWS (uma CMK pode ser escolhida em vez disso).

Ao habilitar sua criptografia, voc√™ est√° habilitando a **criptografia em repouso para seu armazenamento, snapshots, r√©plicas de leitura e seus backups**. As chaves para gerenciar essa criptografia podem ser emitidas usando o **KMS**.\
N√£o √© poss√≠vel adicionar esse n√≠vel de criptografia depois que seu banco de dados foi criado. **Isso deve ser feito durante sua cria√ß√£o**.

No entanto, h√° uma **solu√ß√£o alternativa que permite criptografar um banco de dados n√£o criptografado da seguinte maneira**. Voc√™ pode criar um snapshot do seu banco de dados n√£o criptografado, criar uma c√≥pia criptografada desse snapshot, usar esse snapshot criptografado para criar um novo banco de dados e, finalmente, seu banco de dados ser√° criptografado.

#### Criptografia TDE

Al√©m da criptografia oferecida pelo RDS em si no n√≠vel de aplicativo, existem **mecanismos adicionais de criptografia em n√≠vel de plataforma** que podem ser usados para proteger dados em repouso, incluindo **Oracle e SQL Server Transparent Data Encryption**, conhecidos como TDE, e isso pode ser usado em conjunto com a ordem do m√©todo discutido, mas isso **impactaria o desempenho** do banco de dados MySQL fun√ß√µes criptogr√°ficas e fun√ß√µes criptogr√°ficas do Microsoft Transact-SQL.

Se voc√™ deseja usar o m√©todo TDE, primeiro deve garantir que o banco de dados esteja associado a um grupo de op√ß√µes. Os grupos de op√ß√µes fornecem configura√ß√µes padr√£o para seu banco de dados e ajudam na ger√™ncia, que inclui alguns recursos de seguran√ßa. No entanto, os grupos de op√ß√µes existem apenas para os seguintes motores de banco de dados e vers√µes.

Depois que o banco de dados estiver associado a um grupo de op√ß√µes, voc√™ deve garantir que a op√ß√£o de criptografia transparente de dados Oracle seja adicionada a esse grupo. Depois que essa op√ß√£o TDE foi adicionada ao grupo de op√ß√µes, ela n√£o pode ser removida. O TDE pode usar dois modos de criptografia diferentes, primeiro, a criptografia de tablespace TDE, que criptografa tabelas inteiras e, segundo, a criptografia de coluna TDE, que apenas criptografa elementos individuais do banco de dados.

### Enumera√ß√£o

{% code overflow="wrap" %}
```bash
# Informa√ß√µes de clusters
aws rds describe-db-clusters #IAM habilitado? p√∫blico? porta? DG?
aws rds describe-db-cluster-endpoints #URLs do cluster
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Snapshots do cluster
aws rds describe-db-cluster-snapshots

# Obter informa√ß√µes de inst√¢ncias de banco de dados
aws rds describe-db-instances #nome de usu√°rio? url? porta? vpc? SG? p√∫blico?
aws rds describe-db-security-groups

## Encontrar backups automatizados
aws rds describe-db-instance-automated-backups

## Encontrar snapshots
aws rds describe-db-snapshots 
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restaurar snapshot como nova inst√¢ncia
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Qualquer snapshot p√∫blico na conta
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## redefinir credenciais do MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Acesso N√£o Autenticado

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[