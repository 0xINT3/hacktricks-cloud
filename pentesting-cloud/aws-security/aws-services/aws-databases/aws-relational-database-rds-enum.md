# AWS - 関係データベース（RDS）Enum

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong>を通じて、ゼロからヒーローまでのAWSハッキングを学びましょう！</summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝**したい場合や**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)で**フォロー**する。
- **ハッキングトリックを共有するために** [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する。

</details>

## 基本情報

AWSが提供する**関係データベースサービス（RDS）**は、**クラウド内の関係データベースの展開、運用、スケーリングを効率化**するよう設計されています。このサービスは、ハードウェアのプロビジョニング、データベースの構成、パッチ適用、バックアップなどの労力を要するタスクを自動化しながら、コスト効率とスケーラビリティの利点を提供します。

AWS RDSは、MySQL、PostgreSQL、MariaDB、Oracle Database、Microsoft SQL Server、Amazon Auroraなど、さまざまな広く使用されている関係データベースエンジンをサポートしており、MySQLとPostgreSQLの両方に対応しています。

RDSの主な機能には次のものがあります：

- データベースインスタンスの**管理**が簡素化されています。
- 読み取りパフォーマンスを向上させるための**リードレプリカ**の作成。
- 高可用性とフェイルオーバーメカニズムを確保するための**マルチアベイラビリティゾーン（AZ）デプロイメント**の構成。
- 他のAWSサービスとの**統合**：
  - ロバストなアクセス制御のためのAWS Identity and Access Management（**IAM**）。
  - 包括的な監視とメトリクスのためのAWS **CloudWatch**。
  - 暗号化を確保するためのAWS Key Management Service（**KMS**）。

## 資格情報

DBクラスターを作成する際、マスター**ユーザー名**を構成できます（デフォルトは**`admin`**）。このユーザーのパスワードを生成する方法は次のとおりです：

- 自分で**パスワード**を指定する
- RDSに**自動生成**させる
- RDSにそれをKMSキーで暗号化して**AWS Secret Manager**で管理させる

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### 認証

3種類の認証オプションがありますが、**マスターパスワードを使用することは常に許可されています**：

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### パブリックアクセスとVPC

デフォルトでは、データベースへの**パブリックアクセスは許可されていません**が、**許可される可能性があります**。したがって、デフォルトでは、選択した**セキュリティグループ**（EC2 SGに保存されています）が許可する場合にのみ、同じVPCからのマシンがアクセスできます。

DBインスタンスを公開する代わりに、**RDS Proxy**を作成することができ、DBクラスターの**スケーラビリティ**と**可用性**を向上させることができます。

さらに、**データベースポートを変更**することもできます。

### 暗号化

AWS管理キーを使用してデフォルトで**暗号化が有効**になっています（代わりにCMKを選択することもできます）。

暗号化を有効にすると、**ストレージ、スナップショット、リードレプリカ、バックアップの休止中の暗号化**が有効になります。この暗号化を管理するためのキーは、**KMS**を使用して発行できます。\
この暗号化レベルをデータベースが作成された後に追加することはできません。**作成中に行う必要があります**。

ただし、次のようにして未暗号化のデータベースを暗号化する回避策があります。未暗号化のデータベースのスナップショットを作成し、そのスナップショットの暗号化コピーを作成し、その暗号化されたスナップショットを使用して新しいデータベースを作成し、最終的にデータベースは暗号化されます。

#### 透過的データ暗号化（TDE）

RDSに固有のアプリケーションレベルの暗号化機能に加えて、RDSはOracleとSQL Server向けのデータを休止中に保護するための**追加のプラットフォームレベルの暗号化メカニズム**もサポートしています。これにはOracleとSQL Server向けの**透過的データ暗号化（TDE）**が含まれます。ただし、TDEはデータを休止中に暗号化することでセキュリティを向上させる一方で、データベースのパフォーマンスに**影響を与える可能性**があります。このパフォーマンスへの影響は、特にMySQLの暗号化関数やMicrosoft Transact-SQLの暗号化関数と併用した場合に顕著です。

TDEを利用するには、いくつかの事前のステップが必要です：

1. **オプショングループの関連付け**：
   - データベースはオプショングループに関連付ける必要があります。オプショングループは設定や機能を含むコンテナとして機能し、セキュリティの向上を含むデータベース管理を容易にします。
   - ただし、オプショングループは特定のデータベースエンジンとバージョンにのみ利用可能です。

2. **オプショングループへのTDEの含有**：
   - オプショングループに関連付けられた後、Oracle Transparent Data Encryptionオプションをそのグループに含める必要があります。
   - TDEオプションがオプショングループに追加されると、それが恒久的なものとなり、削除することはできません。

3. **TDE暗号化モード**：
   - TDEには2つの異なる暗号化モードがあります：
     - **TDEテーブルスペース暗号化**：このモードはテーブル全体を暗号化し、より広範囲のデータ保護を提供します。
     - **TDE列暗号化**：このモードはデータベース内の特定の個々の要素を暗号化することに焦点を当て、どのデータを暗号化するかをより細かく制御できます。

これらの前提条件とTDEの操作上の複雑さを理解することは、RDS内での暗号化の効果的な実装と管理にとって重要です。これにより、データセキュリティと必要な標準への準拠が確保されます。

### 列挙

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### 認証されていないアクセス

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### 特権昇格

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### 攻撃後の活動

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### 永続性

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQLインジェクション

**SQL構文**を使用してDynamoDBデータにアクセスする方法があり、そのため、典型的な**SQLインジェクションも可能**です。

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong>を使用して、ゼロからヒーローまでAWSハッキングを学びましょう！</summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)を**フォロー**する
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出して、あなたのハッキングトリックを共有する

</details>
