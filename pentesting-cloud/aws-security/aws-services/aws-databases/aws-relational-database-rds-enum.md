# AWS - 关系型数据库 (RDS) 枚举

<details>

<summary><strong>从零到英雄学习AWS黑客技术，通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>!</strong></summary>

支持HackTricks的其他方式：

* 如果您想在 **HackTricks中看到您的公司广告** 或 **下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 基本信息

AWS提供的**关系型数据库服务 (RDS)** 旨在简化**云中关系型数据库**的部署、操作和扩展。该服务提供成本效益和可扩展性的优势，同时自动化了硬件配置、数据库配置、补丁和备份等劳动密集型任务。

AWS RDS支持多种广泛使用的关系型数据库引擎，包括MySQL、PostgreSQL、MariaDB、Oracle数据库、Microsoft SQL Server和Amazon Aurora，兼容MySQL和PostgreSQL。

RDS的关键特性包括：

- **数据库实例管理**简化了。
- 创建**读副本**以提高读取性能。
- 配置**多可用区 (AZ) 部署**以确保高可用性和故障转移机制。
- 与其他AWS服务的**集成**，例如：
- AWS身份和访问管理 (**IAM**) 提供强大的访问控制。
- AWS **CloudWatch** 提供全面的监控和指标。
- AWS密钥管理服务 (**KMS**) 确保静态数据加密。


## 凭证

创建DB集群时，可以配置主**用户名**（默认为**`admin`**）。要生成此用户的密码，您可以：

* **指定**一个**密码**
* 告诉RDS **自动生成**它
* 告诉RDS在**AWS Secret Manager**中管理它，并使用KMS密钥加密

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### 认证

有3种认证选项，但始终允许使用**主密码**：

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### 公共访问 & VPC

默认情况下，数据库**不允许公共访问**，但**可以授予**。因此，默认情况下，如果选定的**安全组**（存储在EC2 SG中）允许，只有来自同一VPC的机器才能访问它。

可以创建一个**RDS代理**，而不是暴露DB实例，这可以**提高**数据库集群的**可扩展性**和**可用性**。

此外，**数据库端口也可以修改**。

### 加密

**默认启用加密**，使用AWS管理的密钥（也可以选择CMK）。

启用加密意味着您为存储、快照、读副本和备份启用了**静态数据加密**。可以使用**KMS**发行管理此加密的密钥。\
在数据库创建后，无法添加此级别的加密。**必须在创建过程中完成**。

然而，有一个**解决方法允许您加密未加密的数据库，如下所示**。您可以创建未加密数据库的快照，创建该快照的加密副本，使用该加密快照创建新数据库，然后，最终，您的数据库将被加密。

#### 透明数据加密 (TDE)

除了RDS在应用程序级别固有的加密能力外，RDS还支持**额外的平台级加密机制**来保护静态数据。这包括Oracle和SQL Server的**透明数据加密 (TDE)**。然而，需要注意的是，虽然TDE通过加密静态数据来增强安全性，但它也可能**影响数据库性能**。当与MySQL加密函数或Microsoft Transact-SQL加密函数结合使用时，尤其会注意到这种性能影响。

要使用TDE，需要一些初步步骤：

1. **选项组关联**：
- 数据库必须与一个选项组关联。选项组作为设置和功能的容器，便于数据库管理，包括安全增强。
- 然而，重要的是要注意，选项组只适用于特定的数据库引擎和版本。

2. **在选项组中包含TDE**：
- 一旦与选项组关联，就需要在该组中包含Oracle透明数据加密选项。
- 需要认识到的是，一旦将TDE选项添加到选项组中，它就成为永久性的，不能被移除。

3. **TDE加密模式**：
- TDE提供两种不同的加密模式：
- **TDE表空间加密**：此模式加密整个表，提供更广泛的数据保护范围。
- **TDE列加密**：此模式专注于加密数据库中的特定个别元素，允许对加密数据进行更细粒度的控制。

理解这些先决条件和TDE的操作细节对于有效实施和管理RDS中的加密至关重要，确保数据安全并符合必要的标准。

### 枚举

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### 未经认证的访问

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### 权限提升

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### 后期利用

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### 持久化

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL 注入

存在使用 **SQL 语法** 访问 DynamoDB 数据的方法，因此，典型的 **SQL 注入也是可能的**。

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>从零开始学习 AWS 黑客攻击！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您希望在 HackTricks 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs**](https://opensea.io/collection/the-peass-family)系列
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享您的黑客技巧。

</details>
