# AWS - 关系型数据库（RDS）枚举

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>

## 基本信息

**关系型数据库服务（RDS）**是一种托管的数据库服务，简化了在云中设置、运行和扩展**关系型数据库**的过程。AWS RDS 提供了具有成本效益和可调整大小的容量，并自动化了耗时的管理任务，如硬件配置、数据库设置、打补丁和备份。

AWS RDS 支持**几种流行的关系型数据库引擎**：MySQL、PostgreSQL、MariaDB、Oracle Database、Microsoft SQL Server 和与 MySQL 或 PostgreSQL 兼容的 Amazon Aurora。

使用 RDS，您可以轻松管理数据库实例，创建读取**副本**以提高读取**性能**，并设置**多可用区（AZ）**部署以实现高可用性和故障转移支持。此外，RDS **与其他 AWS 服务集成**，如用于**访问控制**的 AWS Identity and Access Management（IAM）、用于监控和指标的 AWS **CloudWatch**，以及用于静态加密的 AWS Key Management Service（KMS）。

## 凭据

在创建 DB 集群时，可以配置主**用户名**（默认为`admin`）。要生成此用户的密码，您可以：

* 自己**指定**一个**密码**
* 告诉 RDS **自动生成**密码
* 告诉 RDS 使用 KMS 密钥在 **AWS Secret Manager** 中管理密码的加密

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### 认证

有 3 种认证选项，但始终允许使用**主密码**：

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### 公共访问和 VPC

默认情况下，数据库**不允许公共访问**，但**可以允许**。因此，默认情况下，只有来自同一 VPC 的机器才能访问它，如果所选的**安全组**（存储在 EC2 SG 中）允许访问。

可以创建一个**RDS 代理**来代替暴露 DB 实例，这将**提高**DB 集群的**可扩展性**和**可用性**。

此外，还可以修改**数据库端口**。

### 加密

使用 AWS 托管的密钥（也可以选择 CMK），**默认启用加密**。

通过启用加密，您可以为存储、快照、读取副本和备份启用**静态加密**。可以使用 **KMS** 发行用于管理此加密的密钥。\
在创建数据库时，无法添加此级别的加密。**必须在创建期间完成**。

但是，有一种**解决方法允许您对未加密的数据库进行加密**。您可以创建未加密数据库的快照，创建该快照的加密副本，使用该加密快照创建新数据库，然后最终您的数据库将被加密。

#### TDE 加密

除了 RDS 本身在应用程序级别提供的加密外，还有**其他平台级别的加密机制**可用于保护静态数据，包括称为 TDE 的 Oracle 和 SQL Server 透明数据加密。这可以与上述方法顺序一起使用，但会**影响**数据库 MySQL 加密函数和 Microsoft Transact-SQL 加密函数的性能。

如果要使用 TDE 方法，则必须首先确保数据库与选项组关联。选项组为数据库提供默认设置，并帮助进行管理，包括一些安全功能。但是，选项组仅适用于以下数据库引擎和版本。

将数据库与选项组关联后，必须确保将 Oracle 透明数据加密选项添加到该组中。一旦将 TDE 选项添加到选项组中，就无法删除。TDE 可以使用两种不同的加密模式，首先是 TDE 表空间加密，它加密整个表，其次是 TDE 列加密，它只加密数据库的个别元素。

### 枚举

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### 未经身份验证的访问

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### 提权

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### 漏洞利用后

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### 持久化

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL注入

有一些方法可以使用**SQL语法**访问DynamoDB数据，因此，典型的**SQL注入也是可能的**。

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的**公司广告**，或者如果您想访问**PEASS的最新版本或下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品，[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>
