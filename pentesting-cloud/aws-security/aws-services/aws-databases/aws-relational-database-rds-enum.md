# AWS - Enumeraci칩n de Base de Datos Relacional (RDS)

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informaci칩n B치sica

**Relational Database Service (RDS)** es un servicio de base de datos gestionado que simplifica el proceso de configuraci칩n, operaci칩n y escalado de una **base de datos relacional en la nube**. AWS RDS ofrece capacidad rentable y redimensionable, y automatiza tareas administrativas que consumen tiempo, como la provisi칩n de hardware, la configuraci칩n de la base de datos, la aplicaci칩n de parches y las copias de seguridad.

AWS RDS soporta **varios motores de base de datos relacionales populares**: MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server y Amazon Aurora compatible con MySQL o con PostgreSQL.

Con RDS, puedes gestionar f치cilmente instancias de bases de datos, crear **r칠plicas de lectura** para aumentar el **rendimiento de lectura**, y configurar despliegues en **m칰ltiples Zonas de Disponibilidad (AZ)** para alta disponibilidad y soporte de failover. Adem치s, RDS **se integra** con otros servicios de AWS, como AWS Identity and Access Management (**IAM**) para el **control de acceso**, AWS **CloudWatch** para monitoreo y m칠tricas, y AWS Key Management Service (**KMS**) para encriptaci칩n en reposo.

## Credenciales

Al crear el cl칰ster de la base de datos, el **nombre de usuario maestro** puede ser configurado (**`admin`** por defecto). Para generar la contrase침a de este usuario puedes:

* **Indicar** una **contrase침a** t칰 mismo
* Pedirle a RDS que la **genere autom치ticamente**
* Pedirle a RDS que la gestione en **AWS Secret Manager** encriptada con una clave KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Autenticaci칩n

Hay 3 tipos de opciones de autenticaci칩n, pero usar la **contrase침a maestra siempre est치 permitido**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Acceso P칰blico & VPC

Por defecto **no se concede acceso p칰blico** a las bases de datos, sin embargo, **podr칤a concederse**. Por lo tanto, por defecto solo las m치quinas de la misma VPC podr치n acceder si el **grupo de seguridad** seleccionado (almacenado en EC2 SG) lo permite.

En lugar de exponer una instancia de base de datos, es posible crear un **RDS Proxy** que **mejora** la **escalabilidad** y **disponibilidad** del cl칰ster de la base de datos.

Adem치s, el **puerto de la base de datos puede ser modificado** tambi칠n.

### Encriptaci칩n

**La encriptaci칩n est치 habilitada por defecto** utilizando una clave gestionada por AWS (se podr칤a elegir una CMK en su lugar).

Al habilitar la encriptaci칩n, est치s activando la **encriptaci칩n en reposo para tu almacenamiento, instant치neas, r칠plicas de lectura y tus copias de seguridad**. Las claves para gestionar esta encriptaci칩n pueden ser emitidas utilizando **KMS**.\
No es posible a침adir este nivel de encriptaci칩n despu칠s de que tu base de datos haya sido creada. **Debe hacerse durante su creaci칩n**.

Sin embargo, hay una **soluci칩n alternativa que te permite encriptar una base de datos no encriptada de la siguiente manera**. Puedes crear una instant치nea de tu base de datos no encriptada, crear una copia encriptada de esa instant치nea, usar esa instant치nea encriptada para crear una nueva base de datos y, entonces, finalmente, tu base de datos estar칤a encriptada.

#### Encriptaci칩n TDE

Adem치s de la encriptaci칩n ofrecida por RDS en s칤 a nivel de aplicaci칩n, hay **mecanismos adicionales de encriptaci칩n a nivel de plataforma** que podr칤an usarse para proteger los datos en reposo, incluyendo **Oracle y SQL Server Transparent Data Encryption**, conocido como TDE, y esto podr칤a usarse en conjunto con el m칠todo discutido anteriormente, pero **afectar칤a al rendimiento** de la base de datos, funciones criptogr치ficas de MySQL y funciones criptogr치ficas de Microsoft Transact-SQL.

Si quieres usar el m칠todo TDE, primero debes asegurarte de que la base de datos est칠 asociada a un grupo de opciones. Los grupos de opciones proporcionan configuraciones predeterminadas para tu base de datos y ayudan con la gesti칩n, que incluye algunas caracter칤sticas de seguridad. Sin embargo, los grupos de opciones solo existen para los siguientes motores de base de datos y versiones.

Una vez que la base de datos est칠 asociada con un grupo de opciones, debes asegurarte de que la opci칩n de Encriptaci칩n de Datos Transparente de Oracle est칠 a침adida a ese grupo. Una vez que esta opci칩n TDE ha sido a침adida al grupo de opciones, no se puede eliminar. TDE puede usar dos modos de encriptaci칩n diferentes, primero, la encriptaci칩n de espacio de tablas TDE que encripta tablas enteras y, segundo, la encriptaci칩n de columna TDE que solo encripta elementos individuales de la base de datos.

### Enumeraci칩n

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
### Acceso No Autenticado

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Escalada de Privilegios

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Explotaci칩n

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### Inyecci칩n SQL

Existen maneras de acceder a los datos de DynamoDB utilizando **sintaxis SQL**, por lo tanto, las **inyecciones SQL t칤picas tambi칠n son posibles**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras maneras de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
