# AWS - 関係データベース (RDS) 列挙

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**PEASSファミリー**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

## 基本情報

**Relational Database Service (RDS)** は、**クラウド内の関係データベース**の設定、運用、スケーリングを簡素化する管理データベースサービスです。AWS RDSは、コスト効率の良いリサイズ可能な容量を提供し、ハードウェアのプロビジョニング、データベースのセットアップ、パッチ適用、バックアップなどの時間を要する管理作業を自動化します。

AWS RDSは、**複数の人気のある関係データベースエンジン**をサポートしています：MySQL、PostgreSQL、MariaDB、Oracle Database、Microsoft SQL Server、およびMySQLまたはPostgreSQLと互換性のあるAmazon Aurora。

RDSを使用すると、データベースインスタンスを簡単に管理し、読み取り**パフォーマンス**を向上させるための読み取り**レプリカ**を作成し、高可用性とフェイルオーバーサポートのための**マルチアベイラビリティゾーン（AZ）**デプロイメントを設定することができます。さらに、RDSはAWS Identity and Access Management (**IAM**) での**アクセス制御**、AWS **CloudWatch** での監視とメトリクス、AWS Key Management Service (**KMS**) での休止状態の暗号化など、他のAWSサービスと**統合**します。

## 資格情報

DBクラスターを作成する際に、マスター**ユーザー名**を設定できます（デフォルトでは**`admin`**）。このユーザーのパスワードを生成するには：

* 自分で**パスワード**を**指定**する
* RDSに自動生成させる
* RDSにAWS Secret ManagerでKMSキーで暗号化された状態で管理させる

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### 認証

3種類の認証オプションがありますが、**マスターパスワードの使用は常に許可されています**：

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### パブリックアクセス & VPC

デフォルトではデータベースへの**パブリックアクセスは許可されていません**が、**許可される可能性があります**。したがって、デフォルトでは選択された**セキュリティグループ**（EC2 SGに保存されている）が許可する場合にのみ、同じVPCのマシンからアクセスできます。

DBインスタンスを公開する代わりに、DBクラスターの**スケーラビリティ**と**可用性**を**向上**させる**RDSプロキシ**を作成することが可能です。

さらに、**データベースポートも変更可能**です。

### 暗号化

**暗号化はデフォルトで有効**になっており、AWS管理キー（代わりにCMKを選択できます）を使用しています。

暗号化を有効にすると、ストレージ、スナップショット、読み取りレプリカ、バックアップの**休止状態の暗号化**が有効になります。この暗号化を管理するためのキーは、**KMS**を使用して発行できます。\
データベースが作成された後にこのレベルの暗号化を追加することはできません。**作成中に行う必要があります**。

ただし、次のようにして暗号化されていないデータベースを暗号化する**回避策があります**。暗号化されていないデータベースのスナップショットを作成し、そのスナップショットの暗号化されたコピーを作成し、その暗号化されたスナップショットを使用して新しいデータベースを作成し、最終的にデータベースが暗号化されます。

#### TDE暗号化

RDS自体がアプリケーションレベルで提供する暗号化に加えて、**OracleおよびSQL Serverの透過的データ暗号化**として知られるTDEなど、データの休止状態を保護するために使用できる**追加のプラットフォームレベルの暗号化メカニズム**があります。これは、前述の方法と併用できますが、データベースの**パフォーマンスに影響**を与えます。MySQLの暗号化関数とMicrosoft Transact-SQLの暗号化関数。

TDEメソッドを使用する場合は、まずデータベースがオプショングループに関連付けられていることを確認する必要があります。オプショングループは、データベースのデフォルト設定を提供し、セキュリティ機能を含む管理を支援します。ただし、オプショングループは次のデータベースエンジンとバージョンにのみ存在します。

データベースがオプショングループに関連付けられたら、Oracle透過的データ暗号化オプションがそのグループに追加されていることを確認する必要があります。このTDEオプションがオプショングループに追加されると、削除することはできません。TDEは2つの異なる暗号化モードを使用できます。まず、TDEテーブルスペース暗号化は、テーブル全体を暗号化し、次に、TDE列暗号化は、データベースの個々の要素のみを暗号化します。

### 列挙

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### 認証されていないアクセス

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### 権限昇格

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### 攻撃後の活動

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### 持続性

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQLインジェクション

**SQL構文**を使用してDynamoDBのデータにアクセスする方法があり、そのため、典型的な**SQLインジェクションも可能です**。

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)で<strong>ゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手してください。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックしてください。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加するか**、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローしてください**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有してください。

</details>
