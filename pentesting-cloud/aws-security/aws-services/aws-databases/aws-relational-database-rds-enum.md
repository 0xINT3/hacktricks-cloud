# AWS - Enumeraci√≥n de Bases de Datos Relacionales (RDS)

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop).
* Obt√©n [**productos oficiales de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>

## Informaci√≥n B√°sica

**Relational Database Service (RDS)** es un servicio de base de datos administrada que simplifica el proceso de configuraci√≥n, operaci√≥n y escalado de una **base de datos relacional en la nube**. AWS RDS proporciona capacidad rentable y escalable, y automatiza tareas administrativas que consumen tiempo, como la provisi√≥n de hardware, la configuraci√≥n de la base de datos, la aplicaci√≥n de parches y las copias de seguridad.

AWS RDS admite **varios motores de base de datos relacionales populares**: MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server y Amazon Aurora compatible con MySQL o con PostgreSQL.

Con RDS, puedes administrar f√°cilmente instancias de bases de datos, crear **r√©plicas de lectura** para aumentar el **rendimiento de lectura**, y configurar implementaciones de **multi-Availability Zone (AZ)** para alta disponibilidad y soporte de conmutaci√≥n por error. Adem√°s, RDS **se integra** con otros servicios de AWS, como AWS Identity and Access Management (**IAM**) para el **control de acceso**, AWS **CloudWatch** para la monitorizaci√≥n y m√©tricas, y AWS Key Management Service (**KMS**) para el cifrado en reposo.

## Credenciales

Al crear el cl√∫ster de la base de datos, se puede configurar el **nombre de usuario** maestro (**`admin`** de forma predeterminada). Para generar la contrase√±a de este usuario, puedes:

* **Indicar** una **contrase√±a** t√∫ mismo
* Indicar a RDS que la **genere autom√°ticamente**
* Indicar a RDS que la gestione en **AWS Secret Manager** cifrada con una clave KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Autenticaci√≥n

Existen 3 tipos de opciones de autenticaci√≥n, pero siempre se permite usar la **contrase√±a maestra**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Acceso P√∫blico y VPC

De forma predeterminada, **no se concede acceso p√∫blico** a las bases de datos, sin embargo, **se podr√≠a conceder**. Por lo tanto, de forma predeterminada, solo las m√°quinas de la misma VPC podr√°n acceder si el grupo de seguridad seleccionado (almacenado en EC2 SG) lo permite.

En lugar de exponer una instancia de base de datos, es posible crear un **Proxy de RDS** que **mejora** la **escalabilidad** y **disponibilidad** del cl√∫ster de la base de datos.

Adem√°s, tambi√©n se puede modificar el **puerto de la base de datos**.

### Cifrado

El **cifrado est√° habilitado de forma predeterminada** utilizando una clave administrada por AWS (se puede elegir una CMK en su lugar).

Al habilitar el cifrado, est√°s habilitando el **cifrado en reposo para tu almacenamiento, instant√°neas, r√©plicas de lectura y copias de seguridad**. Las claves para gestionar este cifrado se pueden emitir utilizando **KMS**.\
No es posible agregar este nivel de cifrado despu√©s de que se haya creado la base de datos. **Debe hacerse durante su creaci√≥n**.

Sin embargo, hay un **m√©todo alternativo que te permite cifrar una base de datos no cifrada de la siguiente manera**. Puedes crear una instant√°nea de tu base de datos no cifrada, crear una copia cifrada de esa instant√°nea, usar esa instant√°nea cifrada para crear una nueva base de datos y, finalmente, tu base de datos estar√° cifrada.

#### Cifrado TDE

Adem√°s del cifrado ofrecido por RDS mismo a nivel de aplicaci√≥n, existen **mecanismos adicionales de cifrado a nivel de plataforma** que se pueden utilizar para proteger los datos en reposo, incluido el **cifrado transparente de datos de Oracle y SQL Server**, conocido como TDE, y esto se puede utilizar en conjunto con el m√©todo de orden discutido, pero **afectar√≠a el rendimiento** de las funciones criptogr√°ficas de MySQL y las funciones criptogr√°ficas de Microsoft Transact-SQL.

Si deseas utilizar el m√©todo TDE, primero debes asegurarte de que la base de datos est√© asociada a un grupo de opciones. Los grupos de opciones proporcionan configuraciones predeterminadas para tu base de datos y ayudan con la gesti√≥n, que incluye algunas caracter√≠sticas de seguridad. Sin embargo, los grupos de opciones solo existen para los siguientes motores de bases de datos y versiones.

Una vez que la base de datos est√© asociada a un grupo de opciones, debes asegurarte de que la opci√≥n de Cifrado Transparente de Datos de Oracle se agregue a ese grupo. Una vez que esta opci√≥n de TDE se haya agregado al grupo de opciones, no se puede eliminar. TDE puede utilizar dos modos de cifrado diferentes, en primer lugar, el cifrado de tablespace de TDE que cifra tablas completas y, en segundo lugar, el cifrado de columna de TDE que solo cifra elementos individuales de la base de datos.

### Enumeraci√≥n

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Acceso no autenticado

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Escalada de privilegios

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Explotaci√≥n

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### Inyecci√≥n SQL

Existen formas de acceder a los datos de DynamoDB con **sintaxis SQL**, por lo tanto, tambi√©n son posibles las **inyecciones SQL t√≠picas**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**, ¬°consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
