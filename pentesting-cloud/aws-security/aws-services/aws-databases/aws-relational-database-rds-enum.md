# AWS - Enumeraci√≥n de Base de Datos Relacional (RDS)

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informaci√≥n B√°sica

El **Servicio de Base de Datos Relacional (RDS)** ofrecido por AWS est√° dise√±ado para simplificar la implementaci√≥n, operaci√≥n y escalado de una **base de datos relacional en la nube**. Este servicio ofrece las ventajas de eficiencia de costos y escalabilidad al automatizar tareas intensivas en mano de obra como la provisi√≥n de hardware, configuraci√≥n de la base de datos, parches y copias de seguridad.

AWS RDS admite varios motores de base de datos relacionales ampliamente utilizados, incluidos MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server y Amazon Aurora, con compatibilidad tanto para MySQL como para PostgreSQL.

Las caracter√≠sticas clave de RDS incluyen:

- La **gesti√≥n de instancias de base de datos** se simplifica.
- Creaci√≥n de **r√©plicas de lectura** para mejorar el rendimiento de lectura.
- Configuraci√≥n de **implementaciones en m√∫ltiples Zonas de Disponibilidad (AZ)** para garantizar alta disponibilidad y mecanismos de conmutaci√≥n por error.
- **Integraci√≥n** con otros servicios de AWS, como:
  - AWS Identity and Access Management (**IAM**) para un control de acceso s√≥lido.
  - AWS **CloudWatch** para monitoreo y m√©tricas completas.
  - AWS Key Management Service (**KMS**) para garantizar el cifrado en reposo.

## Credenciales

Al crear el cl√∫ster de la base de datos, se puede configurar el **nombre de usuario maestro** (**`admin`** de forma predeterminada). Para generar la contrase√±a de este usuario puedes:

* **Indicar** una **contrase√±a** t√∫ mismo
* Indicar a RDS que la **genere autom√°ticamente**
* Indicar a RDS que la administre en **AWS Secret Manager** cifrada con una clave KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Autenticaci√≥n

Existen 3 tipos de opciones de autenticaci√≥n, pero siempre se permite usar la **contrase√±a maestra**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Acceso P√∫blico y VPC

Por defecto, **no se otorga acceso p√∫blico** a las bases de datos, sin embargo, **podr√≠a otorgarse**. Por lo tanto, de forma predeterminada, solo las m√°quinas de la misma VPC podr√°n acceder si el **grupo de seguridad** seleccionado (almacenado en EC2 SG) lo permite.

En lugar de exponer una instancia de base de datos, es posible crear un **Proxy de RDS** que **mejora** la **escalabilidad** y **disponibilidad** del cl√∫ster de la base de datos.

Adem√°s, tambi√©n se puede modificar el **puerto de la base de datos**.

### Cifrado

El **cifrado est√° habilitado de forma predeterminada** utilizando una clave administrada por AWS (se podr√≠a elegir un CMK en su lugar).

Al habilitar el cifrado, est√°s activando el **cifrado en reposo para tu almacenamiento, instant√°neas, r√©plicas de lectura y copias de seguridad**. Las claves para administrar este cifrado se pueden emitir utilizando **KMS**.\
No es posible agregar este nivel de cifrado despu√©s de que se haya creado tu base de datos. **Debe hacerse durante su creaci√≥n**.

Sin embargo, hay un **m√©todo que te permite cifrar una base de datos no cifrada de la siguiente manera**. Puedes crear una instant√°nea de tu base de datos no cifrada, crear una copia cifrada de esa instant√°nea, usar esa instant√°nea cifrada para crear una nueva base de datos y luego, finalmente, tu base de datos estar√≠a cifrada.

#### Cifrado de Datos Transparente (TDE)

Junto con las capacidades de cifrado inherentes a RDS a nivel de aplicaci√≥n, RDS tambi√©n admite **mecanismos de cifrado adicionales a nivel de plataforma** para proteger los datos en reposo. Esto incluye **Cifrado de Datos Transparente (TDE)** para Oracle y SQL Server. Sin embargo, es crucial tener en cuenta que si bien TDE mejora la seguridad al cifrar datos en reposo, tambi√©n puede **afectar el rendimiento de la base de datos**. Este impacto en el rendimiento es especialmente notable cuando se utiliza en conjunto con funciones criptogr√°ficas de MySQL o funciones criptogr√°ficas de Microsoft Transact-SQL.

Para utilizar TDE, se requieren ciertos pasos preliminares:

1. **Asociaci√≥n de Grupo de Opciones**:
   - La base de datos debe estar asociada con un grupo de opciones. Los grupos de opciones sirven como contenedores para configuraciones y funciones, facilitando la gesti√≥n de la base de datos, incluidas las mejoras de seguridad.
   - Sin embargo, es importante tener en cuenta que los grupos de opciones solo est√°n disponibles para motores de base de datos y versiones espec√≠ficas.

2. **Inclusi√≥n de TDE en el Grupo de Opciones**:
   - Una vez asociado con un grupo de opciones, la opci√≥n de Cifrado de Datos Transparente de Oracle debe incluirse en ese grupo.
   - Es esencial reconocer que una vez que se agrega la opci√≥n de TDE a un grupo de opciones, se convierte en una caracter√≠stica permanente y no se puede eliminar.

3. **Modos de Cifrado de TDE**:
   - TDE ofrece dos modos de cifrado distintos:
     - **Cifrado de Espacio de Tabla TDE**: Este modo cifra tablas completas, proporcionando un alcance m√°s amplio de protecci√≥n de datos.
     - **Cifrado de Columna TDE**: Este modo se centra en cifrar elementos espec√≠ficos e individuales dentro de la base de datos, lo que permite un control m√°s granular sobre qu√© datos se cifran.

Comprender estos requisitos previos y las complejidades operativas de TDE es crucial para implementar y gestionar de manera efectiva el cifrado dentro de RDS, garantizando tanto la seguridad de los datos como el cumplimiento de los est√°ndares necesarios.

### Enumeraci√≥n

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Acceso no autenticado

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Escalada de privilegios

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Explotaci√≥n

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### Inyecci√≥n SQL

Existen formas de acceder a los datos de DynamoDB con **sintaxis SQL**, por lo tanto, las **inyecciones SQL t√≠picas tambi√©n son posibles**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
