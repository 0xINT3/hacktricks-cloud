# AWS - Enumeraci칩n de Base de Datos Relacional (RDS)

<details>

<summary><strong>Aprende hacking de AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informaci칩n B치sica

El **Servicio de Base de Datos Relacional (RDS)** ofrecido por AWS est치 dise침ado para simplificar la implementaci칩n, operaci칩n y escalado de una **base de datos relacional en la nube**. Este servicio ofrece ventajas de eficiencia de costos y escalabilidad, mientras automatiza tareas intensivas en mano de obra como la provisi칩n de hardware, configuraci칩n de la base de datos, parches y copias de seguridad.

AWS RDS soporta varios motores de base de datos relacionales ampliamente utilizados, incluyendo MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server y Amazon Aurora, con compatibilidad para MySQL y PostgreSQL.

Las caracter칤sticas clave de RDS incluyen:

- La **gesti칩n de instancias de base de datos** se simplifica.
- Creaci칩n de **r칠plicas de lectura** para mejorar el rendimiento de lectura.
- Configuraci칩n de **implementaciones en m칰ltiples Zonas de Disponibilidad (AZ)** para garantizar alta disponibilidad y mecanismos de failover.
- **Integraci칩n** con otros servicios de AWS, como:
  - AWS Identity and Access Management (**IAM**) para un control de acceso robusto.
  - AWS **CloudWatch** para monitoreo y m칠tricas completas.
  - AWS Key Management Service (**KMS**) para garantizar la encriptaci칩n en reposo.

## Credenciales

Al crear el cl칰ster de la base de datos, se puede configurar el **nombre de usuario maestro** (**`admin`** por defecto). Para generar la contrase침a de este usuario puedes:

* **Indicar** una **contrase침a** t칰 mismo
* Pedirle a RDS que la **genere autom치ticamente**
* Pedirle a RDS que la gestione en **AWS Secret Manager** encriptada con una clave KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Autenticaci칩n

Hay 3 tipos de opciones de autenticaci칩n, pero usar la **contrase침a maestra siempre est치 permitido**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Acceso P칰blico & VPC

Por defecto **no se concede acceso p칰blico** a las bases de datos, sin embargo, **podr칤a concederse**. Por lo tanto, por defecto solo las m치quinas de la misma VPC podr치n acceder si el **grupo de seguridad** seleccionado (almacenado en EC2 SG) lo permite.

En lugar de exponer una instancia de base de datos, es posible crear un **Proxy RDS** que **mejora** la **escalabilidad** y **disponibilidad** del cl칰ster de la base de datos.

Adem치s, el **puerto de la base de datos se puede modificar** tambi칠n.

### Encriptaci칩n

La **encriptaci칩n est치 habilitada por defecto** utilizando una clave gestionada por AWS (se podr칤a elegir una CMK en su lugar).

Al habilitar tu encriptaci칩n, est치s habilitando la **encriptaci칩n en reposo para tu almacenamiento, instant치neas, r칠plicas de lectura y tus copias de seguridad**. Las claves para gestionar esta encriptaci칩n se pueden emitir utilizando **KMS**.\
No es posible agregar este nivel de encriptaci칩n despu칠s de que tu base de datos haya sido creada. **Tiene que hacerse durante su creaci칩n**.

Sin embargo, hay una **soluci칩n alternativa que te permite encriptar una base de datos no encriptada de la siguiente manera**. Puedes crear una instant치nea de tu base de datos no encriptada, crear una copia encriptada de esa instant치nea, usar esa instant치nea encriptada para crear una nueva base de datos y luego, finalmente, tu base de datos estar칤a encriptada.

#### Encriptaci칩n de Datos Transparente (TDE)

Adem치s de las capacidades de encriptaci칩n inherentes a RDS a nivel de aplicaci칩n, RDS tambi칠n soporta **mecanismos de encriptaci칩n adicionales a nivel de plataforma** para proteger los datos en reposo. Esto incluye **Encriptaci칩n de Datos Transparente (TDE)** para Oracle y SQL Server. Sin embargo, es crucial tener en cuenta que, aunque TDE mejora la seguridad encriptando los datos en reposo, tambi칠n puede **afectar el rendimiento de la base de datos**. Este impacto en el rendimiento es especialmente notable cuando se utiliza en conjunto con funciones criptogr치ficas de MySQL o funciones criptogr치ficas de Transact-SQL de Microsoft.

Para utilizar TDE, se requieren ciertos pasos preliminares:

1. **Asociaci칩n con Grupo de Opciones**:
   - La base de datos debe estar asociada con un grupo de opciones. Los grupos de opciones sirven como contenedores para configuraciones y caracter칤sticas, facilitando la gesti칩n de la base de datos, incluyendo mejoras de seguridad.
   - Sin embargo, es importante tener en cuenta que los grupos de opciones solo est치n disponibles para ciertos motores y versiones de bases de datos.

2. **Inclusi칩n de TDE en Grupo de Opciones**:
   - Una vez asociada con un grupo de opciones, la opci칩n de Encriptaci칩n de Datos Transparente de Oracle necesita ser incluida en ese grupo.
   - Es esencial reconocer que una vez que la opci칩n TDE se agrega a un grupo de opciones, se convierte en un elemento permanente y no se puede eliminar.

3. **Modos de Encriptaci칩n TDE**:
   - TDE ofrece dos modos de encriptaci칩n distintos:
     - **Encriptaci칩n de Espacio de Tablas TDE**: Este modo encripta tablas enteras, proporcionando un alcance m치s amplio de protecci칩n de datos.
     - **Encriptaci칩n de Columna TDE**: Este modo se centra en encriptar elementos espec칤ficos individuales dentro de la base de datos, permitiendo un control m치s granular sobre qu칠 datos se encriptan.

Comprender estos requisitos previos y las complejidades operativas de TDE es crucial para implementar y gestionar efectivamente la encriptaci칩n dentro de RDS, asegurando tanto la seguridad de los datos como el cumplimiento de los est치ndares necesarios.

### Enumeraci칩n

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
### Acceso no autenticado

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Escalada de Privilegios

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Explotaci칩n

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### Inyecci칩n SQL

Existen formas de acceder a los datos de DynamoDB con **sintaxis SQL**, por lo tanto, las **inyecciones SQL t칤picas tambi칠n son posibles**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
