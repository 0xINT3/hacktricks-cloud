# AWS - 关系型数据库 (RDS) 枚举

<details>

<summary><strong>从零开始学习AWS黑客攻击直至成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在 **HackTricks中看到您的公司广告** 或 **下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 基本信息

**关系型数据库服务 (RDS)** 是一种托管数据库服务，简化了在云中设置、操作和扩展**关系型数据库**的过程。AWS RDS提供成本效益高且可调整大小的容量，并自动执行耗时的管理任务，如硬件配置、数据库设置、补丁和备份。

AWS RDS支持**几种流行的关系型数据库引擎**：MySQL、PostgreSQL、MariaDB、Oracle数据库、Microsoft SQL Server和兼容MySQL或PostgreSQL的Amazon Aurora。

使用RDS，您可以轻松管理数据库实例，创建读取**副本**以提高读取**性能**，并设置**多可用区 (AZ)** 部署以实现高可用性和故障转移支持。此外，RDS还**集成**了其他AWS服务，如AWS身份和访问管理（**IAM**）用于**访问控制**，AWS **CloudWatch**用于监控和指标，以及AWS密钥管理服务（**KMS**）用于静态数据加密。

## 凭证

创建DB集群时，可以配置主**用户名**（默认为**`admin`**）。要生成此用户的密码，您可以：

* **指定**一个**密码**
* 让RDS**自动生成**密码
* 让RDS在**AWS Secret Manager**中管理密码，并使用KMS密钥加密

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### 认证

有3种认证选项，但始终允许使用**主密码**：

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### 公共访问 & VPC

默认情况下，数据库**不允许公共访问**，但**可以授权**。因此，默认情况下，如果选定的**安全组**（存储在EC2 SG中）允许，则只有来自同一VPC的机器才能访问它。

可以创建一个**RDS代理**，而不是暴露DB实例，这可以**提高**数据库集群的**可扩展性**和**可用性**。

此外，**数据库端口也可以修改**。

### 加密

默认情况下，使用AWS管理的密钥（也可以选择CMK）启用**加密**。

启用加密意味着您为存储、快照、读取副本和备份启用了**静态数据加密**。可以使用**KMS**来管理这些加密密钥。\
在数据库创建后，无法添加这种级别的加密。**必须在创建过程中完成**。

然而，有一种**变通方法允许您加密未加密的数据库**，如下所示。您可以创建未加密数据库的快照，创建该快照的加密副本，使用该加密快照创建新数据库，然后，最终，您的数据库将被加密。

#### TDE加密

除了RDS本身在应用程序级别提供的加密之外，还有**额外的平台级别加密机制**可用于保护静态数据，包括**Oracle和SQL Server透明数据加密**，即TDE，这可以与前面讨论的方法结合使用，但它会**影响数据库的性能**，MySQL加密函数和Microsoft Transact-SQL加密函数。

如果您想使用TDE方法，那么您必须首先确保数据库与选项组关联。选项组为您的数据库提供默认设置，并帮助管理，其中包括一些安全功能。然而，只有以下数据库引擎和版本存在选项组。

一旦数据库与选项组关联，您必须确保Oracle透明数据加密选项已添加到该组。一旦将TDE选项添加到选项组，就无法移除。TDE可以使用两种不同的加密模式，首先是TDE表空间加密，它加密整个表，其次是TDE列加密，它只加密数据库的个别元素。

### 枚举

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### 未经认证的访问

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### 权限提升

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### 后期利用

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### 持久化

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL 注入

存在使用 **SQL 语法** 访问 DynamoDB 数据的方法，因此，典型的 **SQL 注入也是可能的**。

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>从零到英雄学习 AWS 黑客攻击！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您希望在 HackTricks 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享您的黑客技巧**。

</details>
