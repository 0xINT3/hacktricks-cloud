# AWS - Enumeraci√≥n de Bases de Datos Relacionales (RDS)

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si deseas ver a tu **empresa anunciada en HackTricks** o si deseas acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop).
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

</details>

## Informaci√≥n B√°sica

**Relational Database Service (RDS)** es un servicio de base de datos administrado que simplifica el proceso de configuraci√≥n, operaci√≥n y escalado de una **base de datos relacional en la nube**. AWS RDS proporciona capacidad escalable y rentable, y automatiza tareas de administraci√≥n que consumen tiempo, como la provisi√≥n de hardware, la configuraci√≥n de la base de datos, el parcheo y las copias de seguridad.

AWS RDS admite **varios motores de base de datos relacionales populares**: MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server y Amazon Aurora compatible con MySQL o con PostgreSQL.

Con RDS, puedes administrar f√°cilmente instancias de bases de datos, crear **r√©plicas de lectura** para aumentar el **rendimiento** de lectura y configurar implementaciones de **multi-zona de disponibilidad (AZ)** para alta disponibilidad y soporte de conmutaci√≥n por error. Adem√°s, RDS **se integra** con otros servicios de AWS, como AWS Identity and Access Management (**IAM**) para **control de acceso**, AWS **CloudWatch** para monitoreo y m√©tricas, y AWS Key Management Service (**KMS**) para cifrado en reposo.

## Credenciales

Al crear el cl√∫ster de la base de datos, se puede configurar el **nombre de usuario** maestro (por defecto es **`admin`**). Para generar la contrase√±a de este usuario, puedes:

* **Indicar** una **contrase√±a** t√∫ mismo
* Decirle a RDS que la **genere autom√°ticamente**
* Decirle a RDS que la gestione en **AWS Secret Manager** cifrada con una clave KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Autenticaci√≥n

Existen 3 opciones de autenticaci√≥n, pero siempre se permite usar la **contrase√±a maestra**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Acceso P√∫blico y VPC

Por defecto, **no se concede acceso p√∫blico** a las bases de datos, sin embargo, **podr√≠a ser concedido**. Por lo tanto, por defecto, solo las m√°quinas de la misma VPC podr√°n acceder si el **grupo de seguridad** seleccionado (almacenado en EC2 SG) lo permite.

En lugar de exponer una instancia de BD, es posible crear un **proxy de RDS** que **mejora** la **escalabilidad** y **disponibilidad** del cl√∫ster de BD.

Adem√°s, el **puerto de la base de datos tambi√©n puede ser modificado**.

### Cifrado

El **cifrado est√° habilitado por defecto** utilizando una clave administrada por AWS (se puede elegir un CMK en su lugar).

Al habilitar el cifrado, est√°s habilitando el **cifrado en reposo para tu almacenamiento, instant√°neas, r√©plicas de lectura y tus copias de seguridad**. Las claves para administrar este cifrado se pueden emitir utilizando **KMS**.\
No es posible agregar este nivel de cifrado despu√©s de que se haya creado tu base de datos. **Debe hacerse durante su creaci√≥n**.

Sin embargo, hay un **trabajo en torno que te permite cifrar una base de datos sin cifrar de la siguiente manera**. Puedes crear una instant√°nea de tu base de datos sin cifrar, crear una copia cifrada de esa instant√°nea, usar esa instant√°nea cifrada para crear una nueva base de datos y, finalmente, tu base de datos estar√≠a cifrada.

#### Cifrado TDE

Adem√°s del cifrado ofrecido por RDS en s√≠ a nivel de aplicaci√≥n, existen **mecanismos de cifrado de nivel de plataforma adicionales** que podr√≠an usarse para proteger los datos en reposo, incluido el **cifrado transparente de datos de Oracle y SQL Server**, conocido como TDE, y esto podr√≠a usarse en conjunto con el m√©todo de orden discutido, pero **afectar√≠a el rendimiento** de las funciones criptogr√°ficas de la base de datos MySQL y las funciones criptogr√°ficas de Microsoft Transact-SQL.

Si deseas utilizar el m√©todo TDE, primero debes asegurarte de que la base de datos est√© asociada a un grupo de opciones. Los grupos de opciones proporcionan configuraciones predeterminadas para tu base de datos y ayudan con la gesti√≥n, que incluye algunas caracter√≠sticas de seguridad. Sin embargo, los grupos de opciones solo existen para los siguientes motores de base de datos y versiones.

Una vez que la base de datos est√© asociada con un grupo de opciones, debes asegurarte de que se agregue la opci√≥n de cifrado transparente de datos de Oracle a ese grupo. Una vez que se haya agregado esta opci√≥n TDE al grupo de opciones, no se puede eliminar. TDE puede usar dos modos de cifrado diferentes, en primer lugar, el cifrado de tablespace TDE que cifra tablas completas y, en segundo lugar, el cifrado de columna TDE que solo cifra elementos individuales de la base de datos.

### Enumeraci√≥n

{% code overflow="wrap" %}
```bash
# Informaci√≥n de cl√∫steres
aws rds describe-db-clusters #¬øHabilitado IAM? ¬øP√∫blico? ¬øPuerto? ¬øDG?
aws rds describe-db-cluster-endpoints #URLs del cl√∫ster
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Instant√°neas de cl√∫steres
aws rds describe-db-cluster-snapshots

# Obtener informaci√≥n de las instancias de BD
aws rds describe-db-instances #¬øNombre de usuario? ¬øURL? ¬øPuerto? ¬øVPC? ¬øSG? ¬øP√∫blico?
aws rds describe-db-security-groups

## Encontrar copias de seguridad autom√°ticas
aws rds describe-db-instance-automated-backups

## Encontrar instant√°neas
aws rds describe-db-snapshots 
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restaurar instant√°nea como nueva instancia
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Cualquier instant√°nea p√∫blica en la cuenta
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## Restablecer credenciales de MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Acceso No Autenticado

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Escalada de Privilegios

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Explotaci√≥n