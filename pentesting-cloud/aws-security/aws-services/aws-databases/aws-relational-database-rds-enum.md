# AWS - 関係データベース (RDS) 列挙

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**、または**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**PEASSファミリー**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**する。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

## 基本情報

AWSが提供する**関係データベースサービス (RDS)** は、**クラウド内の関係データベース**の展開、運用、およびスケーリングを合理化するように設計されています。このサービスは、コスト効率とスケーラビリティの利点を提供し、ハードウェアのプロビジョニング、データベースの設定、パッチ適用、バックアップなどの労働集約的なタスクを自動化します。

AWS RDSは、MySQL、PostgreSQL、MariaDB、Oracle Database、Microsoft SQL Server、Amazon Auroraなど、広く使用されているさまざまな関係データベースエンジンをサポートしており、MySQLとPostgreSQLの両方に対応しています。

RDSの主な機能には以下が含まれます:

- **データベースインスタンスの管理**が簡素化されます。
- 読み取りパフォーマンスを向上させるための**リードレプリカ**の作成。
- 高可用性とフェイルオーバーメカニズムを確保するための**マルチアベイラビリティゾーン (AZ) デプロイメント**の設定。
- 他のAWSサービスとの**統合**、例えば:
- 強力なアクセス制御のためのAWS Identity and Access Management (**IAM**)。
- 包括的な監視とメトリクスのためのAWS **CloudWatch**。
- 休止状態での暗号化を確保するためのAWS Key Management Service (**KMS**)。


## 資格情報

DBクラスターを作成する際に、マスター**ユーザー名**を設定できます（デフォルトでは**`admin`**）。このユーザーのパスワードを生成するには:

* 自分で**パスワード**を**指定**する
* RDSに**自動生成**させる
* RDSに**AWS Secret Manager**でKMSキーで暗号化された状態で管理させる

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### 認証

3種類の認証オプションがありますが、**マスターパスワードの使用は常に許可されています**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### パブリックアクセス & VPC

デフォルトではデータベースへの**パブリックアクセスは許可されていません**が、**許可される可能性があります**。したがって、デフォルトでは選択された**セキュリティグループ**（EC2 SGに保存されている）が許可する場合にのみ、同じVPCのマシンからのみアクセスできます。

DBインスタンスを露出させる代わりに、DBクラスターの**スケーラビリティ**と**可用性**を**向上**させる**RDSプロキシ**を作成することが可能です。

さらに、**データベースポートも変更**することができます。

### 暗号化

**暗号化はデフォルトで有効**になっており、AWS管理キー（代わりにCMKを選択できます）を使用しています。

暗号化を有効にすることで、ストレージ、スナップショット、リードレプリカ、バックアップの**休止状態での暗号化**が有効になります。この暗号化を管理するためのキーは**KMS**を使用して発行できます。\
データベースが作成された後にこのレベルの暗号化を追加することはできません。**作成中に行う必要があります**。

ただし、以下のようにして暗号化されていないデータベースを暗号化する**回避策があります**。暗号化されていないデータベースのスナップショットを作成し、そのスナップショットの暗号化されたコピーを作成し、その暗号化されたスナップショットを使用して新しいデータベースを作成し、最終的に、データベースが暗号化されます。

#### 透過的データ暗号化 (TDE)

RDSに固有のアプリケーションレベルの暗号化機能に加えて、RDSは**追加のプラットフォームレベルの暗号化メカニズム**もサポートしており、休止状態のデータを保護します。これには、OracleとSQL Serverの**透過的データ暗号化 (TDE)** が含まれます。ただし、TDEは休止状態のデータを暗号化することでセキュリティを強化する一方で、MySQLの暗号化関数やMicrosoft Transact-SQLの暗号化関数と組み合わせた場合には、**データベースのパフォーマンスに影響を与える可能性がある**ことに注意が必要です。

TDEを利用するためには、いくつかの準備ステップが必要です:

1. **オプショングループの関連付け**:
- データベースはオプショングループに関連付けられている必要があります。オプショングループは、セキュリティ強化を含む設定や機能のコンテナとして機能し、データベース管理を容易にします。
- ただし、オプショングループは特定のデータベースエンジンとバージョンでのみ利用可能であることに注意が必要です。

2. **オプショングループへのTDEの追加**:
- オプショングループに関連付けられたら、Oracle Transparent Data Encryptionオプションをそのグループに含める必要があります。
- TDEオプションをオプショングループに追加すると、それは永続的なものとなり、削除することはできないことを認識することが重要です。

3. **TDE暗号化モード**:
- TDEには2つの異なる暗号化モードがあります:
- **TDE Tablespace Encryption**: このモードはテーブル全体を暗号化し、より広範なデータ保護を提供します。
- **TDE Column Encryption**: このモードはデータベース内の特定の個々の要素を暗号化することに焦点を当て、どのデータを暗号化するかについてより細かな制御を可能にします。

これらの前提条件とTDEの運用の複雑さを理解することは、RDS内での暗号化の効果的な実装と管理に不可欠であり、データセキュリティと必要な基準への準拠を確保します。

### 列挙

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### 認証されていないアクセス

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### 権限昇格

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### 攻撃後の活動

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### 持続性

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQLインジェクション

**SQL構文**を使用してDynamoDBデータにアクセスする方法があり、そのため、典型的な**SQLインジェクションも可能です**。

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)で<strong>ゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>!</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックしてください。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加するか**、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローしてください**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有してください**。

</details>
