# AWS - Enum√©ration de la base de donn√©es relationnelle (RDS)

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informations de base

**Relational Database Service (RDS)** est un service de base de donn√©es g√©r√© qui simplifie le processus de configuration, d'exploitation et de mise √† l'√©chelle d'une **base de donn√©es relationnelle dans le cloud**. AWS RDS fournit une capacit√© rentable et redimensionnable, et automatise les t√¢ches d'administration chronophages, telles que la provision de mat√©riel, la configuration de la base de donn√©es, le patching et les sauvegardes.

AWS RDS prend en charge **plusieurs moteurs de base de donn√©es relationnels populaires** : MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server et Amazon Aurora compatible avec MySQL ou avec PostgreSQL.

Avec RDS, vous pouvez facilement g√©rer les instances de base de donn√©es, cr√©er des **r√©pliques de lecture** pour augmenter les performances de lecture, et configurer des d√©ploiements **multi-zones de disponibilit√© (AZ)** pour une haute disponibilit√© et une prise en charge de la reprise apr√®s sinistre. De plus, RDS **s'int√®gre** √† d'autres services AWS, tels que AWS Identity and Access Management (**IAM**) pour le **contr√¥le d'acc√®s**, AWS **CloudWatch** pour la surveillance et les m√©triques, et AWS Key Management Service (**KMS**) pour le chiffrement au repos.

## Identifiants

Lors de la cr√©ation du cluster de base de donn√©es, le **nom d'utilisateur principal** peut √™tre configur√© (**`admin`** par d√©faut). Pour g√©n√©rer le mot de passe de cet utilisateur, vous pouvez :

* **Indiquer** un **mot de passe** vous-m√™me
* Demander √† RDS de le **g√©n√©rer automatiquement**
* Demander √† RDS de le g√©rer dans **AWS Secret Manager** chiffr√© avec une cl√© KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Authentification

Il existe 3 types d'options d'authentification, mais l'utilisation du **mot de passe principal est toujours autoris√©e** :

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Acc√®s public et VPC

Par d√©faut, **aucun acc√®s public n'est accord√©** aux bases de donn√©es, cependant, il **pourrait √™tre accord√©**. Par cons√©quent, par d√©faut, seules les machines du m√™me VPC pourront y acc√©der si le groupe de s√©curit√© s√©lectionn√© (stock√© dans EC2 SG) le permet.

Au lieu d'exposer une instance de base de donn√©es, il est possible de cr√©er un **proxy RDS** qui **am√©liore** la **scalabilit√©** et la **disponibilit√©** du cluster de base de donn√©es.

De plus, le **port de la base de donn√©es peut √©galement √™tre modifi√©**.

### Chiffrement

Le **chiffrement est activ√© par d√©faut** en utilisant une cl√© g√©r√©e par AWS (une CMK pourrait √™tre choisie √† la place).

En activant votre chiffrement, vous activez le **chiffrement au repos pour votre stockage, vos instantan√©s, vos r√©pliques de lecture et vos sauvegardes**. Les cl√©s pour g√©rer ce chiffrement peuvent √™tre √©mises en utilisant **KMS**.\
Il n'est pas possible d'ajouter ce niveau de chiffrement apr√®s la cr√©ation de votre base de donn√©es. **Il doit √™tre fait pendant sa cr√©ation**.

Cependant, il existe une **solution de contournement vous permettant de chiffrer une base de donn√©es non chiffr√©e comme suit**. Vous pouvez cr√©er un instantan√© de votre base de donn√©es non chiffr√©e, cr√©er une copie chiffr√©e de cet instantan√©, utiliser cet instantan√© chiffr√© pour cr√©er une nouvelle base de donn√©es, et enfin, votre base de donn√©es serait alors chiffr√©e.

#### Chiffrement TDE

En plus du chiffrement offert par RDS lui-m√™me au niveau de l'application, il existe des **m√©canismes de chiffrement suppl√©mentaires au niveau de la plateforme** qui pourraient √™tre utilis√©s pour prot√©ger les donn√©es au repos, y compris **Oracle et SQL Server Transparent Data Encryption**, connus sous le nom de TDE, et cela pourrait √™tre utilis√© en conjonction avec la m√©thode de commande discut√©e mais cela **affecterait les performances** des fonctions cryptographiques MySQL et des fonctions cryptographiques Microsoft Transact-SQL.

Si vous voulez utiliser la m√©thode TDE, vous devez d'abord vous assurer que la base de donn√©es est associ√©e √† un groupe d'options. Les groupes d'options fournissent des param√®tres par d√©faut pour votre base de donn√©es et aident √† la gestion, ce qui comprend certaines fonctionnalit√©s de s√©curit√©. Cependant, les groupes d'options n'existent que pour les moteurs de base de donn√©es et les versions suivants.

Une fois que la base de donn√©es est associ√©e √† un groupe d'options, vous devez vous assurer que l'option de chiffrement transparent des donn√©es Oracle est ajout√©e √† ce groupe. Une fois que cette option TDE a √©t√© ajout√©e au groupe d'options, elle ne peut pas √™tre supprim√©e. TDE peut utiliser deux modes de chiffrement diff√©rents, d'abord, le chiffrement de tablespace TDE qui chiffre des tables enti√®res et, deuxi√®mement, le chiffrement de colonne TDE qui chiffre simplement des √©l√©ments individuels de la base de donn√©es.

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# Informations sur les clusters
aws rds describe-db-clusters #IAM activ√© ? public ? port ? DG ?
aws rds describe-db-cluster-endpoints #URL des clusters
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Instantan√©s de cluster
aws rds describe-db-cluster-snapshots

# Obtenir des informations sur les instances de base de donn√©es
aws rds describe-db-instances #nom d'utilisateur ? url ? port ? vpc ? SG ? public ?
aws rds describe-db-security-groups

## Trouver des sauvegardes automatis√©es
aws rds describe-db-instance-automated-backups

## Trouver des instantan√©s
aws rds describe-db-snapshots 
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restaurer un instantan√© en tant que nouvelle instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Tout instantan√© public dans le compte
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## R√©initialiser les informations d'identification de MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID>