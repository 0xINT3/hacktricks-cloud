# AWS - リレーショナルデータベース（RDS）の列挙

<details>

<summary><strong>HackTricksをサポートして特典を受け取る！</strong></summary>

* **HackTricksで会社を宣伝**したい場合や、**最新バージョンのPEASSを入手**したい場合、または**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をご確認ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見する
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**でフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## 基本情報

**リレーショナルデータベースサービス（RDS）**は、**クラウド上でリレーショナルデータベースを設定、運用、スケーリングする**プロセスを簡素化するマネージドデータベースサービスです。AWS RDSは、コスト効率の高いリサイズ可能な容量を提供し、ハードウェアのプロビジョニング、データベースのセットアップ、パッチ適用、バックアップなど、時間のかかる管理タスクを自動化します。

AWS RDSは、**いくつかの人気のあるリレーショナルデータベースエンジン**をサポートしています：MySQL、PostgreSQL、MariaDB、Oracle Database、Microsoft SQL Server、Amazon Aurora（MySQLまたはPostgreSQL互換）。

RDSを使用すると、簡単にデータベースインスタンスを管理し、読み取りパフォーマンスを向上させるために読み取りレプリカを作成し、高可用性とフェイルオーバーサポートのために**マルチアベイラビリティゾーン（AZ）デプロイメント**を設定できます。さらに、RDSは、アクセス制御のためのAWS Identity and Access Management（IAM）、監視とメトリクスのためのAWS CloudWatch、暗号化のためのAWS Key Management Service（KMS）など、他のAWSサービスと統合します。

## 資格情報

DBクラスタを作成する際、マスター**ユーザー名**を設定できます（デフォルトは**`admin`**）。このユーザーのパスワードを生成するには、次の方法があります。

* 自分で**パスワード**を指定する
* RDSに**自動生成**させる
* RDSによって**AWS Secret Manager**で管理されたKMSキーで暗号化するように指定する

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### 認証

認証オプションは3つありますが、**マスターパスワードを使用することは常に許可されています**。

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### パブリックアクセスとVPC

デフォルトでは、データベースへの**パブリックアクセスは許可されていません**が、**許可される場合があります**。したがって、デフォルトでは、同じVPCからのみアクセスできるようになります（選択したセキュリティグループはEC2 SGに保存されます）。

DBインスタンスを公開する代わりに、DBクラスタの**スケーラビリティ**と**可用性**を向上させるために、**RDS Proxy**を作成することもできます。

さらに、**データベースポートを変更**することもできます。

### 暗号化

**暗号化はデフォルトで有効**になっています（AWS管理キーを使用するか、CMKを選択することもできます）。

暗号化を有効にすると、ストレージ、スナップショット、読み取りレプリカ、バックアップの**静止状態での暗号化**が有効になります。この暗号化の管理には**KMS**を使用してキーを発行できます。\
データベースが作成された後にこの暗号化レベルを追加することはできません。**作成時に行う必要があります**。

ただし、次の方法で暗号化されていないデータベースを暗号化することもできる**回避策**があります。暗号化されていないデータベースのスナップショットを作成し、そのスナップショットの暗号化コピーを作成し、その暗号化されたスナップショットを使用して新しいデータベースを作成し、最後にデータベースを暗号化します。

#### TDE暗号化

RDS自体が提供する暗号化に加えて、**OracleおよびSQL Server Transparent Data Encryption（TDE）**と呼ばれる追加のプラットフォームレベルの暗号化メカニズムがあります。これは、データベースの暗号化に影響を与える可能性があるため、MySQLの暗号化関数とMicrosoft Transact-SQLの暗号化関数に影響を与えます。

TDEメソッドを使用する場合は、まずデータベースがオプショングループに関連付けられていることを確認する必要があります。オプショングループは、データベースのデフォルト設定を提供し、セキュリティ機能を含む管理を支援します。ただし、オプショングループは次のデータベースエンジンとバージョンのみで使用できます。

データベースがオプショングループに関連付けられたら、Oracle Transparent Data Encryptionオプションがそのグループに追加されていることを確認する必要があります。このTDEオプションがオプショングループに追加された後は、削除することはできません。TDEは2つの異なる暗号化モードを使用できます。第一に、テーブルスペースの暗号化でテーブル全体を暗号化し、第二に、列の暗号化でデータベースの個々の要素を暗号化します。

### 列挙

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### 認証されていないアクセス

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### 特権昇格

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### 攻撃後の処理

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### 永続化

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQLインジェクション

**SQL構文**を使用してDynamoDBデータにアクセスする方法があります。そのため、一般的な**SQLインジェクションも可能**です。

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>ハックトリックをサポートして特典を受け取る！</strong></summary>

* **HackTricksで会社を宣伝**したい場合や、**最新バージョンのPEASSを入手**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**をフォローする。**
* **ハッキングのトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
