# AWS - Απαρίθμηση DynamoDB

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## DynamoDB

### Βασικές Πληροφορίες

Το Amazon DynamoDB παρουσιάζεται από το AWS ως μια **πλήρως διαχειριζόμενη, serverless, key-value NoSQL βάση δεδομένων**, σχεδιασμένη για την υποστήριξη εφαρμογών υψηλής απόδοσης ανεξάρτητα από το μέγεθός τους. Η υπηρεσία εξασφαλίζει αξιόπιστα χαρακτηριστικά, συμπεριλαμβανομένων μέτρων ασφαλείας, αδιάκοπων αντιγράφων ασφαλείας, αυτόματης αντιγραφής σε πολλαπλές περιοχές, ενσωματωμένης μνήμης cache και ευέλικτων εργαλείων εξαγωγής δεδομένων.

Στο πλαίσιο του DynamoDB, αντί να δημιουργείται μια παραδοσιακή βάση δεδομένων, **δημιουργούνται πίνακες**. Κάθε πίνακας απαιτεί την καθορισμένη **πρωτεύουσα κλειδαριά** ως αναπόσπαστο στοιχείο του **κύριου κλειδιού** του πίνακα. Αυτή η πρωτεύουσα κλειδαριά, ουσιαστικά μια **τιμή κατακερματισμού**, παίζει κρίσιμο ρόλο τόσο στην ανάκτηση στοιχείων όσο και στη διανομή των δεδομένων σε διάφορους κόμβους. Αυτή η διανομή είναι καθοριστική για τη διατήρηση της κλιμακωσιμότητας και της διαθεσιμότητας της βάσης δεδομένων. Επιπλέον, υπάρχει η δυνατότητα ενσωμάτωσης μιας **κλειδαριάς ταξινόμησης** για περαιτέρω οργάνωση των δεδομένων.

### Κρυπτογράφηση

Από προεπιλογή, το DynamoDB χρησιμοποιεί ένα κλειδί KMS που **ανήκει στο Amazon DynamoDB**, ακόμη και όχι το διαχειριζόμενο κλειδί του AWS που τουλάχιστον ανήκει στον λογαριασμό σας.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Αντίγραφα Ασφαλείας & Εξαγωγή σε S3

Είναι δυνατόν να **προγραμματίσετε** τη δημιουργία **αντιγράφων ασφαλείας του πίνακα** ή να τα δημιουργήσετε κατά **απαίτηση**. Επιπλέον, είναι επίσης δυνατόν να ενεργοποιήσετε τη **ανάκτηση σε συγκεκριμένη χρονική στιγμή (PITR) για έναν πίνακα**. Η ανάκτηση σε συγκεκριμένη χρονική στιγμή παρέχει συνεχή **αντίγραφα ασφαλείας** των δεδομένων του DynamoDB για **35 ημέρες** για να σας βοηθήσει να προστατευτείτε από ακούσιες εγγραφές ή διαγραφές.

Είναι επίσης δυνατόν να εξάγετε **τα δεδομένα ενός πίνακα σε S3**, αλλά ο πίνακας πρέπει να έχει ενεργοποιημένη τη **PITR**.

### Γραφική Διεπαφή Χρήστη

Υπάρχει μια γραφική διεπαφή χρήστη για τις τοπικές υπηρεσίες Dynamo όπως το [DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/), [dynalite](https://github.com/mhart/dynalite), [localstack](https://github.com/localstack/localstack), κλπ, που μπορεί να είναι χρήσιμη: [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### Απαρίθμηση
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
### Μη εξουσιοδοτημένη πρόσβαση

{% content-ref url="../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### Ανέβασμα δικαιωμάτων

{% content-ref url="../../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### Μετά από εκμετάλλευση

{% content-ref url="../../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### Διατήρηση

{% content-ref url="../../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## Ενσωμάτωση DynamoDB

### Ενσωμάτωση SQL

Υπάρχουν τρόποι να αποκτήσετε πρόσβαση σε δεδομένα DynamoDB με **σύνταξη SQL**, επομένως, είναι δυνατές και οι κλασικές **ενσωματώσεις SQL**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### Ενσωμάτωση NoSQL

Στο DynamoDB μπορούν να χρησιμοποιηθούν διάφορες **συνθήκες** για την ανάκτηση δεδομένων, όπως σε μια κοινή ενσωμάτωση NoSQL, αν είναι δυνατόν να **αλυσοδεθούν περισσότερες συνθήκες για την ανάκτηση** δεδομένων, μπορείτε να ανακτήσετε κρυφά δεδομένα (ή να αντλήσετε ολόκληρο τον πίνακα).\
Μπορείτε να βρείτε εδώ τις συνθήκες που υποστηρίζονται από το DynamoDB: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html)

Σημειώστε ότι υποστηρίζονται **διάφορες συνθήκες** αν η πρόσβαση στα δεδομένα γίνεται μέσω **`query`** ή μέσω **`scan`**.

{% hint style="info" %}
Πράγματι, οι ενέργειες **Query** πρέπει να καθορίσουν τη συνθήκη **"EQ" (ίσο)** στον **κύριο** κλειδί για να λειτουργήσουν, καθιστώντας τις πολύ **λιγότερο ευάλωτες σε ενσωματώσεις NoSQL** (και περιορίζοντας επίσης πολύ τη λειτουργία).
{% endhint %}

Αν μπορείτε να **αλλάξετε τη σύγκριση** που γίνεται ή να προσθέσετε νέες, μπορείτε να ανακτήσετε περισσότερα δεδομένα.
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### Ενέργεια εισαγωγής Raw Json

Το **DynamoDB** δέχεται αντικείμενα **Json** για να **αναζητήσει** δεδομένα μέσα στη βάση δεδομένων. Αν ανακαλύψετε ότι μπορείτε να γράψετε στο αντικείμενο json που στέλνετε για αναζήτηση, μπορείτε να κάνετε αντιγραφή της βάσης δεδομένων, όλο το περιεχόμενο.

Για παράδειγμα, εισάγοντας σε ένα αίτημα όπως:

{% code overflow="wrap" %}
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

Ένας επιτιθέμενος μπορεί να εισαγάγει κάτι όπως:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

διορθώστε την συνθήκη "EQ" αναζητώντας το ID 1000 και στη συνέχεια αναζητήστε όλα τα δεδομένα με ένα συμβολοσειρά Id μεγαλύτερη από 0, που είναι όλα.

### :Ιδιότητα Εισαγωγής

Ορισμένα SDK επιτρέπουν τη χρήση μιας συμβολοσειράς που υποδηλώνει το φιλτράρισμα που πρέπει να γίνει, όπως:

{% code overflow="wrap" %}
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

Πρέπει να γνωρίζετε ότι κατά την αναζήτηση στο DynamoDB για την **αντικατάσταση** μιας τιμής γνωρίσματος στις **έκφρασεις φίλτρου** κατά τη σάρωση των στοιχείων, οι δείκτες πρέπει να **αρχίζουν** με τον χαρακτήρα **`:`**. Τέτοιοι δείκτες θα **αντικατασταθούν** με την πραγματική **τιμή γνωρίσματος κατά την εκτέλεση**.

Επομένως, μια σύνδεση όπως η προηγούμενη μπορεί να παρακαμφθεί με κάτι τέτοιο:
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
