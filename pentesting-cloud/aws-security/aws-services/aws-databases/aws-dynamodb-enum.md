# AWS - Enumeración de DynamoDB

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## DynamoDB

### Información básica

Amazon DynamoDB es una base de datos **NoSQL de clave-valor completamente administrada y sin servidor** diseñada para ejecutar aplicaciones de alto rendimiento a cualquier escala. DynamoDB ofrece seguridad integrada, copias de seguridad continuas, replicación automatizada de varias regiones, almacenamiento en caché en memoria y herramientas de exportación de datos.

En DynamoDB no se crea una base de datos sino que se **crea una tabla**. Cada tabla debe tener configurada una **clave de partición** que forma parte de la **clave principal de la tabla**. Es un **valor hash** que se utiliza para recuperar elementos de la tabla y asignar datos a través de hosts para escalabilidad y disponibilidad. También es posible configurar una **clave de ordenación**.

### Encriptación

Por defecto, DynamoDB utiliza una clave KMS que **pertenece a Amazon DynamoDB**, ni siquiera la clave administrada por AWS que al menos pertenece a su cuenta.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Copias de seguridad y exportación a S3

Es posible **programar** la generación de **copias de seguridad de tablas** o crearlas **bajo demanda**. Además, también es posible habilitar la **recuperación en el momento de la copia (PITR) para una tabla**. La recuperación en el momento de la copia proporciona **copias de seguridad continuas** de los datos de DynamoDB durante **35 días** para ayudarlo a protegerse contra operaciones de escritura o eliminación accidental.

También es posible exportar **los datos de una tabla a S3**, pero la tabla debe tener **PITR habilitado**.

### GUI

Hay una GUI para servicios DynamoDB locales como [DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/), [dynalite](https://github.com/mhart/dynalite), [localstack](https://github.com/localstack/localstack), etc., que podría ser útil: [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### Enumeración

```bash
# Tablas
aws dynamodb list-tables 
aws dynamodb describe-table --table-name <t_name> #Obtener información de metadatos
## La clave principal y la clave de ordenación aparecerán dentro del campo KeySchema

#Comprobar si la recuperación en el momento de la copia está habilitada
aws dynamodb describe-continuous-backups \
  --table-name tablename

# Copias de seguridad
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Tablas globales
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exportaciones
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misceláneo
aws dynamodb describe-endpoints #Puntos finales de DynamoDB
```

### Acceso no autenticado

{% content-ref url="../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### Post Explotación

{% content-ref url="../../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## Inyección de DynamoDB

### Inyección SQL

Hay formas de acceder a los datos de DynamoDB con **sintaxis SQL**, por lo tanto, también son posibles **inyecciones SQL típicas**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### Inyección NoSQL

En DynamoDB se pueden utilizar diferentes **condiciones** para recuperar datos, como en una inyección NoSQL común si es posible **encadenar más condiciones para recuperar** datos se podrían obtener datos ocultos (o volcar toda la tabla).\
Aquí puedes encontrar las condiciones admitidas por DynamoDB: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html), ten en cuenta que se admiten **diferentes condiciones** si se accede a los datos a través de **`query`** o a través de **`scan`**.

Si puedes **cambiar la comparación** realizada o agregar nuevas, podrías recuperar más datos.

```bash
# Comparadores para volcar la base de datos
"NE": "a123" #Obtener todo lo que no sea igual a "a123"
"NOT_CONTAINS": "a123" #Lo que piensas
"GT": " " #Todas las cadenas son mayores que un espacio
```

{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### Inyección de Json crudo

**DynamoDB** acepta objetos **Json** para **buscar** datos dentro de la DB. Si descubres que puedes escribir en el objeto json enviado para buscar, podrías hacer que la DB volcara todo el contenido.

Por ejemplo, inyectando en una solicitud como:

`'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'`

un atacante podría inyectar algo como:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

arreglar la condición "EQ" buscando el ID 100