# AWS - Enum√©ration de Redshift

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts Github.**

</details>

## Amazon Redshift

Redshift est un service enti√®rement g√©r√© qui peut √™tre mis √† l'√©chelle jusqu'√† plus d'un p√©taoctet, qui est utilis√© comme **entrep√¥t de donn√©es pour les solutions de big data**. En utilisant des clusters Redshift, vous pouvez ex√©cuter des analyses sur vos ensembles de donn√©es √† l'aide d'outils de requ√™te SQL rapides et d'applications d'intelligence d'affaires pour obtenir une meilleure compr√©hension de la vision de votre entreprise.

**Redshift offre un chiffrement au repos en utilisant une hi√©rarchie de cl√©s de chiffrement √† quatre niveaux en utilisant soit KMS soit CloudHSM pour g√©rer le niveau sup√©rieur des cl√©s**. **Lorsque le chiffrement est activ√© pour votre cluster, il ne peut pas √™tre d√©sactiv√© et vice versa**. Lorsque vous avez un cluster non chiffr√©, il ne peut pas √™tre chiffr√©.

Le chiffrement de votre cluster ne peut se produire que pendant sa cr√©ation, et une fois chiffr√©, les donn√©es, les m√©tadonn√©es et toutes les instantan√©s sont √©galement chiffr√©s. Les niveaux de hi√©rarchisation des cl√©s de chiffrement sont les suivants : **le niveau un est la cl√© principale, le niveau deux est la cl√© de chiffrement de cluster, le CEK, le niveau trois est la cl√© de chiffrement de base de donn√©es, le DEK, et enfin le niveau quatre, les cl√©s de chiffrement de donn√©es elles-m√™mes**.

### KMS

Lors de la cr√©ation de votre cluster, vous pouvez soit s√©lectionner la **cl√© KMS par d√©faut** pour Redshift, soit s√©lectionner votre **propre CMK**, ce qui vous donne plus de flexibilit√© en mati√®re de contr√¥le de la cl√©, en particulier d'un point de vue auditable.

La cl√© KMS par d√©faut pour Redshift est automatiquement cr√©√©e par Redshift la premi√®re fois que l'option de cl√© est s√©lectionn√©e et utilis√©e, et elle est enti√®rement g√©r√©e par AWS.

Cette cl√© KMS est ensuite chiffr√©e avec la cl√© principale CMK, niveau un. Cette cl√© de donn√©es KMS chiffr√©e est ensuite utilis√©e comme cl√© de chiffrement de cluster, le CEK, niveau deux. Ce CEK est ensuite envoy√© par KMS √† Redshift o√π il est stock√© s√©par√©ment du cluster. Redshift envoie ensuite ce CEK chiffr√© au cluster sur un canal s√©curis√© o√π il est stock√© en m√©moire.

Redshift demande ensuite √† KMS de d√©chiffrer le CEK, niveau deux. Ce CEK d√©chiffr√© est √©galement stock√© en m√©moire. Redshift cr√©e ensuite une cl√© de chiffrement de base de donn√©es al√©atoire, le DEK, niveau trois, et la charge dans la m√©moire du cluster. Le CEK d√©chiffr√© en m√©moire chiffre ensuite le DEK, qui est √©galement stock√© en m√©moire.

Ce DEK chiffr√© est ensuite envoy√© sur un canal s√©curis√© et stock√© dans Redshift s√©par√©ment du cluster. Le CEK et le DEK sont maintenant stock√©s en m√©moire du cluster √† la fois sous une forme chiffr√©e et d√©chiffr√©e. Le DEK d√©chiffr√© est ensuite utilis√© pour chiffrer les cl√©s de donn√©es, niveau quatre, qui sont g√©n√©r√©es al√©atoirement par Redshift pour chaque bloc de donn√©es dans la base de donn√©es.

Vous pouvez utiliser AWS Trusted Advisor pour surveiller la configuration de vos compartiments Amazon S3 et vous assurer que le journalisation des compartiments est activ√©e, ce qui peut √™tre utile pour effectuer des audits de s√©curit√© et suivre les mod√®les d'utilisation dans S3.

### CloudHSM

<details>

<summary>Utilisation de Redshift avec CloudHSM</summary>

Lorsque vous travaillez avec CloudHSM pour effectuer votre chiffrement, vous devez d'abord configurer une connexion de confiance entre votre client HSM et Redshift tout en utilisant des certificats client et serveur.

Cette connexion est n√©cessaire pour fournir des communications s√©curis√©es, permettant l'envoi de cl√©s de chiffrement entre votre client HSM et vos clusters Redshift. En utilisant une paire de cl√©s priv√©e et publique g√©n√©r√©e de mani√®re al√©atoire, Redshift cr√©e un certificat client public, qui est chiffr√© et stock√© par Redshift. Celui-ci doit √™tre t√©l√©charg√© et enregistr√© sur votre client HSM, et attribu√© √† la partition HSM correcte.

Vous devez ensuite configurer Redshift avec les d√©tails suivants de votre client HSM : l'adresse IP HSM, le nom de partition HSM, le mot de passe de partition HSM et le certificat de serveur HSM public, qui est chiffr√© par CloudHSM en utilisant une cl√© ma√Ætre interne. Une fois ces informations fournies, Redshift confirmera et v√©rifiera qu'il peut se connecter et acc√©der √† la partition de d√©veloppement.

Si vos politiques de s√©curit√© internes ou vos contr√¥les de gouvernance dictent que vous devez appliquer une rotation de cl√©, cela est possible avec Redshift, ce qui vous permet de faire pivoter les cl√©s de chiffrement pour les clusters chiffr√©s, cependant, vous devez √™tre conscient que pendant le processus de rotation de cl√©, il rendra un cluster indisponible pendant une tr√®s courte p√©riode de temps, il est donc pr√©f√©rable de ne faire pivoter les cl√©s que lorsque vous en avez besoin, ou si vous pensez qu'elles ont pu √™tre compromises.

Pendant la rotation, Redshift fera pivoter le CEK pour votre cluster et pour toutes les sauvegardes de ce cluster. Il fera pivoter un DEK pour le cluster, mais il n'est pas possible de faire pivoter un DEK pour les instantan√©s stock√©s dans S3 qui ont √©t√© chiffr√©s √† l'aide du DEK. Il mettra le cluster dans un √©tat de ¬´ rotation des cl√©s ¬ª jusqu'√† ce que le processus soit termin√©, moment o√π le statut reviendra √† ¬´ disponible ¬ª.

</details>

### √ânum√©ration

```bash
# Obtenir les clusters
aws redshift describe-clusters
## Obtenir si accessible publiquement
aws redshift describe-clusters | jq -r ".Clusters[].PubliclyAccessible"
## Obtenir le nom d'utilisateur de la base de donn√©es pour se connecter
aws redshift describe-clusters | jq -r ".Clusters[].MasterUsername"
## Obtenir le point d'extr√©mit√©
aws redshift describe-clusters | jq -r ".Clusters[].Endpoint"
## Adresses publiques des n≈ìuds
aws redshift describe-cl