# AWS - DynamoDB Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team 전문가)로부터 AWS 해킹을 처음부터 전문가까지 배우세요!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고되길 원하거나 HackTricks를 PDF로 다운로드하고 싶다면** [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)를 **팔로우**하세요.
* **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

## DynamoDB

### 기본 정보

Amazon DynamoDB는 **크기에 관계없이 고성능 애플리케이션을 구동하기 위해 맞춤 설정된**, **완전히 관리되고 서버리스인 키-값 NoSQL 데이터베이스**로 AWS에서 제공됩니다. 이 서비스는 내재된 보안 조치, 중단 없는 백업, 여러 지역 간 자동 복제, 통합형 인메모리 캐싱 및 편리한 데이터 내보내기 유틸리티를 포함한 강력한 기능을 보장합니다.

DynamoDB의 맥락에서, 전통적인 데이터베이스를 설정하는 대신 **테이블이 생성**됩니다. 각 테이블은 **테이블의 기본 키**의 필수 구성 요소로 **파티션 키**의 지정을 요구합니다. 이 파티션 키는 본질적으로 **해시 값**으로, 항목을 검색하고 데이터를 다양한 호스트에 분산하는 데 중요한 역할을 합니다. 이 분산은 데이터베이스의 확장성과 가용성을 유지하는 데 중요합니다. 또한 데이터 구성을 더 세밀하게 정의하기 위해 **정렬 키**를 통합하는 옵션이 있습니다.

### 암호화

기본적으로 DynamoDB는 **Amazon DynamoDB에 속하는 KMS 키**를 사용하며, 적어도 귀하의 계정에 속하는 AWS 관리형 키가 아닙니다.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### 백업 및 S3로 내보내기

**테이블 백업을 예약**하거나 **요청에 따라 생성**할 수 있습니다. 또한 **테이블에 대한 시점 복구 (PITR)를 활성화**할 수도 있습니다. 시점 복구는 **35일 동안** DynamoDB 데이터의 지속적인 **백업**을 제공하여 우연한 쓰기 또는 삭제 작업에 대비할 수 있도록 도와줍니다.

또한 **테이블의 데이터를 S3로 내보낼 수** 있지만, 테이블은 **PITR를 활성화**해야 합니다.

### GUI

[DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development), [dynalite](https://github.com/mhart/dynalite), [localstack](https://github.com/localstack/localstack) 등 로컬 Dynamo 서비스에 대한 GUI가 있어 유용할 수 있습니다: [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### 열거
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
### 인증되지 않은 액세스

{% content-ref url="../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### 권한 상승

{% content-ref url="../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### 사후 공격

{% content-ref url="../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### 지속성

{% content-ref url="../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## DynamoDB Injection

### SQL Injection

**SQL 구문**을 사용하여 DynamoDB 데이터에 액세스하는 방법이 있으므로, 전형적인 **SQL 인젝션도 가능**합니다.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### NoSQL Injection

DynamoDB에서는 다양한 **조건**을 사용하여 데이터를 검색할 수 있으며, 일반적인 NoSQL Injection과 같이 데이터를 검색하는 데 **더 많은 조건을 연결할 수 있다면** 숨겨진 데이터를 얻거나 전체 테이블을 덤프할 수 있습니다.\
DynamoDB에서 지원하는 조건은 여기에서 찾을 수 있습니다: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html)

데이터에 **`query`** 또는 **`scan`**을 통해 액세스하는 경우 **다른 조건**이 지원됨을 유의하십시오.

{% hint style="info" %}
실제로 **Query** 작업은 작동하려면 **기본** 키에서 **조건 "EQ (equals)"**을 지정해야 하므로 NoSQL 인젝션에 **덜 취약**하며 (또한 작업을 매우 제한함).
{% endhint %}

수행되는 **비교를 변경**하거나 새로운 비교를 추가할 수 있다면 더 많은 데이터를 검색할 수 있습니다.
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### Raw Json injection

**DynamoDB**은 데이터베이스 내에서 데이터를 검색하기 위해 **Json** 객체를 허용합니다. 검색에 보내는 json 객체에 쓸 수 있다면, 데이터베이스 덤프를 만들어 모든 내용을 볼 수 있습니다.

예를 들어, 다음과 같이 요청에 주입하는 경우:

{% code overflow="wrap" %}
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

공격자는 다음과 같이 삽입할 수 있습니다:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

ID 1000을 검색하고 Id 문자열이 0보다 큰 모든 데이터를 찾는 "EQ" 조건을 수정할 수 있습니다.

### :property Injection

일부 SDK는 수행할 필터링을 나타내는 문자열을 사용할 수 있습니다:

{% code overflow="wrap" %}
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

DynamoDB에서 항목을 스캔하는 동안 **필터 표현식**에서 **속성 값**을 **대체**하기 위해 검색할 때, 토큰은 **`:`** 문자로 **시작**해야 합니다. 이러한 토큰은 **실행 시간에 실제 속성 값으로 대체**됩니다.

따라서 이전과 같은 로그인은 다음과 같이 우회될 수 있습니다:
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team 전문가)로부터 AWS 해킹을 제로부터 전문가까지 배우세요</strong>!</summary>

다른 방법으로 HackTricks를 지원하는 방법:

* **회사가 HackTricks에 광고되길 원하거나 HackTricks를 PDF로 다운로드하길 원한다면** [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 우리의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우**하세요.
* **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>
