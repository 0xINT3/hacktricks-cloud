# AWS - DynamoDB Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'ı **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## DynamoDB

### Temel Bilgiler

Amazon DynamoDB, AWS tarafından sunulan, boyutlarına bakılmaksızın yüksek performanslı uygulamaları desteklemek için özelleştirilmiş, **tamamen yönetilen, sunucusuz, anahtar-değer NoSQL veritabanı** olarak sunulur. Hizmet, kesintisiz yedeklemeler, otomatik olarak birden çok bölgeye yayılan replikasyon, bellek içi önbellekleme ve kullanışlı veri dışa aktarma araçları gibi güçlü özellikleri sağlar.

DynamoDB bağlamında, geleneksel bir veritabanı yerine **tablo oluşturulur**. Her tablo, **tablonun birincil anahtarı**nın ayrılmaz bir bileşeni olarak bir **bölüm anahtarı**nın belirtilmesini gerektirir. Bu bölüm anahtarı, temelde bir **hash değeri** olan, hem öğelerin alınması hem de verinin çeşitli ana bilgisayarlara dağıtılması açısından kritik bir rol oynar. Bu dağıtım, veritabanının ölçeklenebilirliğini ve kullanılabilirliğini sağlamak için önemlidir. Ayrıca, veri düzenini daha da geliştirmek için bir **sıralama anahtarı** dahil etme seçeneği vardır.

### Şifreleme

Varsayılan olarak, DynamoDB, en azından hesabınıza ait olan AWS yönetilen anahtara ait olmayan, **Amazon DynamoDB'ye ait bir KMS anahtarını** kullanır.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Yedeklemeler ve S3'e Aktarma

Tablo yedeklemelerinin **zamanlanması** veya **talep üzerine** oluşturulması mümkündür. Ayrıca, bir tablo için **Zamana Göre Kurtarma (PITR)** özelliğini etkinleştirmek de mümkündür. Zamana göre kurtarma, yanlışlıkla yazma veya silme işlemlerine karşı korunmanıza yardımcı olmak için DynamoDB verilerinizin **35 gün boyunca sürekli olarak yedeklenmesini** sağlar.

Ayrıca, bir tablonun verilerini **S3'e aktarmak** da mümkündür, ancak tablonun **PITR özelliğine sahip** olması gerekmektedir.

### GUI

[DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/), [dynalite](https://github.com/mhart/dynalite), [localstack](https://github.com/localstack/localstack) gibi yerel Dynamo hizmetleri için bir GUI mevcuttur ve bu [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin) adresinden erişilebilir.

### Enumerasyon

```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```

## DynamoDB Enümerasyonu

### Kimlik Doğrulama Gerektirmeyen Erişim

{% content-ref url="../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### İzin Yükseltme

{% content-ref url="../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### Saldırı Sonrası

{% content-ref url="../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## DynamoDB Enjeksiyonu

### SQL Enjeksiyonu

DynamoDB verilerine **SQL sözdizimi** ile erişmenin yolları vardır, bu nedenle tipik **SQL enjeksiyonları da mümkündür**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### NoSQL Enjeksiyonu

DynamoDB'de farklı **koşullar** kullanılarak veri alınabilir, bu nedenle yaygın bir NoSQL Enjeksiyonunda olduğu gibi daha fazla koşul ekleyerek veri alabilirsiniz (veya tüm tabloyu dökümleyebilirsiniz).\
DynamoDB tarafından desteklenen koşulları burada bulabilirsiniz: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html)

Not olarak, veri **`sorgu`** veya **`tarama`** yoluyla erişiliyorsa, **farklı koşullar** desteklenir.

{% hint style="info" %}
Aslında, **Sorgu** işlemleri, işlemin çok sınırlı olmasını sağlamak için **anahtar** olarak **"EQ" (eşit)** koşulunu belirtmek zorundadır, bu da NoSQL enjeksiyonlarına karşı daha az duyarlı hale getirir.
{% endhint %}

Eğer **karşılaştırma** yapılanı değiştirebilir veya yeni karşılaştırmalar ekleyebilirseniz, daha fazla veri alabilirsiniz.

```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```

{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### Ham Json enjeksiyonu

**DynamoDB**, DB içindeki verileri aramak için **Json** nesnelerini kabul eder. Eğer gönderilen json nesnesine yazabileceğinizi bulursanız, DB'nin tüm içeriğini sızdırabilirsiniz.

Örneğin, aşağıdaki gibi bir isteğe enjeksiyon yaparak:

{% code overflow="wrap" %}
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

Bir saldırgan şöyle bir şey enjekte edebilir:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

"EQ" koşulunu düzeltin ve 1000 ID'sini arayın ve ardından 0'dan büyük bir Id dizesi olan tüm verileri arayın, yani hepsi.

### :property Enjeksiyonu

Bazı SDK'lar, yapılacak filtrelemeyi belirten bir dize kullanmaya izin verir:

{% code overflow="wrap" %}
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

DynamoDB'de öğeleri tarama sırasında bir özniteliğin değerini **filtre ifadelerinde** **değiştirmek** için arama yaparken, belirteçlerin **`:`** karakteri ile **başlaması** gerektiğini bilmelisiniz. Bu tür belirteçler, çalışma zamanında gerçek **öznitelik değeriyle değiştirilecektir**.

Bu nedenle, önceki gibi bir giriş, aşağıdaki gibi atlatılabilir:

```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman seviyesine öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'ı takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>
