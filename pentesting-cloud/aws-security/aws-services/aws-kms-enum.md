# AWS - KMS Enum

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ**.
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рддрдХрдиреАрдХреЗрдВ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## KMS - Key Management Service

AWS Key Management Service (AWS KMS) рдПрдХ рдкреНрд░рдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ **рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬрд┐рдпреЛрдВ** (CMKs) рдХреЛ рдмрдирд╛рдиреЗ рдФрд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдЖрд╕рд╛рдиреА рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ, рдЬреЛ рдЖрдкрдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬрд┐рдпрд╛рдБ рд╣реИрдВред AWS KMS CMKs **рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓реНрд╕** (HSMs) рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рд╣реИрдВред

KMS **рд╕рдордорд┐рдд рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЖрд░рд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, S3 рдХреЗ рдЕрдВрджрд░)ред рдпрджрд┐ рдЖрдкрдХреЛ **рдЯреНрд░рд╛рдВрдЬрд┐рдЯ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**, рддреЛ рдЖрдкрдХреЛ **TLS** рдЬреИрд╕реА рдХреБрдЫ рдЪреАрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред\
KMS рдПрдХ **рдХреНрд╖реЗрддреНрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реЗрд╡рд╛** рд╣реИред

**Amazon рдХреЗ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдЖрдкрдХреА рдХреБрдВрдЬрд┐рдпреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдирд╣реАрдВ рд╣реИ**ред рд╡реЗ рдЖрдкрдХреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рдФрд░ рд╡реЗ рдЖрдкрдХреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдореЗрдВ рдЖрдкрдХреА рд╕рд╣рд╛рдпрддрд╛ рдирд╣реАрдВ рдХрд░рддреЗред AWS рдХреЗрд╡рд▓ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдФрд░ рдЙрд╕рдХреЗ рдЕрдВрддрд░реНрдЧрдд рдЖрдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдкреНрд░рд╢рд╛рд╕рди рдХрд░рддрд╛ рд╣реИ, рд╣рдорд╛рд░реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдкреНрд░рд╢рд╛рд╕рди рдФрд░ рдЙрди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рдХрд╛ рдкреНрд░рд╢рд╛рд╕рди рдХрд░рдирд╛ рд╣рдорд╛рд░реЗ рдКрдкрд░ рд╣реИред

**рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬрд┐рдпрд╛рдБ** (CMK): 4KB рдЖрдХрд╛рд░ рддрдХ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддреА рд╣реИрдВред рд╡реЗ рдЖрдорддреМрд░ рдкрд░ DEKs (рдбреЗрдЯрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬрд┐рдпреЛрдВ) рдХреЛ рдмрдирд╛рдиреЗ, рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВред рдлрд┐рд░ DEKs рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдПрдХ рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА (CMK) AWS KMS рдореЗрдВ рдПрдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХрд╛ рддрд╛рд░реНрдХрд┐рдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рд╣реИред рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдФрд░ рдЕрдиреНрдп рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрд┐рд╕рдореЗрдВ рдЗрд╕рдХреА рдирд┐рд░реНрдорд╛рдг рддрд┐рдерд┐, рд╡рд┐рд╡рд░рдг, рдФрд░ рдХреБрдВрдЬреА рдХреА рд╕реНрдерд┐рддрд┐ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдПрдХ **CMK рдореЗрдВ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЬрдм рдЖрдк рдПрдХ CMK рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, AWS KMS рдЙрд╕ CMK рдХреЗ рд▓рд┐рдП рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк рдмрд┐рдирд╛ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рдПрдХ CMK рдмрдирд╛рдиреЗ рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЙрд╕ CMK рдореЗрдВ рдЕрдкрдиреА рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЖрдпрд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЗ 2 рдкреНрд░рдХрд╛рд░ рд╣реИрдВ:

* **AWS рдкреНрд░рдмрдВрдзрд┐рдд CMKs: рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдпрд╣ рдЙрд╕ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЙрд╕ рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдИ рдЧрдИ рд╣реИред рд╡реЗ рдкрд╣рд▓реА рдмрд╛рд░ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬрдм рдЖрдк рдЙрд╕ рд╕реЗрд╡рд╛ рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВред рд╣рд░ 3 рд╕рд╛рд▓ рдореЗрдВ рдШреБрдорд╛рд╡ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдмрджрд▓рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред
* **рдЧреНрд░рд╛рд╣рдХ рдкреНрд░рдмрдВрдзрдХ CMKs**: рд▓рдЪреАрд▓рд╛рдкрди, рдШреБрдорд╛рд╡, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрдмрд▓ рдкрд╣реБрдБрдЪ рдФрд░ рдХреБрдВрдЬреА рдиреАрддрд┐ред рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдФрд░ рдЕрдХреНрд╖рдо рдХрд░реЗрдВред

**рд▓рд┐рдлрд╛рдлрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди** Key Management Service (KMS) рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ: рджреЛ-рд╕реНрддрд░реАрдп рдкрджрд╛рдиреБрдХреНрд░рдо рдкреНрд░рдгрд╛рд▓реА рдЬреЛ **рдбреЗрдЯрд╛ рдХреЛ рдбреЗрдЯрд╛ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рддреА рд╣реИ рдФрд░ рдлрд┐рд░ рдбреЗрдЯрд╛ рдХреБрдВрдЬреА рдХреЛ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рддреА рд╣реИ**ред

### рдХреБрдВрдЬреА рдиреАрддрд┐рдпрд╛рдБ

рдпреЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИрдВ **рдХреМрди KMS рдореЗрдВ рдПрдХ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдФрд░ рдкрд╣реБрдБрдЪ рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ:**

*   рдпрд╣ KMS рдХреБрдВрдЬреА рдХреЗ рдорд╛рд▓рд┐рдХ AWS рдЦрд╛рддреЗ рдХреЛ рдХреБрдВрдЬреА рддрдХ рдкреВрд░реНрдг рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

AWS рдХреА рдЕрдиреНрдп рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐рдпреЛрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, рдПрдХ AWS **KMS рдХреБрдВрдЬреА рдиреАрддрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЦрд╛рддреЗ рдпрд╛ рдЙрд╕рдХреЗ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддреА рд╣реИ**ред рдЦрд╛рддрд╛ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, **рдХреБрдВрдЬреА рдиреАрддрд┐ рдореЗрдВ рдПрдХ рд╕реНрдкрд╖реНрдЯ рд╡рдХреНрддрд╡реНрдп рд╢рд╛рдорд┐рд▓ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП** рдЬреЛ рдпрд╣ рдЕрдиреБрдорддрд┐ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдпрд╣ рдПрдХред

* рдЦрд╛рддреЗ(`"AWS": "arn:aws:iam::111122223333:root"`) рдХреЛ IAM рдЕрдиреБрдорддрд┐рдпрд╛рдБ рди рджреЗрдиреЗ рдкрд░ рд╡реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдВрдЧреАред
*   рдпрд╣ **рдЦрд╛рддреЗ рдХреЛ IAM рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ KMS рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**, рдХреБрдВрдЬреА рдиреАрддрд┐ рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрддред

**рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рдмрд┐рдирд╛, KMS рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реА IAM рдиреАрддрд┐рдпрд╛рдБ рдкреНрд░рднрд╛рд╡реА рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВ**, рд╣рд╛рд▓рд╛рдВрдХрд┐ KMS рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдБрдЪ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╡рд╛рд▓реА IAM рдиреАрддрд┐рдпрд╛рдБ рдЕрднреА рднреА рдкреНрд░рднрд╛рд╡реА рд╣реЛрддреА рд╣реИрдВред
* рдпрд╣ **рдХреБрдВрдЬреА рдХреЗ рдЕрдкреНрд░рдмрдВрдзрдиреАрдп рд╣реЛрдиреЗ рдХреЗ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИ** рдЦрд╛рддрд╛ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдкрд╣реБрдБрдЪ рдирд┐рдпрдВрддреНрд░рдг рдЕрдиреБрдорддрд┐ рджреЗрдХрд░, рдЬрд┐рд╕рдореЗрдВ рдЦрд╛рддрд╛ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЬрд┐рд╕реЗ рд╣рдЯрд╛рдпрд╛ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддрд╛ред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдиреАрддрд┐** рдЙрджрд╛рд╣рд░рдг:
```json
{
"Sid": "Enable IAM policies",
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::111122223333:root"
},
"Action": "kms:*",
"Resource": "*"
}
```
{% hint style="warning" %}
рдпрджрд┐ **рдЦрд╛рддреЗ рдХреЛ рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ рд╣реИ** (`"arn:aws:iam::111122223333:root"`) рддреЛ рдЙрд╕ рдЦрд╛рддреЗ рдХреЗ **рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рдЕрднреА рднреА KMS рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП IAM рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЪрд╛рд╣рд┐рдП** рд╣реЛрдВрдЧреАред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ **ARN** рдХрд┐рд╕реА рднреВрдорд┐рдХрд╛ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ рд╣реИ** **Key Policy** рдореЗрдВ, рддреЛ рдЙрд╕ рднреВрдорд┐рдХрд╛ рдХреЛ **IAM рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА** рд╣реИред
{% endhint %}

<details>

<summary>Policy Details</summary>

рдиреАрддрд┐ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ:

* JSON рдЖрдзрд╛рд░рд┐рдд рджрд╕реНрддрд╛рд╡реЗрдЬрд╝
* Resource --> рдкреНрд░рднрд╛рд╡рд┐рдд рд╕рдВрд╕рд╛рдзрди ( "\*" рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ)
* Action --> kms:Encrypt, kms:Decrypt, kms:CreateGrant ... (рдЕрдиреБрдорддрд┐рдпрд╛рдБ)
* Effect --> Allow/Deny
* Principal --> arn рдкреНрд░рднрд╛рд╡рд┐рдд
* Conditions (рд╡реИрдХрд▓реНрдкрд┐рдХ) --> рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрдиреЗ рдХреА рд╢рд░реНрдд

Grants:

* рдЖрдкрдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЕрдкрдиреЗ AWS рдЦрд╛рддреЗ рдХреЗ рднреАрддрд░ рдПрдХ рдЕрдиреНрдп AWS рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рд╕реМрдВрдкрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ AWS KMS APIs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ред CMK рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛, рдЕрдиреБрджрд╛рди рдкреНрд░рд╛рдкреНрддрдХрд░реНрддрд╛ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдФрд░ рдЖрд╡рд╢реНрдпрдХ рд╕рдВрдЪрд╛рд▓рди рд╕реНрддрд░ (Decrypt, Encrypt, GenerateDataKey...) рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* рдЕрдиреБрджрд╛рди рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж рдПрдХ GrantToken рдФрд░ рдПрдХ GratID рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ

**Access**:

* **key policy** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ -- рдпрджрд┐ рдпрд╣ рдореМрдЬреВрдж рд╣реИ, рддреЛ рдпрд╣ IAM рдиреАрддрд┐ рдкрд░ **рдкреНрд░рд╛рдердорд┐рдХрддрд╛** рд▓реЗрддрд╛ рд╣реИ
* **IAM policy** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ
* **grants** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

</details>

### Key Administrators

Key administrator рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ:

* KMS рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдБрдЪ рд╣реЛрддреА рд╣реИ рд▓реЗрдХрд┐рди рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдпрд╛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ
* рдХреЗрд╡рд▓ IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рднреВрдорд┐рдХрд╛рдПрдБ Key Administrators рд╕реВрдЪреА рдореЗрдВ рдЬреЛрдбрд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ (рд╕рдореВрд╣ рдирд╣реАрдВ)
* рдпрджрд┐ рдмрд╛рд╣рд░реА CMK рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ Key Administrators рдХреЛ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЖрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ

### Rotation of CMKs

* рдЬрд┐рддрдирд╛ рд▓рдВрдмрд╛ рд╕рдордп рддрдХ рдПрдХ рд╣реА рдХреБрдВрдЬреА рд╕реНрдерд╛рди рдкрд░ рд░рд╣рддреА рд╣реИ, рдЙрддрдирд╛ рдЕрдзрд┐рдХ рдбреЗрдЯрд╛ рдЙрд╕ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рд╡рд╣ рдХреБрдВрдЬреА рднрдВрдЧ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рдЬреЛрдЦрд┐рдо рдореЗрдВ рдбреЗрдЯрд╛ рдХрд╛ рд╡реНрдпрд╛рдкрдХ рдХреНрд╖реЗрддреНрд░ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрд┐рддрдирд╛ рдЕрдзрд┐рдХ рд╕рдордп рддрдХ рдХреБрдВрдЬреА рд╕рдХреНрд░рд┐рдп рд░рд╣рддреА рд╣реИ, рдЙрд╕рдХреЗ рднрдВрдЧ рд╣реЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрдврд╝ рдЬрд╛рддреА рд╣реИред
* **KMS рд╣рд░ 365 рджрд┐рдиреЛрдВ рдореЗрдВ рдЧреНрд░рд╛рд╣рдХ рдХреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдШреБрдорд╛рддрд╛ рд╣реИ** (рдпрд╛ рдЖрдк рдЬрдм рдЪрд╛рд╣реЗрдВ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ) рдФрд░ **AWS рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд╣рд░ 3 рд╕рд╛рд▓ рдореЗрдВ** рдФрд░ рдЗрд╕ рд╕рдордп рдХреЛ рдмрджрд▓рд╛ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* **рдкреБрд░рд╛рдиреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдмрд░рдХрд░рд╛рд░ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ** рдЙрд╕ рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛ рдШреБрдорд╛рд╡ рд╕реЗ рдкрд╣рд▓реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛
* рдПрдХ рдмреНрд░реЗрдХ рдореЗрдВ, рдХреБрдВрдЬреА рдХреЛ рдШреБрдорд╛рдиреЗ рд╕реЗ рдЦрддрд░рд╛ рджреВрд░ рдирд╣реАрдВ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╕рдордЭреМрддрд╛ рдХреА рдЧрдИ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рд╕рднреА рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдирдпрд╛ рдбреЗрдЯрд╛ рдирдИ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред
* рдпрджрд┐ **CMK** **рдЕрдХреНрд╖рдо** рдпрд╛ **рдкреНрд░рддреАрдХреНрд╖рд╛ рдореЗрдВ рд╣рдЯрд╛рдиреЗ** рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реИ, рддреЛ KMS CMK рдХреЛ рдлрд┐рд░ рд╕реЗ рд╕рдХреНрд╖рдо рдХрд┐рдП рдЬрд╛рдиреЗ рдпрд╛ рд╣рдЯрд╛рдиреЗ рдХреЛ рд░рджреНрдж рдХрд┐рдП рдЬрд╛рдиреЗ рддрдХ **рдХреБрдВрдЬреА рдШреБрдорд╛рд╡ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдирд╣реАрдВ рдХрд░реЗрдЧрд╛**ред

#### Manual rotation

* рдПрдХ **рдирдИ CMK рдмрдирд╛рдИ рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП**, рдлрд┐рд░, рдПрдХ рдирдИ CMK-ID рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ **рдЕрдкрдбреЗрдЯ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдХрд┐рд╕реА рднреА **рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдХреЛ **рд╕рдВрджрд░реНрднрд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирдИ CMK-IDред
* рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк **рдПрдХ рдХреБрдВрдЬреА-id рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдирд╛рдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдлрд┐рд░ рдмрд╕ рдЙрд╕ рдХреБрдВрдЬреА рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдирд╛рдо рд╕рдВрджрд░реНрднрд┐рдд рдХрд░ рд░рд╣рд╛ рд╣реИред
* рдЖрдкрдХреЛ рдкреБрд░рд╛рдиреА рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдкреБрд░рд╛рдиреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ** рдЬреЛ рдЙрд╕рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдЧрдИ рдереАрдВред

рдЖрдк рдЕрдкрдиреЗ рдСрди-рдкреНрд░рд┐рдорд╛рдЗрд╕реЗрд╕ рдХреБрдВрдЬреА рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рд╕реЗ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдЖрдпрд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### Other relevant KMS information

KMS рдХреА рдХреАрдордд рдкреНрд░рддрд┐ рдорд╣реАрдиреЗ рд╕рднреА рд╕реЗрд╡рд╛рдУрдВ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди/рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╣реЛрддреА рд╣реИред

KMS рдореЗрдВ CloudTrail рдХреЗ рд╕рд╛рде рдкреВрд░реНрдг рдСрдбрд┐рдЯ рдФрд░ рдЕрдиреБрдкрд╛рд▓рди **рдПрдХреАрдХрд░рдг** рд╣реИ; рдпрд╣рд╛рдБ рдЖрдк KMS рдкрд░ рдХрд┐рдП рдЧрдП рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХрд╛ рдСрдбрд┐рдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

KMS рдиреАрддрд┐ рдХреЗ рд╕рд╛рде рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* рд╕реАрдорд┐рдд рдХрд░реЗрдВ рдХрд┐ рдХреМрди рдбреЗрдЯрд╛ рдХреБрдВрдЬрд┐рдпрд╛рдБ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХрд┐рди рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЗрди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдкрд╣реБрдБрдЪ рд╣реИ
* рд╕рд┐рд╕реНрдЯрдореНрд╕ рдХреЛ рдХреЗрд╡рд▓ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ, рдХреЗрд╡рд▓ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдпрд╛ рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдБрдЪ рд╕реАрдорд┐рдд рдХрд░реЗрдВ
* рд╕рд┐рд╕реНрдЯрдореНрд╕ рдХреЛ рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рдкрд╛рд░ рдХреБрдВрдЬрд┐рдпреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдЕрдиреБрд╢рдВрд╕рд┐рдд рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ KMS рдХреЛ рд╣реЛрд╕реНрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╡рд┐рдлрд▓рддрд╛ рдЕрдиреНрдп рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рд╕рд┐рд╕реНрдЯрдореНрд╕ рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░реЗрдЧреА)ред

рдЖрдк рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝ рдпрд╛ рдХреЙрдкреА/рдореВрд╡ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ; рдЖрдк рдХреЗрд╡рд▓ рдХреНрд╖реЗрддреНрд░ рдкрд╛рд░ рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### Enumeration
```bash
aws kms list-keys
aws kms list-key-policies --key-id <id>
aws kms list-grants --key-id <id>
aws kms describe-key --key-id <id>
aws kms get-key-policy --key-id <id> --policy-name <name> # Default policy name is "default"
aws kms describe-custom-key-stores
```
### рдкреНрд░рд┐рд╡реЗрд╕реНрдХ

{% content-ref url="../aws-privilege-escalation/aws-kms-privesc.md" %}
[aws-kms-privesc.md](../aws-privilege-escalation/aws-kms-privesc.md)
{% endcontent-ref %}

### рдкреЛрд╕реНрдЯ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди

{% content-ref url="../../aws-pentesting/aws-post-exploitation/aws-kms-post-exploitation.md" %}
[aws-kms-post-exploitation.md](../../aws-pentesting/aws-post-exploitation/aws-kms-post-exploitation.md)
{% endcontent-ref %}

### рдкрд░реНрд╕рд┐рд╕реНрдЯреЗрдВрд╕

{% content-ref url="../../aws-pentesting/aws-persistence/aws-kms-persistence.md" %}
[aws-kms-persistence.md](../../aws-pentesting/aws-persistence/aws-kms-persistence.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://docs.aws.amazon.com/kms/latest/developerguide/key-policy-default.html](https://docs.aws.amazon.com/kms/latest/developerguide/key-policy-default.html)

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
