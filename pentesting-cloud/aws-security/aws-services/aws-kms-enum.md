# AWS - KMS Enum

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)\*\* рдкрд░ рдлреЙрд▓реЛ\*\* рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## KMS - Key Management Service

AWS Key Management Service (AWS KMS) рдХреЛ рдПрдХ рдкреНрд░рдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ** рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддрд╛ рд╣реИред рдпреЗ CMKs рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред AWS KMS рдХреА рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ CMKs рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓реНрд╕ (HSMs) рджреНрд╡рд╛рд░рд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИрдВ**, рдЬреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИред

KMS **рд╕рдордорд┐рддреНрд░ рдЧрдгрд┐рдд** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **рд╡рд┐рд╢реНрд░рд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, S3 рдХреЗ рдЕрдВрджрд░)ред рдпрджрд┐ рдЖрдкрдХреЛ **рдбреЗрдЯрд╛ рдХреЛ рдЯреНрд░рд╛рдВрдЬрд┐рдЯ рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддреЛ рдЖрдкрдХреЛ **TLS** рдЬреИрд╕реА рдХреБрдЫ рдЪреАрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

KMS рдПрдХ **рдХреНрд╖реЗрддреНрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реЗрд╡рд╛** рд╣реИред

**Amazon рдХреЗ рдкреНрд░рд╢рд╛рд╕рдХ рдЖрдкрдХреЗ рдХреБрдВрдЬрд┐рдпреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рдкрд╛рддреЗ**ред рд╡реЗ рдЖрдкрдХреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рдФрд░ рд╡реЗ рдЖрдкрдХреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХрд░рдиреЗ рдореЗрдВ рдЖрдкрдХреА рдорджрдж рдирд╣реАрдВ рдХрд░рддреЗред AWS рдмрд╕ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдФрд░ рдЙрд╕рдХреЗ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИ, рд╣рдореЗрдВ рд╣рдорд╛рд░реА рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдирд╛ рд╣реИ рдФрд░ рдЙрди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдП рдЙрд╕рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдирд╛ рд╣реИред

**рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬрд┐рдпрд╛рдБ** (CMK): 4KB рдЖрдХрд╛рд░ рддрдХ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддреА рд╣реИрдВред рд╡реЗ рд╕рд╛рдорд╛рдиреНрдпрдд: рдбреЗрдЯрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬрд┐рдпреЛрдВ (DEKs) рдХреЛ рдмрдирд╛рдиреЗ, рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдлрд┐рд░ DEKs рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА (CMK) AWS KMS рдореЗрдВ рдПрдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХрд╛ рддрд╛рд░реНрдХрд┐рдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рд╣реИред рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреА рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдФрд░ рдЕрдиреНрдп рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдЬрд┐рд╕рдореЗрдВ рдЗрд╕рдХреА рдирд┐рд░реНрдорд╛рдг рддрд┐рдерд┐, рд╡рд┐рд╡рд░рдг, рдФрд░ рдХреБрдВрдЬреА рд╕реНрдерд┐рддрд┐ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдПрдХ **CMK рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рд╢рд╛рдорд┐рд▓ рд╣реИ**ред рдЬрдм рдЖрдк рдПрдХ CMK рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, AWS KMS рдЙрд╕ CMK рдХреЗ рд▓рд┐рдП рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк рдПрдХ CMK рдмрд┐рдирд╛ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рдмрдирд╛рдиреЗ рдФрд░ рдлрд┐рд░ рдЙрд╕ CMK рдореЗрдВ рдЕрдкрдиреА рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЖрдпрд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рджреЛ рдкреНрд░рдХрд╛рд░ рдХреА рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬрд┐рдпрд╛рдБ рд╣реИрдВ:

* **AWS рдкреНрд░рдмрдВрдзрд┐рдд CMKs: рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдпрд╣ рдЙрд╕ рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдиреЗ рдЙрд╕реЗ рдмрдирд╛рдпрд╛ рд╣реИ рдХреНрд╖реЗрддреНрд░ рдореЗрдВред рдпрд╣ рдкрд╣рд▓реА рдмрд╛рд░ рдЙрд╕ рд╕реЗрд╡рд╛ рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдкрд░ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред рд╣рд░ 3 рд╕рд╛рд▓ рдореЗрдВ рд░реЛрдЯреЗрдЯ рд╣реЛрддреА рд╣реИ рдФрд░ рдЗрд╕реЗ рдмрджрд▓рдирд╛ рд╕рдВрднрд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реИред
* **рдЧреНрд░рд╛рд╣рдХ рдкреНрд░рдмрдВрдзрдХ CMKs**: рд▓рдЪреАрд▓рд╛рддрд╛, рд░реЛрдЯреЗрд╢рди, рд╡рд┐рдиреНрдпрд╛рд╕рдиреАрдп рдкрд╣реБрдВрдЪ рдФрд░ рдХреБрдВрдЬреА рдиреАрддрд┐ред рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдФрд░ рдЕрдХреНрд╖рдо рдХрд░реЗрдВред

**Key Policies**

рдпреЗ **рдХрд┐рд╕рдХреЛ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдФрд░ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИрдВ**ред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ:**

* рдпрд╣ **AWS рдЦрд╛рддрд╛ рдХреЛ рдкреВрд░реА рдкрд╣реБрдВрдЪ** рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ KMS рдХреБрдВрдЬреА рдХрд╛ рдорд╛рд▓рд┐рдХ рд╣реИред

рдЕрдиреНрдп AWS рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐рдпреЛрдВ рдХреА рднрд╛рдВрддрд┐, AWS **KMS рдХреБрдВрдЬреА рдиреАрддрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХрд┐рд╕реА рдЦрд╛рддреЗ рдпрд╛ рдЙрд╕рдХреЗ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддреА**ред рдЦрд╛рддреЗ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, **рдХреБрдВрдЬреА рдиреАрддрд┐ рдореЗрдВ рдПрдХ рд╕реНрдкрд╖реНрдЯ рдмрдпрд╛рди рд╢рд╛рдорд┐рд▓** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬреИрд╕реЗ рдпрд╣ рдПрдХред

* рдЦрд╛рддреЗ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рдмрд┐рдирд╛ (`"AWS": "arn:aws:iam::111122223333:root"`) IAM рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдВрдЧреАред
* рдпрд╣ **рдЦрд╛рддреЗ рдХреЛ IAM рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рджреЗрддрд╛ рд╣реИ KMS рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдХреБрдВрдЬреА рдиреАрддрд┐ рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрддред

**рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рдмрд┐рдирд╛, KMS рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реА IAM рдиреАрддрд┐рдпрд╛рдБ рдЕрд╕рдХреНрд╖рдо** рд╣реЛрддреА рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ KMS рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реА IAM рдиреАрддрд┐рдпрд╛рдБ рдХрд╛рдо рдХрд░рддреА рд╣реИрдВред

* рдпрд╣ **рдХреБрдВрдЬреА рдХреЛ рдЕрдкреНрд░рдмрдВрдзрдиреАрдп рд╣реЛрдиреЗ рдХреЗ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИ** рдЬрд┐рд╕реЗ рдЦрд╛рддреЗ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ, рдЬрд┐рд╕рдореЗрдВ рдЦрд╛рддреЗ рдХрд╛ рдореВрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╣рдЯрд╛рдпрд╛ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддрд╛ред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдиреАрддрд┐** рдЙрджрд╛рд╣рд░рдг:

```json
{
"Sid": "Enable IAM policies",
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::111122223333:root"
},
"Action": "kms:*",
"Resource": "*"
}
```

{% hint style="warning" %}
рдЕрдЧрд░ **рдЦрд╛рддрд╛ рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ рд╣реИ** (`"arn:aws:iam::111122223333:root"`) рддреЛ рдЦрд╛рддреЗ рд╕реЗ **рдПрдХ рдкреНрд░рдореБрдЦ** рдХреЛ KMS рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП IAM рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдХрд┐рд╕реА рднреВрдорд┐рдХрд╛ рдХреА ARN рдЦрд╛рддреЗ рдореЗрдВ **рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ** рд╣реИ, рддреЛ рдЙрд╕ рднреВрдорд┐рдХрд╛ рдХреЛ **IAM рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреА**ред
{% endhint %}

<details>

<summary>рдиреАрддрд┐ рд╡рд┐рд╡рд░рдг</summary>

рдиреАрддрд┐ рдХреА рдЧреБрдгрдзрд░реНрдо:

* JSON рдЖрдзрд╛рд░рд┐рдд рджрд╕реНрддрд╛рд╡реЗрдЬрд╝
* рд╕рдВрд╕рд╛рдзрд┐рдд рд╕рдВрд╕рд╛рдзрди --> рдкреНрд░рднрд╛рд╡рд┐рдд рд╕рдВрд╕рд╛рдзрди ("\*" рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)
* рдХрд╛рд░реНрд░рд╡рд╛рдИ --> kms:Encrypt, kms:Decrypt, kms:CreateGrant ... (рдЕрдиреБрдорддрд┐рдпрд╛рдБ)
* рдкреНрд░рднрд╛рд╡ --> рдЕрдиреБрдорддрд┐/рдЕрд╕реНрд╡реАрдХреГрддрд┐
* рдкреНрд░рдореБрдЦ --> рдкреНрд░рднрд╛рд╡рд┐рдд arn
* рд╢рд░реНрддреЗрдВ (рд╡реИрдХрд▓реНрдкрд┐рдХ) --> рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╢рд░реНрдд

рдЕрдиреБрджрд╛рди:

* рдЕрдиреНрдп AWS рдкреНрд░рдореБрдЦ рдХреЛ рдЕрдкрдиреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЕрдиреБрджрд╛рди рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред рдЖрдкрдХреЛ AWS KMS APIs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрдиреНрд╣реЗрдВ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ред рдЗрд╕рдореЗрдВ CMK рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛, рдЕрдиреБрджрд╛рди рдкреНрд░рдореБрдЦ рдФрд░ рдЖрд╡рд╢реНрдпрдХ рд╕реНрддрд░ рдХрд╛ рдСрдкрд░реЗрд╢рди (Decrypt, Encrypt, GenerateDataKey...) рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* рдЕрдиреБрджрд╛рди рдмрдирд╛рдпрд╛ рдЬрд╛рдиреЗ рдХреЗ рдмрд╛рдж рдПрдХ GrantToken рдФрд░ рдПрдХ GratID рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

**рдкрд╣реБрдВрдЪ**:

* **рдХреБрдВрдЬреА рдиреАрддрд┐** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ -- рдпрджрд┐ рдпрд╣ рдореМрдЬреВрдж рд╣реИ, рддреЛ рдпрд╣ **IAM рдиреАрддрд┐** рдкрд░ **рдкреНрд░рд╛рдзрд╛рдирддрд╛** рд▓реЗрддрд╛ рд╣реИ
* **IAM рдиреАрддрд┐** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ
* **рдЕрдиреБрджрд╛рди** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

</details>

### рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХ

рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ:

* KMS рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рд╣реИ, рд▓реЗрдХрд┐рди рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдпрд╛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рдирд╣реАрдВ рд╣реИ
* рдХреЗрд╡рд▓ IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рднреВрдорд┐рдХрд╛рдПрдБ рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рд╕реВрдЪреА рдореЗрдВ рдЬреЛрдбрд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ (рд╕рдореВрд╣ рдирд╣реАрдВ)
* рдпрджрд┐ рдмрд╛рд╣рд░реА CMK рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЖрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ

### CMKs рдХрд╛ рдЪрдХреНрд░рд╡реГрджреНрдзрд┐

* рдЬрд┐рддрдиреЗ рдЕрдзрд┐рдХ рд╕рдордп рддрдХ рдПрдХ рд╣реА рдХреБрдВрдЬреА рд╕реНрдерд╛рди рдкрд░ рдЫреЛрдбрд╝реА рдЬрд╛рддреА рд╣реИ, рдЙрд╕ рд╕рдордп рдХреЗ рд╕рд╛рде рдЙрд╕ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдбреЗрдЯрд╛ рдЬреНрдпрд╛рджрд╛ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рдЙрд╕ рдХреБрдВрдЬреА рдХреЛ рднрдВрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдбреЗрдЯрд╛ рдХрд╛ рд╡реНрдпрд╛рдкрдХ рдХреНрд╖реЗрддреНрд░ рдЬреЛрдЦрд┐рдо рдореЗрдВ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдХреБрдВрдЬреА рдЬрд┐рддрдирд╛ рдЕрдзрд┐рдХ рд╕рдХреНрд░рд┐рдп рд╣реЛрддреА рд╣реИ, рдЙрд╕реЗ рднрдВрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрдврд╝ рдЬрд╛рддреА рд╣реИред
* **KMS рд╣рд░ 365 рджрд┐рди рдореЗрдВ рдЧреНрд░рд╛рд╣рдХ рдХреБрдВрдЬреА рдХреЛ рдЪрдХреНрд░рд╡реГрджреНрдзрд┐ рдХрд░рддрд╛ рд╣реИ** (рдпрд╛ рдЖрдк рдЪрд╛рд╣реЗрдВ рддреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдХрднреА рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ) рдФрд░ **AWS рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХреБрдВрдЬрд┐рдпрд╛рдБ рд╣рд░ 3 рд╡рд░реНрд╖ рдореЗрдВ** рдФрд░ рдЗрд╕ рд╕рдордп рдХреЛ рдпрд╣ рдмрджрд▓рд╛ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* **рдкреБрд░рд╛рдиреА рдХреБрдВрдЬрд┐рдпрд╛рдБ** рдЙрд╕ рд╕рдордп рддрдХ рд░рдЦреА рдЬрд╛рддреА рд╣реИрдВ рдЬрдм рдЪрдХреНрд░рд╡реГрджреНрдзрд┐ рд╕реЗ рдкрд╣рд▓реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдбреЗрдЯрд╛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ
* рдПрдХ рдЯреВрдЯ рдореЗрдВ, рдХреБрдВрдЬреА рдХреЛ рдЪрдХреНрд░рд╡реГрджреНрдзрд┐ рдирд╣реАрдВ рдХрд░рдиреЗ рд╕реЗ рдЦрддрд░рд╛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдВрдЬреА рдХреЛ рд░реЛрдЯреЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ рдХрд┐ рд╕рдВрджрд┐рдЧреНрдз рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рд╕рднреА рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдирдП рдбреЗрдЯрд╛ рдирдИ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред
* рдпрджрд┐ **CMK** **рдЕрдХреНрд╖рдо** рдпрд╛ **рдкреНрд░рд▓рдВрдмрд┐рдд рд╣реИ**, **рд╣рдЯрд╛рдиреЗ** рддрдХ **рдХреБрдВрдЬреА рдЪрдХреНрд░рд╡реГрджреНрдзрд┐** рдХрд░реЗрдЧрд╛ рдирд╣реАрдВ рдЬрдм рддрдХ CMK рдкреБрдирдГ рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рдпрд╛ рд╣рдЯрд╛рдиреЗ рдХреЛ рд░рджреНрдж рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

#### рдореИрдиреНрдпреБрдЕрд▓ рдЪрдХреНрд░рд╡реГрджреНрдзрд┐

* рдПрдХ **рдирдИ CMK рдмрдирд╛рдиреА рд╣реЛрдЧреА**, рдлрд┐рд░, рдПрдХ рдирдИ CMK-ID рдмрдирд╛рдИ рдЬрд╛рдПрдЧреА, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдХрд┐рд╕реА рднреА **рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдХреЛ **рдирдП CMK-ID** рдХрд╛ рд╕рдВрджрд░реНрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЕрдкрдбреЗрдЯ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред
* рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк **рдХреБрдВрдЬреА-id рдХрд╛ рд╕рдВрджрд░реНрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдлрд┐рд░ рдХреЗрд╡рд▓ рдЙрд╕ рдХреБрдВрдЬреА рдХреЛ рдЕрдкрдб

```bash
aws kms list-keys
aws kms list-key-policies --key-id <id>
aws kms list-grants --key-id <id>
aws kms describe-key --key-id <id>
aws kms get-key-policy --key-id <id> --policy-name <name> # Default policy name is "default"
aws kms describe-custom-key-stores
```

### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░

{% content-ref url="../aws-privilege-escalation/aws-kms-privesc.md" %}
[aws-kms-privesc.md](../aws-privilege-escalation/aws-kms-privesc.md)
{% endcontent-ref %}

### рдкреЛрд╕реНрдЯ рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди

{% content-ref url="../aws-post-exploitation/aws-kms-post-exploitation.md" %}
[aws-kms-post-exploitation.md](../aws-post-exploitation/aws-kms-post-exploitation.md)
{% endcontent-ref %}

### рд╕реНрдерд┐рд░рддрд╛

{% content-ref url="../aws-persistence/aws-kms-persistence.md" %}
[aws-kms-persistence.md](../aws-persistence/aws-kms-persistence.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://docs.aws.amazon.com/kms/latest/developerguide/key-policy-default.html](https://docs.aws.amazon.com/kms/latest/developerguide/key-policy-default.html)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб github рд░реЗрдкреЛ рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
