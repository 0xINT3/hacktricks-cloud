# AWS - KMS Enum

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХреЛ** **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos** рдХреЛ

</details>

## KMS - рдХреА рдореИрдиреЗрдЬрдореЗрдВрдЯ рд╕реЗрд╡рд╛

AWS Key Management Service (AWS KMS) рдПрдХ рдореИрдиреЗрдЬ рдХреА рдЧрдИ рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ **рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА** (CMKs) рдХреЛ рдмрдирд╛рдиреЗ рдФрд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреА рд╣реИ, рдЬреЛ рдЖрдкрдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИред AWS KMS CMKs рдХреЛ **рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓реНрд╕** (HSMs) рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

KMS **рд╕рдордорд┐рддреНрд░ рдЧрдгрд┐рдд** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **рдмрд╛рдХреА рдХреЗ рд░реВрдк рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, S3 рдХреЗ рднреАрддрд░)ред рдпрджрд┐ рдЖрдкрдХреЛ **рдбреЗрдЯрд╛ рдХреЛ рдпрд╛рддреНрд░рд╛ рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛** рд╣реИ, рддреЛ рдЖрдкрдХреЛ **TLS** рдЬреИрд╕реА рдХреБрдЫ рдЪреАрдЬрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред\
KMS рдПрдХ **рдХреНрд╖реЗрддреНрд░рд╡рд┐рд╢реЗрд╖ рд╕реЗрд╡рд╛** рд╣реИред

**рдЕрдореЗрдЬрд╝рди рдХреЗ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдЖрдкрдХреА рдХреБрдВрдЬреА рдХрд╛ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ**ред рд╡реЗ рдЖрдкрдХреА рдХреБрдВрдЬреА рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡реЗ рдЖрдкрдХреЛ рдЖрдкрдХреА рдХреБрдВрдЬреА рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдореЗрдВ рдорджрдж рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред AWS рд╕рд┐рд░реНрдл рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдФрд░ рдЙрд╕рдХреЗ рдЖрдзрд╛рд░рднреВрдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдкреНрд░рд╢рд╛рд╕рди рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдореЗрдВ рд╣рдорд╛рд░реА рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдкреНрд░рд╢рд╛рд╕рди рдХрд░рдиреЗ рдФрд░ рдЙрди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред

**рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА** (CMK): 4KB рдЖрдХрд╛рд░ рддрдХ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддреА рд╣реИрдВред рд╡реЗ рдЖрдорддреМрд░ рдкрд░ рдбреЗрдЯрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ, рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП DEKs (рдбреЗрдЯрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА) рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВред рдлрд┐рд░ DEKs рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА (CMK) AWS KMS рдореЗрдВ рдПрдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХрд╛ рддрд╛рд░реНрдХрд┐рдХ рдкреНрд░рддрд┐рд╖реНрдард╛рди рд╣реИред рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдФрд░ рдЕрдиреНрдп рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрд┐рд╕рдореЗрдВ рдЗрд╕рдХреА рд╕реГрдЬрди рддрд┐рдерд┐, рд╡рд┐рд╡рд░рдг рдФрд░ рдХреБрдВрдЬреА рд╕реНрдерд┐рддрд┐ рдЬреИрд╕реА рдЕрдиреНрдп рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, **рдПрдХ CMK рдореЗрдВ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИ**ред рдЬрдм рдЖрдк рдПрдХ CMK рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, AWS KMS рдЙрд╕ CMK рдХреЗ рд▓рд┐рдП рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк рдПрдХ CMK рдмрд┐рдирд╛ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рдмрдирд╛рдиреЗ рдФрд░ рдлрд┐рд░ рдЙрд╕ CMK рдореЗрдВ рдЕрдкрдиреА рдЦреБрдж рдХреА рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЖрдпрд╛рдд рдХрд░рдиреЗ рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ 2 рдкреНрд░рдХрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВ:

* **AWS рдореИрдиреЗрдЬ рдХрд┐рдП рдЧрдП CMKs: рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВ**ред рдпрд╣ рдЙрд╕ рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдХреА рдЬрд╛рддреА рд╣реИ рдЬрд┐рд╕рдиреЗ рдЙрд╕ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рд╣реИред рд╣рд░ 3 рд╕рд╛рд▓ рдореЗрдВ рд░реЛрдЯреЗрдЯ рд╣реЛрддреА рд╣реИ рдФрд░ рдЗрд╕реЗ рдмрджрд▓рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред
* **рдЧреНрд░рд╛рд╣рдХ рдкреНрд░рдмрдВрдзрдХ CMKs**: рд▓рдЪреАрд▓рд╛рдкрди, рд░реЛрдЯреЗрд╢рди, рд╡рд┐рдиреНрдпрд╛рд╕ рдпреЛрдЧреНрдп рдкрд╣реБрдВрдЪ рдФрд░ рдХреБрдВрдЬреА рдиреАрддрд┐ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВред рдХреБрдВрдЬреА рдХреЛ рд╕рдХреНрд╖рдо рдФрд░ рдЕрдХреНрд╖рдо рдХрд░реЗрдВред

**Key Policies** (рдХреБрдВрдЬреА рдиреАрддрд┐рдпрд╛рдБ)

рдпреЗ **рд╡реНрдпрдХреНрддрд┐ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИрдВ рдХрд┐ KMS рдореЗрдВ рдХреМрди рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ**ред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ:**

*   рдпрд╣ **AWS рдЦрд╛рддрд╛ рдХреЛ рдкреВрд░реА рдкрд╣реБрдВрдЪ** рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ KMS рдХреБрдВрдЬреА рдорд╛рд▓рд┐рдХ рд╣реИред

рдЕрдиреНрдп AWS рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐рдпреЛрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, AWS **KMS рдХреБрдВрдЬреА рдиреАрддрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЦрд╛рддреЗ рдпрд╛ рдЙрд╕рдХреЗ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддреА рд╣реИ**ред рдЦрд╛рддрд╛ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, **рдХреБрдВрдЬреА рдиреАрддрд┐ рдо
```json
{
"Sid": "Enable IAM policies",
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::111122223333:root"
},
"Action": "kms:*",
"Resource": "*"
}
```
{% hint style="warning" %}
рдпрджрд┐ рдЦрд╛рддрд╛ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ (`"arn:aws:iam::111122223333:root"`) рддреЛ рдЦрд╛рддреЗ рд╕реЗ рдПрдХ рдкреНрд░рдореБрдЦ рдХреЛ KMS рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП IAM рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдХрд┐рд╕реА рд░реЛрд▓ рдХреА ARN рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ Key Policy рдореЗрдВ рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ рд╣реИ, рддреЛ рдЙрд╕ рд░реЛрд▓ рдХреЛ IAM рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред
{% endhint %}

<details>

<summary>рдиреАрддрд┐ рд╡рд┐рд╡рд░рдг</summary>

рдиреАрддрд┐ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ:

* JSON рдЖрдзрд╛рд░рд┐рдд рджрд╕реНрддрд╛рд╡реЗрдЬрд╝
* рд╕рдВрд╕рд╛рдзрд┐рдд рд╕рдВрд╕рд╛рдзрди --> рдкреНрд░рднрд╛рд╡рд┐рдд рд╕рдВрд╕рд╛рдзрди ("\*" рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)
* рдХрд╛рд░реНрд░рд╡рд╛рдИ --> kms:Encrypt, kms:Decrypt, kms:CreateGrant ... (рдЕрдиреБрдорддрд┐рдпрд╛рдБ)
* рдкреНрд░рднрд╛рд╡ --> рдЕрдиреБрдорддрд┐/рдирд┐рд╖реЗрдз
* рдкреНрд░рдореБрдЦ --> рдкреНрд░рднрд╛рд╡рд┐рдд arn
* рд╢рд░реНрддреЗрдВ (рд╡реИрдХрд▓реНрдкрд┐рдХ) --> рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╢рд░реНрдд

рдЕрдиреБрджрд╛рди:

* рдЕрдкрдиреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЕрдкрдиреЗ AWS рдЦрд╛рддреЗ рдХреЗ рднреАрддрд░ рдПрдХ рдЕрдиреНрдп AWS рдкреНрд░рдореБрдЦ рдХреЛ рд╕реМрдВрдкрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЖрдкрдХреЛ AWS KMS APIs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдиреНрд╣реЗрдВ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЗрд╕рдореЗрдВ CMK рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛, рдкреНрд░рднрд╛рд╡рд┐рдд рдкреНрд░рдореБрдЦ рдФрд░ рдЖрд╡рд╢реНрдпрдХ рд╕реНрддрд░ рдХреЗ рдСрдкрд░реЗрд╢рди (Decrypt, Encrypt, GenerateDataKey...) рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* рдЕрдиреБрдорддрд┐ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ рддреЛ рдПрдХ GrantToken рдФрд░ рдПрдХ GratID рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ

**рдкрд╣реБрдВрдЪ**:

* **рдХреБрдВрдЬреА рдиреАрддрд┐** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ -- рдпрджрд┐ рдпрд╣ рдореМрдЬреВрдж рд╣реИ, рддреЛ рдпрд╣ IAM рдиреАрддрд┐ рдкрд░ **рдкреНрд░рд╛рдзрд╛рдирддрд╛** рд▓реЗрддрд╛ рд╣реИ
* **IAM рдиреАрддрд┐** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ
* **рдЕрдиреБрджрд╛рди** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

</details>

### рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХ

рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ:

* KMS рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдпрд╛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ
* рдХреЗрд╡рд▓ IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рднреВрдорд┐рдХрд╛рдПрдБ рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХ рд╕реВрдЪреА рдореЗрдВ рдЬреЛрдбрд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ (рд╕рдореВрд╣ рдирд╣реАрдВ)
* рдпрджрд┐ рдмрд╛рд╣рд░реА CMK рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХ рдХреЛ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЖрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ

### CMKs рдХреА рд░реЛрдЯреЗрд╢рди

* рдЬрд┐рддрдиреЗ рдЕрдзрд┐рдХ рд╕рдордп рддрдХ рдПрдХ рд╣реА рдХреБрдВрдЬреА рд╕реНрдерд╛рди рдореЗрдВ рдЫреЛрдбрд╝реА рдЬрд╛рддреА рд╣реИ, рдЙрддрдирд╛ рд╣реА рдЕрдзрд┐рдХ рдбреЗрдЯрд╛ рдЙрд╕ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рдЙрд╕ рдХреБрдВрдЬреА рдХреЛ рднрдВрдЧ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдбреЗрдЯрд╛ рдХрд╛ рд╡реНрдпрд╛рдкрдХ рдХреНрд╖реЗрддреНрд░ рдЬреЛрдЦрд┐рдо рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХреБрдВрдЬреА рдХрд┐рддрдирд╛ рдЕрдзрд┐рдХ рд╕рдХреНрд░рд┐рдп рд╣реЛрддреА рд╣реИ, рдЙрд╕реЗ рднрдВрдЧ рд╣реЛрдиреЗ рдХрд╛ рд╕рдВрднрд╛рд╡рдирд╛ рдмрдврд╝рддреА рд╣реИред
* **KMS рд╣рд░ 365 рджрд┐рди рдореЗрдВ рдЧреНрд░рд╛рд╣рдХ рдХреБрдВрдЬреА рдХреЛ рд░реЛрдЯреЗрдЯ рдХрд░рддрд╛ рд╣реИ** (рдпрд╛ рдЖрдк рдЪрд╛рд╣реЗрдВ рддреЛ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ) рдФрд░ **AWS рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХреБрдВрдЬреА рдХреЛ рд╣рд░ 3 рд╡рд░реНрд╖ рдореЗрдВ** рдФрд░ рдпрд╣ рд╕рдордп рдмрджрд▓рд╛ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* **рдкреБрд░рд╛рдиреА рдХреБрдВрдЬреА рд╕рдВрдЧреНрд░рд╣реАрдд** рд░рдЦреА рдЬрд╛рддреА рд╣реИ рдЬреЛ рд░реЛрдЯреЗрд╢рди рд╕реЗ рдкрд╣рд▓реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛
* рдПрдХ рдмреНрд░реЗрдХ рдореЗрдВ, рдХреБрдВрдЬреА рдХреЛ рд░реЛрдЯреЗрдЯ рдХрд░рдиреЗ рд╕реЗ рдЦрддрд░рд╛ рд╣рдЯрд╛рдиреЗ рдХреА рдХреЛрдИ рд╕рдВрднрд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рд╕рднреА рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдирдИ рдбреЗрдЯрд╛ рдирдИ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред
* рдпрджрд┐ **CMK** рдЕрдХреНрд╖рдо рдпрд╛ **рдкреНрд░рд▓рдВрдмрд┐рдд рд╣рдЯрд╛рдиреЗ** рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реИ, рддреЛ KMS **рдХреБрдВрдЬреА рд░реЛрдЯреЗрд╢рди рдирд╣реАрдВ рдХрд░реЗрдЧрд╛** рдЬрдм рддрдХ CMK рдХреЛ рдкреБрдирдГ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рд╣рдЯрд╛рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд░рджреНрдж рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рд╣реИред

#### рдореИрдиреНрдпреБрдЕрд▓ рд░реЛрдЯреЗрд╢рди

* рдПрдХ **рдирдИ CMK рдмрдирд╛рдиреА рд╣реЛрдЧреА**, рдлрд┐рд░, рдПрдХ рдирдИ CMK-ID рдмрдирд╛рдИ рдЬрд╛рдПрдЧреА, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ **рдХрд┐рд╕реА рднреА рдЕрдиреБрдкреНрд░рдпреЛрдЧ** рдХреЛ **рдирдИ CMK-ID рдХрд╛ рд╕рдВрджрд░реНрдн** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЕрджреНрдпрддрди рдХрд░рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред
* рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк **рдХреБрдВрдЬреА-id рдХреЗ рд▓рд┐рдП рдЙрдкрдирд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдлрд┐рд░ рдЙрдкрдирд╛рдо рдХреЗ рд▓рд┐рдП рдХреБрдВрдЬреА рдХреЛ рдЕрджреНрдпрддрди рдХрд░реЗрдВред
* рдЖрдкрдХреЛ **рдкреБрд░рд╛рдиреА рдХреБрдВрдЬреА рд╕рдВрдЧреНрд░рд╣реАрдд рд░рдЦрдиреА рд╣реЛрдЧреА** рддрд╛рдХрд┐ рдЙрд╕рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдкреБрд░рд╛рдиреЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рдЖрдк рдЕрдкрдиреА on-premises рдХреБрдВрдЬреА рдмреБрдирд┐рдпрд╛рдж рд╕реЗ рдХреБрдВрдЬреА рдЖрдпрд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рдЕрдиреНрдп рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ KMS рдЬрд╛рдирдХрд╛рд░реА

KMS рдХреА рдХреАрдордд рдорд╣реАрдиреЗ рдореЗрдВ рд╕рднреА рд╕реЗрд╡рд╛рдУрдВ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди/рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИред

KMS рдореЗрдВ рдкреВрд░реНрдг рд▓реЗрдЦрд╛ рдФрд░ рдЕрдиреБрдкрд╛рд▓рди **CloudTrail рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг** рд╣реИ; рдпрд╣рд╛рдВ рдЖрдк KMS рдкрд░ рдХрд┐рдП рдЧрдП рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХрд╛ рд▓реЗрдЦрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

KMS рдиреАрддрд┐ рдХреЗ рд╕рд╛рде рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* рдбреЗрдЯрд╛ рдХреБрдВрдЬреА рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреМрди рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХреМрди рд╕реЗрд╡рд╛рдПрдВ рдЗрди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ
* рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдХреЗрд╡рд▓ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ, рдХреЗрд╡рд▓ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдпрд╛ рджреЛрдиреЛрдВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдХреА рд╕реАрдорд╛
* рдХреБрдВрдЬрд┐рдпреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рдмреАрдЪ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЗрд╕реЗ рдЕрдиреБрд╢рдВрд╕рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ KMS рдХреА рд╣реЛрд╕реНрдЯрд┐рдВрдЧ рдХреНрд╖реЗрддреНрд░ рдо
```bash
aws kms list-keys
aws kms list-key-policies --key-id <id>
aws kms list-grants --key-id <id>
aws kms describe-key --key-id <id>
aws kms get-key-policy --key-id <id> --policy-name <name> # Default policy name is "default"
aws kms describe-custom-key-stores
```
### Privesc

{% content-ref url="../aws-privilege-escalation/aws-kms-privesc.md" %}
[aws-kms-privesc.md](../aws-privilege-escalation/aws-kms-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../../aws-pentesting/aws-post-exploitation/aws-kms-post-exploitation.md" %}
[aws-kms-post-exploitation.md](../../aws-pentesting/aws-post-exploitation/aws-kms-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../../aws-pentesting/aws-persistence/aws-kms-persistence.md" %}
[aws-kms-persistence.md](../../aws-pentesting/aws-persistence/aws-kms-persistence.md)
{% endcontent-ref %}

## References

* [https://docs.aws.amazon.com/kms/latest/developerguide/key-policy-default.html](https://docs.aws.amazon.com/kms/latest/developerguide/key-policy-default.html)

<details>

<summary><strong>рдЖрдзрд╛рд░рднреВрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХрд╛ рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред**

</details>
