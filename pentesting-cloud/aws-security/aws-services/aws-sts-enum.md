# AWS - STS Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'ı **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## STS

**AWS Security Token Service (STS)**, genellikle **geçici, sınırlı yetkilendirme kimlik bilgileri** vermek için tasarlanmıştır. Bu kimlik bilgileri, **AWS Kimlik ve Erişim Yönetimi (IAM)** kullanıcıları veya kimlik doğrulaması yapılmış kullanıcılar (federasyon kullanıcıları) için istenebilir.

STS'nin amacı, **kimlik taklit etmek için kimlik bilgileri vermek** olduğundan, hizmet, **yetkileri yükseltme ve kalıcılığı sürdürme** açısından son derece değerlidir, ancak geniş bir seçenek yelpazesi olmayabilir.

### Rol Taklit Etme

AWS STS tarafından sağlanan [AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API\_AssumeRole.html) eylemi, birincil birincilin kimlik bilgilerini edinmesine izin vererek, aslında onları taklit etmesine olanak tanır. Çağrıldığında, belirtilen ARN'ye karşılık gelen bir erişim anahtar kimliği, gizli anahtar ve oturum belirteciyle yanıt verir.

Sızma Testçileri veya Kırmızı Takım üyeleri için bu teknik, ayrıcalık yükseltme için önemlidir (ayrıntılar [**burada**](../aws-privilege-escalation/aws-sts-privesc.md#sts-assumerole) açıklanmıştır). Bununla birlikte, bu teknik oldukça göze çarpan bir teknik olup saldırganı şüphelendirebilir.

#### Rol Taklit Etme Mantığı

Aynı hesapta bir rolü taklit etmek için **taklit edilecek rol ARN'sine özellikle izin veren bir rol** varsa, aşağıdaki gibi:

```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:role/priv-role"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```

Bu durumda **`priv-role`** rolü, **özellikle izin verilmesi gerekmez**. İzin verilme yeterlidir.

Ancak, bir rolün bir hesabın bunu üstlenebilmesine izin verdiği durumlarda, örneğin:

```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:root"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```

Rolu almaya çalışanın, onu **almak için belirli bir `sts:AssumeRole` iznine** ihtiyacı olacak.

Farklı bir hesaptan bir **rolü** almaya çalışıyorsanız, **alınan rolün buna izin vermesi gerekmektedir** (rolün ARN'sini veya dış hesabı belirtir) ve **diğer rolü almaya çalışan rolün bunu yapabilmesi için izinlere sahip olması GEREKİR** (bu durumda, alınan rol bir ARN belirtse bile bu isteğe bağlı değildir).

### Sorgulama

```bash
# Get basic info of the creds
aws sts get-caller-identity
aws sts get-access-key-info --access-key-id <AccessKeyID>

# Get CLI a session token with current creds
## Using CLI creds
## You cannot get session creds using session creds
aws sts get-session-token
## MFA
aws sts get-session-token --serial-number <arn_device> --token-code <otp_code>
```

### Privesc

Aşağıdaki sayfada, **ayrıcalıkları yükseltmek için STS izinlerini kötüye kullanma** yöntemlerini kontrol edebilirsiniz:

{% content-ref url="../aws-privilege-escalation/aws-sts-privesc.md" %}
[aws-sts-privesc.md](../aws-privilege-escalation/aws-sts-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-sts-post-exploitation.md" %}
[aws-sts-post-exploitation.md](../aws-post-exploitation/aws-sts-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../aws-persistence/aws-iam-persistence.md" %}
[aws-iam-persistence.md](../aws-persistence/aws-iam-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>
