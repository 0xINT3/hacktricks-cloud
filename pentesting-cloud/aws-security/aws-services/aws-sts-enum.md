# AWS - STS Απαρίθμηση

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## STS

Το **AWS Security Token Service (STS)** έχει σχεδιαστεί κυρίως για να εκδίδει **προσωρινές, περιορισμένων δικαιωμάτων διαπιστευτήρια**. Αυτά τα διαπιστευτήρια μπορούν να ζητηθούν για χρήστες του **AWS Identity and Access Management (IAM)** ή για εξουσιοδοτημένους χρήστες (εξουσιοδοτημένοι χρήστες).

Δεδομένου ότι ο σκοπός του STS είναι να **εκδίδει διαπιστευτήρια για την παραπλάνηση της ταυτότητας**, ο υπηρεσία είναι απίστευτα αξιοσημείωτη για την **ανέλιξη δικαιωμάτων και τη διατήρηση της διαρκείας**, ακόμα κι αν δεν έχει μια ευρεία γκάμα επιλογών.

### Παραπλάνηση Ρόλου

Η ενέργεια [AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API\_AssumeRole.html) που παρέχεται από το AWS STS είναι κρίσιμη καθώς επιτρέπει σε έναν αρχέτυπο να αποκτήσει διαπιστευτήρια για έναν άλλο αρχέτυπο, παραπλανώντας τον ουσιαστικά. Μετά την κλήση, απαντά με ένα αναγνωριστικό κλειδιού πρόσβασης, ένα μυστικό κλειδί και ένα διακριτικό συνεδρίας που αντιστοιχούν στον καθορισμένο ARN.

Για τους ελεγκτές διείσδυσης ή τα μέλη της Ερυθράς Ομάδας, αυτή η τεχνική είναι ουσιώδης για την ανέλιξη δικαιωμάτων (όπως αναλύεται [**εδώ**](../aws-privilege-escalation/aws-sts-privesc.md#sts-assumerole)). Ωστόσο, αξίζει να σημειωθεί ότι αυτή η τεχνική είναι αρκετά εμφανής και μπορεί να μην εκπλήξει έναν επιτιθέμενο.
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:role/priv-role"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
Ο ρόλος **`priv-role`** σε αυτήν την περίπτωση, **δεν χρειάζεται να επιτρέπεται ειδικά** να υποθέσει αυτόν τον ρόλο (με αυτήν την άδεια είναι αρκετό).

Ωστόσο, αν ένας ρόλος επιτρέπει σε έναν λογαριασμό να τον υποθέσει, όπως στο:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:root"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
Ο ρόλος που προσπαθεί να υιοθετήσει θα χρειαστεί μια **συγκεκριμένη άδεια `sts:AssumeRole`** για αυτόν τον ρόλο **για να τον υιοθετήσει**.

Εάν προσπαθήσετε να υιοθετήσετε έναν **ρόλο** από ένα διαφορετικό λογαριασμό, ο **υιοθετημένος ρόλος πρέπει να το επιτρέπει** (δηλώνοντας το ρόλο **ARN** ή τον **εξωτερικό λογαριασμό**), και ο **ρόλος που προσπαθεί να υιοθετήσει** τον άλλο **ΠΡΕΠΕΙ** να **έχει άδειες για να τον υιοθετήσει** (σε αυτήν την περίπτωση αυτό δεν είναι προαιρετικό, ακόμα κι αν ο υιοθετημένος ρόλος καθορίζει ένα ARN).

### Απαρίθμηση
```bash
# Get basic info of the creds
aws sts get-caller-identity
aws sts get-access-key-info --access-key-id <AccessKeyID>

# Get CLI a session token with current creds
## Using CLI creds
## You cannot get session creds using session creds
aws sts get-session-token
## MFA
aws sts get-session-token --serial-number <arn_device> --token-code <otp_code>
```
### Ανέβασμα δικαιωμάτων

Στην παρακάτω σελίδα μπορείτε να ελέγξετε πώς να **καταχραστείτε τα δικαιώματα STS για να ανεβάσετε δικαιώματα**:

{% content-ref url="../aws-privilege-escalation/aws-sts-privesc.md" %}
[aws-sts-privesc.md](../aws-privilege-escalation/aws-sts-privesc.md)
{% endcontent-ref %}

### Μετά την εκμετάλλευση

{% content-ref url="../../aws-pentesting/aws-post-exploitation/aws-sts-post-exploitation.md" %}
[aws-sts-post-exploitation.md](../../aws-pentesting/aws-post-exploitation/aws-sts-post-exploitation.md)
{% endcontent-ref %}

### Διατήρηση

{% content-ref url="../aws-persistence/aws-iam-persistence.md" %}
[aws-iam-persistence.md](../aws-persistence/aws-iam-persistence.md)
{% endcontent-ref %}

## Αναφορές

* [https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist)

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
