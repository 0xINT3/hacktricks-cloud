# AWS - STS Enum

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## STS

**AWS Security Token Service (STS)** is prim√™r ontwerp om **tydelike, beperkte-voorreggelde geloofsbriewe** uit te reik. Hierdie geloofsbriewe kan aangevra word vir **AWS Identity and Access Management (IAM)**-gebruikers of vir ge√Ødentifiseerde gebruikers (gefedereerde gebruikers).

Aangesien STS se doel is om **geloofsbriewe vir identiteitsverpersoonliking uit te reik**, is die diens van groot waarde vir **voorregverhoging en volharding**, alhoewel dit nie 'n wye verskeidenheid opsies mag h√™ nie.

### Veronderstel Rol Verpersoonliking

Die aksie [AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API\_AssumeRole.html) wat deur AWS STS voorsien word, is van kritieke belang omdat dit 'n beginsel in staat stel om geloofsbriewe vir 'n ander beginsel te bekom, en hulle dus verpersoonlik. By aanroeping reageer dit met 'n toegangssleutel-ID, 'n geheime sleutel en 'n sessie-token wat ooreenstem met die gespesifiseerde ARN.

Vir penetrasietoetsers of Red Team-lede is hierdie tegniek van groot belang vir voorregverhoging (soos verduidelik [**hier**](../aws-privilege-escalation/aws-sts-privesc.md#sts-assumerole)). Dit is egter die moeite werd om daarop te let dat hierdie tegniek nogal opvallend is en 'n aanvaller nie onverwags kan vang nie.

#### Veronderstel Rol Logika

Om 'n rol in dieselfde rekening aan te neem as die **rol wat aangeneem moet word, spesifiek 'n rol ARN toelaat** soos in:

```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:role/priv-role"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```

Die rol **`priv-role`** in hierdie geval, hoef **nie spesifiek toegelaat te word** om daardie rol aan te neem (met daardie toestemming is genoeg).

Maar as 'n rol toelaat dat 'n rekening dit aanneem, soos in:

```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:root"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```

Die rol wat probeer aanneem moet 'n **spesifieke `sts:AssumeRole` toestemming** oor daardie rol h√™ **om dit aan te neem**.

As jy probeer om 'n **rol** van 'n ander rekening aan te neem, moet die **aangenome rol dit toelaat** (deur die rol se **ARN** of die **eksterne rekening** aan te dui), en die **rol wat probeer aanneem** die ander een **MOET** toestemmings h√™ om dit aan te neem (in hierdie geval is dit nie opsioneel nie, selfs as die aangenome rol 'n ARN spesifiseer).

### Enumerasie

```bash
# Get basic info of the creds
aws sts get-caller-identity
aws sts get-access-key-info --access-key-id <AccessKeyID>

# Get CLI a session token with current creds
## Using CLI creds
## You cannot get session creds using session creds
aws sts get-session-token
## MFA
aws sts get-session-token --serial-number <arn_device> --token-code <otp_code>
```

### Privesc

In die volgende bladsy kan jy sien hoe om **STS-permissies te misbruik om voorregte te verhoog**:

{% content-ref url="../aws-privilege-escalation/aws-sts-privesc.md" %}
[aws-sts-privesc.md](../aws-privilege-escalation/aws-sts-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-sts-post-exploitation.md" %}
[aws-sts-post-exploitation.md](../aws-post-exploitation/aws-sts-post-exploitation.md)
{% endcontent-ref %}

### Volharding

{% content-ref url="../aws-persistence/aws-iam-persistence.md" %}
[aws-iam-persistence.md](../aws-persistence/aws-iam-persistence.md)
{% endcontent-ref %}

## Verwysings

* [https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>
