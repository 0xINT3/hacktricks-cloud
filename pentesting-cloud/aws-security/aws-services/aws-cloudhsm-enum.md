# AWS - CloudHSM Enum

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

## HSM - Hardware Security Module

Cloud HSMは、安全な暗号鍵のストレージ用のFIPS 140レベル2認証の**ハードウェアデバイス**です（CloudHSMはハードウェアアプライアンスであり、仮想化サービスではありません）。これは、プリロードされた5.3.13のSafeNetLuna 7000アプライアンスです。ファームウェアのバージョンが2つあり、どちらを選ぶかはあなたの正確なニーズに基づいています。一つはFIPS 140-2コンプライアンス用で、もう一つは新しいバージョンで使用できます。

CloudHSMの特異な特徴は、物理デバイスであるため、他の顧客と**共有されず**、一般的に言われるマルチテナントではありません。専用のシングルテナントアプライアンスで、あなたのワークロードに専用で提供されます。

通常、デバイスは容量があれば15分以内に利用可能ですが、一部のゾーンでは利用できない場合があります。

これはあなた専用の物理デバイスなので、**鍵はデバイス上に保存されます**。鍵は、別のデバイスに**複製する**か、オフラインストレージにバックアップするか、スタンバイアプライアンスにエクスポートする必要があります。**このデバイスは**S3やKMSのようなAWSの他のサービスによってバックアップされていません。

**CloudHSM**では、サービスを自分で**スケールする必要があります**。あなたの暗号化ニーズに基づいて、十分なCloudHSMデバイスをプロビジョニングする必要があります。Key Management ServiceのスケーリングはAWSによって行われ、需要に応じて自動的にスケールします。ソリューションをスケールする際には、自動スケーリングがある場合は、ソリューションをサービスするのに十分なCloudHSMアプライアンスがあることを確認してください。

スケーリングと同様に、**CloudHSMのパフォーマンスはあなた次第です**。パフォーマンスは使用する暗号化アルゴリズムと鍵をアクセスまたは取得してデータを暗号化する頻度によって異なります。Key management serviceのパフォーマンスはAmazonによって処理され、需要に応じて自動的にスケールします。CloudHSMのパフォーマンスは、より多くのアプライアンスを追加することで達成され、より高いパフォーマンスが必要な場合は、デバイスを追加するか、より高速なアルゴリズムに暗号化方法を変更する必要があります。

ソリューションが**マルチリージョン**の場合、第二リージョンに複数の**CloudHSMアプライアンスを追加し、プライベートVPN接続**またはトラフィックが常にアプライアンス間で保護される方法でクロスリージョン接続を確立する必要があります。マルチリージョンソリューションを持っている場合は、鍵を**複製し、運用するリージョンに追加のCloudHSMデバイスを設定する方法を考える必要があります**。非常に迅速に、複数のリージョンにわたって6台または8台のデバイスが展開され、暗号化鍵の完全な冗長性が実現するシナリオになる可能性があります。

**CloudHSM**は、安全な鍵のストレージ用のエンタープライズクラスのサービスであり、企業の**信頼の根源として使用できます**。PKIのプライベート鍵やX509実装の認証局鍵を保存できます。AESなどの対称アルゴリズムで使用される対称鍵に加えて、**KMSは対称鍵のみを保存し物理的に保護します（認証局として機能することはできません）**ので、PKIとCA鍵を保存する必要がある場合は、CloudHSMが解決策になるかもしれません。

**CloudHSMはKey Management Serviceよりもかなり高価です**。CloudHSMはハードウェアアプライアンスなので、CloudHSMデバイスをプロビジョニングするための固定費用がかかり、その後アプライアンスを稼働させるための時間当たりの費用がかかります。費用は、特定の要件を達成するために必要なCloudHSMアプライアンスの数によって乗算されます。\
さらに、SafeNet ProtectVソフトウェアスイートなどのサードパーティソフトウェアの購入や統合にかかる時間と労力も考慮する必要があります。Key Management Serviceは使用ベースであり、保有する鍵の数と入出力操作に依存します。多くのAWSサービスとのシームレスな統合を提供するため、統合コストは大幅に低くなるはずです。コストは暗号化ソリューションにおける二次的な要因と考えるべきです。暗号化は通常、セキュリティとコンプライアンスのために使用されます。

**CloudHSMでは、鍵へのアクセスはあなただけです**。詳細には立ち入りませんが、CloudHSMでは自分で鍵を管理します。**KMSでは、あなたとAmazonが共同で鍵を管理します**。AWSには乱用に対する多くのポリシーセーフガードがありますが、どちらのソリューションでも**鍵にアクセスすることはできません**。主な違いは鍵の所有権と管理に関するコンプライアンスであり、CloudHSMでは、あなただけが排他的にアクセスできるハードウェアアプライアンスを管理し、維持します。

### CloudHSMの提案

1. 常に**HAセットアップ**でCloudHSMをデプロイし、少なくとも2つのアプライアンスを**別々のアベイラビリティゾーン**に配置し、可能であれば、AWSの別のリージョンまたはオンプレミスに第三のアプライアンスを配置します。
2. **CloudHSMの初期化**には注意してください。このアクションは**鍵を破壊します**ので、別のコピーを持っているか、絶対に必要がなく、決して必要にならないことを確信してください。
3. CloudHSMは**特定のバージョンのファームウェアとソフトウェアのみをサポート**します。アップデートを実行する前に、ファームウェアおよびソフトウェアがAWSによってサポートされていることを確認してください。アップグレードガイドが不明確な場合は、AWSサポートに連絡して確認することができます。
4. **ネットワーク構成は決して変更してはいけません**。AWSのデータセンター内にあることを覚えておいてください。AWSが基本的なハードウェアを監視しているため、ハードウェアが故障した場合は交換してくれますが、故障を知っている場合に限ります。
5. **SysLog転送は削除または変更してはいけません**。常にSysLog転送機を**追加**して、ログを独自の収集ツールに向けることができます。
6. **SNMP**の設定には、ネットワークとSysLogフォルダと同じ基本的な制限があります。これは**変更または削除してはいけません**。**追加**のSNMP設定は問題ありませんが、すでにアプライアンスにあるものを変更しないようにしてください。
7. AWSからのもう一つの興味深いベストプラクティスは、**NTP設定を変更しないこと**です。変更した場合に何が起こるかは明確ではありませんので、ソリューションの残りの部分で同じNTP設定を使用しない場合は、2つの時間源がある可能性があることを念頭に置いてください。この点に注意し、CloudHSMは既存のNTPソースを維持する必要があることを理解してください。

CloudHSMの初期導入料金は、専用のハードウェアアプライアンスを割り当てるために$5,000で、その後はCloudHSMの稼働に関連する時間当たりの料金が現在$1.88で、月額約$1,373です。

CloudHSMを使用する最も一般的な理由は、規制上の理由で満たす必要があるコンプライアンス基準です。**KMSは非対称鍵のデータサポートを提供しません。CloudHSMは非対称鍵を安全に保存することができます**。
**公開鍵はプロビジョニング中にHSMアプライアンスにインストールされます**。これにより、SSH経由でCloudHSMインスタンスにアクセスできます。

### ハードウェアセキュリティモジュールとは

ハードウェアセキュリティモジュール（HSM）は、暗号鍵の生成、保存、管理を行い、機密データを保護するために使用される専用の暗号デバイスです。物理的および電子的に暗号機能をシステムの他の部分から隔離することで、高いレベルのセキュリティを提供するように設計されています。

HSMの動作方法は、特定のモデルやメーカーによって異なる場合がありますが、一般的には以下のステップが行われます：

1. **鍵生成**: HSMは安全な乱数生成器を使用してランダムな暗号鍵を生成します。
2. **鍵保存**: 鍵は**HSM内で安全に保存され、承認されたユーザーやプロセスのみがアクセスできます**。
3. **鍵管理**: HSMは鍵のローテーション、バックアップ、取り消しなど、さまざまな鍵管理機能を提供します。
4. **暗号操作**: HSMは暗号化、復号化、デジタル署名、鍵交換などの暗号操作を実行します。これらの操作は**HSMの安全な環境内で実行され**、不正アクセスや改ざんから保護されます。
5. **監査ログ**: HSMはすべての暗号操作とアクセス試行を記録し、コンプライアンスとセキュリティ監査の目的で使用できます。

HSMは、安全なオンライン取引、デジタル証明書、安全な通信、データ暗号化など、幅広いアプリケーションで使用されます。金融、医療、政府など、高いセキュリティレベルが求められる業界でよく使用されます。

全体として、HSMによって提供される高いレベルのセキュリティは、**生の鍵を抽出することを非常に困難にし、試みることはしばしばセキュリティ違反と見なされます**。ただし、鍵の回復手順の場合など、**特定のシナリオ**では、**生の鍵が承認された人員によって抽出される可能性があります**。

### 列挙
```
```
<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**、または**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有してください。

</details>
