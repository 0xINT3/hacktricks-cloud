# AWS - Uchunguzi wa CloudHSM

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## HSM - Moduli ya Usalama wa Vifaa

Cloud HSM ni kifaa cha **vifaa vilivyothibitishwa vya kiwango cha FIPS 140 cha pili** kwa uhifadhi salama wa funguo za kryptografia (tambua kuwa CloudHSM ni kifaa cha vifaa, sio huduma iliyovirtualishwa). Ni kifaa cha SafeNetLuna 7000 kilicho na toleo la 5.3.13 kilichopakiwa mapema. Kuna toleo mbili za firmware na ni ipi unayochagua inategemea mahitaji yako halisi. Moja ni kwa kufuata FIPS 140-2 na kulikuwa na toleo jipya linaloweza kutumika.

Sifa isiyo ya kawaida ya CloudHSM ni kwamba ni kifaa halisi, na kwa hivyo **hakishirikiwa na wateja wengine**, au kama inavyoitwa kawaida, multi-tenant. Ni kifaa cha mpangilio mmoja wa mpangilio kinachopatikana kwa kipekee kwa mzigo wako.

Kawaida, kifaa kinapatikana ndani ya dakika 15 ikizingatiwa kuna uwezo, lakini katika baadhi ya maeneo huenda hakuna.

Kwa kuwa hii ni kifaa halisi kilichowekwa kwa ajili yako, **funguo zimehifadhiwa kwenye kifaa**. Funguo lazima zireplikiwe kwenye kifaa kingine, zihifadhiwe kwenye uhifadhi usio mtandaoni, au zipelekwe kwenye kifaa cha akiba. **Kifaa hiki hakisaidiwi** na S3 au huduma nyingine yoyote kama KMS kwenye AWS.

Katika **CloudHSM**, unapaswa **kupanua huduma mwenyewe**. Lazima upange vifaa vya kutosha vya CloudHSM kushughulikia mahitaji yako ya kryptografia kulingana na algorithm ya kryptografia uliyochagua kutekeleza suluhisho lako.\
Upanuzi wa Huduma ya Usimamizi wa Funguo unafanywa na AWS na hupanuka kiotomatiki kulingana na mahitaji, hivyo kadri matumizi yako yanavyoongezeka, idadi ya vifaa vya CloudHSM vinavyohitajika inaweza kuongezeka. Kumbuka hili unapopanua suluhisho lako na ikiwa suluhisho lako lina uwezo wa kujipanua, hakikisha upeo wako wa juu unazingatiwa na vifaa vya kutosha vya CloudHSM kuhudumia suluhisho.

Kama ilivyo kwa upanuzi, **utendaji upo kwako na CloudHSM**. Utendaji hutofautiana kulingana na algorithm ya kryptografia inayotumiwa na jinsi mara ngapi unahitaji kupata au kurejesha funguo za kuficha data. Utendaji wa huduma ya usimamizi wa funguo unashughulikiwa na Amazon na hupanuka kiotomatiki kulingana na mahitaji. Utendaji wa CloudHSM unapatikana kwa kuongeza vifaa zaidi na ikiwa unahitaji utendaji zaidi unaweza kuongeza vifaa au kubadilisha njia ya kuficha kwa algorithm ambayo ni haraka.

Ikiwa suluhisho lako ni **la mikoa mingi**, unapaswa kuongeza vifaa vya **CloudHSM kadhaa katika mkoa wa pili na kufanya mawasiliano ya msalaba-mikoa kwa kutumia uunganisho wa VPN ya kibinafsi** au njia fulani ili kuhakikisha trafiki daima inalindwa kati ya kifaa katika kila safu ya uhusiano. Ikiwa una suluhisho la mikoa mingi unahitaji kufikiria jinsi ya **kuhakikisha funguo zinareplikiwa na kuweka vifaa vya CloudHSM vingine katika mikoa unayofanya kazi**. Unaweza haraka kuingia kwenye hali ambapo una vifaa sita au nane vilivyosambazwa katika mikoa mingi, ikiruhusu redundansi kamili ya funguo zako za kryptografia.

**CloudHSM** ni huduma ya daraja la biashara kwa uhifadhi salama wa funguo na inaweza kutumika kama **msingi wa uaminifu kwa kampuni**. Inaweza kuhifadhi funguo za faragha katika PKI na funguo za mamlaka ya vyeti katika utekelezaji wa X509. Mbali na funguo za kuficha zinazotumiwa katika algorithm za kuficha kama AES, **KMS inahifadhi na kulinda kimwili funguo za kuficha tu (haiwezi kutenda kama mamlaka ya vyeti)**, kwa hivyo ikiwa unahitaji kuhifadhi funguo za PKI na CA CloudHSM moja au mbili au tatu inaweza kuwa suluhisho lako.

**CloudHSM ni ghali zaidi kuliko Huduma ya Usimamizi wa Funguo**. CloudHSM ni kifaa cha vifaa kwa hivyo una gharama za kufikia kifaa cha CloudHSM, kisha gharama ya kila saa ya kuendesha kifaa. Gharama inazidishwa na idadi ya vifaa vya CloudHSM vinavyohitajika kufikia mahitaji yako maalum.\
Kwa kuongezea, inapaswa kufanywa kwa ununuzi wa programu ya tatu kama safu za programu za SafeNet ProtectV na muda na jitihada za ushirikiano. Huduma ya Usimamizi wa Funguo ni msingi wa matumizi na inategemea idadi ya funguo unazo na shughuli za kuingia na kutoka. Kwa kuwa usimamizi wa funguo unatoa ushirikiano wa moja kwa moja na huduma nyingi za AWS, gharama za ushirikiano zinapaswa kuwa chini sana. Gharama zinapaswa kuzingatiwa kama sababu ya pili katika suluhisho za kuficha. Kuficha kawaida hutumiwa kwa usalama na kufuata sheria.

**Na CloudHSM pekee una ufikiaji wa funguo** na bila kuingia kwa undani sana, na CloudHSM unasimamia funguo zako mwenyewe. **Na KMS, wewe na Amazon mnashirikiana katika usimamizi wa funguo**. AWS ina sera nyingi za ulinzi dhidi ya matumizi mabaya na **bado hawawezi kupata ufikiaji wa funguo wako katika suluhisho lolote**. Tofauti kuu ni kufuata kama inavyohusiana na umiliki na usimamizi wa funguo, na na CloudHSM, hii ni kifaa cha vifaa ambacho unasimamia na kudumisha na ufikiaji wa kipekee kwako na wewe pekee.

### Mapendekezo ya CloudHSM

1. Daima weka CloudHSM katika **mpangilio wa HA** na angalau vifaa viwili katika **zoni tofauti za upatikanaji**, na ikiwezekana, weka cha tatu au kwenye eneo lingine kwenye AWS.
2. Kuwa makini wakati wa **kuanzisha** **CloudHSM**. Hatua hii **itaharibu funguo**, kwa hivyo iwe na nakala nyingine ya funguo au hakikisha kabisa kuwa hauitaji kamwe funguo hizi kufichua data yoyote.
3. CloudHSM inasaidia **toleo fulani la firmware** na programu. Kabla ya kufanya sasisho lolote, hakikisha firmware na/au programu inasaidiwa na AWS. Unaweza daima kuwasiliana na msaada wa AWS kuthibitisha ikiwa mwongozo wa sasisho ni wazi.
4. **Usibadilishe kamwe usanidi wa mtandao.** Kumbuka, iko katika kituo cha data cha AWS na AWS inachunguza vifaa vya msingi kwa niaba yako. Hii inamaanisha kwamba ikiwa vifaa vinashindwa, watakuwekea vingine, lakini tu ikiwa wanajua kimeshindwa.
5. **Usiondoe au ubadilishe mbele ya SysLog.** Unaweza daima **kuongeza** mbele ya SysLog kupeleka magogo kwenye chombo chako cha ukusanyaji.
6. Usanidi wa **SNMP** una vikwazo sawa vya msingi kama mtandao na mbele ya SysLog. Hii **haipaswi kubadilishwa au kuondolewa**. Usanidi wa **SNMP wa ziada** ni mzuri, hakikisha tu hauibadilishi ile ambayo tayari iko kwenye kifaa.
7. Mbinu bora nyingine kutoka AWS ni **kutobadilisha usanidi wa NTP**. Haijulikani nini kitatokea ikiwa utabadilisha, kwa hivyo kumbuka kwamba ikiwa hutumii usanidi sawa wa NTP kwa suluhisho lako lote basi unaweza kuwa na vyanzo viwili vya wakati. Tuwe makini na hili na ujue kwamba CloudHSM inapaswa kubaki na chanzo cha NTP kilichopo.

Malipo ya awali ya uzinduzi wa CloudHSM ni $5,000 kwa kumtenga kifaa cha vifaa kilichowekwa kwa ajili yako, kisha kuna malipo ya kila saa yanayohusiana na kuendesha CloudHSM ambayo kwa sasa ni $1.88 kwa saa ya uendeshaji, au takriban $1,373 kwa mwezi.

Sababu kuu ya kutumia CloudHSM ni viwango vya kufuata ambavyo lazima ukutane kwa sababu za kisheria. **KMS haitoi msaada wa data kwa funguo za kuficha za kiasimetri. CloudHSM inaruhusu kuhifadhi funguo za kuficha za kiasimetri kwa usalama**.

**Funguo ya umma imewekwa kwenye kifaa cha HSM wakati wa utoaji** ili uweze kupata kifaa cha CloudHSM kupitia SSH.
### Ni nini Hardware Security Module

Hardware security module (HSM) ni kifaa cha kryptografia kilichojitolea ambacho hutumika kuzalisha, kuhifadhi, na kusimamia funguo za kryptografia na kulinda data nyeti. Imetengenezwa kutoa kiwango kikubwa cha usalama kwa kufunga kifaa hicho kimwili na kielektroniki kutoka kwa sehemu nyingine ya mfumo.

Jinsi HSM inavyofanya kazi inaweza kutofautiana kulingana na mfano na mtengenezaji maalum, lakini kwa ujumla, hatua zifuatazo hufanyika:

1. **Uzalishaji wa funguo**: HSM inazalisha funguo za kryptografia za kubahatisha kwa kutumia jenereta salama ya nambari za kubahatisha.
2. **Uhifadhi wa funguo**: Funguo hilo **linahifadhiwa kwa usalama ndani ya HSM, ambapo linaweza kufikiwa tu na watumiaji au michakato iliyoruhusiwa**.
3. **Usimamizi wa funguo**: HSM hutoa anuwai ya kazi za usimamizi wa funguo, ikiwa ni pamoja na mzunguko wa funguo, nakala rudufu, na kufuta.
4. **Operesheni za kryptografia**: HSM inatekeleza anuwai ya operesheni za kryptografia, ikiwa ni pamoja na kusimbua, kusimbua, saini za kidijitali, na kubadilishana funguo. Operesheni hizi zinafanywa **ndani ya mazingira salama ya HSM**, ambayo hulinda dhidi ya ufikiaji usioruhusiwa na kuharibiwa.
5. **Kuingiza kumbukumbu**: HSM inaingiza kila operesheni ya kryptografia na majaribio ya ufikiaji, ambayo yanaweza kutumika kwa madhumuni ya kufuata sheria na ukaguzi wa usalama.

HSMs zinaweza kutumika kwa anuwai ya matumizi, ikiwa ni pamoja na shughuli salama za mtandaoni, vyeti vya kidijitali, mawasiliano salama, na kusimbua data. Mara nyingi hutumiwa katika viwanda vinavyohitaji kiwango kikubwa cha usalama, kama vile fedha, afya, na serikali.

Kwa ujumla, kiwango kikubwa cha usalama kinachotolewa na HSMs hufanya iwe **ngumu sana kutoa funguo za kryptografia moja kwa moja kutoka kwao, na jaribio la kufanya hivyo mara nyingi huchukuliwa kama uvunjaji wa usalama**. Walakini, kunaweza kuwa na **hali fulani** ambapo **funguo moja kwa moja inaweza kutolewa** na wafanyakazi walioruhusiwa kwa madhumuni maalum, kama vile katika kesi ya utaratibu wa kupona funguo.

### Uorodheshaji
```
```
<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
