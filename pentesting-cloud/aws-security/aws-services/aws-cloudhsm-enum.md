# AWS - CloudHSM Enum

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandising**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## HSM - Hardware-Sicherheitsmodul

Cloud HSM ist ein FIPS 140 Level Two validiertes **Hardwareger√§t** zur sicheren Speicherung kryptografischer Schl√ºssel (beachten Sie, dass CloudHSM ein Hardwareger√§t ist, kein virtualisierter Dienst). Es handelt sich um ein SafeNetLuna 7000-Ger√§t mit vorinstallierter Version 5.3.13. Es gibt zwei Firmware-Versionen, und welche Sie w√§hlen, h√§ngt wirklich von Ihren genauen Anforderungen ab. Eine ist f√ºr die FIPS 140-2-Konformit√§t und es gab eine neuere Version, die verwendet werden kann.

Das Ungew√∂hnliche an CloudHSM ist, dass es ein physisches Ger√§t ist und daher **nicht mit anderen Kunden geteilt wird**, oder wie es allgemein genannt wird, Multi-Tenant. Es handelt sich um ein dediziertes Single-Tenant-Ger√§t, das ausschlie√ülich f√ºr Ihre Workloads zur Verf√ºgung steht.

In der Regel ist ein Ger√§t innerhalb von 15 Minuten verf√ºgbar, vorausgesetzt, es gibt Kapazit√§ten, aber in einigen Zonen k√∂nnte dies nicht der Fall sein.

Da es sich um ein physisches Ger√§t handelt, das Ihnen gewidmet ist, **werden die Schl√ºssel auf dem Ger√§t gespeichert**. Schl√ºssel m√ºssen entweder auf ein anderes Ger√§t **repliziert**, auf offline gespeichert oder auf ein Standby-Ger√§t exportiert werden. **Dieses Ger√§t wird nicht von S3 oder einem anderen Dienst bei AWS wie KMS unterst√ºtzt**.

Bei **CloudHSM** m√ºssen Sie **den Dienst selbst skalieren**. Sie m√ºssen gen√ºgend CloudHSM-Ger√§te bereitstellen, um die Anforderungen Ihrer Verschl√ºsselung basierend auf den von Ihnen gew√§hlten Verschl√ºsselungsalgorithmen zu bew√§ltigen.\
Das Skalieren des Key Management Service wird von AWS durchgef√ºhrt und skaliert automatisch bei Bedarf, sodass mit zunehmender Nutzung auch die Anzahl der erforderlichen CloudHSM-Ger√§te steigt. Behalten Sie dies im Hinterkopf, w√§hrend Sie Ihre L√∂sung skalieren, und stellen Sie sicher, dass Ihre maximale Skalierung mit ausreichend CloudHSM-Ger√§ten f√ºr die L√∂sung ber√ºcksichtigt wird.

Wie beim Skalieren liegt **die Leistung bei CloudHSM in Ihrer Verantwortung**. Die Leistung variiert je nach verwendeten Verschl√ºsselungsalgorithmus und wie oft Sie auf die Schl√ºssel zugreifen oder die Schl√ºssel abrufen m√ºssen, um die Daten zu verschl√ºsseln. Die Leistung des Key Management Service wird von Amazon verwaltet und skaliert automatisch, wenn die Nachfrage es erfordert. Die Leistung von CloudHSM wird durch Hinzuf√ºgen weiterer Ger√§te erreicht, und wenn Sie mehr Leistung ben√∂tigen, f√ºgen Sie entweder Ger√§te hinzu oder √§ndern Sie die Verschl√ºsselungsmethode in einen schnelleren Algorithmus.

Wenn Ihre L√∂sung **multi-regional** ist, sollten Sie mehrere **CloudHSM-Ger√§te in der zweiten Region hinzuf√ºgen und die Cross-Region-Konnektivit√§t mit einer privaten VPN-Verbindung** oder einer Methode sicherstellen, um sicherzustellen, dass der Datenverkehr zwischen den Ger√§ten auf jeder Ebene der Verbindung immer gesch√ºtzt ist. Wenn Sie eine L√∂sung mit mehreren Regionen haben, m√ºssen Sie dar√ºber nachdenken, wie Sie **Schl√ºssel replizieren und zus√§tzliche CloudHSM-Ger√§te in den Regionen einrichten, in denen Sie t√§tig sind**. Sie k√∂nnten schnell in eine Situation geraten, in der Sie sechs oder acht Ger√§te √ºber mehrere Regionen verteilt haben, um eine vollst√§ndige Redundanz Ihrer Verschl√ºsselungsschl√ºssel zu erm√∂glichen.

**CloudHSM** ist ein Enterprise-Class-Service f√ºr die sichere Schl√ºsselspeicherung und kann als **Vertrauensanker f√ºr ein Unternehmen** verwendet werden. Es kann private Schl√ºssel in PKI und Zertifizierungsstellen-Schl√ºssel in X509-Implementierungen speichern. Neben symmetrischen Schl√ºsseln, die in symmetrischen Algorithmen wie AES verwendet werden, **speichert und sch√ºtzt KMS nur symmetrische Schl√ºssel physisch (kann nicht als Zertifizierungsstelle fungieren)**, daher k√∂nnte CloudHSM oder zwei oder drei Ihre L√∂sung sein, wenn Sie PKI- und CA-Schl√ºssel speichern m√ºssen.

**CloudHSM ist wesentlich teurer als der Key Management Service**. CloudHSM ist ein Hardwareger√§t, sodass Sie Fixkosten f√ºr die Bereitstellung des CloudHSM-Ger√§ts haben, dann einen st√ºndlichen Betrag f√ºr den Betrieb des Ger√§ts zahlen m√ºssen. Die Kosten werden mit der Anzahl der erforderlichen CloudHSM-Ger√§te multipliziert, um Ihre spezifischen Anforderungen zu erf√ºllen.\
Zus√§tzlich m√ºssen bei der Anschaffung von Drittanbietersoftware wie SafeNet ProtectV-Softwarepaketen und Integrationszeit und -aufwand ber√ºcksichtigt werden. Der Key Management Service basiert auf der Nutzung und h√§ngt von der Anzahl der Schl√ºssel ab, die Sie haben, sowie von den Ein- und Ausgabeoperationen. Da das Schl√ºsselmanagement nahtlose Integration mit vielen AWS-Diensten bietet, sollten die Integrationskosten erheblich geringer sein. Kosten sollten als sekund√§rer Faktor bei Verschl√ºsselungsl√∂sungen betrachtet werden. Verschl√ºsselung wird typischerweise f√ºr Sicherheit und Compliance verwendet.

**Mit CloudHSM haben nur Sie Zugriff auf die Schl√ºssel** und ohne zu sehr ins Detail zu gehen, verwalten Sie mit CloudHSM Ihre eigenen Schl√ºssel. **Mit KMS verwalten Sie und Amazon gemeinsam Ihre Schl√ºssel**. AWS hat viele Richtlinienschutzma√ünahmen gegen Missbrauch und **kann in keiner der L√∂sungen auf Ihre Schl√ºssel zugreifen**. Der Hauptunterschied besteht in der Compliance in Bezug auf den Schl√ºsselbesitz und das Management, und bei CloudHSM handelt es sich um ein Hardwareger√§t, das Sie exklusiv verwalten und warten, mit ausschlie√ülichem Zugriff f√ºr Sie und nur Sie.

### CloudHSM-Empfehlungen

1. Implementieren Sie CloudHSM immer in einem **HA-Setup** mit mindestens zwei Ger√§ten in **getrennten Verf√ºgbarkeitszonen** und wenn m√∂glich, implementieren Sie ein drittes entweder lokal oder in einer anderen Region bei AWS.
2. Seien Sie vorsichtig beim **Initialisieren** eines **CloudHSM**. Diese Aktion **zerst√∂rt die Schl√ºssel**, also haben Sie entweder eine Kopie der Schl√ºssel oder seien Sie absolut sicher, dass Sie diese Schl√ºssel nicht ben√∂tigen und niemals ben√∂tigen werden, um Daten zu entschl√ºsseln.
3. CloudHSM unterst√ºtzt nur bestimmte Versionen von Firmware und Software. Bevor Sie ein Update durchf√ºhren, stellen Sie sicher, dass die Firmware und/oder Software von AWS unterst√ºtzt wird. Sie k√∂nnen sich jederzeit an den AWS-Support wenden, um zu √ºberpr√ºfen, ob der Aktualisierungsleitfaden unklar ist.
4. Die **Netzwerkkonfiguration sollte niemals ge√§ndert werden**. Denken Sie daran, es befindet sich in einem AWS-Rechenzentrum, und AWS √ºberwacht die Basishardware f√ºr Sie. Das bedeutet, dass sie es f√ºr Sie ersetzen, wenn die Hardware ausf√§llt, aber nur, wenn sie wissen, dass sie ausgefallen ist.
5. Der **SysLog-Weiterleitung sollte nicht entfernt oder ge√§ndert werden**. Sie k√∂nnen immer **einen SysLog-Weiterleiter hinzuf√ºgen**, um die Protokolle an Ihr eigenes Sammelwerkzeug zu leiten.
6. Die **SNMP-Konfiguration hat die gleichen grundlegenden Einschr√§nkungen wie das Netzwerk und der SysLog-Ordner. Diese **sollte nicht ge√§ndert oder entfernt werden**. Eine **zus√§tzliche** SNMP-Konfiguration ist in Ordnung, stellen Sie nur sicher, dass Sie die vorhandene Konfiguration auf dem Ger√§t nicht √§ndern.
7. Eine weitere interessante bew√§hrte Praxis von AWS ist es, **die NTP-Konfiguration nicht zu √§ndern**. Es ist nicht klar, was passieren w√ºrde, wenn Sie es tun w√ºrden, also denken Sie daran, dass, wenn Sie nicht dieselbe NTP-Konfiguration f√ºr den Rest Ihrer L√∂sung verwenden, Sie zwei Zeitquellen haben k√∂nnten. Seien Sie sich dessen bewusst und wissen Sie, dass das CloudHSM mit der bestehenden NTP-Quelle bleiben muss.

Die anf√§ngliche Startgeb√ºhr f√ºr CloudHSM betr√§gt 5.000 USD, um das dedizierte Hardwareger√§t f√ºr Ihren Gebrauch zuzuweisen, dann f√§llt eine st√ºndliche Geb√ºhr f√ºr den Betrieb von CloudHSM an, die derzeit bei 1,88 USD pro Betriebsstunde liegt oder etwa 1.373 USD pro Monat betr√§gt.

Der h√§ufigste Grund f√ºr die Verwendung von CloudHSM sind Compliance-Standards, die Sie aus regulatorischen Gr√ºnden einhalten m√ºssen. **KMS bietet keine Datenunterst√ºtzung f√ºr asymmetrische Schl√ºssel. CloudHSM erm√∂glicht es Ihnen, asymmetrische Schl√ºssel sicher zu speichern**.

Der **√∂ffentliche Schl√ºssel wird beim Bereitstellen auf dem HSM-Ger√§t installiert**, sodass Sie √ºber SSH auf die CloudHSM-Instanz zugreifen k√∂nnen.
### Was ist ein Hardware-Sicherheitsmodul

Ein Hardware-Sicherheitsmodul (HSM) ist ein dediziertes kryptografisches Ger√§t, das zur Generierung, Speicherung und Verwaltung kryptografischer Schl√ºssel und zum Schutz sensibler Daten verwendet wird. Es ist darauf ausgelegt, ein hohes Ma√ü an Sicherheit zu bieten, indem die kryptografischen Funktionen physisch und elektronisch vom Rest des Systems isoliert werden.

Die Funktionsweise eines HSM kann je nach spezifischem Modell und Hersteller variieren, aber im Allgemeinen treten die folgenden Schritte auf:

1. **Schl√ºsselgenerierung**: Das HSM generiert einen zuf√§lligen kryptografischen Schl√ºssel mithilfe eines sicheren Zufallszahlengenerators.
2. **Schl√ºsselspeicherung**: Der Schl√ºssel wird **sicher im HSM gespeichert, wo er nur von autorisierten Benutzern oder Prozessen abgerufen werden kann**.
3. **Schl√ºsselverwaltung**: Das HSM bietet eine Reihe von Schl√ºsselverwaltungsfunktionen, einschlie√ülich Schl√ºsselrotation, Backup und Widerruf.
4. **Kryptografische Operationen**: Das HSM f√ºhrt eine Reihe von kryptografischen Operationen durch, einschlie√ülich Verschl√ºsselung, Entschl√ºsselung, digitale Signatur und Schl√ºsselaustausch. Diese Operationen werden **innerhalb der sicheren Umgebung des HSM durchgef√ºhrt**, die vor unbefugtem Zugriff und Manipulation sch√ºtzt.
5. **Audit-Protokollierung**: Das HSM protokolliert alle kryptografischen Operationen und Zugriffsversuche, die f√ºr Compliance- und Sicherheitspr√ºfungszwecke verwendet werden k√∂nnen.

HSMs k√∂nnen f√ºr eine Vielzahl von Anwendungen verwendet werden, darunter sichere Online-Transaktionen, digitale Zertifikate, sichere Kommunikation und Datenverschl√ºsselung. Sie werden h√§ufig in Branchen eingesetzt, die ein hohes Ma√ü an Sicherheit erfordern, wie Finanzwesen, Gesundheitswesen und Regierung.

Insgesamt macht das hohe Sicherheitsniveau, das von HSMs bereitgestellt wird, es **sehr schwierig, Rohschl√ºssel daraus zu extrahieren, und der Versuch, dies zu tun, wird oft als Sicherheitsversto√ü angesehen**. Es kann jedoch **bestimmte Szenarien** geben, in denen ein **Rohschl√ºssel von autorisiertem Personal** f√ºr spezifische Zwecke extrahiert werden k√∂nnte, wie z. B. im Fall eines Schl√ºsselwiederherstellungsverfahrens.

### Enumeration
```
TODO
```
<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
