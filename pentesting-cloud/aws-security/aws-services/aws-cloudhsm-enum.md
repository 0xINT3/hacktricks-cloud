# AWS - CloudHSM Enum

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい場合は**[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**をフォロー**してください。
* **ハッキングトリックを共有するために**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する。

</details>

## HSM - ハードウェアセキュリティモジュール

Cloud HSMは、安全な暗号鍵の保存のためのFIPS 140レベル2の検証済み**ハードウェアデバイス**です（CloudHSMはハードウェアアプライアンスであり、仮想化されたサービスではありません）。これは、5.3.13がプリロードされたSafeNetLuna 7000アプライアンスです。2つのファームウェアバージョンがあり、選択するのは実際のニーズに基づいています。1つはFIPS 140-2の準拠用であり、新しいバージョンも使用できます。

CloudHSMの異例の特徴は、それが**物理デバイスである**ということです。したがって、他の顧客と共有されていない、または一般的に言われるように、マルチテナントではありません。これは、専用のシングルテナントアプライアンスであり、あなたのワークロードにのみ利用可能です。

通常、デバイスは15分以内に利用可能になります（容量がある場合）。ただし、一部のゾーンでは利用できない場合があります。

これはあなた専用の物理デバイスであるため、**鍵はデバイスに保存されます**。鍵は別のデバイスに**レプリケート**したり、オフラインストレージにバックアップしたり、スタンバイアプライアンスにエクスポートする必要があります。このデバイスは、S3やKMSのようなAWSの他のサービスによってバックアップされていません。

**CloudHSM**では、**サービスを自分でスケーリングする必要があります**。解決策に実装する暗号化アルゴリズムに基づいて、暗号化ニーズを処理するのに十分なCloudHSMデバイスをプロビジョニングする必要があります。\
Key Management ServiceのスケーリングはAWSによって実行され、需要に応じて自動的にスケーリングされるため、使用量が増えるにつれて必要なCloudHSMアプライアンスの数も増える可能性があります。ソリューションをスケーリングする際にはこれを考慮し、ソリューションが自動スケーリングを持っている場合は、ソリューションをサービスするために十分なCloudHSMアプライアンスが考慮されていることを確認してください。

スケーリングと同様に、**CloudHSMのパフォーマンスはあなた次第です**。パフォーマンスは、使用される暗号化アルゴリズムとデータを暗号化するために鍵をアクセスまたは取得する頻度に基づいて異なります。キーマネジメントサービスのパフォーマンスはAmazonによって処理され、需要に応じて自動的にスケーリングされます。CloudHSMのパフォーマンスは、より多くのアプライアンスを追加することによって達成され、必要に応じてデバイスを追加するか、より高速なアルゴリズムに暗号化方法を変更することで、パフォーマンスを向上させることができます。

ソリューションが**マルチリージョン**の場合、第2リージョンにいくつかの**CloudHSMアプライアンスを追加**し、プライベートVPN接続を使用してクロスリージョン接続を確保するか、トラフィックが常に保護されるようにするための方法を見つける必要があります。マルチリージョンソリューションを持っている場合は、**鍵をレプリケートし、運用しているリージョンに追加のCloudHSMデバイスを設定**する必要があります。複数のリージョンにわたって広がる6台または8台のデバイスを持つシナリオにすぐに入る可能性があるため、暗号化キーの完全な冗長性を実現できます。

**CloudHSM**は、セキュアな鍵の保存のためのエンタープライズクラスのサービスであり、企業の**信頼のルート**として使用できます。PKIでプライベートキーを、X509で証明書機関キーを格納できます。対称アルゴリズムで使用される対称鍵のみを物理的に保護し、KMSはPKIおよびCAキーを格納できないため、CloudHSMが解決策となる可能性があります。

**CloudHSMはKey Management Serviceよりもかなり高価です**。CloudHSMはハードウェアアプライアンスなので、CloudHSMデバイスをプロビジョニングするための固定コストと、アプライアンスを実行するための時間ごとのコストがかかります。特定の要件を満たすために必要なCloudHSMアプライアンスの数だけコストがかかります。\
さらに、SafeNet ProtectVソフトウェアスイートなどのサードパーティソフトウェアの購入、統合時間、および労力を考慮する必要があります。Key Management Serviceは使用量に基づいており、持っている鍵の数と入出力操作に依存します。多くのAWSサービスとシームレスに統合するため、統合コストはかなり低く抑えられるはずです。コストは、暗号化ソリューションにおいては二次的な要因として考慮すべきです。暗号化は通常、セキュリティとコンプライアンスのために使用されます。

**CloudHSMでは、鍵にアクセスできるのはあなただけ**であり、詳細には立ち入りませんが、CloudHSMでは独自の鍵を管理します。**KMSでは、あなたとAmazonが共同で鍵を管理**します。AWSには、両方のソリューションで鍵にアクセスできないようにするための多くのポリシーセーフガードがあります。主な違いは、鍵の所有権と管理に関連するコンプライアンスであり、CloudHSMでは、これはあなた専用のハードウェアアプライアンスであり、あなたにのみ独占的なアクセス権があります。

### CloudHSMの提案

1. 常に**HAセットアップ**でCloudHSMを展開し、**別々の可用性ゾーンに少なくとも2つのアプライアンス**を配置し、可能であれば、AWSの別のリージョンでサードを展開します。
2. **CloudHSMを初期化**する際には注意してください。このアクションは**鍵を破壊**するため、他に鍵のコピーがあるか、鍵が必要ないことを絶対に確認してください。
3. CloudHSMは特定のファームウェアおよびソフトウェアのバージョンのみをサポートしています。アップデートを実行する前に、ファームウェアまたはソフトウェアがAWSによってサポートされていることを確認してください。アップグレードガイドが不明確な場合は、いつでもAWSサポートに連絡して確認できます。
4. **ネットワーク構成は変更しないでください。**覚えておいてください、AWSのデータセンターにあり、AWSは基本ハードウェアを監視しています。つまり、ハードウェアが故障した場合、AWSが交換しますが、それが故障していることを知っている場合に限ります。
5. **SysLogフォワーダを削除または変更しないでください。**常にログを自分の収集ツールに向けるために、SysLogフォワーダを追加できます。
6. **SNMP**構成には、ネットワークとSysLogフォルダと同じ基本的な制限があります。これを**変更または削除しないでください**。追加のSNMP構成は問題ありませんが、すでにアプライアンスにあるものを変更しないようにしてください。
7. AWSからのもう1つの興味深いベストプラクティスは、**NTP構成を変更しないこと**です。変更した場合の具体的な影響は明確ではありませんので、ソリューションの残りの部分に同じNTP構成を使用していない場合は、2つの時間ソースを持つ可能性があります。これを認識しておき、CloudHSMが既存のNTPソースとともに維持される必要があることを知っておいてください。

CloudHSMの初期起動料金は、あなた専用のハードウェアアプライアンスを割り当てるための$5,000であり、現在のCloudHSMの運用時間あたりの料金は$1.88であり、約$1,373/月です。

CloudHSMを使用する最も一般的な理由は、規制上の理由で満たす必要があるコンプライアンス基準です。**KMSは非対称鍵のデータサポートを提供しません。CloudHSMは非対称鍵を安全に保存できます**。

**公開鍵は、プロビジョニング中にHSMアプライアンスにインストール**されるため、SSH経由でCloudHSMインスタンスにアクセスできます。

### ハードウェアセキュリティモジュールとは

ハードウェアセキュリティモジュール（HSM）は、暗号鍵を生成、保存、管理し、機密データを保護するために使用される専用の暗号デバイスです。暗号機能を物理的および電子的に他のシステムから分離することで、高いセキュリティレベルを提供するよう設計されています。

HSMの動作方法は、特定のモデルやメーカーによって異なりますが、一般的には次の手順が実行されます：

1. **鍵生成**：HSMは安全な乱数生成器を使用してランダムな暗号鍵を生成します。
2. **鍵の保存**：鍵は**HSM内で安全に保存**され、認証されたユーザーまたはプロセスのみがアクセスできます。
3. **鍵管理**：HSMは、鍵のローテーション、バックアップ、取り消しを含むさまざまな鍵管理機能を提供します。
4. **暗号操作**：HSMは、暗号化、復号化、デジタル署名、鍵交換などのさまざまな暗号操作を実行します。これらの操作は、HSMの安全な環境内で実行され、未承認のアクセスや改ざんから保護されます。
5. **監査ログ**：HSMはすべての暗号操作とアクセス試行をログに記録し、コンプライアンスおよびセキュリティ監査の目的に使用できます。

HSMは、安全なオンライン取引、デジタル証明書、安全な通信、データ暗号化など、さまざまなアプリケーションに使用できます。金融、医療、政府など、高度なセキュリティレベルが必要な業界でよく使用されます。

HSMが提供する高いセキュリティレベル
```
```
<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でAWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)、当社の独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションを発見する
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**をフォロー**する
- **ハッキングトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出してください。

</details>
