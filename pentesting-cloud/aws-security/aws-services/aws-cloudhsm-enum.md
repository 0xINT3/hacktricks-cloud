# AWS - Enumerazione di CloudHSM

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team di HackTricks AWS)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se desideri vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>

## HSM - Modulo di Sicurezza Hardware

Cloud HSM √® un dispositivo hardware convalidato a livello FIPS 140-2 per la memorizzazione sicura delle chiavi crittografiche (nota che CloudHSM √® un dispositivo hardware, non √® un servizio virtualizzato). Si tratta di un dispositivo SafeNetLuna 7000 con preinstallato il firmware 5.3.13. Ci sono due versioni del firmware e la scelta dipende dalle esigenze specifiche. Una √® per la conformit√† FIPS 140-2 e c'era una versione pi√π recente che pu√≤ essere utilizzata.

La caratteristica insolita di CloudHSM √® che si tratta di un dispositivo fisico e quindi **non √® condiviso con altri clienti**, o come comunemente definito, multi-tenant. Si tratta di un dispositivo dedicato a un singolo tenant reso disponibile esclusivamente per i tuoi carichi di lavoro.

Di solito, un dispositivo √® disponibile entro 15 minuti a condizione che ci sia capacit√†, ma in alcune zone potrebbe non esserci.

Poich√© si tratta di un dispositivo fisico dedicato a te, **le chiavi sono memorizzate sul dispositivo**. Le chiavi devono essere replicate su un altro dispositivo, salvate su un supporto di archiviazione offline o esportate su un dispositivo di riserva. **Questo dispositivo non √® supportato** da S3 o da altri servizi AWS come KMS.

In **CloudHSM**, devi **scalare il servizio da solo**. Devi fornire abbastanza dispositivi CloudHSM per gestire le esigenze di crittografia in base agli algoritmi di crittografia che hai scelto di implementare per la tua soluzione.\
La scalabilit√† del Key Management Service √® gestita da AWS e si adatta automaticamente alla domanda, quindi man mano che aumenta l'utilizzo, potrebbe essere necessario un numero maggiore di dispositivi CloudHSM. Tieni presente questo mentre scalate la tua soluzione e se la tua soluzione ha il ridimensionamento automatico, assicurati che il massimo scalabilit√† sia considerato con abbastanza dispositivi CloudHSM per servire la soluzione.

Come la scalabilit√†, **le prestazioni dipendono da te con CloudHSM**. Le prestazioni variano in base all'algoritmo di crittografia utilizzato e a quanto spesso √® necessario accedere o recuperare le chiavi per crittografare i dati. Le prestazioni del servizio di gestione delle chiavi sono gestite da Amazon e si adattano automaticamente in base alle esigenze della domanda. Le prestazioni di CloudHSM sono ottenute aggiungendo pi√π dispositivi e se hai bisogno di pi√π prestazioni, aggiungi dispositivi o modifica il metodo di crittografia con un algoritmo pi√π veloce.

Se la tua soluzione √® **multi-regionale**, dovresti aggiungere diversi **dispositivi CloudHSM nella seconda regione e stabilire la connettivit√† cross-regionale con una connessione VPN privata** o un qualche metodo per garantire che il traffico sia sempre protetto tra i dispositivi ad ogni livello della connessione. Se hai una soluzione multi-regionale, devi pensare a come **replicare le chiavi e configurare ulteriori dispositivi CloudHSM nelle regioni in cui operi**. Potresti trovarti rapidamente in una situazione in cui hai sei o otto dispositivi distribuiti su pi√π regioni, consentendo la piena ridondanza delle tue chiavi di crittografia.

**CloudHSM** √® un servizio di classe enterprise per la memorizzazione sicura delle chiavi e pu√≤ essere utilizzato come **radice di fiducia per un'azienda**. Pu√≤ memorizzare chiavi private in PKI e chiavi di autorit√† di certificazione nelle implementazioni X509. Oltre alle chiavi simmetriche utilizzate negli algoritmi simmetrici come AES, **KMS memorizza e protegge fisicamente solo le chiavi simmetriche (non pu√≤ agire come autorit√† di certificazione)**, quindi se hai bisogno di memorizzare chiavi PKI e CA, uno, due o tre CloudHSM potrebbero essere la tua soluzione.

**CloudHSM √® considerevolmente pi√π costoso di Key Management Service**. CloudHSM √® un dispositivo hardware quindi hai costi fissi per la fornitura del dispositivo CloudHSM, quindi un costo orario per eseguire il dispositivo. Il costo √® moltiplicato per quanti dispositivi CloudHSM sono necessari per soddisfare le tue esigenze specifiche.\
Inoltre, devono essere considerati i costi relativi all'acquisto di software di terze parti come i pacchetti software SafeNet ProtectV e il tempo e lo sforzo di integrazione. Key Management Service √® basato sull'utilizzo e dipende dal numero di chiavi che possiedi e dalle operazioni di input e output. Poich√© il servizio di gestione delle chiavi offre un'integrazione senza soluzione di continuit√† con molti servizi AWS, i costi di integrazione dovrebbero essere significativamente inferiori. I costi dovrebbero essere considerati un fattore secondario nelle soluzioni di crittografia. La crittografia √® tipicamente utilizzata per motivi di sicurezza e conformit√†.

**Con CloudHSM solo tu hai accesso alle chiavi** e senza entrare troppo nei dettagli, con CloudHSM gestisci le tue chiavi. **Con KMS, tu e Amazon gestite congiuntamente le chiavi**. AWS ha molte politiche di salvaguardia contro gli abusi e **non pu√≤ comunque accedere alle tue chiavi in nessuna delle due soluzioni**. La distinzione principale riguarda la conformit√† per quanto riguarda la propriet√† e la gestione delle chiavi e con CloudHSM, si tratta di un dispositivo hardware che gestisci e mantieni con accesso esclusivo a te e solo a te.

### Suggerimenti su CloudHSM

1. Implementa sempre CloudHSM in un **setup ad alta disponibilit√†** con almeno due dispositivi in **zone di disponibilit√† separate**, e se possibile, implementa un terzo dispositivo in locale o in un'altra regione su AWS.
2. Fai attenzione quando **inizializzi** un **CloudHSM**. Questa azione **distrugger√† le chiavi**, quindi assicurati di avere un'altra copia delle chiavi o essere assolutamente sicuro che non hai e non avrai mai bisogno di queste chiavi per decrittografare dati.
3. CloudHSM supporta solo **alcune versioni di firmware** e software. Prima di eseguire un aggiornamento, assicurati che il firmware e/o il software siano supportati da AWS. Puoi sempre contattare il supporto AWS per verificare se la guida all'aggiornamento non √® chiara.
4. La **configurazione di rete non dovrebbe mai essere modificata**. Ricorda, si trova in un data center AWS e AWS monitora l'hardware di base per te. Ci√≤ significa che se l'hardware fallisce, lo sostituiranno per te, ma solo se sanno che √® fallito.
5. Il **forward di SysLog non dovrebbe essere rimosso o modificato**. Puoi sempre **aggiungere** un inoltratore di SysLog per indirizzare i log al tuo strumento di raccolta personale.
6. La configurazione **SNMP** ha le stesse restrizioni di base della rete e della cartella SysLog. Questa **non dovrebbe essere modificata o rimossa**. Una configurazione **SNMP aggiuntiva** va bene, assicurati solo di non modificare quella gi√† presente sul dispositivo.
7. Un'altra pratica consigliata interessante da AWS √® **non modificare la configurazione NTP**. Non √® chiaro cosa succederebbe se lo facessi, quindi tieni presente che se non utilizzi la stessa configurazione NTP per il resto della tua soluzione, potresti avere due fonti di tempo. Sii consapevole di questo e sappi che il CloudHSM deve rimanere con la sorgente NTP esistente.

Il costo iniziale per il lancio di CloudHSM √® di $5.000 per allocare il dispositivo hardware dedicato al tuo utilizzo, quindi c'√® un costo orario associato all'esecuzione di CloudHSM attualmente di $1,88 all'ora di funzionamento, o approssimativamente $1.373 al mese.

Il motivo pi√π comune per utilizzare CloudHSM sono gli standard di conformit√† che devi rispettare per motivi normativi. **KMS non offre supporto dati per chiavi asimmetriche. CloudHSM ti consente di memorizzare in modo sicuro chiavi asimmetriche**.

La **chiave pubblica √® installata sul dispositivo HSM durante la fornitura** in modo da poter accedere all'istanza CloudHSM tramite SSH.
### Cos'√® un modulo di sicurezza hardware

Un modulo di sicurezza hardware (HSM) √® un dispositivo crittografico dedicato utilizzato per generare, memorizzare e gestire chiavi crittografiche e proteggere dati sensibili. √à progettato per fornire un alto livello di sicurezza isolando fisicamente ed elettronicamente le funzioni crittografiche dal resto del sistema.

Il funzionamento di un HSM pu√≤ variare a seconda del modello e del produttore specifico, ma generalmente si verificano i seguenti passaggi:

1. **Generazione chiave**: L'HSM genera una chiave crittografica casuale utilizzando un generatore di numeri casuali sicuro.
2. **Memorizzazione chiave**: La chiave √® **memorizzata in modo sicuro all'interno dell'HSM, dove pu√≤ essere accessibile solo da utenti o processi autorizzati**.
3. **Gestione chiave**: L'HSM fornisce una serie di funzioni di gestione chiave, inclusa rotazione, backup e revoca delle chiavi.
4. **Operazioni crittografiche**: L'HSM esegue una serie di operazioni crittografiche, inclusa crittografia, decrittografia, firma digitale e scambio di chiavi. Queste operazioni sono **eseguite all'interno dell'ambiente sicuro dell'HSM**, che protegge contro accessi non autorizzati e manomissioni.
5. **Registrazione audit**: L'HSM registra tutte le operazioni crittografiche e i tentativi di accesso, che possono essere utilizzati per fini di conformit√† e audit di sicurezza.

Gli HSM possono essere utilizzati per una vasta gamma di applicazioni, inclusi transazioni online sicure, certificati digitali, comunicazioni sicure e crittografia dei dati. Sono spesso utilizzati in settori che richiedono un alto livello di sicurezza, come finanza, sanit√† e governo.

Complessivamente, l'alto livello di sicurezza fornito dagli HSM rende **molto difficile estrarre chiavi grezze da essi, e tentare di farlo √® spesso considerato una violazione della sicurezza**. Tuttavia, potrebbero esserci **certi scenari** in cui una **chiave grezza potrebbe essere estratta** da personale autorizzato per scopi specifici, come nel caso di una procedura di recupero chiave.

### Enumerazione
```
TODO
```
<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team AWS di HackTricks)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se desideri vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
