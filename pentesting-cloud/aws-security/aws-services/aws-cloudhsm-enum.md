# AWS - CloudHSM Enum

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## HSM - Module de S√©curit√© Mat√©riel

Cloud HSM est un **dispositif mat√©riel** valid√© FIPS 140 niveau deux pour le stockage s√©curis√© des cl√©s cryptographiques (notez que CloudHSM est un appareil mat√©riel, ce n'est pas un service virtualis√©). C'est un appareil SafeNetLuna 7000 avec la version 5.3.13 pr√©charg√©e. Il existe deux versions de firmware et le choix d√©pend de vos besoins pr√©cis. L'une est pour la conformit√© FIPS 140-2 et il y avait une version plus r√©cente qui peut √™tre utilis√©e.

La particularit√© de CloudHSM est qu'il s'agit d'un dispositif physique, et donc il n'est **pas partag√© avec d'autres clients**, ou comme on le dit commun√©ment, multi-locataire. C'est un appareil d√©di√© √† un seul locataire exclusivement mis √† disposition pour vos charges de travail.

Typiquement, un dispositif est disponible dans les 15 minutes en supposant qu'il y ait de la capacit√©, mais dans certaines zones cela pourrait ne pas √™tre le cas.

Puisqu'il s'agit d'un dispositif physique qui vous est d√©di√©, **les cl√©s sont stock√©es sur l'appareil**. Les cl√©s doivent soit √™tre **r√©pliqu√©es sur un autre dispositif**, sauvegard√©es sur un stockage hors ligne, ou export√©es vers un appareil de secours. **Cet appareil n'est pas sauvegard√©** par S3 ou tout autre service chez AWS comme KMS.

Dans **CloudHSM**, vous devez **dimensionner le service vous-m√™me**. Vous devez provisionner suffisamment de dispositifs CloudHSM pour g√©rer vos besoins en cryptage en fonction des algorithmes de cryptage que vous avez choisis pour votre solution.\
Le dimensionnement du Key Management Service est effectu√© par AWS et s'adapte automatiquement √† la demande, donc √† mesure que votre utilisation augmente, le nombre d'appareils CloudHSM requis pourrait √©galement augmenter. Gardez cela √† l'esprit lorsque vous dimensionnez votre solution et si votre solution a une auto-dimensionnement, assurez-vous que votre √©chelle maximale est prise en compte avec suffisamment d'appareils CloudHSM pour servir la solution.

Tout comme le dimensionnement, **la performance est de votre responsabilit√© avec CloudHSM**. La performance varie en fonction de l'algorithme de cryptage utilis√© et de la fr√©quence √† laquelle vous devez acc√©der ou r√©cup√©rer les cl√©s pour crypter les donn√©es. La performance du service de gestion des cl√©s est g√©r√©e par Amazon et s'adapte automatiquement √† la demande. La performance de CloudHSM est obtenue en ajoutant plus d'appareils et si vous avez besoin de plus de performance, vous ajoutez des dispositifs ou modifiez la m√©thode de cryptage pour l'algorithme qui est plus rapide.

Si votre solution est **multi-r√©gions**, vous devriez ajouter plusieurs **appareils CloudHSM dans la deuxi√®me r√©gion et √©tablir la connectivit√© inter-r√©gions avec une connexion VPN priv√©e** ou une m√©thode pour assurer que le trafic est toujours prot√©g√© entre l'appareil √† chaque couche de la connexion. Si vous avez une solution multi-r√©gions, vous devez r√©fl√©chir √† la fa√ßon de **r√©pliquer les cl√©s et de configurer des dispositifs CloudHSM suppl√©mentaires dans les r√©gions o√π vous op√©rez**. Vous pouvez tr√®s rapidement vous retrouver dans un sc√©nario o√π vous avez six ou huit appareils r√©partis sur plusieurs r√©gions, permettant une redondance compl√®te de vos cl√©s de cryptage.

**CloudHSM** est un service de classe entreprise pour le stockage s√©curis√© des cl√©s et peut √™tre utilis√© comme **racine de confiance pour une entreprise**. Il peut stocker des cl√©s priv√©es dans PKI et des cl√©s d'autorit√© de certification dans des impl√©mentations X509. En plus des cl√©s sym√©triques utilis√©es dans les algorithmes sym√©triques tels que AES, **KMS stocke et prot√®ge physiquement uniquement les cl√©s sym√©triques (ne peut pas agir comme une autorit√© de certification)**, donc si vous avez besoin de stocker des cl√©s PKI et CA, un ou deux CloudHSM ou trois pourraient √™tre votre solution.

**CloudHSM est consid√©rablement plus cher que le Key Management Service**. CloudHSM est un appareil mat√©riel donc vous avez des co√ªts fixes pour provisionner l'appareil CloudHSM, puis un co√ªt horaire pour faire fonctionner l'appareil. Le co√ªt est multipli√© par autant d'appareils CloudHSM qui sont n√©cessaires pour atteindre vos exigences sp√©cifiques.\
De plus, une consid√©ration crois√©e doit √™tre prise en compte dans l'achat de logiciels tiers tels que les suites logicielles SafeNet ProtectV et le temps et l'effort d'int√©gration. Le Key Management Service est bas√© sur l'utilisation et d√©pend du nombre de cl√©s que vous avez et des op√©rations d'entr√©e et de sortie. Comme la gestion des cl√©s offre une int√©gration transparente avec de nombreux services AWS, les co√ªts d'int√©gration devraient √™tre nettement inf√©rieurs. Les co√ªts devraient √™tre consid√©r√©s comme un facteur secondaire dans les solutions de cryptage. Le cryptage est g√©n√©ralement utilis√© pour la s√©curit√© et la conformit√©.

**Avec CloudHSM, seul vous avez acc√®s aux cl√©s** et sans entrer dans trop de d√©tails, avec CloudHSM, vous g√©rez vos propres cl√©s. **Avec KMS, vous et Amazon co-g√©rez vos cl√©s**. AWS a de nombreuses politiques de protection contre les abus et **ne peut toujours pas acc√©der √† vos cl√©s dans les deux solutions**. La principale distinction est la conformit√© en ce qui concerne la propri√©t√© et la gestion des cl√©s, et avec CloudHSM, c'est un appareil mat√©riel que vous g√©rez et entretenez avec un acc√®s exclusif √† vous et √† vous seul.

### Suggestions CloudHSM

1. D√©ployez toujours CloudHSM dans une configuration **HA** avec au moins deux appareils dans des **zones de disponibilit√© s√©par√©es**, et si possible, d√©ployez un troisi√®me soit sur site soit dans une autre r√©gion chez AWS.
2. Soyez prudent lors de l'**initialisation** d'un **CloudHSM**. Cette action **d√©truira les cl√©s**, donc ayez une autre copie des cl√©s ou soyez absolument s√ªr que vous n'avez pas et n'aurez jamais besoin de ces cl√©s pour d√©chiffrer des donn√©es.
3. CloudHSM ne **prend en charge que certaines versions de firmware** et de logiciels. Avant d'effectuer une mise √† jour, assurez-vous que le firmware et/ou le logiciel sont pris en charge par AWS. Vous pouvez toujours contacter le support AWS pour v√©rifier si le guide de mise √† jour n'est pas clair.
4. La **configuration r√©seau ne doit jamais √™tre modifi√©e.** Rappelez-vous, elle se trouve dans un centre de donn√©es AWS et AWS surveille le mat√©riel de base pour vous. Cela signifie que si le mat√©riel √©choue, ils le remplaceront pour vous, mais seulement s'ils savent qu'il a √©chou√©.
5. La **redirection SysLog ne doit pas √™tre supprim√©e ou modifi√©e**. Vous pouvez toujours **ajouter** un transfert SysLog pour diriger les journaux vers votre propre outil de collecte.
6. La configuration **SNMP** a les m√™mes restrictions de base que le r√©seau et le dossier SysLog. Cela **ne doit pas √™tre modifi√© ou supprim√©**. Une configuration SNMP **suppl√©mentaire** est acceptable, assurez-vous simplement de ne pas changer celle qui est d√©j√† sur l'appareil.
7. Une autre meilleure pratique int√©ressante d'AWS est de **ne pas changer la configuration NTP**. Il n'est pas clair ce qui se passerait si vous le faisiez, donc gardez √† l'esprit que si vous n'utilisez pas la m√™me configuration NTP pour le reste de votre solution, vous pourriez avoir deux sources de temps. Soyez conscient de cela et sachez que le CloudHSM doit rester avec la source NTP existante.

Les frais de lancement initial pour CloudHSM sont de 5 000 $ pour allouer l'appareil mat√©riel d√©di√© √† votre usage, puis il y a des frais horaires associ√©s √† l'exploitation de CloudHSM qui sont actuellement de 1,88 $ par heure d'op√©ration, soit environ 1 373 $ par mois.

La raison la plus courante d'utiliser CloudHSM est les normes de conformit√© que vous devez respecter pour des raisons r√©glementaires. **KMS n'offre pas de support de donn√©es pour les cl√©s asym√©triques. CloudHSM vous permet de stocker des cl√©s asym√©triques en toute s√©curit√©**.
La **cl√© publique est install√©e sur l'appareil HSM lors de la provision** afin que vous puissiez acc√©der √† l'instance CloudHSM via SSH.

### Qu'est-ce qu'un module de s√©curit√© mat√©rielle

Un module de s√©curit√© mat√©rielle (HSM) est un dispositif cryptographique d√©di√© utilis√© pour g√©n√©rer, stocker et g√©rer des cl√©s cryptographiques et prot√©ger des donn√©es sensibles. Il est con√ßu pour fournir un haut niveau de s√©curit√© en isolant physiquement et √©lectroniquement les fonctions cryptographiques du reste du syst√®me.

Le fonctionnement d'un HSM peut varier en fonction du mod√®le sp√©cifique et du fabricant, mais g√©n√©ralement, les √©tapes suivantes se produisent :

1. **G√©n√©ration de cl√©** : Le HSM g√©n√®re une cl√© cryptographique al√©atoire en utilisant un g√©n√©rateur de nombres al√©atoires s√©curis√©.
2. **Stockage de cl√©** : La cl√© est **stock√©e en toute s√©curit√© √† l'int√©rieur du HSM, o√π elle ne peut √™tre acc√©d√©e que par des utilisateurs ou des processus autoris√©s**.
3. **Gestion de cl√©** : Le HSM fournit une gamme de fonctions de gestion de cl√©s, y compris la rotation de cl√©s, la sauvegarde et la r√©vocation.
4. **Op√©rations cryptographiques** : Le HSM effectue une gamme d'op√©rations cryptographiques, y compris le chiffrement, le d√©chiffrement, la signature num√©rique et l'√©change de cl√©s. Ces op√©rations sont **effectu√©es √† l'int√©rieur de l'environnement s√©curis√© du HSM**, ce qui prot√®ge contre l'acc√®s non autoris√© et la manipulation.
5. **Journalisation d'audit** : Le HSM enregistre toutes les op√©rations cryptographiques et les tentatives d'acc√®s, qui peuvent √™tre utilis√©es √† des fins de conformit√© et d'audit de s√©curit√©.

Les HSM peuvent √™tre utilis√©s pour une large gamme d'applications, y compris les transactions en ligne s√©curis√©es, les certificats num√©riques, les communications s√©curis√©es et le chiffrement des donn√©es. Ils sont souvent utilis√©s dans des industries n√©cessitant un haut niveau de s√©curit√©, telles que la finance, la sant√© et le gouvernement.

Dans l'ensemble, le haut niveau de s√©curit√© fourni par les HSM rend **tr√®s difficile l'extraction de cl√©s brutes de ces derniers, et tenter de le faire est souvent consid√©r√© comme une violation de la s√©curit√©**. Cependant, il peut y avoir **certains sc√©narios** o√π une **cl√© brute pourrait √™tre extraite** par du personnel autoris√© √† des fins sp√©cifiques, comme dans le cas d'une proc√©dure de r√©cup√©ration de cl√©.

### √ânum√©ration
```
```
<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
