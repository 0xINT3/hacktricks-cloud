# AWS - CloudHSM Enum

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## HSM - Module de s√©curit√© mat√©rielle

Cloud HSM est un dispositif mat√©riel valid√© de niveau deux FIPS 140 pour le stockage s√©curis√© de cl√©s cryptographiques (notez que CloudHSM est un appareil mat√©riel, ce n'est pas un service virtualis√©). Il s'agit d'un appareil SafeNetLuna 7000 pr√©charg√© avec la version 5.3.13. Il existe deux versions de firmware et le choix d√©pend vraiment de vos besoins exacts. L'une est pour la conformit√© FIPS 140-2 et il y avait une version plus r√©cente qui peut √™tre utilis√©e.

La caract√©ristique inhabituelle de CloudHSM est qu'il s'agit d'un appareil physique, et donc il n'est **pas partag√© avec d'autres clients**, ou comme on le dit couramment, multi-locataire. C'est un appareil d√©di√© √† un seul locataire exclusivement mis √† la disposition de vos charges de travail.

G√©n√©ralement, un appareil est disponible en 15 minutes s'il y a de la capacit√©, mais dans certaines zones, cela pourrait ne pas √™tre le cas.

√âtant donn√© qu'il s'agit d'un appareil physique qui vous est d√©di√©, **les cl√©s sont stock√©es sur l'appareil**. Les cl√©s doivent √™tre soit **r√©pliqu√©es sur un autre appareil**, sauvegard√©es sur un stockage hors ligne, ou export√©es vers un appareil de secours. **Cet appareil n'est pas sauvegard√©** par S3 ou tout autre service chez AWS comme KMS.

Dans **CloudHSM**, vous devez **mettre en place le service vous-m√™me**. Vous devez provisionner suffisamment d'appareils CloudHSM pour g√©rer vos besoins en mati√®re de chiffrement en fonction des algorithmes de chiffrement que vous avez choisis pour mettre en ≈ìuvre votre solution.\
La mise √† l'√©chelle du service de gestion des cl√©s est effectu√©e par AWS et se met automatiquement √† l'√©chelle selon la demande, donc √† mesure que votre utilisation augmente, le nombre d'appareils CloudHSM n√©cessaires pourrait √©galement augmenter. Gardez cela √† l'esprit lorsque vous mettez √† l'√©chelle votre solution et si votre solution a une mise √† l'√©chelle automatique, assurez-vous que votre √©chelle maximale est prise en compte avec suffisamment d'appareils CloudHSM pour servir la solution.

Tout comme la mise √† l'√©chelle, **la performance d√©pend de vous avec CloudHSM**. La performance varie en fonction de l'algorithme de chiffrement utilis√© et de la fr√©quence √† laquelle vous devez acc√©der ou r√©cup√©rer les cl√©s pour chiffrer les donn√©es. La performance du service de gestion des cl√©s est g√©r√©e par Amazon et se met automatiquement √† l'√©chelle selon les besoins. La performance de CloudHSM est obtenue en ajoutant plus d'appareils et si vous avez besoin de plus de performance, vous ajoutez soit des appareils, soit modifiez la m√©thode de chiffrement vers un algorithme plus rapide.

Si votre solution est **multi-r√©gion**, vous devriez ajouter plusieurs **appareils CloudHSM dans la deuxi√®me r√©gion et mettre en place la connectivit√© inter-r√©gionale avec une connexion VPN priv√©e** ou une m√©thode pour garantir que le trafic est toujours prot√©g√© entre l'appareil √† chaque couche de la connexion. Si vous avez une solution multi-r√©gion, vous devez r√©fl√©chir √† la mani√®re de **r√©pliquer les cl√©s et configurer des appareils CloudHSM suppl√©mentaires dans les r√©gions o√π vous op√©rez**. Vous pouvez rapidement vous retrouver dans une situation o√π vous avez six ou huit appareils r√©partis dans plusieurs r√©gions, permettant une redondance compl√®te de vos cl√©s de chiffrement.

**CloudHSM** est un service de classe entreprise pour le stockage s√©curis√© des cl√©s et peut √™tre utilis√© comme **racine de confiance pour une entreprise**. Il peut stocker des cl√©s priv√©es en PKI et des cl√©s d'autorit√© de certification dans des impl√©mentations X509. En plus des cl√©s sym√©triques utilis√©es dans des algorithmes sym√©triques tels que AES, **KMS stocke et prot√®ge physiquement uniquement les cl√©s sym√©triques (ne peut pas agir en tant qu'autorit√© de certification)**, donc si vous devez stocker des cl√©s PKI et CA, un ou deux ou trois CloudHSM pourraient √™tre votre solution.

**CloudHSM est consid√©rablement plus cher que le service de gestion des cl√©s**. CloudHSM est un appareil mat√©riel, donc vous avez des co√ªts fixes pour provisionner l'appareil CloudHSM, puis un co√ªt horaire pour ex√©cuter l'appareil. Le co√ªt est multipli√© par autant d'appareils CloudHSM n√©cessaires pour r√©pondre √† vos besoins sp√©cifiques.\
De plus, il faut tenir compte de l'achat de logiciels tiers tels que les suites logicielles SafeNet ProtectV et du temps et des efforts d'int√©gration. Le service de gestion des cl√©s est bas√© sur l'utilisation et d√©pend du nombre de cl√©s que vous avez et des op√©rations d'entr√©e et de sortie. Comme la gestion des cl√©s offre une int√©gration transparente avec de nombreux services AWS, les co√ªts d'int√©gration devraient √™tre nettement inf√©rieurs. Les co√ªts devraient √™tre consid√©r√©s comme un facteur secondaire dans les solutions de chiffrement. Le chiffrement est g√©n√©ralement utilis√© pour la s√©curit√© et la conformit√©.

**Avec CloudHSM, vous seul avez acc√®s aux cl√©s** et sans entrer dans les d√©tails, avec CloudHSM, vous g√©rez vos propres cl√©s. **Avec KMS, vous et Amazon g√©rez conjointement vos cl√©s**. AWS dispose de nombreuses sauvegardes de politique contre les abus et **ne peut toujours pas acc√©der √† vos cl√©s dans l'une ou l'autre solution**. La principale distinction r√©side dans la conformit√© en ce qui concerne la propri√©t√© et la gestion des cl√©s, et avec CloudHSM, il s'agit d'un appareil mat√©riel que vous g√©rez et entretenez avec un acc√®s exclusif √† vous et √† vous seul.

### Suggestions CloudHSM

1. D√©ployez toujours CloudHSM dans une configuration **HA** avec au moins deux appareils dans des **zones de disponibilit√© distinctes**, et si possible, d√©ployez un troisi√®me soit sur site soit dans une autre r√©gion chez AWS.
2. Soyez prudent lors de l'**initialisation** d'un **CloudHSM**. Cette action **d√©truira les cl√©s**, alors ayez une autre copie des cl√©s ou soyez absolument s√ªr que vous n'avez pas besoin et ne devrez jamais avoir besoin de ces cl√©s pour d√©crypter des donn√©es.
3. CloudHSM ne **prend en charge que certaines versions de firmware** et de logiciels. Avant d'effectuer une mise √† jour, assurez-vous que le firmware et/ou le logiciel est pris en charge par AWS. Vous pouvez toujours contacter le support AWS pour v√©rifier si le guide de mise √† niveau est peu clair.
4. La **configuration r√©seau ne doit jamais √™tre modifi√©e**. Rappelez-vous, c'est dans un centre de donn√©es AWS et AWS surveille le mat√©riel de base pour vous. Cela signifie que si le mat√©riel tombe en panne, ils le remplaceront pour vous, mais seulement s'ils savent qu'il est en panne.
5. Le **transfert SysLog ne doit pas √™tre supprim√© ou modifi√©**. Vous pouvez toujours **ajouter** un transmetteur SysLog pour diriger les journaux vers votre propre outil de collecte.
6. La configuration **SNMP** a les m√™mes restrictions de base que le r√©seau et le dossier SysLog. Cela **ne doit pas √™tre modifi√© ou supprim√©**. Une **configuration SNMP suppl√©mentaire** est acceptable, assurez-vous simplement de ne pas modifier celle qui est d√©j√† sur l'appareil.
7. Une autre bonne pratique int√©ressante d'AWS est de **ne pas modifier la configuration NTP**. Il n'est pas clair ce qui se passerait si vous le faisiez, alors gardez √† l'esprit que si vous n'utilisez pas la m√™me configuration NTP pour le reste de votre solution, vous pourriez avoir deux sources de temps. Soyez simplement conscient de cela et sachez que le CloudHSM doit rester avec la source NTP existante.

Le co√ªt initial de lancement de CloudHSM est de 5 000 $ pour allouer l'appareil mat√©riel d√©di√© √† votre utilisation, puis il y a un co√ªt horaire associ√© √† l'ex√©cution de CloudHSM qui est actuellement de 1,88 $ par heure d'op√©ration, soit environ 1 373 $ par mois.

La raison la plus courante d'utiliser CloudHSM est les normes de conformit√© que vous devez respecter pour des raisons r√©glementaires. **KMS n'offre pas de support de donn√©es pour les cl√©s asym√©triques. CloudHSM vous permet de stocker des cl√©s asym√©triques en toute s√©curit√©**.

La **cl√© publique est install√©e sur l'appareil HSM lors de la provision** afin que vous puissiez acc√©der √† l'instance CloudHSM via SSH.

### Qu'est-ce qu'un module de s√©curit√© mat√©rielle

Un module de s√©curit√© mat√©rielle (HSM) est un dispositif cryptographique d√©di√© utilis√© pour g√©n√©rer, stocker et g√©rer des cl√©s cryptographiques et prot√©ger des donn√©es sensibles. Il est con√ßu pour fournir un niveau √©lev√© de s√©curit√© en isolant physiquement et √©lectroniquement les fonctions cryptographiques du reste du syst√®me.

La mani√®re dont un HSM fonctionne peut varier en fonction du mod√®le et du fabricant sp√©cifique, mais g√©n√©ralement, les √©tapes suivantes se produisent :

1. **G√©n√©ration de cl√©** : L'HSM g√©n√®re une cl√© cryptographique al√©atoire √† l'aide d'un g√©n√©rateur de nombres al√©atoires s√©curis√©.
2. **Stockage de cl√©** : La cl√© est **stock√©e de mani√®re s√©curis√©e √† l'int√©rieur de l'HSM, o√π elle ne peut √™tre acc√©d√©e que par des utilisateurs ou des processus autoris√©s**.
3. **Gestion de cl√©** : L'HSM fournit une gamme de fonctions de gestion de cl√©s, y compris la rotation de cl√©s, la sauvegarde et la r√©vocation.
4. **Op√©rations cryptographiques** : L'HSM effectue une gamme d'op√©rations cryptographiques, y compris le chiffrement, le d√©chiffrement, la signature num√©rique et l'√©change de cl√©s. Ces op√©rations sont **effectu√©es dans l'environnement s√©curis√© de l'HSM**, ce qui prot√®ge contre l'acc√®s non autoris√© et la manipulation.
5. **Journalisation d'audit** : L'HSM enregistre toutes les op√©rations cryptographiques et les tentatives d'acc√®s, qui peuvent √™tre utilis√©es √† des fins de conformit√© et d'audit de s√©curit√©.

Les HSM peuvent √™tre utilis√©s pour une large gamme d'applications, y compris les transactions en ligne s√©curis√©es, les certificats num√©riques, les communications s√©curis√©es et le chiffrement des donn√©es. Ils sont souvent utilis√©s dans des secteurs qui exigent un niveau √©lev√© de s√©curit√©, tels que la finance, la sant√© et le gouvernement.

Dans l'ensemble, le niveau √©lev√© de s√©curit√© fourni par les HSM rend **tr√®s difficile d'extraire des cl√©s brutes d'eux, et tenter de le faire est souvent consid√©r√© comme une violation de la s√©curit√©**. Cependant, il peut y avoir **certaines situations** o√π une **cl√© brute pourrait √™tre extraite** par du personnel autoris√© √† des fins sp√©cifiques, comme dans le cas d'une proc√©dure de r√©cup√©ration de cl√©.

### √ânum√©ration
```
```
<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge HackTricks AWS)</strong></a><strong>!</strong></summary>

D'autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF** Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
