# AWS - ECS Enum

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## ECS

### Podstawowe informacje

Amazon **Elastic Container Services** lub ECS dostarcza platformę do **hostowania aplikacji w kontenerach w chmurze**. ECS ma dwa **metody wdrażania**, typ instancji **EC2** i opcję **bezserwerową**, **Fargate**. Usługa ta **ułatwia uruchamianie kontenerów w chmurze**.

ECS działa przy użyciu trzech podstawowych elementów: **Klastry**, **Usługi** i **Definicje zadań**.

* **Klastry** to **grupy kontenerów**, które działają w chmurze. Jak wcześniej wspomniano, istnieją dwa typy uruchamiania kontenerów: EC2 i Fargate. AWS definiuje typ uruchamiania **EC2** jako umożliwiający klientom "uruchamianie \[ich] aplikacji w kontenerach na klastrze instancji Amazon EC2, które \[są] **zarządzane** przez \[nich]". **Fargate** jest podobny i jest definiowany jako "pozwalający na uruchamianie aplikacji w kontenerach **bez konieczności dostarczania i zarządzania** infrastrukturą backendową".
* **Usługi** są tworzone wewnątrz klastra i są odpowiedzialne za **uruchamianie zadań**. W definicji usługi **określasz liczbę zadań do uruchomienia, skalowanie automatyczne, dostawcę pojemności (Fargate/EC2/Zewnętrzny)**, **informacje o sieci** takie jak VPC, podsieci i grupy zabezpieczeń.
* Istnieją **2 rodzaje aplikacji**:
* **Usługa**: Grupa zadań obsługujących długotrwałą pracę obliczeniową, która może być zatrzymywana i ponownie uruchamiana. Na przykład aplikacja internetowa.
* **Zadanie**: Samodzielne zadanie, które jest uruchamiane i zatrzymywane. Na przykład zadanie wsadowe.
* Wśród aplikacji usługowych istnieją **2 rodzaje planistów usług**:
* [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): Strategia planowania replik umieszcza i **utrzymuje żądaną liczbę** zadań w klastrze. Jeśli z jakiegoś powodu zadanie zostanie zatrzymane, uruchamiane jest nowe zadanie na tym samym lub innym węźle.
* [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html): Wdraża dokładnie jedno zadanie na każdej aktywnej instancji kontenera, która spełnia wymagania. Nie trzeba określać żądanej liczby zadań, strategii umieszczania zadań ani korzystać z polityk automatycznego skalowania usługi.
* **Definicje zadań** są odpowiedzialne za **określanie, jakie kontenery będą uruchamiane** oraz różne parametry, które zostaną skonfigurowane wraz z kontenerami, takie jak **mapowanie portów** z hostem, **zmienne środowiskowe**, **punkt wejścia** Docker...
* Sprawdź **zmienne środowiskowe w celu znalezienia poufnych informacji**!

### Poufne dane w definicjach zadań

Definicje zadań są odpowiedzialne za **konfigurowanie rzeczywistych kontenerów, które będą uruchamiane w ECS**. Ponieważ definicje zadań określają sposób uruchamiania kontenerów, można w nich znaleźć wiele informacji.

Pacu może wyliczać ECS (list-clusters, list-container-instances, list-services, list-task-definitions), może również wydobywać definicje zadań.

### Wyliczanie
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances --cluster <cluster>
aws ecs describe-container-instances --cluster <cluster> --container-instances <container_instance_arn>

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### Nieuwierzytelniony dostęp

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### Przywileje

Na następnej stronie możesz sprawdzić, jak **wykorzystać uprawnienia ECS do eskalacji przywilejów**:

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### Po eksploatacji

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### Trwałość

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
