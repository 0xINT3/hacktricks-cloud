# AWS - ECS Enum

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**d√©p√¥ts Github HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## ECS

### Informations de base

Amazon **Elastic Container Services** ou ECS fournit une plateforme pour **h√©berger des applications conteneuris√©es dans le cloud**. ECS dispose de deux m√©thodes de **d√©ploiement**, le type d'instance **EC2** et une option **serverless**, **Fargate**. Le service **facilite grandement l'ex√©cution de conteneurs dans le cloud**.

ECS fonctionne √† l'aide des trois blocs de construction suivants : **Clusters**, **Services** et **Task Definitions**.

* Les **Clusters** sont des **groupes de conteneurs** qui s'ex√©cutent dans le cloud. Comme mentionn√© pr√©c√©demment, il existe deux types de lancement pour les conteneurs, EC2 et Fargate. AWS d√©finit le type de lancement **EC2** comme permettant aux clients "d'ex√©cuter leurs applications conteneuris√©es sur un cluster d'instances Amazon EC2 qu'ils **g√®rent**". **Fargate** est similaire et est d√©fini comme "[permettant] d'ex√©cuter vos applications conteneuris√©es **sans avoir besoin de provisionner et de g√©rer** l'infrastructure backend".
* Les **Services** sont cr√©√©s √† l'int√©rieur d'un cluster et sont responsables de **l'ex√©cution des t√¢ches**. Dans une d√©finition de service, **vous d√©finissez le nombre de t√¢ches √† ex√©cuter, l'auto-scaling, le fournisseur de capacit√© (Fargate/EC2/External),** les informations de **r√©seau** telles que les VPC, les sous-r√©seaux et les groupes de s√©curit√©.
  * Il y a **2 types d'applications** :
    * **Service** : Un groupe de t√¢ches g√©rant un travail de calcul de longue dur√©e qui peut √™tre arr√™t√© et red√©marr√©. Par exemple, une application web.
    * **Task** : Une t√¢che autonome qui s'ex√©cute et se termine. Par exemple, un travail en batch.
  * Parmi les applications de service, il y a **2 types de planificateurs de service** :
    * [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html) : La strat√©gie de planification de r√©plica place et **maintient le nombre souhait√©** de t√¢ches dans votre cluster. Si pour une raison quelconque une t√¢che est arr√™t√©e, une nouvelle est lanc√©e dans le m√™me n≈ìud ou dans un n≈ìud diff√©rent.
    * [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html) : D√©ploie exactement une t√¢che sur chaque instance de conteneur active qui a les exigences n√©cessaires. Il n'est pas n√©cessaire de sp√©cifier un nombre souhait√© de t√¢ches, une strat√©gie de placement de t√¢ches ou d'utiliser des politiques de mise √† l'√©chelle automatique de service.
* Les **Task Definitions** sont responsables de **d√©finir les conteneurs qui seront ex√©cut√©s** et les diff√©rents param√®tres qui seront configur√©s avec les conteneurs tels que les **correspondances de port** avec l'h√¥te, les **variables d'environnement**, le **point d'entr√©e** Docker...
  * V√©rifiez les **variables d'environnement pour les informations sensibles** !

### Donn√©es sensibles dans les d√©finitions de t√¢ches

Les d√©finitions de t√¢ches sont responsables de **configurer les conteneurs r√©els qui s'ex√©cuteront dans ECS**. √âtant donn√© que les d√©finitions de t√¢ches d√©finissent la mani√®re dont les conteneurs s'ex√©cuteront, une pl√©thore d'informations peut √™tre trouv√©e √† l'int√©rieur.

Pacu peut √©num√©rer ECS (list-clusters, list-container-instances, list-services, list-task-definitions), il peut √©galement d√©charger les d√©finitions de t√¢ches.

### √ânum√©ration

```bash
# Informations sur les clusters
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Instances de conteneurs
## Une instance de conteneur Amazon ECS est une instance Amazon EC2 qui ex√©cute l'agent de conteneur Amazon ECS et a √©t√© enregistr√©e dans un cluster Amazon ECS.
aws ecs list-container-instances
aws ecs describe-container-instances

# Informations sur les services
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# D√©finitions de t√¢ches
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Recherchez les variables d'environnement et les secrets utilis√©s √† partir de la d√©finition de t√¢che
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```

### Acc√®s non authentifi√©

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

Sur la page suivante, vous pouvez v√©rifier comment **abuser des autorisations ECS pour escalader les privil√®ges** :

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### Post-exploitation

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### Persistance

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**d√©p√¥ts Github HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>