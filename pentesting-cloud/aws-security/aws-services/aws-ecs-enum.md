# AWS - ECS Enum

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もし **HackTricks で会社を宣伝したい**場合や、**PEASS の最新バージョンにアクセスしたい**場合、または **HackTricks を PDF でダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式の PEASS & HackTricks スワッグ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。これは、私たちの独占的な [**NFT**](https://opensea.io/collection/the-peass-family) のコレクションです
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) または [**telegram グループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) をフォローしてください。
* **ハッキングのトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) の GitHub リポジトリに PR を提出してください。

</details>

## ECS

### 基本情報

Amazon **Elastic Container Services**（ECS）は、コンテナ化されたアプリケーションをクラウド上でホストするためのプラットフォームを提供します。ECS には、**EC2** インスタンスタイプと **サーバーレス** オプションである **Fargate** の2つの **デプロイメント** メソッドがあります。このサービスは、クラウドでのコンテナの実行を非常に簡単で痛みのないものにします。

ECS は、次の3つの構成要素を使用して動作します：**クラスタ**、**サービス**、および **タスク定義**。

* **クラスタ** は、クラウドで実行されている **コンテナのグループ** です。前述のように、コンテナの起動タイプには EC2 と Fargate の2つがあります。AWS は、EC2 起動タイプを「Amazon EC2 インスタンスのクラスタ上でコンテナ化されたアプリケーションを実行するためのもの」と定義しています。Fargate も同様で、「バックエンドインフラストラクチャをプロビジョニングおよび管理する必要がないで、コンテナ化されたアプリケーションを実行することができます」と定義されています。
* **サービス** は、クラスタ内に作成され、**タスクの実行** を担当します。サービス定義内では、実行するタスクの数、自動スケーリング、キャパシティプロバイダ（Fargate/EC2/External）、VPC、サブネット、セキュリティグループなどの **ネットワーキング** 情報を定義します。
* **2種類のアプリケーション** があります：
* **サービス**：長時間実行される計算作業を処理するタスクのグループで、停止して再開することができます。例えば、Webアプリケーションです。
* **タスク**：単独のタスクが実行され、終了します。例えば、バッチジョブです。
* サービスアプリケーションの中には、**2種類のサービススケジューラ** があります：
* [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs_services.html)：レプリカスケジューリング戦略は、クラスタ全体にタスクの **所望の数を配置し維持** します。何らかの理由でタスクがシャットダウンした場合、同じノードまたは異なるノードで新しいタスクが起動されます。
* [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs_services.html)：必要な要件を満たすアクティブなコンテナインスタンスごとに正確に1つのタスクをデプロイします。タスクの所望の数、タスク配置戦略、またはサービスオートスケーリングポリシーを指定する必要はありません。
* **タスク定義** は、実行するコンテナを **定義** し、コンテナと関連するさまざまなパラメータ（ホストとのポートマッピング、環境変数、Docker のエントリポイントなど）を設定する責任があります。
* **環境変数には機密情報が含まれている可能性があるので注意してください**！

### タスク定義内の機密データ

タスク定義は、ECS で実行される実際のコンテナの設定を行う責任があります。タスク定義は、コンテナの実行方法を定義するため、多くの情報が含まれている可能性があります。

Pacu は ECS を列挙することができます（list-clusters、list-container-instances、list-services、list-task-definitions）。また、タスク定義をダンプすることもできます。

### 列挙
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances --cluster <cluster>
aws ecs describe-container-instances --cluster <cluster> --container-instances <container_instance_arn>

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### 認証されていないアクセス

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### 特権昇格

以下のページでは、**ECSの権限を悪用して特権を昇格させる方法**を確認できます：

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### 攻撃後の処理

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### 永続化

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もしもあなたの**会社をHackTricksで宣伝したい**場合や、**最新版のPEASSを入手したい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)を手に入れましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私をフォローしましょう 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>
