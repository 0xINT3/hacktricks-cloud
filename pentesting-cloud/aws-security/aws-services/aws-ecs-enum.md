# AWS - ECS 枚举

<details>

<summary><strong>从零到英雄学习AWS黑客技术</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在 **HackTricks中看到您的公司广告** 或 **下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## ECS

### 基本信息

Amazon **Elastic Container Services**（ECS）提供了一个平台，用于**在云中托管容器化应用程序**。ECS有两种**部署**方法，**EC2**实例类型和**无服务器**选项，**Fargate**。该服务**使在云中运行容器变得非常容易且无痛**。

ECS使用以下三个构建块操作：**集群**，**服务**和**任务定义**。

* **集群**是在云中运行的**容器组**。如前所述，容器有两种启动类型，EC2和Fargate。AWS将**EC2**启动类型定义为允许客户“在他们**管理**的Amazon EC2实例集群上运行\[他们的]容器化应用程序”。**Fargate**类似，被定义为“\[允许]您运行容器化应用程序，**无需配置和管理**后端基础设施”。
* **服务**在集群内创建，负责**运行任务**。在服务定义中，**您定义要运行的任务数量，自动扩展，容量提供商（Fargate/EC2/外部），** **网络**信息，如VPC、子网和安全组。
* 有**2种类型的应用程序**：
* **服务**：一组处理长期运行计算工作的任务，可以停止和重新启动。例如，一个Web应用程序。
* **任务**：运行并终止的独立任务。例如，一个批处理作业。
* 在服务应用程序中，有**2种类型的服务调度器**：
* [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html)：复制调度策略在集群中放置并**维护所需数量**的任务。如果由于某种原因任务关闭，将在同一节点或不同节点启动一个新任务。
* [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html)：在每个具有所需条件的活动容器实例上部署一个任务。无需指定所需的任务数量，任务放置策略，或使用服务自动扩展策略。
* **任务定义**负责**定义将运行哪些容器**以及将与容器一起配置的各种参数，如与主机的**端口映射**，**环境变量**，Docker **入口点**...
* 检查**环境变量以获取敏感信息**！

### 任务定义中的敏感数据

任务定义负责**配置将在ECS中运行的实际容器**。由于任务定义定义了容器的运行方式，因此可以在其中找到大量信息。

Pacu可以枚举ECS（list-clusters, list-container-instances, list-services, list-task-definitions），它还可以转储任务定义。

### 枚举
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances --cluster <cluster>
aws ecs describe-container-instances --cluster <cluster> --container-instances <container_instance_arn>

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### 未经认证的访问

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### 权限提升

在以下页面中，您可以检查如何**滥用ECS权限以提升权限**：

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### 后期利用

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### 持久性

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>从零开始学习AWS黑客攻击！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF版本**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在**Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来**分享您的黑客技巧。

</details>
