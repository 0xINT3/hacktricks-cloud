# AWS - ECS 枚举

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## ECS

### 基本信息

Amazon **弹性容器服务**（Elastic Container Services，ECS）提供了一个平台，用于在云中**托管容器化应用程序**。ECS有两种**部署**方法，**EC2**实例类型和**无服务器**选项，**Fargate**。该服务**使在云中运行容器变得非常简单和无痛**。

ECS使用以下三个构建块运作：**集群**（Clusters）、**服务**（Services）和**任务定义**（Task Definitions）。

* **集群**是在云中运行的**容器组**。如前所述，容器有两种启动类型，EC2和Fargate。AWS将**EC2**启动类型定义为允许客户“在一组由\[他们] **管理**的Amazon EC2实例上运行\[他们]的容器化应用程序”。**Fargate**类似，被定义为“\[允许]您在无需提供和管理后端基础设施的情况下运行您的容器化应用程序”。
* **服务**是在集群内创建的，负责**运行任务**。在服务定义中，**您定义要运行的任务数量、自动扩展、容量提供者（Fargate/EC2/外部）**，以及**网络**信息，如VPC、子网和安全组。
* 有**2种应用程序类型**：
  * **服务**：处理长时间运行的计算工作的一组任务，可以停止和重新启动。例如，Web应用程序。
  * **任务**：运行并终止的独立任务。例如，批处理作业。
* 在服务应用程序中，有**2种服务调度程序类型**：
  * [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html)：复制调度策略在集群中放置并**维护所需数量**的任务。如果由于某种原因任务关闭，将在相同或不同节点上启动一个新任务。
  * [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html)：在具有所需要求的每个活动容器实例上部署一个任务。无需指定任务数量、任务放置策略或使用服务自动扩展策略。
* **任务定义**负责**定义将要运行的容器**以及将与容器配置的各种参数，如与主机的**端口映射**、**环境变量**、Docker **入口点**等。
* 检查**任务定义中的敏感信息的环境变量**！

### 任务定义中的敏感数据

任务定义负责**配置将在ECS中运行的实际容器**。由于任务定义定义了容器的运行方式，因此其中可能包含大量信息。

Pacu可以枚举ECS（列出集群、列出容器实例、列出服务、列出任务定义），还可以转储任务定义。

### 枚举
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances --cluster <cluster>
aws ecs describe-container-instances --cluster <cluster> --container-instances <container_instance_arn>

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### 未经身份验证的访问

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### 提权

在下面的页面中，您可以查看如何**滥用 ECS 权限以提升特权**：

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### 漏洞利用后

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### 持久性

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 HackTricks 中看到您的**公司广告**或**下载 PDF 版本的 HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 探索[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**电报群组**](https://t.me/peass) 或在 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live) 上**关注**我们。
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享您的黑客技巧**。

</details>
