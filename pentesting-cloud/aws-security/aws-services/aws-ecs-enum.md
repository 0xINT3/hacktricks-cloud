# AWS - ECS枚举

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向**[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## ECS

### 基本信息

Amazon **弹性容器服务**（Elastic Container Services，ECS）提供了一个在云中托管容器化应用程序的平台。ECS有两种**部署**方法，**EC2**实例类型和**无服务器**选项**Fargate**。该服务使得在云中运行容器非常简单和无痛。

ECS使用以下三个构建块进行操作：**集群**（Clusters）、**服务**（Services）和**任务定义**（Task Definitions）。

* **集群**是在云中运行的**容器组**。如前所述，容器有两种启动类型，EC2和Fargate。AWS将**EC2**启动类型定义为允许客户“在一组Amazon EC2实例的集群上运行\[他们的]容器化应用程序，\[他们]进行管理”。**Fargate**类似，并被定义为“允许您在无需预配和管理后端基础设施的情况下运行容器化应用程序”。
* **服务**是在集群内创建的，负责**运行任务**。在服务定义中，您可以定义要运行的任务数量、自动缩放、容量提供者（Fargate/EC2/External）、网络信息（如VPC、子网和安全组）等**网络**信息。
* 有**2种类型的应用程序**：
* **服务**：处理长时间运行的计算工作的一组任务，可以停止和重新启动。例如，一个Web应用程序。
* **任务**：独立运行和终止的任务。例如，一个批处理作业。
* 在服务应用程序中，有**2种类型的服务调度器**：
* [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html)：复制调度策略将所需数量的任务放置和**维护**在集群中。如果由于某种原因任务关闭，将在相同或不同的节点上启动一个新任务。
* [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html)：在每个具有所需要求的活动容器实例上部署一个任务。无需指定任务数量、任务放置策略或使用服务自动缩放策略。
* **任务定义**负责**定义将要运行的容器**以及与容器配置的各种参数，例如与主机的**端口映射**、**环境变量**、Docker的**入口点**等。
* 检查**环境变量中的敏感信息**！

### 任务定义中的敏感数据

任务定义负责**配置在ECS中运行的实际容器**。由于任务定义定义了容器的运行方式，其中包含大量的信息。

Pacu可以枚举ECS（list-clusters、list-container-instances、list-services、list-task-definitions），还可以转储任务定义。

### 枚举
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances
aws ecs describe-container-instances

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### 未经身份验证的访问

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### 特权升级

您可以在以下页面中查看如何**滥用 ECS 权限以提升特权**：

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### 漏洞利用后

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### 持久化

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的**公司广告**，或者如果您想访问**PEASS 的最新版本或下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>
