# AWS - ECS Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>

## ECS

### 基本情報

Amazon **Elastic Container Services**（ECS）は、クラウドで**コンテナ化されたアプリケーションをホストするプラットフォーム**を提供します。ECSには、**EC2**インスタンスタイプと**サーバーレス**オプションの**Fargate**という2つの**デプロイ**方法があります。このサービスは、クラウドでのコンテナの実行を非常に簡単で苦痛のないものにします。

ECSは、次の3つの構成要素を使用して運用されます：**クラスター**、**サービス**、および**タスク定義**。

* **クラスター**は、クラウドで実行されている**コンテナのグループ**です。前述のように、コンテナにはEC2とFargateの2つの起動タイプがあります。AWSは**EC2**起動タイプを「お客様が\[自分たちの\]コンテナ化されたアプリケーションを\[自分たちで\] **管理**するAmazon EC2インスタンスのクラスター上で実行することを可能にする」と定義しています。**Fargate**は似ており、「バックエンドインフラストラクチャのプロビジョニングと管理**する必要なく**、コンテナ化されたアプリケーションを実行することを\[可能にする\]」と定義されています。
* **サービス**はクラスター内に作成され、**タスクの実行**を担当します。サービス定義内では、実行するタスクの数、オートスケーリング、キャパシティプロバイダ（Fargate/EC2/External）、VPC、サブネット、セキュリティグループなどの**ネットワーキング**情報を定義します。
* **2種類のアプリケーション**があります：
* **サービス**：長時間実行されるコンピューティング作業を処理するタスクのグループで、停止して再開することができます。例えば、ウェブアプリケーション。
* **タスク**：実行されて終了するスタンドアロンのタスク。例えば、バッチジョブ。
* サービスアプリケーションの中には、**2種類のサービススケジューラー**があります：
* [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html)：レプリカスケジューリング戦略は、クラスター全体にわたって**所望の数**のタスクを配置し、維持します。何らかの理由でタスクがシャットダウンした場合、同じまたは異なるノードに新しいタスクが起動されます。
* [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html)：必要な要件を持つ各アクティブなコンテナインスタンス上に正確に1つのタスクをデプロイします。所望のタスク数を指定したり、タスク配置戦略を使用したり、サービスオートスケーリングポリシーを使用する必要はありません。
* **タスク定義**は、**実行されるコンテナを定義**し、ホストとの**ポートマッピング**、**環境変数**、Docker **エントリポイント**など、コンテナに設定されるさまざまなパラメータを担当します。
* **環境変数から機密情報をチェック**してください！

### タスク定義における機密データ

タスク定義は、ECSで実行される実際のコンテナを**設定する責任**があります。タスク定義はコンテナの実行方法を定義するため、多くの情報が内部に見つかる可能性があります。

PacuはECSを列挙することができます（list-clusters, list-container-instances, list-services, list-task-definitions）、また、タスク定義をダンプすることもできます。

### 列挙
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances --cluster <cluster>
aws ecs describe-container-instances --cluster <cluster> --container-instances <container_instance_arn>

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### 認証されていないアクセス

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### 権限昇格

以下のページでは、**ECSの権限を悪用して権限を昇格させる方法**について確認できます：

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### 攻撃後の活動

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### 持続性

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)で<strong>ゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックしてください。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォロー**してください。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有してください**。

</details>
