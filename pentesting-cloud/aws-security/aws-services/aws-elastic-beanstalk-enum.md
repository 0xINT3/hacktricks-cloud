# AWS - Elastic Beanstalk Enum

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Elastic Beanstalk

Amazon Elastic Beanstalk dostarcza uproszczoną platformę do **wdrożenia, zarządzania i skalowania aplikacji internetowych i usług**. Obsługuje wiele języków programowania i frameworków, takich jak Java, .NET, PHP, Node.js, Python, Ruby i Go, a także kontenery Docker. Usługa jest kompatybilna z powszechnie używanymi serwerami, takimi jak Apache, Nginx, Passenger i IIS.

Elastic Beanstalk zapewnia prosty i elastyczny sposób na **wdrożenie aplikacji w chmurze AWS**, bez konieczności martwienia się o infrastrukturę. Automatycznie obsługuje szczegóły dotyczące **provisioningu** pojemności, **balanceowania obciążenia**, **skalowania** i **monitorowania zdrowia aplikacji**, pozwalając skupić się na pisaniu i wdrażaniu kodu.

Infrastrukturę tworzoną przez Elastic Beanstalk zarządza grupy **Autoscaling** w **EC2** (z load balancerem). Oznacza to, że jeśli **skompromitujesz hosta**, powinieneś wiedzieć o EC2:

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

Ponadto, jeśli używany jest Docker, można użyć **ECS**.

{% content-ref url="../../aws-security/aws-services/aws-eks-enum.md" %}
[aws-eks-enum.md](../../aws-security/aws-services/aws-eks-enum.md)
{% endcontent-ref %}

### Aplikacja i środowiska

W Elastic Beanstalk AWS, pojęcia "aplikacja" i "środowisko" pełnią różne funkcje i mają różne role w procesie wdrażania.

#### Aplikacja

* Aplikacja w Elastic Beanstalk to **logiczny kontener dla kodu źródłowego aplikacji, środowisk i konfiguracji**. Grupuje różne wersje kodu aplikacji i umożliwia zarządzanie nimi jako jednostką.
* Tworząc aplikację, podajesz nazwę i opis, ale w tym momencie **nie są tworzone żadne zasoby**. Jest to po prostu sposób organizacji i zarządzania kodem i powiązanymi zasobami.
* Możesz mieć **wiele wersji aplikacji** w ramach jednej aplikacji. Każda wersja odpowiada określonemu wydaniu kodu, które można wdrożyć w jednym lub wielu środowiskach.

#### Środowisko

* Środowisko to **uruchomiona instancja Twojej aplikacji** działająca na infrastrukturze AWS. To tutaj kod aplikacji jest wdrażany i wykonywany. Elastic Beanstalk dostarcza niezbędne zasoby (np. instancje EC2, load balancery, grupy auto-scaling, bazy danych) na podstawie konfiguracji środowiska.
* **Każde środowisko uruchamia jedną wersję Twojej aplikacji**, a możesz mieć wiele środowisk o różnych celach, takich jak rozwój, testowanie, staging i produkcja.
* Tworząc środowisko, wybierasz platformę (np. Java, .NET, Node.js itp.) i typ środowiska (np. serwer WWW lub pracownik). Możesz również dostosować konfigurację środowiska, aby kontrolować różne aspekty infrastruktury i ustawienia aplikacji.

### 2 rodzaje środowisk

1. **Środowisko serwera WWW**: Jest przeznaczone do **hostowania i obsługi aplikacji internetowych i interfejsów API**. Te aplikacje zazwyczaj obsługują przychodzące żądania HTTP/HTTPS. Środowisko serwera WWW dostarcza zasoby takie jak **instancje EC2, load balancery i grupy auto-scaling**, aby obsługiwać ruch przychodzący, zarządzać pojemnością i zapewnić wysoką dostępność aplikacji.
2. **Środowisko pracownika**: Jest przeznaczone do przetwarzania **zadań w tle**, które są często czasochłonnymi lub wymagającymi dużych zasobów operacjami, które nie wymagają natychmiastowych odpowiedzi dla klientów. Środowisko pracownika dostarcza zasoby takie jak **instancje EC2 i grupy auto-scaling**, ale **nie ma load balancera**, ponieważ nie obsługuje bezpośrednio żądań HTTP/HTTPS. Zamiast tego pobiera zadania z kolejki **Amazon Simple Queue Service (SQS)**, która działa jako bufor między środowiskiem pracownika a przetwarzanymi zadaniami.

### Bezpieczeństwo

Tworząc aplikację w Beanstalk, istnieją 3 bardzo ważne opcje związane z bezpieczeństwem do wyboru:

* **Para kluczy EC2**: Będzie to **klucz SSH**, który będzie mógł uzyskać dostęp do instancji EC2 uruchamiających aplikację.
* **Profil instancji IAM**: Jest to **profil instancji**, który będą miały instancje (uprawnienia IAM).
* Wygenerowana automatycznie rola nosi nazwę **`aws-elasticbeanstalk-ec2-role`** i ma pewne interesujące uprawnienia dotyczące wszystkich ECS, wszystkich SQS, DynamoDB elasticbeanstalk i elasticbeanstalk S3, korzystając z zarządzanych przez AWS polityk: [AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier), [AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker), [AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier).
* **Rola usługi**: Jest to **rola, którą usługa AWS** będzie używać do wykonywania wszystkich niezbędnych działań. O ile mi wiadomo, zwykły użytkownik AWS nie może uzyskać dostępu do tej roli.
* Rola ta wygenerowana przez AWS nosi nazwę **`aws-elasticbeanstalk-service-role`** i korzysta z zarządzanych przez AWS polityk [AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth) i [AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)

Domyślnie **wersja metadanych 1 jest wyłączona**:

<figure><img src="../../../.gitbook/assets/image (18) (1) (2).png" alt=""><figcaption></figcaption></figure>
### Narażenie

Dane Beanstalk są przechowywane w **wiadrze S3** o następującej nazwie: **`elasticbeanstalk-<region>-<acc-id>`** (jeśli zostało utworzone w konsoli AWS). Wewnątrz tego wiadra znajduje się **załadowany kod źródłowy aplikacji**.

**URL** utworzonej strony internetowej to **`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**

{% hint style="warning" %}
Jeśli uzyskasz **dostęp do odczytu** do wiadra, będziesz mógł **odczytać kod źródłowy** i nawet znaleźć na nim **wrażliwe dane uwierzytelniające**.

Jeśli uzyskasz **dostęp do zapisu** do wiadra, będziesz mógł **modyfikować kod źródłowy**, aby **naruszyć** rolę IAM, którą aplikacja będzie używać przy następnym uruchomieniu.
{% endhint %}

### Wyliczanie

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
{% endcode %}

### Nieuwierzytelniony dostęp

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### Trwałość

{% content-ref url="../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### Przywileje

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### Po eksploatacji

{% content-ref url="../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi trikami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
