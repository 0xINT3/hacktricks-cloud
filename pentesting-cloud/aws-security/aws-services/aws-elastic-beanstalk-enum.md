# AWS - Enumerazione di Elastic Beanstalk

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di github.

</details>

## Elastic Beanstalk

Amazon Elastic Beanstalk fornisce una piattaforma semplificata per **deployare, gestire e scalare applicazioni web e servizi**. Supporta una variet√† di linguaggi di programmazione e framework, come Java, .NET, PHP, Node.js, Python, Ruby e Go, oltre a contenitori Docker. Il servizio √® compatibile con server ampiamente utilizzati, tra cui Apache, Nginx, Passenger e IIS.

Elastic Beanstalk fornisce un modo semplice e flessibile per **deployare le tue applicazioni nel cloud AWS**, senza la necessit√† di preoccuparti dell'infrastruttura sottostante. Gestisce automaticamente i dettagli della **provisioning** della capacit√†, del **bilanciamento del carico**, dello **scaling** e del monitoraggio della salute dell'applicazione, consentendoti di concentrarti sulla scrittura e sul deploy del tuo codice.

L'infrastruttura creata da Elastic Beanstalk √® gestita da gruppi di **Autoscaling** in **EC2** (con un bilanciatore di carico). Ci√≤ significa che alla fine della giornata, se **comprometti l'host**, dovresti conoscere EC2:

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

Inoltre, se viene utilizzato Docker, √® possibile utilizzare **ECS**.

{% content-ref url="../../aws-security/aws-services/aws-eks-enum.md" %}
[aws-eks-enum.md](../../aws-security/aws-services/aws-eks-enum.md)
{% endcontent-ref %}

### Applicazione ed Environments

In AWS Elastic Beanstalk, i concetti di "applicazione" e "environment" hanno scopi diversi e ruoli distinti nel processo di deploy.

#### Applicazione

* Un'applicazione in Elastic Beanstalk √® un **contenitore logico per il codice sorgente, gli ambienti e le configurazioni** della tua applicazione. Raggruppa diverse versioni del codice della tua applicazione e ti consente di gestirle come un'entit√† singola.
* Quando crei un'applicazione, fornisci un nome e una descrizione, ma in questa fase **non vengono provisionate risorse**. √à semplicemente un modo per organizzare e gestire il tuo codice e le risorse correlate.
* Puoi avere **pi√π versioni dell'applicazione** all'interno di un'applicazione. Ogni versione corrisponde a un rilascio specifico del tuo codice, che pu√≤ essere deployato su uno o pi√π ambienti.

#### Environment

* Un environment √® un'**istanza provisionata della tua applicazione** in esecuzione su infrastruttura AWS. √à **dove il tuo codice dell'applicazione viene deployato ed eseguito**. Elastic Beanstalk provvede alle risorse necessarie (ad esempio, istanze EC2, bilanciatori di carico, gruppi di autoscaling, database) in base alla configurazione dell'ambiente.
* **Ogni ambiente esegue una singola versione della tua applicazione**, e puoi avere pi√π ambienti per scopi diversi, come sviluppo, testing, staging e produzione.
* Quando crei un ambiente, scegli una piattaforma (ad esempio, Java, .NET, Node.js, ecc.) e un tipo di ambiente (ad esempio, server web o worker). Puoi anche personalizzare la configurazione dell'ambiente per controllare vari aspetti dell'infrastruttura e delle impostazioni dell'applicazione.

### 2 tipi di Environments

1. **Ambiente server web**: √à progettato per **ospitare e servire applicazioni web e API**. Queste applicazioni gestiscono tipicamente le richieste HTTP/HTTPS in ingresso. L'ambiente server web provvede alle risorse come **istanze EC2, bilanciatori di carico e gruppi di autoscaling** per gestire il traffico in ingresso, gestire la capacit√† e garantire l'alta disponibilit√† dell'applicazione.
2. **Ambiente worker**: √à progettato per elaborare **attivit√† in background**, che sono spesso operazioni che richiedono molto tempo o risorse e non richiedono risposte immediate ai client. L'ambiente worker provvede alle risorse come **istanze EC2 e gruppi di autoscaling**, ma **non ha un bilanciatore di carico** poich√© non gestisce direttamente le richieste HTTP/HTTPS. Invece, consuma attivit√† da una **coda di servizio di messaggistica semplice di Amazon (SQS)**, che funge da buffer tra l'ambiente worker e le attivit√† che elabora.

### Sicurezza

Durante la creazione di un'app in Beanstalk ci sono 3 opzioni di sicurezza molto importanti da scegliere:

* **Coppia di chiavi EC2**: Questa sar√† la **chiave SSH** che potr√† accedere alle istanze EC2 in esecuzione dell'app
* **Profilo istanza IAM**: Questo √® il **profilo istanza** che avranno le istanze (**privilegi IAM**)
* Il ruolo generato automaticamente si chiama **`aws-elasticbeanstalk-ec2-role`** e ha alcuni accessi interessanti su tutti ECS, tutti SQS, DynamoDB elasticbeanstalk ed elasticbeanstalk S3 utilizzando le politiche gestite da AWS: [AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier), [AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker), [AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier).
* **Ruolo di servizio**: Questo √® il **ruolo che il servizio AWS** utilizzer√† per eseguire tutte le azioni necessarie. A quanto ne so, un utente AWS normale non pu√≤ accedere a quel ruolo.
* Questo ruolo generato da AWS si chiama **`aws-elasticbeanstalk-service-role`** e utilizza le politiche gestite da AWS [AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth) e [AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)

Per impostazione predefinita, **la versione dei metadati 1 √® disabilitata**:

<figure><img src="../../../.gitbook/assets/image (18) (1) (2).png" alt=""><figcaption></figcaption></figure>
### Esposizione

I dati di Beanstalk vengono archiviati in un **bucket S3** con il seguente nome: **`elasticbeanstalk-<region>-<acc-id>`** (se √® stato creato nella console AWS). All'interno di questo bucket troverai il **codice sorgente dell'applicazione** caricato.

L'**URL** della pagina web creata √® **`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**

{% hint style="warning" %}
Se ottieni **accesso in lettura** al bucket, puoi **leggere il codice sorgente** e persino trovare **credenziali sensibili** al suo interno.

Se ottieni **accesso in scrittura** al bucket, potresti **modificare il codice sorgente** per **compromettere** il **ruolo IAM** che l'applicazione utilizzer√† la prossima volta che verr√† eseguita.
{% endhint %}

### Enumerazione

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
{% endcode %}

### Accesso non autenticato

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### Persistenza

{% content-ref url="../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
