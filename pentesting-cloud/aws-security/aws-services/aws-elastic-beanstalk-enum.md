# AWS - Elastic Beanstalk Enum

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[NFTs收藏](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## Elastic Beanstalk

Amazon Elastic Beanstalk提供了一个简化的平台，用于**部署、管理和扩展Web应用程序和服务**。它支持各种编程语言和框架，如Java、.NET、PHP、Node.js、Python、Ruby和Go，以及Docker容器。该服务与包括Apache、Nginx、Passenger和IIS在内的广泛使用的服务器兼容。

Elastic Beanstalk提供了一种简单灵活的方式，**将您的应用程序部署到AWS云**，无需担心底层基础设施。它**自动**处理容量**预配**、负载**平衡**、**扩展**和应用程序健康**监控**的细节，让您可以专注于编写和部署代码。

Elastic Beanstalk创建的基础设施由**EC2**中的**自动扩展**组管理（带有负载均衡器）。这意味着，如果您**入侵主机**，您应该了解有关EC2的信息：

{% content-ref url="aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

此外，如果使用Docker，可以使用**ECS**。

{% content-ref url="aws-eks-enum.md" %}
[aws-eks-enum.md](aws-eks-enum.md)
{% endcontent-ref %}

### 应用程序和环境

在AWS Elastic Beanstalk中，"应用程序"和"环境"的概念在部署过程中具有不同的目的，并在其中扮演着不同的角色。

#### 应用程序

* Elastic Beanstalk中的应用程序是一个**逻辑容器，用于存储应用程序的源代码、环境和配置**。它将不同版本的应用程序代码组合在一起，并允许您将它们作为单个实体进行管理。
* 创建应用程序时，您提供名称和描述**，但此阶段不会预配任何资源**。这只是一种组织和管理代码及相关资源的方式。
* 您可以在一个应用程序中拥有**多个应用程序版本**。每个版本对应于代码的特定发布，可以部署到一个或多个环境中。

#### 环境

* 环境是在AWS基础设施上运行的**应用程序的预配实例**。它是**部署和执行应用程序代码的地方**。Elastic Beanstalk根据环境配置预配必要的资源（例如EC2实例、负载均衡器、自动扩展组、数据库）。
* **每个环境运行一个应用程序版本**，您可以为不同目的创建多个环境，如开发、测试、暂存和生产。
* 创建环境时，您选择一个平台（例如Java、.NET、Node.js等）和一个环境类型（例如Web服务器或工作程序）。您还可以自定义环境配置，以控制基础设施和应用程序设置的各个方面。

### 两种类型的环境

1. **Web服务器环境**：旨在**托管和提供Web应用程序和API**。这些应用程序通常处理传入的HTTP/HTTPS请求。Web服务器环境预配资源，如**EC2实例、负载均衡器和自动扩展**组，以处理传入流量，管理容量，并确保应用程序高可用性。
2. **工作程序环境**：旨在处理**后台任务**，这些任务通常是耗时或资源密集型操作，不需要立即响应客户端。工作程序环境预配资源，如**EC2实例和自动扩展组**，但**没有负载均衡器**，因为它不直接处理HTTP/HTTPS请求。相反，它从**Amazon Simple Queue Service (SQS)队列**中获取任务，该队列充当工作程序环境和其处理的任务之间的缓冲区。

### 安全性

在Beanstalk中创建应用程序时，有3个非常重要的安全选项可供选择：

* **EC2密钥对**：这将是能够访问运行应用程序的EC2实例的**SSH密钥**
* **IAM实例配置文件**：这是实例将拥有的**实例配置文件**（**IAM权限**）
* 自动生成的角色称为**`aws-elasticbeanstalk-ec2-role`**，具有对所有ECS、所有SQS、DynamoDB、elasticbeanstalk和elasticbeanstalk S3的一些有趣访问权限，使用AWS托管策略：[AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier)、[AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker)、[AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier)。
* **服务角色**：这是AWS服务将用于执行所有所需操作的**角色**。据我所知，普通AWS用户无法访问该角色。
* AWS生成的此角色称为**`aws-elasticbeanstalk-service-role`**，使用AWS托管策略[AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth)和[AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)

默认情况下**禁用元数据版本1**：

<figure><img src="../../../.gitbook/assets/image (103).png" alt=""><figcaption></figcaption></figure>
### 暴露

Beanstalk 数据存储在一个名为 **`elasticbeanstalk-<region>-<acc-id>`** 的 **S3 存储桶**中（如果是在 AWS 控制台中创建的）。在这个存储桶中，您将找到应用程序的 **源代码**。

创建的网页的 **URL** 是 **`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**

{% hint style="warning" %}
如果您获得了对存储桶的 **读取权限**，您可以 **读取源代码**，甚至找到其中的 **敏感凭证**

如果您获得了对存储桶的 **写入权限**，您可以 **修改源代码** 以 **危害** 应用程序下次执行时使用的 **IAM 角色**。
{% endhint %}

### 枚举

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
### 未经身份验证的访问

{% content-ref url="../aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### 持久性

{% content-ref url="../aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### 提权

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### 漏洞利用后

{% content-ref url="../aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>从零开始学习AWS黑客技术</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

其他支持HackTricks的方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
