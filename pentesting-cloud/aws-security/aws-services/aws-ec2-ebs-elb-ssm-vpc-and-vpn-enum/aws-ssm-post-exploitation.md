# AWS - SSM рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**рдж рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **рдореБрдЭреЗ** рдЯреНрд╡рд┐рдЯрд░ рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PR рдЬрдорд╛ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## MitM SSM

### EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рднреЗрдЬреЗ рдЧрдП SSM рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ MitM рдХрд░реЗрдВ <a href="#intercept-ec2-messages" id="intercept-ec2-messages"></a>

**EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ IAM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ**, рдЖрдк SSM рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рд╡рдЬрд╣ рд╕реЗ EC2 рд╕рдВрджреЗрд╢ рдФрд░ SSM рд╕рддреНрд░реЛрдВ рдХреЛ MitM рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

[**SSM рдПрдЬреЗрдВрдЯ**](https://github.com/aws/amazon-ssm-agent) рд╕рддрдд рд░реВрдк рд╕реЗ **`ec2messages:GetMessages`** рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ **20 рд╕реЗрдХрдВрдб** рддрдХ **рдХрдиреЗрдХреНрд╢рди рдЦреЛрд▓реЗ рд░рдЦрддрд╛ рд╣реИ**ред рдпрджрд┐ рдХреЛрдИ рд╕рдВрджреЗрд╢ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕реЗ [**`ssm:SendCommand`**](https://docs.aws.amazon.com/cli/latest/reference/ssm/send-command.html) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рддреЛ рдпрд╣ рдЦреБрд▓реЗ рдХрдиреЗрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред

рдПрдХ **рд╣рдорд▓рд╛рд╡рд░** рдЕрдзрд┐рдХ рдЖрд╕рд╛рдиреА рд╕реЗ EC2 рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ **`ec2messages:GetMessages`** рдХреЙрд▓ рдХрд░рдХреЗ MitM рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ [**рдкреНрд░рдорд╛рдг**](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-document-interception) рдЗрд╕рдХрд╛ рдЙрджрд╛рд╣рд░рдг рджреЗрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрди рд░рд╣рд╛ рд╣реИред рд╣рдорд▓рд╛рд╡рд░ рднреА рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдЕрдкрдиреА рдкрд╕рдВрдж рдХреЗ рдЕрдиреБрд╕рд╛рд░ **рдХрд┐рд╕реА рднреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИред

рд╣рдорд▓рд╛рд╡рд░ рднреА рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдЕрдкрдиреА рдкрд╕рдВрдж рдХреЗ рдЕрдиреБрд╕рд╛рд░ **рдХрд┐рд╕реА рднреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИред

### MitM SSM рд╕рддреНрд░ рд╕рдВрджреЗрд╢

рдпрд╣ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХрдИ WebSocket рдХрдиреЗрдХреНрд╢рди рдФрд░ рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдмрд╛рдЗрдирд░реА рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИред **SSM рдПрдЬреЗрдВрдЯ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реА**, рд╡рд╣ AWS рдХреЗ рд╕рд╛рде рдПрдХ **WebSocket** рдХрдиреЗрдХреНрд╢рди **рдмрдирд╛рддрд╛ рд╣реИ**ред рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ SSM рд╕рддреНрд░ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ ([ssm:StartSession](https://docs.aws.amazon.com/cli/latest/reference/ssm/start-session.html)), рддреЛ **рдирд┐рдпрдВрддреНрд░рдг рдЪреИрдирд▓** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдбреЗрдЯрд╛ рдЪреИрдирд▓ **рдЖрд░рдВрдн** рдХрд░рддрд╛ рд╣реИред

SSM рдПрдЬреЗрдВрдЯ рдХрд╛ рд╕реНрд░реЛрдд рдХреЛрдб, рдпрд╣рд╛рдВ рдЙрдкрд▓рдмреНрдз [рд╣реИ](https://github.com/aws/amazon-ssm-agent), рдЗрд╕реЗ [рдЗрд╕](https://github.com/aws/amazon-ssm-agent/blob/21c85d674bbb44dd13cd8738d1b9d86658a6b18e/agent/session/contracts/agentmessage.go#L73) рддрд░рд╣ рдХреЗ рдмрд╛рдЗрдирд░реА рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╕рдВрджреЗрд╢ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

**SSM рд╕рддреНрд░реЛрдВ рдХреЛ MitM рдХрд░рдирд╛ EC2 рд╕рдВрджреЗрд╢реЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИ**, рдХреНрдпреЛрдВрдХрд┐ **рдирд┐рдпрдВрддреНрд░рдг рдЪреИрдирд▓ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдЬреАрд╡рд┐рдд рд░рд╣рддреЗ рд╣реИрдВ** рдФрд░ AWS рдХреЗрд╡рд▓ **рдирд╡реАрдирддрдо рдЪреИрдирд▓** рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рддрд╛ рд╣реИред рдпрд╣ [рдкреНрд░рдорд╛рдг](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-session-interception) рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдирд┐рдпрдВрддреНрд░рдг рдЪреИрдирд▓ рдмрдирд╛рдиреЗ рдФрд░ рд╕рддреНрд░ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреИрд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдПред

рджреБрд░реБрдкрдпреЛрдЧ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, **SSM рд╕рддреНрд░реЛрдВ рдХреЛ MitM рдХрд░рдирд╛ EC2 рд╕рдВрджреЗрд╢реЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИ**ред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ **рдирд┐рдпрдВрддреНрд░рдг рдЪреИрдирд▓ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдЬреАрд╡рд┐рдд рд░рд╣рддреЗ рд╣реИрдВ**, рдФрд░ EC2 рд╕рдВрджреЗрд╢реЛрдВ рдХреА рддрд░рд╣ AWS рдХреЗрд╡рд▓ **рдирд╡реАрдирддрдо рдЪреИрдирд▓** рдХреЗ рд╕рд╛рде рд╣реА рд╕рдВрд╡рд╛рдж рдХрд░реЗрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдирд┐рдпрдВрддреНрд░рдг рдЪреИрдирд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдиреЗ рд╡рд╛рд▓реЗ рд╕рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рд╕реБрди рд╕рдХрддреЗ рд╣реИрдВред SSM рдПрдЬреЗрдВрдЯ рдХреЗ рд╕реНрд░реЛрдд рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдо рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдмрд╛рдЗрдирд░реА рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ (рдпрджрд┐ рдЖрдк [рдкреНрд░рдорд╛рдг](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-session-interception) рдХреЛ рджреЗрдЦреЗрдВ, рддреЛ рдЖрдкрдХреЛ рдзреНрдпрд╛рди рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдореИрдВрдиреЗ рдЕрдХреНрд╕рд░ рдмрд╕ рдЧреЛ рдХреЛ рдкрд╛рдпрдерди рдореЗрдВ рдЕрдиреБрд╡рд╛рдж рдХрд┐рдпрд╛ рд╣реИ), рдФрд░ рд╕рддреНрд░ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЖрджреЗрд╢ (**рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА**) рдЪреЛрд░реА рдХ
