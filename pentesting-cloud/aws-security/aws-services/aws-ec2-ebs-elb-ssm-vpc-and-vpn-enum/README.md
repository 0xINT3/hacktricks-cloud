# AWS - EC2, EBS, ELB, SSM, VPC & VPN Enum

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## VPC & R√©seau

Apprenez ce qu'est un VPC et ses composants dans :

{% content-ref url="../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md" %}
[aws-vpc-and-networking-basic-information.md](../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md)
{% endcontent-ref %}

## EC2

Vous pouvez utiliser Amazon EC2 pour lancer des **serveurs virtuels**, configurer la **s√©curit√©** et le **r√©seau**, et g√©rer le **stockage**. Amazon EC2 vous permet de faire √©voluer vos ressources en fonction des besoins ou des pics de popularit√©, r√©duisant ainsi votre besoin de pr√©voir le trafic.

Choses int√©ressantes √† √©num√©rer dans EC2 :

* Machines virtuelles
* Cl√©s SSH
* Donn√©es utilisateur
* EC2s/AMIs/Snapshots existants
* R√©seau
* R√©seaux
* Sous-r√©seaux
* Adresses IP publiques
* Ports ouverts
* Connexions int√©gr√©es avec d'autres r√©seaux en dehors d'AWS

### Profils d'instance

L'utilisation de **r√¥les** pour accorder des autorisations aux applications s'ex√©cutant sur des **instances EC2** n√©cessite une configuration suppl√©mentaire. Une application s'ex√©cutant sur une instance EC2 est abstraite d'AWS par le syst√®me d'exploitation virtualis√©. En raison de cette s√©paration suppl√©mentaire, vous avez besoin d'une √©tape suppl√©mentaire pour attribuer un r√¥le AWS et ses autorisations associ√©es √† une instance EC2 et les rendre disponibles pour ses applications.

Cette √©tape suppl√©mentaire consiste en la **cr√©ation d'un** [_**profil d'instance**_](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_use\_switch-role-ec2\_instance-profiles.html) attach√© √† l'instance. Le **profil d'instance contient le r√¥le et** peut fournir les informations d'identification temporaires du r√¥le √† une application s'ex√©cutant sur l'instance. Ces informations d'identification temporaires peuvent ensuite √™tre utilis√©es dans les appels API de l'application pour acc√©der aux ressources et limiter l'acc√®s uniquement aux ressources sp√©cifi√©es par le r√¥le. Notez que **seul un r√¥le peut √™tre attribu√© √† une instance EC2** √† la fois, et toutes les applications sur l'instance partagent le m√™me r√¥le et les m√™mes autorisations.

### Point de terminaison des m√©tadonn√©es

Les m√©tadonn√©es AWS EC2 sont des informations sur une instance Amazon Elastic Compute Cloud (EC2) disponibles pour l'instance en cours d'ex√©cution. Ces m√©tadonn√©es sont utilis√©es pour fournir des informations sur l'instance, telles que son ID d'instance, la zone de disponibilit√© dans laquelle elle s'ex√©cute, le r√¥le IAM associ√© √† l'instance et le nom d'h√¥te de l'instance.

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### √ânum√©ration
```bash
# Get EC2 instances
aws ec2 describe-instances
aws ec2 describe-instance-status #Get status from running instances

# Get user data from each ec2 instance
for instanceid in $(aws ec2 describe-instances --profile <profile> --region us-west-2 | grep -Eo '"i-[a-zA-Z0-9]+' | tr -d '"'); do
echo "Instance ID: $instanceid"
aws ec2 describe-instance-attribute --profile <profile> --region us-west-2 --instance-id "$instanceid" --attribute userData | jq ".UserData.Value" | tr -d '"' | base64 -d
echo ""
echo "-------------------"
done

# Instance profiles
aws iam list-instance-profiles
aws iam list-instance-profiles-for-role --role-name <name>

# Get tags
aws ec2 describe-tags

# Get volumes
aws ec2 describe-volume-status
aws ec2 describe-volumes

# Get snapshots
aws ec2 describe-snapshots --owner-ids self

# Scheduled instances
aws ec2 describe-scheduled-instances

# Get custom images
aws ec2 describe-images --owners self

# Get Elastic IPs
aws ec2 describe-addresses

# Get current output
aws ec2 get-console-output --instance-id [id]

# Get VPN customer gateways
aws ec2 describe-customer-gateways
aws ec2 describe-vpn-gateways
aws ec2 describe-vpn-connections

# List conversion tasks to upload/download VMs
aws ec2 describe-conversion-tasks
aws ec2 describe-import-image-tasks

# Get Bundle Tasks
aws ec2 describe-bundle-tasks

# Get Classic Instances
aws ec2 describe-classic-link-instances

# Get Dedicated Hosts
aws ec2 describe-hosts

# Get SSH Key Pairs
aws ec2 describe-key-pairs

# Get Internet Gateways
aws ec2 describe-internet-gateways

# Get NAT Gateways
aws ec2 describe-nat-gateways

# Get subnetworks
aws ec2 describe-subnets

# Get FW rules
aws ec2 describe-network-acls

# Get security groups
aws ec2 describe-security-groups

# Get interfaces
aws ec2 describe-network-interfaces

# Get routes table
aws ec2 describe-route-tables

# Get VPCs
aws ec2 describe-vpcs
aws ec2 describe-vpc-peering-connections
```
### Acc√®s non authentifi√©

{% content-ref url="../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md" %}
[aws-ec2-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

Sur la page suivante, vous pouvez v√©rifier comment **exploiter les autorisations EC2 pour escalader les privil√®ges** :

{% content-ref url="../../aws-privilege-escalation/aws-ec2-privesc.md" %}
[aws-ec2-privesc.md](../../aws-privilege-escalation/aws-ec2-privesc.md)
{% endcontent-ref %}

### Post-Exploitation

{% content-ref url="../../../aws-pentesting/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/" %}
[aws-ec2-ebs-ssm-and-vpc-post-exploitation](../../../aws-pentesting/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/)
{% endcontent-ref %}

## EBS

Les **snapshots Amazon EBS** (Elastic Block Store) sont essentiellement des **sauvegardes statiques** des volumes AWS EBS. En d'autres termes, ce sont des **copies** des **disques** attach√©s √† une **instance EC2** √† un moment pr√©cis. Les snapshots EBS peuvent √™tre copi√©s entre les r√©gions et les comptes, ou m√™me t√©l√©charg√©s et ex√©cut√©s localement.

Les snapshots peuvent contenir des **informations sensibles** telles que du **code source ou des cl√©s API**, il est donc recommand√© de les v√©rifier si vous en avez l'occasion.

### Diff√©rence entre AMI et EBS

Une **AMI** est utilis√©e pour **lancer une instance EC2**, tandis qu'un **snapshot EC2** est utilis√© pour **sauvegarder et r√©cup√©rer les donn√©es stock√©es sur un volume EBS**. Bien qu'un snapshot EC2 puisse √™tre utilis√© pour cr√©er une nouvelle AMI, ce n'est pas la m√™me chose qu'une AMI et il ne contient pas d'informations sur le syst√®me d'exploitation, le serveur d'applications ou d'autres logiciels n√©cessaires pour ex√©cuter une application.

### Privesc

Sur la page suivante, vous pouvez v√©rifier comment **exploiter les autorisations EBS pour escalader les privil√®ges** :

{% content-ref url="../../aws-privilege-escalation/aws-ebs-privesc.md" %}
[aws-ebs-privesc.md](../../aws-privilege-escalation/aws-ebs-privesc.md)
{% endcontent-ref %}

## SSM

**Amazon Simple Systems Manager (SSM)** permet de g√©rer √† distance des instances EC2 pour faciliter leur administration. Chacune de ces instances doit ex√©cuter le service **SSM Agent, car c'est lui qui re√ßoit les actions et les ex√©cute** √† partir de l'API AWS.

L'agent **SSM** permet √† Systems Manager de mettre √† jour, g√©rer et configurer ces ressources. L'agent **traite les demandes du service Systems Manager dans le cloud AWS**, puis les ex√©cute comme sp√©cifi√© dans la demande.

L'**agent SSM est pr√©install√©**[ **dans certaines AMI**](https://docs.aws.amazon.com/systems-manager/latest/userguide/ami-preinstalled-agent.html) ou vous devez [**l'installer manuellement**](https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-manual-agent-install.html) sur les instances. De plus, le r√¥le IAM utilis√© √† l'int√©rieur de l'instance doit avoir la politique **AmazonEC2RoleforSSM** attach√©e pour pouvoir communiquer.

### √ânum√©ration
```bash
aws ssm describe-instance-information
aws ssm describe-parameters
aws ssm describe-sessions --state [Active|History]
aws ssm describe-instance-patches --instance-id <id>
aws ssm describe-instance-patch-states --instance-ids <id>
aws ssm describe-instance-associations-status --instance-id <id>
```
Vous pouvez v√©rifier si Systems Manager est en cours d'ex√©cution sur une instance EC2 en ex√©cutant simplement la commande suivante :
```bash
ps aux | grep amazon-ssm
```
### Privesc

Dans la page suivante, vous pouvez v√©rifier comment **abuser des autorisations SSM pour escalader les privil√®ges**:

{% content-ref url="../../aws-privilege-escalation/aws-ssm-privesc.md" %}
[aws-ssm-privesc.md](../../aws-privilege-escalation/aws-ssm-privesc.md)
{% endcontent-ref %}

### Post-Exploitation

Des techniques telles que l'interception des messages SSM peuvent √™tre trouv√©es dans la page de post-exploitation SSM:

{% content-ref url="aws-ssm-post-exploitation.md" %}
[aws-ssm-post-exploitation.md](aws-ssm-post-exploitation.md)
{% endcontent-ref %}

## ELB

**Elastic Load Balancing** (ELB) est un service de **r√©partition de charge pour les d√©ploiements Amazon Web Services** (AWS). ELB distribue automatiquement le **trafic d'application entrant** et ajuste les ressources pour r√©pondre aux demandes de trafic.

### √ânum√©ration
```bash
# List internet-facing ELBs
aws elb describe-load-balancers
aws elb describe-load-balancers | jq '.LoadBalancerDescriptions[]| select( .Scheme | contains("internet-facing"))|.DNSName'

# DONT FORGET TO CHECK VERSION 2
aws elbv2 describe-load-balancers
aws elbv2 describe-load-balancers | jq '.LoadBalancers[].DNSName'
aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
```
## Mod√®les de lancement et groupes d'auto-scaling

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# Launch templates
aws ec2 describe-launch-templates
aws ec2 describe-launch-templates --launch-template-id <launch_template_id>
## Get details, like user data
aws ec2 describe-launch-template-versions --launch-template-id <launch_template_id>

# Autoscaling
aws autoscaling describe-auto-scaling-groups
aws autoscaling describe-auto-scaling-instances
aws autoscaling describe-launch-configurations
aws autoscaling describe-load-balancer-target-groups
aws autoscaling describe-load-balancers
```
{% endcode %}

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
