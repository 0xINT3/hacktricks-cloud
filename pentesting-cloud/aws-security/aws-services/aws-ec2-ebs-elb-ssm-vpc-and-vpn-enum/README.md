# AWS - EC2, EBS, ELB, SSM, VPC & VPN Enum

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) **e** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **reposit√≥rios do github.**

</details>

## VPC e Networking

Saiba o que √© um VPC e sobre seus componentes em:

{% content-ref url="../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md" %}
[aws-vpc-and-networking-basic-information.md](../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md)
{% endcontent-ref %}

## EC2

Voc√™ pode usar o Amazon EC2 para lan√ßar **servidores virtuais**, configurar **seguran√ßa** e **rede**, e gerenciar **armazenamento**. O Amazon EC2 permite que voc√™ dimensione para cima ou para baixo para lidar com mudan√ßas nos requisitos ou picos de popularidade, reduzindo sua necessidade de prever o tr√°fego.

Coisas interessantes para enumerar no EC2:

* M√°quinas virtuais
  * Chaves SSH
  * Dados do usu√°rio
  * EC2s/AMIs/Snapshots existentes
* Rede
  * Redes
  * Sub-redes
  * IPs p√∫blicos
  * Portas abertas
* Conex√µes integradas com outras redes fora da AWS

### Perfis de inst√¢ncia

Usar **fun√ß√µes** para conceder permiss√µes a aplicativos que s√£o executados em **inst√¢ncias EC2** requer um pouco de configura√ß√£o extra. Um aplicativo em execu√ß√£o em uma inst√¢ncia EC2 √© abstra√≠do da AWS pelo sistema operacional virtualizado. Devido a essa separa√ß√£o adicional, voc√™ precisa de uma etapa adicional para atribuir uma fun√ß√£o AWS e suas permiss√µes associadas a uma inst√¢ncia EC2 e torn√°-las dispon√≠veis para seus aplicativos.

Essa etapa adicional √© a **cria√ß√£o de um** [_**perfil de inst√¢ncia**_](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_use\_switch-role-ec2\_instance-profiles.html) anexado √† inst√¢ncia. O **perfil de inst√¢ncia cont√©m a fun√ß√£o e** pode fornecer as credenciais tempor√°rias da fun√ß√£o para um aplicativo que √© executado na inst√¢ncia. Essas credenciais tempor√°rias podem ent√£o ser usadas nas chamadas de API do aplicativo para acessar recursos e limitar o acesso apenas aos recursos que a fun√ß√£o especifica. Observe que **apenas uma fun√ß√£o pode ser atribu√≠da a uma inst√¢ncia EC2** de cada vez, e todos os aplicativos na inst√¢ncia compartilham a mesma fun√ß√£o e permiss√µes.

### Endpoint de metadados

Os metadados do EC2 da AWS s√£o informa√ß√µes sobre uma inst√¢ncia do Amazon Elastic Compute Cloud (EC2) que est√£o dispon√≠veis para a inst√¢ncia em tempo de execu√ß√£o. Esses metadados s√£o usados para fornecer informa√ß√µes sobre a inst√¢ncia, como seu ID de inst√¢ncia, a zona de disponibilidade em que est√° sendo executada, a fun√ß√£o IAM associada √† inst√¢ncia e o nome do host da inst√¢ncia.

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Enumera√ß√£o

```bash
# Obter inst√¢ncias EC2
aws ec2 describe-instances
aws ec2 describe-instance-status #Obter status das inst√¢ncias em execu√ß√£o

# Obter dados do usu√°rio de cada inst√¢ncia ec2
for instanceid in $(aws ec2 describe-instances --profile <profile> --region us-west-2 | grep -Eo '"i-[a-zA-Z0-9]+' | tr -d '"'); do
  echo "ID da inst√¢ncia: $instanceid"
  aws ec2 describe-instance-attribute --profile <profile> --region us-west-2 --instance-id "$instanceid" --attribute userData | jq ".UserData.Value" | tr -d '"' | base64 -d
  echo ""
  echo "-------------------"
done

# Perfis de inst√¢ncia
aws iam list-instance-profiles
aws iam list-instance-profiles-for-role --role-name <name>

# Obter tags
aws ec2 describe-tags

# Obter volumes
aws ec2 describe-volume-status
aws ec2 describe-volumes

# Obter snapshots
aws ec2 describe-snapshots --owner-ids self

# Inst√¢ncias agendadas
aws ec2 describe-scheduled-instances

# Obter imagens personalizadas
aws ec2 describe-images --owners self 

# Obter IPs el√°sticos
aws ec2 describe-addresses

# Obter sa√≠da atual
aws ec2 get-console-output --instance-id [id]

# Obter gateways de clientes VPN
aws ec2 describe-customer-gateways
aws ec2 describe-vpn-gateways
aws ec2 describe-vpn-connections 

# Listar tarefas de convers√£o para fazer upload/download de VMs
aws ec2 describe-conversion-tasks
aws ec2 describe-import-image-tasks

# Obter tarefas de pacote
aws ec2 describe-bundle-tasks

# Obter inst√¢ncias cl√°ssicas
aws ec2 describe-classic-link-instances

# Obter hosts dedicados
aws ec2 describe-hosts

# Obter pares de chaves SSH
aws ec2 describe-key-pairs

# Obter gateways de internet
aws ec2 describe-internet-gateways

# Ob
## ELB

**Elastic Load Balancing** (ELB) √© um servi√ßo de balanceamento de carga para implanta√ß√µes da Amazon Web Services (AWS). O ELB distribui automaticamente o tr√°fego de aplicativos de entrada e dimensiona recursos para atender √†s demandas de tr√°fego.

<figure><img src="https://lh6.googleusercontent.com/cRBL0xfhe4VRn6PU0Bs_NPx937HqgdYxYNkRAh0WmQFfVZfyYg6X1rhpJwmVIQXIEeepQcUoJipsdH-qmacm8Dw49H539e2ygb2A5hQWGjMh_SAEHOfhygtTLINR2h5l6p4NiiMMO7g0LTZiFpdBB9IeEA=s2048" alt=""><figcaption></figcaption></figure>

### Enumera√ß√£o

```bash
# Listar ELBs voltados para a internet
aws elb describe-load-balancers
aws elb describe-load-balancers | jq '.LoadBalancerDescriptions[]| select( .Scheme | contains("internet-facing"))|.DNSName'

# N√ÉO ESQUE√áA DE VERIFICAR A VERS√ÉO 2
aws elbv2 describe-load-balancers
aws elbv2 describe-load-balancers | jq '.LoadBalancers[].DNSName'
aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
```

## Modelos de lan√ßamento e grupos de dimensionamento autom√°tico

### Enumera√ß√£o

{% code overflow="wrap" %}
```bash
# Modelos de lan√ßamento
aws ec2 describe-launch-templates
aws ec2 describe-launch-templates --launch-template-id <launch_template_id>
## Obter detalhes, como dados do usu√°rio
aws ec2 describe-launch-template-versions --launch-template-id <launch_template_id>

# Dimensionamento autom√°tico
aws autoscaling describe-auto-scaling-groups
aws autoscaling describe-auto-scaling-instances
aws autoscaling describe-launch-configurations
aws autoscaling describe-load-balancer-target-groups
aws autoscaling describe-load-balancers
```
{% endcode %}

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>