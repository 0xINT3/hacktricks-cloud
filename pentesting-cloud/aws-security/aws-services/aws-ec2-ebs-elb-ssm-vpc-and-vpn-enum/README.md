# AWS - EC2, EBS, ELB, SSM, VPC & VPN Enum

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFT exclusifs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## VPC et R√©seau

Apprenez ce qu'est un VPC et ses composants dans :

{% content-ref url="../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md" %}
[aws-vpc-and-networking-basic-information.md](../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md)
{% endcontent-ref %}

## EC2

Vous pouvez utiliser Amazon EC2 pour lancer des **serveurs virtuels**, configurer la **s√©curit√©** et le **r√©seau**, et g√©rer le **stockage**. Amazon EC2 vous permet de **monter ou descendre** pour g√©rer les changements de besoins ou les pics de popularit√©, r√©duisant ainsi votre besoin de pr√©voir le trafic.

Choses int√©ressantes √† √©num√©rer dans EC2 :

* Machines virtuelles
  * Cl√©s SSH
  * Donn√©es utilisateur
  * EC2s/AMIs/Snapshots existants
* R√©seau
  * R√©seaux
  * Sous-r√©seaux
  * Adresses IP publiques
  * Ports ouverts
* Connexions int√©gr√©es avec d'autres r√©seaux en dehors d'AWS

### Profils d'instance

L'utilisation de **r√¥les** pour accorder des autorisations aux applications qui s'ex√©cutent sur les **instances EC2** n√©cessite une configuration suppl√©mentaire. Une application s'ex√©cutant sur une instance EC2 est abstraite d'AWS par le syst√®me d'exploitation virtualis√©. En raison de cette s√©paration suppl√©mentaire, vous avez besoin d'une √©tape suppl√©mentaire pour attribuer un r√¥le AWS et ses autorisations associ√©es √† une instance EC2 et les rendre disponibles pour ses applications.

Cette √©tape suppl√©mentaire est la **cr√©ation d'un** [_**profil d'instance**_](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_use\_switch-role-ec2\_instance-profiles.html) attach√© √† l'instance. Le **profil d'instance contient le r√¥le et** peut fournir les **informations d'identification temporaires du r√¥le** √† une application qui s'ex√©cute sur l'instance. Ces informations d'identification temporaires peuvent ensuite √™tre utilis√©es dans les appels API de l'application pour acc√©der aux ressources et pour limiter l'acc√®s uniquement aux ressources que le r√¥le sp√©cifie. Notez que **seul un r√¥le peut √™tre attribu√© √† une instance EC2** √† la fois, et que toutes les applications sur l'instance partagent le m√™me r√¥le et les m√™mes autorisations.

### Point de terminaison de m√©tadonn√©es

Les m√©tadonn√©es AWS EC2 sont des informations sur une instance Amazon Elastic Compute Cloud (EC2) qui sont disponibles pour l'instance en cours d'ex√©cution. Ces m√©tadonn√©es sont utilis√©es pour fournir des informations sur l'instance, telles que son ID d'instance, la zone de disponibilit√© dans laquelle elle s'ex√©cute, le r√¥le IAM associ√© √† l'instance et le nom d'h√¥te de l'instance.

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### √ânum√©ration

```bash
# Obtenir les instances EC2
aws ec2 describe-instances
aws ec2 describe-instance-status #Obtenir l'√©tat des instances en cours d'ex√©cution

# Obtenir les donn√©es utilisateur de chaque instance EC2
for instanceid in $(aws ec2 describe-instances --profile <profile> --region us-west-2 | grep -Eo '"i-[a-zA-Z0-9]+' | tr -d '"'); do
  echo "Instance ID: $instanceid"
  aws ec2 describe-instance-attribute --profile <profile> --region us-west-2 --instance-id "$instanceid" --attribute userData | jq ".UserData.Value" | tr -d '"' | base64 -d
  echo ""
  echo "-------------------"
done

# Profils d'instance
aws iam list-instance-profiles
aws iam list-instance-profiles-for-role --role-name <name>

# Obtenir les tags
aws ec2 describe-tags

# Obtenir les volumes
aws ec2 describe-volume-status
aws ec2 describe-volumes

# Obtenir les snapshots
aws ec2 describe-snapshots --owner-ids self

# Instances planifi√©es
aws ec2 describe-scheduled-instances

# Obtenir les images personnalis√©es
aws ec2 describe-images --owners self 

# Obtenir les adresses IP √©lastiques
aws ec2 describe-addresses

# Obtenir la sortie actuelle
aws ec2 get-console-output --instance-id [id]

# Obtenir les passerelles clients VPN
aws ec2 describe-customer-gateways
aws ec2 describe-vpn-gateways
aws ec2 describe-vpn-connections 

# Liste des t√¢ches de conversion pour t√©l√©charger/t√©l√©verser des VM
aws ec2 describe-conversion-tasks
aws ec2 describe-import-image-tasks

# Obtenir les t√¢ches de bundle
aws ec2 describe-bundle-tasks

# Obtenir les instances classiques
aws ec
## ELB

**Elastic Load Balancing** (ELB) est un service d'√©quilibrage de charge pour les d√©ploiements d'Amazon Web Services (AWS). ELB distribue automatiquement le trafic d'application entrant et met √† l'√©chelle les ressources pour r√©pondre aux demandes de trafic.

<figure><img src="https://lh6.googleusercontent.com/cRBL0xfhe4VRn6PU0Bs_NPx937HqgdYxYNkRAh0WmQFfVZfyYg6X1rhpJwmVIQXIEeepQcUoJipsdH-qmacm8Dw49H539e2ygb2A5hQWGjMh_SAEHOfhygtTLINR2h5l6p4NiiMMO7g0LTZiFpdBB9IeEA=s2048" alt=""><figcaption></figcaption></figure>

### √ânum√©ration

```bash
# Liste des ELB accessibles depuis Internet
aws elb describe-load-balancers
aws elb describe-load-balancers | jq '.LoadBalancerDescriptions[]| select( .Scheme | contains("internet-facing"))|.DNSName'

# N'OUBLIEZ PAS DE V√âRIFIER LA VERSION 2
aws elbv2 describe-load-balancers
aws elbv2 describe-load-balancers | jq '.LoadBalancers[].DNSName'
aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
```

## Mod√®les de lancement et groupes d'auto-scaling

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# Mod√®les de lancement
aws ec2 describe-launch-templates
aws ec2 describe-launch-templates --launch-template-id <launch_template_id>
## Obtenir des d√©tails, comme les donn√©es utilisateur
aws ec2 describe-launch-template-versions --launch-template-id <launch_template_id>

# Auto-scaling
aws autoscaling describe-auto-scaling-groups
aws autoscaling describe-auto-scaling-instances
aws autoscaling describe-launch-configurations
aws autoscaling describe-load-balancer-target-groups
aws autoscaling describe-load-balancers
```
{% endcode %}

<details>

<summary><strong>Soutenez HackTricks et obtenez des avantages !</strong></summary>

* Si vous voulez voir votre **entreprise annonc√©e dans HackTricks** ou si vous voulez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos.**

</details>