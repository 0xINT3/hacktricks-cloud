# AWS - EC2, EBS, ELB, SSM, VPC & VPN Enum

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## VPC & Δικτύωση

Μάθετε τι είναι ένα VPC και για τα στοιχεία του στο:

{% content-ref url="../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md" %}
[aws-vpc-and-networking-basic-information.md](../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md)
{% endcontent-ref %}

## EC2

Το Amazon EC2 χρησιμοποιείται για την εκκίνηση **εικονικών διακομιστών**. Επιτρέπει την παραμετροποίηση της **ασφάλειας** και της **δικτύωσης** και τη διαχείριση της **αποθήκευσης**. Η ευελιξία του Amazon EC2 είναι εμφανής στη δυνατότητά του να κλιμακώνει τους πόρους προς τα πάνω και προς τα κάτω, προσαρμόζοντας αποτελεσματικά στις μεταβαλλόμενες απαιτήσεις ή στις αιφνίδιες αυξήσεις της δημοτικότητας. Αυτή η δυνατότητα μειώνει την ανάγκη για ακριβείς προβλέψεις κίνησης.

Ενδιαφέροντα πράγματα για απαρίθμηση στο EC2:

* Εικονικές μηχανές
* Κλειδιά SSH
* Δεδομένα χρήστη
* Υπάρχοντες EC2s/AMIs/Snapshots
* Δικτύωση
* Δίκτυα
* Υποδίκτυα
* Δημόσιες διευθύνσεις IP
* Ανοιχτές θύρες
* Ενσωματωμένες συνδέσεις με άλλα δίκτυα έξω από το AWS

### Προφίλ Εικόνας

Η χρήση **ρόλων** για την απόδοση δικαιωμάτων σε εφαρμογές που εκτελούνται σε **EC2 instances** απαιτεί μια επιπλέον διαμόρφωση. Μια εφαρμογή που εκτελείται σε ένα EC2 instance απομονώνεται από το AWS από το εικονικοποιημένο λειτουργικό σύστημα. Λόγω αυτής της επιπλέον απομόνωσης, χρειάζεστε ένα επιπλέον βήμα για να αναθέσετε έναν ρόλο AWS και τα σχετικά δικαιώματα σε ένα EC2 instance και να τα καταστήσετε διαθέσιμα στις εφαρμογές του.

Αυτό το επιπλέον βήμα είναι η **δημιουργία ενός** [_**προφίλ εικόνας**_](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_use\_switch-role-ec2\_instance-profiles.html) που συνδέεται με το instance. Το **προφίλ εικόνας περιέχει τον ρόλο** και μπορεί να παρέχει τα προσωρινά διαπιστευτήρια του ρόλου σε μια εφαρμογή που εκτελείται στο instance. Αυτά τα προσωρινά διαπιστευτήρια μπορούν στη συνέχεια να χρησιμοποιηθούν στις κλήσεις API της εφαρμογής για την πρόσβαση σε πόρους και για τον περιορισμό της πρόσβασης μόνο σε εκείνους τους πόρους που καθορίζει ο ρόλος. Σημειώστε ότι **μόνο ένας ρόλος μπορεί να ανατεθεί σε ένα EC2 instance** τη φορά και όλες οι εφαρμογές στο instance μοιράζονται τον ίδιο ρόλο και τα ίδια δικαιώματα.

### Σημείο Μεταδεδομένων

Τα μεταδεδομένα του AWS EC2 είναι πληροφορίες για ένα instance του Amazon Elastic Compute Cloud (EC2) που είναι διαθέσιμες στο instance κατά τη διάρκεια της εκτέλεσής του. Αυτά τα μεταδεδομένα χρησιμοποιούνται για να παρέχουν πληροφορίες για το instance, όπως το instance ID, η ζώνη διαθεσιμότητας στην οποία εκτελείται, ο ρόλος IAM που συσχετίζεται με το instance και το όνομα του instance.

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Απαρίθμηση
```bash
# Get EC2 instances
aws ec2 describe-instances
aws ec2 describe-instance-status #Get status from running instances

# Get user data from each ec2 instance
for instanceid in $(aws ec2 describe-instances --profile <profile> --region us-west-2 | grep -Eo '"i-[a-zA-Z0-9]+' | tr -d '"'); do
echo "Instance ID: $instanceid"
aws ec2 describe-instance-attribute --profile <profile> --region us-west-2 --instance-id "$instanceid" --attribute userData | jq ".UserData.Value" | tr -d '"' | base64 -d
echo ""
echo "-------------------"
done

# Instance profiles
aws iam list-instance-profiles
aws iam list-instance-profiles-for-role --role-name <name>

# Get tags
aws ec2 describe-tags

# Get volumes
aws ec2 describe-volume-status
aws ec2 describe-volumes

# Get snapshots
aws ec2 describe-snapshots --owner-ids self

# Scheduled instances
aws ec2 describe-scheduled-instances

# Get custom images
aws ec2 describe-images --owners self

# Get Elastic IPs
aws ec2 describe-addresses

# Get current output
aws ec2 get-console-output --instance-id [id]

# Get VPN customer gateways
aws ec2 describe-customer-gateways
aws ec2 describe-vpn-gateways
aws ec2 describe-vpn-connections

# List conversion tasks to upload/download VMs
aws ec2 describe-conversion-tasks
aws ec2 describe-import-image-tasks

# Get Bundle Tasks
aws ec2 describe-bundle-tasks

# Get Classic Instances
aws ec2 describe-classic-link-instances

# Get Dedicated Hosts
aws ec2 describe-hosts

# Get SSH Key Pairs
aws ec2 describe-key-pairs

# Get Internet Gateways
aws ec2 describe-internet-gateways

# Get NAT Gateways
aws ec2 describe-nat-gateways

# Get subnetworks
aws ec2 describe-subnets

# Get FW rules
aws ec2 describe-network-acls

# Get security groups
aws ec2 describe-security-groups

# Get interfaces
aws ec2 describe-network-interfaces

# Get routes table
aws ec2 describe-route-tables

# Get VPCs
aws ec2 describe-vpcs
aws ec2 describe-vpc-peering-connections
```
### Μη εξουσιοδοτημένη πρόσβαση

{% content-ref url="../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md" %}
[aws-ec2-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md)
{% endcontent-ref %}

### Ανέβασμα δικαιωμάτων

Στην παρακάτω σελίδα μπορείτε να ελέγξετε πώς να **καταχραστείτε τα δικαιώματα του EC2 για να αναβαθμίσετε τα δικαιώματα**:

{% content-ref url="../../aws-privilege-escalation/aws-ec2-privesc.md" %}
[aws-ec2-privesc.md](../../aws-privilege-escalation/aws-ec2-privesc.md)
{% endcontent-ref %}

### Μετά την εκμετάλλευση

{% content-ref url="../../../aws-pentesting/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/" %}
[aws-ec2-ebs-ssm-and-vpc-post-exploitation](../../../aws-pentesting/aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/)
{% endcontent-ref %}

## EBS

Τα **EBS** (Elastic Block Store) **snapshots** της Amazon είναι βασικά στατικά **αντίγραφα ασφαλείας** των όγκων AWS EBS. Με άλλα λόγια, είναι **αντίγραφα** των **δίσκων** που είναι συνδεδεμένοι σε μια **EC2** Περίπτωση σε ένα συγκεκριμένο σημείο του χρόνου. Τα αντίγραφα EBS μπορούν να αντιγραφούν σε διάφορες περιοχές και λογαριασμούς, ή ακόμα και να ληφθούν και να εκτελεστούν τοπικά.

Τα αντίγραφα μπορεί να περιέχουν **ευαίσθητες πληροφορίες** όπως **κώδικα πηγής ή κλειδιά API**, για αυτό, αν έχετε την ευκαιρία, συνιστάται να το ελέγξετε.

### Διαφορά AMI & EBS

Ένα **AMI** χρησιμοποιείται για να **ξεκινήσει μια περίπτωση EC2**, ενώ ένα **Snapshot EC2** χρησιμοποιείται για **δημιουργία αντιγράφων ασφαλείας και ανάκτηση δεδομένων που αποθηκεύονται σε έναν όγκο EBS**. Ενώ ένα Snapshot EC2 μπορεί να χρησιμοποιηθεί για να δημιουργήσει ένα νέο AMI, δεν είναι το ίδιο πράγμα με ένα AMI και δεν περιλαμβάνει πληροφορίες σχετικά με το λειτουργικό σύστημα, τον εξυπηρετητή εφαρμογών ή άλλο λογισμικό που απαιτείται για την εκτέλεση μιας εφαρμογής.

### Ανέβασμα δικαιωμάτων

Στην παρακάτω σελίδα μπορείτε να ελέγξετε πώς να **καταχραστείτε τα δικαιώματα του EBS για να αναβαθμίσετε τα δικαιώματα**:

{% content-ref url="../../aws-privilege-escalation/aws-ebs-privesc.md" %}
[aws-ebs-privesc.md](../../aws-privilege-escalation/aws-ebs-privesc.md)
{% endcontent-ref %}

## SSM

Το **Amazon Simple Systems Manager (SSM)** επιτρέπει την απομακρυσμένη διαχείριση των περιπτώσεων EC2 για να διευκολύνει τη διαχείρισή τους. Κάθε μια από αυτές τις περιπτώσεις πρέπει να εκτελεί την υπηρεσία **SSM Agent καθώς η υπηρεσία θα είναι αυτή που θα λαμβάνει τις ενέργειες και θα τις εκτελεί** από το AWS API.

Ο **SSM Agent** καθιστά δυνατή την ενημέρωση, διαχείριση και διαμόρφωση αυτών των πόρων από το Systems Manager. Ο πράκτορας **επεξεργάζεται τα αιτήματα από την υπηρεσία Systems Manager στο AWS Cloud** και τα εκτελεί όπως προβλέπεται στο αίτημα.

Ο **SSM Agent έρχεται**[ **προεγκατεστημένος σε ορισμένα AMI**](https://docs.aws.amazon.com/systems-manager/latest/userguide/ami-preinstalled-agent.html) ή πρέπει να [**εγκατασταθεί χειροκίνητα**](https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-manual-agent-install.html) στις περιπτώσεις. Επίσης, ο ρόλος IAM που χρησιμοποιείται μέσα στην περίπτωση πρέπει να έχει επισυναφθεί την πολιτική **AmazonEC2RoleforSSM** για να μπορεί να επικοινωνήσει.

### Απαρίθμηση
```bash
aws ssm describe-instance-information
aws ssm describe-parameters
aws ssm describe-sessions --state [Active|History]
aws ssm describe-instance-patches --instance-id <id>
aws ssm describe-instance-patch-states --instance-ids <id>
aws ssm describe-instance-associations-status --instance-id <id>
```
Μπορείτε να ελέγξετε αν το Systems Manager εκτελείται σε μια EC2 περίπτωση απλά εκτελώντας:
```bash
ps aux | grep amazon-ssm
```
### Ανέβασμα Προνομίων

Στην παρακάτω σελίδα μπορείτε να ελέγξετε πώς να **καταχραστείτε τα δικαιώματα του SSM για να αναβαθμίσετε τα προνόμια**:

{% content-ref url="../../aws-privilege-escalation/aws-ssm-privesc.md" %}
[aws-ssm-privesc.md](../../aws-privilege-escalation/aws-ssm-privesc.md)
{% endcontent-ref %}

### Μετά την Εκμετάλλευση

Τεχνικές όπως η παρεμβολή μηνυμάτων SSM μπορούν να βρεθούν στη σελίδα μετά την εκμετάλλευση του SSM:

{% content-ref url="broken-reference" %}
[Σπασμένος σύνδεσμος](broken-reference)
{% endcontent-ref %}

## ELB

Το **Elastic Load Balancing** (ELB) είναι ένα **υπηρεσία ισορροπίας φορτίου για τις αναπτύξεις του Amazon Web Services** (AWS). Το ELB αυτόματα **διανέμει την εισερχόμενη κίνηση της εφαρμογής** και κλιμακώνει τους πόρους για να ανταποκριθεί στις απαιτήσεις της κίνησης.

### Απαρίθμηση
```bash
# List internet-facing ELBs
aws elb describe-load-balancers
aws elb describe-load-balancers | jq '.LoadBalancerDescriptions[]| select( .Scheme | contains("internet-facing"))|.DNSName'

# DONT FORGET TO CHECK VERSION 2
aws elbv2 describe-load-balancers
aws elbv2 describe-load-balancers | jq '.LoadBalancers[].DNSName'
aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
```
## Πρότυπα Εκκίνησης & Ομάδες Αυτόματης Κλιμάκωσης

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# Launch templates
aws ec2 describe-launch-templates
aws ec2 describe-launch-templates --launch-template-id <launch_template_id>
## Get details, like user data
aws ec2 describe-launch-template-versions --launch-template-id <launch_template_id>

# Autoscaling
aws autoscaling describe-auto-scaling-groups
aws autoscaling describe-auto-scaling-instances
aws autoscaling describe-launch-configurations
aws autoscaling describe-load-balancer-target-groups
aws autoscaling describe-load-balancers
```
{% endcode %}

## VPN

Ένα VPN επιτρέπει τη σύνδεση του δικτύου σας στον τόπο εγκατάστασης (site-to-site VPN) ή των φορητών υπολογιστών των εργαζομένων (Client VPN) με ένα AWS VPC, έτσι ώστε οι υπηρεσίες να μπορούν να προσπελαστούν χωρίς να χρειάζεται να τις εκθέσετε στο διαδίκτυο.

### Βασικά στοιχεία AWS VPN

1. **Πύλη πελάτη**:
* Μια πύλη πελάτη είναι ένα πόρος που δημιουργείτε στο AWS για να αντιπροσωπεύει την πλευρά σας μιας σύνδεσης VPN.
* Ουσιαστικά είναι μια φυσική συσκευή ή μια εφαρμογή λογισμικού στην πλευρά σας της σύνδεσης VPN Site-to-Site.
* Παρέχετε πληροφορίες δρομολόγησης και τη δημόσια διεύθυνση IP της συσκευής δικτύου σας (όπως ένας δρομολογητής ή ένα τείχος προστασίας) στο AWS για να δημιουργήσετε μια πύλη πελάτη.
* Λειτουργεί ως σημείο αναφοράς για την εγκατάσταση της σύνδεσης VPN και δεν προκαλεί επιπρόσθετες χρεώσεις.
2. **Εικονική Ιδιωτική Πύλη**:
* Μια Εικονική Ιδιωτική Πύλη (VPG) είναι ο συγκεντρωτής VPN στην πλευρά του Amazon της σύνδεσης VPN Site-to-Site.
* Είναι συνδεδεμένη με το VPC σας και λειτουργεί ως στόχος για τη σύνδεση VPN σας.
* Η VPG είναι το άκρο του AWS για τη σύνδεση VPN.
* Χειρίζεται την ασφαλή επικοινωνία μεταξύ του VPC σας και του δικτύου σας στον τόπο εγκατάστασης.
3. **Σύνδεση VPN Site-to-Site**:
* Μια σύνδεση VPN Site-to-Site συνδέει το δίκτυο σας στον τόπο εγκατάστασης με ένα VPC μέσω ενός ασφαλούς, IPsec VPN τούνελ.
* Αυτός ο τύπος σύνδεσης απαιτεί μια πύλη πελάτη και μια Εικονική Ιδιωτική Πύλη.
* Χρησιμοποιείται για ασφαλή, σταθερή και συνεπή επικοινωνία μεταξύ του κέντρου δεδομένων ή του δικτύου σας και του περιβάλλοντος AWS σας.
* Συνήθως χρησιμοποιείται για τακτικές, μακροπρόθεσμες συνδέσεις και χρεώνεται με βάση τον όγκο των δεδομένων που μεταφέρονται μέσω της σύνδεσης.
4. **Σημείο πρόσβασης Client VPN**:
* Ένα σημείο πρόσβασης Client VPN είναι ένας πόρος που δημιουργείτε στο AWS για να ενεργοποιήσετε και να διαχειριστείτε τις συνεδρίες VPN των πελατών.
* Χρησιμοποιείται για την επιτροπή σε μεμονωμένες συσκευές (όπως φορητούς υπολογιστές, έξυπνα τηλέφωνα κ.λπ.) να συνδεθούν με ασφάλεια σε πόρους AWS ή το δίκτυο σας στον τόπο εγκατάστασης.
* Διαφέρει από τη σύνδεση Site-to-Site VPN στο ότι σχεδιάστηκε για μεμονωμένους πελάτες αντί για τη σύνδεση ολόκληρων δικτύων.
* Με το Client VPN, κάθε συσκευή πελάτη χρησιμοποιεί λογισμικό πελάτη VPN για να καθιερώσει μια ασφαλή σύνδεση.

Μπορείτε να [**βρείτε περισσότερες πληροφορίες σχετικά με τα οφέλη και τα στοιχεία των AWS VPN εδώ**](../../../aws-pentesting/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/aws-vpc-and-networking-basic-information.md#vpn).&#x20;

Post E

### Απαρίθμηση
```bash
# VPN endpoints
## Check used subnetwork, authentication, SGs, connected...
aws ec2 describe-client-vpn-endpoints

## Get AWS network info related to the vpn endpoint
aws ec2 describe-client-vpn-target-networks --client-vpn-endpoint-id <id>

## Get AWS subnet & ip range the VPN iconnected to
aws ec2 describe-client-vpn-routes --client-vpn-endpoint-id <id>

## Check authorization rules
aws ec2 describe-client-vpn-authorization-rules --client-vpn-endpoint-id <id>

## Get current connections to the VPN endpoint
aws ec2 describe-client-vpn-connections --client-vpn-endpoint-id <id>

# Get VPN gateways and check with which VPC each is connected
aws ec2 describe-vpn-gateways

# Get VPN site-to-site connections
aws ec2 describe-vpn-connections
```
### Τοπική Απαρίθμηση

#### Τοπικές Προσωρινές Πιστοποιήσεις

Όταν χρησιμοποιείται ο AWS VPN Client για να συνδεθείτε σε ένα VPN, ο χρήστης συνήθως θα συνδεθεί στο AWS για να αποκτήσει πρόσβαση στο VPN. Στη συνέχεια, δημιουργούνται και αποθηκεύονται τοπικά ορισμένα διαπιστευτήρια AWS για την εγκαθίδρυση της σύνδεσης VPN. Αυτά τα διαπιστευτήρια αποθηκεύονται στο `$HOME/.config/AWSVPNClient/TemporaryCredentials/<region>/temporary-credentials.txt` και περιλαμβάνουν ένα **AccessKey**, ένα **SecretKey** και ένα **Token**.

Τα διαπιστευτήρια ανήκουν στον χρήστη `arn:aws:sts::<acc-id>:assumed-role/aws-vpn-client-metrics-analytics-access-role/CognitoIdentityCredentials` (TODO: ερευνήστε περισσότερο σχετικά με τα δικαιώματα αυτών των διαπιστευτηρίων).

#### Αρχεία διαμόρφωσης opvn

Εάν έχει εγκατασταθεί μια σύνδεση VPN, θα πρέπει να αναζητήσετε αρχεία διαμόρφωσης **`.opvn`** στο σύστημα. Επιπλέον, ένα μέρος όπου μπορείτε να βρείτε τις διαμορφώσεις είναι στο **`$HOME/.config/AWSVPNClient/OpenVpnConfigs`**

### **Μετά την Εκμετάλλευση**

{% content-ref url="../../aws-post-exploitation/aws-vpn-post-exploitation.md" %}
[aws-vpn-post-exploitation.md](../../aws-post-exploitation/aws-vpn-post-exploitation.md)
{% endcontent-ref %}

# Αναφορές
* [https://docs.aws.amazon.com/batch/latest/userguide/getting-started-ec2.html](https://docs.aws.amazon.com/batch/latest/userguide/getting-started-ec2.html)

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Συμμετάσχετε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
