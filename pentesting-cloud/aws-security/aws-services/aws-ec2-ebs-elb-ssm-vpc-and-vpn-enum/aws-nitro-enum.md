# AWS - рдирд╛рдЗрдЯреНрд░реЛ рдЗрдирдо

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

AWS рдирд╛рдЗрдЯреНрд░реЛ рдПрдХ рд╕реБрдзрд╛рд░рдХ рддрдХрдиреАрдХреЛрдВ рдХрд╛ рд╕рдореВрд╣ рд╣реИ рдЬреЛ AWS EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдмрдирд╛рддрд╛ рд╣реИред рдЕрдореЗрдЬрд╝рди рджреНрд╡рд╛рд░рд╛ рдкреЗрд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ **рд╕реБрд░рдХреНрд╖рд╛, рдкреНрд░рджрд░реНрд╢рди, рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдХреЛ рдмрдврд╝рд╛рдиреЗ** рдХреЗ рд▓рд┐рдП, рдирд╛рдЗрдЯреНрд░реЛ рдЕрдкрдирд╛рддрд╛ рд╣реИ рдХрд╕реНрдЯрдо **рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдХреЙрдореНрдкреЛрдиреЗрдВрдЯреНрд╕ рдФрд░ рдПрдХ рд╣рд▓реНрдХрд╛ рд╣рд╛рдЗрдкрд░рд╡рд╛рдЗрдЬрд╝рд░** рдХрд╛ рдЙрдкрдпреЛрдЧред рдпрд╣ рдзрд╛рд░рдгрд╛ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХреАрдХрд░рдг рдХреА рдмрд╣реБрдд рд╕реА рдкрд╛рд░рдВрдкрд░рд┐рдХ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рд╕рдорд░реНрдкрд┐рдд рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдФрд░ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдореЗрдВ **рдХрдо рдХрд░рдХреЗ рд╣рдорд▓реЗ рдХреА рд╕рддрд╣ рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИ** рдФрд░ рд╕рдВрд╕рд╛рдзрди рдХреБрд╢рд▓рддрд╛ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░рддрд╛ рд╣реИред рд╡рд░реНрдЪреБрдЕрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЕрд▓рдЧ рдХрд░рдХреЗ, рдирд╛рдЗрдЯреНрд░реЛ EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ **рд▓рдЧрднрдЧ рдмреЗрдпрд░-рдореЗрдЯрд▓ рдкреНрд░рджрд░реНрд╢рди** рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╕рдВрд╕рд╛рдзрди-рдЙрддреНрд╕рд░реНрдЬрди рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд▓рд╛рднрдХрд╛рд░реА рдмрдирд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдирд╛рдЗрдЯреНрд░реЛ рд╕реБрд░рдХреНрд╖рд╛ рдЪрд┐рдк рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ **рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдФрд░ рдлрд░реНрдорд╡реЗрдпрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛** рдХреЛ, рдЕрдзрд┐рдХ рд╕реБрджреГрдврд╝ рдмрдирд╛рддреЗ рд╣реИрдВред

### рдирд╛рдЗрдЯреНрд░реЛ рдПрдиреНрдХреНрд▓реЗрд╡реНрд╕

**AWS рдирд╛рдЗрдЯреНрд░реЛ рдПрдиреНрдХреНрд▓реЗрд╡реНрд╕** рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд, **рдЕрд▓рдЧ рдХрдВрдкреНрдпреВрдЯ рдкрд░рд┐рд╡реЗрд╢ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЕрдореЗрдЬрд╝рди EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рднреАрддрд░**, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрдЪреНрдЪ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдХреЛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред AWS рдирд╛рдЗрдЯреНрд░реЛ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдпреЗ рдПрдиреНрдХреНрд▓реЗрд╡реНрд╕ рдордЬрдмреВрдд **рдЕрд▓рдЧрд╛рд╡ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛** рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ **рдЧреЛрдкрдиреАрдп рдЬрд╛рдирдХрд╛рд░реА** рдЬреИрд╕реЗ PII рдпрд╛ рд╡рд┐рддреНрддреАрдп рд░рд┐рдХреЙрд░реНрдбреНрд╕ рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрджрд░реНрд╢ рд╣реИред рдЗрдирдореЗрдВ рдПрдХ рдиреНрдпреВрдирддрдо рдкрд░рд┐рд╡реЗрд╢ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдбреЗрдЯрд╛ рдХрд╛ рдЕрд╡рд╕рд╛рдж рдХрд░рдиреЗ рдХрд╛ рдЬреЛрдЦрд┐рдо рдХрд╛рдлреА рдХрдо рдХрд░ рджреЗрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдирд╛рдЗрдЯреНрд░реЛ рдПрдиреНрдХреНрд▓реЗрд╡реНрд╕ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдХреЗрд╡рд▓ рдЕрдзрд┐рдХреГрдд рдХреЛрдб рдЪрд▓ рд░рд╣рд╛ рд╣реИ, рдЬреЛ рд╕рдЦреНрдд рдЕрдиреБрдкрд╛рд▓рди рдФрд░ рдбреЗрдЯрд╛ рд╕рдВрд░рдХреНрд╖рдг рдорд╛рдирдХреЛрдВ рдХреЛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред

{% hint style="danger" %}
рдирд╛рдЗрдЯреНрд░реЛ рдПрдиреНрдХреНрд▓реЗрд╡ рдЫрд╡рд┐рдпрд╛рдБ **EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдЕрдВрджрд░ рд╕реЗ рдЪрд▓рд╛рдИ рдЬрд╛рддреА рд╣реИрдВ** рдФрд░ рдЖрдк AWS рд╡реЗрдм рдХрдВрд╕реЛрд▓ рд╕реЗ рдирд╣реАрдВ рджреЗрдЦ рд╕рдХрддреЗ рдХрд┐ рдХреНрдпрд╛ рдПрдХ EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдирд╛рдЗрдЯреНрд░реЛ рдПрдиреНрдХреНрд▓реЗрд╡ рдореЗрдВ рдЫрд╡рд┐рдпрд╛рдБ рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред
{% endhint %}

## рдирд╛рдЗрдЯреНрд░реЛ рдПрдиреНрдХреНрд▓реЗрд╡ CLI рд╕реНрдерд╛рдкрдирд╛

рд╕рднреА рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ [**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕реЗ**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпреЗ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВ:
```bash
# Install tools
sudo amazon-linux-extras install aws-nitro-enclaves-cli -y
sudo yum install aws-nitro-enclaves-cli-devel -y

# Config perms
sudo usermod -aG ne $USER
sudo usermod -aG docker $USER

# Check installation
nitro-cli --version

# Start and enable the Nitro Enclaves allocator service.
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service
```
## рдирд╛рдЗрдЯреНрд░реЛ рдПрдиреНрдХреНрд▓реЗрд╡ рдЗрдореЗрдЬреЗрд╕

рдирд╛рдЗрдЯреНрд░реЛ рдПрдиреНрдХреНрд▓реЗрд╡ рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЫрд╡рд┐рдпрд╛рдБ рдбреЙрдХрд░ рдЗрдореЗрдЬреЗрд╕ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реЛрддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдЕрдкрдиреА рдирд╛рдЗрдЯреНрд░реЛ рдПрдиреНрдХреНрд▓реЗрд╡ рдЗрдореЗрдЬреЗрд╕ рдбреЙрдХрд░ рдЗрдореЗрдЬреЗрд╕ рд╕реЗ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ:
```bash
# You need to have the docker image accesible in your running local registry
# Or indicate the full docker image URL to access the image
nitro-cli build-enclave --docker-uri <docker-img>:<tag> --output-file nitro-img.eif
```
рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, Nitro Enclave рдЫрд╡рд┐рдпрд╛рдБ рдПрдХреНрд╕рдЯреЗрдВрд╢рди **`eif`** (Enclave Image File) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИрдВред

рдЖрдЙрдЯрдкреБрдЯ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛:
```
Using the locally available Docker image...
Enclave Image successfully created.
{
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
```
### рдПрдХ рдЫрд╡рд┐ рдЪрд▓рд╛рдПрдВ

рдЬреИрд╕рд╛ рдХрд┐ [**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave) рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдПрдХ рдПрдиреНрдХреНрд▓реЗрд╡ рдЫрд╡рд┐ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрд╕реЗ **`eif` рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЖрдХрд╛рд░ рдХрд╛ рдХрдо рд╕реЗ рдХрдо 4 рдЧреБрдгрд╛ рдореЗрдореЛрд░реА рд╕реМрдВрдкрдиреА рд╣реЛрдЧреА**ред рдЗрд╕реЗ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рдВрд╕рд╛рдзрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдлрд╝рд╛рдЗрд▓ рдореЗрдВред
```shell
/etc/nitro_enclaves/allocator.yaml
```
{% hint style="danger" %}
рд╣рдореЗрд╢рд╛ рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдЖрдкрдХреЛ **рдорд╛рддрд╛ EC2** рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕рдВрд╕рд╛рдзрди рдЖрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ!
{% endhint %}

рдПрдХ рдЫрд╡рд┐ рдХреЛ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЬрд╛рдирдиреЗ рдХреЗ рдмрд╛рдж рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдПрдиреНрдХреНрд▓реЗрд╡ рдЫрд╡рд┐ рдХреЛ рдЪрд▓рд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```shell
# Restart the service so the new default values apply
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service

# Indicate the CPUs and memory to give
nitro-cli run-enclave --cpu-count 2 --memory 3072 --eif-path hello.eif --debug-mode --enclave-cid 16
```
{% endcode %}

### рдЬрд╛рдВрдЪреЗрдВ рдПрдиреНрдХреНрд▓реЗрд╡реНрд╕

рдпрджрд┐ рдЖрдк рдПрдХ EC2 рд╣реЛрд╕реНрдЯ рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдЪрд▓ рд░рд╣реА рдПрдиреНрдХреНрд▓реЗрд╡ рдЗрдореЗрдЬреЗрд╕ рдХреА рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```bash
nitro-cli describe-enclaves
```
рдПрдХ рдЪрд▓ рд░рд╣реЗ рдПрдиреНрдХреНрд▓реЗрд╡ рдЗрдореЗрдЬ рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╢реИрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдиреНрдХреНрд▓реЗрд╡ рдХрд╛ рдореБрдЦреНрдп рдЙрджреНрджреЗрд╢реНрдп рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдЧрд░ рдЖрдк **`--debug-mode`** рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдХреЗ **stdout** рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```shell
ENCLAVE_ID=$(nitro-cli describe-enclaves | jq -r ".[0].EnclaveID")
nitro-cli console --enclave-id ${ENCLAVE_ID}
```
### рдПрдиреНрдХреНрд▓реЗрд╡реНрд╕ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░реЗрдВ

рдпрджрд┐ рдХрд┐рд╕реА рд╣рдорд▓рд╛рд╡рд░ рдиреЗ рдПрд╕реА 2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬ рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЙрдирдХреЗ рдЕрдВрджрд░ рд╢реИрд▓ рдорд┐рд▓рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдЙрд╕реЗ рдЙрдиреНрд╣реЗрдВ рд╕рдорд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрдЧреА:
```shell
nitro-cli terminate-enclave --enclave-id ${ENCLAVE_ID}
```
## Vsock

**рдПрдиреНрдХреНрд▓реЗрд╡** рдЪрд▓ рд░рд╣реА рдЫрд╡рд┐ рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ **рд╡реАрд╕реЙрдХреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред

**рд╡рд░реНрдЪреБрдЕрд▓ рд╕реЙрдХреЗрдЯ (рд╡реАрд╕реЙрдХреНрд╕)** рдПрдХ рд╕реЙрдХреЗрдЯ рдкрд░рд┐рд╡рд╛рд░ рд╣реИ рдЬреЛ рд▓рд┐рдирдХреНрд╕ рдореЗрдВ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЗрдВ (**VMs**) рдФрд░ рдЙрдирдХреЗ **рд╣рд╛рдЗрдкрд░рд╡рд╛рдЗрдЬрд╝рд░реНрд╕** рдпрд╛ VMs **рдЦреБрдж** рдХреЗ рдмреАрдЪ **рд╕рдВрд╡рд╛рдж** рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдПред Vsock рдПрдлрд┐рд╢рд┐рдПрдВрдЯ, **рджреНрд╡рд┐рджрд┐рд╢реАрдп рд╕рдВрд╡рд╛рдж** рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╛рд╡рдирд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдореЗрдЬрд╝рдмрд╛рди рдХреЗ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рд╕реНрдЯреИрдХ рдкрд░ рдирд┐рд░реНрднрд░рддрд╛ред рдЗрд╕рд╕реЗ VMs рдХреЛ рдиреЗрдЯрд╡рд░реНрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдмрд┐рдирд╛ рднреА рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрддреА рд╣реИ, **32-рдмрд┐рдЯ рд╕рдВрджрд░реНрдн рдЖрдИрдбреА (CID) рдФрд░ рдкреЛрд░реНрдЯ рдирдВрдмрд░** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдиреЗрдХреНрд╢рди рдХреА рдкрд╣рдЪрд╛рди рдФрд░ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред Vsock API рдиреЗ рд╕реНрдЯреНрд░реАрдо рдФрд░ рдбреЗрдЯрд╛рдЧреНрд░рд╛рдо рд╕реЙрдХреЗрдЯ рдкреНрд░рдХрд╛рд░ рджреЛрдиреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд┐рдпрд╛ рд╣реИ, рдЬреЛ TCP рдФрд░ UDP рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд╣реИ, рд╡рд░реНрдЪреБрдЕрд▓ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрддрд░реАрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╣реБрдореБрдЦреА рдЙрдкрдХрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред

{% hint style="success" %}
рдЗрд╕рд▓рд┐рдП, рдПрдХ vsock рдкрддрд╛ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: `<CID>:<Port>`
{% endhint %}

рдПрдиреНрдХреНрд▓реЗрд╡ рдЪрд▓ рд░рд╣реА рдЫрд╡рд┐рдпреЛрдВ рдХреЗ **CID** рдвреВрдВрдврдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдмрд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд cmd рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **`EnclaveCID`** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

<pre class="language-bash"><code class="lang-bash">nitro-cli describe-enclaves

[
{
"EnclaveName": "secure-channel-example",
"EnclaveID": "i-0bc274f83ade02a62-enc18ef3d09c886748",
"ProcessID": 10131,
<strong>    "EnclaveCID": 16,
</strong>    "NumberOfCPUs": 2,
"CPUIDs": [
1,
3
],
"MemoryMiB": 1024,
"State": "RUNNING",
"Flags": "DEBUG_MODE",
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
]
</code></pre>

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдореЗрдЬрд╝рдмрд╛рди рд╕реЗ рдХреЛрдИ рддрд░реАрдХрд╛ рдирд╣реАрдВ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХреЗ рдХрд┐ рдХреЛрдИ CID рдХреЛрдИ рдкреЛрд░реНрдЯ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд░рд╣рд╛ рд╣реИ! рдХреБрдЫ **vsock рдкреЛрд░реНрдЯ рд╕реНрдХреИрдирд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛** [**https://github.com/carlospolop/Vsock-scanner**](https://github.com/carlospolop/Vsock-scanner)ред
{% endhint %}

### Vsock рд╕рд░реНрд╡рд░/рд╕реБрдирдиреЗ рд╡рд╛рд▓рд╛

рдпрд╣рд╛рдБ рдХреБрдЫ рдЙрджрд╛рд╣рд░рдг рд╣реИрдВ:

* [https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/server.py](https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/server.py)

<details>

<summary>рд╕рд░рд▓ рдкрд╛рдпрдерди рд╕реБрдирдиреЗ рд╡рд╛рд▓рд╛</summary>
```python
#!/usr/bin/env python3

# From
https://medium.com/@F.DL/understanding-vsock-684016cf0eb0

import socket

CID = socket.VMADDR_CID_HOST
PORT = 9999

s = socket.socket(socket.AF_VSOCK, socket.SOCK_STREAM)
s.bind((CID, PORT))
s.listen()
(conn, (remote_cid, remote_port)) = s.accept()

print(f"Connection opened by cid={remote_cid} port={remote_port}")

while True:
buf = conn.recv(64)
if not buf:
break

print(f"Received bytes: {buf}")
```
</details>
```bash
# Using socat
socat VSOCK-LISTEN:<port>,fork EXEC:"echo Hello from server!"
```
### Vsock рдХреНрд▓рд╛рдЗрдВрдЯ

рдЙрджрд╛рд╣рд░рдг:

* [https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/client.py](https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/client.py)

<details>

<summary>рд╕рд░рд▓ рдкрд╛рдпрдерди рдХреНрд▓рд╛рдЗрдВрдЯ</summary>
```python
#!/usr/bin/env python3

#From https://medium.com/@F.DL/understanding-vsock-684016cf0eb0

import socket

CID = socket.VMADDR_CID_HOST
PORT = 9999

s = socket.socket(socket.AF_VSOCK, socket.SOCK_STREAM)
s.connect((CID, PORT))
s.sendall(b"Hello, world!")
s.close()
```
</details>
```bash
# Using socat
echo "Hello, vsock!" | socat - VSOCK-CONNECT:3:5000
```
### Vsock рдкреНрд░реЙрдХреНрд╕реА

рдЙрдкрдХрд░рдг vsock-proxy рдПрдХ рдЕрдиреНрдп рдкрддреЗ рдХреЗ рд╕рд╛рде рдПрдХ vsock рдкреНрд░реЙрдХреНрд╕реА рдХреЛ рдкреНрд░реЙрдХреНрд╕реА рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```bash
vsock-proxy 8001 ip-ranges.amazonaws.com 443 --config your-vsock-proxy.yaml
```
рдпрд╣ **рд╕реНрдерд╛рдиреАрдп рдкреЛрд░реНрдЯ 8001 рдХреЛ vsock рдореЗрдВ рдлреЙрд░рд╡рд░реНрдб** рдХрд░реЗрдЧрд╛ `ip-ranges.amazonaws.com:443` рдФрд░ рдлрд╝рд╛рдЗрд▓ **`your-vsock-proxy.yaml`** рдореЗрдВ рдпрд╣ рд╕рд╛рдордЧреНрд░реА рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬреЛ `ip-ranges.amazonaws.com:443` рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ:
```yaml
allowlist:
- {address: ip-ranges.amazonaws.com, port: 443}
```
рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЖрдк EC2 рд╣реЛрд╕реНрдЯ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ vsock рдкрддреЛрдВ (**`<CID>:<Port>`**) рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ (рдиреЛрдЯ рдХрд░реЗрдВ `3:8001`, 3 CID рд╣реИ рдФрд░ 8001 рдкреЛрд░реНрдЯ рд╣реИ):
```bash
sudo ss -l -p -n | grep v_str
v_str LISTEN 0      0                                                                              3:8001                   *:*     users:(("vsock-proxy",pid=9458,fd=3))
```
{% endcode %}

## рдирд╛рдЗрдЯреНрд░реЛ рдПрдиреНрдХреНрд▓реЗрд╡ рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди рдФрд░ рдХреЗрдПрдордПрд╕

рдирд╛рдЗрдЯреНрд░реЛ рдПрдиреНрдХреНрд▓реЗрд╡реНрд╕ рдПрд╕рдбреАрдХреЗ рдПрдХ рдПрдиреНрдХреНрд▓реЗрд╡ рдХреЛ рдирд╛рдЗрдЯреНрд░реЛ рд╣рд╛рдЗрдкрд░рд╡рд╛рдЗрдЬрд░ рд╕реЗ рдПрдХ **рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХрд▓реА рд╕рд╛рдЗрдиреНрдб рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди рдбреЙрдХреНрдпреВрдореЗрдВрдЯ** рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЙрд╕ рдПрдиреНрдХреНрд▓реЗрд╡ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢рд┐рд╖реНрдЯ **рдЕрджреНрд╡рд┐рддреАрдп рдорд╛рдк** рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдпреЗ рдорд╛рдк, рдЬрд┐рдирдореЗрдВ **рд╣реИрд╢ рдФрд░ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд░рдЬрд┐рд╕реНрдЯрд░реНрд╕ (рдкреАрд╕реАрдЖрд░реНрд╕)** рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдПрдиреНрдХреНрд▓реЗрд╡ рдХреА рдкрд╣рдЪрд╛рди рд╕рд╛рдмрд┐рдд рдХреА рдЬрд╛ рд╕рдХреЗ рдФрд░ рдмрд╛рд╣реНрдп рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рд╢реНрд╡рд╛рд╕ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди рдбреЙрдХреНрдпреВрдореЗрдВрдЯ рдЖрдо рддреМрд░ рдкрд░ PCR0, PCR1, рдФрд░ PCR2 рдЬреИрд╕реЗ рдорд╛рди рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рдирд╕реЗ рдЖрдкрдиреЗ рдПрдХ рдПрдиреНрдХреНрд▓реЗрд╡ рдИрдЖрдИрдПрдл рдмрдирд╛рддреЗ рдФрд░ рд╕рд╣реЗрдЬрддреЗ рд╕рдордп рдкрд╣рд▓реЗ рднреА рд╕рд╛рдордирд╛ рдХрд┐рдпрд╛ рд╣реИред

[**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-3-cryptographic-attestation#a-unique-feature-on-nitro-enclaves) рд╕реЗ, рдпреЗ рд╣реИрдВ рдкреАрд╕реАрдЖрд░ рдорд╛рди:

<table><thead><tr><th width="97">PCR</th><th width="221">... рдХрд╛ рд╣реИрд╢</th><th>рд╡рд┐рд╡рд░рдг</th></tr></thead><tbody><tr><td>PCR0</td><td>рдПрдиреНрдХреНрд▓реЗрд╡ рдЗрдореЗрдЬ рдлрд╝рд╛рдЗрд▓</td><td>рдЗрдореЗрдЬ рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдПрдХ рд▓рдЧрд╛рддрд╛рд░ рдорд╛рдк, рдмрд┐рдирд╛ рд╕реЗрдХреНрд╢рди рдбреЗрдЯрд╛ рдХреЗред</td></tr><tr><td>PCR1</td><td>рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдФрд░ рдмреВрдЯрд╕реНрдЯреНрд░реИрдк</td><td>рдХрд░реНрдиреЗрд▓ рдФрд░ рдмреВрдЯ рд░реИрдордлреНрд╕ рдбреЗрдЯрд╛ рдХрд╛ рдПрдХ рд▓рдЧрд╛рддрд╛рд░ рдорд╛рдкред</td></tr><tr><td>PCR2</td><td>рдПрдкреНрд▓рд┐рдХреЗрд╢рди</td><td>рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдПрдХ рд▓рдЧрд╛рддрд╛рд░, рдХреНрд░рдордмрджреНрдз рдорд╛рдк, рдмреВрдЯ рд░реИрдордлреНрд╕ рдХреЗ рдмрд┐рдирд╛ред</td></tr><tr><td>PCR3</td><td>рдорд╛рддрд╛ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рд╕реМрдВрдкреА рдЧрдИ IAM рднреВрдорд┐рдХрд╛</td><td>рдорд╛рддрд╛ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рд╕реМрдВрдкреА рдЧрдИ IAM рднреВрдорд┐рдХрд╛ рдХрд╛ рдПрдХ рд▓рдЧрд╛рддрд╛рд░ рдорд╛рдкред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗрд╡рд▓ рддрдм рд╣реА рд╕рдлрд▓ рд╣реЛрддреА рд╣реИ рдЬрдм рдорд╛рддрд╛ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдкрд╛рд╕ рд╕рд╣реА IAM рднреВрдорд┐рдХрд╛ рд╣реЛред</td></tr><tr><td>PCR4</td><td>рдорд╛рддрд╛ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХрд╛ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдЖрдИрдбреА</td><td>рдорд╛рддрд╛ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдЖрдИрдбреА рдХрд╛ рдПрдХ рд▓рдЧрд╛рддрд╛рд░ рдорд╛рдкред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗрд╡рд▓ рддрдм рд╣реА рд╕рдлрд▓ рд╣реЛрддреА рд╣реИ рдЬрдм рдорд╛рддрд╛ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдкрд╛рд╕ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдЖрдИрдбреА рд╣реЛред</td></tr><tr><td>PCR8</td><td>рдПрдиреНрдХреНрд▓реЗрд╡ рдЗрдореЗрдЬ рдлрд╝рд╛рдЗрд▓ рд╕рд╛рдЗрдирд┐рдВрдЧ рд╕рд░реНрдЯрд┐рдлрд╝рд┐рдХреЗрдЯ</td><td>рдПрдиреНрдХреНрд▓реЗрд╡ рдЗрдореЗрдЬ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕рд╛рдЗрдирд┐рдВрдЧ рд╕рд░реНрдЯрд┐рдлрд╝рд┐рдХреЗрдЯ рдХрд╛ рдорд╛рдкред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗрд╡рд▓ рддрдм рд╣реА рд╕рдлрд▓ рд╣реЛрддреА рд╣реИ рдЬрдм рдПрдиреНрдХреНрд▓реЗрд╡ рдХреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рд░реНрдЯрд┐рдлрд╝рд┐рдХреЗрдЯ рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдЗрди рдХрд┐рдП рдЧрдП рдПрдиреНрдХреНрд▓реЗрд╡ рдЗрдореЗрдЬ рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдмреВрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред</td></tr></tbody></table>

рдЖрдк рдЕрдкрдиреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ **рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХрд▓ рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди** рдХреЛ рдПрдХреАрдХреГрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **AWS KMS** рдЬреИрд╕реА рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рд╛рде рдкреВрд░реНрд╡-рдирд┐рд░реНрдорд┐рдд рдПрдХреАрдХрд░рдг рдХрд╛ рд▓рд╛рдн рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВред AWS KMS рдПрдиреНрдХреНрд▓реЗрд╡ рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди рдХреЛ **рд╕рддреНрдпрд╛рдкрд┐рдд** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреА рдХреБрдВрдЬреА рдиреАрддрд┐рдпреЛрдВ рдореЗрдВ рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди-рдЖрдзрд╛рд░рд┐рдд рд╕реНрдерд┐рддрд┐рд╢реБрд▓реНрдХ рдХреБрдВрдЬрд┐рдпрд╛рдБ (`kms:RecipientAttestation:ImageSha384` рдФрд░ `kms:RecipientAttestation:PCR`) рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпреЗ рдиреАрддрд┐рдпрд╛рдБ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИрдВ рдХрд┐ AWS KMS рдХреЗрд╡рд▓ рдЙрд╕ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЕрдЧрд░ рдПрдиреНрдХреНрд▓реЗрд╡ рдХрд╛ рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди рдбреЙрдХреНрдпреВрдореЗрдВрдЯ рдорд╛рдиреНрдп рд╣реИ** рдФрд░ **рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╢рд░реНрддреЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИ** рддреЛ рд╣реА рд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдЧрд╛ред

{% hint style="success" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдбреАрдмрдЧ (--debug) рдореЛрдб рдореЗрдВ рдПрдиреНрдХреНрд▓реЗрд╡реНрд╕ рдЙрди рдкреАрд╕реАрдЖрд░ рдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рдЕрдЯреЗрд╕реНрдЯреЗрд╢рди рдбреЙрдХреНрдпреВрдореЗрдВрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рд╢реВрдиреНрдпреЛрдВ рд╕реЗ рдмрдиреЗ рд╣реЛрддреЗ рд╣реИрдВ (`000000000000000000000000000000000000000000000000`)ред рдЗрд╕рд▓рд┐рдП, рдЗрди рдорд╛рдиреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рд╡рд╛рд▓реА KMS рдиреАрддрд┐рдпрд╛рдБ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдВрдЧреАред
{% endhint %}

### PCR рдмрд╛рдЗрдкрд╛рд╕

рд╣рдорд▓рд╛рд╡рд░ рдХреА рджреГрд╖реНрдЯрд┐ рд╕реЗ, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреБрдЫ рдкреАрд╕реАрдЖрд░ рдорд╛рдиреЛрдВ рдХреЛ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреЗ рдФрд░ рдПрдиреНрдХреНрд▓реЗрд╡ рдЗрдореЗрдЬ рдХреЗ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЗ рдпрд╛ рд╕рднреА рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рд╡реИрдз рдорд╛рдирд╛ рдЬрд╛рдПрдЧрд╛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП PCR4 рдХреЗрд╡рд▓ рдорд╛рддрд╛ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдЖрдИрдбреА рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдЗрд╕рд▓рд┐рдП рдЙрд╕ EC2 рдореЗрдВ рдХрд┐рд╕реА рднреА рдПрдиреНрдХреНрд▓реЗрд╡ рдЗрдореЗрдЬ рдХреЛ рдЪрд▓рд╛рдиреЗ рд╕реЗ рдЗрд╕ рд╕рдВрднрд╛рд╡рд┐рдд PCR рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛)ред

рдЗрд╕рд▓рд┐рдП, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЬреЛ EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдХрд░рддрд╛ рд╣реИ, рд╡рд╣ рдЗрди рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рдЙрд▓реНрд▓рдВрдШрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рдПрдиреНрдХреНрд▓реЗрд╡ рдЗрдореЗрдЬ рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИред

рд╣рд░ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдХреЛ рдЙрд▓реНрд▓рдВрдШрди рдХрд░рдиреЗ/рдирдП рдЗрдореЗрдЬ рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдиреБрд╕рдВрдзрд╛рди рдЕрднреА рднреА рдХрд░рдирд╛ рдмрд╛рдХреА рд╣реИред

## рд╕рдВрджрд░реНрдн

* [https://medium.com/@F.DL/understanding-vsock-684016cf0eb0](https://medium.com/@F.DL/understanding-vsock-684016cf0eb0)
* AWS рдХреЗ рдирд╛рдЗрдЯреНрд░реЛ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдХреЗ рд╕рднреА рд╣рд┐рд╕реНрд╕реЗ: [https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░** **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ **HackTricks** рдФрд░ **HackTricks Cloud** github рд░реЗрдкреЛ рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>
