# AWS - Enum√©ration de la passerelle API

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'exclusivit√©s [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Passerelle API

### Informations de base

AWS API Gateway est un service enti√®rement g√©r√© fourni par Amazon Web Services (AWS) qui vous permet de cr√©er, publier, maintenir, surveiller et s√©curiser des **API (interfaces de programmation d'applications) √† n'importe quelle √©chelle**. API Gateway agit comme une **"porte d'entr√©e"** pour les applications afin d'acc√©der aux donn√©es, √† la logique m√©tier ou aux fonctionnalit√©s de vos services backend, tels que les charges de travail s'ex√©cutant sur Amazon Elastic Compute Cloud (**EC2**), AWS **Lambda**, ou toute **application web**.

API Gateway vous permet de d√©finir **comment les demandes √† vos API doivent √™tre trait√©es**, et il peut cr√©er des points de terminaison d'API personnalis√©s avec des m√©thodes sp√©cifiques (par exemple, GET, POST, PUT, DELETE) et des ressources. Il peut √©galement g√©n√©rer des SDK client (kits de d√©veloppement logiciel) pour faciliter l'appel de vos API par les d√©veloppeurs √† partir de leurs applications.

### Types de passerelles API

* **API HTTP** : Cr√©ez des API REST √† faible latence et rentables avec des fonctionnalit√©s int√©gr√©es telles que OIDC et OAuth2, et une prise en charge CORS native. Fonctionne avec les √©l√©ments suivants : Lambda, backends HTTP.
* **API WebSocket** : Cr√©ez une API WebSocket en utilisant des connexions persistantes pour des cas d'utilisation en temps r√©el tels que les applications de chat ou les tableaux de bord. Fonctionne avec les √©l√©ments suivants : Lambda, HTTP, services AWS.
* **API REST** : D√©veloppez une API REST o√π vous avez un contr√¥le complet sur la demande et la r√©ponse ainsi que des capacit√©s de gestion d'API. Fonctionne avec les √©l√©ments suivants : Lambda, HTTP, services AWS.
* **API REST priv√©e** : Cr√©ez une API REST qui n'est accessible que depuis un VPC.

### Principaux composants de la passerelle API

1. **Ressources** : Dans API Gateway, les ressources sont les composants qui **constituent la structure de votre API**. Ils repr√©sentent **les diff√©rents chemins ou points de terminaison** de votre API et correspondent aux diff√©rentes actions que votre API prend en charge. Une ressource est chaque m√©thode (par exemple, GET, POST, PUT, DELETE) **√† l'int√©rieur de chaque chemin** (/, ou /users, ou /user/{id}.
2. **Stages** : Les √©tapes dans API Gateway repr√©sentent **diff√©rentes versions ou environnements** de votre API, tels que le d√©veloppement, la mise en sc√®ne ou la production. Vous pouvez utiliser des √©tapes pour g√©rer et d√©ployer **plusieurs versions de votre API simultan√©ment**, ce qui vous permet de tester de nouvelles fonctionnalit√©s ou des correctifs de bogues sans affecter l'environnement de production. Les √©tapes prennent √©galement en charge les **variables d'√©tape**, qui sont des paires cl√©-valeur qui peuvent √™tre utilis√©es pour configurer le comportement de votre API en fonction de l'√©tape actuelle. Par exemple, vous pourriez utiliser des variables d'√©tape pour diriger les demandes d'API vers diff√©rentes fonctions Lambda ou autres services backend en fonction de l'√©tape.
   * L'√©tape est indiqu√©e au d√©but de l'URL du point de terminaison de la passerelle API.
3. **Authorizers** : Les authorizers dans API Gateway sont responsables de **contr√¥ler l'acc√®s √† votre API** en v√©rifiant l'identit√© de l'appelant avant de permettre √† la demande de se poursuivre. Vous pouvez utiliser des **fonctions Lambda AWS** en tant qu'authorizers personnalis√©s, ce qui vous permet de mettre en ≈ìuvre votre propre logique d'authentification et d'autorisation. Lorsqu'une demande arrive, API Gateway transmet le jeton d'autorisation de la demande √† l'authorizer Lambda, qui traite le jeton et renvoie une strat√©gie IAM qui d√©termine les actions que l'appelant est autoris√© √† effectuer. API Gateway prend √©galement en charge les **authorizers int√©gr√©s**, tels que **AWS Identity and Access Management (IAM)** et **Amazon Cognito**.
4. **Resource Policy** : Une politique de ressource dans API Gateway est un document JSON qui **d√©finit les autorisations d'acc√®s √† votre API**. Elle est similaire √† une politique IAM mais sp√©cifiquement adapt√©e √† API Gateway. Vous pouvez utiliser une politique de ressource pour contr√¥ler qui peut acc√©der √† votre API, quelles m√©thodes ils peuvent appeler et √† partir de quelles adresses IP ou VPC ils peuvent se connecter. **Les politiques de ressources peuvent √™tre utilis√©es en combinaison avec des authorizers** pour fournir un contr√¥le d'acc√®s granulaire pour votre API.
   * Pour que l'API prenne effet, elle doit √™tre **d√©ploy√©e √† nouveau apr√®s** que la politique de ressource a √©t√© modifi√©e.

### Journalisation

Par d√©faut, les
### Cl√© API requise

Il est possible de d√©finir des points d'extr√©mit√© d'API qui **requi√®rent une cl√© API valide** pour y acc√©der.

<figure><img src="../../../.gitbook/assets/image (92) (1).png" alt=""><figcaption></figcaption></figure>

Il est possible de g√©n√©rer des cl√©s API dans le portail API Gateway et m√™me de d√©finir leur utilisation maximale (en termes de requ√™tes par seconde et en termes de requ√™tes par mois).

## Acc√®s non authentifi√©

{% content-ref url="../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md" %}
[aws-api-gateway-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md)
{% endcontent-ref %}

## Privil√®ge d'escalade

{% content-ref url="../aws-privilege-escalation/aws-apigateway-privesc.md" %}
[aws-apigateway-privesc.md](../aws-privilege-escalation/aws-apigateway-privesc.md)
{% endcontent-ref %}

## Post-exploitation

{% content-ref url="../aws-post-exploitation/aws-api-gateway-post-exploitation.md" %}
[aws-api-gateway-post-exploitation.md](../aws-post-exploitation/aws-api-gateway-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts Github.**

</details>