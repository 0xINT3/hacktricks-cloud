# AWS - API Gateway Enum

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## API Gateway

### рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

AWS API Gateway рдПрдХ рдкреВрд░реНрдг рдкреНрд░рдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ Amazon Web Services (AWS) рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИ, рдЬреЛ рдЖрдкрдХреЛ **APIs (Application Programming Interfaces) рдХреЛ рдХрд┐рд╕реА рднреА рдкреИрдорд╛рдиреЗ рдкрд░** рдмрдирд╛рдиреЗ, рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░рдиреЗ, рдмрдирд╛рдП рд░рдЦрдиреЗ, рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреЗ рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред API Gateway рдЖрдкрдХреЗ рдмреИрдХрдПрдВрдб рд╕реЗрд╡рд╛рдУрдВ рд╕реЗ рдбреЗрдЯрд╛, рд╡реНрдпрд╛рдкрд╛рд░ рддрд░реНрдХ, рдпрд╛ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ **"рдлреНрд░рдВрдЯ рдбреЛрд░"** рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ Amazon Elastic Compute Cloud (**EC2**), AWS **Lambda**, рдпрд╛ рдХреЛрдИ рднреА **рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдкрд░ рдЪрд▓ рд░рд╣реЗ рдХрд╛рд░реНрдпрднрд╛рд░ред

API Gateway рдЖрдкрдХреЛ рдпрд╣ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ APIs рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдХреИрд╕реЗ рд╕рдВрднрд╛рд▓рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдпрд╣ рд╡рд┐рд╢рд┐рд╖реНрдЯ рддрд░реАрдХреЛрдВ (рдЬреИрд╕реЗ рдХрд┐ GET, POST, PUT, DELETE) рдФрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╕реНрдЯрдо API рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛ рдЙрдирдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рд╕реЗ рдЖрдкрдХреЗ APIs рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЗрдВрдЯ SDKs (Software Development Kits) рднреА рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### API Gateways рдХреЗ рдкреНрд░рдХрд╛рд░

* **HTTP API**: рдХрдо рд╡рд┐рд▓рдВрдмрддрд╛ рдФрд░ рд▓рд╛рдЧрдд рдкреНрд░рднрд╛рд╡реА REST APIs рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ OIDC рдФрд░ OAuth2 рдЬреИрд╕реА рдмрд┐рд▓реНрдЯ-рдЗрди рд╕реБрд╡рд┐рдзрд╛рдПрдБ рд╣реЛрддреА рд╣реИрдВ, рдФрд░ рдиреЗрдЯрд┐рд╡ CORS рд╕рдорд░реНрдерди рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: Lambda, HTTP рдмреИрдХрдПрдВрдбреНрд╕ред
* **WebSocket API**: рдЪреИрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдпрд╛ рдбреИрд╢рдмреЛрд░реНрдбреНрд╕ рдЬреИрд╕реЗ рд░рд┐рдпрд▓-рдЯрд╛рдЗрдо рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдкрд░реНрд╕рд┐рд╕реНрдЯреЗрдВрдЯ рдХрдиреЗрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ WebSocket API рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВред рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: Lambda, HTTP, AWS Servicesред
* **REST API**: рдПрдХ REST API рдХрд╛ рд╡рд┐рдХрд╛рд╕ рдХрд░реЗрдВ рдЬрд╣рд╛рдБ рдЖрдкрдХреЛ рдЕрдиреБрд░реЛрдз рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде-рд╕рд╛рде API рдкреНрд░рдмрдВрдзрди рдХреНрд╖рдорддрд╛рдУрдВ рдкрд░ рдкреВрд░рд╛ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: Lambda, HTTP, AWS Servicesред
* **REST API Private**: рдПрдХ REST API рдмрдирд╛рдПрдВ рдЬреЛ рдХреЗрд╡рд▓ VPC рдХреЗ рднреАрддрд░ рд╕реЗ рд╣реА рд╕реБрд▓рдн рд╣реЛред

### API Gateway рдореБрдЦреНрдп рдШрдЯрдХ

1. **Resources**: API Gateway рдореЗрдВ, resources рд╡реЗ рдШрдЯрдХ рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ **рдЖрдкрдХреЗ API рдХреА рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдмрдирд╛рддреЗ рд╣реИрдВ**ред рд╡реЗ **рдЖрдкрдХреЗ API рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдкрдереЛрдВ рдпрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреЗ рд╣реИрдВ** рдФрд░ рдЖрдкрдХреЗ API рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рд╡рд┐рднрд┐рдиреНрди рдХреНрд░рд┐рдпрд╛рдУрдВ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреЗ рд╣реИрдВред рдПрдХ resource рдкреНрд░рддреНрдпреЗрдХ рд╡рд┐рдзрд┐ (рдЬреИрд╕реЗ рдХрд┐ GET, POST, PUT, DELETE) рд╣реЛрддреА рд╣реИ **рдкреНрд░рддреНрдпреЗрдХ рдкрде рдХреЗ рдЕрдВрджрд░** (/, рдпрд╛ /users, рдпрд╛ /user/{id}).
2. **Stages**: API Gateway рдореЗрдВ Stages рдЖрдкрдХреЗ API рдХреЗ **рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдпрд╛ рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреЗ рд╣реИрдВ**, рдЬреИрд╕реЗ рдХрд┐ рд╡рд┐рдХрд╛рд╕, рд╕реНрдЯреЗрдЬрд┐рдВрдЧ, рдпрд╛ рдЙрддреНрдкрд╛рджрдиред рдЖрдк рд╕реНрдЯреЗрдЬреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ API рдХреЗ **рдХрдИ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рдПрдХ рд╕рд╛рде рдкреНрд░рдмрдВрдзрд┐рдд рдФрд░ рддреИрдирд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдЬрд┐рд╕рд╕реЗ рдЖрдк рдЙрддреНрдкрд╛рджрди рд╡рд╛рддрд╛рд╡рд░рдг рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд┐рдП рдмрд┐рдирд╛ рдирдИ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдпрд╛ рдмрдЧ рдлрд┐рдХреНрд╕реЗрд╕ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред Stages рдпрд╣ рднреА **рд╕реНрдЯреЗрдЬ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВ**, рдЬреЛ рдХрд┐ рдХреБрдВрдЬреА-рдореВрд▓реНрдп рдЬреЛрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд░реНрддрдорд╛рди рд╕реНрдЯреЗрдЬ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЖрдкрдХреЗ API рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рд╕реНрдЯреЗрдЬ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╕реНрдЯреЗрдЬреЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрд▓рдЧ-рдЕрд▓рдЧ Lambda рдлрдВрдХреНрд╢рдиреНрд╕ рдпрд╛ рдЕрдиреНрдп рдмреИрдХрдПрдВрдб рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП API рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* рд╕реНрдЯреЗрдЬ API Gateway рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ URL рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рджрд░реНрд╢рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
3. **Authorizers**: API Gateway рдореЗрдВ Authorizers рдЖрдкрдХреЗ API рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ **рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВ** рдЕрдиреБрд░реЛрдз рдХреЛ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреЙрд▓рд░ рдХреА рдкрд╣рдЪрд╛рди рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдХреЗред рдЖрдк **AWS Lambda рдлрдВрдХреНрд╢рдиреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд╕реНрдЯрдо authorizers рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдЖрдкрдХреЛ рдЕрдкрдиреА рд╕реНрд╡рдпрдВ рдХреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдЕрдзрд┐рдХрд╛рд░реАрдХрд░рдг рддрд░реНрдХ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЬрдм рдПрдХ рдЕрдиреБрд░реЛрдз рдЖрддрд╛ рд╣реИ, рддреЛ API Gateway рдЕрдиреБрд░реЛрдз рдХреЗ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдЯреЛрдХрди рдХреЛ Lambda authorizer рдХреЛ рдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЯреЛрдХрди рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ IAM рдиреАрддрд┐ рд╡рд╛рдкрд╕ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рдХреЙрд▓рд░ рдХреНрдпрд╛ рдХреНрд░рд┐рдпрд╛рдПрдВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред API Gateway **рдмрд┐рд▓реНрдЯ-рдЗрди authorizers** рдХрд╛ рднреА рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ **AWS Identity and Access Management (IAM)** рдФрд░ **Amazon Cognito**ред
4. **Resource Policy**: API Gateway рдореЗрдВ рдПрдХ resource policy рдПрдХ JSON рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╣реЛрддреА рд╣реИ рдЬреЛ **рдЖрдкрдХреЗ API рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИ**ред рдпрд╣ рдПрдХ IAM рдиреАрддрд┐ рдХреЗ рд╕рдорд╛рди рд╣реЛрддреА рд╣реИ рд▓реЗрдХрд┐рди рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ API Gateway рдХреЗ рд▓рд┐рдП рдмрдирд╛рдИ рдЧрдИ рд╣реЛрддреА рд╣реИред рдЖрдк рдПрдХ resource policy рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рдЖрдкрдХреЗ API рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ, рд╡реЗ рдХреМрди рд╕реА рд╡рд┐рдзрд┐рдпрд╛рдВ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдХрд┐рди IP рдкрддреЛрдВ рдпрд╛ VPCs рд╕реЗ рд╡реЗ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред **Resource policies рдХрд╛ рдЙрдкрдпреЛрдЧ authorizers рдХреЗ рд╕рд╛рде рд╕рдВрдпреЛрдЬрди рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** рдЖрдкрдХреЗ API рдХреЗ рд▓рд┐рдП рд╕реВрдХреНрд╖реНрдо рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
* Resource policy рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ **рдмрд╛рдж API рдХреЛ рдлрд┐рд░ рд╕реЗ рддреИрдирд╛рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП** рддрд╛рдХрд┐ рдпрд╣ рдкреНрд░рднрд╛рд╡реА рд╣реЛ рд╕рдХреЗред

### рд▓реЙрдЧрд┐рдВрдЧ

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, **CloudWatch Logs** **рдмрдВрдж** рд╣реЛрддреЗ рд╣реИрдВ, **Access Logging** рднреА **рдмрдВрдж** рд╣реЛрддреА рд╣реИ, рдФрд░ **X-Ray tracing** рднреА **рдмрдВрдж** рд╣реЛрддреА рд╣реИред

### рд╕реВрдЪреАрдХрд░рдг

{% hint style="success" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛрдиреЛрдВ AWS apis (**`apigateway`** рдФрд░ **`apigatewayv2`**) рдореЗрдВ рдЖрдкрдХреЛ рдЬрд┐рд╕ рдПрдХрдорд╛рддреНрд░ рдЕрдиреБрдорддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдФрд░ рдПрдХрдорд╛рддреНрд░ рдкрдарди рдЕрдиреБрдорддрд┐ рджреЗрдп рд╣реЛрддреА рд╣реИ рд╡рд╣ рд╣реИ **`apigateway:GET`**, рдЗрд╕рдХреЗ рд╕рд╛рде рдЖрдк **рд╕рдм рдХреБрдЫ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**
{% endhint %}

{% tabs %}
{% tab title="apigateway" %}
```bash
# Generic info
aws apigateway get-account
aws apigateway get-domain-names
aws apigateway get-usage-plans
aws apigateway get-vpc-links
aws apigateway get-client-certificates

# Enumerate APIs
aws apigateway get-rest-apis # This will also show the resource policy (if any)
## Get stages
aws apigateway get-stages --rest-api-id <id>
## Get resources
aws apigateway get-resources --rest-api-id <id>
## Get API resource action per HTTP verb (check authorizers and api key required)
aws apigateway get-method --http-method GET --rest-api-id <api-id> --resource-id <resource-id>

## Call API
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>
## API authorizers
aws apigateway get-authorizers --rest-api-id <id>
## Models
aws apigateway get-models --rest-api-id <id>
## More info
aws apigateway get-gateway-responses --rest-api-id <id>
aws apigateway get-request-validators --rest-api-id <id>
aws apigateway get-deployments --rest-api-id <id>

# Get api keys generated
aws apigateway get-api-keys --include-value
aws apigateway get-api-key --api-key <id> --include-value # Get just 1
## Example use API key
curl -X GET -H "x-api-key: AJE&Ygenu4[..]" https://e83uuftdi8.execute-api.us-east-1.amazonaws.com/dev/test
## Usage plans
aws apigateway get-usage-plans #Get limit use info
aws apigateway get-usage-plan-keys --usage-plan-id <plan_id> #Get clear text values of api keys
aws apigateway get-usage-plan-key --usage-plan-id <plan_id> --key-id <key_id>
###Already consumed
aws apigateway get-usage --usage-plan-id <plan_id> --start-date 2023-07-01 --end-date 2023-07-12
```
{% endtab %}

{% tab title="apigatewayv2" %}
```bash
# Generic info
aws apigatewayv2 get-account --
aws apigatewayv2 get-domain-names
aws apigatewayv2 get-domain-name --domain-name <name>
aws apigatewayv2 get-usage-plans --
aws apigatewayv2 get-vpc-links
aws apigatewayv2 get-client-certificates --

# Enumerate APIs
aws apigatewayv2 get-apis # This will also show the resource policy (if any)
aws apigatewayv2 get-api --api-id <id>

## Get all the info from an api at once
aws apigatewayv2 export-api --api-id <id> --output-type YAML --specification OAS30 /tmp/api.yaml

## Get stages
aws apigatewayv2 get-stages --api-id <id>

## Get routes
aws apigatewayv2 get-routes --api-id <id>
aws apigatewayv2 get-route --api-id <id> --route-id <route-id>

## Get deployments
aws apigatewayv2 get-deployments --api-id <id>
aws apigatewayv2 get-deployment --api-id <id> --deployment-id <dep-id>

## Get integrations
aws apigatewayv2 get-integrations --api-id <id>

## Get authorizers
aws apigatewayv2 get-authorizers --api-id <id>
aws apigatewayv2 get-authorizer --api-id <id> --authorizer-id <uth-id>

## Get domain mappings
aws apigatewayv2 get-api-mappings --api-id <id> --domain-name <dom-name>
aws apigatewayv2 get-api-mapping --api-id <id> --api-mapping-id <map-id> --domain-name <dom-name>

## Get models
aws apigatewayv2 get-models --api-id <id>

## Call API
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>
```
{% endtab %}
{% endtabs %}

## API Gateway рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рд╛рдзрд┐рдХрд░рдг

### Resource Policy

рд░рд┐рд╕реЛрд░реНрд╕ рдкреЙрд▓рд┐рд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╣ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдХреМрди API рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдирд┐рд░реНрджрд┐рд╖реНрдЯ IP рдПрдВрдбрдкреЙрдЗрдВрдЯ `/resource_policy` рдХреЛ GET рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЙрд▓ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛**ред

<figure><img src="../../../.gitbook/assets/image (92) (1) (1).png" alt=""><figcaption></figcaption></figure>

### IAM Authorizer

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ рдкрде (рд░рд┐рд╕реЛрд░реНрд╕) рдХреЗ рдЕрдВрджрд░ рдХреА рдореЗрдердбреНрд╕ рдХреЛ IAM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЗрд╕реЗ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

<figure><img src="https://lh3.googleusercontent.com/GGx-kfqNXu6zMqGidnO8_eR88fYPpJG-wNuBBnedAJntiRUEPTEScl7OvWthGYRiI_msYCdC6oBFvJc827Tb4-4UogxpOyrEXyst-8IDzP9DC2NOtXSY7w58L0baCAcBQjSyvBhJREvWWCtiboNYPSKuEw=s2048" alt=""><figcaption></figcaption></figure>

рдЬрдм рдпрд╣ рд╕реЗрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЖрдкрдХреЛ рддреНрд░реБрдЯрд┐ `{"message":"Missing Authentication Token"}` рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧреА рдЬрдм рдЖрдк рдмрд┐рдирд╛ рдХрд┐рд╕реА рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЗ рдПрдВрдбрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВрдЧреЗред

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рдЕрдкреЗрдХреНрд╖рд┐рдд рдЯреЛрдХрди рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ **Postman** рдХреЗ рдЕрдВрджрд░ **`Authorization`** рдкреНрд░рдХрд╛рд░ **`AWS Signature`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред

<figure><img src="../../../.gitbook/assets/image (3) (1) (3).png" alt=""><figcaption></figcaption></figure>

рдЖрдк рдЬрд┐рд╕ рдЦрд╛рддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЙрд╕рдХреА accessKey рдФрд░ SecretKey рд╕реЗрдЯ рдХрд░реЗрдВ рдФрд░ рдЖрдк API рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рдПрдХ **Authorization** **header** рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ рдЬреИрд╕реЗ:
```
AWS4-HMAC-SHA256 Credential=AKIAYY7XU6ECUDOTWB7W/20220726/us-east-1/execute-api/aws4_request, SignedHeaders=host;x-amz-date, Signature=9f35579fa85c0d089c5a939e3d711362e92641e8c14cc571df8c71b4bc62a5c2
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЕрдиреНрдп рдорд╛рдорд▓реЛрдВ рдореЗрдВ **Authorizer** рдХреЛ **рдЦрд░рд╛рдм рддрд░реАрдХреЗ рд╕реЗ рдХреЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛** рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХреЗрд╡рд▓ **Authorization header** рдореЗрдВ **рдХреБрдЫ рднреА рднреЗрдЬрдиреЗ рд╕реЗ** **рдЫрд┐рдкреА рд╣реБрдИ рд╕рд╛рдордЧреНрд░реА рджреЗрдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ**ред

### рдкрд╛рдпрдерди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреБрд░реЛрдз рд╣рд╕реНрддрд╛рдХреНрд╖рд░
```python

pip install requests
pip install requests-aws4auth
pip install boto3

import boto3
import requests
from requests_aws4auth import AWS4Auth

region = 'us-east-1'  # Region
service = 'execute-api'
access_key = 'YOUR_ACCESS_KEY'
secret_key = 'YOUR_SECRET_KEY'

url = 'https://<apiid>.execute-api.us-east-1.amazonaws.com/<stage>/<resource>'

session = boto3.Session(aws_access_key_id=access_key, aws_secret_access_key=secret_key)
credentials = session.get_credentials()
awsauth = AWS4Auth(credentials.access_key, credentials.secret_key, region, service, session_token=credentials.token)

response = requests.get(url, auth=awsauth)

print(response.text)

```
### рдХрд╕реНрдЯрдо рд▓реИрдореНрдмреНрдбрд╛ рдСрдерд░рд╛рдЗрдЬрд╝рд░

рдПрдХ рд▓реИрдореНрдмреНрдбрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рдВрднрд╡ рд╣реИ рдЬреЛ рджрд┐рдП рдЧрдП рдЯреЛрдХрди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ **IAM рдкреЙрд▓рд┐рд╕реА рд▓реМрдЯрд╛рдПрдЧрд╛** рдЬреЛ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдЧрд╛ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **API рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ рдпрд╛ рдирд╣реАрдВ**ред\
рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рд░рд┐рд╕реЛрд░реНрд╕ рдореЗрдердб рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдСрдерд░рд╛рдЗрдЬрд╝рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред

<details>

<summary>рд▓реИрдореНрдмреНрдбрд╛ рдСрдерд░рд╛рдЗрдЬрд╝рд░ рдХреЛрдб рдЙрджрд╛рд╣рд░рдг</summary>
```python
import json

def lambda_handler(event, context):
token = event['authorizationToken']
method_arn = event['methodArn']

if not token:
return {
'statusCode': 401,
'body': 'Unauthorized'
}

try:
# Replace this with your own token validation logic
if token == "your-secret-token":
return generate_policy('user', 'Allow', method_arn)
else:
return generate_policy('user', 'Deny', method_arn)
except Exception as e:
print(e)
return {
'statusCode': 500,
'body': 'Internal Server Error'
}

def generate_policy(principal_id, effect, resource):
policy = {
'principalId': principal_id,
'policyDocument': {
'Version': '2012-10-17',
'Statement': [
{
'Action': 'execute-api:Invoke',
'Effect': effect,
'Resource': resource
}
]
}
}
return policy
```
</details>

рдЗрд╕реЗ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХреЙрд▓ рдХрд░реЗрдВ:

<pre class="language-bash" data-overflow="wrap"><code class="lang-bash"><strong>curl "https://jhhqafgh6f.execute-api.eu-west-1.amazonaws.com/prod/custom_auth" -H 'Authorization: your-secret-token'
</strong></code></pre>

{% hint style="warning" %}
Lambda рдХреЛрдб рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдпрд╣ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ
{% endhint %}

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ **рдирдХрд╛рд░рд╛рддреНрдордХ рдиреАрддрд┐ рдЙрддреНрдкрдиреНрди рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рд╡рд╛рдкрд╕ рдХреА рдЬрд╛рддреА рд╣реИ** рддреЛ API Gateway рджреНрд╡рд╛рд░рд╛ рд▓реМрдЯрд╛рдИ рдЧрдИ рддреНрд░реБрдЯрд┐ рд╣реИ: `{"Message":"User is not authorized to access this resource with an explicit deny"}`

рдЗрд╕ рддрд░рд╣ рдЖрдк **рдЗрд╕ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдкрд╣рдЪрд╛рди** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рдЖрд╡рд╢реНрдпрдХ API рдХреБрдВрдЬреА

API рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЬреЛ **рдорд╛рдиреНрдп API рдХреБрдВрдЬреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛** рд╣реЛрддреА рд╣реИред

<figure><img src="../../../.gitbook/assets/image (92) (1).png" alt=""><figcaption></figcaption></figure>

API Gateway рдкреЛрд░реНрдЯрд▓ рдореЗрдВ API рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдпрд╣ рд╕реЗрдЯ рдХрд░рдирд╛ рдХрд┐ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рддрдирд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдФрд░ рдкреНрд░рддрд┐ рдорд╛рд╣ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ)ред

API рдХреБрдВрдЬреА рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЗрд╕реЗ **Usage Plan** рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛, рдЗрд╕ usage plan рдХреЛ **API Stage** рд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд API stage рдХреЛ **рдПрдВрдбрдкреЙрдЗрдВрдЯ** рдкрд░ **method throttling** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ API рдХреБрдВрдЬреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдкрд╣реБрдБрдЪ

{% content-ref url="../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md" %}
[aws-api-gateway-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md)
{% endcontent-ref %}

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-apigateway-privesc.md" %}
[aws-apigateway-privesc.md](../aws-privilege-escalation/aws-apigateway-privesc.md)
{% endcontent-ref %}

## рдкреЛрд╕реНрдЯ рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди

{% content-ref url="../aws-post-exploitation/aws-api-gateway-post-exploitation.md" %}
[aws-api-gateway-post-exploitation.md](../aws-post-exploitation/aws-api-gateway-post-exploitation.md)
{% endcontent-ref %}

### рдкрд░реНрд╕рд┐рд╕реНрдЯреЗрдВрд╕

{% content-ref url="../aws-persistence/aws-api-gateway-persistence.md" %}
[aws-api-gateway-persistence.md](../aws-persistence/aws-api-gateway-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ**.
* **HackTricks** рдХреЛ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
