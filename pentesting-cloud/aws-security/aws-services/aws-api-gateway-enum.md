# AWS - Enumera√ß√£o do API Gateway

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## API Gateway

### Informa√ß√µes b√°sicas

O AWS API Gateway √© um servi√ßo totalmente gerenciado fornecido pela Amazon Web Services (AWS) que permite criar, publicar, manter, monitorar e proteger **APIs (Interfaces de Programa√ß√£o de Aplicativos) em qualquer escala**. O API Gateway atua como uma **"porta de entrada"** para aplicativos acessarem dados, l√≥gica de neg√≥cios ou funcionalidades de seus servi√ßos de backend, como cargas de trabalho em execu√ß√£o no Amazon Elastic Compute Cloud (**EC2**), AWS **Lambda** ou qualquer **aplicativo da web**.

O API Gateway permite definir **como as solicita√ß√µes √†s suas APIs devem ser tratadas**, e pode criar pontos de extremidade de API personalizados com m√©todos espec√≠ficos (por exemplo, GET, POST, PUT, DELETE) e recursos. Ele tamb√©m pode gerar SDKs de cliente (Kits de Desenvolvimento de Software) para facilitar para os desenvolvedores chamar suas APIs de seus aplicativos.

### Tipos de API Gateways

* **HTTP API**: Crie APIs REST de baixa lat√™ncia e baixo custo com recursos integrados, como OIDC e OAuth2, e suporte CORS nativo. Funciona com o seguinte: Lambda, back-ends HTTP.
* **WebSocket API**: Crie uma API WebSocket usando conex√µes persistentes para casos de uso em tempo real, como aplicativos de bate-papo ou pain√©is. Funciona com o seguinte: Lambda, HTTP, servi√ßos AWS.
* **REST API**: Desenvolva uma API REST onde voc√™ tem controle completo sobre a solicita√ß√£o e a resposta, juntamente com recursos de gerenciamento de API. Funciona com o seguinte: Lambda, HTTP, servi√ßos AWS.
* **REST API Privada**: Crie uma API REST que s√≥ pode ser acessada de dentro de uma VPC.

### Principais componentes do API Gateway

1. **Recursos**: No API Gateway, os recursos s√£o os componentes que **comp√µem a estrutura de sua API**. Eles representam **os diferentes caminhos ou pontos finais** de sua API e correspondem √†s v√°rias a√ß√µes que sua API suporta. Um recurso √© cada m√©todo (por exemplo, GET, POST, PUT, DELETE) **dentro de cada caminho** (/, ou /usu√°rios, ou /usu√°rio/{id}.
2. **Est√°gios**: Os est√°gios no API Gateway representam **diferentes vers√µes ou ambientes** de sua API, como desenvolvimento, prepara√ß√£o ou produ√ß√£o. Voc√™ pode usar est√°gios para gerenciar e implantar **v√°rias vers√µes de sua API simultaneamente**, permitindo que voc√™ teste novos recursos ou corre√ß√µes de bugs sem afetar o ambiente de produ√ß√£o. Os est√°gios tamb√©m **suportam vari√°veis de est√°gio**, que s√£o pares de chave-valor que podem ser usados para configurar o comportamento de sua API com base no est√°gio atual. Por exemplo, voc√™ pode usar vari√°veis de est√°gio para direcionar solicita√ß√µes de API para diferentes fun√ß√µes Lambda ou outros servi√ßos de backend, dependendo do est√°gio.
   * O est√°gio √© indicado no in√≠cio do URL do endpoint do API Gateway.
3. **Autorizadores**: Os autorizadores no API Gateway s√£o respons√°veis por **controlar o acesso √† sua API** verificando a identidade do chamador antes de permitir que a solicita√ß√£o prossiga. Voc√™ pode usar **fun√ß√µes Lambda da AWS** como autorizadores personalizados, o que permite que voc√™ implemente sua pr√≥pria l√≥gica de autentica√ß√£o e autoriza√ß√£o. Quando uma solicita√ß√£o chega, o API Gateway passa o token de autoriza√ß√£o da solicita√ß√£o para o autorizador Lambda, que processa o token e retorna uma pol√≠tica IAM que determina quais a√ß√µes o chamador tem permiss√£o para executar. O API Gateway tamb√©m suporta **autorizadores integrados**, como **Identity and Access Management (IAM) da AWS** e **Amazon Cognito**.
4. **Pol√≠tica de Recursos**: Uma pol√≠tica de recursos no API Gateway √© um documento JSON que **define as permiss√µes para acessar sua API**. √â semelhante a uma pol√≠tica IAM, mas especificamente adaptada para o API Gateway. Voc√™ pode usar uma pol√≠tica de recursos para controlar quem pode acessar sua API, quais m√©todos eles podem chamar e de quais endere√ßos IP ou VPCs eles podem se conectar. **As pol√≠ticas de recursos podem ser usadas em combina√ß√£o com autorizadores** para fornecer controle de acesso granular para sua API.
   * Para que a API tenha efeito, ela precisa ser **implantada novamente ap√≥s** a pol√≠tica de recursos ser modificada.

### Registro

Por padr√£o, **os logs do CloudWatch** est√£o **desativados**, o **registro de acesso** est√° **desativado** e o **rastreamento X-Ray** tamb√©m est√° **desativado**.

### Enumera√ß√£o

```bash
# Informa√ß√µes gen√©ricas
aws apigateway get-account
aws apigateway get-domain-names
aws apigateway get-usage-plans
aws apigateway get-vpc-links
aws apigateway get-client-certificates

# Enumerar APIs
aws apig
### Chave de API necess√°ria

√â poss√≠vel definir endpoints de API que **exigem uma chave de API v√°lida** para serem contatados.

<figure><img src="../../../.gitbook/assets/image (92) (1).png" alt=""><figcaption></figcaption></figure>

√â poss√≠vel gerar chaves de API no portal do API Gateway e at√© mesmo definir quantas vezes ela pode ser usada (em termos de solicita√ß√µes por segundo e em termos de solicita√ß√µes por m√™s).

## Acesso n√£o autenticado

{% content-ref url="../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md" %}
[aws-api-gateway-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md)
{% endcontent-ref %}

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-apigateway-privesc.md" %}
[aws-apigateway-privesc.md](../aws-privilege-escalation/aws-apigateway-privesc.md)
{% endcontent-ref %}

## P√≥s-Explora√ß√£o

{% content-ref url="../aws-post-exploitation/aws-api-gateway-post-exploitation.md" %}
[aws-api-gateway-post-exploitation.md](../aws-post-exploitation/aws-api-gateway-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>