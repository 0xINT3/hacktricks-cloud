# AWS - API Gateway Enum

<details>

<summary><strong>рдмреЗрдирд┐рдлрд┐рдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдФрд░ HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ рдпрджрд┐ рдЖрдк PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## API Gateway

### рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА

AWS API Gateway рдПрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ Amazon Web Services (AWS) рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдк **рдХрд┐рд╕реА рднреА рд╕реНрддрд░ рдкрд░ API (рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдЗрдВрдЯрд░рдлреЗрд╕) рдХреЛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдмрдирд╛рдП рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдореЙрдирд┐рдЯрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**. API Gateway рдПрдХ **"рдореБрдЦреНрдп рджреНрд╡рд╛рд░"** рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ рдЖрдкрдХреЗ рдмреИрдХрдПрдВрдб рд╕реЗрд╡рд╛рдУрдВ рд╕реЗ рдбреЗрдЯрд╛, рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рддрд╛рд░реНрдХрд┐рдХ рдпрд╛ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ Amazon Elastic Compute Cloud (**EC2**), AWS **Lambda**, рдпрд╛ рдХреЛрдИ рднреА **рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдкрд░ рдЪрд▓ рд░рд╣реЗ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд╕рд╛рдеред

API Gateway рдЖрдкрдХреЛ **рдЕрдкрдиреЗ API рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдХреИрд╕реЗ рд╣реИрдВрдбрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП** рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд╡рд┐рдзрд┐рдпреЛрдВ (рдЬреИрд╕реЗ рдХрд┐ GET, POST, PUT, DELETE) рдФрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╕реНрдЯрдо API рдЗрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ (рдПрдкреАрдЖрдИ рдЕрдВрддрд░рдлрд▓рдХреЛрдВ) рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛ рдЖрдкрдХреЗ рдПрдкреАрдЖрдИ рдХреЛ рдЙрдирдХреЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рд╕реЗ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЗрдВрдЯ SDKs (рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдХрд┐рдЯреНрд╕) рднреА рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред

### API Gateway рдХреЗ рдкреНрд░рдХрд╛рд░

* **HTTP API**: OIDC рдФрд░ OAuth2 рдЬреИрд╕реА рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕рд╛рде рд▓реЛ-рд▓реИрдЯреЗрдВрд╕реА рдФрд░ рдХреЙрд╕реНрдЯ-рдЗрдлреЗрдХреНрдЯрд┐рд╡ REST API рдмрдирд╛рдПрдВ, рдФрд░ рдореВрд▓рднреВрдд CORS рд╕рдорд░реНрдерди рдХреЗ рд╕рд╛рдеред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: Lambda, HTTP backends.
* **WebSocket API**: рдЪреИрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ рдбреИрд╢рдмреЛрд░реНрдб рдЬреИрд╕реЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдпреА рдХрдиреЗрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ WebSocket API рдмрдирд╛рдПрдВред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: Lambda, HTTP, AWS рд╕реЗрд╡рд╛рдПрдВред
* **REST API**: рдПрдХ REST API рд╡рд┐рдХрд╕рд┐рдд рдХрд░реЗрдВ рдЬрд╣рд╛рдВ рдЖрдкрдХреЛ рдЕрдиреБрд░реЛрдз рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде рдкреВрд░реА рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреА рд╣реИ, рд╕рд╛рде рд╣реА API рдкреНрд░рдмрдВрдзрди рдХреНрд╖рдорддрд╛рдПрдВред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: Lambda, HTTP, AWS рд╕реЗрд╡рд╛рдПрдВред
* **REST API Private**: рдПрдХ REST API рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдХрд╛ рдХреЗрд╡рд▓ рдПрдХ VPC рдХреЗ рднреАрддрд░ рд╕реЗ рд╣реА рдкрд╣реБрдВрдЪ рд╣реЛрддреА рд╣реИред

### API Gateway рдореБрдЦреНрдп рдШрдЯрдХ

1. **рд╕рдВрд╕рд╛рдзрди**: API Gateway рдореЗрдВ, рд╕рдВрд╕рд╛рдзрди рд╡реЗ рдШрдЯрдХ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЗ API рдХреЗ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдмрдирд╛рддреЗ рд╣реИрдВред рд╡реЗ рдЖрдкрдХреЗ API рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдкрде рдпрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рдкреНрд░рддрд┐рд╖реНрдард┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЗ API рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рд╡рд┐рднрд┐рдиреНрди рдХрд╛рд░реНрд░рд╡рд╛рдЗрдпреЛрдВ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреЗ рд╣реИрдВред рд╕рдВрд╕рд╛рдзрди рд╣рд░ рдореЗрдердб (рдЬреИрд╕реЗ рдХрд┐ GET, POST, PUT, DELETE) рдХреЛ рдкреНрд░рддрд┐рд╖реНрдард┐рдд рдХрд░рддрд╛ рд╣реИ **рдкреНрд░рддреНрдпреЗрдХ рдкрде рдХреЗ рднреАрддрд░** (/, рдпрд╛ /users, рдпрд╛ /user/{id}ред
2. **рд╕реНрдЯреЗрдЬ**: API Gateway рдореЗрдВ рд╕реНрдЯреЗрдЬ рдЖрдкрдХреЗ API рдХреЗ **рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ** рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рд╡рд┐рдХрд╛рд╕, рд╕реНрдЯреЗрдЬрд┐рдВрдЧ, рдпрд╛ рдЙрддреНрдкрд╛рджрдиред рдЖрдк рд╕реНрдЯреЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдПрдХ рд╕рд╛рде рдХрдИ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдФрд░ рдбрд┐рдкреНрд▓реЙрдп** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЖрдк рдирдИ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдпрд╛ рдмрдЧ рдлрд┐рдХреНрд╕ рдХреЛ рдкрд░реАрдХреНрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдмрд┐рдирд╛ рдЙрддреНрдкрд╛рджрди рд╡рд╛рддрд╛рд╡рд░рдг рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд┐рдПред рд╕реНрдЯреЗрдЬ рднреА **рд╕реНрдЯреЗрдЬ рдЪрд░рдг** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рд╡рд░реНрддрдорд╛рди рд╕реНрдЯреЗрдЬ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЖрдкрдХреЗ API рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рд╕реНрдЯреЗрдЬ рдЪрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрдЯреЗрдЬ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ API рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╡рд┐рднрд┐рдиреНрди Lambda рдлрд╝рдВрдХреНрд╢рди рдпрд╛ рдЕрдиреНрдп рдмреИрдХрдПрдВрдб рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдЯреЗрдЬ рдЪрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* рд╕реНрдЯреЗрдЬ рдХреЛ API Gateway рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ URL рдХреА рд╢
```bash
# Generic info
aws apigateway get-account
aws apigateway get-domain-names
aws apigateway get-usage-plans
aws apigateway get-vpc-links
aws apigateway get-client-certificates

# Enumerate APIs
aws apigateway get-rest-apis # This will also show the resource policy (if any)
## Get stages
aws apigateway get-stages --rest-api-id <id>
## Get resources
aws apigateway get-resources --rest-api-id <id>
## Get API resource action per HTTP verb (check authorizers and api key required)
aws apigateway get-method --http-method GET --rest-api-id <api-id> --resource-id <resource-id>

## Call API
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>
## API authorizers
aws apigateway get-authorizers --rest-api-id <id>
## Models
aws apigateway get-models --rest-api-id <id>
## More info
aws apigateway get-gateway-responses --rest-api-id <id>
aws apigateway get-request-validators --rest-api-id <id>
aws apigateway get-deployments --rest-api-id <id>

# Get api keys generated
aws apigateway get-api-keys --include-value
aws apigateway get-api-key --api-key <id> --include-value # Get just 1
## Example use API key
curl -X GET -H "x-api-key: AJE&Ygenu4[..]" https://e83uuftdi8.execute-api.us-east-1.amazonaws.com/dev/test
## Usage plans
aws apigateway get-usage-plans #Get limit use info
aws apigateway get-usage-plan-keys --usage-plan-id <plan_id> #Get clear text values of api keys
aws apigateway get-usage-plan-key --usage-plan-id <plan_id> --key-id <key_id>
###Already consumed
aws --profile myadmin --region eu-west-1 apigateway get-usage --usage-plan-id <plan_id> --start-date 2023-07-01 --end-date 2023-07-12
```
## API Gateway рдПрдВрдбрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдЕрдзрд┐рдХрд╛рд░реАрдХрд░рдг

### рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐

рдПрдкреАрдЖрдИ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рдХреМрди рдХреЙрд▓ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЗрд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдЗрдВрдЧрд┐рдд рдЖрдИрдкреА рдХреЛ рдХреЙрд▓ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛** рд╣реИ рдПрдВрдбрдкреЙрдЗрдВрдЯ `/resource_policy` рдХреЛ GET рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред

<figure><img src="../../../.gitbook/assets/image (92) (1) (1).png" alt=""><figcaption></figcaption></figure>

### IAM рдЕрдзрд┐рдХреГрдд рдХрд░реНрддрд╛

рдПрдХ рдкрде (рд╕рдВрд╕рд╛рдзрди) рдХреЗ рднреАрддрд░ рдХреЗ рдПрдХ рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП IAM рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред

<figure><img src="https://lh3.googleusercontent.com/GGx-kfqNXu6zMqGidnO8_eR88fYPpJG-wNuBBnedAJntiRUEPTEScl7OvWthGYRiI_msYCdC6oBFvJc827Tb4-4UogxpOyrEXyst-8IDzP9DC2NOtXSY7w58L0baCAcBQjSyvBhJREvWWCtiboNYPSKuEw=s2048" alt=""><figcaption></figcaption></figure>

рдЬрдм рдпрд╣ рд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдХреЛрдИ рдЕрдзрд┐рдХрд╛рд░реАрдХрд░рдг рдХреЗ рдмрд┐рдирд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдиреЗ рдкрд░ рддреНрд░реБрдЯрд┐ `{"message":"Missing Authentication Token"}` рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧреАред

рдЕрдкрдиреЗ рджреНрд╡рд╛рд░рд╛ рдЙрдореНрдореАрджреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЯреЛрдХрди рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ **Postman** рдХреЗ рднреАрддрд░ **`Authorization`** рдкреНрд░рдХрд╛рд░ **`AWS Signature`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред

<figure><img src="../../../.gitbook/assets/image (3) (1) (3).png" alt=""><figcaption></figcaption></figure>

рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЦрд╛рддрд╛ рдХреА рдПрдХреНрд╕реЗрд╕ рдХреБрдВрдЬреА рдФрд░ рд╕реАрдХреНрд░реЗрдЯ рдХреБрдВрдЬреА рд╕реЗрдЯ рдХрд░реЗрдВ рдФрд░ рдЖрдк рдПрдкреАрдЖрдИ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рдПрдХ **Authorization** **рд╣реИрдбрд░** рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ рдЬреИрд╕рд╛ рдХрд┐:
```
AWS4-HMAC-SHA256 Credential=AKIAYY7XU6ECUDOTWB7W/20220726/us-east-1/execute-api/aws4_request, SignedHeaders=host;x-amz-date, Signature=9f35579fa85c0d089c5a939e3d711362e92641e8c14cc571df8c71b4bc62a5c2
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЕрдиреНрдп рдорд╛рдорд▓реЛрдВ рдореЗрдВ **рдСрдерд░рд╛рдЗрдЬрд╝рд░** рдЧрд▓рдд рдврдВрдЧ рд╕реЗ рдХреЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдСрдерд░рд╛рдЗрдЬрд╝реЗрд╢рди рд╣реИрдбрд░** рдореЗрдВ рдХреБрдЫ рднреА рднреЗрдЬрдиреЗ рд╕реЗ **рдЫрд┐рдкреА рд╣реБрдИ рд╕рд╛рдордЧреНрд░реА рджреЗрдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рд╣реЛ рд╕рдХрддреА рд╣реИред

### рдХрд╕реНрдЯрдо рд▓реИрдореНрдмрдбрд╛ рдСрдерд░рд╛рдЗрдЬрд╝рд░

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ рджрд┐рдП рдЧрдП рдЯреЛрдХрди рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдПрдХ рд▓реИрдореНрдмрдбрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ IAM рдиреАрддрд┐ **рд╡рд╛рдкрд╕ рдХрд░реЗрдЧрд╛** рдЬреЛ рдпрд╣ рджрд░реНрд╢рд╛рддреА рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **API рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рд╣реИ рдпрд╛ рдирд╣реАрдВред\
рдЖрдк рдСрдерд░рд╛рдЗрдЬрд╝рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣рд░ рд╡рд┐рдзрд┐ рд╕рдВрд╕рд╛рдзрди рдХреЛ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

<details>

<summary>рд▓реИрдореНрдмрдбрд╛ рдСрдерд░рд╛рдЗрдЬрд╝рд░ рдХреЛрдб рдЙрджрд╛рд╣рд░рдг</summary>
```python
import json

def lambda_handler(event, context):
token = event['authorizationToken']
method_arn = event['methodArn']

if not token:
return {
'statusCode': 401,
'body': 'Unauthorized'
}

try:
# Replace this with your own token validation logic
if token == "your-secret-token":
return generate_policy('user', 'Allow', method_arn)
else:
return generate_policy('user', 'Deny', method_arn)
except Exception as e:
print(e)
return {
'statusCode': 500,
'body': 'Internal Server Error'
}

def generate_policy(principal_id, effect, resource):
policy = {
'principalId': principal_id,
'policyDocument': {
'Version': '2012-10-17',
'Statement': [
{
'Action': 'execute-api:Invoke',
'Effect': effect,
'Resource': resource
}
]
}
}
return policy
```
</details>

рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХреЙрд▓ рдХрд░реЗрдВ:

<pre class="language-bash" data-overflow="wrap"><code class="lang-bash"><strong>curl "https://jhhqafgh6f.execute-api.eu-west-1.amazonaws.com/prod/custom_auth" -H 'Authorization: рдЖрдкрдХрд╛-рдЧреБрдкреНрдд-рдЯреЛрдХрди'
</strong></code></pre>

{% hint style="warning" %}
рд▓реИрдореНрдмрдбрд╛ рдХреЛрдб рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдпрд╣ рдЕрдзрд┐рдХреГрддрддрд╛ рд╕рдВрдХреЗрдд рд╕рдВрдХреНрд░рдорд┐рдд рд╣реЛ рд╕рдХрддреА рд╣реИ
{% endhint %}

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдПрдХ **рдирд┐рд╖реЗрдз рдиреАрддрд┐ рдЙрддреНрдкрдиреНрди рдФрд░ рд╡рд╛рдкрд╕реА** рдХреА рдЬрд╛рддреА рд╣реИ рддреЛ API Gateway рджреНрд╡рд╛рд░рд╛ рд╡рд╛рдкрд╕реА рдХреА рдЧрдИ рддреНрд░реБрдЯрд┐ рд╣реИ: `{"Message":"User is not authorized to access this resource with an explicit deny"}`

рдЗрд╕ рддрд░рд╣ рд╕реЗ рдЖрдк **рдЗрд╕ рдЕрдзрд┐рдХреГрддрддрд╛** рдХреА рдкрд╣рдЪрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рдЖрд╡рд╢реНрдпрдХ API рдХреБрдВрдЬреА

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ API рдЕрдВрдд-рдмрд┐рдВрджреБ рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛ, рдЬрд┐рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдПрдХ рдорд╛рдиреНрдп API рдХреБрдВрдЬреА** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

<figure><img src="../../../.gitbook/assets/image (92) (1).png" alt=""><figcaption></figcaption></figure>

API Gateway рдкреЛрд░реНрдЯрд▓ рдореЗрдВ API рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдФрд░ рдпрд╣ рднреА рд╕реЗрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдпрд╣ рдХрд┐рддрдирд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рд╕реЗрдХрдВрдб рдореЗрдВ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдФрд░ рдорд╣реАрдиреЗ рдореЗрдВ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░)ред

рдПрдХ API рдХреБрдВрдЬреА рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЗрд╕реЗ рдПрдХ **рдЙрдкрдпреЛрдЧ рдпреЛрдЬрдирд╛** рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛, рдЗрд╕ рдЙрдкрдпреЛрдЧ рдпреЛрдЬрдирд╛ рдХреЛ **API рд╕реНрдЯреЗрдЬ** рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд API рд╕реНрдЯреЗрдЬ рдХреЛ **рдПрдХ рд╡рд┐рдзрд┐ рдереНрд░реЙрдЯрд▓рд┐рдВрдЧ** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдЬреЛ API рдХреБрдВрдЬреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд░рдЦрддреА рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдкрд╣реБрдБрдЪ

{% content-ref url="../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md" %}
[aws-api-gateway-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md)
{% endcontent-ref %}

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-apigateway-privesc.md" %}
[aws-apigateway-privesc.md](../aws-privilege-escalation/aws-apigateway-privesc.md)
{% endcontent-ref %}

## рдкреЛрд╕реНрдЯ рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди

{% content-ref url="../aws-post-exploitation/aws-api-gateway-post-exploitation.md" %}
[aws-api-gateway-post-exploitation.md](../aws-post-exploitation/aws-api-gateway-post-exploitation.md)
{% endcontent-ref %}

### рд╕реНрдерд╛рдпрд┐рддреНрд╡

{% content-ref url="../aws-persistence/aws-api-gateway-persistence.md" %}
[aws-api-gateway-persistence.md](../aws-persistence/aws-api-gateway-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
