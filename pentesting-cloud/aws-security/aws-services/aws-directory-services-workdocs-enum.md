# AWS - Directory Dienste / WorkDocs Enum

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Directory Dienste

AWS Directory Service vir Microsoft Active Directory is 'n bestuurde diens wat dit maklik maak om 'n gids op te stel, te bedryf en te skaal in die AWS Cloud. Dit is gebou op werklike **Microsoft Active Directory** en integreer nou met ander AWS-dienste, wat dit maklik maak om jou gidsbewuste werklaste en AWS-hulpbronne te bestuur. Met AWS Managed Microsoft AD kan jy jou bestaande Active Directory-gebruikers, groepe en beleide gebruik om toegang tot jou AWS-hulpbronne te bestuur. Dit kan jou identiteitsbestuur vereenvoudig en die behoefte aan addisionele identiteitsoplossings verminder. AWS Managed Microsoft AD bied ook outomatiese rugsteun en rampherstelvermo√´ns, wat help om die beskikbaarheid en duursaamheid van jou gids te verseker. Oor die algemeen kan AWS Directory Service vir Microsoft Active Directory jou tyd en hulpbronne bespaar deur 'n bestuurde, hoogs beskikbare en skaalbare Active Directory-diens in die AWS Cloud te bied.

### Opsies

Directory Dienste maak dit moontlik om 5 tipes gidse te skep:

* **AWS Managed Microsoft AD**: Hierdie opsie sal 'n nuwe **Microsoft AD in AWS** laat loop. Jy sal die administrateur wagwoord kan instel en toegang tot die DC's in 'n VPC h√™.
* **Simple AD**: Hierdie opsie sal 'n **Linux-Samba** Active Directory-kompatibele bediener wees. Jy sal die administrateur wagwoord kan instel en toegang tot die DC's in 'n VPC h√™.
* **AD Connector**: 'n Proksi vir die **omleiding van gidseversoeke na jou bestaande Microsoft Active Directory** sonder om enige inligting in die wolk te kas. Dit sal in 'n **VPC** luister en jy moet **volmagte gee om toegang tot die bestaande AD** te verkry.
* **Amazon Cognito User Pools**: Dit is dieselfde as Cognito User Pools.
* **Cloud Directory**: Dit is die **eenvoudigste** opsie. 'n **Serverlose** gids waar jy die **skema** aandui wat gebruik moet word en volgens die gebruik **gefactureer word**.

AWS Directory-dienste maak dit moontlik om te **sinchroniseer** met jou bestaande **plaaslike** Microsoft AD, jou eie een in AWS te laat loop of te sinchroniseer met **ander gidstipes**.

### Laboratorium

Hier kan jy 'n goeie handleiding vind om jou eie Microsoft AD in AWS te skep: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Enumerasie
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### Aantekening

Let daarop dat as die **beskrywing** van die gids 'n **domein** in die veld **`AccessUrl`** bevat, is dit omdat 'n **gebruiker** waarskynlik met sy **AD-legitimasie** in sommige **AWS-dienste kan aanmeld**:

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon Bestuurskonsol)
* `<name>.awsapps.com/start` (IAM Identiteitsentrum)

### Bevoorregte Eskalasie

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## Volharding

### Gebruik van 'n AD-gebruiker

'n **AD-gebruiker** kan **toegang tot die AWS-bestuurskonsol** gekry deur 'n rol aan te neem. Die **standaard gebruikersnaam is Admin** en dit is moontlik om die wagwoord vanaf die AWS-konsol te **verander**.

Daarom is dit moontlik om die wagwoord van Admin te **verander**, 'n nuwe gebruiker te **skep** of die wagwoord van 'n gebruiker te **verander** en daardie gebruiker 'n rol te gee om toegang te behou.\
Dit is ook moontlik om 'n gebruiker by 'n groep binne AD **toe te voeg** en daardie AD-groep toegang tot 'n rol te gee (om hierdie volharding meer heimlik te maak).

### AD deel (van slagoffer na aanvaller)

Dit is moontlik om 'n AD-omgewing van 'n slagoffer na 'n aanvaller te deel. Op hierdie manier sal die aanvaller steeds toegang tot die AD-omgewing h√™.\
Dit impliseer egter die deel van die bestuurde AD en die skep van 'n VPC-peering-verbinding.

Jy kan 'n gids hier vind: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~AD deel (van aanvaller na slagoffer)~~

Dit lyk nie asof dit moontlik is om AWS-toegang aan gebruikers van 'n ander AD-omgewing tot een AWS-rekening te verleen nie.

## WorkDocs

Amazon Web Services (AWS) WorkDocs is 'n wolkgebaseerde **l√™erberging- en deel-diens**. Dit is deel van die AWS-pakket van wolkrekenaardienste en is ontwerp om 'n veilige en skaalbare oplossing vir organisasies te bied om l√™ers en dokumente te stoor, te deel en saam te werk.

AWS WorkDocs bied 'n webgebaseerde koppelvlak vir gebruikers om hul l√™ers en dokumente te laai, toegang te verkry en te bestuur. Dit bied ook funksies soos weergawebeheer, werklike tyd-saamwerking en integrasie met ander AWS-dienste en derdeparty-hulpmiddels.

### Enumerasie

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Privesc

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>
