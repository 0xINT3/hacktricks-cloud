# AWS - Redshift Enum

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** Ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Amazon Redshift

Το Redshift είναι ένα πλήρως διαχειριζόμενο υπηρεσία που μπορεί να κλιμακωθεί έως και ένα πεταβάιτ, το οποίο χρησιμοποιείται ως **αποθήκη δεδομένων για λύσεις μεγάλων δεδομένων**. Χρησιμοποιώντας συστάδες Redshift, μπορείτε να εκτελέσετε αναλύσεις στα σύνολα δεδομένων σας χρησιμοποιώντας γρήγορα εργαλεία ερωτήσεων βασισμένα σε SQL και εφαρμογές ευφυούς επιχειρηματικής νοημοσύνης για να αποκτήσετε μεγαλύτερη κατανόηση της εικόνας για την επιχείρησή σας.

**Το Redshift προσφέρει κρυπτογράφηση στην ανάπαυση χρησιμοποιώντας μια ιεραρχία τεσσάρων επιπέδων κρυπτογράφησης κλειδιών χρησιμοποιώντας είτε το KMS είτε το CloudHSM για τη διαχείριση του ανώτατου επιπέδου κλειδιών**. **Όταν η κρυπτογράφηση είναι ενεργοποιημένη για τη συστάδα σας, δεν μπορεί να απενεργοποιηθεί και αντίστροφα**. Όταν έχετε μια μη κρυπτογραφημένη συστάδα, δεν μπορεί να κρυπτογραφηθεί.

Η κρυπτογράφηση για τη συστάδα σας μπορεί να γίνει μόνο κατά τη δημιουργία της και αφού κρυπτογραφηθεί, τα δεδομένα, οι μεταδεδομένες και οποιαδήποτε αντίγραφα ασφαλείας κρυπτογραφούνται επίσης. Τα επίπεδα ιεραρχίας των κλειδιών κρυπτογράφησης είναι ως εξής, **το πρώτο επίπεδο είναι το κύριο κλειδί, το δεύτερο επίπεδο είναι το κλειδί κρυπτογράφησης της συστάδας, το CEK, το τρίτο επίπεδο είναι το κλειδί κρυπτογράφησης της βάσης δεδομένων, το DEK, και τέλος το τέταρτο επίπεδο είναι τα ίδια τα κλειδιά κρυπτογράφησης των δεδομένων**.

### KMS

Κατά τη δημιουργία της συστάδας σας, μπορείτε είτε να επιλέξετε το **προεπιλεγμένο KMS κλειδί** για το Redshift είτε να επιλέξετε το **δικό σας CMK**, που σας παρέχει μεγαλύτερη ευελιξία όσον αφορά τον έλεγχο του κλειδιού, ειδικά από την άποψη της ελεγξιμότητας.

Το προεπιλεγμένο KMS κλειδί για το Redshift δημιουργείται αυτόματα από το Redshift την πρώτη φορά που επιλέγεται και χρησιμοποιείται η επιλογή του κλειδιού και διαχειρίζεται πλήρως από το AWS.

Αυτό το KMS κλειδί κρυπτογραφείται στη συνέχεια με το κύριο κλειδί CMK, το πρώτο επίπεδο. Αυτό το κρυπτογραφημένο KMS κλειδί δεδομένων χρησιμοποιείται στη συνέχεια ως κλειδί κρυπτογράφησης της συστάδας, το CEK, το δεύτερο επίπεδο. Αυτό το CEK στέλνεται στο Redshift από το KMS, όπου αποθηκεύεται ξεχωριστά από τη συστάδα. Το Redshift στέλνει στη συνέχεια αυτό το κρυπτογραφημένο CEK στη συστάδα μέσω ενός ασφαλούς καναλιού, όπου αποθηκεύεται στη μνήμη.

Το Redshift ζητά στη συνέχεια από το KMS να αποκρυπτογραφήσει το CEK, το δεύτερο επίπεδο. Αυτό το α

```bash
# Get clusters
aws redshift describe-clusters
## Get if publicly accessible
aws redshift describe-clusters | jq -r ".Clusters[].PubliclyAccessible"
## Get DB username to login
aws redshift describe-clusters | jq -r ".Clusters[].MasterUsername"
## Get endpoint
aws redshift describe-clusters | jq -r ".Clusters[].Endpoint"
## Public addresses of the nodes
aws redshift describe-clusters | jq -r ".Clusters[].ClusterNodes[].PublicIPAddress"
## Get IAM roles of the clusters
aws redshift describe-clusters | jq -r ".Clusters[].IamRoles"

# Endpoint access & authorization
aws redshift describe-endpoint-access
aws redshift describe-endpoint-authorization

# Get credentials
aws redshift get-cluster-credentials --db-user <username> --cluster-identifier <cluster-id>
## By default, the temporary credentials expire in 900 seconds. You can optionally specify a duration between 900 seconds (15 minutes) and 3600 seconds (60 minutes).
aws redshift get-cluster-credentials-with-iam --cluster-identifier <cluster-id>
## Gives creds to access redshift with the IAM redshift permissions given to the current AWS account
## More in https://docs.aws.amazon.com/redshift/latest/mgmt/redshift-iam-access-control-identity-based.html

# Authentication profiles
aws redshift describe-authentication-profiles

# Snapshots
aws redshift describe-cluster-snapshots

# Scheduled actions
aws redshift describe-scheduled-actions

# Connect
# The redshift instance must be publicly available (not by default), the sg need to allow inbounds connections to the port and you need creds
psql -h redshift-cluster-1.sdflju3jdfkfg.us-east-1.redshift.amazonaws.com -U admin -d dev -p 5439
```

## Ανέβασμα δικαιωμάτων

{% content-ref url="../aws-privilege-escalation/aws-redshift-privesc.md" %}
[aws-redshift-privesc.md](../aws-privilege-escalation/aws-redshift-privesc.md)
{% endcontent-ref %}

## Μόνιμη παραμονή

Οι παρακάτω ενέργειες επιτρέπουν την χορήγηση πρόσβασης σε άλλους λογαριασμούς AWS στο cluster:

* [authorize-endpoint-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-endpoint-access.html)
* [authorize-snapshot-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-snapshot-access.html)

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Συμμετάσχετε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
