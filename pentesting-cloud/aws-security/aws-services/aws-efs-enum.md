# AWS - EFS Enum

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## EFS

### Βασικές Πληροφορίες

Το Amazon Elastic File System (EFS) παρουσιάζεται ως ένα **πλήρως διαχειριζόμενο, κλιμακούμενο και ελαστικό δικτυακό σύστημα αρχείων** από το AWS. Η υπηρεσία διευκολύνει τη δημιουργία και τη διαμόρφωση **συστημάτων αρχείων** που μπορούν να προσπελαστούν ταυτόχρονα από πολλά παραδείγματα EC2 και άλλες υπηρεσίες του AWS. Οι βασικές λειτουργίες του EFS περιλαμβάνουν την αυτόματη κλιμάκωση χωρίς χειροκίνητη παρέμβαση, την παροχή πρόσβασης χαμηλής καθυστέρησης, την υποστήριξη φορτίων υψηλής ροής, την εγγύηση της ανθεκτικότητας των δεδομένων και την ομαλή ενσωμάτωση με διάφορους μηχανισμούς ασφαλείας του AWS.

Από προεπιλογή, ο φάκελος EFS που θα πρέπει να προσαρτηθεί είναι **`/`** αλλά μπορεί να έχει και **διαφορετικό όνομα**.

### Δικτυακή Πρόσβαση

Ένα EFS δημιουργείται σε ένα VPC και θα είναι **από προεπιλογή προσβάσιμο σε όλα τα υποδίκτυα του VPC**. Ωστόσο, το EFS θα έχει ένα Ομάδα Ασφαλείας. Για να **δοθεί πρόσβαση σε ένα EC2** (ή οποιαδήποτε άλλη υπηρεσία του AWS) για να προσαρτήσει το EFS, είναι απαραίτητο να **επιτραπεί στην Ομάδα Ασφαλείας του EFS μια εισερχόμενη κανόνα NFS** (θύρα 2049) **από την Ομάδα Ασφαλείας του EC2**.

Χωρίς αυτό, **δεν θα μπορείτε να επικοινωνήσετε με την υπηρεσία NFS**.

Για περισσότερες πληροφορίες σχετικά με το πώς να το κάνετε αυτό, ελέγξτε: [https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount](https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount)

### Απαρίθμηση
```bash
# Get filesystems and access policies (if any)
aws efs describe-file-systems
aws efs describe-file-system-policy --file-system-id <id>

# Get subnetworks and IP addresses where you can find the file system
aws efs describe-mount-targets --file-system-id <id>
aws efs describe-mount-target-security-groups --mount-target-id <id>
aws ec2 describe-security-groups --group-ids <sg_id>

# Get other access points
aws efs describe-access-points

# Get replication configurations
aws efs describe-replication-configurations

# Search for NFS in EC2 networks
sudo nmap -T4 -Pn -p 2049 --open 10.10.10.0/20 # or /16 to be sure
```
{% hint style="danger" %}
Μπορεί να συμβεί το εξής: το σημείο προσάρτησης του EFS βρίσκεται μέσα στο ίδιο VPC αλλά σε διαφορετικό subnet. Εάν θέλετε να είστε σίγουροι ότι βρίσκετε όλα τα σημεία EFS, θα ήταν καλύτερο να σαρώσετε το `/16` netmask.
{% endhint %}

### Προσάρτηση EFS

{% code overflow="wrap" %}
```bash
sudo mkdir /efs

## Mount found
sudo apt install nfs-common
sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport <IP>:/ /efs

## Mount with efs type
## You need to have installed the package amazon-efs-utils
sudo yum install amazon-efs-utils # If centos
sudo apt-get install amazon-efs-utils # If ubuntu
sudo mount -t efs <file-system-id/EFS DNS name>:/ /efs/
```
{% endcode %}

### Πρόσβαση IAM

Από προεπιλογή, οποιοσδήποτε με **πρόσβαση στο δίκτυο του EFS** θα μπορεί να το προσαρτήσει, **να το διαβάσει και να το γράψει ακόμα και ως χρήστης root**. Ωστόσο, μπορεί να υπάρχουν πολιτικές συστήματος αρχείων που επιτρέπουν **μόνο σε αρχές με συγκεκριμένα δικαιώματα** να έχουν πρόσβαση σε αυτό.\
Για παράδειγμα, αυτή η πολιτική συστήματος αρχείων **δεν θα επιτρέψει ακόμα και την προσάρτηση** του συστήματος αρχείων αν δεν έχετε την άδεια IAM:
```json
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-2ca2ba76-5d83-40be-8557-8f6c19eaa797",
"Statement": [
{
"Sid": "efs-statement-e7f4b04c-ad75-4a7f-a316-4e5d12f0dbf5",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": "",
"Resource": "arn:aws:elasticfilesystem:us-east-1:318142138553:file-system/fs-0ab66ad201b58a018",
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
Ή αυτό θα **αποτρέψει την ανώνυμη πρόσβαση**:

<figure><img src="../../../.gitbook/assets/image (3) (6).png" alt=""><figcaption></figcaption></figure>

Σημειώστε ότι για να προσαρτήσετε συστήματα αρχείων που προστατεύονται από το IAM, ΠΡΕΠΕΙ να χρησιμοποιήσετε τον τύπο "efs" στην εντολή προσάρτησης:
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
# To use a different pforile from ~/.aws/credentials
# You can use: -o tls,iam,awsprofile=namedprofile
```
### Σημεία Πρόσβασης

Τα **σημεία πρόσβασης** είναι **ειδικά σημεία εισόδου για μια EFS αρχειοθήκη** που διευκολύνουν τη διαχείριση της πρόσβασης των εφαρμογών σε κοινόχρηστα σύνολα δεδομένων.

Όταν δημιουργείτε ένα σημείο πρόσβασης, μπορείτε να **καθορίσετε τον κάτοχο και τα POSIX δικαιώματα** για τα αρχεία και τους καταλόγους που δημιουργούνται μέσω του σημείου πρόσβασης. Μπορείτε επίσης να **ορίσετε έναν προσαρμοσμένο κατάλογο ρίζας** για το σημείο πρόσβασης, είτε καθορίζοντας έναν υπάρχοντα κατάλογο είτε δημιουργώντας έναν νέο με τα επιθυμητά δικαιώματα. Αυτό σας επιτρέπει να **ελέγχετε την πρόσβαση στην EFS αρχειοθήκη σας με βάση την εφαρμογή ή τον χρήστη**, καθιστώντας πιο εύκολη τη διαχείριση και την ασφάλεια των κοινόχρηστων αρχείων σας.

**Μπορείτε να προσαρτήσετε το Αρχειοθετικό Σύστημα από ένα σημείο πρόσβασης χρησιμοποιώντας κάτι παρόμοιο με:**
```bash
# Use IAM if you need to use iam permissions
sudo mount -t efs -o tls,[iam],accesspoint=<access-point-id> \
<file-system-id/EFS DNS> /efs/
```
{% hint style="warning" %}
Σημειώστε ότι ακόμα και αν προσπαθήσετε να προσαρτήσετε ένα σημείο πρόσβασης, πρέπει να είστε σε θέση να **επικοινωνήσετε με την υπηρεσία NFS μέσω δικτύου**, και αν το EFS έχει μια πολιτική συστήματος αρχείων, χρειάζεστε **επαρκή δικαιώματα IAM** για να το προσαρτήσετε.
{% endhint %}

Τα σημεία πρόσβασης μπορούν να χρησιμοποιηθούν για τους εξής σκοπούς:

* **Απλοποίηση διαχείρισης δικαιωμάτων**: Ορίζοντας έναν POSIX χρήστη και έναν ομάδα για κάθε σημείο πρόσβασης, μπορείτε εύκολα να διαχειρίζεστε τα δικαιώματα πρόσβασης για διάφορες εφαρμογές ή χρήστες χωρίς να τροποποιείτε τα δικαιώματα του υποκείμενου συστήματος αρχείων.
* **Επιβολή ενός καταλόγου ρίζας**: Τα σημεία πρόσβασης μπορούν να περιορίσουν την πρόσβαση σε έναν συγκεκριμένο κατάλογο εντός του συστήματος αρχείων EFS, εξασφαλίζοντας ότι κάθε εφαρμογή ή χρήστης λειτουργεί εντός του ορισμένου φακέλου του. Αυτό βοηθά στην αποτροπή ατυχήματος αποκάλυψης ή τροποποίησης δεδομένων.
* **Ευκολότερη πρόσβαση στο σύστημα αρχείων**: Τα σημεία πρόσβασης μπορούν να συσχετιστούν με μια συνάρτηση AWS Lambda ή μια εργασία AWS Fargate, απλοποιώντας την πρόσβαση στο σύστημα αρχείων για εφαρμογές χωρίς διακομιστή και εφαρμογές σε εμπορευματοκιβώτια.

## Ανέβασμα δικαιωμάτων

{% content-ref url="../aws-privilege-escalation/aws-efs-privesc.md" %}
[aws-efs-privesc.md](../aws-privilege-escalation/aws-efs-privesc.md)
{% endcontent-ref %}

## Μετά την εκμετάλλευση

{% content-ref url="../aws-post-exploitation/aws-efs-post-exploitation.md" %}
[aws-efs-post-exploitation.md](../aws-post-exploitation/aws-efs-post-exploitation.md)
{% endcontent-ref %}

## Διατήρηση

{% content-ref url="../aws-persistence/aws-efs-persistence.md" %}
[aws-efs-persistence.md](../aws-persistence/aws-efs-persistence.md)
{% endcontent-ref %}

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
