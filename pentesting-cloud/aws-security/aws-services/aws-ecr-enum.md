# AWS - ECR Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>에서 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>

## ECR

### 기본 정보

Amazon **Elastic Container Registry** (Amazon ECR)는 **관리되는 컨테이너 이미지 레지스트리 서비스**입니다. 이 서비스는 고객이 잘 알려진 인터페이스를 사용하여 컨테이너 이미지와 상호 작용할 수 있는 환경을 제공하기 위해 설계되었습니다. 특히 Docker CLI 또는 기타 선호하는 클라이언트를 사용하여 푸시, 풀 및 컨테이너 이미지 관리와 같은 작업을 수행할 수 있습니다.

ECR은 **레지스트리**와 **저장소** 두 가지 유형의 객체로 구성됩니다.

#### 레지스트리

모든 AWS 계정에는 **개인** 및 **공용** 두 가지 레지스트리가 있습니다.

1. **개인 레지스트리**:

* **기본적으로 개인**: Amazon ECR 개인 레지스트리에 저장된 컨테이너 이미지는 AWS 계정 내의 권한이 있는 사용자 또는 권한이 부여된 사용자에게만 액세스할 수 있습니다.
* **개인 저장소**의 URI는 `<account_id>.dkr.ecr.<region>.amazonaws.com/<repo-name>` 형식을 따릅니다.
* **액세스 제어**: IAM 정책을 사용하여 개인 컨테이너 이미지에 대한 액세스를 **제어**할 수 있으며, 사용자 또는 역할을 기반으로 세밀한 권한을 구성할 수 있습니다.
* **AWS 서비스와의 통합**: Amazon ECR 개인 레지스트리는 EKS, ECS 등 다른 AWS 서비스와 쉽게 **통합**될 수 있습니다.
* **기타 개인 레지스트리 옵션**:
* 태그 불변성 열은 태그 불변성이 활성화되어 있는지 여부를 나타내며, 이미지를 덮어쓰는 **기존 태그**로의 이미지 **푸시**를 **방지**합니다.
* **암호화 유형** 열은 저장소의 암호화 속성을 나타내며, AES-256과 같은 기본 암호화 유형 또는 KMS가 활성화된 암호화를 보여줍니다.
* **Pull through cache** 열은 Pull through cache 상태를 나타내며, Pull through cache 상태가 활성화되면 **외부 공용 저장소의 저장소를 개인 저장소에 캐시**합니다.
* 특정 **IAM 정책**을 구성하여 다른 **권한**을 부여할 수 있습니다.
* **스캔 구성**을 사용하여 저장소 내에 저장된 이미지의 취약점을 스캔할 수 있습니다.

2. **공용 레지스트리**:

* **공개 액세스**: ECR 공용 레지스트리에 저장된 컨테이너 이미지는 **인증 없이 인터넷의 누구나 액세스**할 수 있습니다.
* **공용 저장소**의 URI는 `public.ecr.aws/<random>/<name>`과 같은 형식입니다. `<random>` 부분은 관리자가 기억하기 쉬운 다른 문자열로 변경할 수 있습니다.

#### **저장소**

이는 **개인 레지스트리** 또는 **공용 레지스트리**에 있는 **이미지**입니다.

{% hint style="info" %}
이미지를 저장소에 업로드하려면 **ECR 저장소의 이름이 이미지와 동일**해야 합니다.
{% endhint %}

### 레지스트리 및 저장소 정책

**레지스트리 및 저장소**에는 다른 주체/계정에게 권한을 부여하는 데 사용할 수 있는 **정책**도 있습니다. 예를 들어, 다음 저장소 정책 이미지에서는 조직 전체의 모든 사용자가 이미지에 액세스할 수 있도록 설정되어 있습니다:

<figure><img src="../../../.gitbook/assets/image (87).png" alt=""><figcaption></figcaption></figure>

### 열거

{% code overflow="wrap" %}
```bash
# Get repos
aws ecr describe-repositories
aws ecr describe-registry

# Get image metadata
aws ecr list-images --repository-name <repo_name>
aws ecr describe-images --repository-name <repo_name>
aws ecr describe-image-replication-status --repository-name <repo_name> --image-id <image_id>
aws ecr describe-image-scan-findings --repository-name <repo_name> --image-id <image_id>
aws ecr describe-pull-through-cache-rules --repository-name <repo_name> --image-id <image_id>

# Get public repositories
aws ecr-public describe-repositories

# Get policies
aws ecr get-registry-policy
aws ecr get-repository-policy --repository-name <repo_name>
```
{% endcode %}

### 인증되지 않은 열거

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md" %}
[aws-ecr-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md)
{% endcontent-ref %}

### 권한 상승

다음 페이지에서는 **ECR 권한을 악용하여 권한을 상승**하는 방법을 확인할 수 있습니다:

{% content-ref url="../aws-privilege-escalation/aws-ecr-privesc.md" %}
[aws-ecr-privesc.md](../aws-privilege-escalation/aws-ecr-privesc.md)
{% endcontent-ref %}

### 후반 공격

{% content-ref url="../aws-post-exploitation/aws-ecr-post-exploitation.md" %}
[aws-ecr-post-exploitation.md](../aws-post-exploitation/aws-ecr-post-exploitation.md)
{% endcontent-ref %}

### 지속성

{% content-ref url="../aws-persistence/aws-ecr-persistence.md" %}
[aws-ecr-persistence.md](../aws-persistence/aws-ecr-persistence.md)
{% endcontent-ref %}

# 참고 자료
* [https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html](https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사를 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* 독점적인 [**NFT**](https://opensea.io/collection/the-peass-family) 컬렉션인 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>
