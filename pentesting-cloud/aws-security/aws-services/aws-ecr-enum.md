# AWS - ECR Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## ECR

### Temel Bilgiler

Amazon **Elastic Container Registry** (Amazon ECR), yönetilen bir konteyner görüntü kayıt defteri hizmetidir. Müşterilerin, tanınmış arayüzleri kullanarak konteyner görüntülerine etkileşimde bulunabilecekleri bir ortam sağlamak üzere tasarlanmıştır. Özellikle Docker CLI veya tercih edilen herhangi bir istemci kullanımına destek verilir, bu da itme, çekme ve konteyner görüntülerini yönetme gibi faaliyetleri mümkün kılar.

ECR, **Kayıt Defterleri** ve **Depolar** olmak üzere 2 tür nesneden oluşur.

#### Kayıt Defterleri

Her AWS hesabında 2 kayıt defteri bulunur: **Özel** ve **Genel**.

1. **Özel Kayıt Defterleri**:

* **Varsayılan olarak özel**: Amazon ECR özel bir kayıt defterinde depolanan konteyner görüntüleri, yalnızca AWS hesabınızdaki yetkilendirilmiş kullanıcılara veya izin verilenlere erişilebilir.
* **Özel bir depo**nin URI'si, `<hesap_id>.dkr.ecr.<bölge>.amazonaws.com/<repo-adı>` formatını izler.
* **Erişim kontrolü**: Özel konteyner görüntülerinize **IAM politikaları** kullanarak erişimi kontrol edebilir ve kullanıcılara veya rollerle ilgili ayrıntılı izinler yapılandırabilirsiniz.
* **AWS hizmetleriyle entegrasyon**: Amazon ECR özel kayıt defterleri, EKS, ECS gibi diğer AWS hizmetleriyle kolayca entegre edilebilir.
* **Diğer özel kayıt defteri seçenekleri**:
* Etiket değişmezlik sütunu, durumunu listeler, etiket değişmezlik etkinleştirildiyse, önceden var olan etiketlerle görüntü itmelerinin görüntüleri üzerine yazılmasını **engeller**.
* **Şifreleme türü** sütunu, depo şifreleme özelliklerini listeler, AES-256 gibi varsayılan şifreleme türlerini veya KMS etkinleştirilmiş şifrelemeleri gösterir.
* **Önbelleği geçir** sütunu, durumunu listeler, Önbelleği geçirme durumu Etkinse, **dış bir genel depodaki depoları özel depoya önbelleğe alır**.
* Farklı **izinler** sağlamak için özel **IAM politikaları** yapılandırılabilir.
* **Tarama yapılandırması**, depoda depolanan görüntülerdeki zafiyetleri taramak için kullanılabilir.

2. **Genel Kayıt Defterleri**:

* **Genel erişilebilirlik**: ECR Genel kayıt defterinde depolanan konteyner görüntüleri, kimlik doğrulamasız olarak internet üzerindeki herkese **erişilebilir**.
* **Genel bir depo**nun URI'si, `public.ecr.aws/<rastgele>/<ad>` şeklindedir. `<rastgele>` kısmı yönetici tarafından başka bir hatırlanması daha kolay dizeye değiştirilebilir.

#### **Depolar**

Bunlar, **özel kayıt defterindeki** veya **genel** olan **görüntülerdir**.

{% hint style="info" %}
Bir görüntüyü bir depoya yüklemek için, **ECR deposunun görüntüyle aynı ada sahip olması gerekir**.
{% endhint %}

### Kayıt Defteri ve Depo Politikaları

**Kayıt defterleri ve depolar** ayrıca **diğer prensiplere/hesaplara izin vermek için kullanılabilecek politikalara sahiptir**. Örneğin, aşağıdaki depo politikası görüntüsünde, tüm organizasyondan herhangi bir kullanıcının görüntüye erişebileceğini görebilirsiniz:

<figure><img src="../../../.gitbook/assets/image (87).png" alt=""><figcaption></figcaption></figure>

### Numaralandırma

{% code overflow="wrap" %}
```bash
# Get repos
aws ecr describe-repositories
aws ecr describe-registry

# Get image metadata
aws ecr list-images --repository-name <repo_name>
aws ecr describe-images --repository-name <repo_name>
aws ecr describe-image-replication-status --repository-name <repo_name> --image-id <image_id>
aws ecr describe-image-scan-findings --repository-name <repo_name> --image-id <image_id>
aws ecr describe-pull-through-cache-rules --repository-name <repo_name> --image-id <image_id>

# Get public repositories
aws ecr-public describe-repositories

# Get policies
aws ecr get-registry-policy
aws ecr get-repository-policy --repository-name <repo_name>
```
{% endcode %}

### Kimlik Doğrulama Olmadan Sıralama

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md" %}
[aws-ecr-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md)
{% endcontent-ref %}

### Privilege Escalation

Aşağıdaki sayfada, **ECR izinlerini kötüye kullanarak ayrıcalıkları yükseltme** yöntemlerini kontrol edebilirsiniz:

{% content-ref url="../aws-privilege-escalation/aws-ecr-privesc.md" %}
[aws-ecr-privesc.md](../aws-privilege-escalation/aws-ecr-privesc.md)
{% endcontent-ref %}

### Saldırı Sonrası

{% content-ref url="../aws-post-exploitation/aws-ecr-post-exploitation.md" %}
[aws-ecr-post-exploitation.md](../aws-post-exploitation/aws-ecr-post-exploitation.md)
{% endcontent-ref %}

### Kalıcılık

{% content-ref url="../aws-persistence/aws-ecr-persistence.md" %}
[aws-ecr-persistence.md](../aws-persistence/aws-ecr-persistence.md)
{% endcontent-ref %}

# Referanslar
* [https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html](https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ile sıfırdan kahraman olmak için AWS hackleme öğrenin</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **tanıtmak isterseniz veya HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>
