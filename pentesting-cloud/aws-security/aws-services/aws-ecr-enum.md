# AWS - ECR Enum

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## ECR

### Taarifa Msingi

Amazon **Elastic Container Registry** (Amazon ECR) ni **huduma ya usajili wa picha za kontena iliyosimamiwa**. Imetengenezwa kutoa mazingira ambapo wateja wanaweza kuingiliana na picha zao za kontena kwa kutumia interfaces zinazojulikana. Hasa, matumizi ya Docker CLI au mteja wowote unaopendelewa yanategemewa, kuruhusu shughuli kama kusukuma, kuvuta, na kusimamia picha za kontena.

ECR inajumuisha aina 2 za vitu: **Usajili** na **Repositories**.

#### Usajili

Kila akaunti ya AWS ina usajili 2: **Binafsi** & **Umma**.

1. **Usajili wa Binafsi**:

* **Binafsi kwa chaguo-msingi**: Picha za kontena zilizohifadhiwa kwenye usajili wa binafsi wa Amazon ECR zinapatikana **kwa watumiaji walioruhusiwa** ndani ya akaunti yako ya AWS au kwa wale waliopewa idhini.
* URI ya **repo la binafsi** inafuata muundo `<account_id>.dkr.ecr.<region>.amazonaws.com/<repo-name>`
* **Kudhibiti upatikanaji**: Unaweza **kudhibiti upatikanaji** wa picha zako za kontena za binafsi kwa kutumia **sera za IAM**, na unaweza kusanidi ruhusa za kina zinazotegemea watumiaji au majukumu.
* **Ushirikiano na huduma za AWS**: Usajili wa binafsi wa Amazon ECR unaweza kwa urahisi **kushirikishwa na huduma zingine za AWS**, kama vile EKS, ECS...
* **Chaguzi zingine za usajili wa binafsi**:
* Safu ya kutokubadilika kwa lebo inaonyesha hali yake, ikiwa kutokubadilika kwa lebo imewezeshwa itazuia kusukuma kwa picha na **lebo zilizopo awali** kuharibu picha.
* Safu ya **Aina ya Ufichamishaji** inaorodhesha mali za ufichamishaji wa usajili, inaonyesha aina za ufichamishaji za msingi kama AES-256, au ina ufichamishaji uliozimishwa wa **KMS**.
* Safu ya **Kache ya Kuvuta kupitia** inaonyesha hali yake, ikiwa hali ya Kuvuta kupitia ni Aktiva itahifadhi **makusanyo katika usajili wa umma wa nje ndani ya usajili wako wa binafsi**.
* Sera maalum za **IAM** zinaweza kusanidiwa kutoa **ruhusa tofauti**.
* **Usanidi wa uchunguzi** huruhusu kutafuta kasoro katika picha zilizohifadhiwa ndani ya repo.

2. **Usajili wa Umma**:

* **Upatikanaji wa Umma**: Picha za kontena zilizohifadhiwa kwenye usajili wa Umma wa ECR zinapatikana **kwa yeyote kwenye mtandao bila uwakilishi.**
* URI ya **repo la umma** ni kama `public.ecr.aws/<random>/<name>`. Ingawa sehemu ya `<random>` inaweza kubadilishwa na msimamizi kwa herufi nyingine rahisi kukumbuka.

#### **Repositories**

Hizi ni **picha** zilizo kwenye **usajili wa binafsi** au kwenye **umma**.

{% hint style="info" %}
Tafadhali kumbuka kwamba ili kupakia picha kwenye repo, **repo ya ECR inahitaji kuwa na jina sawa na picha**.
{% endhint %}

### Sera za Usajili & Repositori

**Usajili & repositori** pia zina **sera zinazoweza kutumika kutoa ruhusa kwa wakala/wakaunti wengine**. Kwa mfano, katika sera ya picha ya repositori ifuatayo unaweza kuona jinsi mtumiaji yeyote kutoka kwa shirika zima ataweza kupata picha:

<figure><img src="../../../.gitbook/assets/image (87).png" alt=""><figcaption></figcaption></figure>

### Uchambuzi

{% code overflow="wrap" %}
```bash
# Get repos
aws ecr describe-repositories
aws ecr describe-registry

# Get image metadata
aws ecr list-images --repository-name <repo_name>
aws ecr describe-images --repository-name <repo_name>
aws ecr describe-image-replication-status --repository-name <repo_name> --image-id <image_id>
aws ecr describe-image-scan-findings --repository-name <repo_name> --image-id <image_id>
aws ecr describe-pull-through-cache-rules --repository-name <repo_name> --image-id <image_id>

# Get public repositories
aws ecr-public describe-repositories

# Get policies
aws ecr get-registry-policy
aws ecr get-repository-policy --repository-name <repo_name>
```
### Uchunguzi usiothibitishwa

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md" %}
[aws-ecr-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

Kwenye ukurasa ufuatao unaweza kuangalia jinsi ya **kutumia vibali vya ECR kwa kujiongezea mamlaka**:

{% content-ref url="../aws-privilege-escalation/aws-ecr-privesc.md" %}
[aws-ecr-privesc.md](../aws-privilege-escalation/aws-ecr-privesc.md)
{% endcontent-ref %}

### Baada ya Uvamizi

{% content-ref url="../aws-post-exploitation/aws-ecr-post-exploitation.md" %}
[aws-ecr-post-exploitation.md](../aws-post-exploitation/aws-ecr-post-exploitation.md)
{% endcontent-ref %}

### Uthabiti

{% content-ref url="../aws-persistence/aws-ecr-persistence.md" %}
[aws-ecr-persistence.md](../aws-persistence/aws-ecr-persistence.md)
{% endcontent-ref %}

# Marejeo
* [https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html](https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html)

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka mwanzo hadi mtaalamu na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
