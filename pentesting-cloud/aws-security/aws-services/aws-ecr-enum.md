# AWS - ECR Enum

## AWS - ECR Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team 전문가)</strong>를 통해 **제로**부터 **히어로**까지 AWS 해킹을 배우세요!</summary>

HackTricks를 지원하는 다른 방법:

- **회사를 HackTricks에서 광고**하거나 **PDF로 HackTricks 다운로드**하려면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
- [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 얻으세요
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
- **Discord 그룹**에 **가입**하거나 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)를 **팔로우**하세요.
- **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

### ECR

#### 기본 정보

Amazon **Elastic Container Registry** (Amazon ECR)는 **관리형 컨테이너 이미지 레지스트리 서비스**입니다. 고객이 잘 알려진 인터페이스를 사용하여 컨테이너 이미지와 상호 작용할 수 있는 환경을 제공하도록 설계되었습니다. 구체적으로 Docker CLI 또는 선호하는 클라이언트를 사용하여 푸시, 풀 및 컨테이너 이미지 관리와 같은 활동을 지원합니다.

ECR은 **레지스트리**와 **저장소**로 구성됩니다.

**레지스트리**

모든 AWS 계정에는 **Private** 및 **Public** 2개의 레지스트리가 있습니다.

1. **Private 레지스트리**:

- **기본적으로 비공개**: Amazon ECR 비공개 레지스트리에 저장된 컨테이너 이미지는 **AWS 계정 내의 권한이 있는 사용자** 또는 권한이 부여된 사용자만 액세스할 수 있습니다.
- **비공개 저장소**의 URI는 `<account_id>.dkr.ecr.<region>.amazonaws.com/<repo-name>` 형식을 따릅니다.
- **액세스 제어**: **IAM 정책**을 사용하여 비공개 컨테이너 이미지에 대한 액세스를 **제어**할 수 있으며 사용자 또는 역할에 기반한 세밀한 권한을 구성할 수 있습니다.
- **AWS 서비스와의 통합**: Amazon ECR 비공개 레지스트리는 EKS, ECS 등 다른 AWS 서비스와 쉽게 **통합**될 수 있습니다.
- **기타 비공개 레지스트리 옵션**:
- Tag 불변성 열은 상태를 나열하며, 태그 불변성이 활성화되면 **기존 태그로 이미지 푸시를 방지**합니다.
- **암호화 유형** 열은 저장소의 암호화 속성을 나열하며, AES-256와 같은 기본 암호화 유형 또는 **KMS**가 활성화된 암호화를 보여줍니다.
- Pull through cache 열은 상태를 나열하며, Pull through cache 상태가 활성화되면 **외부 공개 저장소의 저장소를 개인 저장소로 캐시**합니다.
- 특정 **IAM 정책**을 구성하여 다른 **권한**을 부여할 수 있습니다.
- **스캔 구성**을 통해 저장소 내에 저장된 이미지의 취약점을 스캔할 수 있습니다.

2. **Public 레지스트리**:

- **공개 액세스**: ECR Public 레지스트리에 저장된 컨테이너 이미지는 **인증 없이 인터넷 상의 누구에게나 액세스**할 수 있습니다.
- **공개 저장소**의 URI는 `public.ecr.aws/<random>/<name>`와 같습니다. `<random>` 부분은 관리자가 다른 문자열로 변경할 수 있습니다.

**저장소**

이것은 **비공개 레지스트리**나 **공개 레지스트리**에 있는 **이미지**입니다.

{% hint style="info" %}
이미지를 저장소에 업로드하려면 **ECR 저장소가 이미지와 동일한 이름**을 가져야 합니다.
{% endhint %}

#### 레지스트리 및 저장소 정책

**레지스트리 및 저장소**에는 다른 주체/계정에 **권한을 부여하는 데 사용할 수 있는 정책**이 있습니다. 예를 들어, 다음 저장소 정책 이미지에서 조직 전체의 모든 사용자가 이미지에 액세스할 수 있는 방법을 볼 수 있습니다:

<figure><img src="../../../.gitbook/assets/image (280).png" alt=""><figcaption></figcaption></figure>

#### 열거

{% code overflow="wrap" %}
```bash
# Get repos
aws ecr describe-repositories
aws ecr describe-registry

# Get image metadata
aws ecr list-images --repository-name <repo_name>
aws ecr describe-images --repository-name <repo_name>
aws ecr describe-image-replication-status --repository-name <repo_name> --image-id <image_id>
aws ecr describe-image-scan-findings --repository-name <repo_name> --image-id <image_id>
aws ecr describe-pull-through-cache-rules --repository-name <repo_name> --image-id <image_id>

# Get public repositories
aws ecr-public describe-repositories

# Get policies
aws ecr get-registry-policy
aws ecr get-repository-policy --repository-name <repo_name>
```
{% endcode %}

#### 인증되지 않은 Enum

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md" %}
[aws-ecr-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md)
{% endcontent-ref %}

#### 권한 상승

다음 페이지에서 **ECR 권한을 남용하여 권한 상승**하는 방법을 확인할 수 있습니다:

{% content-ref url="../aws-privilege-escalation/aws-ecr-privesc.md" %}
[aws-ecr-privesc.md](../aws-privilege-escalation/aws-ecr-privesc.md)
{% endcontent-ref %}

#### 사후 공격

{% content-ref url="../aws-post-exploitation/aws-ecr-post-exploitation.md" %}
[aws-ecr-post-exploitation.md](../aws-post-exploitation/aws-ecr-post-exploitation.md)
{% endcontent-ref %}

#### 지속성

{% content-ref url="../aws-persistence/aws-ecr-persistence.md" %}
[aws-ecr-persistence.md](../aws-persistence/aws-ecr-persistence.md)
{% endcontent-ref %}

## 참고 자료

* [https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html](https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 제로부터 AWS 해킹을 전문가로 배우세요!</summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 PDF로 다운로드하려면** [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* 💬 [**디스코드 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)를 **팔로우**하세요.
* **HackTricks** 및 **HackTricks Cloud** 깃허브 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>
