# AWS - Enumeraci√≥n de WAF

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## WAF

AWS WAF es un **firewall de aplicaciones web** que ayuda a **proteger tus aplicaciones web** o APIs contra exploits web comunes que pueden afectar la disponibilidad, comprometer la seguridad o consumir recursos excesivos. AWS WAF te da control sobre **c√≥mo llega el tr√°fico a tus aplicaciones** al permitirte crear **reglas de seguridad que bloquean patrones de ataque comunes**, como la inyecci√≥n SQL o el scripting entre sitios, y reglas que filtran patrones de tr√°fico espec√≠ficos que definas.

### Condiciones

Las condiciones te permiten especificar **qu√© elementos de la solicitud HTTP o HTTPS entrante quieres que WAF est√© monitoreando** (XSS, GEO - filtrado por ubicaci√≥n-, direcci√≥n IP, restricciones de tama√±o, ataques de inyecci√≥n SQL, cadenas y coincidencias de expresiones regulares). Ten en cuenta que si est√°s restringiendo un pa√≠s desde CloudFront, esta solicitud no llegar√° al WAF.

Puedes tener **100 condiciones de cada tipo**, como Geo Match o restricciones de tama√±o, sin embargo, **Regex** es la **excepci√≥n** a esta regla donde solo se permiten **10 condiciones Regex**, pero este l√≠mite es posible de aumentar. Puedes tener **100 reglas y 50 Web ACLs por cuenta de AWS**. Est√°s limitado a **5 reglas basadas en la tasa** por cuenta. Finalmente, puedes tener **10,000 solicitudes por segundo** cuando **usas WAF** dentro de tu balanceador de carga de aplicaciones.

### Reglas

Usando estas condiciones, puedes crear reglas: por ejemplo, bloquear una solicitud si se cumplen 2 condiciones.\
Al crear tu regla, se te pedir√° que selecciones un **Tipo de Regla**: **Regla Regular** o **Regla Basada en Tasa**.

La √∫nica **diferencia** entre una regla basada en tasa y una regla regular es que las reglas basadas en tasa **cuentan** el **n√∫mero** de **solicitudes** que se reciben de una direcci√≥n IP particular durante un per√≠odo de tiempo de **cinco minutos**.

Cuando seleccionas una opci√≥n de regla basada en tasa, se te pide que **ingreses el n√∫mero m√°ximo de solicitudes de una sola IP dentro de un marco de tiempo de cinco minutos**. Cuando se alcanza el l√≠mite de conteo, **todas las dem√°s solicitudes de esa misma direcci√≥n IP se bloquean**. Si la tasa de solicitud vuelve a caer por debajo del l√≠mite de tasa especificado, el tr√°fico se permite pasar y ya no se bloquea. Al establecer tu l√≠mite de tasa, **debe establecerse en un valor superior a 2000**. Cualquier solicitud por debajo de este l√≠mite se considera una Regla Regular.

### Acciones

Se aplica una acci√≥n a cada regla, estas acciones pueden ser **Permitir**, **Bloquear** o **Contar**.

* Cuando se **permite** una solicitud, se **reenv√≠a** a la distribuci√≥n relevante de CloudFront o al balanceador de carga de aplicaciones.
* Cuando se **bloquea** una solicitud, la solicitud se **termina** all√≠ y no se realiza ning√∫n otro procesamiento de esa solicitud.
* Una acci√≥n de **Conteo** contar√° el n√∫mero de solicitudes que cumplen las condiciones dentro de esa regla. Esta es una opci√≥n realmente buena para seleccionar al probar las reglas para asegurarse de que la regla est√© recogiendo las solicitudes como se espera antes de establecerla en Permitir o Bloquear.

Si una **solicitud entrante no cumple ninguna regla** dentro del Web ACL, la solicitud toma la acci√≥n asociada a una **acci√≥n predeterminada** especificada que puede ser **Permitir** o **Bloquear**. Un punto importante a tener en cuenta acerca de estas reglas es que se **ejecutan en el orden en que se enumeran dentro de un Web ACL**. As√≠ que ten cuidado de arquitectar este orden correctamente para tu base de reglas, **t√≠picamente** se ordenan como se muestra:

1. IPs en lista blanca como Permitir.
2. IPs en lista negra como Bloquear.
3. Cualquier firma maliciosa tambi√©n como Bloquear.

### CloudWatch

Las m√©tricas de WAF CloudWatch se informan **en intervalos de un minuto por defecto** y se mantienen durante un per√≠odo de dos semanas. Las m√©tricas monitoreadas son Solicitudes Permitidas, Solicitudes Bloqueadas, Solicitudes Contadas y Solicitudes Pasadas.

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>