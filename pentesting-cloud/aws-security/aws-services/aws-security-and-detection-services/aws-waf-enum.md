# AWS - WAF Enum

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

# AWS WAF

AWS WAF is 'n **webtoepassing-firewall** wat ontwerp is om webtoepassings of API's te **beskerm teen verskeie webaanvalle** wat hul beskikbaarheid, veiligheid of hulpbronverbruik kan be√Ønvloed. Dit gee gebruikers die vermo√´ om inkomende verkeer te beheer deur **sekuriteitsre√´ls** op te stel wat tipiese aanvalsvektore soos SQL-injeksie of kruisskripskripseleksie verminder, asook deur aangepaste filterre√´ls te definieer.

## Monitoringskriteria (Voorwaardes)

Voorwaardes spesifiseer die elemente van inkomende HTTP/HTTPS-versoeke wat AWS WAF monitor, wat XSS, geografiese ligging (GEO), IP-adresse, groottebeperkings, SQL-injeksie en patrone (strings en regex-passing) insluit. Dit is belangrik om daarop te let dat versoeke wat op die CloudFront-vlak beperk is op grond van land, nie WAF sal bereik nie.

Elke AWS-rekening kan konfigureer:
- **100 voorwaardes** vir elke tipe (behalwe vir Regex, waar slegs **10 voorwaardes** toegelaat word, maar hierdie limiet kan verhoog word).
- **100 re√´ls** en **50 Web ACL's**.
- 'n maksimum van **5 tempo-gebaseerde re√´ls**.
- 'n deurset van **10 000 versoeke per sekonde** wanneer WAF ge√Ømplementeer word met 'n toepassingslaaibalansier.

## Re√´lkonfigurasie

Re√´ls word saamgestel deur die gespesifiseerde voorwaardes te gebruik. Byvoorbeeld, 'n re√´l kan 'n versoek blokkeer as dit aan 2 spesifieke voorwaardes voldoen. Daar is twee tipes re√´ls:

1. **Gewone Re√´l**: Standaardre√´l gebaseer op gespesifiseerde voorwaardes.
2. **Tempo-gebaseerde Re√´l**: Tel versoeke vanaf 'n spesifieke IP-adres oor 'n vyfminutetydperk. Hier stel gebruikers 'n drempelwaarde vas, en as die aantal versoeke vanaf 'n IP-adres binne vyf minute hierdie limiet oorskry, word daaropvolgende versoeke van daardie IP-adres geblokkeer totdat die versoektempo onder die drempelwaarde daal. Die minimumdrempelwaarde vir tempo-gebaseerde re√´ls is **2000 versoeke**.

## Aksies

Aksies word aan elke re√´l toegewys, met opsies soos **Toelaat**, **Blokkeer**, of **Tel**:

- **Toelaat**: Die versoek word deurgestuur na die toepaslike CloudFront-verspreiding of Toepassingslaaibalansier.
- **Blokkeer**: Die versoek word onmiddellik be√´indig.
- **Tel**: Tel die versoeke wat aan die re√´l se voorwaardes voldoen. Dit is nuttig vir re√´ltoetsing, om die akkuraatheid van die re√´l te bevestig voordat dit op Toelaat of Blokkeer ingestel word.

As 'n versoek nie aan enige re√´l binne die Web ACL voldoen nie, ondergaan dit die **standaardaksie** (Toelaat of Blokkeer). Die volgorde van re√´le uitvoering, wat binne 'n Web ACL gedefinieer is, is krities en volg tipies hierdie volgorde:

1. Toelaat vanaf witlys-IP's.
2. Blokkeer vanaf swartlys-IP's.
3. Blokkeer versoeke wat enige nadelige handtekeninge pas.

## CloudWatch-integrasie

AWS WAF integreer met CloudWatch vir monitering en bied metings soos AllowedRequests, BlockedRequests, CountedRequests en PassedRequests. Hierdie metings word standaard elke minuut gerapporteer en vir 'n tydperk van twee weke behou.

## Enumerasie

Die omvang kan ook CLOUDFRONT wees, maar wanneer jy vir 'n WAF wat nie verband hou met CloudFront nie, wil nagaan, moet jy REGIONAL gebruik.
```
# Get web acls
aws wafv2 list-web-acls --scope REGIONAL
aws wafv2 get-web-acl --scope REGIONAL --name <name> --id <id>
aws wafv2 list-resources-for-web-acl --web-acl-arn <web-acl-arn> #Resources associated with the ACL
aws wafv2 get-web-acl-for-resource --resource-arn <arn> # Get web acl of the resource

# Rule groups
aws wafv2 list-rule-groups --scope REGIONAL
aws wafv2 get-rule-group --scope REGIONAL --name <name> --id <id>

# Get IP sets
aws wafv2 list-ip-sets --scope=REGIONAL
aws wafv2 get-ip-set --scope=REGIONAL --name <name> --id <id>

# Get regex patterns
aws wafv2 list-regex-pattern-sets --scope REGIONAL

# Get logging config (buckets storing the logs)
aws wafv2 list-logging-configurations --scope=REGIONAL
```
## Post Exploitasie / Deurbreek

{% hint style="success" %}
Vanuit 'n aanvaller se perspektief kan hierdie diens die aanvaller help om WAF-beskerming en netwerk blootstelling te identifiseer wat hom kan help om ander webwerwe te kompromitteer.

'n Aanvaller kan egter ook belangstel om hierdie diens te ontwrig sodat die webwerwe nie deur die WAF beskerm word nie.
{% endhint %}

TODO: PR's is welkom

# Verwysings
* https://www.citrusconsulting.com/aws-web-application-firewall-waf/#:~:text=Conditions%20allow%20you%20to%20specify,user%20via%20a%20web%20application.

<details>

<summary><strong>Leer AWS hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
