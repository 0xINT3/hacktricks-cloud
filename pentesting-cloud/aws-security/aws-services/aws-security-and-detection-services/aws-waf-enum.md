# AWS - WAF Enum

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricks**であなたの**会社を広告**したい場合や、**PEASSの最新バージョンにアクセス**したい場合、または**HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## WAF

AWS WAFは、**一般的なWebの脆弱性**によるWebアプリケーションやAPIの**可用性への影響、セキュリティの危険、過剰なリソース消費**から、Webアプリケーションを保護する**Webアプリケーションファイアウォール**です。 AWS WAFを使用すると、SQLインジェクションやクロスサイトスクリプティングなどの**一般的な攻撃パターンをブロックするセキュリティルール**や、特定のトラフィックパターンをフィルタリングするルールを作成できます。

### 条件

条件を使用して、WAFが監視する**受信HTTPまたはHTTPSリクエストの要素**（XSS、GEO-場所によるフィルタリング、IPアドレス、サイズ制約、SQLインジェクション攻撃、文字列および正規表現の一致）を指定できます。ただし、CloudFrontから国を制限している場合、このリクエストはWAFに到達しません。

Geo Matchやサイズ制約などのように、**各タイプの条件を100個**持つことができますが、**Regex**はこのルールの**例外**であり、**10個のRegex**条件のみが許可されますが、この制限は増やすことが可能です。 AWSアカウントごとに**100のルールと50のWeb ACL**を持つことができます。アカウントごとに**5つのレートベースのルール**が制限されています。最後に、アプリケーションロードバランサー内で**WAFを使用**する場合、**1秒あたりのリクエスト数は10,000**です。

### ルール

これらの条件を使用して、ルールを作成できます。例えば、2つの条件が満たされた場合にリクエストをブロックします。\
ルールを作成する際には、**ルールタイプ**（**通常のルール**または**レートベースのルール**）を選択するように求められます。

レートベースのルールと通常のルールの**唯一の違い**は、レートベースのルールが**5分間の時間枠内で特定のIPアドレスから受信されるリクエストの数**を**カウント**することです。

レートベースのルールオプションを選択すると、**5分間の時間枠内で単一のIPからの最大リクエスト数**を入力するように求められます。カウント制限に達すると、その同じIPアドレスからの他のすべてのリクエストはブロックされます。リクエストレートが指定されたレート制限以下に戻った場合、トラフィックは通過し、ブロックされなくなります。レート制限を設定する際には、**2000以上の値に設定する必要があります**。この制限以下のリクエストは通常のルールと見なされます。

### アクション

各ルールにアクションが適用されます。これらのアクションは**許可**、**ブロック**、または**カウント**のいずれかです。

* リクエストが**許可**されると、関連するCloudFrontディストリビューションまたはアプリケーションロードバランサーに**転送**されます。
* リクエストが**ブロック**されると、リクエストはそこで**終了**し、そのリクエストのさらなる処理は行われません。
* **カウント**アクションは、そのルール内の条件を満たすリクエストの数を**カウント**します。これは、ルールが予想どおりのリクエストを取得していることを確認するためにルールをテストする際に選択する非常に良いオプションです。その後、AllowまたはBlockに設定する前に。

Web ACL内の**どのルールにも一致しない着信リクエスト**は、指定された**デフォルトアクション**（AllowまたはBlock）に関連付けられたアクションを実行します。これらのルールについて重要なポイントは、それらがWeb ACL内のリストされた順序で**実行される**ということです。したがって、ルールベースのためにこの順序を正しく設計するために注意してください。**通常**、これらは次のように**順序付け**られます：

1. AllowとしてホワイトリストされたIPアドレス。
2. ブロックされたIPアドレスをブラックリストに登録。
3. バッドシグネチャもブロックとして。

### CloudWatch

WAF CloudWatchメトリクスは、デフォルトでは**1分間隔**で報告され、2週間保持されます。監視されるメトリクスには、AllowedRequests、BlockedRequests、CountedRequests、PassedRequestsがあります。

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricks**であなたの**会社を広告**したい場合や、**PEASSの最新バージョンにアクセス**したい場合、または**HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
