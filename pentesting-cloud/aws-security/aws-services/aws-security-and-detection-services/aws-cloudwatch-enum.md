# AWS - CloudWatch Enum

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## CloudWatch

**CloudWatch** **sammelt** √úberwachungs- und Betriebsdaten in Form von Protokollen/Metriken/Ereignissen und bietet eine **einheitliche Ansicht der AWS-Ressourcen**, Anwendungen und Dienste.\
CloudWatch-Log-Ereignisse haben eine **Gr√∂√üenbeschr√§nkung von 256 KB pro Protokollzeile**.\
Es k√∂nnen **Hochaufl√∂sungsalarme** festgelegt, **Protokolle** und **Metriken** nebeneinander visualisiert, automatisierte Aktionen durchgef√ºhrt, Probleme behoben und Erkenntnisse zur Optimierung von Anwendungen gewonnen werden.

Sie k√∂nnen beispielsweise Protokolle von CloudTrail √ºberwachen. √úberwachte Ereignisse:

* √Ñnderungen an Sicherheitsgruppen und NACLs
* Starten, Stoppen, Neustarten und Beenden von EC2-Instanzen
* √Ñnderungen an Sicherheitsrichtlinien innerhalb von IAM und S3
* Fehlgeschlagene Anmeldeversuche an der AWS-Managementkonsole
* API-Aufrufe, die zu fehlgeschlagener Autorisierung f√ºhrten
* Filter zum Suchen in CloudWatch: [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

### CloudWatch-Protokolle <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

Erm√∂glicht das **Aggregieren und √úberwachen von Protokollen aus Anwendungen** und Systemen von **AWS-Diensten** (einschlie√ülich CloudTrail) und **von Apps/Systemen** (der **CloudWatch-Agent** kann auf einem Host installiert werden). Protokolle k√∂nnen **unbegrenzt gespeichert** werden (abh√§ngig von den Einstellungen der Protokollgruppe) und exportiert werden.

**Elemente**:

| **Protokollgruppe**      | Eine **Sammlung von Protokollstr√∂men**, die dieselben Aufbewahrungs-, √úberwachungs- und Zugriffssteuerungseinstellungen teilen                                      |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Protokollstrom**       | Eine Sequenz von **Protokollereignissen**, die die **gleiche Quelle** teilen                                                                                |
| **Abonnementfilter**     | Definieren ein **Filtermuster, das Ereignisse** in einer bestimmten Protokollgruppe abgleicht, und senden sie an einen Kinesis Data Firehose-Stream, einen Kinesis-Stream oder eine Lambda-Funktion |

### CloudWatch-√úberwachung & Ereignisse

CloudWatch **basic** aggregiert Daten **alle 5 Minuten** (die **detaillierte** Version macht das **alle 1 Minute**). Nach der Aggregation **√ºberpr√ºft** es die Schwellenwerte der Alarme, falls einer ausgel√∂st werden muss.\
In diesem Fall kann CloudWatch vorbereitet sein, ein Ereignis zu senden und automatische Aktionen auszuf√ºhren (AWS Lambda-Funktionen, SNS-Themen, SQS-Warteschlangen, Kinesis-Streams)

### Agenteninstallation

Sie k√∂nnen Agenten in Ihren Maschinen/Containern installieren, um die Protokolle automatisch an CloudWatch zur√ºckzusenden.

* **Erstellen** Sie eine **Rolle** und **h√§ngen** Sie sie an die **Instanz** an, mit Berechtigungen, die es CloudWatch erm√∂glichen, Daten von den Instanzen zu sammeln, zus√§tzlich zur Interaktion mit AWS Systems Manager SSM (CloudWatchAgentAdminPolicy & AmazonEC2RoleforSSM)
* **Laden** Sie den **Agenten** auf die EC2-Instanz herunter und **installieren** Sie ihn ([https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip](https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip)). Sie k√∂nnen ihn von innerhalb der EC2 herunterladen oder ihn automatisch mit AWS System Manager installieren, indem Sie das Paket AWS-ConfigureAWSPackage ausw√§hlen
* **Konfigurieren** und **starten** Sie den CloudWatch-Agenten

Eine Protokollgruppe hat viele Str√∂me. Ein Strom hat viele Ereignisse. Und innerhalb jedes Stroms sind die Ereignisse garantiert in der richtigen Reihenfolge.

## Aktionen

### Enumeration
```bash
# Dashboards
aws cloudwatch list-dashboards
aws cloudwatch get-dashboard --dashboard-name <dashboard_name>

# Alarms
aws cloudwatch describe-alarms
aws cloudwatch describe-alarm-history
aws cloudwatch describe-alarms-for-metric --metric-name <metric_name> --namespace <namespace>
aws cloudwatch describe-alarms-for-metric --metric-name IncomingLogEvents --namespace AWS/Logs

# Anomaly Detections
aws cloudwatch describe-anomaly-detectors
aws cloudwatch describe-insight-rules

# Logs
aws logs tail "<log_group_name>" --follow
aws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# Events enumeration
aws events list-rules
aws events describe-rule --name <name>
aws events list-targets-by-rule --rule <name>
aws events list-archives
aws events describe-archive --archive-name <name>
aws events list-connections
aws events describe-connection --name <name>
aws events list-endpoints
aws events describe-endpoint --name <name>
aws events list-event-sources
aws events describe-event-source --name <name>
aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## Referenzen

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
