# AWS - CloudWatch Enum

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## CloudWatch

**CloudWatch** **collecte** des donn√©es de surveillance et op√©rationnelles sous forme de journaux/m√©triques/√©v√©nements fournissant une **vue unifi√©e des ressources AWS**, des applications et des services.\
Les √©v√©nements de journalisation CloudWatch ont une **limite de taille de 256 Ko sur chaque ligne de journal**.\
Il peut d√©finir des **alarmes √† haute r√©solution**, visualiser **des journaux** et **des m√©triques** c√¥te √† c√¥te, prendre des mesures automatis√©es, r√©soudre les probl√®mes et d√©couvrir des informations pour optimiser les applications.

Vous pouvez surveiller par exemple les journaux de CloudTrail. √âv√©nements surveill√©s :

* Modifications des groupes de s√©curit√© et des NACL
* D√©marrage, arr√™t, red√©marrage et terminaison des instances EC2
* Modifications des strat√©gies de s√©curit√© dans IAM et S3
* Tentatives de connexion √©chou√©es √† la console de gestion AWS
* Appels API ayant entra√Æn√© une autorisation √©chou√©e
* Filtres de recherche dans CloudWatch : [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

### Journaux CloudWatch <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

Permet d'**agr√©ger et de surveiller les journaux des applications** et des syst√®mes des **services AWS** (y compris CloudTrail) et des **applications/syst√®mes** (**l'agent CloudWatch** peut √™tre install√© sur un h√¥te). Les journaux peuvent √™tre **stock√©s ind√©finiment** (selon les param√®tres du groupe de journaux) et peuvent √™tre export√©s.

**√âl√©ments** :

| **Groupe de journaux**   | Une **collection de flux de journaux** partageant les m√™mes param√®tres de r√©tention, de surveillance et de contr√¥le d'acc√®s                                      |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Flux de journaux**     | Une s√©quence d'**√©v√©nements de journalisation** partageant la **m√™me source**                                                                                |
| **Filtres d'abonnement** | D√©finir un **motif de filtre correspondant aux √©v√©nements** dans un groupe de journaux particulier, les envoyer vers un flux Kinesis Data Firehose, un flux Kinesis ou une fonction Lambda |

### Surveillance et √©v√©nements CloudWatch

CloudWatch **de base** agr√®ge les donn√©es **toutes les 5 minutes** (celui **d√©taill√©** le fait **toutes les 1 minute**). Apr√®s l'agr√©gation, il **v√©rifie les seuils des alarmes** au cas o√π il devrait en d√©clencher une.\
Dans ce cas, CloudWatch peut √™tre pr√™t √† envoyer un √©v√©nement et √† effectuer des actions automatiques (fonctions Lambda AWS, sujets SNS, files d'attente SQS, flux Kinesis)

### Installation de l'agent

Vous pouvez installer des agents √† l'int√©rieur de vos machines/conteneurs pour envoyer automatiquement les journaux vers CloudWatch.

* **Cr√©ez** un **r√¥le** et **attachez**-le √† l'**instance** avec des autorisations permettant √† CloudWatch de collecter des donn√©es √† partir des instances en plus d'interagir avec le gestionnaire de syst√®mes AWS SSM (CloudWatchAgentAdminPolicy & AmazonEC2RoleforSSM)
* **T√©l√©chargez** et **installez** l'**agent** sur l'instance EC2 ([https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip](https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip)). Vous pouvez le t√©l√©charger depuis l'int√©rieur de l'EC2 ou l'installer automatiquement √† l'aide du Gestionnaire de syst√®mes AWS en s√©lectionnant le package AWS-ConfigureAWSPackage
* **Configurez** et **d√©marrez** l'agent CloudWatch

Un groupe de journaux a de nombreux flux. Un flux a de nombreux √©v√©nements. Et √† l'int√©rieur de chaque flux, les √©v√©nements sont garantis d'√™tre dans l'ordre.

## Actions

### √ânum√©ration
```bash
# Dashboards
aws cloudwatch list-dashboards
aws cloudwatch get-dashboard --dashboard-name <dashboard_name>

# Alarms
aws cloudwatch describe-alarms
aws cloudwatch describe-alarm-history
aws cloudwatch describe-alarms-for-metric --metric-name <metric_name> --namespace <namespace>
aws cloudwatch describe-alarms-for-metric --metric-name IncomingLogEvents --namespace AWS/Logs

# Anomaly Detections
aws cloudwatch describe-anomaly-detectors
aws cloudwatch describe-insight-rules

# Logs
aws logs tail "<log_group_name>" --follow
aws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# Events enumeration
aws events list-rules
aws events describe-rule --name <name>
aws events list-targets-by-rule --rule <name>
aws events list-archives
aws events describe-archive --archive-name <name>
aws events list-connections
aws events describe-connection --name <name>
aws events list-endpoints
aws events describe-endpoint --name <name>
aws events list-event-sources
aws events describe-event-source --name <name>
aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## R√©f√©rences

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
