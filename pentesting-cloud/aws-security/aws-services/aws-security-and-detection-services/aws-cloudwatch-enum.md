# AWS - CloudWatch Enum

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## CloudWatch

**CloudWatch** **sakuplja** nadzorne i operativne **podatke** u obliku logova/metriƒçkih podataka/dogaƒëaja pru≈æajuƒái **ujedinjen prikaz AWS resursa**, aplikacija i usluga.\
CloudWatch Log Event ima **ograniƒçenje veliƒçine od 256KB na svakoj liniji loga**.\
Mo≈æe postaviti **alarme visoke rezolucije**, vizualizovati **logove** i **metrike** jedno pored drugog, preduzimati automatske akcije, re≈°avati probleme i otkrivati uvide za optimizaciju aplikacija.

Mo≈æete pratiti na primer logove iz CloudTrail-a. Dogaƒëaji koji se prate:

* Promene u Security Group-ama i NACL-ovima
* Pokretanje, zaustavljanje, restartovanje i ga≈°enje EC2 instanci
* Promene u Security Policy-ima unutar IAM-a i S3
* Neuspeli poku≈°aji prijave na AWS Management Console
* API pozivi koji su rezultirali neuspelom autorizacijom
* Filteri za pretragu u cloudwatch-u: [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

### CloudWatch Logovi <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

Omoguƒáava **agregiranje i praƒáenje logova iz aplikacija** i sistema iz **AWS usluga** (ukljuƒçujuƒái CloudTrail) i **iz aplikacija/sistema** (**CloudWatch Agent** mo≈æe biti instaliran na hostu). Logovi mogu biti **ƒçuvani neograniƒçeno dugo** (u zavisnosti od pode≈°avanja Log Group-a) i mogu biti izvezeni.

**Elementi**:

| **Log Group**            | **Kolekcija log stream-ova** koji dele ista pode≈°avanja zadr≈æavanja, nadzora i kontrole pristupa                                                     |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Log Stream**           | Sekvenca **log dogaƒëaja** koji dele **isti izvor**                                                                                                |
| **Subscription Filters** | Defini≈°u **filter ≈°ablon koji odgovara dogaƒëajima** u odreƒëenoj log grupi, ≈°alju ih na Kinesis Data Firehose stream, Kinesis stream ili Lambda funkciju |

### CloudWatch Nadgledanje i Dogaƒëaji

CloudWatch **osnovno** agregira podatke **svakih 5 minuta** (detaljno to radi **svakih 1 minut**). Nakon agregacije, **proverava pragove alarma** u sluƒçaju da treba da pokrene jedan.\
U tom sluƒçaju, CloudWatch mo≈æe biti spreman da po≈°alje dogaƒëaj i izvr≈°i neke automatske akcije (AWS lambda funkcije, SNS teme, SQS redovi, Kinesis Stream-ovi)

### Instalacija Agent-a

Mo≈æete instalirati agente unutar va≈°ih ma≈°ina/kontejnera da automatski ≈°alju logove nazad u CloudWatch.

* **Kreirajte** ulogu i **dodelite** je **instanci** sa dozvolama koje omoguƒáavaju CloudWatch-u da sakuplja podatke sa instanci i da interaguje sa AWS sistem menad≈æerom SSM (CloudWatchAgentAdminPolicy & AmazonEC2RoleforSSM)
* **Preuzmite** i **instalirajte** agent na EC2 instancu ([https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip](https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip)). Mo≈æete ga preuzeti sa unutar EC2 ili ga automatski instalirati koristeƒái AWS System Manager i odabir paketa AWS-ConfigureAWSPackage
* **Konfiguri≈°ite** i **pokrenite** CloudWatch Agent-a

Log grupa ima mnogo stream-ova. Stream ima mnogo dogaƒëaja. A unutar svakog stream-a, dogaƒëaji su garantovano poreƒëani.

## Akcije

### Enumeracija
```bash
# Dashboards
aws cloudwatch list-dashboards
aws cloudwatch get-dashboard --dashboard-name <dashboard_name>

# Alarms
aws cloudwatch describe-alarms
aws cloudwatch describe-alarm-history
aws cloudwatch describe-alarms-for-metric --metric-name <metric_name> --namespace <namespace>
aws cloudwatch describe-alarms-for-metric --metric-name IncomingLogEvents --namespace AWS/Logs

# Anomaly Detections
aws cloudwatch describe-anomaly-detectors
aws cloudwatch describe-insight-rules

# Logs
aws logs tail "<log_group_name>" --follow
aws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# Events enumeration
aws events list-rules
aws events describe-rule --name <name>
aws events list-targets-by-rule --rule <name>
aws events list-archives
aws events describe-archive --archive-name <name>
aws events list-connections
aws events describe-connection --name <name>
aws events list-endpoints
aws events describe-endpoint --name <name>
aws events list-event-sources
aws events describe-event-source --name <name>
aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## Reference

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju ogla≈°enu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
