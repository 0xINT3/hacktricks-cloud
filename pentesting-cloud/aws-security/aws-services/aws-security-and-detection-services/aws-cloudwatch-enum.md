# AWS - CloudWatch Enum

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## CloudWatch

Το **CloudWatch** **συλλέγει** παρακολούθηση και λειτουργικά **δεδομένα** σε μορφή καταγραφών/μετρήσεων/συμβάντων παρέχοντας μια **ενοποιημένη προβολή των πόρων AWS**, εφαρμογών και υπηρεσιών.\
Τα γεγονότα καταγραφής CloudWatch έχουν έναν **περιορισμό μεγέθους των 256KB σε κάθε γραμμή καταγραφής**.\
Μπορεί να ορίσει **συναγερμούς υψηλής ανάλυσης**, να οπτικοποιήσει **καταγραφές** και **μετρήσεις** δίπλα-δίπλα, να πραγματοποιήσει αυτόματες ενέργειες, να επιλύσει προβλήματα και να ανακαλύψει εισαγωγές για τη βελτιστοποίηση εφαρμογών.

Μπορείτε να παρακολουθείτε για παράδειγμα καταγραφές από το CloudTrail. Εκδηλώσεις που παρακολουθούνται:

* Αλλαγές στις Ομάδες Ασφαλείας και τους NACLs
* Έναρξη, Διακοπή, επανεκκίνηση και τερματισμός των παραδειγμάτων EC2
* Αλλαγές στις Πολιτικές Ασφαλείας εντός του IAM και του S3
* Αποτυχημένες προσπάθειες σύνδεσης στην κονσόλα διαχείρισης του AWS
* Κλήσεις API που οδήγησαν σε αποτυχημένη εξουσιοδότηση
* Φίλτρα για αναζήτηση στο cloudwatch: [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

### Καταγραφές CloudWatch <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

Επιτρέπει την **συγκέντρωση και παρακολούθηση καταγραφών από εφαρμογές** και συστήματα από **υπηρεσίες AWS** (συμπεριλαμβανομένου του CloudTrail) και **από εφαρμογές/συστήματα** (**ο πράκτορας CloudWatch** μπορεί να εγκατασταθεί σε έναν κεντρικό υπολογιστή). Οι καταγραφές μπορούν να **αποθηκευτούν απεριόριστα** (ανάλογα με τις ρυθμίσεις της Ομάδας Καταγραφής) και μπορούν να εξαχθούν.

**Στοιχεία**:

| **Ομάδα Καταγραφής**    | Μια **συλλογή από ροές καταγραφής** που μοιράζονται τις ίδιες ρυθμίσεις διατήρησης, παρακολούθησης και ελέγχου πρόσβασης |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Ροή Καταγραφής**       | Μια ακολουθία **γεγονότων καταγραφής** που μοιράζονται την **ίδια πηγή**                                                                                     |
| **Φίλτρα Συνδρομής**    | Ορίζουν ένα **πρότυπο φίλτρου που ταιριάζει με τα γεγονότα** σε μια συγκεκριμένη ομάδα καταγραφής, τα στέλνουν σε ροή Kinesis Data Firehose, ροή Kinesis ή σε μια συνάρτηση Lambda |

### Παρακολούθηση & Εκδηλώσεις CloudWatch

Το CloudWatch **βασικό** συγκεντρώνει δεδομένα **κάθε 5 λεπτά** (το **λεπτομερές** κάνει αυτό **κάθε 1 λεπτό**). Μετά τη συγκέντρωση, **ελέγχει τα όρια των συναγερμών** για να ενεργοποιήσει έναν.\
Σε αυτήν την περίπτωση, το CLoudWatch μπορεί να είναι έτοιμο να στείλει ένα γεγονός και να πραγματοποιήσει ορισμένες αυτόματες ενέργειες (συναρτήσεις AWS lambda, θέματα SNS, ουρές SQS, ροές Kinesis)

### Εγκατάσταση Πράκτορα

Μπορείτε να εγκαταστήσετε πράκτορες μέσα στις μηχανές/δοχεία σας για να στέλνουν αυτόματα τις καταγραφές πίσω στο CloudWatch.

* **Δημιουργήστε** έναν **ρόλο** και **συνδέστε τον** με την **παράδειγμα** με δικαιώματα που επιτρέπουν στο CloudWatch να συλλέγει δεδομένα από τα παραδείγματα εκτός από την αλληλεπίδραση με τον διαχειριστή συστημάτων AWS SSM (CloudWatchAgentAdminPolicy & AmazonEC2RoleforSSM)
* **Κατεβάστε** και **εγκατ
```bash
# Dashboards
aws cloudwatch list-dashboards
aws cloudwatch get-dashboard --dashboard-name <dashboard_name>

# Alarms
aws cloudwatch describe-alarms
aws cloudwatch describe-alarm-history
aws cloudwatch describe-alarms-for-metric --metric-name <metric_name> --namespace <namespace>
aws cloudwatch describe-alarms-for-metric --metric-name IncomingLogEvents --namespace AWS/Logs

# Anomaly Detections
aws cloudwatch describe-anomaly-detectors
aws cloudwatch describe-insight-rules

# Logs
aws logs tail "<log_group_name>" --follow
aws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# Events enumeration
aws events list-rules
aws events describe-rule --name <name>
aws events list-targets-by-rule --rule <name>
aws events list-archives
aws events describe-archive --archive-name <name>
aws events list-connections
aws events describe-connection --name <name>
aws events list-endpoints
aws events describe-endpoint --name <name>
aws events list-event-sources
aws events describe-event-source --name <name>
aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## Αναφορές

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
