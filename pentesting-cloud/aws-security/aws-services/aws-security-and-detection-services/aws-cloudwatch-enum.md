# AWS - Enumerazione di CloudWatch

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di github.

</details>

## CloudWatch

**CloudWatch** **raccoglie** dati di monitoraggio e operativi sotto forma di log/metriche/eventi fornendo una **visione unificata delle risorse**, delle applicazioni e dei servizi AWS.\
Gli eventi di log di CloudWatch hanno un **limite di dimensione di 256KB per ogni riga di log**.\
Pu√≤ impostare **allarmi ad alta risoluzione**, visualizzare **log** e **metriche** affiancati, eseguire azioni automatizzate, risolvere problemi e scoprire informazioni per ottimizzare le applicazioni.

√à possibile monitorare ad esempio i log di CloudTrail. Eventi che vengono monitorati:

* Modifiche ai gruppi di sicurezza e alle ACL
* Avvio, arresto, riavvio e terminazione delle istanze EC2
* Modifiche alle politiche di sicurezza all'interno di IAM e S3
* Tentativi di accesso non riusciti alla console di gestione AWS
* Chiamate API che hanno causato un'autorizzazione non riuscita
* Filtri per la ricerca in cloudwatch: [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

### CloudWatch Logs <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

Consente di **aggregare e monitorare i log delle applicazioni** e dei sistemi dai **servizi AWS** (incluso CloudTrail) e dai **sistemi/applicazioni** (**l'agente CloudWatch** pu√≤ essere installato su un host). I log possono essere **archiviati indefinitamente** (a seconda delle impostazioni del gruppo di log) e possono essere esportati.

**Elementi**:

| **Gruppo di log**       | Una **raccolta di flussi di log** che condividono le stesse impostazioni di conservazione, monitoraggio e controllo dell'accesso                                |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Flusso di log**       | Una sequenza di **eventi di log** che condividono la **stessa origine**                                                                                   |
| **Filtri di sottoscrizione** | Definiscono un **modello di filtro che corrisponde agli eventi** in un determinato gruppo di log, li inviano a uno stream di Kinesis Data Firehose, a uno stream di Kinesis o a una funzione Lambda |

### Monitoraggio ed eventi di CloudWatch

CloudWatch **base** aggrega i dati **ogni 5 minuti** (quello **dettagliato** lo fa **ogni 1 minuto**). Dopo l'aggregazione, **verifica le soglie degli allarmi** nel caso in cui sia necessario attivarne uno.\
In tal caso, CloudWatch pu√≤ essere preparato per inviare un evento e eseguire alcune azioni automatiche (funzioni AWS lambda, argomenti SNS, code SQS, flussi Kinesis)

### Installazione dell'agente

√à possibile installare agenti all'interno delle proprie macchine/contenitori per inviare automaticamente i log a CloudWatch.

* **Crea** un **ruolo** e **collegalo** all'**istanza** con le autorizzazioni che consentono a CloudWatch di raccogliere dati dalle istanze oltre a interagire con AWS Systems Manager SSM (CloudWatchAgentAdminPolicy e AmazonEC2RoleforSSM)
* **Scarica** e **installa** l'**agente** sull'istanza EC2 ([https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip](https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip)). Puoi scaricarlo dall'interno dell'istanza EC2 o installarlo automaticamente utilizzando AWS System Manager selezionando il pacchetto AWS-ConfigureAWSPackage
* **Configura** e **avvia** l'agente CloudWatch

Un gruppo di log ha molti flussi. Un flusso ha molti eventi. E all'interno di ogni flusso, gli eventi sono garantiti essere in ordine.

## Azioni

### Enumerazione
```bash
# Dashboards
aws cloudwatch list-dashboards
aws cloudwatch get-dashboard --dashboard-name <dashboard_name>

# Alarms
aws cloudwatch describe-alarms
aws cloudwatch describe-alarm-history
aws cloudwatch describe-alarms-for-metric --metric-name <metric_name> --namespace <namespace>
aws cloudwatch describe-alarms-for-metric --metric-name IncomingLogEvents --namespace AWS/Logs

# Anomaly Detections
aws cloudwatch describe-anomaly-detectors
aws cloudwatch describe-insight-rules

# Logs
aws logs tail "<log_group_name>" --follow
aws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# Events enumeration
aws events list-rules
aws events describe-rule --name <name>
aws events list-targets-by-rule --rule <name>
aws events list-archives
aws events describe-archive --archive-name <name>
aws events list-connections
aws events describe-connection --name <name>
aws events list-endpoints
aws events describe-endpoint --name <name>
aws events list-event-sources
aws events describe-event-source --name <name>
aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## Riferimenti

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF**, controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
