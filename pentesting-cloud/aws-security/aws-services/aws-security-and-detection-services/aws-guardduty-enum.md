# AWS - GuardDuty Enum

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## GuardDuty

[**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝**](https://aws.amazon.com/guardduty/features/) рдХреЗ рдЕрдиреБрд╕рд╛рд░: GuardDuty **рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ, рдЕрдиреИрдорд▓реА рдбрд┐рдЯреЗрдХреНрд╢рди, рдиреЗрдЯрд╡рд░реНрдХ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ, рдФрд░ рджреБрд╖реНрдЯ рдлрд╝рд╛рдЗрд▓ рдЦреЛрдЬ** рдХрд╛ рд╕рдВрдпреЛрдЬрди рдХрд░рддрд╛ рд╣реИ, AWS рдФрд░ рдЙрджреНрдпреЛрдЧ-рдкреНрд░рдореБрдЦ рддреГрддреАрдп-рдкрдХреНрд╖ рд╕реНрд░реЛрддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ AWS рдкрд░ рдХрд╛рд░реНрдпрднрд╛рд░ рдФрд░ рдбреЗрдЯрд╛ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рдорджрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред GuardDuty рдХрдИ AWS рдбреЗрдЯрд╛ рд╕реНрд░реЛрддреЛрдВ, рдЬреИрд╕реЗ AWS CloudTrail рдШрдЯрдирд╛ рд▓реЙрдЧ, Amazon Virtual Private Cloud (VPC) рдлреНрд▓реЛ рд▓реЙрдЧ, Amazon Elastic Kubernetes Service (EKS) рдСрдбрд┐рдЯ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рд╕реНрддрд░ рдХреЗ рд▓реЙрдЧ, рдФрд░ DNS рдХреНрд╡реЗрд░реА рд▓реЙрдЧ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд▓рд╛рдЦреЛрдВ рдХрд░реЛрдбрд╝ рдШрдЯрдирд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИред

Amazon GuardDuty **рдЖрдкрдХреЗ рдЦрд╛рддреЛрдВ рдореЗрдВ рдЕрд╕рд╛рдорд╛рдиреНрдп рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреА рдкрд╣рдЪрд╛рди** рдХрд░рддрд╛ рд╣реИ, рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреА **рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрдмрдВрдзрд┐рддрддрд╛** рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЙрд╕ рд╕рдВрджрд░реНрдн рдореЗрдВ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдпрд╣ рдЖрд╡рд╛рд╣рд┐рдд рд╣реБрдЖ рдерд╛ред рдЗрд╕рд╕реЗ рдПрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рд╡рд╛рджреА рдХреЛ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдорд┐рд▓рддреА рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЙрдиреНрд╣реЗрдВ рдФрд░ рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдкрд░ рд╕рдордп рдмрд┐рддрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЕрд▓рд░реНрдЯ **GuardDuty рдХрд╛рдВрд╕реЛрд▓ (90 рджрд┐рди)** рдФрд░ CloudWatch рдШрдЯрдирд╛рдПрдБ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВред

{% hint style="warning" %}
рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **GuardDuty рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИ**, рддреЛ рдпрд╣ рдЖрдкрдХреЗ AWS рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╛ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ рдмрдВрдж рдХрд░ рджреЗрдЧрд╛ рдФрд░ рдпрд╣ рдХреЛрдИ рдирдИ рдлрд╛рдЗрдВрдбрд┐рдВрдЧ рдирд╣реАрдВ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛, рдФрд░ **рдореМрдЬреВрджрд╛ рдлрд╛рдЗрдВрдбрд┐рдВрдЧ рдЦреЛ рдЬрд╛рдПрдЧреА**ред\
рдЕрдЧрд░ рдЖрдк рдмрд╕ рдЗрд╕реЗ рд░реЛрдХ рджреЗрддреЗ рд╣реИрдВ, рддреЛ рдореМрдЬреВрджрд╛ рдлрд╛рдЗрдВрдбрд┐рдВрдЧ рдмрдиреА рд░рд╣реЗрдЧреАред
{% endhint %}

### рдлрд╛рдЗрдВрдбрд┐рдВрдЧреНрд╕ рдЙрджрд╛рд╣рд░рдг

* **рд░рд┐рдХреЙрдиреЗрд╕реЗрдВрд╕**: рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рд░рд┐рдХреЙрдиреЗрд╕реЗрдВрд╕ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрдиреЗ рд╡рд╛рд▓реА рдЧрддрд┐рд╡рд┐рдзрд┐, рдЬреИрд╕реЗ **рдЕрд╕рд╛рдорд╛рдиреНрдп рдПрдкреАрдЖрдИ рдЧрддрд┐рд╡рд┐рдзрд┐**, рд╕рдВрджрд┐рдЧреНрдз рдбреЗрдЯрд╛рдмреЗрд╕ **рд▓реЙрдЧрд┐рди** рдкреНрд░рдпрд╛рд╕, рдЗрдВрдЯреНрд░рд╛-VPC **рдкреЛрд░реНрдЯ рд╕реНрдХреИрдирд┐рдВрдЧ**, рдЕрд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдлрд▓ рд▓реЙрдЧрд┐рди рдЕрдиреБрд░реЛрдз рдкреИрдЯрд░реНрди, рдпрд╛ рдПрдХ рдЬрд╛рдиреЗ рдорд╛рдиреЗ рдмреБрд░реЗ рдЖрдИрдкреА рд╕реЗ рдЕрдирдмреНрд▓реЙрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдкреЛрд░реНрдЯ рдкреНрд░реЛрдмрд┐рдВрдЧред
* **рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝**: рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдХрд╛ рд╕реВрдЪрдирд╛ рджреЗрдиреЗ рд╡рд╛рд▓реА рдЧрддрд┐рд╡рд┐рдзрд┐, рдЬреИрд╕реЗ **рдХреНрд░рд┐рдкреНрдЯреЛрдХрд░реЗрдВрд╕реА рдорд╛рдЗрдирд┐рдВрдЧ, рдмреИрдХрдбреЛрд░ рдХрдорд╛рдВрдб рдФрд░ рдХрдВрдЯреНрд░реЛрд▓ (C\&C)** рдЧрддрд┐рд╡рд┐рдзрд┐, рдбреЛрдореЗрди рдЬрдирд░реЗрд╢рди рдПрд▓реНрдЧреЛрд░рд┐рджрдо (DGA) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдореИрд▓рд╡реЗрдпрд░, рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдбреЗрдирд╛рдЗрд▓ рдСрдл рд╕рд░реНрд╡рд┐рд╕ рдЧрдд
```bash
# Get Org config
aws guardduty list-organization-admin-accounts #Get Delegated Administrator
aws guardduty describe-organization-configuration --detector-id <id>

# Check external invitations
aws guardduty list-invitations
aws guardduty get-invitations-count

# Detector Information
aws guardduty list-detectors # 1 detector per account with GuardDuty
aws guardduty get-detector --detector-id <id> # Get detector info
aws guardduty get-master-account --detector-id <id>

# Get filters
aws guardduty list-filters --detector-id <id> # Check filters
aws guardduty get-filter --detector-id <id> --filter-name <name>

# Findings
aws guardduty list-findings --detector-id <id> # List findings
aws guardduty get-findings --detector-id <id> --finding-ids <id> # Get details about the finding
aws guardduty get-findings-statistics --detector-id <id> --finding-statistic-types <types>

# Get trusted IP addresses
aws guardduty list-ip-sets --detector-id <id>
aws guardduty get-ip-set --detector-id <id>

# Member accounts of the current AWS GuardDuty master account
aws guardduty list-members --detector-id <id>
aws guardduty get-members --detector-id <id> --account-ids <id>
aws guardduty get-member-detectors --detector-id <id> --account-ids <id>

# Continuously export its findings to an Amazon S3 bucket
aws guardduty list-publishing-destinations --detector-id <id>

# Intelligence sets that you have uploaded to GuardDuty
aws guardduty list-threat-intel-sets --detector-id <id>
aws guardduty get-threat-intel-set --detector-id <id> --threat-intel-set-id <id>
```
## GuardDuty рдмрд╛рдпрдкрд╛рд╕

### рд╕рд╛рдорд╛рдиреНрдп рдорд╛рд░реНрдЧрджрд░реНрд╢рди

рдЬрд┐рддрдирд╛ рд╕рдВрднрд╡ рд╣реЛ, рдЙрди рдкреНрд░рдорд╛рдгрд┐рдХрддрд╛ рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдиреЗрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ:

* рдЙрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рддрдиреА рдмрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ
* рд╕реНрдерд╛рди
* рдЙрдкрдпреЛрдХреНрддрд╛ рдПрдЬреЗрдВрдЯ / рд╕реЗрд╡рд╛рдПрдВ (рдпрд╣ awscli, рд╡реЗрдмрдХрдВрд╕реЛрд▓, рд▓реИрдореНрдмрдбрд╛ рд╕реЗ рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ...)
* рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде, рдкрд╣реБрдВрдЪ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╛рд╡рдирд╛ рд╕реЗ рдЬреНрдпрд╛рджрд╛ рд╕рдВрднрд╛рд╡рдирд╛ рдмрдирд╛рдПрдВ:

* рдпрджрд┐ рдпрд╣ **рдЙрдкрдпреЛрдХреНрддрд╛ рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рддреЛ рдЗрд╕реЗ рдЙрд╕реА рдШрдВрдЯреЛрдВ рдореЗрдВ, рдЙрд╕реА рднреВ-рд╕реНрдерд╛рди рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ (рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рддреЛ рд╡рд╣реА ISP рдФрд░ IP рднреА)
* рдпрджрд┐ рдпрд╣ **рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рднреВрдорд┐рдХрд╛ рд╣реИ**, рддреЛ рдЙрд╕реА рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдПрдХ рд╕рдорд╛рди рд╕реЗрд╡рд╛ рдмрдирд╛рдПрдВ рдФрд░ рдЙрд╕реЗ рдЙрд╕реА рд╕рдордп рд╕реАрдорд╛рдУрдВ рдореЗрдВ рдЙрд╕ рд╕реНрдерд╛рди рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
* рд╣рдореЗрд╢рд╛ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдХрд┐ рдЗрд╕ рдкреНрд░рдореБрдЦ рдиреЗ рдЙрдкрдпреЛрдЧ рдХреА рд╣реИ **рд╡рд╣реА рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
* рдпрджрд┐ рдЖрдкрдХреЛ **рдЕрдиреНрдп рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдпрд╛ рдЕрдиреБрдорддрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛** рд╣реЛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, 1,000,000 рдХреНрд▓рд╛рдЙрдбрдЯреНрд░реЗрд▓ рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓реЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛), рддреЛ рдЗрд╕реЗ **рдзреАрд░реЗ-рдзреАрд░реЗ** рдФрд░ **AWS рдХреЗ рд╕рд╛рде рдиреНрдпреВрдирддрдо рдкреНрд░рднрд╛рд╡** рдХреЗ рд╕рд╛рде рдХрд░реЗрдВ (рдХрднреА-рдХрднреА awscli рд▓рд┐рдЦрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХрдИ рдкрдврд╝рдиреЗ рдХреЗ рдПрдкреАрдЖрдИ рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ)

### GuardDuty рдХреЛ рддреЛрдбрд╝рдирд╛

#### `guardduty:UpdateDetector`

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдЖрдк рдЪреЗрддрд╛рд╡рдирд┐рдпрд╛рдВ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП GuardDuty рдХреЛ рдЕрдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% endcode %}
```bash
aws guardduty update-detector --detector-id <detector-id> --no-enable
aws guardduty update-detector --detector-id <detector-id> --data-sources S3Logs={Enable=false}
```
#### `guardduty:CreateFilter`

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ рдлрд╛рдЗрдВрдбрд┐рдВрдЧреНрд╕ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИ:
```bash
aws guardduty create-filter  --detector-id <detector-id> --name <filter-name> --finding-criteria file:///tmp/criteria.json --action ARCHIVE
```
#### `iam:PutRolePolicy`, (`guardduty:CreateIPSet`|`guardduty:UpdateIPSet`)

рдкрд┐рдЫрд▓реА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рд╣рдорд▓рд╛рд╡рд░ рдЧрд╛рд░реНрдбрдбреНрдпреВрдЯреА рдХреА [**рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдЖрдИрдкреА рд╕реВрдЪреА**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html) рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рдереЗ рдЕрдкрдирд╛ рдЖрдИрдкреА рдкрддрд╛ рдЬреЛрдбрд╝рдХрд░ рдФрд░ рдЪреЗрддрд╛рд╡рдирд┐рдпрд╛рдВ рдЙрддреНрдкрдиреНрди рдХрд┐рдП рдмрд┐рдирд╛ред
```bash
aws guardduty update-ip-set --detector-id <detector-id> --activate --ip-set-id <ip-set-id> --location https://some-bucket.s3-eu-west-1.amazonaws.com/attacker.csv
```
{% endcode %}

#### `guardduty:DeletePublishingDestination`

рд╣рдорд▓рд╛рд╡рд░ рдЪреЗрддрд╛рд╡рдиреА рджреЗрдиреЗ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдЧрдВрддрд╡реНрдп рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ: 

{% code overflow="wrap" %}
```bash
aws guardduty delete-publishing-destination --detector-id <detector-id> --destination-id <dest-id>
```
{% endcode %}

{% hint style="danger" %}
рдЗрд╕ рдкреНрд░рдХрд╛рд╢рди рд╕реНрдерд▓ рдХреЛ рд╣рдЯрд╛рдиреЗ рд╕реЗ **GuardDuty рдХреЛрдиреНрд╕реЛрд▓ рдореЗрдВ рдлрд╛рдЗрдВрдбрд┐рдВрдЧреНрд╕ рдХреА рдЙрддреНрдкрддреНрддрд┐ рдпрд╛ рджреГрд╢реНрдпрддрд╛ рдкрд░ рдХреЛрдИ рдкреНрд░рднрд╛рд╡ рдирд╣реАрдВ рдкрдбрд╝реЗрдЧрд╛**ред GuardDuty рдЖрдкрдХреЗ AWS рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдШрдЯрдирд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЬрд╛рд░реА рд░рдЦреЗрдЧрд╛, рд╕рдВрджрд┐рдЧреНрдз рдпрд╛ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд╡реНрдпрд╡рд╣рд╛рд░ рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдЧрд╛, рдФрд░ рдлрд╛рдЗрдВрдбрд┐рдВрдЧреНрд╕ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ред
{% endhint %}

### рд╡рд┐рд╢реЗрд╖ рдлрд╛рдЗрдВрдбрд┐рдВрдЧреНрд╕ рдмрд╛рдпрдкрд╛рд╕ рдЙрджрд╛рд╣рд░рдг

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ GuardDuty рдлрд╛рдЗрдВрдбрд┐рдВрдЧреНрд╕ рдХрдИ рд╣реЛрддреА рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐, **рд░реЗрдб рдЯреАрдорд░ рдХреЗ рд▓рд┐рдП рд╕рднреА рдХрд╛ рдЕрд╕рд░ рдирд╣реАрдВ рд╣реЛрдЧрд╛**, рдФрд░ рдпрд╣ рднреА рдмреЗрд╣рддрд░ рд╣реИ, рдЖрдкрдХреЗ рдкрд╛рд╕ [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html) рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдХреА **рдкреВрд░реА рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг** рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХрд┐рд╕реА рдХрд╛рд░реНрд░рд╡рд╛рдИ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдирдЬрд░ рдбрд╛рд▓реЗрдВ рддрд╛рдХрд┐ рдкрдХрдбрд╝реЗ рди рдЬрд╛рдПрдВред

рдпрд╣рд╛рдБ рдЖрдкрдХреЛ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ GuardDuty рдлрд╛рдЗрдВрдбрд┐рдВрдЧреНрд╕ рдмрд╛рдпрдкрд╛рд╕ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдорд┐рд▓реЗрдВрдЧреЗ:

#### [PenTest:IAMUser/KaliLinux](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux) <a href="#pentest-iam-kalilinux" id="pentest-iam-kalilinux"></a>

GuardDuty рд╕рд╛рдорд╛рдиреНрдп рдкреЗрдиреЗрдЯреНрд░реЗрд╢рди рдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдЙрдкрдХрд░рдгреЛрдВ рд╕реЗ AWS API рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ [PenTest рдлрд╛рдЗрдВрдбрд┐рдВрдЧ](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux) рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИред\
рдпрд╣ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдЬреЗрдВрдЯ рдирд╛рдо** рджреНрд╡рд╛рд░рд╛ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ API рдЕрдиреБрд░реЛрдз рдореЗрдВ рдкрд╛рд░рд┐рдд рд╣реЛрддрд╛ рд╣реИред\
рдЗрд╕рд▓рд┐рдП, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдЬреЗрдВрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рдХреЗ рд╣рдо рдЧрд╛рд░реНрдбрдбреНрдпреВрдЯреА рдХреЛ рд╣рдорд▓рд╛ рдкрд╣рдЪрд╛рдирдиреЗ рд╕реЗ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк `botocore` рдкреИрдХреЗрдЬ рдореЗрдВ `session.py` рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕реЗ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдЬреЗрдВрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ AWS CLI рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд░реВрдк рдореЗрдВ рдмрд░реНрдк рд╕реНрд╡реАрдЯ рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВ рдФрд░ рдпреВрдЬрд░-рдПрдЬреЗрдВрдЯ рдХреЛ MitM рдХреЗ рд╕рд╛рде рдмрджрд▓реЗрдВ рдпрд╛ рдмрд╕ Ubuntu, Mac рдпрд╛ Windows рдЬреИрд╕реЗ рдУрдПрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдЕрд▓рд░реНрдЯ рдЯреНрд░рд┐рдЧрд░ рди рд╣реЛред

#### UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration

рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╕реЗрд╡рд╛ рд╕реЗ EC2 рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдирд┐рдХрд╛рд▓рдирд╛ рдФрд░ **рдЙрдиреНрд╣реЗрдВ AWS рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рдмрд╛рд╣рд░ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛** [**`UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.OutsideAWS`**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws) рдЕрд▓рд░реНрдЯ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рддрд╛ рд╣реИред рдЙрд▓реНрдЯреЗ, рдЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдЕрдкрдиреЗ EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ [**`UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.InsideAWS`**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws) рдЕрд▓рд░реНрдЯ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИред рдлрд┐рд░ рднреА, **рдЙрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдПрдХ рдФрд░ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝реНрдб EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдЕрдВрджрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЕрдиреБрд╕реНрдерд┐рдд рд╣реИ**, рдХреЛрдИ рдЕрд▓рд░реНрдЯ рдирд╣реАрдВ рдЙрдард╛рддрд╛ред

{% hint style="success" %}
рдЗрд╕рд▓рд┐рдП, **рдЬрд╣рд╛рдВ рдЖрдкрдиреЗ рдЙрдиреНрд╣реЗрдВ рдкрд╛рдпрд╛ рд╣реИ, рдорд╢реАрди рдХреЗ рдЕрдВрджрд░ рд╕реЗ рдирд┐рдХрд╛рд▓реЗ рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ** рддрд╛рдХрд┐ рдпрд╣ рдЕрд▓рд░реНрдЯ рдЯреНрд░рд┐рдЧрд░ рди рд╣реЛред
{% endhint %}

## рд╕рдВрджрд░реНрдн

* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html](https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html)
* [https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html](https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws)
* [https://docs.aws.amazon.com/whitepapers/latest/aws-privatelink/what-are-vpc-endpoints.html](https://docs.aws.amazon.com/whitepapers/latest/aws-privatelink/what-are-vpc-endpoints.html)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб рдЧрд┐рдЯрд╣рдм рд░реЗрдкреЛ рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>
