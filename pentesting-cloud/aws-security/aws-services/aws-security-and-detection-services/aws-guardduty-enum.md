# AWS - GuardDuty Enum

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## GuardDuty

[**рдбреЙрдХреНрд╕**](https://aws.amazon.com/guardduty/features/) рдХреЗ рдЕрдиреБрд╕рд╛рд░: GuardDuty **рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ, рдЕрдиреЛрдорд▓реА рдбрд┐рдЯреЗрдХреНрд╢рди, рдиреЗрдЯрд╡рд░реНрдХ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ, рдФрд░ рдореИрд▓рд┐рд╢рд╕ рдлрд╛рдЗрд▓ рдбрд┐рд╕реНрдХрд╡рд░реА** рдХреЛ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ, AWS рдФрд░ рдЙрджреНрдпреЛрдЧ-рдЕрдЧреНрд░рдгреА рддреГрддреАрдп-рдкрдХреНрд╖ рд╕реНрд░реЛрддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ AWS рдкрд░ рдХрд╛рд░реНрдпрднрд╛рд░ рдФрд░ рдбреЗрдЯрд╛ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред GuardDuty AWS CloudTrail рдЗрд╡реЗрдВрдЯ рд▓реЙрдЧреНрд╕, Amazon Virtual Private Cloud (VPC) Flow Logs, Amazon Elastic Kubernetes Service (EKS) рдСрдбрд┐рдЯ рдФрд░ рд╕рд┐рд╕реНрдЯрдо-рд╕реНрддрд░реАрдп рд▓реЙрдЧреНрд╕, рдФрд░ DNS рдХреНрд╡реЗрд░реА рд▓реЙрдЧреНрд╕ рдЬреИрд╕реЗ рдХрдИ AWS рдбреЗрдЯрд╛ рд╕реНрд░реЛрддреЛрдВ рдХреЗ рджрд╕рд┐рдпреЛрдВ рдЕрд░рдмреЛрдВ рдЗрд╡реЗрдВрдЯреНрд╕ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИред

Amazon GuardDuty рдЖрдкрдХреЗ рдЦрд╛рддреЛрдВ рдХреЗ рднреАрддрд░ **рдЕрд╕рд╛рдорд╛рдиреНрдп рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ**, рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЗ **рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХрддрд╛** рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЙрд╕ **рд╕рдВрджрд░реНрдн** рдХреЛ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдпрд╣ рдЖрд╣реНрд╡рд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдЗрд╕рд╕реЗ рдПрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдХрд░реНрддрд╛ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдЖрдЧреЗ рдХреА рдЬрд╛рдВрдЪ рдкрд░ рд╕рдордп рд╡реНрдпрддреАрдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдпрд╛ рдирд╣реАрдВред

рдЕрд▓рд░реНрдЯ **GuardDuty рдХрдВрд╕реЛрд▓ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВ (90 рджрд┐рди)** рдФрд░ CloudWatch Events рдореЗрдВред

{% hint style="warning" %}
рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **GuardDuty рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИ**, рддреЛ рдпрд╣ рдЖрдкрдХреЗ AWS рд╡рд╛рддрд╛рд╡рд░рдг рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдирд╛ рдмрдВрдж рдХрд░ рджреЗрдЧрд╛ рдФрд░ рдпрд╣ рдХреЛрдИ рдирдИ рдЦреЛрдЬ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, рдФрд░ **рдореМрдЬреВрджрд╛ рдЦреЛрдЬреЗрдВ рдЦреЛ рдЬрд╛рдПрдВрдЧреА**ред\
рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдХреЗрд╡рд▓ рд░реЛрдХрддреЗ рд╣реИрдВ, рддреЛ рдореМрдЬреВрджрд╛ рдЦреЛрдЬреЗрдВ рдмрдиреА рд░рд╣реЗрдВрдЧреАред
{% endhint %}

### рдЦреЛрдЬреЛрдВ рдХрд╛ рдЙрджрд╛рд╣рд░рдг

* **рд░реЗрдХреЛрдиреНрдиреИрд╕реЗрдВрд╕**: рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдЯреЛрд╣ рд▓реЗрдиреЗ рдХреА рдЧрддрд┐рд╡рд┐рдзрд┐ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрдиреЗ рд╡рд╛рд▓реА рдЧрддрд┐рд╡рд┐рдзрд┐, рдЬреИрд╕реЗ рдХрд┐ **рдЕрд╕рд╛рдорд╛рдиреНрдп API рдЧрддрд┐рд╡рд┐рдзрд┐**, рд╕рдВрджрд┐рдЧреНрдз рдбреЗрдЯрд╛рдмреЗрд╕ **рд▓реЙрдЧрд┐рди** рдкреНрд░рдпрд╛рд╕, рдЗрдВрдЯреНрд░рд╛-VPC **рдкреЛрд░реНрдЯ рд╕реНрдХреИрдирд┐рдВрдЧ**, рдЕрд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдлрд▓ рд▓реЙрдЧрд┐рди рдЕрдиреБрд░реЛрдз рдкреИрдЯрд░реНрди, рдпрд╛ рдЬреНрдЮрд╛рдд рдмреБрд░реЗ IP рд╕реЗ рдЕрд╡рд░реБрджреНрдз рдкреЛрд░реНрдЯ рдкреНрд░реЛрдмрд┐рдВрдЧред
* **рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕рдордЭреМрддрд╛**: рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕рдордЭреМрддреЗ рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрдиреЗ рд╡рд╛рд▓реА рдЧрддрд┐рд╡рд┐рдзрд┐, рдЬреИрд╕реЗ рдХрд┐ **рдХреНрд░рд┐рдкреНрдЯреЛрдХрд░реЗрдВрд╕реА рдорд╛рдЗрдирд┐рдВрдЧ, рдмреИрдХрдбреЛрд░ рдХрдорд╛рдВрдб рдФрд░ рдХрдВрдЯреНрд░реЛрд▓ (C\&C)** рдЧрддрд┐рд╡рд┐рдзрд┐, рдореИрд▓рд╡реЗрдпрд░ рдЬреЛ рдбреЛрдореЗрди рдЬрдирд░реЗрд╢рди рдПрд▓реНрдЧреЛрд░рд┐рджрдо (DGA) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдбрд┐рдирд╛рдпрд▓ рдСрдл рд╕рд░реНрд╡рд┐рд╕ рдЧрддрд┐рд╡рд┐рдзрд┐, рдЕрд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ **рдЙрдЪреНрдЪ рдиреЗрдЯрд╡рд░реНрдХ** рдЯреНрд░реИрдлрд┐рдХ рд╡реЙрд▓реНрдпреВрдо, рдЕрд╕рд╛рдорд╛рдиреНрдп рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓, рдЬреНрдЮрд╛рдд рдореИрд▓рд┐рд╢рд╕ IP рдХреЗ рд╕рд╛рде рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕рдВрдЪрд╛рд░, рдмрд╛рд╣рд░реА IP рдкрддреЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ рдЕрд╕реНрдерд╛рдпреА Amazon EC2 рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕, рдФрд░ DNS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрд╢рдиред
* **рдЦрд╛рддрд╛ рд╕рдордЭреМрддрд╛**: рдЦрд╛рддрд╛ рд╕рдордЭреМрддреЗ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рдкреИрдЯрд░реНрди рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЕрд╕рд╛рдорд╛рдиреНрдп рднреВ-рд╕реНрдерд╛рди рдпрд╛ рдЧреБрдордирд╛рдореАрдХрд░рдг рдкреНрд░реЙрдХреНрд╕реА рд╕реЗ API рдХреЙрд▓, AWS CloudTrail рд▓реЙрдЧрд┐рдВрдЧ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рдкреНрд░рдпрд╛рд╕, рдЦрд╛рддрд╛ рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐ рдХреЛ рдХрдордЬреЛрд░ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкрд░рд┐рд╡рд░реНрддрди, рдЕрд╕рд╛рдорд╛рдиреНрдп рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдпрд╛ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рд▓реЙрдиреНрдЪ, рдЕрд╕рд╛рдорд╛рдиреНрдп рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рддреИрдирд╛рддреА, рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЪреЛрд░реА, рд╕рдВрджрд┐рдЧреНрдз рдбреЗрдЯрд╛рдмреЗрд╕ рд▓реЙрдЧрд┐рди рдЧрддрд┐рд╡рд┐рдзрд┐, рдФрд░ рдЬреНрдЮрд╛рдд рдореИрд▓рд┐рд╢рд╕ IP рдкрддреЛрдВ рд╕реЗ API рдХреЙрд▓ред
* **рдмрдХреЗрдЯ рд╕рдордЭреМрддрд╛**: рдмрдХреЗрдЯ рд╕рдордЭреМрддреЗ рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрдиреЗ рд╡рд╛рд▓реА рдЧрддрд┐рд╡рд┐рдзрд┐, рдЬреИрд╕реЗ рдХрд┐ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЗ рджреБрд░реБрдкрдпреЛрдЧ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╕рдВрджрд┐рдЧреНрдз рдбреЗрдЯрд╛ рдПрдХреНрд╕реЗрд╕ рдкреИрдЯрд░реНрди, рджреВрд░рд╕реНрде рд╣реЛрд╕реНрдЯ рд╕реЗ рдЕрд╕рд╛рдорд╛рдиреНрдп Amazon S3 API рдЧрддрд┐рд╡рд┐рдзрд┐, рдЬреНрдЮрд╛рдд рдореИрд▓рд┐рд╢рд╕ IP рдкрддреЛрдВ рд╕реЗ рдЕрдирдзрд┐рдХреГрдд S3 рдПрдХреНрд╕реЗрд╕, рдФрд░ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ S3 рдмрдХреЗрдЯреНрд╕ рдореЗрдВ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП API рдХреЙрд▓ рдЬрд┐рд╕рдХрд╛ рдкрд╣рд▓реЗ рдмрдХреЗрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХрд╛ рдХреЛрдИ рдЗрддрд┐рд╣рд╛рд╕ рдирд╣реАрдВ рд╣реИ рдпрд╛ рдЕрд╕рд╛рдорд╛рдиреНрдп рд╕реНрдерд╛рди рд╕реЗ рдЖрд╣реНрд╡рд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред Amazon GuardDuty рд▓рдЧрд╛рддрд╛рд░ AWS CloudTrail S3 рдбреЗрдЯрд╛ рдЗрд╡реЗрдВрдЯреНрд╕ (рдЬреИрд╕реЗ рдХрд┐ GetObject, ListObjects, DeleteObject) рдХреА рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдкрдХреЗ рд╕рднреА Amazon S3 рдмрдХреЗрдЯреНрд╕ рдореЗрдВ рд╕рдВрджрд┐рдЧреНрдз рдЧрддрд┐рд╡рд┐рдзрд┐ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗред

<details>

<summary>рдЦреЛрдЬ рдЬрд╛рдирдХрд╛рд░реА</summary>

рдЦреЛрдЬ рд╕рд╛рд░рд╛рдВрд╢:

* рдЦреЛрдЬ рдкреНрд░рдХрд╛рд░
* рдЧрдВрднреАрд░рддрд╛: 7-8.9 рдЙрдЪреНрдЪ, 4-6.9 рдордзреНрдпрдо, 01-3.9 рдирд┐рдореНрди
* рдХреНрд╖реЗрддреНрд░
* рдЦрд╛рддрд╛ ID
* рд╕рдВрд╕рд╛рдзрди ID
* рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рд╕рдордп
* рдХрд┐рд╕ рдзрдордХреА рд╕реВрдЪреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛

рд╢рд░реАрд░ рдореЗрдВ рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ:

* рдкреНрд░рднрд╛рд╡рд┐рдд рд╕рдВрд╕рд╛рдзрди
* рдХреНрд░рд┐рдпрд╛
* рдЕрднрд┐рдиреЗрддрд╛: Ip рдкрддрд╛, рдкреЛрд░реНрдЯ рдФрд░ рдбреЛрдореЗрди
* рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА

</details>

### рд╕рднреА рдЦреЛрдЬреЗрдВ

рд╕рднреА GuardDuty рдЦреЛрдЬреЛрдВ рдХреА рд╕реВрдЪреА рддрдХ рдкрд╣реБрдВрдЪреЗрдВ: [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)

### рдорд▓реНрдЯреА рдЕрдХрд╛рдЙрдВрдЯреНрд╕

#### рдЖрдордВрддреНрд░рдг рджреНрд╡рд╛рд░рд╛

рдЖрдк **рдЕрдиреНрдп рдЦрд╛рддреЛрдВ рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдПрдХ рдЕрд▓рдЧ AWS GuardDuty рдЦрд╛рддреЗ рдореЗрдВ рддрд╛рдХрд┐ **рд╣рд░ рдЦрд╛рддреЗ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдПрдХ рд╣реА GuardDuty рд╕реЗ рдХреА рдЬрд╛ рд╕рдХреЗ**ред рдорд╛рд╕реНрдЯрд░ рдЦрд╛рддреЗ рдХреЛ рд╕рджрд╕реНрдп рдЦрд╛рддреЛрдВ рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдлрд┐рд░ рд╕рджрд╕реНрдп рдЦрд╛рддреЗ рдХреЗ рдкреНрд░рддрд┐рдирд┐рдзрд┐ рдХреЛ рдЖрдордВрддреНрд░рдг рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

#### рд╕рдВрдЧрдарди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

рдЖрдк рд╕рдВрдЧрдарди рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рднреА рдЦрд╛рддреЗ рдХреЛ **GuardDuty рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдкреНрд░рд╢рд╛рд╕рдХ** рдирд┐рдпреБрдХреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдХреЗрд╡рд▓ рд╕рдВрдЧрдарди рдкреНрд░рдмрдВрдзрди рдЦрд╛рддрд╛ рд╣реА рдПрдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдкреНрд░рд╢рд╛рд╕рдХ рдирд┐рдпреБрдХреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдПрдХ рдЦрд╛рддрд╛ рдЬрд┐рд╕реЗ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдкреНрд░рд╢рд╛рд╕рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рдпреБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╡рд╣ GuardDuty рдкреНрд░рд╢рд╛рд╕рдХ рдЦрд╛рддрд╛ рдмрди рдЬрд╛рддрд╛ рд╣реИ, рдЙрд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ AWS рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ GuardDuty рд╕рдХреНрд╖рдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЙрд╕реЗ рдЙрд╕ рдХреНрд╖реЗрддреНрд░ рдХреЗ рднреАрддрд░ рд╕рдВрдЧрдарди рдХреЗ рд╕рднреА рдЦрд╛рддреЛрдВ рдХреЗ рд▓рд┐рдП GuardDuty рдХреЛ рд╕рдХреНрд╖рдо
```bash
# Get Org config
aws guardduty list-organization-admin-accounts #Get Delegated Administrator
aws guardduty describe-organization-configuration --detector-id <id>

# Check external invitations
aws guardduty list-invitations
aws guardduty get-invitations-count

# Detector Information
aws guardduty list-detectors # 1 detector per account with GuardDuty
aws guardduty get-detector --detector-id <id> # Get detector info
aws guardduty get-master-account --detector-id <id>

# Get filters
aws guardduty list-filters --detector-id <id> # Check filters
aws guardduty get-filter --detector-id <id> --filter-name <name>

# Findings
aws guardduty list-findings --detector-id <id> # List findings
aws guardduty get-findings --detector-id <id> --finding-ids <id> # Get details about the finding
aws guardduty get-findings-statistics --detector-id <id> --finding-statistic-types <types>

# Get trusted IP addresses
aws guardduty list-ip-sets --detector-id <id>
aws guardduty get-ip-set --detector-id <id>

# Member accounts of the current AWS GuardDuty master account
aws guardduty list-members --detector-id <id>
aws guardduty get-members --detector-id <id> --account-ids <id>
aws guardduty get-member-detectors --detector-id <id> --account-ids <id>

# Continuously export its findings to an Amazon S3 bucket
aws guardduty list-publishing-destinations --detector-id <id>

# Intelligence sets that you have uploaded to GuardDuty
aws guardduty list-threat-intel-sets --detector-id <id>
aws guardduty get-threat-intel-set --detector-id <id> --threat-intel-set-id <id>
```
{% endcode %}

## GuardDuty рдмрд╛рдпрдкрд╛рд╕

### рд╕рд╛рдорд╛рдиреНрдп рдорд╛рд░реНрдЧрджрд░реНрд╢рди

рдЬрд┐рддрдирд╛ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХреЗ рдЙрддрдирд╛ рдЬрд╛рдирдХрд╛рд░реА рдЗрдХрдЯреНрдард╛ рдХрд░реЗрдВ рдХрд┐ рдЖрдк рдЬрд┐рд╕ credentials рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╣реИрдВ, рдЙрд╕рдХрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреИрд╕рд╛ рд╣реИ:

* рдЙрдкрдпреЛрдЧ рдХреЗ рд╕рдордп
* рд╕реНрдерд╛рди
* User Agents / Services (рдпрд╣ awscli, webconsole, lambda... рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)
* рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде, рдЬрд┐рддрдирд╛ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХреЗ рдЙрд╕реА рдкрд░рд┐рджреГрд╢реНрдп рдХреЛ рдкреБрдирдГ рдмрдирд╛рдПрдВ рддрд╛рдХрд┐ рдЖрдк рдкрд╣реБрдБрдЪ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдВ:

* рдЕрдЧрд░ рдпрд╣ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдПрдХ рднреВрдорд┐рдХрд╛ рд╣реИ**, рддреЛ рдЙрд╕реА рд╕рдордп, рдЙрд╕реА рднреВ-рд╕реНрдерд╛рди рд╕реЗ (рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рддреЛ рдЙрд╕реА ISP рдФрд░ IP рд╕реЗ рднреА) рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ
* рдЕрдЧрд░ рдпрд╣ **рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ рдПрдХ рднреВрдорд┐рдХрд╛ рд╣реИ**, рддреЛ рдЙрд╕реА рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЙрд╕реА рд╕реЗрд╡рд╛ рдХреЛ рдмрдирд╛рдПрдВ рдФрд░ рд╡рд╣рд╛рдБ рд╕реЗ рдЙрд╕реА рд╕рдордп рд╕реАрдорд╛ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
* рд╣рдореЗрд╢рд╛ рдЙрд╕реА **рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдЬрд┐рд╕рдХрд╛ рдЗрд╕ principal рдиреЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИ
* рдЕрдЧрд░ рдЖрдкрдХреЛ **рдЕрдиреНрдп рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдпрд╛ рдХрд┐рд╕реА рдЕрдиреБрдорддрд┐ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, 1.000.000 cloudtrail рд▓реЙрдЧ рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛) рддреЛ рдЗрд╕реЗ **рдзреАрд░реЗ-рдзреАрд░реЗ** рдФрд░ AWS рдХреЗ рд╕рд╛рде **рдиреНрдпреВрдирддрдо рдорд╛рддреНрд░рд╛ рдореЗрдВ рдЗрдВрдЯрд░реИрдХреНрд╢рди** рдХреЗ рд╕рд╛рде рдХрд░реЗрдВ (awscli рдХрднреА-рдХрднреА рд▓рд┐рдЦрдиреЗ рд╡рд╛рд▓реЗ API рд╕реЗ рдкрд╣рд▓реЗ рдХрдИ рдкрдврд╝рдиреЗ рд╡рд╛рд▓реЗ APIs рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ)

### GuardDuty рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ

#### `guardduty:ListDetectors`, `guardduty:UpdateDetector`

рдЗрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдЖрдк GuardDuty рдХреЛ рдЕрдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЕрд▓рд░реНрдЯ рдЯреНрд░рд┐рдЧрд░ рди рд╣реЛрдВред
```bash
# Disabling the detector
aws guardduty update-detector \
--detector-id <detector-id> \
--no-enable

# Removing s3 as a log source
aws guardduty update-detector \
--detector-id <detector-id> \
--data-sources S3Logs={Enable=false}

# Increase finding update time to 6 hours
aws guardduty update-detector \
--detector-id <detector-id> \
--finding-publishing-frequency SIX_HOURS
```
#### `guardduty:ListDetectors`, `guardduty:ListIPSet`, `iam:PutRolePolicy`, (`guardduty:CreateIPSet`|`guardduty:UpdateIPSet`)

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ GuardDuty рдХреА [рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп IP рд╕реВрдЪреА](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_upload-lists.html) рдХреЛ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **рдЙрдирдХрд╛ рдЕрдкрдирд╛ IP рд╕реВрдЪреА рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп IP рд╕реВрдЪреА рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рд╕реА рднреА IP рдХреЗ рдЦрд┐рд▓рд╛рдл **рдХреЛрдИ Cloudtrail рдпрд╛ VPC рдлреНрд▓реЛ рд▓реЙрдЧ рдЕрд▓рд░реНрдЯ рдЙрддреНрдкрдиреНрди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред

{% hint style="info" %}
DNS рдирд┐рд╖реНрдХрд░реНрд╖ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп IP рд╕реВрдЪреА рд╕реЗ рдореБрдХреНрдд рд╣реИрдВред
{% endhint %}
```bash
aws guardduty update-ip-set \
--detector-id <detector-id> \
--ip-set-id 24adjigdk34290840348exampleiplist \
--location https://malicious-bucket.s3-us-east-1.amazonaws.com/customiplist.csv \
--activate
```
{% hint style="info" %}
рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЧреЛрдкрдиреАрдпрддрд╛ рдХреЗ рд╕реНрддрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, **рдлрд╛рдЗрд▓ рдХреЛ рд▓рдХреНрд╖рд┐рдд рдЦрд╛рддреЗ рдореЗрдВ рдПрдХ s3 рдмрдХреЗрдЯ рдореЗрдВ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдПрдХ рдЦрд╛рддреЗ рдореЗрдВред**
{% endhint %}

#### `guardduty:CreateFilter`

рдирд╡ рдирд┐рд░реНрдорд┐рдд GuardDuty рдирд┐рд╖реНрдХрд░реНрд╖реЛрдВ рдХреЛ [Suppression Rules](https://docs.aws.amazon.com/guardduty/latest/ug/findings_suppression-rule.html) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдПрдХ рдЖрдХреНрд░рдордгрдХрд╛рд░реА [**рдлрд┐рд▓реНрдЯрд░реНрд╕**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_filter-findings.html) рдХрд╛ **рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрди рдирд┐рд╖реНрдХрд░реНрд╖реЛрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рдЬреЛ рд╡реЗ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВрдЧреЗред

рдлрд┐рд▓реНрдЯрд░реНрд╕ рдХреЛ [CreateFilter API](https://docs.aws.amazon.com/guardduty/latest/APIReference/API_CreateFilter.html) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```bash
aws guardduty create-filter \
--action ARCHIVE \
--detector-id <detector-id> \
--name yourfiltername \
--finding-criteria file://criteria.json
```
#### `guardduty:DeletePublishingDestination`

рдПрдХ рдЖрдХреНрд░рдордгрдХрд╛рд░реА рдЕрд▓рд░реНрдЯреНрд╕ рдХреЗ [рдЧрдВрддрд╡реНрдп рдХреЛ рд╣рдЯрд╛рдХрд░](https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html) рдЖрд╕рд╛рдиреА рд╕реЗ рдЕрд▓рд░реНрдЯрд┐рдВрдЧ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░ рд╕рдХрддрд╛ рд╣реИред
```bash
aws guardduty delete-publishing-destination \
--detector-id <detector-id> \
--destination-id def456
```
{% hint style="danger" %}
рдЗрд╕ рдкреНрд░рдХрд╛рд╢рди рд╕реНрдерд▓ рдХреЛ рд╣рдЯрд╛рдиреЗ рд╕реЗ **GuardDuty рдХрдВрд╕реЛрд▓ рдХреЗ рднреАрддрд░ рдирд┐рд╖реНрдХрд░реНрд╖реЛрдВ рдХреЗ рдЙрддреНрдкрд╛рджрди рдпрд╛ рджреГрд╢реНрдпрддрд╛ рдкрд░ рдХреЛрдИ рдкреНрд░рднрд╛рд╡ рдирд╣реАрдВ рдкрдбрд╝реЗрдЧрд╛**ред GuardDuty рдЖрдкрдХреЗ AWS рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдШрдЯрдирд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЬрд╛рд░реА рд░рдЦреЗрдЧрд╛, рд╕рдВрджрд┐рдЧреНрдз рдпрд╛ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд╡реНрдпрд╡рд╣рд╛рд░ рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдЧрд╛, рдФрд░ рдирд┐рд╖реНрдХрд░реНрд╖ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ред
{% endhint %}

### рд╡рд┐рд╢рд┐рд╖реНрдЯ рдирд┐рд╖реНрдХрд░реНрд╖реЛрдВ рдХреА рдмрд╛рдИрдкрд╛рд╕

#### Pentest рдирд┐рд╖реНрдХрд░реНрд╖

OS's GuardDuty рд╕рд╛рдорд╛рдиреНрдп рдкреЗрдирдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдЙрдкрдХрд░рдгреЛрдВ рд╕реЗ AWS API рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ рдФрд░ [PenTest Finding](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux) рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИред\
рдпрд╣ **user agent name** рджреНрд╡рд╛рд░рд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ API рдЕрдиреБрд░реЛрдз рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред\
рдЗрд╕рд▓рд┐рдП, **user agent рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ** GuardDuty рдХреЛ рд╣рдорд▓реЗ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рд╕реЗ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

Ubuntu, Mac рдпрд╛ Windows рдЬреИрд╕реЗ OS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдЗрд╕ рдЕрд▓рд░реНрдЯ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдиреЗ рд╕реЗ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк `botocore` рдкреИрдХреЗрдЬ рдореЗрдВ `session.py` рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред Kali Linux рдореЗрдВ рдпрд╣ `/usr/local/lib/python3.7/dist-packages/botocore/session.py` рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред

рд▓рд╛рдЗрди [456](https://github.com/boto/botocore/blob/7de36c07ecec503f588ac27658b1795e83b67b75/botocore/session.py#L456) рдХреЗ рдЖрд╕рдкрд╛рд╕ рдЖрдкрдХреЛ `platform.system()` рдФрд░ `platform.release()` рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред рдЗрд╕ **рдХреЛрдб рдХреЛ рд╡реИрдз user agent strings рдХреЗ рд╕рд╛рде рдмрджрд▓реЗрдВ рдЬреИрд╕реЗ рдХрд┐** [**Pacu**](https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/user\_agents.txt) рдореЗрдВ рдкрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВред

#### Tor Client рдирд┐рд╖реНрдХрд░реНрд╖

{% hint style="success" %}
рдЗрд╕реЗ рдмрд╛рдИрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдмрд╕ **AWS рд╕реЗ рдЬреБрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП Tor рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдирд╛ рд╣реИ** (рдЖрдк Tor рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреНрдпреЛрдВ рдХрд░реЗрдВрдЧреЗ рдЕрдЧрд░ рдЖрдк рдЪреБрдкрдХреЗ рд╕реЗ рд░рд╣рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдкрд░рд┐рджреГрд╢реНрдп рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?)
{% endhint %}

рдпрджрд┐ рдЖрдк **Tor** рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ **Guarduty** рдЕрд▓рд░реНрдЯ [**UnauthorizedAccess:EC2/TorClient**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient)** рд╕реЗрдЯ рдХрд░реЗрдЧрд╛ред**

Guarduty рдЗрд╕реЗ [Tor nodes рдХреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд╕реВрдЪреА](https://metrics.torproject.org/exonerator.html) рдХреА рдорджрдж рд╕реЗ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИред

рдпрджрд┐ рдЖрдкрдХреЛ Tor рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддреЛ рдЖрдк [**Bridges**](https://community.torproject.org/relay/types-of-relays/#Bridge) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рдмрд╛рдИрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд▓реЗрдХрд┐рди рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдпрд╣ рдмреЗрд╣рддрд░ рд╣реЛрдЧрд╛ рдЕрдЧрд░ рдЖрдк рдмрд┐рд▓реНрдХреБрд▓ рднреА AWS рд╕реЗ рдЬреБрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП Tor рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗред

Bridge рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк [Obfs4](https://gitlab.com/yawning/obfs4) (`apt install tor obfs4proxy`) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ [bridges.torproject.org](https://bridges.torproject.org/options) рд╕реЗ bridge address рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣рд╛рдБ рд╕реЗ, `torrc` рдлрд╛рдЗрд▓ рдмрдирд╛рдПрдВ рдЬрд┐рд╕рдореЗрдВ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдХрд╛ рд╣реЛ:
```
UseBridges 1
Bridge obfs4 <IP ADDRESS>:<PORT> <FINGERPRINT> cert=<cert_string> iat-mode=0
ClientTransportPlugin obfs4 exec /bin/obfs4proxy
```
```
`tor -f torrc` рдЪрд▓рд╛рдПрдВ рдФрд░ рдЖрдк 9050 рдкреЛрд░реНрдЯ рдкрд░ рдирд┐рдпрдорд┐рдд socks5 рдкреНрд░реЙрдХреНрд╕реА рд╕реЗ рдЬреБрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред

#### рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрд╢рди рдбрд┐рдЯреЗрдХреНрд╢рди

рдпрджрд┐ рдЖрдк **EC2 рдХреНрд░реЗрдбреНрд╕** рдХреЛ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╕рд░реНрд╡рд┐рд╕ рд╕реЗ **рдЪреБрд░рд╛рддреЗ рд╣реИрдВ** рдФрд░ рдЙрдиреНрд╣реЗрдВ **AWS рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХреЗ рдмрд╛рд╣рд░** рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЕрд▓рд░реНрдЯ [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.OutsideAWS](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws) рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрдк **рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддреЛ **рдЪреБрд░рд╛рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рдЕрд▓рд░реНрдЯ [UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.InsideAWS](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws) рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИред

{% hint style="warning" %}
рдпрджрд┐ рдЖрдкрдиреЗ **рд╕рдорд╛рди рдЕрдХрд╛рдЙрдВрдЯ** рдХреА рдПрдХ рдФрд░ **EC2** рдорд╢реАрди рдХреЛ **рдХрдореНрдкреНрд░реЛрдорд╛рдЗрдЬрд╝** рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЖрдк рд╡рд╣рд╛рдВ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдХреЛрдИ рдЕрд▓рд░реНрдЯ** рдЬрдирд░реЗрдЯ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред
{% endhint %}

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╛рд░реНрдпрд╢реАрд▓ рдмрд╛рдИрдкрд╛рд╕ рдореМрдЬреВрдж рд╣реИ - [VPC Endpoints](https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints.html)ред **VPC Endpoints** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ **GuardDuty рдЕрд▓рд░реНрдЯ рдЯреНрд░рд┐рдЧрд░ рдирд╣реАрдВ рд╣реЛрдЧрд╛**ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ, `рдпрджрд┐ рдЖрдк EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕реЗ IAM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЪреБрд░рд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕реЗ VPC Endpoints рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЯреНрд░реИрдлрд┐рдХ рд░реВрдЯрд┐рдВрдЧ рдХрд░рддреЗ рд╣реБрдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд╕реЗ GuardDuty рдлрд╛рдЗрдВрдбрд┐рдВрдЧ рдЯреНрд░рд┐рдЧрд░ рдирд╣реАрдВ рд╣реЛрдЧреАред`

рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**SneakyEndpoints**](https://github.com/Frichetten/SneakyEndpoints) рдЯреВрд▓ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдпрд╣ рдкреНрд░реЛрдЬреЗрдХреНрдЯ **Terraform рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗрдЯрдЕрдк рдХрд░рддрд╛ рд╣реИ**ред рдпрд╣ рдЗрдВрдЯрд░рдиреЗрдЯ рдПрдХреНрд╕реЗрд╕ рдХреЗ рдмрд┐рдирд╛ рдПрдХ рдирд┐рдЬреА рд╕рдмрдиреЗрдЯ рдореЗрдВ рдПрдХ EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдмрдирд╛рдПрдЧрд╛ рдФрд░ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдХрдИ VPC Endpoints рдмрдирд╛рдПрдЧрд╛ред

**рдЗрд╕ рдЕрд▓рд░реНрдЯ рдХреЛ рдмрд╛рдИрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛** рдпрд╣ рд╣реИ рдХрд┐ рдЪреБрд░рд╛рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдЙрд╕реА рдорд╢реАрди рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░реЗрдВ рдЬрд╣рд╛рдВ рд╕реЗ рд╡реЗ рдЪреБрд░рд╛рдП рдЧрдП рдереЗ **рдпрд╛ рдЙрд╕реА рдЕрдХрд╛рдЙрдВрдЯ рдХреА рдХрд┐рд╕реА рдЕрдиреНрдп рдорд╢реАрди рдореЗрдВред**

## рд╕рдВрджрд░реНрдн

* [https://hackingthe.cloud/aws/avoiding-detection/guardduty-pentest/](https://hackingthe.cloud/aws/avoiding-detection/guardduty-pentest/)
* [https://hackingthe.cloud/aws/avoiding-detection/guardduty-tor-client/](https://hackingthe.cloud/aws/avoiding-detection/guardduty-tor-client/)
* [https://hackingthe.cloud/aws/avoiding-detection/modify-guardduty-config/](https://hackingthe.cloud/aws/avoiding-detection/modify-guardduty-config/)
* [https://hackingthe.cloud/aws/avoiding-detection/steal-keys-undetected/](https://hackingthe.cloud/aws/avoiding-detection/steal-keys-undetected/)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
```
