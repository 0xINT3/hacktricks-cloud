# AWS - Enumera√ß√£o do GuardDuty

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

## GuardDuty

O Amazon GuardDuty √© um servi√ßo de detec√ß√£o de amea√ßas inteligente baseado em regi√£o, o primeiro do tipo oferecido pela AWS, que permite aos usu√°rios **monitorar** sua **conta AWS** em busca de **comportamentos incomuns e inesperados, analisando logs de fluxo VPC, logs de eventos de gerenciamento do AWS CloudTrail, logs de eventos de dados do CloudTrail S3 e logs DNS**. Ele usa **feeds de intelig√™ncia de amea√ßas**, como listas de **endere√ßos IP e dom√≠nios maliciosos**, e **aprendizado de m√°quina** para identificar **atividades inesperadas e potencialmente n√£o autorizadas e maliciosas** dentro do seu ambiente AWS. Isso pode incluir problemas como escalonamentos de privil√©gios, uso de credenciais expostas ou comunica√ß√£o com endere√ßos IP ou dom√≠nios maliciosos.

Alertas **aparecem no console do GuardDuty (90 dias)** e em eventos do CloudWatch.

Por exemplo, o GuardDuty pode detectar inst√¢ncias **EC2 comprometidas que servem malware ou minerando** bitcoin. Ele tamb√©m monitora o **comportamento de acesso √† conta AWS em busca de sinais de comprometimento**, como implanta√ß√µes de infraestrutura n√£o autorizadas, como inst√¢ncias implantadas em uma **regi√£o que nunca foi usada**, ou **chamadas de API incomuns**, como uma altera√ß√£o de pol√≠tica de senha para reduzir a for√ßa da senha.\
Voc√™ pode **carregar listas de endere√ßos IP permitidos e bloqueados** para que o GuardDuty leve essas informa√ß√µes em considera√ß√£o.

Resumo das descobertas:

* Tipo de descoberta
* Gravidade: 7-8.9Alta, 4-6.9M√©dia, 01-3.9Baixa
* Regi√£o
* ID da conta
* ID do recurso
* Hora da detec√ß√£o
* Qual lista de amea√ßas foi usada

O corpo tem essas informa√ß√µes:

* Recurso afetado
* A√ß√£o
* Ator: endere√ßo IP, porta e dom√≠nio
* Informa√ß√µes adicionais

Voc√™ pode **convidar outras contas** para uma conta AWS GuardDuty diferente para que **todas as contas sejam monitoradas pelo mesmo GuardDuty**. A conta principal deve convidar as contas de membros e, em seguida, o representante da conta de membro deve aceitar o convite.\
Existem diferentes permiss√µes de fun√ß√£o IAM para permitir que o GuardDuty obtenha as informa√ß√µes e permita que um usu√°rio **carregue IPs permitidos e bloqueados**.\
O GuarDuty usa uma fun√ß√£o vinculada ao servi√ßo chamada "AWSServiceRoleForAmazonGuardDuty" que permite recuperar metadados de pontos finais afetados.

Voc√™ paga pelo processamento de seus arquivos de log, por 1 milh√£o de eventos por m√™s do CloudTrail e por GB de logs analisados do VPC Flow.

Quando um usu√°rio **desativa o GuardDuty**, ele deixar√° de monitorar seu ambiente AWS e n√£o gerar√° novas descobertas, e as **descobertas existentes ser√£o perdidas**.\
Se voc√™ apenas parar, as descobertas existentes permanecer√£o.

## A√ß√µes

### Enumera√ß√£o

```bash
aws guardduty list-organization-admin-accounts
aws guardduty list-invitations
aws guardduty get-invitations-count
aws guardduty list-detectors
aws guardduty describe-organization-configuration --detector-id <id>
aws guardduty get-detector --detector-id <id>
aws guardduty list
## Refer√™ncias

* [https://hackingthe.cloud/aws/avoiding-detection/guardduty-pentest/](https://hackingthe.cloud/aws/avoiding-detection/guardduty-pentest/)
* [https://hackingthe.cloud/aws/avoiding-detection/guardduty-tor-client/](https://hackingthe.cloud/aws/avoiding-detection/guardduty-tor-client/)
* [https://hackingthe.cloud/aws/avoiding-detection/modify-guardduty-config/](https://hackingthe.cloud/aws/avoiding-detection/modify-guardduty-config/)
* [https://hackingthe.cloud/aws/avoiding-detection/steal-keys-undetected/](https://hackingthe.cloud/aws/avoiding-detection/steal-keys-undetected/)

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>