# AWS - Macie Enum

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

# Macie

O Amazon Macie se destaca como um servi√ßo projetado para **detectar, classificar e identificar dados automaticamente** dentro de uma conta AWS. Ele utiliza **machine learning** para monitorar e analisar dados continuamente, com foco principal em detectar e alertar sobre atividades incomuns ou suspeitas, examinando dados de **eventos do cloud trail** e padr√µes de comportamento do usu√°rio.

Principais caracter√≠sticas do Amazon Macie:

1. **Revis√£o Ativa de Dados**: Emprega machine learning para revisar ativamente os dados √† medida que v√°rias a√ß√µes ocorrem dentro da conta AWS.
2. **Detec√ß√£o de Anomalias**: Identifica atividades ou padr√µes de acesso irregulares, gerando alertas para mitigar potenciais riscos de exposi√ß√£o de dados.
3. **Monitoramento Cont√≠nuo**: Monitora automaticamente e detecta novos dados no Amazon S3, utilizando machine learning e intelig√™ncia artificial para se adaptar aos padr√µes de acesso de dados ao longo do tempo.
4. **Classifica√ß√£o de Dados com NLP**: Utiliza processamento de linguagem natural (NLP) para classificar e interpretar diferentes tipos de dados, atribuindo pontua√ß√µes de risco para priorizar descobertas.
5. **Monitoramento de Seguran√ßa**: Identifica dados sens√≠veis √† seguran√ßa, incluindo chaves de API, chaves secretas e informa√ß√µes pessoais, ajudando a prevenir vazamentos de dados.

O Amazon Macie √© um **servi√ßo regional** e requer a fun√ß√£o IAM 'AWSMacieServiceCustomerSetupRole' e um AWS CloudTrail ativado para funcionar.

## Sistema de Alerta

O Macie categoriza alertas em categorias predefinidas como:

- Acesso anonimizado
- Conformidade de dados
- Perda de credenciais
- Escalada de privil√©gios
- Ransomware
- Acesso suspeito, etc.

Esses alertas fornecem descri√ß√µes detalhadas e decomposi√ß√µes de resultados para uma resposta e resolu√ß√£o eficazes.

## Recursos do Painel

O painel categoriza dados em v√°rias se√ß√µes, incluindo:

- Objetos S3 (por intervalo de tempo, ACL, PII)
- Eventos/usu√°rios do CloudTrail de alto risco
- Locais de Atividade
- Tipos de identidade de usu√°rio do CloudTrail, e mais.

## Categoriza√ß√£o de Usu√°rios

Os usu√°rios s√£o classificados em n√≠veis com base no n√≠vel de risco de suas chamadas de API:

- **Platinum**: Chamadas de API de alto risco, frequentemente com privil√©gios de admin.
- **Gold**: Chamadas de API relacionadas √† infraestrutura.
- **Silver**: Chamadas de API de risco m√©dio.
- **Bronze**: Chamadas de API de baixo risco.

## Tipos de Identidade

Os tipos de identidade incluem Root, usu√°rio IAM, Fun√ß√£o Assumida, Usu√°rio Federado, Conta AWS e Servi√ßo AWS, indicando a fonte das solicita√ß√µes.

## Classifica√ß√£o de Dados

A classifica√ß√£o de dados abrange:

- Tipo de Conte√∫do: Baseado no tipo de conte√∫do detectado.
- Extens√£o de Arquivo: Baseado na extens√£o do arquivo.
- Tema: Categorizado por palavras-chave dentro dos arquivos.
- Regex: Categorizado com base em padr√µes regex espec√≠ficos.

O risco mais alto entre essas categorias determina o n√≠vel de risco final do arquivo.

## Pesquisa e An√°lise

A fun√ß√£o de pesquisa do Amazon Macie permite consultas personalizadas em todos os dados do Macie para an√°lises aprofundadas. Os filtros incluem Dados do CloudTrail, propriedades do Bucket S3 e Objetos S3. Al√©m disso, suporta o convite de outras contas para compartilhar o Amazon Macie, facilitando a gest√£o colaborativa de dados e o monitoramento de seguran√ßa.


## Enumera√ß√£o
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### P√≥s-Explora√ß√£o

{% hint style="success" %}
Do ponto de vista de um atacante, este servi√ßo n√£o √© feito para detectar o atacante, mas para detectar informa√ß√µes sens√≠veis nos arquivos armazenados. Portanto, este servi√ßo pode **ajudar um atacante a encontrar informa√ß√µes sens√≠veis** dentro dos buckets.\
No entanto, talvez um atacante tamb√©m possa estar interessado em interromper o servi√ßo para evitar que a v√≠tima receba alertas e roubar essas informa√ß√µes mais facilmente.
{% endhint %}

TODO: PRs s√£o bem-vindos!

# Refer√™ncias
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
