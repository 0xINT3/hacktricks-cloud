# AWS - Enumeraci√≥n de Macie

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Macie

La funci√≥n principal del servicio es proporcionar un m√©todo autom√°tico de **detecci√≥n, identificaci√≥n y clasificaci√≥n de datos** que est√°s almacenando dentro de tu cuenta de AWS.

El servicio est√° respaldado por **machine learning**, permitiendo que tus datos sean revisados activamente a medida que se realizan diferentes acciones dentro de tu cuenta de AWS. El machine learning puede detectar patrones de acceso y **comportamiento de usuarios** analizando datos de eventos de **cloud trail** para **alertar sobre cualquier actividad inusual o irregular**. Cualquier hallazgo realizado por Amazon Macie se presenta dentro de un tablero que puede activar alertas, permiti√©ndote resolver r√°pidamente cualquier amenaza potencial de exposici√≥n o compromiso de tus datos.

Amazon Macie monitorear√° autom√°ticamente y de forma continua **nuevos datos almacenados en Amazon S3**. Utilizando las capacidades de machine learning e inteligencia artificial, este servicio tiene la habilidad de familiarizarse con el tiempo con patrones de acceso a datos.\
Amazon Macie tambi√©n utiliza m√©todos de procesamiento de lenguaje natural para **clasificar e interpretar diferentes tipos de datos y contenido**. El procesamiento de lenguaje natural utiliza principios de ciencias de la computaci√≥n y ling√º√≠stica computacional para examinar las interacciones entre computadoras y el lenguaje humano. En particular, c√≥mo programar computadoras para entender y descifrar datos de lenguaje. El **servicio puede asignar autom√°ticamente valores comerciales a los datos evaluados en forma de una puntuaci√≥n de riesgo**. Esto permite a Amazon Macie ordenar los hallazgos en base a prioridades, permiti√©ndote enfocarte primero en las alertas m√°s cr√≠ticas. Adem√°s de esto, Amazon Macie tambi√©n tiene el beneficio adicional de poder **monitorear y descubrir cambios de seguridad que gobiernan tus datos**. As√≠ como identificar datos espec√≠ficos centrados en la seguridad como claves de acceso almacenadas dentro de un bucket de S3.

Este monitoreo de seguridad protector y proactivo permite a Amazon Macie **identificar datos cr√≠ticos, sensibles y enfocados en la seguridad como claves de API, claves secretas, adem√°s de datos de PII (informaci√≥n personal identificable) y PHI**.

Esto es √∫til para evitar fugas de datos ya que Macie detectar√° si est√°s exponiendo informaci√≥n de personas a Internet.

Es un **servicio regional**.

Requiere la existencia del rol de IAM 'AWSMacieServiceCustomerSetupRole' y necesita que AWS CloudTrail est√© habilitado.

Categor√≠as de alertas predefinidas:

* Acceso anonimizado
* Cumplimiento de configuraci√≥n
* P√©rdida de credenciales
* Cumplimiento de datos
* Alojamiento de archivos
* Enumeraci√≥n de identidad
* P√©rdida de informaci√≥n
* Anomal√≠a de ubicaci√≥n
* Permisos abiertos
* Escalada de privilegios
* Ransomware
* Interrupci√≥n del servicio
* Acceso sospechoso

El **resumen de alertas** proporciona informaci√≥n detallada para permitirte responder adecuadamente. Tiene una descripci√≥n que proporciona un nivel m√°s profundo de comprensi√≥n de por qu√© se gener√≥. Tambi√©n tiene un desglose de los resultados.

El usuario tiene la posibilidad de crear nuevas alertas personalizadas.

**Categorizaci√≥n del tablero**:

* Objetos S3 para el rango de tiempo seleccionado
* Objetos S3
* Objetos S3 por PII - Informaci√≥n Personal Identificable
* Objetos S3 por ACL
* Eventos de CloudTrail de alto riesgo y usuarios asociados
* Errores de CloudTrail de alto riesgo y usuarios asociados
* Ubicaci√≥n de la actividad
* Eventos de CloudTrail
* ISPs de la actividad
* Tipos de identidad de usuario de CloudTrail

**Categor√≠as de usuarios**: Macie categoriza a los usuarios en las siguientes categor√≠as:

* **Platinum**: Usuarios o roles considerados como realizadores de llamadas API de alto riesgo. A menudo tienen privilegios de administradores. Deber√≠as monitorearlos muy bien en caso de que est√©n comprometidos.
* **Gold**: Usuarios o roles con historial de llamadas a APIs relacionadas con cambios de infraestructura. Tambi√©n deber√≠as monitorearlos.
* **Silver**: Usuarios o roles que realizan llamadas API de riesgo medio.
* **Bronze**: Usuarios o roles que utilizan el nivel m√°s bajo de riesgo basado en llamadas API.

**Tipos de identidad**:

* Root: Solicitud realizada por el usuario root.
* Usuario IAM: Solicitud realizada por un usuario IAM.
* Rol asumido: Solicitud realizada con credenciales temporales asumidas (API AssumeRole para STS).
* Usuario federado: Solicitud realizada con credenciales temporales (API GetFederationToken para STS).
* Cuenta AWS: Solicitud realizada por una cuenta AWS diferente.
* Servicio AWS: Solicitud realizada por un servicio AWS.

**Clasificaci√≥n de datos**: Existen 4 clasificaciones de archivos:

* Content-Type: lista archivos basados en el tipo de contenido detectado. El riesgo dado se determina por el tipo de contenido detectado.
* Extensi√≥n de archivo: Igual que el tipo de contenido pero basado en la extensi√≥n.
* Tema: Categoriza basado en una serie de palabras clave detectadas dentro de los archivos.
* Regex: Categor√≠as basadas en expresiones regulares espec√≠ficas.

El riesgo final de un archivo ser√° el riesgo m√°s alto encontrado entre esas 4 categor√≠as.

La funci√≥n de investigaci√≥n permite crear tus propias consultas contra todos los datos de Amazon Macie y realizar un an√°lisis profundo de los datos. Puedes filtrar resultados basados en: Datos de CloudTrail, propiedades de Bucket S3 y Objetos S3.

Es posible invitar a otras cuentas a Amazon Macie para que varias cuentas compartan Amazon Macie.

### Enumeraci√≥n
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Explotaci√≥n

{% hint style="success" %}
Desde la perspectiva de un atacante, este servicio no est√° hecho para detectar al atacante, sino para detectar informaci√≥n sensible en los archivos almacenados. Por lo tanto, este servicio podr√≠a **ayudar a un atacante a encontrar informaci√≥n sensible** dentro de los buckets.\
Sin embargo, tal vez un atacante tambi√©n podr√≠a estar interesado en interrumpirlo para evitar que la v√≠ctima reciba alertas y robar esa informaci√≥n m√°s f√°cilmente.
{% endhint %}

TODO: ¬°Se aceptan PRs!

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
