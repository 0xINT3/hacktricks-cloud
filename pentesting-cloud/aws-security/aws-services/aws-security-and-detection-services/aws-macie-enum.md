# AWS - Enumeraci√≥n de Macie

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop).
* Obt√©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com).
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family).
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>

## Macie

La funci√≥n principal del servicio es proporcionar un m√©todo autom√°tico para **detectar, identificar y clasificar datos** que se almacenan en tu cuenta de AWS.

El servicio est√° respaldado por **aprendizaje autom√°tico**, lo que permite revisar activamente tus datos a medida que se realizan diferentes acciones en tu cuenta de AWS. El aprendizaje autom√°tico puede detectar patrones de acceso y **comportamiento del usuario** analizando datos de eventos de CloudTrail para **alertar sobre cualquier actividad inusual o irregular**. Cualquier hallazgo realizado por Amazon Macie se presenta en un panel de control que puede generar alertas, lo que te permite resolver r√°pidamente cualquier amenaza potencial de exposici√≥n o compromiso de tus datos.

Amazon Macie monitorear√° y detectar√° autom√°ticamente de forma continua **nuevos datos almacenados en Amazon S3**. Utilizando las capacidades de aprendizaje autom√°tico e inteligencia artificial, este servicio tiene la capacidad de familiarizarse con el tiempo, los patrones de acceso a los datos.\
Amazon Macie tambi√©n utiliza m√©todos de procesamiento de lenguaje natural para **clasificar e interpretar diferentes tipos de datos y contenido**. El procesamiento de lenguaje natural utiliza principios de ciencias de la computaci√≥n y ling√º√≠stica computacional para analizar las interacciones entre las computadoras y el lenguaje humano. En particular, c√≥mo programar computadoras para comprender y descifrar datos de lenguaje. El **servicio puede asignar autom√°ticamente valores comerciales a los datos que se eval√∫an en forma de una puntuaci√≥n de riesgo**. Esto permite que Amazon Macie ordene los hallazgos seg√∫n su prioridad, lo que te permite centrarte primero en las alertas m√°s cr√≠ticas. Adem√°s de esto, Amazon Macie tambi√©n tiene la ventaja adicional de poder **monitorear y descubrir cambios de seguridad que rigen tus datos**. Adem√°s, puede identificar datos espec√≠ficos centrados en la seguridad, como claves de acceso almacenadas en un bucket de S3.

Este monitoreo de seguridad protector y proactivo permite que Amazon Macie **identifique datos cr√≠ticos, sensibles y centrados en la seguridad, como claves de API, claves secretas, adem√°s de datos de informaci√≥n de identificaci√≥n personal (PII) y datos de informaci√≥n de salud personal (PHI)**.

Esto es √∫til para evitar fugas de datos, ya que Macie detectar√° si est√°s exponiendo informaci√≥n personal en Internet.

Es un servicio **regional**.

Requiere la existencia del rol IAM 'AWSMacieServiceCustomerSetupRole' y necesita que AWS CloudTrail est√© habilitado.

Categor√≠as de alertas predefinidas:

* Acceso anonimizado
* Cumplimiento de configuraci√≥n
* P√©rdida de credenciales
* Cumplimiento de datos
* Alojamiento de archivos
* Enumeraci√≥n de identidad
* P√©rdida de informaci√≥n
* Anomal√≠a de ubicaci√≥n
* Permisos abiertos
* Escalada de privilegios
* Ransomware
* Interrupci√≥n del servicio
* Acceso sospechoso

El **resumen de alertas** proporciona informaci√≥n detallada para que puedas responder de manera adecuada. Tiene una descripci√≥n que brinda un nivel m√°s profundo de comprensi√≥n de por qu√© se gener√≥. Tambi√©n tiene un desglose de los resultados.

El usuario tiene la posibilidad de crear nuevas alertas personalizadas.

**Categorizaci√≥n del panel de control**:

* Objetos S3 para el rango de tiempo seleccionado
* Objetos S3
* Objetos S3 por PII - Informaci√≥n de Identificaci√≥n Personal
* Objetos S3 por ACL
* Eventos de CloudTrail de alto riesgo y usuarios asociados
* Errores de CloudTrail de alto riesgo y usuarios asociados
* Ubicaci√≥n de actividad
* Eventos de CloudTrail
* ISP de actividad
* Tipos de identidad de usuario de CloudTrail

**Categor√≠as de usuario**: Macie categoriza a los usuarios en las siguientes categor√≠as:

* **Platinum**: Usuarios o roles considerados que realizan llamadas de API de alto riesgo. A menudo tienen privilegios de administrador. Debes monitorearlos bastante bien en caso de que sean comprometidos.
* **Gold**: Usuarios o roles con historial de llamadas a APIs relacionadas con cambios de infraestructura. Tambi√©n debes monitorearlos.
* **Silver**: Usuarios o roles que realizan llamadas de API de nivel de riesgo medio.
* **Bronze**: Usuarios o roles que utilizan el nivel m√°s bajo de riesgo basado en las llamadas de API.

**Tipos de identidad**:

* Root: Solicitud realizada por el usuario root
* IAM user: Solicitud realizada por un usuario IAM
* Assumed Role: Solicitud realizada por credenciales temporales asumidas (API AssumeRole para STS)
* Federated User: Solicitud realizada utilizando credenciales temporales (API GetFederationToken para STS)
* AWS Account: Solicitud realizada por una cuenta de AWS diferente
* AWS Service: Solicitud realizada por un servicio de AWS

**Clasificaci√≥n de datos**: Existen 4 clasificaciones de archivos:

* Content-Type: lista archivos seg√∫n el tipo de contenido detectado. El riesgo dado se determina por el tipo de contenido detectado.
* Extensi√≥n de archivo: lo mismo que Content-Type pero basado en la extensi√≥n.
* Tema: Categoriza seg√∫n una serie de palabras clave detectadas dentro de los archivos.
* Regex: Categor√≠as basadas en expresiones regulares espec√≠ficas.

El riesgo final de un archivo ser√° el riesgo m√°s alto encontrado entre esas 4 categor√≠as.

La funci√≥n de investigaci√≥n permite crear tus propias consultas sobre todos los datos de Amazon Macie y realizar un an√°lisis exhaustivo de los datos. Puedes filtrar los resultados en funci√≥n de: Datos de CloudTrail, propiedades del bucket de S3 y objetos de S3.

Es posible invitar a otras cuentas a Amazon Macie para que varias cuentas compartan Amazon Macie.

### Enumeraci√≥n
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Explotaci√≥n

{% hint style="success" %}
Desde la perspectiva de un atacante, este servicio no est√° dise√±ado para detectar al atacante, sino para detectar informaci√≥n sensible en los archivos almacenados. Por lo tanto, este servicio podr√≠a **ayudar a un atacante a encontrar informaci√≥n sensible** dentro de los buckets.\
Sin embargo, tal vez a un atacante tambi√©n le interese interrumpirlo para evitar que la v√≠ctima reciba alertas y robar esa informaci√≥n m√°s f√°cilmente.
{% endhint %}

TODO: ¬°Se aceptan PRs!

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**, ¬°consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
