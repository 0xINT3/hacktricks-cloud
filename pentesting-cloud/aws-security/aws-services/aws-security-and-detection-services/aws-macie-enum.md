# AWS - Enumerazione di Macie

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

# Macie

Amazon Macie si distingue come un servizio progettato per **rilevare, classificare e identificare automaticamente i dati** all'interno di un account AWS. Sfrutta l'**apprendimento automatico** per monitorare e analizzare continuamente i dati, concentrandosi principalmente sulla rilevazione e l'allerta di attivit√† insolite o sospette esaminando i dati degli eventi di traccia del cloud e i modelli di comportamento degli utenti.

Caratteristiche principali di Amazon Macie:

1. **Revisione attiva dei dati**: Utilizza l'apprendimento automatico per revisionare attivamente i dati mentre avvengono varie azioni all'interno dell'account AWS.
2. **Rilevazione delle anomalie**: Identifica attivit√† o modelli di accesso irregolari, generando allerte per mitigare i potenziali rischi di esposizione dei dati.
3. **Monitoraggio continuo**: Monitora e rileva automaticamente nuovi dati in Amazon S3, utilizzando l'apprendimento automatico e l'intelligenza artificiale per adattarsi ai modelli di accesso ai dati nel tempo.
4. **Classificazione dei dati con NLP**: Utilizza l'elaborazione del linguaggio naturale (NLP) per classificare e interpretare diversi tipi di dati, assegnando punteggi di rischio per prioritizzare le scoperte.
5. **Monitoraggio della sicurezza**: Identifica dati sensibili alla sicurezza, inclusi chiavi API, chiavi segrete e informazioni personali, contribuendo a prevenire fughe di dati.

Amazon Macie √® un **servizio regionale** e richiede il ruolo IAM 'AWSMacieServiceCustomerSetupRole' e un AWS CloudTrail abilitato per la funzionalit√†.

## Sistema di allerta

Macie categorizza le allerte in categorie predefinite come:

- Accesso anonimizzato
- Conformit√† dei dati
- Perdita di credenziali
- Escalation dei privilegi
- Ransomware
- Accesso sospetto, ecc.

Queste allerte forniscono descrizioni dettagliate e scomposizioni dei risultati per una risposta e una risoluzione efficaci.

## Funzionalit√† del dashboard

Il dashboard categorizza i dati in varie sezioni, tra cui:

- Oggetti S3 (per intervallo di tempo, ACL, PII)
- Eventi/utenti CloudTrail ad alto rischio
- Posizioni delle attivit√†
- Tipi di identit√† degli utenti di CloudTrail, e altro ancora.

## Categorizzazione degli utenti

Gli utenti vengono classificati in livelli in base al livello di rischio delle loro chiamate API:

- **Platinum**: Chiamate API ad alto rischio, spesso con privilegi di amministratore.
- **Gold**: Chiamate API relative all'infrastruttura.
- **Silver**: Chiamate API a rischio medio.
- **Bronze**: Chiamate API a basso rischio.

## Tipi di identit√†

I tipi di identit√† includono Root, Utente IAM, Ruolo assunto, Utente federato, Account AWS e Servizio AWS, indicando la fonte delle richieste.

## Classificazione dei dati

La classificazione dei dati comprende:

- Tipo di contenuto: Basato sul tipo di contenuto rilevato.
- Estensione del file: Basato sull'estensione del file.
- Tema: Categorizzato in base alle parole chiave presenti nei file.
- Regex: Categorizzato in base a modelli regex specifici.

Il rischio pi√π elevato tra queste categorie determina il livello di rischio finale del file.

## Ricerca e analisi

La funzione di ricerca di Amazon Macie consente di eseguire query personalizzate su tutti i dati di Macie per un'analisi approfondita. I filtri includono dati di CloudTrail, propriet√† del bucket S3 e oggetti S3. Inoltre, supporta l'invito di altri account per condividere Amazon Macie, facilitando la gestione collaborativa dei dati e il monitoraggio della sicurezza.


## Enumerazione
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Esploitation

{% hint style="success" %}
Dal punto di vista di un attaccante, questo servizio non √® stato creato per rilevare l'attaccante, ma per individuare informazioni sensibili nei file archiviati. Pertanto, questo servizio potrebbe **aiutare un attaccante a trovare informazioni sensibili** all'interno dei bucket.\
Tuttavia, potrebbe interessare anche a un attaccante interromperlo al fine di impedire alla vittima di ricevere avvisi e rubare pi√π facilmente tali informazioni.
{% endhint %}

TODO: I PR sono benvenuti!

# Riferimenti
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
