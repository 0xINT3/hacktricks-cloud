# AWS - Macie Enum

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**する。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

# Macie

Amazon Macieは、AWSアカウント内のデータを**自動的に検出、分類、特定する**ように設計されたサービスとして際立っています。**機械学習**を活用してデータを継続的に監視・分析し、**クラウドトレイルイベント**データとユーザーの行動パターンを調査することで、通常とは異なるまたは怪しい活動を検出し、警告します。

Amazon Macieの主な特徴:

1. **アクティブデータレビュー**: 機械学習を使用して、AWSアカウント内で様々なアクションが発生するにつれてデータを積極的にレビューします。
2. **異常検出**: 不規則な活動やアクセスパターンを特定し、潜在的なデータ漏洩リスクを軽減するためのアラートを生成します。
3. **継続的監視**: Amazon S3に新しいデータが検出されると自動的に監視し、機械学習と人工知能を使用して時間とともにデータアクセスパターンに適応します。
4. **NLPによるデータ分類**: 自然言語処理（NLP）を使用して異なるデータタイプを分類・解釈し、発見を優先するためのリスクスコアを割り当てます。
5. **セキュリティ監視**: APIキー、シークレットキー、個人情報などのセキュリティに敏感なデータを特定し、データ漏洩を防ぐのに役立ちます。

Amazon Macieは**リージョナルサービス**であり、機能するためには'IAMロールAWSMacieServiceCustomerSetupRole'と有効なAWS CloudTrailが必要です。

## アラートシステム

Macieはアラートを以下のような事前定義されたカテゴリに分類します:

- 匿名アクセス
- データコンプライアンス
- 資格情報の損失
- 権限の昇格
- ランサムウェア
- 疑わしいアクセスなど

これらのアラートは詳細な説明と結果の内訳を提供し、効果的な対応と解決を支援します。

## ダッシュボードの特徴

ダッシュボードはデータを以下のような様々なセクションに分類します:

- S3オブジェクト（時間範囲、ACL、PIIによる）
- ハイリスクCloudTrailイベント/ユーザー
- アクティビティの場所
- CloudTrailユーザーのアイデンティティタイプなど

## ユーザーの分類

ユーザーは、APIコールのリスクレベルに基づいて以下のように階層に分類されます:

- **プラチナ**: 管理者権限を持つことが多い高リスクAPIコール。
- **ゴールド**: インフラ関連のAPIコール。
- **シルバー**: 中リスクのAPIコール。
- **ブロンズ**: 低リスクのAPIコール。

## アイデンティティタイプ

アイデンティティタイプには、Root、IAMユーザー、Assumed Role、Federated User、AWSアカウント、AWSサービスが含まれ、リクエストのソースを示します。

## データ分類

データ分類には以下が含まれます:

- コンテンツタイプ: 検出されたコンテンツタイプに基づく。
- ファイル拡張子: ファイル拡張子に基づく。
- テーマ: ファイル内のキーワードによって分類。
- 正規表現: 特定の正規表現パターンに基づいて分類。

これらのカテゴリの中で最もリスクが高いものが、ファイルの最終的なリスクレベルを決定します。

## 研究と分析

Amazon Macieの研究機能は、Macieのデータ全体にわたるカスタムクエリを可能にし、詳細な分析を行います。フィルターにはCloudTrailデータ、S3バケットのプロパティ、S3オブジェクトが含まれます。さらに、他のアカウントを招待してAmazon Macieを共有することをサポートし、協力的なデータ管理とセキュリティ監視を促進します。

## 列挙
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### ポストエクスプロイテーション

{% hint style="success" %}
攻撃者の視点からすると、このサービスは攻撃者を検出するためのものではなく、保存されたファイル内の機密情報を検出するためのものです。したがって、このサービスは**攻撃者がバケット内の機密情報を見つけるのを助ける可能性があります**。\
しかし、攻撃者は被害者がアラートを受け取るのを防ぎ、より簡単にその情報を盗むために、このサービスを妨害することにも興味を持つかもしれません。
{% endhint %}

TODO: PRs are welcome!

# 参考文献
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)で</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>!</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションをチェックしてください。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォロー**してください。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有してください**。

</details>
