# AWS - Macie 枚举

<details>

<summary><strong>从零到英雄学习AWS黑客技术，通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## Macie

该服务的主要功能是提供一种自动方法，用于**检测、识别并分类**您在AWS账户中存储的数据。

该服务由**机器学习**支持，允许您的数据在AWS账户中进行不同操作时被积极审查。机器学习可以通过分析**cloud trail事件**数据来发现访问模式和**用户行为**，以**警告任何不寻常或不规则的活动**。Amazon Macie发现的任何问题都会在仪表板中呈现，可以触发警报，让您能够快速解决任何潜在的数据暴露或妥协风险。

Amazon Macie将自动并持续**监控和检测存储在Amazon S3中的新数据**。利用机器学习和人工智能的能力，这项服务能够随着时间的推移熟悉数据的访问模式。\
Amazon Macie还使用自然语言处理方法来**分类和解释不同的数据类型和内容**。NLP使用来自计算机科学和计算语言学的原理来研究计算机与人类语言之间的交互。特别是，如何编程计算机以理解和解读语言数据。**该服务可以自动为评估的数据分配业务价值，以风险评分的形式**。这使Amazon Macie能够按优先级顺序排列发现，使您能够首先关注最关键的警报。除此之外，Amazon Macie还能够**监控和发现管理您数据的安全变化**。以及识别特定的以安全为中心的数据，如S3桶中持有的访问密钥。

这种保护性和主动性的安全监控使Amazon Macie能够**识别关键的、敏感的和以安全为中心的数据，如API密钥、密钥，以及PII（个人身份信息）和PHI数据**。

这对于避免数据泄露很有用，因为Macie会检测到您是否将人们的信息暴露在互联网上。

它是一个**区域性服务**。

它需要IAM角色'AWSMacieServiceCustomerSetupRole'的存在，并且需要启用AWS CloudTrail。

预定义的警报类别：

* 匿名访问
* 配置合规
* 凭证丢失
* 数据合规
* 文件托管
* 身份枚举
* 信息丢失
* 位置异常
* 开放权限
* 权限升级
* 勒索软件
* 服务中断
* 可疑访问

**警报摘要**提供详细信息，以便您做出适当的响应。它有一个描述，提供了为什么会生成它的更深层次的理解。它还有结果的细分。

用户有可能创建新的自定义警报。

**仪表板分类**：

* 选定时间范围内的S3对象
* S3对象
* 由PII - 个人身份信息分类的S3对象
* 由ACL分类的S3对象
* 高风险CloudTrail事件及相关用户
* 高风险CloudTrail错误及相关用户
* 活动位置
* CloudTrail事件
* 活动ISP
* CloudTrail用户身份类型

**用户类别**：Macie将用户分为以下类别：

* **Platinum**：被认为进行高风险API调用的用户或角色。通常他们拥有管理员权限。如果他们被泄露，您应该密切监控
* **Gold**：有调用与基础设施变更相关API的历史的用户或角色。您也应该监控他们
* **Silver**：执行中等风险级别API调用的用户或角色
* **Bronze**：根据API调用使用最低风险级别的用户或角色

**身份类型**：

* Root：由root用户发出的请求
* IAM用户：由IAM用户发出的请求
* 假定角色：由临时假定凭证发出的请求（STS的AssumeRole API）
* 联合用户：使用临时凭证发出的请求（STS的GetFederationToken API）
* AWS账户：由不同AWS账户发出的请求
* AWS服务：由AWS服务发出的请求

**数据分类**：存在4种文件分类：

* Content-Type：根据检测到的内容类型列出文件。给定的风险由检测到的内容类型决定。
* 文件扩展名：与content-type相同，但基于扩展名
* 主题：根据文件中检测到的一系列关键词进行分类
* 正则表达式：根据特定的正则表达式进行分类

文件的最终风险将是这4个类别中发现的最高风险

研究功能允许您针对所有Amazon Macie数据创建自己的查询，并对数据进行深入分析。您可以根据以下条件过滤结果：CloudTrail数据、S3桶属性和S3对象

可以邀请其他账户加入Amazon Macie，以便多个账户共享Amazon Macie。

### 枚举
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### 渗透后期

{% hint style="success" %}
从攻击者的角度来看，这项服务并不是为了检测攻击者，而是为了检测存储文件中的敏感信息。因此，这项服务可能会**帮助攻击者在存储桶中找到敏感信息**。\
然而，攻击者也可能对破坏它感兴趣，以防止受害者收到警报，从而更容易地窃取那些信息。
{% endhint %}

TODO: 欢迎提交PR！

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>从零开始学习AWS黑客攻击！</strong></summary>

其他支持HackTricks的方式：

* 如果您希望在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF版本**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方的PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库**提交PR来分享您的黑客技巧**。

</details>
