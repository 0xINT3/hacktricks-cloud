# AWS - √ânum√©ration de Macie

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Macie

La fonction principale du service est de fournir une m√©thode automatique de **d√©tection, d'identification et de classification des donn√©es** que vous stockez dans votre compte AWS.

Le service est soutenu par l'**apprentissage automatique**, permettant √† vos donn√©es d'√™tre activement examin√©es alors que diff√©rentes actions sont prises dans votre compte AWS. L'apprentissage automatique peut rep√©rer les mod√®les d'acc√®s et le **comportement des utilisateurs** en analysant les donn√©es d'√©v√©nements **cloud trail** pour **alerter contre toute activit√© inhabituelle ou irr√©guli√®re**. Toutes les d√©couvertes faites par Amazon Macie sont pr√©sent√©es dans un tableau de bord qui peut d√©clencher des alertes, vous permettant de r√©soudre rapidement toute menace potentielle d'exposition ou de compromission de vos donn√©es.

Amazon Macie surveillera automatiquement et en continu **les nouvelles donn√©es stock√©es dans Amazon S3**. Utilisant les capacit√©s de l'apprentissage automatique et de l'intelligence artificielle, ce service a la capacit√© de se familiariser avec le temps, les mod√®les d'acc√®s aux donn√©es.\
Amazon Macie utilise √©galement des m√©thodes de traitement du langage naturel pour **classifier et interpr√©ter diff√©rents types de donn√©es et contenus**. Le TALN utilise des principes de l'informatique et de la linguistique computationnelle pour examiner les interactions entre les ordinateurs et le langage humain. En particulier, comment programmer les ordinateurs pour comprendre et d√©chiffrer les donn√©es linguistiques. Le **service peut automatiquement attribuer des valeurs commerciales aux donn√©es √©valu√©es sous forme de score de risque**. Cela permet √† Amazon Macie de classer les d√©couvertes sur une base prioritaire, vous permettant de vous concentrer d'abord sur les alertes les plus critiques. En plus de cela, Amazon Macie a √©galement l'avantage suppl√©mentaire de pouvoir **surveiller et d√©couvrir les changements de s√©curit√© r√©gissant vos donn√©es**. Ainsi que d'identifier des donn√©es sp√©cifiques centr√©es sur la s√©curit√© telles que les cl√©s d'acc√®s contenues dans un seau S3.

Cette surveillance de s√©curit√© protectrice et proactive permet √† Amazon Macie d'**identifier des donn√©es critiques, sensibles et ax√©es sur la s√©curit√© telles que les cl√©s API, les cl√©s secr√®tes, en plus des donn√©es PII (informations personnellement identifiables) et PHI**.

Cela est utile pour √©viter les fuites de donn√©es car Macie d√©tectera si vous exposez des informations personnelles sur Internet.

C'est un **service r√©gional**.

Il n√©cessite l'existence du r√¥le IAM 'AWSMacieServiceCustomerSetupRole' et il a besoin qu'AWS CloudTrail soit activ√©.

Cat√©gories d'alertes pr√©d√©finies :

* Acc√®s anonymis√©
* Conformit√© de configuration
* Perte de justificatifs
* Conformit√© des donn√©es
* H√©bergement de fichiers
* √ânum√©ration d'identit√©
* Perte d'information
* Anomalie de localisation
* Permissions ouvertes
* Escalade de privil√®ges
* Ransomware
* Perturbation de service
* Acc√®s suspect

Le **r√©sum√© des alertes** fournit des informations d√©taill√©es pour vous permettre de r√©pondre de mani√®re appropri√©e. Il a une description qui fournit un niveau de compr√©hension plus profond de la raison pour laquelle il a √©t√© g√©n√©r√©. Il a √©galement une ventilation des r√©sultats.

L'utilisateur a la possibilit√© de cr√©er de nouvelles alertes personnalis√©es.

**Cat√©gorisation du tableau de bord** :

* Objets S3 pour la plage de temps s√©lectionn√©e
* Objets S3
* Objets S3 par PII - Informations Personnellement Identifiables
* Objets S3 par ACL
* √âv√©nements CloudTrail √† haut risque et utilisateurs associ√©s
* Erreurs CloudTrail √† haut risque et utilisateurs associ√©s
* Localisation d'activit√©
* √âv√©nements CloudTrail
* Fournisseurs d'acc√®s Internet d'activit√©
* Types d'identit√© d'utilisateur CloudTrail

**Cat√©gories d'utilisateurs** : Macie cat√©gorise les utilisateurs dans les cat√©gories suivantes :

* **Platinum** : Utilisateurs ou r√¥les consid√©r√©s comme effectuant des appels d'API √† haut risque. Souvent, ils ont des privil√®ges d'administrateurs. Vous devriez les surveiller de pr√®s au cas o√π ils seraient compromis.
* **Gold** : Utilisateurs ou r√¥les ayant un historique d'appels d'API li√©s aux changements d'infrastructure. Vous devriez √©galement les surveiller.
* **Silver** : Utilisateurs ou r√¥les effectuant des appels d'API √† risque moyen.
* **Bronze** : Utilisateurs ou r√¥les utilisant le niveau de risque le plus bas bas√© sur les appels d'API.

**Types d'identit√©** :

* Root : Requ√™te faite par l'utilisateur root.
* Utilisateur IAM : Requ√™te faite par un utilisateur IAM.
* R√¥le assum√© : Requ√™te faite par des informations d'identification temporaires assum√©es (API AssumeRole pour STS).
* Utilisateur f√©d√©r√© : Requ√™te faite en utilisant des informations d'identification temporaires (API GetFederationToken pour STS).
* Compte AWS : Requ√™te faite par un compte AWS diff√©rent.
* Service AWS : Requ√™te faite par un service AWS.

**Classification des donn√©es** : Il existe 4 classifications de fichiers :

* Content-Type : liste des fichiers bas√©e sur le type de contenu d√©tect√©. Le risque donn√© est d√©termin√© par le type de contenu d√©tect√©.
* Extension de fichier : Identique au type de contenu mais bas√© sur l'extension.
* Th√®me : Cat√©gorise en fonction d'une s√©rie de mots-cl√©s d√©tect√©s dans les fichiers.
* Regex : Cat√©gories bas√©es sur des expressions r√©guli√®res sp√©cifiques.

Le risque final d'un fichier sera le risque le plus √©lev√© trouv√© entre ces 4 cat√©gories.

La fonction de recherche permet de cr√©er vos propres requ√™tes contre toutes les donn√©es Amazon Macie et d'effectuer une analyse approfondie des donn√©es. Vous pouvez filtrer les r√©sultats en fonction de : Donn√©es CloudTrail, propri√©t√©s des seaux S3 et objets S3.

Il est possible d'inviter d'autres comptes √† Amazon Macie afin que plusieurs comptes partagent Amazon Macie.

### √ânum√©ration
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Exploitation

{% hint style="success" %}
Du point de vue d'un attaquant, ce service n'est pas con√ßu pour d√©tecter l'attaquant, mais pour d√©tecter les informations sensibles dans les fichiers stock√©s. Par cons√©quent, ce service pourrait **aider un attaquant √† trouver des informations sensibles** √† l'int√©rieur des seaux.\
Cependant, peut-√™tre qu'un attaquant pourrait √©galement √™tre int√©ress√© √† le perturber afin d'emp√™cher la victime de recevoir des alertes et de voler ces informations plus facilement.
{% endhint %}

TODO : Les PR sont les bienvenues !

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
