# AWS - Enumeraci칩n de Macie

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

# Macie

Amazon Macie se destaca como un servicio dise침ado para **detectar, clasificar e identificar datos autom치ticamente** dentro de una cuenta de AWS. Utiliza **machine learning** para monitorear y analizar datos continuamente, enfoc치ndose principalmente en detectar y alertar sobre actividades inusuales o sospechosas examinando datos de eventos de **cloud trail** y patrones de comportamiento de usuarios.

Caracter칤sticas clave de Amazon Macie:

1. **Revisi칩n Activa de Datos**: Emplea machine learning para revisar datos activamente a medida que ocurren diversas acciones dentro de la cuenta de AWS.
2. **Detecci칩n de Anomal칤as**: Identifica actividades o patrones de acceso irregulares, generando alertas para mitigar posibles riesgos de exposici칩n de datos.
3. **Monitoreo Continuo**: Monitorea autom치ticamente y detecta nuevos datos en Amazon S3, utilizando machine learning e inteligencia artificial para adaptarse a los patrones de acceso de datos con el tiempo.
4. **Clasificaci칩n de Datos con NLP**: Utiliza procesamiento de lenguaje natural (NLP) para clasificar e interpretar diferentes tipos de datos, asignando puntajes de riesgo para priorizar hallazgos.
5. **Monitoreo de Seguridad**: Identifica datos sensibles de seguridad, incluyendo claves de API, claves secretas e informaci칩n personal, ayudando a prevenir fugas de datos.

Amazon Macie es un **servicio regional** y requiere el rol IAM 'AWSMacieServiceCustomerSetupRole' y un AWS CloudTrail habilitado para su funcionalidad.

## Sistema de Alertas

Macie categoriza las alertas en categor칤as predefinidas como:

- Acceso anonimizado
- Cumplimiento de datos
- P칠rdida de credenciales
- Escalada de privilegios
- Ransomware
- Acceso sospechoso, etc.

Estas alertas proporcionan descripciones detalladas y desgloses de resultados para una respuesta y resoluci칩n efectivas.

## Caracter칤sticas del Tablero

El tablero categoriza los datos en varias secciones, incluyendo:

- Objetos S3 (por rango de tiempo, ACL, PII)
- Eventos/usuarios de CloudTrail de alto riesgo
- Ubicaciones de Actividad
- Tipos de identidad de usuario de CloudTrail, y m치s.

## Categorizaci칩n de Usuarios

Los usuarios se clasifican en niveles basados en el nivel de riesgo de sus llamadas a la API:

- **Platinum**: Llamadas a la API de alto riesgo, a menudo con privilegios de administrador.
- **Gold**: Llamadas a la API relacionadas con la infraestructura.
- **Silver**: Llamadas a la API de riesgo medio.
- **Bronze**: Llamadas a la API de bajo riesgo.

## Tipos de Identidad

Los tipos de identidad incluyen Root, usuario IAM, Rol Asumido, Usuario Federado, Cuenta AWS y Servicio AWS, indicando la fuente de las solicitudes.

## Clasificaci칩n de Datos

La clasificaci칩n de datos abarca:

- Tipo de Contenido: Basado en el tipo de contenido detectado.
- Extensi칩n de Archivo: Basado en la extensi칩n del archivo.
- Tema: Categorizado por palabras clave dentro de los archivos.
- Regex: Categorizado basado en patrones regex espec칤ficos.

El riesgo m치s alto entre estas categor칤as determina el nivel de riesgo final del archivo.

## Investigaci칩n y An치lisis

La funci칩n de investigaci칩n de Amazon Macie permite consultas personalizadas en todos los datos de Macie para un an치lisis profundo. Los filtros incluyen Datos de CloudTrail, propiedades de Buckets S3 y Objetos S3. Adem치s, admite invitar a otras cuentas para compartir Amazon Macie, facilitando la gesti칩n colaborativa de datos y el monitoreo de seguridad.


## Enumeraci칩n
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Explotaci칩n

{% hint style="success" %}
Desde la perspectiva de un atacante, este servicio no est치 hecho para detectar al atacante, sino para detectar informaci칩n sensible en los archivos almacenados. Por lo tanto, este servicio podr칤a **ayudar a un atacante a encontrar informaci칩n sensible** dentro de los buckets.\
Sin embargo, tal vez un atacante tambi칠n podr칤a estar interesado en interrumpirlo para evitar que la v칤ctima reciba alertas y robar esa informaci칩n m치s f치cilmente.
{% endhint %}

TODO: 춰Se aceptan PRs!

# Referencias
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
