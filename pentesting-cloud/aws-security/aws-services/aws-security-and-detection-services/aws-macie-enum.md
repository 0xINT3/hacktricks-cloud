# AWS - Macie Enum

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert Red Team AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

# Macie

Amazon Macie se distingue en tant que service con√ßu pour **d√©tecter, classifier et identifier automatiquement des donn√©es** au sein d'un compte AWS. Il exploite **l'apprentissage automatique** pour surveiller et analyser en continu les donn√©es, en se concentrant principalement sur la d√©tection et l'alerte des activit√©s inhabituelles ou suspectes en examinant les donn√©es d'√©v√©nements de **CloudTrail** et les mod√®les de comportement des utilisateurs.

Principales fonctionnalit√©s d'Amazon Macie :

1. **Examen actif des donn√©es** : Utilise l'apprentissage automatique pour examiner activement les donn√©es au fur et √† mesure que diverses actions se produisent dans le compte AWS.
2. **D√©tection d'anomalies** : Identifie les activit√©s ou les mod√®les d'acc√®s irr√©guliers, g√©n√©rant des alertes pour att√©nuer les risques potentiels d'exposition des donn√©es.
3. **Surveillance continue** : Surveille et d√©tecte automatiquement de nouvelles donn√©es dans Amazon S3, en utilisant l'apprentissage automatique et l'intelligence artificielle pour s'adapter aux mod√®les d'acc√®s aux donn√©es au fil du temps.
4. **Classification des donn√©es avec NLP** : Utilise le traitement du langage naturel (NLP) pour classer et interpr√©ter diff√©rents types de donn√©es, attribuant des scores de risque pour prioriser les r√©sultats.
5. **Surveillance de la s√©curit√©** : Identifie les donn√©es sensibles en mati√®re de s√©curit√©, y compris les cl√©s API, les cl√©s secr√®tes et les informations personnelles, contribuant √† pr√©venir les fuites de donn√©es.

Amazon Macie est un **service r√©gional** et n√©cessite le r√¥le IAM 'AWSMacieServiceCustomerSetupRole' et un CloudTrail AWS activ√© pour fonctionner.

## Syst√®me d'alerte

Macie cat√©gorise les alertes en cat√©gories pr√©d√©finies telles que :

- Acc√®s anonymis√©
- Conformit√© des donn√©es
- Perte d'identifiants
- √âl√©vation de privil√®ges
- Ran√ßongiciel
- Acc√®s suspect, etc.

Ces alertes fournissent des descriptions d√©taill√©es et des d√©compositions des r√©sultats pour une r√©ponse et une r√©solution efficaces.

## Fonctionnalit√©s du tableau de bord

Le tableau de bord cat√©gorise les donn√©es en diff√©rentes sections, notamment :

- Objets S3 (par plage horaire, ACL, PII)
- √âv√©nements/utilisateurs CloudTrail √† haut risque
- Lieux d'activit√©
- Types d'identit√© des utilisateurs CloudTrail, et plus encore.

## Cat√©gorisation des utilisateurs

Les utilisateurs sont class√©s en niveaux en fonction du niveau de risque de leurs appels API :

- **Platine** : Appels API √† haut risque, souvent avec des privil√®ges d'administrateur.
- **Or** : Appels API li√©s √† l'infrastructure.
- **Argent** : Appels API √† risque moyen.
- **Bronze** : Appels API √† faible risque.

## Types d'identit√©

Les types d'identit√© incluent Root, Utilisateur IAM, R√¥le Assum√©, Utilisateur F√©d√©r√©, Compte AWS et Service AWS, indiquant la source des demandes.

## Classification des donn√©es

La classification des donn√©es englobe :

- Type de contenu : Bas√© sur le type de contenu d√©tect√©.
- Extension de fichier : Bas√© sur l'extension de fichier.
- Th√®me : Cat√©goris√© par mots-cl√©s dans les fichiers.
- Regex : Cat√©goris√© en fonction de mod√®les regex sp√©cifiques.

Le risque le plus √©lev√© parmi ces cat√©gories d√©termine le niveau de risque final du fichier.

## Recherche et Analyse

La fonction de recherche d'Amazon Macie permet des requ√™tes personnalis√©es sur l'ensemble des donn√©es Macie pour une analyse approfondie. Les filtres incluent les donn√©es CloudTrail, les propri√©t√©s du bucket S3 et les objets S3. De plus, il prend en charge l'invitation d'autres comptes pour partager Amazon Macie, facilitant la gestion collaborative des donn√©es et la surveillance de la s√©curit√©.


## √ânum√©ration
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Exploitation

{% hint style="success" %}
D'un point de vue d'un attaquant, ce service n'est pas con√ßu pour d√©tecter l'attaquant, mais pour d√©tecter des informations sensibles dans les fichiers stock√©s. Par cons√©quent, ce service pourrait **aider un attaquant √† trouver des infos sensibles** √† l'int√©rieur des compartiments.\
Cependant, un attaquant pourrait √©galement √™tre int√©ress√© √† le perturber afin d'emp√™cher la victime de recevoir des alertes et de voler plus facilement ces informations.
{% endhint %}

TODO: Les PR sont les bienvenues !

# R√©f√©rences
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
