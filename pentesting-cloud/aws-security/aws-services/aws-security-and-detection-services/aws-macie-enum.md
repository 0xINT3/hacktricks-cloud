# AWS - Macie Enum

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

## Macie

このサービスの主な機能は、AWSアカウント内で保存しているデータを**自動的に検出、識別、分類する**方法を提供することです。

サービスは**機械学習**によって支えられており、AWSアカウント内で異なるアクションが取られるにつれて、データが積極的にレビューされます。機械学習は、**クラウドトレイルイベント**データを分析して、**通常とは異なるまたは不規則な活動に対して警告する**ことができます。Amazon Macieによって行われた発見は、ダッシュボード内で提示され、アラートをトリガーすることができ、データの露出や妥協の潜在的な脅威を迅速に解決することができます。

Amazon Macieは自動的かつ継続的に**Amazon S3に保存された新しいデータを監視し、検出します**。機械学習と人工知能の能力を使用して、このサービスは時間とともにデータへのアクセスパターンを熟知することができます。\
Amazon Macieは自然言語処理の方法も使用して、**異なるデータタイプとコンテンツを分類し、解釈します**。NLPは、コンピュータ科学と計算言語学の原則を使用して、コンピュータと人間の言語との間の相互作用を見ます。特に、コンピュータに言語データを理解し、解読する方法をプログラムする方法です。**サービスは、評価されたデータにビジネス価値を自動的に割り当てることができます**。これにより、Amazon Macieは優先度の高い基準で発見を順序付けすることができ、最も重要なアラートから集中して対処することができます。さらに、Amazon Macieは、データを管理するセキュリティ変更を**監視し、発見する**こともできます。また、S3バケット内に保持されているアクセスキーなどの特定のセキュリティ中心のデータを特定することもできます。

この保護的かつ積極的なセキュリティ監視により、Amazon Macieは**APIキー、シークレットキー、さらにはPII（個人識別情報）およびPHIデータなどの重要な、機密性の高い、セキュリティに焦点を当てたデータを特定する**ことができます。

これは、Macieがインターネットに人々の情報を公開している場合にデータ漏洩を避けるのに役立ちます。

**リージョナルサービス**です。

IAMロール 'AWSMacieServiceCustomerSetupRole' の存在が必要で、AWS CloudTrailが有効になっている必要があります。

事前定義されたアラートカテゴリ:

* 匿名アクセス
* コンフィグコンプライアンス
* 資格情報の損失
* データコンプライアンス
* ファイルホスティング
* アイデンティティ列挙
* 情報損失
* 位置異常
* オープンパーミッション
* 権限昇格
* ランサムウェア
* サービス中断
* 疑わしいアクセス

**アラートサマリー**は、適切に対応するための詳細情報を提供します。生成された理由をより深く理解するための説明があります。また、結果の内訳もあります。

ユーザーは新しいカスタムアラートを作成する可能性があります。

**ダッシュボードの分類**:

* 選択された時間範囲のS3オブジェクト
* S3オブジェクト
* PII - 個人識別情報によるS3オブジェクト
* ACLによるS3オブジェクト
* ハイリスクCloudTrailイベントおよび関連ユーザー
* ハイリスクCloudTrailエラーおよび関連ユーザー
* アクティビティの場所
* CloudTrailイベント
* アクティビティISP
* CloudTrailユーザーIDタイプ

**ユーザーカテゴリ**: Macieは以下のカテゴリにユーザーを分類します:

* **プラチナ**: 高リスクAPIコールを行うと考えられるユーザーやロール。しばしば管理者権限を持っています。妥協された場合に備えてしっかりと監視する必要があります
* **ゴールド**: インフラ変更に関連するAPIを呼び出す履歴のあるユーザーやロール。これらも監視する必要があります
* **シルバー**: 中程度のリスクAPIコールを行うユーザーやロール
* **ブロンズ**: APIコールに基づいて最低レベルのリスクを使用するユーザーやロール

**IDタイプ**:

* Root: ルートユーザーによるリクエスト
* IAMユーザー: IAMユーザーによるリクエスト
* Assumed Role: 一時的な仮想資格情報（AssumeRole API for STS）によるリクエスト
* Federated User: 一時的な資格情報（GetFederationToken API fro STS）を使用したリクエスト
* AWSアカウント: 別のAWSアカウントによるリクエスト
* AWSサービス: AWSサービスによるリクエスト

**データ分類**: 4つのファイル分類が存在します:

* Content-Type: 検出されたコンテンツタイプに基づいてファイルをリストします。与えられたリスクは検出されたコンテンツのタイプによって決まります。
* ファイル拡張子: Content-Typeと同じですが、拡張子に基づいています
* テーマ: ファイル内で検出された一連のキーワードに基づいて分類します
* Regex: 特定の正規表現に基づいてカテゴリを分類します

ファイルの最終リスクは、これら4つのカテゴリの中で見つかった最も高いリスクになります

リサーチ機能により、Amazon Macieのすべてのデータに対して独自のクエリを作成し、データの深い分析を行うことができます。結果をフィルタリングするには：CloudTrailデータ、S3バケットプロパティ、S3オブジェクト

他のアカウントをAmazon Macieに招待することが可能で、複数のアカウントがAmazon Macieを共有できます。

### 列挙
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### 侵害後の活動

{% hint style="success" %}
攻撃者の視点から見ると、このサービスは攻撃者を検出するためのものではなく、保存されたファイル内の機密情報を検出するためのものです。したがって、このサービスは**攻撃者がバケット内の機密情報を見つけるのを助ける可能性があります**。\
しかし、攻撃者は被害者がアラートを受け取るのを防ぎ、情報をより簡単に盗むために、このサービスを妨害することにも興味を持つかもしれません。
{% endhint %}

TODO: PRs are welcome!

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をチェック！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックしてください。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォロー**してください。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有してください**。

</details>
