# AWS - Macie Enum

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

# Macie

Amazon Macie se distingue comme un service con√ßu pour **d√©tecter, classer et identifier automatiquement les donn√©es** au sein d'un compte AWS. Il utilise le **machine learning** pour surveiller et analyser continuellement les donn√©es, en se concentrant principalement sur la d√©tection et l'alerte contre les activit√©s inhabituelles ou suspectes en examinant les donn√©es d'**√©v√©nements cloud trail** et les mod√®les de comportement des utilisateurs.

Caract√©ristiques cl√©s d'Amazon Macie :

1. **R√©vision Active des Donn√©es** : Utilise le machine learning pour examiner activement les donn√©es √† mesure que diverses actions se produisent dans le compte AWS.
2. **D√©tection d'Anomalies** : Identifie les activit√©s ou les mod√®les d'acc√®s irr√©guliers, g√©n√©rant des alertes pour att√©nuer les risques potentiels d'exposition des donn√©es.
3. **Surveillance Continue** : Surveille et d√©tecte automatiquement les nouvelles donn√©es dans Amazon S3, en utilisant le machine learning et l'intelligence artificielle pour s'adapter aux mod√®les d'acc√®s aux donn√©es au fil du temps.
4. **Classification des Donn√©es avec NLP** : Utilise le traitement du langage naturel (NLP) pour classer et interpr√©ter diff√©rents types de donn√©es, en attribuant des scores de risque pour prioriser les r√©sultats.
5. **Surveillance de la S√©curit√©** : Identifie les donn√©es sensibles √† la s√©curit√©, y compris les cl√©s API, les cl√©s secr√®tes et les informations personnelles, aidant √† pr√©venir les fuites de donn√©es.

Amazon Macie est un **service r√©gional** et n√©cessite le r√¥le IAM 'AWSMacieServiceCustomerSetupRole' et un AWS CloudTrail activ√© pour fonctionner.

## Syst√®me d'Alerte

Macie cat√©gorise les alertes en cat√©gories pr√©d√©finies telles que :

- Acc√®s anonymis√©
- Conformit√© des donn√©es
- Perte de credentials
- Escalade de privil√®ges
- Ransomware
- Acc√®s suspect, etc.

Ces alertes fournissent des descriptions d√©taill√©es et des d√©compositions des r√©sultats pour une r√©ponse et une r√©solution efficaces.

## Fonctionnalit√©s du Tableau de Bord

Le tableau de bord cat√©gorise les donn√©es en diff√©rentes sections, y compris :

- Objets S3 (par plage de temps, ACL, PII)
- √âv√©nements/utilisateurs CloudTrail √† haut risque
- Lieux d'Activit√©
- Types d'identit√© d'utilisateur CloudTrail, et plus encore.

## Cat√©gorisation des Utilisateurs

Les utilisateurs sont class√©s en niveaux en fonction du niveau de risque de leurs appels API :

- **Platinum** : Appels API √† haut risque, souvent avec des privil√®ges d'admin.
- **Gold** : Appels API li√©s √† l'infrastructure.
- **Silver** : Appels API √† risque moyen.
- **Bronze** : Appels API √† faible risque.

## Types d'Identit√©

Les types d'identit√© comprennent Root, utilisateur IAM, R√¥le Assum√©, Utilisateur F√©d√©r√©, Compte AWS et Service AWS, indiquant la source des requ√™tes.

## Classification des Donn√©es

La classification des donn√©es comprend :

- Type de Contenu : Bas√© sur le type de contenu d√©tect√©.
- Extension de Fichier : Bas√© sur l'extension de fichier.
- Th√®me : Cat√©goris√© par mots-cl√©s dans les fichiers.
- Regex : Cat√©goris√© en fonction de motifs regex sp√©cifiques.

Le risque le plus √©lev√© parmi ces cat√©gories d√©termine le niveau de risque final du fichier.

## Recherche et Analyse

La fonction de recherche d'Amazon Macie permet des requ√™tes personnalis√©es sur toutes les donn√©es Macie pour une analyse approfondie. Les filtres comprennent les Donn√©es CloudTrail, les propri√©t√©s des Buckets S3 et les Objets S3. De plus, il prend en charge l'invitation d'autres comptes √† partager Amazon Macie, facilitant la gestion collaborative des donn√©es et la surveillance de la s√©curit√©.


## √ânum√©ration
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Exploitation

{% hint style="success" %}
Du point de vue d'un attaquant, ce service n'est pas con√ßu pour d√©tecter l'attaquant, mais pour d√©tecter les informations sensibles dans les fichiers stock√©s. Par cons√©quent, ce service pourrait **aider un attaquant √† trouver des infos sensibles** √† l'int√©rieur des seaux.\
Cependant, il se peut aussi qu'un attaquant soit int√©ress√© par la perturbation de ce service afin d'emp√™cher la victime de recevoir des alertes et de voler ces informations plus facilement.
{% endhint %}

TODO : Les PR sont les bienvenues !

# R√©f√©rences
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
