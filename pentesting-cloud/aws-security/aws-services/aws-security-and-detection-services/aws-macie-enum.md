# AWS - Macie Enum

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もし **HackTricks で会社を宣伝したい**場合や、**PEASS の最新バージョンを入手したい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式の PEASS & HackTricks スワッグ**](https://peass.creator-spring.com) を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) を見つけて、独占的な [**NFT**](https://opensea.io/collection/the-peass-family) のコレクションを発見しましょう
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) または [**telegram グループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) をフォローしましょう。
* 自分のハッキングテクニックを共有するために、[**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) の GitHub リポジトリに PR を提出することで、ハッキングトリックを共有しましょう。

</details>

## Macie

このサービスの主な機能は、AWS アカウント内に保存されているデータを**自動的に検出、識別、分類**することです。

このサービスは、**機械学習**によって支えられており、AWS アカウント内でさまざまなアクションが行われるたびにデータを積極的にレビューすることができます。機械学習は、クラウドトレイルイベントデータを分析してアクセスパターンや**ユーザーの行動**を検出し、**異常または不正なアクティビティに対してアラートを発信**することができます。Amazon Macie が行った発見は、ダッシュボード上に表示され、アラートをトリガーとして使用することで、データの漏洩や侵害の潜在的な脅威を迅速に解決することができます。

Amazon Macie は、自動的にかつ継続的に**Amazon S3 に保存されている新しいデータを監視および検出**します。機械学習と人工知能の能力を活用することで、このサービスは時間の経過とともにデータへのアクセスパターンを習得することができます。\
Amazon Macie はまた、自然言語処理の手法を使用して、さまざまなデータタイプとコンテンツを**分類および解釈**します。自然言語処理は、コンピュータサイエンスと計算言語学の原則を使用して、コンピュータと人間の言語との相互作用を調べます。特に、コンピュータに言語データを理解し解読させる方法についてのプログラムを作成する方法です。**このサービスは、リスクスコアの形で評価されるデータに自動的にビジネス価値を割り当てることができます**。これにより、Amazon Macie は優先順位に基づいて発見を順序付けることができ、最も重要なアラートに集中することができます。さらに、Amazon Macie は、データを管理するセキュリティ変更を**監視および検出**することもできます。また、S3 バケット内に保持されているアクセスキーなどのセキュリティに関連するデータを特定することもできます。

この保護的かつ積極的なセキュリティモニタリングにより、Amazon Macie は**API キー、シークレットキー、PII（個人を特定できる情報）および PHI データ**などの重要なセキュリティに関連するデータを特定することができます。

これにより、Macie は個人情報をインターネットに公開しているかどうかを検出し、データの漏洩を防ぐのに役立ちます。

これは**リージョナルサービス**です。

IAM ロール 'AWSMacieServiceCustomerSetupRole' の存在と、AWS CloudTrail の有効化が必要です。

事前定義されたアラートカテゴリ:

* 匿名化されたアクセス
* 設定の準拠
* 資格情報の喪失
* データの準拠
* ファイルのホスティング
* 識別情報の列挙
* 情報の喪失
* 場所の異常
* オープンな権限
* 特権の昇格
* ランサムウェア
* サービスの中断
* 不審なアクセス

**アラートの概要**には、適切な対応を行うための詳細な情報が提供されます。生成された理由についてより深い理解を提供する説明があります。また、結果の詳細な分析も含まれています。

ユーザーは新しいカスタムアラートを作成することも可能です。

**ダッシュボードの分類**:

* 選択した時間範囲の S3 オブジェクト
* S3 オブジェクト
* PII（個人を特定できる情報）による S3 オブジェクト
* ACL による S3 オブジェクト
* ハイリスクな CloudTrail イベントと関連するユーザー
* ハイリスクな CloudTrail エラーと関連するユーザー
* アクティビティの場所
* CloudTrail イベント
* アクティビティの ISP
* CloudTrail ユーザーの ID タイプ

**ユーザーカテゴリ**: Macie は以下のカテゴリにユーザーを分類します:

* **プラチナ**: 高リスクの API 呼び出しを行うと考えられるユーザーまたはロール。しばしば管理者特権を持っています。侵害された場合には注意して監視する必要があります
* **ゴールド**: インフラストラクチャの変更に関連する API を呼び出す履歴のあるユーザーまたはロール。これらも監視する必要があります
* **シルバー**: 中程度のリスクの API 呼び出しを行うユーザーまたはロール
* **ブロンズ**: API 呼び出しに基づいて最も低いリスクを持つユーザーまたはロール

**ID タイプ**:

* ルート: ルートユーザーによるリクエスト
* IAM ユーザー: IAM ユーザーによるリクエスト
* 仮定されたロール: 一時的な仮定された資格情報によるリクエスト（STS の AssumeRole API）
* フェデレーテッドユーザー: 一時的な資格情報を使用したリクエスト（STS の GetFederationToken API）
* AWS アカウント: 異なる AWS アカウントによるリクエスト
* AWS サービス: AWS サービスによるリクエスト

**データの分類**: 4 つのファイル分類が存在します:

* コンテンツタイプ: 検出されたコンテンツタイプに基づいてファイルをリストアップします。与えられたリスクは、検出されたコンテンツの種類によって決まります。
* ファイル拡張子: コンテンツタイプと同様ですが、拡張子に基づいて分類します
* テーマ: ファイル内で検出された一連のキーワードに基づいて分類します
* 正規表現: 特定の正規表現に基づいて分類します

ファイルの最終的なリスクは、これら4つのカテゴリの中で最も高いリスクとなります。

研究機能を使用すると、Amazon Macie のすべてのデータに対して独自のクエリを作成し、データの詳細な分析を実行することができます。クラウドトレイルデータ、S3 バケットのプロパテ
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### ポストエクスプロイテーション

{% hint style="success" %}
攻撃者の視点から見ると、このサービスは攻撃者を検出するためではなく、保存されたファイル内の機密情報を検出するために作られています。したがって、このサービスは攻撃者がバケット内の機密情報を見つけるのに役立つかもしれません。\
ただし、攻撃者はアラートを受け取ることを防ぎ、その情報をより簡単に盗むために、このサービスを妨害することにも興味を持つかもしれません。
{% endhint %}

TODO: PRは歓迎です！

<details>

<summary><strong>ハックトリックスをサポートして特典を得る！</strong></summary>

* もしもあなたの**会社をハックトリックスで宣伝したい**場合や、**最新版のPEASSやHackTricksのPDFをダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしましょう 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>
