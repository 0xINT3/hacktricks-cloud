# AWS - Macie Enum

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Macie

A principal fun√ß√£o do servi√ßo √© fornecer um m√©todo autom√°tico de **detectar, identificar e tamb√©m classificar dados** que voc√™ est√° armazenando dentro da sua conta AWS.

O servi√ßo √© suportado por **machine learning**, permitindo que seus dados sejam ativamente revisados √† medida que diferentes a√ß√µes s√£o realizadas dentro da sua conta AWS. O machine learning pode identificar padr√µes de acesso e **comportamento do usu√°rio** analisando dados de **eventos do CloudTrail** para **alertar contra qualquer atividade incomum ou irregular**. Quaisquer descobertas feitas pelo Amazon Macie s√£o apresentadas em um painel de controle que pode acionar alertas, permitindo que voc√™ resolva rapidamente qualquer amea√ßa potencial de exposi√ß√£o ou comprometimento dos seus dados.

O Amazon Macie monitorar√° automaticamente e continuamente **novos dados armazenados no Amazon S3**. Usando as capacidades de machine learning e intelig√™ncia artificial, este servi√ßo tem a habilidade de se familiarizar, ao longo do tempo, com padr√µes de acesso aos dados.\
O Amazon Macie tamb√©m utiliza m√©todos de processamento de linguagem natural para **classificar e interpretar diferentes tipos de dados e conte√∫dos**. O PLN utiliza princ√≠pios da ci√™ncia da computa√ß√£o e lingu√≠stica computacional para examinar as intera√ß√µes entre computadores e a linguagem humana. Em particular, como programar computadores para entender e decifrar dados de linguagem. O **servi√ßo pode atribuir automaticamente valores comerciais aos dados avaliados na forma de uma pontua√ß√£o de risco**. Isso permite que o Amazon Macie ordene as descobertas com base na prioridade, permitindo que voc√™ se concentre primeiro nos alertas mais cr√≠ticos. Al√©m disso, o Amazon Macie tamb√©m tem o benef√≠cio adicional de poder **monitorar e descobrir mudan√ßas de seguran√ßa que governam seus dados**. Assim como identificar dados espec√≠ficos centrados em seguran√ßa, como chaves de acesso armazenadas em um bucket S3.

Este monitoramento de seguran√ßa protetivo e proativo permite que o Amazon Macie **identifique dados cr√≠ticos, sens√≠veis e focados em seguran√ßa, como chaves de API, chaves secretas, al√©m de informa√ß√µes PII (informa√ß√µes pessoais identific√°veis) e dados PHI**.

Isso √© √∫til para evitar vazamentos de dados, pois o Macie detectar√° se voc√™ est√° expondo informa√ß√µes pessoais na Internet.

√â um **servi√ßo regional**.

Requer a exist√™ncia da fun√ß√£o IAM 'AWSMacieServiceCustomerSetupRole' e precisa que o AWS CloudTrail esteja habilitado.

Categorias de alertas pr√©-definidas:

* Acesso anonimizado
* Conformidade de configura√ß√£o
* Perda de credenciais
* Conformidade de dados
* Hospedagem de arquivos
* Enumera√ß√£o de identidade
* Perda de informa√ß√µes
* Anomalia de localiza√ß√£o
* Permiss√µes abertas
* Escalada de privil√©gios
* Ransomware
* Interrup√ß√£o de servi√ßo
* Acesso suspeito

O **resumo do alerta** fornece informa√ß√µes detalhadas para permitir que voc√™ responda adequadamente. Ele tem uma descri√ß√£o que fornece um n√≠vel mais profundo de compreens√£o do porqu√™ foi gerado. Tamb√©m tem uma decomposi√ß√£o dos resultados.

O usu√°rio tem a possibilidade de criar novos alertas personalizados.

**Categoriza√ß√£o do painel de controle**:

* Objetos S3 para o intervalo de tempo selecionado
* Objetos S3
* Objetos S3 por PII - Informa√ß√µes Pessoais Identific√°veis
* Objetos S3 por ACL
* Eventos do CloudTrail de alto risco e usu√°rios associados
* Erros do CloudTrail de alto risco e usu√°rios associados
* Localiza√ß√£o da Atividade
* Eventos do CloudTrail
* ISPs da Atividade
* Tipos de identidade do usu√°rio do CloudTrail

**Categorias de Usu√°rios**: Macie categoriza os usu√°rios nas seguintes categorias:

* **Platinum**: Usu√°rios ou fun√ß√µes considerados como realizando chamadas de API de alto risco. Frequentemente t√™m privil√©gios de administradores. Voc√™ deve monitor√°-los bem em caso de comprometimento
* **Gold**: Usu√°rios ou fun√ß√µes com hist√≥rico de chamadas de APIs relacionadas a mudan√ßas de infraestrutura. Voc√™ tamb√©m deve monitor√°-los
* **Silver**: Usu√°rios ou fun√ß√µes realizando chamadas de API de risco m√©dio
* **Bronze**: Usu√°rios ou fun√ß√µes usando o menor n√≠vel de risco com base em chamadas de API

**Tipos de Identidade**:

* Root: Solicita√ß√£o feita pelo usu√°rio root
* Usu√°rio IAM: Solicita√ß√£o feita por usu√°rio IAM
* Fun√ß√£o Assumida: Solicita√ß√£o feita por credenciais tempor√°rias assumidas (API AssumeRole para STS)
* Usu√°rio Federado: Solicita√ß√£o feita usando credenciais tempor√°rias (API GetFederationToken para STS)
* Conta AWS: Solicita√ß√£o feita por uma conta AWS diferente
* Servi√ßo AWS: Solicita√ß√£o feita por um servi√ßo AWS

**Classifica√ß√£o de dados**: Existem 4 classifica√ß√µes de arquivos:

* Content-Type: lista arquivos com base no tipo de conte√∫do detectado. O risco dado √© determinado pelo tipo de conte√∫do detectado.
* Extens√£o de Arquivo: O mesmo que content-type, mas com base na extens√£o
* Tema: Categoriza com base em uma s√©rie de palavras-chave detectadas nos arquivos
* Regex: Categorias com base em regex espec√≠ficos

O risco final de um arquivo ser√° o maior risco encontrado entre essas 4 categorias

A fun√ß√£o de pesquisa permite criar suas pr√≥prias consultas contra todos os dados do Amazon Macie e realizar uma an√°lise aprofundada dos dados. Voc√™ pode filtrar resultados com base em: Dados do CloudTrail, propriedades do Bucket S3 e Objetos S3

√â poss√≠vel convidar outras contas para o Amazon Macie, para que v√°rias contas compartilhem o Amazon Macie.

### Enumera√ß√£o
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### P√≥s-Explora√ß√£o

{% hint style="success" %}
Do ponto de vista de um atacante, este servi√ßo n√£o √© feito para detectar o atacante, mas para detectar informa√ß√µes sens√≠veis nos arquivos armazenados. Portanto, este servi√ßo pode **ajudar um atacante a encontrar informa√ß√µes sens√≠veis** dentro dos buckets.\
No entanto, talvez um atacante tamb√©m possa estar interessado em interromper o servi√ßo para evitar que a v√≠tima receba alertas e roubar essas informa√ß√µes mais facilmente.
{% endhint %}

TODO: PRs s√£o bem-vindos!

<details>

<summary><strong>Aprenda AWS hacking do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo do** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo do [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>
