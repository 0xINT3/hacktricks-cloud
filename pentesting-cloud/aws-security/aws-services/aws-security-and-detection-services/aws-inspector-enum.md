# AWS - Inspector 枚举

<details>

<summary><strong>从零到英雄学习AWS黑客技术，通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>!</strong></summary>

支持HackTricks的其他方式：

* 如果你想在 **HackTricks中看到你的公司广告** 或 **下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享你的黑客技巧。

</details>

## Inspector

Amazon Inspector服务是**基于代理的**，这意味着它需要在任何你想评估的EC2实例上**安装软件代理**。这使得它成为一个易于配置并随时添加到AWS基础设施中已经运行的现有资源的服务。这有助于Amazon Inspector成为你现有安全流程和程序的无缝集成的另一个安全层。

这些是AWS Inspector允许你执行的测试：

* **CVEs**
* **CIS基准**
* **安全最佳实践**
* **网络可达性**

你可以在任何你决定的EC2机器上运行这些测试。

### AWS Inspector的元素

**角色**：创建或选择一个角色，以允许Amazon Inspector对EC2实例拥有只读访问权限（DescribeInstances）\
**评估目标**：你想对其进行评估的EC2实例组\
**AWS代理**：必须安装在EC2实例上以进行监控的软件代理。数据通过TLS通道发送到Amazon Inspector。代理定期向检查器发送心跳，请求指令。它可以自动更新\
**评估模板**：定义如何在EC2实例上运行评估的具体配置。评估模板创建后无法修改。

* 要使用的规则包
* 评估运行的持续时间 15分钟/1小时/8小时
* SNS主题，选择何时通知：开始，完成，状态变化，报告发现
* 要分配给发现的属性

**规则包**：包含在运行评估时针对EC2检查的一系列单独规则。每个规则还有一个严重性（高，中，低，信息性）。可能性包括：

* 常见漏洞和暴露（CVEs）
* 互联网安全中心（CIS）基准
* 安全最佳实践

一旦你配置了Amazon Inspector角色，安装了AWS代理，配置了目标和模板，你就可以运行它了。评估运行可以停止、恢复或删除。

Amazon Inspector有一组预定义的规则，分成包。每个评估模板定义了测试中要包含的规则包。实例根据包含在评估模板中的规则包进行评估。

{% hint style="info" %}
请注意，如今AWS已经允许你**自动创建**所有必要的**配置**，甚至自动**在EC2实例内安装代理。**
{% endhint %}

### **报告**

**遥测**：从实例收集的数据，详细说明在评估运行期间的配置、行为和进程。一旦收集，数据就通过TLS实时发送回Amazon Inspector，在那里它被存储并在S3上通过临时KMS密钥加密。Amazon Inspector然后访问S3 Bucket，将数据解密到内存中，并根据用于该评估的任何规则包分析它以生成发现。

**评估报告**：提供评估内容和评估结果的详细信息。

* **发现报告** 包含评估摘要、关于EC2和规则的信息以及发生的发现。
* **完整报告** 是发现报告 + 通过的规则列表。

## 枚举
```
# Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

# Get findings
aws inspector list-findings

# Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

# Rule packages
aws inspector list-rules-packages
```
## 后渗透

{% hint style="success" %}
从攻击者的角度来看，这项服务可以帮助攻击者发现漏洞和网络暴露点，这些可能帮助他们攻破其他实例/容器。

然而，攻击者也可能对破坏这项服务感兴趣，以便受害者无法看到漏洞（全部或特定的）。
{% endhint %}

TODO: 欢迎提交PR

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>从零到英雄学习AWS黑客攻击！</strong></summary>

其他支持HackTricks的方式：

* 如果你想在**HackTricks**中看到你的**公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库**提交PR来分享你的黑客技巧**。

</details>
