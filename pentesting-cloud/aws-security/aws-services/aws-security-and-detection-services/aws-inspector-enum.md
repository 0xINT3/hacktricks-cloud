# AWS - Inspector Enum

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop).
* Obtén el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com).
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family).
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>

## Inspector

El servicio Amazon Inspector es **basado en agentes**, lo que significa que requiere que se **instalen agentes de software en las instancias EC2** que deseas evaluar. Esto hace que sea un servicio fácil de configurar y agregar en cualquier momento a los recursos existentes que ya se ejecutan dentro de tu infraestructura de AWS. Esto ayuda a que Amazon Inspector se integre sin problemas con cualquiera de tus procesos y procedimientos de seguridad existentes como otro nivel de seguridad.

Estas son las pruebas que AWS Inspector te permite realizar:

* **CVEs**
* **CIS Benchmarks**
* **Mejores prácticas de seguridad**
* **Alcance de la red**

Puedes ejecutar cualquiera de estas pruebas en las máquinas EC2 que elijas.

### Elemento de AWS Inspector

**Rol**: Crea o selecciona un rol para permitir que Amazon Inspector tenga acceso de solo lectura a las instancias EC2 (DescribeInstances)\
**Objetivos de evaluación**: Grupo de instancias EC2 en las que deseas ejecutar una evaluación\
**Agentes de AWS**: Agentes de software que deben instalarse en las instancias EC2 para monitorear. Los datos se envían a Amazon Inspector utilizando un canal TLS. El agente envía periódicamente un latido al inspector solicitando instrucciones. Puede actualizarse automáticamente\
**Plantillas de evaluación**: Define configuraciones específicas sobre cómo se ejecuta una evaluación en tus instancias EC2. Una plantilla de evaluación no se puede modificar después de su creación.

* Paquetes de reglas que se utilizarán
* Duración de la ejecución de la evaluación: 15 minutos / 1 hora / 8 horas
* Temas de SNS, selecciona cuándo notificar: inicio, finalización, cambio de estado, informe de un hallazgo
* Atributos asignados a los hallazgos

**Paquete de reglas**: Contiene una serie de reglas individuales que se verifican en una instancia EC2 cuando se ejecuta una evaluación. Cada una también tiene una gravedad (alta, media, baja, informativa). Las posibilidades son:

* Vulnerabilidades y exposiciones comunes (CVEs)
* Centro de seguridad de Internet (CIS) Benchmark
* Mejores prácticas de seguridad

Una vez que hayas configurado el Rol de Amazon Inspector, instalado los Agentes de AWS, configurado el objetivo y configurado la plantilla, podrás ejecutarlo. Una ejecución de evaluación se puede detener, reanudar o eliminar.

Amazon Inspector tiene un conjunto predefinido de reglas agrupadas en paquetes. Cada plantilla de evaluación define qué paquetes de reglas se incluirán en la prueba. Las instancias se evalúan en función de los paquetes de reglas incluidos en la plantilla de evaluación.

{% hint style="info" %}
Ten en cuenta que hoy en día AWS ya te permite **crear automáticamente** todas las **configuraciones** necesarias e incluso **instalar automáticamente los agentes dentro de las instancias EC2**.
{% endhint %}

### **Informes**

**Telemetría**: datos que se recopilan de una instancia, detallando su configuración, comportamiento y procesos durante una ejecución de evaluación. Una vez recopilados, los datos se envían a Amazon Inspector en tiempo casi real a través de TLS, donde se almacenan y cifran en S3 mediante una clave KMS efímera. Luego, Amazon Inspector accede al bucket de S3, descifra los datos en memoria y los analiza con respecto a los paquetes de reglas utilizados para esa evaluación para generar los hallazgos.

**Informe de evaluación**: Proporciona detalles sobre lo que se evaluó y los resultados de la evaluación.

* El informe de **hallazgos** contiene el resumen de la evaluación, información sobre la instancia EC2 y las reglas, y los hallazgos que ocurrieron.
* El **informe completo** es el informe de hallazgos + una lista de reglas que se aprobaron.

## Enumeración
```
# Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

# Get findings
aws inspector list-findings

# Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

# Rule packages
aws inspector list-rules-packages
```
### Post Explotación

{% hint style="success" %}
Desde la perspectiva de un atacante, este servicio puede ayudar al atacante a encontrar vulnerabilidades y exposiciones de red que podrían ayudarlo a comprometer otras instancias/contenedores.

Sin embargo, un atacante también podría estar interesado en interrumpir este servicio para que la víctima no pueda ver las vulnerabilidades (todas o específicas).
{% endhint %}

TODO: Se aceptan PRs

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop).
* Obtén el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com).
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family).
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>
