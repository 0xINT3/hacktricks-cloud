# AWS - Inspector Enum

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Inspector

El servicio Amazon Inspector es **basado en agentes**, lo que significa que requiere que se instalen agentes de software en cualquier instancia EC2 que desees evaluar. Esto hace que sea un servicio fácil de configurar y añadir en cualquier momento a los recursos existentes que ya están funcionando dentro de tu infraestructura de AWS. Esto ayuda a que Amazon Inspector se integre sin problemas con cualquiera de tus procesos y procedimientos de seguridad existentes como otro nivel de seguridad.

Estas son las pruebas que AWS Inspector te permite realizar:

* **CVEs**
* **CIS Benchmarks**
* **Mejores prácticas de seguridad**
* **Alcance de la red**

Puedes hacer que cualquiera de estas pruebas se ejecute en las máquinas EC2 que decidas.

### Elemento de AWS Inspector

**Rol**: Crea o selecciona un rol para permitir que Amazon Inspector tenga acceso de solo lectura a las instancias EC2 (DescribeInstances)\
**Objetivos de Evaluación**: Grupo de instancias EC2 contra las que deseas ejecutar una evaluación\
**Agentes de AWS**: Agentes de software que deben instalarse en las instancias EC2 para monitorear. Los datos se envían a Amazon Inspector mediante un canal TLS. Un latido regular se envía desde el agente al inspector pidiendo instrucciones. Puede actualizarse automáticamente\
**Plantillas de Evaluación**: Definen configuraciones específicas sobre cómo se ejecuta una evaluación en tus instancias EC2. Una plantilla de evaluación no se puede modificar después de su creación.

* Paquetes de reglas a utilizar
* Duración de la ejecución de la evaluación 15min/1hora/8horas
* Temas de SNS, selecciona cuándo notificar: Inicio, finalización, cambio de estado, informe de un hallazgo
* Atributos para asignar a los hallazgos

**Paquete de reglas**: Contiene una serie de reglas individuales que se verifican contra una EC2 cuando se ejecuta una evaluación. Cada una también tiene una severidad (alta, media, baja, informativa). Las posibilidades son:

* Vulnerabilidades Comunes y Exposiciones (CVEs)
* Benchmark del Centro para la Seguridad en Internet (CIS)
* Mejores prácticas de seguridad

Una vez que hayas configurado el Rol de Amazon Inspector, los Agentes de AWS estén instalados, el objetivo esté configurado y la plantilla esté configurada, podrás ejecutarla. Una ejecución de evaluación puede detenerse, reanudarse o eliminarse.

Amazon Inspector tiene un conjunto predefinido de reglas, agrupadas en paquetes. Cada Plantilla de Evaluación define qué paquetes de reglas se incluirán en la prueba. Las instancias se evalúan contra los paquetes de reglas incluidos en la plantilla de evaluación.

{% hint style="info" %}
Ten en cuenta que hoy en día AWS ya te permite **crear automáticamente** todas las **configuraciones** necesarias e incluso instalar automáticamente los agentes dentro de las instancias EC2.
{% endhint %}

### **Informes**

**Telemetría**: datos que se recopilan de una instancia, detallando su configuración, comportamiento y procesos durante una ejecución de evaluación. Una vez recopilados, los datos se envían de vuelta a Amazon Inspector en tiempo casi real a través de TLS, donde luego se almacenan y cifran en S3 mediante una clave KMS efímera. Amazon Inspector luego accede al Bucket de S3, descifra los datos en memoria y los analiza contra cualquier paquete de reglas utilizado para esa evaluación para generar los hallazgos.

**Informe de Evaluación**: Proporciona detalles sobre lo que se evaluó y los resultados de la evaluación.

* El **informe de hallazgos** contiene el resumen de la evaluación, información sobre la EC2 y las reglas y los hallazgos que ocurrieron.
* El **informe completo** es el informe de hallazgos + una lista de reglas que se pasaron.

## Enumeración
```
# Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

# Get findings
aws inspector list-findings

# Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

# Rule packages
aws inspector list-rules-packages
```
## Post Explotación

{% hint style="success" %}
Desde la perspectiva de un atacante, este servicio puede ayudar al atacante a encontrar vulnerabilidades y exposiciones de red que podrían ayudarle a comprometer otras instancias/contenedores.

Sin embargo, un atacante también podría estar interesado en interrumpir este servicio para que la víctima no pueda ver vulnerabilidades (todas o específicas).
{% endhint %}

TODO: Se aceptan PRs

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
