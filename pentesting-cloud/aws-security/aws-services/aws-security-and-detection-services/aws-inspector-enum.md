# AWS - Inspector枚举

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版的HackTricks，请查看[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## Inspector

Amazon Inspector服务是**基于代理**的，这意味着它需要在您想要评估的任何EC2实例上**安装软件代理**。这使得它成为一个易于配置和添加到已在您的AWS基础架构中运行的现有资源的服务。这有助于Amazon Inspector成为您现有安全流程和程序的无缝集成，作为另一层安全。

以下是AWS Inspector允许您执行的测试：

* **CVEs**
* **CIS基准**
* **安全最佳实践**
* **网络可达性**

您可以在您选择的EC2机器上运行其中任何一个。

### AWS Inspector的元素

**角色**：创建或选择一个角色，允许Amazon Inspector对EC2实例具有只读访问权限（DescribeInstances）\
**评估目标**：要对其进行评估的一组EC2实例\
**AWS代理**：必须在EC2实例上安装的软件代理，用于监视。数据通过TLS通道发送到Amazon Inspector。代理定期向检查员发送心跳请求指令。它可以自动更新自身\
**评估模板**：定义在EC2实例上运行评估的具体配置。创建评估模板后无法修改。

* 要使用的规则包
* 评估运行的持续时间15分钟/1小时/8小时
* SNS主题，选择何时通知：开始、完成、更改状态、报告发现
* 分配给发现的属性

**规则包**：包含一系列在运行评估时针对EC2进行检查的单个规则。每个规则还具有严重性（高、中、低、信息）。可能性包括：

* 通用漏洞和曝光（CVE）
* 互联网安全中心（CIS）基准
* 安全最佳实践

一旦配置了Amazon Inspector角色，安装了AWS代理，配置了目标并配置了模板，您就可以运行它。评估运行可以停止、恢复或删除。

Amazon Inspector有一组预定义的规则，分组到包中。每个评估模板定义了在测试中包含哪些规则包。实例正在根据评估模板中包含的规则包进行评估。

{% hint style="info" %}
请注意，现在AWS已经允许您**自动创建**所有必要的**配置**，甚至自动**在EC2实例内部安装代理**。
{% endhint %}

### **报告**

**遥测数据**：从实例收集的数据，详细说明了在评估运行期间的配置、行为和进程。收集完成后，数据通过TLS实时发送回Amazon Inspector，然后使用临时KMS密钥加密存储在S3上。然后，Amazon Inspector访问S3存储桶，在内存中解密数据，并根据用于该评估的任何规则包对其进行分析以生成发现。

**评估报告**：提供有关评估内容和评估结果的详细信息。

* **发现报告**包含评估的摘要，有关EC2和规则的信息以及发现的结果。
* **完整报告**是发现报告+通过的规则列表。

## 枚举
```
# Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

# Get findings
aws inspector list-findings

# Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

# Rule packages
aws inspector list-rules-packages
```
### 后渗透

{% hint style="success" %}
从攻击者的角度来看，这项服务可以帮助攻击者找到可能帮助他入侵其他实例/容器的漏洞和网络暴露。

然而，攻击者也可能对破坏这项服务感兴趣，以便受害者无法看到漏洞（全部或特定的漏洞）。
{% endhint %}

TODO：欢迎提交PR

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF格式的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>
