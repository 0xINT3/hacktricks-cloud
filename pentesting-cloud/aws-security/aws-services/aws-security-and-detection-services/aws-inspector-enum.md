# AWS - Enum√©ration d'Inspector

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## Inspector

Le service Amazon Inspector est **bas√© sur un agent**, ce qui signifie qu'il n√©cessite des agents logiciels √† **installer sur toutes les instances EC2** que vous souhaitez √©valuer. Cela en fait un service facile √† configurer et √† ajouter √† tout moment aux ressources existantes d√©j√† en cours d'ex√©cution dans votre infrastructure AWS. Cela permet √† Amazon Inspector de devenir une int√©gration transparente avec l'ensemble de vos processus de s√©curit√© existants et de vos proc√©dures en tant qu'autre niveau de s√©curit√©.

Voici les tests que AWS Inspector vous permet d'effectuer :

* **CVEs**
* **Benchmarks CIS**
* **Meilleures pratiques de s√©curit√©**
* **Accessibilit√© r√©seau**

Vous pouvez ex√©cuter n'importe lequel de ces tests sur les machines EC2 que vous d√©cidez.

### √âl√©ment d'AWS Inspector

**R√¥le** : Cr√©ez ou s√©lectionnez un r√¥le pour permettre √† Amazon Inspector d'avoir un acc√®s en lecture seule aux instances EC2 (DescribeInstances)\
**Cibles d'√©valuation** : Groupe d'instances EC2 sur lesquelles vous souhaitez ex√©cuter une √©valuation\
**Agents AWS** : Agents logiciels qui doivent √™tre install√©s sur les instances EC2 pour surveiller. Les donn√©es sont envoy√©es √† Amazon Inspector via un canal TLS. Un battement r√©gulier est envoy√© de l'agent √† l'inspecteur demandant des instructions. Il peut se mettre √† jour automatiquement\
**Mod√®les d'√©valuation** : D√©finissez des configurations sp√©cifiques pour ex√©cuter une √©valuation sur vos instances EC2. Un mod√®le d'√©valuation ne peut pas √™tre modifi√© apr√®s sa cr√©ation.

* Packages de r√®gles √† utiliser
* Dur√©e de l'ex√©cution de l'√©valuation 15min/1heure/8heures
* Sujets SNS, s√©lectionnez quand notifier : D√©but, fin, changement d'√©tat, signalement d'une d√©couverte
* Attributs √† attribuer aux d√©couvertes

**Package de r√®gles** : Contient un certain nombre de r√®gles individuelles qui sont v√©rifi√©es contre une EC2 lorsqu'une √©valuation est ex√©cut√©e. Chacune a √©galement une gravit√© (√©lev√©e, moyenne, faible, informationnelle). Les possibilit√©s sont :

* Vuln√©rabilit√©s et Expositions Courantes (CVEs)
* Benchmark du Center for Internet Security (CIS)
* Meilleures pratiques de s√©curit√©

Une fois que vous avez configur√© le r√¥le Amazon Inspector, install√© les agents AWS, configur√© la cible et configur√© le mod√®le, vous pourrez l'ex√©cuter. Une √©valuation peut √™tre arr√™t√©e, reprise ou supprim√©e.

Amazon Inspector a un ensemble pr√©d√©fini de r√®gles, regroup√©es en packages. Chaque mod√®le d'√©valuation d√©finit quels packages de r√®gles doivent √™tre inclus dans le test. Les instances sont √©valu√©es par rapport aux packages de r√®gles inclus dans le mod√®le d'√©valuation.

{% hint style="info" %}
Notez qu'aujourd'hui AWS vous permet d√©j√† de **cr√©er automatiquement** toutes les **configurations n√©cessaires** et m√™me d'**installer automatiquement les agents √† l'int√©rieur des instances EC2**.
{% endhint %}

### **Rapports**

**T√©l√©m√©trie** : donn√©es collect√©es √† partir d'une instance, d√©taillant sa configuration, son comportement et ses processus lors d'une ex√©cution d'√©valuation. Une fois collect√©es, les donn√©es sont ensuite renvoy√©es √† Amazon Inspector en quasi temps r√©el via TLS o√π elles sont ensuite stock√©es et chiffr√©es sur S3 via une cl√© KMS √©ph√©m√®re. Amazon Inspector acc√®de ensuite au compartiment S3, d√©chiffre les donn√©es en m√©moire et les analyse par rapport √† tout package de r√®gles utilis√© pour cette √©valuation afin de g√©n√©rer les d√©couvertes.

**Rapport d'√©valuation** : Fournit des d√©tails sur ce qui a √©t√© √©valu√© et les r√©sultats de l'√©valuation.

* Le rapport des **d√©couvertes** contient le r√©sum√© de l'√©valuation, des informations sur l'EC2 et les r√®gles et les d√©couvertes qui se sont produites.
* Le **rapport complet** est le rapport des d√©couvertes + une liste des r√®gles qui ont √©t√© valid√©es.

## √ânum√©ration
```
# Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

# Get findings
aws inspector list-findings

# Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

# Rule packages
aws inspector list-rules-packages
```
## Post Exploitation

{% hint style="success" %}
D'un point de vue de l'attaquant, ce service peut aider l'attaquant √† trouver des vuln√©rabilit√©s et des expositions r√©seau qui pourraient l'aider √† compromettre d'autres instances/containers.

Cependant, un attaquant pourrait √©galement √™tre int√©ress√© √† perturber ce service afin que la victime ne puisse pas voir les vuln√©rabilit√©s (toutes ou sp√©cifiques).
{% endhint %}

TODO: Les PR sont les bienvenues

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF** Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
