# AWS - Enum√©ration du Gestionnaire de Pare-feu

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert Red Team AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF** Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>

## Gestionnaire de Pare-feu

**AWS Firewall Manager** simplifie la gestion et la maintenance de **AWS WAF, AWS Shield Advanced, les groupes de s√©curit√© Amazon VPC et les listes de contr√¥le d'acc√®s r√©seau (ACL), et AWS Network Firewall, AWS Route 53 Resolver DNS Firewall et les pare-feu tiers** sur plusieurs comptes et ressources. Il vous permet de configurer vos r√®gles de pare-feu, les protections Shield Advanced, les groupes de s√©curit√© VPC et les param√®tres du pare-feu r√©seau une seule fois, le service **appliquant automatiquement ces r√®gles et protections sur l'ensemble de vos comptes et ressources**, y compris les nouveaux ajouts.

Le service offre la possibilit√© de **regrouper et prot√©ger des ressources sp√©cifiques ensemble**, comme celles partageant une balise commune ou toutes vos distributions CloudFront. Un avantage significatif de Firewall Manager est sa capacit√© √† **√©tendre automatiquement la protection aux nouvelles ressources ajout√©es** dans votre compte.

Un **groupe de r√®gles** (une collection de r√®gles WAF) peut √™tre incorpor√© dans une Politique AWS Firewall Manager, qui est ensuite li√©e √† des ressources AWS sp√©cifiques telles que les distributions CloudFront ou les √©quilibreurs de charge d'applications.

AWS Firewall Manager fournit des **listes d'applications et de protocoles g√©r√©es** pour simplifier la configuration et la gestion des politiques de groupe de s√©curit√©. Ces listes vous permettent de d√©finir les protocoles et applications autoris√©s ou refus√©s par vos politiques. Il existe deux types de listes g√©r√©es :

* **Listes g√©r√©es par Firewall Manager** : Ces listes incluent **FMS-Default-Public-Access-Apps-Allowed**, **FMS-Default-Protocols-Allowed** et **FMS-Default-Protocols-Allowed**. Elles sont g√©r√©es par Firewall Manager et incluent des applications et protocoles couramment utilis√©s qui devraient √™tre autoris√©s ou refus√©s au grand public. Il n'est pas possible de les √©diter ou de les supprimer, cependant, vous pouvez choisir leur version.
* **Listes g√©r√©es personnalis√©es** : Vous g√©rez ces listes vous-m√™me. Vous pouvez cr√©er des listes d'applications et de protocoles personnalis√©es adapt√©es aux besoins de votre organisation. Contrairement aux listes g√©r√©es par Firewall Manager, ces listes n'ont pas de versions, mais vous avez un contr√¥le total sur les listes personnalis√©es, vous permettant de les cr√©er, de les √©diter et de les supprimer selon vos besoins.

Il est important de noter que **les politiques de Firewall Manager ne permettent que des actions "Bloquer" ou "Compter"** pour un groupe de r√®gles, sans option "Autoriser".

### Pr√©requis

Les √©tapes pr√©alables suivantes doivent √™tre compl√©t√©es avant de proc√©der √† la configuration du Gestionnaire de Pare-feu pour commencer √† prot√©ger efficacement les ressources de votre organisation. Ces √©tapes fournissent la configuration de base requise pour que le Gestionnaire de Pare-feu applique les politiques de s√©curit√© et garantisse la conformit√© dans votre environnement AWS :

1. **Rejoindre et configurer les Organisations AWS** : Assurez-vous que votre compte AWS fait partie de l'organisation AWS Organizations o√π les politiques du Gestionnaire de Pare-feu AWS doivent √™tre implant√©es. Cela permet une gestion centralis√©e des ressources et des politiques sur plusieurs comptes AWS au sein de l'organisation.
2. **Cr√©er un Compte Administrateur par D√©faut du Gestionnaire de Pare-feu AWS** : √âtablissez un compte administrateur par d√©faut sp√©cifiquement pour la gestion des politiques de s√©curit√© du Gestionnaire de Pare-feu. Ce compte sera responsable de la configuration et de l'application des politiques de s√©curit√© dans toute l'organisation. Seul le compte de gestion de l'organisation est en mesure de cr√©er des comptes administrateurs par d√©faut du Gestionnaire de Pare-feu.
3. **Activer AWS Config** : Activez AWS Config pour fournir au Gestionnaire de Pare-feu les donn√©es de configuration et les informations n√©cessaires pour appliquer efficacement les politiques de s√©curit√©. AWS Config aide √† analyser, auditer, surveiller et auditer les configurations et les modifications des ressources, facilitant une meilleure gestion de la s√©curit√©.
4. **Pour les Politiques de Pare-feu Tiers, Abonnez-vous sur le AWS Marketplace et Configurez les Param√®tres des Tiers** : Si vous pr√©voyez d'utiliser des politiques de pare-feu tiers, abonnez-vous √† celles-ci sur le AWS Marketplace et configurez les param√®tres n√©cessaires. Cette √©tape garantit que le Gestionnaire de Pare-feu peut int√©grer et appliquer les politiques de fournisseurs tiers de confiance.
5. **Pour les Politiques de Pare-feu R√©seau et de Pare-feu DNS, activer le partage de ressources** : Activez le partage de ressources sp√©cifiquement pour les politiques de pare-feu r√©seau et de pare-feu DNS. Cela permet au Gestionnaire de Pare-feu d'appliquer des protections pare-feu aux VPC et √† la r√©solution DNS de votre organisation, renfor√ßant la s√©curit√© du r√©seau.
6. **Pour utiliser AWS Firewall Manager dans les r√©gions d√©sactiv√©es par d√©faut** : Si vous avez l'intention d'utiliser le Gestionnaire de Pare-feu dans des r√©gions AWS d√©sactiv√©es par d√©faut, assurez-vous de prendre les mesures n√©cessaires pour activer sa fonctionnalit√© dans ces r√©gions. Cela garantit une application coh√©rente de la s√©curit√© dans toutes les r√©gions o√π votre organisation op√®re.

Pour plus d'informations, consultez : [Commencer avec les politiques AWS WAF du Gestionnaire de Pare-feu AWS](https://docs.aws.amazon.com/waf/latest/developerguide/getting-started-fms.html).

### Types de politiques de protection

AWS Firewall Manager g√®re plusieurs types de politiques pour appliquer des contr√¥les de s√©curit√© sur diff√©rents aspects de l'infrastructure de votre organisation :

1. **Politique AWS WAF** : Ce type de politique prend en charge √† la fois AWS WAF et AWS WAF Classic. Vous pouvez d√©finir quelles ressources sont prot√©g√©es par la politique. Pour les politiques AWS WAF, vous pouvez sp√©cifier des ensembles de groupes de r√®gles √† ex√©cuter en premier et en dernier dans le web ACL. De plus, les propri√©taires de compte peuvent ajouter des r√®gles et des groupes de r√®gles √† ex√©cuter entre ces ensembles.
2. **Politique Shield Advanced** : Cette politique applique les protections Shield Advanced √† travers votre organisation pour des types de ressources sp√©cifi√©s. Elle aide √† se prot√©ger contre les attaques DDoS et autres menaces.
3. **Politique de Groupe de S√©curit√© Amazon VPC** : Avec cette politique, vous pouvez g√©rer les groupes de s√©curit√© utilis√©s dans toute votre organisation, en imposant un ensemble de r√®gles de base dans votre environnement AWS pour contr√¥ler l'acc√®s r√©seau.
4. **Politique de Liste de Contr√¥le d'Acc√®s R√©seau (ACL) Amazon VPC** : Ce type de politique vous donne le contr√¥le sur les ACL r√©seau utilis√©es dans votre organisation, vous permettant d'imposer un ensemble de r√®gles ACL r√©seau de base dans votre environnement AWS.
5. **Politique de Pare-feu R√©seau** : Cette politique applique la protection du Pare-feu R√©seau AWS aux VPC de votre organisation, renfor√ßant la s√©curit√© du r√©seau en filtrant le trafic en fonction de r√®gles pr√©d√©finies.
6. **Politique de Pare-feu DNS Resolver Amazon Route 53** : Cette politique applique des protections de pare-feu DNS Resolver aux VPC de votre organisation, aidant √† bloquer les tentatives de r√©solution de domaine malveillantes et √† appliquer des politiques de s√©curit√© pour le trafic DNS.
7. **Politique de Pare-feu Tiers** : Ce type de politique applique des protections de pare-feu tiers, disponibles par abonnement via la console AWS Marketplace. Il vous permet d'int√©grer des mesures de s√©curit√© suppl√©mentaires de fournisseurs de confiance dans votre environnement AWS.
1. **Politique Palo Alto Networks Cloud NGFW** : Cette politique applique les protections et les r√®gles de Palo Alto Networks Cloud Next Generation Firewall (NGFW) aux VPC de votre organisation, offrant une pr√©vention avanc√©e des menaces et des contr√¥les de s√©curit√© au niveau des applications.
2. **Politique Fortigate Cloud Native Firewall (CNF) en tant que Service** : Cette politique applique les protections Fortigate Cloud Native Firewall (CNF) en tant que Service, offrant une pr√©vention des menaces de premier plan, un pare-feu d'application web (WAF) et une protection API adapt√©e aux infrastructures cloud.
### Comptes administrateurs

AWS Firewall Manager offre une flexibilit√© dans la gestion des ressources pare-feu au sein de votre organisation gr√¢ce √† sa port√©e administrative et √† deux types de comptes administrateurs.

**La port√©e administrative d√©finit les ressources qu'un administrateur de Firewall Manager peut g√©rer**. Apr√®s qu'un compte de gestion d'AWS Organizations ait int√©gr√© une organisation √† Firewall Manager, il peut cr√©er des administrateurs suppl√©mentaires avec diff√©rentes port√©es administratives. Ces port√©es peuvent inclure :

- Comptes ou unit√©s organisationnelles (UO) auxquels l'administrateur peut appliquer des politiques.
- R√©gions o√π l'administrateur peut effectuer des actions.
- Types de politiques de Firewall Manager que l'administrateur peut g√©rer.

La port√©e administrative peut √™tre soit **compl√®te soit restreinte**. Une port√©e compl√®te accorde √† l'administrateur l'acc√®s √† **tous les types de ressources sp√©cifi√©s, r√©gions et types de politiques**. En revanche, **une port√©e restreinte accorde des autorisations administratives √† seulement un sous-ensemble de ressources, r√©gions ou types de politiques**. Il est conseill√© d'accorder aux administrateurs uniquement les autorisations dont ils ont besoin pour remplir efficacement leurs r√¥les. Vous pouvez appliquer n'importe quelle combinaison de ces conditions de port√©e administrative √† un administrateur, garantissant ainsi le respect du principe du moindre privil√®ge.

Il existe deux types distincts de comptes administrateurs, chacun remplissant des r√¥les et responsabilit√©s sp√©cifiques :

- **Administrateur par d√©faut :**
- Le compte administrateur par d√©faut est cr√©√© par le compte de gestion de l'organisation AWS Organizations lors du processus d'int√©gration √† Firewall Manager.
- Ce compte a la capacit√© de g√©rer des pare-feu tiers et poss√®de une port√©e administrative compl√®te.
- Il sert de compte administrateur principal pour Firewall Manager, responsable de la configuration et de l'application des politiques de s√©curit√© dans toute l'organisation.
- Bien que l'administrateur par d√©faut ait un acc√®s complet √† tous les types de ressources et fonctionnalit√©s administratives, il fonctionne au m√™me niveau que les autres administrateurs si plusieurs administrateurs sont utilis√©s au sein de l'organisation.
- **Administrateurs de Firewall Manager :**
- Ces administrateurs peuvent g√©rer des ressources dans la port√©e d√©sign√©e par le compte de gestion de l'organisation AWS Organizations, tel que d√©fini par la configuration de la port√©e administrative.
- Les administrateurs de Firewall Manager sont cr√©√©s pour remplir des r√¥les sp√©cifiques au sein de l'organisation, permettant la d√©l√©gation des responsabilit√©s tout en maintenant les normes de s√©curit√© et de conformit√©.
- √Ä la cr√©ation, Firewall Manager v√©rifie aupr√®s d'AWS Organizations pour d√©terminer si le compte est d√©j√† un administrateur d√©l√©gu√©. Si ce n'est pas le cas, Firewall Manager appelle Organizations pour d√©signer le compte comme administrateur d√©l√©gu√© pour Firewall Manager.

La gestion de ces comptes administrateurs implique de les cr√©er au sein de Firewall Manager et de d√©finir leurs port√©es administratives selon les exigences de s√©curit√© de l'organisation et le principe du moindre privil√®ge. En attribuant des r√¥les administratifs appropri√©s, les organisations peuvent garantir une gestion efficace de la s√©curit√© tout en maintenant un contr√¥le granulaire sur l'acc√®s aux ressources sensibles.

Il est important de souligner que **un seul compte au sein d'une organisation peut servir de compte administrateur par d√©faut de Firewall Manager**, en respectant le principe de "**premier arriv√©, dernier parti**". Pour d√©signer un nouveau compte administrateur par d√©faut, une s√©rie d'√©tapes doit √™tre suivie :

- Tout d'abord, chaque compte administrateur de Firewall Manager doit r√©voquer son propre compte.
- Ensuite, l'administrateur par d√©faut existant peut r√©voquer son propre compte, ce qui permet de retirer efficacement l'organisation de Firewall Manager. Ce processus entra√Æne la suppression de toutes les politiques de Firewall Manager cr√©√©es par le compte r√©voqu√©.
- Enfin, le compte de gestion d'AWS Organizations doit d√©signer le compte administrateur par d√©faut de Firewall Manager.

## √ânum√©ration
```
# Users/Administrators

## Get the AWS Organizations account that is associated with AWS Firewall Manager as the AWS Firewall Manager default administrator
aws fms get-admin-account

## List of Firewall Manager administrators within the organization
aws fms list-admin-accounts-for-organization # ReadOnlyAccess policy is not enough for this

## Return a list of the member accounts in the FM administrator's AWS organization
aws fms list-member-accounts # Only a Firewall Manager administrator or the Organization's management account can make this request

## List the accounts that are managing the specified AWS Organizations member account
aws fms list-admins-managing-account # ReadOnlyAccess policy is not enough for this

# Resources

## Get the resources that a Firewall Manager administrator can manage
aws fms get-admin-scope --admin-account <value> # ReadOnlyAccess policy is not enough for this

## Returns the summary of the resource sets used
aws fms list-resource-sets # ReadOnlyAccess policy is not enough for this

## Get information about a specific resource set
aws fms get-resource-set --identifier <value>  # ReadOnlyAccess policy is not enough for this

## Retrieve the list of tags for a given resource
aws fms list-tags-for-resource --resource-arn <value>

## List of the resources in the AWS Organization's accounts that are available to be associated with a FM resource set. Only one account is supported per request.
aws fms list-compliance-status --member-account-ids <value> --resource-type <value> # ReadOnlyAccess policy is not enough for this

## List the resources that are currently associated to a resource set
aws fms list-resource-set-resources --identifier <value> # ReadOnlyAccess policy is not enough for this

# Policies

## Returns the list of policies
aws fms list-policies

## Get information about the specified AWS Firewall Manager policy
aws fms get-policy --policy-id <value>

## List all of the third-party firewall policies that are associated with the third-party firewall administrator's account
aws fms list-third-party-firewall-firewall-policies --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

# AppsList

## Return a list of apps list
aws fms list-apps-lists --max-results [1-100]

## Get information about the specified AWS Firewall Manager applications list
aws fms get-apps-list --list-id <value>

# Protocols

## Get the details of the Firewall Manager protocols list.
aws fms list-protocols-lists

## Get information about the specified AWS Firewall Manager Protocols list
aws fms get-protocols-list --list-id <value>

# Compliance

## Return a summary of which member accounts are protected by the specified policy
aws fms list-compliance-status --policy-id <policy-id>

## Get detailed compliance information about the specified member account (resources that are in and out of compliance with the specified policy)
aws fms get-compliance-detail --policy-id <value> --member-account <value>

# Other useful info

## Get information about the SNS topic that is used to record AWS Firewall Manager SNS logs (if any)
aws fms get-notification-channel

## Get policy-level attack summary information in the event of a potential DDoS attack
aws fms get-protection-status --policy-id <value> # Just for Shield Advanced policy

## Get the onboarding status of a Firewall Manager admin account to third-party firewall vendor tenant.
aws fms get-third-party-firewall-association-status --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

## Get violations' details for a resource based on the specified AWS Firewall Manager policy and AWS account.
aws fms get-violation-details --policy-id <value> --member-account <value> --resource-id <value> --resource-type <value>
```
## Post Exploitation / Contourner la D√©tection

### `organizations:DescribeOrganization` & (`fms:AssociateAdminAccount`, `fms:DisassociateAdminAccount`, `fms:PutAdminAccount`)
Un attaquant avec l'autorisation **`fms:AssociateAdminAccount`** serait capable de d√©finir le compte administrateur par d√©faut de Firewall Manager. Avec l'autorisation **`fms:PutAdminAccount`**, un attaquant serait capable de cr√©er ou mettre √† jour un compte administrateur de Firewall Manager et avec l'autorisation **`fms:DisassociateAdminAccount`**, un attaquant potentiel pourrait supprimer l'association du compte administrateur actuel de Firewall Manager.

- La dissociation du **compte administrateur par d√©faut de Firewall Manager suit la politique du premier entr√©, dernier sorti**. Tous les administrateurs de Firewall Manager doivent se dissocier avant que le compte administrateur par d√©faut de Firewall Manager puisse dissocier le compte.
- Pour cr√©er un administrateur de Firewall Manager avec **PutAdminAccount**, le compte doit appartenir √† l'organisation qui a √©t√© pr√©c√©demment int√©gr√©e √† Firewall Manager en utilisant **AssociateAdminAccount**.
- La cr√©ation d'un compte administrateur de Firewall Manager ne peut √™tre effectu√©e que par le compte de gestion de l'organisation.
```bash
aws fms associate-admin-account --admin-account <value>
aws fms disassociate-admin-account
aws fms put-admin-account --admin-account <value>
```
**Impact potentiel :** Perte de gestion centralis√©e, √©vitement des politiques, violations de la conformit√© et perturbation des contr√¥les de s√©curit√© dans l'environnement.

### `fms:PutPolicy`, `fms:DeletePolicy`

Un attaquant avec les permissions **`fms:PutPolicy`**, **`fms:DeletePolicy`** serait capable de cr√©er, modifier ou supprimer d√©finitivement une politique AWS Firewall Manager.
```bash
aws fms put-policy --policy <value> | --cli-input-json file://<policy.json> [--tag-list <value>]
aws fms delete-policy --policy-id <value> [--delete-all-policy-resources | --no-delete-all-policy-resources]
```
Un exemple de politique permissive √† travers un groupe de s√©curit√© permissif, afin de contourner la d√©tection, pourrait √™tre le suivant :
```json
{
"Policy": {
"PolicyName": "permisive_policy",
"SecurityServicePolicyData": {
"Type": "SECURITY_GROUPS_COMMON",
"ManagedServiceData": "{\"type\":\"SECURITY_GROUPS_COMMON\",\"securityGroups\":[{\"id\":\"<permisive_security_group_id>\"}], \"applyToAllEC2InstanceENIs\":\"true\",\"IncludeSharedVPC\":\"true\"}"
},
"ResourceTypeList": ["AWS::EC2::Instance", "AWS::EC2::NetworkInterface", "AWS::EC2::SecurityGroup", "AWS::ElasticLoadBalancingV2::LoadBalancer", "AWS::ElasticLoadBalancing::LoadBalancer"],
"ResourceType": "AWS::EC2::SecurityGroup",
"ExcludeResourceTags": false,
"ResourceTags": [],
"RemediationEnabled": true
},
"TagList": []
}
```
**Impact potentiel :** D√©mant√®lement des contr√¥les de s√©curit√©, √©vitement des politiques, violations de la conformit√©, perturbations op√©rationnelles et potentielles violations de donn√©es au sein de l'environnement.

### `fms:BatchAssociateResource`, `fms:BatchDisassociateResource`, `fms:PutResourceSet`, `fms:DeleteResourceSet`

Un attaquant avec les autorisations **`fms:BatchAssociateResource`** et **`fms:BatchDisassociateResource`** serait capable d'associer ou de dissocier des ressources d'un ensemble de ressources de Firewall Manager respectivement. De plus, les autorisations **`fms:PutResourceSet`** et **`fms:DeleteResourceSet`** permettraient √† un attaquant de cr√©er, modifier ou supprimer ces ensembles de ressources de AWS Firewall Manager.
```bash
# Associate/Disassociate resources from a resource set
aws fms batch-associate-resource --resource-set-identifier <value> --items <value>
aws fms batch-disassociate-resource --resource-set-identifier <value> --items <value>

# Create, modify or delete a resource set
aws fms put-resource-set --resource-set <value> [--tag-list <value>]
aws fms delete-resource-set --identifier <value>
```
**Impact potentiel :** L'ajout d'un nombre inutile d'√©l√©ments √† un ensemble de ressources augmentera le niveau de bruit dans le Service, entra√Ænant potentiellement un d√©ni de service (DoS). De plus, des modifications des ensembles de ressources pourraient entra√Æner une perturbation des ressources, une √©vitement des politiques, des violations de la conformit√© et une perturbation des contr√¥les de s√©curit√© dans l'environnement.

### `fms:PutAppsList`, `fms:DeleteAppsList`

Un attaquant ayant les autorisations **`fms:PutAppsList`** et **`fms:DeleteAppsList`** serait capable de cr√©er, modifier ou supprimer des listes d'applications √† partir du Gestionnaire de pare-feu AWS. Cela pourrait √™tre critique, car des applications non autoris√©es pourraient √™tre autoris√©es √† acc√©der au grand public, ou l'acc√®s √† des applications autoris√©es pourrait √™tre refus√©, entra√Ænant un DoS.
```bash
aws fms put-apps-list --apps-list <value> [--tag-list <value>]
aws fms delete-apps-list --list-id <value>
```
**Impact potentiel :** Cela pourrait entra√Æner des mauvaises configurations, des √©vasions de politique, des violations de conformit√© et des perturbations des contr√¥les de s√©curit√© dans l'environnement.

### `fms:PutProtocolsList`, `fms:DeleteProtocolsList`

Un attaquant avec les autorisations **`fms:PutProtocolsList`** et **`fms:DeleteProtocolsList`** serait capable de cr√©er, modifier ou supprimer des listes de protocoles √† partir du Gestionnaire de pare-feu AWS. De m√™me que pour les listes d'applications, cela pourrait √™tre critique car des protocoles non autoris√©s pourraient √™tre utilis√©s par le grand public, ou l'utilisation de protocoles autoris√©s pourrait √™tre refus√©e, provoquant un d√©ni de service (DoS).
```bash
aws fms put-protocols-list --apps-list <value> [--tag-list <value>]
aws fms delete-protocols-list --list-id <value>
```
**Impact potentiel :** Cela pourrait entra√Æner des mauvaises configurations, des √©vasions de politique, des violations de conformit√© et la perturbation des contr√¥les de s√©curit√© au sein de l'environnement.

### `fms:PutNotificationChannel`, `fms:DeleteNotificationChannel`

Un attaquant ayant les autorisations **`fms:PutNotificationChannel`** et **`fms:DeleteNotificationChannel`** serait capable de supprimer et de d√©signer le r√¥le IAM et le sujet Amazon Simple Notification Service (SNS) que Firewall Manager utilise pour enregistrer les journaux SNS.

Pour utiliser **`fms:PutNotificationChannel`** en dehors de la console, vous devez configurer la strat√©gie d'acc√®s du sujet SNS, permettant au **SnsRoleName** sp√©cifi√© de publier les journaux SNS. Si le **SnsRoleName** fourni est un r√¥le autre que le **`AWSServiceRoleForFMS`**, il n√©cessite une relation de confiance configur√©e pour permettre au principal de service Firewall Manager **fms.amazonaws.com** d'assumer ce r√¥le.

Pour plus d'informations sur la configuration d'une politique d'acc√®s SNS :

{% content-ref url="../aws-services/aws-sns-enum.md" %}
[aws-sns-enum.md](../aws-services/aws-sns-enum.md)
{% endcontent-ref %}
```bash
aws fms put-notification-channel --sns-topic-arn <value> --sns-role-name <value>
aws fms delete-notification-channel
```
**Impact potentiel :** Cela pourrait potentiellement entra√Æner des alertes de s√©curit√© manqu√©es, un temps de r√©ponse aux incidents retard√©, des violations de donn√©es potentielles et des perturbations op√©rationnelles au sein de l'environnement.

### `fms:AssociateThirdPartyFirewall`, `fms:DisssociateThirdPartyFirewall`
Un attaquant ayant les autorisations **`fms:AssociateThirdPartyFirewall`**, **`fms:DisssociateThirdPartyFirewall`** serait en mesure d'associer ou de dissocier des pare-feu tiers de leur gestion centralis√©e via AWS Firewall Manager.
{% hint style="warning" %}
Seul l'administrateur par d√©faut peut cr√©er et g√©rer des pare-feu tiers.
{% endhint %}
```bash
aws fms associate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
aws fms disassociate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
```
**Impact potentiel :** La dissociation entra√Ænerait une √©vitement de politique, des violations de conformit√© et une perturbation des contr√¥les de s√©curit√© au sein de l'environnement. L'association, quant √† elle, entra√Ænerait une perturbation de l'allocation des co√ªts et du budget.

### `fms:TagResource`, `fms:UntagResource`

Un attaquant pourrait ajouter, modifier ou supprimer des tags des ressources du Gestionnaire de pare-feu, perturbant l'allocation des co√ªts, le suivi des ressources et les politiques de contr√¥le d'acc√®s bas√©es sur les tags.
```bash
aws fms tag-resource --resource-arn <value> --tag-list <value>
aws fms untag-resource --resource-arn <value> --tag-keys <value>
```
**Impact potentiel** : Perturbation de l'allocation des co√ªts, du suivi des ressources et des politiques de contr√¥le d'acc√®s bas√©es sur les balises.

## R√©f√©rences

* [https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html](https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsfirewallmanager.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsfirewallmanager.html)
* [https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html](https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
