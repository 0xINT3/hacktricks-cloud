# AWS - Enumera√ß√£o de Configura√ß√£o

<details>

<summary><strong>Aprenda hacking na AWS de zero a her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## AWS Config

O AWS Config **captura altera√ß√µes de recursos**, ent√£o qualquer altera√ß√£o em um recurso suportado pelo Config pode ser registrada, o que **registra o que mudou juntamente com outros metadados √∫teis, tudo mantido em um arquivo conhecido como um item de configura√ß√£o**, um CI. Esse servi√ßo √© **espec√≠fico da regi√£o**.

Um item de configura√ß√£o ou **CI**, como √© conhecido, √© um componente chave do AWS Config. √â composto por um arquivo JSON que **mant√©m as informa√ß√µes de configura√ß√£o, informa√ß√µes de relacionamento e outros metadados como uma visualiza√ß√£o instant√¢nea de um recurso suportado**. Todas as informa√ß√µes que o AWS Config pode registrar para um recurso s√£o capturadas dentro do CI. Um CI √© criado **sempre que** um recurso suportado tem uma altera√ß√£o feita em sua configura√ß√£o de qualquer maneira. Al√©m de registrar os detalhes do recurso afetado, o AWS Config tamb√©m registrar√° CIs para quaisquer recursos diretamente relacionados para garantir que a altera√ß√£o n√£o afetou esses recursos tamb√©m.

* **Metadados**: Cont√©m detalhes sobre o pr√≥prio item de configura√ß√£o. Um ID de vers√£o e um ID de configura√ß√£o, que identifica unicamente o CI. Outras informa√ß√µes podem incluir um MD5Hash que permite comparar outros CIs j√° registrados contra o mesmo recurso.
* **Atributos**: Isso mant√©m informa√ß√µes de **atributos comuns em rela√ß√£o ao recurso real**. Dentro desta se√ß√£o, tamb√©m temos um ID de recurso √∫nico e quaisquer tags de chave valor associadas ao recurso. O tipo de recurso tamb√©m √© listado. Por exemplo, se este fosse um CI para uma inst√¢ncia EC2, os tipos de recursos listados poderiam ser a interface de rede ou o endere√ßo IP el√°stico para aquela inst√¢ncia EC2.
* **Relacionamentos**: Isso mant√©m informa√ß√µes para qualquer **relacionamento conectado que o recurso possa ter**. Portanto, nesta se√ß√£o, seria mostrada uma descri√ß√£o clara de qualquer relacionamento com outros recursos que este recurso tinha. Por exemplo, se o CI fosse para uma inst√¢ncia EC2, a se√ß√£o de relacionamento poderia mostrar a conex√£o com uma VPC juntamente com a sub-rede em que a inst√¢ncia EC2 reside.
* **Configura√ß√£o atual**: Isso exibir√° as mesmas informa√ß√µes que seriam geradas se voc√™ realizasse uma chamada de API de descri√ß√£o ou lista feita pelo AWS CLI. O AWS Config usa as mesmas chamadas de API para obter as mesmas informa√ß√µes.
* **Eventos relacionados**: Isso se refere ao AWS CloudTrail. Isso exibir√° o **ID do evento do AWS CloudTrail relacionado √† altera√ß√£o que acionou a cria√ß√£o deste CI**. Um novo CI √© feito para cada altera√ß√£o feita em um recurso. Como resultado, diferentes IDs de eventos do CloudTrail ser√£o criados.

**Hist√≥rico de Configura√ß√£o**: √â poss√≠vel obter o hist√≥rico de configura√ß√£o de recursos gra√ßas aos itens de configura√ß√£o. Um hist√≥rico de configura√ß√£o √© entregue a cada 6 horas e cont√©m todos os CIs para um tipo de recurso espec√≠fico.

**Streams de Configura√ß√£o**: Os itens de configura√ß√£o s√£o enviados para um T√≥pico SNS para permitir a an√°lise dos dados.

**Instant√¢neos de Configura√ß√£o**: Os itens de configura√ß√£o s√£o usados para criar um instant√¢neo em um determinado momento de todos os recursos suportados.

**O S3 √© usado para armazenar** os arquivos de Hist√≥rico de Configura√ß√£o e quaisquer Instant√¢neos de Configura√ß√£o de seus dados em um √∫nico bucket, que √© definido no gravador de configura√ß√£o. Se voc√™ tiver v√°rias contas da AWS, pode querer agregar seus arquivos de hist√≥rico de configura√ß√£o em um √∫nico bucket S3 para sua conta principal. No entanto, voc√™ precisar√° conceder acesso de grava√ß√£o para este princ√≠pio de servi√ßo, config.amazonaws.com, e suas contas secund√°rias com acesso de grava√ß√£o ao bucket S3 em sua conta principal.

### Funcionamento

* Ao fazer altera√ß√µes, por exemplo, em um grupo de seguran√ßa ou lista de controle de acesso de um bucket ‚Äî> dispara um Evento captado pelo AWS Config
* Armazena tudo em um bucket S3
* Dependendo da configura√ß√£o, assim que algo muda, pode acionar uma fun√ß√£o lambda OU agendar uma fun√ß√£o lambda para procurar periodicamente as configura√ß√µes do AWS Config
* Lambda retorna ao Config
* Se uma regra foi violada, o Config dispara um SNS

![](<../../../../.gitbook/assets/image (126).png>)

### Regras de Configura√ß√£o

As regras de configura√ß√£o s√£o uma √≥tima maneira de ajud√°-lo a **aplicar verifica√ß√µes de conformidade espec√≠ficas** **e controles em seus recursos**, e permite que voc√™ adote uma especifica√ß√£o de implanta√ß√£o ideal para cada um de seus tipos de recursos. Cada regra **√© essencialmente uma fun√ß√£o lambda** que, quando chamada, avalia o recurso e realiza alguma l√≥gica simples para determinar o resultado de conformidade com a regra. **Cada vez que uma altera√ß√£o √© feita** em um de seus recursos suportados, **o AWS Config verificar√° a conformidade em rela√ß√£o a quaisquer regras de configura√ß√£o que voc√™ tenha em vigor**.\
A AWS possui uma s√©rie de **regras predefinidas** que se enquadram no guarda-chuva de seguran√ßa e est√£o prontas para uso. Por exemplo, Rds-storage-encrypted. Isso verifica se a criptografia de armazenamento est√° ativada por suas inst√¢ncias de banco de dados RDS. Encrypted-volumes. Isso verifica se algum volume EBS que tenha um estado anexado est√° criptografado.

* **Regras gerenciadas pela AWS**: Conjunto de regras predefinidas que abrangem muitas melhores pr√°ticas, ent√£o sempre vale a pena navegar por essas regras primeiro antes de configurar as suas pr√≥prias, pois existe a chance de a regra j√° existir.
* **Regras personalizadas**: Voc√™ pode criar suas pr√≥prias regras para verificar configura√ß√µes personalizadas espec√≠ficas.

Limite de 50 regras de configura√ß√£o por regi√£o antes de precisar entrar em contato com a AWS para um aumento.\
Resultados n√£o conformes N√ÉO s√£o exclu√≠dos.

<details>

<summary><strong>Aprenda hacking na AWS de zero a her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
