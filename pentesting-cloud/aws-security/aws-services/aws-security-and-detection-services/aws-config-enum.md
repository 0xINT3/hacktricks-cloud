# AWS - Config 枚举

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>从零开始学习AWS黑客攻击！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>

## AWS Config

AWS Config **捕获资源变更**，因此Config支持的任何资源的变更都可以被记录下来，这将**记录变更内容以及其他有用的元数据，所有这些都保存在称为配置项的文件中**，即CI。\
此服务是**特定于区域的**。

配置项或称为**CI**，是AWS Config的关键组成部分。它由一个JSON文件组成，该文件**包含配置信息、关系信息和其他元数据，作为支持资源的时间点快照视图**。AWS Config可以为资源记录的所有信息都被捕获在CI中。每次对支持资源的配置进行任何更改时，都会创建一个CI。除了记录受影响资源的详细信息外，AWS Config还会记录任何直接相关资源的CI，以确保变更没有影响到这些资源。

* **元数据**：包含有关配置项本身的详细信息。一个版本ID和一个配置ID，唯一标识CI。其他信息可以包括一个MD5Hash，允许您将其他已记录的CI与同一资源进行比较。
* **属性**：这包含了与实际资源相关的常见**属性信息**。在这个部分中，我们还有一个唯一的资源ID，以及与资源关联的任何键值标签。资源类型也会列出。例如，如果这是一个EC2实例的CI，列出的资源类型可能是网络接口，或者是该EC2实例的弹性IP地址。
* **关系**：这包含了资源可能具有的任何连接**关系的信息**。因此，在这个部分中，它将显示该资源与其他资源的任何关系的清晰描述。例如，如果CI是针对EC2实例的，关系部分可能会显示与VPC的连接以及EC2实例所在的子网。
* **当前配置**：这将显示如果您执行AWS CLI的describe或list API调用时会生成的相同信息。AWS Config使用相同的API调用来获取相同的信息。
* **相关事件**：这与AWS CloudTrail相关。这将显示与触发创建此CI的变更相关的**AWS CloudTrail事件ID**。每次对资源进行变更时，都会创建一个新的CI。因此，将创建不同的CloudTrail事件ID。

**配置历史**：得益于配置项，可以获取资源的配置历史。配置历史每6小时交付一次，包含特定资源类型的所有CI。

**配置流**：配置项被发送到SNS主题以便分析数据。

**配置快照**：使用配置项创建所有支持资源的时间点快照。

**S3用于存储**配置历史文件和任何配置快照的数据，这些数据存储在配置记录器中定义的单个存储桶中。如果您有多个AWS账户，您可能希望将配置历史文件聚合到主账户的同一个S3存储桶中。但是，您需要为此服务原则config.amazonaws.com以及您的次级账户授予对主账户中S3存储桶的写入权限。

### 功能

* 当进行更改时，例如对安全组或存储桶访问控制列表 —> 触发AWS Config捕获的事件
* 所有内容存储在S3存储桶中
* 根据设置，一旦发生变更，可能会触发lambda函数，或者安排lambda函数定期查看AWS Config设置
* Lambda反馈给Config
* 如果规则被破坏，Config触发一个SNS

![](<../../../../.gitbook/assets/image (46).png>)

### Config 规则

Config规则是帮助您**强制执行特定合规性检查**和**跨资源控制**的绝佳方式，并允许您为每种资源类型采用理想的部署规范。每个规则**本质上是一个lambda函数**，在调用时评估资源并执行一些简单逻辑以确定与规则的合规性结果。**每次对您支持的资源进行更改时**，**AWS Config将检查与您设置的任何config规则的合规性**。\
AWS有许多**预定义的规则**，这些规则属于安全范畴，随时可用。例如，Rds-storage-encrypted。这检查您的RDS数据库实例是否激活了存储加密。Encrypted-volumes。这检查是否有附加状态的EBS卷已加密。

* **AWS管理规则**：一组预定义的规则，涵盖了许多最佳实践，因此在设置自己的规则之前，先浏览这些规则总是值得的，因为可能已经存在该规则。
* **自定义规则**：您可以创建自己的规则来检查特定的自定义配置。

每个区域的config规则限制为50个，如果需要增加，需要联系AWS。\
不合规的结果不会被删除。

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>从零开始学习AWS黑客攻击！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>
