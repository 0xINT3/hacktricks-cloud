# AWS - Enumeraci√≥n de Configuraci√≥n

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipo Rojo de HackTricks en AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## AWS Configuraci√≥n

AWS Config **captura cambios en recursos**, por lo que cualquier cambio en un recurso compatible con Config puede ser registrado, lo que **registrar√° qu√© cambi√≥ junto con otros metadatos √∫tiles, todo contenido en un archivo conocido como un elemento de configuraci√≥n**, un CI. Este servicio es **espec√≠fico de regi√≥n**.

Un elemento de configuraci√≥n o **CI** como se le conoce, es un componente clave de AWS Config. Est√° compuesto por un archivo JSON que **contiene la informaci√≥n de configuraci√≥n, informaci√≥n de relaci√≥n y otros metadatos como una vista instant√°nea en un punto espec√≠fico del tiempo de un recurso compatible**. Toda la informaci√≥n que AWS Config puede registrar para un recurso se captura dentro del CI. Se crea un CI **cada vez** que se realiza un cambio en la configuraci√≥n de un recurso compatible de alguna manera. Adem√°s de registrar los detalles del recurso afectado, AWS Config tambi√©n registrar√° CIs para cualquier recurso directamente relacionado para asegurarse de que el cambio no afect√≥ a esos recursos tambi√©n.

* **Metadatos**: Contiene detalles sobre el propio elemento de configuraci√≥n. Un ID de versi√≥n y un ID de configuraci√≥n, que identifica de forma √∫nica al CI. Otra informaci√≥n puede incluir un MD5Hash que te permite comparar otros CIs ya registrados contra el mismo recurso.
* **Atributos**: Esto contiene informaci√≥n de **atributos comunes contra el recurso real**. Dentro de esta secci√≥n, tambi√©n tenemos un ID de recurso √∫nico y cualquier etiqueta de clave-valor asociada al recurso. Tambi√©n se lista el tipo de recurso. Por ejemplo, si este fuera un CI para una instancia de EC2, los tipos de recursos listados podr√≠an ser la interfaz de red, o la direcci√≥n IP el√°stica para esa instancia de EC2.
* **Relaciones**: Esto contiene informaci√≥n para cualquier **relaci√≥n conectada que el recurso pueda tener**. Por lo tanto, en esta secci√≥n, se mostrar√≠a una descripci√≥n clara de cualquier relaci√≥n con otros recursos que tenga este recurso. Por ejemplo, si el CI fuera para una instancia de EC2, la secci√≥n de relaciones podr√≠a mostrar la conexi√≥n a un VPC junto con la subred en la que reside la instancia de EC2.
* **Configuraci√≥n actual**: Esto mostrar√° la misma informaci√≥n que se generar√≠a si realizaras una llamada API de descripci√≥n o lista hecha por la CLI de AWS. AWS Config utiliza las mismas llamadas API para obtener la misma informaci√≥n.
* **Eventos relacionados**: Esto se relaciona con AWS CloudTrail. Esto mostrar√° el **ID de evento de AWS CloudTrail que est√° relacionado con el cambio que desencaden√≥ la creaci√≥n de este CI**. Se crea un nuevo CI por cada cambio realizado en un recurso. Como resultado, se crear√°n diferentes IDs de eventos de CloudTrail.

**Historial de Configuraci√≥n**: Es posible obtener el historial de configuraci√≥n de recursos gracias a los elementos de configuraci√≥n. Se entrega un historial de configuraci√≥n cada 6 horas y contiene todos los CIs para un tipo de recurso en particular.

**Flujos de Configuraci√≥n**: Los elementos de configuraci√≥n se env√≠an a un Tema de SNS para habilitar el an√°lisis de los datos.

**Instant√°neas de Configuraci√≥n**: Los elementos de configuraci√≥n se utilizan para crear una instant√°nea en un momento espec√≠fico de todos los recursos compatibles.

**S3 se utiliza para almacenar** los archivos de Historial de Configuraci√≥n y cualquier instant√°nea de Configuraci√≥n de tus datos dentro de un √∫nico bucket, que se define dentro del grabador de Configuraci√≥n. Si tienes varias cuentas de AWS, es posible que desees agregar tus archivos de historial de configuraci√≥n de configuraci√≥n en el mismo bucket de S3 para tu cuenta principal. Sin embargo, deber√°s otorgar acceso de escritura para este principio de servicio, config.amazonaws.com, y tus cuentas secundarias con acceso de escritura al bucket de S3 en tu cuenta principal.

### Funcionamiento

* Cuando se realizan cambios, por ejemplo en el grupo de seguridad o en la lista de control de acceso al bucket ‚Äî> se dispara un Evento recogido por AWS Config
* Almacena todo en un bucket de S3
* Dependiendo de la configuraci√≥n, tan pronto como algo cambie, podr√≠a activar una funci√≥n lambda O programar una funci√≥n lambda para revisar peri√≥dicamente la configuraci√≥n de AWS Config
* Lambda devuelve a Config
* Si se ha incumplido una regla, Config activa un SNS

![](<../../../../.gitbook/assets/image (126).png>)

### Reglas de Configuraci√≥n

Las reglas de configuraci√≥n son una excelente manera de ayudarte a **aplicar controles y verificaciones de cumplimiento espec√≠ficos en todos tus recursos**, y te permite adoptar una especificaci√≥n de implementaci√≥n ideal para cada uno de tus tipos de recursos. Cada regla **es esencialmente una funci√≥n lambda** que, cuando se llama, eval√∫a el recurso y realiza alguna l√≥gica simple para determinar el resultado de cumplimiento con la regla. **Cada vez que se realiza un cambio** en uno de tus recursos compatibles, **AWS Config verificar√° el cumplimiento con cualquier regla de configuraci√≥n que tengas establecida**.\
AWS tiene una serie de **reglas predefinidas** que caen bajo el paraguas de seguridad y que est√°n listas para usar. Por ejemplo, Rds-storage-encrypted. Esto verifica si el cifrado de almacenamiento est√° activado por tus instancias de base de datos RDS. Encrypted-volumes. Esto verifica si hay vol√∫menes EBS que tienen un estado adjunto y est√°n cifrados.

* **Reglas administradas por AWS**: Conjunto de reglas predefinidas que cubren muchas mejores pr√°cticas, por lo que siempre vale la pena explorar estas reglas primero antes de configurar las tuyas, ya que existe la posibilidad de que la regla ya exista.
* **Reglas personalizadas**: Puedes crear tus propias reglas para verificar configuraciones personalizadas espec√≠ficas.

L√≠mite de 50 reglas de configuraci√≥n por regi√≥n antes de que necesites contactar a AWS para aumentar.\
Los resultados no conformes NO se eliminan.

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipo Rojo de HackTricks en AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
