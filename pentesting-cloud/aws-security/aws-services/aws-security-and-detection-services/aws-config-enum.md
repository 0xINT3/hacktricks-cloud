# AWS - Config Enum

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**PEASSの最新バージョンを見たい**場合、または**HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## AWS Config

AWS Configは、Configでサポートされるリソースの変更を**キャプチャ**し、変更内容と他の有用なメタデータを記録することができます。これらの情報は、**構成アイテム**として知られるファイル内に保持されます。\
このサービスは**リージョン固有**です。

構成アイテムまたは**CI**は、AWS Configの重要なコンポーネントです。これは、サポートされるリソースの**構成情報、関係情報、およびその他のメタデータを、ポイントインタイムのスナップショットビューとして保持するJSONファイル**で構成されています。AWS Configがリソースのために記録できるすべての情報は、CI内にキャプチャされます。CIは、サポートされるリソースの構成に変更が加えられるたびに作成されます。影響を受けるリソースの詳細だけでなく、変更がそれらのリソースにも影響を与えなかったことを確認するために、AWS Configは直接関連するリソースに対してもCIを記録します。

* **メタデータ**: 構成アイテム自体に関する詳細情報を含みます。CIを一意に識別するバージョンIDと構成IDが含まれます。他のCIと同じリソースに対してすでに記録されているCIと比較するためのMD5ハッシュなどの情報も含まれる場合があります。
* **属性**: 実際のリソースに対する一般的な**属性情報**を保持します。このセクションでは、リソースに関連付けられた一意のリソースIDやキーバリュータグなどが表示されます。リソースの種類もリストされます。たとえば、これがEC2インスタンスのCIの場合、リストされるリソースタイプは、そのEC2インスタンスのネットワークインターフェースやElastic IPアドレスなどです。
* **関係**: リソースが持つ**関連する関係**に関する情報を保持します。このセクションでは、このリソースに関連する他のリソースとの関係の明確な説明が表示されます。たとえば、CIがEC2インスタンスの場合、関係セクションには、EC2インスタンスが所属するVPCとサブネットへの接続が表示される場合があります。
* **現在の構成**: これは、AWS CLIで実行されるdescribeまたはlist API呼び出しと同じ情報が表示されます。AWS Configは、同じ情報を取得するために同じAPI呼び出しを使用します。
* **関連するイベント**: これはAWS CloudTrailに関連します。これにより、このCIの作成をトリガーした変更に関連する**AWS CloudTrailイベントID**が表示されます。リソースに対して行われる変更ごとに新しいCIが作成されますので、異なるCloudTrailイベントIDが作成されます。

**構成履歴**: 構成アイテムのおかげで、リソースの構成履歴を取得することができます。構成履歴は6時間ごとに提供され、特定のリソースタイプのすべてのCIを含みます。

**構成ストリーム**: 構成アイテムはSNSトピックに送信され、データの分析が可能になります。

**構成スナップショット**: 構成アイテムは、サポートされるすべてのリソースのポイントインタイムスナップショットを作成するために使用されます。

**S3は**構成履歴ファイルとデータの構成スナップショットを、構成レコーダーで定義された単一のバケットに保存するために使用されます。複数のAWSアカウントを持っている場合、プライマリアカウントのS3バケットに構成履歴ファイルを集約することができます。ただし、このサービスプリンシパル（config.amazonaws.com）とプライマリアカウントのS3バケットへの書き込みアクセス権限をセカンダリアカウントに付与する必要があります。

### 動作

* セキュリティグループやバケットのアクセス制御リストなどの変更を行うと、AWS Configによってイベントとして発火します。
* すべてをS3バケットに保存します。
* セットアップに応じて、変更があるたびにLambda関数をトリガーするか、定期的にAWS Configの設定を確認するためにLambda関数をスケジュールすることができます。
* LambdaがConfigにフィードバックします。
* ルールが破られた場合、ConfigはSNSを起動します。

![](<../../../../.gitbook/assets/image (46).png>)

### 構成ルール

構成ルールは、リソース全体で特定のコンプライアンスチェックと制御を**強制するのに役立つ**素晴らしい方法であり、各リソースタイプの理想的な展開仕様を採用することができます。各ルールは、リソースを評価し、ルールとのコンプライアンス結果を決定するためのいくつかのシンプルなロジックを実行する**基本的にはLambda関数**です。サポートされるリソースのいずれかに変更が加えられるたびに、AWS Configは設定されている構成ルールに対するコンプライアンスをチェックします。\
AWSには、セキュリティの範囲に含まれるいくつかの**事前定義済みルール**があり、すぐに使用できます。たとえば、Rds-storage-encryptedは、RDSデータベースインスタンスでストレージの暗号化が有効になって
