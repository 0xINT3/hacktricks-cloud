# AWS - Config Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

## AWS Config

AWS Configは**リソースの変更をキャプチャ**します。Configがサポートするリソースの変更は記録され、**何が変更されたかとその他の有用なメタデータを含むファイル、CI（コンフィギュレーションアイテム）に記録されます**。このサービスは**リージョン固有**です。

コンフィギュレーションアイテム、または**CI**はAWS Configの重要なコンポーネントです。これは、サポートされるリソースの時点でのスナップショットビューとしての**構成情報、関連情報、その他のメタデータを含むJSONファイル**で構成されています。AWS Configがリソースに対して記録できるすべての情報はCI内にキャプチャされます。サポートされるリソースに対して構成が変更される**毎回**CIが作成されます。影響を受けたリソースの詳細を記録するだけでなく、その変更が他のリソースに影響を与えなかったことを確認するために、直接関連するリソースのCIも記録されます。

* **メタデータ**: コンフィギュレーションアイテム自体に関する詳細が含まれています。バージョンIDとCIを一意に識別するコンフィギュレーションIDがあります。他の情報には、同じリソースに対して既に記録されている他のCIと比較するためのMD5Hashが含まれることがあります。
* **属性**: 実際のリソースに対する共通の**属性情報**を保持します。このセクションには、ユニークなリソースIDとリソースに関連付けられている任意のキーバリュータグも含まれています。リソースタイプもリストされています。例えば、これがEC2インスタンスのCIであれば、リストされるリソースタイプには、そのEC2インスタンスのネットワークインターフェースやエラスティックIPアドレスが含まれるかもしれません。
* **関係**: リソースが持つ可能性のある**関連する関係**に関する情報を保持します。したがって、このセクションには、このリソースが持っていた他のリソースとの関係の明確な説明が表示されます。例えば、CIがEC2インスタンスの場合、関係セクションには、EC2インスタンスが存在するVPCとサブネットへの接続が表示されるかもしれません。
* **現在の構成:** AWS CLIによって実行されるdescribeまたはlist APIコールが生成するのと同じ情報を表示します。AWS Configは同じAPIコールを使用して同じ情報を取得します。
* **関連イベント**: AWS CloudTrailに関連します。これは、このCIの作成をトリガーした変更に関連する**AWS CloudTrailイベントID**を表示します。リソースに対して行われた変更ごとに新しいCIが作成されるため、異なるCloudTrailイベントIDが作成されます。

**構成履歴**: コンフィギュレーションアイテムのおかげで、リソースの構成履歴を取得することが可能です。構成履歴は6時間ごとに配信され、特定のリソースタイプのすべてのCIが含まれます。

**構成ストリーム**: コンフィギュレーションアイテムは、データの分析を可能にするためにSNSトピックに送信されます。

**構成スナップショット**: コンフィギュレーションアイテムは、サポートされるすべてのリソースの時点でのスナップショットを作成するために使用されます。

**S3は**、単一のバケット内の構成履歴ファイルと任意の構成スナップショットのデータを格納するために使用されます。これは、構成レコーダー内で定義されています。複数のAWSアカウントを持っている場合は、プライマリアカウントの同じS3バケットに構成履歴ファイルを集約することが望ましいかもしれません。ただし、このサービスプリンシパル、config.amazonaws.com、およびセカンダリアカウントにプライマリアカウントのS3バケットへの書き込みアクセスを許可する必要があります。

### 機能

* 変更を加えるとき、例えばセキュリティグループやバケットアクセスコントロールリストに —> AWS Configによって検出されるイベントとして発火します
* すべてをS3バケットに保存します
* 設定によっては、何かが変更されるとすぐにLambda関数をトリガーするか、またはLambda関数を定期的にスケジュールしてAWS Configの設定を定期的に確認することができます
* LambdaはConfigにフィードバックを送ります
* ルールに違反した場合、ConfigはSNSを起動します

![](<../../../../.gitbook/assets/image (46).png>)

### Configルール

Configルールは、リソースに対して特定のコンプライアンスチェックとコントロールを**強制するのに役立つ素晴らしい方法**であり、リソースタイプごとに理想的なデプロイメント仕様を採用することができます。各ルールは**基本的にはLambda関数**であり、呼び出されたときにリソースを評価し、ルールとのコンプライアンス結果を決定するためのいくつかの単純なロジックを実行します。**変更が加えられるたびに**、**AWS Configは設置されているConfigルールに対するコンプライアンスをチェックします**。\
AWSには、使用する準備ができているセキュリティの範疇にある**事前定義されたルール**がいくつかあります。例えば、Rds-storage-encrypted。これは、RDSデータベースインスタンスによってストレージ暗号化がアクティブ化されているかどうかをチェックします。Encrypted-volumes。これは、アタッチされた状態のEBSボリュームが暗号化されているかどうかをチェックします。

* **AWS管理ルール**: ベストプラクティスの多くをカバーする事前定義されたルールのセットですので、独自のルールを設定する前にこれらのルールを最初にブラウズする価値が常にあります。ルールが既に存在する可能性があります。
* **カスタムルール**: 特定のカスタム構成をチェックする独自のルールを作成できます。

リージョンごとに50のconfigルールの制限があります。増加を求めるにはAWSに連絡する必要があります。\
非準拠の結果は削除されません。

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>
