# AWS - Config Enum

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧**。

</details>

## AWS Config

AWS Config **捕获资源更改**，因此任何由 Config 支持的资源的更改都可以被记录下来，这将**记录更改的内容以及其他有用的元数据，全部保存在一个称为配置项（configuration item）的文件中**。配置项（CI）是 AWS Config 的一个关键组成部分。它由一个 JSON 文件组成，**以支持的资源的某个特定时间点的快照视图的形式，保存配置信息、关系信息和其他元数据**。AWS Config 可以记录资源的所有可记录信息都包含在配置项中。每当支持的资源的配置发生变化时，都会创建一个配置项。除了记录受影响资源的详细信息外，AWS Config 还会记录任何直接相关资源的配置项，以确保更改不会影响这些资源。

* **元数据**：包含有关配置项本身的详细信息。版本 ID 和配置 ID 是唯一标识配置项的信息。其他信息可能包括 MD5 哈希，允许您将其他已记录的配置项与同一资源进行比较。
* **属性**：这包含对实际资源的常见**属性信息**。在此部分中，还有一个唯一的资源 ID，以及与资源关联的任何键值标签。还列出了资源类型。例如，如果这是一个 EC2 实例的配置项，列出的资源类型可能是该 EC2 实例的网络接口或弹性 IP 地址。
* **关系**：这包含资源可能具有的任何连接**关系的信息**。因此，在此部分中，它将显示该资源与其他资源的任何关系的清晰描述。例如，如果配置项是针对一个 EC2 实例的，关系部分可能显示与 VPC 的连接以及 EC2 实例所在的子网。
* **当前配置**：这将显示如果您通过 AWS CLI 执行描述或列表 API 调用时生成的相同信息。AWS Config 使用相同的 API 调用获取相同的信息。
* **相关事件**：这与 AWS CloudTrail 相关。它将显示与触发创建此配置项的更改相关的 AWS CloudTrail 事件 ID。针对每个资源的每个更改都会创建一个新的配置项。因此，将创建不同的 CloudTrail 事件 ID。

**配置历史**：通过配置项，可以获取资源的配置历史。配置历史每 6 小时提供一次，并包含特定资源类型的所有配置项。

**配置流**：配置项被发送到 SNS 主题以便进行数据分析。

**配置快照**：配置项用于创建所有支持的资源的某个特定时间点的快照。

**使用 S3 存储**配置历史文件和数据的任何配置快照，这些都在配置记录器中定义的单个存储桶中。如果您有多个 AWS 帐户，您可能希望将配置历史文件聚合到主帐户的同一 S3 存储桶中。但是，您需要授予此服务主体（config.amazonaws.com）和主帐户中具有对 S3 存储桶的写访问权限的辅助帐户的写访问权限。

### 工作原理

* 当进行更改时，例如对安全组或存储桶访问控制列表进行更改 —> 触发 AWS Config 捕获事件
* 将所有内容存储在 S3 存储桶中
* 根据设置，一旦发生更改，可能会触发一个 Lambda 函数，或者定期调度 Lambda 函数来查看 AWS Config 设置
* Lambda 反馈给 Config
* 如果违反了规则，Config 将触发一个 SNS

![](<../../../../.gitbook/assets/image (46).png>)

### 配置规则

配置规则是帮助您**强制执行特定的合规性检查和控制**的好方法，允许您为每种资源类型采用理想的部署规范。每个规则**本质上是一个 Lambda 函数**，当调用时，它评估资源并执行一些简单的逻辑以确定规则的合规性结果。**每当对您支持的资源进行更改时，AWS Config 将检查与您设置的任何配置规则的合规性**。\
AWS 提供了一些预定义的规则，这些规则属于安全范畴，可以直接使用。例如，Rds-storage-encrypted。它检查您的 RDS 数据库实例是否已激活存储加密。Encrypted-volumes。它检查是否对任何已附加状态的 EBS 卷进行了加密。

* **AWS 托管规则**：一组预定义规则，涵盖了许多最佳实践，因此在设置自己的规则之前，浏览这些规则是值得的，因为可能已经存在相同的规则。
* **自定义规则**：您可以创建自己的规则来检查特定的自定义配置。

每个区域最多支持 50 个配置规则，超过后需要联系 AWS 进行增加。\
不合规的结果不会被删除。

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧**。

</details>
