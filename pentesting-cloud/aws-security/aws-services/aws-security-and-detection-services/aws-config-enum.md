# AWS - Enumeración de Config

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos.
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## AWS Config

AWS Config **captura los cambios de recursos**, por lo que cualquier cambio en un recurso compatible con Config puede ser registrado, lo que **registrará lo que cambió junto con otros metadatos útiles, todo contenido en un archivo conocido como un elemento de configuración**, un CI.\
Este servicio es **específico de la región**.

Un elemento de configuración o **CI**, como se le conoce, es un componente clave de AWS Config. Está compuesto por un archivo JSON que **contiene la información de configuración, la información de relación y otros metadatos como una vista instantánea de un recurso compatible**. Toda la información que AWS Config puede registrar para un recurso se captura dentro del CI. Se crea un CI **cada vez que** se realiza un cambio en la configuración de un recurso compatible de cualquier manera. Además de registrar los detalles del recurso afectado, AWS Config también registrará CIs para cualquier recurso directamente relacionado para asegurarse de que el cambio no afectó a esos recursos también.

* **Metadatos**: Contiene detalles sobre el propio elemento de configuración. Un ID de versión y un ID de configuración, que identifica de manera única el CI. Otra información puede incluir un MD5Hash que le permite comparar otros CIs ya registrados contra el mismo recurso.
* **Atributos**: Esto contiene información común de **atributos contra el recurso real**. Dentro de esta sección, también tenemos un ID de recurso único y cualquier etiqueta de valor clave asociada al recurso. También se enumera el tipo de recurso. Por ejemplo, si este fuera un CI para una instancia de EC2, los tipos de recursos enumerados podrían ser la interfaz de red o la dirección IP elástica para esa instancia de EC2.
* **Relaciones**: Esto contiene información para cualquier **relación conectada que el recurso pueda tener**. Por lo tanto, dentro de esta sección, mostraría una descripción clara de cualquier relación con otros recursos que tenga este recurso. Por ejemplo, si el CI fuera para una instancia de EC2, la sección de relaciones podría mostrar la conexión a una VPC junto con la subred en la que reside la instancia de EC2.
* **Configuración actual**: Esto mostrará la misma información que se generaría si realizara una llamada API de descripción o lista realizada por AWS CLI. AWS Config utiliza las mismas llamadas API para obtener la misma información.
* **Eventos relacionados**: Esto se refiere a AWS CloudTrail. Esto mostrará el **ID de evento de AWS CloudTrail que está relacionado con el cambio que desencadenó la creación de este CI**. Se crea un nuevo CI por cada cambio realizado en un recurso. Como resultado, se crearán diferentes IDs de eventos de CloudTrail.

**Historial de configuración**: Es posible obtener el historial de configuración de los recursos gracias a los elementos de configuración. Se entrega un historial de configuración cada 6 horas y contiene todos los CIs para un tipo de recurso en particular.

**Flujos de configuración**: Los elementos de configuración se envían a un tema de SNS para permitir el análisis de los datos.

**Instantáneas de configuración**: Los elementos de configuración se utilizan para crear una instantánea en el tiempo de todos los recursos compatibles.

**S3 se utiliza para almacenar** los archivos de historial de configuración y cualquier instantánea de configuración de sus datos dentro de un solo bucket, que se define dentro del grabador de configuración. Si tiene varias cuentas de AWS, es posible que desee agregar los archivos de historial de configuración a la misma S3 bucket para su cuenta principal. Sin embargo, deberá otorgar acceso de escritura para este principio de servicio, config.amazonaws.com, y sus cuentas secundarias con acceso de escritura a la S3 bucket en su cuenta principal.

### Funcionamiento

* Cuando se realizan cambios, por ejemplo, en el grupo de seguridad o en la lista de control de acceso del bucket -> se activa como un evento recogido por AWS Config
* Almacena todo en el bucket S3
* Dependiendo de la configuración, tan pronto como algo cambie, podría activar una función lambda O programar una función lambda para buscar periódicamente en la configuración de AWS Config
* Lambda devuelve a Config
* Si se ha incumplido una regla, Config inicia un SNS

![](<../../../../.gitbook/assets/image (46).png>)

### Reglas de Config

Las reglas de Config son una excelente manera de ayudarlo a **aplicar controles y verificaciones de cumplimiento específicos en todos sus recursos**, y le permite adoptar una especificación de implementación ideal para cada uno de sus tipos de recursos. Cada regla **es esencialmente una función lambda** que, cuando se llama, evalúa el recurso y lleva a cabo alguna lógica simple para determinar el resultado de cumplimiento con la regla. **Cada vez que se realiza un cambio** en uno de sus recursos compatibles, **AWS Config verificará el cumplimiento con cualquier regla de configuración que tenga en su lugar**.\
AWS tiene una serie de **reglas predefinidas** que caen bajo el paraguas de seguridad que están listas para usar. Por ejemplo, Rds-storage-encrypted. Esto verifica si la encriptación de almacenamiento está activada por sus instancias de base de datos RDS. Encrypted-volumes. Esto verifica si algún volumen EBS que tenga un estado adjunto está encriptado.

* **Reglas administradas por AWS**: Conjunto de reglas predefinidas que cubren muchas mejores prácticas, por lo que siempre vale la pena buscar estas reglas primero antes de configurar las suyas propias, ya que existe la posibilidad de que la regla ya exista.
* **Reglas personalizadas**: Puede crear sus propias reglas para verificar configuraciones personalizadas específicas.

Límite de 50 reglas de configuración por región antes de que necesite contactar a AWS para obtener un aumento.\
Los resultados no conformes NO se eliminan.

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos.
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>