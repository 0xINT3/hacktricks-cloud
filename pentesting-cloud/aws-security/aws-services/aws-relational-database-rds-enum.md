# AWS - Relational Database (RDS) Enum

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repository di github.

</details>

## Informazioni di base

Il servizio **Relational Database Service (RDS)** offerto da AWS √® progettato per semplificare la distribuzione, l'operazione e la scalabilit√† di un **database relazionale nel cloud**. Questo servizio offre i vantaggi dell'efficienza dei costi e della scalabilit√†, automatizzando attivit√† laboriose come la fornitura di hardware, la configurazione del database, il patching e i backup.

AWS RDS supporta vari motori di database relazionali ampiamente utilizzati, tra cui MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server e Amazon Aurora, con compatibilit√† sia per MySQL che per PostgreSQL.

Le principali caratteristiche di RDS includono:

* La **gestione delle istanze del database** √® semplificata.
* Creazione di **repliche di lettura** per migliorare le prestazioni di lettura.
* Configurazione di **implementazioni multi-Availability Zone (AZ)** per garantire l'alta disponibilit√† e i meccanismi di failover.
* **Integrazione** con altri servizi AWS, come:
* AWS Identity and Access Management (**IAM**) per un robusto controllo degli accessi.
* AWS **CloudWatch** per il monitoraggio e le metriche completi.
* AWS Key Management Service (**KMS**) per garantire la crittografia a riposo.

## Credenziali

Durante la creazione del cluster del database, √® possibile configurare il **nome utente** principale (**`admin`** per impostazione predefinita). Per generare la password di questo utente √® possibile:

* **Indicare** una **password** personalizzata
* Dire a RDS di **generarla automaticamente**
* Dire a RDS di gestirla in **AWS Secret Manager** crittografata con una chiave KMS

<figure><img src="../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Autenticazione

Ci sono 3 tipi di opzioni di autenticazione, ma l'uso della **password principale √® sempre consentito**:

<figure><img src="../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Accesso pubblico e VPC

Per impostazione predefinita, **nessun accesso pubblico √® concesso** ai database, tuttavia **potrebbe essere concesso**. Pertanto, per impostazione predefinita, solo le macchine dalla stessa VPC saranno in grado di accedervi se il gruppo di sicurezza selezionato (archiviato in EC2 SG) lo consente.

Invece di esporre un'istanza del database, √® possibile creare un **RDS Proxy** che **migliora** la **scalabilit√†** e la **disponibilit√†** del cluster del database.

Inoltre, √® possibile modificare anche la **porta del database**.

### Crittografia

La **crittografia √® abilitata per impostazione predefinita** utilizzando una chiave gestita da AWS (√® possibile scegliere una CMK al suo posto).

Abilitando la crittografia, si abilita la **crittografia a riposo per la memorizzazione, gli snapshot, le repliche di lettura e i backup**. Le chiavi per gestire questa crittografia possono essere emesse utilizzando **KMS**.\
Non √® possibile aggiungere questo livello di crittografia dopo la creazione del database. **Deve essere fatto durante la sua creazione**.

Tuttavia, c'√® un **metodo alternativo che consente di crittografare un database non crittografato come segue**. √à possibile creare uno snapshot del database non crittografato, creare una copia crittografata di tale snapshot, utilizzare tale snapshot crittografato per creare un nuovo database e infine, il database sar√† crittografato.

#### Crittografia dei dati trasparente (TDE)

Oltre alle capacit√† di crittografia intrinseche a RDS a livello di applicazione, RDS supporta anche **meccanismi di crittografia a livello di piattaforma aggiuntivi** per proteggere i dati a riposo. Questo include la **Crittografia dei dati trasparente (TDE)** per Oracle e SQL Server. Tuttavia, √® fondamentale notare che mentre TDE migliora la sicurezza crittografando i dati a riposo, potrebbe anche **influenzare le prestazioni del database**. Questo impatto sulle prestazioni √® particolarmente evidente quando viene utilizzato in combinazione con le funzioni crittografiche di MySQL o le funzioni crittografiche di Microsoft Transact-SQL.

Per utilizzare TDE, sono necessari determinati passaggi preliminari:

1. **Associazione del gruppo di opzioni**:

* Il database deve essere associato a un gruppo di opzioni. I gruppi di opzioni fungono da contenitori per impostazioni e funzionalit√†, facilitando la gestione del database, inclusi i miglioramenti della sicurezza.
* Tuttavia, √® importante notare che i gruppi di opzioni sono disponibili solo per specifici motori di database e versioni.

2. **Inclusione di TDE nel gruppo di opzioni**:

* Una volta associato a un gruppo di opzioni, l'opzione di crittografia dei dati trasparente di Oracle deve essere inclusa in quel gruppo.
* √à essenziale riconoscere che una volta che l'opzione TDE viene aggiunta a un gruppo di opzioni, diventa una parte permanente e non pu√≤ essere rimossa.

3. **Modalit√† di crittografia TDE**:

* TDE offre due modalit√† di crittografia distinte:
* **Crittografia dello spazio tabella TDE**: questa modalit√† crittografa intere tabelle, fornendo un'ampia protezione dei dati.
* **Crittografia delle colonne TDE**: questa modalit√† si concentra sulla crittografia di elementi specifici e individuali all'interno del database, consentendo un controllo pi√π granulare su quali dati vengono crittografati.

Comprendere questi prerequisiti e le complessit√† operative di TDE √® fondamentale per implementare e gestire in modo efficace la crittografia all'interno di RDS, garantendo sia la sicurezza dei dati che la conformit√† agli standard necessari.

### Enumerazione

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Accesso non autenticato

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistenza

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Injection

Ci sono modi per accedere ai dati di DynamoDB con la sintassi SQL, quindi sono possibili anche le tipiche iniezioni SQL.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF**, controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
