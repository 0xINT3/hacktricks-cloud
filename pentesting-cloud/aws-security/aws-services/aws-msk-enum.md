# AWS - MSK Enum

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub**.

</details>

## Amazon MSK

**Amazon Managed Streaming for Apache Kafka (Amazon MSK)** - —Ü–µ –ø–æ—Å–ª—É–≥–∞, —è–∫–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é –∫–µ—Ä—É—î—Ç—å—Å—è, —Å–ø—Ä–∏—è—é—á–∏ —Ä–æ–∑—Ä–æ–±—Ü—ñ —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—é –¥–æ–¥–∞—Ç–∫—ñ–≤, —â–æ –æ–±—Ä–æ–±–ª—è—é—Ç—å –ø–æ—Ç–æ–∫–æ–≤—ñ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ **Apache Kafka**. –û–ø–µ—Ä–∞—Ü—ñ—ó —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–ª–æ—â–∞–¥–∫–æ—é, –≤–∫–ª—é—á–∞—é—á–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è **–∫–ª–∞—Å—Ç–µ—Ä—ñ–≤**, –ø—Ä–æ–ø–æ–Ω—É—é—Ç—å—Å—è Amazon MSK.
–ü–æ—Å–ª—É–≥–∞ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó **–ø–ª–æ—â–∞–¥–∫–∏ –æ–±—Ä–æ–±–∫–∏ –¥–∞–Ω–∏—Ö Apache Kafka**, –≤–∫–ª—é—á–∞—é—á–∏ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ —Ç–∞ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö. –í–æ–Ω–∞ –ø—Ä–∞—Ü—é—î –Ω–∞ **–≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö Apache Kafka**, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ –¥–æ–¥–∞—Ç–∫–∞–º–∏, —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ —Ç–∞ –ø–ª–∞–≥—ñ–Ω–∞–º–∏ —è–∫ –≤—ñ–¥ –ø–∞—Ä—Ç–Ω–µ—Ä—ñ–≤, —Ç–∞–∫ —ñ –≤—ñ–¥ **—Å–ø—ñ–ª—å–Ω–æ—Ç–∏ Apache Kafka**, —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –≤–Ω–µ—Å–µ–Ω–Ω—è –∑–º—ñ–Ω —É –∫–æ–¥ –¥–æ–¥–∞—Ç–∫–∞.

–ó —Ç–æ—á–∫–∏ –∑–æ—Ä—É –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ Amazon MSK –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥ –ø–æ—à–∏—Ä–µ–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –≤—ñ–¥–º–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞**, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏, —â–æ –¥–æ–¥–∞—Ç–∫–∏ –≤–∏—Ä–æ–±–Ω–∏–∫–∞ —Ç–∞ —Å–ø–æ–∂–∏–≤–∞—á–∞ –ø—Ä–æ–¥–æ–≤–∂—É—é—Ç—å —Å–≤–æ—é –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å –∑ –∑–∞–ø–∏—Å—É —Ç–∞ —á–∏—Ç–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º–∏ –ø–µ—Ä–µ—à–∫–æ–¥–∞–º–∏. –ö—Ä—ñ–º —Ç–æ–≥–æ, –≤—ñ–Ω —Å–ø—Ä—è–º–æ–≤–∞–Ω–∏–π –Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—é –ø—Ä–æ—Ü–µ—Å—ñ–≤ —Ä–µ–ø–ª—ñ–∫–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö, –Ω–∞–º–∞–≥–∞—é—á–∏—Å—å **–ø–µ—Ä–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å—Ö–æ–≤–∏—â–µ –∑–∞–º—ñ–Ω–µ–Ω–∏—Ö –±—Ä–æ–∫–µ—Ä—ñ–≤**, —Ç–∏–º —Å–∞–º–∏–º –º—ñ–Ω—ñ–º—ñ–∑—É—é—á–∏ –æ–±—Å—è–≥ –¥–∞–Ω–∏—Ö, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–µ–ø–ª—ñ–∫—É–≤–∞—Ç–∏ Apache Kafka.

### **–¢–∏–ø–∏**

–Ü—Å–Ω—É—é—Ç—å 2 —Ç–∏–ø–∏ –∫–ª–∞—Å—Ç–µ—Ä—ñ–≤ Kafka, —è–∫—ñ –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ AWS: Provisioned —Ç–∞ Serverless.

–ó —Ç–æ—á–∫–∏ –∑–æ—Ä—É –∞—Ç–∞–∫—É—é—á–æ–≥–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏, —â–æ:

* **Serverless –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –ø—É–±–ª—ñ—á–Ω–∏–º** (–≤—ñ–Ω –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –ª–∏—à–µ –≤ VPN –±–µ–∑ –±—É–¥—å-—è–∫–æ—ó –ø—É–±–ª—ñ—á–Ω–æ—ó IP-–∞–¥—Ä–µ—Å–∏). –û–¥–Ω–∞–∫ **Provisioned** –º–æ–∂–µ –±—É—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è **–ø—É–±–ª—ñ—á–Ω–æ—ó IP-–∞–¥—Ä–µ—Å–∏** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —Ü—å–æ–≥–æ –Ω–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è) —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ **–≥—Ä—É–ø—É –±–µ–∑–ø–µ–∫–∏** –¥–ª—è **–≤–∏–∫–ª–∞–¥–µ–Ω–Ω—è** –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏—Ö –ø–æ—Ä—Ç—ñ–≤.
* **Serverless –ø—ñ–¥—Ç—Ä–∏–º—É—î –ª–∏—à–µ IAM** —è–∫ –º–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó. **Provisioned** –ø—ñ–¥—Ç—Ä–∏–º—É—î –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é SASL/SCRAM (**–ø–∞—Ä–æ–ª—å**), –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é **IAM**, –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é AWS **Certificate** Manager (ACM) —Ç–∞ **–ù–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π** –¥–æ—Å—Ç—É–ø.
* –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –Ω–µ–º–æ–∂–ª–∏–≤–æ –ø—É–±–ª—ñ—á–Ω–æ –≤–∏–∫–ª–∞—Å—Ç–∏ Provisioned Kafka, —è–∫—â–æ —É–≤—ñ–º–∫–Ω–µ–Ω–æ –Ω–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø

### Enumeration
```bash
#Get clusters
aws kafka list-clusters
aws kafka list-clusters-v2

# Check the supported authentication
aws kafka list-clusters |  jq -r ".ClusterInfoList[].ClientAuthentication"

# Get Zookeeper endpoints
aws kafka list-clusters | jq -r ".ClusterInfoList[].ZookeeperConnectString, .ClusterInfoList[].ZookeeperConnectStringTls"

# Get nodes and node enspoints
aws kafka kafka list-nodes --cluster-arn <cluster-arn>
aws kafka kafka list-nodes --cluster-arn <cluster-arn> | jq -r ".NodeInfoList[].BrokerNodeInfo.Endpoints" # Get endpoints

# Get used kafka configs
aws kafka list-configurations #Get Kafka config file
aws kafka describe-configuration --arn <config-arn> # Get version of config
aws kafka describe-configuration-revision --arn <config-arn> --revision <version> # Get content of config version

# If using SCRAN authentication, get used AWS secret name (not secret value)
aws kafka list-scram-secrets --cluster-arn <cluster-arn>
```
### –î–æ—Å—Ç—É–ø IAM –¥–æ Kafka (—É –±–µ–∑—Å–µ—Ä–≤–µ—Ä–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ)
```bash
# Guide from https://docs.aws.amazon.com/msk/latest/developerguide/create-serverless-cluster.html
# Download Kafka
wget https://archive.apache.org/dist/kafka/2.8.1/kafka_2.12-2.8.1.tgz
tar -xzf kafka_2.12-2.8.1.tgz

# In kafka_2.12-2.8.1/libs download the MSK IAM JAR file.
cd kafka_2.12-2.8.1/libs
wget https://github.com/aws/aws-msk-iam-auth/releases/download/v1.1.1/aws-msk-iam-auth-1.1.1-all.jar

# Create file client.properties in kafka_2.12-2.8.1/bin
security.protocol=SASL_SSL
sasl.mechanism=AWS_MSK_IAM
sasl.jaas.config=software.amazon.msk.auth.iam.IAMLoginModule required;
sasl.client.callback.handler.class=software.amazon.msk.auth.iam.IAMClientCallbackHandler

# Export endpoints address
export BS=boot-ok2ngypz.c2.kafka-serverless.us-east-1.amazonaws.com:9098
## Make sure you will be able to access the port 9098 from the EC2 instance (check VPS, subnets and SG)

# Create a topic called msk-serverless-tutorial
kafka_2.12-2.8.1/bin/kafka-topics.sh --bootstrap-server $BS --command-config client.properties --create --topic msk-serverless-tutorial --partitions 6

# Send message of every new line
kafka_2.12-2.8.1/bin/kafka-console-producer.sh --broker-list $BS --producer.config client.properties --topic msk-serverless-tutorial

# Read messages
kafka_2.12-2.8.1/bin/kafka-console-consumer.sh --bootstrap-server $BS --consumer.config client.properties --topic msk-serverless-tutorial --from-beginning
```
### –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤

{% content-ref url="../aws-privilege-escalation/aws-msk-privesc.md" %}
[aws-msk-privesc.md](../aws-privilege-escalation/aws-msk-privesc.md)
{% endcontent-ref %}

### –ù–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø

{% content-ref url="../aws-unauthenticated-enum-access/aws-msk-unauthenticated-enum.md" %}
[aws-msk-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-msk-unauthenticated-enum.md)
{% endcontent-ref %}

### –ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å

–Ø–∫—â–æ –≤–∏ –º–∞—î—Ç–µ **–¥–æ—Å—Ç—É–ø –¥–æ VPC**, –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è Provisioned Kafka, –≤–∏ –º–æ–∂–µ—Ç–µ **—É–≤—ñ–º–∫–Ω—É—Ç–∏ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø**, —è–∫—â–æ **–∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è SASL/SCRAM**, **–ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ** –ø–∞—Ä–æ–ª—å –∑ —Å–µ–∫—Ä–µ—Ç—É, –Ω–∞–¥–∞–π—Ç–µ –¥–µ—è–∫—ñ **—ñ–Ω—à—ñ –∫–µ—Ä–æ–≤–∞–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ IAM –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º** (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è IAM –∞–±–æ serverless) –∞–±–æ –∑–±–µ—Ä—ñ–≥–∞–π—Ç–µ –∑ **—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞–º–∏**.

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://docs.aws.amazon.com/msk/latest/developerguide/what-is-msk.html](https://docs.aws.amazon.com/msk/latest/developerguide/what-is-msk.html)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤–æ—é **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
