# AWS - Enumeración de MQ

<details>

<summary><strong>Aprende hacking de AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Amazon MQ

### Introducción a los Message Brokers
Los **message brokers** actúan como intermediarios, facilitando la comunicación entre diferentes sistemas de software, que pueden estar construidos en plataformas variadas y programados en diferentes lenguajes. **Amazon MQ** simplifica la implementación, operación y mantenimiento de message brokers en AWS. Ofrece servicios gestionados para **Apache ActiveMQ** y **RabbitMQ**, asegurando una provisión sin problemas y actualizaciones automáticas de la versión del software.

### AWS - RabbitMQ
RabbitMQ es un destacado software de **colas de mensajes**, también conocido como _message broker_ o _queue manager_. Es fundamentalmente un sistema donde se configuran colas. Las aplicaciones se interfazan con estas colas para **enviar y recibir mensajes**. Los mensajes en este contexto pueden llevar una variedad de información, desde comandos para iniciar procesos en otras aplicaciones (potencialmente en diferentes servidores) hasta mensajes de texto simples. El software del queue-manager mantiene los mensajes hasta que son recuperados y procesados por una aplicación receptora. AWS proporciona una solución fácil de usar para alojar y gestionar servidores RabbitMQ.

### AWS - ActiveMQ
Apache ActiveMQ® es un destacado message broker de código abierto y basado en Java, conocido por su versatilidad. Soporta múltiples protocolos estándar de la industria, ofreciendo una amplia compatibilidad de clientes a través de una variedad de lenguajes y plataformas. Los usuarios pueden:

- Conectarse con clientes escritos en JavaScript, C, C++, Python, .Net y más.
- Aprovechar el protocolo **AMQP** para integrar aplicaciones de diferentes plataformas.
- Usar **STOMP** sobre websockets para intercambios de mensajes de aplicaciones web.
- Gestionar dispositivos IoT con **MQTT**.
- Mantener la infraestructura existente de **JMS** y extender sus capacidades.

La robustez y flexibilidad de ActiveMQ lo hacen adecuado para una multitud de requisitos de mensajería.


## Enumeración
```bash
# List brokers
aws mq list-brokers

# Get broker info
aws mq describe-broker --broker-id <broker-id>
## Find endpoints in .BrokerInstances
## Find if public accessible in .PubliclyAccessible

# List usernames (only for ActiveMQ)
aws mq list-users --broker-id <broker-id>

# Get user info (PASSWORD NOT INCLUDED)
aws mq describe-user --broker-id <broker-id> --username <username>

# Lits configurations (only for ActiveMQ)
aws mq list-configurations
## Here you can find if simple or LDAP authentication is used

# Creacte Active MQ user
aws mq create-user --broker-id <value> --password <value> --username <value> --console-access
```
{% hint style="warning" %}
TODO: Indicar cómo enumerar RabbitMQ y ActiveMQ internamente y cómo escuchar en todas las colas y enviar datos (enviar PR si sabes cómo hacer esto)
{% endhint %}

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-mq-privesc.md" %}
[aws-mq-privesc.md](../aws-privilege-escalation/aws-mq-privesc.md)
{% endcontent-ref %}

## Acceso No Autenticado

{% content-ref url="../aws-unauthenticated-enum-access/aws-mq-unauthenticated-enum.md" %}
[aws-mq-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-mq-unauthenticated-enum.md)
{% endcontent-ref %}

## Persistencia

Si conoces las credenciales para acceder a la consola web de RabbitMQ, puedes crear un nuevo usuario con privilegios de administrador.

## Referencias

* [https://www.cloudamqp.com/blog/part1-rabbitmq-for-beginners-what-is-rabbitmq.html](https://www.cloudamqp.com/blog/part1-rabbitmq-for-beginners-what-is-rabbitmq.html)
* [https://activemq.apache.org/](https://activemq.apache.org/)

<details>

<summary><strong>Aprende hacking en AWS de cero a héroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sigue** a **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
