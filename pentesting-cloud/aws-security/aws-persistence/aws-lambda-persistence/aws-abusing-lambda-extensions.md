# AWS - Misbruik van Lambda-uitbreidings

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere maniere om HackTricks te ondersteun:

* Als jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>

## Lambda-uitbreidings

Lambda-uitbreidings verbeter funksies deur te integreer met verskeie **monitoring, waarneming, sekuriteit, en bestuurstelsels**. Hierdie uitbreidings, toegevoeg via [.zip-argiewe met behulp van Lambda-laag](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html) of ingesluit in [houerbeeldimplementasies](https://aws.amazon.com/blogs/compute/working-with-lambda-layers-and-extensions-in-container-images/), werk in twee modusse: **interne** en **eksterne**.

* **Interne uitbreidings** smelt saam met die uitvoeringsproses, deur sy aanvang te manipuleer met behulp van **taalspesifieke omgewingsveranderlikes** en **omhulselkripte**. Hierdie aanpassing geld vir 'n verskeidenheid van uitvoeringstye, insluitend **Java Correto 8 en 11, Node.js 10 en 12, en .NET Core 3.1**.
* **Eksterne uitbreidings** loop as afsonderlike prosesse, wat bedryfsafstemming handhaaf met die Lambda-funksie se lewensiklus. Hulle is verenigbaar met verskeie uitvoeringstye soos **Node.js 10 en 12, Python 3.7 en 3.8, Ruby 2.5 en 2.7, Java Corretto 8 en 11, .NET Core 3.1**, en **aangepaste uitvoeringstye**.

Vir meer inligting oor [**hoe lambda-uitbreidings werk, kyk na die dokumente**](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-extensions-api.html).

### Eksterne Uitbreiding vir Volharding, Diefstal van Versoeke & Wysiging van Versoeke

Dit is 'n opsomming van die tegniek wat voorgestel word in hierdie pos: [https://www.clearvector.com/blog/lambda-spy/](https://www.clearvector.com/blog/lambda-spy/)

Daar is bevind dat die verstek Linux-kernel in die Lambda-uitvoeringomgewing saamgestel is met "process\_vm\_readv" en "process\_vm\_writev" stelseloproepe. En alle prosesse loop met dieselfde gebruikers-ID, selfs die nuwe proses wat geskep is vir die eksterne uitbreiding. **Dit beteken dat 'n eksterne uitbreiding volle lees- en skryftoegang tot Rapid se heap-geheue het, volgens ontwerp.**

Verder, terwyl Lambda-uitbreidings die vermo√´ het om **te inteken op oproepgebeure**, onthul AWS nie die rou data aan hierdie uitbreidings nie. Dit verseker dat **uitbreidings nie toegang het tot sensitiewe inligting** wat oorgedra word via die HTTP-versoek nie.

Die Init (Rapid) proses monitor alle API-versoeke by [http://127.0.0.1:9001](http://127.0.0.1:9001/) terwyl Lambda-uitbreidings ge√Ønisialiseer en uitgevoer word voor die uitvoering van enige uitvoeringstyd-kode, maar na Rapid.

<figure><img src="../../../../.gitbook/assets/image (254).png" alt=""><figcaption><p><a href="https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.default.png">https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.default.png</a></p></figcaption></figure>

Die veranderlike **`AWS_LAMBDA_RUNTIME_API`** dui die **IP**-adres en **poort**nommer van die Rapid API aan **kind-uitvoeringstydprosesse** en addisionele uitbreidings.

{% hint style="warning" %}
Deur die **`AWS_LAMBDA_RUNTIME_API`**-omgewingsveranderlike te verander na 'n **`poort`** waartoe ons toegang het, is dit moontlik om alle aksies binne die Lambda-uitvoering te onderskep (**man-in-die-middel**). Dit is moontlik omdat die uitbreiding met dieselfde regte as Rapid Init loop, en die stelsel se kernel toelaat vir **wysiging van prosesgeheue**, wat die verandering van die poortnommer moontlik maak.
{% endhint %}

Omdat **uitbreidings voor enige uitvoeringstyd-kode loop**, sal die wysiging van die omgewingsveranderlike die uitvoeringstydproses (bv., Python, Java, Node, Ruby) be√Ønvloed wanneer dit begin. Verder sal **uitbreidings wat na ons gelaai is**, wat staatmaak op hierdie veranderlike, ook deur ons uitbreiding roeteer. Hierdie opstelling kan dit moontlik maak vir malware om heeltemal sekuriteitsmaatre√´ls of loguitbreidings direk binne die uitvoeringomgewing te vermy.

<figure><img src="../../../../.gitbook/assets/image (267).png" alt=""><figcaption><p><a href="https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.mitm.png">https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.mitm.png</a></p></figcaption></figure>

Die instrument [**lambda-spy**](https://github.com/clearvector/lambda-spy) is geskep om daardie **geheue skryf** en **sensitiewe inligting steel** van lambda-versoeke, ander **uitbreidingsversoeke** en selfs **hulle wysig**.

## Verwysings

* [https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/](https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/)
* [https://www.clearvector.com/blog/lambda-spy/](https://www.clearvector.com/blog/lambda-spy/)

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
