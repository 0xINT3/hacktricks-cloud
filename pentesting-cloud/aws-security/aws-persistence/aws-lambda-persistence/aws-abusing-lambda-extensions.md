# AWS - Kutumia Vibaya Lambda Extensions

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya HackTricks AWS)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Lambda Extensions

Vifaa vya Lambda huongeza utendaji kwa kuingiliana na zana mbalimbali za **uchunguzi, uonekano, usalama, na utawala**. Vifaa hivi, vilivyotolewa kupitia [.zip archives kwa kutumia safu za Lambda](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html) au vilivyojumuishwa katika [mizigo ya picha ya kontena](https://aws.amazon.com/blogs/compute/working-with-lambda-layers-and-extensions-in-container-images/), hufanya kazi katika njia mbili: **ndani** na **nje**.

* **Vifaa vya ndani** huchanganyika na mchakato wa runtime, kubadilisha kuanza kwake kwa kutumia **mazingira maalum ya lugha** na **scripti za pembetatu**. Kubadilika huku kunatumika kwa anuwai ya mifumo ya uendeshaji, ikiwa ni pamoja na **Java Correto 8 na 11, Node.js 10 na 12, na .NET Core 3.1**.
* **Vifaa vya nje** hufanya kazi kama michakato tofauti, kudumisha ushirikiano wa operesheni na mzunguko wa Lambda. Vinapatikana kwa mifumo mbalimbali ya uendeshaji kama vile **Node.js 10 na 12, Python 3.7 na 3.8, Ruby 2.5 na 2.7, Java Corretto 8 na 11, .NET Core 3.1**, na **mifumo ya uendeshaji ya desturi**.

Kwa habari zaidi kuhusu [**jinsi vifaa vya lambda extensions vinavyofanya kazi angalia nyaraka**](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-extensions-api.html).

### Kifaa cha Nje cha Uthabiti, Kuiba Maombi & Kubadilisha Maombi

Hii ni muhtasari wa mbinu iliyopendekezwa katika chapisho hili: [https://www.clearvector.com/blog/lambda-spy/](https://www.clearvector.com/blog/lambda-spy/)

Iligundulika kuwa kernel ya Linux ya msingi katika mazingira ya runtime ya Lambda imekamilishwa na " **process\_vm\_readv**" na " **process\_vm\_writev**" wito wa mfumo. Na michakato yote inaendeshwa na kitambulisho kimoja cha mtumiaji, hata mchakato mpya ulioanzishwa kwa ajili ya kifaa cha nje. **Hii inamaanisha kuwa kifaa cha nje kina ufikiaji kamili wa kusoma na kuandika kumbukumbu ya Rapid, kwa kubuni.**

Zaidi ya hayo, ingawa vifaa vya Lambda vina uwezo wa **kujiandikisha kwa matukio ya wito**, AWS haifunui data halisi kwa vifaa hivi. Hii inahakikisha kuwa **vifaa haviwezi kupata habari nyeti** zilizotumwa kupitia ombi la HTTP.

Mchakato wa Init (Rapid) unachunguza maombi yote ya API kwenye [http://127.0.0.1:9001](http://127.0.0.1:9001/) wakati vifaa vya Lambda vinainitishwa na kukimbia kabla ya utekelezaji wa nambari ya runtime yoyote, lakini baada ya Rapid.

<figure><img src="../../../../.gitbook/assets/image (254).png" alt=""><figcaption><p><a href="https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.default.png">https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.default.png</a></p></figcaption></figure>

Kigezo cha **`AWS_LAMBDA_RUNTIME_API`** kinaonyesha **IP** na **namba ya bandari** ya API ya Rapid kwa **mchakato wa runtime wa watoto** na vifaa vingine.

{% hint style="warning" %}
Kwa kubadilisha **kigezo cha mazingira cha `AWS_LAMBDA_RUNTIME_API`** kwenda **`bandari`** tunayo ufikiaji wa, ni rahisi kuingilia vitendo vyote ndani ya runtime ya Lambda (**mtu katikati**). Hii inawezekana kwa sababu kifaa cha nje kinaendeshwa na mamlaka sawa na Rapid Init, na kernel ya mfumo inaruhusu **ubadilishaji wa kumbukumbu ya mchakato**, kuruhusu marekebisho ya namba ya bandari.
{% endhint %}

Kwa sababu **vifaa vinakimbia kabla ya nambari ya runtime yoyote**, kubadilisha kigezo cha mazingira kutawaathiri mchakato wa runtime (k.m., Python, Java, Node, Ruby) unapoanza. Zaidi ya hayo, **vifaa vilivyopakiwa baada** ya vyetu, ambavyo vinategemea kigezo hiki, pia vitapitia kupitia kifaa chetu. Hali hii inaweza kuwezesha zisizo kwa programu hasidi kupita kabisa hatua za usalama au vifaa vya kuingiza kumbukumbu moja kwa moja ndani ya mazingira ya runtime.

<figure><img src="../../../../.gitbook/assets/image (267).png" alt=""><figcaption><p><a href="https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.mitm.png">https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.mitm.png</a></p></figcaption></figure>

Zana ya [**lambda-spy**](https://github.com/clearvector/lambda-spy) iliumbwa kufanya **kuandika kumbukumbu** hiyo na **kuiba habari nyeti** kutoka kwa maombi ya lambda, maombi mengine ya **vifaa vya nje** na hata **kubadilisha**.

## Marejeo

* [https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/](https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/)
* [https://www.clearvector.com/blog/lambda-spy/](https://www.clearvector.com/blog/lambda-spy/)

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya HackTricks AWS)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
