# AWS - Lambda Volharding

<details>

<summary><strong>Leer AWS hakwerk vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Lambda

Vir meer inligting, kyk:

{% content-ref url="../../aws-services/aws-lambda-enum.md" %}
[aws-lambda-enum.md](../../aws-services/aws-lambda-enum.md)
{% endcontent-ref %}

### Lambda Laag Volharding

Dit is moontlik om **'n laag in te voer/terugdeur om arbitr√™re kode uit te voer** wanneer die lambda op 'n sluipende manier uitgevoer word:

{% content-ref url="aws-lambda-layers-persistence.md" %}
[aws-lambda-layers-persistence.md](aws-lambda-layers-persistence.md)
{% endcontent-ref %}

### Lambda Uitbreiding Volharding

Deur Lambda-lae te misbruik, is dit ook moontlik om uitbreidings te misbruik en in die lambda te volhard, maar ook om versoek te steel en te wysig.

{% content-ref url="aws-abusing-lambda-extensions.md" %}
[aws-abusing-lambda-extensions.md](aws-abusing-lambda-extensions.md)
{% endcontent-ref %}

### Via hulpbronnepolisie√´

Dit is moontlik om toegang te verleen tot verskillende lambda-aksies (soos aanroep of kode-opdatering) aan eksterne rekeninge:

<figure><img src="../../../../.gitbook/assets/image (255).png" alt=""><figcaption></figcaption></figure>

### Weergawes, Aliasse & Gewigte

'n Lambda kan **verskillende weergawes** h√™ (met verskillende kode vir elke weergawe).\
Dan kan jy **verskillende aliase met verskillende weergawes** van die lambda skep en verskillende gewigte aan elkeen toeken.\
Op hierdie manier kan 'n aanvaller 'n **terugdeur weergawe 1** skep en 'n **weergawe 2 met slegs die wettige kode** en **slegs die weergawe 1 in 1%** van die versoek uitvoer om onopgemerk te bly.

<figure><img src="../../../../.gitbook/assets/image (120).png" alt=""><figcaption></figcaption></figure>

### Weergawe Terugdeur + API Gateway

1. Kopieer die oorspronklike kode van die Lambda
2. **Skep 'n nuwe weergawe met 'n terugdeur** van die oorspronklike kode (of net met skadelike kode). Publiseer en **implementeer daardie weergawe** na $LATEST
1. Roep die API gateway wat verband hou met die lambda aan om die kode uit te voer
3. **Skep 'n nuwe weergawe met die oorspronklike kode**, Publiseer en implementeer daardie **weergawe** na $LATEST.
1. Dit sal die teruggedeurde kode in 'n vorige weergawe verberg
4. Gaan na die API Gateway en **skep 'n nuwe POST-metode** (of kies enige ander metode) wat die teruggedeurde weergawe van die lambda sal uitvoer: `arn:aws:lambda:us-east-1:<acc_id>:function:<func_name>:1`
1. Merk die finale :1 van die arn **wat die weergawe van die funksie aandui** (weergawe 1 sal die teruggedeurde wees in hierdie scenario).
5. Kies die geskepte POST-metode en in Aksies kies **`Implementeer API`**
6. Nou, wanneer jy die funksie **oproep via POST, sal jou Terugdeur** aangeroep word

### Cron/Gebeurtenisaktiveerder

Die feit dat jy **lambda-funksies kan laat loop wanneer iets gebeur of wanneer 'n tyd verloop** maak lambda 'n aangename en algemene manier om volharding te verkry en opsporing te vermy.\
Hier het jy 'n paar idees om jou **teenwoordigheid in AWS meer sluipend te maak deur lambdas te skep**.

* Elke keer as 'n nuwe gebruiker geskep word, genereer lambda 'n nuwe gebruikersleutel en stuur dit na die aanvaller.
* Elke keer as 'n nuwe rol geskep word, gee lambda aanname rol-permissies aan gekompromitteerde gebruikers.
* Elke keer as nuwe cloudtrail-logboeke gegenereer word, verwyder/wysig hulle
