# AWS - S3 Persistence

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスウェグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションをご覧ください
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦で**フォロー**する：[**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
- **ハッキングトリックを共有するために、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。**

</details>

## S3

詳細については、以下をチェックしてください：

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### KMSクライアントサイド暗号化

暗号化プロセスが完了すると、ユーザーはKMS APIを使用して新しいキーを生成します（`aws kms generate-data-key`）そして**生成された暗号化されたキーをファイルのメタデータに保存**します（[pythonコード例](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)）。そのため、攻撃者はこのキーをメタデータから取得し、KMSを使用して復号化（`aws kms decrypt`）して情報を暗号化するために使用されたキーを取得できます。これにより、攻撃者は暗号化キーを取得し、そのキーが他のファイルを暗号化するために再利用される場合、それを使用できます。

### S3 ACLの使用

通常、バケットのACLは無効になっていますが、十分な権限を持つ攻撃者はそれらを悪用することができます（有効になっている場合または攻撃者が有効にできる場合）S3バケットへのアクセスを維持するために。
