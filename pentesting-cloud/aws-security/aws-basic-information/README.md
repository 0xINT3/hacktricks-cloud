# AWS - Osnovne informacije

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite videti **oglašavanje vaše kompanije na HackTricks-u** ili **preuzeti HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Hijerarhija organizacije

![](<../../../.gitbook/assets/image (54).png>)

### Nalozi

U AWS-u postoji **root nalog**, koji je **roditeljski kontejner za sve naloge** vaše **organizacije**. Međutim, ne morate koristiti taj nalog za implementaciju resursa, možete kreirati **druge naloge da biste razdvojili različite AWS** infrastrukture među njima.

Ovo je veoma interesantno sa **bezbednosnog** aspekta, jer **jedan nalog neće moći pristupiti resursima iz drugog naloga** (osim ako se posebno kreiraju mostovi), na ovaj način možete stvoriti granice između implementacija.

Stoga, postoje **dva tipa naloga u organizaciji** (govorimo o AWS nalozima, a ne o korisničkim nalozima): jedan nalog koji je određen kao upravljački nalog, i jedan ili više članskih naloga.

*   **Upravljački nalog (root nalog)** je nalog koji koristite za kreiranje organizacije. Iz upravljačkog naloga organizacije, možete uraditi sledeće:

* Kreirati naloge u organizaciji
* Pozvati druge postojeće naloge u organizaciju
* Ukloniti naloge iz organizacije
* Upravljati pozivnicama
* Primeniti politike na entitete (korene, OUs ili naloge) unutar organizacije
* Omogućiti integraciju sa podržanim AWS uslugama kako bi se obezbedila funkcionalnost usluga u svim nalozima organizacije.
* Moguće je prijaviti se kao root korisnik koristeći e-mail i lozinku korištene za kreiranje ovog root naloga/organizacije.

Upravljački nalog ima **odgovornosti plaćajućeg naloga** i odgovoran je za plaćanje svih troškova koji se akumuliraju od strane članskih naloga. Ne možete promeniti upravljački nalog organizacije.
* **Članski nalozi** čine sve ostale naloge u organizaciji. Nalog može biti član samo jedne organizacije u isto vreme. Možete pridružiti politiku nalogu da primenite kontrole samo na taj nalog.
* Članski nalozi **mora koristiti validnu e-mail adresu** i mogu imati **ime**, generalno neće moći upravljati naplatom (ali im može biti omogućen pristup).
```
aws organizations create-account --account-name testingaccount --email testingaccount@lalala1233fr.com
```
### **Organizacione jedinice**

Nalozi mogu biti grupisani u **organizacione jedinice (OU)**. Na ovaj način možete kreirati **polise** za organizacionu jedinicu koje će biti **primenjene na sve podređene naloge**. Napomena: OU može imati druge OU kao podređene.
```bash
# You can get the root id from aws organizations list-roots
aws organizations create-organizational-unit --parent-id r-lalala --name TestOU
```
### Politika kontrole usluga (SCP)

**Politika kontrole usluga (SCP)** je politika koja određuje usluge i akcije koje korisnici i uloge mogu koristiti u računima na koje SCP utiče. SCP-ovi su **slični IAM** politikama dozvola, osim što **ne dodeljuju nikakve dozvole**. Umesto toga, SCP-ovi određuju **maksimalne dozvole** za organizaciju, organizacionu jedinicu (OU) ili račun. Kada priložite SCP organizacionom korenu ili OU, SCP ograničava dozvole za entitete u članovskim računima.

Ovo je JEDINI način da se **čak i korisnik sa root privilegijama zaustavi** u obavljanju određenih radnji. Na primer, može se koristiti da se spreči korisnicima da onemoguće CloudTrail ili izbrišu rezervne kopije.\
Jedini način da se ovo zaobiđe je da se kompromituje i **glavni račun** koji konfiguriše SCP-ove (glavni račun ne može biti blokiran).

{% hint style="warning" %}
Imajte na umu da **SCP-ovi ograničavaju samo principe u računu**, tako da drugi računi nisu pogođeni. To znači da zabrana SCP-a `s3:GetObject` neće sprečiti ljude da **pristupaju javnom S3 spremištu** u vašem računu.
{% endhint %}

Primeri SCP-a:

* Potpuno zabraniti root nalog
* Dozvoliti samo određene regione
* Dozvoliti samo usluge sa belom listom
*   Zabraniti onemogućavanje GuardDuty, CloudTrail-a i javnog

pristupa S3 blokiranju
*   Zabraniti brisanje ili izmenu bezbednosnih/incidentnih odgovora

uloga.
* Zabraniti brisanje rezervnih kopija.
* Zabraniti kreiranje IAM korisnika i pristupnih ključeva

Pronađite **JSON primere** na [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html)

### ARN

**Amazon Resource Name** je **jedinstveno ime** koje svaki resurs unutar AWS-a ima, sastoji se od sledećeg:
```
arn:partition:service:region:account-id:resource-type/resource-id
arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env
```
Napomena da postoje 4 particije u AWS-u, ali samo 3 načina da ih pozovete:

* AWS Standard: `aws`
* AWS Kina: `aws-cn`
* AWS US javni internet (GovCloud): `aws-us-gov`
* AWS Secret (US Classified): `aws`

## IAM - Upravljanje identitetom i pristupom

IAM je usluga koja vam omogućava upravljanje **autentifikacijom**, **autorizacijom** i **kontrolom pristupa** unutar vašeg AWS naloga.

* **Autentifikacija** - Proces definisanja identiteta i verifikacije tog identiteta. Ovaj proces se može podeliti na: identifikaciju i verifikaciju.
* **Autorizacija** - Određuje šta identitet može pristupiti unutar sistema nakon što je autentifikovan.
* **Kontrola pristupa** - Metod i proces načina na koji se pristup dodeljuje bezbednom resursu.

IAM se može definisati po svojoj sposobnosti da upravlja, kontroliše i reguliše mehanizme autentifikacije, autorizacije i kontrole pristupa identitetima vaših resursa unutar vašeg AWS naloga.

### [Koren korisnika AWS naloga](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_root-user.html) <a href="#id_root" id="id_root"></a>

Kada prvi put kreirate Amazon Web Services (AWS) nalog, počinjete sa jednim identitetom za prijavljivanje koji ima **potpuni pristup svim** AWS uslugama i resursima u nalogu. To je korisnik _**korena AWS naloga**_ i pristupa mu se prijavljivanjem sa **adresom e-pošte i lozinkom koju ste koristili prilikom kreiranja naloga**.

Imajte na umu da će novi **admin korisnik** imati **manje dozvole od korisnika korena**.

Sa aspekta bezbednosti, preporučuje se kreiranje drugih korisnika i izbegavanje korišćenja ovog korisnika.

### [IAM korisnici](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_users.html) <a href="#id_iam-users" id="id_iam-users"></a>

IAM _korisnik_ je entitet koji kreirate u AWS-u da **predstavlja osobu ili aplikaciju** koja ga koristi za **interakciju sa AWS-om**. Korisnik u AWS-u se sastoji od imena i akreditacija (lozinke i do dva pristupna ključa).

Kada kreirate IAM korisnika, dodeljujete mu **dozvole** tako što ga činite **članom grupe korisnika** koja ima odgovarajuće politike dozvola pridružene (preporučeno), ili **direktno pridruživanjem politika** korisniku.

Korisnici mogu imati **omogućeno MFA za prijavljivanje** putem konzole. API tokeni korisnika sa omogućenim MFA nisu zaštićeni MFA. Ako želite **ograničiti pristup API ključevima korisnika korišćenjem MFA**, morate naznačiti u politici da je potrebno prisustvo MFA za izvršavanje određenih radnji (primer [**ovde**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html)).

#### CLI

* **ID pristupnog ključa**: 20 nasumičnih velikih alfanumeričkih karaktera poput AKHDNAPO86BSHKDIRYT
* **Tajni ID pristupnog ključa**: 40 nasumičnih velikih i malih karaktera: S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtU (Nije moguće povratiti izgubljeni tajni ID pristupnog ključa).

Kada god trebate **promeniti pristupni ključ**, trebate pratiti ovaj proces:\
_Kreirajte novi pristupni ključ -> Primijenite novi ključ na sistem/aplikaciju -> označite originalni ključ kao neaktivan -> Testirajte i verifikujte da novi pristupni ključ radi -> Obrišite stari pristupni ključ_

### MFA - Višestruka autentifikacija

Koristi se za **kreiranje dodatnog faktora za autentifikaciju** pored postojećih metoda, kao što je lozinka, čime se stvara višestruki nivo autentifikacije.\
Možete koristiti **besplatnu virtuelnu aplikaciju ili fizički uređaj**. Možete koristiti aplikacije poput Google autentifikacije besplatno da biste aktivirali MFA u AWS-u.

Politike sa MFA uslovima mogu biti pridružene sledećem:

* IAM korisniku ili grupi
* Resursu kao što je Amazon S3 kanta, Amazon SQS red ili Amazon SNS tema
* Poverenjskoj politici IAM uloge koju može preuzeti korisnik

Ako želite **pristupiti putem CLI-ja** resursu koji **proverava MFA**, morate pozvati **`GetSessionToken`**. To će vam dati token sa informacijama o MFA.\
Imajte na umu da **poverenički podaci `AssumeRole` ne sadrže ove informacije**.
```bash
aws sts get-session-token --serial-number <arn_device> --token-code <code>
```
Kao što je [**ovde navedeno**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html), postoji mnogo različitih slučajeva u kojima **MFA ne može biti korišćen**.

### [IAM grupe korisnika](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) <a href="#id_iam-groups" id="id_iam-groups"></a>

IAM [grupa korisnika](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) je način da se **dodeljuju politike više korisnicima** odjednom, što može olakšati upravljanje dozvolama za te korisnike. **Uloge i grupe ne mogu biti deo grupe**.

Možete dodeliti **politiku zasnovanu na identitetu grupi korisnika** tako da svi **korisnici** u grupi korisnika **dobiju dozvole politike**. Ne možete identifikovati **grupu korisnika** kao **`Principal`** u **politici** (kao što je politika zasnovana na resursima) jer grupe se odnose na dozvole, a ne na autentifikaciju, a principali su autentifikovani IAM entiteti.

Evo nekih važnih karakteristika grupa korisnika:

* **Grupa korisnika** može **sadržati mnogo korisnika**, a **korisnik** može **pripadati više grupa**.
* **Grupe korisnika ne mogu biti ugnježdene**; mogu sadržati samo korisnike, a ne druge grupe korisnika.
* Ne postoji **podrazumevana grupa korisnika koja automatski uključuje sve korisnike u AWS nalogu**. Ako želite da imate takvu grupu korisnika, morate je kreirati i dodeliti svakom novom korisniku.
* Broj i veličina IAM resursa u AWS nalogu, kao što je broj grupa i broj grupa kojima korisnik može biti član, su ograničeni. Za više informacija, pogledajte [IAM i AWS STS kvote](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_iam-quotas.html).

### [IAM uloge](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles.html) <a href="#id_iam-roles" id="id_iam-roles"></a>

IAM **uloga** je veoma **slična** korisniku, jer je to identitet sa politikama dozvola koje određuju šta može i ne može da radi u AWS-u. Međutim, uloga **nema nikakve akreditive** (lozinku ili pristupne ključeve) povezane sa njom. Umesto da bude jedinstveno povezana sa jednom osobom, uloga je namenjena da bude **preuzeta od strane bilo koga ko je potreban (i ima dovoljno dozvola)**. IAM korisnik može preuzeti ulogu privremeno kako bi dobio različite dozvole za određeni zadatak. Uloga može biti **dodeljena federiranom korisniku** koji se prijavljuje koristeći spoljni pružalac identiteta umesto IAM-a.

IAM uloga se sastoji od **dve vrste politika**: **politika poverenja**, koja ne može biti prazna, definiše **ko može preuzeti** ulogu, i **politika dozvola**, koja ne može biti prazna, definiše **na šta može pristupiti**.

#### AWS Security Token Service (STS)

AWS Security Token Service (STS) je veb servis koji olakšava **izdavanje privremenih akreditiva sa ograničenim privilegijama**. Specifično je prilagođen za:

### [Privremeni akreditivi u IAM-u](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_temp.html) <a href="#id_temp-creds" id="id_temp-creds"></a>

**Privremeni akreditivi se uglavnom koriste sa IAM ulogama**, ali postoje i druge upotrebe. Možete zatražiti privremene akreditive koji imaju ograničeniji skup dozvola od vašeg standardnog IAM korisnika. Ovo **sprečava** vas da **slučajno obavljate zadatke koji nisu dozvoljeni** sa ograničenijim akreditivima. Prednost privremenih akreditiva je da automatski ističu nakon određenog vremenskog perioda. Imate kontrolu nad trajanjem važenja akreditiva.

### Politike

#### Dozvole politike

Koriste se za dodeljivanje dozvola. Postoje 2 vrste:

* AWS upravljane politike (unapred konfigurisane od strane AWS-a)
* Korisnički upravljane politike: Konfigurisane od strane vas. Možete kreirati politike zasnovane na AWS upravljanim politikama (modifikujući jednu od njih i kreirajući svoju), koristeći generator politika (prikaz sa grafičkim interfejsom koji vam pomaže da dodeljujete dozvole) ili pišući sopstvene politike.

Po **podrazumevanoj postavci pristup** je **odbijen**, pristup će biti odobren ako je eksplicitno navedena uloga.\
Ako postoji **samo "Deny"**, on će anulirati "Allow", osim za zahteve koji koriste osnovne bezbednosne akreditive AWS naloga (koji su podrazumevano dozvoljeni).
```javascript
{
"Version": "2012-10-17",  //Version of the policy
"Statement": [  //Main element, there can be more than 1 entry in this array
{
"Sid": "Stmt32894y234276923" //Unique identifier (optional)
"Effect": "Allow", //Allow or deny
"Action": [  //Actions that will be allowed or denied
"ec2:AttachVolume",
"ec2:DetachVolume"
],
"Resource": [ //Resource the action and effect will be applied to
"arn:aws:ec2:*:*:volume/*",
"arn:aws:ec2:*:*:instance/*"
],
"Condition": { //Optional element that allow to control when the permission will be effective
"ArnEquals": {"ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/instance-id"}
}
}
]
}
```
[Globalna polja koja se mogu koristiti za uslove u bilo kojoj usluzi dokumentovana su ovde](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_policies\_condition-keys.html#condition-keys-resourceaccount).\
[Specifična polja koja se mogu koristiti za uslove po usluzi dokumentovana su ovde](https://docs.aws.amazon.com/service-authorization/latest/reference/reference\_policies\_actions-resources-contextkeys.html).

#### Inline politike

Ova vrsta politika se **direktno dodeljuje** korisniku, grupi ili ulozi. Zatim, one se ne pojavljuju na listi politika kao što to čine druge.\
Inline politike su korisne ako želite da **održavate strogu jedan-na-jedan vezu između politike i identiteta** na koje se primenjuje. Na primer, želite da budete sigurni da se dozvole u politici ne dodeljuju nenamerno drugom identitetu osim onog za koji su namenjene. Kada koristite inline politiku, dozvole u politici ne mogu se nenamerno dodeliti pogrešnom identitetu. Osim toga, kada koristite AWS Management Console za brisanje tog identiteta, politike ugrađene u identitet takođe se brišu. To je zato što su deo glavnog entiteta.

#### Politike resursnih kanti

Ovo su **politike** koje se mogu definisati u **resursima**. **Nisu svi resursi AWS-a podržavaju**.

Ako princip nema eksplicitno odbijanje na njima, a politika resursa im dodeljuje pristup, onda im je dozvoljen pristup.

### IAM granice

IAM granice se mogu koristiti da **ograniče dozvole koje korisnik ili uloga treba da ima pristup**. Na ovaj način, čak i ako korisniku drugom politikom budu dodeljeni **različiti skupovi dozvola**, operacija će **neuspeti** ako pokuša da ih koristi.

Granica je samo politika koja je pridružena korisniku i koja **ukazuje na maksimalni nivo dozvola koje korisnik ili uloga mogu imati**. Dakle, **čak i ako korisnik ima administratorski pristup**, ako granica ukazuje da može samo čitati S3 kante, to je maksimum koji može da uradi.

**Ovo**, **SCP-ovi** i **princip najmanjih privilegija** su načini da se kontroliše da korisnici nemaju više dozvola od onih koje im je potrebno.

### Politike sesije

Politika sesije je **politika koja se postavlja kada se pretpostavi uloga** na neki način. To će biti kao **IAM granica za tu sesiju**: To znači da politika sesije ne dodeljuje dozvole, već ih **ograničava na one koje su navedene u politici** (pri čemu su maksimalne dozvole one koje ima uloga).

Ovo je korisno za **mere bezbednosti**: Kada administrator preuzima veoma privilegovanu ulogu, može ograničiti dozvole samo na one koje su navedene u politici sesije u slučaju da sesija bude kompromitovana.
```bash
aws sts assume-role \
--role-arn <value> \
--role-session-name <value> \
[--policy-arns <arn_custom_policy1> <arn_custom_policy2>]
[--policy <file://policy.json>]
```
Napomena da **AWS po defaultu može dodati politike sesije sesijama** koje će biti generisane zbog trećih razloga. Na primer, kod [neautentifikovanih pretpostavljenih uloga za kognito](../aws-services/aws-cognito-enum/cognito-identity-pools.md#accessing-iam-roles) po defaultu (koristeći unapređenu autentifikaciju), AWS će generisati **podatke o sesiji sa politikom sesije** koja ograničava usluge kojima sesija može pristupiti [**na sledeću listu**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services).

Dakle, ako se u nekom trenutku susretnete sa greškom "... jer nijedna politika sesije ne dozvoljava ...", a uloga ima pristup za izvršavanje radnje, to je zato što **postoji politika sesije koja to sprečava**.

### Federacija identiteta

Federacija identiteta **omogućava korisnicima sa spoljnih provajdera identiteta** da pristupe AWS resursima na siguran način, bez potrebe da obezbede AWS korisničke podatke iz validnog IAM korisničkog naloga.\
Primer provajdera identiteta može biti vaša sopstvena korporativna **Microsoft Active Directory** (putem **SAML**) ili **OpenID** servisi (kao što je **Google**). Federisani pristup će omogućiti korisnicima unutar njega pristup AWS-u.

Da biste konfigurisali ovaj poverenje, generiše se **IAM provajder identiteta (SAML ili OAuth)** koji će **poveriti** **drugu platformu**. Zatim, barem jedna **IAM uloga je dodeljena (poverena) provajderu identiteta**. Ako korisnik sa poverene platforme pristupi AWS-u, pristupiće kao pomenuta uloga.

Međutim, obično ćete želeti da dodelite **različitu ulogu u zavisnosti od grupe korisnika** u platformi treće strane. Zatim, nekoliko **IAM uloga može poveriti** provajderu identiteta treće strane, a treća strana platforma će omogućiti korisnicima da pretpostave jednu ili drugu ulogu.

<figure><img src="../../../.gitbook/assets/image (1) (2).png" alt=""><figcaption></figcaption></figure>

### IAM centar identiteta

AWS IAM centar identiteta (naslednik AWS Single Sign-On) proširuje mogućnosti AWS Identity and Access Management (IAM) kako bi pružio **centralno mesto** koje objedinjuje **administraciju korisnika i njihov pristup AWS nalogu** i cloud aplikacijama.

Domen za prijavu će biti nešto poput `<user_input>.awsapps.com`.

Za prijavu korisnika mogu se koristiti 3 izvora identiteta:

* Identity Center direktorijum: Redovni AWS korisnici
* Active Directory: Podržava različite konektore
* Spoljni provajder identiteta: Svi korisnici i grupe dolaze iz spoljnog provajdera identiteta (IdP)

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

U najjednostavnijem slučaju Identity Center direktorijuma, **Identity Center će imati listu korisnika i grupa** i moći će im **dodeliti politike** za **bilo koji od naloga** organizacije.

Da biste omogućili pristup korisniku/grupi Identity Centera na nalog, **kreiraće se SAML provajder identiteta koji veruje Identity Centeru**, i **kreiraće se uloga koja veruje provajderu identiteta sa naznačenim politikama** u odredišnom nalogu.

#### AwsSSOInlinePolicy

Moguće je **dodeliti dozvole putem ugrađenih politika ulogama kreiranim putem IAM centra identiteta**. Uloge kreirane u nalozima kojima se **dodeljuju ugrađene politike u AWS Identity Centeru** imaće ove dozvole u ugrađenoj politici nazvanoj **`AwsSSOInlinePolicy`**.

Dakle, čak i ako vidite 2 uloge sa ugrađenom politikom nazvanom **`AwsSSOInlinePolicy`**, to **ne znači da imaju iste dozvole**.

### Poverenja i uloge između naloga

**Korisnik** (koji veruje) može kreirati ulogu između naloga sa određenim politikama, a zatim **omogućiti drugom korisniku** (koji je poveren) da **pristupi njegovom nalogu**, ali samo **sa pristupom naznačenim u politikama nove uloge**. Da biste to kreirali, jednostavno kreirajte novu ulogu i odaberite ulogu između naloga. Uloge za pristup između naloga nude dve opcije. Pružanje pristupa između AWS naloga koje posedujete i pružanje pristupa između naloga koje posedujete i AWS naloga treće strane.\
Preporučuje se **navesti korisnika koji je poveren i ne koristiti nešto generičko**, jer u suprotnom, drugi autentifikovani korisnici poput federisanih korisnika takođe će moći zloupotrebiti ovo poverenje.

### AWS Simple AD

Nije podržano:

* Povereni odnosi
* AD Admin centar
* Potpuna podrška za PS API
* AD Recycle Bin
* Upravljane grupe servisnih naloga
* Proširenja šeme
* Nema direktan pristup OS-u ili instancama

#### Veb federacija ili OpenID autentifikacija

Aplikacija koristi AssumeRoleWithWebIdentity da bi kreirala privremene akreditive. Međutim, ovo ne daje pristup AWS konzoli, već samo pristup resursima unutar AWS-a.

### Ostale IAM opcije

* Možete **postaviti politiku lozinke** sa opcijama kao što su minimalna dužina i zahtevi za lozinku.
* Možete **preuzeti "Credential Report"** sa informacijama o trenutnim akreditivima (kao što su vreme kreiranja korisnika, da li je lozinka omogućena...). Možete generisati izveštaj o akreditivima najmanje jednom svakih **četiri sata**.

AWS Identity and Access Management (IAM) pruža **detaljnu kontrolu pristupa** na svim AWS resursima. Pomoću IAM-a možete odrediti **ko može pristupiti kojim uslugama i resursima**, i pod kojim uslovima. Pomoću IAM politika upravljate dozvolama za svoje radnike i sisteme kako biste **osigurali najmanje privilegije**.

### IAM ID prefiksi

Na [**ovoj stranici**](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_identifiers.html#identifiers-unique-ids) možete pronaći **IAM ID prefikse** ključeva u zavisnosti od njihove prirode:

| ABIA | [Bearer token AWS STS servisa](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_bearer.html)                                                                                                         |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ACCA | Kontekstualni akreditiv                                                                                                                                                                                           |
| AGPA | Korisnička grupa                                                                                                                                                                                                            |
| AIDA | IAM korisnik                                                                                                                                                                                                              |
| AIPA | Amazon EC2 profil instance                                                                                                                                                                                           |
| AKIA | Pristupni ključ                                                                                                                                                                                                            |
| ANPA | Upravljana politika                                                                                                                                                                                                        |
| ANVA | Verzija u upravljanoj politici                                                                                                                                                                                           |
| APKA | Javni ključ                                                                                                                                                                                                            |
| AROA | Uloga                                                                                                                                                                                                                  |
| ASCA | Sertifikat                                                                                                                                                                                                           |
| ASIA | [Privremeni (AWS STS) identifikatori ključeva pristupa](https://docs.aws.amazon.com/STS/latest/APIReference/API\_Credentials.html) koriste ovaj prefiks, ali su jedinstveni samo u kombinaciji sa tajnim pristupnim ključem i tokenom sesije. |

### Preporučene dozvole za proveru naloga

Sledeće privilegije omogućavaju različite nivoe čitanja metapodataka:

* `arn:aws:iam::aws:policy/SecurityAudit`
* `arn:aws:iam::aws:policy/job-function/ViewOnlyAccess`
* `codebuild:ListProjects`
* `config:Describe*`
* `cloudformation:ListStacks`
* `logs:DescribeMetricFilters`
* `directconnect:DescribeConnections`
* `dynamodb:ListTables`

## Razno

### CLI autentifikacija

Da bi se redovni korisnik autentifikovao na AWS putem CLI, potrebno je imati **lokalne akreditive**. Podrazumevano ih možete konfiguris
```
[default]
aws_access_key_id = AKIA5ZDCUJHF83HDTYUT
aws_secret_access_key = uOcdhof683fbOUGFYEQug8fUGIf68greoihef

[Admin]
aws_access_key_id = AKIA8YDCu7TGTR356SHYT
aws_secret_access_key = uOcdhof683fbOUGFYEQuR2EIHG34UY987g6ff7
region = eu-west-2
```
Ako trebate pristupiti **različitim AWS nalozima** i vašem profilu je omogućen pristup **pretpostavljanju uloge unutar tih naloga**, ne morate ručno pozivati STS svaki put (`aws sts assume-role --role-arn <role-arn> --role-session-name sessname`) i konfigurirati akreditive.

Možete koristiti datoteku `~/.aws/config` da biste [**naznačili koje uloge pretpostaviti**](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html), a zatim koristiti parametar `--profile` kao i obično (pretpostavljanje uloge će se obaviti na transparentan način za korisnika).\
Primjer konfiguracijske datoteke:
```
[profile acc2]
region=eu-west-2
role_arn=arn:aws:iam::<account-id>:role/<role-path>
role_session_name = <session_name>
source_profile = <profile_with_assume_role>
sts_regional_endpoints = regional
```
Sa ovim konfiguracionim fajlom možete koristiti aws cli na sledeći način:
```
aws --profile acc2 ...
```
Ako tražite nešto **slično** ovome, ali za **pregledač**, možete provjeriti **dodatak** [**AWS Extend Switch Roles**](https://chrome.google.com/webstore/detail/aws-extend-switch-roles/jpmkfafbacpgapdghgdpembnojdlgkdl?hl=en).

## Reference

* [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html)
* [https://aws.amazon.com/iam/](https://aws.amazon.com/iam/)
* [https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite vidjeti svoju **kompaniju oglašenu u HackTricks-u** ili **preuzeti HackTricks u PDF formatu**, provjerite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podijelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
