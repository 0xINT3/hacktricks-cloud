# AWS - 기본 정보

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 상품**](https://peass.creator-spring.com)을 구매하세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>

## 조직 계층

![](<../../../.gitbook/assets/image (54).png>)

### 계정

AWS에서는 **루트 계정**이 있으며, 이는 **조직의 모든 계정의 상위 컨테이너**입니다. 그러나 리소스를 배포하기 위해 해당 계정을 사용할 필요는 없으며, **다른 계정을 생성하여 AWS 인프라를 분리**할 수 있습니다.

보안 관점에서 매우 흥미로운 점은 **한 계정이 다른 계정의 리소스에 액세스할 수 없다는 것**입니다(다리가 명시적으로 생성되지 않는 한). 이렇게 함으로써 배포 사이에 경계를 생성할 수 있습니다.

따라서 조직 내에는 **두 가지 유형의 계정**이 있습니다(여기서 AWS 계정과 사용자 계정을 얘기하고 있습니다): 관리 계정 하나와 하나 이상의 멤버 계정.

*   **관리 계정(루트 계정)**은 조직을 생성하는 데 사용하는 계정입니다. 조직의 관리 계정에서 다음 작업을 수행할 수 있습니다:

* 조직 내에서 계정 생성
* 기존 계정을 조직에 초대
* 계정을 조직에서 제거
* 초대 관리
* 조직 내의 엔티티(루트, OUs 또는 계정)에 정책 적용
* 지원되는 AWS 서비스와의 통합을 활성화하여 조직의 모든 계정에서 서비스 기능 제공.
* 이 루트 사용자로 로그인하는 것은 이 루트 계정/조직을 생성할 때 사용한 이메일과 비밀번호를 사용하여 가능합니다.

관리 계정은 **지불 계정의 책임**을 지며, 멤버 계정이 발생하는 모든 비용을 지불합니다. 조직의 관리 계정을 변경할 수 없습니다.
* **멤버 계정**은 조직 내의 나머지 모든 계정을 구성합니다. 계정은 한 번에 하나의 조직의 멤버가 될 수 있습니다. 계정에 정책을 첨부하여 해당 계정에만 제어를 적용할 수 있습니다.
* 멤버 계정은 **유효한 이메일 주소를 사용**해야 하며, **이름**을 가질 수 있으며, 일반적으로 요금 관리를 할 수 없습니다(하지만 액세스 권한을 부여받을 수도 있음).
```
aws organizations create-account --account-name testingaccount --email testingaccount@lalala1233fr.com
```
### **조직 단위**

계정은 **조직 단위 (OU)** 에 그룹화 될 수 있습니다. 이렇게하면 조직 단위에 대한 **정책**을 만들 수 있으며 이는 **모든 하위 계정에 적용**됩니다. 조직 단위는 다른 조직 단위를 하위 계정으로 가질 수 있다는 점에 유의하세요.
```bash
# You can get the root id from aws organizations list-roots
aws organizations create-organizational-unit --parent-id r-lalala --name TestOU
```
### 서비스 제어 정책 (SCP)

**서비스 제어 정책 (SCP)**은 SCP가 영향을 미치는 계정에서 사용자 및 역할이 사용할 수 있는 서비스 및 작업을 지정하는 정책입니다. SCP는 IAM 권한 정책과 유사하지만 **어떤 권한도 부여하지 않습니다**. 대신, SCP는 조직, 조직 단위(OU) 또는 계정에 대한 **최대 권한**을 지정합니다. SCP를 조직 루트 또는 OU에 첨부하면 SCP는 회원 계정의 엔터티에 대한 권한을 제한합니다.

이것은 **루트 사용자조차도 특정 작업을 수행하지 못하도록 막는 유일한 방법**입니다. 예를 들어, CloudTrail을 비활성화하거나 백업을 삭제하는 것을 사용자가 막을 수 있습니다.\
이를 우회하는 유일한 방법은 SCP를 구성하는 **마스터 계정**도 침해하는 것입니다(마스터 계정은 차단할 수 없습니다).

{% hint style="warning" %}
SCP는 **계정의 주체에만 제한을 가합니다**. 따라서 다른 계정에는 영향을 미치지 않습니다. 이는 SCP가 `s3:GetObject`를 거부한다고 해도 사람들이 계정의 **공개 S3 버킷에 액세스하는 것을 막지 않는다는 것을 의미**합니다.
{% endhint %}

SCP 예시:

* 루트 계정 전체 거부
* 특정 지역만 허용
* 화이트리스트에 있는 서비스만 허용
*   GuardDuty, CloudTrail 및 S3 Public Block Access를 비활성화하는 것을 거부
*   보안/사고 대응 역할을 삭제하거나 수정하는 것을 거부
* 백업 삭제 거부
* IAM 사용자 및 액세스 키 생성 거부

[https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html)에서 **JSON 예시**를 찾을 수 있습니다.

### ARN

**Amazon Resource Name**은 AWS 내의 모든 리소스가 가지는 **고유한 이름**입니다. 다음과 같이 구성됩니다:
```
arn:partition:service:region:account-id:resource-type/resource-id
arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env
```
## IAM - Identity and Access Management

IAM은 AWS 계정 내에서 **인증**, **권한 부여** 및 **액세스 제어**를 관리하는 데 사용되는 서비스입니다.

* **인증** - 신원을 정의하고 해당 신원을 확인하는 과정입니다. 이 과정은 식별 및 확인으로 세분화될 수 있습니다.
* **권한 부여** - 인증된 신원이 시스템 내에서 액세스할 수 있는 내용을 결정합니다.
* **액세스 제어** - 안전한 리소스에 대한 액세스가 부여되는 방법 및 과정입니다.

IAM은 AWS 계정 내 리소스에 대한 신원의 인증, 권한 부여 및 액세스 제어 메커니즘을 관리, 제어 및 조정하는 능력으로 정의될 수 있습니다.

### [AWS 계정 루트 사용자](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_root-user.html) <a href="#id_root" id="id_root"></a>

Amazon Web Services (AWS) 계정을 처음 생성할 때, 계정에 대한 모든 AWS 서비스 및 리소스에 대한 **완전한 액세스 권한을 가진 단일 로그인 신원**으로 시작합니다. 이것이 AWS 계정의 _**루트 사용자**_이며, 계정 생성 시 사용한 **이메일 주소와 비밀번호로 로그인**하여 액세스할 수 있습니다.

새로운 **관리자 사용자**는 **루트 사용자보다 적은 권한**을 가집니다.

보안적인 측면에서, 다른 사용자를 생성하고 이 사용자를 사용하지 않는 것이 권장됩니다.

### [IAM 사용자](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_users.html) <a href="#id_iam-users" id="id_iam-users"></a>

IAM _사용자_는 AWS에서 생성하는 개체로, AWS와 상호 작용하는 **사람 또는 애플리케이션을 나타냅니다**. AWS에서 사용자는 이름과 자격 증명(비밀번호 및 최대 두 개의 액세스 키)으로 구성됩니다.

IAM 사용자를 생성할 때, 해당 사용자를 **권한 정책이 부착된 사용자 그룹의 구성원**으로 만들어 권한을 부여하거나, 사용자에게 **직접 정책을 부착**함으로써 권한을 부여합니다.

사용자는 콘솔을 통해 로그인할 때 **MFA를 활성화**할 수 있습니다. MFA가 활성화된 사용자의 API 토큰은 MFA로 보호되지 않습니다. MFA를 사용하여 사용자의 API 키의 액세스를 **제한하려면** 정책에서 특정 작업을 수행하기 위해 MFA가 필요하다고 지정해야 합니다(예: [**여기**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html) 참조).

#### CLI

* **액세스 키 ID**: AKHDNAPO86BSHKDIRYT와 같은 20자의 무작위 대문자 알파벳 및 숫자 조합
* **비밀 액세스 키 ID**: S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtU와 같은 40자의 무작위 대소문자 조합 (분실된 비밀 액세스 키 ID를 검색할 수 없습니다).

액세스 키를 **변경해야 하는 경우** 다음 절차를 따르십시오:\
_새로운 액세스 키 생성 -> 시스템/애플리케이션에 새로운 키 적용 -> 원래 키를 비활성화로 표시 -> 새로운 액세스 키가 작동하는지 테스트 및 확인 -> 이전 액세스 키 삭제_

### MFA - 다중 요소 인증

MFA는 기존의 비밀번호와 같은 기존 방법 외에도 **인증에 대한 추가 요소를 생성**하는 데 사용되며, 따라서 다중 요소 수준의 인증을 생성합니다.\
가상 애플리케이션이나 물리적 장치와 같은 **무료 가상 애플리케이션 또는 물리적 장치**를 사용할 수 있습니다. AWS에서는 구글 인증과 같은 앱을 무료로 사용하여 MFA를 활성화할 수 있습니다.

MFA 조건이 있는 정책은 다음에 부착될 수 있습니다:

* IAM 사용자 또는 그룹
* Amazon S3 버킷, Amazon SQS 큐 또는 Amazon SNS 주제와 같은 리소스
* 사용자가 가정할 수 있는 IAM 역할의 신뢰 정책

MFA를 확인하는 **리소스에 CLI로 액세스**하려면 **`GetSessionToken`**을 호출해야 합니다. 이를 통해 MFA에 대한 정보가 포함된 토큰을 얻을 수 있습니다.\
**`AssumeRole` 자격 증명에는 이 정보가 포함되지 않습니다**.
```bash
aws sts get-session-token --serial-number <arn_device> --token-code <code>
```
[**여기에서 언급된 것**](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html)과 같이, **MFA를 사용할 수 없는** 다양한 경우가 있습니다.

### [IAM 사용자 그룹](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id\_groups.html) <a href="#id_iam-groups" id="id_iam-groups"></a>

IAM [사용자 그룹](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id\_groups.html)은 한 번에 여러 사용자에게 정책을 **첨부**하여 해당 사용자의 권한을 관리하기 쉽게 할 수 있는 방법입니다. **역할과 그룹은 그룹의 일부가 될 수 없습니다**.

**사용자 그룹에 신원 기반 정책을 첨부**하여 사용자 그룹의 **모든 사용자가 정책의 권한을 받을 수 있도록** 할 수 있습니다. 그룹은 인증이 아닌 권한과 관련이 있으므로 그룹을 정책(예: 리소스 기반 정책)의 **`Principal`**로 식별할 수 없습니다.

사용자 그룹의 중요한 특징은 다음과 같습니다:

* 사용자 **그룹**은 **여러 사용자를 포함**할 수 있으며, **사용자**는 **여러 그룹에 속할 수 있습니다**.
* **사용자 그룹은 중첩될 수 없으며**, 다른 사용자 그룹이 아닌 사용자만 포함할 수 있습니다.
* AWS 계정의 모든 사용자를 자동으로 포함하는 기본 사용자 그룹은 **없습니다**. 그러한 사용자 그룹을 만들고 각 새 사용자를 할당해야 합니다.
* 사용자가 소속될 수 있는 그룹의 수와 크기, 예를 들어 그룹의 수 및 사용자가 소속될 수 있는 그룹의 수는 제한됩니다. 자세한 내용은 [IAM 및 AWS STS 할당량](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/reference\_iam-quotas.html)을 참조하십시오.

### [IAM 역할](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id\_roles.html) <a href="#id_iam-roles" id="id_iam-roles"></a>

IAM **역할**은 AWS에서 수행할 수 있는 작업을 결정하는 권한 정책을 가진 **사용자와 유사한 신원**입니다. 그러나 역할은 **암호나 액세스 키와 연결되지 않습니다**. 한 사람과 고유하게 연결되는 대신, 역할은 필요한 사람이 임시로 다른 권한을 부여받을 수 있도록 하는 것을 목적으로 합니다. IAM 사용자는 특정 작업을 위해 역할을 **임시로 가질 수 있습니다**. 역할은 IAM 대신 외부 신원 제공자를 사용하여 로그인하는 [**연합 사용자**](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id\_roles\_providers.html)에게 할당될 수 있습니다.

IAM 역할은 다음 두 가지 유형의 정책으로 구성됩니다: **신뢰 정책**과 **권한 정책**입니다. 신뢰 정책은 비어 있을 수 없으며, 역할을 **가능한 사용자**를 정의하고 권한 정책은 비어 있을 수 없으며, 역할이 **액세스할 수 있는 내용**을 정의합니다.

#### AWS 보안 토큰 서비스 (STS)

AWS 보안 토큰 서비스 (STS)는 **임시적이고 제한된 권한을 가진 자격 증명을 발급**하는 웹 서비스입니다. 이 서비스는 다음과 같이 특별히 제작되었습니다:

### [IAM에서 임시 자격 증명](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/id\_credentials\_temp.html) <a href="#id_temp-creds" id="id_temp-creds"></a>

**임시 자격 증명은 주로 IAM 역할과 함께 사용**되지만 다른 용도로도 사용됩니다. 표준 IAM 사용자보다 제한된 권한 집합을 가진 임시 자격 증명을 요청할 수 있습니다. 이를 통해 제한된 자격 증명으로 허용되지 않은 작업을 실수로 수행하는 것을 방지할 수 있습니다. 임시 자격 증명의 장점은 일정 기간이 지난 후 자동으로 만료된다는 것입니다. 자격 증명의 유효 기간을 제어할 수 있습니다.

### 정책

#### 정책 권한

권한을 할당하는 데 사용됩니다. 두 가지 유형이 있습니다:

* AWS 관리 정책 (AWS에서 미리 구성)
* 고객 관리 정책: 사용자가 구성합니다. AWS 관리 정책을 기반으로 정책을 생성할 수 있으며 (하나를 수정하고 고유한 정책을 생성), 정책 생성기(권한 부여 및 거부를 도와주는 GUI 뷰)를 사용하거나 직접 작성할 수 있습니다.

**기본적으로 액세스가 거부**되며, 명시적인 역할이 지정된 경우에만 액세스가 허용됩니다.\
**"Deny"가 하나만 있는 경우 "Allow"를 무시**하게 됩니다. 단, AWS 계정의 루트 보안 자격 증명을 사용하는 요청은 기본적으로 허용됩니다.
```javascript
{
"Version": "2012-10-17",  //Version of the policy
"Statement": [  //Main element, there can be more than 1 entry in this array
{
"Sid": "Stmt32894y234276923" //Unique identifier (optional)
"Effect": "Allow", //Allow or deny
"Action": [  //Actions that will be allowed or denied
"ec2:AttachVolume",
"ec2:DetachVolume"
],
"Resource": [ //Resource the action and effect will be applied to
"arn:aws:ec2:*:*:volume/*",
"arn:aws:ec2:*:*:instance/*"
],
"Condition": { //Optional element that allow to control when the permission will be effective
"ArnEquals": {"ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/instance-id"}
}
}
]
}
```
[전역 조건으로 사용할 수 있는 필드는 여기에 문서화되어 있습니다](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-resourceaccount).\
[각 서비스별로 사용할 수 있는 조건 필드는 여기에 문서화되어 있습니다](https://docs.aws.amazon.com/service-authorization/latest/reference/reference_policies_actions-resources-contextkeys.html).

#### 인라인 정책

이 유형의 정책은 사용자, 그룹 또는 역할에 **직접 할당**됩니다. 그런 다음, 다른 정책과 마찬가지로 정책 목록에 나타나지 않습니다.\
인라인 정책은 정책과 적용 대상 신원 간의 엄격한 일대일 관계를 유지하려는 경우 유용합니다. 예를 들어, 정책의 권한이 의도한 신원 이외의 신원에게 실수로 할당되지 않도록 하려는 경우입니다. 인라인 정책을 사용하면 정책의 권한이 잘못된 신원에 부착되지 않도록 방지할 수 있습니다. 또한 AWS Management Console을 사용하여 해당 신원을 삭제할 때 신원에 포함된 정책도 삭제됩니다. 이는 정책이 주체 엔티티의 일부이기 때문입니다.

#### 리소스 버킷 정책

이는 **리소스**에 정의할 수 있는 **정책**입니다. **AWS의 모든 리소스가 이를 지원하는 것은 아닙니다**.

주체에게 명시적인 거부가 없고 리소스 정책이 액세스를 허용하면 허용됩니다.

### IAM 바운더리

IAM 바운더리는 사용자 또는 역할이 액세스할 수 있는 권한을 **제한하는 데 사용**될 수 있습니다. 이렇게 하면 **다른 정책**에 의해 사용자에게 부여된 다른 권한 집합이 있더라도 해당 작업을 시도하면 **실패**합니다.

바운더리는 사용자에게 부착된 정책일 뿐이며 사용자 또는 역할이 가질 수 있는 최대 권한 수준을 나타냅니다. 따라서 사용자가 관리자 액세스 권한을 가지더라도 바운더리가 S3 버킷을 읽기만 할 수 있도록 지정한다면, 그게 사용자가 할 수 있는 최대 권한입니다.

**이것**, **SCP** 및 **최소 권한** 원칙을 따르는 것은 사용자가 필요한 권한보다 더 많은 권한을 가지지 않도록 제어하는 방법입니다.

### 세션 정책

세션 정책은 어떤 역할이 **가정될 때 설정되는 정책**입니다. 이는 해당 세션에 대한 **IAM 바운더리와 같습니다**: 즉, 세션 정책은 권한을 부여하지 않고 정책에서 지정된 권한으로 제한합니다(최대 권한은 역할이 가진 권한입니다).

이는 **보안 조치**에 유용합니다: 관리자가 매우 권한이 있는 역할을 가정할 때 세션이 침해당할 경우 세션 정책에서 지정된 권한만 허용할 수 있습니다.
```bash
aws sts assume-role \
--role-arn <value> \
--role-session-name <value> \
[--policy-arns <arn_custom_policy1> <arn_custom_policy2>]
[--policy <file://policy.json>]
```
참고로 기본적으로 **AWS는 세션을 생성하기 위해 세션 정책을 추가**할 수 있습니다. 예를 들어, [인증되지 않은 Cognito 가정 역할](../aws-services/aws-cognito-enum/cognito-identity-pools.md#accessing-iam-roles)의 경우 기본적으로 (향상된 인증을 사용하여) AWS는 세션 정책을 생성하여 세션이 액세스할 수 있는 서비스를 제한합니다. [**다음 목록**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services)으로.

따라서 어떤 시점에서 "... 세션 정책을 허용하지 않기 때문에 ..."라는 오류가 발생하고 역할이 작업을 수행할 수 있는 액세스 권한이 있는 경우, **이는 작업을 방지하는 세션 정책이 있는 것**입니다.

### 신원 연합

신원 연합은 AWS 외부의 신원 제공자로부터 AWS 리소스에 안전하게 액세스할 수 있도록 하는 것을 의미합니다. 유형 제공자의 예로는 고유한 기업 **Microsoft Active Directory**(via **SAML**) 또는 **OpenID** 서비스(예: **Google**)가 있습니다. 연합 액세스를 통해 해당 플랫폼 내의 사용자가 AWS에 액세스할 수 있습니다.

이 신뢰를 구성하기 위해 **IAM 신원 제공자(SAML 또는 OAuth)**가 생성되며, 적어도 하나의 **IAM 역할이(가) 신원 제공자를 신뢰**합니다. 신뢰된 플랫폼의 사용자가 AWS에 액세스하면 해당 역할로 액세스하게 됩니다.

그러나 일반적으로 제3자 플랫폼의 사용자 그룹에 따라 **다른 역할을 부여**하려고 할 것입니다. 그런 다음 여러 **IAM 역할이 제3자 신원 제공자를 신뢰**하고 제3자 플랫폼이 한 역할 또는 다른 역할을 가정할 수 있도록 할 것입니다.

<figure><img src="../../../.gitbook/assets/image (1) (2).png" alt=""><figcaption></figcaption></figure>

### IAM 신원 센터

AWS IAM 신원 센터(AWS Single Sign-On의 후속 제품)는 AWS Identity and Access Management(IAM)의 기능을 확장하여 AWS 계정 및 클라우드 애플리케이션에 대한 **사용자 및 액세스 관리를 통합하는 중앙 장소**를 제공합니다.

로그인 도메인은 `<user_input>.awsapps.com`과 같은 형식이 될 것입니다.

사용자를 로그인하기 위해 다음과 같은 3가지 신원 소스를 사용할 수 있습니다:

* 신원 센터 디렉터리: 일반적인 AWS 사용자
* Active Directory: 다양한 커넥터 지원
* 외부 신원 제공자: 모든 사용자 및 그룹이 외부 신원 제공자(IdP)에서 제공됩니다.

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

가장 간단한 경우인 신원 센터 디렉터리의 경우, **신원 센터에는 사용자 및 그룹 목록**이 있으며, 조직의 **모든 계정에 대해 정책을 할당**할 수 있습니다.

신원 센터 사용자/그룹에게 계정에 액세스 권한을 부여하려면 **신원 센터를 신뢰하는 SAML 신원 제공자**가 생성되고, 대상 계정에는 지정된 정책을 사용하여 **신원 제공자를 신뢰하는 역할**이 생성됩니다.

#### AwsSSOInlinePolicy

IAM 신원 센터를 통해 생성된 역할에 **인라인 정책을 통해 권한을 부여**할 수 있습니다. AWS 신원 센터에서 **인라인 정책을 가진 계정에 생성된 역할**은 **`AwsSSOInlinePolicy`**라는 인라인 정책에 이러한 권한을 갖게 됩니다.

따라서 **`AwsSSOInlinePolicy`**라는 인라인 정책이 있는 2개의 역할을 볼 수 있더라도, **동일한 권한을 갖는 것은 아닙니다**.

### 계정 간 신뢰 및 역할

**신뢰하는 사용자**는 일부 정책을 가진 계정 간 역할을 생성한 다음, **신뢰받는 사용자**에게 **자신의 계정에 액세스할 수 있는 권한을 새로운 역할 정책에 지정**할 수 있습니다. 이를 위해 새로운 역할을 생성하고 "계정 간 역할"을 선택하면 됩니다. 계정 간 액세스용 역할은 두 가지 옵션을 제공합니다. 소유한 AWS 계정 간의 액세스 제공 및 소유한 계정과 제3자 AWS 계정 간의 액세스 제공입니다.\
이 신뢰를 남용하지 않도록 **신뢰받는 사용자를 구체적으로 지정**하는 것이 좋습니다.

### AWS Simple AD

지원되지 않는 기능:

* 신뢰 관계
* AD 관리 센터
* 전체 PS API 지원
* AD 재활용통
* 그룹 관리 서비스 계정
* 스키마 확장
* OS 또는 인스턴스에 직접 액세스 불가

#### 웹 연합 또는 OpenID 인증

앱은 AssumeRoleWithWebIdentity를 사용하여 일시적인 자격 증명을 생성합니다. 그러나 이는 AWS 콘솔에 대한 액세스가 아니라 AWS 내의 리소스에 대한 액세스만을 부여합니다.

### 기타 IAM 옵션

* 최소 길이 및 암호 요구 사항과 같은 옵션을 설정할 수 있는 **암호 정책 설정**을 할 수 있습니다.
* 현재 자격 증명에 대한 정보를 포함하는 **"자격 증명 보고서"**를 다운로드할 수 있습니다(사용자 생성 시간, 암호 사용 가능 여부 등). 자격 증명 보고서는 **4시간마다 한 번** 생성할 수 있습니다.

AWS Identity and Access Management(IAM)은 AWS 전체에서 **세밀한 액세스 제어**를 제공합니다. IAM을 사용하면 **누가 어떤 서비스와 리소스에 액세스할 수 있는지** 및 어떤 조건에서 액세스할 수 있는지를 지정할 수 있습니다. IAM 정책을 사용하여 귀사의 인력 및 시스템에 대한 권한을 관리하여 **최소한의 권한을 보장**할 수 있습니다.

### IAM ID 접두사

[**이 페이지**](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_identifiers.html#identifiers-unique-ids)에서 키의 IAM ID 접두사를 찾을 수 있습니다.

| ABIA | [AWS STS 서비스 베어러 토큰](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_bearer.html) |
| ---- | ------------------------------------------------------------------------------------------------- |
| ACCA | 컨텍스트별 자격 증명                                                                               |
| AGPA | 사용자 그룹                                                                                        |
| AIDA | IAM 사용자                                                                                         |
| AIPA | Amazon EC2 인스턴스 프로필                                                                         |
| AKIA | 액세스 키                                                                                          |
| ANPA | 관리 정책                                                                                          |
| ANVA | 관리 정책의 버전                                                                                    |
| APKA | 공개 키                                                                                            |
| AROA | 역할                                                                                               |
| ASCA | 인증서                                                                                             |
| ASIA | 일시적(AWS STS) 액세스 키 ID는 이 접두사를 사용하지만, 비밀 액세스 키 및 세션 토큰과만 결합 시에만 고유합니다. |

### 계정 감사를 위한 권장 권한

다음 권한은 다양한 메타데이터의 읽기 액세스를 부여합니다:

* `arn:aws:iam::aws:policy/SecurityAudit`
* `arn:aws:iam::aws:policy/job-function/ViewOnlyAccess`
* `codebuild:ListProjects`
* `config:Describe*`
* `cloudformation:ListStacks`
* `logs
```
[default]
aws_access_key_id = AKIA5ZDCUJHF83HDTYUT
aws_secret_access_key = uOcdhof683fbOUGFYEQug8fUGIf68greoihef

[Admin]
aws_access_key_id = AKIA8YDCu7TGTR356SHYT
aws_secret_access_key = uOcdhof683fbOUGFYEQuR2EIHG34UY987g6ff7
region = eu-west-2
```
만약 **다른 AWS 계정**에 액세스해야 하고 프로필이 **해당 계정 내에서 역할을 가정**할 수 있는 권한을 가지고 있다면, 매번 수동으로 STS를 호출하고 자격 증명을 구성할 필요가 없습니다 (`aws sts assume-role --role-arn <role-arn> --role-session-name sessname`).

`~/.aws/config` 파일을 사용하여 [**가정할 역할을 지정**](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html)하고, 그런 다음 일반적인 방식으로 `--profile` 매개변수를 사용할 수 있습니다 (사용자에게는 `assume-role`이 투명하게 수행됩니다).

구성 파일 예시:
```
[profile acc2]
region=eu-west-2
role_arn=arn:aws:iam::<account-id>:role/<role-path>
role_session_name = <session_name>
source_profile = <profile_with_assume_role>
sts_regional_endpoints = regional
```
이 구성 파일을 사용하여 다음과 같이 aws cli를 사용할 수 있습니다:
```
aws --profile acc2 ...
```
이와 유사한 것을 찾고 있다면 **브라우저**용 **확장 프로그램** [**AWS Extend Switch Roles**](https://chrome.google.com/webstore/detail/aws-extend-switch-roles/jpmkfafbacpgapdghgdpembnojdlgkdl?hl=en)을 확인해볼 수 있습니다.

## 참고 자료

* [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html)
* [https://aws.amazon.com/iam/](https://aws.amazon.com/iam/)
* [https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 상품**](https://peass.creator-spring.com)을 구매하세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
