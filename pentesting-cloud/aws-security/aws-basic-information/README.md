# AWS - Basiese Inligting

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>

## Organisasie Hi√´rargie

![](<../../../.gitbook/assets/image (54).png>)

### Rekeninge

In AWS is daar 'n **hoofrekening,** wat die **ouerhouer vir al die rekeninge** vir jou **organisasie** is. Jy hoef egter nie daardie rekening te gebruik om hulpbronne te implementeer nie, jy kan **ander rekeninge skep om verskillende AWS-infrastrukture van mekaar te skei**.

Dit is baie interessant vanuit 'n **sekuriteitsoogpunt**, aangesien **een rekening nie toegang sal h√™ tot hulpbronne van 'n ander rekening** (behalwe as br√ªe spesifiek geskep word nie), sodat jy op hierdie manier grense tussen implementering kan skep.

Daarom is daar **twee tipes rekeninge in 'n organisasie** (ons praat van AWS-rekeninge en nie Gebruikersrekeninge nie): 'n enkele rekening wat as die bestuursrekening aangewys is, en een of meer lidrekeninge.

*   Die **bestuursrekening (die hoofrekening)** is die rekening wat jy gebruik om die organisasie te skep. Vanuit die bestuursrekening van die organisasie kan jy die volgende doen:

* Rekeninge in die organisasie skep
* Ander bestaande rekeninge na die organisasie uitnooi
* Rekeninge uit die organisasie verwyder
* Uitnodigings bestuur
* Beleide toepas op entiteite (wortels, OUs of rekeninge) binne die organisasie
* Integrasie met ondersteunde AWS-diens om diensfunksionaliteit in al die rekeninge in die organisasie te bied.
* Dit is moontlik om as die hoofgebruiker in te teken met die e-pos en wagwoord wat gebruik is om hierdie hoofrekening/organisasie te skep.

Die bestuursrekening het die **verantwoordelikhede van 'n betalingsrekening** en is verantwoordelik vir die betaling van alle koste wat deur die lidrekeninge opgebou word. Jy kan nie 'n organisasie se bestuursrekening verander nie.
* **Lidrekeninge** maak al die ander rekeninge in 'n organisasie uit. 'n Rekening kan slegs lid van een organisasie op 'n slag wees. Jy kan 'n beleid aan 'n rekening heg om beheer slegs op daardie een rekening toe te pas.
* Lidrekeninge **moet 'n geldige e-posadres gebruik** en kan 'n **naam** h√™, oor die algemeen sal hulle nie die fakturering kan bestuur nie (maar hulle kan toegang daartoe gegee word).
```
aws organizations create-account --account-name testingaccount --email testingaccount@lalala1233fr.com
```
### **Organisasie Eenhede**

Rekeninge kan gegroepeer word in **Organisasie Eenhede (OE)**. Op hierdie manier kan jy **beleide** skep vir die Organisasie Eenheid wat toegepas sal word op **alle kinderrekeninge**. Let daarop dat 'n OE ander OEs as kinders kan h√™.
```bash
# You can get the root id from aws organizations list-roots
aws organizations create-organizational-unit --parent-id r-lalala --name TestOU
```
### Diensbeheerbeleid (SCP)

'n **Diensbeheerbeleid (SCP)** is 'n beleid wat spesifiseer watter dienste en aksies gebruikers en rolle kan gebruik in die rekeninge wat deur die SCP be√Ønvloed word. SCP's is **soortgelyk aan IAM-toestemmingsbeleide**, behalwe dat hulle **geen toestemmings verleen** nie. In plaas daarvan spesifiseer SCP's die **maksimum toestemmings** vir 'n organisasie, organisatoriese eenheid (OU) of rekening. Wanneer jy 'n SCP aan jou organisasie se hoof of 'n OU heg, beperk die SCP toestemmings vir entiteite in lidrekeninge.

Dit is die ENIGSTE manier waarop **selfs die hoofgebruiker gestop kan word** om iets te doen. Byvoorbeeld, dit kan gebruik word om gebruikers te verhoed om CloudTrail uit te skakel of rugsteune te verwyder.\
Die enigste manier om dit te omseil, is om ook die **hoofrekening** wat die SCP's konfigureer, te kompromitteer (die hoofrekening kan nie geblokkeer word nie).

{% hint style="warning" %}
Let daarop dat **SCP's slegs die beginsels in die rekening beperk**, so ander rekeninge word nie geraak nie. Dit beteken dat 'n SCP wat `s3:GetObject` ontken, nie mense sal verhoed om 'n openbare S3-emmer in jou rekening **te benader nie**.
{% endhint %}

Voorbeelde van SCP's:

* Ontken die hoofrekening heeltemal
* Staaf slegs spesifieke streke toe
* Staaf slegs witlys-dienste toe
*   Ontken die vermo√´ om GuardDuty, CloudTrail en S3 Public Block Access uit te skakel
*   Ontken die vermo√´ om sekuriteit/insidentreaksie-rolle te verwyder of te wysig.
* Ontken die verwydering van rugsteune.
* Ontken die skep van IAM-gebruikers en toegangssleutels

Vind **JSON-voorbeelde** by [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html)

### ARN

**Amazon Resource Name** is die **unieke naam** wat elke hulpbron binne AWS het, dit is saamgestel soos volg:
```
arn:partition:service:region:account-id:resource-type/resource-id
arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env
```
Let wel dat daar 4 partisies in AWS is, maar slegs 3 maniere om hulle te noem:

* AWS Standaard: `aws`
* AWS China: `aws-cn`
* AWS US openbare internet (GovCloud): `aws-us-gov`
* AWS Secret (US Geklassifiseer): `aws`

## IAM - Identiteit en Toegangsbestuur

IAM is die diens wat jou in staat stel om **Identifikasie**, **Goedkeuring** en **Toegangsbeheer** binne jou AWS-rekening te bestuur.

* **Identifikasie** - Proses om 'n identiteit te definieer en die verifikasie van daardie identiteit. Hierdie proses kan onderverdeel word in: Identifikasie en verifikasie.
* **Goedkeuring** - Bepaal wat 'n identiteit binne 'n stelsel kan toegang kry nadat dit daaraan ge√Ødentifiseer is.
* **Toegangsbeheer** - Die metode en proses van hoe toegang verleen word tot 'n veilige bron.

IAM kan gedefinieer word deur sy vermo√´ om die identifikasie, goedkeuring en toegangsbeheer meganismes van identiteite tot jou hulpbronne binne jou AWS-rekening te bestuur, beheer en regeer.

### [AWS-rekening hoofgebruiker](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_root-user.html) <a href="#id_root" id="id_root"></a>

Wanneer jy 'n Amazon Web Services (AWS)-rekening skep, begin jy met 'n enkele aanmeldingsidentiteit wat **volledige toegang tot alle** AWS-dienste en hulpbronne in die rekening het. Dit is die AWS-rekening _**hoofgebruiker**_ en dit word benader deur aan te meld met die **e-posadres en wagwoord wat jy gebruik het om die rekening te skep**.

Let daarop dat 'n nuwe **administrateurgebruiker** minder toestemmings as die hoofgebruiker sal h√™.

Vanuit 'n veiligheidsoogpunt word dit aanbeveel om ander gebruikers te skep en om nie hierdie een te gebruik nie.

### [IAM-gebruikers](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_users.html) <a href="#id_iam-users" id="id_iam-users"></a>

'n IAM-gebruiker is 'n entiteit wat jy in AWS skep om die persoon of toepassing te **verteenwoordig** wat dit gebruik om met AWS te **interaksie** te h√™. 'n Gebruiker in AWS bestaan uit 'n naam en geloofsbriewe (wagwoord en tot twee toegangssleutels).

Wanneer jy 'n IAM-gebruiker skep, verleen jy dit **toestemmings** deur dit 'n **lid van 'n gebruikersgroep** te maak wat toepaslike toestemmingsbeleide aangeheg het (aanbeveel), of deur **beleide direk aan die gebruiker te heg**.

Gebruikers kan **MFA geaktiveer h√™ om aan te meld** deur die konsole. API-tokens van MFA-geaktiveerde gebruikers word nie deur MFA beskerm nie. As jy die toegang van 'n gebruiker se API-sleutels met MFA wil **beperk**, moet jy in die beleid aandui dat MFA teenwoordig moet wees om sekere aksies uit te voer (voorbeeld [**hier**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html)).

#### CLI

* **Toegangssleutel-ID**: 20 lukrake hoofletters en alfanumeriese karakters soos AKHDNAPO86BSHKDIRYT
* **Geheime toegangssleutel-ID**: 40 lukrake hoof- en kleinletters: S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtU (Dit is nie moontlik om verlore geheime toegangssleutel-ID's te herstel nie).

Wanneer jy die **Toegangssleutel wil verander**, moet jy die volgende proses volg:\
_Skep 'n nuwe toegangssleutel -> Pas die nuwe sleutel toe op die stelsel/toepassing -> merk die oorspronklike een as onaktief -> Toets en verifieer dat die nuwe toegangssleutel werk -> Verwyder die ou toegangssleutel_

### MFA - Multi-Faktor-Verifikasie

Dit word gebruik om 'n bykomende faktor vir verifikasie te skep, bo-op jou bestaande metodes, soos wagwoord, en skep dus 'n multi-faktorvlak van verifikasie.\
Jy kan 'n **gratis virtuele toepassing of 'n fisiese toestel** gebruik. Jy kan gratis programme soos Google-verifikasie gebruik om 'n MFA in AWS te aktiveer.

Beleide met MFA-voorwaardes kan geheg word aan die volgende:

* 'n IAM-gebruiker of -groep
* 'n hulpbron soos 'n Amazon S3-emmer, Amazon SQS-ry of Amazon SNS-onderwerp
* Die vertrouensbeleid van 'n IAM-rol wat deur 'n gebruiker aangeneem kan word

As jy **toegang via die CLI** wil h√™ tot 'n hulpbron wat **MFA nagaan**, moet jy **`GetSessionToken`** noem. Dit sal jou 'n token gee met inligting oor MFA.\
Let daarop dat **`AssumeRole`-volmagte hierdie inligting nie bevat nie**.
```bash
aws sts get-session-token --serial-number <arn_device> --token-code <code>
```
Soos [**hier aangedui**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html), is daar baie verskillende gevalle waar **MFA nie gebruik kan word nie**.

### [IAM-gebruikersgroepe](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) <a href="#id_iam-groups" id="id_iam-groups"></a>

'n IAM-gebruikersgroep is 'n manier om **beleide aan verskeie gebruikers te heg** op een slag, wat dit makliker kan maak om die toestemmings vir daardie gebruikers te bestuur. **Rolle en groepe kan nie deel wees van 'n groep nie**.

Jy kan 'n **identiteitsgebaseerde beleid aan 'n gebruikersgroep heg** sodat al die **gebruikers** in die gebruikersgroep die beleid se toestemmings **ontvang**. Jy kan nie 'n **gebruikersgroep** identifiseer as 'n **`Principal`** in 'n **beleid** (soos 'n hulpbron-gebaseerde beleid) nie, omdat groepe verband hou met toestemmings, nie outentisering nie, en beginsels geoutentiseerde IAM-entiteite is.

Hier is 'n paar belangrike kenmerke van gebruikersgroepe:

* 'n Gebruikersgroep kan **baie gebruikers bevat**, en 'n **gebruiker** kan **aan verskeie groepe behoort**.
* **Gebruikersgroepe kan nie genestel word nie**; hulle kan slegs gebruikers bevat, nie ander gebruikersgroepe nie.
* Daar is **geen verstek gebruikersgroep wat outomaties alle gebruikers in die AWS-rekening insluit nie**. As jy 'n gebruikersgroep soos daardie wil h√™, moet jy dit skep en elke nuwe gebruiker daaraan toewys.
* Die aantal en grootte van IAM-hulpbronne in 'n AWS-rekening, soos die aantal groepe en die aantal groepe waarvan 'n gebruiker 'n lid kan wees, is beperk. Vir meer inligting, sien [IAM en AWS STS kwotas](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_iam-quotas.html).

### [IAM-rolle](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles.html) <a href="#id_iam-roles" id="id_iam-roles"></a>

'n IAM-rol is baie **soortgelyk** aan 'n **gebruiker**, in die sin dat dit 'n **identiteit met beleidsre√´ls is wat bepaal wat** dit in AWS kan en nie kan doen nie. 'n Rol het egter **geen geloofsbriewe** (wagwoord of toegangssleutels) wat daarmee geassosieer word nie. In plaas daarvan om uniek geassosieer te word met een persoon, is 'n rol bedoel om **deur enigeen wat dit nodig het (en genoeg toestemmings het)** oorgeneem te word. 'n IAM-gebruiker kan 'n rol **aanneem om tydelik** verskillende toestemmings vir 'n spesifieke taak oor te neem. 'n Rol kan **toegewys word aan 'n** [**gefedereerde gebruiker**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_providers.html) wat aanmeld deur 'n eksterne identiteitsverskaffer te gebruik in plaas van IAM.

'n IAM-rol bestaan uit **twee tipes beleidsre√´ls**: 'n **vertrouensbeleid**, wat nie leeg kan wees nie, wat bepaal **wie die rol kan aanneem**, en 'n **toestemmingsbeleid**, wat nie leeg kan wees nie, wat bepaal **waartoe dit toegang kan h√™**.

#### AWS Security Token Service (STS)

AWS Security Token Service (STS) is 'n webdiens wat die **uitreiking van tydelike, beperkte-voorreggelde geloofsbriewe** fasiliteer. Dit is spesifiek ontwerp vir:

### [Tydelike geloofsbriewe in IAM](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_temp.html) <a href="#id_temp-creds" id="id_temp-creds"></a>

**Tydelike geloofsbriewe word hoofsaaklik gebruik met IAM-rolle**, maar daar is ook ander gebruike. Jy kan tydelike geloofsbriewe aanvra wat 'n meer beperkte stel toestemmings het as jou standaard IAM-gebruiker. Dit **voorkom** dat jy **per ongeluk take uitvoer wat nie toegelaat word** deur die meer beperkte geloofsbriewe nie. 'n Voordeel van tydelike geloofsbriewe is dat hulle outomaties verval na 'n vasgestelde tydperk. Jy het beheer oor die geldigheidsduur van die geloofsbriewe.

### Beleide

#### Beleidstoestemmings

Word gebruik om toestemmings toe te ken. Daar is 2 tipes:

* AWS-bestuurde beleide (vooraf gekonfigureer deur AWS)
* Klantbestuurde beleide: Deur jou gekonfigureer. Jy kan beleide skep gebaseer op AWS-bestuurde beleide (deur een daarvan te wysig en jou eie te skep), die beleidsgenerator gebruik ( 'n GUI-aansig wat jou help om toestemmings toe te ken en te weier) of jou eie skryf..

By **verstek word toegang** **ontken**, toegang sal toegestaan word as 'n eksplisiete rol gespesifiseer is.\
As daar 'n **enkele "Weiering" bestaan, sal dit die "Toelaat" oorskryf**, behalwe vir versoek wat die AWS-rekening se hoofsekuriteitsgeloofsbriewe gebruik (wat standaard toegelaat word).
```javascript
{
"Version": "2012-10-17",  //Version of the policy
"Statement": [  //Main element, there can be more than 1 entry in this array
{
"Sid": "Stmt32894y234276923" //Unique identifier (optional)
"Effect": "Allow", //Allow or deny
"Action": [  //Actions that will be allowed or denied
"ec2:AttachVolume",
"ec2:DetachVolume"
],
"Resource": [ //Resource the action and effect will be applied to
"arn:aws:ec2:*:*:volume/*",
"arn:aws:ec2:*:*:instance/*"
],
"Condition": { //Optional element that allow to control when the permission will be effective
"ArnEquals": {"ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/instance-id"}
}
}
]
}
```
Die [globale velde wat gebruik kan word vir voorwaardes in enige diens word hier gedokumenteer](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_policies\_condition-keys.html#condition-keys-resourceaccount).\
Die [spesifieke velde wat gebruik kan word vir voorwaardes per diens word hier gedokumenteer](https://docs.aws.amazon.com/service-authorization/latest/reference/reference\_policies\_actions-resources-contextkeys.html).

#### Inline Beleide

Hierdie soort beleide word **direk toegewys** aan 'n gebruiker, groep of rol. Hulle verskyn dan nie in die beleidelys soos enige ander een nie.\
Inline beleide is nuttig as jy 'n streng een-tot-een verhouding tussen 'n beleid en die identiteit wat dit toegepas word, wil handhaaf. Byvoorbeeld, jy wil seker maak dat die toestemmings in 'n beleid nie per ongeluk aan 'n identiteit toegewys word wat nie bedoel is nie. Wanneer jy 'n inline beleid gebruik, kan die toestemmings in die beleid nie per ongeluk aan die verkeerde identiteit geheg word nie. Daarbenewens, wanneer jy die AWS-bestuurskonsol gebruik om daardie identiteit te verwyder, word die beleide wat in die identiteit ingebed is, ook verwyder. Dit is omdat hulle deel is van die hoofentiteit.

#### Hulpbronemmerbeleide

Dit is **beleide** wat in **hulpbronne** gedefinieer kan word. **Nie alle hulpbronne van AWS ondersteun hulle nie**.

As 'n hoof nie 'n uitdruklike weiering op hulle het nie, en 'n hulpbronbeleid hulle toegang verleen, word hulle toegelaat.

### IAM Grense

IAM-grense kan gebruik word om die toestemmings wat 'n gebruiker of rol toegang tot moet h√™, te **beperk**. Op hierdie manier, selfs al word 'n ander stel toestemmings aan die gebruiker verleen deur 'n **ander beleid**, sal die operasie **misluk** as hy probeer om dit te gebruik.

'n Grens is net 'n beleid wat aan 'n gebruiker geheg is en **die maksimum vlak van toestemmings aandui** wat die gebruiker of rol kan h√™. So, **selfs al het die gebruiker Administrateurtoegang**, as die grens aandui dat hy slegs S3-emmers kan lees, is dit die maksimum wat hy kan doen.

**Dit**, **SCPs** en **om die beginsel van die minste bevoegdheid te volg**, is die maniere om te beheer dat gebruikers nie meer toestemmings het as wat hulle nodig het nie.

### Sessiebeleide

'n Sessiebeleid is 'n **beleid wat ingestel word wanneer 'n rol aangeneem word** op een of ander manier. Dit sal soos 'n **IAM-grens vir daardie sessie wees**: Dit beteken dat die sessiebeleid nie toestemmings verleen nie, maar hulle beperk tot diegene wat in die beleid aangedui word (met die maksimum toestemmings wat die rol het).

Dit is nuttig vir **sekuriteitsmaatre√´ls**: Wanneer 'n administrateur 'n baie bevoorregte rol gaan aanneem, kan hy die toestemming beperk tot slegs diegene wat in die sessiebeleid aangedui word in geval die sessie gekompromitteer word.
```bash
aws sts assume-role \
--role-arn <value> \
--role-session-name <value> \
[--policy-arns <arn_custom_policy1> <arn_custom_policy2>]
[--policy <file://policy.json>]
```
Let daarop dat **AWS standaard sessiebeleide kan byvoeg tot sessies** wat gegenereer gaan word as gevolg van derde redes. Byvoorbeeld, in [ongeauthentiseerde cognito aangeneemde rolle](../aws-services/aws-cognito-enum/cognito-identity-pools.md#accessing-iam-roles) standaard (deur verbeterde outentisering te gebruik), sal AWS **sessievolmagte met 'n sessiebeleid genereer** wat die dienste wat die sessie kan toegang [**beperk tot die volgende lys**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services).

Daarom, as jy op 'n punt die fout te√´kom "... omdat geen sessiebeleid die ... toelaat nie", en die rol het toegang om die aksie uit te voer, is dit omdat **daar 'n sessiebeleid is wat dit voorkom**.

### Identiteitsfederasie

Identiteitsfederasie **stel gebruikers van identiteitsverskaffers wat ekstern is** in staat om veilig toegang tot AWS-hulpbronne te verkry sonder om AWS-gebruikersvolmagte van 'n geldige IAM-gebruikersrekening te verskaf. 'n Voorbeeld van 'n identiteitsverskaffer kan jou eie korporatiewe **Microsoft Active Directory** (via **SAML**) of **OpenID**-dienste (soos **Google**) wees. Gefedereerde toegang sal dan die gebruikers binne dit in staat stel om toegang tot AWS te verkry.

Om hierdie vertroue te konfigureer, word 'n **IAM-identiteitsverskaffer gegenereer (SAML of OAuth)** wat die **ander platform sal vertrou**. Dan word ten minste een **IAM-rol toegewys (vertrouend) aan die identiteitsverskaffer**. As 'n gebruiker van die vertroude platform toegang tot AWS verkry, sal hy as die genoemde rol toegang verkry.

Jy sal egter gewoonlik 'n **verskillende rol wil gee afhangende van die groep van die gebruiker** in die derde party platform. Dan kan verskeie **IAM-rolle die derde party identiteitsverskaffer vertrou** en die derde party platform sal die een wees wat gebruikers in staat stel om een rol of die ander aan te neem.

<figure><img src="../../../.gitbook/assets/image (1) (2).png" alt=""><figcaption></figcaption></figure>

### IAM Identiteitsentrum

AWS IAM Identiteitsentrum (opvolger van AWS Enkeltekenaanmelding) brei die vermo√´ns van AWS Identiteit en Toegangsbestuur (IAM) uit om 'n **sentrale plek** te bied wat die **administrasie van gebruikers en hul toegang tot AWS-rekeninge** en wolktoepassings saambring.

Die aanmeldingsdomein gaan iets soos `<user_input>.awsapps.com` wees.

Om gebruikers aan te meld, kan daar 3 identiteitsbronne gebruik word:

* Identiteitsentrumgids: Gewone AWS-gebruikers
* Aktiewe Gids: Ondersteun verskillende skakelaar
* Eksterne Identiteitsverskaffer: Alle gebruikers en groepe kom van 'n eksterne Identiteitsverskaffer (IdP)

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

In die eenvoudigste geval van die Identiteitsentrumgids sal die **Identiteitsentrum 'n lys van gebruikers & groepe h√™** en sal in staat wees om **beleide aan hulle toe te ken** vir **enige van die rekeninge** van die organisasie.

Om toegang te gee aan 'n Identiteitsentrum-gebruiker/groep tot 'n rekening, sal 'n **SAML Identiteitsverskaffer wat die Identiteitsentrum vertrou, geskep word**, en 'n **rol wat die Identiteitsverskaffer vertrou met die aangeduide beleide, sal in die bestemmingsrekening geskep word**.

#### AwsSSOInlinePolicy

Dit is moontlik om **volmagte te gee via inline beleide aan rolle wat geskep is deur middel van die IAM Identiteitsentrum**. Die rolle wat in die rekeninge geskep word en **inline beleide in AWS Identiteitsentrum** kry, sal hierdie volmagte h√™ in 'n inline beleid genaamd **`AwsSSOInlinePolicy`**.

Daarom, selfs as jy 2 rolle sien met 'n inline beleid genaamd **`AwsSSOInlinePolicy`**, beteken dit **nie dat dit dieselfde volmagte het nie**.

### Kruisrekeningvertroue en Rolle

**'n Gebruiker** (vertrouend) kan 'n Kruisrekeningrol met sekere beleide skep en dan, **'n ander gebruiker** (vertrou) toelaat om **toegang tot sy rekening te verkry**, maar slegs **met die toegang wat in die nuwe rolbeleide aangedui word**. Om dit te skep, skep net 'n nuwe Rol en kies Kruisrekeningrol. Rolle vir Kruisrekeningstoegang bied twee opsies aan. Verskaffing van toegang tussen AWS-rekeninge wat jy besit, en verskaffing van toegang tussen 'n rekening wat jy besit en 'n derde party AWS-rekening.\
Dit word aanbeveel om **die vertroude gebruiker te spesifiseer en nie iets algemeen te gebruik nie** omdat, as dit nie gedoen word nie, sal ander ge√Ødentifiseerde gebruikers soos gefedereerde gebruikers ook hierdie vertroue kan misbruik.

### AWS Eenvoudige AD

Nie ondersteun nie:

* Vertrouensverhoudings
* AD Adminsentrum
* Volledige PS API-ondersteuning
* AD Herwinbak
* Groep Bestuurde Diensrekeninge
* Skema-uitbreidings
* Geen Direkte toegang tot OS of Instansies

#### Webfederasie of OpenID-outentisering

Die toepassing gebruik die AssumeRoleWithWebIdentity om tydelike volmagte te skep. Dit gee egter nie toegang tot die AWS-konsole nie, slegs toegang tot hulpbronne binne AWS.

### Ander IAM-opsies

* Jy kan **'n wagwoordbeleid instel** met opsies soos minimum lengte en wagwoordvereistes.
* Jy kan 'n "Credential Report" **aflaai met inligting oor huidige volmagte** (soos gebruiker se skeppingstyd, is wagwoord geaktiveer...). Jy kan 'n volmagverslag genereer so dikwels as een keer elke **vier uur**.

AWS Identiteit en Toegangsbestuur (IAM) bied **fyngekorreleerde toegangsbeheer** regoor AWS. Met IAM kan jy **spesifiseer wie toegang tot watter dienste en hulpbronne kan verkry**, en onder watter voorwaardes. Met IAM-beleide bestuur jy volmagte vir jou werksmag en stelsels om **minste-privilege volmagte te verseker**.

### IAM-ID-voorvoegsels

In [**hierdie bladsy**](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_identifiers.html#identifiers-unique-ids) kan jy die **IAM-ID-voorvoegsels** van sleutels vind, afhangende van hul aard:

| ABIA | [AWS STS-diensdraer-token](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_bearer.html)                                                                                                         |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ACCA | Konteksspesifieke volmag                                                                                                                                                                                           |
| AGPA | Gebruikersgroep                                                                                                                                                                                                            |
| AIDA | IAM-gebruiker                                                                                                                                                                                                              |
| AIPA | Amazon EC2-instansieprofiel                                                                                                                                                                                           |
| AKIA | Toegangssleutel                                                                                                                                                                                                            |
| ANPA | Bestuurde beleid                                                                                                                                                                                                        |
| ANVA | Weergawe in 'n bestuurde beleid                                                                                                                                                                                           |
| APKA | Openbare sleutel                                                                                                                                                                                                            |
| AROA | Rol                                                                                                                                                                                                                  |
| ASCA | Sertifikaat                                                                                                                                                                                                           |
| ASIA | [Tydelike (AWS STS) toegangssleutel-ID's](https://docs.aws.amazon.com/STS/latest/APIReference/API\_Credentials.html) gebruik hierdie voorvoegsel, maar is slegs uniek in kombinasie met die geheime toegangssleutel en die sessietoken. |

### Aanbevole volmagte om rekeninge te ouditeer

Die volgende volmagte verleen verskillende leestoegang tot metadata:

* `arn:aws:iam::aws:policy/SecurityAudit`
* `arn:aws:iam::aws:policy/job-function/ViewOnlyAccess`
* `codebuild:ListProjects`
* `config:Describe*`
* `cloudformation:ListStacks`
* `logs:DescribeMetricFilters`
* `directconnect:DescribeConnections`
* `dynamodb:ListTables`

## Verskillende

### CLI-outentisering

Om 'n gewone gebruiker in staat te stel om via die AWS CLI te outentiseer, moet jy **plaaslike volmagte** h√™. Standaard kan jy hulle **handmatig** konfigureer in `~/.aws/credentials` of deur **`aws configure`** uit te voer.\
In daardie l√™er kan jy meer as een profiel h√™, as **geen profiel** gespesifiseer word nie
```
[default]
aws_access_key_id = AKIA5ZDCUJHF83HDTYUT
aws_secret_access_key = uOcdhof683fbOUGFYEQug8fUGIf68greoihef

[Admin]
aws_access_key_id = AKIA8YDCu7TGTR356SHYT
aws_secret_access_key = uOcdhof683fbOUGFYEQuR2EIHG34UY987g6ff7
region = eu-west-2
```
As jy toegang tot **verskillende AWS-rekeninge** benodig en jou profiel toegang gegee is om **'n rol binne daardie rekeninge aan te neem**, hoef jy nie elke keer handmatig STS te roep (`aws sts assume-role --role-arn <role-arn> --role-session-name sessname`) en die geloofsbriewe te konfigureer nie.

Jy kan die `~/.aws/config` l√™er gebruik om aan te dui watter rolle aangeneem moet word, en dan die `--profile` parameter soos gewoonlik gebruik (die `assume-role` sal op 'n deursigtige manier vir die gebruiker uitgevoer word).\
'n Voorbeeld van 'n konfigurasie-l√™er:
```
[profile acc2]
region=eu-west-2
role_arn=arn:aws:iam::<account-id>:role/<role-path>
role_session_name = <session_name>
source_profile = <profile_with_assume_role>
sts_regional_endpoints = regional
```
Met hierdie konfigurasie-l√™er kan jy dan die aws cli gebruik soos volg:
```
aws --profile acc2 ...
```
As jy iets soortgelyks soek vir die **blaaier**, kan jy die **uitbreiding** [**AWS Extend Switch Roles**](https://chrome.google.com/webstore/detail/aws-extend-switch-roles/jpmkfafbacpgapdghgdpembnojdlgkdl?hl=en) nagaan.

## Verwysings

* [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html)
* [https://aws.amazon.com/iam/](https://aws.amazon.com/iam/)
* [https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>
