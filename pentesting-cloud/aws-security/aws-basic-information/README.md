# AWS - Informazioni di Base

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team di HackTricks AWS)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Gerarchia dell'Organizzazione

![](<../../../.gitbook/assets/image (151).png>)

### Account

In AWS c'√® un **account principale,** che √® il **contenitore principale per tutti gli account** della tua **organizzazione**. Tuttavia, non √® necessario utilizzare quell'account per distribuire risorse, √® possibile creare **altri account per separare diversi AWS** infrastrutture tra di loro.

Questo √® molto interessante da un punto di vista **di sicurezza**, poich√© **un account non sar√† in grado di accedere alle risorse di un altro account** (tranne che siano creati ponti specifici), in questo modo √® possibile creare confini tra le distribuzioni.

Pertanto, ci sono **due tipi di account in un'organizzazione** (stiamo parlando di account AWS e non di account utente): un singolo account designato come account di gestione e uno o pi√π account membri.

*   Il **account di gestione (l'account principale)** √® l'account che si utilizza per creare l'organizzazione. Dall'account di gestione dell'organizzazione, √® possibile fare quanto segue:

* Creare account nell'organizzazione
* Invitare altri account esistenti all'organizzazione
* Rimuovere account dall'organizzazione
* Gestire inviti
* Applicare policy alle entit√† (radici, OU o account) all'interno dell'organizzazione
* Abilitare l'integrazione con i servizi AWS supportati per fornire funzionalit√† del servizio in tutti gli account dell'organizzazione.
* √à possibile accedere come utente principale utilizzando l'email e la password utilizzate per creare questo account principale/organizzazione.

L'account di gestione ha le **responsabilit√† di un account pagante** ed √® responsabile del pagamento di tutti i costi che sono accumulati dagli account membri. Non √® possibile modificare l'account di gestione di un'organizzazione.
* Gli **account membri** costituiscono tutti gli altri account di un'organizzazione. Un account pu√≤ essere membro di una sola organizzazione alla volta. √à possibile allegare una policy a un account per applicare controlli solo a quel determinato account.
* Gli account membri **devono utilizzare un indirizzo email valido** e possono avere un **nome**, in generale non saranno in grado di gestire la fatturazione (ma potrebbero essere autorizzati ad accedervi).
```
aws organizations create-account --account-name testingaccount --email testingaccount@lalala1233fr.com
```
### **Unit√† Organizzative**

Gli account possono essere raggruppati in **Unit√† Organizzative (OU)**. In questo modo, √® possibile creare **policy** per l'Unit√† Organizzativa che verranno **applicate a tutti gli account figli**. Si noti che un'OU pu√≤ avere altre OU come figli.
```bash
# You can get the root id from aws organizations list-roots
aws organizations create-organizational-unit --parent-id r-lalala --name TestOU
```
### Service Control Policy (SCP)

Una **policy di controllo del servizio (SCP)** √® una policy che specifica i servizi e le azioni che gli utenti e i ruoli possono utilizzare negli account che l'SCP influisce. Gli SCP sono **simili alle policy di autorizzazioni IAM** tranne che non concedono alcuna autorizzazione. Invece, gli SCP specificano le **autorizzazioni massime** per un'organizzazione, un'unit√† organizzativa (OU) o un account. Quando si attacca un SCP alla radice dell'organizzazione o a un'OU, l'**SCP limita le autorizzazioni per le entit√† negli account membri**.

Questo √® l'UNICO modo in cui **anche l'utente root pu√≤ essere fermato** dall'eseguire determinate azioni. Ad esempio, potrebbe essere utilizzato per impedire agli utenti di disabilitare CloudTrail o eliminare i backup.\
L'unico modo per aggirare ci√≤ √® compromettere anche l'**account principale** che configura gli SCP (l'account principale non pu√≤ essere bloccato).

{% hint style="warning" %}
Nota che **gli SCP limitano solo i principali nell'account**, quindi gli altri account non sono interessati. Ci√≤ significa che negare a un SCP `s3:GetObject` non impedir√† alle persone di **accedere a un bucket S3 pubblico** nel tuo account.
{% endhint %}

Esempi di SCP:

* Negare completamente l'account root
* Consentire solo regioni specifiche
* Consentire solo servizi autorizzati
*   Negare la disabilitazione di GuardDuty, CloudTrail e l'accesso pubblico a S3
*   Negare la cancellazione o modifica dei ruoli di sicurezza/incident response
* Negare la cancellazione dei backup
* Negare la creazione di utenti IAM e chiavi di accesso

Trova **esempi in formato JSON** su [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html)

### ARN

**Amazon Resource Name** √® il **nome univoco** che ogni risorsa all'interno di AWS ha, √® composto come segue:
```
arn:partition:service:region:account-id:resource-type/resource-id
arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env
```
Nota che ci sono 4 partizioni in AWS ma solo 3 modi per chiamarle:

* AWS Standard: `aws`
* AWS China: `aws-cn`
* AWS US public Internet (GovCloud): `aws-us-gov`
* AWS Secret (US Classified): `aws`

## IAM - Identity and Access Management

IAM √® il servizio che ti permetter√† di gestire **Autenticazione**, **Autorizzazione** e **Controllo degli Accessi** all'interno del tuo account AWS.

* **Autenticazione** - Processo di definizione di un'identit√† e la verifica di tale identit√†. Questo processo pu√≤ essere suddiviso in: Identificazione e verifica.
* **Autorizzazione** - Determina a cosa pu√≤ accedere un'identit√† all'interno di un sistema una volta che √® stata autenticata.
* **Controllo degli Accessi** - Il metodo e il processo di come viene concesso l'accesso a una risorsa sicura.

IAM pu√≤ essere definito dalla sua capacit√† di gestire, controllare e governare meccanismi di autenticazione, autorizzazione e controllo degli accessi delle identit√† alle risorse all'interno del tuo account AWS.

### [Utente root dell'account AWS](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_root-user.html) <a href="#id_root" id="id_root"></a>

Quando crei per la prima volta un account Amazon Web Services (AWS), inizi con un'unica identit√† di accesso che ha **accesso completo a tutti** i servizi e le risorse AWS nell'account. Questo √® l'utente _**root**_ dell'account AWS e si accede utilizzando l'**indirizzo email e la password** che hai usato per creare l'account.

Nota che un nuovo **utente amministratore** avr√† **meno permessi rispetto all'utente root**.

Da un punto di vista della sicurezza, √® consigliabile creare altri utenti e evitare di utilizzare questo.

### [Utenti IAM](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_users.html) <a href="#id_iam-users" id="id_iam-users"></a>

Un _utente_ IAM √® un'entit√† che crei in AWS per **rappresentare la persona o l'applicazione** che lo utilizza per **interagire con AWS**. Un utente in AWS √® composto da un nome e credenziali (password e fino a due chiavi di accesso).

Quando crei un utente IAM, gli concedi **autorizzazioni** rendendolo un **membro di un gruppo di utenti** a cui sono associate le politiche di autorizzazione appropriate (raccomandato), o **collegando direttamente le politiche** all'utente.

Gli utenti possono avere **MFA abilitato per l'accesso** tramite la console. I token API degli utenti con MFA abilitato non sono protetti da MFA. Se desideri **limitare l'accesso alle chiavi API di un utente utilizzando MFA** √® necessario indicare nella policy che per eseguire determinate azioni √® necessaria la presenza di MFA (esempio [**qui**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html)).

#### CLI

* **ID chiave di accesso**: 20 caratteri alfanumerici maiuscoli casuali come AKHDNAPO86BSHKDIRYT
* **ID chiave di accesso segreta**: 40 caratteri casuali maiuscoli e minuscoli: S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtU (Non √® possibile recuperare le ID chiave di accesso segrete perse).

Ogni volta che devi **cambiare la chiave di accesso**, questo √® il processo che dovresti seguire:\
_Creare una nuova chiave di accesso -> Applicare la nuova chiave al sistema/applicazione -> contrassegnare quella originale come inattiva -> Testare e verificare che la nuova chiave di accesso funzioni -> Eliminare la vecchia chiave di accesso_

### MFA - Autenticazione Multifattore

Viene utilizzata per **creare un fattore aggiuntivo per l'autenticazione** oltre ai tuoi metodi esistenti, come la password, creando quindi un livello di autenticazione multifattore.\
Puoi utilizzare un'applicazione virtuale gratuita o un dispositivo fisico. Puoi utilizzare app come autenticazione di Google gratuitamente per attivare un MFA in AWS.

Le policy con condizioni MFA possono essere collegate ai seguenti:

* Un utente IAM o gruppo
* Una risorsa come un bucket Amazon S3, una coda Amazon SQS o un topic Amazon SNS
* La policy di trust di un ruolo IAM che pu√≤ essere assunto da un utente

Se desideri **accedere tramite CLI** a una risorsa che **verifica la presenza di MFA** √® necessario chiamare **`GetSessionToken`**. Questo ti fornir√† un token con informazioni su MFA.\
Nota che le credenziali di **`AssumeRole` non contengono queste informazioni**.
```bash
aws sts get-session-token --serial-number <arn_device> --token-code <code>
```
Come **dichiarato qui**, ci sono molti casi in cui **MFA non pu√≤ essere utilizzato**.

### [Gruppi utenti IAM](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) <a href="#id_iam-groups" id="id_iam-groups"></a>

Un **gruppo utenti IAM** √® un modo per **associare le policy a pi√π utenti** contemporaneamente, il che pu√≤ rendere pi√π semplice gestire le autorizzazioni per quegli utenti. **Ruoli e gruppi non possono far parte di un gruppo**.

√à possibile associare una **policy basata sull'identit√† a un gruppo utenti** in modo che tutti gli **utenti** nel gruppo utenti **ricevano le autorizzazioni della policy**. **Non** √® possibile identificare un **gruppo utenti** come un **`Principal`** in una **policy** (come una policy basata sulle risorse) perch√© i gruppi si riferiscono alle autorizzazioni, non all'autenticazione, e i principali sono entit√† IAM autenticate.

Ecco alcune caratteristiche importanti dei gruppi utenti:

* Un **gruppo utenti** pu√≤ **contenere molti utenti**, e un **utente** pu√≤ **appartenere a pi√π gruppi**.
* I **gruppi utenti non possono essere nidificati**; possono contenere solo utenti, non altri gruppi utenti.
* Non esiste un **gruppo utenti predefinito che includa automaticamente tutti gli utenti nell'account AWS**. Se si desidera avere un gruppo utenti del genere, √® necessario crearlo e assegnare a ciascun nuovo utente.
* Il numero e la dimensione delle risorse IAM in un account AWS, come il numero di gruppi e il numero di gruppi di cui un utente pu√≤ essere membro, sono limitati. Per ulteriori informazioni, consultare [IAM and AWS STS quotas](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_iam-quotas.html).

### [Ruoli IAM](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles.html) <a href="#id_iam-roles" id="id_iam-roles"></a>

Un **ruolo IAM** √® molto **simile** a un **utente**, nel senso che √® un'**identit√† con policy di autorizzazione che determinano cosa** pu√≤ e non pu√≤ fare in AWS. Tuttavia, un ruolo **non ha credenziali** (password o chiavi di accesso) associate. Invece di essere associato in modo univoco a una persona, un ruolo √® destinato ad essere **assumibile da chiunque ne abbia bisogno (e abbia abbastanza permessi)**. Un **utente IAM pu√≤ assumere un ruolo per assumere temporaneamente** diverse autorizzazioni per un compito specifico. Un ruolo pu√≤ essere **assegnato a un** [**utente federato**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_providers.html) che accede utilizzando un provider di identit√† esterno anzich√© IAM.

Un ruolo IAM √® composto da **due tipi di policy**: Una **policy di trust**, che non pu√≤ essere vuota, definisce **chi pu√≤ assumere** il ruolo, e una **policy di autorizzazioni**, che non pu√≤ essere vuota, definisce **a cosa pu√≤ accedere**.

#### AWS Security Token Service (STS)

Il servizio AWS Security Token Service (STS) √® un servizio web che facilita l'**emissione di credenziali temporanee e a privilegi limitati**. √à specificamente progettato per:

### [Credenziali temporanee in IAM](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_temp.html) <a href="#id_temp-creds" id="id_temp-creds"></a>

Le **credenziali temporanee sono utilizzate principalmente con i ruoli IAM**, ma ci sono anche altri utilizzi. √à possibile richiedere credenziali temporanee che hanno un insieme di autorizzazioni pi√π restrittivo rispetto alle normali credenziali IAM dell'utente. Questo **impedisce** di **eseguire accidentalmente attivit√† non consentite** dalle credenziali pi√π restrittive. Un vantaggio delle credenziali temporanee √® che scadono automaticamente dopo un periodo di tempo prestabilito. Si ha il controllo sulla durata per cui le credenziali sono valide.

### Policy

#### Autorizzazioni della policy

Vengono utilizzate per assegnare autorizzazioni. Ci sono 2 tipi:

* Policy gestite da AWS (preconfigurate da AWS)
* Policy gestite dal cliente: Configurate da te. Puoi creare policy basate su policy gestite da AWS (modificandone una e creandone una tua), utilizzando il generatore di policy (una vista GUI che ti aiuta a concedere e negare autorizzazioni) o scrivendo la tua.

Per **default l'accesso** √® **negato**, l'accesso sar√† concesso se √® stato specificato un ruolo esplicito.\
Se esiste un singolo "Deny", esso sovrascriver√† l'"Allow", tranne per le richieste che utilizzano le credenziali di sicurezza radice dell'account AWS (che sono consentite per impostazione predefinita).
```javascript
{
"Version": "2012-10-17",  //Version of the policy
"Statement": [  //Main element, there can be more than 1 entry in this array
{
"Sid": "Stmt32894y234276923" //Unique identifier (optional)
"Effect": "Allow", //Allow or deny
"Action": [  //Actions that will be allowed or denied
"ec2:AttachVolume",
"ec2:DetachVolume"
],
"Resource": [ //Resource the action and effect will be applied to
"arn:aws:ec2:*:*:volume/*",
"arn:aws:ec2:*:*:instance/*"
],
"Condition": { //Optional element that allow to control when the permission will be effective
"ArnEquals": {"ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/instance-id"}
}
}
]
}
```
I [campi globali che possono essere utilizzati per condizioni in qualsiasi servizio sono documentati qui](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_policies\_condition-keys.html#condition-keys-resourceaccount).\
I [campi specifici che possono essere utilizzati per condizioni per servizio sono documentati qui](https://docs.aws.amazon.com/service-authorization/latest/reference/reference\_policies\_actions-resources-contextkeys.html).

#### Policy Inline

Questo tipo di policy √® **assegnato direttamente** a un utente, gruppo o ruolo. Quindi, non compare nell'elenco delle Policy poich√© pu√≤ essere utilizzato da chiunque altro.\
Le policy inline sono utili se si desidera **mantenere una rigorosa relazione uno a uno tra una policy e l'identit√†** a cui √® applicata. Ad esempio, si desidera essere sicuri che le autorizzazioni in una policy non vengano assegnate per errore a un'identit√† diversa da quella prevista. Quando si utilizza una policy inline, le autorizzazioni nella policy non possono essere erroneamente collegate all'identit√† sbagliata. Inoltre, quando si utilizza la Console di gestione AWS per eliminare quell'identit√†, le policy incorporate nell'identit√† vengono eliminate anche. Questo perch√© fanno parte dell'entit√† principale.

#### Policy del Bucket delle Risorse

Queste sono **policy** che possono essere definite nelle **risorse**. **Non tutte le risorse di AWS le supportano**.

Se un principale non ha un rifiuto esplicito su di esse e una policy delle risorse concede loro l'accesso, allora sono consentite.

### Limiti IAM

I limiti IAM possono essere utilizzati per **limitare le autorizzazioni a cui un utente o ruolo dovrebbe avere accesso**. In questo modo, anche se un diverso insieme di autorizzazioni viene concesso all'utente da una **diversa policy**, l'operazione **fallir√†** se prova a utilizzarle.

Un limite √® semplicemente una policy allegata a un utente che **indica il livello massimo di autorizzazioni che l'utente o il ruolo pu√≤ avere**. Quindi, **anche se l'utente ha accesso di amministratore**, se il limite indica che pu√≤ solo leggere i bucket S3, quello √® il massimo che pu√≤ fare.

**Questo**, **SCPs** e **seguire il principio del privilegio minimo** sono i modi per controllare che gli utenti non abbiano pi√π autorizzazioni di quelle di cui hanno bisogno.

### Policy di Sessione

Una policy di sessione √® una **policy impostata quando un ruolo viene assunto** in qualche modo. Questo sar√† come un **limite IAM per quella sessione**: ci√≤ significa che la policy di sessione non concede autorizzazioni ma le **limita a quelle indicate nella policy** (essendo le autorizzazioni massime quelle del ruolo).

Questo √® utile per **misure di sicurezza**: quando un amministratore sta per assumere un ruolo molto privilegiato, potrebbe limitare le autorizzazioni solo a quelle indicate nella policy di sessione nel caso in cui la sessione venga compromessa.
```bash
aws sts assume-role \
--role-arn <value> \
--role-session-name <value> \
[--policy-arns <arn_custom_policy1> <arn_custom_policy2>]
[--policy <file://policy.json>]
```
Nota che per impostazione predefinita **AWS potrebbe aggiungere le policy di sessione alle sessioni** che verranno generate a causa di terzi motivi. Ad esempio, in [ruoli ipotetici di Cognito non autenticati](../aws-services/aws-cognito-enum/cognito-identity-pools.md#accessing-iam-roles) per impostazione predefinita (utilizzando l'autenticazione avanzata), AWS generer√† **credenziali di sessione con una policy di sessione** che limita i servizi ai quali la sessione pu√≤ accedere [**alla seguente lista**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services).

Pertanto, se in un certo momento ti trovi di fronte all'errore "... perch√© nessuna policy di sessione consente il...", e il ruolo ha accesso per eseguire l'azione, √® perch√© **c'√® una policy di sessione che lo impedisce**.

### Federazione delle identit√†

La federazione delle identit√† **consente agli utenti provenienti da provider di identit√† esterni** ad AWS di accedere in modo sicuro alle risorse AWS senza dover fornire le credenziali utente AWS da un account utente IAM valido.\
Un esempio di provider di identit√† pu√≤ essere il tuo **Microsoft Active Directory** aziendale (tramite **SAML**) o servizi **OpenID** (come **Google**). L'accesso federato consentir√† quindi agli utenti al suo interno di accedere ad AWS.

Per configurare questa fiducia, viene generato un **Provider di identit√† IAM (SAML o OAuth)** che **conferir√† fiducia** all'**altra piattaforma**. Successivamente, almeno un **ruolo IAM viene assegnato (con fiducia) al Provider di identit√†**. Se un utente dalla piattaforma fidata accede ad AWS, lo far√† come il ruolo menzionato.

Tuttavia, di solito si desidera assegnare un **ruolo diverso a seconda del gruppo dell'utente** nella piattaforma di terze parti. Quindi, diversi **ruoli IAM possono fidarsi** del Provider di identit√† di terze parti e sar√† la piattaforma di terze parti a consentire agli utenti di assumere uno o l'altro ruolo.

<figure><img src="../../../.gitbook/assets/image (247).png" alt=""><figcaption></figcaption></figure>

### Centro delle identit√† IAM

Il Centro delle identit√† IAM di AWS (successore di AWS Single Sign-On) espande le capacit√† di Identity and Access Management (IAM) di AWS per fornire un **punto centrale** che riunisce **l'amministrazione degli utenti e il loro accesso agli account AWS** e alle applicazioni cloud.

Il dominio di accesso sar√† qualcosa come `<user_input>.awsapps.com`.

Per accedere agli utenti, ci sono 3 fonti di identit√† che possono essere utilizzate:

* Directory del Centro delle identit√†: Utenti AWS regolari
* Active Directory: Supporta diversi connettori
* Provider di identit√† esterno: Tutti gli utenti e i gruppi provengono da un Provider di identit√† esterno (IdP)

<figure><img src="../../../.gitbook/assets/image (279).png" alt=""><figcaption></figcaption></figure>

Nel caso pi√π semplice della directory del Centro delle identit√†, il **Centro delle identit√† avr√† un elenco di utenti e gruppi** e sar√† in grado di **assegnare policy** a essi per **qualsiasi account** dell'organizzazione.

Per concedere l'accesso a un utente/gruppo del Centro delle identit√† a un account, verr√† creato un **Provider di identit√† SAML che si fida del Centro delle identit√†**, e verr√† creato un **ruolo che si fida del Provider di identit√† con le policy indicate** nell'account di destinazione.

#### AwsSSOInlinePolicy

√à possibile **concedere autorizzazioni tramite policy inline ai ruoli creati tramite il Centro delle identit√† IAM**. I ruoli creati negli account a cui vengono **assegnate policy inline nel Centro delle identit√† IAM** avranno queste autorizzazioni in una policy inline chiamata **`AwsSSOInlinePolicy`**.

Pertanto, anche se vedi 2 ruoli con una policy inline chiamata **`AwsSSOInlinePolicy`**, **non significa che abbiano le stesse autorizzazioni**.

### Fiducie e ruoli tra account

**Un utente** (che si fida) pu√≤ creare un Ruolo tra account con alcune policy e quindi, **consentire a un altro utente** (fidato) di **accedere al suo account** ma solo **avendo l'accesso indicato nelle nuove policy del ruolo**. Per creare questo, basta creare un nuovo Ruolo e selezionare Ruolo tra account. I Ruoli per l'accesso tra account offrono due opzioni. Fornire accesso tra account AWS di tua propriet√† e fornire accesso tra un account di tua propriet√† e un account AWS di terze parti.\
Si consiglia di **specificare l'utente di fiducia e non inserire qualcosa di generico** perch√© altrimenti, altri utenti autenticati come utenti federati saranno in grado di abusare di questa fiducia.

### AWS Simple AD

Non supportato:

* Relazioni di fiducia
* Centro amministrativo AD
* Supporto completo API PS
* Cestino di riciclo AD
* Account di servizio gestiti dal gruppo
* Estensioni dello schema
* Nessun accesso diretto al sistema operativo o alle istanze

#### Federazione Web o Autenticazione OpenID

L'applicazione utilizza l'AssumeRoleWithWebIdentity per creare credenziali temporanee. Tuttavia, ci√≤ non concede l'accesso alla console AWS, ma solo l'accesso alle risorse all'interno di AWS.

### Altre opzioni IAM

* Puoi **impostare una policy sulla password** con opzioni come lunghezza minima e requisiti della password.
* Puoi **scaricare il "Report delle credenziali"** con informazioni sulle credenziali attuali (come l'ora di creazione dell'utente, se la password √® abilitata...). Puoi generare un report delle credenziali fino a una volta ogni **quattro ore**.

Identity and Access Management (IAM) di AWS fornisce un **controllo degli accessi dettagliato** su tutti i servizi AWS. Con IAM, puoi specificare **chi pu√≤ accedere a quali servizi e risorse**, e in quali condizioni. Con le policy IAM, gestisci le autorizzazioni per la tua forza lavoro e i sistemi per **garantire autorizzazioni a privilegi minimi**.

### Prefissi ID IAM

In [**questa pagina**](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_identifiers.html#identifiers-unique-ids) puoi trovare i **prefissi ID IAM** delle chiavi in base alla loro natura:

| ABIA | [Token di portatore del servizio AWS STS](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_bearer.html)                                                                                                         |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ACCA | Credenziale specifica del contesto                                                                                                                                                                                           |
| AGPA | Gruppo utenti                                                                                                                                                                                                            |
| AIDA | Utente IAM                                                                                                                                                                                                              |
| AIPA | Profilo istanza Amazon EC2                                                                                                                                                                                           |
| AKIA | Chiave di accesso                                                                                                                                                                                                            |
| ANPA | Policy gestita                                                                                                                                                                                                        |
| ANVA | Versione in una policy gestita                                                                                                                                                                                           |
| APKA | Chiave pubblica                                                                                                                                                                                                            |
| AROA | Ruolo                                                                                                                                                                                                                  |
| ASCA | Certificato                                                                                                                                                                                                           |
| ASIA | [ID chiavi temporanee (AWS STS)](https://docs.aws.amazon.com/STS/latest/APIReference/API\_Credentials.html) utilizza questo prefisso, ma √® univoco solo in combinazione con la chiave di accesso segreta e il token di sessione. |

### Autorizzazioni consigliate per verificare gli account

I seguenti privilegi concedono vari accessi in lettura ai metadati:

* `arn:aws:iam::aws:policy/SecurityAudit`
* `arn:aws:iam::aws:policy/job-function/ViewOnlyAccess`
* `codebuild:ListProjects`
* `config:Describe*`
* `cloudformation:ListStacks`
* `logs:DescribeMetricFilters`
* `directconnect:DescribeConnections`
* `dynamodb:ListTables`

## Varie

### Autenticazione CLI

Affinch√© un utente regolare possa autenticarsi ad AWS tramite CLI, √® necessario disporre di **credenziali locali**. Per impostazione predefinita √® possibile configurarle **manualmente** in `~/.aws/credentials` o **eseguendo** `aws configure`.\
In quel file √® possibile avere pi√π di un profilo, se **nessun profilo** viene specificato utilizzando la **cli aws**, verr√† utilizzato quello chiamato **`[default]`** in quel file.\
Esempio di file delle credenziali con pi√π di 1 profilo:
```
[default]
aws_access_key_id = AKIA5ZDCUJHF83HDTYUT
aws_secret_access_key = uOcdhof683fbOUGFYEQug8fUGIf68greoihef

[Admin]
aws_access_key_id = AKIA8YDCu7TGTR356SHYT
aws_secret_access_key = uOcdhof683fbOUGFYEQuR2EIHG34UY987g6ff7
region = eu-west-2
```
Se hai bisogno di accedere a **diversi account AWS** e il tuo profilo √® stato autorizzato ad **assumere un ruolo all'interno di quegli account**, non √® necessario chiamare manualmente STS ogni volta (`aws sts assume-role --role-arn <role-arn> --role-session-name sessname`) e configurare le credenziali.

Puoi utilizzare il file `~/.aws/config` per [**indicare quali ruoli assumere**](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html), e quindi utilizzare il parametro `--profile` come al solito (l'`assume-role` verr√† eseguito in modo trasparente per l'utente).\
Un esempio di file di configurazione:
```
[profile acc2]
region=eu-west-2
role_arn=arn:aws:iam::<account-id>:role/<role-path>
role_session_name = <session_name>
source_profile = <profile_with_assume_role>
sts_regional_endpoints = regional
```
Con questo file di configurazione √® possibile utilizzare aws cli in questo modo:
```
aws --profile acc2 ...
```
Se stai cercando qualcosa **simile** a questo ma per il **browser** puoi controllare l'**estensione** [**AWS Extend Switch Roles**](https://chrome.google.com/webstore/detail/aws-extend-switch-roles/jpmkfafbacpgapdghgdpembnojdlgkdl?hl=en).

## Riferimenti

* [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html)
* [https://aws.amazon.com/iam/](https://aws.amazon.com/iam/)
* [https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
