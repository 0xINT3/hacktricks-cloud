# AWS - 基本情報

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **会社をハックトリックで宣伝したい**場合や、**最新バージョンのPEASSを見たい**場合、または**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をご覧ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションをご覧ください
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## 組織の階層

![](<../../../.gitbook/assets/image (54).png>)

### アカウント

AWSでは、組織のすべてのアカウントの**親コンテナであるルートアカウント**があります。ただし、リソースをデプロイするためにそのアカウントを使用する必要はありません。異なるAWSインフラストラクチャを区別するために、**他のアカウントを作成**することができます。

これは、**セキュリティの観点から非常に興味深い**です。なぜなら、**1つのアカウントは他のアカウントのリソースにアクセスできない**（特別に作成されたブリッジを除く）ため、デプロイメント間に境界を作成できるからです。

したがって、組織内には**2種類のアカウント**があります（AWSアカウントではなくユーザーアカウントについて話しています）：管理アカウントと1つ以上のメンバーアカウントです。

*   **管理アカウント（ルートアカウント）**は、組織を作成するために使用するアカウントです。組織の管理アカウントから、次の操作を行うことができます：

* 組織内でアカウントを作成する
* 他の既存のアカウントを組織に招待する
* アカウントを組織から削除する
* 招待を管理する
* 組織内のエンティティ（ルート、OU、またはアカウント）にポリシーを適用する
* サポートされているAWSサービスとの統合を有効にして、組織内のすべてのアカウントでサービス機能を提供する。
* このルートアカウント/組織を作成するために使用したメールアドレスとパスワードでルートユーザーとしてログインすることが可能です。

管理アカウントは**支払いアカウントの責任**を持ち、メンバーアカウントが発生するすべての料金を支払う責任があります。組織の管理アカウントを変更することはできません。
* **メンバーアカウント**は、組織内の他のすべてのアカウントを構成します。アカウントは同時に1つの組織のメンバーになることができます。アカウントにポリシーを添付して、そのアカウントにのみ制御を適用することができます。
* メンバーアカウントは**有効なメールアドレスを使用**し、**名前**を持つことができますが、一般的には請求を管理することはできません（ただし、アクセス権限が与えられる場合もあります）。
```
aws organizations create-account --account-name testingaccount --email testingaccount@lalala1233fr.com
```
### **組織単位**

アカウントは**組織単位（OU）**にグループ化することができます。これにより、組織単位に対して**ポリシー**を作成し、**子アカウント全体に適用**することができます。なお、OUは他のOUを子として持つことができます。
```bash
# You can get the root id from aws organizations list-roots
aws organizations create-organizational-unit --parent-id r-lalala --name TestOU
```
### サービス制御ポリシー（SCP）

**サービス制御ポリシー（SCP）**は、SCPが影響を及ぼすアカウントでユーザーやロールが使用できるサービスとアクションを指定するポリシーです。SCPはIAMの権限ポリシーと似ていますが、**権限を付与しません**。代わりに、SCPは組織、組織単位（OU）、またはアカウントの**最大権限**を指定します。SCPを組織ルートまたはOUにアタッチすると、**SCPはメンバーアカウント内のエンティティの権限を制限**します。

これは、**ルートユーザーですら制限**される唯一の方法です。例えば、CloudTrailの無効化やバックアップの削除をユーザーが行えないようにするために使用することができます。\
これを回避する唯一の方法は、SCPを設定する**マスターアカウント**自体を侵害することです（マスターアカウントはブロックできません）。

{% hint style="warning" %}
SCPはアカウント内のプリンシパルにのみ制限をかけるため、他のアカウントには影響を与えません。つまり、SCPが`s3:GetObject`を拒否しても、他のアカウントの人々がアカウント内の**パブリックS3バケットにアクセスすることを防ぎません**。
{% endhint %}

SCPの例：

* ルートアカウントを完全に拒否する
* 特定のリージョンのみを許可する
* ホワイトリストに登録されたサービスのみを許可する
*   GuardDuty、CloudTrail、およびS3 Public Block Accessの無効化を拒否する
*   セキュリティ/インシデント対応ロールの削除や変更を拒否する
* バックアップの削除を拒否する
* IAMユーザーとアクセスキーの作成を拒否する

[https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html)で**JSONの例**を見つけることができます。

### ARN

**Amazon Resource Name（ARN）**は、AWS内のすべてのリソースが持つ**一意の名前**です。以下のように構成されています：
```
arn:partition:service:region:account-id:resource-type/resource-id
arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env
```
## IAM - Identity and Access Management

IAMは、AWSアカウント内での**認証**、**認可**、および**アクセス制御**を管理するためのサービスです。

* **認証** - アイデンティティの定義とそのアイデンティティの検証のプロセスです。このプロセスは、識別と検証の2つの部分に分けることができます。
* **認可** - 認証が行われた後、システム内でアイデンティティがアクセスできるものを決定します。
* **アクセス制御** - セキュリティリソースへのアクセスがどのように許可されるかの方法とプロセスです。

IAMは、AWSアカウント内のリソースへのアイデンティティの認証、認可、およびアクセス制御メカニズムを管理、制御、ガバナンスする能力によって定義されます。

### [AWSアカウントのルートユーザー](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_root-user.html) <a href="#id_root" id="id_root"></a>

Amazon Web Services（AWS）アカウントを最初に作成すると、アカウント内のすべてのAWSサービスとリソースに**完全なアクセス権限を持つ**単一のサインインアイデンティティが作成されます。これがAWSアカウントの_**ルートユーザー**_であり、アカウントの作成時に使用した**メールアドレスとパスワード**でサインインすることでアクセスできます。

新しい**管理者ユーザー**は、ルートユーザーよりも**制限された権限**を持ちます。

セキュリティの観点からは、他のユーザーを作成し、このルートユーザーを使用しないことが推奨されます。

### [IAMユーザー](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_users.html) <a href="#id_iam-users" id="id_iam-users"></a>

IAMユーザーは、AWSで作成するエンティティであり、それを使用してAWSとのやり取りを行う**人物またはアプリケーションを表す**ものです。AWSのユーザーは、名前と資格情報（パスワードと最大2つのアクセスキー）で構成されます。

IAMユーザーを作成すると、それを適切な権限ポリシーがアタッチされた**ユーザーグループのメンバー**にすることで、権限を付与します（推奨方法）またはユーザーに**直接ポリシーをアタッチ**することで権限を付与します。

ユーザーは、コンソールを介してログインする際に**MFAを有効にする**ことができます。MFAが有効なユーザーのAPIトークンはMFAによって保護されません。ユーザーのAPIキーのアクセスをMFAで制限するには、ポリシーで特定のアクションを実行するためにMFAが必要であることを示す必要があります（例は[**こちら**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html)）。

#### CLI

* **アクセスキーID**：AKHDNAPO86BSHKDIRYTのような20文字のランダムな大文字英数字
* **シークレットアクセスキーID**：S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtUのような40文字のランダムな大文字と小文字の英数字（紛失したシークレットアクセスキーIDを取得することはできません）。

アクセスキーを**変更する必要がある場合**は、次の手順に従う必要があります：\
_新しいアクセスキーを作成 -> システム/アプリケーションに新しいキーを適用 -> 元のキーを無効にする -> 新しいアクセスキーが動作することをテストおよび検証 -> 古いアクセスキーを削除する_

### MFA - マルチファクタ認証

これは、パスワードなどの既存の方法に加えて、認証のための**追加の要素を作成するために使用される**ものであり、したがって、マルチファクタ認証レベルを作成します。\
無料の仮想アプリケーションまたは物理デバイスを使用することができます。Google認証などのアプリを使用して、AWSでMFAを有効にするために無料で使用することができます。

MFA条件を持つポリシーは、次のものにアタッチできます：

* IAMユーザーまたはグループ
* Amazon S3バケット、Amazon SQSキュー、またはAmazon SNSトピックなどのリソース
* ユーザーによって引き受けられることができるIAMロールの信頼ポリシー

MFAをチェックするリソースに**CLI経由でアクセス**する場合は、**`GetSessionToken`**を呼び出す必要があります。これにより、MFAに関する情報が含まれたトークンが取得できます。\
なお、**`AssumeRole`の資格情報にはこの情報が含まれていません**。
```bash
aws sts get-session-token --serial-number <arn_device> --token-code <code>
```
[**ここで述べられているように**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html)、**MFAを使用できない**さまざまなケースがあります。

### [IAMユーザーグループ](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) <a href="#id_iam-groups" id="id_iam-groups"></a>

IAM [ユーザーグループ](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html)は、**複数のユーザーにポリシーを一括で割り当てる**方法であり、これによりこれらのユーザーの権限を管理しやすくすることができます。**ロールとグループはグループの一部になることはできません**。

**ユーザーグループにアイデンティティベースのポリシーを割り当てる**ことで、ユーザーグループの**すべてのユーザーがポリシーの権限を受け取る**ことができます。グループは認証ではなく権限に関連しているため、グループをポリシーの**`Principal`**として識別することはできません（リソースベースのポリシーなど）。以下はユーザーグループの重要な特徴です：

- ユーザーグループは**多くのユーザーを含む**ことができ、**ユーザー**は**複数のグループに所属**することができます。
- **ユーザーグループはネストできません**。ユーザーグループには他のユーザーグループではなく、ユーザーのみを含めることができます。
- **AWSアカウントのすべてのユーザーを自動的に含むデフォルトのユーザーグループはありません**。そのようなユーザーグループを作成し、各新しいユーザーを割り当てる必要があります。
- IAMリソースの数やサイズ（グループの数、ユーザーが所属できるグループの数など）には制限があります。詳細については、[IAMおよびAWS STSのクォータ](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_iam-quotas.html)を参照してください。

### [IAMロール](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles.html) <a href="#id_iam-roles" id="id_iam-roles"></a>

IAM **ロール**は、AWSでの操作の許可ポリシーを持つ**ユーザー**と非常に**似ています**。ただし、ロールには関連する認証情報（パスワードやアクセスキー）はありません。ロールは、必要な人が一時的に異なる権限を持つために**アサインできる**ように設計されています。IAMユーザーは、特定のタスクのために一時的に異なる権限を持つためにロールを**アサイン**することができます。ロールは、IAMではなく外部のアイデンティティプロバイダを使用してサインインする[**フェデレーテッドユーザー**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_providers.html)に**アサイン**することもできます。

IAMロールには、**2つのタイプのポリシー**があります：**信頼ポリシー**（空にすることはできません）は、**ロールをアサインできるユーザー**を定義し、**許可ポリシー**（空にすることはできません）は、**アクセスできる内容**を定義します。

#### AWSセキュリティトークンサービス（STS）

これは、AWS Identity and Access Management（IAM）ユーザーや認証されたユーザー（フェデレーテッドユーザー）のために、**一時的な制限付き特権の資格情報**を要求できるウェブサービスです。

### [IAMの一時的な資格情報](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_temp.html) <a href="#id_temp-creds" id="id_temp-creds"></a>

**一時的な資格情報は主にIAMロールと共に使用**されますが、他の用途もあります。一時的な資格情報を要求すると、標準のIAMユーザーよりも制限された権限セットを持つ一時的な資格情報を取得できます。これにより、より制限された資格情報で許可されていないタスクを誤って実行することを防ぐことができます。一時的な資格情報の利点は、一定期間後に自動的に期限切れになることです。資格情報の有効期間を制御できます。

### ポリシー

#### ポリシーの権限

権限を割り当てるために使用されます。2つのタイプがあります：

- AWS管理ポリシー（AWSによって事前に設定されたポリシー）
- カスタマーマネージドポリシー：ユーザーが設定するポリシー。AWS管理ポリシーを基にポリシーを作成できます（それらの1つを変更して独自のポリシーを作成する）、ポリシージェネレータ（許可と拒否の権限を助けるGUIビュー）を使用するか、独自のポリシーを作成することができます。

**デフォルトではアクセスは拒否**され、明示的なロールが指定されている場合にのみアクセスが許可されます。\
**単一の"Deny"が存在する場合、"Allow"は上書きされます**が、AWSアカウントのルートセキュリティ資格情報を使用するリクエストはデフォルトで許可されます。
```javascript
{
"Version": "2012-10-17",  //Version of the policy
"Statement": [  //Main element, there can be more than 1 entry in this array
{
"Sid": "Stmt32894y234276923" //Unique identifier (optional)
"Effect": "Allow", //Allow or deny
"Action": [  //Actions that will be allowed or denied
"ec2:AttachVolume",
"ec2:DetachVolume"
],
"Resource": [ //Resource the action and effect will be applied to
"arn:aws:ec2:*:*:volume/*",
"arn:aws:ec2:*:*:instance/*"
],
"Condition": { //Optional element that allow to control when the permission will be effective
"ArnEquals": {"ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/instance-id"}
}
}
]
}
```
#### インラインポリシー

この種のポリシーは、ユーザー、グループ、またはロールに**直接割り当て**られます。そのため、他のポリシーと同様にポリシーリストに表示されません。\
インラインポリシーは、ポリシーとそれが適用されるアイデンティティの間に**厳密な一対一の関係を維持**したい場合に便利です。たとえば、ポリシーの許可が意図したアイデンティティ以外のアイデンティティに誤って割り当てられないようにする場合に使用します。インラインポリシーを使用すると、ポリシーの許可は誤って誤ったアイデンティティに割り当てられることはありません。さらに、AWS Management Consoleを使用してそのアイデンティティを削除すると、アイデンティティに埋め込まれたポリシーも削除されます。それは、それらが主体エンティティの一部であるためです。

#### リソースバケットポリシー

これらは**リソース**に定義できる**ポリシー**です。**AWSのすべてのリソースがそれらをサポートしているわけではありません**。

プリンシパルに明示的な拒否がなく、リソースポリシーがアクセスを許可する場合、アクセスが許可されます。

### IAMバウンダリー

IAMバウンダリーは、ユーザーやロールがアクセスできる権限を**制限するために使用**できます。これにより、**異なるポリシー**によってユーザーに異なる権限セットが付与されても、操作が**失敗する**ようになります。

バウンダリーは、ユーザーに**最大レベルの権限を示す**ポリシーが添付されたものです。したがって、ユーザーが管理者アクセス権を持っていても、バウンダリーがS3バケットの読み取りのみを許可すると示している場合、それができることの最大範囲です。

**これ**、**SCP**、および**最小特権**の原則に従うことは、ユーザーが必要以上の権限を持たないように制御する方法です。

### セッションポリシー

セッションポリシーは、ロールが**仮定されるときに設定されるポリシー**です。これは、そのセッションのための**IAMバウンダリーのようなもの**です：つまり、セッションポリシーは許可を与えるのではなく、ポリシーで指示された権限に**制限をかけます**（ロールが持つ最大の権限がそれです）。

これは**セキュリティ対策**に役立ちます：管理者が非常に特権のあるロールを仮定する場合、セッションが侵害された場合にセッションポリシーで指示された権限のみを制限することができます。
```bash
aws sts assume-role \
--role-arn <value> \
--role-session-name <value> \
[--policy-arns <arn_custom_policy1> <arn_custom_policy2>]
[--policy <file://policy.json>]
```
デフォルトでは、AWSはサードパーティの理由によって生成されるセッションにセッションポリシーを追加する可能性があります。たとえば、[未認証のCognitoが想定するロール](../aws-services/aws-cognito-enum/cognito-identity-pools.md#accessing-iam-roles)では、デフォルトで（強化認証を使用して）AWSはセッションポリシーを持つセッション資格情報を生成します。このセッションポリシーは、セッションがアクセスできるサービスを[次のリスト](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services)に制限します。

したがって、ある時点で「... because no session policy allows the ...」というエラーが発生し、ロールがアクションを実行する権限を持っている場合、それはセッションポリシーがそれを防いでいるためです。

### アイデンティティフェデレーション

アイデンティティフェデレーションは、AWS外部のアイデンティティプロバイダからAWSリソースに安全にアクセスするためのもので、有効なIAMユーザーアカウントのAWSユーザー資格情報を提供する必要がありません。
アイデンティティプロバイダの例としては、独自の企業の**Microsoft Active Directory**（**SAML**を介して）や**OpenID**サービス（**Google**など）があります。フェデレーテッドアクセスにより、それに含まれるユーザーはAWSにアクセスできます。

この信頼を構成するためには、**IAMアイデンティティプロバイダ（SAMLまたはOAuth）**が生成され、**他のプラットフォーム**を**信頼**します。その後、少なくとも1つの**IAMロールが（信頼して）アイデンティティプロバイダに割り当てられます**。信頼されたプラットフォームのユーザーがAWSにアクセスすると、指定されたロールとしてアクセスします。

ただし、通常はサードパーティプラットフォームのユーザーグループに応じて**異なるロールを割り当てたい**と思うでしょう。そのため、複数の**IAMロールがサードパーティのアイデンティティプロバイダを信頼**し、サードパーティプラットフォームがユーザーに1つまたは他のロールをアサインできるようにします。

<figure><img src="../../../.gitbook/assets/image (1) (2).png" alt=""><figcaption></figcaption></figure>

### IAM Identity Center

AWS IAM Identity Center（AWS Single Sign-Onの後継）は、AWS Identity and Access Management（IAM）の機能を拡張し、AWSアカウントとクラウドアプリケーションへのユーザーの管理とアクセスを**1つの中央の場所**にまとめます。

ログインドメインは、`<user_input>.awsapps.com`のようになります。

ユーザーをログインさせるためには、次の3つのアイデンティティソースを使用できます。

* Identity Center Directory：通常のAWSユーザー
* Active Directory：さまざまなコネクタをサポート
* 外部アイデンティティプロバイダ：すべてのユーザーとグループは外部アイデンティティプロバイダ（IdP）から来ます

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Identity Centerディレクトリの最も単純な場合では、**Identity Centerにはユーザーとグループのリストがあり**、それらに対して**組織のいずれかのアカウントにポリシーを割り当てることができます**。

Identity Centerユーザー/グループにアカウントへのアクセス権を付与するためには、**Identity Centerを信頼するSAML Identity Providerが作成され**、指定されたポリシーでIdentity Providerを信頼する**ロールが宛先アカウントに作成されます**。

#### AwsSSOInlinePolicy

IAM Identity Centerで作成されたロールに**インラインポリシーを介して権限を付与することができます**。AWS Identity Centerで**インラインポリシーを持つアカウントで作成されたロール**は、**`AwsSSOInlinePolicy`**という名前のインラインポリシーにこれらの権限があります。

したがって、**`AwsSSOInlinePolicy`**という名前のインラインポリシーを持つ2つのロールがある場合でも、**同じ権限を持っているわけではない**ことに注意してください。

### クロスアカウントの信頼とロール

**信頼するユーザー**は、一部のポリシーを持つクロスアカウントロールを作成し、**別のユーザー**（信頼されるユーザー）が**アクセスできるようにする**ことができますが、その際には新しいロールポリシーで指定されたアクセスのみが可能です。これを作成するには、単に新しいロールを作成し、クロスアカウントロールを選択します。クロスアカウントアクセス用のロールには、所有するAWSアカウント間のアクセスと、所有するアカウントとサードパーティのAWSアカウント間のアクセスの2つのオプションがあります。
他の認証済みユーザー（フェデレーテッドユーザーなど）がこの信頼を悪用することがないように、**信頼されるユーザーを特定する**ことをお勧めします。

### AWS Simple AD

サポートされていません：

* 信頼関係
* AD管理センター
* 完全なPS APIサポート
* ADリサイクルビン
* グループ管理サービスアカウント
* スキーマ拡張
* OSまたはインスタンスへの直接アクセスはありません

#### WebフェデレーションまたはOpenID認証

このアプリは、AssumeRoleWithWebIdentityを使用して一時的な資格情報を作成します。ただし、これによりAWSコンソールへのアクセスは許可されません。AWS内のリソースにのみアクセスできます。

### その他のIAMオプション

* 最小長やパスワードの要件など、パスワードポリシー設定を行うことができます。
* 現在の資格情報に関する情報（ユーザー作成時刻、パスワードが有効かどうかなど）を含む「資格情報レポート」を**ダウンロード**することができます。資格情報レポートは、最大で**4時間ごと**に生成できます。

AWS Identity and Access Management（IAM）は、AWS全体で**細かいアクセス制御**を提供します。IAMを使用すると、**誰がどのサービスとリソースにアクセスできるか**、およびどの条件の下でアクセスできるかを指定できます。IAMポリシーを使用して、ワークフォースとシステムへの権限を管理し、**最小特権の権限**を確保します。

### IAM IDのプレフィックス

[**このページ**](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_identifiers.html#identifiers-unique-ids)では、キーのIAM IDプレフィックスをその性質に応じて見つけることができます。

| ABIA | [AWS STSサービスベアラートークン](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_bearer.html) |
| ---- | --------------------------------------------------------------------- |
| ACCA | コンテキスト固有の資格情報                                             |
| AGPA | ユーザーグループ                                                     |
| AIDA | IAMユーザー                                                           |
| AIPA | Amazon EC2インスタンスプロファイル                                     |
| AKIA | アクセスキー                                                         |
| ANPA | 管理ポリシー                                                         |
| ANVA | 管理ポリシーのバージョン                                               |
| APKA | 公開鍵                                                               |
| AROA
## その他

### CLI認証

AWSのCLIを通じて一般ユーザーが認証するためには、**ローカルの資格情報**が必要です。デフォルトでは、`~/.aws/credentials`に**手動で**設定するか、`aws configure`を**実行**することで設定できます。\
そのファイルでは、複数のプロファイルを持つことができます。AWS CLIで**プロファイルが指定されていない**場合、そのファイル内の`[default]`という名前のプロファイルが使用されます。\
複数のプロファイルを持つ資格情報ファイルの例:
```
[default]
aws_access_key_id = AKIA5ZDCUJHF83HDTYUT
aws_secret_access_key = uOcdhof683fbOUGFYEQug8fUGIf68greoihef

[Admin]
aws_access_key_id = AKIA8YDCu7TGTR356SHYT
aws_secret_access_key = uOcdhof683fbOUGFYEQuR2EIHG34UY987g6ff7
region = eu-west-2
```
**異なるAWSアカウント**にアクセスする必要があり、プロファイルが**それらのアカウント内での役割を引き受ける権限**を与えられている場合、毎回STSを手動で呼び出して(`aws sts assume-role --role-arn <role-arn> --role-session-name sessname`)認証情報を設定する必要はありません。

`~/.aws/config`ファイルを使用して、[**引き受ける役割を指定**](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html)し、通常通り`--profile`パラメータを使用することができます（`assume-role`はユーザーに対して透過的に実行されます）。
設定ファイルの例：
```
[profile acc2]
region=eu-west-2
role_arn=arn:aws:iam::<account-id>:role/<role-path>
role_session_name = <session_name>
source_profile = <profile_with_assume_role>
sts_regional_endpoints = regional
```
この設定ファイルを使用して、次のようにaws cliを使用できます：
```
aws --profile acc2 ...
```
もしもあなたがブラウザ向けの同様のものを探しているなら、[AWS Extend Switch Roles](https://chrome.google.com/webstore/detail/aws-extend-switch-roles/jpmkfafbacpgapdghgdpembnojdlgkdl?hl=en)という**拡張機能**をチェックしてみてください。

## 参考文献

* [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html)
* [https://aws.amazon.com/iam/](https://aws.amazon.com/iam/)
* [https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もしもあなたの**会社をHackTricksで宣伝したい**場合や、**最新版のPEASSを入手したい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)を手に入れましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)をフォローしましょう。
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出して、あなたのハッキングトリックを共有しましょう。

</details>
