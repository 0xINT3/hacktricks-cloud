# AWS - Cognito 認証されていない列挙

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>

## 認証されていないCognito

Cognitoは、開発者が**アプリユーザーにAWSサービスへのアクセスを許可する**ことを可能にするAWSサービスです。開発者は、アプリ内の**認証されたユーザーにIAMロールを付与する**（人々はサインアップするだけでアクセスできる可能性があります）だけでなく、**認証されていないユーザーにIAMロールを付与する**こともできます。

Cognitoに関する基本情報については、以下をチェックしてください:

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### ペネトレーションテストと列挙のためのPacuモジュール

AWSエクスプロイトフレームワークである[Pacu](https://github.com/RhinoSecurityLabs/pacu)には、アカウント内のすべてのCognitoアセットを列挙し、弱い設定、アクセス制御に使用されるユーザー属性などをフラグ付けする「cognito__enum」モジュールと、「cognito__attack」モジュールが含まれています。また、ユーザー作成（MFAサポートを含む）と、変更可能なカスタム属性、使用可能なアイデンティティプールの資格情報、idトークン内の引き受け可能なロールなどに基づく権限昇格を自動化します。

モジュールの機能の説明については、[ブログ投稿](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2)のパート2を参照してください。インストール手順については、メインの[Pacu](https://github.com/RhinoSecurityLabs/pacu)ページを参照してください。

### 使用法

特定のアイデンティティプールとユーザープールクライアントに対してユーザー作成とすべての権限昇格ベクトルを試みるcognito__attackの使用例：
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
```
Sample cognito__enumの使用例は、現在のAWSアカウントで見えるすべてのユーザープール、ユーザープールクライアント、アイデンティティプール、ユーザーなどを収集するためのものです:
```
```bash
Pacu (new:test) > run cognito__enum
```
### Identity Pool ID

Identity Poolsは、**Identity Pool IDを知っている**未認証ユーザーに**IAMロールを付与**することができます（これは一般的に**見つける**ことができます）。この情報を持つ攻撃者は、その**IAMロールにアクセス**し、それを悪用する可能性があります。
さらに、IAMロールはIdentity Poolにアクセスする**認証済みユーザー**にも割り当てられる可能性があります。攻撃者が**ユーザーを登録**することができるか、またはIdentity Poolで使用されている**アイデンティティプロバイダー**に既に**アクセス**している場合、認証済みユーザーに与えられている**IAMロールにアクセス**し、その特権を悪用することができます。

[**こちらでその方法を確認してください**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### User Pool ID

デフォルトではCognitoは**新規ユーザーの登録**を許可しています。ユーザーを登録できると、**基盤となるアプリケーション**への**アクセス**や、Cognito User Poolをアイデンティティプロバイダーとして受け入れているIdentity Poolの**認証済みIAMアクセスロール**にアクセスできる可能性があります。[**こちらでその方法を確認してください**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)で</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>!</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォロー**してください。
* **HackTricks**の[**githubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有してください。

</details>
