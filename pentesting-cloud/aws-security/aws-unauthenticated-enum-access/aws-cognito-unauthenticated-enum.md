# AWS - Cognito Unauthenticated Enum

<details>

<summary><strong>ゼロからヒーローまでAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**または[telegramグループ](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)で**フォロー**する。
- **ハッキングトリックを共有するために、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。**

</details>

## Unauthenticated Cognito

Cognitoは、開発者が**アプリユーザーにAWSサービスへのアクセス権を付与**できるようにするAWSサービスです。開発者は、アプリ内の**認証済みユーザーにIAMロールを付与**し（おそらく人々は単にサインアップすることができるかもしれません）、**未認証ユーザーにIAMロールを付与**することもできます。

Cognitoの基本情報については、以下をチェックしてください：

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### ペンテストと列挙のためのPacuモジュール

AWSのExploitationフレームワークである[Pacu](https://github.com/RhinoSecurityLabs/pacu)には、現在、アカウント内のすべてのCognitoアセットの列挙を自動化し、弱い構成、アクセス制御に使用されるユーザー属性などをフラグ付けし、ユーザーの作成（MFAサポートを含む）や、変更可能なカスタム属性に基づく特権昇格、使用可能なアイデンティティプール資格情報、IDトークン内の仮定可能なロールなどを自動化する「cognito__enum」と「cognito__attack」モジュールが含まれています。

モジュールの機能の説明については、[ブログ記事](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2)の第2部を参照してください。インストール手順については、メインの[Pacu](https://github.com/RhinoSecurityLabs/pacu)ページをご覧ください。

### 使用方法

指定されたアイデンティティプールとユーザープールクライアントに対してユーザーの作成とすべての特権昇格ベクトルを試すためのcognito__attackの使用例：
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
以下は、現在のAWSアカウントで表示されるすべてのユーザープール、ユーザープールクライアント、アイデンティティプール、ユーザーなどを収集するためのcognito__enumのサンプル使用方法です：
```bash
Pacu (new:test) > run cognito__enum
```
### Identity Pool ID

Identity Poolsは、単に**Identity Pool IDを知っている未認証ユーザーにIAMロールを付与**することができます（**見つけやすい**）。この情報を持つ攻撃者は、そのIAMロールに**アクセスを試み**、悪用することができます。さらに、IAMロールは、Identity Poolにアクセスする**認証済みユーザー**にも割り当てることができます。攻撃者が**ユーザーを登録**することができるか、またはIdentity Poolで使用されている**IDプロバイダーにアクセス**できる場合、認証されたユーザーに与えられている**IAMロールにアクセス**し、その権限を悪用することができます。

[**ここでその方法を確認**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### User Pool ID

デフォルトでは、Cognitoは**新しいユーザーを登録**することを許可します。ユーザーを登録できるようになると、**基礎となるアプリケーション**や、CognitoユーザープールをIDプロバイダーとして受け入れているIdentity Poolの**認証済みIAMアクセスロールにアクセス**できるかもしれません。[**ここでその方法を確認**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).

<details>

<summary><strong>**htARTE (HackTricks AWS Red Team Expert)**でAWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>こちら</strong></a><strong>!</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksで企業を宣伝**したい場合や、**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**telegramグループ**](https://t.me/peass)に参加**したり、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)をフォロー**してください。**
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出**して、あなたのハッキングテクニックを共有してください。

</details>
