# AWS - Enumeración no autenticada de Cognito

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop).
* Obtén el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com).
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family).
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).

</details>

## Cognito no autenticado

Cognito es un servicio de AWS que permite a los desarrolladores **conceder a los usuarios de su aplicación acceso a los servicios de AWS**. Los desarrolladores pueden otorgar **roles IAM a los usuarios autenticados** en su aplicación (potencialmente, las personas solo podrán registrarse) y también pueden otorgar un **rol IAM a los usuarios no autenticados**.

Para obtener información básica sobre Cognito, consulta:

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### Módulos de Pacu para pentesting y enumeración

[Pacu](https://github.com/RhinoSecurityLabs/pacu), el marco de explotación de AWS, ahora incluye los módulos "cognito__enum" y "cognito__attack" que automatizan la enumeración de todos los activos de Cognito en una cuenta y detectan configuraciones débiles, atributos de usuario utilizados para el control de acceso, etc., y también automatizan la creación de usuarios (incluido el soporte de MFA) y la escalada de privilegios basada en atributos personalizados modificables, credenciales de la piscina de identidades utilizables, roles asumibles en tokens de identidad, etc.

Para obtener una descripción de las funciones de los módulos, consulta la parte 2 de la [publicación del blog](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2). Para obtener instrucciones de instalación, consulta la página principal de [Pacu](https://github.com/RhinoSecurityLabs/pacu).

### Uso

Uso de muestra de cognito__attack para intentar la creación de usuarios y todos los vectores de escalada de privilegios contra una piscina de identidades y un cliente de grupo de usuarios específicos:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
Uso de ejemplo de cognito__enum para recopilar todas las piscinas de usuarios, clientes de piscinas de usuarios, piscinas de identidad, usuarios, etc. visibles en la cuenta actual de AWS:
```bash
Pacu (new:test) > run cognito__enum
```
### ID del grupo de identidad

Los grupos de identidad pueden otorgar **roles IAM a usuarios no autenticados** que solo **conozcan la ID del grupo de identidad** (lo cual es bastante común de **encontrar**), y un atacante con esta información podría intentar **acceder a ese rol IAM** y explotarlo. Además, los roles IAM también pueden asignarse a **usuarios autenticados** que acceden al grupo de identidad. Si un atacante puede **registrarse como usuario** o ya tiene **acceso al proveedor de identidad** utilizado en el grupo de identidad, podría acceder al **rol IAM que se otorga a los usuarios autenticados** y abusar de sus privilegios.

[**Ver cómo hacerlo aquí**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### ID del grupo de usuarios

Por defecto, Cognito permite **registrar nuevos usuarios**. Poder registrar un usuario podría darte **acceso** a la **aplicación subyacente** o al **rol de acceso IAM autenticado de un grupo de identidad** que acepta como proveedor de identidad el Grupo de Usuarios de Cognito. [**Ver cómo hacerlo aquí**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF**, ¡consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
