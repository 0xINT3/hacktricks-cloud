# AWS - Cognito未認証の列挙

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もし、あなたの**会社をHackTricksで宣伝したい**場合や、**PEASSの最新バージョンにアクセスしたい**場合、または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけてください。これは、私たちの独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションです
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

## 未認証のCognito

Cognitoは、開発者がアプリのユーザーにAWSサービスへのアクセスを許可するためのAWSサービスです。開発者は、アプリの認証済みユーザーに**IAMロールを付与**し（おそらく人々は単にサインアップすることができる）、**未認証のユーザーにもIAMロールを付与**することもできます。

Cognitoの基本情報については、次を参照してください：

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### ペネトレーションテストと列挙のためのPacuモジュール

AWSの脆弱性フレームワークである[Pacu](https://github.com/RhinoSecurityLabs/pacu)には、"cognito__enum"と"cognito__attack"モジュールが含まれており、アカウント内のすべてのCognitoアセットの列挙を自動化し、弱い設定、アクセス制御に使用されるユーザー属性などを検出し、また、変更可能なカスタム属性に基づいたユーザーの作成（MFAサポートを含む）や特権エスカレーション、使用可能なアイデンティティプールの資格情報、IDトークン内の引き受け可能なロールなども自動化します。

モジュールの機能の説明については、[ブログ記事](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2)のパート2を参照してください。インストール手順については、[Pacu](https://github.com/RhinoSecurityLabs/pacu)のメインページを参照してください。

### 使用方法

指定されたアイデンティティプールとユーザープールクライアントに対して、ユーザーの作成とすべての特権エスカレーションベクトルを試すためのcognito__attackの使用例：
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
現在のAWSアカウントで表示されるすべてのユーザープール、ユーザープールクライアント、アイデンティティプール、ユーザーなどを収集するためのcognito__enumの使用例:
```bash
Pacu (new:test) > run cognito__enum
```
### Identity Pool ID

Identity Poolsは、**未認証のユーザーにIAMロールを付与**することができます。Identity Pool IDは比較的**見つけやすい**情報ですので、この情報を持つ攻撃者は、そのIAMロールに**アクセスし、悪用**することができます。\
さらに、IAMロールは、Identity Poolにアクセスする**認証済みユーザー**にも割り当てることができます。攻撃者が**ユーザーを登録**することができるか、またはIdentity Poolで使用されている**IDプロバイダーにアクセス**できる場合、認証されたユーザーに与えられる**IAMロールにアクセス**し、その権限を悪用することができます。

[**ここでその方法を確認してください**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### User Pool ID

デフォルトでは、Cognitoでは**新しいユーザーを登録**することができます。ユーザーを登録できるようになると、**基礎となるアプリケーション**またはCognitoユーザープールをIDプロバイダーとして受け入れている**認証済みIAMアクセスロール**にアクセスできる場合があります。[**ここでその方法を確認してください**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もしもあなたの**会社をHackTricksで宣伝**したい場合や、**PEASSの最新バージョンを入手**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)を手に入れましょう。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**してください。
* **HackTricks**と**HackTricks Cloud**のgithubリポジトリに**PRを提出**することで、あなたのハッキングテクニックを共有してください。

</details>
