# AWS - Cognito 未经认证的枚举

<details>

<summary><strong>从零开始学习AWS黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您希望在 **HackTricks中看到您的公司广告** 或 **下载HackTricks的PDF版本**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方的PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 未经认证的Cognito

Cognito是一个AWS服务，它使开发者能够**授予其应用用户访问AWS服务的权限**。开发者将向其应用中的**经过认证的用户授予IAM角色**（潜在的用户可能只需注册即可），他们还可以向**未经认证的用户授予IAM角色**。

有关Cognito的基本信息，请查看：

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### Pacu模块用于渗透测试和枚举

[Pacu](https://github.com/RhinoSecurityLabs/pacu)，AWS利用框架，现在包括"cognito__enum"和"cognito__attack"模块，这些模块自动枚举账户中的所有Cognito资产并标记弱配置、用于访问控制的用户属性等，并自动化用户创建（包括MFA支持）和基于可修改的自定义属性、可用的身份池凭证、可假设的id令牌中的角色等的权限提升。

有关模块功能的描述，请参阅[博客文章](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2)的第2部分。有关安装说明，请参阅主要的[Pacu](https://github.com/RhinoSecurityLabs/pacu)页面。

### 使用方法

示例cognito__attack使用方法，尝试针对给定的身份池和用户池客户端创建用户和所有权限提升向量：
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
```markdown
Sample cognito__enum 用法，用于收集当前 AWS 账户中可见的所有用户池、用户池客户端、身份池、用户等信息：
```
```bash
Pacu (new:test) > run cognito__enum
```
### 身份池 ID

身份池可以授予**未经认证的用户 IAM 角色**，这些用户只需**知道身份池 ID**（这是相当常见的**发现**），攻击者有了这些信息就可以尝试**访问该 IAM 角色**并利用它。\
此外，IAM 角色也可以分配给访问身份池的**经过认证的用户**。如果攻击者可以**注册用户**或已经有**访问身份提供者的权限**，你可以访问**授予经过认证的用户的 IAM 角色**并滥用其权限。

[**查看如何做到这一点**](../aws-services/aws-cognito-enum/cognito-identity-pools.md)。

### 用户池 ID

默认情况下 Cognito 允许**注册新用户**。能够注册用户可能会让你**访问**底层应用程序或身份池的**经过认证的 IAM 访问角色**，该身份池接受 Cognito 用户池作为身份提供者。[**查看如何做到这一点**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration)。

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>从零开始学习 AWS 黑客攻击！</strong></summary>

其他支持 HackTricks 的方式：

* 如果你想在 HackTricks 中看到你的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享你的黑客技巧**。

</details>
