# AWS - Enumera√ß√£o N√£o Autenticada do EC2

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **vers√£o mais recente do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## EC2 e Servi√ßos Relacionados

Verifique nesta p√°gina mais informa√ß√µes sobre isso:

{% content-ref url="../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### Portas P√∫blicas

√â poss√≠vel expor **qualquer porta das m√°quinas virtuais para a internet**. Dependendo do **que est√° sendo executado** na porta exposta, um atacante pode abusar dela.

#### SSRF

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### AMIs e Snapshots P√∫blicos

A AWS permite **dar acesso a qualquer pessoa para baixar AMIs e Snapshots**. Voc√™ pode listar esses recursos facilmente em sua pr√≥pria conta:
```bash
# Public AMIs
aws ec2 describe-images --executable-users all
## Search AMI by ownerID
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `967541184254/`) == `true`]'
## Search AMI by substr ("shared" in the example)
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `shared`) == `true`]'

# Public EBS snapshots (hard-drive copies)
aws ec2 describe-snapshots --restorable-by-user-ids all
aws ec2 describe-snapshots --restorable-by-user-ids all | jq '.Snapshots[] | select(.OwnerId == "099720109477")'
```
#### Modelo de URL p√∫blica

#### Description

This technique involves enumerating unauthenticated access to AWS EC2 instances by leveraging a publicly accessible URL template.

#### Descri√ß√£o

Esta t√©cnica envolve a enumera√ß√£o de acesso n√£o autenticado a inst√¢ncias do AWS EC2, aproveitando um modelo de URL publicamente acess√≠vel.

#### Vulnerable Application

AWS EC2 instances with publicly accessible URLs.

#### Aplica√ß√£o Vulner√°vel

Inst√¢ncias do AWS EC2 com URLs publicamente acess√≠veis.

#### Impact

An attacker can use this technique to discover and access sensitive information or resources on the target EC2 instances without authentication.

#### Impacto

Um atacante pode usar essa t√©cnica para descobrir e acessar informa√ß√µes ou recursos sens√≠veis nas inst√¢ncias do EC2 de destino sem autentica√ß√£o.

#### Steps to Reproduce

1. Identify the target AWS EC2 instance with a publicly accessible URL.
2. Analyze the URL structure and parameters.
3. Enumerate different values for the parameters to discover potential information leaks or unauthorized access.
4. Exploit the discovered vulnerabilities to gain unauthorized access to sensitive information or resources.

#### Passos para Reproduzir

1. Identifique a inst√¢ncia do AWS EC2 de destino com uma URL publicamente acess√≠vel.
2. Analise a estrutura e os par√¢metros da URL.
3. Enumere diferentes valores para os par√¢metros para descobrir poss√≠veis vazamentos de informa√ß√µes ou acesso n√£o autorizado.
4. Explore as vulnerabilidades descobertas para obter acesso n√£o autorizado a informa√ß√µes ou recursos sens√≠veis.
```bash
# EC2
ec2-{ip-seperated}.compute-1.amazonaws.com
# ELB
http://{user_provided}-{random_id}.{region}.elb.amazonaws.com:80/443
https://{user_provided}-{random_id}.{region}.elb.amazonaws.com
```
### Enumerar inst√¢ncias EC2 com IP p√∫blico

{% code overflow="wrap" %}
```bash
aws ec2 describe-instances --query "Reservations[].Instances[?PublicIpAddress!=null].PublicIpAddress" --output text
```
{% endcode %}

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **vers√£o mais recente do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo Telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no GitHub.

</details>
