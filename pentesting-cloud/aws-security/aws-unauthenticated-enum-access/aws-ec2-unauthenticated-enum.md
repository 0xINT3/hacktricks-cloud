# AWS - Enumerazione non autenticata di EC2

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## EC2 e servizi correlati

Controlla in questa pagina ulteriori informazioni a riguardo:

{% content-ref url="../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### Porte pubbliche

√à possibile esporre **qualsiasi porta delle macchine virtuali su Internet**. A seconda di **cosa viene eseguito** sulla porta esposta, un attaccante potrebbe sfruttarla.

#### SSRF

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### AMI pubbliche e snapshot EBS

AWS consente di **concedere l'accesso a chiunque per scaricare AMI e snapshot**. √à possibile elencare facilmente queste risorse dal proprio account:

{% code overflow="wrap" %}
```bash
# Public AMIs
aws ec2 describe-images --executable-users all

## Search AMI by ownerID
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `967541184254/`) == `true`]'

## Search AMI by substr ("shared" in the example)
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `shared`) == `true`]'

# Public EBS snapshots (hard-drive copies)
aws ec2 describe-snapshots --restorable-by-user-ids all
aws ec2 describe-snapshots --restorable-by-user-ids all | jq '.Snapshots[] | select(.OwnerId == "099720109477")'
```
{% endcode %}

#### Modello di URL pubblico

```plaintext
http://<ec2-instance-public-ip>:<port>/
```

#### Description

This technique involves enumerating unauthenticated access to AWS EC2 instances. By using the public IP address and port number of an EC2 instance, an attacker can attempt to access the instance without providing any credentials.

#### Impact

If successful, an attacker can gain unauthorized access to the EC2 instance and potentially extract sensitive information or perform malicious activities.

#### Steps to Perform

1. Identify the public IP address of the target EC2 instance.
2. Identify the port number on which the instance is running.
3. Use a web browser or a tool like cURL to access the instance using the public IP address and port number.
4. Analyze the response to determine if any sensitive information is leaked or if any unauthorized actions can be performed.

#### Mitigation

To mitigate the risk of unauthenticated access to EC2 instances, follow these recommendations:

- Ensure that EC2 instances are not exposed to the public internet unless necessary.
- Implement strong authentication mechanisms, such as using SSH keys or IAM roles, to restrict access to EC2 instances.
- Regularly monitor and review access logs to identify any unauthorized access attempts.
- Keep EC2 instances and associated software up to date with the latest security patches.
- Implement network security measures, such as firewalls and security groups, to restrict access to EC2 instances.

#### References

- [AWS EC2 Security Best Practices](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-security-best-practices.html)
```bash
# EC2
ec2-{ip-seperated}.compute-1.amazonaws.com
# ELB
http://{user_provided}-{random_id}.{region}.elb.amazonaws.com:80/443
https://{user_provided}-{random_id}.{region}.elb.amazonaws.com
```
### Enumerare le istanze EC2 con indirizzo IP pubblico

{% code overflow="wrap" %}
```bash
aws ec2 describe-instances --query "Reservations[].Instances[?PublicIpAddress!=null].PublicIpAddress" --output text
```
{% endcode %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
