# AWS - EC2未经身份验证的枚举

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF格式的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## EC2和相关服务

在此页面中查看更多关于此的信息：

{% content-ref url="../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### 公共端口

可以将**虚拟机的任何端口暴露给互联网**。根据暴露的端口中运行的内容，攻击者可能会滥用它。

#### SSRF

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### 公共AMI和EBS快照

AWS允许**任何人下载AMI和快照**。您可以很容易地从您自己的账户列出这些资源：

{% code overflow="wrap" %}
```bash
# Public AMIs
aws ec2 describe-images --executable-users all

## Search AMI by ownerID
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `967541184254/`) == `true`]'

## Search AMI by substr ("shared" in the example)
aws ec2 describe-images --executable-users all --query 'Images[?contains(ImageLocation, `shared`) == `true`]'

# Public EBS snapshots (hard-drive copies)
aws ec2 describe-snapshots --restorable-by-user-ids all
aws ec2 describe-snapshots --restorable-by-user-ids all | jq '.Snapshots[] | select(.OwnerId == "099720109477")'
```
#### 公共URL模板

{% code-tabs %}
{% code-tabs-item title="URL模板" %}
```
https://<aws_region>.console.aws.amazon.com/ec2/v2/home?region=<aws_region>#Instances:search=<instance_id>
```
{% endcode-tabs-item %}
{% endcode-tabs %}

#### Description

#### 描述

The AWS EC2 service allows users to launch and manage virtual servers in the cloud. In some cases, these EC2 instances may be misconfigured and allow unauthenticated access to sensitive information.

AWS EC2服务允许用户在云中启动和管理虚拟服务器。在某些情况下，这些EC2实例可能配置错误，允许未经身份验证的访问敏感信息。

#### Impact

#### 影响

An attacker can exploit this misconfiguration to gain unauthorized access to sensitive data stored on the EC2 instance. This can include confidential customer information, intellectual property, or other sensitive data.

攻击者可以利用这个配置错误来未经授权地访问存储在EC2实例上的敏感数据。这可能包括机密客户信息、知识产权或其他敏感数据。

#### Recommendation

#### 建议

It is recommended to ensure that EC2 instances are properly configured with appropriate access controls and authentication mechanisms. Regular security assessments and audits should be conducted to identify and remediate any misconfigurations.

建议确保EC2实例以适当的访问控制和身份验证机制进行正确配置。应定期进行安全评估和审计，以识别和纠正任何配置错误。

#### References

#### 参考资料

- [AWS EC2 Documentation](https://docs.aws.amazon.com/ec2/index.html)

{% endcode %}
```bash
# EC2
ec2-{ip-seperated}.compute-1.amazonaws.com
# ELB
http://{user_provided}-{random_id}.{region}.elb.amazonaws.com:80/443
https://{user_provided}-{random_id}.{region}.elb.amazonaws.com
```
### 枚举具有公共IP的EC2实例

{% code overflow="wrap" %}
```bash
aws ec2 describe-instances --query "Reservations[].Instances[?PublicIpAddress!=null].PublicIpAddress" --output text
```
{% endcode %}

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版本的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交PR来分享您的黑客技巧。

</details>
