# AWS - Acesso n√£o autenticado ao CodeBuild

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## CodeBuild

Para mais informa√ß√µes, consulte esta p√°gina:

{% content-ref url="../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### buildspec.yml

Se voc√™ comprometer o acesso de escrita sobre um reposit√≥rio contendo um arquivo chamado **`buildspec.yml`**, voc√™ poderia **inserir um backdoor** neste arquivo, que especifica os **comandos que ser√£o executados** dentro de um projeto CodeBuild e extrair os segredos, comprometer o que √© feito e tamb√©m comprometer as **credenciais da fun√ß√£o IAM do CodeBuild**.

Observe que mesmo que n√£o haja nenhum arquivo **`buildspec.yml`**, mas voc√™ sabe que o CodeBuild est√° sendo usado (ou um CI/CD diferente) **modificar algum c√≥digo leg√≠timo** que ser√° executado tamb√©m pode lhe proporcionar um shell reverso, por exemplo.

Para obter informa√ß√µes relacionadas, voc√™ pode verificar a p√°gina sobre como atacar as A√ß√µes do Github (semelhante a isso):

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

## Runners de A√ß√µes do GitHub auto-hospedados no AWS CodeBuild <a href="#action-runner" id="action-runner"></a>

Conforme [**indicado na documenta√ß√£o**](https://docs.aws.amazon.com/codebuild/latest/userguide/action-runner.html), √© poss√≠vel configurar o **CodeBuild** para executar **a√ß√µes auto-hospedadas do Github** quando um fluxo de trabalho √© acionado dentro de um reposit√≥rio do Github configurado. Isso pode ser detectado verificando a configura√ß√£o do projeto CodeBuild porque o **`Tipo de evento`** precisa conter: **`WORKFLOW_JOB_QUEUED`** e em um Fluxo de trabalho do Github porque ele selecionar√° um corredor **auto-hospedado** assim:
```bash
runs-on: codebuild-<project-name>-${{ github.run_id }}-${{ github.run_attempt }}
```
Esta nova rela√ß√£o entre Github Actions e AWS cria outra forma de comprometer a AWS a partir do Github, uma vez que o c√≥digo no Github estar√° sendo executado em um projeto CodeBuild com uma fun√ß√£o IAM anexada.
