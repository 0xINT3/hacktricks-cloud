# AWS - Api Gateway 인증되지 않은 열거

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

### API Invoke 우회

[Attack Vectors for APIs Using AWS API Gateway Lambda Authorizers - Alexandre & Leonardo](https://www.youtube.com/watch?v=bsPKk7WDOnE)에서 언급한 대로, Lambda Authorizers는 API 엔드포인트를 호출할 권한을 부여하기 위해 **IAM 구문을 사용하여** 구성할 수 있습니다. 이는 [**문서에서 가져온 것**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html)입니다:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Permission",
"Action": [
"execute-api:Execution-operation"
],
"Resource": [
"arn:aws:execute-api:region:account-id:api-id/stage/METHOD_HTTP_VERB/Resource-path"
]
}
]
}
```
이렇게 엔드포인트에 권한을 부여하는 방법의 문제는 **"\*"이 "아무 것이나"를 의미**하며, **정규식 구문을 더 이상 지원하지 않는다는 것**입니다.

일부 예시:

* `arn:aws:execute-apis:sa-east-1:accid:api-id/prod/*/dashboard/*`와 같은 규칙은 각 사용자가 `/dashboard/user/{username}`에 액세스할 수 있도록 하지만, `/admin/dashboard/createAdmin`과 같은 다른 경로에도 액세스할 수 있게 됩니다.

{% hint style="warning" %}
**"\*"는 슬래시로 확장이 멈추지 않는다는 것**에 유의하십시오. 따라서, 예를 들어 api-id에 "\*"을 사용하는 경우 최종적인 정규식이 여전히 유효하다면 "어떤 스테이지"나 "어떤 메소드"를 나타낼 수도 있습니다.\
따라서 `arn:aws:execute-apis:sa-east-1:accid:*/prod/GET/dashboard/*`\
예를 들어, `/prod/GET/dashboard/admin` 경로로의 테스트 스테이지에 대한 POST 요청을 유효하게 할 수 있습니다.
{% endhint %}

항상 액세스를 허용하려는 내용을 명확히하고, 부여된 권한으로 다른 시나리오가 가능한지 확인해야 합니다.

더 많은 정보는 [**문서**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html) 외에도, [**이 공식 aws github**](https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints/tree/master/blueprints)에서 인증자를 구현하기 위한 코드를 찾을 수 있습니다.

### IAM 정책 인젝션

동일한 [**발표**](https://www.youtube.com/watch?v=bsPKk7WDOnE)에서는 코드가 **사용자 입력**을 사용하여 **IAM 정책을 생성**하는 경우, 와일드카드(그리고 "." 또는 특정 문자열과 같은 다른 문자)를 포함하여 **제한을 우회**할 수 있다는 사실이 노출됩니다.

### 공개 URL 템플릿
```
https://{random_id}.execute-api.{region}.amazonaws.com/{user_provided}
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>
