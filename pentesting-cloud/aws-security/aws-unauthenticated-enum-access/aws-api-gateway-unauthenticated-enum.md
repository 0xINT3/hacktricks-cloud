# AWS - Uchambuzi wa API Gateway Usiothibitishwa

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka mwanzo hadi mtaalamu na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalamu wa Timu Nyekundu ya HackTricks AWS)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

### Kupuuza Wito wa API

Kulingana na mazungumzo [Mbinu za Mashambulizi kwa APIs Zinazotumia Waandishi wa Lambda wa AWS API Gateway - Alexandre & Leonardo](https://www.youtube.com/watch?v=bsPKk7WDOnE), Waandishi wa Lambda wanaweza kusanidiwa **kwa kutumia sintaksia ya IAM** kutoa ruhusa za kuita vituo vya API. Hii imetolewa [**kutoka kwenye nyaraka**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Permission",
"Action": [
"execute-api:Execution-operation"
],
"Resource": [
"arn:aws:execute-api:region:account-id:api-id/stage/METHOD_HTTP_VERB/Resource-path"
]
}
]
}
```
Tatizo na njia hii ya kutoa ruhusa ya kuita mwisho ni kwamba **"\*" inamaanisha "chochote"** na hakuna tena **msaada wa sintaksia ya regex**.

Baadhi ya mifano:

* Kanuni kama vile `arn:aws:execute-apis:sa-east-1:accid:api-id/prod/*/dashboard/*` ili kumpa kila mtumiaji ufikiaji wa `/dashboard/user/{username}` itawapa ufikiaji wa njia nyingine kama vile `/admin/dashboard/createAdmin` kwa mfano.

{% hint style="warning" %}
Tambua kwamba **"\*" haikomi kupanuka na vishwa**, kwa hivyo, ikiwa utatumia "\*" katika api-id kwa mfano, inaweza pia kuashiria "hatua yoyote" au "njia yoyote" ikiwa regex ya mwisho bado ni halali.\
Kwa hivyo `arn:aws:execute-apis:sa-east-1:accid:*/prod/GET/dashboard/*`\
Inaweza kuthibitisha ombi la post kwa hatua ya majaribio kwa njia `/prod/GET/dashboard/admin` kwa mfano.
{% endhint %}

Daima unapaswa kuwa na wazi kile unachotaka kuruhusu kupata ufikiaji kisha angalia ikiwa hali zingine zinawezekana na ruhusa zilizotolewa.

Kwa habari zaidi, mbali na [**nyaraka**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html), unaweza kupata nambari ya kutekeleza waandikishaji katika [**github rasmi ya aws hii**](https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints/tree/master/blueprints).

### Uingizaji wa Sera ya IAM

Katika [**mazungumzo hayo**](https://www.youtube.com/watch?v=bsPKk7WDOnE) inaonyesha ukweli kwamba ikiwa nambari inatumia **matokeo ya mtumiaji** ku **zalisha sera za IAM**, vivuli (na vingine kama vile "." au herufi maalum) vinaweza kujumuishwa hapo na lengo la **kupita kwa vizuizi**.

### Kiolesura cha URL ya Umma
```
https://{random_id}.execute-api.{region}.amazonaws.com/{user_provided}
```
### Pata ID ya Akaunti kutoka kwa URL ya API Gateway ya umma

Kama ilivyo na S3 buckets, Data Exchange na Lambda URLs gateways, Inawezekana kupata ID ya akaunti ya akaunti kwa kukiuka **`aws:ResourceAccount`** **Policy Condition Key** kutoka kwa URL ya API Gateway ya umma. Hii hufanywa kwa kupata ID ya akaunti kwa herufi moja baada ya nyingine kwa kukiuka wildcards katika sehemu ya **`aws:ResourceAccount`** ya sera.\
Mbinu hii pia inaruhusu kupata **thamani za vitambulisho** ikiwa unajua ufunguo wa lebo (kuna baadhi ya default ya kuvutia).

Unaweza kupata maelezo zaidi katika [**utafiti wa awali**](https://blog.plerion.com/conditional-love-for-aws-metadata-enumeration/) na zana [**conditional-love**](https://github.com/plerionhq/conditional-love/) kwa kiotomatiki hiki cha unyanyasaji.

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
