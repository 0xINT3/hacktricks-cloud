# AWS - Ανεπιβεβαίωτη Απαρίθμηση S3

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας στο hacking υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## Δημόσια Buckets S3

Ένα bucket θεωρείται **"δημόσιο"** εάν **οποιοσδήποτε χρήστης μπορεί να απαριθμήσει το περιεχόμενο** του bucket και **"ιδιωτικό"** εάν το περιεχόμενο του bucket μπορεί να απαριθμηθεί ή να γραφεί μόνο από συγκεκριμένους χρήστες.

Οι εταιρείες μπορεί να έχουν **κακώς ρυθμισμένες άδειες πρόσβασης στα buckets**, παρέχοντας πρόσβαση είτε σε όλα είτε σε όλους τους εξουσιοδοτημένους χρήστες στο AWS σε οποιοδήποτε λογαριασμό (και έτσι σε οποιονδήποτε). Σημειώστε ότι, ακόμα και με τέτοιες λανθασμένες ρυθμίσεις, ορισμένες ενέργειες ενδέχεται να μην είναι δυνατό να πραγματοποιηθούν, καθώς τα buckets μπορεί να έχουν τις δικές τους λίστες ελέγχου πρόσβασης (ACLs).

**Μάθετε για την κακώς ρυθμισμένη AWS-S3 εδώ:** [**http://flaws.cloud**](http://flaws.cloud/) **και** [**http://flaws2.cloud/**](http://flaws2.cloud)

### Εύρεση Buckets AWS

Διάφορες μέθοδοι για να βρείτε όταν μια ιστοσελίδα χρησιμοποιεί το AWS για την αποθήκευση ορισμένων πόρων:

#### Απαρίθμηση & OSINT:

* Χρησιμοποιώντας το πρόσθετο προγράμματος περιήγησης **wappalyzer**
* Χρησιμοποιώντας το burp (**spidering** το web) ή περιηγούμενος χειροκίνητα στη σελίδα, όλοι οι **φορτωμένοι πόροι** θα αποθηκευτούν στο Ιστορικό.
*   **Έλεγξε τους πόρους** σε τομείς όπως:

```
http://s3.amazonaws.com/[bucket_name]/
http://[bucket_name].s3.amazonaws.com/
```
* Έλεγξε τα **CNAMES** καθώς το `resources.domain.com` μπορεί να έχει το CNAME `bucket.s3.amazonaws.com`
* Έλεγξε το [https://buckets.grayhatwarfare.com](https://buckets.grayhatwarfare.com/), μια ιστοσελίδα με ήδη **ανακαλυμένα ανοικτά buckets**.
* Το **όνομα του bucket** και το **όνομα του τομέα του bucket** πρέπει να είναι **ίδια**.
* Το **flaws.cloud** βρίσκεται στην **IP** 52.92.181.107 και εάν πάτε εκεί σας ανακατευθύνει στο [https://aws.amazon.com/s3/](https://aws.amazon.com/s3/). Επίσης, το `dig -x 52.92.181.107` δίνει `s3-website-us-west-2.amazonaws.com`.
* Για να ελέγξετε αν είναι ένα bucket μπορείτε επίσης να **επισκεφθείτε** το [https://flaws.cloud.s3.amazonaws.com/](https://flaws.cloud.s3.amazonaws.com/).

#### Βίαιη Δοκιμή

Μπορείτε να βρείτε buckets με την **βίαιη δοκιμή ονομάτων** που σχετίζονται με την εταιρεία που ελέγχετε:

* [https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)
* [https://github.com/clario-tech/s3-inspector](https://github.com/clario-tech/s3-inspector)
* [https://github.com/jordanpotti/AWSBucketDump](https://github.com/jordanpotti/AWSBucketDump) (Περιέχει μια λίστα με πιθανά ονόματα bucket)
* [https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets](https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets)
* [https://github.com/smaranchand/bucky](https://github.com/smaranchand/bucky)
* [https://github.com/t
## Καλέστε το s3scanner
s3scanner --threads 100 scan --buckets-file /tmp/final-words-s3.txt  | grep bucket_exists
</code></pre>

#### Λεηλασία S3 Buckets

Δεδομένων των ανοικτών S3 buckets, το [**BucketLoot**](https://github.com/redhuntlabs/BucketLoot) μπορεί αυτόματα να **αναζητήσει ενδιαφέρουσες πληροφορίες**.

### Βρείτε την περιοχή

Μπορείτε να βρείτε όλες τις υποστηριζόμενες περιοχές από το AWS στο [**https://docs.aws.amazon.com/general/latest/gr/s3.html**](https://docs.aws.amazon.com/general/latest/gr/s3.html)

#### Με το DNS

Μπορείτε να βρείτε την περιοχή ενός bucket με το **`dig`** και το **`nslookup`** κάνοντας ένα **DNS αίτημα στην ανακαλυφθείσα IP**:
```bash
dig flaws.cloud
;; ANSWER SECTION:
flaws.cloud.    5    IN    A    52.218.192.11

nslookup 52.218.192.11
Non-authoritative answer:
11.192.218.52.in-addr.arpa name = s3-website-us-west-2.amazonaws.com.
```
Ελέγξτε αν ο επιλυμένος τομέας έχει τη λέξη "website".\
Μπορείτε να αποκτήσετε πρόσβαση στον στατικό ιστότοπο μεταβαίνοντας στο: `flaws.cloud.s3-website-us-west-2.amazonaws.com`\
ή μπορείτε να αποκτήσετε πρόσβαση στον κάδο επισκεπτόμενοι: `flaws.cloud.s3-us-west-2.amazonaws.com`

#### Δοκιμάζοντας

Εάν προσπαθήσετε να αποκτήσετε πρόσβαση σε έναν κάδο, αλλά στο **όνομα τομέα που καθορίζετε αναφέρετε μια άλλη περιοχή** (για παράδειγμα, ο κάδος βρίσκεται στο `bucket.s3.amazonaws.com` αλλά προσπαθείτε να αποκτήσετε πρόσβαση στο `bucket.s3-website-us-west-2.amazonaws.com`), τότε θα σας **κατευθύνουν στη σωστή τοποθεσία**:

![](<../../../.gitbook/assets/image (57).png>)

### Απαρίθμηση του κάδου

Για να ελέγξετε την προσβασιμότητα του κάδου, ο χρήστης μπορεί απλά να εισάγει το URL στον περιηγητή του ιστού. Ένας ιδιωτικός κάδος θα απαντήσει με "Άρνηση πρόσβασης". Ένας δημόσιος κάδος θα εμφανίσει μια λίστα με τα πρώτα 1.000 αντικείμενα που έχουν αποθηκευτεί.

Ανοιχτός για όλους:

![](<../../../.gitbook/assets/image (67).png>)

Ιδιωτικός:

![](<../../../.gitbook/assets/image (78).png>)

Μπορείτε επίσης να το ελέγξετε με το cli:
```bash
#Use --no-sign-request for check Everyones permissions
#Use --profile <PROFILE_NAME> to indicate the AWS profile(keys) that youwant to use: Check for "Any Authenticated AWS User" permissions
#--recursive if you want list recursivelyls
#Opcionally you can select the region if you now it
aws s3 ls s3://flaws.cloud/ [--no-sign-request] [--profile <PROFILE_NAME>] [ --recursive] [--region us-west-2]
```
Εάν το κουβάδι δεν έχει ένα όνομα τομέα, κατά την προσπάθεια εντοπισμού του, **τοποθετήστε μόνο το όνομα του κουβάδιου** και όχι ολόκληρο τον τομέα AWSs3. Παράδειγμα: `s3://<ΟΝΟΜΑ_ΚΟΥΒΑΔΙΟΥ>`

### Πρότυπο δημόσιας διεύθυνσης URL
```
https://{user_provided}.s3.amazonaws.com
```
### Λήψη του αναγνωριστικού λογαριασμού από δημόσιο Bucket

Είναι δυνατό να προσδιοριστεί ένας λογαριασμός AWS εκμεταλλευόμενος το νέο **`S3:ResourceAccount`** **Policy Condition Key**. Αυτή η συνθήκη **περιορίζει την πρόσβαση βάσει του S3 bucket** στον οποίο ανήκει ο λογαριασμός (άλλες πολιτικές που βασίζονται σε λογαριασμούς περιορίζουν βάσει του λογαριασμού στον οποίο ανήκει ο αιτούντας αρχή).\
Και επειδή η πολιτική μπορεί να περιέχει **μπαλαντέρ** είναι δυνατό να βρεθεί το αριθμός του λογαριασμού **μόνο έναν αριθμό τη φορά**.

Αυτό το εργαλείο αυτοματοποιεί τη διαδικασία:
```bash
# Installation
pipx install s3-account-search
pip install s3-account-search
# With a bucket
s3-account-search arn:aws:iam::123456789012:role/s3_read s3://my-bucket
# With an object
s3-account-search arn:aws:iam::123456789012:role/s3_read s3://my-bucket/path/to/object.ext
```
## Αναφορές

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudar.be/awsblog/finding-the-account-id-of-any-public-s3-bucket/](https://cloudar.be/awsblog/finding-the-account-id-of-any-public-s3-bucket/)

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
