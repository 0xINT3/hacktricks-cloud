# AWS - Enumeraci√≥n no autenticada de S3

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Revisa los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos.
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en Github.

</details>

## Buckets p√∫blicos de S3

Un bucket se considera **"p√∫blico"** si **cualquier usuario puede listar el contenido** del bucket, y **"privado"** si el contenido del bucket solo puede ser listado o escrito por ciertos usuarios.

Las empresas pueden tener **permisos de buckets mal configurados** dando acceso a todo o a cualquier persona autenticada en AWS en cualquier cuenta (por lo que a cualquiera). Tenga en cuenta que incluso con tales configuraciones incorrectas, algunas acciones pueden no poder realizarse ya que los buckets pueden tener sus propias listas de control de acceso (ACL).

**Aprenda sobre la mala configuraci√≥n de AWS-S3 aqu√≠:** [**http://flaws.cloud**](http://flaws.cloud/) **y** [**http://flaws2.cloud/**](http://flaws2.cloud)

### Encontrar Buckets de AWS

Diferentes m√©todos para encontrar cuando una p√°gina web est√° usando AWS para almacenar algunos recursos:

#### Enumeraci√≥n y OSINT:

* Usando el plugin del navegador **wappalyzer**
* Usando burp (**spidering** la web) o navegando manualmente por la p√°gina, todos los **recursos cargados** se guardar√°n en el Historial.
*   **Compruebe los recursos** en dominios como:

    ```
    http://s3.amazonaws.com/[bucket_name]/
    http://[bucket_name].s3.amazonaws.com/
    ```
* Compruebe los **CNAMES** ya que `resources.domain.com` podr√≠a tener el CNAME `bucket.s3.amazonaws.com`
* Compruebe [https://buckets.grayhatwarfare.com](https://buckets.grayhatwarfare.com/), una web con buckets abiertos ya **descubiertos**.
* El **nombre del bucket** y el **nombre de dominio del bucket** deben ser **iguales**.
  * **flaws.cloud** est√° en **IP** 52.92.181.107 y si va all√≠ se redirige a [https://aws.amazon.com/s3/](https://aws.amazon.com/s3/). Adem√°s, `dig -x 52.92.181.107` da `s3-website-us-west-2.amazonaws.com`.
  * Para comprobar que es un bucket tambi√©n puede **visitar** [https://flaws.cloud.s3.amazonaws.com/](https://flaws.cloud.s3.amazonaws.com/).

#### Fuerza bruta

Puede encontrar buckets **por fuerza bruta de nombres** relacionados con la empresa que est√° probando:

* [https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)
* [https://github.com/clario-tech/s3-inspector](https://github.com/clario-tech/s3-inspector)
* [https://github.com/jordanpotti/AWSBucketDump](https://github.com/jordanpotti/AWSBucketDump) (Contiene una lista con nombres de buckets potenciales)
* [https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets](https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets)
* [https://github.com/smaranchand/bucky](https://github.com/smaranchand/bucky)
* [https://github.com/tomdev/teh\_s3\_bucketeers](https://github.com/tomdev/teh\_s3\_bucketeers)
* [https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3](https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3)
* [https://github.com/Eilonh/s3crets\_scanner](https://github.com/Eilonh/s3crets\_scanner)

<pre class="language-bash"><code class="lang-bash"># Generar una lista de palabras para crear permutaciones
curl -s https://raw.githubusercontent.com/cujanovic/goaltdns/master/words.txt > /tmp/words-s3.txt.temp
curl -s https://raw.githubusercontent.com/jordanpotti/AWSBucketDump/master/BucketNames.txt >>/tmp/words-s3.txt.temp
cat /tmp/words-s3.txt.temp | sort -u > /tmp/words-s3.txt

# Generar una lista de palabras basada en los dominios y subdominios a probar
## Escriba esos dominios y subdominios en subdomains.txt
cat subdomains.txt > /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "-" >> /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "\n" | sort -u >> /tmp/words-hosts-s3.txt

# Crear permutaciones basadas en una lista con los dominios y subdominios a atacar
goaltdns -l /tmp/words-hosts-s3.txt -w /tmp/words-s3.txt -o /tmp/final-words-s3.txt.temp
##