# AWS - Enumera√ß√£o n√£o autenticada do S3

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

## Buckets p√∫blicos do S3

Um bucket √© considerado **"p√∫blico"** se **qualquer usu√°rio puder listar o conte√∫do** do bucket e **"privado"** se o conte√∫do do bucket puder ser **listado ou escrito apenas por determinados usu√°rios**.

As empresas podem ter **permiss√µes de buckets mal configuradas** dando acesso a tudo ou a todos autenticados na AWS em qualquer conta (ou seja, para qualquer pessoa). Observe que, mesmo com essas configura√ß√µes incorretas, algumas a√ß√µes podem n√£o ser capazes de serem executadas, pois os buckets podem ter suas pr√≥prias listas de controle de acesso (ACLs).

**Saiba mais sobre a m√° configura√ß√£o do AWS-S3 aqui:** [**http://flaws.cloud**](http://flaws.cloud/) **e** [**http://flaws2.cloud/**](http://flaws2.cloud)

### Encontrando Buckets AWS

Diferentes m√©todos para encontrar quando uma p√°gina da web est√° usando a AWS para armazenar alguns recursos:

#### Enumera√ß√£o & OSINT:

* Usando o plugin do navegador **wappalyzer**
* Usando o burp (**spidering** na web) ou navegando manualmente pela p√°gina, todos os **recursos carregados** ser√£o salvos no Hist√≥rico.
*   **Verifique os recursos** em dom√≠nios como:

    ```
    http://s3.amazonaws.com/[bucket_name]/
    http://[bucket_name].s3.amazonaws.com/
    ```
* Verifique os **CNAMES** como `resources.domain.com` que pode ter o CNAME `bucket.s3.amazonaws.com`
* Verifique [https://buckets.grayhatwarfare.com](https://buckets.grayhatwarfare.com/), um site com buckets abertos j√° **descobertos**.
* O **nome do bucket** e o **nome do dom√≠nio do bucket** precisam ser **os mesmos**.
  * **flaws.cloud** est√° no **IP** 52.92.181.107 e se voc√™ for l√°, ser√° redirecionado para [https://aws.amazon.com/s3/](https://aws.amazon.com/s3/). Al√©m disso, `dig -x 52.92.181.107` fornece `s3-website-us-west-2.amazonaws.com`.
  * Para verificar se √© um bucket, voc√™ tamb√©m pode **visitar** [https://flaws.cloud.s3.amazonaws.com/](https://flaws.cloud.s3.amazonaws.com/).

#### Brute-Force

Voc√™ pode encontrar buckets por **for√ßa bruta de nomes** relacionados √† empresa que voc√™ est√° testando:

* [https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)
* [https://github.com/clario-tech/s3-inspector](https://github.com/clario-tech/s3-inspector)
* [https://github.com/jordanpotti/AWSBucketDump](https://github.com/jordanpotti/AWSBucketDump) (Cont√©m uma lista com nomes de buckets potenciais)
* [https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets](https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets)
* [https://github.com/smaranchand/bucky](https://github.com/smaranchand/bucky)
* [https://github.com/tomdev/teh\_s3\_bucketeers](https://github.com/tomdev/teh\_s3\_bucketeers)
* [https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3](https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3)
* [https://github.com/Eilonh/s3crets\_scanner](https://github.com/Eilonh/s3crets\_scanner)

<pre class="language-bash"><code class="lang-bash"># Gerar uma lista de palavras para criar permuta√ß√µes
curl -s https://raw.githubusercontent.com/cujanovic/goaltdns/master/words.txt > /tmp/words-s3.txt.temp
curl -s https://raw.githubusercontent.com/jordanpotti/AWSBucketDump/master/BucketNames.txt >>/tmp/words-s3.txt.temp
cat /tmp/words-s3.txt.temp | sort -u > /tmp/words-s3.txt

# Gerar uma lista de palavras com base nos dom√≠nios e subdom√≠nios para testar
## Escreva esses dom√≠nios e subdom√≠nios em subdomains.txt
cat subdomains.txt > /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "-" >> /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "\n" | sort -u >> /tmp/words-hosts-s3.txt

#