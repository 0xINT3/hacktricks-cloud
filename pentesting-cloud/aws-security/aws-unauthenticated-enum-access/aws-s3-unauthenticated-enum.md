# AWS - S3 Yetkisiz Enum

<details>

<summary><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı takip edin.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## S3 Halka Açık Kovalar

Bir kova, içeriğin **herhangi bir kullanıcının listelenebileceği** durumda **"halka açık"** olarak kabul edilir ve içeriğin **yalnızca belirli kullanıcılar tarafından listelenebileceği veya yazılabileceği** durumda **"özel"** olarak kabul edilir.

Şirketler, yanlış yapılandırılmış izinlerle kovalara erişim sağlayabilir ve her şeye veya herhangi bir AWS hesabında kimlik doğrulaması yapılmış herkese (yani herkese) erişim sağlayabilir. Bununla birlikte, bu tür yanlış yapılandırmalarla bazı eylemlerin gerçekleştirilemeyebileceğini unutmayın, çünkü kovaların kendi erişim kontrol listeleri (ACL'ler) olabilir.

AWS-S3 yanlış yapılandırma hakkında bilgi edinin: [**http://flaws.cloud**](http://flaws.cloud/) **ve** [**http://flaws2.cloud/**](http://flaws2.cloud)

### AWS Kovalarını Bulma

Bir web sayfasının AWS'yi bazı kaynakları depolamak için kullandığını bulmak için farklı yöntemler:

#### Enumerasyon ve OSINT:

* **wappalyzer** tarayıcı eklentisini kullanarak
* Burp kullanarak (web tarayıcısı) veya sayfada manuel olarak gezinerek **yüklenen tüm kaynaklar** Geçmiş'e kaydedilir.
* Aşağıdaki gibi **alanlarda kaynakları kontrol edin**:

```
http://s3.amazonaws.com/[bucket_name]/
http://[bucket_name].s3.amazonaws.com/
```
* `resources.domain.com` olarak bir CNAME'e sahip olabileceği için **CNAMES** kontrol edin `bucket.s3.amazonaws.com`
* Zaten **keşfedilmiş açık kovalara** sahip olan [https://buckets.grayhatwarfare.com](https://buckets.grayhatwarfare.com/) web sitesini kontrol edin.
* **Kova adı** ve **kova alan adı**'nın **aynı olması gerekir.**
* **flaws.cloud** IP 52.92.181.107'de ve oraya giderseniz [https://aws.amazon.com/s3/](https://aws.amazon.com/s3/) yönlendirilir. Ayrıca, `dig -x 52.92.181.107` `s3-website-us-west-2.amazonaws.com` verir.
* Bir kova olduğunu kontrol etmek için ayrıca [https://flaws.cloud.s3.amazonaws.com/](https://flaws.cloud.s3.amazonaws.com/) adresini **ziyaret edebilirsiniz**.

#### Brute-Force

Pentest yaptığınız şirketle ilgili **isimlerin brute-force** edilerek kovalar bulunabilir:

* [https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)
* [https://github.com/clario-tech/s3-inspector](https://github.com/clario-tech/s3-inspector)
* [https://github.com/jordanpotti/AWSBucketDump](https://github.com/jordanpotti/AWSBucketDump) (Potansiyel kova adları içeren bir liste içerir)
* [https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets](https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets)
* [https://github.com/smaranchand/bucky](https://github.com/smaranchand/bucky)
* [https://github.com/tomdev/teh\_s3\_bucketeers](https://github.com/tomdev/teh\_s3\_bucketeers)
* [https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3](https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3)
* [https://github.com/Eilonh/s3crets\_scanner](https://github.com/Eilonh/s3crets\_scanner)
* [https://github.com/belane/CloudHunter](https://github.com/belane/CloudHunter)

<pre class="language-bash"><code class="lang-bash"># Permutasyon oluşturmak için bir kelime listesi oluşturun
curl -s https://raw.githubusercontent.com/cujanovic/goaltdns/master/words.txt > /tmp/words-s3.txt.temp
curl -s https://raw.githubusercontent.com/jordanpotti/AWSBucketDump/master/BucketNames.txt >>/tmp/words-s3.txt.temp
cat /tmp/words-s3.txt.temp | sort -u > /tmp/words-s3.txt

# Test edilecek alan adları ve alt alan adlarına dayalı bir kelime listesi oluşturun
## Bu alan adlarını ve alt alan adlarını subdomains.txt dosyasına yazın
cat subdomains.txt > /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "-" >> /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "\n" | sort -u >> /tmp/words-hosts-s3.txt

# Saldırı yapılacak alan adları ve alt alan adları listesiyle permutasyonlar oluşturun
goaltdns -l /tmp/words-hosts-s3.txt -w /tmp/words-s3.txt -o /tmp/final-words-s3.txt.temp
## Önceki araç, alt alan adları için permutasyon oluşturmaya özeldir, bu listeyi filtreleyelim
<strong>### ". ile biten satırları kaldır
</strong>cat /tmp/final-words-s3.txt.temp | grep -Ev "\.$" > /tmp/final-words-s3.txt.temp2
### TLD olmadan liste oluştur
cat /tmp/final-words-s3.txt.temp2 | sed -E 's/\.[a-zA-Z0-9]+$//' > /tmp/final-words-s3.txt.temp3
### Noktalar olmadan liste oluştur
cat /tmp/final-words-s3.txt.temp3 | tr -d "." > /tmp/final-words-s3.txt.temp4http://phantom.s3.amazonaws.com/
### Tireler olmadan liste oluştur
cat /tmp/final-words-s3.txt.temp3 | tr "." "-" > /tmp/final-words-s3.txt.temp5

## Son kelime listesini oluşturun
cat /tmp/final-words-s3.txt.temp2 /tmp/final-words-s3.txt.temp3 /tmp/final-words-s3.txt.temp4 /tmp/final-words-s3.txt.temp5 | grep -v -- "-\." | awk '{print tolower($0)}' | sort -u > /tmp/final-words-s3.txt
## S3 taraması yapın
s3scanner --threads 100 scan --buckets-file /tmp/final-words-s3.txt  | grep bucket_exists
</code></pre>

#### S3 Kovaları
Açık S3 kovaları verildiğinde, [**BucketLoot**](https://github.com/redhuntlabs/BucketLoot) otomatik olarak **ilginç bilgileri arayabilir**.

### Bölgeyi Bulun
AWS tarafından desteklenen tüm bölgeleri [**https://docs.aws.amazon.com/general/latest/gr/s3.html**](https://docs.aws.amazon.com/general/latest/gr/s3.html) adresinde bulabilirsiniz.

#### DNS ile
Bir kovanın bölgesini **`dig`** ve **`nslookup`** ile bulabilirsiniz, keşfedilen IP'nin **DNS isteği** yaparak:
```bash
dig flaws.cloud
;; ANSWER SECTION:
flaws.cloud.    5    IN    A    52.218.192.11

nslookup 52.218.192.11
Non-authoritative answer:
11.192.218.52.in-addr.arpa name = s3-website-us-west-2.amazonaws.com.
```
Çözümlenen alan adında "website" kelimesinin bulunduğunu kontrol edin. 

Statik web sitesine şu adrese giderek erişebilirsiniz: `flaws.cloud.s3-website-us-west-2.amazonaws.com` veya kovaya şu adrese giderek erişebilirsiniz: `flaws.cloud.s3-us-west-2.amazonaws.com`

#### Deneyerek

Bir kovaya erişmeye çalışırken, **alan adında başka bir bölge belirtirseniz** (örneğin kova `bucket.s3.amazonaws.com` içindeyken `bucket.s3-website-us-west-2.amazonaws.com`'e erişmeye çalışırsanız, doğru konuma yönlendirileceksiniz:

![](<../../../.gitbook/assets/image (57).png>)

### Kovayı Numaralandırma

Bir kullanıcı, kovayı açıklığa test etmek için URL'yi web tarayıcısına girebilir. Özel bir kova "Erişim Engellendi" yanıtı verecektir. Genel bir kova, depolanan ilk 1.000 nesneyi listeleyecektir.

Herkes için açık:

![](<../../../.gitbook/assets/image (67).png>)

Özel:

![](<../../../.gitbook/assets/image (78).png>)

Bunu ayrıca komut satırı aracılığıyla da kontrol edebilirsiniz:
```bash
#Use --no-sign-request for check Everyones permissions
#Use --profile <PROFILE_NAME> to indicate the AWS profile(keys) that youwant to use: Check for "Any Authenticated AWS User" permissions
#--recursive if you want list recursivelyls
#Opcionally you can select the region if you now it
aws s3 ls s3://flaws.cloud/ [--no-sign-request] [--profile <PROFILE_NAME>] [ --recursive] [--region us-west-2]
```
Eğer kovada bir alan adı yoksa, onu numaralandırmaya çalışırken, **sadece kova adını** ve tüm AWSs3 alan adını değil. Örnek: `s3://<BUCKETNAME>`

### Genel URL şablonu
```
https://{user_provided}.s3.amazonaws.com
```
### Genel Erişime Açık Kova'dan Hesap Kimliği Alın

Yeni **`S3:ResourceAccount`** **Politika Koşulu Anahtarını** kullanarak bir AWS hesabını belirlemek mümkündür. Bu koşul, erişimi **S3 kovasına** dayalı olarak sınırlar (diğer hesap tabanlı politikalar, istekte bulunan başlığın bulunduğu hesaba dayalı olarak sınırlama yapar).\
Ve politika, **yer tutucular** içerebildiği için hesap numarasını **sadece bir numara ile** bulmak mümkündür.

Bu araç süreci otomatikleştirir:
```bash
# Installation
pipx install s3-account-search
pip install s3-account-search
# With a bucket
s3-account-search arn:aws:iam::123456789012:role/s3_read s3://my-bucket
# With an object
s3-account-search arn:aws:iam::123456789012:role/s3_read s3://my-bucket/path/to/object.ext
```
## Referanslar

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudar.be/awsblog/finding-the-account-id-of-any-public-s3-bucket/](https://cloudar.be/awsblog/finding-the-account-id-of-any-public-s3-bucket/)

<details>

<summary><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek** paylaşın.

</details>
