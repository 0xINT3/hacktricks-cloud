# AWS - S3 Ongeverifieerde Enum

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## S3 Openlike Emmer

'n Emmer word as **"openbaar"** beskou as **enige gebruiker die inhoud** van die emmer kan lys, en **"privaat"** as die inhoud van die emmer **slegs deur sekere gebruikers** gelys of geskryf kan word.

Maatskappye kan **emmer-toestemmings verkeerd konfigureer** h√™ wat toegang gee tot alles of tot enige persoon wat ge√Ødentifiseer is in AWS in enige rekening (dus vir enigiemand). Let daarop dat selfs met sulke verkeerde konfigurasies sommige aksies nie uitgevoer kan word nie, aangesien emmers hul eie toegangbeheerlyste (ACL's) kan h√™.

**Leer meer oor AWS-S3-misconfiguratie hier:** [**http://flaws.cloud**](http://flaws.cloud/) **en** [**http://flaws2.cloud/**](http://flaws2.cloud)

### Vind AWS Emmer

Verskillende metodes om te vind wanneer 'n webblad AWS gebruik om sekere hulpbronne te stoor:

#### Enumerasie & OSINT:

* Gebruik die **wappalyzer**-blaaierinvoegtoepassing
* Gebruik burp (**spidering** deur die web) of deur handmatig deur die bladsy te navigeer, sal alle **hulpbronne** wat **gelaai** word, in die Geskiedenis gestoor word.
*   **Kyk vir hulpbronne** in domeine soos:

```
http://s3.amazonaws.com/[emmer_naam]/
http://[emmer_naam].s3.amazonaws.com/
```
* Kyk vir **CNAMES** aangesien `resources.domain.com` die CNAME `bucket.s3.amazonaws.com` kan h√™
* Kyk na [https://buckets.grayhatwarfare.com](https://buckets.grayhatwarfare.com/), 'n webwerf met reeds **ontdekte oop emmers**.
* Die **emmer-naam** en die **emmer-domeinnaam** moet **gelyk wees.**
* **flaws.cloud** is op **IP** 52.92.181.107 en as jy daarheen gaan, word jy na [https://aws.amazon.com/s3/](https://aws.amazon.com/s3/) omgelei. Ook gee `dig -x 52.92.181.107` `s3-website-us-west-2.amazonaws.com`.
* Om te bevestig dat dit 'n emmer is, kan jy ook [https://flaws.cloud.s3.amazonaws.com/](https://flaws.cloud.s3.amazonaws.com/) **besoek**.

#### Brute-Force

Jy kan emmers vind deur **naam-brute-force** wat verband hou met die maatskappy wat jy pentesting:

* [https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)
* [https://github.com/clario-tech/s3-inspector](https://github.com/clario-tech/s3-inspector)
* [https://github.com/jordanpotti/AWSBucketDump](https://github.com/jordanpotti/AWSBucketDump) (Bevat 'n lys met potensi√´le emmernaam)
* [https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets](https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets)
* [https://github.com/smaranchand/bucky](https://github.com/smaranchand/bucky)
* [https://github.com/tomdev/teh\_s3\_bucketeers](https://github.com/tomdev/teh\_s3\_bucketeers)
* [https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3](https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3)
* [https://github.com/Eilonh/s3crets\_scanner](https://github.com/Eilonh/s3crets\_scanner)
* [https://github.com/belane/CloudHunter](https://github.com/belane/CloudHunter)

<pre class="language-bash"><code class="lang-bash"># Genereer 'n woordelys om permutasies te skep
curl -s https://raw.githubusercontent.com/cujanovic/goaltdns/master/words.txt > /tmp/words-s3.txt.temp
curl -s https://raw.githubusercontent.com/jordanpotti/AWSBucketDump/master/BucketNames.txt >>/tmp/words-s3.txt.temp
cat /tmp/words-s3.txt.temp | sort -u > /tmp/words-s3.txt

# Genereer 'n woordelys gebaseer op die domeine en subdomeine om te toets
## Skryf daardie domeine en subdomeine in subdomains.txt
cat subdomains.txt > /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "-" >> /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "\n" | sort -u >> /tmp/words-hosts-s3.txt

# Skep permutasies gebaseer op 'n lys met die domeine en subdomeine om aan te val
goaltdns -l /tmp/words-hosts-s3.txt -w /tmp/words-s3.txt -o /tmp/final-words-s3.txt.temp
## Die vorige instrument is gespesialiseerd in die skep van permutasies vir subdomeine, laat ons daardie lys filter
<strong>### Verwyder lyne wat eindig met "."
</strong>cat /tmp/final-words-s3.txt.temp | grep -Ev "\.$" > /tmp/final-words-s3.txt.temp2
### Skep 'n lys sonder TLD
cat /tmp/final-words-s3.txt.temp2 | sed -E 's/\.[a-zA-Z0-9]+$//' > /tmp/final-words-s3.txt.temp3
### Skep 'n lys sonder punte
cat /tmp/final-words-s3.txt.temp3 | tr -d "." > /tmp/final-words-s3.txt.temp4http://phantom.s3.amazonaws.com/
### Skep 'n lys sonder koppeltekens
cat /tmp/final-words-s3.txt.temp3 | tr "." "-" > /tmp/final-words-s3.txt.temp5

## Skep die finale woordelys
cat /tmp/final-words-s3.txt.temp2 /tmp/final-words-s3.txt.temp3 /tmp/final-words-s3.txt.temp4 /tmp/final-words-s3.txt.temp5 | grep -v -- "-\." | awk '{print tolower($0)}' | sort -u > /tmp/final-words-s3.txt
## Roep s3scanner aan
s3scanner --threads 100 scan --buckets-file /tmp/final-words-s3.txt  | grep bucket_exists
</code></pre>

#### Roof S3 Emmers

Met oop S3 emmers kan [**BucketLoot**](https://github.com/redhuntlabs/BucketLoot) outomaties **soek na interessante inligting**.

### Vind die Streek

Jy kan al die ondersteunde streke deur AWS vind in [**https://docs.aws.amazon.com/general/latest/gr/s3.html**](https://docs.aws.amazon.com/general/latest/gr/s3.html)

#### Deur DNS

Jy kan die streek van 'n emmer kry met 'n **`dig`** en **`nslookup`** deur 'n **DNS-versoek van die ontdekte IP** te doen:
```bash
dig flaws.cloud
;; ANSWER SECTION:
flaws.cloud.    5    IN    A    52.218.192.11

nslookup 52.218.192.11
Non-authoritative answer:
11.192.218.52.in-addr.arpa name = s3-website-us-west-2.amazonaws.com.
```
Kontroleer of die opgeloste domein die woord "webwerf" bevat.\
Jy kan toegang kry tot die statiese webwerf deur na die volgende adres te gaan: `flaws.cloud.s3-website-us-west-2.amazonaws.com`\
of jy kan die emmer besoek deur na die volgende adres te gaan: `flaws.cloud.s3-us-west-2.amazonaws.com`

#### Deur te probeer

As jy probeer om toegang tot 'n emmer te verkry, maar in die **domeinnaam spesifiseer jy 'n ander streek** (byvoorbeeld die emmer is in `bucket.s3.amazonaws.com` maar jy probeer toegang verkry tot `bucket.s3-website-us-west-2.amazonaws.com`), sal jy **na die korrekte plek verwys word**:

![](<../../../.gitbook/assets/image (57).png>)

### Enumerating die emmer

Om die oopheid van die emmer te toets, kan 'n gebruiker net die URL in hul webblaaier invoer. 'n Privaat emmer sal reageer met "Toegang Geweier". 'n Openbare emmer sal die eerste 1,000 voorwerpe wat gestoor is, lys.

Oop vir almal:

![](<../../../.gitbook/assets/image (67).png>)

Privaat:

![](<../../../.gitbook/assets/image (78).png>)

Jy kan dit ook met die opdraglyn toets:
```bash
#Use --no-sign-request for check Everyones permissions
#Use --profile <PROFILE_NAME> to indicate the AWS profile(keys) that youwant to use: Check for "Any Authenticated AWS User" permissions
#--recursive if you want list recursivelyls
#Opcionally you can select the region if you now it
aws s3 ls s3://flaws.cloud/ [--no-sign-request] [--profile <PROFILE_NAME>] [ --recursive] [--region us-west-2]
```
As die emmer nie 'n domeinnaam het nie, wanneer jy probeer om dit op te som, **plaas slegs die emmernaam** en nie die hele AWSs3-domein nie. Voorbeeld: `s3://<EMMERNOMMER>`

### Openbare URL-sjabloon
```
https://{user_provided}.s3.amazonaws.com
```
### Kry Rekening ID van openbare Emmertjie

Dit is moontlik om 'n AWS-rekening te bepaal deur gebruik te maak van die nuwe **`S3:ResourceAccount`** **Beleidstoestand Sleutel**. Hierdie toestand **beperk toegang gebaseer op die S3-emmertjie** waarin 'n rekening is (ander rekening-gebaseerde beleide beperk gebaseer op die rekening waarin die versoekende hoof is).\
En omdat die beleid **wildcards** kan bevat, is dit moontlik om die rekeningnommer **net een nommer op 'n slag** te vind.

Hierdie instrument outomatiseer die proses:
```bash
# Installation
pipx install s3-account-search
pip install s3-account-search
# With a bucket
s3-account-search arn:aws:iam::123456789012:role/s3_read s3://my-bucket
# With an object
s3-account-search arn:aws:iam::123456789012:role/s3_read s3://my-bucket/path/to/object.ext
```
## Verwysings

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudar.be/awsblog/finding-the-account-id-of-any-public-s3-bucket/](https://cloudar.be/awsblog/finding-the-account-id-of-any-public-s3-bucket/)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>
