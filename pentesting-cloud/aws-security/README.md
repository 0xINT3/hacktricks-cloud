# AWS рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реБрд░реБрдЖрдд рд╕реЗ рд▓реЗрдХрд░ рдПрдХреНрд╕рдкрд░реНрдЯ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

**AWS рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ** рдЖрдкрдХреЛ AWS рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ **рдореВрд▓ рдмрд╛рддреЗрдВ рдЬрд╛рдирдиреА рдЪрд╛рд╣рд┐рдП** рдЬреЛ рдЖрдкрдХреЛ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдВрдЧреА рдХрд┐ рдЖрдкрдХреЛ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ, рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреИрд╕реЗ рдвреВрдВрдврдирд╛ рд╣реИ рдФрд░ рдЙрдирдХрд╛ рд╢реЛрд╖рдг рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИред

рд╕рдВрдЧрдарди рдХреА рд╣рд╛рдпрд░рд╛рд░реНрдХреА, IAM рдФрд░ рдЕрдиреНрдп рдореВрд▓ рдЕрд╡рдзрд╛рд░рдгрд╛рдУрдВ рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдпрд╣рд╛рдБ рдХреА рдЧрдИ рд╣реИ:

{% content-ref url="aws-basic-information/" %}
[aws-basic-information](aws-basic-information/)
{% endcontent-ref %}

## рд╕реАрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд▓реИрдмреНрд╕

* [https://github.com/RhinoSecurityLabs/cloudgoat](https://github.com/RhinoSecurityLabs/cloudgoat)
* [https://hackingthe.cloud/aws/capture\_the\_flag/cicdont/](https://hackingthe.cloud/aws/capture\_the\_flag/cicdont/)
* [https://github.com/BishopFox/iam-vulnerable](https://github.com/BishopFox/iam-vulnerable)
* [https://github.com/nccgroup/sadcloud](https://github.com/nccgroup/sadcloud)
* [https://github.com/bridgecrewio/terragoat](https://github.com/bridgecrewio/terragoat)
* [https://github.com/ine-labs/AWSGoat](https://github.com/ine-labs/AWSGoat)
* [http://flaws.cloud/](http://flaws.cloud/)
* [http://flaws2.cloud/](http://flaws2.cloud/)

рд╣рдорд▓реЛрдВ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреВрд▓реНрд╕:

* [https://github.com/Datadog/stratus-red-team/](https://github.com/Datadog/stratus-red-team/)
* [https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main](https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main)

## AWS рдкреЗрдВрдЯреЗрд╕реНрдЯрд░/рд░реЗрдб рдЯреАрдо рдореЗрдердбреЛрд▓реЙрдЬреА

AWS рдкрд░реНрдпрд╛рд╡рд░рдг рдХрд╛ рдСрдбрд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЬрд╛рдирдирд╛ рдмрд╣реБрдд рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ: рдХреМрди рд╕реА **рд╕реЗрд╡рд╛рдПрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИрдВ**, рдХреНрдпрд╛ **рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ**, рдХрд┐рд╕рдХреЗ рдкрд╛рд╕ рдХрд┐рд╕ рдЪреАрдЬрд╝ рдХреА **рдкрд╣реБрдВрдЪ** рд╣реИ, рдФрд░ рдХреИрд╕реЗ рдЖрдВрддрд░рд┐рдХ AWS рд╕реЗрд╡рд╛рдПрдВ рдФрд░ **рдмрд╛рд╣рд░реА рд╕реЗрд╡рд╛рдПрдВ** рдЬреБрдбрд╝реА рд╣реБрдИ рд╣реИрдВред

рд░реЗрдб рдЯреАрдо рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, AWS рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХрд╛ **рдкрд╣рд▓рд╛ рдХрджрдо** рдХреБрдЫ **рдкреНрд░рдорд╛рдг-рдкрддреНрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛** рд╣реИред рдпрд╣рд╛рдБ рдХреБрдЫ рд╡рд┐рдЪрд╛рд░ рд╣реИрдВ рдХрд┐ рдЖрдк рдРрд╕рд╛ рдХреИрд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* github (рдпрд╛ рдЗрд╕реА рддрд░рд╣) рдореЗрдВ **рд▓реАрдХ** - OSINT
* **рд╕рд╛рдорд╛рдЬрд┐рдХ** рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ
* **рдкрд╛рд╕рд╡рд░реНрдб** рдкреБрди: рдЙрдкрдпреЛрдЧ (рдкрд╛рд╕рд╡рд░реНрдб рд▓реАрдХ)
* AWS-рд╣реЛрд╕реНрдЯреЗрдб рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдореЗрдВ рднреЗрджреНрдпрддрд╛рдПрдВ
* рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд╕рд╛рде [**рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдлреЛрд░реНрдЬрд░реА**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf)
* **рд▓реЛрдХрд▓ рдлрд╛рдЗрд▓ рд░реАрдб**
* `/home/USERNAME/.aws/credentials`
* `C:\Users\USERNAME\.aws\credentials`
* рддреАрд╕рд░реЗ рдкрдХреНрд╖ **рдмреНрд░реАрдЪреНрдб**
* **рдЖрдВрддрд░рд┐рдХ** рдХрд░реНрдордЪрд╛рд░реА
* [**Cognito**](aws-services/aws-cognito-enum/#cognito) рдкреНрд░рдорд╛рдг-рдкрддреНрд░

рдпрд╛ **рдПрдХ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рд╕реЗрд╡рд╛ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдХреЗ** рдЬреЛ рдЙрдЬрд╛рдЧрд░ рдХреА рдЧрдИ рд╣реИ:

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

рдпрд╛ рдпрджрд┐ рдЖрдк **рд╕рдореАрдХреНрд╖рд╛** рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдЖрдк рдЗрди рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ **рдкреНрд░рдорд╛рдг-рдкрддреНрд░ рдорд╛рдВрдЧ рд╕рдХрддреЗ рд╣реИрдВ**:

{% content-ref url="aws-permissions-for-a-pentest.md" %}
[aws-permissions-for-a-pentest.md](aws-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
рдкреНрд░рдорд╛рдг-рдкрддреНрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ **рд╡реЗ рдХрд┐рд╕рдХреЗ рд╣реИрдВ**, рдФрд░ **рдЙрдирдХреА рдкрд╣реБрдВрдЪ рдХреНрдпрд╛ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдХреБрдЫ рдореВрд▓ рдЧрдгрдирд╛ рдХрд░рдиреА рд╣реЛрдЧреА:
{% endhint %}

## рдореВрд▓ рдЧрдгрдирд╛

### SSRF

рдпрджрд┐ рдЖрдкрдиреЗ AWS рдХреЗ рдЕрдВрджрд░ рдХрд┐рд╕реА рдорд╢реАрди рдореЗрдВ SSRF рдкрд╛рдпрд╛ рд╣реИ рддреЛ рдЯреНрд░рд┐рдХреНрд╕ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреЗрдЬ рдХреЛ рджреЗрдЦреЗрдВ:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Whoami

рдЖрдкрдХреЛ рдкрд╣рд▓реА рдЪреАрдЬрд╝ рдЬреЛ рдЬрд╛рдирдиреА рдЪрд╛рд╣рд┐рдП рд╡рд╣ рд╣реИ рдХрд┐ рдЖрдк рдХреМрди рд╣реИрдВ (рдЖрдк рдХрд┐рд╕ рдЦрд╛рддреЗ рдореЗрдВ рд╣реИрдВ рдФрд░ AWS рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдиреНрдп рдЬрд╛рдирдХрд╛рд░реА):
```bash
# Easiest way, but might be monitored?
aws sts get-caller-identity
aws iam get-user # This will get your own user

# If you have a Key ID
aws sts get-access-key-info --access-key-id=ASIA1234567890123456

# Get inside error message
aws sns publish --topic-arn arn:aws:sns:us-east-1:*account id*:aaa --message aaa

# From metadata
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`
curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/dynamic/instance-identity/document
```
{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдВрдкрдирд┐рдпрд╛рдВ **canary tokens** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреА рд╣реИрдВ рдЬрдм **tokens рдЪреЛрд░реА рд╣реЛ рд░рд╣реЗ рд╣реЛрдВ рдФрд░ рдЙрдкрдпреЛрдЧ рдореЗрдВ рд▓рд╛рдП рдЬрд╛ рд░рд╣реЗ рд╣реЛрдВ** рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЯреЛрдХрди canary token рд╣реИ рдпрд╛ рдирд╣реАрдВред\
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рджреЗрдЦреЗрдВ**](aws-services/aws-security-and-detection-services/aws-cloudtrail-enum.md#honeytokens-bypass).
{% endhint %}

### Org Enumeration

{% content-ref url="../aws-pentesting/aws-services/aws-organizations-enum.md" %}
[aws-organizations-enum.md](../aws-pentesting/aws-services/aws-organizations-enum.md)
{% endcontent-ref %}

### IAM Enumeration

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдВ рд╣реИрдВ **AWS рдЦрд╛рддреЗ рдХреЗ рдЕрдВрджрд░ рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрд╕реНрдерд╛ рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛** рдЖрдкрдХреЛ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ рдХрд┐ рдЖрдк рдФрд░ рдЕрдиреНрдп рдкрд╣рдЪрд╛рдиреЗрдВ рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреИрд╕реЗ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ IAM рдХрд╛ рдЕрдиреБрдХреНрд░рдордг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдВ рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рдЖрдк **рдЙрдиреНрд╣реЗрдВ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ bruteforce рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рдЕрдиреБрдХреНрд░рдордг рдФрд░ brute-forcing **рдХреИрд╕реЗ рдХрд░реЗрдВ** рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП:

{% content-ref url="aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](aws-services/aws-iam-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
рдЕрдм рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ **рдЕрдкрдиреА рд╕рд╛рдЦ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рд╣реИ** (рдФрд░ рдпрджрд┐ рдЖрдк рдПрдХ рд░реЗрдб рдЯреАрдо рд╣реИрдВ рддреЛ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдк **рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓рд╛ рд╣реИ**). рдпрд╣ рд╕рдордп рд╣реИ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рдХрд┐ рдХреМрди рд╕реА рд╕реЗрд╡рд╛рдПрдВ рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИрдВред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЦрдВрдб рдореЗрдВ рдЖрдк рдХреБрдЫ **рд╕рд╛рдорд╛рдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЕрдиреБрдХреНрд░рдордг рдХреИрд╕реЗ рдХрд░реЗрдВ** рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

## Services Enumeration, Post-Exploitation & Persistence

AWS рдореЗрдВ рдЕрджреНрднреБрдд рдорд╛рддреНрд░рд╛ рдореЗрдВ рд╕реЗрд╡рд╛рдПрдВ рд╣реИрдВ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдореЗрдВ рдЖрдкрдХреЛ рдХреБрдЫ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ **рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА, рдЕрдиреБрдХреНрд░рдордг** cheatsheets, **рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓рдиреЗ рд╕реЗ рдмрдЪрдиреЗ**, **рдкрд░реНрд╕рд┐рд╕реНрдЯреЗрдВрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ**, рдФрд░ рдЕрдиреНрдп **post-exploitation** рдЪрд╛рд▓реЗрдВ рдорд┐рд▓реЗрдВрдЧреА:

{% content-ref url="aws-services/" %}
[aws-services](aws-services/)
{% endcontent-ref %}

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдкрдХреЛ рд╕рднреА рдХрд╛рдо **рдореИрдиреНрдпреБрдЕрд▓реА** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ **рдирд╣реАрдВ** рд╣реИ, рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЗ рдиреАрдЪреЗ рдЖрдкрдХреЛ **рдСрдЯреЛрдореИрдЯрд┐рдХ рдЯреВрд▓реНрд╕** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ **рдЦрдВрдб** рдорд┐рд▓реЗрдЧрд╛ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдЪрд░рдг рдореЗрдВ рдЖрдкрдиреЗ рд╢рд╛рдпрдж **рдФрд░ рдЕрдзрд┐рдХ рд╕реЗрд╡рд╛рдПрдВ рдЦреЛрдЬреА рд╣реЛрдВрдЧреА рдЬреЛ рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЙрдЬрд╛рдЧрд░ рд╣реИрдВ,** рдЖрдк рдЙрдирдХрд╛ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

## Privilege Escalation

рдпрджрд┐ рдЖрдк **рдХрдо рд╕реЗ рдХрдо рдЕрдкрдиреА рдЦреБрдж рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ рддреЛ рдЖрдк **рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдЖрдЧреЗ рдХреА рдЕрдиреБрдорддрд┐рдпрд╛рдВ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЖрдкрдХреЛ рдХрдо рд╕реЗ рдХрдо рдЙрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ рдЗрдВрдЧрд┐рдд рдХреА рдЧрдИ рд╣реИрдВ:

{% content-ref url="aws-privilege-escalation/" %}
[aws-privilege-escalation](aws-privilege-escalation/)
{% endcontent-ref %}

## Publicly Exposed Services

AWS рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЕрдиреБрдХреНрд░рдордг рдХрд░рддреЗ рд╕рдордп рдЖрдкрдиреЗ рдХреБрдЫ рдХреЛ рдкрд╛рдпрд╛ рд╣реЛрдЧрд╛ **рдЗрдВрдЯрд░рдиреЗрдЯ рдХреЗ рд▓рд┐рдП рддрддреНрд╡реЛрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВ** (VM/Containers рдкреЛрд░реНрдЯреНрд╕, рдбреЗрдЯрд╛рдмреЗрд╕ рдпрд╛ рдХрддрд╛рд░ рд╕реЗрд╡рд╛рдПрдВ, рд╕реНрдиреИрдкрд╢реЙрдЯреНрд╕ рдпрд╛ рдмрдХреЗрдЯреНрд╕...).\
рдкреЗрдВрдЯреЗрд╕реНрдЯрд░/рд░реЗрдб рдЯреАрдорд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдкрдХреЛ рд╣рдореЗрд╢рд╛ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЖрдк **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА / рдХрдордЬреЛрд░рд┐рдпрд╛рдВ** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЖрдкрдХреЛ AWS рдЦрд╛рддреЗ рдореЗрдВ **рдЖрдЧреЗ рдХреА рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдЗрд╕ рдкреБрд╕реНрддрдХ рдореЗрдВ рдЖрдкрдХреЛ **рдЬрд╛рдирдХрд╛рд░реА** рдорд┐рд▓рдиреА рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреИрд╕реЗ **рдЙрдЬрд╛рдЧрд░ AWS рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЦреЛрдЬреЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рдЬрд╛рдВрдЪреЗрдВ**ред рдЙрдЬрд╛рдЧрд░ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ **рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдореИрдВ рдЖрдкрдХреЛ **рдЦреЛрдЬ** рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░реВрдВрдЧрд╛ рд╡рд┐рд╢рд┐рд╖реНрдЯ **рд╕реЗрд╡рд╛** рдХреЗ рд▓рд┐рдП:

{% embed url="https://book.hacktricks.xyz/" %}

## Compromising the Organization

### From the root/management account

рдЬрдм рдкреНрд░рдмрдВрдзрди рдЦрд╛рддрд╛ рд╕рдВрдЧрдарди рдореЗрдВ рдирдП рдЦрд╛рддреЗ рдмрдирд╛рддрд╛ рд╣реИ, рдПрдХ **рдирдИ рднреВрдорд┐рдХрд╛** рдирдП рдЦрд╛рддреЗ рдореЗрдВ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **`OrganizationAccountAccessRole`** рдирд╛рдо рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ **рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ** рдХреЛ рдирдП рдЦрд╛рддреЗ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **AdministratorAccess** рдиреАрддрд┐ рджреА рдЬрд╛рддреА рд╣реИред

<figure><img src="../../.gitbook/assets/image (3) (3) (2).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕рд▓рд┐рдП, рдПрдХ рдмрдЪреНрдЪреЗ рдЦрд╛рддреЗ рдХреЛ рдкреНрд░рд╢рд╛рд╕рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЪрд╛рд╣рд┐рдП:

* **рдкреНрд░рдмрдВрдзрди** рдЦрд╛рддреЗ рдХреЛ **рд╕рдордЭреМрддрд╛** рдХрд░реЗрдВ рдФрд░ **рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдХреА ID** рдФрд░ **рднреВрдорд┐рдХрд╛ рдХреЗ рдирд╛рдо** (OrganizationAccountAccessRole рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ) рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ рдЬреЛ рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ рдХреЛ рдкреНрд░рд╢рд╛рд╕рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
* рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП aws рдХрдВрд╕реЛрд▓ рдореЗрдВ рд╕рдВрдЧрдардиреЛрдВ рдХреЗ рдЕрдиреБрднрд╛рдЧ рдкрд░ рдЬрд╛рдПрдВ рдпрд╛ `aws organizations list-accounts` рдЪрд▓рд╛рдПрдВ
* рдЖрдк рд╕реАрдзреЗ рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рдирд╛рдо рдирд╣реАрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╕рднреА рдХрд╕реНрдЯрдо IAM рдиреАрддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рдХрд┐рд╕реА рднреА рдЦреЛрдЬреЗрдВ рдЬреЛ **`sts:AssumeRole` рдкрд╣рд▓реЗ рдЦреЛрдЬреЗ рдЧрдП рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдкрд░ рдЕрдиреБрдорддрд┐ рджреЗ рд░рд╣реА рд╣реЛ**ред
* рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ рдореЗрдВ рдПрдХ **рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рд╕рдордЭреМрддрд╛** рдХрд░реЗрдВ рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдореЗрдВ рднреВрдорд┐рдХрд╛ рдкрд░ **`sts:AssumeRole` рдЕрдиреБрдорддрд┐ рд╣реЛ** (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЕрдЧрд░ рдЦрд╛рддрд╛ рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ рд╕реЗ рдХрд┐рд╕реА рдХреЛ рднреА рдирдХрд▓реА рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд░рд╣рд╛ рд╣реЛ, рдЪреВрдВрдХрд┐ рдпрд╣ рдПрдХ рдмрд╛рд╣рд░реА рдЦрд╛рддрд╛ рд╣реИ, рд╡рд┐рд╢рд┐рд╖реНрдЯ `sts:AssumeRole` рдЕрдиреБрдорддрд┐рдпрд╛рдВ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ)ред

## Automated Tools

### Recon

* [**aws-recon**](https://github.com/darkbitio/aws-recon): рд░реВрдмреА рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдПрдХ рдорд▓реНрдЯреА-рдереНрд░реЗрдбреЗрдб AWS рд╕реБрд░рдХреНрд╖рд╛-рдХреЗрдВрджреНрд░рд┐рдд **рдЗрдиреНрд╡реЗрдВрдЯрд░реА рд╕рдВрдЧреНрд░рд╣ рдЯреВрд▓**ред
```bash
# Install
gem install aws_recon

# Recon and get json
AWS_PROFILE=<profile> aws_recon \
--services S3,EC2 \
--regions global,us-east-1,us-east-2 \
--verbose
```
* [**cloudlist**](https://github.com/projectdiscovery/cloudlist): Cloudlist рдПрдХ **multi-cloud рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ Cloud Providers рд╕реЗ Assets** (Hostnames, IP Addresses) рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред
* [**cloudmapper**](https://github.com/duo-labs/cloudmapper): CloudMapper рдЖрдкрдХреЛ рдЕрдкрдиреЗ Amazon Web Services (AWS) рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред рдЕрдм рдЗрд╕рдореЗрдВ рдХрдИ рдФрд░ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдПрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдореБрджреНрджреЛрдВ рдХреЗ рд▓рд┐рдП рдСрдбрд┐рдЯрд┐рдВрдЧ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИред
```bash
# Installation steps in github
# Create a config.json file with the aws info, like:
{
"accounts": [
{
"default": true,
"id": "<account id>",
"name": "dev"
}
],
"cidrs":
{
"2.2.2.2/28": {"name": "NY Office"}
}
}

# Enumerate
python3 cloudmapper.py collect --profile dev
## Number of resources discovered
python3 cloudmapper.py stats --accounts dev

# Create HTML report
## In the report you will find all the info already
python3 cloudmapper.py report --accounts dev

# Identify potential issues
python3 cloudmapper.py audit --accounts dev --json > audit.json
python3 cloudmapper.py audit --accounts dev --markdow > audit.md
python3 cloudmapper.py iam_report --accounts dev

# Identify admins
## The permissions search for are in https://github.com/duo-labs/cloudmapper/blob/4df9fd7303e0337ff16a08f5e58f1d46047c4a87/shared/iam_audit.py#L163-L175
python3 cloudmapper.py find_admins --accounts dev

# Identify unused elements
python3 cloudmapper.py find_unused --accounts dev

# Identify publivly exposed resources
python3 cloudmapper.py public --accounts dev

python cloudmapper.py prepare #Prepare webserver
python cloudmapper.py webserver #Show webserver
```
* [**cartography**](https://github.com/lyft/cartography): Cartography рдПрдХ Python рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рдХреЛ рд╕рдореЗрдХрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдирдХреЗ рдмреАрдЪ рдХреЗ рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ Neo4j рдбреЗрдЯрд╛рдмреЗрд╕ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд рдПрдХ рд╕рд╣рдЬ рдЧреНрд░рд╛рдл рджреГрд╢реНрдп рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИред
```bash
# Install
pip install cartography
## At the time of this writting you need neo4j version 3.5.*

# Get AWS info
AWS_PROFILE=dev cartography --neo4j-uri bolt://127.0.0.1:7687 --neo4j-password-prompt  --neo4j-user neo4j
```
* [**starbase**](https://github.com/JupiterOne/starbase): Starbase рд╕реЗрд╡рд╛рдУрдВ рдФрд░ рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рд╕реЗ рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рдФрд░ рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рдПрдХрддреНрд░ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреНрд▓рд╛рдЙрдб рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░, SaaS рдПрдкреНрд▓рд┐рдХреЗрд╢рди, рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдВрддреНрд░рдг, рдФрд░ рдЕрдзрд┐рдХ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЬрд┐рд╕реЗ Neo4j рдбреЗрдЯрд╛рдмреЗрд╕ рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рдПрдХ рд╕рд╣рдЬ рдЧреНрд░рд╛рдл рджреГрд╢реНрдп рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* [**aws-inventory**](https://github.com/nccgroup/aws-inventory): (python2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ) рдпрд╣ рдПрдХ рдЯреВрд▓ рд╣реИ рдЬреЛ рдПрдХ рдЦрд╛рддреЗ рдореЗрдВ рдмрдирд╛рдП рдЧрдП рд╕рднреА [**AWS рд╕рдВрд╕рд╛рдзрдиреЛрдВ**](https://docs.aws.amazon.com/general/latest/gr/glos-chap.html#resource) рдХреА **рдЦреЛрдЬ** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИред
* [**aws\_public\_ips**](https://github.com/arkadiyt/aws\_public\_ips): рдпрд╣ рдПрдХ рдЯреВрд▓ рд╣реИ рдЬреЛ рдПрдХ AWS рдЦрд╛рддреЗ рд╕реЗ рдЬреБрдбрд╝реЗ рд╕рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ IP рдкрддреЗ (IPv4/IPv6 рджреЛрдиреЛрдВ) рдХреЛ **рдкреНрд░рд╛рдкреНрдд** рдХрд░рддрд╛ рд╣реИред

### Privesc & Exploiting

* [**SkyArk**](https://github.com/cyberark/SkyArk)**:** рд╕реНрдХреИрди рдХрд┐рдП рдЧрдП AWS рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рдЬрд┐рд╕рдореЗрдВ AWS Shadow Admins рднреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП powershell рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред рдЖрдк **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдиреАрддрд┐рдпреЛрдВ рдХреА рдкрд░рд┐рднрд╛рд╖рд╛** рдХреЛ **`Check-PrivilegedPolicy`** рдлрдВрдХреНрд╢рди рдореЗрдВ [https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1](https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1) рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
* [**pacu**](https://github.com/RhinoSecurityLabs/pacu): Pacu рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ **AWS рд╢реЛрд╖рдг рдлреНрд░реЗрдорд╡рд░реНрдХ** рд╣реИ, рдЬрд┐рд╕реЗ рдХреНрд▓рд╛рдЙрдб рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЖрдХреНрд░рд╛рдордХ рд╕реБрд░рдХреНрд╖рд╛ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ **рдЧрд┐рдирддреА**, **рдЧрд▓рдд-рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдирдХрд╛ **рд╢реЛрд╖рдг** рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЖрдк **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдкрд░рд┐рднрд╛рд╖рд╛** рдХреЛ [https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134](https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134) рдореЗрдВ **`user_escalation_methods`** dict рдХреЗ рдЕрдВрджрд░ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ pacu рдХреЗрд╡рд▓ рдЖрдкрдХреЗ рдЕрдкрдиреЗ privescs рдкрдереЛрдВ рдХреА **рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ** (рдЦрд╛рддреЗ рдХреЗ рд╡реНрдпрд╛рдкрдХ рдирд╣реАрдВ)ред
```bash
# Install
## Feel free to use venvs
pip3 install pacu

# Use pacu CLI
pacu
> import_keys <profile_name> # import 1 profile from .aws/credentials
> import_keys --all # import all profiles
> list # list modules
> exec iam__enum_permissions # Get permissions
> exec iam__privesc_scan # List privileged permissions
```
* [**PMapper**](https://github.com/nccgroup/PMapper): Principal Mapper (PMapper) рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╣реИ рдЬреЛ AWS Identity and Access Management (IAM) рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдЬреЛрдЦрд┐рдореЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддреА рд╣реИ, рдЪрд╛рд╣реЗ рд╡рд╣ рдПрдХ AWS рдЕрдХрд╛рдЙрдВрдЯ рдХреЗ рд▓рд┐рдП рд╣реЛ рдпрд╛ рдПрдХ AWS рд╕рдВрдЧрдарди рдХреЗ рд▓рд┐рдПред рдпрд╣ рдПрдХ рдЕрдХрд╛рдЙрдВрдЯ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди IAM Users рдФрд░ Roles рдХреЛ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдЧреНрд░рд╛рдлрд╝ рдХреЗ рд░реВрдк рдореЗрдВ рдореЙрдбрд▓ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ **privilege escalation** рдХреА рдЬрд╛рдВрдЪ рдФрд░ рдЙрди рд╡реИрдХрд▓реНрдкрд┐рдХ рдорд╛рд░реНрдЧреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ AWS рдореЗрдВ рдХрд┐рд╕реА рд╕рдВрд╕рд╛рдзрди рдпрд╛ рдХреНрд░рд┐рдпрд╛ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддрд╛ рд╣реИред рдЖрдк **privesc** рдорд╛рд░реНрдЧреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЧрдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ `_edges.py` рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдирд╛рдореЛрдВ рдореЗрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ [https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing](https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing)
```bash
# Install
pip install principalmapper

# Get data
pmapper --profile dev graph create
pmapper --profile dev graph display # Show basic info
# Generate graph
pmapper --profile dev visualize # Generate svg graph file (can also be png, dot and graphml)
pmapper --profile dev visualize --only-privesc # Only privesc permissions

# Generate analysis
pmapper --profile dev analysis
## Run queries
pmapper --profile dev query 'who can do iam:CreateUser'
pmapper --profile dev query 'preset privesc *' # Get privescs with admins

# Get organization hierarchy data
pmapper --profile dev orgs create
pmapper --profile dev orgs display
```
* [**cloudsplaining**](https://github.com/salesforce/cloudsplaining): Cloudsplaining рдПрдХ AWS IAM рд╕реБрд░рдХреНрд╖рд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдиреНрдпреВрдирддрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рдЙрд▓реНрд▓рдВрдШрди рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдЬреЛрдЦрд┐рдо-рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рд╡рд╛рд▓реА HTML рд░рд┐рдкреЛрд░реНрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред\
рдпрд╣ рдЖрдкрдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ **over privileged** рдЧреНрд░рд╛рд╣рдХ, рдЗрдирд▓рд╛рдЗрди рдФрд░ aws **policies** рджрд┐рдЦрд╛рдПрдЧрд╛ рдФрд░ рдпрд╣ рднреА рдХрд┐ рдХреМрди рд╕реЗ **principals рдХреЛ рдЙрди рддрдХ рдкрд╣реБрдБрдЪ рд╣реИ**ред (рдпрд╣ рдХреЗрд╡рд▓ privesc рдХреЗ рд▓рд┐рдП рд╣реА рдирд╣реАрдВ рдЬрд╛рдБрдЪ рдХрд░рддрд╛ рдмрд▓реНрдХрд┐ рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреА рджрд┐рд▓рдЪрд╕реНрдк рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рднреА, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕реБрдЭрд╛рд╡рд┐рдд рд╣реИ)ред
```bash
# Install
pip install cloudsplaining

# Download IAM policies to check
## Only the ones attached with the versions used
cloudsplaining download --profile dev

# Analyze the IAM policies
cloudsplaining scan --input-file /private/tmp/cloudsplaining/dev.json --output /tmp/files/
```
* [**cloudjack**](https://github.com/prevade/cloudjack): CloudJack AWS рдЦрд╛рддреЛрдВ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддрд╛ рд╣реИ **subdomain hijacking vulnerabilities** рдХреЗ рд▓рд┐рдП рдЬреЛ Route53 рдФрд░ CloudFront рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдЕрд▓рдЧ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
* [**ccat**](https://github.com/RhinoSecurityLabs/ccat): ECR repos рдХреА рд╕реВрдЪреА рдмрдирд╛рдПрдВ -> ECR repo рдХреЛ рдкреБрд▓ рдХрд░реЗрдВ -> рдЙрд╕рдореЗрдВ Backdoor рдбрд╛рд▓реЗрдВ -> Backdoored image рдХреЛ рдкреБрд╢ рдХрд░реЗрдВ
* [**Dufflebag**](https://github.com/bishopfox/dufflebag): Dufflebag рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ Elastic Block Storage (**EBS**) snapshots рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **secrets рдХреА рдЦреЛрдЬ** рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЧрд▓рддреА рд╕реЗ рдЫреЛрдбрд╝реЗ рдЧрдП рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

### Audit

* [**cloudsploit**](https://github.com/aquasecurity/cloudsploit)**:** CloudSploit by Aqua рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╣реИ рдЬрд┐рд╕реЗ **cloud infrastructure рдореЗрдВ security risks рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: Amazon Web Services (AWS), Microsoft Azure, Google Cloud Platform (GCP), Oracle Cloud Infrastructure (OCI), рдФрд░ GitHub (рдпрд╣ ShadowAdmins рдХреА рдЦреЛрдЬ рдирд╣реАрдВ рдХрд░рддрд╛)ред
```bash
./index.js --csv=file.csv --console=table --config ./config.js

# Compiance options: --compliance {hipaa,cis,cis1,cis2,pci}
## use "cis" for cis level 1 and 2
```
* [**Prowler**](https://github.com/prowler-cloud/prowler): Prowler рдПрдХ Open Source рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрдХрд░рдг рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ AWS рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкреНрд░рдерд╛рдУрдВ рдХрд╛ рдЖрдХрд▓рди, рдСрдбрд┐рдЯ, рдШрдЯрдирд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛, рдирд┐рд░рдВрддрд░ рдирд┐рдЧрд░рд╛рдиреА, рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ рдФрд░ рдлреЛрд░реЗрдВрд╕рд┐рдХ рддрддреНрдкрд░рддрд╛ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
```bash
# Install python3, jq and git
# Install
pip install prowler
prowler -v

# Run
prowler <provider>
prowler aws --profile custom-profile [-M csv json json-asff html]
```
* [**CloudFox**](https://github.com/BishopFox/cloudfox): CloudFox рдЖрдкрдХреЛ рдЕрдкрд░рд┐рдЪрд┐рдд рдХреНрд▓рд╛рдЙрдб рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд╕реНрдерд┐рддрд┐рдЬрдиреНрдп рдЬрд╛рдЧрд░реВрдХрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдУрдкрди рд╕реЛрд░реНрд╕ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдЯреВрд▓ рд╣реИ рдЬрд┐рд╕реЗ рдкреЗрдиреЗрдЯреНрд░реЗрд╢рди рдЯреЗрд╕реНрдЯрд░реНрд╕ рдФрд░ рдЕрдиреНрдп рдЖрдХреНрд░рд╛рдордХ рд╕реБрд░рдХреНрд╖рд╛ рдкреЗрд╢реЗрд╡рд░реЛрдВ рдХреЛ рдХреНрд▓рд╛рдЙрдб рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдореЗрдВ рд╢реЛрд╖рдгреАрдп рд╣рдорд▓реЗ рдХреЗ рдорд╛рд░реНрдЧ рдЦреЛрдЬрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред
```bash
cloudfox aws --profile [profile-name] all-checks
```
* [**ScoutSuite**](https://github.com/nccgroup/ScoutSuite): Scout Suite рдПрдХ рдУрдкрди рд╕реЛрд░реНрд╕ рдорд▓реНрдЯреА-рдХреНрд▓рд╛рдЙрдб рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА-рдСрдбрд┐рдЯрд┐рдВрдЧ рдЯреВрд▓ рд╣реИ, рдЬреЛ рдХреНрд▓рд╛рдЙрдб рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рдХреА рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдореБрджреНрд░рд╛ рдХрд╛ рдЖрдХрд▓рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддрд╛ рд╣реИред
```bash
# Install
virtualenv -p python3 venv
source venv/bin/activate
pip install scoutsuite
scout --help

# Get info
scout aws -p dev
```
* [**cs-suite**](https://github.com/SecurityFTW/cs-suite): Cloud Security Suite (рдкрд╛рдпрдерди2.7 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдирджреЗрдЦрд╛ рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИ)
* [**Zeus**](https://github.com/DenizParlak/Zeus): Zeus AWS EC2 / S3 / CloudTrail / CloudWatch / KMS рдХреЗ рд▓рд┐рдП рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдЙрдкрдХрд░рдг рд╣реИ, рдЬреЛ рд╕рд░реНрд╡реЛрддреНрддрдо рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ рдкреНрд░рдерд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ (рдЕрдирджреЗрдЦрд╛ рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИ)ред рдпрд╣ рдХреЗрд╡рд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдХреНрд░реЗрдбреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИред

### рдирд┐рд░рдВрддрд░ рдСрдбрд┐рдЯ

* [**cloud-custodian**](https://github.com/cloud-custodian/cloud-custodian): Cloud Custodian рдПрдХ рдирд┐рдпрдо рдЗрдВрдЬрди рд╣реИ рдЬреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдЙрдб рдЦрд╛рддреЛрдВ рдФрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдиреАрддрд┐рдпрд╛рдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдПрдХ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХреНрд▓рд╛рдЙрдб рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рд╕рдХреНрд╖рдо рд╣реЛ**, рдЬреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдФрд░ рд▓рд╛рдЧрдд рдХреЗ рдЕрдиреБрдХреВрд▓рд┐рдд рд╣реЛред рдпрд╣ рд╕рдВрдЧрдардиреЛрдВ рдХреЗ рдЕрдзреЛрдХреНрд╖рд┐рдкреНрдд рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ рдПрдХ рд╣рд▓реНрдХреЗ рдФрд░ рд▓рдЪреАрд▓реЗ рдЙрдкрдХрд░рдг рдореЗрдВ рд╕рдореЗрдХрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдПрдХреАрдХреГрдд рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рдеред
* [**pacbot**](https://github.com/tmobile/pacbot)**: Policy as Code Bot (PacBot)** рдПрдХ рдордВрдЪ рд╣реИ **рдирд┐рд░рдВрддрд░ рдЕрдиреБрдкрд╛рд▓рди рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ, рдЕрдиреБрдкрд╛рд▓рди рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рдФрд░ рдХреНрд▓рд╛рдЙрдб рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрд╡рдЪрд╛рд▓рди** рдХреЗ рд▓рд┐рдПред PacBot рдореЗрдВ, рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ рдЕрдиреБрдкрд╛рд▓рди рдиреАрддрд┐рдпрд╛рдВ рдХреЛрдб рдХреЗ рд░реВрдк рдореЗрдВ рд▓рд╛рдЧреВ рдХреА рдЬрд╛рддреА рд╣реИрдВред PacBot рджреНрд╡рд╛рд░рд╛ рдЦреЛрдЬреЗ рдЧрдП рд╕рднреА рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдЗрди рдиреАрддрд┐рдпреЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдиреАрддрд┐ рдЕрдиреБрд░реВрдкрддрд╛ рдХрд╛ рдЖрдХрд▓рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред PacBot **рдСрдЯреЛ-рдлрд┐рдХреНрд╕** рдлреНрд░реЗрдорд╡рд░реНрдХ рдиреАрддрд┐ рдЙрд▓реНрд▓рдВрдШрдиреЛрдВ рдХрд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЬрд╡рд╛рдм рджреЗрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдкреВрд░реНрд╡ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрд░рд╡рд╛рдЗрдпреЛрдВ рдХреЛ рд▓реЗрдХрд░ред
* [**streamalert**](https://github.com/airbnb/streamalert)**:** StreamAlert рдПрдХ рд╕рд░реНрд╡рд░рд▓реЗрд╕, **рд░рд┐рдпрд▓-рдЯрд╛рдЗрдо** рдбреЗрдЯрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдлреНрд░реЗрдорд╡рд░реНрдХ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ **рдЗрдиреНрдЬреЗрд╕реНрдЯ, рд╡рд┐рд╢реНрд▓реЗрд╖рдг, рдФрд░ рдЕрд▓рд░реНрдЯ** рдХрд░рдиреЗ рдХреА рд╢рдХреНрддрд┐ рджреЗрддрд╛ рд╣реИ, рдХрд┐рд╕реА рднреА рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗ рдбреЗрдЯрд╛ рдкрд░, рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рдФрд░ рдЕрд▓рд░реНрдЯрд┐рдВрдЧ рддрд░реНрдХ рдЬреЛ рдЖрдк рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдХрдВрдкреНрдпреВрдЯрд░ рд╕реБрд░рдХреНрд╖рд╛ рдЯреАрдореЗрдВ StreamAlert рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рд░ рджрд┐рди рдШрдЯрдирд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рд▓реЙрдЧ рдбреЗрдЯрд╛ рдХреЗ рдЯреЗрд░рд╛рдмрд╛рдЗрдЯреНрд╕ рдХреЛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреА рд╣реИрдВред

## DEBUG: Capture AWS cli requests
```bash
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080

# Capture with burp nor verifying ssl
aws --no-verify-ssl ...

# Dowload brup cert and transform it to pem
curl http://127.0.0.1:8080/cert --output Downloads/certificate.cer
openssl x509 -inform der -in Downloads/certificate.cer -out Downloads/certificate.pem

# Indicate the ca cert to trust
export AWS_CA_BUNDLE=~/Downloads/certificate.pem

# Run aws cli normally trusting burp cert
aws ...
```
## рд╕рдВрджрд░реНрдн

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudsecdocs.com/aws/defensive/tooling/audit/](https://cloudsecdocs.com/aws/defensive/tooling/audit/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>
