# AWS Pentesting

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a> <strong>рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks** рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)\*\* рдкрд░ рдлреЙрд▓реЛ\*\* рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

**AWS** рдорд╛рд╣реМрд▓ рдХреА **рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рд╢реБрд░реВ** рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреБрдЫ **рдореМрд▓рд┐рдХ рдмрд╛рддреЗрдВ** рдЬрд╛рдирдиреА рдЪрд╛рд╣рд┐рдП рдЬреИрд╕реЗ рдХрд┐ AWS рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдкрдХреЛ рд╕рдордЭ рдореЗрдВ рдЖрдП рдХрд┐ рдЖрдкрдХреЛ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ, рдорд┐рд╕рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреИрд╕реЗ рдЦреЛрдЬреЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВред

рд╕рдВрдЧрдарди рд╡рд░реНрдЧреАрдХрд░рдг, IAM рдФрд░ рдЕрдиреНрдп рдореМрд▓рд┐рдХ рдЕрд╡рдзрд╛рд░рдгрд╛рдПрдВ рдЗрд╕рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рдХреА рдЧрдИ рд╣реИрдВ:

{% content-ref url="aws-basic-information/" %}
[aws-basic-information](aws-basic-information/)
{% endcontent-ref %}

## рд╕реАрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд▓реИрдм

* [https://github.com/RhinoSecurityLabs/cloudgoat](https://github.com/RhinoSecurityLabs/cloudgoat)
* [https://github.com/BishopFox/iam-vulnerable](https://github.com/BishopFox/iam-vulnerable)
* [https://github.com/nccgroup/sadcloud](https://github.com/nccgroup/sadcloud)
* [https://github.com/bridgecrewio/terragoat](https://github.com/bridgecrewio/terragoat)
* [https://github.com/ine-labs/AWSGoat](https://github.com/ine-labs/AWSGoat)
* [http://flaws.cloud/](http://flaws.cloud/)
* [http://flaws2.cloud/](http://flaws2.cloud/)

рд╣рдорд▓реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг:

* [https://github.com/Datadog/stratus-red-team/](https://github.com/Datadog/stratus-red-team/)
* [https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main](https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main)

## AWS рдкреЗрдВрдЯреЗрд╕реНрдЯрд░/рд░реЗрдб рдЯреАрдо рдореЗрдердбреЛрд▓реЙрдЬреА

AWS рдорд╛рд╣реМрд▓ рдХреА рдорд╛рдирд╡реАрдп рд╕рдореГрджреНрдзрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд┐рдВрджреБ рд╣реИ: рдХреМрди рд╕реЗрд╡рд╛рдПрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИрдВ, рдХреНрдпрд╛ рдЕрдирд╛рд╡рд░рдг рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рдХрд┐рд╕рдХреЗ рдкрд╛рд╕ рдХреНрдпрд╛ **рдкрд╣реБрдВрдЪ** рд╣реИ, рдФрд░ рдЖрдВрддрд░рд┐рдХ AWS рд╕реЗрд╡рд╛рдПрдВ рдФрд░ **рдмрд╛рд╣реНрдп рд╕реЗрд╡рд╛рдПрдВ** рдХреИрд╕реЗ рдЬреБрдбрд╝реА рд╣реИрдВред

рд░реЗрдб рдЯреАрдо рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, **AWS рдорд╛рд╣реМрд▓ рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬ** рдХрд░рдиреЗ рдХрд╛ **рдкрд╣рд▓рд╛ рдХрджрдо** рдХреБрдЫ **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИред рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЗрд╕реЗ рдХреИрд╕реЗ рдХрд░рдиреЗ рдХреЗ рдХреБрдЫ рд╡рд┐рдЪрд╛рд░ рд╣реИрдВ:

* github рдореЗрдВ **рд▓реАрдХ** (рдпрд╛ рд╕рдорд╛рди) - OSINT
* **рд╕реЛрд╢рд▓** рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ
* **рдкрд╛рд╕рд╡рд░реНрдб** рдкреБрдирдГ рдЙрдкрдпреЛрдЧ (рдкрд╛рд╕рд╡рд░реНрдб рд▓реАрдХ)
* AWS-рд╣реЛрд╕реНрдЯреЗрдб рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╡рдВрд╢рд╡рд╛рдж
* [**рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдлреЙрд░реНрдЬрд░реА**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рддрдХ рдкрд╣реБрдВрдЪ
* **рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рдкрдврд╝реЗрдВ**
* `/home/USERNAME/.aws/credentials`
* `C:\Users\USERNAME\.aws\credentials`
* 3rd рдкрд╛рд░реНрдЯреА **рдЙрд▓реНрд▓рдВрдШрд┐рдд**
* **рдЖрдВрддрд░рд┐рдХ** рдХрд░реНрдордЪрд╛рд░реА
* [**рдХреЛрдЧреНрдирд┐рдЯреЛ** ](aws-services/aws-cognito-enum/#cognito)рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕

рдпрд╛ **рдЕрдкреНрд░рдорд╛рдгрд┐рдд рд╕реЗрд╡рд╛** рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬ рдХрд░рдХреЗ:

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

рдпрд╛ рдпрджрд┐ рдЖрдк **рд╕рдореАрдХреНрд╖рд╛** рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдЖрдк рд╕рд┐рд░реНрдл **рдЗрди рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдорд╛рдВрдЧ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="aws-permissions-for-a-pentest.md" %}
[aws-permissions-for-a-pentest.md](aws-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
рдЬрдм рдЖрдк рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╡реЗ рдХрд┐рд╕рдХреЗ рд╣реИрдВ, рдФрд░ рдЙрдирдХреЗ рдкрд╛рд╕ рдХреНрдпрд╛ рдкрд╣реБрдВрдЪ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдХреБрдЫ рдореМрд▓рд┐рдХ рдЧрдгрдирд╛ рдХрд░рдиреА рд╣реЛрдЧреА:
{% endhint %}

## рдореМрд▓рд┐рдХ рдЧрдгрдирд╛

### SSRF

рдпрджрд┐ рдЖрдкрдиреЗ AWS рдХреЗ рдЕрдВрджрд░ рдХрд┐рд╕реА рдорд╢реАрди рдореЗрдВ SSRF рдкрд╛рдпрд╛ рд╣реИ рддреЛ рдЯреНрд░рд┐рдХреНрд╕ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреЗрдЬ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Whoami

рдЖрдкрдХреЛ рдЬрд╛рдирдиреЗ рдХреА рдкрд╣рд▓реА рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк рдХреМрди рд╣реИрдВ (рдЖрдк рдХрд┐рд╕ рдЦрд╛рддреЗ рдореЗрдВ рд╣реИрдВ рдФрд░ AWS рдорд╛рд╣реМрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдиреНрдп рдЬрд╛рдирдХрд╛рд░реА):

```bash
# Easiest way, but might be monitored?
aws sts get-caller-identity
aws iam get-user # This will get your own user

# If you have a Key ID
aws sts get-access-key-info --access-key-id=ASIA1234567890123456

# Get inside error message
aws sns publish --topic-arn arn:aws:sns:us-east-1:*account id*:aaa --message aaa

# From metadata
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`
curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/dynamic/instance-identity/document
```

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдВрдкрдирд┐рдпрд╛рдВ **рдХреИрдиреЗрд░реА рдЯреЛрдХрдиреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреА рд╣реИрдВ рддрд╛рдХрд┐ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХреЗрдВ рдХрд┐ **рдЯреЛрдХрдиреНрд╕ рдЪреЛрд░реА рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ**ред рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдЙрд╕ рдЯреЛрдХрди рдХреЛ рдХреИрдиреЗрд░реА рдЯреЛрдХрди рд╣реИ рдпрд╛ рдирд╣реАрдВ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред\
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдЗрд╕ рдкреГрд╖реНрда рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ**](aws-services/aws-security-and-detection-services/aws-cloudtrail-enum.md#honeytokens-bypass)ред
{% endhint %}

### рд╕рдВрдЧрдарди рдЬрд╛рдБрдЪ

{% content-ref url="aws-services/aws-organizations-enum.md" %}
[aws-organizations-enum.md](aws-services/aws-organizations-enum.md)
{% endcontent-ref %}

### IAM рдЬрд╛рдБрдЪ

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ **рддреЛ AWS рдЦрд╛рддреЗ рдХреЗ рдЕрдВрджрд░ рдкреНрд░рддреНрдпреЗрдХ рдПрдВрдЯрд┐рдЯреА рдХреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛** рдЖрдкрдХреЛ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ рдХрд┐ рдЖрдк рдФрд░ рдЕрдиреНрдп рдкрд╣рдЪрд╛рди рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреИрд╕реЗ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░реЗрдВ**ред

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ IAM рдХреА рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрдиреНрд╣реЗрдВ **рдмреНрд░реВрдЯрдлреЛрд░реНрд╕ рдХрд░рдХреЗ** рдЙрдиреНрд╣реЗрдВ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВред\
рдЬрд╛рдБрдЪ рдХрд░реЗрдВ **рдХреИрд╕реЗ рдирд╛рдореАрдХрд░рдг рдФрд░ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕рд┐рдВрдЧ рдХрд░реЗрдВ**:

{% content-ref url="aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](aws-services/aws-iam-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
рдЕрдм рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдЕрдкрдиреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ **рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рд╣реИ** (рдФрд░ рдпрджрд┐ рдЖрдк рдПрдХ рд▓рд╛рд▓ рдЯреАрдо рд╣реИрдВ рддреЛ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ **рдкрд╣рдЪрд╛рдирд╛ рдирд╣реАрдВ рдЧрдпрд╛ рд╣реИ**)ред рддреЛ рдпрд╣ рд╕рдордп рд╣реИ рдХрд┐ рдЖрдк рд╕рдордЭреЗрдВ рдХрд┐ рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рдХреМрди рд╕реА рд╕реЗрд╡рд╛рдПрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИрдВред\
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЦрдВрдб рдореЗрдВ рдЖрдк рдХреБрдЫ рдЖрдо рд╕реЗрд╡рд╛рдУрдВ рдХреЛ **рдирд╛рдореАрдХрд░рдг рдХрд░рдиреЗ** рдХреЗ рдХреБрдЫ рддрд░реАрдХреЗ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

## рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдирд╛рдореАрдХрд░рдг, рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди рдФрд░ рд╕реНрдерд┐рд░рддрд╛

AWS рдореЗрдВ рдПрдХ рдЪреМрдВрдХрд╛рдиреЗ рд╡рд╛рд▓реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рд╕реЗрд╡рд╛рдПрдВ рд╣реИрдВ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдореЗрдВ рдЖрдкрдХреЛ **рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА, рдирд╛рдореАрдХрд░рдг** рдЪреАрдЯрд╢реАрдЯреНрд╕, **рдкрдХрдбрд╝ рд╕реЗ рдмрдЪрдиреЗ** рдХреЗ рддрд░реАрдХреЗ, **рд╕реНрдерд┐рд░рддрд╛** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ, рдФрд░ рдЕрдиреНрдп **рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди** рдЯреНрд░рд┐рдХреНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реЗрдЧреА:

{% content-ref url="aws-services/" %}
[aws-services](aws-services/)
{% endcontent-ref %}

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдкрдХреЛ **рд╕рднреА рдХрд╛рдо рдХреЛ** рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ **рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ**, рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЗ рдиреАрдЪреЗ рдЖрдкрдХреЛ [**рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ**](./#automated-tools) рдПрдХ рдЦрдВрдб рдорд┐рд▓реЗрдЧрд╛ред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдЗрд╕ рдЪрд░рдг рдореЗрдВ рдЖрдкрдиреЗ **рдЕрдирдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╕реЗрд╡рд╛рдПрдВ** рдЦреЛрдЬ рд▓реА рд╣реЛ рд╕рдХрддреА рд╣реИрдВ, рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╢рд╛рдпрдж рдЙрддреНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

## рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐

рдпрджрд┐ рдЖрдк **рдХрдо рд╕реЗ рдХрдо рдЕрдкрдиреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдБрдЪ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдк **рдЬрд╛рдБрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЖрдкрдХреЛ рдХрдо рд╕реЗ рдХрдо рдЙрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрд┐рдиреНрд╣реЗрдВ рдЗрд╕рдореЗрдВ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:

{% content-ref url="aws-privilege-escalation/" %}
[aws-privilege-escalation](aws-privilege-escalation/)
{% endcontent-ref %}

## рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрдЬрд╛рдЧрд░рд┐рдд рд╕реЗрд╡рд╛рдПрдВ

AWS рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдирд╛рдореАрдХрд░рдг рдХрд░рддреЗ рд╕рдордп рдЖрдкрдиреЗ рдХреБрдЫ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдкрд╛рдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ **рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рддрддреНрдХрд╛рд▓рд┐рдХ рддрддреНрд╡реЛрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВ** (VM/рдХрдВрдЯреЗрдирд░ рдкреЛрд░реНрдЯ, рдбреЗрдЯрд╛рдмреЗрд╕ рдпрд╛ рдХрддрд╛рд░ рд╕реЗрд╡рд╛рдПрдВ, рд╕реНрдиреИрдкрд╢реЙрдЯреНрд╕ рдпрд╛ рдмрдХреЗрдЯреНрд╕...)ред\
рдкреЗрдВрдЯреЗрд╕реНрдЯрд░/рд░реЗрдб рдЯреАрдорд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдкрдХреЛ рд╣рдореЗрд╢рд╛ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдЙрдирдореЗрдВ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА / рдХрдорд┐рдпреЛрдВ** рдХреЛ рдкрд╛рдПрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЖрдкрдХреЛ **AWS рдЦрд╛рддреЗ рдореЗрдВ рдЖрдЧреЗ рдХреА рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдЗрд╕ рдкреБрд╕реНрддрдХ рдореЗрдВ рдЖрдкрдХреЛ рдорд┐рд▓реЗрдЧреА **рдЬрд╛рдирдХрд╛рд░реА** рдХрд┐ **рдЙрдЬрд╛рдЧрд░рд┐рдд AWS рд╕реЗрд╡рд╛рдПрдВ рдХреИрд╕реЗ рдЦреЛрдЬреЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рдЬрд╛рдВрдЪреЗрдВ**ред рдЙрдЬрд╛рдЧрд░рд┐рдд рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ **рдХрдорд┐рдпреЛрдВ рдХреИрд╕реЗ рдЦреЛрдЬреЗрдВ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдореИрдВ рдЖрдкрдХреЛ рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░реВрдВрдЧрд╛ рдХрд┐ рдЖрдк рд╡рд┐рд╢рд┐рд╖реНрдЯ **рд╕реЗрд╡рд╛** рдХреЗ рд▓рд┐рдП **рдЦреЛрдЬреЗрдВ**:

{% embed url="https://book.hacktricks.xyz/" %}

## рд╕рдВрдЧрдарди рдХреЛ рдХрдордЬреЛрд░ рдХрд░рдирд╛

### рдореВрд▓/рдкреНрд░рдмрдВрдзрди рдЦрд╛рддрд╛ рд╕реЗ

рдЬрдм рдкреНрд░рдмрдВрдзрди рдЦрд╛рддрд╛ рд╕рдВрдЧрдарди рдореЗрдВ рдирдП рдЦрд╛рддреЗ рдмрдирд╛рддрд╛ рд╣реИ, рддреЛ рдирдП рдЦрд╛рддреЗ рдореЗрдВ рдПрдХ **рдирдпрд╛ рднреВрдорд┐рдХрд╛** рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **`OrganizationAccountAccessRole`** рдирд╛рдордХ рдФрд░ **рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ** рдХреЛ рдирдП рдЦрд╛рддреЗ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **AdministratorAccess** рдиреАрддрд┐ рджреЗрддреА рд╣реИред

<figure><img src="../../.gitbook/assets/image (3) (3) (2).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕рд▓рд┐рдП, рдПрдХ рдмрд╛рд▓рдХ рдЦрд╛рддреЗ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╢рд╛рд╕рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЪрд╛рд╣рд┐рдП:

* **рдкреНрд░рдмрдВрдзрди** рдЦрд╛рддреЗ рдХреЛ **рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝** рдХрд░реЗрдВ рдФрд░ **рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ** рдХреА **рдЖрдИрдбреА** рдФрд░ **рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рдирд╛рдо** (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ OrganizationAccountAccessRole) рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ рдЬреЛ рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ рдХреЛ рдкреНрд░рд╢рд╛рд╕рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред
* рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП AWS рдХрдВрд╕реЛрд▓ рдореЗрдВ рд╕рдВрдЧрдарди рдЦрдВрдб рдореЗрдВ рдЬрд╛рдПрдВ рдпрд╛ `aws organizations list-accounts` рдЪрд▓рд╛рдПрдВред
* рдЖрдк рд╕реАрдзреЗ рд░реВрдк рд╕реЗ рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рдирд╛рдо рдирд╣реАрдВ рдвреВрдВрдв рд╕рдХрддреЗ, рдЗрд╕рд▓рд┐рдП рд╕рднреА рдХрд╕реНрдЯрдо IAM рдиреАрддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдФрд░ рдХрд┐рд╕реА рднреА рдРрд╕реА рдиреАрддрд┐ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ рдЬреЛ **рдкрд╣рд▓реЗ рдкрддрд╛ рд▓рдЧрд╛рдП рдЧрдП рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдкрд░ `sts:AssumeRole` рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣ред**
* **рдкреНрд░рдмрдВрдзрди** рдЦрд╛рддреЗ рдореЗрдВ рдПрдХ **рдореБрдЦреНрдп** рд╡реНрдпрдХреНрддрд┐ рдХреЛ **`sts:AssumeRole` рдЕрдиреБрдорддрд┐** рдХреЗ рд╕рд╛рде **рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдореЗрдВ рднреВрдорд┐рдХрд╛ рдкрд░ `sts:AssumeRole` рдЕрдиреБрдорддрд┐** рдХреЗ рд╕рд╛рде **рдХрдВрдкреНрд░рдорд╛рдЗрдЬ** рдХрд░реЗрдВ (рдпрджрд┐ рдЦрд╛рддрд╛ рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ рд╕реЗ рдХрд┐рд╕реА рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд░рд╣рд╛ рд╣реИ, рддреЛ рдпрд╣ рдПрдХ рдмрд╛рд╣реНрдп рдЦрд╛рддрд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рд╡рд┐рд╢реЗрд╖ `sts:AssumeRole` рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ)ред

## рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдг

### рдЬрд╛рд╕реВрд╕реА

* [**aws-recon**](https://github.com/darkbitio/aws-recon): рдПрдХ рдорд▓реНрдЯреА-рдереНрд░реЗрдбреЗрдб AWS рд╕реБрд░рдХреНрд╖рд╛-рдХреЗрдВрджреНрд░рд┐рдд **рдЗрдиреНрд╡реЗрдВрдЯрд░реА рд╕рдВрдЧреНрд░рд╣рдг рдЙрдкрдХрд░рдг** рдЬреЛ рд░реВрдмреА рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИред

```bash
# Install
gem install aws_recon

# Recon and get json
AWS_PROFILE=<profile> aws_recon \
--services S3,EC2 \
--regions global,us-east-1,us-east-2 \
--verbose
```

* [**cloudlist**](https://github.com/projectdiscovery/cloudlist): Cloudlist рдПрдХ **рдорд▓реНрдЯреА-рдХреНрд▓рд╛рдЙрдб рдЯреВрд▓ рд╣реИ рдЬреЛ рдПрд╕реЗрдЯреНрд╕** (рд╣реЛрд╕реНрдЯрдиреЗрдореНрд╕, рдЖрдИрдкреА рдкрддреЗ) рдХреЛ рдХреНрд▓рд╛рдЙрдб рдкреНрд░рджрд╛рддрд╛рдУрдВ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред
* [**cloudmapper**](https://github.com/duo-labs/cloudmapper): CloudMapper рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдЕрдореЗрдЬрд╝рди рд╡реЗрдм рд╕реЗрд╡рд╛рдУрдВ (AWS) рдХреЗ рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдореЗрдВ рдЕрдм рдЕрдзрд┐рдХ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдореБрдЖрдпрдирд╛ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИред

```bash
# Installation steps in github
# Create a config.json file with the aws info, like:
{
"accounts": [
{
"default": true,
"id": "<account id>",
"name": "dev"
}
],
"cidrs":
{
"2.2.2.2/28": {"name": "NY Office"}
}
}

# Enumerate
python3 cloudmapper.py collect --profile dev
## Number of resources discovered
python3 cloudmapper.py stats --accounts dev

# Create HTML report
## In the report you will find all the info already
python3 cloudmapper.py report --accounts dev

# Identify potential issues
python3 cloudmapper.py audit --accounts dev --json > audit.json
python3 cloudmapper.py audit --accounts dev --markdow > audit.md
python3 cloudmapper.py iam_report --accounts dev

# Identify admins
## The permissions search for are in https://github.com/duo-labs/cloudmapper/blob/4df9fd7303e0337ff16a08f5e58f1d46047c4a87/shared/iam_audit.py#L163-L175
python3 cloudmapper.py find_admins --accounts dev

# Identify unused elements
python3 cloudmapper.py find_unused --accounts dev

# Identify publivly exposed resources
python3 cloudmapper.py public --accounts dev

python cloudmapper.py prepare #Prepare webserver
python cloudmapper.py webserver #Show webserver
```

* [**cartography**](https://github.com/lyft/cartography): Cartography рдПрдХ Python рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдПрдХ Neo4j рдбреЗрдЯрд╛рдмреЗрд╕ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд рдПрдХ рд╕реНрдкрд╖реНрдЯ рдЧреНрд░рд╛рдл рджреГрд╢реНрдп рдореЗрдВ рдмреБрдирд┐рдпрд╛рджреА рд╕рдВрд░рдЪрдирд╛ рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рдФрд░ рдЙрдирдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рд╕рдореЗрдХрд┐рдд рдХрд░рддрд╛ рд╣реИред

```bash
# Install
pip install cartography
## At the time of this writting you need neo4j version 3.5.*

# Get AWS info
AWS_PROFILE=dev cartography --neo4j-uri bolt://127.0.0.1:7687 --neo4j-password-prompt  --neo4j-user neo4j
```

* [**starbase**](https://github.com/JupiterOne/starbase): Starbase рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧреНрд░рд╛рдлрд╝ рджреГрд╢реНрдп рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд Neo4j рдбреЗрдЯрд╛рдмреЗрд╕ рджреНрд╡рд╛рд░рд╛ рдПрдХрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рд╕реЗрд╡рд╛рдУрдВ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рд╕рд╣рд┐рдд рдЬреИрд╕реЗ рдХреНрд▓рд╛рдЙрдб рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪрд╛, SaaS рдПрдкреНрд▓рд┐рдХреЗрд╢рди, рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдВрддреНрд░рдг, рдФрд░ рдЕрдзрд┐рдХ рд╕реЗред
* [**aws-inventory**](https://github.com/nccgroup/aws-inventory): (Python2 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ) рдпрд╣ рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдЦрд╛рддреЗ рдореЗрдВ рдмрдирд╛рдП рдЧрдП рд╕рднреА [**AWS рд╕рдВрд╕рд╛рдзрди**](https://docs.aws.amazon.com/general/latest/gr/glos-chap.html#resource) рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИред
* [**aws\_public\_ips**](https://github.com/arkadiyt/aws\_public\_ips): рдпрд╣ рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдПрдХ AWS рдЦрд╛рддреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЖрдИрдкреА рдкрддреЛрдВ (IPv4/IPv6 рджреЛрдиреЛрдВ) рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред

### Privesc & Exploiting

* [**SkyArk**](https://github.com/cyberark/SkyArk)**:** рд╕реНрдХреИрди рдХрд┐рдП рдЧрдП AWS рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд╕рдмрд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдПрдВ, рд╕рд╣рд┐рдд AWS рд╢реИрдбреЛ рдПрдбрдорд┐рдиреНрд╕ред рдпрд╣ рдкрд╛рд╡рд░рд╢реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЖрдк [https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1](https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1) рдореЗрдВ **`Check-PrivilegedPolicy`** рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдиреАрддрд┐рдпреЛрдВ рдХреА рдкрд░рд┐рднрд╛рд╖рд╛** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
* [**pacu**](https://github.com/RhinoSecurityLabs/pacu): Pacu рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ **AWS рд╢реЛрд╖рдг рдврд╛рдВрдЪрд╛** рд╣реИ, рдЬреЛ рдмрд╛рджрд╢рд╛рд╣реА рд╕реБрд░рдХреНрд╖рд╛ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ **рдЧрдгрдирд╛** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, **рдЧрд▓рдд рд╡рд┐рдиреНрдпрд╛рд╕** рдЦреЛрдЬ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдЙрдиреНрд╣реЗрдВ рд╢реЛрд╖рд┐рдд** рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЖрдк [https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134](https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134) рдореЗрдВ **`user_escalation_methods`** рдбрд┐рдХреНрд╢рдирд░реА рдХреЗ рдЕрдВрджрд░ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдкрд░рд┐рднрд╛рд╖рд╛** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
* рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ pacu **рдХреЗрд╡рд▓ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ privescs рдорд╛рд░реНрдЧреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ** (рдЦрд╛рддрд╛ рд╡реНрдпрд╛рдкрдХ рдирд╣реАрдВ)ред

```bash
# Install
## Feel free to use venvs
pip3 install pacu

# Use pacu CLI
pacu
> import_keys <profile_name> # import 1 profile from .aws/credentials
> import_keys --all # import all profiles
> list # list modules
> exec iam__enum_permissions # Get permissions
> exec iam__privesc_scan # List privileged permissions
```

* [**PMapper**](https://github.com/nccgroup/PMapper): рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдореИрдкрд░ (PMapper) рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд╣реИ рдЬреЛ AWS рдЦрд╛рддреЗ рдпрд╛ AWS рд╕рдВрдЧрдарди рдХреЗ AWS рдкрд╣рдЪрд╛рди рдФрд░ рдкрд╣реБрдВрдЪ рдкреНрд░рдмрдВрдзрди (IAM) рдХреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдореЗрдВ рдЬреЛрдЦрд┐рдореЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП рд╣реИред рдпрд╣ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдЧреНрд░рд╛рдл рдХреЗ рд░реВрдк рдореЗрдВ рдЦрд╛рддреЗ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рднреВрдорд┐рдХрд╛рдПрдБ рдореЙрдбрд▓ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирддрд┐** рдХреА рдЬрд╛рдВрдЪ рдФрд░ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЬреЛ рд╕рдВрд╕рд╛рдзрди рдпрд╛ рдХрд╛рд░реНрд░рд╡рд╛рдИ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдХрд▓реНрдкреА рдкрде рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рджреЗрддрд╛ рд╣реИред рдЖрдк [https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing](https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing) рдореЗрдВ `_edges.py` рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рдкрде рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

```bash
# Install
pip install principalmapper

# Get data
pmapper --profile dev graph create
pmapper --profile dev graph display # Show basic info
# Generate graph
pmapper --profile dev visualize # Generate svg graph file (can also be png, dot and graphml)
pmapper --profile dev visualize --only-privesc # Only privesc permissions

# Generate analysis
pmapper --profile dev analysis
## Run queries
pmapper --profile dev query 'who can do iam:CreateUser'
pmapper --profile dev query 'preset privesc *' # Get privescs with admins

# Get organization hierarchy data
pmapper --profile dev orgs create
pmapper --profile dev orgs display
```

* [**cloudsplaining**](https://github.com/salesforce/cloudsplaining): Cloudsplaining рдПрдХ AWS IAM рд╕реБрд░рдХреНрд╖рд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рдХрдо рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ рдЬреЛрдЦрд┐рдо-рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдЙрд▓реНрд▓рдВрдШрдиреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдЬреЛрдЦрд┐рдо-рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ HTML рд░рд┐рдкреЛрд░реНрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред\
  рдпрд╣ рдЖрдкрдХреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ \*\*рдЕрдзрд┐рдХрд╛рдзрд┐рдХрд╛рдзрд┐рдХрд╛рдзрд┐рдХрд╛рдзрд┐рдХрд╛рдзрд┐рдХрд╛рдз

```bash
# Install
pip install cloudsplaining

# Download IAM policies to check
## Only the ones attached with the versions used
cloudsplaining download --profile dev

# Analyze the IAM policies
cloudsplaining scan --input-file /private/tmp/cloudsplaining/dev.json --output /tmp/files/
```

* [**cloudjack**](https://github.com/prevade/cloudjack): CloudJack AWS рдЦрд╛рддреЛрдВ рдХреА **рд╕рдмрдбреЛрдореЗрди рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ рд╕рдВрд░рдЪрдирд╛рдУрдВ** рдХреЗ рд▓рд┐рдП рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддрд╛ рд╣реИ рдЬреЛ Route53 рдФрд░ CloudFront рдХреА рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рд╣реЛрддреА рд╣реИред
* [**ccat**](https://github.com/RhinoSecurityLabs/ccat): ECR рд░реЗрдкреЛ рдХреА рд╕реВрдЪреА -> ECR рд░реЗрдкреЛ рдЦреАрдВрдЪреЗрдВ -> рдЗрд╕реЗ рдмреИрдХрдбреЛрд░ рдХрд░реЗрдВ -> рдмреИрдХрдбреЛрд░ рдЫрд╡рд┐ рдХреЛ рдкреБрд╢ рдХрд░реЗрдВ
* [**Dufflebag**](https://github.com/bishopfox/dufflebag): Dufflebag рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ Elastic Block Storage (**EBS) рд╕реНрдиреИрдкрд╢реЙрдЯреНрд╕** рдореЗрдВ рдЫреБрдкреА рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреА рдЦреЛрдЬ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рднреВрд▓ рд╕реЗ рдЫреЛрдбрд╝ рджрд┐рдП рдЧрдП рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

### рдордВрдЬреВрд░реА

* [**cloudsploit**](https://github.com/aquasecurity/cloudsploit)**:** Aqua рджреНрд╡рд╛рд░рд╛ CloudSploit рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╣реИ рдЬреЛ **рдмрд╛рджрд▓ рдмреБрдирд┐рдпрд╛рджреА рд╕рдВрд░рдЪрдирд╛рдУрдВ** рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдореЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: рдЕрдореЗрдЬрд╝рди рд╡реЗрдм рд╕реЗрд╡рд╛рдПрдВ (AWS), рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдПрдЬрд╝реНрдпреВрд░, рдЧреВрдЧрд▓ рдХреНрд▓рд╛рдЙрдб рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо (GCP), рдУрд░реЗрдХрд▓ рдХреНрд▓рд╛рдЙрдб рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ (OCI), рдФрд░ рдЧрд┐рдЯрд╣рдм (рдпрд╣ рд╢реИрдбреЛрдПрдбрдорд┐рдиреНрд╕ рдХреА рддрд▓рд╛рд╢ рдирд╣реАрдВ рдХрд░рддрд╛)ред

```bash
./index.js --csv=file.csv --console=table --config ./config.js

# Compiance options: --compliance {hipaa,cis,cis1,cis2,pci}
## use "cis" for cis level 1 and 2
```

* [**Prowler**](https://github.com/prowler-cloud/prowler): Prowler рдПрдХ рдУрдкрди рд╕реЛрд░реНрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ AWS рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкреНрд░рдерд╛рдУрдВ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди, рдорд╣рд╛рдкрд░реАрдХреНрд╖рдг, рд╣рд╛рджрд╕реЗ рдХрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛, рдирд┐рд░рдВрддрд░ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ, рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ рдФрд░ рдлреЛрд░реЗрдВрд╕рд┐рдХреНрд╕ рддреИрдпрд╛рд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред

```bash
# Install python3, jq and git
# Install
pip install prowler
prowler -v

# Run
prowler <provider>
prowler aws --profile custom-profile [-M csv json json-asff html]
```

* [**CloudFox**](https://github.com/BishopFox/cloudfox): CloudFox рдЖрдкрдХреЛ рдЕрдЬрдирдмреА рдХреНрд▓рд╛рдЙрдб рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд╕реНрдерд┐рддрд┐ рдЬрд╛рдЧрд░реВрдХрддрд╛ рд╣рд╛рд╕рд┐рд▓ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдУрдкрди рд╕реЛрд░реНрд╕ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдЯреВрд▓ рд╣реИ рдЬрд┐рд╕реЗ рдкреЗрдиреЗрдЯреНрд░реЗрд╢рди рдЯреЗрд╕реНрдЯрд░реНрд╕ рдФрд░ рдЕрдиреНрдп рдЖрдХреНрд░рд╛рдордХ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЛ рдЙрджреНрджреЗрд╢реНрдпрдкреВрд░реНрдг рддрд░реАрдХреЗ рд╕реЗ рдЦреЛрдЬрдиреЗ рдореЗрдВ рдорджрдж рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред

```bash
cloudfox aws --profile [profile-name] all-checks
```

* [**ScoutSuite**](https://github.com/nccgroup/ScoutSuite): Scout Suite рдПрдХ рдУрдкрди рд╕реЛрд░реНрд╕ рдорд▓реНрдЯреА-рдХреНрд▓рд╛рдЙрдб рд╕реБрд░рдХреНрд╖рд╛ рдордВрдЬреВрд░реА рдЙрдкрдХрд░рдг рд╣реИ, рдЬреЛ рдХреНрд▓рд╛рдЙрдб рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрдерд┐рддрд┐ рдореВрд▓реНрдпрд╛рдВрдХрди рдХреЛ рд╕рдВрднрд╡ рдмрдирд╛рддрд╛ рд╣реИред

```bash
# Install
virtualenv -p python3 venv
source venv/bin/activate
pip install scoutsuite
scout --help

# Get info
scout aws -p dev
```

* [**cs-suite**](https://github.com/SecurityFTW/cs-suite): рдХреНрд▓рд╛рдЙрдб рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдЗрдЯ (рдкрд╛рдпрдерди2.7 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдиреБрд░рдХреНрд╖рд┐рдд рд▓рдЧрддрд╛ рд╣реИ)
* [**Zeus**](https://github.com/DenizParlak/Zeus): Zeus рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ AWS EC2 / S3 / CloudTrail / CloudWatch / KMS рдХреЗ рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ рдЕрднреНрдпрд╛рд╕реЛрдВ рдХреЗ рд▓рд┐рдП рд╣реИ (рдЕрдиреБрд░рдХреНрд╖рд┐рдд рд▓рдЧрддрд╛ рд╣реИ)ред рдпрд╣ рдХреЗрд╡рд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИред

### рдирд┐рд░рдВрддрд░ рдордВрдЬреВрд░реА

* [**cloud-custodian**](https://github.com/cloud-custodian/cloud-custodian): рдХреНрд▓рд╛рдЙрдб рдХрд╕реНрдЯреЛрдбрд┐рдпрди рдПрдХ рдирд┐рдпрдо рдЗрдВрдЬрди рд╣реИ рдЬреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреНрд▓рд╛рдЙрдб рдЦрд╛рддреЛрдВ рдФрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдиреАрддрд┐рдпреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдПрдХ рдЕрдЪреНрдЫреЗ рдврдВрдЧ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХреНрд▓рд╛рдЙрдб рдмреБрдирд┐рдпрд╛рдж** рд╣реЛрддреА рд╣реИ, рдЬреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдФрд░ рд▓рд╛рдЧрдд рдЕрдиреБрдХреВрд▓ рд╣реЛрддреА рд╣реИред рдпрд╣ рдПрдбрд╣реЙрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯреЛрдВ рдХреЛ рдПрдХ рд╣рд▓реНрдХреЗ рдФрд░ рд▓рдЪреАрд▓реЗ рдЙрдкрдХрд░рдг рдореЗрдВ рд╕рдореЗрдХрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдПрдХреАрдХреГрдд рдореИрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рд╣реЛрддреА рд╣реИред
* [**pacbot**](https://github.com/tmobile/pacbot)**: рдиреАрддрд┐ рдХреЗ рд░реВрдк рдореЗрдВ рдХреЛрдб рдмреЙрдЯ (рдкреИрдХрдмреЙрдЯ)** рдПрдХ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рд╣реИ рдЬреЛ **рдирд┐рд░рдВрддрд░ рдЕрдиреБрдкрд╛рд▓рди рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ, рдЕрдиреБрдкрд╛рд▓рди рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрд╡рдЪрд╛рд▓рди рдХреЗ рд▓рд┐рдП рд╣реИ**ред рдкреИрдХрдмреЙрдЯ рдореЗрдВ, рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ рдЕрдиреБрдкрд╛рд▓рди рдиреАрдд

```bash
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080

# Capture with burp nor verifying ssl
aws --no-verify-ssl ...

# Dowload brup cert and transform it to pem
curl http://127.0.0.1:8080/cert --output Downloads/certificate.cer
openssl x509 -inform der -in Downloads/certificate.cer -out Downloads/certificate.pem

# Indicate the ca cert to trust
export AWS_CA_BUNDLE=~/Downloads/certificate.pem

# Run aws cli normally trusting burp cert
aws ...
```

## рд╕рдВрджрд░реНрдн

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudsecdocs.com/aws/defensive/tooling/audit/](https://cloudsecdocs.com/aws/defensive/tooling/audit/)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)\*\* рдкрд░ рдлреЙрд▓реЛ\*\* рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдХреЛ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
