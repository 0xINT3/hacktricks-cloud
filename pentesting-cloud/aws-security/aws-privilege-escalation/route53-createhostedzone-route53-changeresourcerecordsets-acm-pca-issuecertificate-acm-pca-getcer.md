# AWS - Ukarabati wa Mamlaka ya Route53

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka mwanzo hadi mtaalamu na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalamu wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikionekana kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

Kwa habari zaidi kuhusu Route53 angalia:

{% content-ref url="../aws-services/aws-route53-enum.md" %}
[aws-route53-enum.md](../aws-services/aws-route53-enum.md)
{% endcontent-ref %}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

{% hint style="info" %}
Ili kutekeleza shambulio hili akaunti ya lengo lazima tayari iwe na [**Mamlaka ya Cheti ya Kibinafsi ya Meneja wa Cheti wa AWS**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** imewekwa kwenye akaunti, na mifano ya EC2 katika VPC(s) lazima tayari ziwe zimeingiza vyeti kuamini hiyo. Na miundombinu hii ikiwa mahali, shambulio lifuatalo linaweza kutekelezwa kwa kuvizia trafiki ya API ya AWS.
{% endhint %}

Ruhusa nyingine **zilizopendekezwa lakini sio lazima kwa sehemu ya uchambuzi** ni: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Kukiwa na VPC ya AWS na programu nyingi za asili za wingu zinazozungumza na nyingine na na API ya AWS. Kwa kuwa mawasiliano kati ya huduma ndogo za wingu mara nyingi yamefichwa kwa TLS lazima kuwe na CA ya kibinafsi kutoa vyeti halali kwa huduma hizo. **Ikiwa ACM-PCA inatumika** kwa hilo na mshambuliaji anafanikiwa kupata **upatikanaji wa kudhibiti route53 na ACM-PCA CA ya kibinafsi** na seti ya chini ya ruhusa zilizoelezwa hapo juu, inaweza **kuchukua simu za maombi ya programu kwa API ya AWS** kuchukua ruhusa zao za IAM.

Hii inawezekana kwa sababu:

* AWS SDKs hawana [Kufunga Cheti](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning)
* Route53 inaruhusu kuunda Eneo la Kuhifadhiwa Kibinafsi na rekodi za DNS kwa majina ya kikoa ya AWS ya API
* CA ya Kibinafsi katika ACM-PCA haiwezi kuzuiliwa kusaini vyeti tu kwa Majina ya Kawaida maalum

**Matokeo Yanayowezekana:** Ukarabati wa moja kwa moja kwa kuvizia habari nyeti katika trafiki.

#### Utekaji <a href="#ugunduzi" id="ugunduzi"></a>

Pata hatua za utekelezaji katika utafiti wa awali: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)
