# AWS - Route53権限昇格

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を通じてゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**場合や**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスウォッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)で**フォロー**する。
- **HackTricks**（https://github.com/carlospolop/hacktricks）と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出して、あなたのハッキングトリックを共有してください。

</details>

Route53に関する詳細情報は次をチェックしてください：

{% content-ref url="../aws-services/aws-route53-enum.md" %}
[aws-route53-enum.md](../aws-services/aws-route53-enum.md)
{% endcontent-ref %}

### `route53:CreateHostedZone`、`route53:ChangeResourceRecordSets`、`acm-pca:IssueCertificate`、`acm-pca:GetCertificate`

{% hint style="info" %}
この攻撃を実行するには、対象アカウントにすでに[**AWS Certificate Manager Private Certificate Authority**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)**が設定されている必要があり、VPC内のEC2インスタンスがすでにそれを信頼するために証明書をインポートしている必要があります。このインフラが整備されている場合、以下の攻撃を実行してAWS APIトラフィックを傍受できます。
{% endhint %}

他の権限 **列挙のために推奨されますが必須ではありません**: `route53:GetHostedZone`、`route53:ListHostedZones`、`acm-pca:ListCertificateAuthorities`、`ec2:DescribeVpcs`

複数のクラウドネイティブアプリケーションがお互いやAWS APIと通信しているAWS VPCがあると仮定します。マイクロサービス間の通信はしばしばTLSで暗号化されているため、これらのサービスに有効な証明書を発行するためのプライベートCAが必要です。**ACM-PCA**がそのために使用されており、攻撃者が上記の最小限の権限セットで**route53とacm-pcaプライベートCAの両方を制御するアクセスを取得**した場合、アプリケーションのAWS APIへの呼び出しを**乗っ取る**ことができます。

これは可能です因為:

- AWS SDKには[証明書ピンニング](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning)がありません
- Route53はAWS APIドメイン名のプライベートホストゾーンとDNSレコードを作成することを許可します
- ACM-PCAのプライベートCAは特定の共通名の証明書のみに署名するように制限できません

**潜在的な影響:** トラフィック内の機密情報を傍受することによる間接的な権限昇格。

#### 悪用 <a href="#discovery" id="discovery"></a>

オリジナルの研究で悪用手順を見つける: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)
