# AWS - Escalada de privilegios en Route53

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Red Team de HackTricks en AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¡Consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

Para obtener más información sobre Route53, consulta:

{% content-ref url="../aws-services/aws-route53-enum.md" %}
[aws-route53-enum.md](../aws-services/aws-route53-enum.md)
{% endcontent-ref %}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

{% hint style="info" %}
Para realizar este ataque, la cuenta objetivo ya debe tener una [**Autoridad de Certificación Privada de AWS**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** configurada en la cuenta, y las instancias EC2 en las VPC(s) deben haber importado previamente los certificados para confiar en ella. Con esta infraestructura en su lugar, se puede realizar el siguiente ataque para interceptar el tráfico de la API de AWS.
{% endhint %}

Otros permisos **recomendados pero no requeridos para la parte de enumeración**: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Suponiendo que hay una VPC de AWS con múltiples aplicaciones nativas en la nube que se comunican entre sí y con la API de AWS. Dado que la comunicación entre los microservicios suele estar cifrada con TLS, debe haber una CA privada para emitir los certificados válidos para esos servicios. **Si se utiliza ACM-PCA** para eso y el adversario logra obtener **acceso para controlar tanto route53 como acm-pca private CA** con el conjunto mínimo de permisos descrito anteriormente, puede **interceptar las llamadas de aplicación a la API de AWS** tomando el control de sus permisos IAM.

Esto es posible porque:

* Los SDK de AWS no tienen [Pinning de Certificados](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning)
* Route53 permite crear Zona Hospedada Privada y registros DNS para nombres de dominio de API de AWS
* La CA privada en ACM-PCA no se puede restringir para firmar solo certificados para Nombres Comunes específicos

**Impacto potencial:** Escalada de privilegios indirecta al interceptar información sensible en el tráfico.

#### Explotación <a href="#discovery" id="discovery"></a>

Encuentra los pasos de explotación en la investigación original: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)
