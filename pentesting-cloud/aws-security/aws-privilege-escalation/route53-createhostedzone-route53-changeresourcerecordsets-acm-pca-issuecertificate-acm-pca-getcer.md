# AWS - Ανέβασμα Προνομίων στο Route53

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF**, ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Συμμετάσχετε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας στο hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

Για περισσότερες πληροφορίες σχετικά με το Route53, ελέγξτε:

{% content-ref url="../aws-services/aws-route53-enum.md" %}
[aws-route53-enum.md](../aws-services/aws-route53-enum.md)
{% endcontent-ref %}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

{% hint style="info" %}
Για να πραγματοποιηθεί αυτή η επίθεση, ο λογαριασμός στόχος πρέπει ήδη να έχει ένα [**Ιδιωτικό Πιστοποιητικό Αρχής του AWS Certificate Manager**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** που έχει ρυθμιστεί στον λογαριασμό, και οι περιπτώσεις EC2 στο VPC πρέπει ήδη να έχουν εισαγάγει τα πιστοποιητικά για να το εμπιστευτούν. Με αυτήν την υποδομή στη θέση της, μπορεί να πραγματοποιηθεί η παρακάτω επίθεση για να παρεμβληθεί η κίνηση του AWS API.
{% endhint %}

Άλλες άδειες **συνιστώνται αλλά δεν απαιτούνται για το μέρος της απαρίθμησης**: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Υποθέτοντας ότι υπάρχει ένα AWS VPC με πολλές εφαρμογές που επικοινωνούν μεταξύ τους και με το AWS API. Εφόσον η επικοινωνία μεταξύ των μικρουπηργασιών είναι συχνά κρυπτογραφημένη με TLS, πρέπει να υπάρχει ένα ιδιωτικό Πιστοποιητικό Αρχής για να εκδίδει έγκυρα πιστοποιητικά για αυτές τις υπηρεσίες. **Εάν χρησιμοποιείται το ACM-PCA** για αυτό και ο επιτιθέμενος καταφέρει να έχει **πρόσβαση και στον έλεγχο του route53 και του ιδιωτικού Πιστοποιητικού Αρχής του acm-pca** με το ελάχιστο σύνολο δικαιωμάτων που περιγράφονται παραπάνω, μπορεί να αποκτήσει τον έλεγχο των δικαιωμάτων IAM των εφαρμογών.

Αυτό είναι δυνατόν επειδή:

* Τα SDK του AWS δεν έχουν [Καρφίτσωμα Πιστοποιητικού](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning)
* Το Route53 επιτρέπει τη δημιουργία Ιδιωτικής Φιλοξενούμενης Ζώνης και εγγραφών DNS για τα ονόματα τομέων των AWS API
* Το Ιδιωτικό Πιστοποιητικό Αρχής στο ACM-PCA δεν μπορεί να περιοριστεί στην υπογραφή μόνο πιστοποιητικών για συγκεκριμένα Κοινά Ονόματα

**Πιθανές Επιπτώσεις:** Έμμεσο ανέβασμα προνομίων με την παρεμβολή ευαίσθητων πληροφοριών στην κίνηση.

#### Εκμετάλλευση <a href="#discovery" id="discovery"></a>

Βρείτε τα βήματα εκμετάλλευσης στην αρχική έρευνα: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF**, ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Συμμετάσχετε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass
