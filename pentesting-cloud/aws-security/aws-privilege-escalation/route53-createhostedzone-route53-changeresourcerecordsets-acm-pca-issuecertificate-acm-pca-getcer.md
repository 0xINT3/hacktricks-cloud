# AWS - Route53 Privesc

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

Per ulteriori informazioni su Route53, controlla:

{% content-ref url="../aws-services/aws-route53-enum.md" %}
[aws-route53-enum.md](../aws-services/aws-route53-enum.md)
{% endcontent-ref %}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

{% hint style="info" %}
Per eseguire questo attacco, l'account di destinazione deve gi√† avere un [**Certificato di Autorit√† Privata di AWS Certificate Manager**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** configurato nell'account e le istanze EC2 nella VPC devono aver gi√† importato i certificati per fidarsi di esso. Con questa infrastruttura in atto, √® possibile eseguire l'attacco seguente per intercettare il traffico dell'API di AWS.
{% endhint %}

Altri permessi **raccomandati ma non richiesti per la parte di enumerazione**: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Assumendo che ci sia una VPC AWS con pi√π applicazioni native per il cloud che comunicano tra loro e con l'API di AWS. Poich√© la comunicazione tra i microservizi √® spesso crittografata con TLS, deve essere presente un CA privato per emettere i certificati validi per tali servizi. **Se viene utilizzato ACM-PCA** per questo scopo e l'attaccante riesce ad ottenere **accesso al controllo sia di route53 che di acm-pca private CA** con il set minimo di permessi descritti sopra, pu√≤ **intercettare le chiamate dell'applicazione all'API di AWS** assumendo i loro permessi IAM.

Ci√≤ √® possibile perch√©:

* Le SDK di AWS non hanno [Certificate Pinning](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning)
* Route53 consente di creare una zona ospitata privata e record DNS per i nomi di dominio delle API di AWS
* La CA privata in ACM-PCA non pu√≤ essere limitata a firmare solo certificati per nomi comuni specifici

**Impatto potenziale:** Privesc indiretto intercettando informazioni sensibili nel traffico.

#### Sfruttamento <a href="#discovery" id="discovery"></a>

Trova i passaggi di sfruttamento nella ricerca originale: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
