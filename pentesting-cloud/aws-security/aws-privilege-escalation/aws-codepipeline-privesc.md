# AWS - Codepipeline Privesc

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見る
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦でフォローする [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ハッキングトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## codepipeline

codepipelineに関する詳細情報は次を参照してください：

{% content-ref url="../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md" %}
[aws-datapipeline-codepipeline-codebuild-and-codecommit.md](../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md)
{% endcontent-ref %}

### `iam:PassRole`, `codepipeline:CreatePipeline`, `codebuild:CreateProject, codepipeline:StartPipelineExecution`

コードパイプラインを作成する際に、**実行するためのcodepipeline IAMロール**を指定できるため、それを妨害する可能性があります。

前述の権限に加えて、**コードが保存されている場所にアクセスする必要があります**（S3、ECR、github、bitbucket...）

私はこのプロセスをウェブページでテストしました。前述の権限は、コードパイプラインを作成するために必要なList/Getではなく、ウェブで作成するためには、`codebuild:ListCuratedEnvironmentImages, codebuild:ListProjects, codebuild:ListRepositories, codecommit:ListRepositories, events:PutTargets, codepipeline:ListPipelines, events:PutRule, codepipeline:ListActionTypes, cloudtrail:<several>`も必要です。

**ビルドプロジェクトの作成**中に、**実行するコマンド**（逆シェル？）とビルドフェーズを**特権ユーザーとして実行**することができます。これが攻撃者が妨害するために必要な構成です：

![](<../../../.gitbook/assets/image (276).png>)

![](<../../../.gitbook/assets/image (181).png>)

### ?`codebuild:UpdateProject, codepipeline:UpdatePipeline, codepipeline:StartPipelineExecution`

前述の権限で、コードパイプラインで使用されるロールと実行されるコマンドを変更することが可能かもしれません。

### `codepipeline:pollforjobs`

[AWSは言及しています](https://docs.aws.amazon.com/codepipeline/latest/APIReference/API\_PollForJobs.html):

> このAPIが呼び出されると、CodePipelineは、アクションがそのS3バケットへの入力または出力アーティファクトのためにそのS3バケットへのアクセスを必要とする場合、**一時的なS3バケットの認証情報**を返します。このAPIはまた、アクションで定義された**任意のシークレット値**を返します。
