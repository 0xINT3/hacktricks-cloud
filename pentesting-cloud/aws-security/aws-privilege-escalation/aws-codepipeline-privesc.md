# AWS - Codepipeline Privesc

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter**で**@hacktricks_live**をフォローする
* **HackTricks**および**HackTricks Cloud**のGitHubリポジトリにPRを提出して、あなたのハッキングトリックを共有する

</details>

## codepipeline

codepipelineに関する詳細は次を参照してください：

{% content-ref url="../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md" %}
[aws-datapipeline-codepipeline-codebuild-and-codecommit.md](../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md)
{% endcontent-ref %}

### `iam:PassRole`, `codepipeline:CreatePipeline`, `codebuild:CreateProject, codepipeline:StartPipelineExecution`

コードパイプラインを作成する際に、**実行するためのcodepipeline IAMロール**を指定できるため、それを妨害する可能性があります。

前述の権限に加えて、**コードが保存されている場所にアクセスする必要があります**（S3、ECR、github、bitbucketなど）...

私はこのプロセスをウェブページでテストしました。前述の権限は、コードパイプラインを作成するために必要なList/Get権限ではありませんが、ウェブで作成するには、`codebuild:ListCuratedEnvironmentImages, codebuild:ListProjects, codebuild:ListRepositories, codecommit:ListRepositories, events:PutTargets, codepipeline:ListPipelines, events:PutRule, codepipeline:ListActionTypes, cloudtrail:<several>`も必要です。

**ビルドプロジェクトの作成**中に、**実行するコマンド**（rev shell？）とビルドフェーズを**特権ユーザーとして実行**することができます。これが攻撃者が妨害するために必要な構成です：

![](<../../../.gitbook/assets/image (53).png>)

![](<../../../.gitbook/assets/image (64).png>)

### ?`codebuild:UpdateProject, codepipeline:UpdatePipeline, codepipeline:StartPipelineExecution`

前述の権限で、コードパイプラインで使用されるロールと実行されるコマンドを変更することが可能かもしれません。

### `codepipeline:pollforjobs`

[AWSは言及しています](https://docs.aws.amazon.com/codepipeline/latest/APIReference/API\_PollForJobs.html):

> このAPIが呼び出されると、CodePipelineは、アクションがそのS3バケットにアクセスする必要がある場合、パイプラインのアーティファクトを保存するために使用されるS3バケットの一時的な資格情報を**返します**。このAPIはまた、アクションで定義された**任意のシークレット値を返します**。

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter**で**@hacktricks_live**をフォローする
* **HackTricks**および**HackTricks Cloud**のGitHubリポジトリにPRを提出して、あなたのハッキングトリックを共有する

</details>
