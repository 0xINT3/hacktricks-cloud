# AWS - Επέκταση Προνομίων στο Codestar

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Codestar

Μπορείτε να βρείτε περισσότερες πληροφορίες σχετικά με το codestar στο:

{% content-ref url="codestar-createproject-codestar-associateteammember.md" %}
[codestar-createproject-codestar-associateteammember.md](codestar-createproject-codestar-associateteammember.md)
{% endcontent-ref %}

### `iam:PassRole`, `codestar:CreateProject`

Με αυτές τις άδειες μπορείτε να **καταχραστείτε έναν ρόλο codestar IAM** για να εκτελέσετε **αυθαίρετες ενέργειες** μέσω ενός **προτύπου cloudformation**. Ελέγξτε την παρακάτω σελίδα:

{% content-ref url="iam-passrole-codestar-createproject.md" %}
[iam-passrole-codestar-createproject.md](iam-passrole-codestar-createproject.md)
{% endcontent-ref %}

### `codestar:CreateProject`, `codestar:AssociateTeamMember`

Αυτή η τεχνική χρησιμοποιεί το `codestar:CreateProject` για να δημιουργήσει ένα έργο codestar και το `codestar:AssociateTeamMember` για να καθορίσει έναν χρήστη IAM ως **ιδιοκτήτη** ενός νέου έργου CodeStar, το οποίο θα του παραχωρήσει μια **νέα πολιτική με μερικές επιπλέον άδειες**.
```bash
PROJECT_NAME="supercodestar"

aws --profile "$NON_PRIV_PROFILE_USER" codestar create-project \
--name $PROJECT_NAME \
--id $PROJECT_NAME

echo "Waiting 1min to start the project"
sleep 60

USER_ARN=$(aws --profile "$NON_PRIV_PROFILE_USER" opsworks describe-my-user-profile | jq .UserProfile.IamUserArn | tr -d '"')

aws --profile "$NON_PRIV_PROFILE_USER" codestar associate-team-member \
--project-id $PROJECT_NAME \
--user-arn "$USER_ARN" \
--project-role "Owner" \
--remote-access-allowed
```
Εάν είστε ήδη **μέλος του έργου**, μπορείτε να χρησιμοποιήσετε την άδεια **`codestar:UpdateTeamMember`** για να **ενημερώσετε τον ρόλο σας** σε ιδιοκτήτη αντί για `codestar:AssociateTeamMember`

**Πιθανές Επιπτώσεις:** Ανέβασμα δικαιωμάτων στην πολιτική codestar που δημιουργήθηκε. Μπορείτε να βρείτε ένα παράδειγμα αυτής της πολιτικής στο:

{% content-ref url="codestar-createproject-codestar-associateteammember.md" %}
[codestar-createproject-codestar-associateteammember.md](codestar-createproject-codestar-associateteammember.md)
{% endcontent-ref %}

### `codestar:CreateProjectFromTemplate`

1. **Δημιουργία Νέου Έργου:**
- Χρησιμοποιήστε την ενέργεια **`codestar:CreateProjectFromTemplate`** για να ξεκινήσετε τη δημιουργία ενός νέου έργου.
- Μετά την επιτυχή δημιουργία, αυτόματα παρέχεται πρόσβαση για το **`cloudformation:UpdateStack`**.
- Αυτή η πρόσβαση στοχεύει ειδικά ένα stack που συσχετίζεται με τον ρόλο IAM `CodeStarWorker-<γενικό όνομα έργου>-CloudFormation`.

2. **Ενημέρωση του Στοχευμένου Stack:**
- Με τα παρεχόμενα δικαιώματα CloudFormation, προχωρήστε στην ενημέρωση του συγκεκριμένου stack.
- Το όνομα του stack συνήθως ακολουθεί έναν από τους δύο παρακάτω προτύπους:
- `awscodestar-<γενικό όνομα έργου>-infrastructure`
- `awscodestar-<γενικό όνομα έργου>-lambda`
- Το ακριβές όνομα εξαρτάται από το επιλεγμένο πρότυπο (αναφέροντας το παράδειγμα του εκμεταλλευτικού σεναρίου).

3. **Πρόσβαση και Δικαιώματα:**
- Μετά την ενημέρωση, αποκτάτε τις δυνατότητες που έχουν ανατεθεί στον **ρόλο IAM του CloudFormation** που συσχετίζεται με το stack.
- Σημείωση: Αυτό δεν παρέχει από μόνο του πλήρη δικαιώματα διαχειριστή. Μπορεί να απαιτηθούν επιπλέον μη παραμετροποιημένοι πόροι εντός του περιβάλλοντος για να αναβαθμίσετε περαιτέρω τα δικαιώματα.

Για περισσότερες πληροφορίες, ανατρέξτε στην αρχική έρευνα: [https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/](https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/).\
Μπορείτε να βρείτε το εκμεταλλευτικό σενάριο στο [https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar\_createprojectfromtemplate\_privesc/CodeStarPrivEsc.py](https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar\_createprojectfromtemplate\_privesc/CodeStarPrivEsc.py)

**Πιθανές Επιπτώσεις:** Ανέβασμα δικαιωμάτων στον ρόλο cloudformation IAM.

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** Ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
