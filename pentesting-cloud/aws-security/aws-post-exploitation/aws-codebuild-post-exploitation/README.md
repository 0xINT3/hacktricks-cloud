# AWS - CodeBuildポストエクスプロイテーション

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でAWSハッキングをゼロからヒーローまで学びましょう</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)を**フォロー**する
- **ハッキングトリックを共有するために、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する

</details>

## CodeBuild

詳細については、次を確認してください：

{% content-ref url="../../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### CodeBuildリポジトリアクセスの悪用

**CodeBuild**を構成するには、使用するコードリポジトリへの**アクセスが必要**です。複数のプラットフォームがこのコードをホストしている可能性があります：

<figure><img src="../../../../.gitbook/assets/image (96).png" alt=""><figcaption></figcaption></figure>

**CodeBuildプロジェクトは**、IAMロールを介してまたはgithub/bitbucketの**トークンまたはOAuthアクセス**を使用して、構成されたソースプロバイダへのアクセスを持っている必要があります。

**CodeBuildで昇格された権限を持つ攻撃者**は、構成されたアクセスを悪用して、構成されたリポジトリのコードや設定された認証情報でアクセス権がある他のリポジトリのコードを漏洩させることができます。\
これを行うために、攻撃者は単に**リポジトリのURLを変更**して、構成された認証情報でアクセス権がある各リポジトリにアクセスします（AWSウェブはそれらすべてをリストします）：

<figure><img src="../../../../.gitbook/assets/image (107).png" alt=""><figcaption></figcaption></figure>

そして、**Buildspecコマンドを変更**して、各リポジトリを外部に漏洩させます。

{% hint style="warning" %}
ただし、このタスクは**繰り返し作業で面倒**であり、githubトークンが**書き込み権限で構成**されている場合、攻撃者は**その権限を悪用できません**（トークンにアクセス権がないため）。\
またはできるのでしょうか？次のセクションを確認してください
{% endhint %}

### AWS CodeBuildからのアクセストークンの漏洩

CodeBuildで与えられたアクセスをGithubなどのプラットフォームに漏洩させることができます。外部プラットフォームへのアクセスが与えられているかどうかを確認してください：
```bash
aws codebuild list-source-credentials
```
### `codebuild:DeleteProject`

攻撃者は、CodeBuildプロジェクト全体を削除することができ、プロジェクト構成の損失やプロジェクトに依存するアプリケーションに影響を与える可能性があります。
```bash
aws codebuild delete-project --name <value>
```
**潜在的影響**: 削除されたプロジェクトを使用するアプリケーションにおけるプロジェクト構成の喪失とサービスの中断。

### `codebuild:TagResource`、`codebuild:UntagResource`

攻撃者は、CodeBuild リソースからタグを追加、変更、または削除することができ、組織のコスト割り当て、リソース追跡、およびタグに基づくアクセス制御ポリシーに影響を与える可能性があります。
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**潜在的影響**: コスト割り当て、リソース追跡、およびタグベースのアクセス制御ポリシーの混乱。

### `codebuild:DeleteSourceCredentials`

攻撃者は、Gitリポジトリのソース資格情報を削除することができ、リポジトリに依存するアプリケーションの正常な機能に影響を与える可能性があります。
```sql
aws codebuild delete-source-credentials --arn <value>
```
**潜在的な影響**: 影響を受けたリポジトリに依存するアプリケーションの通常の機能が中断され、ソースの資格情報が削除される可能性があります。

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を使って、ゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい** または **HackTricks をPDFでダウンロードしたい** 場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式PEASS＆HackTricksのグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f) または [**telegramグループ**](https://t.me/peass) に **参加** するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) を **フォロー** してください。
* **HackTricks** と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks) のgithubリポジトリに **PRを提出** して、あなたのハッキングテクニックを共有してください。

</details>
