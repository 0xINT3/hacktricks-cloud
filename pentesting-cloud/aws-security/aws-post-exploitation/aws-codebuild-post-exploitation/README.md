# AWS - CodeBuild后渗透

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[NFTs](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## CodeBuild

有关更多信息，请查看：

{% content-ref url="../../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### 滥用CodeBuild仓库访问权限

为了配置**CodeBuild**，它将需要访问将要使用的代码仓库。多个平台可以托管此代码：

<figure><img src="../../../../.gitbook/assets/image (96).png" alt=""><figcaption></figcaption></figure>

**CodeBuild项目必须访问**配置的源提供程序，可以通过**IAM角色**或使用github/bitbucket的**令牌或OAuth访问**。

拥有**CodeBuild中提升的权限的攻击者**可以滥用此配置的访问权限来泄漏配置的仓库和其他具有访问权限的仓库的代码。\
为了做到这一点，攻击者只需将**仓库URL更改为配置凭据具有访问权限的每个仓库**（请注意，AWS Web将为您列出所有这些仓库）：

<figure><img src="../../../../.gitbook/assets/image (107).png" alt=""><figcaption></figcaption></figure>

然后**更改Buildspec命令以外泄每个仓库**。

{% hint style="warning" %}
然而，这个**任务是重复和繁琐的**，如果使用了具有**写权限的github令牌**，攻击者**将无法（滥用）这些权限**，因为他没有访问令牌。\
或者他有吗？查看下一节
{% endhint %}

### 从AWS CodeBuild泄漏访问令牌

您可以泄漏在CodeBuild中给予的访问权限到像Github这样的平台。检查是否给予了对外部平台的任何访问权限：
```bash
aws codebuild list-source-credentials
```
### `codebuild:DeleteProject`

攻击者可以删除整个 CodeBuild 项目，导致项目配置丢失，并影响依赖该项目的应用程序。
```bash
aws codebuild delete-project --name <value>
```
**潜在影响**：删除项目可能导致项目配置丢失，并影响使用已删除项目的应用程序的服务。

### `codebuild:TagResource`，`codebuild:UntagResource`

攻击者可以向CodeBuild资源添加、修改或删除标签，从而破坏您组织基于标签的成本分配、资源跟踪和访问控制策略。
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**潜在影响**：破坏成本分配、资源跟踪和基于标签的访问控制策略。

### `codebuild:DeleteSourceCredentials`

攻击者可以删除用于 Git 存储库的源凭据，影响依赖该存储库的应用程序的正常运行。
```sql
aws codebuild delete-source-credentials --arn <value>
```
**潜在影响**：由于源凭据被移除，可能导致依赖受影响存储库的应用程序正常功能受到干扰。

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github存储库提交PR来分享您的黑客技巧。

</details>
