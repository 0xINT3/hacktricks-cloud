# AWS - CodeBuild 포스트 익스플로잇

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 제로부터 전문가까지 배우세요!</summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고되길 원하거나** **HackTricks를 PDF로 다운로드**하려면 [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [Discord 그룹](https://discord.gg/hRep4RUj7f)** 또는 [텔레그램 그룹](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우**하세요.
* **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

## CodeBuild

더 많은 정보는 확인하세요:

{% content-ref url="../../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### CodeBuild Repo 악용

**CodeBuild**를 구성하려면 사용할 **코드 리포에 액세스**가 필요합니다. 여러 플랫폼이 이 코드를 호스팅할 수 있습니다:

<figure><img src="../../../../.gitbook/assets/image (96).png" alt=""><figcaption></figcaption></figure>

**CodeBuild 프로젝트는** 구성된 소스 제공자에 **액세스해야** 하며, 이는 **IAM 역할** 또는 github/bitbucket **토큰 또는 OAuth 액세스**를 통해 이루어집니다.

**CodeBuild에서 권한이 상승한 공격자**는 구성된 액세스를 악용하여 구성된 리포의 코드 및 액세스 권한이있는 다른 리포의 코드를 노출시킬 수 있습니다.\
이를 위해 공격자는 **구성 자격 증명이 액세스하는 각 리포지토리의 URL을 변경**하기만 하면 됩니다 (aws 웹은 모든 리포지토리를 나열합니다):

<figure><img src="../../../../.gitbook/assets/image (107).png" alt=""><figcaption></figcaption></figure>

그리고 **Buildspec 명령을 변경하여 각 리포를 유출**할 수 있습니다.

{% hint style="warning" %}
그러나 이 **작업은 반복적이고 지루**할 수 있으며, github 토큰이 **쓰기 권한으로 구성**된 경우, 공격자는 **해당 권한을 (악용)할 수 없을** 것입니다.\
혹시 가능할까요? 다음 섹션을 확인하세요
{% endhint %}

### AWS CodeBuild에서 액세스 토큰 노출

CodeBuild에서 제공된 액세스를 Github와 같은 플랫폼에 노출시킬 수 있습니다. 외부 플랫폼에 액세스 권한이 부여되었는지 확인하세요:
```bash
aws codebuild list-source-credentials
```
{% content-ref url="aws-codebuild-token-leakage.md" %}
[aws-codebuild-token-leakage.md](aws-codebuild-token-leakage.md)
{% endcontent-ref %}

### `codebuild:DeleteProject`

공격자는 전체 CodeBuild 프로젝트를 삭제하여 프로젝트 구성 손실을 유발하고 프로젝트에 의존하는 애플리케이션에 영향을 줄 수 있습니다.
```bash
aws codebuild delete-project --name <value>
```
**잠재적 영향**: 삭제된 프로젝트를 사용하는 애플리케이션의 프로젝트 구성 손실 및 서비스 중단.

### `codebuild:TagResource`, `codebuild:UntagResource`

공격자는 CodeBuild 리소스에서 태그를 추가, 수정 또는 제거하여 조직의 태그에 기반한 비용 할당, 리소스 추적 및 액세스 제어 정책을 방해할 수 있습니다.
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**잠재적 영향**: 비용 할당, 자원 추적 및 태그 기반 액세스 제어 정책 방해.

### `codebuild:DeleteSourceCredentials`

공격자는 Git 저장소의 소스 자격 증명을 삭제하여, 저장소에 의존하는 애플리케이션의 정상 작동에 영향을 줄 수 있습니다.
```sql
aws codebuild delete-source-credentials --arn <value>
```
**잠재적 영향**: 영향을 받는 저장소로부터 소스 자격 증명이 제거되어 영향을 받는 응용 프로그램의 정상 작동이 방해될 수 있습니다.

<details>

<summary><strong>제로부터 영웅이 될 때까지 AWS 해킹을 배우세요</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team 전문가)</strong></a><strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고되길 원하거나** **PDF 형식의 HackTricks를 다운로드하고 싶다면** [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 굿즈**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* **💬 [**디스코드 그룹**](https://discord.gg/hRep4RUj7f)에 가입하거나 [**텔레그램 그룹**](https://t.me/peass)에 가입하거나** **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우하세요.**
* **해킹 트릭을 공유하고 싶다면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소로 PR을 제출하세요.

</details>
