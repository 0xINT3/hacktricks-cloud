# AWS - S3 ポストエクスプロイテーション

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でAWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦で**フォロー**する [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **ハッキングトリックを共有するために、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。**

</details>

## S3

詳細については、以下をチェックしてください:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### 機密情報

時々、バケット内で機密情報を読み取り可能な状態で見つけることができます。たとえば、terraformの状態の秘密情報などです。

### ピボット

異なるプラットフォームがS3を使用して機密資産を保存している可能性があります。\
たとえば、**airflow**が**DAGsのコード**をそこに保存しているか、**Webページ**が直接S3から提供されているかもしれません。書き込み権限を持つ攻撃者は、バケットからコードを変更して他のプラットフォームに**ピボット**したり、JSファイルを変更して**アカウントを乗っ取る**ことができます。

### S3ランサムウェア

このシナリオでは、**攻撃者は自分自身のAWSアカウント**または他の侵害されたアカウントで**KMS（Key Management Service）キーを作成**します。その後、この**キーを世界中の誰でもアクセス可能**にし、このキーを使用してオブジェクトを暗号化するために任意のAWSユーザー、ロール、またはアカウントが使用できるようにします。ただし、オブジェクトは復号できません。

攻撃者は、さまざまな方法を使用してそれに書き込みレベルのアクセスを取得し、それに対して**S3バケットを標的にする**ことを特定します。これは、バケットの設定が公開されているか、攻撃者がAWS環境自体にアクセス権を取得しているためです。攻撃者は、通常、個人を特定できる情報（PII）、保護された健康情報（PHI）、ログ、バックアップなどの機密情報を含むバケットを標的にします。

バケットをランサムウェアの標的にできるかどうかを判断するために、攻撃者はその構成をチェックします。これには、**S3オブジェクトバージョニングが有効になっているか**、**マルチファクタ認証削除（MFA削除）が有効になっているか**を確認することが含まれます。オブジェクトバージョニングが有効になっていない場合、攻撃者は進めることができます。オブジェクトバージョニングが有効になっているが、MFA削除が無効になっている場合、攻撃者は**オブジェクトバージョニングを無効に**することができます。オブジェクトバージョニングとMFA削除の両方が有効になっている場合、攻撃者が特定のバケットをランサムウェアの標的にするのはより困難になります。

AWS APIを使用して、攻撃者は**KMSキーを使用してバケット内の各オブジェクトを暗号化したコピーで置き換えます**。これにより、バケット内のデータが暗号化され、キーなしではアクセスできなくなります。

さらに圧力をかけるために、攻撃者は攻撃で使用したKMSキーの削除をスケジュールします。これにより、対象者はデータを回復するための7日間のウィンドウが与えられます。その後、キーが削除され、データが永久に失われる前にデータを回収する方法についての指示が記載された最終ファイル（通常は「ransom-note.txt」という名前）をアップロードすることができます。このファイルは暗号化されずにアップロードされ、対象者の注意を引き、ランサムウェア攻撃に気づかせるためです。

**詳細については** [**元のリサーチをチェック**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でAWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦で**フォロー**する [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **ハッキングトリックを共有するために、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。**

</details>
