# AWS - S3 后渗透

<details>

<summary><strong>从零开始学习AWS黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>!</strong></summary>

支持HackTricks的其他方式：

* 如果您想在 **HackTricks中看到您的公司广告** 或 **下载HackTricks的PDF版本**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现 [**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上 **关注** 我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>

## S3

更多信息请查看：

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### 敏感信息

有时您可以在可读的存储桶中找到敏感信息。例如，terraform状态机密。

### 转移

不同的平台可能使用S3来存储敏感资产。\
例如，**airflow** 可能在其中存储 **DAGs** **代码**，或者 **网页** 可能直接从S3提供服务。拥有写权限的攻击者可以 **修改存储桶中的代码** 来 **转移到其他平台**，或通过修改JS文件 **接管账户**。

### S3 勒索软件

在这种情况下，**攻击者在自己的AWS账户中创建一个KMS（密钥管理服务）密钥** 或另一个被攻破的账户。然后他们使这个 **密钥对全世界都可访问**，允许任何AWS用户、角色或账户使用这个密钥加密对象。然而，对象不能被解密。

攻击者确定一个目标 **S3存储桶并获得对其的写级别访问权限**，使用各种方法。这可能是由于存储桶配置不当而公开暴露，或者攻击者获得了对AWS环境本身的访问权限。攻击者通常针对包含敏感信息的存储桶，如个人身份信息（PII）、受保护的健康信息（PHI）、日志、备份等。

为了确定存储桶是否可以成为勒索软件的目标，攻击者检查其配置。这包括验证是否启用了 **S3对象版本控制** 和是否启用了 **多因素认证删除（MFA删除）**。如果没有启用对象版本控制，攻击者可以继续。如果启用了对象版本控制但未启用MFA删除，攻击者可以 **禁用对象版本控制**。如果同时启用了对象版本控制和MFA删除，对攻击者来说勒索该特定存储桶就变得更加困难。

使用AWS API，攻击者 **用他们的KMS密钥替换存储桶中的每个对象的加密副本**。这有效地加密了存储桶中的数据，使其在没有密钥的情况下无法访问。

为了进一步施加压力，攻击者安排删除用于攻击的KMS密钥。这给目标一个7天的窗口期来恢复他们的数据，之后密钥将被删除，数据将永久丢失。

最后，攻击者可能会上传一个最终文件，通常命名为 "ransom-note.txt"，其中包含有关目标如何检索文件的说明。这个文件未加密上传，很可能是为了引起目标的注意，让他们意识到勒索软件攻击。

**更多信息** [**查看原始研究**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**。**

<details>

<summary><strong>从零开始学习AWS黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>!</strong></summary>

支持HackTricks的其他方式：

* 如果您想在 **HackTricks中看到您的公司广告** 或 **下载HackTricks的PDF版本**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现 [**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的 [**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上 **关注** 我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>
