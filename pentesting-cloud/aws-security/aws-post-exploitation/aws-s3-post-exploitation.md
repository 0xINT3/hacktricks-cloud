# AWS - S3后渗透

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## S3

有关更多信息，请查看：

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### 敏感信息

有时您可以在存储桶中找到可读取的敏感信息。例如，terraform状态机密信息。

### 枢纽

不同的平台可能使用S3来存储敏感资产。\
例如，**airflow**可能会在其中存储**DAGs代码**，或者**网页**可能直接从S3提供。具有写入权限的攻击者可以从存储桶中**修改代码**以**枢纽**到其他平台，或者**接管账户**修改JS文件。

### S3勒索软件

在这种情况下，**攻击者在其自己的AWS账户或另一个受损账户中创建KMS（密钥管理服务）密钥**。然后，他们使此**密钥对世界上任何人都可访问**，允许任何AWS用户、角色或账户使用此密钥加密对象。但是，这些对象无法解密。

攻击者确定目标**S3存储桶并以写入级别访问**它，使用各种方法。这可能是由于暴露给公众的存储桶配置不当，或者攻击者获得对AWS环境本身的访问权限。攻击者通常针对包含个人可识别信息（PII）、受保护的健康信息（PHI）、日志、备份等敏感信息的存储桶。

为了确定存储桶是否可以成为勒索软件的目标，攻击者检查其配置。这包括验证是否启用了**S3对象版本控制**以及是否启用了**多因素身份验证删除（MFA删除）**。如果未启用对象版本控制，则攻击者可以继续。如果启用了对象版本控制但未启用MFA删除，则攻击者可以**禁用对象版本控制**。如果对象版本控制和MFA删除都已启用，则攻击者更难以勒索特定存储桶。

使用AWS API，攻击者**用其KMS密钥的加密副本替换存储桶中的每个对象**。这有效地加密了存储桶中的数据，使其在没有密钥的情况下无法访问。

为了施加进一步压力，攻击者安排删除攻击中使用的KMS密钥。这给目标一个7天的时间窗口，在密钥被删除和数据永久丢失之前恢复其数据。

最后，攻击者可以上传一个最终文件，通常命名为“ransom-note.txt”，其中包含目标如何检索其文件的说明。这个文件是未加密上传的，可能是为了引起目标的注意，并让他们意识到勒索软件攻击。

**有关更多信息** [**查看原始研究**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
