# AWS - S3 ポストエクスプロイト

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) で</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong></a><strong>!</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または **HackTricksをPDFでダウンロードしたい** 場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や [**telegramグループ**](https://t.me/peass)に**参加する**、または **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) を**フォローする**。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

## S3

詳細については以下をチェックしてください:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### 機密情報

時々、バケット内で読める機密情報を見つけることができます。例えば、terraformの状態の秘密です。

### ピボッティング

異なるプラットフォームがS3を使用して機密資産を保存している可能性があります。\
例えば、**airflow**が**DAGs**の**コード**をそこに保存していたり、**ウェブページ**が直接S3から提供されている場合があります。書き込み権限を持つ攻撃者は、他のプラットフォームに**ピボット**するためにバケットから**コードを変更**したり、JSファイルを変更して**アカウントを乗っ取る**ことができます。

### S3 ランサムウェア

このシナリオでは、**攻撃者は自分のAWSアカウント**または別の侵害されたアカウントで**KMS（Key Management Service）キーを作成します**。次に、この**キーを世界中の誰でもアクセスできるようにします**。これにより、任意のAWSユーザー、ロール、またはアカウントがこのキーを使用してオブジェクトを暗号化できますが、オブジェクトを復号化することはできません。

攻撃者はターゲットの**S3バケットを特定し、書き込みレベルのアクセス権を獲得します**。これは、バケットの構成が不十分で公開されているか、攻撃者がAWS環境自体にアクセスしているためかもしれません。攻撃者は通常、個人識別情報（PII）、保護された健康情報（PHI）、ログ、バックアップなど、機密情報を含むバケットをターゲットにします。

バケットがランサムウェアのターゲットになり得るかどうかを判断するために、攻撃者はその構成をチェックします。これには、**S3オブジェクトバージョニング**が有効になっているか、**多要素認証削除（MFA削除）が有効になっているか**を確認することが含まれます。オブジェクトバージョニングが有効になっていない場合、攻撃者は進むことができます。オブジェクトバージョニングが有効でMFA削除が無効の場合、攻撃者は**オブジェクトバージョニングを無効にする**ことができます。オブジェクトバージョニングとMFA削除の両方が有効になっている場合、攻撃者がその特定のバケットをランサムウェアにすることはより困難になります。

AWS APIを使用して、攻撃者は**バケット内の各オブジェクトを自分のKMSキーを使用して暗号化されたコピーに置き換えます**。これにより、バケット内のデータは暗号化され、キーなしではアクセスできなくなります。

さらに圧力をかけるために、攻撃者は攻撃で使用されたKMSキーの削除をスケジュールします。これにより、ターゲットはデータを回復するために7日間のウィンドウを与えられ、キーが削除されデータが永久に失われる前になります。

最後に、攻撃者は通常「ransom-note.txt」という名前の最終ファイルをアップロードすることができます。これには、ターゲットがファイルを取り戻す方法についての指示が含まれています。このファイルは暗号化せずにアップロードされ、おそらくターゲットの注意を引き、ランサムウェア攻撃の存在を知らせるためです。

**詳細については** [**元の研究をチェックしてください**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**。**

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) で</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong></a><strong>!</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または **HackTricksをPDFでダウンロードしたい** 場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や [**telegramグループ**](https://t.me/peass)に**参加する**、または **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) を**フォローする**。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>
