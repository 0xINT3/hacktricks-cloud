# AWS - –ó–Ω—ñ–º–æ–∫ EBS

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω—ñ–º–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ
```bash
# Install dependencies
pip install 'dsnap[cli]'
brew install vagrant
brew install virtualbox

# Get snapshot from image
mkdir snap_wordir; cd snap_workdir
dsnap init
## Download a snapshot of the volume of that instance
## If no snapshot existed it will try to create one
dsnap get <instance-id>
dsnap --profile default --region eu-west-1 get i-0d706e33814c1ef9a
## Other way to get a snapshot
dsnap list #List snapshots
dsnap get snap-0dbb0347f47e38b96 #Download snapshot directly

# Run with vagrant
IMAGE="<download_file>.img" vagrant up #Run image with vagrant+virtuabox
IMAGE="<download_file>.img" vagrant ssh #Access the VM
vagrant destroy #To destoy

# Run with docker
git clone https://github.com/RhinoSecurityLabs/dsnap.git
cd dsnap
make docker/build
IMAGE="<download_file>.img" make docker/run #With the snapshot downloaded
```
–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ü–µ–π –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º [https://rhinosecuritylabs.com/aws/exploring-aws-ebs-snapshots/](https://rhinosecuritylabs.com/aws/exploring-aws-ebs-snapshots/)

–í–∏ –º–æ–∂–µ—Ç–µ —Ü–µ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Pacu, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–¥—É–ª—å [ebs\_\_download\_snapshots](https://github.com/RhinoSecurityLabs/pacu/wiki/Module-Details#ebs\_\_download\_snapshots)

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω—ñ–º–∫–∞ –≤ AWS

{% code overflow="wrap" %}
```bash
aws ec2 create-volume --availability-zone us-west-2a --region us-west-2  --snapshot-id snap-0b49342abd1bdcb89
```
**–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –π–æ–≥–æ –¥–æ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–æ—ó –º–∞—à–∏–Ω–∏ EC2 –ø—ñ–¥ –≤–∞—à–∏–º –∫–µ—Ä—ñ–≤–Ω–∏—Ü—Ç–≤–æ–º** (–≤–æ–Ω–∞ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≤ —Ç—ñ–π –∂–µ –æ–±–ª–∞—Å—Ç—ñ, —â–æ –π –∫–æ–ø—ñ—è —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó –∫–æ–ø—ñ—ó):

–ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –æ–±—Å—è–≥ –æ–±—Ä–∞–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É —Ç–∞ —Ç–∏–ø—É, –ø–µ—Ä–µ–π—à–æ–≤—à–∏ –¥–æ EC2 ‚Äì> –û–±—Å—è–≥–∏.

–©–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –¥—ñ—é, –≤–∏–∫–æ–Ω–∞–π—Ç–µ —Ü—ñ –∫–æ–º–∞–Ω–¥–∏:
- –°—Ç–≤–æ—Ä—ñ—Ç—å –æ–±—Å—è–≥ EBS –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ EC2.
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –æ–±—Å—è–≥ EBS —Ç–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –æ–¥–Ω—ñ–π –∑–æ–Ω—ñ.

–ö—Ä–æ–∫ 2: –ö–ª–∞—Ü–Ω—ñ—Ç—å –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–æ–º—É –æ–±—Å—è–∑—ñ —Ç–∞ –≤–∏–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—é "–ø—Ä–∏–∫—Ä—ñ–ø–∏—Ç–∏ –æ–±—Å—è–≥".

–ö—Ä–æ–∫ 3: –í–∏–±–µ—Ä—ñ—Ç—å –µ–∫–∑–µ–º–ø–ª—è—Ä –∑ –ø–æ–ª—è —Ç–µ–∫—Å—Ç—É –µ–∫–∑–µ–º–ø–ª—è—Ä–∞.

–©–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –¥—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É:
- –ü—Ä–∏–∫—Ä—ñ–ø—ñ—Ç—å –æ–±—Å—è–≥ EBS.

–ö—Ä–æ–∫ 4: –£–≤—ñ–π–¥—ñ—Ç—å –¥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ EC2 —Ç–∞ –ø–µ—Ä–µ–ª—ñ—á—ñ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ñ –¥–∏—Å–∫–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ `lsblk`.

–ö—Ä–æ–∫ 5: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —î –¥–∞–Ω—ñ –Ω–∞ –æ–±—Å—è–∑—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ `sudo file -s /dev/xvdf`.

–Ø–∫—â–æ –≤–∏–≤—ñ–¥ –≤–∏—â–µ–∑–∞–∑–Ω–∞—á–µ–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏ –ø–æ–∫–∞–∑—É—î "/dev/xvdf: data", —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –æ–±—Å—è–≥ –ø–æ—Ä–æ–∂–Ω—ñ–π.

–ö—Ä–æ–∫ 6: –§–æ—Ä–º–∞—Ç—É–π—Ç–µ –æ–±—Å—è–≥ —É —Ñ–∞–π–ª–æ–≤—É —Å–∏—Å—Ç–µ–º—É ext4 –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ `sudo mkfs -t ext4 /dev/xvdf`. –¢–∞–∫–æ–∂ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ñ–æ—Ä–º–∞—Ç xfs –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ `sudo mkfs -t xfs /dev/xvdf`. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–±–æ ext4, –∞–±–æ xfs.

–ö—Ä–æ–∫ 7: –°—Ç–≤–æ—Ä—ñ—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –∑–∞ –≤–ª–∞—Å–Ω–∏–º –≤–∏–±–æ—Ä–æ–º –¥–ª—è –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –æ–±—Å—è–≥—É ext4. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–∞–∑–≤—É "newvolume".

–©–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –¥—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `sudo mkdir /newvolume`.

–ö—Ä–æ–∫ 8: –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –æ–±—Å—è–≥ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É "newvolume" –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ `sudo mount /dev/xvdf /newvolume/`.

–ö—Ä–æ–∫ 9: –ó–º—ñ–Ω—ñ—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥ "newvolume" —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–∏—Å–∫–æ–≤–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è –æ–±—Å—è–≥—É.

–©–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –¥—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:
- –ó–º—ñ–Ω—ñ—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –Ω–∞ `/newvolume`.
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–∏—Å–∫–æ–≤–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ `df -h .`. –í–∏–≤—ñ–¥ —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏ –ø–æ–≤–∏–Ω–µ–Ω –ø–æ–∫–∞–∑–∞—Ç–∏ –≤—ñ–ª—å–Ω–µ –º—ñ—Å—Ü–µ –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ "newvolume".

–í–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Pacu, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–¥—É–ª—å `ebs__explore_snapshots`.

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω—ñ–º–∫–∞ –≤ AWS (–∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é cli)

{% code overflow="wrap" %}
```bash
aws ec2 create-volume --availability-zone us-west-2a --region us-west-2 --snapshot-id <snap-0b49342abd1bdcb89>

# Attach new volume to instance
aws ec2 attach-volume --device /dev/sdh --instance-id <INSTANCE-ID> --volume-id <VOLUME-ID>

# mount the snapshot from within the VM

sudo file -s /dev/sdh
/dev/sdh: symbolic link to `xvdh'

sudo file -s /dev/xvdh
/dev/xvdh: x86 boot sector; partition 1: ID=0xee, starthead 0, startsector 1, 16777215 sectors, extended partition table (last)\011, code offset 0x63

lsblk /dev/xvdh
NAME     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
xvdh     202:112  0    8G  0 disk
‚îú‚îÄxvdh1  202:113  0  7.9G  0 part
‚îú‚îÄxvdh14 202:126  0    4M  0 part
‚îî‚îÄxvdh15 202:127  0  106M  0 part

sudo mount /dev/xvdh1 /mnt

ls /mnt
```
### –¢—ñ–Ω—å–æ–≤–∞ –∫–æ–ø—ñ—è

–ë—É–¥—å-—è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á AWS, —è–∫–∏–π –º–∞—î –¥–æ–∑–≤—ñ–ª **`EC2:CreateSnapshot`**, –º–æ–∂–µ –≤–∫—Ä–∞—Å—Ç–∏ —Ö–µ—à—ñ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ–º–µ–Ω—É, —Å—Ç–≤–æ—Ä–∏–≤—à–∏ **–∑–Ω—ñ–º–æ–∫ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ –¥–æ–º–µ–Ω—É**, –º–æ–Ω—Ç—É–≤–∞–≤—à–∏ –π–æ–≥–æ –Ω–∞ –∫–µ—Ä–æ–≤–∞–Ω–∏–π –Ω–∏–º –µ–∫–∑–µ–º–ø–ª—è—Ä —Ç–∞ **–µ–∫—Å–ø–æ—Ä—Ç—É—é—á–∏ —Ñ–∞–π–ª–∏ —Ä–µ—î—Å—Ç—Ä—É NTDS.dit —Ç–∞ SYSTEM** –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ –ø—Ä–æ–µ–∫—Ç–æ–º secretsdump –≤—ñ–¥ Impacket.

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó –∞—Ç–∞–∫–∏: [https://github.com/Static-Flow/CloudCopy](https://github.com/Static-Flow/CloudCopy) –∞–±–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –æ–¥–Ω—É –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —Ç–µ—Ö–Ω—ñ–∫ –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–Ω—ñ–º–∫–∞.


# –ü–æ—Å–∏–ª–∞–Ω–Ω—è
* https://devopscube.com/mount-ebs-volume-ec2-instance/
