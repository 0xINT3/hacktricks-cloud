# AWS - Uchimbaji wa Baada ya Uvamizi wa API Gateway

<details>

<summary><strong>Jifunze uchimbaji wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za uchimbaji kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## API Gateway

Kwa habari zaidi angalia:

{% content-ref url="../aws-services/aws-api-gateway-enum.md" %}
[aws-api-gateway-enum.md](../aws-services/aws-api-gateway-enum.md)
{% endcontent-ref %}

### Kufikia APIs zisizofichuliwa

Unaweza kuunda mwisho wa [https://us-east-1.console.aws.amazon.com/vpc/home#CreateVpcEndpoint](https://us-east-1.console.aws.amazon.com/vpc/home?region=us-east-1#CreateVpcEndpoint:) na huduma `com.amazonaws.us-east-1.execute-api`, fichua mwisho katika mtandao ambapo una ufikiaji (labda kupitia mashine ya EC2) na weka kikundi cha usalama kuruhusu mawasiliano yote.\
Kisha, kutoka kwenye mashine ya EC2 utaweza kufikia mwisho na hivyo kuita API ya lango ambayo haikufichuliwa awali.

### Mipango ya Matumizi DoS

Katika sehemu ya **Uchambuzi** unaweza kuona jinsi ya **kupata mpango wa matumizi** wa funguo. Ikiwa una funguo na **imepunguzwa** hadi matumizi X **kwa mwezi**, unaweza **kuitumia tu na kusababisha DoS**.

**Funguo ya API** inahitaji tu kuwa **imejumuishwa** ndani ya **kichwa cha HTTP** kinachoitwa **`x-api-key`**.

### `apigateway:UpdateGatewayResponse`, `apigateway:CreateDeployment`

Mvamizi mwenye ruhusa `apigateway:UpdateGatewayResponse` na `apigateway:CreateDeployment` anaweza **kurekebisha Jibu la Lango lililopo ili kujumuisha vichwa vya desturi au templeti za majibu ambazo hufichua habari nyeti au kutekeleza hati za malicious**.

{% code overflow="wrap" %}
```bash
API_ID="your-api-id"
RESPONSE_TYPE="DEFAULT_4XX"

# Update the Gateway Response
aws apigateway update-gateway-response --rest-api-id $API_ID --response-type $RESPONSE_TYPE --patch-operations op=replace,path=/responseTemplates/application~1json,value="{\"message\":\"$context.error.message\", \"malicious_header\":\"malicious_value\"}"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
{% endcode %}

**Athari Inayowezekana**: Kutolewa kwa taarifa nyeti, kutekeleza scripti za malicious, au kupata ufikivu usioruhusiwa kwenye rasilimali za API.

{% hint style="info" %}
Inahitaji kupimwa
{% endhint %}

### `apigateway:UpdateStage`, `apigateway:CreateDeployment`

Mshambuliaji mwenye ruhusa za `apigateway:UpdateStage` na `apigateway:CreateDeployment` anaweza **kurekebisha hatua ya API Gateway iliyopo ili kuendeleza trafiki kwenye hatua tofauti au kubadilisha mipangilio ya caching ili kupata ufikivu usioruhusiwa wa data iliyohifadhiwa**.

{% code overflow="wrap" %}
```bash
API_ID="your-api-id"
STAGE_NAME="Prod"

# Update the API Gateway stage
aws apigateway update-stage --rest-api-id $API_ID --stage-name $STAGE_NAME --patch-operations op=replace,path=/cacheClusterEnabled,value=true,op=replace,path=/cacheClusterSize,value="0.5"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
{% endcode %}

**Athari Inayowezekana**: Upatikanaji usiohalali wa data iliyohifadhiwa, kuvuruga au kuingilia trafiki ya API.

{% hint style="info" %}
Inahitaji kupimwa
{% endhint %}

### `apigateway:PutMethodResponse`, `apigateway:CreateDeployment`

Mshambuliaji mwenye ruhusa za `apigateway:PutMethodResponse` na `apigateway:CreateDeployment` anaweza **kurekebisha jibu la mbinu ya API Gateway REST API iliyopo ili kujumuisha vichwa vya desturi au templeti za majibu ambazo zinaweza kufichua habari nyeti au kutekeleza scripti za malicious**.
```bash
API_ID="your-api-id"
RESOURCE_ID="your-resource-id"
HTTP_METHOD="GET"
STATUS_CODE="200"

# Update the method response
aws apigateway put-method-response --rest-api-id $API_ID --resource-id $RESOURCE_ID --http-method $HTTP_METHOD --status-code $STATUS_CODE --response-parameters "method.response.header.malicious_header=true"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
**Athari Inayowezekana**: Kuvuja kwa habari nyeti, kutekeleza script za malicious, au kupata ufikivu usioruhusiwa kwa rasilimali za API.

{% hint style="info" %}
Inahitaji kupimwa
{% endhint %}

### `apigateway:UpdateRestApi`, `apigateway:CreateDeployment`

Mshambuliaji mwenye ruhusa za `apigateway:UpdateRestApi` na `apigateway:CreateDeployment` anaweza **kurekebisha mipangilio ya API Gateway REST API kwa kuzima kuingiza kumbukumbu au kubadilisha toleo la chini la TLS, ikisababisha kudhoofisha usalama wa API**.
```bash
API_ID="your-api-id"

# Update the REST API settings
aws apigateway update-rest-api --rest-api-id $API_ID --patch-operations op=replace,path=/minimumTlsVersion,value='TLS_1.0',op=replace,path=/apiKeySource,value='AUTHORIZER'

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
**Athari Inayowezekana**: Kupunguza usalama wa API, ikiruhusu ufikiaji usioruhusiwa au kufichua habari nyeti.

{% hint style="info" %}
Inahitaji majaribio
{% endhint %}

### `apigateway:CreateApiKey`, `apigateway:UpdateApiKey`, `apigateway:CreateUsagePlan`, `apigateway:CreateUsagePlanKey`

Mshambuliaji mwenye ruhusa za `apigateway:CreateApiKey`, `apigateway:UpdateApiKey`, `apigateway:CreateUsagePlan`, na `apigateway:CreateUsagePlanKey` anaweza **kuunda funguo mpya za API, kuziunganisha na mipango ya matumizi, na kuzitumia funguo hizi kwa ufikiaji usioruhusiwa wa API**.
```bash
# Create a new API key
API_KEY=$(aws apigateway create-api-key --enabled --output text --query 'id')

# Create a new usage plan
USAGE_PLAN=$(aws apigateway create-usage-plan --name "MaliciousUsagePlan" --output text --query 'id')

# Associate the API key with the usage plan
aws apigateway create-usage-plan-key --usage-plan-id $USAGE_PLAN --key-id $API_KEY --key-type API_KEY
```
**Athari Inayoweza Kutokea**: Upatikanaji usiohalali wa rasilimali za API, kukiuka udhibiti wa usalama.

{% hint style="info" %}
Inahitaji majaribio
{% endhint %}

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka mwanzo hadi mtaalamu na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalamu wa Timu Nyekundu ya HackTricks AWS)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwenye** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
