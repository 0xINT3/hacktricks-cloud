# Pentester les services Kubernetes

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**d√©p√¥ts Github HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

Kubernetes utilise plusieurs **services r√©seau sp√©cifiques** que vous pourriez trouver **expos√©s sur Internet** ou sur un **r√©seau interne une fois que vous avez compromis un pod**.

## Trouver des pods expos√©s avec OSINT

Une fa√ßon pourrait √™tre de rechercher `Identity LIKE "k8s.%.com"` dans [crt.sh](https://crt.sh) pour trouver des sous-domaines li√©s √† Kubernetes. Une autre fa√ßon pourrait √™tre de rechercher `"k8s.%.com"` dans github et de rechercher des **fichiers YAML** contenant la cha√Æne.

## Comment Kubernetes expose les services

Il peut √™tre utile de comprendre comment Kubernetes peut **exposer des services publiquement** afin de les trouver :

{% content-ref url="exposing-services-in-kubernetes.md" %}
[exposing-services-in-kubernetes.md](exposing-services-in-kubernetes.md)
{% endcontent-ref %}

## Trouver des pods expos√©s via la num√©risation de ports

Les ports suivants peuvent √™tre ouverts dans un cluster Kubernetes :

| Port            | Processus      | Description                                                            |
| --------------- | -------------- | ---------------------------------------------------------------------- |
| 443/TCP         | kube-apiserver | Port API Kubernetes                                                     |
| 2379/TCP        | etcd           |                                                                        |
| 6666/TCP        | etcd           | etcd                                                                   |
| 4194/TCP        | cAdvisor       | M√©triques de conteneur                                                 |
| 6443/TCP        | kube-apiserver | Port API Kubernetes                                                     |
| 8443/TCP        | kube-apiserver | Port API Minikube                                                       |
| 8080/TCP        | kube-apiserver | Port API non s√©curis√©                                                   |
| 10250/TCP       | kubelet        | API HTTPS qui permet un acc√®s en mode complet                           |
| 10255/TCP       | kubelet        | Port HTTP en lecture seule non authentifi√© : pods, pods en cours d'ex√©cution et √©tat du n≈ìud |
| 10256/TCP       | kube-proxy     | Serveur de v√©rification de l'√©tat de sant√© de Kube Proxy                |
| 9099/TCP        | calico-felix   | Serveur de v√©rification de l'√©tat de sant√© pour Calico                  |
| 6782-4/TCP      | weave          | M√©triques et points de terminaison                                      |
| 30000-32767/TCP | NodePort       | Proxy vers les services                                                 |
| 44134/TCP       | Tiller         | Service Helm en √©coute                                                  |

### Nmap

```
nmap -n -T4 -p 443,2379,6666,4194,6443,8443,8080,10250,10255,10256,9099,6782-6784,30000-32767,44134 <pod_ipaddress>/16
```

### Kube-apiserver

Il s'agit du **service API Kubernetes** avec lequel les administrateurs communiquent g√©n√©ralement √† l'aide de l'outil **`kubectl`**.

**Ports courants : 6443 et 443**, mais aussi 8443 dans minikube et 8080 en non s√©curis√©.

```
curl -k https://<Adresse IP>:(8|6)443/swaggerapi
curl -k https://<Adresse IP>:(8|6)443/healthz
curl -k https://<Adresse IP>:(8|6)443/api/v1
```

**Consultez la page suivante pour apprendre √† obtenir des donn√©es sensibles et √† effectuer des actions sensibles en communiquant avec ce service :**

{% content-ref url="kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](kubernetes-enumeration.md)
{% endcontent-ref %}

### Kubelet API

Ce service **s'ex√©cute sur chaque n≈ìud du