# рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреБрдмрд░рдиреЗрдЯреАрдЬ рд╕реЗрд╡рд╛рдПрдВ

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**рдж рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos** рдХреЛред

</details>

рдХреБрдмрд░рдиреЗрдЯреАрдЬ рдХрдИ **рд╡рд┐рд╢реЗрд╖ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛рдПрдВ** рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк **рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЙрднрд╛рд░рд╛ рд╣реБрдЖ** рдпрд╛ **рдПрдХ рдкреЙрдб рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдПрдХ рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ** рдкрд╛рдПрдВ рд╕рдХрддреЗ рд╣реИрдВред

## OSINT рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрднрд░реЗ рд╣реБрдП рдкреЙрдбреНрд╕ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛

рдПрдХ рддрд░реАрдХрд╛ рдХреБрдмрд░рдиреЗрдЯреАрдЬ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рдмрдбреЛрдореЗрди рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `Identity LIKE "k8s.%.com"` рдХреЛ [crt.sh](https://crt.sh) рдореЗрдВ рдЦреЛрдЬрдирд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдк `"k8s.%.com"` рдХреЛ github рдореЗрдВ рдЦреЛрдЬреЗрдВ рдФрд░ рдЗрд╕ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рд╕рдореЗрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ **YAML рдлрд╝рд╛рдЗрд▓** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВред

## рдХреБрдмрд░рдиреЗрдЯреАрдЬ рд╕реЗрд╡рд╛рдПрдВ рдХреИрд╕реЗ рдЙрднрд╛рд░рддрд╛ рд╣реИ

рдпрд╣ рдЖрдкрдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рд╕рдордЭреЗрдВ рдХрд┐ рдХреБрдмрд░рдиреЗрдЯреАрдЬ рдХреИрд╕реЗ **рд╕реЗрд╡рд╛рдПрдВ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрднрд╛рд░рддрд╛** рд╣реИ рддрд╛рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдвреВрдВрдв рд╕рдХреЗрдВ:

{% content-ref url="exposing-services-in-kubernetes.md" %}
[exposing-services-in-kubernetes.md](exposing-services-in-kubernetes.md)
{% endcontent-ref %}

## рдкреЛрд░реНрдЯ рд╕реНрдХреИрдирд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрднрд░реЗ рд╣реБрдП рдкреЙрдбреНрд╕ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЛрд░реНрдЯреНрд╕ рдПрдХ рдХреБрдмрд░рдиреЗрдЯреАрдЬ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдЦреБрд▓реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ:

| рдкреЛрд░реНрдЯ            | рдкреНрд░рдХреНрд░рд┐рдпрд╛        | рд╡рд┐рд╡рд░рдг                                                            |
| --------------- | -------------- | ---------------------------------------------------------------------- |
| 443/TCP         | kube-apiserver | рдХреБрдмрд░рдиреЗрдЯреАрдЬ API рдкреЛрд░реНрдЯ                                                    |
| 2379/TCP        | etcd           |                                                                        |
| 6666/TCP        | etcd           | etcd                                                                   |
| 4194/TCP        | cAdvisor       | рдХрдВрдЯреЗрдирд░ рдореАрдЯреНрд░рд┐рдХреНрд╕                                                      |
| 6443/TCP        | kube-apiserver | рдХреБрдмрд░рдиреЗрдЯреАрдЬ API рдкреЛрд░реНрдЯ                                                    |
| 8443/TCP        | kube-apiserver | Minikube API рдкреЛрд░реНрдЯ                                                      |
| 8080/TCP        | kube-apiserver | рдЕрд╕реБрд░рдХреНрд╖рд┐рдд API рдкреЛрд░реНрдЯ                                                      |
| 10250/TCP       | kubelet        | рдкреВрд░реНрдг рдореЛрдб рдПрдХреНрд╕реЗрд╕ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓рд╛ HTTPS API                                |
| 10255/TCP       | kubelet        | рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рд╡рд╛рд▓рд╛ HTTP рдкреЛрд░реНрдЯ: рдкреЙрдб, рдЪрд▓ рд░рд╣реЗ рдкреЙрдб рдФрд░ рдиреЛрдб рд╕реНрдерд┐рддрд┐ |
| 10256/TCP       | kube-proxy     | Kube Proxy рд╕реНрд╡рд╛рд╕реНрдереНрдп рдЬрд╛рдВрдЪ рд╕рд░реНрд╡рд░                                         |
| 9099/TCP        | calico-felix   | Calico рдХреЗ рд▓рд┐рдП рд╕реНрд╡рд╛рд╕реНрдереНрдп рдЬрд╛рдВрдЪ рд╕рд░реНрд╡рд░                                         |
| 6782-4/TCP      | weave          | рдореАрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕                                                  |
| 30000-32767/TCP | NodePort       | рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░реЙрдХреНрд╕реА                                                  |
| 44134/TCP       | Tiller         | Helm рд╕реЗрд╡рд╛ рд╕реБрди рд░рд╣реА рд╣реИ                                                 |

### Nmap
```
nmap -n -T4 -p 443,2379,6666,4194,6443,8443,8080,10250,10255,10256,9099,6782-6784,30000-32767,44134 <pod_ipaddress>/16
```
### Kube-apiserver

рдпрд╣ **API Kubernetes рд╕реЗрд╡рд╛** рд╣реИ рдЬрд┐рд╕рд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЖрдорддреМрд░ рдкрд░ рдЙрдкрдХрд░рдг **`kubectl`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╛рддрдЪреАрдд рдХрд░рддреЗ рд╣реИрдВред

**рд╕рд╛рдорд╛рдиреНрдп рдкреЛрд░реНрдЯ: 6443 рдФрд░ 443**, рд▓реЗрдХрд┐рди рдорд┐рдирд┐рдХреНрдпреВрдм рдореЗрдВ 8443 рдФрд░ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рдореЗрдВ 8080 рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
```
curl -k https://<IP Address>:(8|6)443/swaggerapi
curl -k https://<IP Address>:(8|6)443/healthz
curl -k https://<IP Address>:(8|6)443/api/v1
```
**рдЗрд╕ рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдХреЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:**

{% content-ref url="kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](kubernetes-enumeration.md)
{% endcontent-ref %}

### Kubelet API

рдпрд╣ рд╕реЗрд╡рд╛ **рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╣рд░ рдиреЛрдб рдореЗрдВ рдЪрд▓рддреА рд╣реИ**ред рдпрд╣ рд╕реЗрд╡рд╛ рд╣реА рд╣реИ рдЬреЛ **рдиреЛрдб** рдХреЗ рдЕрдВрджрд░ рдХреЗ рдкреЙрдбреНрд╕ рдХреЛ **рдирд┐рдпрдВрддреНрд░рд┐рдд** рдХрд░реЗрдЧреАред рдпрд╣ **kube-apiserver** рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рддреА рд╣реИред

рдпрджрд┐ рдЖрдкрдХреЛ рдпрд╣ рд╕реЗрд╡рд╛ рдмрд╛рд╣рд░реА рд░реВрдк рд╕реЗ рдорд┐рд▓рддреА рд╣реИ, рддреЛ рдЖрдкрдиреЗ рдПрдХ **рдЕрдкреНрд░рдорд╛рдгрд┐рдд RCE** рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд▓рд┐рдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

#### Kubelet API
```
curl -k https://<IP address>:10250/metrics
curl -k https://<IP address>:10250/pods
```
рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ `рдЕрдирдзрд┐рдХреГрдд` рд╣реИ рддреЛ рдЗрд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

рдпрджрд┐ рдЖрдк рдиреЛрдбреЛрдВ рдХреА рд╕реВрдЪреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рддреЛ рдЖрдк kubelets endpoints рдХреА рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
kubectl get nodes -o custom-columns='IP:.status.addresses[0].address,KUBELET_PORT:.status.daemonEndpoints.kubeletEndpoint.Port' | grep -v KUBELET_PORT | while IFS='' read -r node; do
ip=$(echo $node | awk '{print $1}')
port=$(echo $node | awk '{print $2}')
echo "curl -k --max-time 30 https://$ip:$port/pods"
echo "curl -k --max-time 30 https://$ip:2379/version" #Check  also for etcd
done
```
#### kubelet (рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП)
```
curl -k https://<IP Address>:10255
http://<external-IP>:10255/pods
```
### etcd API

The etcd API is a key-value store used by Kubernetes to store and retrieve configuration data. It is a critical component of the Kubernetes control plane and is responsible for maintaining the cluster's state.

#### Security Considerations

When pentesting Kubernetes services, it is important to pay attention to the security of the etcd API. Here are some security considerations to keep in mind:

1. **Authentication**: Ensure that the etcd API is properly configured to require authentication. This can be done by enabling client authentication and configuring user accounts with appropriate permissions.

2. **Authorization**: Implement proper authorization mechanisms to control access to the etcd API. Use RBAC (Role-Based Access Control) to define roles and permissions for users and service accounts.

3. **Transport Encryption**: Enable transport encryption to protect data in transit. Use TLS (Transport Layer Security) to secure communication between clients and the etcd API server.

4. **Secure etcd Endpoints**: Restrict access to the etcd API by configuring firewall rules or network policies. Limit access to trusted IP addresses or networks.

5. **Secure etcd Data**: Regularly backup etcd data to prevent data loss. Implement proper access controls to protect the etcd data directory from unauthorized access.

#### Pentesting etcd API

During a pentest, it is important to thoroughly test the security of the etcd API. Here are some techniques that can be used:

1. **Enumeration**: Enumerate the etcd API to gather information about the cluster's configuration and stored data. Use tools like `etcdctl` or custom scripts to interact with the API.

2. **Authentication Bypass**: Attempt to bypass authentication mechanisms to gain unauthorized access to the etcd API. Look for misconfigurations or vulnerabilities that could allow for authentication bypass.

3. **Privilege Escalation**: Exploit vulnerabilities or misconfigurations to escalate privileges within the etcd API. Look for insecure default settings, weak access controls, or privilege escalation vulnerabilities.

4. **Data Manipulation**: Attempt to modify or delete data stored in the etcd API. Look for vulnerabilities that could allow for unauthorized data manipulation or data leakage.

5. **Denial of Service**: Test the etcd API for vulnerabilities that could lead to denial of service attacks. Look for resource exhaustion vulnerabilities or misconfigurations that could impact the availability of the etcd API.

By thoroughly testing the security of the etcd API, you can identify and address any vulnerabilities or misconfigurations that could potentially compromise the security of the Kubernetes cluster.
```
curl -k https://<IP address>:2379
curl -k https://<IP address>:2379/version
etcdctl --endpoints=http://<MASTER-IP>:2379 get / --prefix --keys-only
```
### рдЯрд┐рд▓рд░

Tiller рдПрдХ Kubernetes рдХрдВрдЯреНрд░реЛрд▓ рдкреНрд▓реЗрди рдХрдВрдкреЛрдиреЗрдВрдЯ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ Helm рдЪрд╛рд░реНрдЯреНрд╕ рдХреЛ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред Tiller рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рдФрд░ рдпрд╣ рдЪрд╛рд░реНрдЯреНрд╕ рдХреЛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИред Tiller рдХреНрд▓рд╛рдЗрдВрдЯ рдЪрд╛рд░реНрдЯреНрд╕ рдХреЛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЦреЛрдЬрддрд╛ рд╣реИред Tiller рд╕рд░реНрд╡рд░ рдЪрд╛рд░реНрдЯреНрд╕ рдХреЛ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЪрд╛рд░реНрдЯреНрд╕ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред

Tiller рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЧрд▓рдд рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ Tiller рдЖрдкрдХреЗ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдЦрддрд░реЗ рдореЗрдВ рдбрд╛рд▓ рд╕рдХрддрд╛ рд╣реИред рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ Tiller рдХреЛ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╕рднреА рдирд╛рдорд╕реНрдерд╛рдиреЛрдВ рдФрд░ рдирд╛рдорд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рдПрдХреНрд╕реЗрд╕ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдбрд╝реА рд╕реБрд░рдХреНрд╖рд╛ рдЦреЛрд▓ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред

рдЯрд┐рд▓рд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд░рдгреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП:

1. Tiller рдХреЛ рдирд╛рдорд╕реНрдерд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рд╕реАрдорд┐рдд рдХрд░реЗрдВ рдФрд░ рдХреЗрд╡рд▓ рдЙрди рдирд╛рдорд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рдПрдХреНрд╕реЗрд╕ рджреЗрдВ рдЬрд╣рд╛рдВ рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИред
2. Tiller рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯ рдмрдирд╛рдПрдВ рдФрд░ рдЙрд╕реЗ рдХреЗрд╡рд▓ рдЖрд╡рд╢реНрдпрдХ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдкреНрд░рджрд╛рди рдХрд░реЗрдВред
3. Tiller рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реЛрд▓ рдФрд░ рд░реЛрд▓рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдмрдирд╛рдПрдВ рдФрд░ рдЙрд╕реЗ рдХреЗрд╡рд▓ рдЖрд╡рд╢реНрдпрдХ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдкреНрд░рджрд╛рди рдХрд░реЗрдВред
4. Tiller рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдзрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

рдпрджрд┐ рдЖрдк Tiller рдХреЗ рд╕рд╛рде рд╕рдВрдмрдВрдзрд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рдЦреЛрдЬрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рддреБрд░рдВрдд рдареАрдХ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдЖрдкрдХрд╛ рдХреНрд▓рд╕реНрдЯрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рд╣реЗред
```
helm --host tiller-deploy.kube-system:44134 version
```
рдЖрдк рдЗрд╕ рд╕реЗрд╡рд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ Kubernetes рдореЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ:

### cAdvisor

рдореИрдЯреНрд░рд┐рдХреНрд╕ рдЗрдХрдЯреНрдард╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╕реЗрд╡рд╛ред
```
curl -k https://<IP Address>:4194
```
### рдиреЛрдбрдкреЛрд░реНрдЯ

рдЬрдм рдПрдХ рдкреЛрд░реНрдЯ рдХреЛ рд╕рднреА рдиреЛрдбреЛрдВ рдореЗрдВ рдПрдХ **рдиреЛрдбрдкреЛрд░реНрдЯ** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрднрд╛рд░рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдШреЛрд╖рд┐рдд **рд╕реЗрд╡рд╛** рдореЗрдВ рдпрд╣реА рдкреЛрд░реНрдЯ рд╕рднреА рдиреЛрдбреЛрдВ рдореЗрдВ рдЦреЛрд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдкреНрд░реЛрдХреНрд╕реА рдХрд░рддрд╛ рд╣реИ. рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрд╣ рдкреЛрд░реНрдЯ **30000-32767** рдХреЗ рд░реЗрдВрдЬ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ. рдЗрд╕рд▓рд┐рдП рдирдП рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХреА рдЧрдИ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЗрди рдкреЛрд░реНрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╣реБрдВрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ.
```
sudo nmap -sS -p 30000-32767 <IP>
```
## рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рдЧрд▓рддрд┐рдпрд╛рдБ

### рдХреНрдпреВрдм-рдПрдкреАрдЖрдИрд╕рд░реНрд╡рд░ рдЕрдирд╛рдордд рдкрд╣реБрдБрдЪ

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд░реВрдк рд╕реЗ, **рдХреНрдпреВрдм-рдПрдкреАрдЖрдИрд╕рд░реНрд╡рд░** рдПрдкреАрдЖрдИ рдЕрдВрдд-рдмрд┐рдВрджреБрдУрдВ рдХреЛ **рдЕрдирд╛рдордд** рдкрд╣реБрдБрдЪ рдХреЗ рд▓рд┐рдП **рдордирд╛** рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рд▓реЗрдХрд┐рди рдпрд╣ рд╣рдореЗрд╢рд╛ рдЕрдЪреНрдЫрд╛ рд╡рд┐рдЪрд╛рд░ рд╣реИ рдХрд┐ рдЖрдк рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ **рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдЕрдВрдд-рдмрд┐рдВрджреБ** рд╣реИрдВ рдЬреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ:

![](https://www.cyberark.com/wp-content/uploads/2019/09/Kube-Pen-2-fig-5.png)

### ETCD рдЕрдирд╛рдордд рдкрд╣реБрдБрдЪ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛

ETCD рдХреНрд▓рд╕реНрдЯрд░ рд╕реАрдХреНрд░реЗрдЯреНрд╕, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ рдФрд░ рдЕрдзрд┐рдХ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛** рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рддрд╛ рд╣реИред **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд░реВрдк рд╕реЗ, ETCD рдХреЛ **рдЕрдирд╛рдордд** рдкрд╣реБрдБрдЪ рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╣рдореЗрд╢рд╛ рдЕрдЪреНрдЫрд╛ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдЬрд╛рдВрдЪреЗрдВред

рдпрджрд┐ ETCD рдЕрдирд╛рдордд рд░реВрдк рд╕реЗ рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рд╣реИ, рддреЛ рдЖрдкрдХреЛ **etcdctl** рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рд╕рднреА рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХреБрдВрдЬреА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧреА:
```
etcdctl --endpoints=http://<MASTER-IP>:2379 get / --prefix --keys-only
```
### **Kubelet RCE**

[**Kubelet рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг**](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/) рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реЗрд╡рд╛ рдХреЛ **рдЕрдирд╛рдордд рдкрд╣реБрдВрдЪ** рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ:

> Kubelet рд╕рд░реНрд╡рд░ рдХреЛ рдЕрдирд╛рдордд рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИред рджреВрд╕рд░реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐ рджреНрд╡рд╛рд░рд╛ рдЕрд╕реНрд╡реАрдХреГрдд рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрдирд╛рдордд рдЕрдиреБрд░реЛрдз рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░рд┐рдХ рд░реВрдк рд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЕрдирд╛рдордд рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо `system:anonymous` рдФрд░ рдПрдХ рд╕рдореВрд╣ рдирд╛рдо `system:unauthenticated` рд╣реЛрддрд╛ рд╣реИред

**Kuebelet API рдХреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдЕрдзрд┐рдХреГрддрддрд╛ рдХреЛ рд╕рдордЭрдиреЗ** рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреГрд╖реНрда рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="../kubernetes-pentesting/pentesting-kubernetes-services/kubelet-authentication-and-authorization.md" %}
[kubelet-authentication-and-authorization.md](../kubernetes-pentesting/pentesting-kubernetes-services/kubelet-authentication-and-authorization.md)
{% endcontent-ref %}

**Kubelet** рд╕реЗрд╡рд╛ **API рдХрд╛ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдирд╣реАрдВ рд╣реИ**, рд▓реЗрдХрд┐рди рд╕реНрд░реЛрдд рдХреЛрдб рдпрд╣рд╛рдВ рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдЬреНрдЬреНрд╡рд▓ рдЕрдВрддрдГрд╕реНрдерд╛рдкрд┐рдд рдЕрдВрддрдГрд╕реНрдерд╛рдкрд┐рдд рдмрд┐рдВрджреБрдУрдВ рдХреЛ рдвреВрдВрдврдирд╛ рдЗрддрдирд╛ рдЖрд╕рд╛рди рд╣реИ рдЬрд┐рддрдирд╛ рдХрд┐ **рдЪрд▓рд╛рдирд╛**:
```bash
curl -s https://raw.githubusercontent.com/kubernetes/kubernetes/master/pkg/kubelet/server/server.go | grep 'Path("/'

Path("/pods").
Path("/run")
Path("/exec")
Path("/attach")
Path("/portForward")
Path("/containerLogs")
Path("/runningpods/").
```
рд╕рднреА рдпрд╣ рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВред

рдЖрдк [**Kubeletctl**](https://github.com/cyberark/kubeletctl) рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Kubelets рдФрд░ рдЙрдирдХреЗ endpoints рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред


#### /pods

рдЗрд╕ endpoint рдореЗрдВ pods рдФрд░ рдЙрдирдХреЗ containers рдХреА рд╕реВрдЪреА рд╣реЛрддреА рд╣реИ:
```bash
kubeletctl pods
```
#### /exec

рдпрд╣ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХрд┐рд╕реА рднреА рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдХреЛрдб рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:
```bash
kubeletctl exec [command]
```
{% hint style="info" %}
рдЗрд╕ рд╣рдорд▓реЗ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП _**kubelet**_ рд╕реЗрд╡рд╛ рдХреЛ `--anonymous-auth false` рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╕реЗрд╡рд╛ рдХреЛ рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрддрд░ рдкрд░ рдЕрд▓рдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред
{% endhint %}

### **Kubelet (Read Only Port) рд╕реВрдЪрдирд╛ рдЕрд╡рдЧреБрдгрди рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**

рдЬрдм **kubelet read-only port** рдЙрдЬрд╛рдЧрд░ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдорд▓рд╛рд╡рд░реНрддреА API рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рд╕реЗ **рдХреНрд▓рд╕реНрдЯрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рддрддреНрд╡, рдЬреИрд╕реЗ рдкреЙрдб рдХреЗ рдирд╛рдо, рдЖрдВрддрд░рд┐рдХ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рд╕реНрдерд╛рди рдФрд░ рдЕрдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдЙрдЬрд╛рдЧрд░ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рджреВрд░рд╕реНрде рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд URL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ: `http://<external-IP>:10255/pods`

![](https://www.cyberark.com/wp-content/uploads/2019/09/KUbe-Pen-2-fig-6.png)

## рд╕рдВрджрд░реНрдн

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-2" %}

{% embed url="https://labs.f-secure.com/blog/attacking-kubernetes-through-kubelet" %}

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣](https://discord.gg/hRep4RUj7f) рдпрд╛ [рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдкрд░ рдлрд╝реЙрд▓реЛ рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХреНрд▓рд╛рдЙрдб** рдЧрд┐рдЯрд╣рдм рд░реЗрдкреЛ рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>
