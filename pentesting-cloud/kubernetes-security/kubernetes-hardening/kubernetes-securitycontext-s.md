# Kubernetes Güvenlik Bağlamı(ları)

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmak için öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz olan [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)'u **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek** paylaşın.

</details>

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Dokümantasyondan:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Bir Pod'un güvenlik bağlamını belirtirken birkaç özniteliği kullanabilirsiniz. Savunma amaçlı güvenlik açısından aşağıdakileri göz önünde bulundurmalısınız:

* **runASNonRoot**'u **True** olarak ayarlamak
* **runAsUser**'ı yapılandırmak
* Mümkünse, **seLinuxOptions** ve **seccompProfile** ile **izinleri sınırlamak**
* **runAsGroup** ve **supplementaryGroups** aracılığıyla **ayrıcalık grubu erişimini** **VERMEMEK**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>tamsayı</em></p>                                                                                                                                                                                                                                                 | <p>Bir Pod'daki **tüm konteynerlara uygulanan özel bir ek grup**. Bazı hacim türleri, Kubelet'in bu hacmin sahipliğini Pod tarafından sahiplenilen bir şekilde değiştirmesine izin verir:<br>1. Sahip olan GID FSGroup olur<br>2. setgid biti ayarlanır (hacimde oluşturulan yeni dosyalar FSGroup'a ait olur)<br>3. İzin bitleri rw-rw---- ile OR'lanır. Ayarlanmamışsa, Kubelet hiçbir hacmin sahipliğini ve izinlerini değiştirmez</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>dize</em></p>                                                                                                                                                                                                                                      | Bu, Pod içinde görünmeden önce hacmin **sahipliğini ve iznini değiştirme davranışını** tanımlar.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>tamsayı</em></p>                                                                                                                                                                                                                                              | Konteyner sürecinin **giriş noktasını çalıştırmak için kullanılacak GID**. Ayarlanmamışsa, çalışma zamanı varsayılanı kullanılır. Ayrıca SecurityContext içinde de ayarlanabilir.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>mantıksal</em></p>                                                                                                                                                                                                                                            | Konteynerin bir kök kullanıcı olarak çalışmaması gerektiğini belirtir. Eğer true ise, Kubelet, konteynerin UID 0 (kök) olarak çalışmadığından emin olmak için görüntüyü çalışma zamanında doğrular ve konteyneri başlatamazsa hata verir.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>tamsayı</em></p>                                                                                                                                                                                                                                               | Konteyner sürecinin **giriş noktasını çalıştırmak için kullanılacak UID**. Belirtilmemişse, görüntü meta verilerinde belirtilen kullanıcıya varsayılan olarak ayarlanır.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>seLinux hakkında daha fazla bilgi</em></p>                                                           | **Tüm konteynerlara uygulanacak SELinux bağlamı**. Belirtilmemişse, konteyner çalışma zamanı her konteyner için rastgele bir SELinux bağlamı tahsis eder.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Seccomp hakkında daha fazla bilgi</em></p>                                                           | Bu Pod'daki konteynerler tarafından kullanılacak **seccomp seçenekleri**.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>tamsayı dizisi</em></p>                                                                                                                                                                                                                                | Her konteynerde **ilk olarak çalıştırılan sürece uygulanan grupların listesi**, konteynerin birincil GID'sine ek olarak.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>dizi</em><br><em>sysctl hakkında daha fazla bilgi</em></p> | Sysctls, Pod için kullanılan **isim alanlı sysctl'lerin bir listesini** tutar. Konteyner çalışma zamanı tarafından desteklenmeyen sysctl'lerle (tarafından) çalıştırılan Pod'lar başlatılamaz.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Tüm konteynerlara uygulanan Windows özel ayarlar. Belirtilmemişse, bir konteynerin SecurityContext içindeki seçenekler kullanılır.                                                                                                                                                                                                                                                                                                                                               |
## SecurityContext

[**Dokümantasyondan:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Bu bağlam, **konteyner tanımları** içinde ayarlanır. Savunma odaklı bir güvenlik açısından aşağıdaki hususları göz önünde bulundurmalısınız:

* **allowPrivilegeEscalation**'ı **False** olarak ayarlayın
* Hassas **yetenekleri** eklemeyin (ve ihtiyaç duymadıklarınızı kaldırın)
* **privileged**'ı **False** olarak ayarlayın
* Mümkünse, **readOnlyFilesystem**'i **True** olarak ayarlayın
* **runAsNonRoot**'u **True** olarak ayarlayın ve bir **runAsUser** belirleyin
* Mümkünse, **seLinuxOptions** ve **seccompProfile**'ı belirterek **izinleri sınırlayın**
* **runAsGroup** üzerinden **privilege** **group** erişimini **VERMEYİN.**

Unutmayın ki, **SecurityContext** ve **PodSecurityContext** içinde ayarlanan özelliklerde, **SecurityContext**'te belirtilen değer önceliklidir.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation**, bir işlemin **ebeveyn işleminden daha fazla ayrıcalık kazanıp kazanamayacağını** kontrol eder. Bu bool, no\_new\_privs bayrağının konteyner işlemine ayarlanıp ayarlanmayacağını doğrudan kontrol eder. AllowPrivilegeEscalation, konteyner **Privileged** olarak çalıştırıldığında veya **CAP\_SYS\_ADMIN**'e sahip olduğunda her zaman true'dur. |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Capabilities</em> <em>hakkında daha fazla bilgi</em></p>  | Konteynerler çalıştırılırken **eklenecek/düşürülecek yetenekler**. Varsayılan olarak, varsayılan yetenek kümesi kullanılır.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Ayrıcalıklı modda konteyneri çalıştırın. Ayrıcalıklı konteynerlerdeki işlemler, temelde **ana bilgisayardaki root ile eşdeğerdir**. Varsayılan olarak false'dur.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount, konteynerler için kullanılacak **proc mount türünü** belirtir. Varsayılan olarak, DefaultProcMount kullanılır ve salt okunur yolları ve maskelenmiş yolları için konteyner çalışma zamanı varsayılanlarını kullanır.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Bu **konteynerin salt okunur bir kök dosya sistemi** olup olmadığını belirtir. Varsayılan olarak false'dur.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | Konteyner işlemi giriş noktasını çalıştırmak için **GID**'yi belirtir. Ayarlanmamışsa, çalışma zamanı varsayılanı kullanılır.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Konteynerin **root kullanıcısı olarak çalışmaması gerektiğini** belirtir. True ise, Kubelet, konteynerin başlatılamaması için çalışma zamanında görüntüyü UID 0 (root) olarak çalıştırmamasını doğrulayacaktır.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | Konteyner işlemi giriş noktasını çalıştırmak için **UID**'yi belirtir. Ayarlanmamışsa, görüntü meta verilerinde belirtilen kullanıcıya varsayılan olarak ayarlanır.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>seLinux</em> <em>hakkında daha fazla bilgi</em></p> | Konteynere uygulanacak **SELinux bağlamını** belirtir. Belirtilmemişse, konteyner çalışma zamanı her konteyner için rastgele bir SELinux bağlamı tahsis eder.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | Bu konteyner tarafından kullanılacak **seccomp seçenekleri**.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | Tüm konteynerlere uygulanan **Windows özel ayarları**.                                                                                                                                                                                                                                                              |

## Referanslar

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahramana kadar AWS hackleme öğrenin!</summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklam vermek veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)'u takip edin.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek paylaşın.

</details>
