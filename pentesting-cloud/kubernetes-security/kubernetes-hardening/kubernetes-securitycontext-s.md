# Kubernetes SecurityContext(s)

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Z dokumentacji:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Podczas określania kontekstu bezpieczeństwa Podu można użyć kilku atrybutów. Z punktu widzenia defensywnego bezpieczeństwa należy wziąć pod uwagę:

* Ustawienie **runASNonRoot** na **True**
* Konfigurację **runAsUser**
* Jeśli to możliwe, rozważ **ograniczenie** **uprawnień** poprzez określenie **seLinuxOptions** i **seccompProfile**
* **NIE** udzielanie dostępu do **grupy uprzywilejowanej** za pomocą **runAsGroup** i **supplementaryGroups**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>liczba całkowita</em></p>                                                                                                                                                                                                                                                 | <p>Specjalna grupa uzupełniająca, która dotyczy <strong>wszystkich kontenerów w podzie</strong>. Niektóre typy woluminów pozwalają Kubeletowi <strong>zmienić właściciela tego woluminu</strong>, aby był własnością poda:<br>1. GID właściciela będzie FSGroup<br>2. Ustawiony zostanie bit setgid (nowe pliki utworzone w woluminie będą własnością FSGroup)<br>3. Bity uprawnień są OR-owane z rw-rw---- Jeśli nie jest ustawione, Kubelet nie będzie modyfikował właściciela i uprawnień żadnego woluminu</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>łańcuch znaków</em></p>                                                                                                                                                                                                                                      | Określa zachowanie **zmiany właściciela i uprawnień woluminu** przed udostępnieniem go wewnątrz Podu.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>liczba całkowita</em></p>                                                                                                                                                                                                                                              | **GID, pod którym ma być uruchomiony punkt wejścia procesu kontenera**. Używa domyślnych ustawień czasu wykonywania, jeśli nie jest ustawione. Może być również ustawione w SecurityContext.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>wartość logiczna</em></p>                                                                                                                                                                                                                                            | Wskazuje, że kontener musi być uruchomiony jako użytkownik nie będący rootem. Jeśli wartość jest true, Kubelet sprawdzi obraz w czasie wykonywania, aby upewnić się, że nie jest uruchomiony jako UID 0 (root) i nie uruchomi kontenera, jeśli tak jest.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>liczba całkowita</em></p>                                                                                                                                                                                                                                               | **UID, pod którym ma być uruchomiony punkt wejścia procesu kontenera**. Domyślnie jest to użytkownik określony w metadanych obrazu, jeśli nie jest określony.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Więcej informacji na temat</em> <em><strong>seLinux</strong></em></p>                                                           | **Kontekst SELinux, który ma być zastosowany do wszystkich kontenerów**. Jeśli nie jest określony, środowisko uruchomieniowe kontenera przydzieli losowy kontekst SELinux dla każdego kontenera.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Więcej informacji na temat</em> <em><strong>Seccomp</strong></em></p>                                                           | **Opcje seccomp do użycia przez kontenery** w tym podzie.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>tablica liczb całkowitych</em></p>                                                                                                                                                                                                                                | Lista **grup stosowanych do pierwszego uruchomionego procesu w każdym kontenerze**, oprócz podstawowego GID kontenera.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>tablica</em><br><em>Więcej informacji na temat</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctls zawiera listę **sysctls przestrzeni nazw używanych dla poda**. Pody z nieobsługiwanymi sysctls (przez środowisko uruchomieniowe kontenera) mogą nie uruchomić się.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Windowsowe ustawienia specyficzne dla wszystkich kontenerów. Jeśli nie jest określone, będą używane opcje w ramach SecurityContext kontenera.                                                                                                                                                                                                                                                                                                                                               |
## SecurityContext

[**Z dokumentacji:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Ten kontekst jest ustawiany w **definicjach kontenerów**. Z perspektywy defensywnego bezpieczeństwa należy wziąć pod uwagę:

* **allowPrivilegeEscalation** ustawione na **False**
* Nie dodawaj wrażliwych **capabilities** (i usuń te, których nie potrzebujesz)
* **privileged** ustawione na **False**
* Jeśli to możliwe, ustaw **readOnlyFilesystem** na **True**
* Ustaw **runAsNonRoot** na **True** i podaj **runAsUser**
* Jeśli to możliwe, rozważ **ograniczenie** **uprawnień** poprzez określenie **seLinuxOptions** i **seccompProfile**
* **NIE** udzielaj dostępu do **grupy z uprawnieniami** poprzez **runAsGroup**

Należy zauważyć, że atrybuty ustawione zarówno w **SecurityContext**, jak i **PodSecurityContext**, wartość określona w **SecurityContext** ma **priorytet**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** kontroluje, czy proces może **uzyskać więcej uprawnień** niż jego proces nadrzędny. To boolowskie pole bezpośrednio kontroluje, czy flaga no\_new\_privs zostanie ustawiona dla procesu kontenera. AllowPrivilegeEscalation jest zawsze true, gdy kontener jest uruchamiany jako **Privileged** lub ma **CAP\_SYS\_ADMIN**. |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Więcej informacji na temat</em> <em><strong>Capabilities</strong></em></p>  | **Capabilities do dodania/usunięcia podczas uruchamiania kontenerów**. Domyślnie ustawione na zestaw domyślnych capabilities.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Uruchom kontener w trybie privileged. Procesy w kontenerach privileged są w zasadzie **równoważne z rootem na hoście**. Domyślnie ustawione na false.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount określa **typ montowania proc do użycia dla kontenerów**. Domyślnie używane są domyślne ścieżki tylko do odczytu i zmaskowane ścieżki dla kontenera.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Czy ten **kontener ma system plików root tylko do odczytu**. Domyślnie ustawione na false.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | **GID, z którego ma być uruchomiony entrypoint** procesu kontenera. Używa domyślnych ustawień czasu wykonania, jeśli nie jest ustawione.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Wskazuje, że kontener musi **działać jako użytkownik nie będący rootem**. Jeśli true, Kubelet sprawdzi obraz w czasie wykonania, aby upewnić się, że nie działa jako UID 0 (root) i nie uruchomi kontenera, jeśli tak jest.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | **UID, z którego ma być uruchomiony entrypoint** procesu kontenera. Domyślnie używany jest użytkownik określony w metadanych obrazu, jeśli nie jest określony.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Więcej informacji na temat</em> <em><strong>seLinux</strong></em></p> | **Kontekst SELinux, który ma być zastosowany do kontenera**. Jeśli nie jest określony, środowisko wykonawcze kontenera przydzieli losowy kontekst SELinux dla każdego kontenera.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | **Opcje seccomp** do użycia przez ten kontener.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | **Specyficzne dla systemu Windows ustawienia**, które są stosowane do wszystkich kontenerów.                                                                                                                                                                                                                                                              |

## Odwołania

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Podziel się swoimi trikami hakerskimi, przesyłając PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
