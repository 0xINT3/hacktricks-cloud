# Usalama wa Kubernetes SecurityContext(s)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **nifuata** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Kutoka kwenye nyaraka:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Unapotaja muktadha wa usalama wa Pod unaweza kutumia sifa kadhaa. Kutoka kwa mtazamo wa usalama wa kujilinda unapaswa kuzingatia:

* Kuwa na **runASNonRoot** kama **Kweli**
* Kupangilia **runAsUser**
* Ikiwezekana, fikiria **kupunguza** **ruhusa** kwa kuonyesha **seLinuxOptions** na **seccompProfile**
* **USIMPE** upatikanaji wa **kikundi cha mamlaka** kupitia **runAsGroup** na **supplementaryGroups**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>nambari</em></p>                                                                                                                                                                                                                                                 | <p>Kikundi maalum cha ziada kinachotumika kwa <strong>kontena zote katika podi</strong>. Baadhi ya aina za kiasi cha data kuruhusu Kubelet kubadilisha <strong>umiliki wa kiasi hicho cha data</strong> ili kumilikiwe na podi:<br>1. GID inayomiliki itakuwa FSGroup<br>2. Biti ya setgid imewekwa (faili mpya zilizoundwa kwenye kiasi zitamilikiwa na FSGroup)<br>3. Biti za ruhusa zimeongezwa na rw-rw---- Ikiwa haijawekwa, Kubelet haitabadilisha umiliki na ruhusa ya kiasi chochote</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>herufi</em></p>                                                                                                                                                                                                                                      | Hii inadefinisha tabia ya **kubadilisha umiliki na ruhusa ya kiasi cha data** kabla ya kuwekwa wazi ndani ya Podi.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>nambari</em></p>                                                                                                                                                                                                                                              | **GID ya kuendesha kuingia kwa mchakato wa kontena**. Inatumia chaguo la wakati wa utekelezaji ikiwa haijawekwa. Inaweza pia kuwekwa katika Muktadha wa Usalama.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>kweli</em></p>                                                                                                                                                                                                                                            | Inaonyesha kwamba kontena lazima iende kama mtumiaji asiye wa mizizi. Ikiwa ni kweli, Kubelet itathibitisha picha wakati wa utekelezaji ili kuhakikisha kuwa haifanyi kazi kama UID 0 (mizizi) na kushindwa kuanza kontena ikiwa inafanya hivyo.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>nambari</em></p>                                                                                                                                                                                                                                               | **UID ya kuendesha kuingia kwa mchakato wa kontena**. Ina default kwa mtumiaji aliyeainishwa kwenye metadata ya picha ikiwa haijawekwa.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Maelezo zaidi kuhusu</em> <em><strong>seLinux</strong></em></p>                                                           | **Muktadha wa SELinux utakaotumiwa kwa kontena zote**. Ikiwa haijawekwa, muda wa utekelezaji wa kontena utatenga muktadha wa SELinux wa nasibu kwa kila kontena.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Maelezo zaidi kuhusu</em> <em><strong>Seccomp</strong></em></p>                                                           | **Chaguo za seccomp kutumika na kontena** katika podi hii.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>orodha ya nambari</em></p>                                                                                                                                                                                                                                | Orodha ya **vikundi vinavyotumika kwa mchakato wa kwanza unaotekelezwa katika kila kontena**, mbali na GID kuu ya kontena.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>orodha</em><br><em>Maelezo zaidi kuhusu</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctls inashikilia orodha ya **sysctls zilizotengwa kwa podi**. Podi zenye sysctls zisizoungwa mkono (na muda wa utekelezaji wa kontena) zinaweza kushindwa kuzinduliwa.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Mipangilio maalum ya Windows inayotumiwa kwa kontena zote. Ikiwa haijawekwa, chaguo ndani ya Muktadha wa Usalama wa kontena itatumika.                                                                                                                                                                                                                                                                                                                                               |
## SecurityContext

[**Kutoka kwa nyaraka:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Muktadha huu umewekwa ndani ya **ufafanuzi wa vyombo**. Kutoka mtazamo wa usalama wa kujilinda unapaswa kuzingatia:

* **allowPrivilegeEscalation** iwe **False**
* Usiweke **capabilities** nyeti (na ondoa zile usizohitaji)
* **privileged** iwe **False**
* Ikiwezekana, weka **readOnlyFilesystem** kama **True**
* Weka **runAsNonRoot** iwe **True** na weka **runAsUser**
* Ikiwezekana, zingatia **kupunguza** **ruhusa** kwa kuonyesha **seLinuxOptions** na **seccompProfile**
* **USIPE** upatikanaji wa **kikundi** cha **privilege** kupitia **runAsGroup.**

Tambua kuwa sifa zilizowekwa katika **SecurityContext na PodSecurityContext**, thamani iliyoainishwa katika **SecurityContext** inachukua **kipaumbele**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** inadhibiti ikiwa mchakato unaweza **kupata mamlaka zaidi** kuliko mchakato wake mzazi. Bool hii moja kwa moja inadhibiti ikiwa bendera ya no\_new\_privs itawekwa kwenye mchakato wa chombo. AllowPrivilegeEscalation ni kweli daima wakati chombo kinakimbia kama **Privileged** au ina **CAP\_SYS\_ADMIN** |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Maelezo zaidi kuhusu</em> <em><strong>Capabilities</strong></em></p>  | **uwezo wa kuongeza/kuondoa wakati wa kukimbia vyombo**. Ina default kwa seti ya uwezo ya msingi.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Kimbia chombo katika hali ya kuwa na mamlaka. Mchakato katika vyombo vilivyo na mamlaka ni **sawa na root kwenye mwenyeji**. Ina default kuwa ni uongo.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount inaashiria **aina ya proc mount ya kutumia kwa vyombo**. Chaguo la msingi ni DefaultProcMount ambayo hutumia mipangilio ya msingi ya runtime ya chombo kwa njia za kusoma tu na njia zilizofichwa.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Ikiwa **chombo hiki kina mfumo wa mizizi wa kusoma tu**. Chaguo la msingi ni uongo.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | **GID ya kukimbia kuingia** ya mchakato wa chombo. Inatumia chaguo la runtime ikiwa halijaainishwa.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Inaonyesha kuwa chombo lazima **kikimbie kama mtumiaji asiye na mizizi**. Ikiwa ni kweli, Kubelet itathibitisha picha wakati wa runtime ili kuhakikisha kuwa haikimbi kama UID 0 (mizizi) na itashindwa kuanza chombo ikiwa itakimbia.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | **UID ya kukimbia kuingia** ya mchakato wa chombo. Chaguo la msingi ni mtumiaji aliyeainishwa katika metadata ya picha ikiwa haijaainishwa.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Maelezo zaidi kuhusu</em> <em><strong>seLinux</strong></em></p> | **Muktadha wa SELinux utakaotumiwa kwa chombo**. Ikiwa haijaainishwa, runtime ya chombo itatenga muktadha wa SELinux wa kubahatisha kwa kila chombo.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | **chaguo za seccomp** za kutumia na chombo hiki.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | **Mipangilio maalum ya Windows** inayotumiwa kwa vyombo vyote.                                                                                                                                                                                                                                                              |

## Marejeo

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

<details>

<summary><strong>Jifunze kuhusu kuvamia AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au **kikundi cha** [**telegram**](https://t.me/peass) au **nifuata** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Shiriki mbinu zako za kuvamia kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
