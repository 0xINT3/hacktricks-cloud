# Durcissement de Kubernetes

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts Github.**

</details>

## Outils

### Kubescape

[**Kubescape**](https://github.com/armosec/kubescape) est un outil open-source K8s fournissant une vue unique multi-cloud K8s, comprenant l'analyse des risques, la conformit√© de s√©curit√©, le visualiseur RBAC et la num√©risation des vuln√©rabilit√©s d'image. Kubescape analyse les clusters K8s, les fichiers YAML et les charts HELM, d√©tectant les mauvaises configurations selon plusieurs cadres (tels que le [NSA-CISA](https://www.armosec.io/blog/kubernetes-hardening-guidance-summary-by-armo), [MITRE ATT\&CK¬Æ](https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/)), les vuln√©rabilit√©s logicielles et les violations RBAC (contr√¥le d'acc√®s bas√© sur les r√¥les) aux premiers stades du pipeline CI/CD, calcule le score de risque instantan√©ment et montre les tendances de risque au fil du temps.

### Kube-bench

L'outil [**kube-bench**](https://github.com/aquasecurity/kube-bench) est un outil qui v√©rifie si Kubernetes est d√©ploy√© de mani√®re s√©curis√©e en ex√©cutant les v√©rifications document√©es dans le [**CIS Kubernetes Benchmark**](https://www.cisecurity.org/benchmark/kubernetes/).\
Vous pouvez choisir de :

* ex√©cuter kube-bench √† partir d'un conteneur (partageant l'espace de noms PID avec l'h√¥te)
* ex√©cuter un conteneur qui installe kube-bench sur l'h√¥te, puis ex√©cuter kube-bench directement sur l'h√¥te
* installer les derniers binaires √† partir de la [page des versions](https://github.com/aquasecurity/kube-bench/releases),
* le compiler √† partir des sources.

### Kubeaudit

L'outil [**kubeaudit**](https://github.com/Shopify/kubeaudit) est un outil en ligne de commande et un package Go pour **auditer les clusters Kubernetes** pour diverses pr√©occupations de s√©curit√© diff√©rentes.

Kubeaudit peut d√©tecter s'il s'ex√©cute dans un conteneur dans un cluster. Si c'est le cas, il essaiera d'auditer toutes les ressources Kubernetes dans ce cluster :

```
kubeaudit all
```

Cet outil dispose √©galement de l'argument `autofix` pour **corriger automatiquement les probl√®mes d√©tect√©s.**

### **Popeye**

[**Popeye**](https://github.com/derailed/popeye) est un utilitaire qui analyse le cluster Kubernetes en direct et **signale les probl√®mes potentiels avec les ressources et les configurations d√©ploy√©es**. Il nettoie votre cluster en fonction de ce qui est d√©ploy√© et non de ce qui est stock√© sur le disque. En analysant votre cluster, il d√©tecte les mauvaises configurations et vous aide √† vous assurer que les meilleures pratiques sont en place, √©vitant ainsi les maux de t√™te futurs. Il vise √† r√©duire la surcharge cognitive √† laquelle on est confront√© lors de l'exploitation d'un cluster Kubernetes dans la nature. De plus, si votre cluster utilise un serveur de m√©triques, il signale les allocations de ressources potentielles en exc√®s ou en d√©faut et tente de vous avertir si votre cluster manque de capacit√©.

### **Kicks**

[**KICS**](https://github.com/Checkmarx/kics) trouve des **vuln√©rabilit√©s de s√©curit√©**, des probl√®mes de conformit√© et des erreurs de configuration d'infrastructure dans les solutions suivantes d'**Infrastructure as Code** : Terraform, Kubernetes, Docker, AWS CloudFormation, Ansible, Helm, Microsoft ARM et les sp√©cifications OpenAPI 3.0.

### Checkov

[**Checkov**](https://github.com/bridgecrewio/checkov) est un outil d'analyse de code statique pour l'infrastructure en tant que code.

Il analyse l'infrastructure cloud provisionn√©e √† l'aide de [Terraform](https://terraform.io), Terraform plan, [Cloudformation](https://aws.amazon.com/cloudformation/), [AWS SAM](https://aws.amazon.com/serverless/sam/), [Kubernetes](https://kubernetes.io), [Dockerfile](https://www.docker.com), [Serverless](https://www.serverless.com) ou [ARM Templates](https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview) et d√©tecte les erreurs de configuration de s√©curit√© et de conformit√© √† l'aide d'une analyse bas√©e sur un graphique.

### **Surveillance avec Falco**

{% content-ref url="monitoring-with-falco.md" %}
[monitoring-with-falco.md](monitoring-with-falco.md)
{% endcontent-ref %}

## Conseils

### Kubernetes PodSecurityContext et SecurityContext

Vous pouvez configurer le **contexte de s√©curit√© des Pods** (avec _PodSecurityContext_) et des **conteneurs** qui vont √™tre ex√©cut√©s (avec _SecurityContext_). Pour plus d'informations, lisez :

{% content-ref url="kubernetes-securitycontext-s.md" %}
[kubernetes-securitycontext-s.md](kubernetes-securitycontext-s.md)
{% endcontent-ref %}

### Durcissement de l'API Kubernetes

Il est tr√®s important de **prot√©ger l'acc√®s au serve