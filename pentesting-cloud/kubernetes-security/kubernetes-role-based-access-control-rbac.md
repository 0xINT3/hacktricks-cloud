# Contr√¥le d'acc√®s bas√© sur les r√¥les (RBAC) de Kubernetes

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts Github.**

</details>

## Contr√¥le d'acc√®s bas√© sur les r√¥les (RBAC)

Kubernetes dispose d'un **module d'autorisation nomm√© Contr√¥le d'acc√®s bas√© sur les r√¥les** ([**RBAC**](https://kubernetes.io/docs/reference/access-authn-authz/rbac/)) qui permet de d√©finir les autorisations d'utilisation du serveur API.

Le mod√®le d'autorisation de RBAC est constitu√© de **trois parties distinctes** :

1. **R√¥le/ClusterRole** - La permission r√©elle. Il contient des _**r√®gles**_ qui repr√©sentent un ensemble d'autorisations. Chaque r√®gle contient des [ressources](https://kubernetes.io/docs/reference/kubectl/overview/#resource-types) et des [verbes](https://kubernetes.io/docs/reference/access-authn-authz/authorization/#determine-the-request-verb). Le verbe est l'action qui s'appliquera sur la ressource.
2. **Sujet (utilisateur, groupe ou compte de service)** - L'objet qui recevra les autorisations.
3. **RoleBinding/ClusterRoleBinding** - La connexion entre R√¥le/ClusterRole et le sujet.

![](https://www.cyberark.com/wp-content/uploads/2018/12/rolebiding\_serviceaccount\_and\_role-1024x551.png)

La diff√©rence entre les "**R√¥les**" et les "**ClusterRoles**" r√©side simplement dans l'endroit o√π le r√¥le sera appliqu√© - un "**R√¥le**" accordera l'acc√®s √† un **seul** **espace de noms** **sp√©cifique**, tandis qu'un "**ClusterRole**" peut √™tre utilis√© dans **tous les espaces de noms** du cluster. De plus, les **ClusterRoles** peuvent √©galement accorder l'acc√®s √† :

* des ressources √† **port√©e de cluster** (comme les n≈ìuds).
* des points de terminaison **sans ressource** (comme /healthz).
* des ressources √† port√©e de namespace (comme les Pods), **dans tous les espaces de noms**.

√Ä partir de **Kubernetes** 1.6, les politiques **RBAC** sont **activ√©es par d√©faut**. Mais pour activer RBAC, vous pouvez utiliser quelque chose comme :

```
kube-apiserver --authorization-mode=Example,RBAC --other-options --more-options
```

## Mod√®les

Dans le mod√®le d'un **R√¥le** ou d'un **ClusterRole**, vous devrez indiquer le **nom du r√¥le**, l'**espace de noms** (dans les r√¥les) et ensuite les **apiGroups**, **resources** et **verbs** du r√¥le :

* Les **apiGroups** sont un tableau qui contient les diff√©rentes **espaces de noms API** auxquels cette r√®gle s'applique. Par exemple, une d√©finition de Pod utilise apiVersion: v1. _Il peut avoir des valeurs telles que rbac.authorization.k8s.io ou \[\*]_.
* Les **resources** sont un tableau qui d√©finit **les ressources auxquelles cette r√®gle s'applique**. Vous pouvez trouver toutes les ressources avec : `kubectl api-resources --namespaced=true`
* Les **verbs** sont un tableau qui contient les **verbes autoris√©s**. Le verbe dans Kubernetes d√©finit le **type d'action** que vous devez appliquer √† la ressource. Par exemple, le verbe "list" est utilis√© contre les collections tandis que "get" est utilis√© contre une seule ressource.

### Verbes de r√®gles

(_Ces informations ont √©t√© prises_ [_**ici**_](https://kubernetes.io/docs/reference/access-authn-authz/authorization/#determine-the-request-verb))

| Verbe HTTP | Verbe de requ√™te                                                                                                                                               |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| POST       | create                                                                                                                                                         |
| GET, HEAD  | get (pour les ressources individuelles), list (pour les collections, y compris le contenu complet de l'objet), watch (pour regarder une ressource individuelle ou une collection de ressources) |
| PUT        | update                                                                                                                                                         |
| PATCH      | patch                                                                                                                                                          |
| DELETE     | delete (pour les ressources individuelles), deletecollection (pour les collections)                                                                          |

Kubernetes v√©rifie parfois l'autorisation pour des autorisations suppl√©mentaires en utilisant des verbes sp√©cialis√©s. Par exemple :

* [PodSecurityPolicy](https://kubernetes.io/docs/concepts/policy/pod-security-policy/)
  * verbe `use` sur les ressources `podsecuritypolicies` dans le groupe API `policy`.
* [RBAC](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#privilege-escalation-prevention-and-bootstrapping)
  * verbes `bind` et `escalate` sur les ressources `roles` et `clusterroles` dans le groupe API `rbac.authorization.k8s.io`.
* [Authentication](https://kubernetes.io/docs/reference/access-authn-authz/authentication/)
  * verbe `impersonate` sur les `utilisateurs`, `groupes` et `comptes de service` dans le groupe API de base, et les `userextras` dans le groupe API `authentication.k8s.io`.

{% hint style="warning" %}
Vous pouvez trouver **t