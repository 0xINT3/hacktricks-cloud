# Pentesting Kubernetes Services

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a> <strong>рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

Kubernetes рдХрдИ **рд╡рд┐рд╢рд┐рд╖реНрдЯ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрд╡рд╛рдУрдВ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк **рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЙрдЬрд╛рдЧрд░** рдпрд╛ **рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдкрдиреЗ рдПрдХ рдкреЙрдб рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рд╣реЛ**.

## OSINT рдХреЗ рд╕рд╛рде рдЙрдЬрд╛рдЧрд░ рдкреЙрдбреНрд╕ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛

рдПрдХ рддрд░реАрдХрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ [crt.sh](https://crt.sh) рдореЗрдВ `Identity LIKE "k8s.%.com"` рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░рдирд╛ рддрд╛рдХрд┐ kubernetes рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдЙрдкрдбреЛрдореЗрдиреНрд╕ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ github рдореЗрдВ `"k8s.%.com"` рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░рдирд╛ рдФрд░ **YAML рдлрд╛рдЗрд▓реЛрдВ** рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░рдирд╛ рдЬрд┐рд╕рдореЗрдВ рдпрд╣ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реЛрддреА рд╣реИред

## Kubernetes рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдХреИрд╕реЗ рдЙрдЬрд╛рдЧрд░ рдХрд░рддрд╛ рд╣реИ

рдпрд╣ рдЖрдкрдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рд╕рдордЭреЗрдВ рдХрд┐ Kubernetes рдХреИрд╕реЗ **рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрдЬрд╛рдЧрд░** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдвреВрдВрдв рд╕рдХреЗрдВ:

{% content-ref url="../exposing-services-in-kubernetes.md" %}
[exposing-services-in-kubernetes.md](../exposing-services-in-kubernetes.md)
{% endcontent-ref %}

## рдкреЛрд░реНрдЯ рд╕реНрдХреИрдирд┐рдВрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдЬрд╛рдЧрд░ рдкреЙрдбреНрд╕ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЛрд░реНрдЯреНрд╕ Kubernetes рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдЦреБрд▓реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ:

| рдкреЛрд░реНрдЯ           | рдкреНрд░рдХреНрд░рд┐рдпрд╛      | рд╡рд┐рд╡рд░рдг                                                                    |
| --------------- | -------------- | ------------------------------------------------------------------------ |
| 443/TCP         | kube-apiserver | Kubernetes API рдкреЛрд░реНрдЯ                                                     |
| 2379/TCP        | etcd           |                                                                          |
| 6666/TCP        | etcd           | etcd                                                                     |
| 4194/TCP        | cAdvisor       | рдХрдВрдЯреЗрдирд░ рдореЗрдЯреНрд░рд┐рдХреНрд╕                                                         |
| 6443/TCP        | kube-apiserver | Kubernetes API рдкреЛрд░реНрдЯ                                                     |
| 8443/TCP        | kube-apiserver | Minikube API рдкреЛрд░реНрдЯ                                                       |
| 8080/TCP        | kube-apiserver | рдЕрд╕реБрд░рдХреНрд╖рд┐рдд API рдкреЛрд░реНрдЯ                                                      |
| 10250/TCP       | kubelet        | HTTPS API рдЬреЛ рдкреВрд░реНрдг рдореЛрдб рдПрдХреНрд╕реЗрд╕ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ                          |
| 10255/TCP       | kubelet        | рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ HTTP рдкреЛрд░реНрдЯ: рдкреЙрдбреНрд╕, рдЪрд▓ рд░рд╣реЗ рдкреЙрдбреНрд╕ рдФрд░ рдиреЛрдб рд╕реНрдЯреЗрдЯ |
| 10256/TCP       | kube-proxy     | Kube Proxy рд╕реНрд╡рд╛рд╕реНрдереНрдп рдЬрд╛рдВрдЪ рд╕рд░реНрд╡рд░                                          |
| 9099/TCP        | calico-felix   | Calico рдХреЗ рд▓рд┐рдП рд╕реНрд╡рд╛рд╕реНрдереНрдп рдЬрд╛рдВрдЪ рд╕рд░реНрд╡рд░                                       |
| 6782-4/TCP      | weave          | рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдФрд░ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕                                                  |
| 30000-32767/TCP | NodePort       | рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░реЙрдХреНрд╕реА                                                   |
| 44134/TCP       | Tiller         | Helm рд╕реЗрд╡рд╛ рд╕реБрдирдирд╛                                                          |

### Nmap

{% code overflow="wrap" %}
```bash
nmap -n -T4 -p 443,2379,6666,4194,6443,8443,8080,10250,10255,10256,9099,6782-6784,30000-32767,44134 <pod_ipaddress>/16
```
{% endcode %}

### Kube-apiserver

рдпрд╣ **API Kubernetes рд╕реЗрд╡рд╛** рд╣реИ рдЬрд┐рд╕рд╕реЗ рдкреНрд░рд╢рд╛рд╕рдХ рдЖрдорддреМрд░ рдкрд░ **`kubectl`** рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╛рдд рдХрд░рддреЗ рд╣реИрдВред

**рд╕рд╛рдорд╛рдиреНрдп рдкреЛрд░реНрдЯреНрд╕: 6443 рдФрд░ 443**, рд▓реЗрдХрд┐рди рдорд┐рдиреАрдХреНрдпреВрдм рдореЗрдВ 8443 рдФрд░ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдХреЗ рд▓рд┐рдП 8080 рднреАред

```
curl -k https://<IP Address>:(8|6)443/swaggerapi
curl -k https://<IP Address>:(8|6)443/healthz
curl -k https://<IP Address>:(8|6)443/api/v1
```

**рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдЗрд╕ рд╕реЗрд╡рд╛ рд╕реЗ рдмрд╛рдд рдХрд░рддреЗ рд╣реБрдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдХреНрд░рд┐рдпрд╛рдПрдВ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рджреЗрдЦреЗрдВ:**

{% content-ref url="../kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](../kubernetes-enumeration.md)
{% endcontent-ref %}

### Kubelet API

рдпрд╣ рд╕реЗрд╡рд╛ **рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдиреЛрдб рдореЗрдВ рдЪрд▓рддреА рд╣реИ**ред рдпрд╣ рд╡рд╣ рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ **рдиреЛрдб** рдХреЗ рдЕрдВрджрд░ рдкреЙрдбреНрд╕ рдХреЛ **рдирд┐рдпрдВрддреНрд░рд┐рдд** рдХрд░реЗрдЧреАред рдпрд╣ **kube-apiserver** рд╕реЗ рдмрд╛рдд рдХрд░рддреА рд╣реИред

рдпрджрд┐ рдЖрдкрдХреЛ рдпрд╣ рд╕реЗрд╡рд╛ рдЙрдЬрд╛рдЧрд░ рд╣реЛрддреА рд╣реБрдИ рдорд┐рд▓рддреА рд╣реИ, рддреЛ рдЖрдкрдиреЗ рдПрдХ **рдЕрдкреНрд░рдорд╛рдгрд┐рдд RCE** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

#### Kubelet API

```
curl -k https://<IP address>:10250/metrics
curl -k https://<IP address>:10250/pods
```

рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ `Unauthorized` рд╣реИ, рддреЛ рдЗрд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рдпрджрд┐ рдЖрдк рдиреЛрдбреНрд╕ рдХреА рд╕реВрдЪреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк kubelets рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХреА рд╕реВрдЪреА рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```bash
kubectl get nodes -o custom-columns='IP:.status.addresses[0].address,KUBELET_PORT:.status.daemonEndpoints.kubeletEndpoint.Port' | grep -v KUBELET_PORT | while IFS='' read -r node; do
ip=$(echo $node | awk '{print $1}')
port=$(echo $node | awk '{print $2}')
echo "curl -k --max-time 30 https://$ip:$port/pods"
echo "curl -k --max-time 30 https://$ip:2379/version" #Check  also for etcd
done
```

#### kubelet (рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП)

```
curl -k https://<IP Address>:10255
http://<external-IP>:10255/pods
```

### etcd API

```
curl -k https://<IP address>:2379
curl -k https://<IP address>:2379/version
etcdctl --endpoints=http://<MASTER-IP>:2379 get / --prefix --keys-only
```

### рдЯрд┐рд▓рд░

```
helm --host tiller-deploy.kube-system:44134 version
```

### cAdvisor

рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдПрдХрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╕реЗрд╡рд╛ред

```
curl -k https://<IP Address>:4194
```

### NodePort

рдЬрдм рдХреЛрдИ рдкреЛрд░реНрдЯ рд╕рднреА рдиреЛрдбреНрд╕ рдореЗрдВ рдПрдХ **NodePort** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╡рд╣реА рдкреЛрд░реНрдЯ рд╕рднреА рдиреЛрдбреНрд╕ рдореЗрдВ рдЦреБрд▓ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдЯреНрд░реИрдлрд┐рдХ рдХреЛ рдШреЛрд╖рд┐рдд **Service** рдореЗрдВ рдкреНрд░реЙрдХреНрд╕реАрдлрд╛рдИ рдХрд░рддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрд╣ рдкреЛрд░реНрдЯ **рд░реЗрдВрдЬ 30000-32767** рдореЗрдВ рд╣реЛрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рдирдИ рдЕрдирдЪреЗрдХреНрдб рд╕рд░реНрд╡рд┐рд╕реЗрдЬ рдЙрди рдкреЛрд░реНрдЯреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реБрд▓рдн рд╣реЛ рд╕рдХрддреА рд╣реИрдВред

```
sudo nmap -sS -p 30000-32767 <IP>
```

## рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдорд┐рд╕рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди

### Kube-apiserver рдЕрдирд╛рдо рдПрдХреНрд╕реЗрд╕

**kube-apiserver API рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕** рдкрд░ рдЕрдирд╛рдо рдПрдХреНрд╕реЗрд╕ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИред рд▓реЗрдХрд┐рди рдЖрдк рдХреБрдЫ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![](https://www.cyberark.com/wp-content/uploads/2019/09/Kube-Pen-2-fig-5.png)

### **ETCD рдЕрдирд╛рдо рдПрдХреНрд╕реЗрд╕ рдХреА рдЬрд╛рдВрдЪ**

ETCD рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╕реАрдХреНрд░реЗрдЯреНрд╕, рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдлрд╛рдЗрд▓реНрд╕ рдФрд░ рдЕрдзрд┐рдХ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛** рд╕реНрдЯреЛрд░ рдХрд░рддрд╛ рд╣реИред **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд░реВрдк рд╕реЗ, ETCD рдХреЛ **рдЕрдирд╛рдо рд░реВрдк рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдирд╣реАрдВ** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рд╣рдореЗрд╢рд╛ рдЕрдЪреНрдЫрд╛ рд╣реЛрддрд╛ рд╣реИред

рдпрджрд┐ ETCD рдХреЛ рдЕрдирд╛рдо рд░реВрдк рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ [**etcdctl**](https://github.com/etcd-io/etcd/blob/master/etcdctl/READMEv2.md) **рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдкрдбрд╝ рд╕рдХрддрд╛ рд╣реИ**ред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рд╕реЗ рд╕рднреА рдХреАрдЬрд╝ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ:

```
etcdctl --endpoints=http://<MASTER-IP>:2379 get / --prefix --keys-only
```

### **Kubelet RCE**

[**Kubelet рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг**](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/) рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЧреБрдордирд╛рдо рдкрд╣реБрдБрдЪ** рд╕реЗрд╡рд╛ рдХреЛ **рдЕрдиреБрдорддрд┐ рд╣реИ:**

> Kubelet рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП рдЧреБрдордирд╛рдо рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИред рдЬреЛ рдЕрдиреБрд░реЛрдз рдЕрдиреНрдп рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐ рджреНрд╡рд╛рд░рд╛ рдЕрд╕реНрд╡реАрдХреГрдд рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рдЧреБрдордирд╛рдо рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рдЧреБрдордирд╛рдо рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо `system:anonymous` рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдПрдХ рд╕рдореВрд╣ рдирд╛рдо `system:unauthenticated` рд╣реЛрддрд╛ рд╣реИ

**Kuebelet API рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдЕрдзрд┐рдХрд╛рд░реАрдХрд░рдг рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ** рдЗрд╕реЗ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рджреЗрдЦреЗрдВ:

{% content-ref url="kubelet-authentication-and-authorization.md" %}
[kubelet-authentication-and-authorization.md](kubelet-authentication-and-authorization.md)
{% endcontent-ref %}

**Kubelet** рд╕реЗрд╡рд╛ **API рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХреГрдд рдирд╣реАрдВ рд╣реИ**, рд▓реЗрдХрд┐рди рд╕реНрд░реЛрдд рдХреЛрдб рдпрд╣рд╛рдБ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдЬрд╛рдЧрд░ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХреЛ рдвреВрдБрдврдирд╛ **рдЪрд▓рд╛рдиреЗ рдЬрд┐рддрдирд╛ рдЖрд╕рд╛рди рд╣реИ**:

```bash
curl -s https://raw.githubusercontent.com/kubernetes/kubernetes/master/pkg/kubelet/server/server.go | grep 'Path("/'

Path("/pods").
Path("/run")
Path("/exec")
Path("/attach")
Path("/portForward")
Path("/containerLogs")
Path("/runningpods/").
```

рд╕рднреА рджрд┐рд▓рдЪрд╕реНрдк рд▓рдЧрддреЗ рд╣реИрдВред

рдЖрдк [**Kubeletctl**](https://github.com/cyberark/kubeletctl) рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ Kubelets рдФрд░ рдЙрдирдХреЗ endpoints рд╕реЗ рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

#### /pods

рдпрд╣ endpoint pods рдФрд░ рдЙрдирдХреЗ containers рдХреА рд╕реВрдЪреА рджрд┐рдЦрд╛рддрд╛ рд╣реИ:

```bash
kubeletctl pods
```

#### /exec

рдпрд╣ рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХрд┐рд╕реА рднреА рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдмрд╣реБрдд рдЖрд╕рд╛рдиреА рд╕реЗ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ:

```bash
kubeletctl exec [command]
```

{% hint style="info" %}
рдЗрд╕ рд╣рдорд▓реЗ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП _**kubelet**_ рд╕реЗрд╡рд╛ рдХреЛ `--anonymous-auth false` рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рд╕реЗрд╡рд╛ рдХреЛ рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрддрд░ рдкрд░ рдЕрд▓рдЧ рдХрд░ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред
{% endhint %}

### **Kubelet (Read Only Port) рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЕрдирд╛рд╡рд░рдг рдХреА рдЬрд╛рдБрдЪ**

рдЬрдм **kubelet read-only port** рдЙрдЬрд╛рдЧрд░ рд╣реЛрддрд╛ рд╣реИ, рд╣рдорд▓рд╛рд╡рд░ API рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рд╕реЗ **рдХреНрд▓рд╕реНрдЯрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рддрддреНрд╡, рдЬреИрд╕реЗ рдХрд┐ рдкреЙрдбреНрд╕ рдХреЗ рдирд╛рдо, рдЖрдВрддрд░рд┐рдХ рдлрд╛рдЗрд▓реЛрдВ рдХрд╛ рд╕реНрдерд╛рди рдФрд░ рдЕрдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдЙрдЬрд╛рдЧрд░ рд╣реЛрддреЗ рд╣реИрдВред рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдЗрд╕реЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЙрдЬрд╛рдЧрд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рджреВрд░рд╕реНрде рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ URL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ: `http://<external-IP>:10255/pods`

![](https://www.cyberark.com/wp-content/uploads/2019/09/KUbe-Pen-2-fig-6.png)

## рд╕рдВрджрд░реНрдн

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-2" %}

{% embed url="https://labs.f-secure.com/blog/attacking-kubernetes-through-kubelet" %}

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a> <strong>рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВред

</details>
