# Pentesting Kubernetes Services

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

Kubernetes utiliza v√°rios **servi√ßos de rede espec√≠ficos** que voc√™ pode encontrar **expostos √† Internet** ou em uma **rede interna uma vez que voc√™ tenha comprometido um pod**.

## Encontrando pods expostos com OSINT

Uma maneira pode ser procurando por `Identity LIKE "k8s.%.com"` em [crt.sh](https://crt.sh) para encontrar subdom√≠nios relacionados ao kubernetes. Outra maneira pode ser buscar `"k8s.%.com"` no github e procurar por **arquivos YAML** contendo a string.

## Como o Kubernetes Exp√µe Servi√ßos

Pode ser √∫til para voc√™ entender como o Kubernetes pode **expor servi√ßos publicamente** para encontr√°-los:

{% content-ref url="../exposing-services-in-kubernetes.md" %}
[exposing-services-in-kubernetes.md](../exposing-services-in-kubernetes.md)
{% endcontent-ref %}

## Encontrando pods expostos via varredura de portas

As seguintes portas podem estar abertas em um cluster Kubernetes:

| Porta           | Processo       | Descri√ß√£o                                                                         |
| --------------- | -------------- | --------------------------------------------------------------------------------- |
| 443/TCP         | kube-apiserver | Porta da API Kubernetes                                                           |
| 2379/TCP        | etcd           |                                                                                   |
| 6666/TCP        | etcd           | etcd                                                                              |
| 4194/TCP        | cAdvisor       | M√©tricas de cont√™ineres                                                           |
| 6443/TCP        | kube-apiserver | Porta da API Kubernetes                                                           |
| 8443/TCP        | kube-apiserver | Porta da API Minikube                                                             |
| 8080/TCP        | kube-apiserver | Porta da API insegura                                                             |
| 10250/TCP       | kubelet        | API HTTPS que permite acesso total ao modo                                        |
| 10255/TCP       | kubelet        | Porta HTTP somente leitura n√£o autenticada: pods, pods em execu√ß√£o e estado do n√≥ |
| 10256/TCP       | kube-proxy     | Servidor de verifica√ß√£o de sa√∫de do Kube Proxy                                    |
| 9099/TCP        | calico-felix   | Servidor de verifica√ß√£o de sa√∫de para Calico                                      |
| 6782-4/TCP      | weave          | M√©tricas e endpoints                                                              |
| 30000-32767/TCP | NodePort       | Proxy para os servi√ßos                                                            |
| 44134/TCP       | Tiller         | Servi√ßo Helm escutando                                                            |

### Nmap

{% code overflow="wrap" %}
```bash
nmap -n -T4 -p 443,2379,6666,4194,6443,8443,8080,10250,10255,10256,9099,6782-6784,30000-32767,44134 <pod_ipaddress>/16
```
{% endcode %}
