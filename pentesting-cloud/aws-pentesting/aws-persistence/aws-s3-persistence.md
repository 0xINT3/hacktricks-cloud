# AWS - S3 Persistence

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでのAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**のGitHubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

## S3

詳細については以下をチェックしてください:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### S3 ACL Access Controlを通じて

多くの組織が**S3バケットに機密情報を保存している**ことを知っていると、**これらのバケットへのアクセスを維持する**ことは、組織内での**持続性を維持する**のに十分かもしれません。

[**S3 ACL Access Control**](https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html)は、AWSの機能で、アクセス制御リストを使用して、Identity-basedやResource-basedのIAMポリシーを設定せずに、自分のAWSアカウント外からS3バケットにアクセスを許可することができます。\
多くの組織は、リソースポリシーを介して公開されたS3バケットに対してアラートを出す準備ができているかもしれませんが、バケットやオブジェクトのACLに関連する機能に対するアラートは及ばないかもしれません。さらに、ACLを介して他のアカウントにバケットやオブジェクトリソースを公開するより微妙な設定は、強力なアラート機能を持つ組織であっても検出されない可能性があります。これらの権限を使用すると、制御している他のAWSアカウントにオブジェクト、バケット、およびバケットACLの読み取りまたは書き込みを許可することによって、アクセスを拡張することができます。\
さらに、アクセスはAUTHENTICATED USERSに拡張することができます。これは、AWSが他のAWSアカウントの任意のAWS IAMプリンシパルを記述するために使用する用語です。アクセスはANY USERにも拡張することができます。これは、AWSが認証を必要としない匿名アクセスを記述するために使用する用語です。

### KMS Client-Side Encryption

暗号化プロセスが完了すると、ユーザーはKMS APIを使用して新しいキーを生成します（`aws kms generate-data-key`）、そして生成された暗号化キーをファイルのメタデータ内に保存します（[python code example](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)）。したがって、復号化が行われるときに、再びKMSを使用して復号化することができます。&#x20;

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

したがって、攻撃者はこのキーをメタデータから取得し、KMS（`aws kms decrypt`）で復号化して、情報を暗号化するために使用されたキーを取得することができます。この方法で、攻撃者は暗号化キーを手に入れ、そのキーが他のファイルを暗号化するために再利用される場合、それを使用することができます。

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でゼロからヒーローまでのAWSハッキングを学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**のGitHubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>
