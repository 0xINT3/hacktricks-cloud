# AWS - S3持久化

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版本的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## S3

有关更多信息，请查看：

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### 通过S3 ACL访问控制

了解到许多组织将敏感信息存储在S3存储桶中，保持对这些存储桶的访问权限可能足以在组织内部保持持久性。

[**S3 ACL访问控制**](https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html) 是AWS的一项公认功能，您可以使用访问控制列表来允许来自您自己的AWS帐户之外的地方访问S3存储桶，而无需配置基于身份或基于资源的IAM策略。\
虽然许多组织可能准备通过资源策略对公开的S3存储桶进行警报，但这种警报可能不会扩展到与存储桶或对象ACL相关的功能。此外，通过ACL将存储桶或对象资源暴露给其他帐户的更微妙的配置可能会被组织忽略，即使这些组织具有强大的警报功能。使用这些权限，您可以通过允许您控制的其他AWS帐户读取或写入对象、存储桶和存储桶ACL来**扩展您的访问权限**。\
此外，访问权限还可以扩展到**已认证用户**，这是AWS用于描述任何其他AWS帐户中的AWS IAM主体的术语。访问权限还可以扩展到**任何用户**，这是AWS用于描述不需要身份验证的匿名访问。

### KMS客户端端到端加密

当加密过程完成后，用户将使用KMS API生成一个新密钥（`aws kms generate-data-key`），并将生成的加密密钥存储在文件的元数据中（[Python代码示例](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)），因此在解密时可以再次使用KMS进行解密：&#x20;

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

因此，攻击者可以从元数据中获取此密钥，并使用KMS（`aws kms decrypt`）解密以获取用于加密信息的密钥。这样，攻击者将拥有加密密钥，如果该密钥被重用于加密其他文件，则可以使用该密钥。


<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版本的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>
