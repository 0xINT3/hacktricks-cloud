# AWS - S3永続化

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**最新バージョンのPEASSを入手したり、HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見する
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## S3

詳細については、次を参照してください：

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### S3 ACLアクセス制御を介して

多くの組織が**S3バケットに機密情報を保存**していることを知っているため、**それらのバケットへのアクセスを維持**することは、**組織内での永続性を維持する**ために十分です。

[**S3 ACLアクセス制御**](https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html)は、アクセス制御リストを使用して、Identity-basedまたはResource-based IAMポリシーを設定せずに、**AWSアカウント外部からS3バケットへのアクセスを許可**するAWSの認識された機能です。\
多くの組織は、リソースポリシーを介して公開されたS3バケットに関してアラートを設定しているかもしれませんが、このアラートはバケットまたはオブジェクトACLに関連する機能には適用されない場合があります。さらに、バケットまたはオブジェクトリソースをACLを介して他のアカウントに公開するような微妙な設定は、強力なアラート機能を持つ組織でも検出されない場合があります。これらの権限を使用すると、他のAWSアカウントで制御しているAWSアカウントを読み取りまたは書き込みオブジェクト、バケット、およびバケットACLを許可することができます。\
さらに、アクセスはAUTHENTICATED USERSに拡張することもできます。これは、AWSが他のAWSアカウント内の任意のAWS IAMプリンシパルを説明するために使用する用語です。アクセスは、認証を必要としない匿名アクセスを指すAWSの用語であるANY USERにも拡張できます。

### KMSクライアントサイド暗号化

暗号化プロセスが完了すると、ユーザーはKMS APIを使用して新しいキーを生成します（`aws kms generate-data-key`）し、生成された暗号化キーをファイルのメタデータに**保存**します（[Pythonコードの例](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)）。そのため、復号化が行われると、再びKMSを使用してそれを復号化できます：&#x20;

<figure><img src="../../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

したがって、攻撃者はメタデータからこのキーを取得し、KMSを使用して復号化することで、情報を暗号化するために使用されたキーを取得できます。これにより、攻撃者は暗号化キーを取得し、そのキーが他のファイルの暗号化に再利用される場合、それを使用することができます。


<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**最新バージョンのPEASSを入手したり、HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見する
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
