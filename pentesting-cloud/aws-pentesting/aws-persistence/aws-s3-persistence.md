# AWS - S3 Persistence

<details>

<summary><strong>рдмрдврд╝рд┐рдпрд╛ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ рдлрд╝реЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## S3

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### S3 ACL рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

рдХрдИ рд╕рдВрдЧрдардиреЛрдВ рдХреЗ рдкрд╛рд╕ **S3 рдмрдХреЗрдЯ рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣рд┐рдд рд╣реЛрддреА рд╣реИ**, рдЗрди рдмрдХреЗрдЯреЛрдВ рдХрд╛ **рдПрдХреНрд╕реЗрд╕ рдмрдирд╛рдП рд░рдЦрдирд╛** рд╕рдВрдЧрдарди рдХреЗ рднреАрддрд░ **рд╕реНрдерд╛рдпрд┐рддреНрд╡ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ**ред

[**S3 ACL рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг**](https://docs.aws.amazon.com/AmazonS3/latest/userguide/acl-overview.html) AWS рдХреА рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рддрд╣рдд рдЖрдк рдПрдХ рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг рд╕реВрдЪреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ AWS рдЦрд╛рддреЗ рдХреЗ рдмрд╛рд╣рд░ рд╕реЗ S3 рдмрдХреЗрдЯреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ **рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ** рдмрд┐рдирд╛ рдПрдХ Identity-based рдпрд╛ Resource-based IAM рдиреАрддрд┐ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд┐рдирд╛ред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХрдИ рд╕рдВрдЧрдарди S3 рдмрдХреЗрдЯреЛрдВ рдХреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдмрдирд╛рдиреЗ рдкрд░ рдЪреЗрддрд╛рд╡рдиреА рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдЪреЗрддрд╛рд╡рдиреА рдмрдХреЗрдЯ рдпрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ ACL рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реЗ рдХреНрд╖рдорддрд╛рдУрдВ рддрдХ рдлреИрд▓ рд╕рдХрддреА рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдмрдХреЗрдЯ рдпрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЕрдиреНрдп рдЦрд╛рддреЛрдВ рдХреЛ ACL рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдЬрд╛рдЧрд░ рдХрд░рдиреЗ рд╡рд╛рд▓реА рд╕реВрдХреНрд╖реНрдо рд╡рд┐рдиреНрдпрд╛рд╕ рднреА рд╕рдВрдЧрдардиреЛрдВ рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрдХрд░рдг рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдордЬрдмреВрдд рдЪреЗрддрд╛рд╡рдиреА рдХреНрд╖рдорддрд╛рдУрдВ рд╡рд╛рд▓реЗ рд╕рдВрдЧрдардиреЛрдВ рджреНрд╡рд╛рд░рд╛ рднреАред рдЗрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк **рдЕрдиреНрдп AWS рдЦрд╛рддреЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕, рдмрдХреЗрдЯреНрд╕ рдФрд░ рдмрдХреЗрдЯ ACL рдХреЛ рдкрдврд╝реЗрдВ рдпрд╛ рд▓рд┐рдЦреЗрдВ**ред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдПрдХреНрд╕реЗрд╕ AUTHENTICATED USERS рдХреЗ рд▓рд┐рдП рднреА рдмрдврд╝рд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ AWS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХрд┐рд╕реА рднреА AWS IAM рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рд╡рд░реНрдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП AWS рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдПрдХреНрд╕реЗрд╕ рдХреЛ рдХрд┐рд╕реА рднреА USER рдХреЗ рд▓рд┐рдП рдмрдврд╝рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ AWS рджреНрд╡рд╛рд░рд╛ рдПрдХ рдРрд╕рд╛ рд╢рдмреНрдж рд╣реИ рдЬрд┐рд╕рдХрд╛ рд╡рд░реНрдгрди рдЕрдиреБрдорддрд┐ рдХреЗ рдмрд┐рдирд╛ рдкрд╣рдЪрд╛рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред

### KMS рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди

рдЬрдм рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреВрд░реА рд╣реЛрддреА рд╣реИ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ KMS API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдирдпрд╛ рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ (`aws kms generate-data-key`) рдФрд░ рд╡рд╣ рдлрд╝рд╛рдЗрд▓ рдХреА рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдореЗрдВ рдЙрддреНрдкрдиреНрди рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдХреБрдВрдЬреА рдХреЛ **рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдЧрд╛** ([python code example](https://aioboto3.readthedocs.io/en/latest/cse.html#how-it-works-kms-managed-keys)) рддрд╛рдХрд┐ рдЬрдм рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ KMS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХреЗ:&#x20;

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

рдЗрд╕рд▓рд┐рдП, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╕реЗ рдЗрд╕ рдХреБрдВрдЬреА рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ KMS (`aws kms decrypt`) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдХреЗ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ рдХреБрдВрдЬреА рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рддрд░реАрдХреЗ рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рд╣реЛрдЧреА рдФрд░ рдпрджрд┐ рд╡рд╣ рдХреБрдВрдЬреА рдХреЛ рджреБрдмрд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреНрдп рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдЧрд╛ред

<details>

<summary><strong>рдмрдврд╝рд┐рдпрд╛ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖ
