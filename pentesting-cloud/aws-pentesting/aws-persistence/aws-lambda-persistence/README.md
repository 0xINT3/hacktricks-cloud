# AWS - Lambda Kalıcılığı

<details>

<summary><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamını görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'i takip edin.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek paylaşın.

</details>

## Lambda

Daha fazla bilgi için kontrol edin:

{% content-ref url="../../../aws-security/aws-services/aws-lambda-enum.md" %}
[aws-lambda-enum.md](../../../aws-security/aws-services/aws-lambda-enum.md)
{% endcontent-ref %}

### Lambda Katmanı Kalıcılığı

Lambda yürütüldüğünde, lambda'nın **keyfi kodu yürütmek için bir katmanı tanıtması/arka kapı oluşturması mümkündür**:

{% content-ref url="aws-lambda-layers-persistence.md" %}
[aws-lambda-layers-persistence.md](aws-lambda-layers-persistence.md)
{% endcontent-ref %}

### Lambda Uzantısı Kalıcılığı

Lambda Katmanlarını kötüye kullanarak, lambda içinde kalıcılık sağlamak ve aynı zamanda istekleri çalmak ve değiştirmek de mümkündür.

{% content-ref url="aws-abusing-lambda-extensions.md" %}
[aws-abusing-lambda-extensions.md](aws-abusing-lambda-extensions.md)
{% endcontent-ref %}

### Kaynak politikaları aracılığıyla

Farklı lambda eylemlerine (örneğin, çağırma veya kodu güncelleme) dış hesaplara erişim vermek mümkündür:

<figure><img src="../../../../.gitbook/assets/image (2) (1) (2) (2).png" alt=""><figcaption></figcaption></figure>

### Sürümler, Takma Adlar ve Ağırlıklar

Bir Lambda'nın **farklı sürümleri** olabilir (her sürümde farklı kod).\
Daha sonra, lambda'nın **farklı sürümleriyle farklı takma adlar** oluşturabilir ve her birine farklı ağırlıklar atayabilirsiniz.\
Bu şekilde bir saldırgan, **arka kapılı bir sürüm 1** ve **yalnızca meşru kodu içeren bir sürüm 2** oluşturabilir ve gizli kalmak için isteklerin yalnızca %1'inde **sürüm 1'i yürütebilir**.

<figure><img src="../../../../.gitbook/assets/image (2) (2).png" alt=""><figcaption></figcaption></figure>

### Sürüm Arka Kapısı + API Gateway

1. Lambda'nın orijinal kodunu kopyalayın
2. Orijinal kodu **arka kapı oluşturacak şekilde yeni bir sürüm oluşturun** (veya sadece kötü amaçlı kodla). Bu sürümü $LATEST'e yayınlayın ve dağıtın.
1. Kodu yürütmek için lambda ile ilgili API ağ geçidine çağrı yapın
3. Orijinal kodla yeni bir sürüm oluşturun, bu sürümü $LATEST'e yayınlayın ve dağıtın.
1. Bu, kötü amaçlı kodu önceki bir sürümde gizler
4. API Gateway'e gidin ve **yeni bir POST yöntemi oluşturun** (veya başka bir yöntem seçin) ve arka kapılı lambda'nın çalıştırılacağı: `arn:aws:lambda:us-east-1:<acc_id>:function:<func_name>:1`
1. Arnnin sonundaki :1, **fonksiyonun sürümünü belirten** (bu senaryoda sürüm 1 arka kapılı olan) bir işaret olacaktır.
5. Oluşturulan POST yöntemini seçin ve Eylemler'de **`API'yi Yayınla`** seçeneğini seçin.
6. Şimdi, **POST ile işlevi çağırdığınızda** Arka Kapınız çağrılacaktır.

### Cron/Olay etkinleyici

Lambda işlevlerinin bir şey olduğunda veya belirli bir süre geçtiğinde çalışmasını sağlayabilme özelliği, lambda'yı kalıcılık elde etmek ve tespit edilmekten kaçınmak için güzel ve yaygın bir yol yapar.\
AWS'deki varlığınızı daha gizli hale getirmek için lambda oluşturarak aşağıdaki fikirlere sahip olursunuz.

* Her yeni kullanıcı oluşturulduğunda, lambda yeni bir kullanıcı anahtarı oluşturur ve bunu saldırganın yanına gönderir.
* Her yeni rol oluşturulduğunda, lambda, etkilenen kullanıcılara rolü varsayılan olarak atar.
* Her yeni cloudtrail günlüğü oluşturulduğunda, bunları siler/değiştirir

<details>

<summary><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamını görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'i takip edin.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek paylaşın.

</details>
