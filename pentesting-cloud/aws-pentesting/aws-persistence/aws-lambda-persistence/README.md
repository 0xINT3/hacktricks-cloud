# AWS - Μόνιμη Αντοχή Lambda

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF**, ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στα αποθετήρια [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## Lambda

Για περισσότερες πληροφορίες, ελέγξτε:

{% content-ref url="../../../aws-security/aws-services/aws-lambda-enum.md" %}
[aws-lambda-enum.md](../../../aws-security/aws-services/aws-lambda-enum.md)
{% endcontent-ref %}

### Μόνιμη Αντοχή Επιπέδου Lambda

Είναι δυνατόν να **εισαγάγετε/παρασύρετε ένα επίπεδο για να εκτελέσετε αυθαίρετο κώδικα** όταν η λειτουργία lambda εκτελείται με τρόπο που δεν εντοπίζεται εύκολα:

{% content-ref url="aws-lambda-layers-persistence.md" %}
[aws-lambda-layers-persistence.md](aws-lambda-layers-persistence.md)
{% endcontent-ref %}

### Μόνιμη Αντοχή Επέκτασης Lambda

Χρησιμοποιώντας τα επίπεδα Lambda, είναι επίσης δυνατόν να καταχραστείτε επεκτάσεις και να διατηρήσετε τη λειτουργία lambda, αλλά και να κλέψετε και να τροποποιήσετε αιτήσεις.

{% content-ref url="aws-abusing-lambda-extensions.md" %}
[aws-abusing-lambda-extensions.md](aws-abusing-lambda-extensions.md)
{% endcontent-ref %}

### Μέσω πολιτικών πόρων

Είναι δυνατόν να χορηγηθεί πρόσβαση σε διάφορες ενέργειες λειτουργίας lambda (όπως κλήση ή ενημέρωση κώδικα) σε εξωτερικούς λογαριασμούς:

<figure><img src="../../../../.gitbook/assets/image (2) (1) (2) (2).png" alt=""><figcaption></figcaption></figure>

### Εκδόσεις, Ψευδώνυμα & Βάρη

Μια λειτουργία Lambda μπορεί να έχει **διάφορες εκδόσεις** (με διαφορετικό κώδικα για κάθε έκδοση).\
Στη συνέχεια, μπορείτε να δημιουργήσετε **διάφορα ψευδώνυμα με διάφορες εκδόσεις** της λειτουργίας lambda και να ορίσετε διάφορα βάρη για κάθε έκδοση.\
Με αυτόν τον τρόπο, ένας επιτιθέμενος μπορεί να δημιουργήσει μια **έκδοση 1 με παρασύροντα κώδικα** και μια **έκδοση 2 με μόνο τον νόμιμο κώδικα** και να **εκτελεί μόνο την έκδοση 1 στο 1%** των αιτημάτων για να παραμείνει αόρατος.

<figure><img src="../../../../.gitbook/assets/image (2) (2).png" alt=""><figcaption></figcaption></figure>

### Παρασύροντας Έκδοση + API Gateway

1. Αντιγράψτε τον αρχικό κώδικα της Lambda
2. **Δημιουργήστε μια νέα παρασύροντα έκδοση** του αρχικού κώδικα (ή απλά με κακόβουλο κώδικα). Δημοσιεύστε και **αναπτύξτε αυτήν την έκδοση** στο $LATEST
1. Καλέστε το API gateway που σχετίζεται με τη λειτουργία lambda για να εκτελέσετε τον κώδικα
3. **Δημιουργήστε μια νέα έκδοση με τον αρχικό κώδικα**, Δημοσιεύστε και αναπτύξτε αυτήν την **έκδοση** στο $LATEST.
1. Αυτό θα κρύψει τον παρασύροντα κώδικα σε μια προηγούμενη έκδοση
4. Πηγαίνετε στο API Gateway και **δημιουργήστε μια νέα μέθοδο POST** (ή επιλέξτε οποιαδήποτε άλλη μέθοδο) που θα εκτελεί την παρασύροντα έκδοση της λειτουργίας lambda: `arn:aws:lambda:us-east-1:<acc_id>:function:<func_name>:1`
1. Σημειώστε το τελικό :1 του arn **που υποδηλώνει την έκδοση της λειτουργίας** (η έκδοση 1 θα είναι η παρασύροντα σενάριο).
5. Επιλέξτε τη δημιουργημένη μέθοδο POST και στις Ενέργειες επιλέξτε **`Αναπτύξτε το API`**
6. Τώρα, όταν καλεί
