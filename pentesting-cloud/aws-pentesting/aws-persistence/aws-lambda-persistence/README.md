# AWS - Lambda Persistence

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## Lambda

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="../../../aws-security/aws-services/aws-lambda-enum.md" %}
[aws-lambda-enum.md](../../../aws-security/aws-services/aws-lambda-enum.md)
{% endcontent-ref %}

### Lambda Layer Persistence

рдПрдХ рд▓реЗрдпрд░ рдХреЛ **рдкрд░рд┐рдЪрдп/рдмреИрдХрдбреЛрд░ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рддрд╛рдХрд┐ рдЬрдм рд▓реИрдореНрдмреНрдбрд╛ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдП рддреЛ рдордирдорд╛рдирд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛ** рдПрдХ рдЧреБрдкреНрдд рддрд░реАрдХреЗ рд╕реЗ:

{% content-ref url="aws-lambda-layers-persistence.md" %}
[aws-lambda-layers-persistence.md](aws-lambda-layers-persistence.md)
{% endcontent-ref %}

### Lambda Extension Persistence

Lambda Layers рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ рдХрд╛ рднреА рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдФрд░ рд▓реИрдореНрдмреНрдбрд╛ рдореЗрдВ рд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рд░рд╣рдиреЗ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЪреБрд░рд╛рдирд╛ рдФрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИред

{% content-ref url="aws-abusing-lambda-extensions.md" %}
[aws-abusing-lambda-extensions.md](aws-abusing-lambda-extensions.md)
{% endcontent-ref %}

### рд░рд┐рд╕реЛрд░реНрд╕ рдкреЙрд▓рд┐рд╕реАрдЬ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

рдмрд╛рд╣рд░реА рдЦрд╛рддреЛрдВ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рд▓реИрдореНрдмреНрдбрд╛ рдХреНрд░рд┐рдпрд╛рдУрдВ (рдЬреИрд╕реЗ рдХрд┐ рдЗрдиреНрд╡реЛрдХ рдпрд╛ рдЕрдкрдбреЗрдЯ рдХреЛрдб) рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:

<figure><img src="../../../../.gitbook/assets/image (2) (1) (2) (2).png" alt=""><figcaption></figcaption></figure>

### рд╕рдВрд╕реНрдХрд░рдг, рдЙрдкрдирд╛рдо рдФрд░ рд╡рдЬрди

рдПрдХ Lambda рдореЗрдВ **рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕реНрдХрд░рдг** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ (рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдЕрд▓рдЧ рдХреЛрдб рдХреЗ рд╕рд╛рде).\
рдлрд┐рд░, рдЖрдк рд▓реИрдореНрдмреНрдбрд╛ рдХреЗ **рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рднрд┐рдиреНрди рдЙрдкрдирд╛рдо рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рд╡рдЬрди рджреЗ рд╕рдХрддреЗ рд╣реИрдВред\
рдЗрд╕ рддрд░рд╣ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рдмреИрдХрдбреЛрд░реНрдб рд╕рдВрд╕реНрдХрд░рдг 1** рдФрд░ **рдХреЗрд╡рд▓ рд╡реИрдз рдХреЛрдб рд╡рд╛рд▓рд╛ рд╕рдВрд╕реНрдХрд░рдг 2** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдХреЗрд╡рд▓ 1% рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рд╕рдВрд╕реНрдХрд░рдг 1 рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ рдЧреБрдкреНрдд рд░рд╣ рд╕рдХрддрд╛ рд╣реИред**

<figure><img src="../../../../.gitbook/assets/image (2) (2).png" alt=""><figcaption></figcaption></figure>

### рд╕рдВрд╕реНрдХрд░рдг рдмреИрдХрдбреЛрд░ + API Gateway

1. Lambda рдХреЗ рдореВрд▓ рдХреЛрдб рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдПрдВ
2. рдореВрд▓ рдХреЛрдб рдХреЛ **рдмреИрдХрдбреЛрд░рд┐рдВрдЧ рдХрд░рдХреЗ рдПрдХ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдмрдирд╛рдПрдВ** (рдпрд╛ рдХреЗрд╡рд▓ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдХреЗ рд╕рд╛рде). рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ рдФрд░ рдЙрд╕ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ $LATEST рдкрд░ **рдбрд┐рдкреНрд▓реЙрдп рдХрд░реЗрдВ**
3. рд▓реИрдореНрдмреНрдбрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд API рдЧреЗрдЯрд╡реЗ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛ
4. **рдореВрд▓ рдХреЛрдб рдХреЗ рд╕рд╛рде рдПрдХ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдмрдирд╛рдПрдВ**, рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ рдФрд░ рдЙрд╕ **рд╕рдВрд╕реНрдХрд░рдг** рдХреЛ $LATEST рдкрд░ рдбрд┐рдкреНрд▓реЙрдп рдХрд░реЗрдВред
5. рдЗрд╕рд╕реЗ рдкрд┐рдЫрд▓реЗ рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдмреИрдХрдбреЛрд░реНрдб рдХреЛрдб рдЫрд┐рдк рдЬрд╛рдПрдЧрд╛
6. API Gateway рдкрд░ рдЬрд╛рдПрдВ рдФрд░ **рдПрдХ рдирдпрд╛ POST рдореЗрдердб рдмрдирд╛рдПрдВ** (рдпрд╛ рдХреЛрдИ рдЕрдиреНрдп рдореЗрдердб рдЪреБрдиреЗрдВ) рдЬреЛ рдмреИрдХрдбреЛрд░реНрдб рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓реИрдореНрдмреНрдбрд╛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛: `arn:aws:lambda:us-east-1:<acc_id>:function:<func_name>:1`
7. рдЕрдВрддрд┐рдо :1 рдХрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдЬреЛ arn рдореЗрдВ **рд╕рдВрдХреЗрдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдлрдВрдХреНрд╢рди рдХрд╛ рд╕рдВрд╕реНрдХрд░рдг** (рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ рд╕рдВрд╕реНрдХрд░рдг 1 рдмреИрдХрдбреЛрд░реНрдб рд╣реЛрдЧрд╛)ред
8. рдмрдирд╛рдП рдЧрдП POST рдореЗрдердб рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ Actions рдореЗрдВ **`Deploy API`** рдЪреБрдиреЗрдВ
9. рдЕрдм, рдЬрдм рдЖрдк POST рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлрдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВрдЧреЗ рддреЛ рдЖрдкрдХрд╛ рдмреИрдХрдбреЛрд░ рд╕рдХреНрд░рд┐рдп рд╣реЛ рдЬрд╛рдПрдЧрд╛

### Cron/Event рдПрдХреНрдЪреБрдПрдЯрд░

рдпрд╣ рддрдереНрдп рдХрд┐ рдЖрдк **рд▓реИрдореНрдмреНрдбрд╛ рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЛ рдХреБрдЫ рд╣реЛрдиреЗ рдкрд░ рдпрд╛ рдХреБрдЫ рд╕рдордп рдмреАрддрдиреЗ рдкрд░ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ** рд▓реИрдореНрдмреНрдбрд╛ рдХреЛ рдкрд░реНрд╕рд┐рд╕реНрдЯреЗрдВрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рд╕реЗ рдмрдЪрдиреЗ рдХрд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХрд╛ рдмрдирд╛рддрд╛ рд╣реИред\
рдпрд╣рд╛рдВ рдХреБрдЫ рд╡рд┐рдЪрд╛рд░ рд╣реИрдВ рдЬрд┐рдирд╕реЗ рдЖрдк AWS рдореЗрдВ рдЕрдкрдиреА **рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЛ рдЕрдзрд┐рдХ рдЧреБрдкреНрдд рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рд▓реИрдореНрдмреНрдбрд╛ рдмрдирд╛рдХрд░**ред

* рд╣рд░ рдмрд╛рд░ рдЬрдм рдПрдХ рдирдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рд▓реИрдореНрдмреНрдбрд╛ рдПрдХ рдирдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рднреЗрдЬрддрд╛ рд╣реИред
* рд╣рд░ рдмрд╛рд░ рдЬрдм рдПрдХ рдирдпрд╛ рд░реЛрд▓ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рд▓реИрдореНрдмреНрдбрд╛ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрд╕реНрдпреВрдо рд░реЛрд▓ рдЕрдиреБрдорддрд┐рдпрд╛рдВ рджреЗрддрд╛ рд╣реИред
* рд╣рд░ рдмрд╛рд░ рдЬрдм рдирдП cloudtrail рд▓реЙрдЧ рдЙрддреНрдкрдиреНрди рд╣реЛрддреЗ рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рд╣рдЯрд╛рдПрдВ/рдмрджрд▓реЗрдВ

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
