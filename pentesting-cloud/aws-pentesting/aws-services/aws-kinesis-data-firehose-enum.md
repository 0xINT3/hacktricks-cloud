# AWS - Kinesis Data Firehose Enum

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* If you want to see your **company advertised in HackTricks** or if you want access to the **latest version of the PEASS or download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Kinesis Data Firehose

Amazon Kinesis Data Firehoseは、Amazon Simple Storage Service（Amazon S3）、Amazon Redshift、Amazon OpenSearch Service、Splunk、およびカスタムのHTTPエンドポイントなどの**宛先にリアルタイムのストリーミングデータを配信するための完全に管理されたサービス**です。\
Kinesis Data Firehoseを使用すると、アプリケーションを作成したりリソースを管理したりする必要はありません。データプロデューサーを**構成してデータをKinesis Data Firehoseに送信**し、指定した宛先にデータを**自動的に配信**します。また、Kinesis Data Firehoseを**データを配信する前に変換するように構成**することもできます。

### 列挙
```bash
# Get delivery streams
aws firehose list-delivery-streams

# Get stream info
aws firehose describe-delivery-stream --delivery-stream-name <name>
## Get roles
aws firehose describe-delivery-stream --delivery-stream-name <name> | grep -i RoleARN
```
## ポストエクスプロイテーション / 防御回避

Firehoseがログや防御インサイトの送信に使用されている場合、攻撃者はこれらの機能を使用して正常に動作しないようにすることができます。

### firehose:DeleteDeliveryStream
```
aws firehose delete-delivery-stream --delivery-stream-name <value> --allow-force-delete
```
### firehose:UpdateDestination

このアクションは、指定されたAmazon Kinesis Data Firehose配信ストリームの宛先を更新します。

#### パラメータ

- `DeliveryStreamName`（必須）：更新する配信ストリームの名前。
- `CurrentDeliveryStreamVersionId`（必須）：現在の配信ストリームのバージョンID。
- `DestinationId`（必須）：更新する宛先のID。
- `S3DestinationUpdate`：Amazon S3宛先の更新情報。
- `ExtendedS3DestinationUpdate`：拡張Amazon S3宛先の更新情報。
- `RedshiftDestinationUpdate`：Amazon Redshift宛先の更新情報。
- `ElasticsearchDestinationUpdate`：Amazon Elasticsearch宛先の更新情報。
- `SplunkDestinationUpdate`：Splunk宛先の更新情報。

#### 応答

- `DeliveryStreamARN`：更新された配信ストリームのAmazonリソース名（ARN）。
- `ResponseMetadata`：リクエストのメタデータ。

#### 例

##### リクエスト

```python
response = client.update_destination(
    DeliveryStreamName='example-stream',
    CurrentDeliveryStreamVersionId='1',
    DestinationId='example-destination',
    S3DestinationUpdate={
        'RoleARN': 'arn:aws:iam::123456789012:role/firehose_delivery_role',
        'BucketARN': 'arn:aws:s3:::example-bucket',
        'Prefix': 'example-prefix',
        'BufferingHints': {
            'SizeInMBs': 128,
            'IntervalInSeconds': 300
        },
        'CompressionFormat': 'UNCOMPRESSED',
        'EncryptionConfiguration': {
            'NoEncryptionConfig': 'NoEncryption'
        },
        'CloudWatchLoggingOptions': {
            'Enabled': True,
            'LogGroupName': 'example-log-group',
            'LogStreamName': 'example-log-stream'
        }
    }
)
```

##### レスポンス

```python
{
    'DeliveryStreamARN': 'arn:aws:firehose:us-west-2:123456789012:deliverystream/example-stream',
    'ResponseMetadata': {
        'RequestId': '12345678-1234-1234-1234-123456789012',
        'HTTPStatusCode': 200,
        'HTTPHeaders': {
            'x-amzn-requestid': '12345678-1234-1234-1234-123456789012',
            'content-type': 'application/x-amz-json-1.1',
            'content-length': '1234',
            'date': 'Thu, 01 Jan 1970 00:00:00 GMT'
        },
        'RetryAttempts': 0
    }
}
```
```
aws firehose update-destination --delivery-stream-name <value> --current-delivery-stream-version-id <value> --destination-id <value>
```
### firehose:PutRecord | firehose:PutRecordBatch

これらのアクションは、Amazon Kinesis Data Firehoseに対して実行できるものです。`firehose:PutRecord`アクションは、単一のレコードをFirehoseストリームに書き込むために使用されます。`firehose:PutRecordBatch`アクションは、複数のレコードを一括でFirehoseストリームに書き込むために使用されます。
```
aws firehose put-record --delivery-stream-name my-stream --record '{"Data":"SGVsbG8gd29ybGQ="}'

aws firehose put-record-batch --delivery-stream-name my-stream --records file://records.json
```
## 参考文献

* [https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html](https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html)

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もしもあなたの**会社をHackTricksで宣伝したい**場合や、**最新版のPEASSを入手したい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **HackTricks**と**HackTricks Cloud**のgithubリポジトリにPRを提出して、あなたのハッキングトリックを共有してください。

</details>
