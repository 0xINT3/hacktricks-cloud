# AWS - Kinesis Data Firehose 枚举

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>

## Kinesis Data Firehose

Amazon Kinesis Data Firehose 是一个**全管理的服务，用于将实时**[**流数据**](http://www.amazonaws.cn/streaming-data/) **传送到目标**，例如 Amazon Simple Storage Service (Amazon S3)、Amazon Redshift、Amazon OpenSearch Service、Splunk 和任何自定义的 HTTP 终端点。\
使用 Kinesis Data Firehose，您无需编写应用程序或管理资源。您只需**配置数据生成器**将数据发送到 Kinesis Data Firehose，它将**自动将数据传送到指定的目标**。您还可以配置 Kinesis Data Firehose **在传送数据之前对其进行转换**。

### 枚举
```bash
# Get delivery streams
aws firehose list-delivery-streams

# Get stream info
aws firehose describe-delivery-stream --delivery-stream-name <name>
## Get roles
aws firehose describe-delivery-stream --delivery-stream-name <name> | grep -i RoleARN
```
## 后渗透/防御绕过

如果Firehose用于发送日志或防御洞察，攻击者可以利用这些功能来阻止其正常工作。

### firehose:DeleteDeliveryStream
```
aws firehose delete-delivery-stream --delivery-stream-name <value> --allow-force-delete
```
### firehose:UpdateDestination

#### Description

The `firehose:UpdateDestination` action allows you to update the specified delivery stream destination. This action can be used to modify the destination configuration, such as the S3 bucket or the data transformation settings.

#### Required Permissions

To perform the `firehose:UpdateDestination` action, the user must have the following permissions:

- `firehose:UpdateDestination` on the specified delivery stream.

#### Usage

```bash
aws firehose update-destination \
    --delivery-stream-name <delivery-stream-name> \
    --current-delivery-stream-version-id <current-delivery-stream-version-id> \
    --destination-id <destination-id> \
    --s3-destination-configuration <s3-destination-configuration> \
    --extended-s3-destination-configuration <extended-s3-destination-configuration> \
    --redshift-destination-configuration <redshift-destination-configuration> \
    --elasticsearch-destination-configuration <elasticsearch-destination-configuration> \
    --splunk-destination-configuration <splunk-destination-configuration> \
    --http-destination-configuration <http-destination-configuration> \
    --open-xray-destination-configuration <open-xray-destination-configuration> \
    --processing-configuration <processing-configuration> \
    --cloudwatch-logging-options <cloudwatch-logging-options> \
    --vpc-configuration <vpc-configuration> \
    --http-endpoint-configuration <http-endpoint-configuration> \
    --request-headers <request-headers> \
    --response-headers <response-headers> \
    --request-configuration <request-configuration> \
    --kinesis-streams-destination-configuration <kinesis-streams-destination-configuration> \
    --extended-kinesis-streams-destination-configuration <extended-kinesis-streams-destination-configuration> \
    --elasticsearch-buffering-hints <elasticsearch-buffering-hints> \
    --elasticsearch-retry-options <elasticsearch-retry-options> \
    --s3-buffering-hints <s3-buffering-hints> \
    --s3-retry-options <s3-retry-options> \
    --splunk-retry-options <splunk-retry-options> \
    --http-retry-options <http-retry-options> \
    --buffering-hints <buffering-hints> \
    --retry-options <retry-options> \
    --s3-backup-mode <s3-backup-mode> \
    --s3-backup-configuration <s3-backup-configuration> \
    --data-format-conversion-configuration <data-format-conversion-configuration> \
    --schema-configuration <schema-configuration> \
    --deserializer <deserializer> \
    --serializer <serializer> \
    --input-format-configuration <input-format-configuration> \
    --output-format-configuration <output-format-configuration> \
    --encryption-configuration <encryption-configuration> \
    --cloudwatch-encryption-configuration <cloudwatch-encryption-configuration> \
    --processing-configuration <processing-configuration> \
    --cloudwatch-logging-options <cloudwatch-logging-options> \
    --vpc-configuration <vpc-configuration> \
    --http-endpoint-configuration <http-endpoint-configuration> \
    --request-headers <request-headers> \
    --response-headers <response-headers> \
    --request-configuration <request-configuration> \
    --kinesis-streams-destination-configuration <kinesis-streams-destination-configuration> \
    --extended-kinesis-streams-destination-configuration <extended-kinesis-streams-destination-configuration> \
    --elasticsearch-buffering-hints <elasticsearch-buffering-hints> \
    --elasticsearch-retry-options <elasticsearch-retry-options> \
    --s3-buffering-hints <s3-buffering-hints> \
    --s3-retry-options <s3-retry-options> \
    --splunk-retry-options <splunk-retry-options> \
    --http-retry-options <http-retry-options> \
    --buffering-hints <buffering-hints> \
    --retry-options <retry-options> \
    --s3-backup-mode <s3-backup-mode> \
    --s3-backup-configuration <s3-backup-configuration> \
    --data-format-conversion-configuration <data-format-conversion-configuration> \
    --schema-configuration <schema-configuration> \
    --deserializer <deserializer> \
    --serializer <serializer> \
    --input-format-configuration <input-format-configuration> \
    --output-format-configuration <output-format-configuration> \
    --encryption-configuration <encryption-configuration> \
    --cloudwatch-encryption-configuration <cloudwatch-encryption-configuration>
```

#### Example

The following command updates the destination configuration for the specified delivery stream:

```bash
aws firehose update-destination \
    --delivery-stream-name my-delivery-stream \
    --current-delivery-stream-version-id 1 \
    --destination-id my-destination \
    --s3-destination-configuration '{"RoleARN": "arn:aws:iam::123456789012:role/firehose-role","BucketARN": "arn:aws:s3:::my-bucket","Prefix": "my-prefix/"}'
```

#### References

- [AWS Documentation: UpdateDestination](https://docs.aws.amazon.com/firehose/latest/APIReference/API_UpdateDestination.html)
```
aws firehose update-destination --delivery-stream-name <value> --current-delivery-stream-version-id <value> --destination-id <value>
```
### firehose:PutRecord | firehose:PutRecordBatch

#### 描述

`firehose:PutRecord`和`firehose:PutRecordBatch`是用于将数据记录发送到Amazon Kinesis Data Firehose的AWS Identity and Access Management (IAM)权限。

#### 潜在风险

攻击者可能会滥用这些权限来发送恶意数据记录，导致数据泄露或服务中断。

#### 建议

为了减轻潜在风险，建议采取以下措施：

- 限制对这些权限的访问，仅授予必要的用户或角色。
- 定期审查和监控与这些权限相关的活动，以便及时检测和应对任何异常行为。
- 实施数据验证和过滤机制，以防止恶意数据记录的传输。
- 配置适当的日志记录和监控，以便及时发现和调查任何潜在的安全事件。

#### 示例

以下是使用AWS CLI发送数据记录的示例：

```bash
aws firehose put-record --delivery-stream-name my-delivery-stream --record '{"Data":"SGVsbG8gd29ybGQ="}'
```

以下是使用AWS CLI批量发送数据记录的示例：

```bash
aws firehose put-record-batch --delivery-stream-name my-delivery-stream --records '[{"Data":"SGVsbG8gd29ybGQ="},{"Data":"VGhpcyBpcyBhIG5lZWQgdG8gdGV4dA=="}]'
```

#### 参考

- [Amazon Kinesis Data Firehose API Reference](https://docs.aws.amazon.com/firehose/latest/APIReference/API_Operations.html)
```
aws firehose put-record --delivery-stream-name my-stream --record '{"Data":"SGVsbG8gd29ybGQ="}'

aws firehose put-record-batch --delivery-stream-name my-stream --records file://records.json
```
## 参考资料

* [https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html](https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html)

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 PDF 版的 HackTricks，请查看 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)！
* 获取 [**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现我们的独家 [**NFTs**](https://opensea.io/collection/the-peass-family) 集合 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>
