# AWS - Enumeración de Kinesis Data Firehose

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop).
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>

## Kinesis Data Firehose

Amazon Kinesis Data Firehose es un servicio **totalmente administrado para la entrega de datos en tiempo real** [**de transmisión**](http://www.amazonaws.cn/streaming-data/) **a destinos** como Amazon Simple Storage Service (Amazon S3), Amazon Redshift, Amazon OpenSearch Service, Splunk y cualquier punto final HTTP personalizado.\
Con Kinesis Data Firehose, no es necesario escribir aplicaciones ni administrar recursos. **Configuras tus productores de datos** para enviar datos a Kinesis Data Firehose, y este **entrega automáticamente los datos al destino** que especificaste. También puedes configurar Kinesis Data Firehose **para transformar tus datos antes de entregarlos**.

### Enumeración
```bash
# Get delivery streams
aws firehose list-delivery-streams

# Get stream info
aws firehose describe-delivery-stream --delivery-stream-name <name>
## Get roles
aws firehose describe-delivery-stream --delivery-stream-name <name> | grep -i RoleARN
```
## Post-explotación / Evadir la defensa

En caso de que firehose se utilice para enviar registros o información de defensa, utilizando estas funcionalidades, un atacante podría evitar que funcione correctamente.

### firehose:DeleteDeliveryStream
```
aws firehose delete-delivery-stream --delivery-stream-name <value> --allow-force-delete
```
### firehose:UpdateDestination

La acción `firehose:UpdateDestination` permite a un usuario actualizar la configuración de un destino en un flujo de datos de Amazon Kinesis Data Firehose. Esto incluye la actualización de la configuración de entrega, como el destino de entrega, el formato de datos y las transformaciones de datos.

#### Sintaxis

El siguiente es un ejemplo de la sintaxis de la política de IAM para permitir la acción `firehose:UpdateDestination`:

```markdown
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "firehose:UpdateDestination",
            "Resource": "arn:aws:firehose:region:account-id:deliverystream/stream-name"
        }
    ]
}
```

#### Descripción

La acción `firehose:UpdateDestination` se utiliza para actualizar la configuración de un destino en un flujo de datos de Amazon Kinesis Data Firehose. Esto puede incluir la actualización del destino de entrega, el formato de datos y las transformaciones de datos.

Para utilizar esta acción, el usuario debe tener permisos de IAM para ejecutarla. Además, el usuario debe especificar el ARN del flujo de datos y el nombre del destino que se va a actualizar.

#### Ejemplo

El siguiente ejemplo muestra cómo utilizar la acción `firehose:UpdateDestination` para actualizar la configuración de un destino en un flujo de datos de Amazon Kinesis Data Firehose:

```markdown
aws firehose update-destination --delivery-stream-name stream-name --current-delivery-stream-version-id version-id --destination-id destination-id --s3-destination-configuration RoleARN=role-arn,BucketARN=bucket-arn,Prefix=prefix
```

En este ejemplo, se utiliza el comando `aws firehose update-destination` para actualizar la configuración de un destino en un flujo de datos de Amazon Kinesis Data Firehose. Se especifica el nombre del flujo de datos, la versión actual del flujo de datos, el ID del destino y la configuración del destino de entrega.
```
aws firehose update-destination --delivery-stream-name <value> --current-delivery-stream-version-id <value> --destination-id <value>
```
### firehose:PutRecord | firehose:PutRecordBatch

El método `firehose:PutRecord` permite a un usuario agregar un solo registro a un flujo de datos de Amazon Kinesis Data Firehose. El registro puede tener un tamaño máximo de 1 MB.

El método `firehose:PutRecordBatch` permite a un usuario agregar múltiples registros a un flujo de datos de Amazon Kinesis Data Firehose en una sola llamada. Cada lote de registros puede tener un tamaño máximo de 4 MB o hasta 500 registros, lo que ocurra primero.

Estos métodos son importantes de tener en cuenta durante una evaluación de seguridad de Amazon Kinesis Data Firehose, ya que pueden ser utilizados para enviar datos maliciosos o sensibles a un flujo de datos. Un atacante podría intentar enviar registros falsificados o manipulados para afectar la integridad de los datos o para realizar un ataque de denegación de servicio.

Durante una prueba de penetración en Amazon Kinesis Data Firehose, es recomendable verificar si se han implementado controles adecuados para prevenir el envío de registros maliciosos o manipulados. También es importante revisar las políticas de acceso y los permisos asignados a los usuarios para asegurarse de que solo se les permita realizar operaciones legítimas en los flujos de datos.
```
aws firehose put-record --delivery-stream-name my-stream --record '{"Data":"SGVsbG8gd29ybGQ="}'

aws firehose put-record-batch --delivery-stream-name my-stream --records file://records.json
```
## Referencias

* [https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html](https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html)

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop).
* Obtén el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>
