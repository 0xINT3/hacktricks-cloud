# AWS - Directory Services / WorkDocs Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## Directory Services

AWS Directory Service for Microsoft Active Directory, AWS Bulutunda bir dizin oluşturmayı, işletmeyi ve ölçeklendirmeyi kolaylaştıran bir yönetilen hizmettir. Gerçek **Microsoft Active Directory** üzerine inşa edilmiştir ve diğer AWS hizmetleriyle sıkı bir şekilde entegre olur, bu da dizinle ilgili iş yüklerinizi ve AWS kaynaklarınızı yönetmeyi kolaylaştırır. AWS Yönetilen Microsoft AD ile mevcut Active Directory kullanıcılarınızı, gruplarınızı ve politikalarınızı AWS kaynaklarınıza erişimi yönetmek için kullanabilirsiniz. Bu, kimlik yönetiminizi basitleştirebilir ve ek kimlik çözümlerine olan ihtiyacı azaltabilir. AWS Yönetilen Microsoft AD ayrıca otomatik yedekleme ve felaket kurtarma yetenekleri sağlar, bu da dizininizin kullanılabilirliğini ve dayanıklılığını sağlamaya yardımcı olur. Genel olarak, AWS Directory Service for Microsoft Active Directory, AWS Bulutunda yönetilen, yüksek kullanılabilirlikli ve ölçeklenebilir bir Active Directory hizmeti sağlayarak zaman ve kaynak tasarrufu yapmanıza yardımcı olabilir.

### Seçenekler

Directory Services, 5 tür dizin oluşturmanıza izin verir:

* **AWS Yönetilen Microsoft AD**: AWS'de yeni bir **Microsoft AD çalıştıracak**. Yönetici şifresini ayarlayabilir ve bir VPC'deki DC'lere erişebilirsiniz.
* **Basit AD**: **Linux-Samba** Active Directory uyumlu sunucusu olacak. Yönetici şifresini ayarlayabilir ve bir VPC'deki DC'lere erişebilirsiniz.
* **AD Bağlayıcısı**: Bulutta herhangi bir bilgiyi önbelleğe almadan, mevcut Microsoft Active Directory'nize yönlendirme dizin istekleri için bir proxy. Bir **VPC** üzerinde dinleyecek ve mevcut AD'ye erişmek için **kimlik bilgilerini** vermeniz gerekecek.
* **Amazon Cognito Kullanıcı Havuzları**: Bu, Cognito Kullanıcı Havuzları ile aynıdır.
* **Cloud Directory**: Bu en basit olanıdır. Kullanmak istediğiniz **şemayı** belirttiğiniz ve kullanıma göre **faturalandırıldığınız** bir **sunucusuz** dizin.

AWS Directory hizmetleri, mevcut yerel Microsoft AD'nizle **senkronize etmenize**, AWS'de **kendi AD'nizi çalıştırmanıza** veya **diğer dizin türleriyle senkronize etmenize** olanak tanır.

### Lab

AWS'de kendi Microsoft AD'nizi oluşturmak için güzel bir öğreticiye buradan ulaşabilirsiniz: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Enumerasyon
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### Giriş

Dizinin **açıklamasında** **`AccessUrl`** alanında bir **alan adı** bulunuyorsa, bir **kullanıcının** muhtemelen **AD kimlik bilgileriyle** bazı **AWS hizmetlerine giriş yapabileceği** anlamına gelir:

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon Yönetim Konsolu)
* `<name>.awsapps.com/start` (IAM Kimlik Merkezi)

### Yetki Yükseltme

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## Kalıcılık

### Bir AD kullanıcısı kullanarak

Bir **AD kullanıcısı**, bir Rolü varsaymak için **AWS yönetim konsoluna erişim** sağlanabilir. **Varsayılan kullanıcı adı Admin**'dir ve AWS konsolundan **şifresi değiştirilebilir**.

Bu nedenle, **Admin'in şifresi değiştirilebilir**, **yeni bir kullanıcı oluşturulabilir** veya bir kullanıcının şifresi değiştirilebilir ve bu kullanıcıya erişimi sürdürmek için bir Rol verilebilir.\
Ayrıca, bir kullanıcıyı AD içinde bir gruba **eklemek** ve bu AD grubuna bir Rol **erişim vermek** de mümkündür (bu kalıcılığı daha gizli hale getirmek için).

### AD paylaşımı (kurbandan saldırgana)

Bir kurbandan saldırgana bir AD ortamı paylaşmak mümkündür. Bu şekilde saldırgan, AD ortamına erişmeye devam edebilecektir.\
Ancak, bu, yönetilen AD'nin paylaşılmasını ve aynı zamanda bir VPC eşleme bağlantısı oluşturulmasını gerektirir.

Bir kılavuz burada bulunabilir: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~AD paylaşımı (saldırgan tarafından kurbanına)~~

Farklı bir AD ortamından kullanıcılara AWS erişimi vermek, bir AWS hesabına mümkün görünmüyor.

## WorkDocs

Amazon Web Services (AWS) WorkDocs, bulut tabanlı bir **dosya depolama ve paylaşım hizmetidir**. AWS'nin bulut bilişim hizmetleri paketinin bir parçasıdır ve kuruluşların dosya ve belgeleri depolamak, paylaşmak ve işbirliği yapmak için güvenli ve ölçeklenebilir bir çözüm sunmak üzere tasarlanmıştır.

AWS WorkDocs, kullanıcıların dosyalarını ve belgelerini yüklemeleri, erişmeleri ve yönetmeleri için web tabanlı bir arayüz sağlar. Ayrıca, sürüm kontrolü, gerçek zamanlı işbirliği ve diğer AWS hizmetleri ve üçüncü taraf araçlarla entegrasyon gibi özellikler sunar.

### Numaralandırma

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Privesc

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>A'dan Z'ye AWS hackleme becerilerini öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI'na**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>
