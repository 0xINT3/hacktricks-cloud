# AWS - Υπηρεσίες Καταλόγου / Εντοπισμός Εργασιακών Εγγράφων

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Υπηρεσίες Καταλόγου

Η υπηρεσία AWS Directory Service για το Microsoft Active Directory είναι μια διαχειριζόμενη υπηρεσία που διευκολύνει τη **δημιουργία, λειτουργία και κλιμάκωση ενός καταλόγου** στο AWS Cloud. Είναι βασισμένη στο πραγματικό **Microsoft Active Directory** και ενσωματώνεται στενά με άλλες υπηρεσίες του AWS, καθιστώντας εύκολη τη διαχείριση των φορτίων εργασίας που εξαρτώνται από τον κατάλογο και των πόρων του AWS. Με το AWS Managed Microsoft AD, μπορείτε να **χρησιμοποιήσετε τους υπάρχοντες** χρήστες, ομάδες και πολιτικές του Active Directory για τη διαχείριση της πρόσβασης στους πόρους του AWS. Αυτό μπορεί να βοηθήσει στην απλοποίηση της διαχείρισης της ταυτότητας σας και στη μείωση της ανάγκης για επιπλέον λύσεις ταυτότητας. Το AWS Managed Microsoft AD παρέχει επίσης αυτόματα αντίγραφα ασφαλείας και δυνατότητες ανάκτησης από καταστροφή, βοηθώντας στη διασφάλιση της διαθεσιμότητας και της ανθεκτικότητας του καταλόγου σας. Συνολικά, η υπηρεσία AWS Directory Service για το Microsoft Active Directory μπορεί να σας βοηθήσει να εξοικονομήσετε χρόνο και πόρους παρέχοντας μια διαχειριζόμενη, υψηλής διαθεσιμότητας και κλιμάκωσης υπηρεσία καταλόγου στο AWS Cloud.

### Επιλογές

Οι Υπηρεσίες Καταλόγου επιτρέπουν τη δημιουργία 5 τύπων καταλόγων:

* **AWS Managed Microsoft AD**: Ο οποίος θα εκτελέσει ένα νέο **Microsoft AD στο AWS**. Θα μπορείτε να ορίσετε τον κωδικό διαχειριστή και να έχετε πρόσβαση στους DCs σε μια VPC.
* **Simple AD**: Ο οποίος θα είναι ένας **Linux-Samba** διακομιστής συμβατός με το Active Directory. Θα μπορείτε να ορίσετε τον κωδικό διαχειριστή και να έχετε πρόσβαση στους DCs σε μια VPC.
* **AD Connector**: Ένας διαμεσολαβητής για την **ανακατεύθυνση αιτημάτων καταλόγου στον υπάρχοντα Microsoft Active Directory** σας χωρίς να αποθηκεύει κάποιες πληροφορίες στο cloud. Θα ακούει σε μια **VPC** και θα χρειαστεί να δώσετε **διαπιστευτήρια για πρόσβαση στον υπάρχοντα AD**.
* **Amazon Cognito User Pools**: Αυτό είναι το ίδιο με τα Cognito User Pools.
* **Cloud Directory**: Αυτό είναι το **απλούστερο**. Ένας **serverless** κατάλογος όπου δηλώνετε το **σχήμα** που θα χρησιμοποιηθεί και χρεώνεστε ανάλογα με τη χρήση.

Οι υπηρεσίες καταλόγου του AWS επιτρέπουν το **συγχρονισμό** με τον υπάρχοντα **on-premises** Microsoft AD σας, την **εκτέλεση του δικού σας** στο AWS ή τον συγχρονισμό με **άλλους τύπους καταλόγων**.

### Εργαστήριο

Εδώ μπορείτε να βρείτε ένα ωραίο εκπαιδευτικό εγχειρίδιο για τη δημιουργία του δικού σας Microsoft AD στο AWS: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Εντοπισμός
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### Σύνδεση

Σημειώστε ότι αν η **περιγραφή** του καταλόγου περιέχει ένα **domain** στο πεδίο **`AccessUrl`**, αυτό συμβαίνει επειδή ένας **χρήστης** μπορεί πιθανότατα να **συνδεθεί** με τα **AD διαπιστευτήριά του** σε ορισμένες **υπηρεσίες AWS**:

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon Management Console)
* `<name>.awsapps.com/start` (IAM Identity Center)

### Ανόδος Προνομίων

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## Μόνιμη Παραμονή

### Χρήση ενός AD χρήστη

Ένας **AD χρήστης** μπορεί να δοθεί **πρόσβαση στον πίνακα διαχείρισης AWS** μέσω ενός ρόλου προς υποθείσει. Το προεπιλεγμένο όνομα χρήστη είναι Admin και είναι δυνατόν να **αλλάξετε τον κωδικό πρόσβασης** από τον πίνακα διαχείρισης AWS.

Επομένως, είναι δυνατόν να **αλλάξετε τον κωδικό πρόσβασης του Admin**, να **δημιουργήσετε ένα νέο χρήστη** ή να **αλλάξετε τον κωδικό πρόσβασης** ενός χρήστη και να του δώσετε έναν ρόλο για να διατηρήσετε την πρόσβαση.\
Είναι επίσης δυνατόν να **προσθέσετε ένα χρήστη σε μια ομάδα μέσα στο AD** και να δώσετε σε αυτήν την ομάδα AD πρόσβαση σε έναν ρόλο (για να καταστήσετε αυτήν τη μόνιμη παραμονή πιο αόρατη).

### Κοινή χρήση AD (από θύμα σε επιτιθέμενο)

Είναι δυνατόν να μοιραστείτε ένα περιβάλλον AD από ένα θύμα σε έναν επιτιθέμενο. Με αυτόν τον τρόπο, ο επιτιθέμενος θα μπορεί να συνεχίσει να έχει πρόσβαση στο περιβάλλον AD.\
Ωστόσο, αυτό συνεπάγεται την κοινή χρήση του διαχειριζόμενου AD και τη δημιουργία μιας σύνδεσης VPC peering.

Μπορείτε να βρείτε έναν οδηγό εδώ: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~Κοινή χρήση AD (από επιτιθέμενο σε θύμα)~~

Δεν φαίνεται δυνατή η χορήγηση πρόσβασης AWS σε χρήστες από διαφορετικό περιβάλλον AD σε έναν λογαριασμό AWS.

## WorkDocs

Το Amazon Web Services (AWS) WorkDocs είναι ένα υπηρεσία αποθήκευσης και κοινής χρήσης αρχείων στον **πληγέντα**. Αποτελεί μέρος της σουίτας υπηρεσιών υπολογιστικού νέφους της AWS και έχει σχεδιαστεί για να παρέχει μια ασφαλή και κλιμακούμενη λύση για τον αποθηκευτικό χώρο, την κοινή χρήση και τη συνεργασία σε αρχεία και έγγραφα για οργανισμούς.

Το AWS WorkDocs παρέχει μια διαδικτυακή διεπαφή για τους χρήστες να ανεβάζουν, να έχουν πρόσβαση και να διαχειρίζονται τα αρχεία και τα έγγραφά τους. Προσφέρει επίσης δυνατότητες όπως έλεγχος εκδόσεων, συνεργασία πραγματικού χρόνου και ενσωμάτωση με άλλες υπηρεσίες της AWS και εργαλεία τρίτων.

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Ανέβασμα δικαιωμάτων

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
