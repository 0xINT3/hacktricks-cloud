# AWS - Directory Services / WorkDocs Enum

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Directory Services

AWS Directory Service za Microsoft Active Directory je upravljana usluga koja olakšava **postavljanje, upravljanje i skaliranje direktorijuma** u AWS oblaku. Izgrađena je na stvarnom **Microsoft Active Directory-u** i čvrsto se integriše sa drugim AWS uslugama, što olakšava upravljanje radnim opterećenjima i AWS resursima koji su svesni direktorijuma. Sa AWS Managed Microsoft AD, možete **koristiti postojeće** korisnike, grupe i politike Active Directory-ja za upravljanje pristupom vašim AWS resursima. Ovo može olakšati upravljanje identitetom i smanjiti potrebu za dodatnim rešenjima za identitet. AWS Managed Microsoft AD takođe pruža automatsko bekapovanje i mogućnosti oporavka od katastrofe, što pomaže u osiguravanju dostupnosti i trajnosti vašeg direktorijuma. Sveukupno, AWS Directory Service za Microsoft Active Directory može vam pomoći da uštedite vreme i resurse pružajući upravljenu, visoko dostupnu i skalabilnu uslugu Active Directory-ja u AWS oblaku.

### Opcije

Directory Services omogućava kreiranje 5 vrsta direktorijuma:

* **AWS Managed Microsoft AD**: Koja će pokrenuti novi **Microsoft AD u AWS-u**. Moći ćete postaviti administratorsku lozinku i pristupiti DC-ovima u VPC-u.
* **Simple AD**: Koja će biti **Linux-Samba** Active Directory–kompatibilni server. Moći ćete postaviti administratorsku lozinku i pristupiti DC-ovima u VPC-u.
* **AD Connector**: Proxy za **preusmeravanje zahteva direktorijuma na postojeći Microsoft Active Directory** bez keširanja bilo kakvih informacija u oblaku. Slušaće u **VPC-u** i morate dati **poverljive podatke za pristup postojećem AD-u**.
* **Amazon Cognito User Pools**: Ovo je isto kao Cognito User Pools.
* **Cloud Directory**: Ovo je **najjednostavniji**. Serverless direktorijum gde navodite **šemu** koju želite koristiti i plaćate prema upotrebi.

AWS Directory services omogućava **sinhronizaciju** sa postojećim **on-premises** Microsoft AD-om, pokretanje sopstvenog u AWS-u ili sinhronizaciju sa **drugim vrstama direktorijuma**.

### Laboratorija

Ovde možete pronaći lep tutorijal za kreiranje sopstvenog Microsoft AD-a u AWS-u: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Enumeracija
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### Prijavljivanje

Imajte na umu da ako **opis** direktorijuma sadrži **domen** u polju **`AccessUrl`**, to znači da **korisnik** verovatno može **da se prijavi** sa svojim **AD akreditivima** na neke **AWS usluge**:

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon Management Console)
* `<name>.awsapps.com/start` (IAM Identity Center)

### Eskalacija privilegija

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## Upornost

### Korišćenje AD korisnika

**AD korisniku** se može dati **pristup preko AWS upravljačke konzole** putem uloge koju preuzima. **Podrazumevano korisničko ime je Admin** i moguće je **promeniti njegovu lozinku** sa AWS konzole.

Stoga je moguće **promeniti lozinku za Admina**, **kreirati novog korisnika** ili **promeniti lozinku** korisnika i dodeliti tom korisniku ulogu kako bi održao pristup.\
Takođe je moguće **dodati korisnika grupi unutar AD** i **dodeliti toj AD grupi pristup ulozi** (da bi se ova upornost više prikrila).

### Deljenje AD (od žrtve ka napadaču)

Moguće je deliti AD okruženje od žrtve ka napadaču. Na ovaj način će napadač moći nastaviti pristupati AD okruženju.\
Međutim, ovo podrazumeva deljenje upravljane AD i takođe stvaranje VPC peering konekcije.

Možete pronaći vodič ovde: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~Deljenje AD (od napadača ka žrtvi)~~

Ne izgleda moguće omogućiti pristup AWS korisnicima iz drugog AD okruženja ka jednom AWS nalogu.

## WorkDocs

Amazon Web Services (AWS) WorkDocs je cloud bazirana usluga za **skladištenje i deljenje fajlova**. Ona je deo AWS paketa cloud računarskih usluga i dizajnirana je da pruži sigurno i skalabilno rešenje za organizacije za skladištenje, deljenje i saradnju na fajlovima i dokumentima.

AWS WorkDocs pruža veb baziranu interfejs za korisnike da otpremaju, pristupaju i upravljaju svojim fajlovima i dokumentima. Takođe nudi funkcije kao što su kontrola verzija, saradnja u realnom vremenu i integracija sa drugim AWS uslugama i alatima trećih strana.

### Enumeracija

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Privesc

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju oglašenu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
