# AWS - Elastic Beanstalk Enum

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Elastic Beanstalk

**Amazon Elastic Beanstalk** √© um servi√ßo totalmente gerenciado que facilita o **deploy, execu√ß√£o e escalonamento de aplica√ß√µes web** e servi√ßos desenvolvidos com Java, .NET, PHP, Node.js, Python, Ruby, Go, Docker, Tomcat em servidores familiares como Apache, Nginx, Passenger e IIS.

Elastic Beanstalk oferece uma maneira simples e flex√≠vel de **fazer o deploy de suas aplica√ß√µes na nuvem AWS**, sem a necessidade de se preocupar com a infraestrutura subjacente. Ele **gerencia automaticamente** os detalhes de **provisionamento** de capacidade, **balanceamento** de carga, **escalonamento** e **monitoramento** da sa√∫de da aplica√ß√£o, permitindo que voc√™ se concentre em escrever e fazer o deploy do seu c√≥digo.

A infraestrutura criada pelo Elastic Beanstalk √© gerenciada por **Grupos de Autoscaling** no **EC2** (com um balanceador de carga). Isso significa que, no final das contas, se voc√™ **comprometer o host**, voc√™ deve saber sobre EC2:

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

Al√©m disso, se Docker for usado, √© poss√≠vel utilizar **ECS**.

{% content-ref url="../../aws-security/aws-services/aws-eks-enum.md" %}
[aws-eks-enum.md](../../aws-security/aws-services/aws-eks-enum.md)
{% endcontent-ref %}

### Aplica√ß√£o & Ambientes

No AWS Elastic Beanstalk, os conceitos de "aplica√ß√£o" e "ambiente" servem a prop√≥sitos diferentes e t√™m pap√©is distintos no processo de deploy.

#### Aplica√ß√£o

* Uma aplica√ß√£o no Elastic Beanstalk √© um **cont√™iner l√≥gico para o c√≥digo-fonte da sua aplica√ß√£o, ambientes e configura√ß√µes**. Ele agrupa diferentes vers√µes do seu c√≥digo de aplica√ß√£o e permite que voc√™ as gerencie como uma √∫nica entidade.
* Ao criar uma aplica√ß√£o, voc√™ fornece um nome e descri√ß√£o, mas nenhum recurso √© provisionado nesta etapa. √â simplesmente uma maneira de organizar e gerenciar seu c√≥digo e recursos relacionados.
* Voc√™ pode ter **m√∫ltiplas vers√µes de aplica√ß√£o** dentro de uma aplica√ß√£o. Cada vers√£o corresponde a um lan√ßamento espec√≠fico do seu c√≥digo, que pode ser implantado em um ou mais ambientes.

#### Ambiente

* Um ambiente √© uma **inst√¢ncia provisionada da sua aplica√ß√£o** executando na infraestrutura AWS. √â **onde o c√≥digo da sua aplica√ß√£o √© implantado e executado**. Elastic Beanstalk provisiona os recursos necess√°rios (por exemplo, inst√¢ncias EC2, balanceadores de carga, grupos de auto-scaling, bancos de dados) com base na configura√ß√£o do ambiente.
* **Cada ambiente executa uma √∫nica vers√£o da sua aplica√ß√£o**, e voc√™ pode ter m√∫ltiplos ambientes para diferentes prop√≥sitos, como desenvolvimento, teste, staging e produ√ß√£o.
* Ao criar um ambiente, voc√™ escolhe uma plataforma (por exemplo, Java, .NET, Node.js, etc.) e um tipo de ambiente (por exemplo, servidor web ou worker). Voc√™ tamb√©m pode personalizar a configura√ß√£o do ambiente para controlar v√°rios aspectos da infraestrutura e configura√ß√µes da aplica√ß√£o.

### 2 tipos de Ambientes

1. **Ambiente de Servidor Web**: √â projetado para **hospedar e servir aplica√ß√µes web e APIs**. Essas aplica√ß√µes normalmente lidam com solicita√ß√µes HTTP/HTTPS recebidas. O ambiente de servidor web provisiona recursos como **inst√¢ncias EC2, balanceadores de carga e grupos de auto-scaling** para lidar com o tr√°fego de entrada, gerenciar a capacidade e garantir a alta disponibilidade da aplica√ß√£o.
2. **Ambiente de Worker**: √â projetado para processar **tarefas de fundo**, que s√£o opera√ß√µes frequentemente demoradas ou que consomem muitos recursos e que n√£o requerem respostas imediatas aos clientes. O ambiente de worker provisiona recursos como **inst√¢ncias EC2 e grupos de auto-scaling**, mas **n√£o possui um balanceador de carga**, j√° que n√£o lida diretamente com solicita√ß√µes HTTP/HTTPS. Em vez disso, consome tarefas de uma **fila do Amazon Simple Queue Service (SQS)**, que atua como um buffer entre o ambiente de worker e as tarefas que ele processa.

### Seguran√ßa

Ao criar um App no Beanstalk, existem 3 op√ß√µes de seguran√ßa muito importantes a escolher:

* **Par de chaves EC2**: Esta ser√° a **chave SSH** que poder√° acessar as inst√¢ncias EC2 executando o app
* **Perfil de inst√¢ncia IAM**: Este √© o **perfil de inst√¢ncia** que as inst√¢ncias ter√£o (**privil√©gios IAM**)
* A fun√ß√£o autogerada √© chamada **`aws-elasticbeanstalk-ec2-role`** e tem alguns acessos interessantes sobre todos os ECS, todos os SQS, DynamoDB elasticbeanstalk e elasticbeanstalk S3 usando as pol√≠ticas gerenciadas pela AWS: [AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier), [AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker), [AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier).
* **Fun√ß√£o de servi√ßo**: Esta √© a **fun√ß√£o que o servi√ßo AWS** usar√° para realizar todas as a√ß√µes necess√°rias. At√© onde eu sei, um usu√°rio regular da AWS n√£o pode acessar essa fun√ß√£o.
* Esta fun√ß√£o gerada pela AWS √© chamada **`aws-elasticbeanstalk-service-role`** e usa as pol√≠ticas gerenciadas pela AWS [AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth) e [AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)

Por padr√£o, **a vers√£o 1 dos metadados est√° desativada**:

<figure><img src="../../../.gitbook/assets/image (18) (1) (2).png" alt=""><figcaption></figcaption></figure>
### Exposi√ß√£o

Os dados do Beanstalk s√£o armazenados em um **S3 bucket** com o seguinte nome: **`elasticbeanstalk-<regi√£o>-<id-conta>`**(se foi criado no console da AWS). Dentro deste bucket, voc√™ encontrar√° o **c√≥digo fonte do aplicativo** carregado.

A **URL** da p√°gina web criada √© **`http://<nome-webapp>-env.<aleat√≥rio>.<regi√£o>.elasticbeanstalk.com/`**

{% hint style="warning" %}
Se voc√™ obtiver **acesso de leitura** ao bucket, poder√° **ler o c√≥digo fonte** e at√© encontrar **credenciais sens√≠veis** nele

se voc√™ obtiver **acesso de escrita** ao bucket, poder√° **modificar o c√≥digo fonte** para **comprometer** o **papel IAM** que o aplicativo est√° usando na pr√≥xima vez que for executado.
{% endhint %}

### Enumera√ß√£o

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
{% endcode %}

### Acesso N√£o Autenticado

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### Persist√™ncia

{% content-ref url="../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### Escalonamento de Privil√©gios

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### P√≥s-Explora√ß√£o

{% content-ref url="../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>Aprenda hacking em AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
