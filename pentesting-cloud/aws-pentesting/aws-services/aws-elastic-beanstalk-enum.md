# AWS - Elastic Beanstalk枚举

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版的HackTricks，请查看[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的账号 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## Elastic Beanstalk

**Amazon Elastic Beanstalk**是一个完全托管的服务，可以轻松地部署、运行和扩展使用Java、.NET、PHP、Node.js、Python、Ruby、Go、Docker、Tomcat等开发的Web应用程序和服务，以及在Apache、Nginx、Passenger和IIS等熟悉的服务器上。

Elastic Beanstalk提供了一种简单灵活的方式，可以将您的应用程序部署到AWS云中，无需担心底层基础设施。它会自动处理容量规划、负载均衡、扩展和应用程序健康监控等细节，让您专注于编写和部署代码。

由Elastic Beanstalk创建的基础设施由EC2中的**自动扩展组**（带有负载均衡器）管理。这意味着，如果您**入侵了主机**，您应该了解EC2的相关知识：

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

此外，如果使用Docker，可以使用**ECS**。

{% content-ref url="../../aws-security/aws-services/aws-eks-enum.md" %}
[aws-eks-enum.md](../../aws-security/aws-services/aws-eks-enum.md)
{% endcontent-ref %}

### 应用程序和环境

在AWS Elastic Beanstalk中，"应用程序"和"环境"的概念在部署过程中具有不同的目的和不同的角色。

#### 应用程序

* Elastic Beanstalk中的应用程序是您的应用程序源代码、环境和配置的**逻辑容器**。它将您的应用程序代码的不同版本组合在一起，并允许您将它们作为单个实体进行管理。
* 创建应用程序时，您提供名称和描述，但此阶段不会**预配任何资源**。它只是一种组织和管理代码及相关资源的方式。
* 您可以在一个应用程序中拥有**多个应用程序版本**。每个版本对应于您的代码的特定发布，可以部署到一个或多个环境中。

#### 环境

* 环境是在AWS基础设施上运行的**应用程序的预配实例**。它是**部署和执行应用程序代码的地方**。Elastic Beanstalk根据环境配置预配必要的资源（例如EC2实例、负载均衡器、自动扩展组、数据库）。
* **每个环境运行一个应用程序版本**，您可以为不同的目的（如开发、测试、暂存和生产）拥有多个环境。
* 创建环境时，您选择一个平台（如Java、.NET、Node.js等）和一个环境类型（如Web服务器或工作器）。您还可以自定义环境配置，以控制基础设施和应用程序设置的各个方面。

### 两种类型的环境

1. **Web服务器环境**：设计用于**托管和提供Web应用程序和API**。这些应用程序通常处理传入的HTTP/HTTPS请求。Web服务器环境预配资源，如**EC2实例、负载均衡器和自动扩展组**，以处理传入的流量，管理容量并确保应用程序的高可用性。
2. **工作器环境**：设计用于处理**后台任务**，这些任务通常是耗时或资源密集型操作，不需要对客户端立即响应。工作器环境预配资源，如**EC2实例和自动扩展组**，但它**没有负载均衡器**，因为它不直接处理HTTP/HTTPS请求。相反，它从**Amazon Simple Queue Service (SQS)队列**中消费任务，该队列充当工作器环境和处理的任务之间的缓冲区。

### 安全性

在Beanstalk中创建应用程序时，有3个非常重要的安全选项可供选择：

* **EC2密钥对**：这将是能够访问运行应用程序的EC2实例的SSH密钥
* **IAM实例配置文件**：这是实例将具有的**实例配置文件**（IAM权限）
* 自动生成的角色称为**`aws-elasticbeanstalk-ec2-role`**，并且具有一些有趣的访问权限，可以访问所有ECS、所有SQS、DynamoDB elasticbeanstalk和elasticbeanstalk S3，使用AWS托管策略：[AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier)、[AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker)、[AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier)。
* **服务角色**：这是AWS服务将用于执行所有所需操作的**角色**。据我所知，普通的AWS用户无法访问该角色。
* AWS生成的此角色称为**`aws-elasticbeanstalk-service-role`**，并使用AWS托管策略[AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth)和[AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)

默认情况下，**禁用元数据版本1**：

<figure><img src="../../../.gitbook/assets/image (18) (1) (2).png" alt=""><figcaption></figcaption></figure>
### 暴露

Beanstalk数据存储在一个名为**`elasticbeanstalk-<region>-<acc-id>`**的**S3存储桶**中（如果是在AWS控制台中创建的）。在这个存储桶中，您将找到上传的**应用程序的源代码**。

创建的网页的**URL**是**`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**

{% hint style="warning" %}
如果您获得了对存储桶的**读取权限**，您可以**读取源代码**，甚至在其中找到**敏感凭据**。

如果您获得了对存储桶的**写入权限**，您可以**修改源代码**以在下次执行时**危害**应用程序正在使用的**IAM角色**。
{% endhint %}

### 枚举

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in "us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1"; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
{% endcode %}

### 未经身份验证的访问

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### 持久性

{% content-ref url="../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### 提权

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### 漏洞利用后

{% content-ref url="../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或 **关注**我在 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>
