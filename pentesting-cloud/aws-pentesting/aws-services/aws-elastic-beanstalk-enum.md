# AWS - Elastic Beanstalk Enum

<details>

<summary><strong>ゼロからヒーローまでAWSハッキングを学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**してください。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有してください。

</details>

## Elastic Beanstalk

**Amazon Elastic Beanstalk**は、Java、.NET、PHP、Node.js、Python、Ruby、Go、Docker、Tomcatなどで開発されたウェブアプリケーションやサービスを**デプロイ、実行、スケール**するのを簡単にする完全に管理されたサービスです。Apache、Nginx、Passenger、IISなどのおなじみのサーバー上で動作します。

Elastic Beanstalkは、AWSクラウドへのアプリケーションの**デプロイ**を簡単かつ柔軟に行う方法を提供し、基盤となるインフラストラクチャについて心配する必要はありません。**自動的に**容量の**プロビジョニング**、負荷**バランシング**、**スケーリング**、アプリケーションの健康**モニタリング**の詳細を処理し、コードの記述とデプロイに集中できます。

Elastic Beanstalkによって作成されたインフラストラクチャは、**Autoscaling**グループによって**EC2**で管理されます（ロードバランサー付き）。つまり、最終的には、ホストを**侵害**した場合、EC2について知っておくべきです：

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

さらに、Dockerが使用されている場合は、**ECS**を使用することが可能です。

{% content-ref url="../../aws-security/aws-services/aws-eks-enum.md" %}
[aws-eks-enum.md](../../aws-security/aws-services/aws-eks-enum.md)
{% endcontent-ref %}

### アプリケーションと環境

AWS Elastic Beanstalkでは、「アプリケーション」と「環境」という概念は異なる目的を持ち、デプロイプロセスで異なる役割を果たします。

#### アプリケーション

* Elastic Beanstalkのアプリケーションは、アプリケーションのソースコード、環境、設定の**論理的なコンテナ**です。異なるバージョンのアプリケーションコードをまとめて、単一のエンティティとして管理できます。
* アプリケーションを作成するとき、名前と説明を提供しますが、この段階ではリソースは**プロビジョニングされません**。これは単にコードと関連リソースを整理し、管理する方法です。
* アプリケーション内には**複数のアプリケーションバージョン**を持つことができます。各バージョンはコードの特定のリリースに対応し、一つ以上の環境にデプロイすることができます。

#### 環境

* 環境は、AWSインフラストラクチャ上で実行されているアプリケーションの**プロビジョニングされたインスタンス**です。ここでアプリケーションコードが**デプロイされ実行されます**。Elastic Beanstalkは、環境設定に基づいて必要なリソース（例：EC2インスタンス、ロードバランサー、オートスケーリンググループ、データベース）をプロビジョニングします。
* **各環境はアプリケーションの単一バージョンを実行します**。開発、テスト、ステージング、本番などの異なる目的のために複数の環境を持つことができます。
* 環境を作成するとき、プラットフォーム（例：Java、.NET、Node.jsなど）と環境タイプ（例：ウェブサーバーまたはワーカー）を選択します。また、インフラストラクチャとアプリケーション設定のさまざまな側面を制御するために環境設定をカスタマイズすることもできます。

### 環境の2種類

1. **ウェブサーバー環境**: ウェブアプリケーションやAPIを**ホストして提供する**ために設計されています。これらのアプリケーションは通常、HTTP/HTTPSリクエストを処理します。ウェブサーバー環境は、トラフィックの処理、容量の管理、アプリケーションの高可用性の確保などを行うために、**EC2インスタンス、ロードバランサー、オートスケーリング**グループなどのリソースをプロビジョニングします。
2. **ワーカー環境**: **バックグラウンドタスク**を処理するために設計されています。これらは、クライアントに即時の応答を必要としない、時間がかかるかリソースを多く消費する操作が多いです。ワーカー環境は、**EC2インスタンスとオートスケーリンググループ**などのリソースをプロビジョニングしますが、HTTP/HTTPSリクエストを直接処理しないため、**ロードバランサーはありません**。代わりに、**Amazon Simple Queue Service (SQS)キュー**からタスクを消費します。これは、ワーカー環境と処理するタスクの間のバッファとして機能します。

### セキュリティ

Beanstalkでアプリを作成する際には、選択する3つの非常に重要なセキュリティオプションがあります：

* **EC2キーペア**: これはアプリを実行しているEC2インスタンスにアクセスできる**SSHキー**です
* **IAMインスタンスプロファイル**: これはインスタンスが持つ**インスタンスプロファイル**です（**IAM権限**）
* 自動生成されたロールは**`aws-elasticbeanstalk-ec2-role`**と呼ばれ、AWS管理ポリシーを使用して、すべてのECS、すべてのSQS、DynamoDB elasticbeanstalk、elasticbeanstalk S3に対して興味深いアクセス権を持っています：[AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier)、[AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker)、[AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier)。
* **サービスロール**: これはAWSサービスが必要なアクションを実行するために使用する**ロール**です。一般的なAWSユーザーはそのロールにアクセスできないと思われます。
* AWSによって生成されたこのロールは**`aws-elasticbeanstalk-service-role`**と呼ばれ、AWS管理ポリシー[AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth)と[AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)を使用します。

デフォルトでは**メタデータバージョン1は無効**です：

<figure><img src="../../../.gitbook/assets/image (18) (1) (2).png" alt=""><figcaption></figcaption></figure>
### 漏洩

Beanstalkのデータは、以下の名前の**S3バケット**に保存されています：**`elasticbeanstalk-<region>-<acc-id>`**（AWSコンソールで作成された場合）。このバケット内には、アップロードされた**アプリケーションのソースコード**が見つかります。

作成されたウェブページの**URL**は**`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**です。

{% hint style="warning" %}
バケットに**読み取りアクセス**を得た場合、**ソースコードを読む**ことができ、**機密クレデンシャル**を見つける可能性があります。

バケットに**書き込みアクセス**を得た場合、次回実行時にアプリケーションが使用している**IAMロール**を**侵害**するために、**ソースコードを変更**することができます。
{% endhint %}

### 列挙

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
### 認証されていないアクセス

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### 永続性

{% content-ref url="../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### 権限昇格

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### 攻撃後の活動

{% content-ref url="../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSのハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**テレグラムグループ**](https://t.me/peass)に参加する、または**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
