# AWS - Elastic Beanstalk 枚举

<details>

<summary><strong>从零开始学习AWS黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在 **HackTricks** 中看到您的**公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## Elastic Beanstalk

**Amazon Elastic Beanstalk** 是一个完全托管的服务，它可以轻松地**部署、运行和扩展**使用Java、.NET、PHP、Node.js、Python、Ruby、Go、Docker开发的Web应用程序和服务，并在Apache、Nginx、Passenger和IIS等熟悉的服务器上运行。

Elastic Beanstalk提供了一种简单灵活的方式，将您的应用程序**部署到AWS云**，而无需担心底层基础设施。它会**自动**处理容量**配置**、负载**均衡**、**扩展**和应用程序健康**监控**的细节，让您可以专注于编写和部署代码。

Elastic Beanstalk创建的基础设施由**EC2**中的**自动扩展**组管理（带有负载均衡器）。这意味着，如果您**攻破了主机**，您应该了解EC2：

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

此外，如果使用了Docker，可以使用**ECS**。

{% content-ref url="../../aws-security/aws-services/aws-eks-enum.md" %}
[aws-eks-enum.md](../../aws-security/aws-services/aws-eks-enum.md)
{% endcontent-ref %}

### 应用程序和环境

在AWS Elastic Beanstalk中，“应用程序”和“环境”的概念服务于不同的目的，并在部署过程中扮演不同的角色。

#### 应用程序

* Elastic Beanstalk中的应用程序是您的应用程序源代码、环境和配置的**逻辑容器**。它将不同版本的应用程序代码组合在一起，允许您将它们作为单个实体进行管理。
* 创建应用程序时，您需要提供一个名称和描述**，但此阶段不会配置任何资源**。它只是组织和管理代码及相关资源的一种方式。
* 您可以在一个应用程序中拥有**多个应用程序版本**。每个版本对应于您代码的特定发布版本，可以部署到一个或多个环境中。

#### 环境

* 环境是在AWS基础设施上运行的应用程序的**配置实例**。它是**部署和执行应用程序代码的地方**。Elastic Beanstalk根据环境配置配置必要的资源（例如，EC2实例、负载均衡器、自动扩展组、数据库）。
* **每个环境运行应用程序的单个版本**，您可以为不同的目的拥有多个环境，例如开发、测试、预发布和生产。
* 创建环境时，您可以选择一个平台（例如，Java、.NET、Node.js等）和环境类型（例如，Web服务器或工作器）。您还可以自定义环境配置，以控制基础设施和应用程序设置的各个方面。

### 两种类型的环境

1. **Web服务器环境**：它旨在**托管和服务Web应用程序和API**。这些应用程序通常处理传入的HTTP/HTTPS请求。Web服务器环境配置资源，如**EC2实例、负载均衡器和自动扩展**组，以处理传入流量、管理容量并确保应用程序的高可用性。
2. **工作器环境**：它旨在处理**后台任务**，这些任务通常是耗时或资源密集型的操作，不需要立即响应客户端。工作器环境配置资源，如**EC2实例和自动扩展组**，但它**没有负载均衡器**，因为它不直接处理HTTP/HTTPS请求。相反，它从**Amazon Simple Queue Service (SQS)队列**中消费任务，该队列充当工作器环境和它处理的任务之间的缓冲。

### 安全性

在Beanstalk中创建应用程序时，有3个非常重要的安全选项可供选择：

* **EC2密钥对**：这将是能够访问运行应用程序的EC2实例的**SSH密钥**
* **IAM实例配置文件**：这是实例将拥有的**实例配置文件**（**IAM权限**）
* 自动生成的角色称为**`aws-elasticbeanstalk-ec2-role`**，它通过AWS管理的策略拥有对所有ECS、所有SQS、DynamoDB elasticbeanstalk和elasticbeanstalk S3的一些有趣的访问权限：[AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier), [AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker), [AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier)。
* **服务角色**：这是**AWS服务**将使用的**角色**，以执行所有需要的操作。据我所知，普通AWS用户无法访问该角色。
* AWS生成的这个角色称为**`aws-elasticbeanstalk-service-role`**，它使用AWS管理的策略 [AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth) 和 [AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)

默认情况下**元数据版本1被禁用**：

<figure><img src="../../../.gitbook/assets/image (18) (1) (2).png" alt=""><figcaption></figcaption></figure>
### 暴露

Beanstalk 数据存储在以下名称的 **S3 桶** 中：**`elasticbeanstalk-<region>-<acc-id>`**（如果是在 AWS 控制台中创建的）。在这个桶里，你会找到上传的**应用程序源代码**。

创建的网页的 **URL** 是 **`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**

{% hint style="warning" %}
如果你获得了桶的**读取权限**，你可以**读取源代码**，甚至在其中找到**敏感凭证**

如果你获得了桶的**写入权限**，你可以**修改源代码**，以**危害**应用程序下次执行时使用的 **IAM 角色**。
{% endhint %}

### 枚举

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
{% endcode %}

### 未经认证的访问

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### 持久性

{% content-ref url="../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### 权限提升

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### 后期利用

{% content-ref url="../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS 红队专家)</strong></a><strong>从零开始学习 AWS 黑客攻击！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您想在 **HackTricks** 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方的 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFT 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享您的黑客技巧。

</details>
