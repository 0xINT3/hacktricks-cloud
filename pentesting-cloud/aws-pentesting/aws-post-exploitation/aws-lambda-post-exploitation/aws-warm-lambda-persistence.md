# AWS - Lambda рдЕрдиреБрд░реЛрдз рдЪреБрд░рд╛рдирд╛

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, рдпрд╛рдиреА [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рд╕реЗ рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рдФрд░ **HackTricks** рдФрд░ **HackTricks Cloud** github рд░реЗрдкреЛ рдореЗрдВ **PR рдЬрдорд╛** рдХрд░рдХреЗред

</details>

## Lambda рдлреНрд▓реЛ

<figure><img src="../../../../.gitbook/assets/image (152).png" alt=""><figcaption><p><a href="https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/lambda_poc_2_arch.png">https://unit42.paloaltonetworks.com/wp-content/uploads/2019/10/lambda_poc_2_arch.png</a></p></figcaption></figure>

1. **Slicer** рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ рдЬреЛ рдХрдВрдЯреЗрдирд░ рдХреЗ рдмрд╛рд╣рд░ рд╣реИ рдЬреЛ **init** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **рдЖрдордВрддреНрд░рдг** рднреЗрдЬрддреА рд╣реИред
2. рдЗрдирд┐рдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреЛрд░реНрдЯ **9001** рдкрд░ рд╕реБрди рд░рд╣реА рд╣реИ рдФрд░ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд░рд╣реА рд╣реИ:
* **`/2018-06-01/runtime/invocation/next`** тАУ рдЕрдЧрд▓реЗ рдЖрдордВрддреНрд░рдг рдШрдЯрдирд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **`/2018-06-01/runtime/invocation/{invoke-id}/response`** тАУ рдЖрдордВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рд╣реИрдВрдбрд▓рд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╡рд╛рдкрд╕ рдХрд░реЗрдВ
* **`/2018-06-01/runtime/invocation/{invoke-id}/error`** тАУ рдПрдХ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рддреНрд░реБрдЯрд┐ рд╡рд╛рдкрд╕ рдХрд░реЗрдВ
3. **bootstrap.py** рдПрдХ рд▓реВрдк рд╣реИ рдЬреЛ рдЗрдирд┐рдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЖрдордВрддреНрд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╣реИрдВрдбрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛрдб рдХреЛ рдмреБрд▓рд╛рддрд╛ рд╣реИ (**`/next`**)ред
4. рдЕрдВрддрддрдГ, **bootstrap.py** рдЗрдирд┐рдЯ рдХреЛ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рднреЗрдЬрддрд╛ рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ bootstrap рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛрдб рдХреЛ рдПрдХ рдореЙрдбреНрдпреВрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЛрдб рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛрдб рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╣реЛ рд░рд╣рд╛ рд╣реИред

## Lambda рдЕрдиреБрд░реЛрдз рдЪреБрд░рд╛рдирд╛

рдЗрд╕ рд╣рдорд▓реЗ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдпрд╣ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛрдб рдХреЛ рдПрдХ рджреБрд░реБрдкрдпреЛрдЧреА **`bootstrap.py`** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛрдб рдХреЛ рджреБрд░реБрдкрдпреЛрдЧреА **`bootstrap.py`** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЕрдВрджрд░ рдЪрд▓рд╛рдПрдВ рдЬреЛ рд╡рд┐рдХрд▓реНрдкрдиреАрдп рдЕрдиреБрд░реЛрдз рдХреЛ рд╣реИрдВрдбрд▓ рдХрд░рддреА рд╣реИред рдЗрд╕ рддрд░рд╣, **рджреБрд░реБрдкрдпреЛрдЧреА bootstrap** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢реБрд░реВ рд╣реЛ рдЬрд╛рдПрдЧреА **init рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдирд╛** рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╣реИрдВрдбрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрдмрдХрд┐ **рд╡рд┐рдзрд┐** bootstrap рджреБрд░реБрдкрдпреЛрдЧреА рдПрдХ рджреМрд░рд╛рди рдлрдВрд╕рд╛ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдпрд╣ init рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдЕрдзрд┐рдХ рдЖрдордВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдкреВрдЫреЗрдЧрд╛ред

рдпрд╣ рдПрдХ рд╕рд░рд▓ рдХрд╛рд░реНрдп рд╣реИ рдЬреИрд╕реЗ рд╣реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдХреЛрдб рд╡рд╛рд╕реНрддрд╡рд┐рдХ **`bootstrap.py`** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛ рд░рд╣рд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП рд╣рдорд▓рд╛рд╡рд░:

* **рд╡рд░реНрддрдорд╛рди рдЖрдордВрддреНрд░рдг рдХреЗ рдирдХрд▓реА рдкрд░рд┐рдгрд╛рдо рдХреЛ init рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рднреЗрдЬреЗрдВ**, рддрд╛рдХрд┐ init рд╕реЛрдЪреЗ рдХрд┐ bootstrap рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрдзрд┐рдХ рдЖрдордВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣реА рд╣реИред
* рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдирд╛ рдЪрд╛рд╣рд┐рдП **`/${invoke-id}/response`**ред
* invoke-id рдХреЛ рд╡рд╛рд╕реНрддрд╡рд┐рдХ **`bootstrap.py`** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕реНрдЯреИрдХ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ [**inspect**](https://docs.python.org/3/library/inspect.html) python рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ (рдЬреИрд╕рд╛ [рдпрд╣рд╛рдБ рд╕реБрдЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ](https://github.com/twistlock/lambda-persistency-poc/blob/master/poc/switch\_runtime.py)) рдпрд╛ рдлрд┐рд░ рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **`/2018-06-01/runtime/invocation/next`** (рдЬреИрд╕рд╛ [рдпрд╣рд╛рдБ рд╕реБрдЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ](https://github.com/Djkusik/serverless\_persistency\_poc/blob/master/gcp/exploit\_files/switcher.py))ред
* рдПрдХ рджреБрд░реБрдкрдпреЛрдЧреА **`boostrap.py`** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ рдЬреЛ рдЕрдЧрд▓реЗ рдЖрдордВрддреНрд░рдгреЛрдВ рдХреЛ рд╣реИрдВрдбрд▓ рдХрд░реЗрдЧреА
* рдЫрд▓рд╛рдкрди рдХреЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд▓реИрдВрдмрдбрд╛ рдЖрдордВрддреНрд░рдг рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреЛ рд╣рдорд▓рд╛рд╡рд░ рдХрдВрдЯреНрд░реЛрд▓ C2 рдХреЛ рднреЗрдЬрдирд╛ рдФрд░ рдлрд┐рд░ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╣реИрдВрдбрд▓ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред
* рдЗрд╕ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдХрд╛рдлреА рд╣реИ рдХрд┐ **`bootstrap.py`** рдХрд╛ рдореВрд▓ рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдП рд╕рд┐рд╕реНрдЯрдо рд╕реЗ, рджреБрд░реБрдкрдпреЛрдЧреА рдХреЛрдб рдЬреЛрдбрд╝рд╛ рдЬрд╛рдП рдФрд░ рд╡рд░реНрддрдорд╛рди рд▓реИрдореНрдмрдбрд╛ рдЖрдордВрддреНрд░рдг рд╕реЗ рдЗрд╕реЗ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдП рдЬрд┐рд╕рдореЗрдВ **`invoke-id`** рдХреЛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПред

### рд╣рдорд▓реЗ рдХреЗ рдЪрд░рдг

## рд╕рдВрджрд░реНрдн

* [https://unit42.paloaltonetworks.com/gaining-persistency-vulnerable-lambdas/](https://unit42.paloaltonetworks.com/gaining-persistency-vulnerable-lambdas/) 

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, рдпрд╛рдиреА [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рд╕реЗ рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рдФрд░ **HackTricks** рдФрд░ **HackTricks Cloud** github рд░реЗрдкреЛ рдореЗрдВ **PR рдЬрдорд╛** рдХрд░рдХреЗред

</details>
