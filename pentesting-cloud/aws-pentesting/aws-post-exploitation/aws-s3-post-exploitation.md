# AWS - Post-exploitation S3

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts Github.**

</details>

## S3

Pour plus d'informations, consultez :

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Informations sensibles

Parfois, vous pourrez trouver des informations sensibles lisibles dans les compartiments. Par exemple, des secrets d'√©tat terraform.

### Pivotement

Diff√©rentes plateformes pourraient utiliser S3 pour stocker des actifs sensibles.\
Par exemple, **airflow** pourrait stocker le **code DAGs** l√†-bas, ou des **pages web** pourraient √™tre directement servies √† partir de S3. Un attaquant disposant de permissions d'√©criture pourrait **modifier le code** du compartiment pour **pivoter** vers d'autres plateformes, ou **prendre le contr√¥le de comptes** en modifiant des fichiers JS.

### Ransomware S3

1. **L'attaquant cr√©e une cl√© KMS** dans son propre compte AWS "personnel" (ou un autre compte compromis) et donne acc√®s "au monde" pour utiliser cette cl√© KMS pour le chiffrement. Cela signifie qu'elle pourrait √™tre utilis√©e par n'importe quel utilisateur/r√¥le/compte AWS pour chiffrer, mais **pas** d√©crypter les objets dans S3.
2. **L'attaquant identifie un compartiment S3 cible et obtient un acc√®s de niveau √©criture**, ce qui est possible par divers moyens diff√©rents. Cela pourrait inclure [une mauvaise configuration des compartiments qui les expose publiquement](https://rhinosecuritylabs.com/penetration-testing/penetration-testing-aws-storage/) ou un [attaquant qui acc√®de √† l'environnement AWS lui-m√™me](https://rhinosecuritylabs.com/penetration-testing/penetration-testing-aws-storage/). Les attaquants cibleraient g√©n√©ralement les compartiments contenant des informations sensibles, telles que les PII, PHI, les journaux, les sauvegardes, etc.
3. **L'attaquant v√©rifie la configuration du compartiment** pour d√©terminer s'il peut √™tre cibl√© par un ransomware. Cela inclurait la v√©rification si la version d'objet S3 est activ√©e et si la suppression d'authentification multifactorielle (MFA delete) est activ√©e. Si la version d'objet n'est pas activ√©e, alors ils sont pr√™ts √† partir. Si la version d'objet est activ√©e, mais que MFA delete est d√©sactiv√©, l'attaquant peut simplement d√©sactiver la version d'objet. Si la version d'objet et MFA delete sont activ√©s, cela n√©cessiterait _beaucoup_ de travail suppl√©mentaire pour pouvoir ransomware ce compartiment sp√©cifique.
4. **L'attaquant utilise l'API AWS pour remplacer chaque objet dans un compartiment par une nouvelle copie de lui-m√™me**, mais cette fois, il est chiffr√© avec la cl√© KMS de l'attaquant.
5. **L'attaquant planifie la suppression de la cl√© KMS** qui a √©t√© utilis√©e pour cette attaque, donnant une fen√™tre de 7 jours √† leur cible jusqu'√† ce que la cl√© soit supprim√©e et que les donn√©es soient perdues pour toujours.
6. **L'attaquant t√©l√©charge un fichier final** tel que "ransom-note.txt" sans chiffrement, qui indique √† la cible comment r√©cup√©rer ses fichiers.

La capture d'√©cran suivante montre un exemple de fichier qui a √©t√© cibl√© pour une attaque de ransomware. Comme vous pouvez le voir, l'ID de compte qui poss√®de la cl√© KMS qui a √©t√© utilis√©e pour chiffrer l'objet (7\*\*\*\*\*\*\*\*\*\*2) est diff√©rent de l'ID de compte du compte qui poss√®de l'objet (2\*\*\*\*\*\*\*\*\*\*1).

![](<../../../.gitbook/assets/image (2) (1) (1) (1).png>)

Ici, vous pouvez [trouver un exemple de ransomware](https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/s3\_ransomware/s3-ransomware-poc.py) qui fait ce qui suit :

1. Rassemble les 100 premiers objets dans le compartiment (ou tous, s'il y a moins de 100 objets dans le compartiment)
2. Un par un, remplace chaque objet par lui-m√™me en utilisant la nouvelle cl√© de chiffrement KMS

Pour plus d'informations, [consultez la recherche originale](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/).

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts Github.**

</details>