# AWS - S3 Post Exploitation

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## S3

Pour plus d'informations, consultez :

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Informations Sensibles

Parfois, vous pourrez trouver des informations sensibles lisibles dans les seaux. Par exemple, les secrets d'√©tat de terraform.

### Pivotement

Diff√©rentes plateformes pourraient utiliser S3 pour stocker des actifs sensibles.\
Par exemple, **airflow** pourrait stocker le **code DAGs** l√†-bas, ou des **pages web** pourraient √™tre directement servies depuis S3. Un attaquant avec des permissions d'√©criture pourrait **modifier le code** du seau pour **pivoter** vers d'autres plateformes, ou **prendre le contr√¥le de comptes** en modifiant des fichiers JS.

### Ransomware S3

1. **L'attaquant cr√©e une cl√© KMS** dans son propre compte AWS "personnel" (ou un autre compte compromis) et donne acc√®s "au monde" pour utiliser cette cl√© KMS pour le chiffrement. Cela signifie qu'elle pourrait √™tre utilis√©e par n'importe quel utilisateur/r√¥le/compte AWS pour chiffrer, mais **pas** pour d√©chiffrer des objets dans S3.
2. **L'attaquant identifie un seau S3 cible et obtient un acc√®s de niveau √©criture √† celui-ci**, ce qui est possible par diff√©rents moyens. Cela pourrait inclure une [mauvaise configuration des seaux qui les expose publiquement](https://rhinosecuritylabs.com/penetration-testing/penetration-testing-aws-storage/) ou un [attaquant obtenant l'acc√®s √† l'environnement AWS lui-m√™me](https://rhinosecuritylabs.com/penetration-testing/penetration-testing-aws-storage/). Typiquement, les attaquants cibleraient des seaux contenant des informations sensibles, telles que des PII, PHI, journaux, sauvegardes, et plus encore.
3. **L'attaquant v√©rifie la configuration du seau** pour d√©terminer s'il peut √™tre cibl√© par un ransomware. Cela inclurait de v√©rifier si la Versioning d'Objet S3 est activ√©e et si la suppression multi-facteurs (MFA delete) est activ√©e. Si le Versioning d'Objet n'est pas activ√©, alors ils sont pr√™ts √† agir. Si le Versioning d'Objet est activ√©, mais que la suppression MFA est d√©sactiv√©e, l'attaquant peut simplement d√©sactiver le Versioning d'Objet. Si le Versioning d'Objet et la suppression MFA sont activ√©s, cela n√©cessiterait _beaucoup_ de travail suppl√©mentaire pour pouvoir ran√ßonner ce seau sp√©cifique.
4. **L'attaquant utilise l'API AWS pour remplacer chaque objet dans un seau par une nouvelle copie de lui-m√™me**, mais cette fois, il est chiffr√© avec la cl√© KMS de l'attaquant.
5. **L'attaquant planifie la suppression de la cl√© KMS** qui a √©t√© utilis√©e pour cette attaque, donnant un d√©lai de 7 jours √† sa cible jusqu'√† ce que la cl√© soit supprim√©e et que les donn√©es soient perdues √† jamais.
6. **L'attaquant t√©l√©charge un dernier fichier** tel que "ransom-note.txt" sans chiffrement, qui instruit la cible sur la mani√®re de r√©cup√©rer ses fichiers.

La capture d'√©cran suivante montre un exemple de fichier qui a √©t√© cibl√© pour une attaque par ransomware. Comme vous pouvez le voir, l'ID de compte qui poss√®de la cl√© KMS qui a √©t√© utilis√©e pour chiffrer l'objet (7\*\*\*\*\*\*\*\*\*\*2) est diff√©rent de l'ID de compte du compte qui poss√®de l'objet (2\*\*\*\*\*\*\*\*\*\*1).

![](<../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png>)

Ici, vous pouvez [trouver un exemple de ransomware](https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/s3\_ransomware/s3-ransomware-poc.py) qui fait ce qui suit :

1. Rassemble les 100 premiers objets dans le seau (ou tous, s'il y a moins de 100 objets dans le seau)
2. Un par un, r√©√©crit chaque objet avec lui-m√™me en utilisant la nouvelle cl√© de chiffrement KMS

Pour plus d'infos [consultez la recherche originale](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/).

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
