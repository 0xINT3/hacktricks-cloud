# AWS - S3 Post Explotaci칩n

<details>

<summary><strong>Aprende hacking de AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## S3

Para m치s informaci칩n revisa:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Informaci칩n Sensible

A veces podr치s encontrar informaci칩n sensible legible en los buckets. Por ejemplo, secretos del estado de terraform.

### Pivoteo

Diferentes plataformas podr칤an estar utilizando S3 para almacenar activos sensibles.\
Por ejemplo, **airflow** podr칤a estar almacenando **c칩digo de DAGs** all칤, o **p치ginas web** podr칤an estar siendo servidas directamente desde S3. Un atacante con permisos de escritura podr칤a **modificar el c칩digo** del bucket para **pivoteo** a otras plataformas, o **tomar control de cuentas** modificando archivos JS.

### Ransomware de S3

En este escenario, el **atacante crea una clave de KMS (Key Management Service) en su propia cuenta de AWS** o en otra cuenta comprometida. Luego hacen esta **clave accesible a cualquier persona en el mundo**, permitiendo a cualquier usuario, rol o cuenta de AWS encriptar objetos usando esta clave. Sin embargo, los objetos no pueden ser desencriptados.

El atacante identifica un **bucket S3 objetivo y obtiene acceso de nivel de escritura** al mismo utilizando varios m칠todos. Esto podr칤a deberse a una mala configuraci칩n del bucket que lo expone p칰blicamente o al atacante obteniendo acceso al entorno de AWS en s칤. El atacante t칤picamente apunta a buckets que contienen informaci칩n sensible como informaci칩n personal identificable (PII), informaci칩n de salud protegida (PHI), registros, copias de seguridad y m치s.

Para determinar si el bucket puede ser objetivo de ransomware, el atacante verifica su configuraci칩n. Esto incluye verificar si **S3 Object Versioning** est치 habilitado y si **multi-factor authentication delete (MFA delete) est치 habilitado**. Si Object Versioning no est치 habilitado, el atacante puede proceder. Si Object Versioning est치 habilitado pero MFA delete est치 deshabilitado, el atacante puede **deshabilitar Object Versioning**. Si tanto Object Versioning como MFA delete est치n habilitados, se vuelve m치s dif칤cil para el atacante aplicar ransomware a ese bucket espec칤fico.

Usando la API de AWS, el atacante **reemplaza cada objeto en el bucket con una copia encriptada usando su clave de KMS**. Esto efectivamente encripta los datos en el bucket, haci칠ndolos inaccesibles sin la clave.

Para aumentar la presi칩n, el atacante programa la eliminaci칩n de la clave de KMS utilizada en el ataque. Esto le da al objetivo una ventana de 7 d칤as para recuperar sus datos antes de que la clave sea eliminada y los datos se pierdan permanentemente.

Finalmente, el atacante podr칤a subir un archivo final, usualmente llamado "ransom-note.txt", que contiene instrucciones para el objetivo sobre c칩mo recuperar sus archivos. Este archivo se sube sin encriptaci칩n, probablemente para llamar la atenci칩n del objetivo y hacerle consciente del ataque de ransomware.

**Para m치s informaci칩n** [**revisa la investigaci칩n original**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

<details>

<summary><strong>Aprende hacking de AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** revisa los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n de [**NFTs exclusivos**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
