# AWS - Secrets Manager 후반 공격

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **HackTricks**와 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하여 자신의 해킹 기법을 공유하세요.

</details>

## Secrets Manager

자세한 정보는 다음을 확인하세요:

{% content-ref url="../../aws-security/aws-services/aws-secrets-manager-enum.md" %}
[aws-secrets-manager-enum.md](../../aws-security/aws-services/aws-secrets-manager-enum.md)
{% endcontent-ref %}

### Secrets 읽기

**Secrets 자체는 민감한 정보**입니다. [privesc 페이지](../../aws-security/aws-privilege-escalation/aws-secrets-manager-privesc.md)를 확인하여 그들을 읽는 방법을 배워보세요.

### DoS 비밀 값 변경

비밀 값을 변경하면 해당 값에 의존하는 모든 시스템을 **DoS**할 수 있습니다.

{% hint style="warning" %}
이전 값도 저장되므로 이전 값으로 쉽게 돌아갈 수 있습니다.
{% endhint %}
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS KMS 키 변경

#### Description
An attacker can perform a Denial of Service (DoS) attack by changing the Key Management Service (KMS) key in AWS Secrets Manager.

#### Exploitation
1. Identify the target AWS Secrets Manager instance.
2. Obtain the necessary permissions to modify the KMS key associated with the Secrets Manager instance.
3. Use the AWS CLI or SDK to change the KMS key.
4. Monitor the target application to confirm the DoS attack.

#### Mitigation
To mitigate this issue, follow these recommendations:
- Implement strict access controls and permissions for modifying KMS keys.
- Regularly monitor and audit KMS key changes.
- Enable CloudTrail logging to track any unauthorized changes.
- Implement network-level protections to detect and block DoS attacks.
- Regularly update and patch your AWS infrastructure to prevent known vulnerabilities.
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### 비밀 삭제를 위한 DoS 공격

비밀을 삭제하기 위한 최소 일 수는 7일입니다.
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>
