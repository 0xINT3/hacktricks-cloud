# AWS - Secrets Manager后渗透

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF版本的HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## Secrets Manager

有关更多信息，请查看：

{% content-ref url="../../aws-security/aws-services/aws-secrets-manager-enum.md" %}
[aws-secrets-manager-enum.md](../../aws-security/aws-services/aws-secrets-manager-enum.md)
{% endcontent-ref %}

### 读取Secrets

**Secrets本身是敏感信息**，[请查看权限提升页面](../../aws-security/aws-privilege-escalation/aws-secrets-manager-privesc.md)以了解如何读取它们。

### DoS更改Secret值

更改Secret值可能会导致依赖该值的系统**遭受DoS攻击**。

{% hint style="warning" %}
请注意，先前的值也会被存储，因此很容易返回到先前的值。
{% endhint %}
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS更改KMS密钥

在AWS中，KMS（密钥管理服务）是一种用于创建和管理加密密钥的服务。攻击者可以利用DoS（拒绝服务）攻击来干扰KMS密钥的正常功能。

#### 攻击方法

攻击者可以通过以下步骤执行DoS更改KMS密钥的攻击：

1. 识别目标KMS密钥的ARN（Amazon资源名称）。
2. 使用AWS CLI或SDK发送大量的请求来更改KMS密钥的策略。
3. 攻击者可以使用多个AWS账户或多个IP地址来增加攻击的规模。

#### 防御措施

为了防止DoS更改KMS密钥的攻击，可以采取以下措施：

1. 使用AWS CloudWatch监控KMS密钥的请求速率，并设置警报以检测异常活动。
2. 限制对KMS密钥的访问权限，只允许授权的用户或角色进行更改。
3. 使用AWS WAF（Web应用程序防火墙）来过滤恶意请求。
4. 定期审查KMS密钥的策略，并确保只有必要的权限被授予。

#### 结论

DoS更改KMS密钥的攻击可能会导致KMS密钥的不可用性，从而影响与加密相关的操作。通过采取适当的防御措施，可以减轻此类攻击的风险。
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### DoS 删除秘密

删除秘密的最小天数为7天。
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
<details>

<summary><strong>支持HackTricks并获得好处！</strong></summary>

* 如果您想看到您的**公司在HackTricks中进行广告**，或者如果您想访问**PEASS的最新版本或下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品，[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或者 [**Telegram群组**](https://t.me/peass)，或者在**Twitter**上**关注**我 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来**分享您的黑客技巧**。

</details>
