# AWS - CodeBuild后渗透

<details>

<summary><strong>支持HackTricks并获得福利！</strong></summary>

* 如果您想在HackTricks中看到您的公司广告，或者如果您想访问PEASS的最新版本或下载PDF格式的HackTricks，请查看[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram群组**](https://t.me/peass) 或 **关注**我在**Twitter**上的🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github仓库提交PR来分享您的黑客技巧。**

</details>

## CodeBuild

有关更多信息，请查看：

{% content-ref url="../../aws-security/aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-security/aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### 滥用CodeBuild Repo访问权限

为了配置**CodeBuild**，它将需要访问它将要使用的代码仓库。多个平台可以托管此代码：

<figure><img src="../../../.gitbook/assets/image (3) (5).png" alt=""><figcaption></figcaption></figure>

**CodeBuild项目必须具有对配置的源提供程序的访问权限**，可以通过IAM角色或使用github/bitbucket的令牌或OAuth访问。

在拥有**CodeBuild的提升权限的攻击者**可以滥用此配置的访问权限来泄漏配置的仓库和其他具有访问权限的仓库的代码。\
为了做到这一点，攻击者只需要**将仓库URL更改为配置凭据具有访问权限的每个仓库**（请注意，AWS Web将为您列出所有这些仓库）：

<figure><img src="../../../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

并**更改Buildspec命令以窃取每个仓库**。

{% hint style="warning" %}
然而，这个**任务是重复和繁琐的**，如果配置了一个具有**写权限的github令牌**，攻击者**无法滥用这些权限**，因为他无法访问该令牌。\
或者他可以吗？请查看下一节
{% endhint %}

### 从AWS CodeBuild泄漏访问令牌

{% content-ref url="aws-codebuild-post-exploitation/aws-codebuild-token-leakage.md" %}
[aws-codebuild-token-leakage.md](aws-codebuild-post-exploitation/aws-codebuild-token-leakage.md)
{% endcontent-ref %}

### `codebuild:DeleteProject`

攻击者可以删除整个CodeBuild项目，导致项目配置丢失，并影响依赖于该项目的应用程序。
```bash
aws codebuild delete-project --name <value>
```
**潜在影响**：删除项目可能导致项目配置丢失和使用已删除项目的应用程序服务中断。

### `codebuild:TagResource` , `codebuild:UntagResource`

攻击者可以向CodeBuild资源添加、修改或删除标签，从而干扰您组织的成本分配、资源跟踪和基于标签的访问控制策略。
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**潜在影响**：成本分配、资源跟踪和基于标签的访问控制策略的中断。

### `codebuild:DeleteSourceCredentials`

攻击者可以删除与 Git 存储库相关的源凭据，从而影响依赖该存储库的应用程序的正常运行。
```sql
aws codebuild delete-source-credentials --arn <value>
```
**潜在影响**：由于源凭据被删除，依赖于受影响仓库的应用程序可能会受到正常功能的干扰。

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>
