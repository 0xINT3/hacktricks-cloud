# Az - Dynamic Groups Privesc

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **会社をHackTricksで宣伝したい**場合や、**最新バージョンのPEASSを入手したり、HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしましょう 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## 基本情報

**ダイナミックグループ**は、設定された一連の**ルール**を持つグループであり、ルールに一致するすべての**ユーザーまたはデバイス**がグループに追加されます。ユーザーまたはデバイスの**属性**が**変更**されるたびに、ダイナミックルールが**再確認**されます。また、**新しいルール**が**作成**されると、すべてのデバイスとユーザーが**チェック**されます。

ダイナミックグループにはAzure RBACロールを割り当てることができますが、AzureADロールをダイナミックグループに追加することは**できません**。

この機能にはAzure ADプレミアムP1ライセンスが必要です。

## Privesc

デフォルトでは、Azure ADではどのユーザーでもゲストを招待することができるため、ダイナミックグループの**ルール**が**属性**に基づいてユーザーに**権限**を与える場合、この属性を持つ**ゲスト**を作成して**特権を昇格**することが可能です。また、ゲストは自分自身のプロファイルを管理し、これらの属性を変更することも可能です。

ダイナミックメンバーシップを許可するグループを取得する: `Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### 例

* **ルールの例**: `(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **ルールの説明**: 'tester'という文字列を含むゲストユーザーは、グループに追加されます

1. **Azure Active Directory**に移動し、**ユーザー**をクリックして**`Want to switch back to the legacy users list experience? Click here to leave the preview`**をクリックします。
2. **`New guest user`**をクリックして、メールを**招待**します。
3. 招待が送信されると、**ユーザーのプロファイル**がAzure ADに**追加**されます。ユーザーのプロファイルを開き、**Invitation accepted**の下にある**(manage)をクリック**します。
* ![](<../../.gitbook/assets/image (87) (1).png>)
4. **`Resend invite?`**を**Yes**に変更すると、招待URLが表示されます。
* ![](<../../.gitbook/assets/image (11) (1).png>)
5. **URL**をコピーして**開き**、招待されたユーザーとして**ログイン**し、招待を**受け入れ**ます。
6. ユーザーとしてcliに**ログイン**し、セカンダリメールを設定します

{% code overflow="wrap" %}
```powershell
# ログイン
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# OtherMailsの設定変更
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
{% endcode %}

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **会社をHackTricksで宣伝したい**場合や、**最新バージョンのPEASSを入手したり、HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしましょう 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
