# Az - рдбрд╛рдпрдирд╛рдорд┐рдХ рд╕рдореВрд╣ рдкреНрд░рд╛рдЗрд╡реЗрд╕реА

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣](https://discord.gg/hRep4RUj7f) рдпрд╛ [рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ **рдореБрдЭреЗ рдЯреНрд╡рд┐рдЯрд░ рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА

**рдбрд╛рдпрдирд╛рдорд┐рдХ рд╕рдореВрд╣** рдРрд╕реЗ рд╕рдореВрд╣ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдПрдХ рд╕реЗрдЯ рдХреЗ **рдирд┐рдпрдо** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рд╕рднреА **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рдЙрдкрдХрд░рдг** рдЬреЛ рдирд┐рдпрдореЛрдВ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреЗ рд╣реИрдВ, рд╕рдореВрд╣ рдореЗрдВ рдЬреЛрдбрд╝ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рд╣рд░ рдмрд╛рд░ рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рдЙрдкрдХрд░рдг **рд╡рд┐рд╢реЗрд╖рддрд╛** рдмрджрд▓рддрд╛ рд╣реИ, рдбрд╛рдпрдирд╛рдорд┐рдХ рдирд┐рдпрдореЛрдВ рдХреА **рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐** рд╣реЛрддреА рд╣реИред рдФрд░ рдЬрдм рдПрдХ **рдирдпрд╛ рдирд┐рдпрдо** **рдмрдирд╛рдпрд╛** рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╕рднреА рдЙрдкрдХрд░рдг рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдЬрд╛рдВрдЪреЗ** рдЬрд╛рддреЗ рд╣реИрдВред

рдбрд╛рдпрдирд╛рдорд┐рдХ рд╕рдореВрд╣реЛрдВ рдХреЛ **Azure RBAC рднреВрдорд┐рдХрд╛рдПрдБ рд╕реМрдВрдкреА** рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдбрд╛рдпрдирд╛рдорд┐рдХ рд╕рдореВрд╣реЛрдВ рдореЗрдВ **AzureAD рднреВрдорд┐рдХрд╛рдПрдБ** рдЬреЛрдбрд╝рдирд╛ **рд╕рдВрднрд╡ рдирд╣реАрдВ** рд╣реИред

рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП Azure AD рдкреНрд░реАрдорд┐рдпрдо P1 рд▓рд╛рдЗрд╕реЗрдВрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

## рдкреНрд░рд╛рдЗрд╡реЗрд╕реА

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ Azure AD рдореЗрдВ рдореЗрд╣рдорд╛рди рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдПрдХ рдбрд╛рдпрдирд╛рдорд┐рдХ рд╕рдореВрд╣ **рдирд┐рдпрдо** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдЕрдиреБрдорддрд┐** рджреЗрддрд╛ рд╣реИ рдЬреЛ **рдирдП рдореЗрд╣рдорд╛рди** рдореЗрдВ **рд╕реЗрдЯ** рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕ рд╡рд┐рд╢реЗрд╖рддрд╛ рд╡рд╛рд▓реЗ рдПрдХ рдореЗрд╣рдорд╛рди рдХреЛ рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдФрд░ **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдЙрдиреНрдирдд рдХрд░рдирд╛** рд╕рдВрднрд╡ рд╣реИред рдПрдХ рдореЗрд╣рдорд╛рди рдХреЛ рдЕрдкрдиреА рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдФрд░ рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рднреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрддреА рд╣реИред

рдбрд╛рдпрдирд╛рдорд┐рдХ рд╕рджрд╕реНрдпрддрд╛ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рд╕рдореВрд╣ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ: `Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### рдЙрджрд╛рд╣рд░рдг

* **рдирд┐рдпрдо рдЙрджрд╛рд╣рд░рдг**: `(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **рдирд┐рдпрдо рд╡рд┐рд╡рд░рдг**: рдХрд┐рд╕реА рднреА рдореЗрд╣рдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд┐рд╕рдХрд╛ рджреНрд╡рд┐рддреАрдпрдХ рдИрдореЗрд▓ рд╕реНрдЯреНрд░рд┐рдВрдЧ 'tester' рдХреЛ рд╕рдореНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрд╕реЗ рд╕рдореВрд╣ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛

1. **Azure Active Directory** рдкрд░ рдЬрд╛рдПрдВ -> **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдФрд░ **`рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реВрдЪреА рдЕрдиреБрднрд╡ рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╣рд╛рдВ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди рдЫреЛрдбрд╝реЗрдВ`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ
2. **`рдирдпрд╛ рдореЗрд╣рдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛`** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ рдПрдХ рдИрдореЗрд▓ **рдЖрдордВрддреНрд░рд┐рдд** рдХрд░реЗрдВ
3. рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдЖрдордВрддреНрд░рдг рднреЗрдЬреЗ рдЬрд╛рдиреЗ рдкрд░ Azure AD рдореЗрдВ **рдЬреЛрдбрд╝реА рдЬрд╛рдПрдЧреА**ред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓реЗрдВ рдФрд░ **рдЗрдиреНрд╡рд┐рдЯреЗрд╢рди рд╕реНрд╡реАрдХрд╛рд░ рдХреЗ рддрд╣рдд (рдкреНрд░рдмрдВрдзрд┐рдд) рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ**ред
* ![](<../../.gitbook/assets/image (87) (1).png>)
4. **`рдЗрдиреНрд╡рд╛рдЗрдЯ рдлрд┐рд░ рд╕реЗ рднреЗрдЬреЗрдВ?`** рдХреЛ **рд╣рд╛рдБ** рдореЗрдВ рдмрджрд▓реЗрдВ рдФрд░ рдЖрдкрдХреЛ рдПрдХ рдЖрдордВрддреНрд░рдг URL рдорд┐рд▓реЗрдЧрд╛:
* ![](<../../.gitbook/assets/image (11) (1).png>)
5. **URL** рдХреЛ **рдХреЙрдкреА** рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ **рдЦреЛрд▓реЗрдВ**, рдЖрдордВрддреНрд░рд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ **рд▓реЙрдЧрд┐рди** рдХрд░реЗрдВ рдФрд░ рдЖрдордВрддреНрд░рдг рд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ
6. рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ рдФрд░ рджреНрд╡рд┐рддреАрдпрдХ рдИрдореЗрд▓ рд╕реЗрдЯ рдХрд░реЗрдВ

{% code overflow="wrap" %}
```powershell
# рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# OtherMails рд╕реЗрдЯрд┐рдВрдЧ рдмрджрд▓реЗрдВ
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
{% endcode %}

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рджреЗрдЦ
