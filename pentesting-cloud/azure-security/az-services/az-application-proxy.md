# Az - Application Proxy

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

## Informa√ß√µes b√°sicas

O Application Proxy do Azure Active Directory fornece **acesso remoto seguro a aplicativos web locais**. Ap√≥s um **login √∫nico no Azure AD**, os usu√°rios podem acessar tanto **aplicativos em nuvem** quanto **locais** por meio de uma **URL externa** ou um portal de aplicativos interno.

Funciona assim:

<figure><img src="../../../.gitbook/assets/image (86).png" alt=""><figcaption></figcaption></figure>

1. Depois que o usu√°rio acessa o aplicativo por meio de um endpoint, o usu√°rio √© direcionado para a **p√°gina de login do Azure AD**.
2. Ap√≥s um **login bem-sucedido**, o Azure AD envia um **token** para o dispositivo do cliente do usu√°rio.
3. O cliente envia o token para o **servi√ßo de Application Proxy**, que recupera o nome principal do usu√°rio (UPN) e o nome principal de seguran√ßa (SPN) do token. **O Application Proxy, em seguida, envia a solicita√ß√£o para o conector do Application Proxy**.
4. Se voc√™ configurou o login √∫nico, o conector executa qualquer **autentica√ß√£o adicional** necess√°ria em nome do usu√°rio.
5. O conector envia a solicita√ß√£o para o **aplicativo local**.
6. A **resposta** √© enviada pelo conector e pelo servi√ßo de Application Proxy **para o usu√°rio**.

## Enumera√ß√£o

```powershell
# Enumere aplicativos com proxy de aplicativo configurado
Get-AzureADApplication | %{try{Get-AzureADApplicationProxyApplication -ObjectId $_.ObjectID;$_.DisplayName;$_.ObjectID}catch{}}

# Obtenha o principal de servi√ßo de aplicativos
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -eq "Nome"}

# Use o seguinte script ps1 de https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/scripts/powershell-display-users-group-of-app
# para encontrar usu√°rios e grupos atribu√≠dos ao aplicativo. Passe o ObjectID do Principal de Servi√ßo para ele
Get-ApplicationProxyAssignedUsersAndGroups -ObjectId <object-id>
```

## Refer√™ncias

* [https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy](https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy)

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>