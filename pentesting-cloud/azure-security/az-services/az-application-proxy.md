# Az - アプリケーションプロキシ

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もし **HackTricks で会社を宣伝したい**場合や、**PEASS の最新バージョンにアクセスしたい**場合、または **HackTricks を PDF でダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式の PEASS & HackTricks スワッグ**](https://peass.creator-spring.com) を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) を見つけてください。これは、私たちの独占的な [**NFT**](https://opensea.io/collection/the-peass-family) のコレクションです
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) または [**telegram グループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) をフォローしてください。
* **ハッキングのトリックを共有するために、PR を** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **の GitHub リポジトリに提出してください。**

</details>

## 基本情報

Azure Active Directory のアプリケーションプロキシは、**オンプレミスの Web アプリケーションへの安全なリモートアクセス**を提供します。**Azure AD へのシングルサインオン**の後、ユーザーは**クラウド**および**オンプレミスのアプリケーション**に、**外部 URL**または内部アプリケーションポータルを介してアクセスできます。

動作は次のようになります：

<figure><img src="../../../.gitbook/assets/image (86).png" alt=""><figcaption></figcaption></figure>

1. ユーザーがエンドポイントを介してアプリケーションにアクセスした後、ユーザーは**Azure AD サインインページ**にリダイレクトされます。
2. **正常なサインイン**の後、Azure AD はトークンをユーザーのクライアントデバイスに送信します。
3. クライアントはトークンを**アプリケーションプロキシサービス**に送信し、トークンからユーザーのプリンシパル名 (UPN) とセキュリティプリンシパル名 (SPN) を取得します。**アプリケーションプロキシはその後、リクエストをアプリケーションプロキシコネクタに送信**します。
4. シングルサインオンを構成している場合、コネクタはユーザーの代わりに必要な**追加の認証**を実行します。
5. コネクタは**オンプレミスのアプリケーション**にリクエストを送信します。
6. **レスポンス**はコネクタとアプリケーションプロキシサービスを経由して**ユーザーに送信**されます。

## 列挙
```powershell
# Enumerate applications with application proxy configured
Get-AzureADApplication | %{try{Get-AzureADApplicationProxyApplication -ObjectId $_.ObjectID;$_.DisplayName;$_.ObjectID}catch{}}

# Get applications service principal
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -eq "Name"}

# Use the following ps1 script from https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/scripts/powershell-display-users-group-of-app
# to find users and groups assigned to the application. Pass the ObjectID of the Service Principal to it
Get-ApplicationProxyAssignedUsersAndGroups -ObjectId <object-id>
```
## 参考文献

* [https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy](https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/application-proxy)

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もし、あなたの**会社をHackTricksで宣伝したい**場合や、**最新版のPEASSを入手したい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **HackTricks**と**HackTricks Cloud**のgithubリポジトリにPRを提出して、あなたのハッキングトリックを共有してください。

</details>
