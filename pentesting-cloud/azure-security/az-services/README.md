# Az - サービス

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**最新バージョンのPEASSを入手したい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つける、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有する**ために、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する。

</details>

## ポータル

**Microsoftのポータルのリスト**は[**https://msportals.io/**](https://msportals.io/)で見つけることができます。

### Rawリクエスト

#### Powershellを介したAzure API

**IDENTITY\_HEADER**と**IDENTITY\_ENDPOINT**から**access\_token**を取得する: `system('curl "$IDENTITY_ENDPOINT?resource=https://management.azure.com/&api-version=2017-09-01" -H secret:$IDENTITY_HEADER');`.

その後、Azure REST APIをクエリして**サブスクリプションID**などを取得します。
```powershell
$Token = 'eyJ0eX..'
$URI = 'https://management.azure.com/subscriptions?api-version=2020-01-01'
# $URI = 'https://graph.microsoft.com/v1.0/applications'
$RequestParams = @{
Method = 'GET'
Uri = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value

# List resources and check for runCommand privileges
$URI = 'https://management.azure.com/subscriptions/b413826f-108d-4049-8c11-d52d5d388768/resources?api-version=2020-10-01'
$URI = 'https://management.azure.com/subscriptions/b413826f-108d-4049-8c11-d52d5d388768/resourceGroups/<RG-NAME>/providers/Microsoft.Compute/virtualMachines/<RESOURCE/providers/Microsoft.Authorization/permissions?apiversion=2015-07-01'
```
#### Azure APIをPythonバージョンで使用する

To interact with Azure services using Python, you can utilize the Azure SDK for Python. This SDK provides a set of libraries and tools that allow you to easily access and manage various Azure services.

To get started, you will need to install the Azure SDK for Python. You can do this by running the following command:

```shell
pip install azure
```

Once the SDK is installed, you can import the necessary modules in your Python script to interact with Azure services. For example, to work with Azure Blob Storage, you can use the `azure.storage.blob` module:

```python
from azure.storage.blob import BlobServiceClient

# Create a connection string to the storage account
connection_string = "DefaultEndpointsProtocol=https;AccountName=myaccount;AccountKey=mykey;EndpointSuffix=core.windows.net"

# Create a BlobServiceClient object
blob_service_client = BlobServiceClient.from_connection_string(connection_string)

# Use the BlobServiceClient object to perform operations on the storage account
# For example, you can list all the containers in the account
containers = blob_service_client.list_containers()

for container in containers:
    print(container.name)
```

This is just a basic example, but you can use the Azure SDK for Python to perform a wide range of operations on various Azure services, such as virtual machines, databases, and cognitive services.

For more information on how to use the Azure SDK for Python, you can refer to the official documentation: [Azure SDK for Python Documentation](https://docs.microsoft.com/en-us/python/azure/)

Happy hacking!
```python
IDENTITY_ENDPOINT = os.environ['IDENTITY_ENDPOINT']
IDENTITY_HEADER = os.environ['IDENTITY_HEADER']

print("[+] Management API")
cmd = 'curl "%s?resource=https://management.azure.com/&api-version=2017-09-01" -H secret:%s' % (IDENTITY_ENDPOINT, IDENTITY_HEADER)
val = os.popen(cmd).read()
print("Access Token: "+json.loads(val)["access_token"])
print("ClientID/AccountID: "+json.loads(val)["client_id"])

print("\r\n[+] Graph API")
cmd = 'curl "%s?resource=https://graph.microsoft.com/&api-version=2017-09-01" -H secret:%s' % (IDENTITY_ENDPOINT, IDENTITY_HEADER)
val = os.popen(cmd).read()
print(json.loads(val)["access_token"])
print("ClientID/AccountID: "+json.loads(val)["client_id"])
```
または、Pythonの関数内部で:
```python
import logging, os
import azure.functions as func

def main(req: func.HttpRequest) -> func.HttpResponse:
logging.info('Python HTTP trigger function processed a request.')
IDENTITY_ENDPOINT = os.environ['IDENTITY_ENDPOINT']
IDENTITY_HEADER = os.environ['IDENTITY_HEADER']
cmd = 'curl "%s?resource=https://management.azure.com&apiversion=2017-09-01" -H secret:%s' % (IDENTITY_ENDPOINT, IDENTITY_HEADER)
val = os.popen(cmd).read()
return func.HttpResponse(val, status_code=200)
```
## サービスのリスト

* [**Azure AD**](az-azuread.md)
* [**Application Proxy**](az-application-proxy.md)
* [**Arm テンプレート / デプロイ**](az-arm-templates.md)
* [**Automation Account**](az-automation-account/)
* [**App Service & Function Apps**](az-azure-app-service.md)
* [**Blob Storage**](az-blob-storage.md)
* [**Intune**](../intune.md)
* [**Keyvault**](../keyvault.md)
* [**Virtual Machines**](../vms.md)

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もしもあなたの**会社を HackTricks で宣伝したい**場合や、**最新版の PEASS を入手したい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式の PEASS & HackTricks スワッグ**](https://peass.creator-spring.com) を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) を見つけて、独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクションを発見しましょう
* 💬 [**Discord グループ**](https://discord.gg/hRep4RUj7f) または [**telegram グループ**](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm) をフォローしましょう。
* **HackTricks** と **HackTricks Cloud** の github リポジトリに PR を提出して、あなたのハッキングトリックを共有しましょう。

</details>
