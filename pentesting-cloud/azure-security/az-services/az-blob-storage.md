# Az - Stockage de blobs

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts Github.**

</details>

## Informations de base

Le stockage de blobs Azure est la solution de stockage d'objets de Microsoft pour le cloud. Le stockage de blobs est optimis√© pour stocker des quantit√©s massives de donn√©es non structur√©es. Les donn√©es non structur√©es sont des donn√©es qui n'adh√®rent pas √† un mod√®le ou √† une d√©finition de donn√©es particuliers, telles que des donn√©es textuelles ou binaires.

Le stockage de blobs offre trois types de ressources :

* Le **compte de stockage** (nom unique)
* Un **conteneur** dans le compte de stockage (dossier)
* Un **blob** dans un conteneur

<figure><img src="../../../.gitbook/assets/image (6) (2).png" alt=""><figcaption></figcaption></figure>

### Diff√©rents types de stockage

| **Stockage de blobs**             | <p><code>https://&#x3C;storage-account>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;containre-name>?restype=container&#x26;comp=list</code></p> |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Azure Data Lake Storage Gen2** | `https://<storage-account>.dfs.core.windows.net`                                                                                                                                                 |
| **Azure Files**                  | `https://<storage-account>.file.core.windows.net`                                                                                                                                                |
| **Stockage de files d'attente**  | `https://<storage-account>.queue.core.windows.net`                                                                                                                                               |
| **Stockage de tableaux**         | `https://<storage-account>.table.core.windows.net`                                                                                                                                               |

### Acc√®s au stockage <a href="#about-blob-storage" id="about-blob-storage"></a>

* Utilisez les principes Azure AD via les **r√¥les RBAC** pris en charge.
* **Cl√©s d'acc√®s** : Utilisez les cl√©s d'acc√®s du compte de stockage. Cela fournit un **acc√®s complet au compte de stockage**.
* **Signature d'acc√®s partag√©** (SAS) : Temps **limit√©** et autorisations sp√©cifiques.
  * Vous pouvez g√©n√©rer une URL SAS avec une cl√© d'acc√®s (plus difficile √† d√©tecter).

### Exposition publique

Si "Autoriser l'acc√®s public aux blobs" est **activ√©** (d√©sactiv√© par d√©faut), il est possible de :

* Donner **un acc√®s public en lecture aux blobs** (vous devez conna√Ætre le nom).
* **Lister les blobs du conteneur** et les **lire**.

### Connexion au stockage

Si vous trouvez un **stockage** auquel vous pouvez vous connecter, vous pouvez utiliser l'outil [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) pour le faire.

## URLs SAS

Une signature d'acc√®s partag√© (SAS) fournit un acc√®s d√©l√©gu√© s√©curis√© aux ressources de votre compte de stockage. Avec une SAS, vous avez un contr√¥le granulaire sur la fa√ßon dont un client peut acc√©der √† vos donn√©es. Par exemple :

* Les ressources auxquelles le client peut acc√©der.
* Les autorisations dont ils disposent pour ces ressources.
* La dur√©e de validit√© de la SAS.

Une URL SAS ressemble √† ceci : **`https://<container_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`**

Utilisez [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) pour acc√©der aux donn√©es ou √† Python :

{% code overflow="wrap" %}
```python
#pip3 install azure-storage-blob
from azure.storage.blob import BlobServiceClient

# List containers
conn_str="<SAS URL>"
svc = BlobServiceClient.from_connection_string(conn_str=conn_str)
for c in svc.list_containers():
    print(c['name']

# List blobs inside conteiner
container = svc.get_container_client(container="<container_name>")
for b in container.list_blobs():
    print(b['name']

# Download file
blob = svc.get_blob_client(container="<container_name>",blob="<blob_name>")
with open("download.out","wb") as f:
    f.write(blob.download_blob().readall())
```
{% endcode %}

### Signature d'acc√®s partag√© de d√©l√©gation utilisateur <a href="#user-delegation-sas" id="user-delegation-sas"></a>

Vous pouvez **s√©curiser un jeton de signature d'acc√®s partag√© (SAS)** pour acc√©der √† un conteneur, un r√©pertoire ou un blob en utilisant soit les **informations d'identification Azure Active Directory (Azure AD)**, soit une cl√© de compte. Pour cr√©er une SAS de d√©l√©g