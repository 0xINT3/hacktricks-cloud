# Az - Blob Storage

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Taarifa Msingi

[Kutoka kwa nyaraka:](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview) Uhifadhi wa Blob wa Azure ni suluhisho la **uhifadhi wa vitu la Microsoft kwa wingu**. Uhifadhi wa Blob umetengenezwa kuhifadhi kiasi kikubwa cha data isiyo na muundo. Data isiyo na muundo ni data ambayo haifuati mfano au ufafanuzi maalum, kama vile maandishi au data ya binary.

Uhifadhi wa Blob hutoa aina tatu za rasilimali:

* **Akaunti ya uhifadhi** (jina la kipekee)
* **Kontena** katika akaunti ya uhifadhi (folda)
* **Blob** katika kontena

<figure><img src="../../../.gitbook/assets/image (6) (2).png" alt=""><figcaption></figcaption></figure>

### Aina Tofauti za Uhifadhi

| **Uhifadhi wa Blob**                    | <p><code>https://&#x3C;akaunti-ya-uhifadhi>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;jina-la-kontena>?restype=kontena&#x26;comp=list</code></p> |
| --------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Uhifadhi wa Data Lake wa Azure Gen2** | `https://<akaunti-ya-uhifadhi>.dfs.core.windows.net`                                                                                                                                                |
| **Faili za Azure**                      | `https://<akaunti-ya-uhifadhi>.file.core.windows.net`                                                                                                                                               |
| **Uhifadhi wa Queue**                   | `https://<akaunti-ya-uhifadhi>.queue.core.windows.net`                                                                                                                                              |
| **Uhifadhi wa Jedwali**                 | `https://<akaunti-ya-uhifadhi>.table.core.windows.net`                                                                                                                                              |

### Upatikanaji wa Uhifadhi <a href="#about-blob-storage" id="about-blob-storage"></a>

* Tumia mabalozi ya Azure AD kupitia majukumu ya **RBAC** yanayoungwa mkono.
* **Vipuli vya Upatikanaji**: Tumia vipuli vya upatikanaji wa akaunti ya uhifadhi. Hii hutoa **upatikanaji kamili kwa akaunti ya uhifadhi.**
* **Saini ya Upatikanaji wa Pamoja** (SAS): **Muda** **mdogo** na ruhusa maalum.
* Unaweza kuzalisha URL ya SAS na **ufunguo wa upatikanaji** (ngumu zaidi kugundua).
* Kwa kuwa SAS inazalishwa kutoka kwa ufunguo wa upatikanaji, ikiwa inafanyiwa upya SAS inakoma kufanya kazi.

### Kufichua Kwa Umma

Ikiwa "Ruhusu upatikanaji wa umma wa Blob" imekuwa **imezimwa** (imezimwa kwa chaguo-msingi), inawezekana:

* Kutoa **upatikanaji wa umma kusoma blobs** (unahitaji kujua jina).
* **Orodhesha blobs za kontena** na **kusoma**.

### Kuunganisha kwa Uhifadhi

Ikiwa unapata **uhifadhi** wowote unaweza kuunganisha kutumia zana [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) kufanya hivyo.

## URL za SAS

[Kutoka kwa nyaraka:](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview) Saini ya upatikanaji wa pamoja (SAS) hutoa upatikanaji ulioidhinishwa salama kwa rasilimali katika akaunti yako ya uhifadhi. Kwa SAS, una udhibiti wa kina juu ya jinsi mteja anaweza kupata data yako. Kwa mfano:

* Ni rasilimali zipi mteja anaweza kupata.
* Ni ruhusa gani wanayo kwa rasilimali hizo.
* Muda gani SAS ni halali.

URL ya SAS inaonekana kama hii: **`https://<jina_la_kontena>.blob.core.windows.net/kontenamipya?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`**

Tumia [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) kupata data au python:

{% code overflow="wrap" %}
```python
#pip3 install azure-storage-blob
from azure.storage.blob import BlobServiceClient

# List containers
conn_str="<SAS URL>"
svc = BlobServiceClient.from_connection_string(conn_str=conn_str)
for c in svc.list_containers():
print(c['name']

# List blobs inside conteiner
container = svc.get_container_client(container="<container_name>")
for b in container.list_blobs():
print(b['name']

# Download file
blob = svc.get_blob_client(container="<container_name>",blob="<blob_name>")
with open("download.out","wb") as f:
f.write(blob.download_blob().readall())
```
{% endcode %}

### Sasisho la Utekelezaji wa Mtumiaji <a href="#user-delegation-sas" id="user-delegation-sas"></a>

Unaweza **kuhakikisha saini ya ufikiaji iliyoshirikiwa (SAS)** kwa ufikiaji wa kontena, saraka, au blob kwa kutumia **vyeti vya Azure Active Directory (Azure AD) au ufunguo wa akaunti**. Ili kuunda sasisho la utekelezaji wa mtumiaji, lazima kwanza uombwe **ufunguo wa utekelezaji wa mtumiaji**, ambao kisha unatumia kusaini SAS.

Msaada unatolewa kwa **Saini ya Utekelezaji wa Mtumiaji wa Ufikiaji wa Kushirikiana (SAS)** katika **Uhifadhi wa Blob wa Azure** na **Uhifadhi wa Data wa Ziwa wa Azure Gen2**. Walakini, ni muhimu kutambua kuwa **Sera za Ufikiaji zilizohifadhiwa** hazilingani na Sasisho la Utekelezaji wa Mtumiaji.

Tafadhali kumbuka kuwa sasisho la utekelezaji wa mtumiaji ni **lililohakikishwa na vyeti vya Azure AD badala ya ufunguo wa akaunti ya uhifadhi**. Hii inazuia wateja/vyombo vya maombi kutoka kuhifadhi/kupata ufunguo wa uhifadhi ili kuunda SAS.

### Sasisho la Huduma

Sasisho la huduma linahakikishwa na **ufunguo wa akaunti ya uhifadhi**. Sasisho la huduma **linatekeleza ufikiaji wa rasilimali katika moja tu** ya huduma za Uhifadhi wa Azure: Uhifadhi wa Blob, Uhifadhi wa Queue, Uhifadhi wa Jedwali, au Faili za Azure. URI kwa SAS ya kiwango cha huduma inajumuisha URI kwa rasilimali ambayo SAS itatekeleza ufikiaji, ikifuatiwa na saini ya SAS.

Ili kutumia vyeti vya Azure Active Directory (Azure AD) kulinda SAS kwa **kontena** au **blob**, tumia **sasisho la utekelezaji wa mtumiaji**.

### Sasisho la Akaunti

Sasisho la akaunti linahakikishwa na moja ya **ufunguo wa akaunti ya uhifadhi** (ipo 2). Sasisho la akaunti **linatekeleza ufikiaji wa rasilimali katika moja au zaidi ya huduma za uhifadhi**. Operesheni zote zinazopatikana kupitia SAS ya huduma au utekelezaji wa mtumiaji pia zinapatikana kupitia SAS ya akaunti.

[kutoka kwa nyaraka:](https://learn.microsoft.com/en-us/rest/api/storageservices/create-account-sas) Kwa kuunda SAS ya akaunti, unaweza:

* Kutekeleza ufikiaji wa operesheni za kiwango cha huduma ambazo kwa sasa hazipatikani na SAS maalum ya huduma, kama vile operesheni za `Pata/Seti Vipimo vya Huduma` na `Pata Takwimu za Huduma`.
* Kutekeleza ufikiaji wa huduma zaidi ya moja kwa wakati mmoja katika akaunti ya uhifadhi. Kwa mfano, unaweza kutekeleza ufikiaji wa rasilimali katika Uhifadhi wa Blob wa Azure na Faili za Azure kwa kutumia SAS ya akaunti.
* Kutekeleza ufikiaji wa operesheni za kuandika na kufuta kwa kontena, foleni, meza, na hisa za faili, ambazo hazipatikani na SAS maalum ya kitu.
* Kutoa anwani ya IP au safu ya anwani za IP kutoka ambazo kupokea maombi.
* Kutoa itifaki ya HTTP kutoka ambayo kupokea maombi (HTTPS au HTTP/HTTPS).

## Urambazaji

```bash
# Get storage accounts
az storage account list #Get the account name from here

# Get keys to authenticate
az storage account keys list --account-name <name>

# Get shares
az storage share list --account-name <name> --account-key <key>

# Get dirs/files inside the share
az storage file list --account-name <name> --share-name <share-name> --account-key <key>
## If type is "dir", you can continue enumerationg files inside of it
az storage file list --account-name <name> --share-name <prev_dir/share-name> --account-key <key>

# Download a complete share (with directories and files inside of them)
az storage file download-batch -d . --source <share-name> --account-name <name> --account-key <key>
```

```powershell
# Get storage accounts
Get-AzStorageAccount | fl
# Get rules to access the storage account
Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet
# Get IPs
(Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet).IPRules
# Get containers of a storage account
Get-AzStorageContainer -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context
# Get blobs inside container
Get-AzStorageBlob -Container epbackup-planetary -Context (Get-AzStorageAccount -name <name> -ResourceGroupName <name>).context
# Get a blob from a container
Get-AzStorageBlobContent -Container <NAME> -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context -Blob <blob_name> -Destination .\Desktop\filename.txt
```

## Marejeo

* [https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)
* [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
