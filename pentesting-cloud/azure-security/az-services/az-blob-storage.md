# Az - Armazenamento de Blob

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou se quiser acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informa√ß√µes b√°sicas

O armazenamento de Blob do Azure √© a solu√ß√£o de **armazenamento de objetos da Microsoft para a nuvem**. O armazenamento de Blob √© otimizado para armazenar enormes quantidades de dados n√£o estruturados. Dados n√£o estruturados s√£o dados que n√£o aderem a um modelo ou defini√ß√£o de dados espec√≠ficos, como dados de texto ou bin√°rios.

O armazenamento de Blob oferece tr√™s tipos de recursos:

* A **conta de armazenamento** (nome exclusivo)
* Um **cont√™iner** na conta de armazenamento (pasta)
* Um **blob** em um cont√™iner

<figure><img src="../../../.gitbook/assets/image (6) (2).png" alt=""><figcaption></figcaption></figure>

### Diferentes tipos de armazenamento

| **Armazenamento de Blob**         | <p><code>https://&#x3C;storage-account>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;containre-name>?restype=container&#x26;comp=list</code></p> |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Azure Data Lake Storage Gen2** | `https://<storage-account>.dfs.core.windows.net`                                                                                                                                                 |
| **Arquivos do Azure**            | `https://<storage-account>.file.core.windows.net`                                                                                                                                                |
| **Armazenamento de fila**        | `https://<storage-account>.queue.core.windows.net`                                                                                                                                               |
| **Armazenamento de tabela**      | `https://<storage-account>.table.core.windows.net`                                                                                                                                               |

### Acesso ao armazenamento <a href="#about-blob-storage" id="about-blob-storage"></a>

* Use princ√≠pios do Azure AD via **fun√ß√µes RBAC** suportadas.
* **Chaves de acesso**: Use as chaves de acesso da conta de armazenamento. Isso fornece **acesso total √† conta de armazenamento**.
* **Assinatura de acesso compartilhado** (SAS): tempo **limitado** e permiss√µes espec√≠ficas.
  * Voc√™ pode gerar uma URL SAS com uma chave de acesso (mais dif√≠cil de detectar).

### Exposi√ß√£o p√∫blica

Se "Permitir acesso p√∫blico ao blob" estiver **habilitado** (desabilitado por padr√£o), √© poss√≠vel:

* Dar **acesso p√∫blico para ler blobs** (voc√™ precisa saber o nome).
* **Listar blobs do cont√™iner** e **l√™-los**.

### Conectar ao armazenamento

Se voc√™ encontrar algum **armazenamento** ao qual possa se conectar, pode usar a ferramenta [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) para faz√™-lo.

## URLs SAS

Uma assinatura de acesso compartilhado (SAS) fornece acesso delegado seguro a recursos em sua conta de armazenamento. Com um SAS, voc√™ tem controle granular sobre como um cliente pode acessar seus dados. Por exemplo:

* Quais recursos o cliente pode acessar.
* Quais permiss√µes eles t√™m para esses recursos.
* Por quanto tempo o SAS √© v√°lido.

Uma URL SAS se parece com isso: **`https://<container_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`**

Use o [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) para acessar os dados ou python:

{% code overflow="wrap" %}
```python
#pip3 install azure-storage-blob
from azure.storage.blob import BlobServiceClient

# List containers
conn_str="<SAS URL>"
svc = BlobServiceClient.from_connection_string(conn_str=conn_str)
for c in svc.list_containers():
    print(c['name']

# List blobs inside conteiner
container = svc.get_container_client(container="<container_name>")
for b in container.list_blobs():
    print(b['name']

# Download file
blob = svc.get_blob_client(container="<container_name>",blob="<blob_name>")
with open("download.out","wb") as f:
    f.write(blob.download_blob().readall())
```
{% endcode %}

### SAS de delega√ß√£o do usu√°rio <a href="#user-delegation-sas" id="user-delegation-sas"></a>

Voc√™ pode **proteger um token de assinatura de acesso compartilhado (SAS)** para acesso a um cont√™iner, diret√≥rio ou blob usando as credenciais do **Azure Active Directory (Azure AD) ou uma chave de conta**. Para criar um SAS de delega√ß√£o do usu√°rio, voc√™ deve primeiro solicitar uma **chave de delega√ß√£o do usu√°rio**, que voc√™ usa para assinar o SAS.

Um SAS de delega√ß√£o do usu√°rio √© suportado para **Armazenamento de Blob do Azure** e **Armazenamento de Data Lake Gen2