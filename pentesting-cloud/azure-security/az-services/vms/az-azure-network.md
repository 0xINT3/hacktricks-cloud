# Az - R√©seau Azure

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge HackTricks AWS)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informations de base

Les r√©seaux au sein d'Azure fonctionnent comme une partie int√©grante de sa plateforme de cloud computing, permettant la **connexion et la communication entre divers services et ressources Azure**. L'architecture r√©seau dans Azure est con√ßue pour √™tre hautement √©volutive, s√©curis√©e et personnalisable.

Au c≈ìur d'Azure, il y a un **r√©seau virtuel (VNet)** qui permet aux utilisateurs de cr√©er des **r√©seaux isol√©s** au sein du cloud Azure. Au sein de ces VNets, des ressources telles que des machines virtuelles, des applications et des bases de donn√©es peuvent √™tre h√©berg√©es et g√©r√©es de mani√®re s√©curis√©e. Le r√©seau dans Azure prend en charge √† la fois la communication au sein du cloud (entre les services Azure) et la connexion aux r√©seaux externes et √† Internet.

La **s√©curit√©** est un aspect critique du r√©seau Azure, avec divers outils et services disponibles pour prot√©ger les donn√©es, g√©rer l'acc√®s et garantir la conformit√©. Ces mesures de s√©curit√© comprennent des **pare-feu**, des **groupes de s√©curit√© r√©seau** et des capacit√©s de **chiffrement**, permettant un haut niveau de contr√¥le sur le trafic et l'acc√®s.

Dans l'ensemble, les capacit√©s r√©seau d'Azure sont con√ßues pour offrir une flexibilit√©, permettant aux utilisateurs de cr√©er un environnement r√©seau adapt√© √† leurs besoins d'application et de charge de travail sp√©cifiques tout en mettant fortement l'accent sur la s√©curit√© et la fiabilit√©.

## R√©seau virtuel (VNET) & Sous-r√©seaux

Un VNet dans Azure est essentiellement une repr√©sentation de votre propre r√©seau dans le cloud. Il s'agit d'une **isolation logique du cloud Azure d√©di√©e √† votre abonnement**. Un VNet vous permet de provisionner et de g√©rer des r√©seaux priv√©s virtuels (VPN) dans Azure et peut √™tre utilis√© pour h√©berger et **g√©rer plusieurs types de ressources Azure**, telles que des Machines Virtuelles (VM), des bases de donn√©es et des services d'application.

Les VNets vous offrent un **contr√¥le total sur vos param√®tres r√©seau**, y compris les plages d'adresses IP, la cr√©ation de sous-r√©seaux, les tables de routage et les passerelles r√©seau.

Un **sous-r√©seau** est une **plage d'adresses IP dans votre VNet**. Vous pouvez diviser un VNet en plusieurs sous-r√©seaux pour des raisons d'organisation et de s√©curit√©. Chaque sous-r√©seau dans un VNet peut √™tre utilis√© pour isoler et regrouper des ressources selon votre architecture r√©seau et d'application.

De plus, les sous-r√©seaux vous permettent de **segmenter votre VNet en un ou plusieurs sous-r√©seaux**, fournissant une plage d'adresses IP que les ressources peuvent utiliser.

### **Exemple**

* Supposons que vous ayez un VNet nomm√© `MyVNet` avec une plage d'adresses IP de `10.0.0.0/16`. Vous pouvez cr√©er un sous-r√©seau au sein de ce VNet, disons `Sous-r√©seau-1`, avec une plage d'adresses IP de `10.0.0.0/24` pour h√©berger vos serveurs web. Un autre sous-r√©seau, `Sous-r√©seau-2` avec une plage de `10.0.1.0/24`, pourrait √™tre utilis√© pour vos serveurs de base de donn√©es. Cette segmentation permet une gestion efficace et des contr√¥les de s√©curit√© au sein du r√©seau.

### √ânum√©ration

Pour lister tous les VNets et sous-r√©seaux dans un compte Azure, vous pouvez utiliser l'Interface de Ligne de Commande Azure (CLI). Voici les √©tapes :

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Groupes de s√©curit√© r√©seau (NSG)

Dans Azure, un **groupe de s√©curit√© r√©seau (NSG)** sert principalement √† filtrer le trafic r√©seau √† la fois vers et depuis les ressources Azure au sein d'un r√©seau virtuel Azure (VNet). Il contient un ensemble de **r√®gles de s√©curit√©** qui dictent m√©ticuleusement le flux du trafic r√©seau.

Les aspects cl√©s des NSG comprennent :

- **Contr√¥le du trafic** : Chaque NSG contient des r√®gles qui sont essentielles pour permettre ou bloquer le trafic r√©seau entrant et sortant associ√© √† diverses ressources Azure.
- **Composants des r√®gles** : Les r√®gles au sein d'un NSG sont tr√®s sp√©cifiques, filtrant le trafic en fonction de crit√®res tels que l'adresse IP source/destination, le port et le protocole. Cette sp√©cificit√© permet une gestion granulaire du trafic r√©seau.
- **Am√©lioration de la s√©curit√©** : En veillant √† ce que seul le trafic autoris√© puisse entrer ou sortir de vos ressources Azure, les NSG jouent un r√¥le crucial dans le renforcement de la posture de s√©curit√© de votre infrastructure r√©seau.


### **Exemple**

* Imaginez que vous avez un NSG nomm√© `MonNSG` appliqu√© √† un sous-r√©seau ou √† une machine virtuelle sp√©cifique au sein de votre VNet. Vous pouvez cr√©er des r√®gles telles que :
* Une r√®gle entrante autorisant le trafic HTTP (port 80) depuis n'importe quelle source vers vos serveurs web.
* Une r√®gle sortante autorisant uniquement le trafic SQL (port 1433) vers une plage d'adresses IP de destination sp√©cifique.

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Pare-feu Azure

Le pare-feu Azure est un service de s√©curit√© r√©seau g√©r√© bas√© sur le cloud qui prot√®ge vos ressources du R√©seau virtuel Azure. C'est un pare-feu enti√®rement √©tatique en tant que service avec des fonctionnalit√©s int√©gr√©es de haute disponibilit√© et de scalabilit√©.

Le pare-feu Azure offre des fonctionnalit√©s plus avanc√©es que les NSG, notamment le filtrage au niveau de l'application, le filtrage au niveau du r√©seau, le filtrage bas√© sur l'intelligence des menaces et l'int√©gration avec Azure Monitor pour le journalisation et l'analyse.\
Il peut filtrer le trafic sortant, entrant, de point √† point, VPN et ExpressRoute. Les r√®gles du pare-feu peuvent √™tre cr√©√©es en fonction du FQDN (Fully Qualified Domain Name), des adresses IP et des ports.

### Diff√©rences entre le pare-feu Azure et les NSG

1. **Port√©e :**
* **NSG :** Fonctionne au niveau du sous-r√©seau ou de l'interface r√©seau. Il est destin√© √† fournir un filtrage de base du trafic entrant et sortant des interfaces r√©seau (NIC), des VM ou des sous-r√©seaux.
* **Pare-feu Azure :** Fonctionne au niveau du VNet, offrant une port√©e plus large de protection. Il est con√ßu pour s√©curiser vos ressources du r√©seau virtuel et g√©rer le trafic entrant et sortant du VNet.
2. **Capacit√©s :**
* **NSG :** Fournit des capacit√©s de filtrage de base bas√©es sur l'adresse IP, le port et le protocole. Il ne prend pas en charge les fonctionnalit√©s avanc√©es telles que l'inspection au niveau de l'application ou l'intelligence des menaces.
* **Pare-feu Azure :** Offre des fonctionnalit√©s avanc√©es telles que le filtrage du trafic au niveau de l'application (niveau 7), le filtrage bas√© sur l'intelligence des menaces, le filtrage du trafic r√©seau, et plus encore. Il prend √©galement en charge plusieurs adresses IP publiques.
3. **Cas d'utilisation :**
* **NSG :** Id√©al pour le filtrage de base du trafic au niveau du r√©seau.
* **Pare-feu Azure :** Adapt√© √† des sc√©narios de filtrage plus complexes n√©cessitant un contr√¥le au niveau de l'application, la journalisation et l'intelligence des menaces.
4. **Gestion et surveillance :**
* **NSG :** Offre une journalisation de base et une int√©gration avec Azure Monitor.
* **Pare-feu Azure :** Fournit des capacit√©s avanc√©es de journalisation et d'analyse via Azure Monitor, essentielles pour comprendre la nature et le sch√©ma du trafic.

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Appareil virtuel de r√©seau (NVA)

Un Appareil Virtuel de R√©seau (**NVA**) dans Azure est un appareil virtuel qui **effectue des fonctions r√©seau au sein d'un r√©seau virtuel**. Les NVA sont g√©n√©ralement utilis√©s pour des fonctions r√©seau qui **ne sont pas nativement disponibles** dans Azure ou lorsque plus de personnalisation est requise. Ce sont essentiellement des **VM qui ex√©cutent des applications ou des services r√©seau**, tels que des pare-feu, des optimiseurs WAN ou des √©quilibreurs de charge.

Les NVA sont utilis√©s pour des t√¢ches de routage complexe, de **s√©curit√©** et de **gestion du trafic r√©seau**. Ils peuvent √™tre d√©ploy√©s √† partir du **Marketplace** Azure, o√π de nombreux fournisseurs tiers proposent leurs appareils pr√™ts √† √™tre int√©gr√©s dans des environnements Azure.

### **Exemple**

* Une organisation peut d√©ployer un NVA dans Azure pour cr√©er une **solution de pare-feu personnalis√©e**. Ce NVA pourrait ex√©cuter un **logiciel de pare-feu tiers**, offrant des fonctionnalit√©s avanc√©es telles que la d√©tection d'intrusion, l'inspection de paquets ou la connectivit√© VPN. Le NVA peut √™tre configur√© pour inspecter et filtrer le trafic le traversant, garantissant la mise en place de mesures de s√©curit√© renforc√©es conform√©ment aux politiques de l'organisation.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Tables de routage Azure & Routes d√©finies par l'utilisateur (UDR)

Les **Tables de routage Azure** sont une fonctionnalit√© au sein de Microsoft Azure qui permet de **contr√¥ler le routage du trafic r√©seau au sein des R√©seaux Virtuels Azure (VNets)**. Essentiellement, elles d√©finissent comment les **paquets** sont **transmis** entre les sous-r√©seaux au sein des VNets, entre les VNets, ou vers des r√©seaux externes. Chaque table de routage contient un ensemble de r√®gles, appel√©es routes, qui sp√©cifient comment les paquets doivent √™tre rout√©s en fonction de leurs adresses IP de destination.

Les **Routes d√©finies par l'utilisateur (UDR)** dans Azure sont des **routes personnalis√©es que vous cr√©ez au sein des Tables de routage Azure** pour contr√¥ler le **flux du trafic r√©seau** au sein et entre les R√©seaux Virtuels Azure (VNets), et vers des connexions externes. Les UDR vous offrent la flexibilit√© de diriger le trafic r√©seau selon vos besoins sp√©cifiques, en rempla√ßant les d√©cisions de routage par d√©faut d'Azure.

Ces routes sont particuli√®rement utiles pour les sc√©narios o√π vous devez **router le trafic √† travers un appareil virtuel**, imposer un chemin sp√©cifique pour des raisons de s√©curit√© ou de conformit√© aux politiques, ou int√©grer des r√©seaux sur site.

### **Exemple**

* Supposons que vous ayez d√©ploy√© un Appareil Virtuel de R√©seau (NVA) pour inspecter le trafic entre les sous-r√©seaux au sein d'un VNet. Vous pouvez cr√©er une UDR qui dirige tout le trafic d'un sous-r√©seau vers un autre sous-r√©seau √† travers le NVA. Cette UDR garantit que le NVA inspecte le trafic √† des fins de s√©curit√© avant d'atteindre sa destination.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link est un service dans Azure qui **permet l'acc√®s priv√© aux services Azure** en veillant √† ce que **le trafic entre votre r√©seau virtuel Azure (VNet) et le service voyage enti√®rement dans le r√©seau principal d'Azure de Microsoft**. Il int√®gre efficacement le service dans votre VNet. Cette configuration renforce la s√©curit√© en ne exposant pas les donn√©es √† l'internet public.

Private Link peut √™tre utilis√© avec divers services Azure, tels que le stockage Azure, la base de donn√©es Azure SQL et les services personnalis√©s partag√©s via Private Link. Il offre un moyen s√©curis√© de consommer des services depuis votre propre VNet ou m√™me depuis diff√©rents abonnements Azure.

{% hint style="danger" %}
Les groupes de s√©curit√© r√©seau (NSG) ne s'appliquent pas aux points de terminaison priv√©s, ce qui signifie clairement qu'associer un NSG √† un sous-r√©seau contenant le Private Link n'aura aucun effet.
{% endhint %}

### **Exemple**

* Consid√©rez un sc√©nario o√π vous avez une **base de donn√©es Azure SQL que vous souhaitez acc√©der de mani√®re s√©curis√©e depuis votre VNet**. Normalement, cela impliquerait de traverser l'internet public. Avec Private Link, vous pouvez cr√©er un **point de terminaison priv√© dans votre VNet** qui se connecte directement au service de base de donn√©es Azure SQL. Ce point de terminaison fait appara√Ætre la base de donn√©es comme faisant partie de votre propre VNet, accessible via une adresse IP priv√©e, garantissant ainsi un acc√®s s√©curis√© et priv√©.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Points de terminaison de service Azure

Les points de terminaison de service Azure √©tendent l'espace d'adressage priv√© de votre r√©seau virtuel et l'identit√© de votre VNet aux services Azure via une connexion directe. En activant les points de terminaison de service, **les ressources de votre VNet peuvent se connecter de mani√®re s√©curis√©e aux services Azure**, tels que le stockage Azure et la base de donn√©es Azure SQL, en utilisant le r√©seau principal d'Azure. Cela garantit que le **trafic de la VNet vers le service Azure reste au sein du r√©seau Azure**, offrant ainsi un chemin plus s√©curis√© et fiable.

### **Exemple**

* Par exemple, un compte **Azure Storage** est accessible par d√©faut via Internet. En activant un **point de terminaison de service pour Azure Storage au sein de votre VNet**, vous pouvez vous assurer que seul le trafic de votre VNet peut acc√©der au compte de stockage. Le pare-feu du compte de stockage peut ensuite √™tre configur√© pour n'accepter le trafic que de votre VNet.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Diff√©rences entre les points de terminaison de service et les liens priv√©s

Microsoft recommande l'utilisation des Liens Priv√©s dans la [**documentation**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints) :

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Points de terminaison de service :**

* Le trafic de votre VNet vers le service Azure passe par le r√©seau principal de Microsoft Azure, contournant l'internet public.
* Le point de terminaison est une connexion directe au service Azure et ne fournit pas d'IP priv√©e pour le service au sein du VNet.
* Le service lui-m√™me reste accessible via son point de terminaison public depuis l'ext√©rieur de votre VNet, sauf si vous configurez le pare-feu du service pour bloquer un tel trafic.
* Il s'agit d'une relation un √† un entre le sous-r√©seau et le service Azure.
* Moins cher que les Liens Priv√©s.

**Liens Priv√©s :**

* Le Lien Priv√© mappe les services Azure dans votre VNet via un point de terminaison priv√©, qui est une interface r√©seau avec une adresse IP priv√©e au sein de votre VNet.
* Le service Azure est accessible en utilisant cette adresse IP priv√©e, le faisant appara√Ætre comme faisant partie de votre r√©seau.
* Les services connect√©s via un Lien Priv√© ne peuvent √™tre accessibles que depuis votre VNet ou les r√©seaux connect√©s ; il n'y a pas d'acc√®s √† l'internet public pour le service.
* Il permet une connexion s√©curis√©e aux services Azure ou √† vos propres services h√©berg√©s dans Azure, ainsi qu'une connexion √† des services partag√©s par d'autres.
* Il offre un contr√¥le d'acc√®s plus granulaire via un point de terminaison priv√© dans votre VNet, par opposition √† un contr√¥le d'acc√®s plus large au niveau du sous-r√©seau avec les points de terminaison de service.

En r√©sum√©, bien que les Points de terminaison de service et les Liens Priv√©s offrent une connectivit√© s√©curis√©e aux services Azure, les **Liens Priv√©s offrent un niveau plus √©lev√© d'isolation et de s√©curit√© en garantissant que les services sont accessibles de mani√®re priv√©e sans les exposer √† l'internet public**. Les Points de terminaison de service, en revanche, sont plus faciles √† configurer pour les cas g√©n√©raux o√π un acc√®s simple et s√©curis√© aux services Azure est requis sans n√©cessiter une IP priv√©e dans le VNet.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** est un point d'entr√©e √©volutif et s√©curis√© pour la **livraison rapide** de vos applications web mondiales. Il **combine** divers services tels que l'√©quilibrage de charge global, l'acc√©l√©ration de site, le d√©chargement SSL et les capacit√©s de pare-feu d'application web (WAF) en un seul service. Azure Front Door fournit un routage intelligent bas√© sur la **localisation du bord la plus proche de l'utilisateur**, garantissant des performances et une fiabilit√© optimales. De plus, il offre un routage bas√© sur l'URL, l'h√©bergement de plusieurs sites, l'affinit√© de session et la s√©curit√© de la couche applicative.

**Azure Front Door WAF** est con√ßu pour **prot√©ger les applications web contre les attaques bas√©es sur le web** sans modification du code en arri√®re-plan. Il inclut des r√®gles personnalis√©es et des ensembles de r√®gles g√©r√©s pour se prot√©ger contre des menaces telles que les injections SQL, les scripts entre sites et autres attaques courantes.

### **Exemple**

* Imaginez que vous avez une application distribu√©e mondialement avec des utilisateurs du monde entier. Vous pouvez utiliser Azure Front Door pour **router les demandes des utilisateurs vers le centre de donn√©es r√©gional le plus proche** h√©bergeant votre application, r√©duisant ainsi la latence, am√©liorant l'exp√©rience utilisateur et **la prot√©geant des attaques web avec les capacit√©s du WAF**. Si une r√©gion particuli√®re rencontre une panne, Azure Front Door peut automatiquement rediriger le trafic vers le meilleur emplacement suivant, assurant une haute disponibilit√©.

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway et Azure Application Gateway WAF

Azure Application Gateway est un **√©quilibreur de charge de trafic web** qui vous permet de g√©rer le trafic vers vos **applications web**. Il offre un **√©quilibrage de charge de couche 7, une terminaison SSL et des capacit√©s de pare-feu d'application web (WAF)** dans le contr√¥leur de livraison d'application (ADC) en tant que service. Les fonctionnalit√©s cl√©s incluent le routage bas√© sur l'URL, l'affinit√© de session bas√©e sur les cookies et le d√©chargement de la couche de sockets s√©curis√©e (SSL), qui sont cruciaux pour les applications n√©cessitant des capacit√©s d'√©quilibrage de charge complexes telles que le routage global et le routage bas√© sur le chemin.

### Exemple

* Consid√©rez un sc√©nario o√π vous avez un site web de commerce √©lectronique qui comprend plusieurs sous-domaines pour diff√©rentes fonctions, telles que les comptes utilisateurs et le traitement des paiements. Azure Application Gateway peut **router le trafic vers les serveurs web appropri√©s en fonction du chemin de l'URL**. Par exemple, le trafic vers `exemple.com/comptes` pourrait √™tre dirig√© vers le service des comptes utilisateurs, et le trafic vers `exemple.com/paiement` pourrait √™tre dirig√© vers le service de traitement des paiements.\
Et **prot√©ger votre site web contre les attaques en utilisant les capacit√©s du WAF.**

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** est une fonctionnalit√© de r√©seau dans Azure qui **permet √† diff√©rents r√©seaux virtuels (VNets) d'√™tre connect√©s directement et de mani√®re transparente**. Gr√¢ce au VNet peering, les ressources dans un VNet peuvent communiquer avec les ressources dans un autre VNet en utilisant des adresses IP priv√©es, **comme s'ils √©taient dans le m√™me r√©seau**.\
**Le VNet Peering peut √©galement √™tre utilis√© avec des r√©seaux sur site** en configurant un VPN site √† site ou Azure ExpressRoute.

**Azure Hub and Spoke** est une topologie de r√©seau utilis√©e dans Azure pour g√©rer et organiser le trafic r√©seau. **Le "hub" est un point central qui contr√¥le et route le trafic entre les diff√©rents "spokes"**. Le hub contient g√©n√©ralement des services partag√©s tels que des appliances virtuelles r√©seau (NVAs), la passerelle VPN Azure, le pare-feu Azure ou Azure Bastion. Les **"spokes" sont des VNets qui h√©bergent des charges de travail et se connectent au hub en utilisant le VNet peering**, leur permettant de tirer parti des services partag√©s au sein du hub. Ce mod√®le favorise une disposition r√©seau claire, r√©duisant la complexit√© en centralisant les services communs que plusieurs charges de travail √† travers diff√©rents VNets peuvent utiliser.

{% hint style="danger" %}
**Le VNET pairing n'est pas transitif dans Azure**, ce qui signifie que si le spoke 1 est connect√© au spoke 2 et que le spoke 2 est connect√© au spoke 3, alors le spoke 1 ne peut pas communiquer directement avec le spoke 3.
{% endhint %}

### Exemples

* Imaginez une entreprise avec des d√©partements s√©par√©s tels que Ventes, RH et D√©veloppement, **chacun avec son propre VNet (les spokes)**. Ces VNets **ont besoin d'acc√©der √† des ressources partag√©es** telles qu'une base de donn√©es centrale, un pare-feu et une passerelle Internet, qui sont tous situ√©s dans **un autre VNet (le hub)**. En utilisant le mod√®le Hub and Spoke, chaque d√©partement peut **se connecter de mani√®re s√©curis√©e aux ressources partag√©es via le VNet du hub sans exposer ces ressources √† Internet public** ou cr√©er une structure r√©seau complexe avec de nombreuses connexions.

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## VPN de site √† site

Un VPN de site √† site dans Azure vous permet de **connecter votre r√©seau sur site √† votre r√©seau virtuel Azure (VNet)**, permettant aux ressources telles que les VM dans Azure d'appara√Ætre comme si elles √©taient sur votre r√©seau local. Cette connexion est √©tablie via un **passerelle VPN qui chiffre le trafic** entre les deux r√©seaux.

### **Exemple**

* Une entreprise avec son si√®ge principal situ√© √† New York dispose d'un centre de donn√©es sur site qui doit se connecter de mani√®re s√©curis√©e √† son VNet dans Azure, qui h√©berge ses charges de travail virtualis√©es. En configurant un **VPN de site √† site, l'entreprise peut garantir une connectivit√© chiffr√©e entre les serveurs sur site et les VM Azure**, permettant aux ressources d'√™tre accessibles de mani√®re s√©curis√©e dans les deux environnements comme s'ils √©taient sur le m√™me r√©seau local.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute est un service qui fournit une **connexion priv√©e, d√©di√©e et haut d√©bit entre votre infrastructure sur site et les centres de donn√©es Azure**. Cette connexion est √©tablie via un fournisseur de connectivit√©, contournant l'internet public et offrant plus de fiabilit√©, des vitesses plus rapides, des latences plus faibles et une s√©curit√© accrue par rapport aux connexions internet classiques.

### **Exemple**

* Une soci√©t√© multinationale n√©cessite une **connexion constante et fiable √† ses services Azure en raison du volume √©lev√© de donn√©es** et du besoin de haut d√©bit. La soci√©t√© opte pour Azure ExpressRoute pour connecter directement son centre de donn√©es sur site √† Azure, facilitant les transferts de donn√©es √† grande √©chelle, tels que les sauvegardes quotidiennes et l'analyse de donn√©es en temps r√©el, avec une confidentialit√© et une vitesse am√©lior√©es.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert Red Team AWS de HackTricks)</strong></a><strong>!</strong></summary>

D'autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
