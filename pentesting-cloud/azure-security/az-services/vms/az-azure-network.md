# Az - Azure Netzwerk

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github Repositories einreichen.

</details>

## Grundlegende Informationen

Netzwerke innerhalb von Azure fungieren als integraler Bestandteil seiner Cloud-Computing-Plattform und erm√∂glichen die **Verbindung und Kommunikation zwischen verschiedenen Azure-Diensten und Ressourcen**. Die Netzwerkarchitektur in Azure ist darauf ausgelegt, hoch skalierbar, sicher und anpassbar zu sein.

Azure bietet im Kern ein **virtuelles Netzwerk (VNet)**, das es Benutzern erm√∂glicht, **isolierte Netzwerke** innerhalb der Azure-Cloud zu erstellen. Innerhalb dieser VNets k√∂nnen Ressourcen wie virtuelle Maschinen, Anwendungen und Datenbanken sicher gehostet und verwaltet werden. Das Networking in Azure unterst√ºtzt sowohl die Kommunikation innerhalb der Cloud (zwischen Azure-Diensten) als auch die Verbindung zu externen Netzwerken und dem Internet.

**Sicherheit** ist ein entscheidender Aspekt des Azure-Netzwerks, mit verschiedenen Tools und Diensten zum Schutz von Daten, zur Verwaltung des Zugriffs und zur Gew√§hrleistung der Compliance. Diese Sicherheitsma√ünahmen umfassen **Firewalls**, **Netzwerksicherheitsgruppen** und **Verschl√ºsselungs**-Funktionen, die eine hohe Kontrolle √ºber den Datenverkehr und den Zugriff erm√∂glichen.

Insgesamt sind die Netzwerkfunktionen von Azure darauf ausgelegt, Flexibilit√§t zu bieten, sodass Benutzer eine Netzwerkumgebung erstellen k√∂nnen, die ihren spezifischen Anwendungs- und Arbeitslastanforderungen entspricht, w√§hrend ein starker Schwerpunkt auf Sicherheit und Zuverl√§ssigkeit gelegt wird.

## Virtuelles Netzwerk (VNET) & Subnetze

Ein VNet in Azure ist im Wesentlichen eine Darstellung Ihres eigenen Netzwerks in der Cloud. Es handelt sich um eine **logische Isolierung der Azure-Cloud, die Ihrem Abonnement gewidmet ist**. Ein VNet erm√∂glicht es Ihnen, virtuelle private Netzwerke (VPNs) in Azure bereitzustellen und zu verwalten und kann verwendet werden, um verschiedene Arten von Azure-Ressourcen wie Virtuelle Maschinen (VMs), Datenbanken und Anwendungsdienste zu hosten und zu **verwalten**.

VNets bieten Ihnen **volle Kontrolle √ºber Ihre Netzwerkeinstellungen**, einschlie√ülich **IP-Adressbereichen, Subnetzerstellung, Routentabellen und Netzwerkgateways**.

Ein **Subnetz** ist ein **Bereich von IP-Adressen in Ihrem VNet**. Sie k√∂nnen ein VNet in mehrere Subnetze unterteilen, um Organisation und Sicherheit zu gew√§hrleisten. Jedes Subnetz in einem VNet kann verwendet werden, um Ressourcen gem√§√ü Ihrer Netzwerk- und Anwendungsarchitektur zu isolieren und zu gruppieren.

Dar√ºber hinaus erm√∂glichen es Subnetze, Ihr VNet in ein oder mehrere Teilnetze zu **unterteilen**, die einen Bereich von IP-Adressen bereitstellen, den Ressourcen nutzen k√∂nnen.

### **Beispiel**

* Angenommen, Sie haben ein VNet mit dem Namen `MyVNet` mit einem IP-Adressbereich von `10.0.0.0/16`. Sie k√∂nnen ein Subnetz innerhalb dieses VNets erstellen, sagen wir `Subnet-1`, mit einem IP-Adressbereich von `10.0.0.0/24` zur Bereitstellung Ihrer Webserver. Ein weiteres Subnetz, `Subnet-2` mit einem Bereich von `10.0.1.0/24`, k√∂nnte f√ºr Ihre Datenbankserver verwendet werden. Diese Segmentierung erm√∂glicht eine effiziente Verwaltung und Sicherheitskontrollen innerhalb des Netzwerks.

### Enumeration

Um alle VNets und Subnetze in einem Azure-Konto aufzulisten, k√∂nnen Sie die Azure-Befehlszeilenschnittstelle (CLI) verwenden. Hier sind die Schritte:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Netzwerksicherheitsgruppen (NSG)

In Azure dient eine **Netzwerksicherheitsgruppe (NSG)** haupts√§chlich dazu, den Netzwerkverkehr zu filtern, der sowohl zu als auch von Azure-Ressourcen innerhalb eines Azure Virtual Network (VNet) flie√üt. Sie enth√§lt eine Reihe von **Sicherheitsregeln**, die den Fluss des Netzwerkverkehrs genau festlegen.

Wichtige Aspekte von NSG sind:

- **Verkehrssteuerung**: Jede NSG enth√§lt Regeln, die entweder dabei helfen, den ein- und ausgehenden Netzwerkverkehr von verschiedenen Azure-Ressourcen zu erlauben oder zu blockieren.
- **Regelkomponenten**: Die Regeln innerhalb einer NSG sind sehr spezifisch und filtern den Verkehr basierend auf Kriterien wie Quell-/Ziel-IP-Adresse, Port und Protokoll. Diese Spezifit√§t erm√∂glicht eine granulare Verwaltung des Netzwerkverkehrs.
- **Sicherheitsverbesserung**: Indem nur autorisierter Verkehr in Ihre Azure-Ressourcen gelangen oder diese verlassen kann, spielen NSGs eine entscheidende Rolle bei der St√§rkung der Sicherheitslage Ihrer Netzwerkinfrastruktur.


### **Beispiel**

* Stellen Sie sich vor, Sie haben eine NSG mit dem Namen `MeineNSG`, die auf ein Subnetz oder eine spezifische virtuelle Maschine in Ihrem VNet angewendet wird. Sie k√∂nnen Regeln erstellen wie:
* Eine eingehende Regel, die den HTTP-Verkehr (Port 80) von jeder Quelle zu Ihren Webservern erlaubt.
* Eine ausgehende Regel, die nur SQL-Verkehr (Port 1433) zu einem bestimmten Ziel-IP-Adressbereich erlaubt.

### Enumeration

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall ist ein verwalteter, cloudbasierter **Netzwerksicherheitsdienst, der Ihre Azure Virtual Network-Ressourcen sch√ºtzt**. Es handelt sich um eine vollst√§ndig zustandsbehaftete Firewall als Dienst mit integrierten Funktionen f√ºr hohe Verf√ºgbarkeit und Skalierbarkeit.

Azure Firewall bietet **fortgeschrittenere** Funktionen als **NSGs**, einschlie√ülich **Filterung auf Anwendungsebene**, Filterung auf Netzwerkebene, Filterung basierend auf Bedrohungsintelligenz und Integration mit Azure Monitor f√ºr Protokollierung und Analyse.\
Es kann den ausgehenden, eingehenden, Sprechen-zu-Sprechen-, VPN- und ExpressRoute-Verkehr filtern. **Firewall-Regeln k√∂nnen basierend auf FQDN (Vollst√§ndig qualifizierter Dom√§nenname), IP-Adressen und Ports erstellt werden**.

### Unterschiede zwischen Azure Firewall und NSGs&#x20;

1. **Umfang:**
* **NSG:** Funktioniert auf der Subnetz- oder Netzwerkschnittstellenebene. Es soll grundlegende Filterung des ein- und ausgehenden Datenverkehrs von Netzwerkschnittstellen (NIC), VMs oder Subnetzen bereitstellen.
* **Azure Firewall:** Arbeitet auf der VNet-Ebene und bietet einen breiteren Schutzumfang. Es ist darauf ausgelegt, Ihre virtuellen Netzwerkressourcen zu sichern und den Datenverkehr rein und raus des VNet zu verwalten.
2. **F√§higkeiten:**
* **NSG:** Bietet grundlegende Filterfunktionen basierend auf IP-Adresse, Port und Protokoll. Es unterst√ºtzt keine fortgeschrittenen Funktionen wie Inspektion auf Anwendungsebene oder Bedrohungsintelligenz.
* **Azure Firewall:** Bietet fortgeschrittene Funktionen wie Filterung des Datenverkehrs auf Anwendungsebene (Layer 7), Filterung basierend auf Bedrohungsintelligenz, Netzwerkdatenverkehr und mehr. Es unterst√ºtzt auch mehrere √∂ffentliche IP-Adressen.
3. **Anwendungsf√§lle:**
* **NSG:** Ideal f√ºr grundlegende Filterung des Netzwerkdatenverkehrs auf Ebene des Netzwerks.
* **Azure Firewall:** Geeignet f√ºr komplexere Filterungsszenarien, bei denen Steuerung auf Anwendungsebene, Protokollierung und Bedrohungsintelligenz erforderlich sind.
4. **Verwaltung und √úberwachung:**
* **NSG:** Bietet grundlegende Protokollierung und Integration mit Azure Monitor.
* **Azure Firewall:** Bietet erweiterte Protokollierungs- und Analysefunktionen √ºber Azure Monitor, die f√ºr das Verst√§ndnis der Art und des Musters des Datenverkehrs unerl√§sslich sind.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Netzwerk-Virtualisierungsger√§t (NVA)

Ein Netzwerk-Virtualisierungsger√§t (**NVA**) in Azure ist ein virtuelles Ger√§t, das **Netzwerkfunktionen innerhalb eines virtuellen Netzwerks ausf√ºhrt**. NVAs werden typischerweise f√ºr Netzwerkfunktionen verwendet, die in Azure **nicht nativ verf√ºgbar** sind oder wenn mehr Anpassung erforderlich ist. Sie sind im Wesentlichen **VMs, die Netzwerkanwendungen oder -dienste ausf√ºhren**, wie Firewalls, WAN-Optimierer oder Lastenausgleicher.

NVAs werden f√ºr komplexe Routing-, **Sicherheits-** und **Netzwerkverkehrsverwaltungsaufgaben** verwendet. Sie k√∂nnen aus dem Azure **Marketplace** bereitgestellt werden, wo viele Drittanbieter ihre Ger√§te anbieten, die f√ºr die Integration in Azure-Umgebungen bereit sind.

### **Beispiel**

* Eine Organisation kann ein NVA in Azure bereitstellen, um eine **benutzerdefinierte Firewall-L√∂sung** zu erstellen. Dieses NVA k√∂nnte eine **Firewall-Software von Drittanbietern** ausf√ºhren und erweiterte Funktionen wie Eindringungserkennung, Paketinspektion oder VPN-Konnektivit√§t bieten. Das NVA kann so konfiguriert werden, dass es den durchlaufenden Datenverkehr √ºberpr√ºft und filtert, um sicherzustellen, dass erweiterte Sicherheitsma√ünahmen gem√§√ü den Richtlinien der Organisation implementiert sind.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Routentabellen & Benutzerdefinierte Routen (UDR)

**Azure Routentabellen** sind eine Funktion innerhalb von Microsoft Azure, die die **Steuerung der Netzwerkverkehrsweiterleitung innerhalb von Azure Virtual Networks (VNets)** erm√∂glicht. Sie definieren im Wesentlichen, wie **Pakete** zwischen Subnetzen innerhalb von VNets, zwischen VNets oder zu externen Netzwerken **weitergeleitet** werden. Jede Routentabelle enth√§lt eine Reihe von Regeln, bekannt als Routen, die angeben, wie Pakete basierend auf ihren Ziel-IP-Adressen geroutet werden sollen.

**Benutzerdefinierte Routen (UDR)** in Azure sind **benutzerdefinierte Routen, die Sie innerhalb von Azure Routentabellen erstellen**, um den **Fluss des Netzwerkverkehrs** innerhalb und zwischen Azure Virtual Networks (VNets) sowie zu externen Verbindungen zu steuern. UDRs geben Ihnen die Flexibilit√§t, den Netzwerkverkehr gem√§√ü Ihren spezifischen Anforderungen zu lenken und Azure's Standard-Routingentscheidungen au√üer Kraft zu setzen.

Diese Routen sind besonders n√ºtzlich f√ºr Szenarien, in denen Sie den Verkehr durch eine virtuelle Appliance routen m√ºssen, einen spezifischen Pfad f√ºr Sicherheits- oder Richtlinienkonformit√§t durchsetzen m√ºssen oder mit On-Premises-Netzwerken integrieren m√ºssen.

### **Beispiel**

* Angenommen, Sie haben eine Network Virtual Appliance (NVA) bereitgestellt, um den Verkehr zwischen Subnetzen innerhalb eines VNets zu inspizieren. Sie k√∂nnen eine UDR erstellen, die den gesamten Verkehr von einem Subnetz zu einem anderen Subnetz durch die NVA leitet. Diese UDR stellt sicher, dass die NVA den Verkehr zu Sicherheitszwecken inspiziert, bevor er sein Ziel erreicht.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link ist ein Dienst in Azure, der **privaten Zugriff auf Azure-Dienste erm√∂glicht**, indem sichergestellt wird, dass der **Datenverkehr zwischen Ihrem Azure Virtual Network (VNet) und dem Dienst ausschlie√ülich innerhalb des Azure-Backbonenetzwerks von Microsoft** verl√§uft. Es bringt den Dienst effektiv in Ihr VNet. Diese Konfiguration erh√∂ht die Sicherheit, da die Daten nicht dem √∂ffentlichen Internet ausgesetzt sind.

Private Link kann mit verschiedenen Azure-Diensten wie Azure Storage, Azure SQL-Datenbank und benutzerdefinierten Diensten verwendet werden, die √ºber Private Link freigegeben sind. Es bietet eine sichere M√∂glichkeit, Dienste aus Ihrem eigenen VNet oder sogar aus verschiedenen Azure-Abonnements zu nutzen.

{% hint style="danger" %}
NSGs gelten nicht f√ºr private Endpunkte, was eindeutig bedeutet, dass die Zuordnung eines NSG zu einem Subnetz, das den Private Link enth√§lt, keine Auswirkungen hat.
{% endhint %}

### **Beispiel**

* Nehmen Sie an, Sie haben eine **Azure SQL-Datenbank, auf die Sie sicher von Ihrem VNet aus zugreifen m√∂chten**. Normalerweise w√ºrde dies die Nutzung des √∂ffentlichen Internets beinhalten. Mit Private Link k√∂nnen Sie einen **privaten Endpunkt in Ihrem VNet erstellen**, der direkt mit dem Azure SQL-Datenbankdienst verbunden ist. Dieser Endpunkt l√§sst die Datenbank so erscheinen, als ob sie Teil Ihres eigenen VNet w√§re, erreichbar √ºber eine private IP-Adresse, was einen sicheren und privaten Zugriff gew√§hrleistet.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure-Dienstendpunkte

Azure-Dienstendpunkte erweitern Ihren privaten Adressraum des virtuellen Netzwerks und die Identit√§t Ihres VNets zu Azure-Diensten √ºber eine direkte Verbindung. Durch Aktivieren von Dienstendpunkten k√∂nnen **Ressourcen in Ihrem VNet sicher mit Azure-Diensten verbinden**, wie z. B. Azure Storage und Azure SQL-Datenbank, unter Verwendung des Azure-Backbonenetzwerks. Dies stellt sicher, dass der **Datenverkehr vom VNet zum Azure-Dienst innerhalb des Azure-Netzwerks bleibt**, was einen sichereren und zuverl√§ssigeren Pfad bietet.

### **Beispiel**

* Zum Beispiel ist ein **Azure Storage**-Konto standardm√§√üig √ºber das √∂ffentliche Internet erreichbar. Durch Aktivieren eines **Dienstendpunkts f√ºr Azure Storage innerhalb Ihres VNets** k√∂nnen Sie sicherstellen, dass nur der Datenverkehr aus Ihrem VNet auf das Speicherkonto zugreifen kann. Die Firewall des Speicherkontos kann dann so konfiguriert werden, dass nur Datenverkehr aus Ihrem VNet akzeptiert wird.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Unterschiede zwischen Service-Endpunkten und privaten Verkn√ºpfungen

Microsoft empfiehlt die Verwendung von privaten Verkn√ºpfungen in der [**Dokumentation**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Service-Endpunkte:**

* Der Datenverkehr von Ihrem VNet zum Azure-Dienst verl√§uft √ºber das Microsoft Azure-Backbonenetzwerk und umgeht das √∂ffentliche Internet.
* Der Endpunkt ist eine direkte Verbindung zum Azure-Dienst und stellt keine private IP f√ºr den Dienst innerhalb des VNet bereit.
* Der Dienst selbst ist weiterhin √ºber seinen √∂ffentlichen Endpunkt von au√üerhalb Ihres VNet erreichbar, es sei denn, Sie konfigurieren die Dienstfirewall, um einen solchen Datenverkehr zu blockieren.
* Es besteht eine Eins-zu-Eins-Beziehung zwischen dem Subnetz und dem Azure-Dienst.
* G√ºnstiger als private Verkn√ºpfungen.

**Private Verkn√ºpfungen:**

* Private Link ordnet Azure-Dienste √ºber einen privaten Endpunkt in Ihr VNet ein, der eine Netzwerkschnittstelle mit einer privaten IP-Adresse innerhalb Ihres VNet ist.
* Der Azure-Dienst wird √ºber diese private IP-Adresse aufgerufen, sodass er wie ein Teil Ihres Netzwerks erscheint.
* √úber Private Link verbundene Dienste k√∂nnen nur von Ihrem VNet oder verbundenen Netzwerken aus zugegriffen werden; es gibt keinen √∂ffentlichen Internetzugriff auf den Dienst.
* Es erm√∂glicht eine sichere Verbindung zu Azure-Diensten oder Ihren eigenen in Azure gehosteten Diensten sowie eine Verbindung zu von anderen geteilten Diensten.
* Es bietet eine genauere Zugriffssteuerung √ºber einen privaten Endpunkt in Ihrem VNet im Gegensatz zu einer breiteren Zugriffssteuerung auf Subnetzebene mit Service-Endpunkten.

Zusammenfassend bieten sowohl Service-Endpunkte als auch private Verkn√ºpfungen eine sichere Konnektivit√§t zu Azure-Diensten, **Private Links bieten jedoch ein h√∂heres Ma√ü an Isolation und Sicherheit, indem sichergestellt wird, dass Dienste privat zugegriffen werden, ohne sie dem √∂ffentlichen Internet auszusetzen**. Service-Endpunkte hingegen sind einfacher einzurichten f√ºr allgemeine F√§lle, in denen ein einfacher, sicherer Zugriff auf Azure-Dienste erforderlich ist, ohne die Notwendigkeit einer privaten IP im VNet.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** ist ein skalierbarer und sicherer Einstiegspunkt f√ºr die **schnelle Bereitstellung** Ihrer globalen Webanwendungen. Es **kombiniert** verschiedene Dienste wie globales **Lastenausgleich, Seitenbeschleunigung, SSL-Entlastung und Web Application Firewall (WAF)**-Funktionen in einem einzigen Dienst. Azure Front Door bietet eine intelligente Routenf√ºhrung basierend auf dem **n√§chsten Edge-Standort des Benutzers**, um optimale Leistung und Zuverl√§ssigkeit zu gew√§hrleisten. Dar√ºber hinaus bietet es routenbasierte Routenf√ºhrung, Hosting mehrerer Websites, Sitzungsaffinit√§t und Sicherheit auf Anwendungsebene.

**Azure Front Door WAF** ist darauf ausgelegt, Webanwendungen vor webbasierten Angriffen zu sch√ºtzen, ohne dass √Ñnderungen am Backend-Code erforderlich sind. Es enth√§lt benutzerdefinierte Regeln und verwaltete Regelsets zum Schutz vor Bedrohungen wie SQL-Injektion, Cross-Site-Scripting und anderen g√§ngigen Angriffen.

### **Beispiel**

* Stellen Sie sich vor, Sie haben eine global verteilte Anwendung mit Benutzern auf der ganzen Welt. Sie k√∂nnen Azure Front Door verwenden, um Benutzeranfragen zum n√§chstgelegenen regionalen Rechenzentrum zu **leiten, das Ihre Anwendung hostet, um die Latenz zu reduzieren, die Benutzererfahrung zu verbessern und sie vor Webangriffen mit den WAF-Funktionen zu sch√ºtzen**. Wenn eine bestimmte Region Ausfallzeiten hat, kann Azure Front Door den Datenverkehr automatisch zum n√§chsten besten Standort umleiten, um eine hohe Verf√ºgbarkeit sicherzustellen.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway und Azure Application Gateway WAF

Azure Application Gateway ist ein **Web-Traffic-Lastenausgleicher**, der es Ihnen erm√∂glicht, den Verkehr zu Ihren **Web**-Anwendungen zu verwalten. Es bietet **Layer 7-Lastenausgleich, SSL-Terminierung und Web Application Firewall (WAF)-Funktionen** im Application Delivery Controller (ADC) als Service. Zu den wichtigsten Funktionen geh√∂ren routing basierend auf URLs, session affinity basierend auf Cookies und SSL-Entlastung, die f√ºr Anwendungen, die komplexe Lastenausgleichsfunktionen wie globales Routing und routing basierend auf Pfaden erfordern, entscheidend sind.

### Beispiel

* Betrachten Sie ein Szenario, in dem Sie eine E-Commerce-Website haben, die mehrere Subdomains f√ºr verschiedene Funktionen wie Benutzerkonten und Zahlungsabwicklung enth√§lt. Azure Application Gateway kann **den Verkehr basierend auf dem URL-Pfad zu den entsprechenden Webservern leiten**. Zum Beispiel k√∂nnte der Verkehr zu `beispiel.com/konten` zum Benutzerkonten-Service geleitet werden und der Verkehr zu `beispiel.com/zahlen` zum Zahlungsabwicklungs-Service.\
Und **sch√ºtzen Sie Ihre Website vor Angriffen mithilfe der WAF-Funktionen**.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** ist ein Netzwerkfeature in Azure, das es **erm√∂glicht, verschiedene virtuelle Netzwerke (VNets) direkt und nahtlos zu verbinden**. Durch VNet-Peering k√∂nnen Ressourcen in einem VNet mit Ressourcen in einem anderen VNet √ºber private IP-Adressen kommunizieren, **als ob sie sich im selben Netzwerk befinden w√ºrden**.\
**VNet-Peering kann auch mit On-Premise-Netzwerken verwendet werden**, indem eine Site-to-Site-VPN oder Azure ExpressRoute eingerichtet wird.

**Azure Hub und Spoke** ist eine Netzwerktopologie, die in Azure zur Verwaltung und Organisation des Netzwerkverkehrs verwendet wird. **Der "Hub" ist ein zentraler Punkt, der den Verkehr zwischen verschiedenen "Spokes" steuert und routet**. Der Hub enth√§lt in der Regel gemeinsam genutzte Dienste wie Netzwerk-Virtualisierungsger√§te (NVAs), Azure VPN Gateway, Azure Firewall oder Azure Bastion. Die **"Spokes" sind VNets, die Workloads hosten und √ºber VNet-Peering mit dem Hub verbunden sind**, was es ihnen erm√∂glicht, die gemeinsam genutzten Dienste im Hub zu nutzen. Dieses Modell f√∂rdert ein sauberes Netzwerklayout, reduziert die Komplexit√§t durch die Zentralisierung gemeinsamer Dienste, die von mehreren Workloads in verschiedenen VNets genutzt werden k√∂nnen.

{% hint style="danger" %}
**VNET-Peering ist in Azure nicht transitiv**, was bedeutet, dass, wenn Spoke 1 mit Spoke 2 verbunden ist und Spoke 2 mit Spoke 3 verbunden ist, Spoke 1 nicht direkt mit Spoke 3 kommunizieren kann.
{% endhint %}

### Beispiele

* Stellen Sie sich ein Unternehmen mit separaten Abteilungen wie Vertrieb, Personalwesen und Entwicklung vor, **jede mit ihrem eigenen VNet (den Spokes)**. Diese VNets **ben√∂tigen Zugriff auf gemeinsam genutzte Ressourcen** wie eine zentrale Datenbank, eine Firewall und ein Internet-Gateway, die sich alle in **einem anderen VNet (dem Hub)** befinden. Durch Verwendung des Hub- und Spoke-Modells kann jede Abteilung **sicher mit den gemeinsam genutzten Ressourcen √ºber das Hub-VNet verbunden werden, ohne diese Ressourcen dem √∂ffentlichen Internet auszusetzen** oder eine komplexe Netzwerkstruktur mit zahlreichen Verbindungen zu erstellen.

### Enumeration

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Ein Site-to-Site-VPN in Azure erm√∂glicht es Ihnen, **Ihr lokales Netzwerk mit Ihrem Azure Virtual Network (VNet) zu verbinden**, sodass Ressourcen wie VMs innerhalb von Azure so erscheinen, als w√§ren sie in Ihrem lokalen Netzwerk. Diese Verbindung wird √ºber ein **VPN-Gateway hergestellt, das den Datenverkehr zwischen den beiden Netzwerken verschl√ºsselt**.

### **Beispiel**

* Ein Unternehmen mit seinem Hauptsitz in New York verf√ºgt √ºber ein lokales Rechenzentrum, das sicher mit seinem VNet in Azure verbunden werden muss, in dem seine virtualisierten Workloads gehostet werden. Durch Einrichten eines **Site-to-Site-VPNs kann das Unternehmen eine verschl√ºsselte Konnektivit√§t zwischen den lokalen Servern und den Azure-VMs sicherstellen**, sodass Ressourcen sicher in beiden Umgebungen abgerufen werden k√∂nnen, als ob sie sich im selben lokalen Netzwerk befinden.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute ist ein Dienst, der eine **private, dedizierte, Hochgeschwindigkeitsverbindung zwischen Ihrer lokalen Infrastruktur und den Azure-Rechenzentren** bereitstellt. Diese Verbindung erfolgt √ºber einen Konnektivit√§tsanbieter, umgeht das √∂ffentliche Internet und bietet mehr Zuverl√§ssigkeit, schnellere Geschwindigkeiten, geringere Latenzen und h√∂here Sicherheit als typische Internetverbindungen.

### **Beispiel**

* Ein multinationales Unternehmen ben√∂tigt eine **konsistente und zuverl√§ssige Verbindung zu seinen Azure-Diensten aufgrund des hohen Datenvolumens** und des Bedarfs an hoher Durchsatzleistung. Das Unternehmen entscheidet sich f√ºr Azure ExpressRoute, um sein lokales Rechenzentrum direkt mit Azure zu verbinden, um gro√ü angelegte Datentransfers wie t√§gliche Backups und Echtzeit-Datenanalysen mit verbesserter Privatsph√§re und Geschwindigkeit zu erm√∂glichen.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys einreichen.

</details>
