# Az - Rete Azure

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informazioni di base

Le reti all'interno di Azure funzionano come parte integrante della sua piattaforma di cloud computing, consentendo la **connessione e la comunicazione tra vari servizi e risorse di Azure**. L'architettura di rete in Azure √® progettata per essere altamente scalabile, sicura e personalizzabile.

Al suo nucleo, Azure fornisce una **rete virtuale (VNet)** che consente agli utenti di creare **reti isolate** all'interno del cloud di Azure. All'interno di queste VNet, le risorse come macchine virtuali, applicazioni e database possono essere ospitate e gestite in modo sicuro. La rete in Azure supporta sia la comunicazione all'interno del cloud (tra i servizi di Azure) che la connessione a reti esterne e a Internet.

**La sicurezza** √® un aspetto critico della rete di Azure, con vari strumenti e servizi disponibili per proteggere i dati, gestire l'accesso e garantire la conformit√†. Queste misure di sicurezza includono **firewall**, **gruppi di sicurezza di rete** e **funzionalit√† di crittografia**, consentendo un elevato livello di controllo sul traffico e l'accesso.

Nel complesso, le capacit√† di rete di Azure sono progettate per offrire flessibilit√†, consentendo agli utenti di creare un ambiente di rete che soddisfi le specifiche esigenze delle proprie applicazioni e carichi di lavoro, mantenendo un forte accento sulla sicurezza e l'affidabilit√†.

## Rete virtuale (VNET) e subnet

Una VNet in Azure √® essenzialmente una rappresentazione della tua rete nel cloud. √à un'**isolazione logica del cloud di Azure dedicata alla tua sottoscrizione**. Una VNet consente di creare e gestire reti private virtuali (VPN) in Azure e pu√≤ essere utilizzata per ospitare e **gestire diversi tipi di risorse di Azure**, come macchine virtuali (VM), database e servizi applicativi.

Le VNet ti forniscono **il pieno controllo sulle impostazioni di rete**, inclusi **gli intervalli di indirizzi IP**, la creazione di subnet, le tabelle di routing e i gateway di rete.

Una **subnet** √® un **intervallo di indirizzi IP nella tua VNet**. Puoi suddividere una VNet in pi√π subnet per organizzazione e sicurezza. Ogni subnet in una VNet pu√≤ essere utilizzata per isolare e raggruppare risorse in base alla tua architettura di rete e applicazione.

Inoltre, le subnet ti consentono di **segmentare la tua VNet in una o pi√π sottoreti**, fornendo un intervallo di indirizzi IP che le risorse possono utilizzare.

### **Esempio**

* Supponiamo di avere una VNet chiamata `MyVNet` con un intervallo di indirizzi IP di `10.0.0.0/16`. Puoi creare una subnet all'interno di questa VNet, diciamo `Subnet-1`, con un intervallo di indirizzi IP di `10.0.0.0/24` per ospitare i tuoi server web. Un'altra subnet, `Subnet-2` con un intervallo di `10.0.1.0/24`, potrebbe essere utilizzata per i tuoi server di database. Questa segmentazione consente una gestione efficiente e controlli di sicurezza all'interno della rete.

### Enumerazione

Per elencare tutte le VNet e le subnet in un account Azure, √® possibile utilizzare l'interfaccia della riga di comando di Azure (CLI). Ecco i passaggi:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
## Gruppi di sicurezza di rete (NSG)

In Azure, un **Gruppo di Sicurezza di Rete (NSG)** svolge la funzione principale di filtrare il traffico di rete sia verso che da risorse Azure all'interno di una Rete Virtuale (VNet) di Azure. Contiene un insieme di **regole di sicurezza** che dettano attentamente il flusso del traffico di rete.

Gli aspetti chiave di NSG includono:

- **Controllo del Traffico**: Ogni NSG contiene regole che sono fondamentali per permettere o ostacolare il traffico di rete in entrata e in uscita associato a varie risorse Azure.
- **Componenti delle Regole**: Le regole all'interno di un NSG sono altamente specifiche, filtrando il traffico in base a criteri come l'indirizzo IP di origine/destinazione, la porta e il protocollo. Questa specificit√† consente una gestione dettagliata del traffico di rete.
- **Miglioramento della Sicurezza**: Assicurando che solo il traffico autorizzato possa entrare o uscire dalle risorse Azure, gli NSG svolgono un ruolo cruciale nel rafforzare la postura di sicurezza dell'infrastruttura di rete.

### **Esempio**

* Immagina di avere un NSG chiamato `MyNSG` applicato a una subnet o a una specifica macchina virtuale all'interno della tua VNet. Puoi creare regole come:
* Una regola in ingresso che consente il traffico HTTP (porta 80) da qualsiasi origine ai tuoi server web.
* Una regola in uscita che consente solo il traffico SQL (porta 1433) a un determinato intervallo di indirizzi IP di destinazione.

### Enumerazione

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
## Azure Firewall

Azure Firewall √® un servizio di sicurezza di rete gestito basato su cloud che protegge le risorse della tua rete virtuale Azure. √à un firewall completamente stateful come servizio con funzionalit√† di disponibilit√† elevata e scalabilit√† integrate.

Azure Firewall fornisce funzionalit√† pi√π avanzate rispetto alle NSG, tra cui filtraggio a livello di applicazione, filtraggio a livello di rete, filtraggio basato su threat intelligence e integrazione con Azure Monitor per il logging e l'analisi. Pu√≤ filtrare il traffico in uscita, in ingresso, tra spoke, VPN ed ExpressRoute. Le regole del firewall possono essere create in base a FQDN (Fully Qualified Domain Name), indirizzi IP e porte.

### Differenze tra Azure Firewall e NSGs

1. **Ambito:**
* **NSG:** Funziona a livello di subnet o interfaccia di rete. √à destinato a fornire un filtraggio di base del traffico in ingresso e in uscita dalle interfacce di rete (NIC), dalle VM o dalle subnet.
* **Azure Firewall:** Opera a livello di VNet, offrendo un ambito di protezione pi√π ampio. √à progettato per proteggere le risorse della tua rete virtuale e gestire il flusso di traffico dentro e fuori la VNet.
2. **Funzionalit√†:**
* **NSG:** Fornisce funzionalit√† di filtraggio di base basate su indirizzo IP, porta e protocollo. Non supporta funzionalit√† avanzate come l'ispezione a livello di applicazione o l'intelligence sulle minacce.
* **Azure Firewall:** Offre funzionalit√† avanzate come il filtraggio del traffico a livello di applicazione (Layer 7), il filtraggio basato su intelligence sulle minacce, il filtraggio del traffico di rete e altro ancora. Supporta anche pi√π indirizzi IP pubblici.
3. **Casi d'uso:**
* **NSG:** Ideale per il filtraggio di base del traffico a livello di rete.
* **Azure Firewall:** Adatto per scenari di filtraggio pi√π complessi in cui √® necessario il controllo a livello di applicazione, il logging e l'intelligence sulle minacce.
4. **Gestione e monitoraggio:**
* **NSG:** Offre un logging di base e l'integrazione con Azure Monitor.
* **Azure Firewall:** Fornisce funzionalit√† avanzate di logging e analisi tramite Azure Monitor, che sono essenziali per comprendere la natura e il pattern del traffico.

### Enumerazione

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
## Network Virtual Appliance (NVA)

Un Network Virtual Appliance (**NVA**) in Azure √® un'applicazione virtuale che **esegue funzioni di rete all'interno di una rete virtuale**. Gli NVA vengono utilizzati principalmente per funzioni di rete che **non sono disponibili nativamente** in Azure o quando √® necessaria una maggiore personalizzazione. Sono essenzialmente **VM che eseguono applicazioni o servizi di rete**, come firewall, ottimizzatori WAN o bilanciatori di carico.

Gli NVA vengono utilizzati per complesse attivit√† di routing, **sicurezza** e **gestione del traffico di rete**. Possono essere distribuiti dal **Marketplace** di Azure, dove molti fornitori di terze parti offrono le loro applicazioni pronte per l'integrazione negli ambienti Azure.

### **Esempio**

* Un'organizzazione pu√≤ distribuire un NVA in Azure per creare una **soluzione firewall personalizzata**. Questo NVA potrebbe eseguire un **software firewall di terze parti**, fornendo funzionalit√† avanzate come rilevamento delle intrusioni, ispezione dei pacchetti o connettivit√† VPN. L'NVA pu√≤ essere configurato per ispezionare e filtrare il traffico che lo attraversa, garantendo l'applicazione di misure di sicurezza avanzate in conformit√† con le politiche dell'organizzazione.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
## Tabelle di routing di Azure e Route definite dall'utente (UDR)

Le **tabelle di routing di Azure** sono una funzionalit√† all'interno di Microsoft Azure che consente di **controllare il routing del traffico di rete all'interno delle reti virtuali di Azure (VNets)**. Fondamentalmente, definiscono come i **pacchetti** vengono **inoltrati** tra i sottoreti all'interno delle VNets, tra le VNets o verso reti esterne. Ogni tabella di routing contiene un insieme di regole, note come route, che specificano come i pacchetti devono essere instradati in base ai loro indirizzi IP di destinazione.

Le **Route definite dall'utente (UDR)** in Azure sono **route personalizzate che crei all'interno delle tabelle di routing di Azure** per controllare il **flusso del traffico di rete** all'interno e tra le reti virtuali di Azure (VNets) e le connessioni esterne. Le UDR ti offrono la flessibilit√† di indirizzare il traffico di rete secondo le tue specifiche esigenze, sovrascrivendo le decisioni di routing predefinite di Azure.

Queste route sono particolarmente utili per scenari in cui √® necessario **instradare il traffico attraverso un'applicazione virtuale**, imporre un percorso specifico per motivi di sicurezza o conformit√† alle politiche o integrarsi con reti locali.

### **Esempio**

* Supponiamo che tu abbia distribuito un Network Virtual Appliance (NVA) per ispezionare il traffico tra sottoreti all'interno di una VNet. Puoi creare una UDR che indirizza tutto il traffico da una sottorete a un'altra sottorete affinch√© passi attraverso l'NVA. Questa UDR garantisce che l'NVA ispezioni il traffico per scopi di sicurezza prima che raggiunga la sua destinazione.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link √® un servizio in Azure che **consente l'accesso privato ai servizi Azure** garantendo che **il traffico tra la rete virtuale Azure (VNet) e il servizio viaggi interamente all'interno della rete principale di Azure di Microsoft**. Porta effettivamente il servizio nella tua VNet. Questa configurazione migliora la sicurezza evitando l'esposizione dei dati su Internet pubblico.

Private Link pu√≤ essere utilizzato con vari servizi Azure, come Azure Storage, Azure SQL Database e servizi personalizzati condivisi tramite Private Link. Fornisce un modo sicuro per consumare servizi all'interno della propria VNet o anche da diverse sottoscrizioni Azure.

{% hint style="danger" %}
Le NSG non si applicano agli endpoint privati, il che significa chiaramente che associare una NSG a un subnet che contiene il Private Link non avr√† alcun effetto.
{% endhint %}

### **Esempio**

* Considera uno scenario in cui hai un **Azure SQL Database a cui desideri accedere in modo sicuro dalla tua VNet**. Normalmente, ci√≤ potrebbe comportare il transito su Internet pubblico. Con Private Link, puoi creare un **endpoint privato nella tua VNet** che si connette direttamente al servizio Azure SQL Database. Questo endpoint fa apparire il database come se facesse parte della tua stessa VNet, accessibile tramite un indirizzo IP privato, garantendo cos√¨ un accesso sicuro e privato.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
## Endpoint dei servizi di Azure

Gli endpoint dei servizi di Azure estendono lo spazio degli indirizzi privati della tua rete virtuale e l'identit√† della tua VNet ai servizi di Azure tramite una connessione diretta. Abilitando gli endpoint dei servizi, **le risorse nella tua VNet possono connettersi in modo sicuro ai servizi di Azure**, come Azure Storage e Azure SQL Database, utilizzando la rete principale di Azure. Ci√≤ garantisce che il **traffico dalla VNet al servizio di Azure rimanga all'interno della rete di Azure**, offrendo un percorso pi√π sicuro e affidabile.

### **Esempio**

* Ad esempio, un account **Azure Storage** √® accessibile per impostazione predefinita tramite Internet pubblico. Abilitando un **endpoint di servizio per Azure Storage all'interno della tua VNet**, puoi garantire che solo il traffico proveniente dalla tua VNet possa accedere all'account di archiviazione. Il firewall dell'account di archiviazione pu√≤ quindi essere configurato per accettare solo il traffico proveniente dalla tua VNet.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Differenze tra Service Endpoints e Private Links

Microsoft consiglia l'uso di Private Links nella [**documentazione**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\


<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Service Endpoints:**

* Il traffico dalla tua VNet al servizio Azure viaggia sulla rete principale di Microsoft Azure, evitando l'uso di internet pubblico.
* Il punto finale √® una connessione diretta al servizio Azure e non fornisce un IP privato per il servizio all'interno della VNet.
* Il servizio stesso √® ancora accessibile tramite il suo punto finale pubblico dall'esterno della VNet, a meno che tu non configuri il firewall del servizio per bloccare tale traffico.
* √à una relazione uno a uno tra il sotto-rete e il servizio Azure.
* Meno costoso rispetto ai Private Links.

**Private Links:**

* Private Link mappa i servizi Azure nella tua VNet tramite un punto finale privato, che √® un'interfaccia di rete con un indirizzo IP privato all'interno della tua VNet.
* Il servizio Azure viene accesso utilizzando questo indirizzo IP privato, facendo apparire come se facesse parte della tua rete.
* I servizi connessi tramite Private Link possono essere accessibili solo dalla tua VNet o dalle reti connesse; non c'√® accesso a internet pubblico per il servizio.
* Consente una connessione sicura ai servizi Azure o ai tuoi servizi ospitati in Azure, cos√¨ come una connessione a servizi condivisi da altri.
* Fornisce un controllo di accesso pi√π granulare tramite un punto finale privato nella tua VNet, rispetto a un controllo di accesso pi√π ampio a livello di sotto-rete con i Service Endpoints.

In sintesi, mentre sia i Service Endpoints che i Private Links forniscono una connettivit√† sicura ai servizi Azure, **i Private Links offrono un livello pi√π elevato di isolamento e sicurezza garantendo che i servizi siano accessibili privatamente senza esporli a internet pubblico**. I Service Endpoints, d'altra parte, sono pi√π facili da configurare per casi generali in cui √® richiesto un accesso semplice e sicuro ai servizi Azure senza la necessit√† di un IP privato nella VNet.

## Azure Front Door (AFD) e AFD WAF

**Azure Front Door** √® un punto di ingresso scalabile e sicuro per la **consegna rapida** delle tue applicazioni web globali. **Combina** vari servizi come il **bilanciamento del carico globale, l'accelerazione del sito, lo scarico SSL e le capacit√† del Web Application Firewall (WAF)** in un unico servizio. Azure Front Door offre un routing intelligente basato sulla **posizione del punto di accesso pi√π vicino all'utente**, garantendo prestazioni e affidabilit√† ottimali. Inoltre, offre il routing basato su URL, l'hosting di pi√π siti, l'affinit√† di sessione e la sicurezza a livello di applicazione.

**Azure Front Door WAF** √® progettato per **proteggere le applicazioni web dagli attacchi basati sul web** senza modificare il codice di backend. Include regole personalizzate e set di regole gestite per proteggere contro minacce come l'iniezione SQL, lo scripting tra siti e altri attacchi comuni.

### **Esempio**

* Immagina di avere un'applicazione distribuita globalmente con utenti in tutto il mondo. Puoi utilizzare Azure Front Door per **instradare le richieste degli utenti al data center regionale pi√π vicino** che ospita la tua applicazione, riducendo cos√¨ la latenza, migliorando l'esperienza dell'utente e **difendendola dagli attacchi web con le capacit√† del WAF**. Se una particolare regione subisce un'interruzione, Azure Front Door pu√≤ automaticamente reindirizzare il traffico alla posizione successiva migliore, garantendo un'elevata disponibilit√†.

### Enumerazione

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway e Azure Application Gateway WAF

Azure Application Gateway √® un **bilanciatore di carico del traffico web** che consente di gestire il traffico delle tue applicazioni web. Offre **bilanciamento del carico di livello 7, terminazione SSL e capacit√† di firewall delle applicazioni web (WAF)** nel Controller di distribuzione delle applicazioni (ADC) come servizio. Le principali caratteristiche includono il routing basato sull'URL, l'affinit√† di sessione basata sui cookie e lo scarico del livello di sicurezza dei socket layer (SSL), che sono fondamentali per le applicazioni che richiedono capacit√† di bilanciamento del carico complesse come il routing globale e il routing basato sul percorso.

### Esempio

* Considera uno scenario in cui hai un sito web di e-commerce che include pi√π sottodomini per diverse funzioni, come gli account utente e l'elaborazione dei pagamenti. Azure Application Gateway pu√≤ **instradare il traffico verso i server web appropriati in base al percorso dell'URL**. Ad esempio, il traffico verso `esempio.com/account` potrebbe essere indirizzato al servizio degli account utente e il traffico verso `esempio.com/pagamento` potrebbe essere indirizzato al servizio di elaborazione dei pagamenti.\
E **proteggere il tuo sito web dagli attacchi utilizzando le capacit√† di WAF.**

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
## Azure Hub, Spoke & VNet Peering

**VNet Peering** √® una funzionalit√† di rete in Azure che **consente di connettere direttamente e in modo trasparente diverse Virtual Network (VNet)**. Attraverso il VNet peering, le risorse in una VNet possono comunicare con le risorse in un'altra VNet utilizzando indirizzi IP privati, **come se fossero nella stessa rete**.\
**Il VNet Peering pu√≤ essere utilizzato anche con reti locali** configurando una VPN site-to-site o Azure ExpressRoute.

**Azure Hub e Spoke** √® una topologia di rete utilizzata in Azure per gestire e organizzare il traffico di rete. **L'"hub" √® un punto centrale che controlla e instrada il traffico tra diversi "spoke"**. L'hub contiene tipicamente servizi condivisi come network virtual appliances (NVA), Azure VPN Gateway, Azure Firewall o Azure Bastion. **Gli "spoke" sono VNets che ospitano carichi di lavoro e si connettono all'hub utilizzando il VNet peering**, consentendo loro di sfruttare i servizi condivisi all'interno dell'hub. Questo modello promuove una struttura di rete pulita, riducendo la complessit√† centralizzando i servizi comuni che pi√π carichi di lavoro in diverse VNets possono utilizzare.

{% hint style="danger" %}
**Il VNET peering non √® transitivo in Azure**, il che significa che se lo spoke 1 √® connesso allo spoke 2 e lo spoke 2 √® connesso allo spoke 3, lo spoke 1 non pu√≤ comunicare direttamente con lo spoke 3.
{% endhint %}

### Esempi

* Immaginiamo un'azienda con dipartimenti separati come Vendite, Risorse Umane e Sviluppo, **ciascuno con la propria VNet (gli spoke)**. Queste VNets **richiedono accesso a risorse condivise** come un database centrale, un firewall e un gateway Internet, che sono tutti situati in **un'altra VNet (l'hub)**. Utilizzando il modello Hub e Spoke, ogni dipartimento pu√≤ **connettersi in modo sicuro alle risorse condivise tramite l'hub VNet senza esporre tali risorse a Internet pubblico** o creare una struttura di rete complessa con numerose connessioni.

### Enumerazione

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
## VPN da sito a sito

Una VPN da sito a sito in Azure ti consente di **connettere la tua rete in locale alla tua rete virtuale di Azure (VNet)**, consentendo alle risorse come le VM all'interno di Azure di apparire come se fossero nella tua rete locale. Questa connessione viene stabilita attraverso un **gateway VPN che crittografa il traffico** tra le due reti.

### **Esempio**

* Un'azienda con la sua sede principale a New York ha un data center in locale che deve connettersi in modo sicuro alla sua VNet in Azure, che ospita i suoi carichi di lavoro virtualizzati. Configurando una **VPN da sito a sito, l'azienda pu√≤ garantire una connettivit√† crittografata tra i server in locale e le VM di Azure**, consentendo di accedere in modo sicuro alle risorse in entrambi gli ambienti come se fossero nella stessa rete locale.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
## Azure ExpressRoute

Azure ExpressRoute √® un servizio che fornisce una connessione **privata, dedicata e ad alta velocit√† tra la tua infrastruttura on-premises e i data center di Azure**. Questa connessione avviene tramite un provider di connettivit√†, bypassando Internet pubblico e offrendo maggiore affidabilit√†, velocit√† pi√π elevate, latenze inferiori e una maggiore sicurezza rispetto alle connessioni Internet tipiche.

### **Esempio**

* Una multinazionale richiede una **connessione coerente e affidabile ai suoi servizi Azure a causa dell'alto volume di dati** e della necessit√† di un'elevata larghezza di banda. L'azienda opta per Azure ExpressRoute per connettere direttamente il proprio data center on-premises ad Azure, facilitando trasferimenti di dati su larga scala, come backup giornalieri e analisi dei dati in tempo reale, con una privacy e una velocit√† migliorate.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
