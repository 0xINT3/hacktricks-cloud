# Az - Δίκτυο Azure

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** Ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Βασικές Πληροφορίες

Τα δίκτυα εντός του Azure λειτουργούν ως αναπόσπαστο μέρος της πλατφόρμας υπολογισμού στο cloud του, επιτρέποντας τη **σύνδεση και επικοινωνία μεταξύ διάφορων υπηρεσιών και πόρων του Azure**. Η αρχιτεκτονική δικτύου στο Azure έχει σχεδιαστεί για να είναι υψηλής κλίμακας, ασφαλής και προσαρμόσιμη.

Στην ουσία, το Azure παρέχει ένα **εικονικό δίκτυο (VNet)** που επιτρέπει στους χρήστες να δημιουργούν **απομονωμένα δίκτυα** εντός του Azure cloud. Μέσα σε αυτά τα VNets, πόροι όπως εικονικές μηχανές, εφαρμογές και βάσεις δεδομένων μπορούν να φιλοξενηθούν και να διαχειριστούν με ασφάλεια. Το δίκτυο στο Azure υποστηρίζει τόσο την επικοινωνία εντός του cloud (μεταξύ υπηρεσιών του Azure) όσο και τη σύνδεση με εξωτερικά δίκτυα και το διαδίκτυο.

Η **ασφάλεια** είναι ένα κρίσιμο στοιχείο του δικτύου Azure, με διάφορα εργαλεία και υπηρεσίες διαθέσιμα για την προστασία των δεδομένων, τη διαχείριση της πρόσβασης και τη διασφάλιση της συμμόρφωσης. Αυτά τα μέτρα ασφαλείας περιλαμβάνουν **τείχη προστασίας**, **ομάδες ασφαλείας δικτύου** και **δυνατότητες κρυπτογράφησης**, επιτρέποντας ένα υψηλό επίπεδο έλεγχου της κίνησης και της πρόσβασης.

Συνολικά, οι δυνατότητες δικτύωσης του Azure έχουν σχεδιαστεί για να προσφέρουν ευελιξία, επιτρέποντας στους χρήστες να δημιουργήσουν ένα περιβάλλον δικτύου που να ταιριάζει στις συγκεκριμένες ανάγκες της εφαρμογής και του φορτίου εργασίας τους, διατηρώντας ταυτόχρονα ένα ισχυρό έμφαση στην ασφάλεια και την αξιοπιστία.

## Εικονικό Δίκτυο (VNET) & Subnets

Ένα VNet στο Azure είναι ουσιαστικά μια αναπαράσταση του δικού σας δικτύου στο cloud. Είναι μια **λογική απομόνωση του Azure cloud που είναι αφιερωμένη στη συνδρομή σας**. Ένα VNet σας επιτρέπει να παρέχετε και να διαχειρίζεστε εικονικά ιδιωτικά δίκτυα (VPNs) στο Azure και μπορεί να χρησιμοποιηθεί για τη φιλοξενία και τη **διαχείριση πολλών τύπων πόρων του Azure**, όπως εικονικές μηχανές (VMs), βάσεις δεδομένων και υπηρεσίες εφαρμογών.

Τα VNets σας παρέχουν **πλήρη έλεγχο των ρυθμίσεων του δικτύου σας**, συμπεριλαμβανομένων των εύρων διευθύνσεων **IP**, της δημιουργίας υποδικτύων, των πινάκων δρομολόγησης και των πυλών δικτύου.

Ένα **υποδίκτυο** είναι ένα **εύρος διευθύνσεων IP στο VNet σας**. Μπορείτε να χωρίσετε ένα VNet σε πολλά υποδίκτυα για οργάνωση και ασφάλεια. Κάθε υποδίκτυο σε ένα VNet μπορεί να χρησιμοποιηθεί για την απομόνωση και την ομαδοποίηση πόρων σύμφωνα με τη δικτυακή και την αρχιτεκτονική της εφαρμογής σας.

Επιπλέον, τα υποδίκτυα σας επιτρέπουν να **διαχωρίσετε το VNet σας σε ένα ή περισσότερα υπο-δίκτυα**, παρέχοντας ένα εύρος διευθύνσεων IP που μπορούν να χρησιμοποιήσουν οι πόροι.

### **Παράδειγμα**

* Υποθέστε ότι έχετε ένα VNet με το όνομα `MyVNet` και ένα εύρος διευθύνσεων IP `10.0.0.0/16`. Μπορείτε να δημιουργήσετε ένα υποδίκτυο μέσα σε αυτό το VNet, ας πούμε `Subnet-1`, με ένα εύρος διευθύνσεων IP `10.0.0.0/24` για τη φιλοξενία τ
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
## Ομάδες Ασφαλείας Δικτύου (NSG)

Στο Azure, μια **Ομάδα Ασφαλείας Δικτύου (NSG)** εξυπηρετεί την κύρια λειτουργία του φιλτραρίσματος της κίνησης δικτύου τόσο προς όσο και από τους πόρους του Azure εντός ενός Εικονικού Δικτύου (VNet) του Azure. Περιλαμβάνει ένα σύνολο από **κανόνες ασφαλείας** που διέπουν λεπτομερώς τη ροή της κίνησης δικτύου.

Κύρια χαρακτηριστικά της NSG περιλαμβάνουν:

- **Έλεγχος Κίνησης**: Κάθε NSG περιέχει κανόνες που είναι ουσιώδεις για την επιτροπή ή τον αποκλεισμό της εισερχόμενης και εξερχόμενης κίνησης δικτύου που σχετίζεται με διάφορους πόρους του Azure.
- **Στοιχεία Κανόνων**: Οι κανόνες εντός μιας NSG είναι υψηλά ειδικοί, φιλτράροντας την κίνηση βάσει κριτηρίων όπως η IP διεύθυνση προέλευσης/προορισμού, ο θύρα και το πρωτόκολλο. Αυτή η ειδικότητα επιτρέπει τη λεπτομερή διαχείριση της κίνησης δικτύου.
- **Ενίσχυση Ασφάλειας**: Με το να διασφαλίζουν ότι μόνο εξουσιοδοτημένη κίνηση μπορεί να εισέλθει ή να εξέλθει από τους πόρους του Azure σας, οι NSG παίζουν ένα κρίσιμο ρόλο στην ενίσχυση της ασφάλειας της υποδομής του δικτύου σας.


### **Παράδειγμα**

* Φανταστείτε ότι έχετε μια NSG με το όνομα `MyNSG` που εφαρμόζεται σε ένα subnet ή ένα συγκεκριμένο εικονικό μηχάνημα εντός του VNet σας. Μπορείτε να δημιουργήσετε κανόνες όπως:
* Ένας εισερχόμενος κανόνας που επιτρέπει την κίνηση HTTP (θύρα 80) από οποιαδήποτε πηγή προς τους διακομιστές ιστού σας.
* Ένας εξερχόμενος κανόνας που επιτρέπει μόνο την κίνηση SQL (θύρα 1433) προς ένα συγκεκριμένο εύρος διευθύνσεων IP προορισμού.

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
## Azure Firewall

Το Azure Firewall είναι ένα διαχειριζόμενο, βασισμένο στον cloud **υπηρεσία ασφάλειας δικτύου που προστατεύει τους πόρους του Azure Virtual Network**. Είναι ένα πλήρως κατάστασης διαδρομής ως υπηρεσία με ενσωματωμένες δυνατότητες υψηλής διαθεσιμότητας και κλιμακωσιμότητας.

Το Azure Firewall παρέχει **πιο προηγμένες** δυνατότητες από τα **NSGs**, συμπεριλαμβανομένης της φιλτράρισης σε επίπεδο εφαρμογής, της φιλτράρισης σε επίπεδο δικτύου, της φιλτράρισης βασισμένης σε απειλές και της ολοκλήρωσης με το Azure Monitor για καταγραφή και ανάλυση.\
Μπορεί να φιλτράρει την εξερχόμενη, εισερχόμενη, επικοινωνία μεταξύ spoke, VPN και ExpressRoute. **Οι κανόνες του τείχους προστασίας μπορούν να δημιουργηθούν βάσει του FQDN (Fully Qualified Domain Name), των διευθύνσεων IP και των θυρών**.

### Διαφορές μεταξύ Azure Firewall και NSGs&#x20;

1. **Εύρος:**
* **NSG:** Λειτουργεί στο επίπεδο του υποδικτύου ή της διεπαφής δικτύου. Έχει σκοπό να παρέχει βασική φιλτράριση της εισερχόμενης και εξερχόμενης κυκλοφορίας από τις διεπαφές δικτύου (NIC), τις εικονικές μηχανές (VMs) ή τα υποδίκτυα.
* **Azure Firewall:** Λειτουργεί στο επίπεδο του VNet, παρέχοντας ένα ευρύτερο εύρος προστασίας. Σχεδιάστηκε για να ασφαλίζει τους πόρους του εικονικού σας δικτύου και να διαχειρίζεται την κυκλοφορία που ρέει μέσα και έξω από το VNet.
2. **Δυνατότητες:**
* **NSG:** Παρέχει βασικές δυνατότητες φιλτραρίσματος βάσει διεύθυνσης IP, θύρας και πρωτοκόλλου. Δεν υποστηρίζει προηγμένες δυνατότητες όπως έλεγχος σε επίπεδο εφαρμογής ή ανίχνευση απειλών.
* **Azure Firewall:** Προσφέρει προηγμένες δυνατότητες όπως φιλτράρισμα κυκλοφορίας σε επίπεδο εφαρμογής (Layer 7), φιλτράρισμα βασισμένο σε απειλές, φιλτράρισμα κυκλοφορίας δικτύου και άλλα. Υποστηρίζει επίσης πολλαπλές δημόσιες διευθύνσεις IP.
3. **Περιπτώσεις Χρήσης:**
* **NSG:** Ιδανικό για βασικό φιλτράρισμα κυκλοφορίας σε επίπεδο δικτύου.
* **Azure Firewall:** Κατάλληλο για πιο περίπλοκα σενάρια φιλτραρίσματος όπου απαιτείται έλεγχος σε επίπεδο εφαρμογής, καταγραφή και ανίχνευση απειλών.
4. **Διαχείριση και Παρακολούθηση:**
* **NSG:** Προσφέρει βασική καταγραφή και ολοκλήρωση με το Azure Monitor.
* **Azure Firewall:** Παρέχει προηγμένες δυνατότητες καταγραφής και αναλυτικής ανάλυσης μέσω του Azure Monitor, το οποίο είναι απαραίτητο για την κατανόηση της φύσης και του μοτίβου της κυκλοφορίας.

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
## Δικτυακή Εικονική Συσκευή (NVA)

Μια Δικτυακή Εικονική Συσκευή (**NVA**) στο Azure είναι μια εικονική συσκευή που **εκτελεί λειτουργίες δικτύου εντός ενός εικονικού δικτύου**. Οι NVA συνήθως χρησιμοποιούνται για λειτουργίες δικτύου που **δεν είναι διαθέσιμες από προεπιλογή** στο Azure ή όταν απαιτείται περισσότερη προσαρμογή. Ουσιαστικά, είναι **εικονικές μηχανές που εκτελούν εφαρμογές ή υπηρεσίες δικτύου**, όπως τείχη προστασίας, βελτιωτές WAN ή ισορροπητές φορτίου.

Οι NVA χρησιμοποιούνται για πολύπλοκο δρομολόγηση, **ασφάλεια** και διαχείριση κίνησης δικτύου. Μπορούν να αναπτυχθούν από το **Marketplace** του Azure, όπου πολλοί προμηθευτές τρίτων προσφέρουν τις συσκευές τους έτοιμες για ενσωμάτωση σε περιβάλλοντα Azure.

### **Παράδειγμα**

* Μια οργάνωση μπορεί να αναπτύξει ένα NVA στο Azure για να δημιουργήσει μια **προσαρμοσμένη λύση τείχους προστασίας**. Αυτό το NVA μπορεί να εκτελέσει ένα **λογισμικό τείχους προστασίας τρίτων**, παρέχοντας προηγμένες δυνατότητες όπως ανίχνευση διείσδυσης, έλεγχος πακέτων ή συνδεσιμότητα VPN. Το NVA μπορεί να ρυθμιστεί για να επιθεωρεί και να φιλτράρει την κίνηση που διέρχεται από αυτό, εξασφαλίζοντας την εφαρμογή ενισχυμένων μέτρων ασφαλείας σύμφωνα με τις πολιτικές της οργάνωσης.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
## Πίνακες Δρομολόγησης Azure & Προσαρμοσμένες Διαδρομές Χρήστη (UDR)

Οι **Πίνακες Δρομολόγησης Azure** είναι μια δυνατότητα εντός του Microsoft Azure που επιτρέπει τον **έλεγχο της δρομολόγησης της κίνησης δικτύου εντός των Εικονικών Δικτύων Azure (VNets)**. Ουσιαστικά, καθορίζουν πώς **πακέτα** δρομολογούνται μεταξύ υποδικτύων εντός των VNets, μεταξύ των VNets ή προς εξωτερικά δίκτυα. Κάθε πίνακας δρομολόγησης περιέχει ένα σύνολο κανόνων, γνωστών ως διαδρομές, που καθορίζουν πώς πρέπει να δρομολογούνται τα πακέτα με βάση τις διευθύνσεις IP προορισμού τους.

Οι **Προσαρμοσμένες Διαδρομές Χρήστη (UDR)** στο Azure είναι **προσαρμοσμένες διαδρομές που δημιουργείτε εντός των Πινάκων Δρομολόγησης Azure** για να ελέγχετε τη **ροή της κίνησης δικτύου** εντός και μεταξύ των Εικονικών Δικτύων Azure (VNets) και προς εξωτερικές συνδέσεις. Οι UDR σας δίνουν την ευελιξία να κατευθύνετε την κίνηση του δικτύου σύμφωνα με τις συγκεκριμένες απαιτήσεις σας, αντικαθιστώντας τις προεπιλεγμένες αποφάσεις δρομολόγησης του Azure.

Αυτές οι διαδρομές είναι ιδιαίτερα χρήσιμες για περιπτώσεις όπου χρειάζεστε να **δρομολογήσετε την κίνηση μέσω εικονικής συσκευής**, να επιβάλετε ένα συγκεκριμένο μονοπάτι για λόγους ασφάλειας ή συμμόρφωσης με πολιτικές, ή να ενσωματωθείτε με δίκτυα εντός του χώρου.

### **Παράδειγμα**

* Υποθέστε ότι έχετε αναπτύξει μια Εικονική Συσκευή Δικτύου (NVA) για τον έλεγχο της κίνησης μεταξύ υποδικτύων εντός ενός VNet. Μπορείτε να δημιουργήσετε μια UDR που καθοδηγεί όλη την κίνηση από ένα υποδίκτυο σε ένα άλλο υποδίκτυο να περνά από το NVA. Αυτή η UDR εξασφαλίζει ότι το NVA ελέγχει την κίνηση για λόγους ασφάλειας πριν φτάσει στον προορισμό της.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Ιδιωτική σύνδεση Azure

Η Ιδιωτική σύνδεση Azure είναι ένα υπηρεσία στο Azure που **επιτρέπει ιδιωτική πρόσβαση σε υπηρεσίες Azure** διασφαλίζοντας ότι **η κίνηση μεταξύ του εικονικού δικτύου Azure (VNet) σας και της υπηρεσίας διαδραματίζεται αποκλειστικά εντός του δικτύου Azure της Microsoft**. Αυτό επιτυγχάνεται με το να φέρνει την υπηρεσία μέσα στο VNet σας. Αυτή η ρύθμιση ενισχύει την ασφάλεια μην εκθέτοντας τα δεδομένα στο δημόσιο διαδίκτυο.

Η Ιδιωτική σύνδεση μπορεί να χρησιμοποιηθεί με διάφορες υπηρεσίες Azure, όπως Azure Storage, Azure SQL Database και προσαρμοσμένες υπηρεσίες που κοινοποιούνται μέσω Ιδιωτικής σύνδεσης. Παρέχει έναν ασφαλή τρόπο για να καταναλώνετε υπηρεσίες από το εσωτερικό του δικού σας VNet ή ακόμα και από διαφορετικές συνδρομές Azure.

{% hint style="danger" %}
Οι Ομάδες Ασφαλείας Δικτύου (NSGs) δεν ισχύουν για ιδιωτικά σημεία πρόσβασης, πράγμα που σημαίνει ότι η συσχέτιση μιας NSG με ένα υποδίκτυο που περιέχει την Ιδιωτική σύνδεση δεν θα έχει κανένα αποτέλεσμα.
{% endhint %}

### **Παράδειγμα**

* Ας υποθέσουμε ένα σενάριο όπου έχετε μια **Azure SQL Database που θέλετε να αποκτήσετε ασφαλή πρόσβαση από το VNet σας**. Συνήθως, αυτό θα περιλάμβανε τη διέλευση από το δημόσιο διαδίκτυο. Με την Ιδιωτική σύνδεση, μπορείτε να δημιουργήσετε ένα **ιδιωτικό σημείο πρόσβασης στο VNet σας** που συνδέεται απευθείας με την υπηρεσία Azure SQL Database. Αυτό το σημείο πρόσβασης καθιστά τη βάση δεδομένων να φαίνεται ότι είναι μέρος του δικού σας VNet, προσβάσιμη μέσω ενός ιδιωτικού διευθύνσεως IP, εξασφαλίζοντας έτσι ασφαλή και ιδιωτική πρόσβαση.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
## Σημεία Υπηρεσιών Azure

Τα Σημεία Υπηρεσιών Azure επεκτείνουν τον ιδιωτικό χώρο διευθύνσεων του εικονικού σας δικτύου και την ταυτότητα του VNet σε υπηρεσίες Azure μέσω μιας άμεσης σύνδεσης. Ενεργοποιώντας τα σημεία υπηρεσιών, **οι πόροι στο VNet σας μπορούν να συνδεθούν ασφαλώς με τις υπηρεσίες Azure**, όπως η αποθήκευση Azure και η βάση δεδομένων Azure SQL, χρησιμοποιώντας το δίκτυο υποδομής της Azure. Αυτό εξασφαλίζει ότι η κίνηση από το VNet προς την υπηρεσία Azure παραμένει εντός του δικτύου Azure, παρέχοντας έναν πιο ασφαλή και αξιόπιστο δρομολογητή.

### **Παράδειγμα**

* Για παράδειγμα, ένας λογαριασμός **Azure Storage** είναι προσβάσιμος από προεπιλογή μέσω του δημόσιου διαδικτύου. Ενεργοποιώντας ένα **σημείο υπηρεσίας για το Azure Storage εντός του VNet σας**, μπορείτε να εξασφαλίσετε ότι μόνο η κίνηση από το VNet σας μπορεί να έχει πρόσβαση στον λογαριασμό αποθήκευσης. Το τείχος προστασίας του λογαριασμού αποθήκευσης μπορεί στη συνέχεια να ρυθμιστεί ώστε να αποδέχεται κίνηση μόνο από το VNet σας.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Διαφορές μεταξύ των Σημείων Υπηρεσίας και των Ιδιωτικών Συνδέσεων

Η Microsoft συνιστά τη χρήση Ιδιωτικών Συνδέσεων στα [**έγγραφα**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\


<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Σημεία Υπηρεσίας:**

* Η κίνηση από το VNet στην υπηρεσία Azure διαμετρένει το δίκτυο Microsoft Azure, παρακάμπτοντας το δημόσιο διαδίκτυο.
* Το σημείο πρόσβασης είναι μια άμεση σύνδεση με την υπηρεσία Azure και δεν παρέχει ιδιωτική IP για την υπηρεσία εντός του VNet.
* Η ίδια η υπηρεσία είναι ακόμα προσβάσιμη μέσω του δημόσιου σημείου πρόσβασής της από έξω από το VNet σας, εκτός εάν ρυθμίσετε το τείχος προστασίας της υπηρεσίας για να αποκλείει τέτοια κίνηση.
* Υπάρχει μια μία προς μία σχέση μεταξύ του υποδικτύου και της υπηρεσίας Azure.
* Είναι φθηνότερο από τις Ιδιωτικές Συνδέσεις.

**Ιδιωτικές Συνδέσεις:**

* Οι Ιδιωτικές Συνδέσεις αντιστοιχούν τις υπηρεσίες Azure στο VNet σας μέσω ενός ιδιωτικού σημείου πρόσβασης, το οποίο είναι μια δικτυακή διεπαφή με ιδιωτική IP διεύθυνση εντός του VNet σας.
* Η υπηρεσία Azure προσπελαύνεται χρησιμοποιώντας αυτήν την ιδιωτική IP διεύθυνση, καθιστώντας την να φαίνεται ότι είναι μέρος του δικτύου σας.
* Οι υπηρεσίες που συνδέονται μέσω Ιδιωτικής Σύνδεσης μπορούν να προσπελαστούν μόνο από το VNet σας ή από συνδεδεμένα δίκτυα. Δεν υπάρχει πρόσβαση από το δημόσιο διαδίκτυο στην υπηρεσία.
* Επιτρέπει μια ασφαλή σύνδεση με τις υπηρεσίες Azure ή τις δικές σας υπηρεσίες που φιλοξενούνται στο Azure, καθώς και μια σύνδεση με υπηρεσίες που μοιράζονται από άλλους.
* Παρέχει πιο λεπτομερή έλεγχο πρόσβασης μέσω ενός ιδιωτικού σημείου πρόσβασης στο VNet σας, αντί για ευρύτερο έλεγχο πρόσβασης στο επίπεδο του υποδικτύου με τα σημεία υπηρεσίας.

Συνολικά, ενώ τόσο τα Σημεία Υπηρεσίας όσο και οι Ιδιωτικές Συνδέσεις παρέχουν ασφαλή συνδεσιμότητα με τις υπηρεσίες Azure, **οι Ιδιωτικές Συνδέσεις προσφέρουν ένα υψηλότερο επίπεδο απομόνωσης και ασφάλειας, διασφαλίζοντας ότι οι υπηρεσίες προσπελαύνονται ιδιωτικά χωρίς να εκτίθενται στο δημόσιο διαδίκτυο**. Τα Σημεία Υπηρεσίας, από την άλλη πλευρά, είναι πιο εύκολο να ρυθμιστούν για γενικές περιπτώσεις όπου απαιτείται απλή, ασφαλής πρόσβαση σε υπηρεσίες Azure χωρίς την ανάγκη για ιδιωτική IP στο VNet.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** είναι ένα κλιμακούμενο και ασφαλές σημείο εισόδου για την **γρήγορη παράδοση** των παγκόσμιων web εφαρμογών σας. Συνδυάζει διάφορες υπηρεσίες όπως παγκόσμια **εξισορρόπηση φορτίου, επιτάχυνση ιστοσελίδων, απενεργοποίηση SSL και δυνατότητες Web Application Firewall (WAF)** σε μια μόνο υπηρεσία. Το Azure Front Door παρέχει έξυπνη δρομολόγηση βασισμένη στη **κοντινότερη τοποθεσία άκρου προς τον χρήστη**, εξασφαλίζοντας βέλτιστη απόδοση και αξιοπιστία. Επιπλέον, προσφέρει δρομολόγηση βάσει URL, φιλοξενία πολλαπλών ιστοτόπων, session affinity και ασφάλεια στο επίπεδο εφαρμογής.

**Azure Front Door WAF** σχεδιάστηκε για να **προστατεύει τις web εφαρμογές από επιθέσεις βασισμένες στο web** χωρίς τροποποίηση του κώδικα της πίσω άκρας. Περιλαμβάνει προσαρμοσμένους κανόνες και διαχειριζόμενους συνόλους κανόνων για την προστασία από απειλές όπως εισαγωγή SQL, cross-site scripting και άλλες κοινές επιθέσεις.

### **Παράδειγμα**

* Φανταστείτε ότι έχετε μια εφαρμογή που είναι κατανεμημένη παγκοσμίως με χρήστες από όλο τον κόσμο. Μπορείτε να χρησιμοποιήσετε το Azure Front Door για να **δρομολογήσετε τα αιτήματα των χρηστών στον πλησιέστερο περιφερειακό κέντρο δεδομένων** που φιλοξενεί την εφαρμογή σας, μειώνοντας έτσι την καθυστέρηση, βελτιώνοντας την εμπειρία του χρήστη και **προστατεύοντάς την από επιθέσεις μέσω των δυνατοτήτων του WAF**. Εάν μια συγκεκριμένη περιοχή αντιμετωπίσει διακοπή λειτουργίας, το Azure Front Door μπορεί αυτόματα να ανακατευθύνει την κίνηση στην επόμενη καλύτερη τοποθεσία, εξασφαλίζοντας υψηλή διαθεσιμότητα.

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway και Azure Application Gateway WAF

Το Azure Application Gateway είναι ένας **φορτωτής ισορροπίας κίνησης ιστού** που σας επιτρέπει να διαχειρίζεστε την κίνηση προς τις **ιστοσελίδες** σας. Προσφέρει δυνατότητες **ισορροπίας φορτίου Layer 7, τερματισμού SSL και προστασίας από επιθέσεις στις εφαρμογές ιστού (WAF)** στον Ελεγκτή Παράδοσης Εφαρμογών (ADC) ως υπηρεσία. Οι βασικές δυνατότητες περιλαμβάνουν την οδήγηση βάσει URL, την αφοσίωση συνεδρίας βάσει cookie και την αποσύνδεση του επιπέδου σύνδεσης ασφαλείας (SSL), οι οποίες είναι κρίσιμες για εφαρμογές που απαιτούν πολύπλοκες δυνατότητες ισορροπίας φορτίου, όπως παγκόσμια οδήγηση και οδήγηση βάσει διαδρομής.

### Παράδειγμα

* Ας υποθέσουμε ένα σενάριο όπου έχετε μια ιστοσελίδα ηλεκτρονικού εμπορίου που περιλαμβάνει πολλαπλούς υποτομείς για διάφορες λειτουργίες, όπως οι λογαριασμοί χρηστών και η επεξεργασία πληρωμών. Το Azure Application Gateway μπορεί να **κατευθύνει την κίνηση προς τους κατάλληλους διακομιστές ιστού βάσει της διαδρομής URL**. Για παράδειγμα, η κίνηση προς `example.com/accounts` μπορεί να κατευθυνθεί στην υπηρεσία λογαριασμών χρηστών και η κίνηση προς `example.com/pay` μπορεί να κατευθυνθεί στην υπηρεσία επεξεργασίας πληρωμών.\
Και **προστατεύει την ιστοσελίδα σας από επιθέσεις χρησιμοποιώντας τις δυνατότητες του WAF**.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**Η σύζευξη των εικονικών δικτύων (VNet Peering)** είναι μια λειτουργία δικτύωσης στο Azure που επιτρέπει τη **σύνδεση απευθείας και απροβλημάτιστη διαφορετικών εικονικών δικτύων (VNets)**. Μέσω της σύζευξης των VNets, οι πόροι σε ένα VNet μπορούν να επικοινωνούν με πόρους σε ένα άλλο VNet χρησιμοποιώντας ιδιωτικές διευθύνσεις IP, **όπως ανήκαν στο ίδιο δίκτυο**.\
**Η σύζευξη των VNets μπορεί επίσης να χρησιμοποιηθεί με δίκτυα on-prem** μέσω της δημιουργίας ενός site-to-site VPN ή Azure ExpressRoute.

**Το Azure Hub και Spoke** είναι μια τοπολογία δικτύου που χρησιμοποιείται στο Azure για τη διαχείριση και οργάνωση της κίνησης του δικτύου. **Το "hub" είναι ένα κεντρικό σημείο που ελέγχει και κατευθύνει την κίνηση μεταξύ διαφορετικών "spokes"**. Το hub περιλαμβάνει συνήθως κοινόχρηστες υπηρεσίες όπως εικονικές συσκευές δικτύου (NVAs), Azure VPN Gateway, Azure Firewall ή Azure Bastion. Τα **"spokes" είναι VNets που φιλοξενούν φορτία εργασίας και συνδέονται με το hub χρησιμοποιώντας τη σύζευξη των VNets**, επιτρέποντας τους να αξιοποιήσουν τις κοινόχρηστες υπηρεσίες εντός του hub. Αυτό το μοντέλο προωθεί μια καθαρή διάταξη του δικτύου, μειώνοντας την πολυπλοκότητα με την κεντρική συγκέντρωση κοινών υπηρεσιών που μπορούν να χρησιμοποιούν πολλαπλές φορτία εργασίας σε διάφορα VNets.

{% hint style="danger" %}
**Η σύζευξη των VNet δεν είναι μεταβατική στο Azure**, πράγμα που σημαίνει ότι αν το spoke 1 είναι συνδεδεμένο με το spoke 2 και το spoke 2 είναι συνδεδεμένο με το spoke 3, τότε το spoke 1 δεν μπορεί να επικοινωνήσει απευθείας με το spoke 3.
{% endhint %}

### Παραδείγματα

* Φανταστείτε μια εταιρεία με ξεχωριστά τμήματα όπως Πωλήσεις, Ανθρώπινο Δυναμικό και Ανάπτυξη, **καθένα με το δικό του VNet (τα spokes)**. Αυτά τα VNets **χρειάζονται πρόσβαση σε κοινόχρηστους πόρους** όπως μια κεντρική βάση δεδομένων, ένα τείχος προστασίας και μια πύλη internet, που βρίσκονται όλα σε **ένα άλλο VNet (το hub)**. Χρησιμοποιώντας το μοντέλο Hub και Spoke, κάθε τμήμα μπορεί να **συνδεθεί ασφαλώς στους κοινόχρηστους πόρους μέσω του VNet του hub χωρίς να αποκαλύπτει αυτούς τους πόρους στο δημόσιο internet** ή να δημιουργεί μια πολύπλοκη δομή δικτύου με πολλαπλές συνδέσεις.

### Απαρίθμηση

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
## Site-to-Site VPN

Ένα Site-to-Site VPN στο Azure σας επιτρέπει να **συνδέσετε το τοπικό δίκτυο σας με το Azure Virtual Network (VNet)**, επιτρέποντας στους πόρους όπως οι εικονικές μηχανές (VMs) στο Azure να φαίνονται σαν να βρίσκονται στο τοπικό σας δίκτυο. Αυτή η σύνδεση δημιουργείται μέσω ενός **VPN πύλης που κρυπτογραφεί την κίνηση** μεταξύ των δύο δικτύων.

### **Παράδειγμα**

* Μια επιχείρηση με κεντρικό γραφείο στη Νέα Υόρκη έχει ένα κέντρο δεδομένων στον τόπο εργασίας που χρειάζεται να συνδεθεί με ασφάλεια με το VNet της στο Azure, όπου φιλοξενούνται οι εικονικές τους εργασίες. Με την εγκατάσταση ενός **Site-to-Site VPN, η εταιρεία μπορεί να εξασφαλίσει κρυπτογραφημένη συνδεσιμότητα μεταξύ των διακομιστών στον τόπο εργασίας και των Azure VMs**, επιτρέποντας την ασφαλή πρόσβαση σε πόρους και στις δύο περιβάλλοντα, σαν να βρίσκονταν στο ίδιο τοπικό δίκτυο.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
## Azure ExpressRoute

Το Azure ExpressRoute είναι ένα υπηρεσία που παρέχει μια **ιδιωτική, αφιερωμένη, υψηλής ταχύτητας σύνδεση μεταξύ της υποδομής σας στον τόπο και των κέντρων δεδομένων του Azure**. Αυτή η σύνδεση γίνεται μέσω ενός παρόχου σύνδεσης, παρακάμπτοντας το δημόσιο διαδίκτυο και προσφέροντας μεγαλύτερη αξιοπιστία, ταχύτερες ταχύτητες, χαμηλότερες καθυστερήσεις και υψηλότερη ασφάλεια από τις συνήθεις συνδέσεις στο διαδίκτυο.

### **Παράδειγμα**

* Μια πολυεθνική εταιρεία απαιτεί μια **συνεπή και αξιόπιστη σύνδεση με τις υπηρεσίες της Azure λόγω του υψηλού όγκου δεδομένων** και της ανάγκης για υψηλή ροή δεδομένων. Η εταιρεία επιλέγει το Azure ExpressRoute για να συνδέσει απευθείας το κέντρο δεδομένων στον τόπο με το Azure, διευκολύνοντας τη μεταφορά μεγάλης κλίμακας δεδομένων, όπως ημερήσια αντίγραφα ασφαλείας και ανάλυση δεδομένων πραγματικού χρόνου, με βελτιωμένη απόρρητοτητα και ταχύτητα.

### **Απαρίθμηση**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
