# Az - Azure Mreža

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Mreže unutar Azure-a funkcionišu kao integralni deo njegove cloud computing platforme, omogućavajući **povezivanje i komunikaciju između različitih Azure servisa i resursa**. Mrežna arhitektura u Azure-u je dizajnirana da bude visoko skalabilna, sigurna i prilagodljiva.

U osnovi, Azure pruža **virtuelnu mrežu (VNet)** koja korisnicima omogućava kreiranje **izolovanih mreža** unutar Azure cloud-a. Unutar ovih VNets-a, resursi poput virtuelnih mašina, aplikacija i baza podataka mogu biti sigurno smešteni i upravljani. Mrežno povezivanje u Azure-u podržava kako komunikaciju unutar cloud-a (između Azure servisa), tako i povezivanje sa spoljnim mrežama i internetom.

**Bezbednost** je ključni aspekt Azure mrežnog povezivanja, sa raznim alatima i servisima dostupnim za zaštitu podataka, upravljanje pristupom i obezbeđivanje usaglašenosti. Ove bezbednosne mere uključuju **firewall-e**, **grupe za mrežnu bezbednost** i mogućnosti **enkripcije**, omogućavajući visok nivo kontrole nad saobraćajem i pristupom.

Ukupno, Azure-ove mogućnosti mrežnog povezivanja su dizajnirane da pruže fleksibilnost, omogućavajući korisnicima da kreiraju mrežno okruženje koje odgovara njihovim specifičnim potrebama aplikacija i radnih opterećenja, uz istovremeno snažan naglasak na sigurnost i pouzdanost.

## Virtuelna mreža (VNET) i podmreže

VNet u Azure-u je suštinski predstavljanje vaše sopstvene mreže u oblaku. To je **logička izolacija Azure cloud-a posvećena vašoj pretplati**. VNet vam omogućava da obezbedite i upravljate virtuelnim privatnim mrežama (VPN-ovima) u Azure-u i može se koristiti za smeštanje i **upravljanje različitim vrstama Azure resursa**, kao što su virtuelne mašine (VM-ovi), baze podataka i aplikativne usluge.

VNets vam pružaju **potpunu kontrolu nad postavkama vaše mreže**, uključujući **opsege IP adresa**, kreiranje podmreža, tabele ruta i mrežne gateway-e.

**Podmreža** je **opseg IP adresa u vašem VNet-u**. Možete podeliti VNet u više podmreža radi organizacije i bezbednosti. Svaka podmreža u VNet-u može se koristiti za izolaciju i grupisanje resursa prema vašoj mrežnoj i aplikativnoj arhitekturi.

Osim toga, podmreže vam omogućavaju da **segmentirate svoj VNet u jednu ili više pod-mreža**, pružajući opseg IP adresa koje resursi mogu koristiti.

### **Primer**

* Pretpostavimo da imate VNet nazvan `MyVNet` sa opsegom IP adresa `10.0.0.0/16`. Možete kreirati podmrežu unutar ovog VNet-a, recimo `Subnet-1`, sa opsegom IP adresa `10.0.0.0/24` za smeštanje vaših web servera. Druga podmreža, `Subnet-2` sa opsegom `10.0.1.0/24`, može se koristiti za vaše baze podataka. Ova segmentacija omogućava efikasno upravljanje i kontrolu bezbednosti unutar mreže.

### Enumeracija

Da biste izlistali sve VNets i podmreže u Azure nalogu, možete koristiti Azure Command-Line Interface (CLI). Evo koraka:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Grupa za bezbednost mreže (NSG)

U Azure-u, **Grupa za bezbednost mreže (NSG)** ima osnovnu funkciju filtriranja mrežnog saobraćaja kako prema Azure resursima unutar Azure virtuelne mreže (VNet), tako i od njih. Ona sadrži skup **pravila za bezbednost** koja detaljno određuju tok mrežnog saobraćaja.

Ključni aspekti NSG-a uključuju:

- **Kontrola saobraćaja**: Svaka NSG sadrži pravila koja su od vitalnog značaja za dozvoljavanje ili blokiranje dolaznog i odlaznog mrežnog saobraćaja povezanog sa različitim Azure resursima.
- **Komponente pravila**: Pravila unutar NSG-a su veoma specifična i filtriraju saobraćaj na osnovu kriterijuma kao što su izvorna/odredišna IP adresa, port i protokol. Ova specifičnost omogućava detaljno upravljanje mrežnim saobraćajem.
- **Poboljšanje bezbednosti**: Osiguravajući da samo ovlašćeni saobraćaj može da ulazi ili izlazi iz vaših Azure resursa, NSG-ovi igraju ključnu ulogu u jačanju bezbednosti vaše mrežne infrastrukture.


### **Primer**

* Zamislite da imate NSG nazvan `MyNSG` primenjen na podmrežu ili određenu virtuelnu mašinu unutar vaše VNet. Možete kreirati pravila kao što su:
* Dolazno pravilo koje dozvoljava HTTP saobraćaj (port 80) sa bilo koje izvorne adrese ka vašim veb serverima.
* Odlazno pravilo koje dozvoljava samo SQL saobraćaj (port 1433) ka određenom opsegu odredišnih IP adresa.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall je upravljana, cloud-based **usluga za mrežnu sigurnost koja štiti vaše Azure Virtual Network resurse**. To je potpuno stanje firewall kao usluga sa ugrađenim mogućnostima visoke dostupnosti i skalabilnosti.

Azure Firewall pruža **naprednije** mogućnosti od **NSG-ova**, uključujući filtriranje na nivou aplikacije, filtriranje na nivou mreže, filtriranje na osnovu obaveštajnih podataka o pretnjama i integraciju sa Azure Monitorom za beleženje i analitiku.\
Može filtrirati odlazni, dolazni, saobraćaj između mreža, VPN i ExpressRoute saobraćaj. **Pravila firewalla mogu se kreirati na osnovu FQDN (Fully Qualified Domain Name), IP adresa i portova**.

### Razlike između Azure Firewalla i NSG-ova&#x20;

1. **Opseg:**
* **NSG:** Radi na nivou podmreže ili mrežnog interfejsa. Namijenjen je pružanju osnovnog filtriranja dolaznog i odlaznog saobraćaja sa mrežnih interfejsa (NIC), virtuelnih mašina (VM) ili podmreža.
* **Azure Firewall:** Deluje na nivou VNet-a, pružajući širi opseg zaštite. Dizajniran je za obezbeđivanje vaših virtualnih mrežnih resursa i upravljanje saobraćajem koji ulazi i izlazi iz VNet-a.
2. **Mogućnosti:**
* **NSG:** Pruža osnovne mogućnosti filtriranja na osnovu IP adrese, porta i protokola. Ne podržava napredne funkcionalnosti poput inspekcije na nivou aplikacije ili obaveštajnih podataka o pretnjama.
* **Azure Firewall:** Nudi napredne funkcionalnosti poput filtriranja saobraćaja na nivou aplikacije (Layer 7), filtriranja na osnovu obaveštajnih podataka o pretnjama, filtriranja mrežnog saobraćaja i još mnogo toga. Takođe podržava više javnih IP adresa.
3. **Upotreba:**
* **NSG:** Idealno za osnovno filtriranje saobraćaja na nivou mreže.
* **Azure Firewall:** Pogodan za složenije scenarije filtriranja gde je potrebna kontrola na nivou aplikacije, beleženje i obaveštajni podaci o pretnjama.
4. **Upravljanje i praćenje:**
* **NSG:** Nudi osnovno beleženje i integraciju sa Azure Monitorom.
* **Azure Firewall:** Pruža napredne mogućnosti beleženja i analitike putem Azure Monitora, što je ključno za razumevanje prirode i obrasca saobraćaja.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Mrežni virtuelni uređaj (NVA)

Mrežni virtuelni uređaj (**NVA**) u Azure-u je virtuelni uređaj koji **obavlja mrežne funkcije unutar virtuelne mreže**. NVA se obično koristi za mrežne funkcije koje **nisu dostupne nativno** u Azure-u ili kada je potrebna veća prilagodljivost. Oni su suštinski **VM-ovi koji pokreću mrežne aplikacije ili usluge**, kao što su firewall-i, WAN optimizatori ili load balancer-i.

NVA se koriste za kompleksno rutiranje, **bezbednost** i **upravljanje mrežnim saobraćajem**. Mogu se implementirati sa Azure **Marketplace-a**, gde mnogi trećepartijski dobavljači nude svoje uređaje spremne za integraciju u Azure okruženja.

### **Primer**

* Organizacija može implementirati NVA u Azure-u kako bi kreirala **prilagođeno rešenje za firewall**. Ovaj NVA može pokretati **firewall softver treće strane**, pružajući napredne funkcije poput detekcije upada, inspekcije paketa ili VPN konektivnosti. NVA se može konfigurisati da inspektuje i filtrira saobraćaj koji prolazi kroz njega, obezbeđujući unapređene bezbednosne mere u skladu sa politikama organizacije.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Tabele ruta i korisnički definisane rute (UDR)

**Azure Tabele ruta** su funkcionalnost unutar Microsoft Azure-a koja omogućava **kontrolu rutiranja mrežnog saobraćaja unutar Azure virtuelnih mreža (VNets)**. U osnovi, one definišu kako se **paketi** prosleđuju između podmreža unutar VNets-a, između VNets-a ili ka spoljnim mrežama. Svaka tabela ruta sadrži skup pravila, poznatih kao rute, koje određuju kako će se paketi rutirati na osnovu njihovih odredišnih IP adresa.

**Korisnički definisane rute (UDR)** u Azure-u su **prilagođene rute koje kreirate unutar Azure Tabela ruta** kako biste kontrolisali **tok mrežnog saobraćaja** unutar i između Azure virtuelnih mreža (VNets), kao i ka spoljnim konekcijama. UDR-ovi vam omogućavaju fleksibilnost da usmeravate mrežni saobraćaj prema vašim specifičnim zahtevima, prelazeći preko Azure-ovih podrazumevanih rutirajućih odluka.

Ove rute su posebno korisne u scenarijima gde je potrebno **usmeravanje saobraćaja preko virtuelnog uređaja**, sprovođenje određene putanje u svrhu bezbednosti ili usaglašenosti sa politikama, ili integracija sa lokalnim mrežama.

### **Primer**

* Pretpostavimo da ste implementirali virtuelni uređaj za mrežu (NVA) radi inspekcije saobraćaja između podmreža unutar jednog VNet-a. Možete kreirati UDR koji usmerava sav saobraćaj iz jedne podmreže ka drugoj podmreži preko NVA. Ovaj UDR obezbeđuje da NVA inspekcioniše saobraćaj u svrhu bezbednosti pre nego što stigne do svog odredišta.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure privatna veza

Azure privatna veza je usluga u Azure-u koja omogućava **privatan pristup Azure uslugama** tako što se **saobraćaj između vaše Azure virtuelne mreže (VNet) i usluge odvija isključivo unutar Microsoft-ove Azure mreže**. Efektivno dovodi uslugu u vašu VNet. Ova postavka poboljšava bezbednost tako što ne izlaže podatke javnom internetu.

Privatna veza se može koristiti sa raznim Azure uslugama, kao što su Azure Storage, Azure SQL baza podataka i prilagođene usluge deljene putem privatne veze. Pruža siguran način za korišćenje usluga iz vaše sopstvene VNet ili čak iz različitih Azure pretplata.

{% hint style="danger" %}
NSG-ovi se ne primenjuju na privatne krajnje tačke, što jasno znači da povezivanje NSG-a sa podmrežom koja sadrži privatnu vezu neće imati nikakav efekat.
{% endhint %}

### **Primer**

* Zamislite scenario u kojem imate **Azure SQL bazu podataka koju želite bezbedno pristupiti iz vaše VNet**. Obično bi to podrazumevalo prolazak kroz javni internet. Sa privatnom vezom, možete kreirati **privatnu krajnju tačku u vašoj VNet** koja se direktno povezuje sa Azure SQL bazom podataka uslugom. Ova krajnja tačka čini da baza podataka izgleda kao da je deo vaše sopstvene VNet, dostupna putem privatne IP adrese, čime se obezbeđuje siguran i privatni pristup.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure servisne tačke

Azure servisne tačke proširuju privatni adresni prostor vaše virtuelne mreže i identitet vaše virtuelne mreže na Azure servise preko direktnog povezivanja. Omogućavanjem servisnih tačaka, **resursi u vašoj virtuelnoj mreži mogu sigurno da se povežu sa Azure servisima**, kao što su Azure Storage i Azure SQL baza podataka, koristeći Azure-ovu mrežu. Ovo osigurava da **saobraćaj između virtuelne mreže i Azure servisa ostaje unutar Azure mreže**, pružajući sigurniju i pouzdaniju putanju.

### **Primer**

* Na primer, **Azure Storage** nalog je podrazumevano dostupan preko javnog interneta. Omogućavanjem **servisne tačke za Azure Storage unutar vaše virtuelne mreže**, možete osigurati da samo saobraćaj iz vaše virtuelne mreže može pristupiti nalogu za skladištenje. Firewall naloga za skladištenje se može konfigurisati da prihvata saobraćaj samo iz vaše virtuelne mreže.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Razlike između usluga krajnjih tačaka i privatnih veza

Microsoft preporučuje korišćenje privatnih veza u [**dokumentaciji**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\


<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Usluge krajnjih tačaka:**

* Saobraćaj iz vaše virtuelne mreže ka Azure usluzi putuje preko Microsoft Azure mreže, zaobilazeći javni internet.
* Krajnja tačka je direktna veza sa Azure uslugom i ne pruža privatnu IP adresu za uslugu unutar virtuelne mreže.
* Usluga je i dalje dostupna putem javne krajnje tačke izvan vaše virtuelne mreže, osim ako konfigurišete zaštitni zid usluge da blokira takav saobraćaj.
* Odnos između podmreže i Azure usluge je jedan prema jedan.
* Jeftinije od privatnih veza.

**Privatne veze:**

* Privatna veza mapira Azure usluge u vašu virtuelnu mrežu putem privatne krajnje tačke, koja je mrežni interfejs sa privatnom IP adresom unutar vaše virtuelne mreže.
* Azure usluga se pristupa koristeći ovu privatnu IP adresu, čime se čini da je deo vaše mreže.
* Usluge povezane putem privatne veze mogu se pristupiti samo iz vaše virtuelne mreže ili povezanih mreža; nema pristupa javnom internetu usluzi.
* Omogućava sigurnu vezu sa Azure uslugama ili vašim sopstvenim uslugama smeštenim u Azure-u, kao i vezu sa uslugama koje dele drugi.
* Pruža precizniju kontrolu pristupa putem privatne krajnje tačke u vašoj virtuelnoj mreži, za razliku od šire kontrole pristupa na nivou podmreže sa uslugama krajnjih tačaka.

Ukratko, iako usluge krajnjih tačaka i privatne veze obezbeđuju sigurnu konekciju sa Azure uslugama, **privatne veze pružaju viši nivo izolacije i sigurnosti tako što osiguravaju da se usluge pristupaju privatno, bez izlaganja javnom internetu**. Usluge krajnjih tačaka, s druge strane, su lakše za podešavanje u opštim slučajevima gde je potrebno jednostavno i sigurno pristupanje Azure uslugama bez potrebe za privatnom IP adresom u virtuelnoj mreži.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** je skalabilna i sigurna ulazna tačka za **brzu isporuku** vaših globalnih veb aplikacija. Ona **kombinuje** različite usluge kao što su globalno **balansiranje opterećenja, ubrzavanje sajta, SSL dekodiranje i Web Application Firewall (WAF)** mogućnosti u jednu uslugu. Azure Front Door obezbeđuje inteligentno rutiranje na osnovu **najbliže lokacije ivice korisniku**, obezbeđujući optimalne performanse i pouzdanost. Dodatno, nudi rutiranje na osnovu URL-a, hosting više sajtova, afinitet sesije i sigurnost na nivou aplikacije.

**Azure Front Door WAF** je dizajniran da **štiti veb aplikacije od napada zasnovanih na vebu** bez modifikacije koda na pozadini. Uključuje prilagođena pravila i upravljane skupove pravila za zaštitu od pretnji kao što su SQL ubacivanje, skriptiranje preko sajta i druge uobičajene napade.

### **Primer**

* Zamislite da imate globalno distribuiranu aplikaciju sa korisnicima širom sveta. Možete koristiti Azure Front Door da **rutirate zahteve korisnika do najbližeg regionalnog data centra** koji hostuje vašu aplikaciju, čime se smanjuje latencija, poboljšava korisničko iskustvo i **štiti je od napada na veb sa WAF mogućnostima**. Ako određena regija doživi prekid rada, Azure Front Door može automatski preusmeriti saobraćaj na sledeću najbolju lokaciju, obezbeđujući visoku dostupnost.

### Nabrojavanje

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway i Azure Application Gateway WAF

Azure Application Gateway je **opterećivač web saobraćaja** koji vam omogućava upravljanje saobraćajem ka vašim **web** aplikacijama. Nudi mogućnosti **opterećivanja na nivou sloja 7, prekida SSL-a i zaštite aplikacija od napada (WAF)** u okviru kontrolera isporuke aplikacija (ADC) kao usluge. Ključne funkcionalnosti uključuju rutiranje na osnovu URL-a, vezivanje sesije na osnovu kolačića i preusmeravanje sloja sigurnih soketa (SSL), što je ključno za aplikacije koje zahtevaju složene mogućnosti opterećivanja kao što su globalno rutiranje i rutiranje na osnovu putanje.

### Primer

* Zamislite scenario u kojem imate e-trgovinski sajt koji uključuje više poddomena za različite funkcije, kao što su korisnički nalozi i obrada plaćanja. Azure Application Gateway može **usmeravati saobraćaj ka odgovarajućim web serverima na osnovu putanje URL-a**. Na primer, saobraćaj ka `primer.com/nalozi` može biti usmeren ka servisu za korisničke naloge, a saobraćaj ka `primer.com/plati` može biti usmeren ka servisu za obradu plaćanja.\
I **zaštititi vaš sajt od napada koristeći mogućnosti WAF-a**.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** je funkcionalnost mreže u Azure-u koja omogućava **direktno i bez problema povezivanje različitih virtuelnih mreža (VNets)**. Kroz VNet peering, resursi u jednoj VNet mogu komunicirati sa resursima u drugoj VNet koristeći privatne IP adrese, **kao da su u istoj mreži**.\
**VNet Peering se takođe može koristiti sa on-prem mrežama** postavljanjem site-to-site VPN-a ili Azure ExpressRoute-a.

**Azure Hub i Spoke** je topologija mreže koja se koristi u Azure-u za upravljanje i organizaciju saobraćaja u mreži. **"Hub" je centralna tačka koja kontroliše i usmerava saobraćaj između različitih "spoke" mreža**. Hub obično sadrži deljene usluge kao što su virtualni mrežni uređaji (NVAs), Azure VPN Gateway, Azure Firewall ili Azure Bastion. **"Spoke" su VNets koji hostuju radne opterećenja i povezuju se sa hub-om koristeći VNet peering**, što im omogućava da iskoriste deljene usluge unutar hub-a. Ovaj model promoviše čist raspored mreže, smanjujući složenost centralizacijom zajedničkih usluga koje mogu koristiti više radnih opterećenja u različitim VNets.

{% hint style="danger" %}
**VNET uparivanje nije tranzitivno u Azure-u**, što znači da ako je spoke 1 povezan sa spoke 2 i spoke 2 je povezan sa spoke 3, tada spoke 1 ne može direktno komunicirati sa spoke 3.
{% endhint %}

### Primeri

* Zamislite kompaniju sa odvojenim odeljenjima kao što su Prodaja, HR i Razvoj, **svako sa svojom VNet-om (spoke)**. Ove VNets **zahtevaju pristup deljenim resursima** kao što su centralna baza podataka, firewall i internet gateway, koji se nalaze u **drugoj VNet-u (hub-u)**. Korišćenjem Hub i Spoke modela, svako odeljenje može **bezbedno se povezati sa deljenim resursima preko hub VNet-a, bez izlaganja tih resursa javnom internetu** ili kreiranja složene mrežne strukture sa brojnim konekcijama.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Site-to-Site VPN u Azure-u vam omogućava da **povežete svoju lokalnu mrežu sa Azure virtuelnom mrežom (VNet)**, omogućavajući resursima poput virtuelnih mašina unutar Azure-a da se prikažu kao da su na vašoj lokalnoj mreži. Ova veza se uspostavlja putem **VPN gateway-a koji enkriptuje saobraćaj** između ove dve mreže.

### **Primer**

* Poslovna kompanija sa svojim glavnim sedištem u Njujorku ima lokalni data centar koji treba bezbedno da se poveže sa svojom VNet-om u Azure-u, gde se nalaze njihovi virtualizovani radni opterećenja. Postavljanjem **Site-to-Site VPN-a, kompanija može obezbediti enkriptovanu konekciju između lokalnih servera i Azure VM-ova**, omogućavajući pristup resursima na bezbedan način iz oba okruženja kao da su u istoj lokalnoj mreži.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute je usluga koja pruža **privatnu, posvećenu i visokobrzinsku vezu između vaše infrastrukture na lokaciji i Azure data centara**. Ova veza se ostvaruje putem pružaoca konektivnosti, zaobilazeći javni internet i pružajući veću pouzdanost, brže brzine, manje latencije i veću sigurnost u odnosu na tipične internet veze.

### **Primer**

* Multinacionalna korporacija zahteva **doslednu i pouzdanu vezu sa svojim Azure uslugama zbog velike količine podataka** i potrebe za visokim protokom. Kompanija se odlučuje za Azure ExpressRoute kako bi direktno povezala svoj data centar na lokaciji sa Azure-om, olakšavajući prenos velikih količina podataka, kao što su dnevne rezervne kopije i analiza podataka u realnom vremenu, uz poboljšanu privatnost i brzinu.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
