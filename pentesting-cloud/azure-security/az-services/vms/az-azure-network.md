# Az - Azure ネットワーク

<details>

<summary><strong>AWSのハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をご覧ください！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをご覧ください
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローしてください。**
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有してください。

</details>

## 基本情報

Azure内のネットワークは、**様々なAzureサービスとリソース間の接続と通信を可能にする**、そのクラウドコンピューティングプラットフォームの不可欠な部分として機能します。Azureのネットワークアーキテクチャは、高いスケーラビリティ、セキュリティ、カスタマイズ性を設計されています。

その核心において、Azureは**仮想ネットワーク（VNet）**を提供し、ユーザーがAzureクラウド内で**隔離されたネットワーク**を作成することを可能にします。これらのVNets内では、仮想マシン、アプリケーション、データベースなどのリソースを安全にホストし、管理することができます。Azureのネットワーキングは、クラウド内の通信（Azureサービス間）と外部ネットワークやインターネットへの接続の両方をサポートしています。

**セキュリティ**はAzureネットワーキングの重要な側面であり、データの保護、アクセス管理、コンプライアンスの確保のための様々なツールとサービスが利用可能です。これらのセキュリティ対策には、**ファイアウォール**、**ネットワークセキュリティグループ**、および**暗号化**機能が含まれ、トラフィックとアクセスに対する高いレベルの制御を可能にします。

全体として、Azureのネットワーキング機能は柔軟性を提供するように設計されており、セキュリティと信頼性に強い重点を置きながら、特定のアプリケーションとワークロードのニーズに合ったネットワーク環境をユーザーが作成できるようになっています。

## 仮想ネットワーク（VNET）とサブネット

AzureのVNetは、基本的にはクラウド内の自分のネットワークの表現です。これは、あなたの**サブスクリプションに専用のAzureクラウドの論理的な隔離**です。VNetを使用すると、Azure内で仮想プライベートネットワーク（VPN）をプロビジョニングし、管理することができ、仮想マシン（VM）、データベース、アプリケーションサービスなど、**様々なタイプのAzureリソースをホストして管理する**ために使用できます。

VNetsは、**IPアドレス範囲**、サブネットの作成、ルートテーブル、ネットワークゲートウェイなど、ネットワーク設定を**完全に制御する**ことを可能にします。

**サブネット**は、VNet内の**IPアドレスの範囲**です。VNetを複数のサブネットに分割して、組織とセキュリティを向上させることができます。VNet内の各サブネットは、ネットワークとアプリケーションアーキテクチャに従ってリソースを分離し、グループ化するために使用できます。

さらに、サブネットを使用すると、VNetを一つ以上のサブネットワークに**セグメント化**し、リソースが使用できるIPアドレスの範囲を提供することができます。

### **例**

* `MyVNet`という名前のVNetがあり、IPアドレス範囲が`10.0.0.0/16`であるとします。このVNet内に`Subnet-1`というサブネットを作成し、IPアドレス範囲を`10.0.0.0/24`にして、Webサーバーをホストすることができます。別のサブネット`Subnet-2`は、範囲が`10.0.1.0/24`で、データベースサーバー用に使用できます。このセグメンテーションにより、ネットワーク内の管理とセキュリティコントロールを効率的に行うことができます。

### 列挙

Azureアカウント内のすべてのVNetsとサブネットをリストするには、Azureコマンドラインインターフェース（CLI）を使用できます。以下が手順です：

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## ネットワークセキュリティグループ (NSG)

Azureのネットワークセキュリティグループ（NSG）は、Azure仮想ネットワーク（**VNet**）内のAzureリソースへの、またはそこからの**ネットワークトラフィックをフィルタリングするために使用されます**。NSGには、複数の種類のAzureリソースへの、またはそこからの入力ネットワークトラフィックを許可または拒否する**セキュリティルール**が含まれています。

NSG内の各ルールは、**ソース/宛先IPアドレス、ポート、およびプロトコルに基づいたフィルターを定義します**。これにより、ネットワークトラフィックを細かく制御し、Azureリソースにアクセスまたはそこからのトラフィックが承認されたもののみであることを保証します。

### **例**

* VNet内のサブネットまたは特定の仮想マシンに適用された`MyNSG`というNSGを想像してください。以下のようなルールを作成できます：
* 任意のソースからのHTTPトラフィック（ポート80）を許可する入力ルール。
* 特定の宛先IPアドレス範囲へのSQLトラフィック（ポート1433）のみを許可する出力ルール。

### 列挙

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewallは、**Azure Virtual Networkリソースを保護するクラウドベースの管理されたネットワークセキュリティサービス**です。完全にステートフルなファイアウォールとしてのサービスであり、組み込まれた高可用性とスケーラビリティ機能を持っています。

Azure Firewallは、**NSGs**よりも**より高度な**機能を提供し、**アプリケーションレベルのフィルタリング**、ネットワークレベルのフィルタリング、脅威インテリジェンスに基づくフィルタリング、ログと分析のためのAzure Monitorとの統合が可能です。\
アウトバウンド、インバウンド、スポーク間、VPN、ExpressRouteトラフィックをフィルタリングできます。**FQDN（完全修飾ドメイン名）、IPアドレス、ポートに基づいてファイアウォールルールを作成できます**。

### Azure FirewallとNSGsの違い&#x20;

1. **範囲:**
* **NSG:** サブネットまたはネットワークインターフェースレベルで動作します。NIC（ネットワークインターフェース）、VM、またはサブネットからのインバウンドおよびアウトバウンドトラフィックを基本的にフィルタリングすることを目的としています。
* **Azure Firewall:** VNetレベルで動作し、より広範な保護の範囲を提供します。仮想ネットワークリソースを保護し、VNetへの流入および流出トラフィックを管理するように設計されています。
2. **機能:**
* **NSG:** IPアドレス、ポート、プロトコルに基づいた基本的なフィルタリング機能を提供します。アプリケーションレベルの検査や脅威インテリジェンスのような高度な機能はサポートしていません。
* **Azure Firewall:** アプリケーションレベル（レイヤー7）のトラフィックフィルタリング、脅威インテリジェンスに基づくフィルタリング、ネットワークトラフィックフィルタリングなどの高度な機能を提供します。また、複数のパブリックIPアドレスをサポートしています。
3. **使用例:**
* **NSG:** 基本的なネットワークレベルのトラフィックフィルタリングに適しています。
* **Azure Firewall:** アプリケーションレベルの制御、ログ、脅威インテリジェンスが必要なより複雑なフィルタリングシナリオに適しています。
4. **管理とモニタリング:**
* **NSG:** 基本的なログとAzure Monitorとの統合を提供します。
* **Azure Firewall:** Azure Monitorを通じて高度なログと分析機能を提供し、トラフィックの性質とパターンを理解するために不可欠です。

### 列挙

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## ネットワーク仮想アプライアンス (NVA)

Azureのネットワーク仮想アプライアンス（**NVA**）は、仮想ネットワーク内で**ネットワーク機能を実行する**仮想アプライアンスです。NVAは通常、Azureで**ネイティブに利用できない**ネットワーク機能が必要な場合や、よりカスタマイズが必要な場合に使用されます。これらは基本的に、ファイアウォール、WAN最適化装置、またはロードバランサーなどのネットワークアプリケーションやサービスを実行する**VM**です。

NVAは複雑なルーティング、**セキュリティ**、および**ネットワークトラフィック管理**のタスクに使用されます。Azure **マーケットプレイス**からデプロイでき、多くのサードパーティベンダーがAzure環境に統合するためのアプライアンスを提供しています。

### **例**

* 組織はAzureにNVAをデプロイして、**カスタムファイアウォールソリューション**を作成することができます。このNVAは**サードパーティのファイアウォールソフトウェア**を実行し、侵入検知、パケット検査、またはVPN接続のような高度な機能を提供することができます。NVAは、それを通過するトラフィックを検査およびフィルタリングするように設定され、組織のポリシーに従って強化されたセキュリティ対策が講じられていることを保証します。

### **列挙**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
## Azure ルートテーブル & ユーザー定義ルート (UDR)

**Azure ルートテーブル** は、**Azure Virtual Networks (VNets) 内のネットワークトラフィックのルーティングを制御する**ための Microsoft Azure 内の機能です。基本的に、これらは VNets 内のサブネット間、VNets 間、または外部ネットワークへの**パケット**の**転送方法**を定義します。各ルートテーブルには、パケットがその宛先 IP アドレスに基づいてどのようにルーティングされるべきかを指定するルールのセット、つまりルートが含まれています。

Azure の **ユーザー定義ルート (UDR)** は、Azure Virtual Networks (VNets) 内および間、外部接続への**ネットワークトラフィックの流れ**を制御するために、**Azure ルートテーブル内で作成するカスタムルート**です。UDR は、Azure のデフォルトのルーティング決定を上書きし、特定の要件に応じてネットワークトラフィックを直接制御する柔軟性を提供します。

これらのルートは、特に**仮想アプライアンスを通じてトラフィックをルーティングする必要がある場合**、セキュリティやポリシーの遵守のために特定の経路を強制する場合、またはオンプレミスネットワークとの統合が必要な場合に役立ちます。

### **例**

* VNet 内のサブネット間のトラフィックを検査するために Network Virtual Appliance (NVA) をデプロイしたとします。あるサブネットから別のサブネットへのすべてのトラフィックが NVA を通過するように UDR を作成できます。この UDR は、トラフィックが宛先に到達する前にセキュリティ目的で NVA によって検査されることを保証します。

### **列挙**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Linkは、**Azureサービスへのプライベートアクセスを可能にする**Azureのサービスであり、**トラフィックがお客様のAzure仮想ネットワーク（VNet）とサービスの間で完全にMicrosoftのAzureバックボーンネットワーク内を移動することを保証します**。これにより、サービスを実質的にお客様のVNetに持ち込むことができます。このセットアップは、データを公開インターネットにさらさないことでセキュリティを強化します。

Private Linkは、Azure Storage、Azure SQL Database、Private Link経由で共有されるカスタムサービスなど、様々なAzureサービスで使用できます。これにより、お客様自身のVNet内、または異なるAzureサブスクリプションからサービスを安全に利用する方法を提供します。

{% hint style="danger" %}
NSGはプライベートエンドポイントには適用されません。これは、Private Linkを含むサブネットにNSGを関連付けても効果がないことを明確に意味します。
{% endhint %}

### **例**

* **Azure SQL Databaseに安全にアクセスしたい**というシナリオを考えてみましょう。通常、これには公開インターネットを経由することが含まれるかもしれません。Private Linkを使用すると、**VNet内にプライベートエンドポイントを作成**し、直接Azure SQL Databaseサービスに接続することができます。このエンドポイントにより、データベースはお客様のVNetの一部であるかのように見え、プライベートIPアドレス経由でアクセス可能になり、安全かつプライベートなアクセスを保証します。

### **列挙**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure サービスエンドポイント

Azure サービスエンドポイントは、直接接続を介して Azure サービスに対して、仮想ネットワークのプライベートアドレス空間と VNet のアイデンティティを拡張します。サービスエンドポイントを有効にすることで、**VNet 内のリソースが Azure のバックボーンネットワークを使用して Azure サービスに安全に接続できます**。これにより、**VNet から Azure サービスへのトラフィックが Azure ネットワーク内に留まる**ことが保証され、より安全で信頼性の高いパスが提供されます。

### **例**

* 例えば、**Azure Storage** アカウントはデフォルトでインターネット上からアクセス可能です。VNet 内で **Azure Storage のサービスエンドポイントを有効にする**ことで、VNet からのトラフィックのみがストレージアカウントにアクセスできるようになります。その後、ストレージアカウントのファイアウォールを VNet からのトラフィックのみを受け入れるように設定できます。

### **列挙**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
### サービスエンドポイントとプライベートリンクの違い

Microsoftは[**ドキュメント**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints)でプライベートリンクの使用を推奨しています：

<figure><img src="../../../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

**サービスエンドポイント：**

* VNetからAzureサービスへのトラフィックは、公共インターネットを迂回してMicrosoft Azureバックボーンネットワークを経由します。
* エンドポイントはAzureサービスへの直接接続であり、VNet内にサービスのプライベートIPを提供しません。
* サービス自体は、サービスのファイアウォールを設定してそのようなトラフィックをブロックしない限り、VNetの外部からその公共エンドポイントを介してアクセス可能です。
* サブネットとAzureサービスの間の一対一の関係です。
* プライベートリンクよりも安価です。

**プライベートリンク：**

* プライベートリンクは、VNet内のプライベートエンドポイントを介してAzureサービスをVNetにマッピングします。これは、VNet内にプライベートIPアドレスを持つネットワークインターフェースです。
* AzureサービスはこのプライベートIPアドレスを使用してアクセスされ、あたかもネットワークの一部であるかのように見えます。
* プライベートリンクを介して接続されたサービスは、VNetまたは接続されたネットワークからのみアクセス可能であり、サービスへの公共インターネットアクセスはありません。
* Azureサービスへの安全な接続を可能にするだけでなく、Azureでホストされている自分のサービスや他人によって共有されているサービスへの接続も可能にします。
* サービスエンドポイントのサブネットレベルでのより広範なアクセス制御とは対照的に、VNet内のプライベートエンドポイントを介してより細かいアクセス制御を提供します。

要約すると、サービスエンドポイントとプライベートリンクの両方がAzureサービスへの安全な接続を提供する一方で、**プライベートリンクはサービスを公共インターネットに露出させることなくプライベートにアクセスすることを保証することで、より高いレベルの隔離とセキュリティを提供します**。一方、サービスエンドポイントは、VNet内にプライベートIPが必要ない場合に、Azureサービスへのシンプルで安全なアクセスを簡単に設定するためのものです。

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door**は、グローバルなWebアプリケーションのためのスケーラブルで安全なエントリーポイントです。これは、グローバルな**ロードバランシング、サイトアクセラレーション、SSLオフロード、およびWebアプリケーションファイアウォール（WAF）**の機能を単一のサービスに**組み合わせます**。Azure Front Doorは、**ユーザーに最も近いエッジロケーションに基づいたインテリジェントなルーティング**を提供し、最適なパフォーマンスと信頼性を保証します。さらに、URLベースのルーティング、複数サイトホスティング、セッションアフィニティ、およびアプリケーション層のセキュリティを提供します。

**Azure Front Door WAF**は、バックエンドコードを変更することなく、**Webベースの攻撃からWebアプリケーションを保護する**ように設計されています。SQLインジェクション、クロスサイトスクリプティング、その他の一般的な攻撃に対抗するカスタムルールと管理されたルールセットが含まれています。

### **例**

* 世界中にユーザーを持つグローバルに分散されたアプリケーションを想像してください。Azure Front Doorを使用して、**ユーザーのリクエストをアプリケーションをホストしている最も近い地域データセンターにルーティングする**ことで、遅延を減らし、ユーザーエクスペリエンスを向上させ、**WAF機能でWeb攻撃から守る**ことができます。特定の地域でダウンタイムが発生した場合、Azure Front Doorは自動的にトラフィックを次善のロケーションにリルートし、高可用性を保証します。

### 列挙

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway と Azure Application Gateway WAF

Azure Application Gateway は、**ウェブ**アプリケーションへのトラフィックを管理するための**ウェブトラフィックのロードバランサー**です。これは、サービスとしてのアプリケーションデリバリーコントローラー（ADC）内で**レイヤー7のロードバランシング、SSL終了、およびウェブアプリケーションファイアウォール（WAF）の機能**を提供します。URLベースのルーティング、クッキーベースのセッションアフィニティ、セキュアソケットレイヤー（SSL）オフロードなどの主要機能が含まれており、グローバルルーティングやパスベースのルーティングなど、複雑なロードバランシング機能を必要とするアプリケーションには不可欠です。

### 例

* 複数のサブドメインを持つ電子商取引ウェブサイトを運営しているシナリオを考えてみましょう。これらのサブドメインは、ユーザーアカウントや支払い処理など、異なる機能を持っています。Azure Application Gateway は、**URLパスに基づいて適切なウェブサーバーへトラフィックをルーティング**することができます。例えば、`example.com/accounts`へのトラフィックはユーザーアカウントサービスに、`example.com/pay`へのトラフィックは支払い処理サービスにそれぞれ向けることができます。\
そして、**WAFの機能を使用してウェブサイトを攻撃から保護します。**

### **列挙**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** は、異なるバーチャルネットワーク（VNets）を直接かつシームレスに接続することを可能にするAzureのネットワーキング機能です。VNetピアリングを通じて、あるVNet内のリソースは、**まるで同じネットワーク内にあるかのように**、別のVNet内のリソースとプライベートIPアドレスを使用して通信できます。\
**VNetピアリングは、オンプレミスネットワークとも使用できます**。これは、サイト間VPNやAzure ExpressRouteを設定することで実現します。

**Azure Hub and Spoke** は、Azureでネットワークトラフィックを管理・整理するために使用されるネットワークトポロジーです。**「ハブ」は、異なる「スポーク」間のトラフィックを制御し、ルーティングする中心点です**。ハブには、ネットワークバーチャルアプライアンス（NVAs）、Azure VPNゲートウェイ、Azureファイアウォール、またはAzure Bastionなどの共有サービスが含まれることが一般的です。**「スポーク」は、ワークロードをホストし、VNetピアリングを使用してハブに接続するVNetsです**。これにより、ハブ内の共有サービスを活用できます。このモデルは、複数のワークロードが異なるVNetsを使用する際に、共通サービスを中央集権化することで、クリーンなネットワークレイアウトを促進し、複雑さを減らします。

{% hint style="danger" %}
**AzureにおけるVNETピアリングは非推移的です**。つまり、スポーク1がスポーク2に接続され、スポーク2がスポーク3に接続されている場合、スポーク1はスポーク3と直接通信することはできません。
{% endhint %}

### 例

* 例えば、営業部、人事部、開発部など、別々の部門を持つ会社があり、**それぞれが独自のVNet（スポーク）を持っています**。これらのVNetsは、中央データベース、ファイアウォール、インターネットゲートウェイなどの**共有リソースへのアクセスが必要です**。これらはすべて**別のVNet（ハブ）に位置しています**。Hub and Spokeモデルを使用することで、各部門は、公共インターネットにそれらのリソースを露出させることなく、また複雑なネットワーク構造を多数の接続で作成することなく、**ハブVNetを通じて共有リソースに安全に接続できます**。

### 列挙

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## サイト間VPN

Azureのサイト間VPNを使用すると、**オンプレミスネットワークをAzure Virtual Network (VNet)に接続できます**。これにより、Azure内のリソース（VMなど）がローカルネットワーク上にあるかのように見えます。この接続は、**2つのネットワーク間のトラフィックを暗号化するVPNゲートウェイを通じて確立されます**。

### **例**

* ニューヨークに本社を置く企業が、オンプレミスのデータセンターをAzureにホストされているVNetに安全に接続する必要があります。このVNetは、仮想化されたワークロードをホストしています。**サイト間VPNを設定することで、企業はオンプレミスサーバーとAzure VM間の暗号化された接続を確保できます**。これにより、両環境のリソースを同じローカルネットワーク内にあるかのように安全にアクセスできます。

### **列挙**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRouteは、**オンプレミスインフラストラクチャとAzureデータセンター間のプライベートで専用の高速接続を提供するサービス**です。この接続は接続プロバイダーを介して行われ、公共インターネットを迂回し、一般的なインターネット接続よりも信頼性が高く、速度が速く、遅延が少なく、セキュリティが高いです。

### **例**

* 多国籍企業は、**大量のデータと高スループットのためにAzureサービスへの一貫性と信頼性のある接続が必要です**。同社は、オンプレミスのデータセンターをAzureに直接接続するためにAzure ExpressRouteを選択し、日々のバックアップやリアルタイムデータ分析などの大規模データ転送を、プライバシーと速度を向上させながら容易に行います。

### **列挙**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
```markdown
{% endcode %}

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をチェック！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**や**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
```
