# Az - Azure Ağı

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahramana kadar AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamını görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## Temel Bilgiler

Azure'daki ağlar, çeşitli Azure hizmetleri ve kaynakları arasındaki **bağlantı ve iletişimi** sağlayarak Azure'ın bulut bilişim platformunun ayrılmaz bir parçası olarak çalışır. Azure'daki ağ mimarisi, yüksek ölçeklenebilirlik, güvenlik ve özelleştirme sağlamak üzere tasarlanmıştır.

Azure, Azure bulutunda **izole edilmiş ağlar** oluşturmanıza izin veren bir **sanal ağ (VNet)** sağlar. Bu VNets içinde, sanal makineler, uygulamalar ve veritabanları gibi kaynaklar güvenli bir şekilde barındırılabilir ve yönetilebilir. Azure'daki ağ, hem bulut içindeki iletişimi (Azure hizmetleri arasında) hem de harici ağlara ve internete bağlantıyı destekler.

**Güvenlik**, Azure ağında kritik bir unsurdur ve verilerin korunması, erişimin yönetimi ve uyumluluğun sağlanması için çeşitli araçlar ve hizmetler mevcuttur. Bu güvenlik önlemleri, trafiği ve erişimi yüksek bir kontrol seviyesine olanak tanıyan **güvenlik duvarları**, **ağ güvenlik grupları** ve **şifreleme** yeteneklerini içerir.

Genel olarak, Azure'ın ağ yetenekleri, kullanıcıların belirli uygulama ve iş yükü ihtiyaçlarına uygun bir ağ ortamı oluşturmalarına olanak tanırken, güvenlik ve güvenilirlik konularına da büyük önem vermektedir.

## Sanal Ağ (VNET) ve Alt Ağlar

Azure'da bir VNet, temel olarak bulutta kendi ağınızın bir temsilidir. Bu, aboneliğinize özel Azure bulutunun **mantıksal bir izolasyonu**dur. Bir VNet, Azure'da sanal özel ağları (VPN'ler) oluşturmanıza ve yönetmenize olanak tanır ve Sanal Makineler (VM'ler), veritabanları ve uygulama hizmetleri gibi **çeşitli türdeki Azure kaynaklarını** barındırmak ve yönetmek için kullanılabilir.

VNets, **IP adresi** aralıkları, alt ağ oluşturma, rota tabloları ve ağ geçitleri dahil olmak üzere ağ ayarlarınız üzerinde **tam kontrol sağlar**.

Bir **alt ağ**, VNet'inizdeki bir **IP adresi aralığıdır**. Bir VNet'i, organizasyon ve güvenlik için birden çok alt ağa bölebilirsiniz. Bir VNet'teki her alt ağ, ağ ve uygulama mimarinize göre kaynakları izole etmek ve gruplandırmak için kullanılabilir.

Ayrıca, alt ağlar, kaynakların kullanabileceği IP adreslerinin bir aralığını sağlayarak VNet'inizi bir veya daha fazla alt ağa **bölmenize** olanak tanır.

### **Örnek**

* Diyelim ki `MyVNet` adında `10.0.0.0/16` IP adres aralığına sahip bir VNet'iniz var. Bu VNet içinde, web sunucularınızı barındırmak için `Subnet-1` adında `10.0.0.0/24` IP adres aralığına sahip bir alt ağ oluşturabilirsiniz. Veritabanı sunucularınız için ise `Subnet-2` adında `10.0.1.0/24` bir aralık kullanılabilir. Bu bölümleme, ağ içinde verimli yönetim ve güvenlik kontrolleri sağlar.

### Sıralama

Bir Azure hesabındaki tüm VNets ve alt ağları listelemek için Azure Komut Satırı Arayüzü (CLI) kullanabilirsiniz. İşte adımlar:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
## Ağ Güvenlik Grupları (NSG)

Azure'da, bir **Ağ Güvenlik Grubu (NSG)**, bir Azure Sanal Ağı (VNet) içindeki Azure kaynaklarına gelen ve giden ağ trafiğini filtreleme işlevini yerine getirir. Ağ trafiğinin akışını ayrıntılı bir şekilde belirleyen bir dizi **güvenlik kuralı** içerir.

NSG'nin temel özellikleri şunlardır:

- **Trafik Kontrolü**: Her NSG, çeşitli Azure kaynaklarıyla ilişkili gelen ve giden ağ trafiğini izin verme veya engelleme konusunda önemli bir rol oynayan kurallar içerir.
- **Kural Bileşenleri**: NSG içindeki kurallar, kaynak/hedef IP adresi, port ve protokol gibi kriterlere dayanarak trafiği filtreler. Bu ayrıntılı özellik, ağ trafiğinin ayrıntılı yönetimine olanak sağlar.
- **Güvenlik Geliştirmesi**: Yalnızca yetkilendirilmiş trafiğin Azure kaynaklarına girebileceğinden veya çıkabileceğinden emin olarak, NSG'ler ağ altyapınızın güvenlik durumunu güçlendirmede önemli bir rol oynar.

### **Örnek**

* VNet'inizde bir alt ağa veya belirli bir sanal makineye uygulanan `MyNSG` adında bir NSG'niz olduğunu hayal edin. Aşağıdaki gibi kurallar oluşturabilirsiniz:
* Herhangi bir kaynaktan web sunucularınıza HTTP trafiğine (port 80) izin veren bir gelen kuralı.
* Belirli bir hedef IP adres aralığına yalnızca SQL trafiğine (port 1433) izin veren bir giden kuralı.

### Numaralandırma

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
## Azure Güvenlik Duvarı

Azure Güvenlik Duvarı, Azure Sanal Ağ kaynaklarınızı koruyan yönetilen, bulut tabanlı bir **ağ güvenlik hizmetidir**. Yüksek kullanılabilirlik ve ölçeklenebilirlik özelliklerine sahip tamamen durum bilincine sahip bir güvenlik duvarıdır.

Azure Güvenlik Duvarı, **NSG'lerden daha gelişmiş** özellikler sunar, bunlar arasında **uygulama düzeyinde filtreleme**, ağ düzeyinde filtreleme, tehdit istihbaratına dayalı filtreleme ve günlükleme ve analiz için Azure Monitor ile entegrasyon bulunur.\
Giden, gelen, konuşan-konuşan, VPN ve ExpressRoute trafiğini filtreleyebilir. **Güvenlik duvarı kuralları FQDN (Tam Tanımlı Alan Adı), IP adresleri ve portlara dayalı olarak oluşturulabilir**.

### Azure Güvenlik Duvarı ve NSG'ler Arasındaki Farklar&#x20;

1. **Kapsam:**
* **NSG:** Alt ağ veya ağ arayüzü düzeyinde çalışır. Ağ arayüzlerinden (NIC), sanal makinelerden veya alt ağlardan gelen giden ve gelen trafiği temel düzeyde filtrelemek için kullanılır.
* **Azure Güvenlik Duvarı:** VNet düzeyinde çalışır ve daha geniş bir koruma kapsamı sağlar. Sanal ağ kaynaklarınızı güvence altına almak ve VNet'e giren ve çıkan trafiği yönetmek için tasarlanmıştır.
2. **Yetenekler:**
* **NSG:** IP adresi, port ve protokole dayalı temel filtreleme yetenekleri sunar. Uygulama düzeyinde denetim veya tehdit istihbaratı gibi gelişmiş özellikleri desteklemez.
* **Azure Güvenlik Duvarı:** Uygulama düzeyinde (Katman 7) trafiği filtreleme, tehdit istihbaratına dayalı filtreleme, ağ trafiği filtreleme ve daha fazlası gibi gelişmiş özellikler sunar. Ayrıca birden fazla genel IP adresini destekler.
3. **Kullanım Senaryoları:**
* **NSG:** Temel ağ düzeyinde trafiği filtrelemek için uygundur.
* **Azure Güvenlik Duvarı:** Uygulama düzeyinde kontrol, günlükleme ve tehdit istihbaratının gerektiği daha karmaşık filtreleme senaryoları için uygundur.
4. **Yönetim ve İzleme:**
* **NSG:** Temel düzeyde günlükleme ve Azure Monitor ile entegrasyon sunar.
* **Azure Güvenlik Duvarı:** Trafik doğasını ve desenini anlamak için önemli olan gelişmiş günlükleme ve analitik yetenekleri Azure Monitor aracılığıyla sağlar.

### Numaralandırma

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
## Ağ Sanal Cihazı (NVA)

Azure'da bir Ağ Sanal Cihazı (NVA), bir sanal ağ içinde **ağ işlevlerini gerçekleştiren bir sanal cihazdır**. NVA'lar genellikle Azure'da **doğal olarak mevcut olmayan ağ işlevleri** için veya daha fazla özelleştirme gerektiğinde kullanılır. Temelde, ağ uygulamaları veya hizmetleri çalıştıran sanal makinelerdir, örneğin güvenlik duvarları, WAN optimizasyonları veya yük dengeleyicileri gibi.

NVAs, karmaşık yönlendirme, **güvenlik** ve **ağ trafiği yönetimi** görevleri için kullanılır. Azure **Marketplace** üzerinden dağıtılabilirler, burada birçok üçüncü taraf satıcı, cihazlarını Azure ortamlarına entegre etmeye hazır olarak sunar.

### **Örnek**

* Bir kuruluş, özelleştirilmiş bir güvenlik duvarı çözümü oluşturmak için Azure'da bir NVA dağıtabilir. Bu NVA, gelişmiş özellikler sunan bir **üçüncü taraf güvenlik duvarı yazılımı** çalıştırabilir, örneğin sızma tespiti, paket incelemesi veya VPN bağlantısı. NVA, üzerinden geçen trafiği denetlemek ve filtrelemek için yapılandırılabilir, böylece kuruluşun politikalarına uygun olarak gelişmiş güvenlik önlemleri sağlanır.

### **Numaralandırma**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
## Azure Yönlendirme Tabloları ve Kullanıcı Tanımlı Yönlendirmeler (UDR)

**Azure Yönlendirme Tabloları**, Microsoft Azure içindeki **Azure Sanal Ağlar (VNets)** içindeki **ağ trafiği yönlendirmesini kontrol etmeye olanak sağlayan bir özelliktir**. Temel olarak, VNets içindeki alt ağlar arasında, VNets arasında veya harici ağlara nasıl **paketlerin yönlendirileceğini** tanımlar. Her yönlendirme tablosu, hedef IP adreslerine göre paketlerin nasıl yönlendirileceğini belirleyen kurallar kümesi olan yönlendirmeleri içerir.

Azure'da **Kullanıcı Tanımlı Yönlendirmeler (UDR)**, Azure Yönlendirme Tabloları içinde oluşturduğunuz **özel yönlendirmelerdir** ve Azure Sanal Ağlar (VNets) arasında ve harici bağlantılarda **ağ trafiğinin akışını kontrol etmek** için kullanılır. UDR'ler, belirli gereksinimlerinize göre ağ trafiğini yönlendirmenize olanak sağlar ve Azure'ın varsayılan yönlendirme kararlarını geçersiz kılar.

Bu yönlendirmeler, ağ trafiğini **sanal bir cihaz üzerinden yönlendirmeniz**, güvenlik veya politika uyumluluğu için belirli bir yol belirlemeniz veya yerindeki ağlarla entegrasyon yapmanız gereken senaryolarda özellikle kullanışlıdır.

### **Örnek**

* Bir VNet içindeki alt ağlar arasındaki trafiği denetlemek için bir Ağ Sanal Cihazı (NVA) dağıttığınızı varsayalım. Bir alt ağdan diğer bir alt ağa giden tüm trafiği NVA üzerinden yönlendiren bir UDR oluşturabilirsiniz. Bu UDR, trafiğin hedefine ulaşmadan önce NVA tarafından güvenlik amaçlı denetlenmesini sağlar.

### **Sıralama**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Özel Bağlantı

Azure Özel Bağlantı, Azure'da bir hizmete özel erişimi sağlayarak, Azure sanal ağınız (VNet) ile hizmet arasındaki trafiğin tamamen Microsoft'un Azure omurga ağı içinde seyahat etmesini sağlayan bir hizmettir. Bu şekilde hizmeti VNet'inize getirir. Bu yapı, verilerin genel internete maruz kalmadan güvenli bir şekilde iletilmesini sağlayarak güvenliği artırır.

Özel Bağlantı, Azure Depolama, Azure SQL Veritabanı ve Özel Bağlantı aracılığıyla paylaşılan özel hizmetler gibi çeşitli Azure hizmetleriyle kullanılabilir. Kendi VNet'inizden veya farklı Azure aboneliklerinden hizmetleri tüketmek için güvenli bir yol sağlar.

{% hint style="danger" %}
Özel uç noktalara NSG'ler uygulanmaz, bu da Özel Bağlantı içeren bir alt ağa NSG atamanın hiçbir etkisi olmadığı anlamına gelir.
{% endhint %}

### **Örnek**

* VNet'inizden güvenli bir şekilde erişmek istediğiniz bir **Azure SQL Veritabanı** olduğunu düşünün. Normalde, bu genel internet üzerinden geçmeyi gerektirebilir. Özel Bağlantı ile, Azure SQL Veritabanı hizmetine doğrudan bağlanan bir **özel uç nokta** oluşturabilirsiniz. Bu uç nokta, veritabanını kendi VNet'inizin bir parçası gibi görünmesini sağlar ve özel bir IP adresi aracılığıyla erişilebilir hale getirir, böylece güvenli ve özel erişim sağlanır.

### **Numaralandırma**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Hizmet Uç Noktaları

Azure Hizmet Uç Noktaları, sanal ağ özel adres alanınızı ve VNet'in kimliğini doğrudan bir bağlantı üzerinden Azure hizmetlerine genişletir. Hizmet uç noktalarını etkinleştirerek, **VNet'teki kaynaklar Azure Depolama ve Azure SQL Veritabanı gibi Azure hizmetlerine güvenli bir şekilde bağlanabilir**. Bu, VNet'ten Azure hizmetine olan trafiğin Azure ağı içinde kalmasını sağlayarak daha güvenli ve güvenilir bir yol sağlar.

### **Örnek**

* Örneğin, bir **Azure Depolama** hesabı varsayılan olarak genel internet üzerinden erişilebilir. VNet'iniz içinde Azure Depolama için bir **hizmet uç noktası etkinleştirerek**, yalnızca VNet'inizden gelen trafiğin depolama hesabına erişebilmesini sağlayabilirsiniz. Depolama hesabı güvenlik duvarı daha sonra yalnızca VNet'inizden gelen trafiği kabul etmek üzere yapılandırılabilir.

### **Numaralandırma**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Hizmet Uç Noktaları ve Özel Bağlantılar Arasındaki Farklar

Microsoft, [**dokümantasyonda**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints) Özel Bağlantıları önermektedir:

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Hizmet Uç Noktaları:**

* VNet'ten Azure hizmetine olan trafiğin iletimi, genel interneti atlayarak Microsoft Azure omurga ağı üzerinden gerçekleşir.
* Uç nokta, Azure hizmetine doğrudan bir bağlantıdır ve VNet içinde hizmet için özel bir IP sağlamaz.
* Hizmet, VNet dışından hala genel uç noktası üzerinden erişilebilir, ancak hizmet güvenlik duvarını bu tür trafiği engellemek için yapılandırmazsanız.
* Alt ağ ile Azure hizmeti arasında bir bir-bir ilişkisi vardır.
* Özel Bağlantılardan daha ucuzdur.

**Özel Bağlantılar:**

* Özel Bağlantı, Azure hizmetlerini VNet'inize özel bir uç nokta aracılığıyla eşler.
* Azure hizmetine bu özel IP adresi kullanılarak erişilir ve hizmet, ağınızın bir parçasıymış gibi görünür.
* Özel Bağlantı ile bağlantılı hizmetlere yalnızca VNet'inizden veya bağlı ağlardan erişilebilir; hizmete genel internet erişimi yoktur.
* Azure hizmetlerine veya Azure'da barındırılan kendi hizmetlerinize güvenli bir bağlantı sağlar ve başkaları tarafından paylaşılan hizmetlere bağlantı sağlar.
* Özel bir uç nokta aracılığıyla VNet'inizde daha geniş bir erişim kontrolü sağlar, hizmet uç noktası düzeyindeki daha geniş erişim kontrolüne kıyasla.

Özetlemek gerekirse, Hizmet Uç Noktaları ve Özel Bağlantılar, Azure hizmetlerine güvenli bağlantı sağlasa da, **Özel Bağlantılar, hizmetlere genel internete maruz kalmadan özel olarak erişilmesini sağlayarak daha yüksek bir izolasyon ve güvenlik düzeyi sunar**. Öte yandan, Hizmet Uç Noktaları, VNet'te özel bir IP gerektirmeyen basit ve güvenli erişim gerektiren genel durumlar için daha kolay kurulur.

## Azure Front Door (AFD) ve AFD WAF

**Azure Front Door**, küresel web uygulamalarınızın **hızlı teslimatı** için ölçeklenebilir ve güvenli bir giriş noktasıdır. **Küresel yük dengeleme, site hızlandırma, SSL kaldırma ve Web Uygulama Güvenlik Duvarı (WAF)** gibi çeşitli hizmetleri tek bir hizmette birleştirir. Azure Front Door, kullanıcıya en yakın kenar konumuna dayalı akıllı yönlendirme sağlayarak optimal performans ve güvenilirlik sağlar. Ayrıca, URL tabanlı yönlendirme, çoklu site barındırma, oturum bağımlılığı ve uygulama katmanı güvenliği sunar.

**Azure Front Door WAF**, arka uç kodunu değiştirmeden web uygulamalarını **web tabanlı saldırılara karşı korumak** için tasarlanmıştır. SQL enjeksiyonu, cross-site scripting ve diğer yaygın saldırılara karşı koruma sağlamak için özel kurallar ve yönetilen kural setleri içerir.

### **Örnek**

* Tüm dünyada kullanıcıları olan küresel bir dağıtıma sahip bir uygulamanız olduğunu hayal edin. Azure Front Door'u kullanarak kullanıcı isteklerini uygulamanızı barındıran en yakın bölgesel veri merkezine yönlendirebilir, böylece gecikmeyi azaltabilir, kullanıcı deneyimini iyileştirebilir ve **WAF yetenekleriyle web saldırılarına karşı savunma sağlayabilirsiniz**. Belirli bir bölge kesinti yaşarsa, Azure Front Door trafikleri otomatik olarak en iyi sonraki konuma yönlendirebilir ve yüksek kullanılabilirlik sağlar.

### Sıralama
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Uygulama Ağı ve Azure Uygulama Ağı WAF

Azure Uygulama Ağı, **web** uygulamalarınıza yönelik trafiği yönetmenizi sağlayan bir **web trafiği yük dengeleyicisidir**. Hizmet olarak bir Uygulama Dağıtım Denetleyicisi (ADC) olarak **Katman 7 yük dengeleme, SSL sonlandırma ve web uygulama güvenlik duvarı (WAF) yetenekleri** sunar. Ana özellikler arasında URL tabanlı yönlendirme, çerez tabanlı oturum bağımlılığı ve karmaşık yük dengeleme yeteneklerine ihtiyaç duyan küresel yönlendirme ve yol tabanlı yönlendirme gibi uygulamalar için önemli olan güvenli soket katmanı (SSL) dışa aktarma bulunur.

### Örnek

* Farklı işlevler için birden fazla alt alan adı içeren bir e-ticaret web sitesine sahip olduğunuzu düşünün, örneğin kullanıcı hesapları ve ödeme işleme. Azure Uygulama Ağı, trafiği **URL yoluna göre uygun web sunucularına yönlendirebilir**. Örneğin, `example.com/accounts` adresine yönelik trafiği kullanıcı hesapları hizmetine yönlendirebilir ve `example.com/pay` adresine yönelik trafiği ödeme işleme hizmetine yönlendirebilir.\
Ve **WAF yeteneklerini kullanarak web sitenizi saldırılardan koruyabilirsiniz.**

### **Numaralandırma**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke ve VNet Peering

**VNet Peering**, Azure'da farklı Sanal Ağların (VNet) doğrudan ve sorunsuz bir şekilde bağlanmasını sağlayan bir ağ özelliğidir. VNet peering sayesinde, bir VNet'teki kaynaklar, başka bir VNet'teki kaynaklarla özel IP adresleri kullanarak iletişim kurabilirler, sanki aynı ağda gibi.\
**VNet Peering, bir on-prem ağ ile de kullanılabilir**, site-to-site VPN veya Azure ExpressRoute kurarak.

**Azure Hub ve Spoke**, Azure'da ağ trafiğini yönetmek ve düzenlemek için kullanılan bir ağ topolojisidir. **"Hub", farklı "spoke"lar arasında trafiği kontrol eden ve yönlendiren merkezi bir noktadır**. Hub genellikle ağ sanal cihazları (NVA'lar), Azure VPN Gateway, Azure Firewall veya Azure Bastion gibi paylaşılan hizmetleri içerir. **"Spoke"lar, iş yüklerini barındıran ve VNet peering kullanarak hub'a bağlanan VNets'tir**, böylece farklı VNets'teki birden çok iş yükü, hub içindeki paylaşılan hizmetleri kullanabilir. Bu model, birden çok VNets'teki iş yüklerinin kullanabileceği ortak hizmetleri merkezileştirerek temiz bir ağ düzeni sağlar ve karmaşıklığı azaltır.

{% hint style="danger" %}
**Azure'da VNET eşleme geçişli değildir**, yani eğer spoke 1 spoke 2'ye bağlıysa ve spoke 2 spoke 3'e bağlıysa, spoke 1 doğrudan spoke 3 ile iletişim kuramaz.
{% endhint %}

### Örnekler

* Satış, İK ve Geliştirme gibi ayrı departmanlara sahip bir şirketi düşünün, **her biri kendi VNet'ine (spoke'larına) sahip**. Bu VNets, merkezi bir veritabanı, bir güvenlik duvarı ve bir internet ağı gibi **paylaşılan kaynaklara erişim gerektirir**, bu kaynaklar **başka bir VNet'te (hub) bulunur**. Hub ve Spoke modelini kullanarak, her departman, paylaşılan kaynaklara hub VNet üzerinden güvenli bir şekilde bağlanabilir, bu kaynakları halka açık internete maruz bırakmadan veya karmaşık bir ağ yapısı oluşturmadan kullanabilir.
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Azure'da bir Site-to-Site VPN, **yerindeki ağınızı Azure Sanal Ağı (VNet) ile bağlantılandırmanıza olanak tanır**, böylece Azure içindeki VM'ler gibi kaynaklar yerel ağınızda gibi görünür. Bu bağlantı, iki ağ arasında trafiği şifreleyen bir **VPN ağ geçidi aracılığıyla kurulur**.

### **Örnek**

* New York'ta ana ofisi bulunan bir işletmenin, sanallaştırılmış iş yüklerini barındıran Azure'daki VNet'ine güvenli bir şekilde bağlanması gereken bir yerinde veri merkezi vardır. **Site-to-Site VPN kurarak, şirket yerindeki sunucular ile Azure VM'leri arasında şifreli bağlantıyı sağlayabilir**, böylece kaynaklar her iki ortamda da aynı yerel ağda gibi güvenli bir şekilde erişilebilir.

### **Numaralandırma**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
## Azure ExpressRoute

Azure ExpressRoute, on-premiz altyapınız ile Azure veri merkezleri arasında **özel, adanmış, yüksek hızlı bir bağlantı sağlayan bir hizmettir**. Bu bağlantı, bir bağlantı sağlayıcı aracılığıyla gerçekleştirilir ve tipik internet bağlantılarına göre daha güvenilirlik, daha hızlı hızlar, daha düşük gecikmeler ve daha yüksek güvenlik sunarak genel interneti atlar.

### **Örnek**

* Bir çok uluslu şirket, yüksek veri hacmi ve yüksek verimlilik ihtiyacı nedeniyle Azure hizmetlerine **sürekli ve güvenilir bir bağlantıya ihtiyaç duyar**. Şirket, büyük ölçekli veri transferlerini, günlük yedeklemeleri ve gerçek zamanlı veri analitiği gibi işlemleri, artırılmış gizlilik ve hız ile gerçekleştirmek için on-premiz veri merkezini Azure'a doğrudan bağlamak için Azure ExpressRoute'u tercih eder.

### **Numaralandırma**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>AWS hackleme becerilerini sıfırdan kahraman seviyesine öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı **takip edin**.
* **Hacking hilelerinizi HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github depolarına PR göndererek paylaşın**.

</details>
