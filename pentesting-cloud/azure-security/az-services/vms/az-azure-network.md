# Az - Rete Azure

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team di HackTricks su AWS)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>

## Informazioni di Base

Le reti all'interno di Azure funzionano come parte integrante della sua piattaforma di cloud computing, consentendo la **connessione e la comunicazione tra vari servizi e risorse di Azure**. L'architettura di rete in Azure √® progettata per essere altamente scalabile, sicura e personalizzabile.

Al suo nucleo, Azure fornisce una **rete virtuale (VNet)** che consente agli utenti di creare **reti isolate** all'interno del cloud di Azure. All'interno di queste VNets, risorse come macchine virtuali, applicazioni e database possono essere ospitate e gestite in modo sicuro. La rete in Azure supporta sia la comunicazione all'interno del cloud (tra i servizi di Azure) che la connessione a reti esterne e a Internet.

**La sicurezza** √® un aspetto critico della rete Azure, con vari strumenti e servizi disponibili per proteggere i dati, gestire l'accesso e garantire la conformit√†. Queste misure di sicurezza includono **firewall**, **gruppi di sicurezza di rete** e capacit√† di **crittografia**, consentendo un elevato controllo sul traffico e sull'accesso.

Nel complesso, le capacit√† di rete di Azure sono progettate per offrire flessibilit√†, consentendo agli utenti di creare un ambiente di rete che soddisfi le specifiche esigenze delle proprie applicazioni e carichi di lavoro, mantenendo un forte emphasis sulla sicurezza e l'affidabilit√†.

## Rete Virtuale (VNET) e Sottoreti

Una VNet in Azure √® essenzialmente una rappresentazione della tua rete nel cloud. Si tratta di un'**isolazione logica del cloud di Azure dedicata al tuo abbonamento**. Una VNet ti consente di creare e gestire reti private virtuali (VPN) in Azure e pu√≤ essere utilizzata per ospitare e **gestire vari tipi di risorse di Azure**, come macchine virtuali (VM), database e servizi applicativi.

Le VNets ti forniscono **controllo completo sulle impostazioni di rete**, inclusi **intervalli di indirizzi IP**, creazione di sottoreti, tabelle di route e gateway di rete.

Una **sottorete** √® un **intervallo di indirizzi IP nella tua VNet**. Puoi dividere una VNet in pi√π sottoreti per organizzazione e sicurezza. Ogni sottorete in una VNet pu√≤ essere utilizzata per isolare e raggruppare risorse in base alla tua architettura di rete e applicazioni.

Inoltre, le sottoreti ti consentono di **segmentare la tua VNet in una o pi√π sottoreti**, fornendo un intervallo di indirizzi IP che le risorse possono utilizzare.

### **Esempio**

* Supponiamo di avere una VNet chiamata `MyVNet` con un intervallo di indirizzi IP di `10.0.0.0/16`. Puoi creare una sottorete all'interno di questa VNet, diciamo `Subnet-1`, con un intervallo di indirizzi IP di `10.0.0.0/24` per ospitare i tuoi server web. Un'altra sottorete, `Subnet-2` con un intervallo di `10.0.1.0/24`, potrebbe essere utilizzata per i tuoi server di database. Questa segmentazione consente una gestione efficiente e controlli di sicurezza all'interno della rete.

### Enumerazione

Per elencare tutte le VNets e le sottoreti in un account Azure, √® possibile utilizzare l'Interfaccia della Riga di Comando di Azure (CLI). Ecco i passaggi:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Gruppi di sicurezza di rete (NSG)

In Azure, un **Network Security Group (NSG)** svolge la funzione principale di filtrare il traffico di rete sia verso che da risorse Azure all'interno di una Rete Virtuale Azure (VNet). Contiene un insieme di **regole di sicurezza** che dettano attentamente il flusso del traffico di rete.

Gli aspetti chiave di NSG includono:

* **Controllo del Traffico**: Ogni NSG contiene regole che sono fondamentali nel permettere o ostacolare il traffico di rete in entrata e in uscita associato a varie risorse Azure.
* **Componenti delle Regole**: Le regole all'interno di un NSG sono molto specifiche, filtrando il traffico in base a criteri come indirizzo IP di origine/destinazione, porta e protocollo. Questa specificit√† consente una gestione dettagliata del traffico di rete.
* **Potenziamento della Sicurezza**: Assicurando che solo il traffico autorizzato possa entrare o uscire dalle risorse Azure, gli NSG svolgono un ruolo cruciale nel rafforzare la postura di sicurezza dell'infrastruttura di rete.

### **Esempio**

* Immagina di avere un NSG chiamato `MyNSG` applicato a un subnet o a una specifica macchina virtuale all'interno della tua VNet. Puoi creare regole come:
* Una regola in entrata che permette il traffico HTTP (porta 80) da qualsiasi origine ai tuoi server web.
* Una regola in uscita che permette solo il traffico SQL (porta 1433) a un determinato intervallo di indirizzi IP di destinazione.

### Enumerazione

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall √® un servizio di sicurezza di rete gestito basato su cloud che protegge le risorse della tua Rete Virtuale Azure. √à un firewall completamente stateful come servizio con funzionalit√† di disponibilit√† elevata e scalabilit√† integrate.

Azure Firewall fornisce funzionalit√† pi√π avanzate rispetto agli NSG, tra cui filtraggio a livello di applicazione, filtraggio a livello di rete, filtraggio basato su intelligence sulle minacce e integrazione con Azure Monitor per il logging e le analisi.\
Pu√≤ filtrare il traffico in uscita, in entrata, tra spoke, VPN e ExpressRoute. Le regole del firewall possono essere create in base a FQDN (Fully Qualified Domain Name), indirizzi IP e porte.

### Differenze tra Azure Firewall e NSG

1. **Ambito:**
* **NSG:** Lavora a livello di subnet o interfaccia di rete. √à destinato a fornire un filtraggio di base del traffico in entrata e in uscita dalle interfacce di rete (NIC), dalle VM o dalle subnet.
* **Azure Firewall:** Opera a livello di VNet, offrendo un ambito di protezione pi√π ampio. √à progettato per proteggere le risorse della tua rete virtuale e gestire il traffico in entrata e in uscita dalla VNet.
2. **Capacit√†:**
* **NSG:** Fornisce funzionalit√† di filtraggio di base basate su indirizzo IP, porta e protocollo. Non supporta funzionalit√† avanzate come l'ispezione a livello di applicazione o l'intelligenza sulle minacce.
* **Azure Firewall:** Offre funzionalit√† avanzate come il filtraggio del traffico a livello di applicazione (Livello 7), il filtraggio basato sull'intelligenza sulle minacce, il filtraggio del traffico di rete e altro ancora. Supporta anche pi√π indirizzi IP pubblici.
3. **Casi d'uso:**
* **NSG:** Ideale per il filtraggio di base del traffico a livello di rete.
* **Azure Firewall:** Adatto per scenari di filtraggio pi√π complessi in cui √® necessario il controllo a livello di applicazione, il logging e l'intelligenza sulle minacce.
4. **Gestione e Monitoraggio:**
* **NSG:** Offre logging di base e integrazione con Azure Monitor.
* **Azure Firewall:** Fornisce funzionalit√† avanzate di logging e analisi tramite Azure Monitor, essenziali per comprendere la natura e il pattern del traffico.

### Enumerazione

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

Un Network Virtual Appliance (**NVA**) in Azure √® un'applicazione virtuale che **esegue funzioni di rete all'interno di una rete virtuale**. Gli NVA sono tipicamente utilizzati per funzioni di rete che **non sono nativamente disponibili** in Azure o quando √® richiesta una maggiore personalizzazione. Sono essenzialmente **VM che eseguono applicazioni o servizi di rete**, come firewall, ottimizzatori WAN o bilanciatori di carico.

Gli NVA sono utilizzati per complesse attivit√† di instradamento, **sicurezza** e **gestione del traffico di rete**. Possono essere distribuiti da **Marketplace** di Azure, dove molti fornitori di terze parti offrono le loro applicazioni pronte per l'integrazione negli ambienti Azure.

### **Esempio**

* Un'organizzazione pu√≤ distribuire un NVA in Azure per creare una **soluzione firewall personalizzata**. Questo NVA potrebbe eseguire un **software firewall di terze parti**, fornendo funzionalit√† avanzate come rilevamento delle intrusioni, ispezione dei pacchetti o connettivit√† VPN. L'NVA pu√≤ essere configurato per ispezionare e filtrare il traffico che lo attraversa, garantendo che siano in atto misure di sicurezza avanzate secondo le politiche dell'organizzazione.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Tabelle di routing di Azure e Route definite dall'utente (UDR)

Le **Tabelle di routing di Azure** sono una funzionalit√† all'interno di Microsoft Azure che permette il **controllo del routing del traffico di rete all'interno delle Reti Virtuali di Azure (VNets)**. Fondamentalmente, definiscono come i **pacchetti** vengono **inoltrati** tra subnet all'interno delle VNets, tra le VNets o verso reti esterne. Ogni tabella di routing contiene un insieme di regole, note come route, che specificano come i pacchetti dovrebbero essere instradati in base ai loro indirizzi IP di destinazione.

Le **Route definite dall'utente (UDR)** in Azure sono **route personalizzate che crei all'interno delle Tabelle di routing di Azure** per controllare il **flusso del traffico di rete** all'interno e tra le Reti Virtuali di Azure (VNets) e verso connessioni esterne. Le UDR ti danno la flessibilit√† di indirizzare il traffico di rete secondo i tuoi requisiti specifici, sovrascrivendo le decisioni di routing predefinite di Azure.

Queste route sono particolarmente utili per scenari in cui √® necessario **instradare il traffico attraverso un'applicazione virtuale**, imporre un percorso specifico per motivi di sicurezza o conformit√† alle normative, o integrarsi con reti locali.

### **Esempio**

* Supponiamo tu abbia implementato un Dispositivo Virtuale di Rete (NVA) per ispezionare il traffico tra le subnet all'interno di una VNet. Puoi creare una UDR che instrada tutto il traffico da una subnet a un'altra subnet attraverso l'NVA. Questa UDR garantisce che l'NVA ispezioni il traffico per motivi di sicurezza prima che raggiunga la sua destinazione.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link √® un servizio in Azure che **consente l'accesso privato ai servizi Azure** garantendo che **il traffico tra la tua rete virtuale Azure (VNet) e il servizio viaggi interamente all'interno della rete principale di Azure di Microsoft**. Porta efficacemente il servizio nella tua VNet. Questa configurazione migliora la sicurezza non esponendo i dati a Internet pubblico.

Private Link pu√≤ essere utilizzato con vari servizi Azure, come Azure Storage, Azure SQL Database e servizi personalizzati condivisi tramite Private Link. Fornisce un modo sicuro per consumare servizi all'interno della propria VNet o anche da diverse sottoscrizioni Azure.

{% hint style="danger" %}
Gli NSG non si applicano agli endpoint privati, il che significa chiaramente che associare un NSG a un subnet che contiene il Private Link non avr√† alcun effetto.
{% endhint %}

### **Esempio**

* Considera uno scenario in cui hai un **Azure SQL Database a cui desideri accedere in modo sicuro dalla tua VNet**. Normalmente, questo potrebbe comportare il transito su Internet pubblico. Con Private Link, puoi creare un **endpoint privato nella tua VNet** che si connette direttamente al servizio Azure SQL Database. Questo endpoint fa apparire il database come se facesse parte della tua stessa VNet, accessibile tramite un indirizzo IP privato, garantendo cos√¨ un accesso sicuro e privato.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Punti di servizio di Azure

I punti di servizio di Azure estendono lo spazio degli indirizzi privati della tua rete virtuale e l'identit√† della tua VNet ai servizi di Azure tramite una connessione diretta. Abilitando i punti di servizio, **le risorse nella tua VNet possono connettersi in modo sicuro ai servizi di Azure**, come Azure Storage e Azure SQL Database, utilizzando la rete principale di Azure. Ci√≤ garantisce che il **traffico dalla VNet al servizio di Azure rimanga all'interno della rete di Azure**, offrendo un percorso pi√π sicuro e affidabile.

### **Esempio**

* Ad esempio, un account **Azure Storage** √® di default accessibile tramite internet pubblico. Abilitando un **punto di servizio per Azure Storage all'interno della tua VNet**, puoi garantire che solo il traffico dalla tua VNet possa accedere all'account di archiviazione. Il firewall dell'account di archiviazione pu√≤ quindi essere configurato per accettare solo il traffico dalla tua VNet.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Differenze tra Endpoint di Servizio e Collegamenti Privati

Microsoft raccomanda l'uso dei Collegamenti Privati nella [**documentazione**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Endpoint di Servizio:**

* Il traffico dal tuo VNet al servizio Azure viaggia sulla rete principale di Microsoft Azure, evitando l'uso di internet pubblico.
* L'endpoint √® una connessione diretta al servizio Azure e non fornisce un IP privato per il servizio all'interno del VNet.
* Il servizio stesso √® ancora accessibile tramite il suo endpoint pubblico da fuori il tuo VNet a meno che tu non configuri il firewall del servizio per bloccare tale traffico.
* Si tratta di una relazione uno a uno tra il subnet e il servizio Azure.
* Meno costoso rispetto ai Collegamenti Privati.

**Collegamenti Privati:**

* Il Collegamento Privato mappa i servizi Azure nel tuo VNet tramite un endpoint privato, che √® un'interfaccia di rete con un indirizzo IP privato all'interno del tuo VNet.
* Il servizio Azure √® accessibile utilizzando questo indirizzo IP privato, facendolo apparire come parte della tua rete.
* I servizi connessi tramite Collegamento Privato possono essere accessibili solo dal tuo VNet o dalle reti collegate; non c'√® accesso a internet pubblico per il servizio.
* Consente una connessione sicura ai servizi Azure o ai tuoi servizi ospitati in Azure, nonch√© una connessione ai servizi condivisi da altri.
* Fornisce un controllo degli accessi pi√π granulare tramite un endpoint privato nel tuo VNet, rispetto a un controllo degli accessi pi√π ampio a livello di subnet con gli endpoint di servizio.

In sintesi, mentre sia gli Endpoint di Servizio che i Collegamenti Privati forniscono una connettivit√† sicura ai servizi Azure, **i Collegamenti Privati offrono un livello pi√π elevato di isolamento e sicurezza garantendo che i servizi siano accessibili privatamente senza esporli a internet pubblico**. Gli Endpoint di Servizio, d'altra parte, sono pi√π facili da configurare per casi generali in cui √® richiesto un accesso semplice e sicuro ai servizi Azure senza la necessit√† di un IP privato nel VNet.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** √® un punto di ingresso scalabile e sicuro per la **consegna rapida** delle tue applicazioni web globali. **Combina** vari servizi come il **bilanciamento del carico globale, l'accelerazione del sito, lo scarico SSL e le capacit√† del Web Application Firewall (WAF)** in un unico servizio. Azure Front Door fornisce un instradamento intelligente basato sulla **posizione del bordo pi√π vicina all'utente**, garantendo prestazioni e affidabilit√† ottimali. Inoltre, offre instradamento basato su URL, hosting di pi√π siti, affinit√† di sessione e sicurezza a livello di applicazione.

**Azure Front Door WAF** √® progettato per **proteggere le applicazioni web dagli attacchi basati sul web** senza modifiche al codice di backend. Include regole personalizzate e set di regole gestite per proteggere contro minacce come l'SQL injection, il cross-site scripting e altri attacchi comuni.

### **Esempio**

* Immagina di avere un'applicazione distribuita globalmente con utenti in tutto il mondo. Puoi utilizzare Azure Front Door per **instradare le richieste degli utenti al data center regionale pi√π vicino** che ospita la tua applicazione, riducendo cos√¨ la latenza, migliorando l'esperienza dell'utente e **difendendola dagli attacchi web con le capacit√† del WAF**. Se una particolare regione subisce un'interruzione, Azure Front Door pu√≤ automaticamente instradare il traffico verso la posizione successiva migliore, garantendo un'elevata disponibilit√†.

### Enumerazione

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway e Azure Application Gateway WAF

Azure Application Gateway √® un **bilanciatore del carico del traffico web** che ti consente di gestire il traffico verso le tue **applicazioni web**. Offre **bilanciamento del carico di livello 7, terminazione SSL e capacit√† di firewall delle applicazioni web (WAF)** nel Controller di distribuzione delle applicazioni (ADC) come servizio. Le funzionalit√† chiave includono il routing basato su URL, l'affinit√† della sessione basata su cookie e lo scarico del livello di sicurezza dei socket (SSL), che sono cruciali per le applicazioni che richiedono capacit√† di bilanciamento del carico complesse come il routing globale e il routing basato su percorsi.

### Esempio

* Considera uno scenario in cui hai un sito web di e-commerce che include pi√π sottodomini per funzioni diverse, come account utente e elaborazione dei pagamenti. Azure Application Gateway pu√≤ **instradare il traffico ai server web appropriati in base al percorso dell'URL**. Ad esempio, il traffico verso `esempio.com/account` potrebbe essere indirizzato al servizio account utente e il traffico verso `esempio.com/pagamento` potrebbe essere indirizzato al servizio di elaborazione dei pagamenti.\
E **proteggere il tuo sito web da attacchi utilizzando le capacit√† del WAF.**

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** √® una funzionalit√† di rete in Azure che **consente a diversi Virtual Network (VNets) di essere collegati direttamente e senza soluzione di continuit√†**. Attraverso il VNet peering, le risorse in un VNet possono comunicare con le risorse in un altro VNet utilizzando indirizzi IP privati, **come se fossero nella stessa rete**.\
**Il VNet Peering pu√≤ essere utilizzato anche con reti locali** configurando una VPN sito-sito o Azure ExpressRoute.

**Azure Hub e Spoke** √® una topologia di rete utilizzata in Azure per gestire e organizzare il traffico di rete. **Il "hub" √® un punto centrale che controlla e instrada il traffico tra diversi "spoke"**. L'hub contiene tipicamente servizi condivisi come dispositivi virtuali di rete (NVAs), Azure VPN Gateway, Azure Firewall o Azure Bastion. Gli **"spoke" sono VNets che ospitano carichi di lavoro e si connettono all'hub utilizzando il VNet peering**, consentendo loro di sfruttare i servizi condivisi all'interno dell'hub. Questo modello favorisce una disposizione pulita della rete, riducendo la complessit√† centralizzando i servizi comuni che pi√π carichi di lavoro attraverso diversi VNets possono utilizzare.

{% hint style="danger" %}
**Il VNET pairing non √® transitivo in Azure**, il che significa che se lo spoke 1 √® connesso allo spoke 2 e lo spoke 2 √® connesso allo spoke 3, allora lo spoke 1 non pu√≤ parlare direttamente con lo spoke 3.
{% endhint %}

### Esempi

* Immagina un'azienda con dipartimenti separati come Vendite, HR e Sviluppo, **ciascuno con il proprio VNet (gli spoke)**. Questi VNets **richiedono accesso a risorse condivise** come un database centrale, un firewall e un gateway internet, che sono tutti situati in **un altro VNet (l'hub)**. Utilizzando il modello Hub e Spoke, ogni dipartimento pu√≤ **connettersi in modo sicuro alle risorse condivise attraverso l'hub VNet senza esporre tali risorse a Internet pubblico** o creare una struttura di rete complessa con numerose connessioni.

### Enumerazione

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## VPN Sito-Sito

Una VPN Sito-Sito in Azure ti consente di **connettere la tua rete locale alla tua Rete Virtuale Azure (VNet)**, consentendo alle risorse come le VM all'interno di Azure di apparire come se fossero nella tua rete locale. Questa connessione √® stabilita attraverso un **gateway VPN che crittografa il traffico** tra le due reti.

### **Esempio**

* Un'azienda con la sua sede principale a New York ha un data center in loco che deve connettersi in modo sicuro alla sua VNet in Azure, che ospita i suoi carichi di lavoro virtualizzati. Configurando una **VPN Sito-Sito, l'azienda pu√≤ garantire una connettivit√† crittografata tra i server in loco e le VM di Azure**, consentendo alle risorse di essere accessibili in modo sicuro in entrambi gli ambienti come se fossero nella stessa rete locale.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute √® un servizio che fornisce una **connessione privata, dedicata e ad alta velocit√† tra la tua infrastruttura on-premises e i data center di Azure**. Questa connessione avviene tramite un fornitore di connettivit√†, bypassando l'internet pubblico e offrendo maggiore affidabilit√†, velocit√† pi√π elevate, latenze inferiori e una sicurezza superiore rispetto alle connessioni internet tipiche.

### **Esempio**

* Una societ√† multinazionale richiede una **connessione coerente e affidabile ai suoi servizi Azure a causa dell'alto volume di dati** e della necessit√† di un'elevata larghezza di banda. L'azienda opta per Azure ExpressRoute per connettere direttamente il suo data center on-premises ad Azure, facilitando trasferimenti di dati su larga scala, come backup giornalieri e analisi dei dati in tempo reale, con maggiore privacy e velocit√†.

### **Enumerazione**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>Impara l'hacking su AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team di HackTricks su AWS)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se desideri vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione esclusiva di [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
