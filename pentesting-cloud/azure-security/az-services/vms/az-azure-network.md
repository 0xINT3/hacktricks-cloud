# Az - Azure Mtandao

<details>

<summary><strong>Jifunze AWS hacking kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Taarifa Msingi

Mtandao ndani ya Azure hufanya kazi kama sehemu muhimu ya jukwaa lake la kompyuta la wingu, kuruhusu **kuunganisha na mawasiliano kati ya huduma na rasilimali mbalimbali za Azure**. Mimarizi ya mtandao katika Azure imeundwa kuwa na uwezo wa kupanuka, kuwa salama, na inayoweza kubadilishwa.

Kimsingi, Azure hutoa **mtandao wa kisasa (VNet)** ambao huruhusu watumiaji kuunda **mitandao iliyotengwa** ndani ya wingu la Azure. Ndani ya hivi VNets, rasilimali kama vile mashine za kisasa, programu, na maktaba zinaweza kuhostiwa na kusimamiwa kwa usalama. Mtandao katika Azure unasaidia mawasiliano ndani ya wingu (kati ya huduma za Azure) na uhusiano na mitandao ya nje na intaneti.

**Usalama** ni sehemu muhimu ya mtandao wa Azure, na zana na huduma mbalimbali zinapatikana kwa kulinda data, kusimamia ufikiaji, na kuhakikisha utii. Hatua hizi za usalama ni pamoja na **firewalls**, **vikundi vya usalama wa mtandao**, na uwezo wa **encryption**, kuruhusu kiwango kikubwa cha udhibiti juu ya trafiki na ufikiaji.

Kwa ujumla, uwezo wa mtandao wa Azure umebuniwa kutoa mabadiliko, kuruhusu watumiaji kuunda mazingira ya mtandao yanayofaa mahitaji yao maalum ya maombi na kazi wakati ukiendelea kuweka mkazo mkubwa kwenye usalama na uaminifu.

## Mtandao wa Kivitual (VNET) & Subnets

VNet katika Azure ni kimsingi uwakilishi wa mtandao wako mwenyewe kwenye wingu. Ni **utengaji wa mantiki wa wingu la Azure uliotengwa kwa usajili wako**. VNet inakuruhusu kuweka na kusimamia mitandao binafsi ya kivitual (VPNs) katika Azure na inaweza kutumika kuhosti na **kusimamia aina mbalimbali za rasilimali za Azure**, kama Mashine za Kivitual (VMs), maktaba, na huduma za programu.

VNets hukupa **udhibiti kamili wa mipangilio yako ya mtandao**, ikiwa ni pamoja na **aina za anwani za IP**, uumbaji wa subneti, meza za njia, na malango ya mtandao.

**Subneti** ni **aina ya anwani za IP katika VNet yako**. Unaweza kugawa VNet katika subneti nyingi kwa ajili ya utaratibu na usalama. Kila subnet katika VNet inaweza kutumika kwa kufanya kazi na kikundi cha rasilimali kulingana na muundo wako wa mtandao na maombi.

Zaidi ya hayo, subneti hukuruhusu **kugawa VNet yako katika subneti moja au zaidi**, ikitoa aina ya anwani za IP ambazo rasilimali zinaweza kutumia.

### **Mfano**

* Fikiria una VNet inayoitwa `MyVNet` yenye mfululizo wa anwani ya IP `10.0.0.0/16`. Unaweza kuunda subneti ndani ya VNet hii, sema `Subnet-1`, yenye mfululizo wa anwani ya IP `10.0.0.0/24` kwa ajili ya kuhosti seva zako za wavuti. Subneti nyingine, `Subnet-2` yenye mfululizo wa `10.0.1.0/24`, inaweza kutumika kwa seva zako za maktaba. Ubaguzi huu unaruhusu usimamizi na udhibiti wa usalama ndani ya mtandao.

### Uorodheshaji

Kutaja VNets na subneti zote katika akaunti ya Azure, unaweza kutumia Interface ya Amri ya Azure (CLI). Hapa kuna hatua:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Vikundi vya Usalama wa Mtandao (NSG)

Katika Azure, **Kikundi cha Usalama wa Mtandao (NSG)** kina jukumu kuu la kuchuja trafiki ya mtandao kuelekea na kutoka kwa rasilimali za Azure ndani ya Mtandao wa Virtual wa Azure (VNet). Kina seti ya **sheria za usalama** ambazo zinaelekeza kwa uangalifu mtiririko wa trafiki ya mtandao.

Vipengele muhimu vya NSG ni pamoja na:

* **Kudhibiti Trafiki**: Kila NSG ina sheria ambazo ni muhimu katika kuruhusu au kuzuia trafiki ya kuingia na kutoka kwa rasilimali za Azure mbalimbali.
* **Vipengele vya Sheria**: Sheria ndani ya NSG ni maalum sana, zikichuja trafiki kulingana na vigezo kama vile anwani ya IP ya chanzo/mahali pa marudio, mlango, na itifaki. Uelekezi huu maalum unaruhusu usimamizi wa kina wa trafiki ya mtandao.
* **Kuongeza Usalama**: Kwa kuhakikisha kuwa ni trafiki iliyoruhusiwa tu inayoweza kuingia au kutoka kwa rasilimali zako za Azure, NSGs zina jukumu muhimu katika kuimarisha hali ya usalama wa miundombinu yako ya mtandao.

### **Mfano**

* Fikiria una NSG iitwayo `MyNSG` iliyotekelezwa kwenye eneo au mashine ya virtual maalum ndani ya VNet yako. Unaweza kuunda sheria kama:
* Sheria ya kuingia kuruhusu trafiki ya HTTP (mlango 80) kutoka chanzo chochote kwenda kwenye seva zako za wavuti.
* Sheria ya kutoka kuruhusu trafiki ya SQL (mlango 1433) kwenda kwenye safu maalum ya anwani ya IP ya marudio.

### Uthibitishaji

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Kizuizi cha Azure

Kizuizi cha Azure ni huduma ya usalama wa mtandao iliyosimamiwa kwenye wingu inayolinda rasilimali zako za Mtandao wa Virtual wa Azure. Ni kizuizi kamili cha hali ya hewa kama huduma na vipengele vya upatikanaji wa juu na uwezo wa kupanuka.

Kizuizi cha Azure hutoa vipengele vya **juu zaidi** kuliko **NSGs**, ikiwa ni pamoja na uchujaji wa kiwango cha maombi, uchujaji wa kiwango cha mtandao, uchujaji unaotegemea ujasusi wa vitisho, na ushirikiano na Azure Monitor kwa ajili ya kuingiza na takwimu.\
Inaweza kuchuja trafiki ya kutoka nje, kuingia, kutoka spoke hadi spoke, VPN, na trafiki ya ExpressRoute. **Sheria za kizuizi zinaweza kuundwa kulingana na FQDN (Jina Kamili la Kikoa), anwani za IP, na bandari**.

### Tofauti kati ya Kizuizi cha Azure na NSGs

1. **Upeo:**
* **NSG:** Inafanya kazi kwenye kiwango cha subnet au kiolesura cha mtandao. Imelenga kutoa uchujaji wa msingi wa trafiki ya kuingia na kutoka kwenye kiolesura cha mtandao (NIC), VMs, au subneti.
* **Kizuizi cha Azure:** Hufanya kazi kwenye kiwango cha VNet, kutoa wigo mpana wa ulinzi. Imepangwa kulinda rasilimali zako za mtandao wa virtual na kusimamia trafiki inayoingia na kutoka kwenye VNet.
2. **Uwezo:**
* **NSG:** Hutoa uwezo wa msingi wa uchujaji kulingana na anwani ya IP, bandari, na itifaki. Haishikilii vipengele vya juu kama uchunguzi wa kiwango cha maombi au ujasusi wa vitisho.
* **Kizuizi cha Azure:** Inatoa vipengele vya juu kama uchujaji wa trafiki wa kiwango cha maombi (Tabaka 7), uchujaji unaotegemea ujasusi wa vitisho, uchujaji wa trafiki wa mtandao, na zaidi. Pia inasaidia anwani za IP za umma zaidi ya moja.
3. **Matumizi:**
* **NSG:** Inafaa kwa uchujaji wa msingi wa trafiki wa kiwango cha mtandao.
* **Kizuizi cha Azure:** Inafaa kwa mazingira ya uchujaji yenye utata zaidi ambapo udhibiti wa kiwango cha maombi, kuingiza, na ujasusi wa vitisho unahitajika.
4. **Usimamizi na Ufuatiliaji:**
* **NSG:** Inatoa kuingiza msingi na ushirikiano na Azure Monitor.
* **Kizuizi cha Azure:** Hutoa uwezo wa kuingiza na takwimu za juu kupitia Azure Monitor, ambayo ni muhimu kwa kuelewa asili na mchoro wa trafiki. 

### Urambazaji

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Kifaa cha Mtandao cha Virtual (NVA)

Kifaa cha Mtandao cha Virtual (**NVA**) katika Azure ni kifaa cha virtual kinachotekeleza **kazi za mtandao ndani ya mtandao wa virtual**. NVAs kawaida hutumiwa kwa kazi za mtandao ambazo **hazipatikani kiasili** katika Azure au wakati mahitaji ya ubinafsishaji zaidi yanahitajika. Kimsingi ni **VMs zinazotekeleza programu au huduma za mtandao**, kama vile firewalls, WAN optimizers, au load balancers.

NVAs hutumiwa kwa ujumuishaji wa njia za kina, **usalama**, na kazi za **usimamizi wa trafiki za mtandao**. Wanaweza kupelekwa kutoka kwenye **Soko la Azure**, ambapo wauzaji wengi wa tatu hutoa vifaa vyao tayari kwa ujumuishaji katika mazingira ya Azure.

### **Mfano**

* Shirika linaweza kupeleka NVA katika Azure ili kuunda **ufumbuzi wa firewall wa kawaida**. NVA hii inaweza kuendesha **programu ya firewall ya tatu**, ikitoa huduma za juu kama uchunguzi wa kuingilia, ukaguzi wa pakiti, au uunganisho wa VPN. NVA inaweza kusanidiwa kuchunguza na kuchuja trafiki inayopita kupitia, kuhakikisha hatua za usalama zilizoboreshwa zinawekwa kulingana na sera za shirika. 

### **Uorodheshaji**
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables** ni kipengele ndani ya Microsoft Azure kinachoruhusu **udhibiti wa mwelekeo wa trafiki ya mtandao ndani ya Azure Virtual Networks (VNets)**. Kimsingi, hufafanua jinsi **pakiti** zinavyo **pelekwa** kati ya subnet ndani ya VNets, kati ya VNets, au kwenye mitandao ya nje. Kila meza ya njia ina seti ya sheria, inayoitwa njia, ambazo hufafanua jinsi pakiti zinapaswa kupelekwa kulingana na anwani zao za IP za marudio.

**User Defined Routes (UDR)** katika Azure ni **njia za desturi unazounda ndani ya Meza za Njia za Azure** ili kudhibiti **mtiririko wa trafiki ya mtandao** ndani na kati ya Azure Virtual Networks (VNets), na kwa mawasiliano ya nje. UDR hukupa uwezo wa kuongoza trafiki ya mtandao kulingana na mahitaji yako maalum, kukiuka maamuzi ya kawaida ya njia za Azure.

Njia hizi ni muhimu hasa kwa hali ambapo unahitaji **kupeleka trafiki kupitia kifaa cha kidhahiri**, kutekeleza njia maalum kwa usalama au kufuata sera, au kuingiliana na mitandao ya ndani.

### **Mfano**

* Fikiria umeweka Kifaa cha Kidhahiri cha Mtandao (NVA) kwa ukaguzi wa trafiki kati ya subnet ndani ya VNet. Unaweza kuunda UDR inayoongoza trafiki yote kutoka subnet moja kwenda subnet nyingine kupitia NVA. UDR hii inahakikisha kuwa NVA inakagua trafiki kwa madhumuni ya usalama kabla haijafika marudio yake.

### **Uorodheshaji**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link ni huduma katika Azure ambayo **inawezesha ufikiaji wa kibinafsi kwa huduma za Azure** kwa kuhakikisha kwamba **trafiki kati ya mtandao wako wa kibinafsi wa Azure (VNet) na huduma inasafiri kabisa ndani ya mtandao wa msingi wa Azure wa Microsoft**. Inaleta huduma hiyo kwenye VNet yako kwa ufanisi. Hii inaimarisha usalama kwa kutokuweka data wazi kwa umma wa intaneti.

Private Link inaweza kutumika na huduma mbalimbali za Azure, kama vile Azure Storage, Azure SQL Database, na huduma za desturi zilizoshirikiwa kupitia Private Link. Inatoa njia salama ya kutumia huduma kutoka ndani ya VNet yako au hata kutoka michango tofauti ya Azure.

{% hint style="danger" %}
NSGs hazitumiki kwa vituo vya kibinafsi, ambayo inamaanisha wazi kwamba kuunganisha NSG na subnet inayojumuisha Private Link haitakuwa na athari yoyote.
{% endhint %}

### **Mfano**

* Fikiria hali ambapo una **Azure SQL Database ambayo unataka kufikia kwa usalama kutoka kwenye VNet yako**. Kawaida, hii inaweza kuhusisha kupita kwenye intaneti ya umma. Kwa kutumia Private Link, unaweza kuunda **kituo cha kibinafsi kwenye VNet yako** ambacho kinahusisha moja kwa moja na huduma ya Azure SQL Database. Kituo hiki kinawezesha database kuonekana kana kwamba ni sehemu ya VNet yako mwenyewe, inayopatikana kupitia anwani ya IP ya kibinafsi, hivyo kuhakikisha ufikiaji salama na wa kibinafsi.

### **Uorodheshaji**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Huduma za Ncha za Azure

Ncha za Huduma za Azure huongeza eneo lako la anwani binafsi la mtandao wa kibinafsi na kitambulisho cha VNet yako kwa huduma za Azure kupitia uhusiano wa moja kwa moja. Kwa kuwezesha ncha za huduma, **rasilimali katika VNet yako zinaweza kuunganisha kwa usalama na huduma za Azure**, kama Azure Storage na Azure SQL Database, kutumia mtandao wa msingi wa Azure. Hii inahakikisha kwamba **trafiki kutoka VNet kwenda kwa huduma ya Azure inabaki ndani ya mtandao wa Azure**, kutoa njia salama na thabiti.

### **Mfano**

* Kwa mfano, akaunti ya **Azure Storage** kwa chaguo-msingi inaweza kufikiwa kupitia mtandao wa umma. Kwa kuwezesha **ncha ya huduma kwa Azure Storage ndani ya VNet yako**, unaweza kuhakikisha kwamba trafiki kutoka kwa VNet yako tu ndiyo inaweza kufikia akaunti ya kuhifadhi. Kinga ya kizuizi cha akaunti ya kuhifadhi inaweza kisha kusanidiwa kupokea trafiki kutoka kwa VNet yako tu.

### **Uorodheshaji**
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Tofauti Kati ya Vipengele vya Huduma na Viungo Binafsi

Microsoft inapendekeza kutumia Viungo Binafsi katika [**nyaraka**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Vipengele vya Huduma:**

* Trafiki kutoka kwenye VNet yako kwenda kwenye huduma ya Azure inapita kupitia mtandao wa msingi wa Microsoft Azure, ikipuuza internet ya umma.
* Endpoint ni uhusiano moja kwa moja kwenye huduma ya Azure na haipatikani kwa anwani ya IP binafsi kwa huduma ndani ya VNet.
* Huduma yenyewe bado inaweza kufikiwa kupitia endpoint yake ya umma kutoka nje ya VNet yako isipokuwa ukiweke kinga ya huduma kuzuia trafiki kama hiyo.
* Ni uhusiano wa moja kwa moja kati ya subnet na huduma ya Azure.
* Gharama ni ndogo kuliko Viungo Binafsi.

**Viungo Binafsi:**

* Viungo Binafsi vinachora huduma za Azure ndani ya VNet yako kupitia endpoint binafsi, ambayo ni kioleshi cha mtandao chenye anwani ya IP binafsi ndani ya VNet yako.
* Huduma ya Azure inafikiwa kwa kutumia anwani hii ya IP binafsi, ikifanya ionekane kama sehemu ya mtandao wako.
* Huduma zilizounganishwa kupitia Viungo Binafsi zinaweza kufikiwa tu kutoka kwenye VNet yako au mitandao iliyounganishwa; hakuna ufikiaji wa internet ya umma kwa huduma.
* Inawezesha uhusiano salama kwa huduma za Azure au huduma zako zinazohifadhiwa kwenye Azure, pamoja na uhusiano kwa huduma zinazoshirikiwa na wengine.
* Inatoa udhibiti wa ufikiaji wa kina zaidi kupitia endpoint binafsi katika VNet yako, tofauti na udhibiti wa ufikiaji wa kawaida kwenye kiwango cha subnet na vipengele vya huduma.

Kwa muhtasari, wakati Vipengele vya Huduma na Viungo Binafsi vinatoa uhusiano salama kwa huduma za Azure, **Viungo Binafsi hutoa kiwango kikubwa zaidi cha kujitenga na usalama kwa kuhakikisha kuwa huduma zinafikiwa kwa faragha bila kuzionyesha kwa umma**. Vipengele vya Huduma, kwa upande mwingine, ni rahisi kuweka kwa matukio ya kawaida ambapo ufikiaji rahisi na salama kwa huduma za Azure unahitajika bila haja ya anwani ya IP binafsi katika VNet.

## Mlango wa Mbele wa Azure (AFD) & AFD WAF

**Mlango wa Mbele wa Azure** ni njia ya kuingilia inayoweza kupanuliwa na salama kwa **utoaji wa haraka** wa maombi yako ya wavuti ulimwenguni. **Inachanganya** huduma mbalimbali kama **usawa wa mzigo wa ulimwengu, kuharakisha tovuti, kufuta SSL, na uwezo wa Firewall wa Maombi ya Wavuti (WAF)** katika huduma moja. Mlango wa Mbele wa Azure hutoa upelekaji wenye akili kulingana na **eneo la pembezoni karibu na mtumiaji**, ikihakikisha utendaji na uaminifu bora. Aidha, inatoa upelekaji kulingana na URL, kuhifadhi tovuti nyingi, ushirikiano wa kikao, na usalama wa safu ya maombi.

**AFD WAF ya Azure Front Door** imeundwa kwa lengo la **kulinda maombi ya wavuti kutokana na mashambulizi ya msingi wa wavuti** bila kuhariri msimbo wa nyuma. Inajumuisha sheria za desturi na seti za sheria zilizosimamiwa kulinda dhidi ya vitisho kama vile uingizaji wa SQL, udukuzi wa tovuti za msalaba, na mashambulizi mengine ya kawaida.

### **Mfano**

* Fikiria una maombi yanayosambazwa kimataifa na watumiaji kote ulimwenguni. Unaweza kutumia Mlango wa Mbele wa Azure ku **peleka maombi ya watumiaji kwenye kituo cha data cha kikanda kilicho karibu** kinachohifadhi maombi yako, hivyo kupunguza kuchelewa, kuboresha uzoefu wa mtumiaji na **kulinda dhidi ya mashambulizi ya wavuti kwa uwezo wa WAF**. Ikiwa eneo fulani linapata muda wa kupumzika, Mlango wa Mbele wa Azure unaweza kiotomatiki kuelekeza trafiki kwenye eneo bora la pili, ikihakikisha upatikanaji wa juu.

### Uorodheshaji

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Lango la Maombi la Azure na Lango la Maombi la Azure WAF

Lango la Maombi la Azure ni **msawazishaji wa mzigo wa trafiki ya wavuti** ambao hukuruhusu kusimamia trafiki kwenye maombi yako ya **wavuti**. Inatoa **usawazishaji wa mzigo wa Tabaka 7, kumaliza SSL, na uwezo wa ukuta wa maombi ya wavuti (WAF)** katika Kudhibiti Mzigo wa Maombi (ADC) kama huduma. Sifa muhimu ni pamoja na usambazaji wa msingi wa URL, ushirikiano wa kikao kulingana na vidakuzi, na kufuta safu salama ya soketi (SSL), ambayo ni muhimu kwa maombi yanayohitaji uwezo wa usawazishaji wa mzigo wa kina kama usambazaji wa ulimwengu na usambazaji kulingana na njia.

### Mfano

* Fikiria hali ambapo una wavuti ya biashara ambayo inajumuisha subdomains kadhaa kwa kazi tofauti, kama akaunti za watumiaji na usindikaji wa malipo. Lango la Maombi la Azure linaweza **kusambaza trafiki kwenye seva za wavuti sahihi kulingana na njia ya URL**. Kwa mfano, trafiki kwa `mfano.com/akaunti` inaweza kupelekwa kwa huduma za akaunti za watumiaji, na trafiki kwa `mfano.com/lipa` inaweza kupelekwa kwa huduma ya usindikaji wa malipo.\
Na **kulinda wavuti yako kutokana na mashambulizi kwa kutumia uwezo wa WAF.**

### **Uorodheshaji**
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** ni kipengele cha mtandao katika Azure ambacho **inaruhusu Virtual Networks (VNets) tofauti kuunganishwa moja kwa moja na kwa urahisi**. Kupitia VNet peering, rasilimali katika VNet moja inaweza kuwasiliana na rasilimali katika VNet nyingine kutumia anwani za IP za kibinafsi, **kana kwamba ziko kwenye mtandao mmoja**.\
**VNet Peering inaweza pia kutumika na mitandao ya ndani** kwa kuweka VPN ya tovuti hadi tovuti au Azure ExpressRoute.

**Azure Hub na Spoke** ni muundo wa mtandao unaotumiwa katika Azure kusimamia na kupanga trafiki ya mtandao. **"Hub" ni sehemu kuu inayodhibiti na kuelekeza trafiki kati ya "spokes" tofauti**. Hub kwa kawaida ina huduma zilizoshirikiwa kama vile vifaa vya mtandao vya kisasa (NVAs), Azure VPN Gateway, Azure Firewall, au Azure Bastion. **"Spokes" ni VNets ambazo hukuza kazi na kuunganisha kwenye hub kwa kutumia VNet peering**, kuwaruhusu kutumia huduma zilizoshirikiwa ndani ya hub. Mfano huu unakuza muundo safi wa mtandao, kupunguza utata kwa kusambaza huduma za kawaida ambazo kazi nyingi kwenye VNets tofauti zinaweza kutumia.

{% hint style="danger" %}
**Unganisho wa VNET hauwezi kuhamishwa katika Azure**, hii inamaanisha kwamba ikiwa spoke 1 imeunganishwa na spoke 2 na spoke 2 imeunganishwa na spoke 3 basi spoke 1 hawezi kuwasiliana moja kwa moja na spoke 3.
{% endhint %}

### Mifano

* Fikiria kampuni yenye idara tofauti kama vile Mauzo, Rasilimali Watu, na Maendeleo, **kila moja ikiwa na VNet yake (spokes)**. VNets hizi **zinahitaji kupata rasilimali zilizoshirikiwa** kama vile database kuu, firewall, na lango la mtandao, ambazo zote ziko katika **VNet nyingine (hub)**. Kwa kutumia mfano wa Hub na Spoke, kila idara inaweza **kuunganisha kwa usalama kwenye rasilimali zilizoshirikiwa kupitia VNet ya hub bila kuzifunua kwa intaneti ya umma** au kuunda muundo wa mtandao wenye mianya mingi. 

### Uorodheshaji

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Vpn ya Tovuti-kwa-Tovuti

VPN ya Tovuti-kwa-Tovuti katika Azure inakuwezesha **kuunganisha mtandao wako wa ndani kwenye Mtandao wa Virtual wa Azure (VNet)**, kuruhusu rasilimali kama VMs ndani ya Azure kuonekana kama ziko kwenye mtandao wako wa ndani. Uunganisho huu unafanywa kupitia **geti la VPN linalochipua trafiki** kati ya mitandao hiyo mbili.

### **Mfano**

* Biashara yenye ofisi yake kuu iliyoko New York ina kituo chake cha data cha ndani ambacho kinahitaji kuunganisha kwa usalama kwenye VNet yake katika Azure, ambayo inaendesha mzigo wake wa kazi uliofanyiwa upya kwa njia ya vitendaji. Kwa kuanzisha **VPN ya Tovuti-kwa-Tovuti, kampuni inaweza kuhakikisha uunganisho uliofichwa kati ya seva za ndani na VMs za Azure**, kuruhusu rasilimali kupatikana kwa usalama katika mazingira yote kana kwamba ziko kwenye mtandao wa ndani mmoja.

### **Uorodheshaji**
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute ni huduma inayotoa **unganisho la kasi kubwa, la kibinafsi na la kujitolea kati ya miundombinu yako ya ndani na vituo vya data vya Azure**. Uunganisho huu hufanywa kupitia mtoa huduma wa uunganisho, ukikwepa intaneti ya umma na kutoa uaminifu zaidi, kasi kubwa, latensi ndogo, na usalama mkubwa kuliko uunganisho wa kawaida wa intaneti.

### **Mfano**

* Kampuni ya kimataifa inahitaji **unganisho thabiti na la kuaminika kwa huduma zake za Azure kutokana na wingi wa data** na haja ya uhamisho wa data wa haraka. Kampuni hiyo inachagua Azure ExpressRoute kuunganisha moja kwa moja kituo chake cha data cha ndani na Azure, kurahisisha uhamisho wa data kwa kiwango kikubwa, kama vile nakala rudufu za kila siku na uchambuzi wa data halisi wakati halisi, huku ikiboresha faragha na kasi. 

### **Uorodheshaji**
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
