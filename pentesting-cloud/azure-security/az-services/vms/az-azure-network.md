# Az - Azure Ağı

<details>

<summary><strong>Sıfırdan kahraman olmak için AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**]'na(https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünleri**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi**]'ni(https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'ler**]'imiz(https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

## Temel Bilgiler

Azure'daki ağlar, çeşitli Azure hizmetleri ve kaynakları arasındaki **bağlantı ve iletişimi sağlayan** bulut bilişim platformunun ayrılmaz bir parçası olarak işlev görür. Azure'daki ağ mimarisi, yüksek ölçeklenebilirlik, güvenlik ve özelleştirilebilirlik sağlamak üzere tasarlanmıştır.

Temelde, Azure, kullanıcıların Azure bulutu içinde **izole edilmiş ağlar** oluşturmalarına izin veren bir **sanal ağ (VNet)** sağlar. Bu VNet'ler içinde sanal makineler, uygulamalar ve veritabanları gibi kaynaklar güvenli bir şekilde barındırılıp yönetilebilir. Azure'daki ağ, hem bulut içindeki iletişimi (Azure hizmetleri arasında) hem de harici ağlara ve internete bağlantıyı destekler.

**Güvenlik**, Azure ağının kritik bir yönüdür ve verileri korumak, erişimi yönetmek ve uyumluluğu sağlamak için çeşitli araçlar ve hizmetler mevcuttur. Bu güvenlik önlemleri arasında **güvenlik duvarları**, **ağ güvenlik grupları** ve **şifreleme** yetenekleri bulunur, bu da trafiği ve erişimi yüksek bir kontrol seviyesine olanak tanır.

Genel olarak, Azure'ın ağ yetenekleri, kullanıcıların belirli uygulama ve iş yükü ihtiyaçlarına uygun bir ağ ortamı oluşturmalarına olanak tanıyacak şekilde esneklik sunacak şekilde tasarlanmış olup güvenlik ve güvenilirlik üzerinde güçlü bir vurgu yapmaktadır.

## Sanal Ağ (VNET) ve Alt Ağlar

Azure'daki bir VNet, bulutta kendi ağınızın bir temsilidir. Bu, **aboneliğinize özel Azure bulutunda** bir **mantıksal izolasyon** sağlar. Bir VNet, Azure'da sanal özel ağlar (VPN'ler) oluşturmanıza ve yönetmenize olanak tanır ve Sanal Makineler (VM'ler), veritabanları ve uygulama hizmetleri gibi **çeşitli türdeki Azure kaynaklarını barındırmak ve yönetmek için kullanılabilir**.

VNets, **IP adresi** aralıkları, alt ağ oluşturma, yönlendirme tabloları ve ağ geçitleri dahil olmak üzere **ağ ayarlarınız üzerinde tam kontrol sağlar**.

Bir **alt ağ**, VNet'inizdeki bir **IP adresi aralığıdır**. Bir VNet'i güvenlik ve organizasyon için birden fazla alt ağa bölebilirsiniz. Bir VNet'teki her alt ağ, kaynakları ağ ve uygulama mimarinize göre izole etmek ve gruplamak için kullanılabilir.

Ayrıca, alt ağlar, kaynakların kullanabileceği IP adreslerini sağlayarak VNet'inizi bir veya daha fazla alt ağa **bölmeye** olanak tanır.

### **Örnek**

* Diyelim ki `MyVNet` adında bir VNet'iniz var ve IP adres aralığı `10.0.0.0/16`. Bu VNet içinde, diyelim ki web sunucularını barındırmak için `Subnet-1` adında bir alt ağ oluşturabilirsiniz, IP adres aralığı `10.0.0.0/24`. Veritabanı sunucularınız için kullanılabilecek `Subnet-2` adında başka bir alt ağ, IP adres aralığı `10.0.1.0/24` olabilir. Bu segmentasyon, ağ içinde verimli yönetim ve güvenlik kontrollerine olanak tanır.

### Numaralandırma

Bir Azure hesabındaki tüm VNets ve alt ağları listelemek için Azure Komut Satırı Arayüzü (CLI) kullanabilirsiniz. İşte adımlar:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Ağ Güvenlik Grupları (NSG)

Azure'da **Ağ Güvenlik Grubu (NSG)**, bir Azure Sanal Ağı (VNet) içindeki Azure kaynaklarına gelen ve giden ağ trafiğini filtreleme temel işlevini yerine getirir. Ağ trafiğinin akışını titizlikle belirleyen bir dizi **güvenlik kuralını** içerir.

NSG'nin temel yönleri şunlardır:

* **Trafik Kontrolü**: Her NSG, çeşitli Azure kaynaklarıyla ilişkili gelen ve giden ağ trafiğini izin verme veya engelleme konusunda önemli olan kuralları içerir.
* **Kural Bileşenleri**: Bir NSG içindeki kurallar son derece belirleyicidir ve kaynak/hedef IP adresi, bağlantı noktası ve protokol gibi kriterlere göre trafiği filtreler. Bu belirleyicilik, ağ trafiğinin ayrıntılı yönetimine olanak tanır.
* **Güvenlik Artırımı**: Yalnızca yetkili trafiğin Azure kaynaklarınıza giriş yapmasına veya çıkış yapmasına izin vererek, NSG'ler ağ altyapınızın güvenlik durumunu güçlendirmede önemli bir rol oynar.

### **Örnek**

* Bir VNet içindeki bir alt ağa veya belirli bir sanal makineye uygulanan `MyNSG` adında bir NSG'niz olduğunu hayal edin. Şu tür kurallar oluşturabilirsiniz:
* Herhangi bir kaynaktan web sunucularınıza (port 80) gelen HTTP trafiğine izin veren bir gelen kural.
* Belirli bir hedef IP adresi aralığına yalnızca SQL trafiğine (port 1433) izin veren bir giden kural.

### Numaralandırma

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Güvenlik Duvarı

Azure Güvenlik Duvarı, Azure Sanal Ağ kaynaklarını koruyan yönetilen, bulut tabanlı bir **ağ güvenliği hizmetidir**. Dahili yüksek kullanılabilirlik ve ölçeklenebilirlik özelliklerine sahip tam stateful bir güvenlik duvarı hizmetidir.

Azure Güvenlik Duvarı, **NSG'lerden daha gelişmiş** özellikler sunar, bunlar arasında **uygulama düzeyinde filtreleme**, ağ düzeyinde filtreleme, tehdit istihbaratına dayalı filtreleme ve günlükleme ve analiz için Azure Monitor ile entegrasyon bulunur.\
Dışa doğru, içeriye doğru, konuşan-arasında, VPN ve ExpressRoute trafiğini filtreleyebilir. **Güvenlik duvarı kuralları FQDN (Tam Tanımlı Alan Adı), IP adresleri ve portlara dayalı olarak oluşturulabilir**.

### Azure Güvenlik Duvarı ve NSG'ler Arasındaki Farklar

1. **Kapsam:**
* **NSG:** Alt ağ veya ağ arayüzü seviyesinde çalışır. Ağ arayüzlerinden (NIC), sanal makinelerden veya alt ağlardan gelen giden ve giden trafiği temel filtreleme amacıyla sağlar.
* **Azure Güvenlik Duvarı:** VNet seviyesinde çalışır, daha geniş bir koruma kapsamı sağlar. Sanal ağ kaynaklarınızı güvence altına almak ve VNet'e giren ve çıkan trafiği yönetmek için tasarlanmıştır.
2. **Yetenekler:**
* **NSG:** IP adresine, porta ve protokole dayalı temel filtreleme yetenekleri sağlar. Uygulama düzeyinde inceleme veya tehdit istihbaratı gibi gelişmiş özellikleri desteklemez.
* **Azure Güvenlik Duvarı:** Uygulama düzeyinde (Katman 7) trafiği filtreleme, tehdit istihbaratına dayalı filtreleme, ağ trafiği filtreleme ve daha fazlası gibi gelişmiş özellikler sunar. Ayrıca birden fazla genel IP adresini destekler.
3. **Kullanım Senaryoları:**
* **NSG:** Temel ağ düzeyinde trafiği filtrelemek için idealdir.
* **Azure Güvenlik Duvarı:** Uygulama düzeyinde kontrol, günlükleme ve tehdit istihbaratının gerektiği daha karmaşık filtreleme senaryoları için uygundur.
4. **Yönetim ve İzleme:**
* **NSG:** Temel günlükleme ve Azure Monitor ile entegrasyon sunar.
* **Azure Güvenlik Duvarı:** Trafik doğasını ve desenini anlamak için gerekli olan gelişmiş günlükleme ve analiz yetenekleri sağlar. Bu, Azure Monitor aracılığıyla gerçekleştirilir.

### Numaralandırma

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Ağ Sanal Cihazı (NVA)

Bir Ağ Sanal Cihazı (**NVA**) Azure'da bir sanal ağ içinde **ağ işlevlerini gerçekleştiren sanal bir cihazdır**. NVAlar genellikle Azure'da **doğal olarak mevcut olmayan ağ işlevleri** için veya daha fazla özelleştirme gerektiğinde kullanılır. Temelde **ağ uygulamalarını veya hizmetlerini çalıştıran VM'lerdir**, örneğin güvenlik duvarları, WAN optimize ediciler veya yük dengeleyiciler gibi.

NVAlar karmaşık yönlendirme, **güvenlik** ve **ağ trafiği yönetimi** görevleri için kullanılır. Azure **Marketplace** üzerinden dağıtılabilirler, burada birçok üçüncü taraf satıcı, Azure ortamlarına entegre edilmeye hazır cihazlarını sunar.

### **Örnek**

* Bir kuruluş, özelleştirilmiş bir güvenlik duvarı çözümü oluşturmak için Azure'da bir NVA dağıtabilir. Bu NVA, gelişmiş özellikler sunan bir **üçüncü taraf güvenlik duvarı yazılımını** çalıştırabilir, örneğin sızma tespiti, paket incelemesi veya VPN bağlantısı. NVA, üzerinden geçen trafiği incelemek ve filtrelemek üzere yapılandırılabilir, böylece kuruluşun politikalarına uygun olarak gelişmiş güvenlik önlemlerinin uygulandığından emin olunabilir.

### **Numaralandırma**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
## Azure Yönlendirme Tabloları ve Kullanıcı Tanımlı Yönlendirmeler (UDR)

**Azure Yönlendirme Tabloları**, Microsoft Azure içinde **Azure Sanal Ağları (VNets)** içinde **ağ trafiği yönlendirmesinin kontrolünü** sağlayan bir özelliktir. Temelde, bunlar VNets içinde alt ağlar arasında, VNets arasında veya harici ağlara nasıl **iletilmesi gerektiğini tanımlar**. Her yönlendirme tablosu, hedef IP adreslerine göre paketlerin nasıl yönlendirileceğini belirten kurallar kümesi olan yönlendirmeler içerir.

**Azure'daki Kullanıcı Tanımlı Yönlendirmeler (UDR)**, Azure Yönlendirme Tabloları içinde **oluşturduğunuz özel yönlendirmelerdir** ve Azure Sanal Ağları (VNets) arasında ve içindeki ağ trafiğinin akışını kontrol etmek ve harici bağlantılara yönlendirmek için kullanılır. UDR'ler, ağ trafiğini belirli gereksinimlerinize göre yönlendirmenize olanak tanır ve Azure'ın varsayılan yönlendirme kararlarını geçersiz kılabilir.

Bu yönlendirmeler, ağ trafiğini **sanal bir cihaz üzerinden yönlendirmeniz gereken senaryolarda**, güvenlik veya politika uyumluluğu için belirli bir yol zorunlu olduğunda veya yerindeki ağlarla entegre olmanız gerektiğinde özellikle yararlıdır.

### **Örnek**

* Diyelim ki bir Ağ Sanal Cihazı (NVA) dağıtmışsınız ve bir VNet içindeki alt ağlar arasındaki trafiği incelemek için kullanıyorsunuz. Bir UDR oluşturabilir ve bu UDR ile bir alt ağdan diğerine giden tüm trafiğin NVA üzerinden gitmesini sağlayabilirsiniz. Bu UDR, trafiğin hedefine ulaşmadan önce NVA'nın güvenlik amaçları için trafiği incelemesini sağlar.

### **Numaralandırma**
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
## Azure Özel Bağlantı

Azure Özel Bağlantı, Azure'da **Azure hizmetlerine özel erişimi sağlayan bir hizmettir** ve **Azure sanal ağınız (VNet) ile hizmet arasındaki trafiğin tamamen Microsoft'un Azure omurga ağı içinde seyahat etmesini sağlayarak** hizmeti etkili bir şekilde VNet'inize getirir. Bu kurulum, verilerin genel internete açık olmamasıyla güvenliği artırır.

Özel Bağlantı, Azure Depolama, Azure SQL Veritabanı ve Özel Bağlantı aracılığıyla paylaşılan özel hizmetler gibi çeşitli Azure hizmetleri ile kullanılabilir. Kendi VNet'inizden veya farklı Azure aboneliklerinden hizmetleri tüketmek için güvenli bir yol sağlar.

{% hint style="danger" %}
Özel uç noktalara NSG'ler uygulanmaz, bu açıkça, Özel Bağlantı içeren bir alt ağa NSG'nin ilişkilendirilmesinin herhangi bir etkisinin olmayacağı anlamına gelir.
{% endhint %}

### **Örnek**

* **Azure SQL Veritabanına güvenli bir şekilde VNet'inizden erişmek istediğiniz bir senaryoyu düşünün**. Normalde, bu genel internet üzerinden geçişi içerebilir. Özel Bağlantı ile, Azure SQL Veritabanı hizmetine doğrudan bağlanan bir **özel uç nokta oluşturabilirsiniz**. Bu uç nokta, veritabanını kendi VNet'inizin bir parçası gibi gösterir, özel bir IP adresi aracılığıyla erişilebilir hale getirir ve böylece güvenli ve özel erişimi sağlar.

### **Numaralandırma**
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Hizmet Noktaları

Azure Hizmet Noktaları, sanal ağ özel adres alanınızı ve VNet'in kimliğini doğrudan bir bağlantı üzerinden Azure hizmetlerine genişletir. Hizmet noktalarını etkinleştirerek, **VNet'teki kaynaklar**, Azure Depolama ve Azure SQL Veritabanı gibi Azure hizmetlerine Azure'nin ana ağı üzerinden güvenli bir şekilde bağlanabilir. Bu, **VNet'ten Azure hizmetine olan trafiğin Azure ağı içinde kalmasını sağlayarak**, daha güvenli ve güvenilir bir yol sağlar.

### **Örnek**

* Örneğin, bir **Azure Depolama** hesabı varsayılan olarak genel internet üzerinden erişilebilirdir. **VNet'iniz içinde Azure Depolama için bir hizmet noktasını etkinleştirerek**, yalnızca VNet'inizden gelen trafiğin depolama hesabına erişebileceğinden emin olabilirsiniz. Depolama hesabı güvenlik duvarı daha sonra yalnızca VNet'inizden gelen trafiği kabul etmek üzere yapılandırılabilir.

### **Numaralandırma**
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Hizmet Noktaları ve Özel Bağlantılar Arasındaki Farklar

Microsoft, [**belgelerde**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints) Özel Bağlantıları kullanmayı önerir:\\

<figure><img src="../../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Hizmet Noktaları:**

* VNet'ten Azure hizmetine trafik, genel interneti atlayarak Microsoft Azure omurga ağı üzerinden geçer.
* Nokta, Azure hizmetine doğrudan bir bağlantıdır ve VNet içinde hizmet için özel bir IP sağlamaz.
* Hizmet kendisi, VNet dışından genel uç noktası üzerinden hala erişilebilir, hizmet duvarınızı böyle bir trafiği engellemek için yapılandırmadıkça.
* Alt ağ ile Azure hizmeti arasında birbirine karşılık gelen bir ilişki vardır.
* Özel Bağlantılardan daha ucuzdur.

**Özel Bağlantılar:**

* Özel Bağlantı, Azure hizmetlerini VNet'inize özel bir IP adresine sahip bir ağ arayüzü olan özel bir uç nokta aracılığıyla eşler.
* Azure hizmetine bu özel IP adresi kullanılarak erişilir, böylece hizmetin ağınızın bir parçası gibi görünmesi sağlanır.
* Özel Bağlantı aracılığıyla bağlanan hizmetlere yalnızca VNet'inizden veya bağlı ağlardan erişilebilir; hizmete genel internet erişimi yoktur.
* Azure hizmetlerine veya Azure'da barındırılan kendi hizmetlerinize güvenli bir bağlantı sağlar, ayrıca diğerlerinin paylaştığı hizmetlere bağlantı sağlar.
* Özel bir VNet'teki özel bir uç nokta aracılığıyla daha geniş bir alt ağ düzeyindeki hizmet noktası ile karşılaştırıldığında daha ayrıntılı erişim kontrolü sağlar.

Özetle, Hizmet Noktaları ve Özel Bağlantılar her ikisi de Azure hizmetlerine güvenli bağlantı sağlasa da, **Özel Bağlantılar hizmetlere genel internete maruz kalmadan özel bir şekilde erişilmesini sağlayarak daha yüksek bir izolasyon ve güvenlik düzeyi sunar**. Öte yandan, Hizmet Noktaları, VNet'te özel bir IP'ye ihtiyaç duyulmadan basit, güvenli erişim gerektiren genel durumlar için daha kolay kuruludur.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door**, küresel web uygulamalarınızın **hızlı teslimatı** için ölçeklenebilir ve güvenli bir giriş noktasıdır. **Küresel yük dengeleme, site hızlandırma, SSL deşifreleme ve Web Uygulama Güvenlik Duvarı (WAF)** gibi çeşitli hizmetleri tek bir hizmette birleştirir. Azure Front Door, kullanıcıya en yakın kenar konumuna dayalı akıllı yönlendirme sağlayarak optimal performans ve güvenilirlik sağlar. Ayrıca URL tabanlı yönlendirme, çoklu site barındırma, oturum bağlılığı ve uygulama katmanı güvenliği sunar.

**Azure Front Door WAF**, arka uç kodunu değiştirmeden web uygulamalarını **web tabanlı saldırılardan korumak** için tasarlanmıştır. SQL enjeksiyonu, çapraz site komut dosyası ve diğer yaygın saldırılara karşı koruma sağlamak için özel kurallar ve yönetilen kural setleri içerir.

### **Örnek**

* Dünya çapında dağıtılmış bir uygulamanızın düşünün ve dünya genelinde kullanıcıları olan bir uygulamanız var. Azure Front Door'u kullanarak kullanıcı isteklerini uygulamanızı barındıran en yakın bölgesel veri merkezine yönlendirebilir, böylece gecikmeyi azaltabilir, kullanıcı deneyimini iyileştirebilir ve **WAF yetenekleri ile web saldırılarına karşı savunabilirsiniz**. Belirli bir bölge kesinti yaşarsa, Azure Front Door otomatik olarak trafiği en iyi konuma yönlendirerek yüksek erişilebilirlik sağlar.

### Numaralandırma

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
## Azure Uygulama Ağ Geçidi ve Azure Uygulama Ağ Geçidi WAF

Azure Uygulama Ağ Geçidi, **web** uygulamalarınıza yönlendirme yapmanızı sağlayan bir **web trafiği yük dengeleyicisidir**. Uygulama Teslim Denetleyicisi (ADC) içinde **Katman 7 yük dengeleme, SSL sonlandırma ve web uygulama duvarı (WAF) yetenekleri** sunar. Ana özellikler arasında URL tabanlı yönlendirme, çerez tabanlı oturum bağlılığı ve güvenli soket katmanı (SSL) boşaltma bulunur; bu özellikler, küresel yönlendirme ve yol tabanlı yönlendirme gibi karmaşık yük dengeleme yeteneklerine ihtiyaç duyan uygulamalar için önemlidir.

### Örnek

* Farklı işlevler için birden fazla alt alan adı içeren bir e-ticaret web sitesine sahip olduğunuzu düşünün, örneğin kullanıcı hesapları ve ödeme işlemleri. Azure Uygulama Ağ Geçidi, trafiği **URL yoluna göre uygun web sunucularına yönlendirebilir**. Örneğin, `example.com/accounts` adresine yönlendirilen trafiği kullanıcı hesapları servisine yönlendirebilir ve `example.com/pay` adresine yönlendirilen trafiği ödeme işlemleri servisine yönlendirebilir.\
Ve **WAF yeteneklerini kullanarak web sitenizi saldırılardan koruyabilirsiniz.**

### **Numaralandırma**
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
## Azure Hub, Spoke ve VNet Eşlemesi

**VNet Eşlemesi**, Azure'da bir ağ özelliğidir ve **farklı Sanal Ağların (VNet'lerin) doğrudan ve sorunsuz bir şekilde bağlanmasına izin verir**. VNet eşlemesi sayesinde, bir VNet'teki kaynaklar, diğer bir VNet'teki kaynaklarla özel IP adresleri kullanarak iletişim kurabilir, **sanki aynı ağda gibi**.\
**VNet Eşlemesi ayrıca yerinde ağlarla da kullanılabilir**, site-to-site VPN veya Azure ExpressRoute kurarak.

**Azure Hub ve Spoke**, ağ trafiğini yönetmek ve düzenlemek için Azure'da kullanılan bir ağ topolojisidir. **"Hub" farklı "spoke'lar" arasında trafiği kontrol eden ve yönlendiren merkezi bir noktadır**. Hub genellikle ağ sanal cihazlarını (NVA'lar), Azure VPN Ağ Geçidi, Azure Güvenlik Duvarı veya Azure Bastion gibi paylaşılan hizmetleri içerir. **"Spoke'lar" ise iş yüklerini barındıran ve VNet eşlemesi kullanarak hub'a bağlanan VNets'tir**, böylece farklı VNets'teki birden fazla iş yükü tarafından kullanılabilen paylaşılan hizmetlerden faydalanabilirler. Bu model, birden fazla VNet'teki iş yüklerinin kullanabileceği ortak hizmetleri merkezileştirerek karmaşıklığı azaltarak temiz bir ağ düzeni teşvik eder.

{% hint style="danger" %}
**Azure'da VNET eşleme geçişli değildir**, yani eğer spoke 1 spoke 2'ye bağlıysa ve spoke 2 spoke 3'e bağlıysa, spoke 1 doğrudan spoke 3 ile iletişim kuramaz.
{% endhint %}

### Örnekler

* Satış, İK ve Geliştirme gibi ayrı departmanlara sahip bir şirketi hayal edin, **her biri kendi VNet'ine (spoke'larına) sahip**. Bu VNets'ler, merkezi bir veritabanına, bir güvenlik duvarına ve bir internet ağına erişim gerektirir, hepsi **başka bir VNet'te (hub'ta) bulunur**. Hub ve Spoke modelini kullanarak, her departman, **hub VNet üzerinden paylaşılan kaynaklara güvenli bir şekilde bağlanabilir ve bu kaynakları genel internete açmadan veya çok sayıda bağlantıya sahip karmaşık bir ağ yapısı oluşturmadan kullanabilir**.

### Numaralandırma
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Azure'daki Site-to-Site VPN, **yerindeki ağınızı Azure Sanal Ağı'na (VNet) bağlamanıza olanak tanır**, böylece Azure'daki VM'ler gibi kaynaklar yerel ağınızda gibi görünür. Bu bağlantı, iki ağ arasındaki trafiği şifreleyen bir **VPN ağ geçidi aracılığıyla kurulur**.

### **Örnek**

* New York'ta ana ofisi bulunan bir işletmenin, sanallaştırılmış iş yüklerine ev sahipliği yapan Azure'daki VNet'ine güvenli bir şekilde bağlanması gereken yerinde bir veri merkezi vardır. **Site-to-Site VPN kurarak, şirket yerindeki sunucular ile Azure VM'leri arasında şifreli bağlantı sağlayabilir**, böylece kaynaklara her iki ortamda da güvenli bir şekilde erişilebilir, sanki aynı yerel ağda gibi. 

### **Numaralandırma**
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
## Azure ExpressRoute

Azure ExpressRoute, on-premises altyapınız ile Azure veri merkezleri arasında **özel, adanmış, yüksek hızlı bir bağlantı sağlayan bir hizmettir**. Bu bağlantı, genel interneti atlayarak bir bağlantı sağlayıcı aracılığıyla gerçekleştirilir ve tipik internet bağlantılarından daha fazla güvenilirlik, daha hızlı hızlar, daha düşük gecikmeler ve daha yüksek güvenlik sunar.

### **Örnek**

* Bir çok uluslu şirket, yüksek veri hacmi ve yüksek veri aktarım hızı gereksinimleri nedeniyle Azure hizmetlerine **sürekli ve güvenilir bir bağlantıya ihtiyaç duyar**. Şirket, günlük yedeklemeler ve gerçek zamanlı veri analitiği gibi büyük ölçekli veri transferlerini, artırılmış gizlilik ve hız ile kolaylaştırmak için on-premises veri merkezini Azure'a doğrudan bağlamak için Azure ExpressRoute'u tercih eder.

### **Numaralandırma**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>Sıfırdan kahraman olmaya kadar AWS hacklemeyi öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
