# Az - Red de Azure

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**swag oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informaci칩n B치sica

Las redes dentro de Azure funcionan como una parte integral de su plataforma de computaci칩n en la nube, permitiendo la **conexi칩n y comunicaci칩n entre varios servicios y recursos de Azure**. La arquitectura de red en Azure est치 dise침ada para ser altamente escalable, segura y personalizable.

En su n칰cleo, Azure proporciona una **red virtual (VNet)** que permite a los usuarios crear **redes aisladas** dentro de la nube de Azure. Dentro de estas VNets, los recursos como m치quinas virtuales, aplicaciones y bases de datos pueden ser alojados y gestionados de forma segura. La red en Azure admite tanto la comunicaci칩n dentro de la nube (entre servicios de Azure) como la conexi칩n a redes externas e internet.

La **seguridad** es un aspecto cr칤tico de la red de Azure, con diversas herramientas y servicios disponibles para proteger datos, gestionar el acceso y garantizar el cumplimiento. Estas medidas de seguridad incluyen **firewalls**, **grupos de seguridad de red** y capacidades de **encriptaci칩n**, lo que permite un alto nivel de control sobre el tr치fico y el acceso.

En general, las capacidades de red de Azure est치n dise침adas para ofrecer flexibilidad, permitiendo a los usuarios crear un entorno de red que se adapte a las necesidades espec칤ficas de sus aplicaciones y cargas de trabajo, manteniendo un fuerte 칠nfasis en la seguridad y la fiabilidad.

## Red Virtual (VNET) y Subredes

Una VNet en Azure es esencialmente una representaci칩n de tu propia red en la nube. Es un **aislamiento l칩gico de la nube de Azure dedicado a tu suscripci칩n**. Una VNet te permite aprovisionar y gestionar redes privadas virtuales (VPNs) en Azure y se puede utilizar para alojar y **gestionar m칰ltiples tipos de recursos de Azure**, como M치quinas Virtuales (VMs), bases de datos y servicios de aplicaciones.

Las VNets te proporcionan **control total sobre la configuraci칩n de tu red**, incluyendo rangos de direcciones IP, creaci칩n de subredes, tablas de enrutamiento y pasarelas de red.

Una **subred** es un **rango de direcciones IP en tu VNet**. Puedes dividir una VNet en m칰ltiples subredes para organizaci칩n y seguridad. Cada subred en una VNet se puede utilizar para aislar y agrupar recursos seg칰n la arquitectura de tu red y aplicaci칩n.

Adem치s, las subredes te permiten **segmentar tu VNet en una o m치s subredes**, proporcionando un rango de direcciones IP que los recursos pueden utilizar.

### **Ejemplo**

* Supongamos que tienes una VNet llamada `MiVNet` con un rango de direcciones IP de `10.0.0.0/16`. Puedes crear una subred dentro de esta VNet, digamos `Subred-1`, con un rango de direcciones IP de `10.0.0.0/24` para alojar tus servidores web. Otra subred, `Subred-2` con un rango de `10.0.1.0/24`, podr칤a ser utilizada para tus servidores de base de datos. Esta segmentaci칩n permite una gesti칩n eficiente y controles de seguridad dentro de la red.

### Enumeraci칩n

Para listar todas las VNets y subredes en una cuenta de Azure, puedes utilizar la Interfaz de L칤nea de Comandos (CLI) de Azure. Aqu칤 est치n los pasos:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Grupos de seguridad de red (NSG)

En Azure, un **Grupo de seguridad de red (NSG)** sirve principalmente para filtrar el tr치fico de red tanto hacia como desde los recursos de Azure dentro de una Red Virtual de Azure (VNet). Contiene un conjunto de **reglas de seguridad** que dictan meticulosamente el flujo de tr치fico de red.

Aspectos clave de NSG incluyen:

- **Control de tr치fico**: Cada NSG contiene reglas que son fundamentales para permitir u obstruir el tr치fico de red entrante y saliente asociado con varios recursos de Azure.
- **Componentes de reglas**: Las reglas dentro de un NSG son altamente espec칤ficas, filtrando el tr치fico en funci칩n de criterios como la direcci칩n IP de origen/destino, puerto y protocolo. Esta especificidad permite una gesti칩n detallada del tr치fico de red.
- **Mejora de la seguridad**: Al garantizar que solo el tr치fico autorizado pueda entrar o salir de sus recursos de Azure, los NSG desempe침an un papel crucial en fortalecer la postura de seguridad de su infraestructura de red.

### **Ejemplo**

- Imagina que tienes un NSG llamado `MiNSG` aplicado a una subred o a una m치quina virtual espec칤fica dentro de tu VNet. Puedes crear reglas como:
- Una regla de entrada que permita el tr치fico HTTP (puerto 80) desde cualquier origen a tus servidores web.
- Una regla de salida que permita solo el tr치fico SQL (puerto 1433) a un rango de direcciones IP de destino espec칤fico.

### Enumeraci칩n

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Firewall de Azure

Azure Firewall es un servicio de seguridad de red administrado basado en la nube que protege los recursos de su Red Virtual de Azure. Es un firewall completamente estatal como servicio con funciones integradas de alta disponibilidad y escalabilidad.

Azure Firewall proporciona caracter칤sticas m치s avanzadas que los NSGs, incluyendo filtrado a nivel de aplicaci칩n, filtrado a nivel de red, filtrado basado en inteligencia de amenazas e integraci칩n con Azure Monitor para registro y an치lisis. Puede filtrar el tr치fico de salida, entrada, de spoke a spoke, VPN y ExpressRoute. Las reglas del firewall pueden crearse en base a FQDN (Nombre de dominio completamente calificado), direcciones IP y puertos.

### Diferencias entre Azure Firewall y NSGs

1. **Alcance:**
* **NSG:** Funciona a nivel de subred o interfaz de red. Est치 destinado a proporcionar un filtrado b치sico del tr치fico de entrada y salida de las interfaces de red (NIC), VM o subredes.
* **Azure Firewall:** Opera a nivel de VNet, proporcionando un alcance de protecci칩n m치s amplio. Est치 dise침ado para asegurar sus recursos de red virtual y gestionar el tr치fico que entra y sale de la VNet.
2. **Capacidades:**
* **NSG:** Ofrece capacidades b치sicas de filtrado basadas en direcci칩n IP, puerto y protocolo. No admite funciones avanzadas como inspecci칩n a nivel de aplicaci칩n o inteligencia de amenazas.
* **Azure Firewall:** Ofrece caracter칤sticas avanzadas como filtrado de tr치fico a nivel de aplicaci칩n (Capa 7), filtrado basado en inteligencia de amenazas, filtrado de tr치fico de red y m치s. Tambi칠n admite m칰ltiples direcciones IP p칰blicas.
3. **Casos de uso:**
* **NSG:** Ideal para el filtrado b치sico de tr치fico a nivel de red.
* **Azure Firewall:** Adecuado para escenarios de filtrado m치s complejos donde se necesite control a nivel de aplicaci칩n, registro e inteligencia de amenazas.
4. **Gesti칩n y Monitoreo:**
* **NSG:** Ofrece registro b치sico e integraci칩n con Azure Monitor.
* **Azure Firewall:** Proporciona capacidades avanzadas de registro y an치lisis a trav칠s de Azure Monitor, lo cual es esencial para comprender la naturaleza y el patr칩n del tr치fico.

### Enumeraci칩n

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
## Dispositivo Virtual de Red (NVA)

Un Dispositivo Virtual de Red (**NVA**) en Azure es un dispositivo virtual que **realiza funciones de red dentro de una red virtual**. Los NVA se utilizan t칤picamente para funciones de red que **no est치n disponibles nativamente** en Azure o cuando se requiere m치s personalizaci칩n. B치sicamente son **VMs que ejecutan aplicaciones o servicios de red**, como firewalls, optimizadores WAN o balanceadores de carga.

Los NVA se utilizan para tareas de enrutamiento complejas, **seguridad** y **gesti칩n del tr치fico de red**. Se pueden implementar desde el **Marketplace** de Azure, donde muchos proveedores de terceros ofrecen sus dispositivos listos para integrarse en entornos de Azure.

### **Ejemplo**

* Una organizaci칩n puede implementar un NVA en Azure para crear una **soluci칩n de firewall personalizado**. Este NVA podr칤a ejecutar un **software de firewall de terceros**, proporcionando funciones avanzadas como detecci칩n de intrusiones, inspecci칩n de paquetes o conectividad VPN. El NVA se puede configurar para inspeccionar y filtrar el tr치fico que pasa a trav칠s de 칠l, asegurando que se apliquen medidas de seguridad mejoradas seg칰n las pol칤ticas de la organizaci칩n.

### **Enumeraci칩n**
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
## Tablas de Rutas de Azure y Rutas Definidas por el Usuario (UDR)

Las **Tablas de Rutas de Azure** son una caracter칤stica dentro de Microsoft Azure que permite el **control del enrutamiento del tr치fico de red dentro de las Redes Virtuales de Azure (VNets)**. B치sicamente, definen c칩mo se **reenv칤an los paquetes** entre subredes dentro de las VNets, entre VNets o hacia redes externas. Cada tabla de rutas contiene un conjunto de reglas, conocidas como rutas, que especifican c칩mo deben enrutarse los paquetes en funci칩n de sus direcciones IP de destino.

Las **Rutas Definidas por el Usuario (UDR)** en Azure son **rutas personalizadas que creas dentro de las Tablas de Rutas de Azure** para controlar el **flujo del tr치fico de red** dentro y entre las Redes Virtuales de Azure (VNets) y hacia conexiones externas. Las UDR te brindan la flexibilidad para dirigir el tr치fico de red seg칰n tus requisitos espec칤ficos, anulando las decisiones de enrutamiento predeterminadas de Azure.

Estas rutas son particularmente 칰tiles para escenarios en los que necesitas **enrutar el tr치fico a trav칠s de un dispositivo virtual**, hacer cumplir un camino espec칤fico por motivos de seguridad o cumplimiento de pol칤ticas, o integrarte con redes locales.

### **Ejemplo**

* Supongamos que has implementado un Aparato Virtual de Red (NVA) para inspeccionar el tr치fico entre subredes dentro de una VNet. Puedes crear una UDR que dirija todo el tr치fico de una subred a otra subred para que pase a trav칠s del NVA. Esta UDR garantiza que el NVA inspeccione el tr치fico con fines de seguridad antes de llegar a su destino.

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link es un servicio en Azure que **permite el acceso privado a los servicios de Azure** al garantizar que **el tr치fico entre su red virtual de Azure (VNet) y el servicio viaje completamente dentro de la red principal de Azure de Microsoft**. B치sicamente, trae el servicio a su VNet. Esta configuraci칩n mejora la seguridad al no exponer los datos a internet p칰blico.

Private Link se puede utilizar con varios servicios de Azure, como Azure Storage, Azure SQL Database y servicios personalizados compartidos a trav칠s de Private Link. Proporciona una forma segura de consumir servicios desde su propia VNet o incluso desde diferentes suscripciones de Azure.

{% hint style="danger" %}
Las NSG no se aplican a los puntos de conexi칩n privados, lo que significa claramente que asociar una NSG con una subred que contiene el Private Link no tendr치 efecto alguno.
{% endhint %}

### **Ejemplo**

* Considere un escenario en el que tiene una **base de datos Azure SQL a la que desea acceder de forma segura desde su VNet**. Normalmente, esto implicar칤a atravesar internet p칰blico. Con Private Link, puede crear un **punto de conexi칩n privado en su VNet** que se conecta directamente al servicio de base de datos Azure SQL. Este punto de conexi칩n hace que la base de datos parezca parte de su propia VNet, accesible a trav칠s de una direcci칩n IP privada, garantizando as칤 un acceso seguro y privado.

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Puntos de conexi칩n de servicio de Azure

Los Puntos de conexi칩n de servicio de Azure extienden el espacio de direcciones privadas de su red virtual y la identidad de su VNet a los servicios de Azure a trav칠s de una conexi칩n directa. Al habilitar los puntos de conexi칩n de servicio, **los recursos en su VNet pueden conectarse de forma segura a los servicios de Azure**, como Azure Storage y Azure SQL Database, utilizando la red central de Azure. Esto asegura que el **tr치fico desde la VNet hacia el servicio de Azure permanezca dentro de la red de Azure**, proporcionando un camino m치s seguro y confiable.

### **Ejemplo**

* Por ejemplo, una cuenta de **Azure Storage** es accesible por defecto a trav칠s de internet p칰blico. Al habilitar un **punto de conexi칩n de servicio para Azure Storage dentro de su VNet**, puede asegurar que solo el tr치fico desde su VNet pueda acceder a la cuenta de almacenamiento. El firewall de la cuenta de almacenamiento luego puede configurarse para aceptar tr치fico solo desde su VNet.

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
### Diferencias entre los puntos de servicio y los enlaces privados

Microsoft recomienda el uso de Enlaces Privados en la [**documentaci칩n**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Puntos de Servicio:**

* El tr치fico desde su VNet hacia el servicio de Azure viaja a trav칠s de la red troncal de Microsoft Azure, evitando el internet p칰blico.
* El punto final es una conexi칩n directa al servicio de Azure y no proporciona una IP privada para el servicio dentro de la VNet.
* El servicio en s칤 sigue siendo accesible a trav칠s de su punto final p칰blico desde fuera de su VNet a menos que configure el firewall del servicio para bloquear dicho tr치fico.
* Es una relaci칩n uno a uno entre la subred y el servicio de Azure.
* Menos costoso que los Enlaces Privados.

**Enlaces Privados:**

* Private Link mapea los servicios de Azure en su VNet a trav칠s de un punto final privado, que es una interfaz de red con una direcci칩n IP privada dentro de su VNet.
* El servicio de Azure se accede utilizando esta direcci칩n IP privada, haci칠ndolo parecer parte de su red.
* Los servicios conectados a trav칠s de Private Link solo pueden ser accedidos desde su VNet o redes conectadas; no hay acceso a internet p칰blico al servicio.
* Permite una conexi칩n segura a los servicios de Azure o sus propios servicios alojados en Azure, as칤 como una conexi칩n a servicios compartidos por otros.
* Proporciona un control de acceso m치s granular a trav칠s de un punto final privado en su VNet, en lugar de un control de acceso m치s amplio a nivel de subred con puntos de servicio.

En resumen, mientras que tanto los Puntos de Servicio como los Enlaces Privados proporcionan conectividad segura a los servicios de Azure, **los Enlaces Privados ofrecen un mayor nivel de aislamiento y seguridad al garantizar que los servicios se accedan de forma privada sin exponerlos al internet p칰blico**. Los Puntos de Servicio, por otro lado, son m치s f치ciles de configurar para casos generales donde se requiere un acceso simple y seguro a los servicios de Azure sin necesidad de una IP privada en la VNet.

## Azure Front Door (AFD) y AFD WAF

**Azure Front Door** es un punto de entrada escalable y seguro para la **entrega r치pida** de sus aplicaciones web globales. **Combina** varios servicios como **balanceo de carga global, aceleraci칩n de sitios, descarga de SSL y capacidades de Firewall de Aplicaciones Web (WAF)** en un solo servicio. Azure Front Door proporciona enrutamiento inteligente basado en la **ubicaci칩n del borde m치s cercana al usuario**, garantizando un rendimiento y confiabilidad 칩ptimos. Adem치s, ofrece enrutamiento basado en URL, hosting de m칰ltiples sitios, afinidad de sesi칩n y seguridad a nivel de aplicaci칩n.

**Azure Front Door WAF** est치 dise침ado para **proteger aplicaciones web de ataques basados en la web** sin modificar el c칩digo del backend. Incluye reglas personalizadas y conjuntos de reglas administradas para proteger contra amenazas como la inyecci칩n SQL, scripting entre sitios y otros ataques comunes.

### **Ejemplo**

* Imagina que tienes una aplicaci칩n distribuida globalmente con usuarios en todo el mundo. Puedes usar Azure Front Door para **enrutar las solicitudes de los usuarios al centro de datos regional m치s cercano** que aloja tu aplicaci칩n, reduciendo as칤 la latencia, mejorando la experiencia del usuario y **defendi칠ndola de ataques web con las capacidades de WAF**. Si una regi칩n en particular experimenta tiempo de inactividad, Azure Front Door puede redirigir autom치ticamente el tr치fico al siguiente mejor lugar, asegurando una alta disponibilidad.

### Enumeraci칩n

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway y Azure Application Gateway WAF

Azure Application Gateway es un **balanceador de carga de tr치fico web** que te permite gestionar el tr치fico hacia tus aplicaciones **web**. Ofrece **balanceo de carga de la capa 7, terminaci칩n SSL y capacidades de firewall de aplicaciones web (WAF)** en el Controlador de Entrega de Aplicaciones (ADC) como un servicio. Las caracter칤sticas clave incluyen enrutamiento basado en URL, afinidad de sesi칩n basada en cookies y descarga de capa de sockets seguros (SSL), que son cruciales para aplicaciones que requieren capacidades de balanceo de carga complejas como enrutamiento global y enrutamiento basado en rutas.

### Ejemplo

* Considera un escenario donde tienes un sitio web de comercio electr칩nico que incluye m칰ltiples subdominios para diferentes funciones, como cuentas de usuario y procesamiento de pagos. Azure Application Gateway puede **dirigir el tr치fico a los servidores web apropiados bas치ndose en la ruta de URL**. Por ejemplo, el tr치fico a `ejemplo.com/cuentas` podr칤a dirigirse al servicio de cuentas de usuario, y el tr치fico a `ejemplo.com/pago` podr칤a dirigirse al servicio de procesamiento de pagos.\
Y **proteger tu sitio web de ataques utilizando las capacidades de WAF.**

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** es una caracter칤stica de red en Azure que **permite la conexi칩n directa y sin problemas entre diferentes Redes Virtuales (VNets)**. A trav칠s de VNet peering, los recursos en una VNet pueden comunicarse con recursos en otra VNet utilizando direcciones IP privadas, **como si estuvieran en la misma red**.\
**VNet Peering tambi칠n se puede utilizar con redes locales** configurando una VPN de sitio a sitio o Azure ExpressRoute.

**Azure Hub and Spoke** es una topolog칤a de red utilizada en Azure para gestionar y organizar el tr치fico de red. **El "hub" es un punto central que controla y dirige el tr치fico entre diferentes "spokes"**. El hub t칤picamente contiene servicios compartidos como dispositivos virtuales de red (NVAs), Azure VPN Gateway, Azure Firewall o Azure Bastion. Los **"spokes" son VNets que alojan cargas de trabajo y se conectan al hub utilizando VNet peering**, lo que les permite aprovechar los servicios compartidos dentro del hub. Este modelo promueve un dise침o de red limpio, reduciendo la complejidad al centralizar servicios comunes que m칰ltiples cargas de trabajo en diferentes VNets pueden utilizar.

{% hint style="danger" %}
**El emparejamiento de VNets no es transitivo en Azure**, lo que significa que si el spoke 1 est치 conectado al spoke 2 y el spoke 2 est치 conectado al spoke 3, entonces el spoke 1 no puede comunicarse directamente con el spoke 3.
{% endhint %}

### Ejemplos

* Imagina una empresa con departamentos separados como Ventas, RRHH y Desarrollo, **cada uno con su propia VNet (los spokes)**. Estas VNets **requieren acceso a recursos compartidos** como una base de datos central, un firewall y una puerta de enlace a Internet, que se encuentran en **otra VNet (el hub)**. Al utilizar el modelo de Hub and Spoke, cada departamento puede **conectarse de forma segura a los recursos compartidos a trav칠s de la VNet del hub sin exponer esos recursos a Internet p칰blico** o crear una estructura de red compleja con numerosas conexiones.

### Enumeraci칩n

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## VPN de sitio a sitio

Una VPN de sitio a sitio en Azure te permite **conectar tu red local a tu Red Virtual de Azure (VNet)**, lo que permite que recursos como las VM dentro de Azure aparezcan como si estuvieran en tu red local. Esta conexi칩n se establece a trav칠s de un **gateway VPN que cifra el tr치fico** entre las dos redes.

### **Ejemplo**

* Una empresa con su oficina principal ubicada en Nueva York tiene un centro de datos local que necesita conectarse de forma segura a su VNet en Azure, donde se encuentran sus cargas de trabajo virtualizadas. Al configurar una **VPN de sitio a sitio, la empresa puede garantizar una conectividad cifrada entre los servidores locales y las VM de Azure**, lo que permite acceder de forma segura a los recursos en ambos entornos como si estuvieran en la misma red local.

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute es un servicio que proporciona una **conexi칩n privada, dedicada y de alta velocidad entre su infraestructura local y los centros de datos de Azure**. Esta conexi칩n se realiza a trav칠s de un proveedor de conectividad, evitando el uso de internet p칰blico y ofreciendo mayor fiabilidad, velocidades m치s r치pidas, latencias m치s bajas y mayor seguridad que las conexiones t칤picas a internet.

### **Ejemplo**

* Una corporaci칩n multinacional requiere una **conexi칩n consistente y confiable a sus servicios de Azure debido al alto volumen de datos** y la necesidad de un alto rendimiento. La empresa opta por Azure ExpressRoute para conectar directamente su centro de datos local a Azure, facilitando transferencias de datos a gran escala, como copias de seguridad diarias y an치lisis de datos en tiempo real, con mayor privacidad y velocidad mejorada.

### **Enumeraci칩n**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Red Team de HackTricks en AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
