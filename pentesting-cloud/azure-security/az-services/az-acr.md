# Az - ACR

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

其他支持HackTricks的方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 基本信息

Azure容器注册表（ACR）是由Microsoft Azure提供的托管服务，用于**存储和管理Docker容器映像和其他工件**。它提供集成的开发人员工具、地理复制、诸如基于角色的访问控制和映像扫描等安全措施、自动构建、Webhook和触发器以及网络隔离等功能。它与Docker CLI和Kubernetes等流行工具配合使用，并与其他Azure服务良好集成。

### 枚举

要枚举该服务，您可以使用脚本[**Get-AzACR.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Get-AzACR.ps1):

{% code overflow="wrap" %}
```bash
# List Docker images inside the registry
IEX (New-Object Net.Webclient).downloadstring("https://raw.githubusercontent.com/NetSPI/MicroBurst/master/Misc/Get-AzACR.ps1")

Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Internet Explorer\Main" -Name "DisableFirstRunCustomize" -Value 2

Get-AzACR -username <username> -password <password> -registry <corp-name>.azurecr.io
```
{% endcode %}

{% tabs %}
{% tab title="az cli" %}

### Azure Container Registry (ACR)

#### List all ACRs in a subscription

```bash
az acr list --subscription <subscription_id>
```

#### Show ACR details

```bash
az acr show --name <acr_name> --resource-group <resource_group_name>
```

#### Get ACR login server

```bash
az acr show --name <acr_name> --query loginServer --output table
```

#### Get ACR credentials

```bash
az acr credential show --name <acr_name>
```

#### Get ACR access keys

```bash
az acr credential show --name <acr_name> --query "passwords[0].value" -o tsv
````

#### Get ACR admin user credentials

```bash
az acr credential show --name <acr_name> --query "passwords[0].value" -o tsv
```

#### Get ACR repository list

```bash
az acr repository list --name <acr_name> --output table
```

#### Get ACR repository details

```bash
az acr repository show --name <acr_name> --repository <repository_name>
```

#### List images in ACR repository

```bash
az acr repository show-tags --name <acr_name> --repository <repository_name> --output table
````

#### Delete an image from ACR repository

```bash
az acr repository delete --name <acr_name> --image <image_tag>
```

#### List webhooks for ACR

```bash
az acr webhook list --registry <acr_name> --resource-group <resource_group_name>
```

#### Show ACR webhook details

```bash
az acr webhook show --registry <acr_name> --resource-group <resource_group_name> --name <webhook_name>
```

#### Delete ACR webhook

```bash
az acr webhook delete --registry <acr_name> --resource-group <resource_group_name> --name <webhook_name>
```

#### Get ACR network rule list

```bash
az acr network-rule list --name <acr_name> --resource-group <resource_group_name>
```

#### Show ACR network rule details

```bash
az acr network-rule show --name <acr_name> --resource-group <resource_group_name> --rule-name <rule_name>
```

#### Add ACR network rule

```bash
az acr network-rule add --name <acr_name> --resource-group <resource_group_name> --ip-address <ip_address>
``json
```

#### Delete ACR network rule

```bash
az acr network-rule remove --name <acr_name> --resource-group <resource_group_name> --ip-address <ip_address>
```

#### Get ACR encryption properties

```bash
az acr encryption show --name <acr_name> --resource-group <resource_group_name>
```

#### Update ACR encryption properties

```bash
az acr encryption update --name <acr_name> --resource-group <resource_group_name> --status Enabled
```

#### Get ACR quarantine policy

```bash
az acr quarantine show --name <acr_name> --resource-group <resourcejson_group_name>
```

#### Update ACR quarantine policy

```bash
az acr quarantine update --name <acr_name> --resource-group <resource_group_name> --status Enabled
```

#### Get ACR retention policy

```bash
az acr retention show --name <acr_name> --resource-group <resource_group_name>
```

#### Update ACR retention policy

```bash
az acr retention update --name <acr_name> --resource-group <resource_group_name> --status Enabled
```

#### Get ACR scope map

```bash
az acr scope-map show --name <acr_name> --resource-group <resource_group_name> --scope-map-name <scope_map_name>
``json
```

#### Update ACR scope map

```bash
az acr scope-map update --name <acr_name> --resource-group <resource_group_name> --scope-map-name <scope_map_name> --actions <actions>
```

#### Get ACR token credential

```bash
az acr token credential show --name <acr_name> --resource-group <resource_group_name>
```

#### List ACR token credentials

```bash
az acr token credential list --name <acr_name> --resource-group <resource_group_name>
```

#### Revoke ACR token credential

```bash
az acr token credential delete --name <acr_name> --resource-group <resource_group_name> --token <token>
```

#### Get ACR webhook config

```bash
az acr webhook get-config --registry <acr_name> --resource-group <resource_group_name> --name <webhook_name>
```

#### Ping ACR webhook

```bash
az acr webhook ping --registry <acr_name> --resource-group <resource_group_name> --name <webhook_name>
```

#### List ACR webhook events

```bash
az acr webhook list-events --registry <acr_name> --resource-group <resource_group_name> --name <webhook_name>
```

#### Get ACR webhook event details

```bash
az acr webhook show-event --registry <acr_name> --resource-group <resource_group_name> --name <webhook_name> --event-id <event_id>
```

#### List ACR webhook scopes

```bash
az acr webhook list-custom-identifiers --registry <acr_name> --resource-group <resource_group_name> --name <webhook_name>
```

#### Get ACR webhook scope details

```bash
az acr webhook show-custom-identifier --registry <acr_name> --resource-group <resource_group_name> --name <webhook_name> --custom-identifier <custom_identifier>
```

#### List ACR webhook scope mappings

```bash
az acr webhook list-custom-identifiers --registry <acr_name> --resource-group <resource_group_name> --name <webhook_name>
```

#### Get ACR webhook scope mapping details

```bash
az acr webhook show-custom-identifier --registry <acr_name> --resource-group <resource_group_name> --name <webhook_name> --custom-identifier <custom_identifier>
```
```bash
az acr list --output table
az acr show --name MyRegistry --resource-group MyResourceGroup
```
{% endtab %}

{% tab title="Az Powershell" %} 

## Azure Container Registry (ACR)

### List all ACRs in a subscription

To list all Azure Container Registries (ACRs) in a subscription, you can use the following Azure PowerShell command:

```powershell
Get-AzAcr
```

This command will retrieve a list of all ACRs along with details such as resource group, location, SKU, login server, and creation date.

### Get information about a specific ACR

To get detailed information about a specific Azure Container Registry (ACR), you can use the following command:

```powershell
Get-AzAcr -ResourceGroupName <resource-group-name> -Name <acr-name>
```

Replace `<resource-group-name>` with the name of the resource group where the ACR is located, and `<acr-name>` with the name of the ACR you want to get information about.

### Delete an ACR

To delete an Azure Container Registry (ACR), you can use the following command:

```powershell
Remove-AzAcr -ResourceGroupName <resource-group-name> -Name <acr-name>
```

Replace `<resource-group-name>` with the name of the resource group where the ACR is located, and `<acr-name>` with the name of the ACR you want to delete.

{% endtab %}
```powershell
# List all ACRs in your subscription
Get-AzContainerRegistry

# Get a specific ACR
Get-AzContainerRegistry -ResourceGroupName "MyResourceGroup" -Name "MyRegistry"
```
登录并从注册表中拉取
```bash
docker login <corp-name>.azurecr.io --username <username> --password <password>
docker pull <corp-name>.azurecr.io/<image>:<tag>
```
<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

其他支持HackTricks的方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
