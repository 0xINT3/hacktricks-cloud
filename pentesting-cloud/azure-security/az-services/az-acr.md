# Az - ACR

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**最新バージョンのPEASSを入手したい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを手に入れる
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)をフォローする。
* **ハッキングのトリックを共有するには、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

## 基本情報

Azure Container Registry (ACR) は、Microsoft Azure が提供する**Docker コンテナイメージやその他のアーティファクトの保存と管理**を行うためのマネージドサービスです。統合開発者ツール、ジオレプリケーション、ロールベースのアクセス制御やイメージスキャンなどのセキュリティ対策、自動ビルド、Webフックとトリガー、ネットワークの分離などの機能を提供しています。Docker CLI や Kubernetes などの人気ツールと連携し、他のAzureサービスともうまく統合されています。

### 列挙

サービスを列挙するために、[**Get-AzACR.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Get-AzACR.ps1)スクリプトを使用できます：

{% code overflow="wrap" %}
```bash
# List Docker images inside the registry
IEX (New-Object Net.Webclient).downloadstring("https://raw.githubusercontent.com/NetSPI/MicroBurst/master/Misc/Get-AzACR.ps1")

Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Internet Explorer\Main" -Name "DisableFirstRunCustomize" -Value 2

Get-AzACR -username <username> -password <password> -registry <corp-name>.azurecr.io
```
{% tab title="az cli" %}
```bash
az acr list --output table
az acr show --name MyRegistry --resource-group MyResourceGroup
```
{% tab title="Az Powershell" %}

Azure Container Registry (ACR) は、Docker イメージのプライベートレジストリを提供する Azure サービスです。ACR を使用すると、Docker イメージを保存、管理、およびデプロイすることができます。

ACR に対してペンテストを実施する際には、以下のセキュリティチェックを実施することが重要です。

1. ACR のアクセス制御を確認する。ACR には、認証とアクセス制御を管理するための Azure Active Directory (AAD) が統合されています。適切なロールベースのアクセス制御 (RBAC) を設定し、不正なアクセスを防止する必要があります。

2. ACR のネットワークセキュリティグループ (NSG) を確認する。NSG を使用して、ACR へのアクセスを制限することができます。必要なポートのみを開放し、不要なトラフィックをブロックするように設定してください。

3. ACR の監査ログを有効にする。監査ログを有効にすることで、ACR へのアクセスや操作のログを収集することができます。不正なアクティビティを検知し、追跡するために、監査ログを定期的に確認してください。

4. ACR のイメージスキャンを実施する。ACR は、イメージスキャン機能を提供しています。イメージスキャンを実施することで、セキュリティ上の脆弱性やマルウェアの検出を行うことができます。定期的にイメージスキャンを実施し、問題がある場合は修正するようにしてください。

5. ACR のセキュリティ設定を確認する。ACR には、セキュリティ設定を構成するための機能があります。SSL/TLS の有効化や、アクセスキーの回転などのセキュリティ設定を適切に構成してください。

ACR のセキュリティチェックを実施することで、ACR のセキュリティを向上させ、潜在的な脆弱性や攻撃を防止することができます。

{% endtab %}
```powershell
# List all ACRs in your subscription
Get-AzContainerRegistry

# Get a specific ACR
Get-AzContainerRegistry -ResourceGroupName "MyResourceGroup" -Name "MyRegistry"
```
{% endtab %}
{% endtabs %}

レジストリへのログインとプル
```bash
docker login <corp-name>.azurecr.io --username <username> --password <password>
docker pull <corp-name>.azurecr.io/<image>:<tag>
```
<details>

<summary><strong>Support HackTricksと特典を受け取る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**最新バージョンのPEASSにアクセスしたい**場合、またはHackTricksをPDFでダウンロードしたい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をご確認ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションをご覧ください
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するには、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>
