# Az - Azure App Service & Function Apps

## Az - Azure App Service & Function Apps

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

### Informazioni di base su App Service

[Dalla documentazione:](https://learn.microsoft.com/en-us/azure/app-service/overview) _Azure App Service_ √® un servizio basato su HTTP per l'hosting di applicazioni web, API REST e backend mobili. Puoi sviluppare nel tuo linguaggio preferito, che sia .NET, .NET Core, Java, Ruby, Node.js, PHP o Python. Le applicazioni vengono eseguite e scalate facilmente sia su ambienti basati su Windows che su Linux.

Ogni app viene eseguita all'interno di un sandbox, ma l'isolamento dipende dai piani di App Service

* Le app nei livelli Free e Shared vengono eseguite su VM condivise
* Le app nei livelli Standard e Premium vengono eseguite su VM dedicate

{% hint style="warning" %}
Nota che **nessuno** di questi isolamenti **impedisce** altre comuni **vulnerabilit√† web** (come l'upload di file o le iniezioni). E se viene utilizzata un'**identit√† di gestione**, potrebbe essere in grado di **comprometterne i permessi**.
{% endhint %}

#### Enumerazione

{% code overflow="wrap" %}
```bash
# List webapps
az webapp list

## Less information
az webapp list --query "[].{hostName: defaultHostName, state: state, name: name, resourcegroup: resourceGroup}"

# Get access restrictions
az webapp config access-restriction show --resource-group <res-group> -n <name>

# Remove access restrictions
az webapp config access-restriction remove --resource-group <res-group> -n <name> --rule-name <rule-name>

# Get snapshots
az webapp config snapshot list --resource-group <res-group> -n <name>

# Restore snapshot
az webapp config snapshot restore -g <res-group> -n <name> --time 2018-12-11T23:34:16.8388367

# Restart webapp
az webapp restart --name <name> --resource-group <res-group>
```
{% endcode %}

```powershell
# Get App Services and Function Apps
Get-AzWebApp
# Get only App Services
Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}
```

{% code overflow="wrap" %}
```
```
{% endcode %}

\`\`\`bash #!/bin/bash

## Get all App Service and Function Apps

## Define Azure subscription ID

azure\_subscription="your\_subscription\_id"

## Log in to Azure

az login

## Select Azure subscription

az account set --subscription $azure\_subscription

## Get all App Services in the specified subscription

list\_app\_services=$(az appservice list --query "\[].{appServiceName: name, group: resourceGroup}" -o tsv)

## Iterate over each App Service

echo "$list\_app\_services" | while IFS=$'\t' read -r appServiceName group; do

## Get the type of the App Service

service\_type=$(az appservice show --name $appServiceName --resource-group $group --query "kind" -o tsv)

## Check if it is a Function App and print its name

if \[ "$service\_type" == "functionapp" ]; then echo "Function App Name: $appServiceName" fi done

````
#### Ottenere le credenziali e accedere al codice dell'applicazione web

To obtain credentials and gain access to the code of the web application, you can follow these steps:

1. Utilize techniques like reconnaissance and enumeration to gather information about the target Azure App Service.

2. Identify potential vulnerabilities or misconfigurations that could lead to unauthorized access.

3. Exploit any discovered vulnerabilities or misconfigurations to gain access to the Azure App Service.

4. Once access is obtained, navigate to the web application's code repository or file system.

5. Analyze the code to understand its structure and functionality.

By following these steps, you can obtain the necessary credentials and gain access to the code of the Azure App Service.
```bash
# Get connection strings that could contain credentials (with DBs for example)
az webapp config connection-string list --name <name> --resource-group <res-group>
## Check how to use the DBs connection strings in the SQL page

# Get credentials to access the code and DB credentials if configured.
az webapp deployment list-publishing-profiles --resource-group <res-group> -n <name>


# Get git URL to access the code
az webapp deployment source config-local-git --resource-group <res-group> -n <name>

# Access/Modify the code via git
git clone 'https://<username>:<password>@name.scm.azurewebsites.net/repo-name.git'
## In my case the username was: $nameofthewebapp and the password some random chars
## If you change the code and do a push, the app is automatically redeployed
````

**Accesso al container Docker con l'app web tramite ssh:**

```bash
# Get ssh session
az webapp create-remote-connection --subscription <SUBSCRIPTION-ID> --resource-group <RG-NAME> -n <APP-SERVICE-NAME>

## If successfull you will get a message such as:
#Verifying if app is running....
#App is running. Trying to establish tunnel connection...
#Opening tunnel on port: 39895
#SSH is available { username: root, password: Docker! }

## So from that machine ssh into that port (you might need generate a new ssh session to the jump host)
ssh root@127.0.0.1 -p 39895
```

### Informazioni di base sulle Function Apps

Azure Functions √® una soluzione **serverless** che ti permette di scrivere meno codice, mantenere meno infrastrutture e risparmiare sui costi. Invece di preoccuparti di distribuire e mantenere server, l'infrastruttura cloud fornisce tutte le risorse aggiornate necessarie per far funzionare le tue applicazioni.

Nel portale di Azure, l'integrazione tra Azure Functions e Azure API Management √® facilitata, consentendo di esporre gli endpoint delle funzioni di trigger HTTP come API REST. Le API esposte in questo modo sono descritte utilizzando una definizione OpenAPI, fornendo un'interfaccia standard e indipendente dal linguaggio per le API RESTful.

Le **Function Apps supportano le Identit√† Gestite**.

Inoltre, la Function App potrebbe avere determinati endpoint che richiedono un certo livello di autenticazione, come "admin" o "anonymous".\
Un attaccante potrebbe cercare di accedere agli endpoint consentiti per gli utenti anonimi per eludere le restrizioni e ottenere accesso a dati o funzionalit√† sensibili.

#### Enumerazione

```powershell
# Get only Function Apps
Get-AzFunctionApp
```

### Riferimenti

* [https://learn.microsoft.com/en-in/azure/app-service/overview](https://learn.microsoft.com/en-in/azure/app-service/overview)
* [https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition](https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition)

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
