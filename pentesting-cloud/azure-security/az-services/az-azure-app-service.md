# Az - Azure App Service & Function Apps

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* If you want to see your **company advertised in HackTricks** or if you want access to the **latest version of the PEASS or download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## App Serviceの基本情報

_Azure App Service_は、Webアプリケーション、REST API、およびモバイルバックエンドをホストするためのHTTPベースのサービスです。お好きな言語で開発できます。.NET、.NET Core、Java、Ruby、Node.js、PHP、またはPythonです。アプリケーションは、WindowsおよびLinuxベースの環境で簡単に実行およびスケーリングできます。

各アプリはサンドボックス内で実行されますが、アプリサービスプランによって分離度が異なります。

* FreeおよびSharedティアのアプリは共有VM上で実行されます。
* StandardおよびPremiumティアのアプリは専用VM上で実行されます。

{% hint style="warning" %}
これらの分離は、ファイルのアップロードやインジェクションなどの一般的なWeb脆弱性を**防ぐことはありません**。また、**管理アイデンティティ**が使用されている場合、その権限を**侵害する可能性**があります。
{% endhint %}

### 列挙

{% tabs %}
{% tab title="az" %}
{% code overflow="wrap" %}
```bash
# List webapps
az webapp list

## Less information
az webapp list --query "[].{hostName: defaultHostName, state: state, name: name, resourcegroup: resourceGroup}"

# Get access restrictions
az webapp config access-restriction show --resource-group <res-group> -n <name>

# Remove access restrictions
az webapp config access-restriction remove --resource-group <res-group> -n <name> --rule-name <rule-name>

# Get snapshots
az webapp config snapshot list --resource-group <res-group> -n <name>

# Restore snapshot
az webapp config snapshot restore -g <res-group> -n <name> --time 2018-12-11T23:34:16.8388367

# Restart webapp
az webapp restart --name <name> --resource-group <res-group>
```
{% endcode %}
{% endtab %}

{% tab title="Az Powershell" %}
```powershell
# Get App Services and Function Apps
Get-AzWebApp
# Get only App Services
Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}
```
#### 資格情報の取得とWebアプリのコードへのアクセス

To obtain credentials and gain access to the webapp code, you can try the following techniques:

- **Application Insights**: Check if the webapp is using Application Insights for logging. If it is, you can access the logs and potentially find sensitive information such as connection strings or passwords.

- **Kudu Console**: Azure App Service provides a Kudu Console, which is a debugging and administration tool. You can access it by appending "/scm" to the webapp URL. From there, you can navigate to the Debug Console and explore the file system to find the webapp code.

- **FTP**: If FTP is enabled for the webapp, you can use an FTP client to connect to the webapp and browse the file system. Look for configuration files or other sensitive information that may be stored in plain text.

- **Azure Storage**: Check if the webapp is using Azure Storage for storing files or data. If it is, you can try to access the storage account and look for any sensitive information that may have been stored there.

- **Environment Variables**: Sometimes, sensitive information such as database connection strings or API keys are stored as environment variables. You can try to access the webapp's environment variables to see if any sensitive information is exposed.

Remember to always follow ethical hacking practices and obtain proper authorization before attempting any of these techniques.
```bash
# Get connection strings that could contain credentials (with DBs for example)
az webapp config connection-string list --name <name> --resource-group <res-group>
## Check how to use the DBs connection strings in the SQL page

# Get credentials to access the code and DB credentials if configured.
az webapp deployment list-publishing-profiles --resource-group <res-group> -n <name>


# Get git URL to access the code
az webapp deployment source config-local-git --resource-group <res-group> -n <name>

# Access/Modify the code via git
git clone 'https://<username>:<password>@name.scm.azurewebsites.net/repo-name.git'
## In my case the username was: $nameofthewebapp and the password some random chars
## If you change the code and do a push, the app is automatically redeployed
```
#### SSHを介してWebアプリのDockerコンテナにアクセスする方法:

```bash
ssh -p <port> <username>@<app-name>.scm.azurewebsites.net
```

Replace `<port>` with the SSH port number, `<username>` with the username, and `<app-name>` with the name of your web app.

`<port>`にはSSHポート番号、`<username>`にはユーザー名、`<app-name>`にはWebアプリの名前を入力してください。
```bash
# Get ssh session
az webapp create-remote-connection --subscription <SUBSCRIPTION-ID> --resource-group <RG-NAME> -n <APP-SERVICE-NAME>

## If successfull you will get a message such as:
#Verifying if app is running....
#App is running. Trying to establish tunnel connection...
#Opening tunnel on port: 39895
#SSH is available { username: root, password: Docker! }

## So from that machine ssh into that port (you might need generate a new ssh session to the jump host)
ssh root@127.0.0.1 -p 39895

```
## Function Appsの基本情報

Azure Functionsは、コードを少なくし、インフラストラクチャを少なく保守し、コストを節約することができる**サーバーレス**ソリューションです。サーバーのデプロイと保守について心配する必要はありません。クラウドインフラストラクチャが、アプリケーションの実行に必要な最新のリソースを提供します。

Azure Functionsは、Azure API Managementと統合されており、ポータルでHTTPトリガー関数の**エンドポイントをREST APIとして公開**することができます。これらのAPIは、OpenAPI定義を使用して記述されます。

**Function Appsは、マネージドアイデンティティをサポートしています。**

### 列挙
```powershell
# Get only Function Apps
Get-AzFunctionApp
```
## 参考文献

* [https://learn.microsoft.com/en-in/azure/app-service/overview](https://learn.microsoft.com/en-in/azure/app-service/overview)
* [https://app.gitbook.com/s/5uvPQhxNCPYYTqpRwsuS/\~/changes/en8rTJy7DsFQXWyNeiqE/pentesting-cloud/azure-security/az-services/az-function-apps#references](https://app.gitbook.com/s/5uvPQhxNCPYYTqpRwsuS/\~/changes/en8rTJy7DsFQXWyNeiqE/pentesting-cloud/azure-security/az-services/az-function-apps#references)
* [https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition](https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition)

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricks**で**会社の広告を見たい**場合や、**PEASSの最新バージョンをダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>
