# Az - Azure App Service & Function Apps

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 HackTricks 的 PDF，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>

## App Service 基本信息

_Azure App Service_ 是一个基于 HTTP 的服务，用于托管 Web 应用程序、REST API 和移动后端。您可以使用您喜欢的语言进行开发，如 .NET、.NET Core、Java、Ruby、Node.js、PHP 或 Python。应用程序可以在 Windows 和 Linux 环境中轻松运行和扩展。

每个应用程序都运行在一个沙箱中，但隔离性取决于 App Service 计划

* 免费和共享层的应用程序运行在共享的虚拟机上
* 标准和高级层的应用程序运行在专用的虚拟机上

{% hint style="warning" %}
请注意，**这些隔离措施都不能防止**其他常见的**Web 漏洞**（如文件上传或注入）。如果使用了**管理身份**，可能会导致其权限被**破坏**。
{% endhint %}

### 枚举

{% tabs %}
{% tab title="az" %}
{% code overflow="wrap" %}
```bash
# List webapps
az webapp list

## Less information
az webapp list --query "[].{hostName: defaultHostName, state: state, name: name, resourcegroup: resourceGroup}"

# Get access restrictions
az webapp config access-restriction show --resource-group <res-group> -n <name>

# Remove access restrictions
az webapp config access-restriction remove --resource-group <res-group> -n <name> --rule-name <rule-name>

# Get snapshots
az webapp config snapshot list --resource-group <res-group> -n <name>

# Restore snapshot
az webapp config snapshot restore -g <res-group> -n <name> --time 2018-12-11T23:34:16.8388367

# Restart webapp
az webapp restart --name <name> --resource-group <res-group>
```
{% endcode %}
{% endtab %}

{% tab title="Az Powershell" %}
```powershell
# Get App Services and Function Apps
Get-AzWebApp
# Get only App Services
Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}
```
#### 获取凭据并访问Web应用程序代码

To obtain credentials and gain access to the web application code, you can follow these steps:

1. **Reverse Engineering**: Analyze the web application binaries or mobile app to identify any hard-coded credentials or API keys. Use tools like IDA Pro or Hopper to disassemble and decompile the code.

2. **Brute-Force**: Attempt to guess weak or default credentials by using common username and password combinations. Tools like Hydra or Burp Suite can automate this process.

3. **Phishing**: Send targeted phishing emails to the web application's users or administrators, tricking them into revealing their credentials. Tools like GoPhish or SocialFish can assist in creating and executing phishing campaigns.

4. **Password Spraying**: Use a list of commonly used passwords and try them against multiple user accounts. Tools like Spray or Azure AD Password Spray can automate this process.

5. **Credential Stuffing**: Utilize leaked credentials from other data breaches and try them against the web application. Tools like Sentry MBA or SNIPR can automate this process.

6. **Exploiting Vulnerabilities**: Identify and exploit vulnerabilities in the web application to gain unauthorized access. Common vulnerabilities include SQL injection, remote code execution, or insecure direct object references.

7. **API Abuse**: Analyze the web application's APIs and endpoints for any misconfigurations or vulnerabilities that can be exploited to gain access to sensitive data or functionality.

Remember to always obtain proper authorization and permission before performing any penetration testing activities.
```bash
# Get connection strings that could contain credentials (with DBs for example)
az webapp config connection-string list --name <name> --resource-group <res-group>
## Check how to use the DBs connection strings in the SQL page

# Get credentials to access the code and DB credentials if configured.
az webapp deployment list-publishing-profiles --resource-group <res-group> -n <name>


# Get git URL to access the code
az webapp deployment source config-local-git --resource-group <res-group> -n <name>

# Access/Modify the code via git
git clone 'https://<username>:<password>@name.scm.azurewebsites.net/repo-name.git'
## In my case the username was: $nameofthewebapp and the password some random chars
## If you change the code and do a push, the app is automatically redeployed
```
#### 通过ssh访问webapp的Docker容器：

```bash
ssh -p <port> <username>@<ip_address>
```

Replace `<port>` with the SSH port number, `<username>` with the username, and `<ip_address>` with the IP address of the Azure App Service.

将`<port>`替换为SSH端口号，`<username>`替换为用户名，`<ip_address>`替换为Azure App Service的IP地址。

#### Access to the Docker container with the webapp via Azure Cloud Shell:

#### 通过Azure Cloud Shell访问webapp的Docker容器：

1. Open the Azure Cloud Shell.

1. 打开Azure Cloud Shell。

2. Run the following command to SSH into the Docker container:

2. 运行以下命令以SSH进入Docker容器：

```bash
ssh -p <port> <username>@<ip_address>
```

Replace `<port>` with the SSH port number, `<username>` with the username, and `<ip_address>` with the IP address of the Azure App Service.

将`<port>`替换为SSH端口号，`<username>`替换为用户名，`<ip_address>`替换为Azure App Service的IP地址。
```bash
# Get ssh session
az webapp create-remote-connection --subscription <SUBSCRIPTION-ID> --resource-group <RG-NAME> -n <APP-SERVICE-NAME>

## If successfull you will get a message such as:
#Verifying if app is running....
#App is running. Trying to establish tunnel connection...
#Opening tunnel on port: 39895
#SSH is available { username: root, password: Docker! }

## So from that machine ssh into that port (you might need generate a new ssh session to the jump host)
ssh root@127.0.0.1 -p 39895

```
## Function Apps基本信息

Azure Functions是一种无服务器解决方案，可以让您编写更少的代码、维护更少的基础设施并节省成本。与其担心部署和维护服务器，云基础设施提供了所有最新的资源，以保持应用程序的运行。

Azure Functions与Azure API Management集成在门户中，可以将您的HTTP触发器函数**端点公开为REST API**。这些API使用OpenAPI定义进行描述。

**Function Apps支持托管标识。**

### 枚举
```powershell
# Get only Function Apps
Get-AzFunctionApp
```
## 参考资料

* [https://learn.microsoft.com/en-in/azure/app-service/overview](https://learn.microsoft.com/en-in/azure/app-service/overview)
* [https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition](https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition)

<details>

<summary><strong>支持 HackTricks 并获得福利！</strong></summary>

* 如果您想在 HackTricks 中看到您的公司广告，或者如果您想访问 PEASS 的最新版本或下载 PDF 版的 HackTricks，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS 和 HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFT**](https://opensea.io/collection/the-peass-family)收藏品
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注**我的 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) **和** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github 仓库提交 PR 来分享您的黑客技巧。**

</details>
