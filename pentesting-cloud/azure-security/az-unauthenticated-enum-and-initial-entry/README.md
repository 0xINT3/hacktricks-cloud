# Az - 認証されていない列挙と初期エントリー

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**最新バージョンのPEASSを入手したい**場合、またはHackTricksをPDFでダウンロードしたい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をご覧ください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## Azureテナント

### テナントの列挙

**テナントのドメイン**を知っているだけで、攻撃者はより詳細な情報を収集するためにいくつかの**公開Azure API**をクエリできます。\
APIを直接クエリするか、PowerShellライブラリ[**AADInternals**](https://github.com/Gerenios/AADInternals)を使用できます。

| API                                                                  | 情報                                                                                          | AADInternalsの関数                                |
| -------------------------------------------------------------------- | -------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | テナントIDを含む**ログイン情報**                                                             | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | テナントの**すべてのドメイン**                                                               | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | テナントの**ログイン情報**、テナント名、ドメインの**認証タイプ**を含む                        | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | **デスクトップSSO情報**を含むログイン情報                                                   | `Get-AADIntLoginInformation -UserName <UserName>` |

**AADInternals**ライブラリの**1つのコマンドだけで**、Azureテナントのすべての情報をクエリできます。
```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```
Azureテナント情報の出力例：
```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          05aea22e-32f3-4c35-831b-52735704feb3
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```
以下の出力から、ターゲット組織のテナント情報がわかります。テナント名、ID、および「ブランド」名が含まれています。また、**デスクトップSSO（別名** [**Seamless SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso)**）が有効かどうかも確認できます**。有効な場合、指定したユーザーがターゲット組織に存在するかどうか（ユーザー列挙）を確認できます。

また、ターゲットテナントのすべての（確認済みの）ドメイン名とその識別タイプも表示されます。フェデレーテッドドメインの場合、使用されるアイデンティティプロバイダー（通常はADFSサーバー）のFQDNも表示されます。MX列は、メールがExchange Onlineに送信されるかどうかを示します。SPF列は、Exchange Onlineがメール送信者としてリストされているかどうかを示します。**注意！**現在、再帰関数はSPFレコードのincludeステートメントを追跡していないため、誤検出が発生する可能性があります。

### ユーザー列挙

テナント内に特定のユーザー名が存在するかどうかを**確認することができます**。これには、ユーザー名が次の形式であるゲストユーザーも含まれます：
```
<email>#EXT#@<tenant name>.onmicrosoft.com
```
メールはユーザーのメールアドレスで、"@"がアンダースコア"_"に置き換えられています。

[**AADInternals**](https://github.com/Gerenios/AADInternals)を使用すると、ユーザーが存在するかどうかを簡単に確認できます。
```powershell
# Check does the user exist
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```
# Azure Unauthenticated Enumeration and Initial Entry

This document outlines various techniques for enumerating and gaining initial access to Azure resources without authentication.

## Table of Contents

- [Introduction](#introduction)
- [Enumeration Techniques](#enumeration-techniques)
  - [Azure Resource Manager (ARM) API](#azure-resource-manager-arm-api)
  - [Azure Active Directory (AAD) Graph API](#azure-active-directory-aad-graph-api)
  - [Azure Storage Account Enumeration](#azure-storage-account-enumeration)
  - [Azure Key Vault Enumeration](#azure-key-vault-enumeration)
- [Initial Entry Techniques](#initial-entry-techniques)
  - [Weak or Default Credentials](#weak-or-default-credentials)
  - [Azure Functions](#azure-functions)
  - [Azure Logic Apps](#azure-logic-apps)
  - [Azure Container Instances](#azure-container-instances)
  - [Azure App Service](#azure-app-service)
  - [Azure Virtual Machines](#azure-virtual-machines)
  - [Azure Kubernetes Service (AKS)](#azure-kubernetes-service-aks)
  - [Azure Batch](#azure-batch)
  - [Azure Service Fabric](#azure-service-fabric)
  - [Azure SQL Database](#azure-sql-database)
  - [Azure Cosmos DB](#azure-cosmos-db)
  - [Azure SignalR Service](#azure-signalr-service)
  - [Azure Event Grid](#azure-event-grid)
  - [Azure Event Hubs](#azure-event-hubs)
  - [Azure Relay](#azure-relay)
  - [Azure API Management](#azure-api-management)
  - [Azure IoT Hub](#azure-iot-hub)
  - [Azure Media Services](#azure-media-services)
  - [Azure Search](#azure-search)
  - [Azure Cognitive Services](#azure-cognitive-services)
  - [Azure Databricks](#azure-databricks)
  - [Azure Data Lake Storage](#azure-data-lake-storage)
  - [Azure HDInsight](#azure-hdinsight)
  - [Azure Machine Learning](#azure-machine-learning)
  - [Azure DevOps](#azure-devops)
  - [Azure Functions Proxies](#azure-functions-proxies)
  - [Azure Front Door](#azure-front-door)
  - [Azure Traffic Manager](#azure-traffic-manager)
  - [Azure CDN](#azure-cdn)
  - [Azure DNS](#azure-dns)
  - [Azure Active Directory B2C](#azure-active-directory-b2c)
  - [Azure Active Directory Domain Services](#azure-active-directory-domain-services)
  - [Azure Active Directory Privileged Identity Management](#azure-active-directory-privileged-identity-management)
  - [Azure Active Directory Identity Protection](#azure-active-directory-identity-protection)
  - [Azure Active Directory External Identities](#azure-active-directory-external-identities)
  - [Azure Active Directory Managed Identities](#azure-active-directory-managed-identities)
  - [Azure Active Directory Conditional Access](#azure-active-directory-conditional-access)
  - [Azure Active Directory Identity Governance](#azure-active-directory-identity-governance)
  - [Azure Active Directory Access Reviews](#azure-active-directory-access-reviews)
  - [Azure Active Directory Privileged Access Management](#azure-active-directory-privileged-access-management)
  - [Azure Active Directory Identity Experience Framework](#azure-active-directory-identity-experience-framework)
  - [Azure Active Directory Connect](#azure-active-directory-connect)
  - [Azure Active Directory Seamless Single Sign-On](#azure-active-directory-seamless-single-sign-on)
  - [Azure Active Directory Password Protection](#azure-active-directory-password-protection)
  - [Azure Active Directory Multi-Factor Authentication](#azure-active-directory-multi-factor-authentication)
  - [Azure Active Directory Application Proxy](#azure-active-directory-application-proxy)
  - [Azure Active Directory Domain Join](#azure-active-directory-domain-join)
  - [Azure Active Directory Domain Services Join](#azure-active-directory-domain-services-join)
  - [Azure Active Directory Domain Services Password Reset](#azure-active-directory-domain-services-password-reset)
  - [Azure Active Directory Domain Services Replication](#azure-active-directory-domain-services-replication)
  - [Azure Active Directory Domain Services Health Monitoring](#azure-active-directory-domain-services-health-monitoring)
  - [Azure Active Directory Domain Services Backup and Restore](#azure-active-directory-domain-services-backup-and-restore)
  - [Azure Active Directory Domain Services Secure LDAP](#azure-active-directory-domain-services-secure-ldap)
  - [Azure Active Directory Domain Services Group Policy](#azure-active-directory-domain-services-group-policy)
  - [Azure Active Directory Domain Services Kerberos](#azure-active-directory-domain-services-kerberos)
  - [Azure Active Directory Domain Services LDAP](#azure-active-directory-domain-services-ldap)
  - [Azure Active Directory Domain Services DNS](#azure-active-directory-domain-services-dns)
  - [Azure Active Directory Domain Services NTLM](#azure-active-directory-domain-services-ntlm)
  - [Azure Active Directory Domain Services Password Hash Synchronization](#azure-active-directory-domain-services-password-hash-synchronization)
  - [Azure Active Directory Domain Services Password Writeback](#azure-active-directory-domain-services-password-writeback)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Seamless Single Sign-On](#azure-active-directory-domain-services-password-hash-synchronization-and-seamless-single-sign-on)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection and Multi-Factor Authentication](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection-and-multi-factor-authentication)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection and Multi-Factor Authentication and Conditional Access](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection-and-multi-factor-authentication-and-conditional-access)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities)
  - [Azure Active Directory Domain Services Password Hash Synchronization and Pass-Through Authentication and Seamless Single Sign-On and Smart Lockout and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities and Conditional Access and Identity Governance and Access Reviews and Privileged Access Management and Identity Experience Framework and Connect and Seamless Single Sign-On and Password Protection and Multi-Factor Authentication and Conditional Access and Identity Protection and External Identities and Managed Identities](#azure-active-directory-domain-services-password-hash-synchronization-and-pass-through-authentication-and-seamless-single-sign-on-and-smart-lockout-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-managed-identities-and-conditional-access-and-identity-governance-and-access-reviews-and-privileged-access-management-and-identity-experience-framework-and-connect-and-seamless-single-sign-on-and-password-protection-and-multi-factor-authentication-and-conditional-access-and-identity-protection-and-external-identities-and-man
```
UserName         Exists
--------         ------
user@company.com True
```
以下のようなテキストファイルを使用することもできます。各行には1つのメールアドレスが含まれています。
```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# Invoke user enumeration
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
次の3つの列挙方法から選択できます：

| 方法       | 説明                                                                                                                                                                                                 |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 通常       | 上記で言及されたGetCredentialType APIを指します。デフォルトの方法です。                                                                                                                           |
| ログイン    | <p>この方法では、ユーザーとしてログインを試みます。<br><strong>注意：</strong>クエリはサインインログに記録されます。</p>                                                                                       |
| 自動ログオン | <p>この方法では、自動ログオンエンドポイントを介してユーザーとしてログインを試みます。<br><strong>クエリはサインインログに記録されません</strong>。そのため、パスワードスプレーおよびブルートフォース攻撃にも適しています。</p> |

有効なユーザー名を発見した後、次のように**ユーザーに関する情報**を取得できます：
```powershell
Get-AADIntLoginInformation -UserName root@corp.onmicrosoft.com
```
スクリプト[o365creeper](https://github.com/LMGsec/o365creeper)は、**メールが有効かどうか**を確認することもできます。
```powershell
# Put in emails.txt emails such as:
# - root@corp.onmicrosoft.com
python.exe .\o365creeper\o365creeper.py -f .\emails.txt -o validemails.txt
```
## Azure サービス

Azure テナントが使用している**ドメイン**を知ったので、**公開されている Azure サービス**を見つけるために試してみましょう。

この目標を達成するために、[**MicroBurst**](https://github.com/NetSPI/MicroBurst)からのメソッドを使用することができます。この関数は、いくつかの**Azure サービスのドメイン**でベースドメイン名（およびいくつかの変形）を検索します。
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1 -Verbose
Invoke-EnumerateAzureSubDomains -Base corp -Verbose
```
## オープンストレージ

[**InvokeEnumerateAzureBlobs.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Invoke-EnumerateAzureBlobs.ps1)のようなツールを使用して、オープンストレージを発見することができます。このツールは、ファイル**`Microburst/Misc/permitations.txt`**を使用して、単純なパーミュテーションを生成し、**オープンストレージアカウントを見つけようとします**。
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base corp
[...]
https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
[...]

# Access https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
# Check: <Name>ssh_info.json</Name>
# Access then https://corpcommon.blob.core.windows.net/secrets/ssh_info.json
```
### SAS URLs

_**共有アクセス署名**_（SAS）URLは、特定のパーツ（フルコンテナ、ファイルなど）へのアクセスを提供するURLであり、リソースに対する特定の権限（読み取り、書き込みなど）を持っています。もしも漏洩しているURLを見つけた場合、機密情報にアクセスすることができます。以下はその例です（これはコンテナへのアクセスのためのものであり、ファイルへのアクセスを許可する場合、URLのパスにもそのファイルが含まれます）：

`https://<storage_account_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

データにアクセスするために[**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/)を使用してください。

## 認証情報の侵害

### フィッシング

* [**一般的なフィッシング**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology)（資格情報またはOAuthアプリ -[不正な同意付与攻撃](az-illicit-consent-grant.md)-）
* [**デバイスコード認証**フィッシング](az-device-code-authentication-phishing.md)

### パスワードスプレー/ブルートフォース

{% content-ref url="az-password-spraying.md" %}
[az-password-spraying.md](az-password-spraying.md)
{% endcontent-ref %}

## 参考文献

* [https://o365blog.com/post/just-looking/](https://o365blog.com/post/just-looking/)

<details>

<summary><strong>ハックトリックスをサポートして特典を受け取ろう！</strong></summary>

* もしもあなたの**会社をハックトリックスで宣伝したい**場合や、**最新版のPEASSを入手したい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**してください。
* **ハッキングのトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>
