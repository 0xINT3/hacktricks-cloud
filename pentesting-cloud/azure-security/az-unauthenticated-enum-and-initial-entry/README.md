# Az - Enum√©ration non authentifi√©e et entr√©e initiale

<details>

<summary><strong>Soutenez HackTricks et obtenez des avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) **et** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos.**

</details>

## Azure Tenant

### Enum√©ration du locataire

Il existe certaines **API Azure publiques** qui, en connaissant simplement le **domaine du locataire**, permettent √† un attaquant de r√©cup√©rer plus d'informations √† son sujet.\
Vous pouvez interroger directement l'API ou utiliser la biblioth√®que PowerShell [**AADInternals**](https://github.com/Gerenios/AADInternals) :

| API                                                                  | Information                                                                                   | Fonction AADInternals                             |
| -------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | **Informations de connexion**, y compris l'ID du locataire                                      | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | **Tous les domaines** du locataire                                                             | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | **Informations de connexion** du locataire, y compris le nom du locataire et le **type d'authentification de domaine** | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | Informations de connexion, y compris les informations **Desktop SSO**                           | `Get-AADIntLoginInformation -UserName <UserName>` |

Vous pouvez interroger toutes les informations d'un locataire Azure avec **une seule commande de la biblioth√®que** [**AADInternals**](https://github.com/Gerenios/AADInternals) :

```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```

Exemple de sortie des informations du locataire Azure :

```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          05aea22e-32f3-4c35-831b-52735704feb3
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```

√Ä partir de la sortie, nous pouvons voir les informations du locataire de l'organisation cible, y compris le nom du locataire, l'ID et le nom de la "marque". Nous pouvons √©galement voir si le **Desktop SSO (alias** [**Seamless SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso)**) est activ√©**. S'il est activ√©, nous pouvons savoir si un utilisateur donn√© existe dans l'organisation cible ou non (√©num√©ration des utilisateurs).

Nous pouvons √©galement voir les noms de tous les domaines (v√©rifi√©s) et leurs types d'identit√© du locataire cible. Pour les domaines f√©d√©r√©s, le FQDN du fournisseur d'identit√© utilis√© (g√©n√©ralement le serveur ADFS) est √©galement affich√©. La colonne MX indique si l'e-mail est envoy√© √† Exchange en ligne ou non. La colonne SPF indique si Exchange en ligne est r√©pertori√© comme exp√©diteur d'e-mails. **Notez que** la fonction de reconnaissance ne suit actuellement pas les d√©clarations d'inclusion des enregistrements SPF, il peut donc y avoir des faux n√©gatifs.

### √ânum√©ration des utilisateurs

Il est possible de **v√©rifier si un nom d'utilisateur existe** dans un locataire. Cela inclut √©galement les **utilisateurs invit√©s**, dont le nom d'utilisateur est au format :

```
<email>#EXT#@<tenant name>.onmicrosoft.com
```

L'e-mail est l'adresse e-mail de l'utilisateur o√π "@" est remplac√© par le trait de soulignement "_".

Avec [**AADInternals**](https://github.com/Gerenios/AADInternals), vous pouvez facilement v√©rifier si l'utilisateur existe ou non :

```powershell
# V√©rifier si l'utilisateur existe
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```

Sortie :

```
UserName         Exists
--------         ------
user@company.com True
```

Vous pouvez √©galement utiliser un fichier texte contenant une adresse e-mail par ligne :

```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# √ânum√©ration des utilis