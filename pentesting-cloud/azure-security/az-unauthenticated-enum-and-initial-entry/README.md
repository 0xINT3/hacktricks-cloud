# Az - Neautentifikovano nabrojavanje i početni unos

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Azure Tenant

### Nabrojavanje tenanta

Postoje neki **javni Azure API-ji** za koje samo poznavanje **domena tenanta** napadaču omogućava da pretražuje više informacija o njemu.\
Možete direktno pretraživati API ili koristiti PowerShell biblioteku [**AADInternals**](https://github.com/Gerenios/AADInternals)**:**

| API                                                                  | Informacije                                                                                                                                                                                                                                           | AADInternals funkcija                             |
| -------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | **Informacije o prijavi**, uključujući ID tenanta                                                                                                                                                                                                            | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | **Svi domeni** tenanta                                                                                                                                                                                                                         | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | <p><strong>Informacije o prijavi</strong> tenanta, uključujući ime tenanta i domen <strong>tipa autentifikacije.</strong><br>Ako je <code>NameSpaceType</code> <strong><code>Managed</code></strong>, to znači da se koristi <strong>AzureAD</strong>.</p> | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | Informacije o prijavi, uključujući **informacije o Desktop SSO-u**                                                                                                                                                                                              | `Get-AADIntLoginInformation -UserName <UserName>` |

Možete pretražiti sve informacije o Azure tenantu sa **samo jednom komandom** [**AADInternals**](https://github.com/Gerenios/AADInternals) **biblioteke**:
```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```
Primer izlaza informacija o Azure zakupcu:
```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          1937e3ab-38de-a735-a830-3075ea7e5b39
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```
Moguće je posmatrati detalje o imenu, ID-u i "brend" imenu zakupca. Dodatno, prikazan je status Desktop Single Sign-On (SSO), poznat i kao [**Seamless SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso). Kada je omogućena, ova funkcija olakšava određivanje prisustva (enumeracije) određenog korisnika unutar ciljne organizacije.

Osim toga, izlaz prikazuje imena svih verifikovanih domena povezanih sa ciljnim zakupcem, zajedno sa njihovim odgovarajućim tipovima identiteta. U slučaju federativnih domena, takođe se otkriva Potpuno kvalifikovano ime domena (FQDN) identitetskog provajdera koji se koristi, obično ADFS servera. Kolona "MX" označava da li se e-pošta usmerava ka Exchange Online-u, dok kolona "SPF" označava da li je Exchange Online naveden kao pošiljalac e-pošte. Važno je napomenuti da trenutna funkcija izviđanja ne analizira "include" izjave unutar SPF zapisa, što može rezultirati lažnim negativima.

### Enumeracija korisnika

Moguće je **proveriti da li korisničko ime postoji** unutar zakupca. Ovo uključuje i **gostujuće korisnike**, čije korisničko ime ima sledeći format:
```
<email>#EXT#@<tenant name>.onmicrosoft.com
```
Email adresa je korisnička email adresa gde se znak "@" zamenjuje sa donjom crtom "\_".

Sa [**AADInternals**](https://github.com/Gerenios/AADInternals) alatom, možete lako proveriti da li korisnik postoji ili ne:
```powershell
# Check does the user exist
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```
# Az unauthenticated enum and initial entry

Ovde ćemo razmotriti neke tehnike za izvršavanje neautentifikovane enumeracije i inicijalnog ulaska u Azure okruženje.

## 1. Enumeracija Azure Workspace-ova

Da biste izvršili enumeraciju Azure Workspace-ova, možete koristiti sledeće metode:

- **DNS enumeracija**: Koristite alate poput `dnsrecon` ili `dnsenum` za pronalaženje poddomena Workspace-a.
- **Whois enumeracija**: Koristite `whois` alat za pronalaženje informacija o vlasniku domena i drugim relevantnim podacima.
- **Google Hacking**: Koristite Google pretragu sa odgovarajućim ključnim rečima kako biste pronašli javno dostupne informacije o Workspace-ovima.

## 2. Pronalaženje nezaštićenih Azure Storage kontejnera

Da biste pronašli nezaštićene Azure Storage kontejnere, možete koristiti sledeće metode:

- **Azure Storage Explorer**: Koristite Azure Storage Explorer za pregled i pronalaženje nezaštićenih kontejnera.
- **Azure CLI**: Koristite Azure CLI komandu `az storage container list` za pronalaženje svih kontejnera u okviru određenog Storage naloga.
- **Automatizovani alati**: Koristite alate poput `azurite` ili `azurite-scan` za automatsko skeniranje Azure Storage naloga i pronalaženje nezaštićenih kontejnera.

## 3. Pronalaženje nezaštićenih Azure Key Vault-ova

Da biste pronašli nezaštićene Azure Key Vault-ove, možete koristiti sledeće metode:

- **Azure Portal**: Pregledajte Azure Portal kako biste pronašli nezaštićene Key Vault-ove.
- **Azure CLI**: Koristite Azure CLI komandu `az keyvault list` za pronalaženje svih Key Vault-ova u okviru određenog Azure naloga.
- **Automatizovani alati**: Koristite alate poput `azurite` ili `azurite-scan` za automatsko skeniranje Azure naloga i pronalaženje nezaštićenih Key Vault-ova.

## 4. Pronalaženje nezaštićenih Azure SQL baza podataka

Da biste pronašli nezaštićene Azure SQL baze podataka, možete koristiti sledeće metode:

- **Azure Portal**: Pregledajte Azure Portal kako biste pronašli nezaštićene SQL baze podataka.
- **Azure CLI**: Koristite Azure CLI komandu `az sql server list` za pronalaženje svih SQL servera u okviru određenog Azure naloga.
- **Automatizovani alati**: Koristite alate poput `azurite` ili `azurite-scan` za automatsko skeniranje Azure naloga i pronalaženje nezaštićenih SQL baza podataka.

## 5. Pronalaženje nezaštićenih Azure Cosmos DB baza podataka

Da biste pronašli nezaštićene Azure Cosmos DB baze podataka, možete koristiti sledeće metode:

- **Azure Portal**: Pregledajte Azure Portal kako biste pronašli nezaštićene Cosmos DB baze podataka.
- **Azure CLI**: Koristite Azure CLI komandu `az cosmosdb list` za pronalaženje svih Cosmos DB naloga u okviru određenog Azure naloga.
- **Automatizovani alati**: Koristite alate poput `azurite` ili `azurite-scan` za automatsko skeniranje Azure naloga i pronalaženje nezaštićenih Cosmos DB baza podataka.
```
UserName         Exists
--------         ------
user@company.com True
```
Možete koristiti tekstualni fajl koji sadrži jednu email adresu po redu:
```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# Invoke user enumeration
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
Postoje **tri različite metode enumeracije** koje možete odabrati:

| Metoda    | Opis                                                                                                                                                                                                   |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Normalna  | Ovo se odnosi na API GetCredentialType koji je pomenut gore. Podrazumevana metoda.                                                                                                                      |
| Prijava    | <p>Ova metoda pokušava da se prijavi kao korisnik.<br><strong>Napomena:</strong> upiti će biti zabeleženi u logovima prijava.</p>                                                                         |
| Autologon  | <p>Ova metoda pokušava da se prijavi kao korisnik putem autologon endpointa.<br><strong>Upiti nisu zabeleženi</strong> u logovima prijava! Zbog toga dobro funkcioniše i za napade poput prskanja lozinki i brute-force napada.</p> |

Nakon otkrivanja validnih korisničkih imena, možete dobiti **informacije o korisniku** pomoću:
```powershell
Get-AADIntLoginInformation -UserName root@corp.onmicrosoft.com
```
Skripta [**o365creeper**](https://github.com/LMGsec/o365creeper) takođe vam omogućava da otkrijete **da li je email validan**.
```powershell
# Put in emails.txt emails such as:
# - root@corp.onmicrosoft.com
python.exe .\o365creeper\o365creeper.py -f .\emails.txt -o validemails.txt
```
## Azure usluge

Sada kada znamo **domene koje Azure zakupac** koristi, vreme je da pokušamo da pronađemo **izložene Azure usluge**.

Možete koristiti metod iz [**MicroBurst**](https://github.com/NetSPI/MicroBurst) za ovaj cilj. Ova funkcija će pretraživati osnovno ime domene (i nekoliko permutacija) u nekoliko **Azure domena usluga:**
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1 -Verbose
Invoke-EnumerateAzureSubDomains -Base corp -Verbose
```
## Otvoreno skladište

Možete otkriti otvoreno skladište pomoću alata kao što je [**InvokeEnumerateAzureBlobs.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Invoke-EnumerateAzureBlobs.ps1) koji će koristiti datoteku **`Microburst/Misc/permitations.txt`** za generisanje permutacija (vrlo jednostavno) kako bi pokušao **pronaći otvorene naloge za skladištenje**.
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base corp
[...]
https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
[...]

# Access https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
# Check: <Name>ssh_info.json</Name>
# Access then https://corpcommon.blob.core.windows.net/secrets/ssh_info.json
```
### SAS URL-ovi

_**URL sa deljenim pristupnim potpisom**_ (SAS) je URL koji **omogućava pristup** određenom delu skladišnog naloga (može biti cela kontejner, datoteka...) sa određenim dozvolama (čitanje, pisanje...) nad resursima. Ako pronađete procureli URL, možete imati pristup osetljivim informacijama. Izgledaju ovako (ovo je primer za pristup kontejneru, ako bi pristup bio samo datoteci, putanja URL-a bi takođe sadržavala tu datoteku):

`https://<naziv_skladišnog_naloga>.blob.core.windows.net/novi_kontejner?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

Koristite [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) za pristup podacima.

## Kompromitovanje akreditacija

### Fišing

* [**Uobičajeni fišing**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (akreditacije ili OAuth aplikacija -[Napad sa neovlašćenim pristankom](az-illicit-consent-grant.md)-)
* [**Fišing autentifikacije uređaja**](az-device-code-authentication-phishing.md)

### Prskanje lozinki / Brute-Force

{% content-ref url="az-password-spraying.md" %}
[az-password-spraying.md](az-password-spraying.md)
{% endcontent-ref %}

## Reference

* [https://aadinternals.com/post/just-looking/](https://aadinternals.com/post/just-looking/)

<details>

<summary><strong>Naučite hakovanje AWS-a od početnika do stručnjaka sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **oglašavanje vaše kompanije u HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
