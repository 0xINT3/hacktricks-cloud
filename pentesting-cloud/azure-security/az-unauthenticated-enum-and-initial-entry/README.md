# Az - рдЕрдЕрдереЗрдВрдЯрд┐рдХреЗрдЯреЗрдб рдПрдиреБрдо рдПрдВрдб рдЗрдирд┐рд╢рд┐рдпрд▓ рдПрдВрдЯреНрд░реА

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдХреЛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

## рдПрдЬрд╝реНрдпреВрд░ рдЯреЗрдиреЗрдВрдЯ

### рдЯреЗрдиреЗрдВрдЯ рдПрдиреБрдорд░реЗрд╢рди

рдХреБрдЫ **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдПрдЬрд╝реНрдпреВрд░ рдПрдкреАрдЖрдИ** рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗрд╡рд▓ **рдЯреЗрдиреЗрдВрдЯ рдХреЗ рдбреЛрдореЗрди** рдХреЛ рдЬрд╛рдирддреЗ рд╣реБрдП рдХреНрд╡реЗрд░реА рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЙрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЬреБрдЯрд╛ рд╕рдХреЗред\
рдЖрдк рд╕реАрдзреЗ рдПрдкреАрдЖрдИ рдХреНрд╡реЗрд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ PowerShell рдкреБрд╕реНрддрдХрд╛рд▓рдп [**AADInternals**](https://github.com/Gerenios/AADInternals)** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:

| рдПрдкреАрдЖрдИ                                                              | рдЬрд╛рдирдХрд╛рд░реА                                                                                                                                                                                                                                           | AADInternals рдлрд╝рдВрдХреНрд╢рди                             |
| -------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | **рд▓реЙрдЧрд┐рди рдЬрд╛рдирдХрд╛рд░реА**, рдЯреЗрдиреЗрдВрдЯ рдЖрдИрдбреА рд╕рд╣рд┐рдд                                                                                                                                                                                                            | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | рдЯреЗрдиреЗрдВрдЯ рдХреЗ **рд╕рднреА рдбреЛрдореЗрди**                                                                                                                                                                                                                         | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | <p><strong>рдЯреЗрдиреЗрдВрдЯ рдХреА рд▓реЙрдЧрд┐рди рдЬрд╛рдирдХрд╛рд░реА</strong>, рдЯреЗрдиреЗрдВрдЯ рдирд╛рдо рдФрд░ рдбреЛрдореЗрди <strong>рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдХрд╛рд░</strong> рд╕рд╣рд┐рддред<br>рдпрджрд┐ <code>NameSpaceType</code> <strong><code>Managed</code></strong> рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ <strong>AzureAD</strong> рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛ рд░рд╣рд╛ рд╣реИред</p> | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | рд▓реЙрдЧрд┐рди рдЬрд╛рдирдХрд╛рд░реА, рд╕рд╣рд┐рдд **рдбреЗрд╕реНрдХрдЯреЙрдк SSO рдЬрд╛рдирдХрд╛рд░реА**                                                                                                                                                                                              | `Get-AADIntLoginInformation -UserName <UserName>` |

рдЖрдк **рдПрдХ рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде** [**AADInternals**](https://github.com/Gerenios/AADInternals) **рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рд╕рд╛рде** рдПрдХ рдПрдЬрд╝реНрдпреВрд░ рдЯреЗрдиреЗрдВрдЯ рдХреА рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдХреНрд╡реЗрд░реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```
рдПрдЬрд╝реНрдпреВрд░ рдЯреЗрдиреЗрдВрдЯ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрджрд╛рд╣рд░рдг:
```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          1937e3ab-38de-a735-a830-3075ea7e5b39
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```
рдЖрдкрдХреЛ рдЖрд╡рд╛рд╕реА рдХрд╛ рдирд╛рдо, рдЖрдИрдбреА, рдФрд░ "рдмреНрд░рд╛рдВрдб" рдирд╛рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╡рд░рдг рджреЗрдЦрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдбреЗрд╕реНрдХрдЯреЙрдк рдПрдХрд▓ рд╕рд╛рдЗрди-рдСрди (SSO), рдЬрд┐рд╕реЗ [**рд╕реАрдорд▓реЗрд╕ SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso) рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХреА рд╕реНрдерд┐рддрд┐ рднреА рдкреНрд░рджрд░реНрд╢рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИред рдЬрдм рдпрд╣ рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рд▓рдХреНрд╖реНрдп рд╕рдВрдЧрдарди рдореЗрдВ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдореМрдЬреВрджрдЧреА (рдЬрд╛рдБрдЪ) рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рддреА рд╣реИред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдЙрддреНрдкрд╛рджрди рдореЗрдВ рд▓рдХреНрд╖рд┐рдд рдЖрд╡рд╛рд╕реА рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рднреА рд╕рддреНрдпрд╛рдкрд┐рдд рдбреЛрдореЗрдиреЛрдВ рдХреЗ рдирд╛рдо рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рд╕рд╛рде рд╣реА рдЙрдирдХреЗ рд╕рдВрдмрдВрдзрд┐рдд рдкрд╣рдЪрд╛рди рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рдеред рд╕рдВрдШреАрдп рдбреЛрдореЗрдиреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ рдХрд╛ рдкреВрд░реНрдг рдпреЛрдЧреНрдп рдбреЛрдореЗрди рдирд╛рдо (FQDN), рдЬрд┐рд╕рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдпрдд: рдПрдХ ADFS рд╕рд░реНрд╡рд░ рд╣реЛрддрд╛ рд╣реИ, рднреА рдЦреБрд▓рд╛рд╕рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред "MX" рд╕реНрддрдВрдн рд╕реНрдкрд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдИрдореЗрд▓ Exchange Online рдореЗрдВ рдорд╛рд░реНрдЧреАрдд рд╣реИ, рдЬрдмрдХрд┐ "SPF" рд╕реНрддрдВрдн Exchange Online рдХреЛ рдИрдореЗрд▓ рднреЗрдЬрдиреЗ рд╡рд╛рд▓реЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реВрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИред рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рд╡рд░реНрддрдорд╛рди рдкреВрд░реНрд╡рд╛рдиреБрд╕рдВрдзрд╛рди рдХрд╛рд░реНрдп SPF рд░рд┐рдХреЙрд░реНрдбреНрд╕ рдХреЗ "рд╢рд╛рдорд┐рд▓" рд╡рдХреНрддрд╡реНрдпреЛрдВ рдХреЛ рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЧрд▓рдд рдирдХрд╛рд░рд╛рддреНрдордХ рдкрд░рд┐рдгрд╛рдо рджреЗрдиреЗ рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддрд╛ рд╣реИред

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд╛рдБрдЪ

рдЖрдкрдХреЛ **рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рдПрдХ рдЖрд╡рд╛рд╕реА рдХреЗ рдЕрдВрджрд░ рдореМрдЬреВрдж рд╣реИред рдЗрд╕рдореЗрдВ **рдореЗрд╣рдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдПрдБ** рднреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдЗрд╕ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ:
```
<email>#EXT#@<tenant name>.onmicrosoft.com
```
рдИрдореЗрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдИрдореЗрд▓ рдкрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ "@" рдХреЛ рдЕрдВрдбрд░рд╕реНрдХреЛрд░ "_" рд╕реЗ рдмрджрд▓ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

[**AADInternals**](https://github.com/Gerenios/AADInternals) рдХреЗ рд╕рд╛рде, рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВ:
```powershell
# Check does the user exist
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```
## рдЖрдЙрдЯрдкреБрдЯ:
```
UserName         Exists
--------         ------
user@company.com True
```
рдЖрдк рдПрдХ рдкрдВрдХреНрддрд┐ рдкреНрд░рддрд┐ рдПрдХ рдИрдореЗрд▓ рдкрддрд╛ рд╡рд╛рд▓рд╛ рдПрдХ рдкрд╛рда рдлрд╝рд╛рдЗрд▓ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# Invoke user enumeration
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
There are **рддреАрди рд╡рд┐рднрд┐рдиреНрди рдЧрдгрдирд╛ рд╡рд┐рдзрд┐рдпрд╛рдБ** рдЪреБрдирдиреЗ рдХреЗ рд▓рд┐рдП:

| рд╡рд┐рдзрд┐      | рд╡рд┐рд╡рд░рдг                                                                                                                                                                                             |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| рд╕рд╛рдорд╛рдиреНрдп    | рдпрд╣ рдКрдкрд░ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд GetCredentialType API рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡рд┐рдзрд┐ред                                                                                                                           |
| рд▓реЙрдЧрд┐рди     | <p>рдпрд╣ рд╡рд┐рдзрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреА рд╣реИред<br><strong>рдиреЛрдЯ:</strong> рдХреНрд╡реЗрд░реА рд╕рд╛рдЗрди-рдЗрдиреНрд╕ рд▓реЙрдЧ рдореЗрдВ рд▓реЙрдЧ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред</p>                                                                                       |
| рдСрдЯреЛрд▓реЙрдЧрди | <p>рдпрд╣ рд╡рд┐рдзрд┐ рдСрдЯреЛрд▓реЙрдЧрди рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреА рд╣реИред<br><strong>рдХреНрд╡реЗрд░реА рд╕рд╛рдЗрди-рдЗрдиреНрд╕ рд▓реЙрдЧ рдореЗрдВ рдирд╣реАрдВ</strong> рд▓реЙрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ! рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрд╣ рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдкреНрд░реЗ рдФрд░ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рд╣рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП рднреА рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддреА рд╣реИред</p> |

рд╡реИрдз рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЖрдк **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```powershell
Get-AADIntLoginInformation -UserName root@corp.onmicrosoft.com
```
рд╕реНрдХреНрд░рд┐рдкреНрдЯ [**o365creeper**](https://github.com/LMGsec/o365creeper) рдЖрдкрдХреЛ рдпрд╣ рднреА рдЦреЛрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ **рдХреНрдпрд╛ рдИрдореЗрд▓ рдорд╛рдиреНрдп рд╣реИ**ред
```powershell
# Put in emails.txt emails such as:
# - root@corp.onmicrosoft.com
python.exe .\o365creeper\o365creeper.py -f .\emails.txt -o validemails.txt
```
**рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдЯреАрдореНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд╛рдВрдЪ**

рдПрдХ рдФрд░ рдЕрдЪреНрдЫрд╛ рд╕реНрд░реЛрдд рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдЯреАрдореНрд╕ рд╣реИред

рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдЯреАрдореНрд╕ рдХрд╛ рдПрдкреАрдЖрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦреЛрдЬ" рдЕрдВрдд-рд╕реНрдерд╛рдпреА **externalsearchv3** рдФрд░ **searchUsers** рдХрд╛ рдЙрдкрдпреЛрдЧ рдЯреАрдореНрд╕-рдирд╛рдорд╛рдВрдХрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рд╛рдорд╛рдиреНрдп рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдПрдкреАрдЖрдИ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЧреИрд░ рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмреАрдЪ рднрд┐рдиреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рдирдХреЗ рдкрд╛рд╕ рдПрдХ рд╡реИрдз рдЯреАрдореНрд╕ рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рд╣реИред

рд╕реНрдХреНрд░рд┐рдкреНрдЯ [**TeamsEnum**](https://github.com/sse-secure-systems/TeamsEnum) рдХрд╛ рдЙрдкрдпреЛрдЧ рдЯреАрдореНрд╕ рдПрдкреАрдЖрдИ рдХреЗ рдЦрд┐рд▓рд╛рдл рджрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреА рдорд╛рдиреНрдпрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```bash
python3 TeamsEnum.py -a password -u <username> -f inputlist.txt -o teamsenum-output.json
```
## рдЖрд╡рд╢реНрдпрдХрддрд╛

рдЗрд╕ рдЯреЗрдХреНрдирд┐рдХрд▓ рд░рд┐рдкреЛрд░реНрдЯ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп Azure рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рдЕрдирдЕрдереЗрдВрдЯрд┐рдХреЗрдЯреЗрдб рдПрдиреБрдорд░реЗрд╢рди рдФрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкреНрд░рд╡реЗрд╢ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рд╣реИред рдпрд╣ рд░рд┐рдкреЛрд░реНрдЯ рдЙрди рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд░реНрдгрд┐рдд рдХрд░рддреА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдордиреЗ рдПрдХ Azure рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╕рдордп рдкрд╛рдпрд╛ рд╣реИ рдФрд░ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдордиреЗ рдПрдХ рдЕрдирдЕрдереЗрдВрдЯрд┐рдХреЗрдЯреЗрдб рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИред

## рд╡рд┐рд╡рд░рдг

рдЗрд╕ рд░рд┐рдкреЛрд░реНрдЯ рдореЗрдВ рд╣рдордиреЗ рдПрдХ Azure рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рд▓рд┐рдП рдЕрдирдЕрдереЗрдВрдЯрд┐рдХреЗрдЯреЗрдб рдПрдиреБрдорд░реЗрд╢рди рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рд╣реИред рд╣рдордиреЗ рдЗрд╕ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдмрд┐рдирд╛ рдПрдХреНрд╕реЗрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдордиреЗ рдЗрд╕ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЙрдкрд╛рдпреЛрдВ рдХрд╛ рднреА рд╡рд░реНрдгрди рдХрд┐рдпрд╛ рд╣реИред

## рдЙрджреНрджреЗрд╢реНрдп

рдЗрд╕ рд░рд┐рдкреЛрд░реНрдЯ рдХрд╛ рдореБрдЦреНрдп рдЙрджреНрджреЗрд╢реНрдп рдЕрдирдЕрдереЗрдВрдЯрд┐рдХреЗрдЯреЗрдб рдПрдиреБрдорд░реЗрд╢рди рдФрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкреНрд░рд╡реЗрд╢ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рдордЭрдирд╛ рд╣реИ рддрд╛рдХрд┐ Azure рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдорд┐рдпреЛрдВ рдХреЛ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдареАрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
```
[-] user1@domain - Target user not found. Either the user does not exist, is not Teams-enrolled or is configured to not appear in search results (personal accounts only)
[+] user2@domain - User2 | Company (Away, Mobile)
[+] user3@domain - User3 | Company (Available, Desktop)
```
рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЙрдкрд▓рдмреНрдзрддрд╛ рд╕реВрдЪрдирд╛ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ рдЬреИрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд:

- рдЙрдкрд▓рдмреНрдз
- рджреВрд░
- рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ
- рд╡реНрдпрд╕реНрдд
- рдСрдлрд▓рд╛рдЗрди

рдпрджрд┐ **рдЖрдЙрдЯ рдСрдл рдСрдлрд┐рд╕ рд╕рдВрджреЗрд╢** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ TeamsEnum рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИред рдпрджрд┐ рдПрдХ рдЖрдЙрдЯрдкреБрдЯ рдлрд╝рд╛рдЗрд▓ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреА рдЧрдИ рдереА, рддреЛ рдЖрдЙрдЯ рдСрдл рдСрдлрд┐рд╕ рд╕рдВрджреЗрд╢ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ JSON рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ:
```
jq . teamsenum-output.json
```
## рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдПрдиреБрдорд░реЗрд╢рди рдФрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкреНрд░рд╡реЗрд╢

рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рд╡рд┐рднрд╛рдЧ рдореЗрдВ, рд╣рдо рдЕрдкреНрд░рдорд╛рдгрд┐рдд рдПрдиреБрдорд░реЗрд╢рди рдФрд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкреНрд░рд╡реЗрд╢ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рддрдХрдиреАрдХреЛрдВ рдХреА рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВрдЧреЗред
```json
{
"email": "user2@domain",
"exists": true,
"info": [
{
"tenantId": "[REDACTED]",
"isShortProfile": false,
"accountEnabled": true,
"featureSettings": {
"coExistenceMode": "TeamsOnly"
},
"userPrincipalName": "user2@domain",
"givenName": "user2@domain",
"surname": "",
"email": "user2@domain",
"tenantName": "Company",
"displayName": "User2",
"type": "Federated",
"mri": "8:orgid:[REDACTED]",
"objectId": "[REDACTED]"
}
],
"presence": [
{
"mri": "8:orgid:[REDACTED]",
"presence": {
"sourceNetwork": "Federated",
"calendarData": {
"outOfOfficeNote": {
"message": "Dear sender. I am out of the office until March 23rd with limited access to my email. I will respond after my return.Kind regards, User2",
"publishTime": "2023-03-15T21:44:42.0649385Z",
"expiry": "2023-04-05T14:00:00Z"
},
"isOutOfOffice": true
},
"capabilities": [
"Audio",
"Video"
],
"availability": "Away",
"activity": "Away",
"deviceType": "Mobile"
},
"etagMatch": false,
"etag": "[REDACTED]",
"status": 20000
}
]
}
```
## рдПрдЬрд╝реНрдпреВрд░ рд╕реЗрд╡рд╛рдПрдВ

рдЬрд╛рди рд▓реЗрдВ рдХрд┐ рд╣рдореЗрдВ рдкрддрд╛ рд╣реИ рдХрд┐ **рдПрдЬрд╝реНрдпреВрд░ рдЯреЗрдиреЗрдВрдЯ** рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ **рдбреЛрдореЗрди** рдЕрдм рд╣рдореЗрдВ рдХреЛрд╢рд┐рд╢ рдХрд░рдиреА рд╣реИ рдХрд┐ **рдПрдЬрд╝реНрдпреВрд░ рд╕реЗрд╡рд╛рдПрдВ рдЙрдЬрд╛рдЧрд░** рдХреА рдЬрд╛рдПрдВред

рдЖрдк рдЗрд╕ рд▓рдХреНрд╖реНрдп рдХреЗ рд▓рд┐рдП [**MicroBust**](https://github.com/NetSPI/MicroBurst) рд╕реЗ рдПрдХ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдХрд╛рд░реНрдп рд╡рд┐рднрд┐рдиреНрди **рдПрдЬрд╝реНрдпреВрд░ рд╕реЗрд╡рд╛ рдбреЛрдореЗрдиреЛрдВ** рдореЗрдВ рдореВрд▓ рдбреЛрдореЗрди рдирд╛рдо (рдФрд░ рдХреБрдЫ рдЕрд╡рдзрд╛рд░рдгрд╛рдПрдБ) рдЦреЛрдЬреЗрдЧрд╛:
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1 -Verbose
Invoke-EnumerateAzureSubDomains -Base corp -Verbose
```
## рдУрдкрди рд╕реНрдЯреЛрд░реЗрдЬ

рдЖрдк рдПрдХ рдЯреВрд▓ рдЬреИрд╕реЗ [**InvokeEnumerateAzureBlobs.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Invoke-EnumerateAzureBlobs.ps1) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдУрдкрди рд╕реНрдЯреЛрд░реЗрдЬ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ **`Microburst/Misc/permitations.txt`** рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рдкрд░рд┐рд╡рд░реНрддрди (рдмрд╣реБрдд рд╕рд░рд▓) рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХреЗ рдФрд░ **рдУрдкрди рд╕реНрдЯреЛрд░реЗрдЬ рдЦрд╛рддреЗ** рдвреВрдВрдв рд╕рдХреЗред
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base corp
[...]
https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
[...]

# Access https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
# Check: <Name>ssh_info.json</Name>
# Access then https://corpcommon.blob.core.windows.net/secrets/ssh_info.json
```
### SAS URLs

рдПрдХ _**рд╕рд╛рдЭрд╛ рдПрдХреНрд╕реЗрд╕ рд╕рд┐рдЧреНрдиреЗрдЪрд░**_ (SAS) URL рдПрдХ URL рд╣реИ рдЬреЛ рдХрд┐рд╕реА рд╕реНрдЯреЛрд░реЗрдЬ рдЕрдХрд╛рдЙрдВрдЯ рдХреЗ рдХрд┐рд╕реА рдЦрдВрдб (рдкреВрд░реЗ рдХрдВрдЯреЗрдирд░, рдПрдХ рдлрд╝рд╛рдЗрд▓...) рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВ (рдкрдврд╝рдиреЗ, рд▓рд┐рдЦрдиреЗ...) рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ред рдпрджрд┐ рдЖрдкрдХреЛ рдХреЛрдИ рд▓реАрдХ рдорд┐рд▓ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЖрдк рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдпреЗ рдРрд╕реЗ рджрд┐рдЦрддреЗ рд╣реИрдВ (рдпрд╣ рдПрдХ рдХрдВрдЯреЗрдирд░ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ, рдЕрдЧрд░ рдпрд╣ рдХреЗрд╡рд▓ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд░рд╣рд╛ рд╣реЛрддрд╛ рддреЛ URL рдХрд╛ рдкрде рднреА рдЙрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛):

`https://<storage_account_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

[**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВ

## рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдХрдордЬреЛрд░ рдХрд░рдирд╛

### рдлрд┐рд╢рд┐рдВрдЧ

* [**рд╕рд╛рдорд╛рдиреНрдп рдлрд┐рд╢рд┐рдВрдЧ**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдпрд╛ OAuth рдРрдк -[рдЕрд╡реИрдз рд╕рд╣рдорддрд┐ рдЕрдиреБрдорддрд┐ рд╣рдорд▓рд╛](az-illicit-consent-grant.md)-)
* [**рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдлрд┐рд╢рд┐рдВрдЧ](az-device-code-authentication-phishing.md)

### рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдкреНрд░реЗрдЗрдВрдЧ / рдмреНрд░реВрдЯ-рдлрд╝реЛрд░реНрд╕

{% content-ref url="az-password-spraying.md" %}
[az-password-spraying.md](az-password-spraying.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://aadinternals.com/post/just-looking/](https://aadinternals.com/post/just-looking/)
* [https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/](https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
