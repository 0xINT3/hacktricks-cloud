# Az - Ongeverifieerde Enum & Inisie√´le Toegang

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>

## Azure Tenant

### Tenant Enumerasie

Daar is sekere **openbare Azure API's** waarvan 'n aanvaller net deur die **domein van die tenant** te weet, kan ondersoek instel om meer inligting daaroor te bekom.\
Jy kan direk die API ondersoek of die PowerShell-biblioteek [**AADInternals**](https://github.com/Gerenios/AADInternals)** gebruik:**

| API                                                                  | Inligting                                                                                                                                                                                                                                           | AADInternals-funksie                             |
| -------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | **Aantekeninligting**, insluitend tenant-ID                                                                                                                                                                                                            | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | **Alle domeine** van die tenant                                                                                                                                                                                                                         | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | <p><strong>Aantekeninligting</strong> van die tenant, insluitend tenant-naam en domein <strong>verifikasietipe.</strong><br>As <code>NameSpaceType</code> <strong><code>Managed</code></strong> is, beteken dit dat <strong>AzureAD</strong> gebruik word.</p> | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | Aantekeninligting, insluitend **Desktop SSO-inligting**                                                                                                                                                                                              | `Get-AADIntLoginInformation -UserName <UserName>` |

Jy kan alle inligting van 'n Azure tenant ondersoek met **net een opdrag van die** [**AADInternals**](https://github.com/Gerenios/AADInternals) **biblioteek**:
```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```
Uitvoervoorbeeld van die Azure huurderinligting:
```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          1937e3ab-38de-a735-a830-3075ea7e5b39
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```
Dit is moontlik om besonderhede oor die huurder se naam, ID en "handelsmerk" naam waar te neem. Daarbenewens word die status van die Desktop Single Sign-On (SSO), ook bekend as [**Seamless SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso), vertoon. Wanneer dit geaktiveer is, fasiliteer hierdie funksie die bepaling van die teenwoordigheid (enumerasie) van 'n spesifieke gebruiker binne die teikenorganisasie.

Verder toon die uitset die name van alle geverifieerde domeine wat verband hou met die teikenhuurder, tesame met hul onderskeie identiteitstipes. In die geval van gefedereerde domeine, word die Volledig Gekwalifiseerde Domeinnaam (FQDN) van die identiteitsverskaffer wat gebruik word, tipies 'n ADFS-bediener, ook bekend gemaak. Die "MX" kolom spesifiseer of e-posse na Exchange Online gerouteer word, terwyl die "SPF" kolom die lys van Exchange Online as 'n e-posafsender aandui. Dit is belangrik om daarop te let dat die huidige verkenningsfunksie nie die "include" verklarings binne SPF-rekords ontled nie, wat kan lei tot vals negatiewe resultate.

### Gebruikersenumerasie

Dit is moontlik om te **kontrolleer of 'n gebruikersnaam** binne 'n huurder bestaan. Dit sluit ook **gasgebruikers** in, waarvan die gebruikersnaam in die formaat is:
```
<email>#EXT#@<tenant name>.onmicrosoft.com
```
Die e-pos is die gebruiker se e-posadres waar die ‚Äú@‚Äù vervang word met 'n onderstreep "_".

Met [**AADInternals**](https://github.com/Gerenios/AADInternals) kan jy maklik nagaan of die gebruiker bestaan of nie:
```powershell
# Check does the user exist
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```
# Azure Ongeverifieerde Enumerasie en Inisie√´le Toegang

Hierdie gids bevat 'n oorsig van die stappe wat geneem kan word om ongeverifieerde enumerasie en inisie√´le toegang in Azure te verkry. Hierdie tegnieke kan gebruik word vir pentesting-doeleindes en om die veiligheid van Azure-implementasies te evalueer.

## Ongeverifieerde Enumerasie

Ongeverifieerde enumerasie behels die identifisering van blootgestelde hulpbronne sonder om 'n geldige aanmelding te vereis. Dit kan gedoen word deur die gebruik van openbare API's, soos die Azure REST API, om inligting oor hulpbronne te verkry.

### Stappe vir Ongeverifieerde Enumerasie

1. Identifiseer die doelwit se Azure-tenants ID.
2. Gebruik die Azure REST API om 'n lys van hulpbronne in die doelwit se tenant te verkry.
3. Analiseer die verkryde inligting om potensi√´le blootgestelde hulpbronne te identifiseer, soos stoorrekenaars, databasisse, virtuele masjiene, ensovoorts.

## Inisie√´le Toegang

Nadat potensi√´le blootgestelde hulpbronne ge√Ødentifiseer is, kan inisie√´le toegang verkry word deur die gebruik van bekende kwesbaarhede of swak konfigurasies. Hier is 'n paar moontlike metodes:

### 1. Blootgestelde Stoorrekenaars

As 'n stoorrekenaar blootgestel is, kan toegang verkry word deur die gebruik van bekende kwesbaarhede, soos swakke wagwoorde of onveilige konfigurasies.

### 2. Blootgestelde Databasisse

As 'n databasis blootgestel is, kan toegang verkry word deur die gebruik van bekende kwesbaarhede, soos swakke wagwoorde of onveilige konfigurasies. Dit kan die moontlikheid bied om data te lek of selfs beheer oor die databasis te verkry.

### 3. Blootgestelde Virtuele Masjiene

As 'n virtuele masjien blootgestel is, kan toegang verkry word deur die gebruik van bekende kwesbaarhede, soos swakke wagwoorde of onveilige konfigurasies. Dit kan die moontlikheid bied om die virtuele masjien te beheer of as 'n springplank na ander hulpbronne binne die Azure-omgewing te dien.

### 4. Blootgestelde Opslaghouers

As 'n opslaghouver blootgestel is, kan toegang verkry word deur die gebruik van bekende kwesbaarhede, soos swakke wagwoorde of onveilige konfigurasies. Dit kan die moontlikheid bied om data te lek of selfs beheer oor die opslaghouver te verkry.

### 5. Blootgestelde Webtoepassings

As 'n webtoepassing blootgestel is, kan toegang verkry word deur die gebruik van bekende kwesbaarhede, soos swakke wagwoorde of onveilige konfigurasies. Dit kan die moontlikheid bied om data te lek, beheer oor die toepassing te verkry, of selfs die uitvoering van arbit√™re kode.

## Voorkoming en Beveiliging

Om die risiko van ongeverifieerde enumerasie en inisie√´le toegang te verminder, moet die volgende maatre√´ls in ag geneem word:

- Stel sterk wagwoorde in vir alle rekeninge en hulpbronne.
- Beperk die blootstelling van hulpbronne deur die gebruik van toegangsbeheer en rolgebaseerde toegangsbeheer.
- Monitor en analiseer logl√™ers vir verdagte aktiwiteit.
- Voer gereelde veiligheidstoetsing en -opdaterings uit om bekende kwesbaarhede te verhelp.

Deur hierdie maatre√´ls te implementeer, kan die veiligheid van Azure-implementasies versterk word en die risiko van ongeoorloofde toegang verminder word.
```
UserName         Exists
--------         ------
user@company.com True
```
Jy kan ook 'n teksl√™er gebruik wat een e-posadres per ry bevat:
```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# Invoke user enumeration
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
Daar is **drie verskillende opnoemingsmetodes** om van te kies:

| Metode    | Beskrywing                                                                                                                                                                                              |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Normaal   | Dit verwys na die GetCredentialType API wat hierbo genoem is. Die verstekmetode.                                                                                                                        |
| Aanteken  | <p>Hierdie metode probeer om as die gebruiker aan te teken.<br><strong>Let op:</strong> navrae sal gelog word in die aanmeldingslog.</p>                                                                 |
| Outomatiese aanmelding | <p>Hierdie metode probeer om as die gebruiker aan te teken via die outomatiese aanmeldingseindpunt.<br><strong>Navrae word nie gelog</strong> in die aanmeldingslog nie! Dit werk dus ook goed vir wagwoordspuit- en brute force-aanvalle.</p> |

Nadat jy die geldige gebruikersname ontdek het, kan jy **inligting oor 'n gebruiker** kry met:
```powershell
Get-AADIntLoginInformation -UserName root@corp.onmicrosoft.com
```
Die skrip [**o365creeper**](https://github.com/LMGsec/o365creeper) stel jou ook in staat om te ontdek of 'n e-pos geldig is.
```powershell
# Put in emails.txt emails such as:
# - root@corp.onmicrosoft.com
python.exe .\o365creeper\o365creeper.py -f .\emails.txt -o validemails.txt
```
## Azure Dienste

Nou dat ons weet watter **domeine die Azure huurder** gebruik, is dit tyd om te probeer om **blootgestelde Azure-dienste** te vind.

Jy kan 'n metode van [**MicroBurst**](https://github.com/NetSPI/MicroBurst) gebruik vir hierdie doel. Hierdie funksie sal die basisdomeinnaam (en 'n paar permutasies) soek in verskeie **Azure-diensdomeine:**
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1 -Verbose
Invoke-EnumerateAzureSubDomains -Base corp -Verbose
```
## Oop Berging

Jy kan oop berging ontdek met 'n instrument soos [**InvokeEnumerateAzureBlobs.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Invoke-EnumerateAzureBlobs.ps1) wat die l√™er **`Microburst/Misc/permitations.txt`** sal gebruik om permutasies (baie eenvoudig) te genereer om te probeer **oop bergingsrekeninge te vind**.
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base corp
[...]
https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
[...]

# Access https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
# Check: <Name>ssh_info.json</Name>
# Access then https://corpcommon.blob.core.windows.net/secrets/ssh_info.json
```
### SAS-URL's

'n **gedeelde toegangssignatuur**' (SAS) URL is 'n URL wat **toegang bied** tot 'n sekere deel van 'n Stoorrekening (kan 'n volledige houer, 'n l√™er...) met sekere spesifieke toestemmings (lees, skryf...) oor die hulpbronne. As jy een vind wat uitgelek het, kan jy moontlik toegang kry tot sensitiewe inligting. Dit lyk soos hierdie (dit is om toegang te verkry tot 'n houer, as dit net toegang verleen tot 'n l√™er, sal die pad van die URL ook daardie l√™er bevat):

`https://<storage_account_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

Gebruik [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) om die data te benader.

## Kompromitteer Gelde

### Hengel

* [**Gewone Hengel**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (gelde of OAuth App -[Illegale Toestemming Verleen Aanval](az-illicit-consent-grant.md)-)
* [**Toestelkode-verifikasie** Hengel](az-device-code-authentication-phishing.md)

### Wagwoord Spuit / Brute-Force

{% content-ref url="az-password-spraying.md" %}
[az-password-spraying.md](az-password-spraying.md)
{% endcontent-ref %}

## Verwysings

* [https://aadinternals.com/post/just-looking/](https://aadinternals.com/post/just-looking/)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSKRIPSIEPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFT's**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>
