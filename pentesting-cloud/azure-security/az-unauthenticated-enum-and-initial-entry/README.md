# Az - Ανεπιβεβαίωτη Απαρίθμηση & Αρχική Είσοδος

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Azure Tenant

### Απαρίθμηση Tenant

Υπάρχουν μερικά **δημόσια APIs του Azure** που απλά γνωρίζοντας το **domain του tenant** ένας επιτιθέμενος μπορεί να ερωτηθεί για να συγκεντρώσει περισσότερες πληροφορίες για αυτόν.\
Μπορείτε να ερωτηθείτε απευθείας το API ή να χρησιμοποιήσετε τη βιβλιοθήκη PowerShell [**AADInternals**](https://github.com/Gerenios/AADInternals)**:**

| API                                                                  | Πληροφορίες                                                                                                                                                                                                                                           | Συνάρτηση AADInternals                             |
| -------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | **Πληροφορίες σύνδεσης**, συμπεριλαμβανομένου του ID του tenant                                                                                                                                                                                        | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | **Όλα τα domains** του tenant                                                                                                                                                                                                                         | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | <p><strong>Πληροφορίες σύνδεσης</strong> του tenant, συμπεριλαμβανομένου του ονόματος του tenant και του domain του <strong>τύπου πιστοποίησης.</strong><br>Εάν το <code>NameSpaceType</code> είναι <strong><code>Managed</code></strong>, σημαίνει ότι χρησιμοποιείται το <strong>AzureAD</strong>.</p> | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | Πληροφορίες σύνδεσης, συμπεριλαμβανομένων των πληροφοριών **Desktop SSO**                                                                                                                                                                              | `Get-AADIntLoginInformation -UserName <UserName>` |

Μπορείτε να ερωτηθείτε για όλες τις πληροφορίες ενός Azure tenant με **μόνο ένα command της** [**βιβλιοθήκης AADInternals**](https://github.com/Gerenios/AADInternals)**:**
```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```
Παράδειγμα εξόδου των πληροφοριών του Azure tenant:
```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          1937e3ab-38de-a735-a830-3075ea7e5b39
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```
Είναι δυνατόν να παρατηρηθούν λεπτομέρειες σχετικά με το όνομα του tenant, το ID και το όνομα "brand". Επιπλέον, εμφανίζεται η κατάσταση του Desktop Single Sign-On (SSO), γνωστό και ως [**Seamless SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso). Όταν είναι ενεργοποιημένη αυτή η λειτουργία, διευκολύνεται η προσδιορισμός της παρουσίας (απαρίθμηση) ενός συγκεκριμένου χρήστη εντός του οργανισμού προορισμού.

Επιπλέον, η έξοδος παρουσιάζει τα ονόματα όλων των επαληθευμένων τομέων που σχετίζονται με τον στόχο tenant, μαζί με τους αντίστοιχους τύπους ταυτότητας τους. Στην περίπτωση των συνδεδεμένων τομέων, αποκαλύπτεται επίσης το Fully Qualified Domain Name (FQDN) του παροχέα ταυτότητας που χρησιμοποιείται, συνήθως ένας διακομιστής ADFS. Η στήλη "MX" υποδεικνύει εάν τα email δρομολογούνται προς το Exchange Online, ενώ η στήλη "SPF" υποδεικνύει την καταχώρηση του Exchange Online ως αποστολέα email. Σημειώνεται ότι η τρέχουσα λειτουργία αναγνώρισης δεν αναλύει τις δηλώσεις "include" εντός των εγγραφών SPF, πράγμα που μπορεί να οδηγήσει σε λανθασμένα αρνητικά αποτελέσματα.

### Απαρίθμηση Χρηστών

Είναι δυνατόν να **ελεγχθεί εάν υπάρχει ένα όνομα χρήστη** εντός ενός tenant. Αυτό περιλαμβάνει επίσης τους **guest χρήστες**, των οποίων το όνομα χρήστη έχει τη μορφή:
```
<email>#EXT#@<tenant name>.onmicrosoft.com
```
Το email είναι η διεύθυνση email του χρήστη όπου το "@" αντικαθίσταται με το υπογεγραμμένο "_".

Με το [**AADInternals**](https://github.com/Gerenios/AADInternals), μπορείτε εύκολα να ελέγξετε εάν ο χρήστης υπάρχει ή όχι:
```powershell
# Check does the user exist
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```
# Ανεπιβεβαίωτη Αναγνώριση και Αρχική Είσοδος στο Azure

Αυτός ο οδηγός περιέχει τεχνικές για την ανεπιβεβαίωτη αναγνώριση και την αρχική είσοδο στο Azure. Αυτές οι τεχνικές επιτρέπουν σε έναν χάκερ να ανακαλύψει ευπάθειες και να αποκτήσει πρόσβαση σε ανεξουσιοδότητες λειτουργίες του Azure χωρίς να απαιτείται πιστοποίηση.

## Ανεπιβεβαίωτη Αναγνώριση

Η ανεπιβεβαίωτη αναγνώριση αναφέρεται στη διαδικασία εντοπισμού ευπαθειών στο Azure χωρίς την ανάγκη για πιστοποίηση. Αυτό μπορεί να επιτευχθεί με τη χρήση διάφορων τεχνικών, όπως:

- Εκτέλεση επιθέσεων brute force για να ανακαλύψετε έγκυρα διαπιστευτήρια.
- Αξιοποίηση ευπαθειών στην αυθεντικοποίηση και την εξουσιοδότηση.
- Χρήση ευπαθειών στις υπηρεσίες Azure για να αποκτήσετε πρόσβαση σε ευαίσθητα δεδομένα.

## Αρχική Είσοδος

Μόλις έχετε ανακαλύψει μια ευπάθεια και έχετε αποκτήσει ανεπιβεβαίωτη πρόσβαση, μπορείτε να προχωρήσετε στην αρχική είσοδο στο Azure. Αυτό περιλαμβάνει την εκτέλεση των παρακάτω ενεργειών:

- Εξερεύνηση του περιβάλλοντος Azure για να ανακαλύψετε ευπάθειες και ευάλωτες ρυθμίσεις.
- Ανάκτηση ευαίσθητων πληροφοριών, όπως διαπιστευτήρια, κλειδιά API και πιστοποιητικά.
- Εκτέλεση επιθέσεων privilege escalation για να αποκτήσετε υψηλότερα δικαιώματα στο Azure.

Αυτές οι τεχνικές μπορούν να σας βοηθήσουν να αποκτήσετε πλήρη έλεγχο ενός περιβάλλοντος Azure και να προχωρήσετε σε περαιτέρω επιθέσεις.
```
UserName         Exists
--------         ------
user@company.com True
```
Μπορείτε επίσης να χρησιμοποιήσετε ένα αρχείο κειμένου που περιέχει μια διεύθυνση email ανά γραμμή:
```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# Invoke user enumeration
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
Υπάρχουν **τρεις διαφορετικές μέθοδοι απαρίθμησης** για να επιλέξετε:

| Μέθοδος   | Περιγραφή                                                                                                                                                                                             |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Κανονική  | Αναφέρεται στο API GetCredentialType που αναφέρθηκε παραπάνω. Η προεπιλεγμένη μέθοδος.                                                                                                                           |
| Σύνδεση   | <p>Αυτή η μέθοδος προσπαθεί να συνδεθεί ως ο χρήστης.<br><strong>Σημείωση:</strong> οι ερωτήσεις θα καταγραφούν στο αρχείο καταγραφής συνδέσεων.</p>                                                                                       |
| Αυτόματη σύνδεση | <p>Αυτή η μέθοδος προσπαθεί να συνδεθεί ως ο χρήστης μέσω του σημείου αυτόματης σύνδεσης.<br><strong>Οι ερωτήσεις δεν καταγράφονται</strong> στο αρχείο καταγραφής συνδέσεων! Ως τέτοιο, λειτουργεί επίσης καλά για επιθέσεις password spray και brute-force.</p> |

Αφού ανακαλύψετε τα έγκυρα ονόματα χρηστών, μπορείτε να λάβετε **πληροφορίες για έναν χρήστη** με:
```powershell
Get-AADIntLoginInformation -UserName root@corp.onmicrosoft.com
```
Το σενάριο [**o365creeper**](https://github.com/LMGsec/o365creeper) σας επιτρέπει επίσης να ανακαλύψετε **αν ένα email είναι έγκυρο**.
```powershell
# Put in emails.txt emails such as:
# - root@corp.onmicrosoft.com
python.exe .\o365creeper\o365creeper.py -f .\emails.txt -o validemails.txt
```
## Υπηρεσίες Azure

Τώρα που γνωρίζουμε τους τομείς που χρησιμοποιεί ο Azure tenant, είναι ώρα να προσπαθήσουμε να βρούμε τις εκτεθειμένες υπηρεσίες Azure.

Μπορείτε να χρησιμοποιήσετε μια μέθοδο από το [**MicroBust**](https://github.com/NetSPI/MicroBurst) για αυτόν τον σκοπό. Αυτή η λειτουργία θα αναζητήσει το βασικό όνομα του τομέα (και μερικές παραλλαγές) σε διάφορους τομείς **υπηρεσιών Azure:**
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1 -Verbose
Invoke-EnumerateAzureSubDomains -Base corp -Verbose
```
## Ανοιχτή Αποθήκευση

Μπορείτε να ανακαλύψετε ανοιχτές αποθηκεύσεις με ένα εργαλείο όπως το [**InvokeEnumerateAzureBlobs.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Invoke-EnumerateAzureBlobs.ps1), το οποίο θα χρησιμοποιήσει το αρχείο **`Microburst/Misc/permitations.txt`** για να δημιουργήσει περιπτώσεις (πολύ απλές) για να δοκιμάσει να **βρει ανοιχτούς λογαριασμούς αποθήκευσης**.
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base corp
[...]
https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
[...]

# Access https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
# Check: <Name>ssh_info.json</Name>
# Access then https://corpcommon.blob.core.windows.net/secrets/ssh_info.json
```
### SAS URLs

Ένα _**shared access signature**_ (SAS) URL είναι ένα URL που **παρέχει πρόσβαση** σε ένα συγκεκριμένο μέρος ενός λογαριασμού αποθήκευσης (μπορεί να είναι ένας ολόκληρος container, ένα αρχείο...) με ορισμένα συγκεκριμένα δικαιώματα (ανάγνωση, εγγραφή...) πάνω στους πόρους. Αν βρείτε ένα διαρρεύσαν SAS URL, μπορείτε να έχετε πρόσβαση σε ευαίσθητες πληροφορίες, μοιάζουν με αυτό (αυτό είναι για πρόσβαση σε έναν container, αν απλά παρέχει πρόσβαση σε ένα αρχείο, η διαδρομή του URL θα περιέχει επίσης αυτό το αρχείο):

`https://<storage_account_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

Χρησιμοποιήστε το [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) για να έχετε πρόσβαση στα δεδομένα.

## Παραβίαση διαπιστευτήριων

### Απάτη Phishing

* [**Κοινή απάτη Phishing**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (διαπιστευτήρια ή OAuth App -[Επίθεση Illicit Consent Grant](az-illicit-consent-grant.md)-)
* [**Απάτη Phishing με Device Code Authentication**](az-device-code-authentication-phishing.md)

### Επίθεση Password Spraying / Brute-Force

{% content-ref url="az-password-spraying.md" %}
[az-password-spraying.md](az-password-spraying.md)
{% endcontent-ref %}

## Αναφορές

* [https://aadinternals.com/post/just-looking/](https://aadinternals.com/post/just-looking/)

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
