# Az - рдбрд┐рд╡рд╛рдЗрд╕ рдкрдВрдЬреАрдХрд░рдг

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

рдЬрдм рдХреЛрдИ рдбрд┐рд╡рд╛рдЗрд╕ AzureAD рд╕реЗ рдЬреБрдбрд╝рддрд╛ рд╣реИ, AzureAD рдореЗрдВ рдПрдХ рдирдпрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдбрд┐рд╡рд╛рдЗрд╕ рдкрдВрдЬреАрдХрд░рдг рдХреЗ рд╕рдордп, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдЙрд╕рдХреЗ рдЦрд╛рддреЗ рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ** (рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдиреЗ рдкрд░ MFA рдХреЗ рд▓рд┐рдП рдкреВрдЫрддрд╛рдЫ рдХреА рдЬрд╛рддреА рд╣реИ), рдлрд┐рд░ рдпрд╣ рдбрд┐рд╡рд╛рдЗрд╕ рдкрдВрдЬреАрдХрд░рдг рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдЕрдВрддрд┐рдо рдкреБрд╖реНрдЯрд┐ рд╕рдВрдХреЗрдд рдХреЗ рд▓рд┐рдП рдкреВрдЫрддрд╛ рд╣реИред

рдЗрд╕рдХреЗ рдмрд╛рдж, рдбрд┐рд╡рд╛рдЗрд╕ рдореЗрдВ рджреЛ RSA рдХреАрдкреЗрдпрд░реНрд╕ рдЙрддреНрдкрдиреНрди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ: **рдбрд┐рд╡рд╛рдЗрд╕ рдХреА** (**рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ** рдХреБрдВрдЬреА) рдЬреЛ **AzureAD** рдХреЛ рднреЗрдЬреА рдЬрд╛рддреА рд╣реИ рдФрд░ **рдЯреНрд░рд╛рдВрд╕рдкреЛрд░реНрдЯ** рдХреА (**рдирд┐рдЬреА** рдХреБрдВрдЬреА) рдЬреЛ рд╕рдВрднрд╡ рд╣реЛ рддреЛ TPM рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рддреА рд╣реИред

рдлрд┐рд░, **рдСрдмреНрдЬреЗрдХреНрдЯ** **AzureAD** рдореЗрдВ рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (Intune рдореЗрдВ рдирд╣реАрдВ) рдФрд░ AzureAD рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рдЗрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдПрдХ **рдкреНрд░рдорд╛рдгрдкрддреНрд░** рд╡рд╛рдкрд╕ рджреЗрддрд╛ рд╣реИред рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдбрд┐рд╡рд╛рдЗрд╕ AzureAD рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИ** рдФрд░ **рдкреНрд░рдорд╛рдгрдкрддреНрд░** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА (рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ TPM рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рд╣реИ рдпрд╛ рдирд╣реАрдВ)ред
```bash
dsregcmd /status
```
рдбрд┐рд╡рд╛рдЗрд╕ рд░рдЬрд┐рд╕реНрдЯреНрд░реЗрд╢рди рдХреЗ рдмрд╛рдж **Primary Refresh Token** LSASS CloudAP рдореЙрдбреНрдпреВрд▓ рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрд░реЛрдзрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред PRT рдХреЗ рд╕рд╛рде **рд╕рддреНрд░ рдХреБрдВрдЬреА рднреА рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ рдХреЗрд╡рд▓ рдбрд┐рд╡рд╛рдЗрд╕ рд╣реА рдЗрд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХреЗ** (рдкрд░рд┐рд╡рд╣рди рдХреБрдВрдЬреА рдХреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ) рдФрд░ рдпрд╣ PRT рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИред**

PRT рдХреНрдпрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="az-lateral-movement-cloud-on-prem/az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-lateral-movement-cloud-on-prem/az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### TPM - Trusted Platform Module

**TPM** рдХреБрдВрдЬреА **рдирд┐рдХрд╛рд▓рдиреЗ** рдХреЛ рд░реЛрдХрддрд╛ рд╣реИ рдПрдХ рдмрдВрдж рдбрд┐рд╡рд╛рдЗрд╕ рд╕реЗ (рдЕрдЧрд░ PIN рджреНрд╡рд╛рд░рд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реЛ) рдФрд░ OS рдкрд░рдд рд╕реЗ рдирд┐рдЬреА рд╕рд╛рдордЧреНрд░реА рдирд┐рдХрд╛рд▓рдиреЗ рд╕реЗред\
рд▓реЗрдХрд┐рди рдпрд╣ **рд╕реБрд░рдХреНрд╖рд╛ рдирд╣реАрдВ рдХрд░рддрд╛** рднреМрддрд┐рдХ рдХрдиреЗрдХреНрд╢рди рдХреА **рд╕реНрдирд┐рдлрд┐рдВрдЧ** рд╕реЗ TPM рдФрд░ CPU рдХреЗ рдмреАрдЪ рдпрд╛ **рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рд╕реЗ TPM рдореЗрдВ рдЬрдм рд╕рд┐рд╕реНрдЯрдо рдЪрд▓ рд░рд╣рд╛ рд╣реЛрддрд╛ рд╣реИ **SYSTEM** рдЕрдзрд┐рдХрд╛рд░реЛрдВ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗред

рдЕрдЧрд░ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЗрдЬ рджреЗрдЦреЗрдВрдЧреЗ рддреЛ рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ **PRT рдЪреБрд░рд╛рдирд╛** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рддрд░рд╣ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╢рд╛рдирджрд╛рд░ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **PRT рдбрд┐рд╡рд╛рдЗрд╕реЗрдЬ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрддрд╛ рд╣реИ**, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдЙрдирд╕реЗ рдЪреБрд░рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдпрд╛ рдЕрдЧрд░ рдирд╣реАрдВ рдЪреБрд░рд╛рдпрд╛ рдЧрдпрд╛ рд╣реЛ рддреЛ рдирдИ рд╕рд╛рдЗрдирд┐рдВрдЧ рдХреБрдВрдЬрд┐рдпрд╛рдБ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ):

{% content-ref url="az-lateral-movement-cloud-on-prem/pass-the-prt.md" %}
[pass-the-prt.md](az-lateral-movement-cloud-on-prem/pass-the-prt.md)
{% endcontent-ref %}

## SSO рдЯреЛрдХрди рдХреЗ рд╕рд╛рде рдбрд┐рд╡рд╛рдЗрд╕ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░рдирд╛

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд▓рд┐рдП рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ рдХрд┐ рд╡рд╣ Microsoft рдбрд┐рд╡рд╛рдЗрд╕ рд░рдЬрд┐рд╕реНрдЯреНрд░реЗрд╢рди рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░реЗ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдбрд┐рд╡рд╛рдЗрд╕ рд╕реЗ:
```bash
# Initialize SSO flow
roadrecon auth prt-init
.\ROADtoken.exe <nonce>

# Request token with PRT with PRT cookie
roadrecon auth -r 01cb2876-7ebd-4aa4-9cc9-d28bd4d359a9 --prt-cookie <cookie>
```
рдФрд░ рдлрд┐рд░ рдЖрдк рдбрд┐рд╡рд╛рдЗрд╕ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../../.gitbook/assets/image (4) (1) (1).png" alt=""><figcaption></figcaption></figure>

рдЬрд┐рд╕рд╕реЗ рдЖрдкрдХреЛ **рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдорд┐рд▓реЗрдЧрд╛ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рднрд╡рд┐рд╖реНрдп рдореЗрдВ PRTs рдорд╛рдВрдЧрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЗрд╕рд▓рд┐рдП рд╕реНрдерд╛рдпрд┐рддреНрд╡ рдмрдирд╛рдП рд░рдЦрдирд╛ рдФрд░ **MFA рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛** рдХреНрдпреЛрдВрдХрд┐ рдореВрд▓ PRT рдЯреЛрдХрди рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирдП рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ **рдкрд╣рд▓реЗ рд╕реЗ рд╣реА MFA рдЕрдиреБрдорддрд┐рдпрд╛рдВ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рдереАрдВ**ред

{% hint style="success" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдирдП рдбрд┐рд╡рд╛рдЗрд╕ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐рдпрд╛рдВ** рдЪрд╛рд╣рд┐рдП рд╣реЛрдВрдЧреАред рд╕рд╛рде рд╣реА, рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░рдиреЗ рдХрд╛ рдорддрд▓рдм рдпрд╣ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ **Intune рдореЗрдВ рдПрдирд░реЛрд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрдЧреА**ред
{% endhint %}

{% hint style="danger" %}
рдпрд╣ рд╣рдорд▓рд╛ рд╕рд┐рддрдВрдмрд░ 2021 рдореЗрдВ рдареАрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдХреНрдпреЛрдВрдХрд┐ рдЕрдм рдЖрдк SSO рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирдП рдбрд┐рд╡рд╛рдЗрд╕ рд░рдЬрд┐рд╕реНрдЯрд░ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдЕрднреА рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рд╡реИрдз рддрд░реАрдХреЗ рд╕реЗ рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо, рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдиреЗ рдкрд░ MFA рдХреЗ рд╕рд╛рде)ред рджреЗрдЦреЗрдВ: [**roadtx**](az-lateral-movement-cloud-on-prem/az-roadtx-authentication.md)ред
{% endhint %}

## рдбрд┐рд╡рд╛рдЗрд╕ рдЯрд┐рдХрдЯ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛

рдпрд╣ рд╕рдВрднрд╡ рдерд╛ рдХрд┐ **рдбрд┐рд╡рд╛рдЗрд╕ рдЯрд┐рдХрдЯ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рдП**, **рдореМрдЬреВрджрд╛ рд╡рд╛рд▓реЗ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдП**, рдФрд░ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди **PRT рдЪреБрд░рд╛рдпрд╛ рдЬрд╛рдП** (рдЗрд╕рд▓рд┐рдП TPM рд╕реЗ рдЪреБрд░рд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ [**рд╡рд╛рд░реНрддрд╛**](https://youtu.be/BduCn8cLV1A) рдХреЛ рджреЗрдЦреЗрдВред

<figure><img src="../../.gitbook/assets/image (4) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="danger" %}
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдареАрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред
{% endhint %}

## WHFB рдХреБрдВрдЬреА рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛

рд╣рдорд▓реЗ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢:

* SSO рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдбрд┐рд╡рд╛рдЗрд╕** рд╕реЗ **рдкрдВрдЬреАрдХреГрдд WHFB** рдХреБрдВрдЬреА рдХреЛ **рдУрд╡рд░рд░рд╛рдЗрдЯ** рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ
* рдпрд╣ TPM рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ **рд╣рд░рд╛ рджреЗрддрд╛ рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ рдХреБрдВрдЬреА рдирдИ рдХреБрдВрдЬреА рдХреЗ **рдирд┐рд░реНрдорд╛рдг рдХреЗ рджреМрд░рд╛рди рд╕реНрдирд┐рдл рдХреА рдЬрд╛рддреА рд╣реИ**
* рдпрд╣ рд╕реНрдерд╛рдпрд┐рддреНрд╡ рднреА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ

<figure><img src="../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдкрдиреЗ searchableDeviceKey рдкреНрд░реЙрдкрд░реНрдЯреА рдХреЛ Azure AD Graph рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ рдЯреЗрдиреЗрдВрдЯ рдореЗрдВ рдПрдХ рдбрд┐рд╡рд╛рдЗрд╕ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП (рддреБрд░рдВрдд рдкрдВрдЬреАрдХреГрдд рдпрд╛ рдПрдХ рд╡реИрдз рдбрд┐рд╡рд╛рдЗрд╕ рд╕реЗ рдЪреБрд░рд╛рдпрд╛ рдЧрдпрд╛ рдкреНрд░рдорд╛рдгрдкрддреНрд░ + рдХреБрдВрдЬреА) рдФрд░ AAD Graph рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реИрдз рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрдиред

рдлрд┐рд░, рдирдИ рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ:
```bash
roadtx genhellokey -d <device id> -k tempkey.key
```
<figure><img src="../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

рдФрд░ рдлрд┐рд░ searchableDeviceKey рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХреЛ PATCH рдХрд░реЗрдВ:

<figure><img src="../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **device code phishing** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдП рдФрд░ рдкрд┐рдЫрд▓реЗ рдЪрд░рдгреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕рдХреА рдкрд╣реБрдБрдЪ рдХреЛ **рдЪреБрд░рд╛рдпрд╛** рдЬрд╛рдПред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="az-lateral-movement-cloud-on-prem/az-phishing-primary-refresh-token-microsoft-entra.md" %}
[az-phishing-primary-refresh-token-microsoft-entra.md](az-lateral-movement-cloud-on-prem/az-phishing-primary-refresh-token-microsoft-entra.md)
{% endcontent-ref %}

<figure><img src="../../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

## рд╕рдВрджрд░реНрдн

* [https://youtu.be/BduCn8cLV1A](https://youtu.be/BduCn8cLV1A)
* [https://www.youtube.com/watch?v=x609c-MUZ\_g](https://www.youtube.com/watch?v=x609c-MUZ\_g)
* [https://www.youtube.com/watch?v=AFay\_58QubY](https://www.youtube.com/watch?v=AFay\_58QubY)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ **рдореБрдЭреЗ рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
