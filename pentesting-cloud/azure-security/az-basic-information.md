# Az - 基本情報

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong>を使って、ゼロからヒーローまでAWSハッキングを学びましょう！</summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝**したい場合や、**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションを見る
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)をフォローする
- **ハッキングトリックを共有するために、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する

</details>

## 組織階層

<figure><img src="../../.gitbook/assets/image (62).png" alt=""><figcaption></figcaption></figure>

### 管理グループ

組織に**多くのAzureサブスクリプション**がある場合、それらの**サブスクリプションのアクセス、ポリシー、コンプライアンスを効率的に管理**する方法が必要になる場合があります。**管理グループ**は、**サブスクリプションよりも上位のガバナンススコープ**を提供します。

1つのディレクトリで**10,000の管理グループ**をサポートし、管理グループツリーは**最大6階層の深さ**をサポートできます。

<figure><img src="../../.gitbook/assets/image (76).png" alt=""><figcaption></figcaption></figure>

[ドキュメントから](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory)：各ディレクトリには、**ルート管理グループと呼ばれる単一のトップレベル管理グループ**が与えられます。ルート管理グループは、**すべての管理グループとサブスクリプションがそれに折りたたまれる**ように階層構造に組み込まれています。このルート管理グループには、**グローバルポリシーとAzureロールの割り当て**がディレクトリレベルで適用できます。Azure ADの**グローバル管理者は、最初にこのルートグループのユーザーアクセス管理者ロールに昇格する必要があります**。アクセスを昇格させた後、管理者は他のディレクトリユーザーやグループにAzureロールを割り当てて階層を管理できます。管理者として、**自分のアカウントをルートの所有者として割り当てる**ことができます。

ルート管理グループは、他の管理グループとは異なり、**移動や削除はできません**。

管理グループを使用すると、どのような種類のサブスクリプションがあっても、スケールでエンタープライズグレードの管理が可能です。ただし、**単一の管理グループ内のすべてのサブスクリプション**は、**同じAzure Active Directory（Azure AD）テナントを信頼する必要があります**。

<figure><img src="../../.gitbook/assets/image (1) (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

### Azureサブスクリプション

Azureでは、サブスクリプションは、ビジネスや技術の**リソースをプロビジョニング**するための**論理コンテナ**として機能します。このコンテナは、仮想マシン（VM）、データベースなどのリソースの詳細を維持します。たとえば、VMのようなAzureリソースの作成時には、それに関連する**サブスクリプションが指定**されます。この構造により、ロールベースのアクセス制御メカニズムを利用してアクセス権を委任することが容易になります。

### リソースグループ

[ドキュメントから：](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) リソースグループは、Azureソリューションの**関連するリソースを保持するコンテナ**です。リソースグループには、ソリューションのすべてのリソース、または**グループとして管理したいリソースのみ**を含めることができます。通常、**ライフサイクルを共有するリソース**を同じリソースグループに追加して、グループとして簡単に展開、更新、削除できるようにします。

すべての**リソース**は**リソースグループ内**にあり、1つのグループにのみ属することができ、リソースグループが削除されると、それに含まれるすべてのリソースも削除されます。

### 管理単位

[ドキュメントから：](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) 管理単位を使用すると、組織を**任意の単位に細分化**し、その単位の**メンバーだけを管理できる特定の管理者を割り当てる**ことができます。たとえば、大学の各学部の管理者に権限を委任して、彼らがエンジニアリング学部だけでアクセスを制御し、ユーザーを管理し、ポリシーを設定できるようにするために、管理単位を使用できます。

**ユーザー**、**グループ**、**デバイス**のみが**管理単位**の**メンバー**になります。

したがって、**管理単位**にはいくつかの**メンバー**が含まれ、他の**主体**はその管理単位の**メンバーを管理するために使用できる権限が割り当てられます**。

## Azure vs Azure AD vs Azure AD ドメインサービス

**Azure AD**は、**Azure**の中にあるサービスです。**Azure**はMicrosoftの**クラウドプラットフォーム**であり、**Azure AD**はAzureのエンタープライズ**アイデンティティサービス**です。\
さらに、**Azure ADはWindows Active Directoryとは異なり**、異なる方法で機能するアイデンティティサービスです。Windows Active Directory環境で**ドメインコントローラーをAzureで実行**したい場合は、**Azure ADドメインサービス**を使用する必要があります。

## 主体

Azureは異なるタイプの主体をサポートしています：

- **ユーザー**：資格情報を持つ**通常の人**
- **グループ**：一緒に管理される**主体のグループ**。グループに付与された**権限**は、その**メンバー**に**継承**されます。
- **サービスプリンシパル/エンタープライズアプリケーション**：**アプリケーション**、ホストされるサービス、および自動化ツールでAzureリソースにアクセスするために作成された**アイデンティティ**です。このアクセスは、サービスプリンシパルに割り当てられたロールによって**制限され**、**どのリソースにアクセスできるか**およびどのレベルでアクセスできるかを制御します。セキュリティ上の理由から、**自動化ツールでサービスプリンシパルを使用**することが常に推奨されます。

**サービスプリンシパル**を作成する際には、**パスワード認証**または**証明書認証**のいずれかを選択できます。

- パスワード認証を選択した場合（デフォルト）、**生成されたパスワードを保存**しておかないと、後でアクセスできなくなります。
- 証明書認証を選択した場合は、**アプリケーションがプライベートキーにアクセスできるように**してください。
- **管理されたアイデンティティ（メタデータ認証情報）**：Azure Active Directoryの管理されたアイデンティティは、アプリケーションの**アイデンティティを自動的に管理する**ためのソリューションを提供します。これらのアイデンティティは、Azure Active Directory（Azure AD）認証と互換性のあるリソースに接続するためにアプリケーションによって使用されます。管理されたアイデンティティを使用することで、アプリケーションはAzure ADトークンを**安全に保護**しながら、直接資格情報を処理する必要がなくなります。
  - **システム割り当て**：一部のAzureサービスでは、**サービスインスタンスに直接管理されたアイデンティティを有効にできる**場合があります。システム割り当ての管理されたアイデンティティを有効にすると、Azure ADにアイデンティティが作成されます。このアイデンティティは、そのサービスインスタンスの**ライフサイクルに結び付けられ**ます。**リソースが削除**されると、Azureは**自動的に**その**アイデンティティを削除**します。設計上、このアイデンティティを使用してAzureリソースからAzure ADにトークンを要求できるのはそのAzureリソースだけです。
  - **ユーザー割り当て**：スタンドアロンのAzureリソースとして管理されたアイデンティティを作成し、Azureサービスの1つまたは**複数のインスタンス**に割り当てることができます。ユーザー割り当てされた管理されたアイデンティティでは、**そのアイデンティティはそれを使用するリソースから別々に管理**されます。

## ロールと権限

**ロール**は**主体**に**スコープ**で**割り当てられます**：`主体 -[HAS ROLE]->(スコープ)`

**グループ**に割り当てられた**ロール**は、グループの**すべてのメンバー**に**継承**されます。

割り当てられたロールがどのスコープに割り当てられたかによって、その**ロール**はスコープコンテナ内の**他のリソース**に**継承**される場合があります。たとえば、ユーザーAが**サブスクリプションにロールを持っている**場合、その**ユーザーはサブスクリプション内のすべてのリソースグループ**と**リソース**にその**ロールを持つ**ことになります。

### **クラシックロール**

| **所有者**                     | <ul><li>すべてのリソースへの完全アクセス</li><li>他のユーザーのアクセスを管理できる</li></ul> | すべてのリソースタイプ |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **寄稿者**               | <ul><li>すべてのリソースへの完全アクセス</li><li>アクセスの管理はできない</li></ul>              | すべてのリソースタイプ |
| **リーダー**                    | • すべてのリソースを表示                                                                     | すべてのリソースタイプ |
| **ユーザーアクセス管理者** | <ul><li>すべてのリソースを表示</li><li>他のユーザーのアクセスを管理できる</li></ul>           | すべてのリソースタイプ |

### 組み込みロール

[ドキュメントから：](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azureロールベースのアクセス制御（Azure RBAC）](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview)には、**ユーザー、グループ、サービスプリンシパル、管理されたアイデンティティ**に**割り当てることができるいくつかのAzure**の**組み込みロール**があります。ロール割り当ては、**Azureリソースへのアクセスを制御**する方法です。組み込みのロールが組織の特定のニーズを満たさない場合は、独自の[**Azureカスタムロール**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**を作成**することができます。

**組み込み**のロールは、それらが**意図されて
