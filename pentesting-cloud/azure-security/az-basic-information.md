# Az - 基本情報

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>

## 組織階層

### 管理グループ

組織が**多くのAzureサブスクリプション**を持っている場合、これらの**サブスクリプション**に対する**アクセス管理**、ポリシー、コンプライアンスを効率的に**管理する**方法が必要になるかもしれません。**管理グループ**は、サブスクリプションより上の**ガバナンススコープ**を提供します。

単一のディレクトリで**10,000の管理グループ**をサポートでき、管理グループツリーは**最大6レベルの深さ**をサポートできることに注意してください。

各ディレクトリには、ルートと呼ばれる単一の**トップレベル管理グループ**が与えられます。ルート管理グループは、**すべての管理グループとサブスクリプションがそれに折りたたまれる**ように階層に組み込まれています。このルート管理グループにより、**グローバルポリシーとAzureロールの割り当て**がディレクトリレベルで適用されます。[Azure AD **グローバル管理者**は、このルートグループの**ユーザーアクセス管理者ロール**に自分を昇格させる必要があります](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin)。アクセスを昇格した後、管理者は**階層を管理するために他のディレクトリユーザーやグループに任意のAzureロールを割り当てる**ことができます。管理者として、**ルート**管理グループの**所有者として自分のアカウントを割り当てる**ことができます。

ルート管理グループは、他の管理グループとは異なり、**移動または削除することはできません**。

管理グループは、どのようなタイプのサブスクリプションを持っているかに関わらず、エンタープライズグレードの管理を大規模に提供します。ただし、**単一の管理グループ内のすべてのサブスクリプション**は、**同じAzure Active Directory (Azure AD)テナント**を信頼する必要があります。

### Azureサブスクリプション

Azureサブスクリプションは、Azureで関連するビジネスまたは技術**リソースをプロビジョニング**するために使用される**論理コンテナ**です。仮想マシン（VM）、データベースなど、すべてのリソースの**詳細を保持**します。VMのようなAzureリソースを作成するとき、それが属する**サブスクリプションを識別**します。これにより、ロールベースのアクセス制御メカニズムを通じてアクセスを委任することができます。

### リソースグループ

リソースグループは、Azureソリューションの**関連リソースを保持**する**コンテナ**です。リソースグループには、ソリューションのすべてのリソース、またはグループとして管理したい**リソースのみ**を含めることができます。一般的に、**同じライフサイクル**を共有する**リソース**を同じリソースグループに追加して、グループとして簡単にデプロイ、更新、削除できるようにします。

すべての**リソース**は**リソースグループ内に存在**しなければならず、グループにのみ属することができ、リソースグループが削除されると、その中のすべてのリソースも削除されます。

### 管理単位

管理単位を使用すると、組織を**任意の単位**に**細分化**し、その単位の**メンバーのみを管理**できる**特定の管理者を割り当てる**ことができます。たとえば、大学で各学校の管理者に権限を委任して、エンジニアリング学部でのみアクセスを制御し、ユーザーを管理し、ポリシーを設定することができます。

**ユーザー**、**グループ**、および**デバイス**のみが**管理単位のメンバー**になることができます。

したがって、**管理単位**はいくつかの**メンバーを含み**、他の**プリンシパル**にはその管理単位を**管理するために使用できる権限が割り当てられます**。

## Azure vs Azure AD vs Azure ADドメインサービス

**Azure AD**は**Azure内**のサービスであることに注意してください。**Azure**はMicrosoftの**クラウドプラットフォーム**であり、**Azure AD**はAzure内のエンタープライズ**アイデンティティサービス**です。\
さらに、**Azure ADはWindows Active Directoryのようではありません**。それはWindows Active Directory環境で**ドメインコントローラーをAzureで実行**する場合は**Azure ADドメインサービス**を使用する必要があります。

## プリンシパル

Azureは異なるタイプのプリンシパルをサポートしています:

* **ユーザー**: アクセスするための資格情報を持つ通常の**人**。
* **グループ**: 一緒に管理される**プリンシパルのグループ**。グループに付与された**権限**は、その**メンバー**に**継承**されます。
*   **サービスプリンシパル/エンタープライズアプリケーション**: これは、アプリケーション、ホストされたサービス、および自動化ツールがAzureリソースにアクセスするために作成された**アイデンティティ**です。このアクセスは、サービスプリンシパルに割り当てられたロールによって**制限され**、**どのリソースにアクセスできるか**、どのレベルでアクセスできるかを制御できます。セキュリティ上の理由から、ユーザーのアイデンティティでログインすることを許可するよりも、自動化ツールでサービスプリンシパルを**使用することを常に推奨**します。

**サービスプリンシパル**を作成するとき、**パスワード認証**または**証明書認証**のいずれかを選択できます。

* **パスワード**認証を選択する場合（デフォルト）、**生成されたパスワードを保存**してください。再度アクセスすることはできません。
* 証明書認証を選択する場合、**アプリケーションが秘密鍵にアクセスできることを確認**してください。
* **マネージドアイデンティティ（メタデータクレデンシャル）**: マネージドアイデンティティは、アプリケーションがAzure Active Directory（**Azure AD**）認証をサポートする**リソースに接続**するために使用する、Azure Active Directoryで**自動的に管理されるアイデンティティ**を提供します。アプリケーションは、マネージドアイデンティティを使用して、**クレデンシャルを管理することなくAzure ADトークンを取得**できます。\
マネージドアイデンティティには2つのタイプがあります:
* **システム割り当て**。一部のAzureサービスでは、サービスインスタンスに直接マネージドアイデンティティを**有効にすることができます**。システム割り当てマネージドアイデンティティを有効にすると、Azure ADにアイデンティティが作成されます。アイデンティティはそのサービスインスタンスの**ライフサイクルに結びつけられ**ます。**リソースが削除される**と、Azureは自動的にその**アイデンティティを削除**します。設計上、そのAzureリソースのみがこのアイデンティティを使用してAzure ADからトークンを要求できます。
* **ユーザー割り当て**。また、マネージドアイデンティティをスタンドアロンのAzureリソースとして作成することもできます。[ユーザー割り当てマネージドアイデンティティを作成](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal)し、1つ以上のAzureサービスインスタンス（複数のリソース）に割り当てることができます。ユーザー割り当てマネージドアイデンティティの場合、**アイデンティティはそれを使用するリソースから別に管理されます**。

## ロールと権限

**ロール**は**スコープ**に**プリンシパル**に**割り当てられます**: `principal -[HAS ROLE]->(scope)`

**グループ**に割り当てられた**ロール**は、グループのすべての**メンバー**に**継承**されます。

ロールが割り当てられたスコープに応じて、**ロール**はスコープコンテナ内の**他のリソース**に**継承**される可能性があります。たとえば、ユーザーAが**サブスクリプションにロール**を持っている場合、サブスクリプション内のすべてのリソースグループとリソースグループ内の**すべてのリソース**にその**ロールを持つ**ことになります。

### **クラシックロール**

### ビルトインロール

[Azureロールベースのアクセス制御（Azure RBAC）](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview)には、**ユーザー、グループ、サービスプリンシパル、およびマネージドアイデンティティ**に**割り当てる**ことができるいくつかのAzure **ビルトインロール**があります。ロールの割り当ては、**Azureリソースへのアクセスを制御する方法**です。ビルトインロールが組織の特定のニーズを満たさない場合は、独自の[**Azureカスタムロール**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**を作成**できます。

**ビルトイン**ロールは、それらが**意図されたリソース**にのみ適用されます。たとえば、**コンピュート**リソースに対する次の2つの例を確認してください:

このロールは**ロジックコンテナ**（管理グループ、サブスクリプション、リソースグループなど）にも割り当てることができ、影響を受けるプリンシパルはそれらのコンテナ内のリソース**に対してそれらを持つことになります**。

* [**すべてのAzureビルトインロールのリスト**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)はこちら。
* [**すべてのAzure ADビルトインロールのリスト**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference)はこちら。

### カスタムロール

Azureでは、ユーザーが必要とする権限で[**カスタムロール**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)を作成することもできます。

### 権限拒否

### グロ
