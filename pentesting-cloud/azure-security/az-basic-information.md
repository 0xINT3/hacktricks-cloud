# Az - Basiese Inligting

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Organisasie Hi√´rargie

<figure><img src="../../.gitbook/assets/image (62).png" alt=""><figcaption></figcaption></figure>

### Bestuursgroepe

As jou organisasie **baie Azure intekeninge** het, mag jy 'n manier benodig om effektief **toegang**, beleid en nakoming vir daardie **intekeninge te bestuur**. **Bestuursgroepe** bied 'n **bestuursomvang bo intekeninge**.

Let daarop dat 'n enkele gids **10,000 bestuursgroepe** kan ondersteun en 'n bestuursgroepboom **tot ses vlakke diep** kan ondersteun.

<figure><img src="../../.gitbook/assets/image (76).png" alt=""><figcaption></figcaption></figure>

[Volgens die dokumentasie](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory): Elke gids word 'n enkele **topvlak bestuursgroep genoem, die wortel** bestuursgroep. Die wortel bestuursgroep is in die hi√´rargie ingebou om **alle bestuursgroepe en intekeninge na hom toe te vou**. Hierdie wortel bestuursgroep maak dit moontlik om **globale beleide en Azure roltoewysings** op die gidssvlak toe te pas. Die [Azure AD **Global Administrator** moet hulself verhoog](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin) na die **User Access Administrator rol van hierdie wortelgroep** aanvanklik. Nadat toegang verhoog is, kan die administrateur **enige Azure rol aan ander gidsgbruikers of -groepe toewys om die hi√´rargie te bestuur**. As administrateur kan jy **jou eie rekening as eienaar van die wortel** bestuursgroep toewys.

Die wortel bestuursgroep **kan nie geskuif of uitgevee word** nie, in teenstelling met ander bestuursgroepe.

Bestuursgroepe bied jou bestuursvlak van ondernemingsgehalte op skaal, ongeag die tipe intekeninge wat jy mag h√™. Nietemin moet **alle intekeninge binne 'n enkele bestuursgroep** die **gelyke Azure Active Directory (Azure AD) huurder** vertrou.

<figure><img src="../../.gitbook/assets/image (1) (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

### Azure Intekeninge

In Azure dien 'n intekening as 'n **logiese houer** vir die doel van **voorsiening** van sake- of tegniese **hulpbronne**. Hierdie houer behou die **besonderhede van hulpbronne** soos virtuele masjiene (VM's), databasisse, en ander. By die skep van 'n Azure-hulpbron, soos 'n VM, word die **intekening wat daarmee geassosieer is**, gespesifiseer. Hierdie struktuur fasiliteer die delegasie van toegang deur gebruik te maak van rolgebaseerde toegangsbeheermeganismes.

### Hulpbrongroepe

[Volgens die dokumentasie:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) 'n Hulpbrongroep is 'n **houer** wat **verwante hulpbronne** vir 'n Azure-oplossing bevat. Die hulpbrongroep kan al die hulpbronne vir die oplossing insluit, of slegs di√© **hulpbronne wat jy as 'n groep wil bestuur**. Voeg gewoonlik **hulpbronne** wat die **lewensiklus deel**, by dieselfde hulpbrongroep sodat jy hulle maklik as 'n groep kan implementeer, opdateer en uitvee.

Alle **hulpbronne** moet **binne 'n hulpbrongroep** wees en kan slegs aan 'n groep behoort, en as 'n hulpbrongroep uitgevee word, word al die hulpbronne daarin ook uitgevee.

### Administratiewe Eenhede

[Volgens die dokumentasie:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Administratiewe eenhede laat jou toe om jou organisasie in **enige eenheid** wat jy wil, te **onderverdeel**, en dan **spesifieke administrateurs toe te ken** wat slegs die lede van daardie eenheid kan **bestuur**. Byvoorbeeld, jy kan administratiewe eenhede gebruik om toestemmings aan administrateurs van elke skool by 'n groot universiteit te delegeer, sodat hulle slegs toegang, gebruikersbestuur en beleide in die Skool van Ingenieurswese kan beheer.

Slegs **gebruikers**, **groepe** en **toestelle** kan **lede** van 'n **administratiewe eenheid** wees.

Daarom sal 'n **administratiewe eenheid** sommige **lede bevat** en ander **beginsels sal toestemmings oor daardie** administratiewe **eenheid** toegewys word wat hulle kan gebruik om die lede van die administratiewe eenheid te **bestuur**.

## Azure vs Azure AD vs Azure AD Domain Services

Dit is belangrik om te let dat **Azure AD** 'n diens is **binne** **Azure**. **Azure** is Microsoft se **wolkmeganisme**, terwyl **Azure AD** 'n onderneming **identiteitsdiens** in Azure is.\
Verder is **Azure AD nie soos Windows Active Directory** nie, dit is 'n identiteitsdiens wat op 'n heeltemal ander manier werk. As jy 'n **Domeinbeheerder in Azure** vir jou Windows Active Directory-omgewing wil gebruik, moet jy **Azure AD Domain Services** gebruik.

## Beginsels

Azure ondersteun verskillende tipes beginsels:

* **Gebruiker**: 'n Gewone **persoon** met geloofsbriewe om toegang te verkry.
* **Groep**: 'n **groep beginsels** wat saam bestuur word. **Toestemmings** wat aan groepe verleen word, word deur sy **lede ge√´rf**.
*   **Diensbeginsel/Ondernemingsprogramme**: Dit is 'n **identiteit** wat geskep is vir **gebruik** met **toepassings**, gehoste dienste en outomatiese gereedskap om toegang tot Azure-hulpbronne te verkry. Hierdie toegang is **beperk deur die rolle wat toegewys is** aan die diensbeginsel, wat jou beheer gee oor **watter hulpbronne toeganklik is** en op watter vlak. Vir veiligheidsredes word dit altyd aanbeveel om **diensbeginsels met outomatiese gereedskap te gebruik** eerder as om hulle toe te laat om met 'n gebruikersident
## Rolle & Toestemmings

**Rolle** word **toegewys** aan **prinsipale** op 'n **omvang**: `prinsipaal -[HET ROL]->(omvang)`

**Rolle** wat aan **groepe** toegewys word, word **ge√´rf** deur al die **lede** van die groep.

Afhanklik van die omvang waarop die rol toegewys is, kan die **rol** ge√´rf word na **ander hulpbronne** binne die omvanghouer. Byvoorbeeld, as 'n gebruiker A 'n **rol op die intekening** het, sal hy daardie **rol op al die hulpbrongroepe** binne die intekening h√™ en op **alle hulpbronne** binne die hulpbrongroep.

### **Klassieke Rolle**

| **Eienaar**                   | <ul><li>Volle toegang tot alle hulpbronne</li><li>Kan toegang vir ander gebruikers bestuur</li></ul> | Alle tipes hulpbronne |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Bydraer**                  | <ul><li>Volle toegang tot alle hulpbronne</li><li>Kan nie toegang bestuur nie</li></ul>              | Alle tipes hulpbronne |
| **Leser**                    | ‚Ä¢ Sien alle hulpbronne                                                                     | Alle tipes hulpbronne |
| **Gebruikerstoegangsadministrateur** | <ul><li>Sien alle hulpbronne</li><li>Kan toegang vir ander gebruikers bestuur</li></ul>           | Alle tipes hulpbronne |

### Ingeboude rolle

[Van die dokumentasie: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure rolgebaseerde toegangsbeheer (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) het verskeie Azure **ingeboude rolle** wat jy kan **toewys** aan **gebruikers, groepe, diensprinsipale en bestuurde identiteite**. Roltoewysings is die manier waarop jy **toegang tot Azure-hulpbronne** beheer. As die ingeboude rolle nie aan die spesifieke behoeftes van jou organisasie voldoen nie, kan jy jou eie [**Azure aangepaste rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**skep**.

**Ingeboude** rolle is slegs van toepassing op die **hulpbronne** waarvoor hulle bedoel is, byvoorbeeld kyk na hierdie 2 voorbeelde van **Ingeboude rolle oor Rekenaar** hulpbronne:

| [Skyf Rugleser](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Verskaf toestemming om rugleser te maak om skyf rug te maak.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Gebruikerstoegang tot Virtuele Masjien](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Sien Virtuele Masjiene in die paneel en teken in as 'n gewone gebruiker. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Hierdie rolle kan ook toegewys word aan logika-houers (soos bestuursgroepe, intekeninge en hulpbrongroepe) en die betrokke prinsipale sal hulle h√™ **oor die hulpbronne binne daardie houers**.

* Vind hier 'n lys met [**alle Azure ingeboude rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* Vind hier 'n lys met [**alle Azure AD ingeboude rolle**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Aangepaste Rolle

Azure maak dit ook moontlik om [**aangepaste rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) te skep met die toestemmings wat die gebruiker nodig het.

### Toestemming Geweier

* Om 'n **prinsipaal toegang tot 'n hulpbron te gee**, moet hy 'n eksplisiete rol kry wat aan hom toegestaan ‚Äã‚Äãword (hoe ook al) **deur hom daardie toestemming te gee**.
* 'n Eksplisiete **ontkenning van roltoewysing het voorrang** bo die rol wat die toestemming gee.

<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

### Globale Administrateur

Gebruikers met die rol van Globale Administrateur het die vermo√´ om '**op te gradeer' na die Gebruikerstoegangsadministrateur Azure-rol tot die hoofbestuursgroep**. Dit beteken dat 'n Globale Administrateur in staat sal wees om toegang te bestuur **tot alle Azure-intekeninge en bestuursgroepe**.\
Hierdie opgradering kan gedoen word aan die einde van die bladsy: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (41).png" alt=""><figcaption></figcaption></figure>

### Azure Beleide

Azure beleide is 'n stel **re√´ls en regulasies in Microsoft Azure**, 'n wolkrekenaardiens, wat help om organisatoriese standaarde te bestuur en af te dwing en om nakoming op skaal te assesseer. Hierdie beleide dwing verskillende re√´ls af oor jou **Azure-hulpbronne**, om te verseker dat daardie hulpbronne voldoen aan korporatiewe standaarde en diensvlak-ooreenkomste.

Azure beleide is van kritieke belang vir wolkbestuur en -sekuriteit, en help om te verseker dat hulpbronne behoorlik en doeltreffend gebruik word, en dat hulle voldoen aan eksterne regulasies en interne beleide.\
Enkele voorbeelde:

1. **Verseker Nakoming met Spesifieke Azure Streke**: Hierdie beleid verseker dat alle hulpbronne in spesifieke Azure streke ge√Ømplementeer word. Byvoorbeeld, 'n maatskappy wil verseker dat al sy data in Europa gestoor word vir GDPR-nakoming.
2. **Handhawing van Naamgewingsstandaarde**: Beleide kan naamgewingskonvensies vir Azure-hulpbronne afdwing. Dit help om hulpbronne te organiseer en maklik te identifiseer op grond van hul name, wat nuttig is in groot omgewings.
3. **Beperking van Sekere Tipes Hulpbronne**: Hierdie beleid kan die skepping van sekere tipes hulpbronne beperk. Byvoorbeeld, 'n beleid kan ingestel word om die skepping van duur hulpbrontipes, soos sekere VM-groottes, te voorkom om koste te beheer.
4. **Handhawing van Merkbeleide**: Merke is sleutel-waardepare wat geassosieer word met Azure-hulpbronne wat gebruik word vir hulpbronbestuur. Beleide kan afdwing dat sekere merke teenwoordig moet wees, of spesifieke waardes moet h√™, vir alle hulpbronne. Dit is nuttig vir koste-opsporing, eienaarskap of kategorisering van hulpbronne.
5. **Beperking van Openbare Toegang tot Hulpbronne**: Beleide kan afdwing dat sekere hulpbronne, soos bergingsrekeninge of databasisse, nie openbare eindpunte het nie, om te verseker dat hulle slegs toeganklik is binne die organisasie se netwerk.
6. **Outomatiese Toepassing van Sekuriteitsinstellings**: Beleide kan gebruik word om outomatiese sekuriteitsinstellings op hulpbronne toe te pas, soos die toepassing van 'n spesifieke netwerksekuriteitsgroep op alle VM's of die versekering dat alle bergingsrekeninge kriptering gebruik.

Let daarop dat Azure beleide aan enige vlak van die Azure-hierargie geheg kan word, maar hulle word **gewoonlik gebruik in die hoofbestuursgroep** of in ander bestuursgroepe.

### Toestemmingsomvang

In Azure **kan toestemmings aan enige deel van die hi√´rargie toegewys word**. Dit sluit bestuursgroepe, intekeninge, hulpbrongroepe en individuele hulpbronne in. Toestemmings word ge√´rf deur die betrokke **hulpbronne** van die entiteit waarop hulle toegewys is.

Hierdie hi√´rargiese struktuur maak doeltreffende
### Standaard Gebruikersmachtigingen

'n Basiese gebruiker sal sommige **standaardmachtigingen** h√™ om sekere dele van AzureAD op te som:

* Lees alle gebruikers, Groepe, Toepassings, Toestelle, Rolle, Intekeninge, en hul openbare eienskappe
* Nodig Gaste uit (_kan afgeskakel word_)
* Skep Sekuriteitsgroepe
* Lees nie-versteekte Groepslidmaatskappe
* Voeg gaste by aan Eie groepe
* Skep nuwe toepassing (_kan afgeskakel word_)
* Voeg tot 50 toestelle by aan Azure (_kan afgeskakel word_)

Jy kan die volledige [lys van **standaardmachtigingen van gebruikers** in die dokumentasie](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions) sien. Verder kan jy in daardie lys ook die **standaardmachtigingslys van gaste** sien.

{% hint style="info" %}
Onthou dat die gebruiker 'n uitdruklike toekenning van die mag nodig het om Azure-hulpbronne op te som.
{% endhint %}

### Bevoorregte Identiteitsbestuur (PIM)

Bevoorregte Identiteitsbestuur (PIM) in Azure is 'n instrument wat **voorregte toegang bestuur, beheer en monitor** in Azure Active Directory en Azure. Dit verbeter sekuriteit deur **net-in-tyd en tydbeperkte bevoorregte toegang** te bied, **goedkeuringsvloeke af te dwing en addisionele verifikasie te vereis**. Hierdie benadering verminder die risiko van ongemagtigde toegang deur te verseker dat verhoogde magte slegs toegeken word wanneer dit nodig is en vir 'n spesifieke tydsduur.

## Verifikasietokens

Daar is **drie tipes tokens** wat in OIDC gebruik word:

* [**Toegangstokens**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** Die kli√´nt bied hierdie token aan die hulpbronbediener aan om **hulpbronne te ontsluit**. Dit kan slegs gebruik word vir 'n spesifieke kombinasie van gebruiker, kli√´nt en hulpbron en **kan nie herroep word nie** totdat dit verval - wat standaard 1 uur is. Opsporing is laag met hierdie tipe token.
* **ID-tokens**: Die kli√´nt ontvang hierdie **token van die magtigingbediener**. Dit bevat basiese inligting oor die gebruiker. Dit is **gekoppel aan 'n spesifieke kombinasie van gebruiker en kli√´nt**.
* **Vernuwings-tokens**: Verskaf aan die kli√´nt saam met toegangstoken. Dit word gebruik om **nuwe toegangs- en ID-tokens te verkry**. Dit is gekoppel aan 'n spesifieke kombinasie van gebruiker en kli√´nt en kan herroep word. Standaard verval vernuwings-tokens na **90 dae** van onaktiwiteit en het **geen vervaltyd vir aktiewe tokens nie**.

{% hint style="warning" %}
Inligting vir **voorwaardelike toegang** word **gestoor** binne die **JWT**. As jy dus die **token vanaf 'n toegelate IP-adres aanvra**, sal daardie **IP-adres** in die token **gestoor** word en kan jy daardie token gebruik vanaf 'n **nie-toegelate IP-adres om die hulpbronne te ontsluit**.
{% endhint %}

Kyk na die volgende bladsy om verskillende maniere te leer om **toegangstokens aan te vra** en daarmee in te teken:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

Die mees algemene API-eindpunte is:

* **Azure-hulpbronbestuurder** (ARM): management.azure.com
* **Microsoft Graph**: graph.microsoft.com (Azure AD Graph wat verouderd is, is graph.windows.net)

## Verwysings

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks-uitrusting**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
