# Az - Temel Bilgiler

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzdaki özel [**NFT'leri**](https://opensea.io/collection/the-peass-family) keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı takip edin.
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR göndererek paylaşın.

</details>

## Kuruluş Hiyerarşisi

<figure><img src="../../.gitbook/assets/image (62).png" alt=""><figcaption></figcaption></figure>

### Yönetim Grupları

Eğer kuruluşunuzda **çok sayıda Azure aboneliği** varsa, bu abonelikler için **erişimi**, **politikaları** ve **uyumluluğu** etkin bir şekilde yönetmek için bir yol gerekebilir. **Yönetim grupları**, **aboneliklerin üzerinde bir yönetim kapsamı** sağlar.

Unutmayın ki tek bir dizinde **10.000 yönetim grubu** desteklenebilir ve bir yönetim grubu ağacı **altı seviyeye kadar derinlik** destekleyebilir.

<figure><img src="../../.gitbook/assets/image (76).png" alt=""><figcaption></figcaption></figure>

[Dokümantasyondan](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory): Her dizine, **kök** yönetim grubu adı verilen bir **üst düzey yönetim grubu** verilir. Kök yönetim grubu, **tüm yönetim gruplarını ve abonelikleri içerecek şekilde hiyerarşiye dahil edilmiştir**. Bu kök yönetim grubu, **genel politikaları ve Azure rol atamalarını** dizin düzeyinde uygulamak için kullanılır. [Azure AD **Global Yöneticisi**](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin), başlangıçta bu kök grubun **Kullanıcı Erişim Yöneticisi rolüne yükseltilmelidir**. Erişimi yükselttikten sonra yönetici, hiyerarşiyi yönetmek için diğer dizin kullanıcılarına veya gruplarına **herhangi bir Azure rolü atayabilir**. Yönetici olarak, kök yönetimin grubunun sahibi olarak **kendi hesabınızı atayabilirsiniz**.

Kök yönetim grubu, diğer yönetim grupları gibi **taşınabilir veya silinemez**.

Yönetim grupları, sahip olabileceğiniz abonelik türüne bakılmaksızın ölçekte kurumsal düzeyde yönetim sağlar. Ancak, **tek bir yönetim grubu içindeki tüm aboneliklerin**, **aynı Azure Active Directory (Azure AD) kiracına güvenmesi** gerekmektedir.

<figure><img src="../../.gitbook/assets/image (1) (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

### Azure Abonelikleri

Azure'da bir abonelik, iş veya teknik kaynakların **provisioning** amacıyla bir **mantıksal konteyner** olarak hizmet eder. Bu konteyner, sanal makineler (VM'ler), veritabanları gibi kaynakların ayrıntılarını korur. Bir Azure kaynağı, örneğin bir VM oluşturulduğunda, **onunla ilişkilendirilen abonelik** belirtilir. Bu yapı, rol tabanlı erişim kontrol mekanizmalarını kullanarak erişimin yetkilendirilmesini kolaylaştırır.

### Kaynak Grupları

[Dokümantasyondan:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Bir kaynak grubu, bir Azure çözümü için **ilgili kaynakları** içeren bir **konteyner**dir. Kaynak grubu, çözüm için tüm kaynakları veya yalnızca **bir grup olarak yönetmek istediğiniz kaynakları** içerebilir. Genellikle, **aynı yaşam döngüsünü paylaşan kaynakları** aynı kaynak grubuna eklersiniz, böylece bunları bir grup olarak kolayca dağıtabilir, güncelleyebilir ve silebilirsiniz.

Tüm **kaynaklar**, bir **kaynak grubu içinde** olmalıdır ve yalnızca bir gruba ait olabilir ve bir kaynak grubu silindiğinde, içindeki tüm kaynaklar da silinir.

### Yönetim Birimleri

[Dokümantasyondan:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Yönetim birimleri, kuruluşunuzu **istediğiniz herhangi bir birime** bölmek ve ardından yalnızca o birimin üyelerini **yönetebilecek belirli yöneticileri atamak** için kullanılır. Örneğin, büyük bir üniversitenin her bir okulunun yöneticilerine izinleri devretmek, böylece sadece Mühendislik Fakültesi'nde erişimi kontrol edebilmelerini, kullanıcıları yönetebilmelerini ve politikaları sadece Mühendislik Fakültesi'nde ayarlayabilmelerini sağlamak için yönetim birimlerini kullanabilirsiniz.

Yalnızca **kullanıcılar**, **gruplar** ve **cihazlar** bir **yönetim biriminin üyesi** olabilir.

Bu nedenle, bir **Yönetim birimi**, bazı **üyeleri içerecek** ve diğer **başlıkların** bu yönetim birimini **yönetmek için atanan izinlere** sahip olacaklarını kullanabilecekleri bir **yönetim birimi** olacaktır.

## Azure vs Azure AD vs Azure AD Domain Services

Önemli bir nokta olarak, **Azure AD**, **Azure**'ın **içindeki bir hizmettir**. **Azure**, Microsoft'un **bulut platformu** iken, **Azure AD**, Azure'da bulunan kurumsal **kimlik hizmetidir**.\
Ayrıca, **Azure AD, Windows Active Directory gibi değildir**, tamamen farklı bir şekilde çalışan bir kimlik hizmetidir. Windows Active Directory ortamınız için bir **Etki Alanı Denetleyicisi**'ni Azure'da çalıştırmak istiyorsanız, **Azure AD Domain Services**'i kullanmanız gerekmektedir.

## Başlıklar

Azure, farklı türde başlıkları destekler:

* **Kullanıcı**: Erişim için kimlik bilgilerine sahip olan bir **kişi**.
* **Grup**: Birlikte yönetilen bir **başlık grubu**. Gruplara verilen **izinler**, üyeleri tarafından **miras alınır**.
* **Hizmet Başlığı/Kurumsal Uygulamalar**: Azure kaynaklarına erişmek için uygulamalar, barındırılan hizmetler ve otomatik araçlarla kullanılmak üzere oluşturulan bir **kimlik**'tir. Bu erişim, hizmet başlığına atanan roller tarafından
## Roller ve İzinler

**Roller**, **ilkeler** üzerinde **ilgili** **kullanıcılara atanır**: `kullanıcı -[ROL SAHİBİ]->(ilke)`

**Gruplara** atanmış **roller**, grup **üyeleri** tarafından **miras alınır**.

Rolün atanmış olduğu kapsama bağlı olarak, rol, kapsam içindeki **diğer kaynaklara** miras alınabilir. Örneğin, bir kullanıcının bir **abonelikte rolü** varsa, bu rolü abonelik içindeki **tüm kaynak gruplarına** ve kaynak grubundaki **tüm kaynaklara** sahip olacaktır.

### **Klasik Roller**

| **Sahip**                     | <ul><li>Tüm kaynaklara tam erişim</li><li>Diğer kullanıcıların erişimini yönetebilir</li></ul> | Tüm kaynak türleri |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Katkıda Bulunan**           | <ul><li>Tüm kaynaklara tam erişim</li><li>Erişimi yönetemez</li></ul>                     | Tüm kaynak türleri |
| **Okuyucu**                   | • Tüm kaynakları görüntüle                                                             | Tüm kaynak türleri |
| **Kullanıcı Erişim Yöneticisi** | <ul><li>Tüm kaynakları görüntüle</li><li>Diğer kullanıcıların erişimini yönetebilir</li></ul> | Tüm kaynak türleri |

### Yerleşik Roller

[Dökümantasyondan: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure rol tabanlı erişim kontrolü (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview), **kullanıcılara, gruplara, hizmet prensiplerine ve yönetilen kimliklere** atayabileceğiniz birkaç Azure **yerleşik rolü** içerir. Rol atamaları, **Azure kaynaklarına erişimi** kontrol etmenin yoludur. Kuruluşunuzun belirli ihtiyaçlarını karşılamayan yerleşik roller varsa, kendi [**Azure özel rollerinizi**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) oluşturabilirsiniz.

**Yerleşik** roller, yalnızca **hedefledikleri kaynaklar** üzerinde **uygulanır**. Örneğin, **Bilgi İşlem** kaynakları üzerindeki **2 örnek yerleşik rolü** kontrol edin:

| [Disk Yedekleme Okuyucusu](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Disk yedeklemesi yapmak için yedekleme ambarına izin verir.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Sanal Makine Kullanıcı Girişi](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Portalda Sanal Makineleri görüntüleme ve düzenli bir kullanıcı olarak oturum açma. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Bu roller ayrıca **mantıksal konteynerlere** (yönetim grupları, abonelikler ve kaynak grupları gibi) atanabilir ve etkilenecek ilgili **kaynaklar üzerinde** bu rolleri **sahipleri** olacaktır.

* [**Tüm Azure yerleşik rollerinin**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles) bir listesini burada bulabilirsiniz.
* [**Tüm Azure AD yerleşik rollerinin**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference) bir listesini burada bulabilirsiniz.

### Özel Roller

Azure, kullanıcının ihtiyaç duyduğu izinlerle [**özel roller**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) oluşturmayı da sağlar.

### İzin Reddedildi

* Bir **kullanıcının bir kaynağa erişimi olması** için, ona **verilen bir rolün** (her ne şekilde olursa olsun) **o izni vermesi** gerekir.
* Bir rolün izni veren rolün üzerinde **reddetme rolü atanmışsa**, reddetme rolü izni veren rolün üzerindeki izni geçersiz kılar.

<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

### Global Yönetici

Global Yönetici rolüne sahip kullanıcılar, User Access Administrator Azure rolünü **kök yönetim grubuna yükseltebilir**. Bu, Global Yöneticinin **tüm Azure aboneliklerini ve yönetim gruplarını yönetebilmesi** anlamına gelir.\
Bu yükseltme, şu adreste yapılabilir: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (41).png" alt=""><figcaption></figcaption></figure>

### Azure İlkeleri

Azure ilkeleri, Microsoft Azure'da **kurallar ve düzenlemeler** olarak tanımlanır ve kurumsal standartları yönetmeye, uyumluluğu değerlendirmeye yardımcı olur. Bu ilkeler, Azure kaynakları üzerinde farklı kurallar uygular ve bu kaynakların kurumsal standartlara ve hizmet düzeyi anlaşmalarına uygun kalmasını sağlar.

Azure ilkeleri, bulut yönetişimi ve güvenliği için önemlidir ve kaynakların doğru ve verimli bir şekilde kullanıldığından, harici düzenlemelere ve iç politikalara uyulduğundan emin olur.\
Örnekler:

1. **Belirli Azure Bölgelerine Uygunluk Sağlama**: Bu ilke, tüm kaynakların belirli Azure bölgelerine dağıtılmasını sağlar. Örneğin, bir şirket, tüm verilerinin GDPR uyumluluğu için Avrupa'da depolanmasını sağlamak isteyebilir.
2. **İsimlendirme Standartlarını Zorlama**: İlkeler, Azure kaynakları için isimlendirme kurallarını zorlayabilir. Bu, büyük ortamlarda kaynakları isimlerine göre düzenlemeye ve kolayca tanımaya yardımcı olur.
3. **Belirli Kaynak Türlerinin Sınırlanması**: Bu ilke, belirli türdeki kaynakların oluşturulmasını sınırlayabilir. Örneğin, belirli VM boyutları gibi maliyetleri kontrol etmek için pahalı kaynak türlerinin oluşturulmasını engelleyen bir ilke belirlenebilir.
4. **Etiketleme İlkelerini Zorlama**: Etiketler, Azure kaynaklarıyla ilişkilendirilen anahtar-değer çiftleridir ve kaynak yönetimi için kullanılır. İlkeler, tüm kaynaklar için belirli etiketlerin var olması veya belirli değerlere sahip olması gerektiğini zorlayabilir. Bu, maliyet takibi, sahiplik veya kaynakların kategorize edilmesi için faydalıdır.
5. **Kaynaklara Genel Erişimi Sınırlama**: İlkeler, belirli kaynakların (depolama hesapları veya veritabanları gibi) genel uç noktalara sahip olmamasını ve yalnızca kuruluşun ağı içinde erişilebilir olmasını zorlayabilir.
6. **Güvenlik Ayarlarının Otomatik Uygulanması**: İlkeler, kaynaklara otomatik olarak güvenlik ayarları uygulamak için kullanılabilir. Örneğin, tüm VM'lerde belirli bir ağ güvenlik grubunun kullanılması veya tüm depolama hesaplarının şifreleme kullanması sağlanabilir.

Azure İlkeleri, Azure hiyerarşisinin herhangi bir seviyesine eklenmesi mümkündür, ancak genellikle kök yönetim grubunda veya diğer yönetim gruplarında kullanılır.

### İzin Kapsamı

Azure'da **izinler hiyerarşinin herhangi bir bölümüne atanabilir**. Bu, yönetim grupları, abonelikler, kaynak grupları ve bireysel kaynaklar dahil olmak üzere tüm kaynaklara
### Varsayılan Kullanıcı İzinleri

Bir temel kullanıcının AzureAD'nin bazı bölümlerini sıralamak için bazı **varsayılan izinlere** sahip olması gerekmektedir:

* Tüm kullanıcıları, Grupları, Uygulamaları, Cihazları, Rolleri, Abonelikleri ve genel özelliklerini okuma
* Misafirleri davet etme (_kapatılabilir_)
* Güvenlik grupları oluşturma
* Gizli olmayan Grup üyeliklerini okuma
* Misafirleri Sahip olduğu gruplara ekleme
* Yeni uygulama oluşturma (_kapatılabilir_)
* Azure'a en fazla 50 cihaz ekleme (_kapatılabilir_)

Tam [**kullanıcıların varsayılan izinlerinin listesini belgelere**](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions) bakabilirsiniz. Ayrıca, bu listede **misafirlerin varsayılan izinlerinin listesini** de görebilirsiniz.

{% hint style="info" %}
Azure kaynaklarını sıralamak için kullanıcının izinlerin açıkça verilmesi gerektiğini unutmayın.
{% endhint %}

### Ayrıcalıklı Kimlik Yönetimi (PIM)

Azure'da Ayrıcalıklı Kimlik Yönetimi (PIM), Azure Active Directory ve Azure'da **ayrıcalıklı erişimi yöneten, denetleyen ve izleyen bir araçtır**. Güvenliği artırırken, **gerektiğinde ve belirli bir süreyle sınırlı ayrıcalıklı erişim sağlar**, **onay süreçlerini zorlar ve ek kimlik doğrulama gerektirir**. Bu yaklaşım, yükseltilmiş izinlerin yalnızca gerektiğinde ve belirli bir süre için verildiğinden yetkisiz erişim riskini en aza indirir.

## Kimlik Doğrulama Jetonları

OIDC'de kullanılan **üç tür jeton** bulunmaktadır:

* [**Erişim Jetonları**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** İstemci, bu jetonu kaynak sunucuya **kaynaklara erişmek** için sunar. Yalnızca belirli bir kullanıcı, istemci ve kaynak kombinasyonu için kullanılabilir ve süresi dolana kadar **iptal edilemez** - varsayılan olarak 1 saat. Bu kullanıldığında tespit düşüktür.
* **Kimlik Jetonları**: İstemci, bu jetonu **yetkilendirme sunucusundan** alır. Kullanıcı hakkında temel bilgiler içerir. Belirli bir kullanıcı ve istemci kombinasyonuna bağlıdır.
* **Yenileme Jetonları**: İstemciye erişim jetonu ile birlikte sağlanır. Yeni erişim ve kimlik jetonları almak için kullanılır. Belirli bir kullanıcı ve istemci kombinasyonuna bağlıdır ve iptal edilebilir. İnaktif yenileme jetonları için varsayılan süre **90 gün**, etkin jetonlar için ise **süresiz**dir.

{% hint style="warning" %}
**Koşullu erişim** için bilgiler **JWT içinde saklanır**. Bu nedenle, **izin verilen bir IP adresinden** jetonu isterseniz, bu **IP** jetonda **saklanır** ve ardından bu jetonu kullanarak **izin verilmeyen bir IP'den kaynaklara erişebilirsiniz**.
{% endhint %}

Erişim jetonlarını **isteme** ve bunlarla **giriş yapma** yöntemlerini öğrenmek için aşağıdaki sayfaya bakın:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

En yaygın API uç noktaları şunlardır:

* **Azure Kaynak Yöneticisi** (ARM): management.azure.com
* **Microsoft Graph**: graph.microsoft.com (Eski Azure AD Graph, graph.windows.net olarak adlandırılır)

## Referanslar

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin!</summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklam vermek veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi Twitter'da takip edin 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live).
* Hacking hilelerinizi [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR göndererek paylaşın.

</details>
