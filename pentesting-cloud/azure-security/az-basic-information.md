# Az - Informa√ß√µes B√°sicas

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Hierarquia Organizacional

<figure><img src="../../.gitbook/assets/image (62).png" alt=""><figcaption></figcaption></figure>

### Grupos de Gerenciamento

Se sua organiza√ß√£o possui **muitas assinaturas Azure**, voc√™ pode precisar de uma maneira eficiente de **gerenciar acesso**, pol√≠ticas e conformidade para essas **assinaturas**. **Grupos de gerenciamento** fornecem um **escopo de governan√ßa acima das assinaturas**.

Observe que **10.000 grupos de gerenciamento** podem ser suportados em um √∫nico diret√≥rio e uma √°rvore de grupo de gerenciamento pode suportar **at√© seis n√≠veis de profundidade**.

<figure><img src="../../.gitbook/assets/image (76).png" alt=""><figcaption></figcaption></figure>

Cada diret√≥rio recebe um √∫nico **grupo de gerenciamento de n√≠vel superior chamado raiz**. O grupo de gerenciamento raiz √© incorporado √† hierarquia para ter **todos os grupos de gerenciamento e assinaturas subordinados a ele**. Este grupo de gerenciamento raiz permite a aplica√ß√£o de **pol√≠ticas globais e atribui√ß√µes de fun√ß√µes Azure** no n√≠vel do diret√≥rio. O [Azure AD **Administrador Global** precisa se elevar](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin) ao **papel de Administrador de Acesso do Usu√°rio deste grupo raiz** inicialmente. Ap√≥s elevar o acesso, o administrador pode **atribuir qualquer fun√ß√£o Azure a outros usu√°rios ou grupos do diret√≥rio para gerenciar a hierarquia**. Como administrador, voc√™ pode atribuir **sua pr√≥pria conta como propriet√°rio do grupo** de gerenciamento raiz.

O grupo de gerenciamento raiz **n√£o pode ser movido ou exclu√≠do**, ao contr√°rio de outros grupos de gerenciamento.

Grupos de gerenciamento oferecem gerenciamento de n√≠vel empresarial em escala, n√£o importa que tipo de assinaturas voc√™ possa ter. No entanto, **todas as assinaturas dentro de um √∫nico grupo de gerenciamento** devem confiar no **mesmo locat√°rio do Azure Active Directory (Azure AD)**.

<figure><img src="../../.gitbook/assets/image (1) (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

### Assinaturas Azure

Uma assinatura Azure √© um **cont√™iner l√≥gico** usado para **provisionar** recursos de neg√≥cios ou t√©cnicos **relacionados no Azure**. Ele cont√©m os **detalhes de todos os seus recursos** como m√°quinas virtuais (VMs), bancos de dados e mais. Quando voc√™ cria um recurso Azure como uma VM, voc√™ identifica a **assinatura a qual pertence**. Permite delegar acesso por meio de mecanismos de controle de acesso baseado em fun√ß√£o.

### Grupos de Recursos

Um grupo de recursos √© um **cont√™iner** que cont√©m **recursos relacionados** para uma solu√ß√£o Azure. O grupo de recursos pode incluir todos os recursos para a solu√ß√£o, ou apenas aqueles **recursos que voc√™ deseja gerenciar como um grupo**. Geralmente, adicione **recursos** que compartilham o **mesmo ciclo de vida** ao mesmo grupo de recursos para que voc√™ possa implantar, atualizar e excluir facilmente como um grupo.

Todos os **recursos** devem estar **dentro de um grupo de recursos** e s√≥ podem pertencer a um grupo e se um grupo de recursos for exclu√≠do, todos os recursos dentro dele tamb√©m ser√£o exclu√≠dos.

### Unidades Administrativas

Unidades administrativas permitem que voc√™ **subdivida** sua organiza√ß√£o em **qualquer unidade** que desejar e, em seguida, **atribua administradores espec√≠ficos** que podem **gerenciar apenas os membros** dessa unidade. Por exemplo, voc√™ poderia usar unidades administrativas para delegar permiss√µes aos administradores de cada escola em uma grande universidade, para que eles pudessem controlar o acesso, gerenciar usu√°rios e definir pol√≠ticas apenas na Escola de Engenharia.

Apenas **usu√°rios**, **grupos** e **dispositivos** podem ser **membros** de uma **unidade administrativa**.

Portanto, uma **Unidade Administrativa** ir√° **conter** alguns **membros** e outros **principais** ser√£o **atribu√≠dos permiss√µes sobre essa** unidade administrativa **que eles podem usar para** **gerenciar os membros** da unidade administrativa.

## Azure vs Azure AD vs Azure AD Domain Services

√â importante notar que **Azure AD** √© um servi√ßo **dentro do** **Azure**. **Azure** √© a **plataforma de nuvem** da Microsoft, enquanto **Azure AD** √© um servi√ßo de **identidade empresarial** no Azure.\
Al√©m disso, **Azure AD n√£o √© como o Windows Active Directory**, √© um servi√ßo de identidade que funciona de maneira completamente diferente. Se voc√™ quiser executar um **Controlador de Dom√≠nio no Azure** para o seu ambiente Windows Active Directory, voc√™ precisa usar **Azure AD Domain Services**.

## Principais

Azure suporta diferentes tipos de principais:

* **Usu√°rio**: Uma **pessoa** comum com credenciais para acesso.
* **Grupo**: Um **grupo de principais** gerenciados juntos. **Permiss√µes** concedidas a grupos s√£o **herdadas** por seus **membros**.
*   **Principal de Servi√ßo/Aplica√ß√µes Empresariais**: √â uma **identidade** criada para **uso** com **aplica√ß√µes**, servi√ßos hospedados e ferramentas automatizadas para acessar recursos Azure. Este acesso √© **restrito pelas fun√ß√µes atribu√≠das** ao principal de servi√ßo, dando-lhe controle sobre **quais recursos podem ser acessados** e em qual n√≠vel. Por raz√µes de seguran√ßa, √© sempre recomendado **usar principais de servi√ßo com ferramentas automatizadas** em vez de permitir que elas fa√ßam login com uma identidade de usu√°rio.

Ao criar um **principal de servi√ßo**, voc√™ pode escolher entre **autentica√ß√£o por senha** ou **autentica√ß√£o por certificado**.

* Se voc√™ escolher autentica√ß√£o por **senha** (por padr√£o), **salve a senha gerada** pois voc√™ n√£o poder√° acess√°-la novamente.
* Se voc√™ escolher autentica√ß√£o por certificado, certifique-se de que a **aplica√ß√£o ter√° acesso sobre a chave privada**.
* **Identidade Gerenciada (Credenciais de Metadados)**: Identidades gerenciadas fornecem uma **identidade automaticamente gerenciada** no Azure Active Directory para aplica√ß√µes usarem ao **conectar-se** a **recursos** que suportam autentica√ß√£o Azure Active Directory (**Azure AD**). Aplica√ß√µes podem usar identidades gerenciadas para **obter tokens Azure AD sem ter que gerenciar quaisquer credenciais**.\
Existem dois tipos de identidades gerenciadas:
* **Atribu√≠da pelo sistema**. Alguns servi√ßos Azure permitem que voc√™ **ative uma identidade gerenciada diretamente em uma inst√¢ncia de servi√ßo**. Quando voc√™ ativa uma identidade gerenciada pelo sistema, uma identidade √© criada no Azure AD. A identidade est√° vinculada ao **ciclo de vida dessa inst√¢ncia de servi√ßo**. Quando o **recurso** √© **exclu√≠do**, o Azure automaticamente **exclui** a **identidade** para voc√™. Por design, apenas esse recurso Azure pode usar essa identidade para solicitar tokens do Azure AD.
* **Atribu√≠da pelo usu√°rio**. Voc√™ tamb√©m pode criar uma identidade gerenciada como um recurso Azure independente. Voc√™ pode [criar uma identidade gerenciada atribu√≠da pelo usu√°rio](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal) e atribu√≠-la a uma ou **mais inst√¢ncias** de um servi√ßo Azure (m√∫ltiplos recursos). Para identidades gerenciadas atribu√≠das pelo usu√°rio, a **identidade √© gerenciada separadamente dos recursos que a utilizam**.

## Fun√ß√µes & Permiss√µes

**Fun√ß√µes** s√£o **atribu√≠das** a **principais** em um **escopo**: `principal -[TEM FUN√á√ÉO]->(escopo)`

**Fun√ß√µes** atribu√≠das a **grupos** s√£o **herdadas** por todos os **membros** do grupo.

Dependendo do escopo ao qual a fun√ß√£o foi atribu√≠da, a **fun√ß√£o** pode ser **herdada** para **outros recursos** dentro do cont√™iner de escopo. Por exemplo, se um usu√°rio A tem uma **fun√ß√£o na assinatura**, ele ter√° essa **fun√ß√£o em todos os grupos de recursos** dentro da assinatura e em **todos os recursos** dentro do grupo de recursos.

### **Fun√ß√µes Cl√°ssicas**

| **Propriet√°rio**                     | <ul><li>Acesso completo a todos os recursos</li><li>Pode gerenciar acesso para outros usu√°rios</li></ul> | Todos os tipos de recursos |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Colaborador**               | <ul><li>Acesso completo a todos os recursos</li><li>N√£o pode gerenciar acesso</li></ul>              | Todos os tipos de recursos |
| **Leitor**                    | ‚Ä¢ Visualizar todos os recursos                                                                     | Todos os tipos de recursos |
| **Administrador de Acesso do Usu√°rio** | <ul><li>Visualizar todos os recursos</li><li>Pode gerenciar acesso para outros usu√°rios</li></ul>           | Todos os tipos de recursos |

### Fun√ß√µes Integradas

O [controle de acesso baseado em fun√ß√£o Azure (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) tem v√°rias **fun√ß√µes integradas Azure** que voc√™ pode **atribuir** a **usu√°rios, grupos, principais de servi√ßo e identidades gerenciadas**. Atribui√ß√µes de fun√ß√£o s√£o a maneira de controlar **acesso a recursos Azure**. Se as fun√ß√µes integradas n√£o atenderem √†s necessidades espec√≠ficas da sua organiza√ß√£o, voc√™ pode criar suas pr√≥prias [**fun√ß√µes personalizadas Azure**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**.**

**Fun√ß√µes Integradas** aplicam-se apenas aos **recursos** aos quais s√£o **destinadas**, por exemplo, confira estes 2 exemplos de **Fun√ß√µes Integradas sobre recursos de Computa√ß√£o**:

| [Leitor de Backup de Disco](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Fornece permiss√£o para cofre de backup realizar backup de disco.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Login de Usu√°rio de M√°quina Virtual](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Visualizar M√°quinas Virtuais no portal e fazer login como um usu√°rio comum. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Essas fun√ß√µes podem **tamb√©m ser atribu√≠das sobre cont√™ineres l√≥gicos** (como grupos de gerenciamento, assinaturas e grupos de recursos) e os principais afetados ter√£o essas fun√ß√µes **sobre os recursos dentro desses cont√™ineres**.

* Encontre aqui uma lista com [**todas as fun√ß√µes integradas Azure**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* Encontre aqui uma lista com [**todas as fun√ß√µes integradas Azure AD**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Fun√ß√µes Personalizadas

Azure tamb√©m permite criar [**fun√ß√µes personalizadas**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) com as permiss√µes que o usu√°rio precisa.

### Permiss√£o Negada

* Para que um **principal tenha algum acesso a um recurso**, ele precisa de uma fun√ß√£o expl√≠cita sendo concedida a ele (de alguma forma) **concedendo-lhe essa permiss√£o**.
* Uma atribui√ß√£o de fun√ß√£o de **nega√ß√£o expl√≠cita tem preced√™ncia** sobre a fun√ß√£o que concede a permiss√£o.

<figure><img src="../../.gitbook/assets/image (32).png" alt=""><figcaption></figcaption></figure>

### Administrador Global

Usu√°rios com a fun√ß√£o de Administrador Global t√™m a capacidade de '**elevar-se' √† fun√ß√£o de Administrador de Acesso do Usu√°rio Azure ao grupo de gerenciamento raiz**. Isso significa que um Administrador Global poder√° gerenciar acesso **a todas as assinaturas e grupos de gerenciamento Azure.**\
Essa eleva√ß√£o pode ser feita no final da p√°gina: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (41).png" alt=""><figcaption></figcaption></figure>

### Pol√≠ticas Azure

Pol√≠ticas Azure s√£o um conjunto de **regras e regulamentos no Microsoft Azure**, um servi√ßo de computa√ß√£o em nuvem, que ajudam a gerenciar e impor padr√µes organizacionais e a avaliar a conformidade em larga escala. Essas pol√≠ticas imp√µem diferentes regras sobre seus **recursos Azure**, garantindo que esses recursos permane√ßam em conformidade com padr√µes corporativos e acordos de n√≠vel de servi√ßo.

Pol√≠ticas Azure s√£o cruciais para a governan√ßa em nuvem e seguran√ßa, ajudando a garantir que os recursos sejam usados de forma adequada e eficiente, e que eles estejam em conformidade com regulamentos externos e pol√≠ticas internas.\
Alguns exemplos:

1. **Garantindo Conformidade com Regi√µes Azure Espec√≠ficas**: Esta pol√≠tica garante que todos os recursos sejam implantados em regi√µes Azure espec√≠ficas. Por exemplo, uma empresa pode querer garantir que todos os seus dados sejam armazenados na Europa para conformidade com o GDPR.
2. **Impondo Padr√µes de Nomenclatura**: Pol√≠ticas podem impor conven√ß√µes de nomenclatura para recursos Azure. Isso ajuda a organizar e identificar facilmente recursos com base em seus nomes, o que √© √∫til em ambientes grandes.
3. **Restringindo Certos Tipos de Recursos**: Esta pol√≠tica pode restringir a cria√ß√£o de certos tipos de recursos. Por exemplo, uma pol√≠tica poderia ser definida para prevenir a cria√ß√£o de tipos de recursos caros, como certos tamanhos de VM, para controlar custos.
4. **Impondo Pol√≠ticas de Etiquetagem**: Etiquetas s√£o pares de chave-valor associados a recursos Azure usados para gerenciamento de recursos. Pol√≠ticas podem impor que certas etiquetas devem estar presentes, ou ter valores espec√≠ficos, para todos os recursos. Isso √© √∫til para rastreamento de custos, propriedade ou categoriza√ß√£o de recursos.
5. **Limitando Acesso P√∫blico a Recursos**: Pol√≠ticas podem impor que certos recursos, como contas de armazenamento ou bancos de dados, n√£o tenham pontos de extremidade p√∫blicos, garantindo que eles sejam acess√≠veis apenas dentro da rede da organiza√ß√£o.
6. **Aplicando Automaticamente Configura√ß√µes de Seguran√ßa**: Pol√≠ticas podem ser usadas para aplicar automaticamente configura√ß√µes de seguran√ßa a recursos, como aplicar um grupo de seguran√ßa de rede espec√≠fico a todas as VMs ou garantir que todas as contas de armazenamento usem criptografia.

Observe que Pol√≠ticas Azure podem ser anexadas a qualquer n√≠vel da hierarquia Azure, mas s√£o **comumente usadas no grupo de gerenciamento raiz** ou em outros grupos de gerenciamento.

### Escopo de Permiss√µes

No Azure **as permiss√µes podem ser atribu√≠das a qualquer parte da hierarquia**. Isso inclui grupos de gerenciamento, assinaturas, grupos de recursos e recursos individuais. As permiss√µes s√£o **herdadas**
