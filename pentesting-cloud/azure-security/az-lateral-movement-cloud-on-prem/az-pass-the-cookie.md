# Az - クッキーのパス

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **ハックトリックで会社を宣伝**したい場合や、**最新バージョンのPEASSをダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つける、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するには、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに送信してください。**

</details>

## なぜクッキーを使用するのか？

ブラウザの**クッキー**は、**認証とMFAをバイパス**するための優れたメカニズムです。ユーザーが既にアプリケーションで認証されているため、セッション**クッキー**を使用して、再認証する必要なくそのユーザーとしてデータにアクセスできます。

**ブラウザのクッキーの場所**は次の場所で確認できます：

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/specific-software-file-type-tricks/browser-artifacts?q=browse#google-chrome" %}

## 攻撃

難しい部分は、これらの**クッキーがユーザー**に対してMicrosoft Data Protection API（**DPAPI**）を介して暗号化されていることです。これは、クッキーが属するユーザーに関連付けられた暗号化[キー](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords)を使用して暗号化されています。これについての詳細情報は次の場所で確認できます：

{% embed url="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords" %}

Mimikatzを手に入れたら、次のコマンドを使用して**ユーザーのクッキーを抽出**できます。
```bash
mimikatz.exe privilege::debug log "dpapi::chrome /in:%localappdata%\google\chrome\USERDA~1\default\cookies /unprotect" exit
```
<figure><img src="../../../.gitbook/assets/image (8) (3).png" alt=""><figcaption></figcaption></figure>

Azureにおいて、**`ESTSAUTH`**、**`ESTSAUTHPERSISTENT`**、**`ESTSAUTHLIGHT`**を含む認証クッキーに注意が必要です。これらはユーザーが最近Azureでアクティブであることを示しています。

<figure><img src="../../../.gitbook/assets/image (14) (1).png" alt=""><figcaption></figcaption></figure>

単にlogin.microsoftonline.comに移動し、**`ESTSAUTHPERSISTENT`**（「ログイン状態を保持する」オプションによって生成される）または**`ESTSAUTH`**のクッキーを追加するだけで、認証されます。

## 参考文献

* [https://stealthbits.com/blog/bypassing-mfa-with-pass-the-cookie/](https://stealthbits.com/blog/bypassing-mfa-with-pass-the-cookie/)

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もしもあなたの**会社をHackTricksで宣伝したい**場合や、**最新版のPEASSやHackTricksのPDFをダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter**で私をフォローしてください 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリにPRを提出することで、あなたのハッキングテクニックを共有してください。

</details>
