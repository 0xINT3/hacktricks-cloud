# Az - Laterale Bewegung (Cloud - On-Prem)

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys einreichen.

</details>

## On-Prem-Maschinen verbunden mit der Cloud

Es gibt verschiedene M√∂glichkeiten, wie eine Maschine mit der Cloud verbunden sein kann:

### Azure AD beigetreten

<figure><img src="../../../.gitbook/assets/image (3) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

### Arbeitsplatz beigetreten

<figure><img src="../../../.gitbook/assets/image (1) (6).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Hybrid beigetreten

<figure><img src="../../../.gitbook/assets/image (3) (2) (2).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Arbeitsplatz beigetreten auf AADJ oder Hybrid

<figure><img src="../../../.gitbook/assets/image (4) (3).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

## Tokens und Einschr√§nkungen <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

In Azure AD gibt es verschiedene Arten von Tokens mit spezifischen Einschr√§nkungen:

- **Zugriffstoken**: Wird verwendet, um auf APIs und Ressourcen wie den Microsoft Graph zuzugreifen. Sie sind an einen bestimmten Client und eine bestimmte Ressource gebunden.
- **Aktualisierungstoken**: Wird an Anwendungen ausgegeben, um neue Zugriffstoken zu erhalten. Sie k√∂nnen nur von der Anwendung verwendet werden, f√ºr die sie ausgestellt wurden, oder von einer Gruppe von Anwendungen.
- **Prim√§re Aktualisierungstoken (PRT)**: Wird f√ºr Single Sign-On auf Azure AD-beigetretenen, registrierten oder hybrid beigetretenen Ger√§ten verwendet. Sie k√∂nnen in Browser-Anmeldefl√ºssen und zum Anmelden bei mobilen und Desktop-Anwendungen auf dem Ger√§t verwendet werden.

Der interessanteste Typ von Token ist das Prim√§re Aktualisierungstoken (PRT).

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

## Pivoting-Techniken

Vom **kompromittierten Ger√§t zur Cloud**:

* [**Cookie weitergeben**](az-pass-the-cookie.md): Stehlen Sie Azure-Cookies aus dem Browser und verwenden Sie sie zum Einloggen
* [**Phishing des Prim√§ren Aktualisierungstokens**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** Phish das PRT, um es zu missbrauchen
* [**PRT weitergeben**](pass-the-prt.md): Stehlen Sie das Ger√§te-PRT, um auf Azure zuzugreifen und es zu imitieren.
* [**Zertifikat weitergeben**](az-pass-the-certificate.md)**:** Generieren Sie ein Zertifikat basierend auf dem PRT, um sich von einem Ger√§t auf ein anderes einzuloggen

Vom Kompromittieren von **AD** bis zum Kompromittieren der **Cloud** und vom Kompromittieren der **Cloud** bis zum Kompromittieren von **AD**:

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **Ein weiterer Weg, um von der Cloud zu On-Prem zu wechseln, ist das** [**Ausnutzen von Intune**](../intune.md)

### [Roadtx](https://github.com/dirkjanm/ROADtools)

Dieses Tool erm√∂glicht es, verschiedene Aktionen auszuf√ºhren, wie das Registrieren einer Maschine in Azure AD, um ein PRT zu erhalten, und die Verwendung von PRTs (legitim oder gestohlen), um auf Ressourcen auf verschiedene Arten zuzugreifen. Dies sind keine direkten Angriffe, aber es erleichtert die Verwendung von PRTs, um auf Ressourcen auf verschiedene Arten zuzugreifen. Weitere Informationen finden Sie unter [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

# Referenzen
* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys einreichen.

</details>
