# Az - Lateral Movement (Cloud - On-Prem)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## On-Prem machines connected to cloud

рдПрдХ рдорд╢реАрди рдХреЛ рдХреНрд▓рд╛рдЙрдб рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВ:

### Azure AD joined

<figure><img src="../../../.gitbook/assets/image (3) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

### Workplace joined

<figure><img src="../../../.gitbook/assets/image (1) (6).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Hybrid joined

<figure><img src="../../../.gitbook/assets/image (3) (2) (2).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Workplace joined on AADJ or Hybrid

<figure><img src="../../../.gitbook/assets/image (4) (3).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

## Tokens and limitations <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

Azure AD рдореЗрдВ, рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реАрдорд╛рдУрдВ рд╡рд╛рд▓реЗ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдЯреЛрдХрди рд╣реЛрддреЗ рд╣реИрдВ:

- **Access tokens**: Microsoft Graph рдЬреИрд╕реЗ API рдФрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рд╡реЗ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рдВрд╕рд╛рдзрди рд╕реЗ рдЬреБрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВред
- **Refresh tokens**: рдирдП рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреЛ рдЬрд╛рд░реА рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрдиреНрд╣реЗрдВ рдХреЗрд╡рд▓ рдЙрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рдпрд╛ рдХреБрдЫ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
- **Primary Refresh Tokens (PRT)**: Azure AD рдЬреБрдбрд╝реЗ, рдкрдВрдЬреАрдХреГрдд рдпрд╛ рд╣рд╛рдЗрдмреНрд░рд┐рдб рдЬреБрдбрд╝реЗ рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рд╕рд┐рдВрдЧрд▓ рд╕рд╛рдЗрди-рдСрди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрдиреНрд╣реЗрдВ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕рд╛рдЗрди-рдЗрди рдлреНрд▓реЛ рдФрд░ рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░ рдореЛрдмрд╛рдЗрд▓ рдФрд░ рдбреЗрд╕реНрдХрдЯреЙрдк рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╕рд╛рдЗрди-рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЯреЛрдХрди рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди (PRT) рд╣реИред

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

## Pivoting Techniques

**рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝реНрдб рдорд╢реАрди рд╕реЗ рдХреНрд▓рд╛рдЙрдб рддрдХ**:

* [**рдХреБрдХреА рдкрд╛рд╕ рдХрд░реЗрдВ**](az-pass-the-cookie.md): рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реЗ Azure рдХреБрдХреА рдЪреБрд░рд╛рдПрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
* [**рдлрд┐рд╢рд┐рдВрдЧ рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** PRT рдХреЛ рдзреЛрдЦрд╛рдзрдбрд╝реА рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд┐рд╢рд┐рдВрдЧ рдХрд░реЗрдВ
* [**PRT рдкрд╛рд╕ рдХрд░реЗрдВ**](pass-the-prt.md): рдбрд┐рд╡рд╛рдЗрд╕ PRT рдЪреБрд░рд╛рдПрдВ рдФрд░ рдЙрд╕реЗ рдЗрдореНрдкрд░реНрд╕рдиреЗрдЯ рдХрд░рддреЗ рд╣реБрдП Azure рддрдХ рдкрд╣реБрдВрдЪреЗрдВред
* [**рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдкрд╛рд╕ рдХрд░реЗрдВ**](az-pass-the-certificate.md)**:** PRT рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрдЯ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ рдФрд░ рдПрдХ рдорд╢реАрди рд╕реЗ рджреВрд╕рд░реЗ рдорд╢реАрди рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ

**AD** рдХреЛ **рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝реНрдб** рдХрд░рдиреЗ рд╕реЗ **рдХреНрд▓рд╛рдЙрдб** рдФрд░ **рдХреНрд▓рд╛рдЙрдб** рдХреЛ **AD** рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝реНрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рдХреНрд▓рд╛рдЙрдб рд╕реЗ On-Prem рддрдХ рдкрд┐рд╡реЛрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** [**Intune рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛**](../intune.md)

### [Roadtx](https://github.com/dirkjanm/ROADtools)

рдпрд╣ рдЙрдкрдХрд░рдг рдХрдИ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреИрд╕реЗ рдХрд┐ рдПрдХ рдорд╢реАрди рдХреЛ Azure AD рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рдХрд░рдирд╛ рдФрд░ PRT рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛, рдФрд░ PRTs (рд╡реИрдз рдпрд╛ рдЪреЛрд░реА рдХрд┐рдП рдЧрдП) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рд╕реЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдПред рдпреЗ рд╕реАрдзреЗ рд╣рдорд▓реЗ рдирд╣реАрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ PRTs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рд╕реЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рддрд╛ рд╣реИред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/) рдореЗрдВ рджреЗрдЦреЗрдВ

# References
* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
