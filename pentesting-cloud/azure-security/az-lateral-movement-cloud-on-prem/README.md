# Az - Laterale Beweging (Wolk - On-Prem)

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-opslagplekke.

</details>

## On-Prem-masjiene wat aan die wolk gekoppel is

Daar is verskillende maniere waarop 'n masjien aan die wolk gekoppel kan wees:

### Azure AD gekoppel

<figure><img src="../../../.gitbook/assets/image (3) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

### Werkplek gekoppel

<figure><img src="../../../.gitbook/assets/image (1) (6).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Hibried gekoppel

<figure><img src="../../../.gitbook/assets/image (3) (2) (2).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Werkplek gekoppel op AADJ of Hibried

<figure><img src="../../../.gitbook/assets/image (4) (3).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

## Tokens en beperkings <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

In Azure AD is daar verskillende tipes tokens met spesifieke beperkings:

- **Toegangstokens**: Gebruik om APIs en hulpbronne soos die Microsoft Graph te benader. Hulle is gekoppel aan 'n spesifieke kli√´nt en hulpbron.
- **Vernuwingsertifikate**: Uitgereik aan toepassings om nuwe toegangstokens te verkry. Hulle kan slegs deur die toepassing waarvoor hulle uitgereik is of 'n groep toepassings gebruik word.
- **Prim√™re Vernuwingsertifikate (PRT)**: Gebruik vir Enkel Aanmelding op Azure AD-gekoppelde, geregistreerde of hibried-gekoppelde toestelle. Dit kan gebruik word in aanmeldingsvloei in die blaaier en vir aanmelding by mobiele en lessenaartoepassings op die toestel.

Die mees interessante tipe token is die Prim√™re Vernuwingsertifikaat (PRT).

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

## Pivoting-tegnieke

Vanaf die **gekompromitteerde masjien na die wolk**:

* [**Gee die Koekie oor**](az-pass-the-cookie.md): Steel Azure-koekies uit die blaaier en gebruik dit om aan te meld
* [**Phishing Prim√™re Vernuwingsertifikaat**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** Phish die PRT om dit te misbruik
* [**Gee die PRT oor**](pass-the-prt.md): Steel die toestel PRT om Azure te benader deur dit voor te gee.
* [**Gee die Sertifikaat oor**](az-pass-the-certificate.md)**:** Genereer 'n sertifikaat gebaseer op die PRT om van die een masjien na die ander aan te meld

Vanaf die **AD-kompromittering na die Wolk-kompromittering** en vanaf die **Wolk-kompromittering na** die **AD-kompromittering**:

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **'n Ander manier om van die wolk na On-Prem te beweeg is** [**Intune misbruik**](../intune.md)

### [Roadtx](https://github.com/dirkjanm/ROADtools)

Hierdie instrument maak dit moontlik om verskeie aksies uit te voer, soos die registreer van 'n masjien in Azure AD om 'n PRT te verkry, en die gebruik van PRT's (wettig of gesteel) om hulpbronne op verskeie verskillende maniere te benader. Dit is nie direkte aanvalle nie, maar dit fasiliteer die gebruik van PRT's om hulpbronne op verskillende maniere te benader. Vind meer inligting by [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

# Verwysings
* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-opslagplekke.

</details>
