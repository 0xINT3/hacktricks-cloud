# Az - Sertifikayı Geçir

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> ile sıfırdan kahraman olmak için AWS hackleme öğrenin<strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamını görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'ı **takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek** paylaşın.

</details>

## Sertifikayı Geçir (Azure)

Azure'a katılan makinelerde, **NegoEx** kimlik doğrulama mekanizmasını destekleyen her iki makine de **gereken kullanıcı için Azure AD CA tarafından verilmiş sertifikaları kullanarak** bir makineden diğerine kimlik doğrulamak mümkündür.

Çok basitleştirilmiş bir şekilde:

* Bağlantıyı başlatan makine (istemci), **Azure AD'den bir kullanıcı için bir sertifika** alması gerekmektedir.
* İstemci, PRT ve diğer detayları içeren bir JSON Web Token (JWT) başlığı oluşturur, türetilmiş anahtar kullanarak (oturum anahtarı ve güvenlik bağlamını kullanarak) imzalar ve **Azure AD'ye gönderir**.
* Azure AD, istemci oturum anahtarı ve güvenlik bağlamını kullanarak JWT imzasını doğrular, PRT'nin geçerliliğini kontrol eder ve **sertifika ile yanıt verir**.

Bu senaryoda ve [**PRT'yi Geçir**](pass-the-prt.md) saldırısı için gereken tüm bilgileri ele geçirdikten sonra:

* Kullanıcı adı
* Kiracı Kimliği
* PRT
* Güvenlik bağlamı
* Türetilmiş Anahtar

Kullanıcı için **P2P sertifikası talep etmek mümkündür** [**PrtToCert**](https://github.com/morRubin/PrtToCert)**** aracıyla:

{% code overflow="wrap" %}
```bash
RequestCert.py [-h] --tenantId TENANTID --prt PRT --userName USERNAME --hexCtx HEXCTX --hexDerivedKey HEXDERIVEDKEY [--passPhrase PASSPHRASE]
```
{% endcode %}

Sertifikalar PRT ile aynı süreye sahip olacak. Sertifikayı kullanmak için [**AzureADJoinedMachinePTC**](https://github.com/morRubin/AzureADJoinedMachinePTC) adlı python aracını kullanabilirsiniz. Bu araç, uzak makineye **kimlik doğrulama** yapacak, **PSEXEC** çalıştıracak ve **kurban makinede bir CMD açacak**. Bu bize Mimikatz'i tekrar kullanarak başka bir kullanıcının PRT'sini elde etme imkanı sağlayacak.
```bash
Main.py [-h] --usercert USERCERT --certpass CERTPASS --remoteip REMOTEIP
```
## Referanslar

* Pass the Certificate'nin nasıl çalıştığı hakkında daha fazla bilgi için orijinal yazıya göz atın: [https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597](https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597)

<details>

<summary><strong>AWS hackleme konusunda sıfırdan kahramana dönüşmek için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'ı öğrenin!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** isterseniz [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>
