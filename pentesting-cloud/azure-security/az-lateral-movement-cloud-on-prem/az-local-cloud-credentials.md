# Az - ローカルクラウド資格情報

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter**で私たちをフォローする 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
- **ハッキングトリックを共有する**ために、[HackTricks](https://github.com/carlospolop/hacktricks)と[HackTricks Cloud](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する。

</details>

## ローカルトークンストレージとセキュリティ考慮事項

### Azure CLI（Command-Line Interface）

Azure CLIによってトークンや機密データがローカルに保存され、セキュリティ上の懸念が引き起こされます：

1. **アクセストークン**：`C:\Users\<username>\.Azure`にある`accessTokens.json`内に平文で保存されています。
2. **サブスクリプション情報**：同じディレクトリ内の`azureProfile.json`にはサブスクリプションの詳細が保存されています。
3. **ログファイル**：`.azure`内の`ErrorRecords`フォルダには、以下のような機密情報を公開する可能性があるログが含まれています：
   - 資格情報が埋め込まれた実行されたコマンド。
   - トークンを使用してアクセスされたURLなど、機密情報を明らかにする可能性があるもの。

### Azure PowerShell

Azure PowerShellもトークンや機密データを保存し、ローカルでアクセスできます：

1. **アクセストークン**：`C:\Users\<username>\.Azure`にある`TokenCache.dat`にアクセストークンが平文で保存されています。
2. **サービスプリンシパルのシークレット**：これらは`AzureRmContext.json`に暗号化されていない状態で保存されています。
3. **トークン保存機能**：ユーザーは`Save-AzContext`コマンドを使用してトークンを永続化する機能を持っていますが、権限なくアクセスされることを防ぐために慎重に使用する必要があります。

## それらを見つけるための自動ツール

- [**Winpeas**](https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS/winPEASexe)
- [**Get-AzurePasswords.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/AzureRM/Get-AzurePasswords.ps1)

## セキュリティ推奨事項

平文で機密データを保存していることを考慮すると、これらのファイルとディレクトリを保護するために次のような対策を取ることが重要です：
- これらのファイルへのアクセス権を制限する。
- これらのディレクトリを権限なくアクセスしたり予期しない変更があったりするかどうかを定期的に監視および監査する。
- 可能な限り機密ファイルを暗号化する。
- このような機密情報を取り扱う際のリスクやベストプラクティスについてユーザーに教育する。
