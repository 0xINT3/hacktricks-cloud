# Az - PTA - рдкрд╛рд╕-рдереНрд░реВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

[рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕реЗ:](https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-pta) Azure Active Directory (Azure AD) Pass-through Authentication рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдПрдХ рд╣реА рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдСрди-рдкреНрд░реЗрдорд┐рд╕ рдФрд░ рдХреНрд▓рд╛рдЙрдб-рдЖрдзрд╛рд░рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**ред рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдПрдХ рдмреЗрд╣рддрд░ рдЕрдиреБрднрд╡ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ - рдПрдХ рдХрдо рдкрд╛рд╕рд╡рд░реНрдб рдпрд╛рдж рд░рдЦрдиреЗ рдХреА рдЬрд░реВрд░рдд рдФрд░ IT рд╣реЗрд▓реНрдкрдбреЗрд╕реНрдХ рд▓рд╛рдЧрдд рдХреЛ рдХрдо рдХрд░рддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рд╛рдЗрди рдЗрди рдХреИрд╕реЗ рдХрд░реЗрдВ рднреВрд▓рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрдо рд╣реЛрддреА рд╣реИред рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ Azure AD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рд╛рдЗрди рдЗрди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рд╕реАрдзреЗ рдЖрдкрдХреЗ рдСрди-рдкреНрд░реЗрдорд┐рд╕ Active Directory рдХреЗ рдЦрд┐рд▓рд╛рдл рдорд╛рдиреНрдпрддрд╛ рджреЗрддреА рд╣реИ**ред

PTA рдореЗрдВ **рдкрд╣рдЪрд╛рдиреЗрдВ** **рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝** рд╣реЛрддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди **рдкрд╛рд╕рд╡рд░реНрдб** рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ PHS рдореЗрдВред

рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдСрди-рдкреНрд░реЗрдо AD рдореЗрдВ рдорд╛рдиреНрдпрддрд╛ рджреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдХреНрд▓рд╛рдЙрдб рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд░ рдПрдХ **рдСрди-рдкреНрд░реЗрдо рд╕рд░реНрд╡рд░** рдореЗрдВ рдЪрд▓ рд░рд╣реЗ рдПрдХ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдПрдЬреЗрдВрдЯ** рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдпрд╣ рдСрди-рдкреНрд░реЗрдо DC рдкрд░ рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ)ред

### рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдлреНрд▓реЛ

<figure><img src="../../../../.gitbook/assets/image (4) (2) (1).png" alt=""><figcaption></figcaption></figure>

1. **рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **Azure AD** рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рдЙрд╕рдиреЗ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рдФрд░ **рдкрд╛рд╕рд╡рд░реНрдб** рднреЗрдЬрд╛
2. **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб** рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ **рдХрддрд╛рд░** рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ Azure AD рдореЗрдВ
3. **рдСрди-рдкреНрд░реЗрдо рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдПрдЬреЗрдВрдЯ** рдХрддрд╛рд░ рд╕реЗ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдЬреБрдЯрд╛рддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ **рдбрд┐рдХреНрд░рд┐рдкреНрдЯ** рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдПрдЬреЗрдВрдЯ **"рдкрд╛рд╕-рдереНрд░реВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдПрдЬреЗрдВрдЯ"** рдпрд╛ **PTA рдПрдЬреЗрдВрдЯ** рдХрд╣рд▓рд╛рддрд╛ рд╣реИред
4. **рдПрдЬреЗрдВрдЯ** **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХреЛ **рдСрди-рдкреНрд░реЗрдо AD** рдХреЗ рдЦрд┐рд▓рд╛рдл рдорд╛рдиреНрдпрддрд╛ рджреЗрддрд╛ рд╣реИ рдФрд░ рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдХрд╛рд░рд╛рддреНрдордХ рд╣реИ, рддреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рд▓реЙрдЧрд┐рди рдкреВрд░рд╛** рдХрд░рддрд╛ рд╣реИред

{% hint style="warning" %}
рдпрджрд┐ рдХреЛрдИ рд╣рдорд▓рд╛рд╡рд░ **PTA** рдХреЛ **рдХрдВрдкреНрд░рдорд╛рдЗрдЬрд╝** рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдХрддрд╛рд░ рд╕реЗ рд╕рднреА **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** (рд╕реНрдкрд╖реНрдЯ-рдкрд╛рда рдореЗрдВ) рджреЗрдЦ рд╕рдХрддрд╛ рд╣реИред\
рд╡рд╣ рднреА AzureAD рдХреЛ рдХрд┐рд╕реА рднреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдорд╛рдиреНрдпрддрд╛ рджреЗ рд╕рдХрддрд╛ рд╣реИ (рд╕реНрдХреЗрд▓реЗрдЯрди рдХреБрдВрдЬреА рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд╣рдорд▓рд╛)ред
{% endhint %}

### рдСрди-рдкреНрд░реЗрдо -> рдХреНрд▓рд╛рдЙрдб

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **PTA** **рдПрдЬреЗрдВрдЯ** рдЪрд▓ рд░рд╣реЗ **Azure AD Connect рд╕рд░реНрд╡рд░** рдХрд╛ **рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ** рдПрдХреНрд╕реЗрд╕ рд╣реИ, рддреЛ рдЖрдк **AADInternals** рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдмреИрдХрдбреЛрд░ рдбрд╛рд▓рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╕рднреА рдкрд╛рд╕рд╡рд░реНрдбреЛрдВ рдХреА рдорд╛рдиреНрдпрддрд╛ рджреЗрдЧрд╛ (рддрд╛рдХрд┐ рд╕рднреА рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдп рд╣реЛрдВ):
```powershell
Install-AADIntPTASpy
```
{% hint style="info" %}
рдпрджрд┐ **рд╕реНрдерд╛рдкрдирд╛ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддреА рд╣реИ**, рддреЛ рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ [Microsoft Visual C++ 2015 Redistributables](https://download.microsoft.com/download/6/A/A/6AA4EDFF-645B-48C5-81CC-ED5963AEAD48/vc_redist.x64.exe) рдХреА рдХрдореА рд╣реЛ рд╕рдХрддреА рд╣реИред
{% endhint %}

рдпрд╣ рднреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ **рдкрд┐рдЫрд▓реЗ рдмреИрдХрдбреЛрд░ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдП рдЧрдП рдорд╢реАрди рдкрд░ PTA рдПрдЬреЗрдВрдЯ рдХреЛ рднреЗрдЬреЗ рдЧрдП рд╕реНрдкрд╖реНрдЯ-рдкрд╛рда рдкрд╛рд╕рд╡рд░реНрдб рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд cmdlet рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ:
```powershell
Get-AADIntPTASpyLog -DecodePasswords
```
рдпрд╣ рдмреИрдХрдбреЛрд░ рдХрд░реЗрдЧрд╛:

* рдПрдХ рдЫреБрдкреА рдлрд╝реЛрд▓реНрдбрд░ `C:\PTASpy` рдмрдирд╛рдПрдЧрд╛
* `PTASpy.dll` рдХреЛ `C:\PTASpy` рдореЗрдВ рдХреЙрдкреА рдХрд░реЗрдЧрд╛
* `PTASpy.dll` рдХреЛ `AzureADConnectAuthenticationAgentService` рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдЧрд╛

{% hint style="info" %}
рдЬрдм AzureADConnectAuthenticationAgent рд╕реЗрд╡рд╛ рдкреБрдирдГ рдЪрд╛рд▓реВ рд╣реЛрддреА рд╣реИ, рддреЛ PTASpy "рдЕрдирд▓реЛрдб" рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдкреБрдирдГ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред
{% endhint %}

### рдХреНрд▓рд╛рдЙрдб -> рдСрди-рдкреНрд░реЗрдо

{% hint style="danger" %}
рдХреНрд▓рд╛рдЙрдб рдкрд░ **GA рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдПрдХ **рдирдпрд╛ PTA рдПрдЬреЗрдВрдЯ рд░рдЬрд┐рд╕реНрдЯрд░** рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдЬрд┐рд╕реЗ рдПрдХ **рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рдорд╢реАрди** рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдПрдХ рдмрд╛рд░ рдПрдЬреЗрдВрдЯ рд╕реЗрдЯрдЕрдк рд╣реЛ рдЬрд╛рдП, рд╣рдо **рдкрд┐рдЫрд▓реЗ** рдЪрд░рдгреЛрдВ рдХреЛ **рджреЛрд╣рд░рд╛ рд╕рдХрддреЗ** рд╣реИрдВ рддрд╛рдХрд┐ **рдХрд┐рд╕реА рднреА рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рд╕рд╛рде рд╣реА, **рд╕реНрдкрд╖реНрдЯ-рдкрд╛рда рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рд╛рдкреНрдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
{% endhint %}

### рд╕реНрд╡рдд: SSO

PTA рдХреЗ рд╕рд╛рде рд╕реНрд╡рдд: SSO рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рдВрднрд╡ рд╣реИ, рдЬреЛ рдЕрдиреНрдп рджреБрд░реБрдкрдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдк рд╣реИред рдЗрд╕реЗ рдЬрд╛рдВрдЪреЗрдВ:

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://learn.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-pta](https://learn.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-pta)
* [https://aadinternals.com/post/on-prem\_admin/#pass-through-authentication](https://aadinternals.com/post/on-prem\_admin/#pass-through-authentication)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> рдХреЗ рд╕рд╛рде **рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ**!</summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **PDF рдореЗрдВ HackTricks рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рд╕реЗ рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ **PRs рд╕рдмрдорд┐рдЯ** рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВред

</details>
