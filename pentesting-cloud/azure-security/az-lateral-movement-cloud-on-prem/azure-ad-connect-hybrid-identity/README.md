# Az AD Connect - Identit√© Hybride

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informations de Base

**L'AD local** peut √™tre **int√©gr√©** avec Azure AD en utilisant **Azure AD Connect** avec les **m√©thodes** suivantes, qui pourraient √™tre exploit√©es pour compromettre le **cloud depuis l'AD local ou l'inverse (**ou les deux). Chaque m√©thode prend en charge la connexion unique (SSO) :

* **Synchronisation de Hash de Mot de Passe (PHS)** : Il est possible d'extraire les mots de passe des utilisateurs privil√©gi√©s en clair de l'AD, y compris les identifiants d'un utilisateur auto-g√©n√©r√© avec des privil√®ges √©lev√©s sur AzureAD.

{% content-ref url="phs-password-hash-sync.md" %}
[phs-password-hash-sync.md](phs-password-hash-sync.md)
{% endcontent-ref %}

* **Authentification Pass-Through (PTA)** : Il est possible de compromettre l'agent ex√©cut√© dans l'AD local pour valider tous les mots de passe des utilisateurs essayant de se connecter √† Azure (local -> Cloud) et il est √©galement possible d'enregistrer un nouvel agent pour valider l'authentification dans un nouvel endroit (Cloud -> local).

{% content-ref url="pta-pass-through-authentication.md" %}
[pta-pass-through-authentication.md](pta-pass-through-authentication.md)
{% endcontent-ref %}

* **F√©d√©ration** : Volez la cl√© priv√©e utilis√©e pour signer le SAML et vous pourrez vous faire passer pour des identit√©s locales et cloud.

{% content-ref url="federation.md" %}
[federation.md](federation.md)
{% endcontent-ref %}

* **SSO Transparent** : Volez le mot de passe de l'utilisateur auto-cr√©√© **AZUREADSSOACC** qui est utilis√© pour signer les tickets d'argent kerberos pour acc√©der √† AzureAD, et incarnez n'importe quel utilisateur dans le cloud.

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

* **Confiance Kerberos Cloud** : De l'Admin Global √† l'Admin de Domaine local en se faisant passer pour un utilisateur en modifiant le nom d'utilisateur et le SID des utilisateurs dans AzureAD, puis en demandant des TGTs √† AzureAD.

{% content-ref url="az-cloud-kerberos-trust.md" %}
[az-cloud-kerberos-trust.md](az-cloud-kerberos-trust.md)
{% endcontent-ref %}

Pour chaque m√©thode, au moins la **synchronisation des utilisateurs est effectu√©e** et un compte portant le nom **`MSOL_<installationidentifier>`** est cr√©√© sur **l'AD local**.

De plus, les m√©thodes **PHS** et **PTA** **supportent** le **SSO Transparent** pour se **connecter automatiquement dans Azure AD** sur les ordinateurs **reli√©s au domaine local**.

Il est possible de v√©rifier si **Azure AD Connect** est install√© avec cette commande du module AzureADConnectHealthSync qui est **install√© par d√©faut** lors de l'installation de **Azure AD Connect** :
```powershell
Get-ADSyncConnector
```
<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe t√©l√©gramme**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
