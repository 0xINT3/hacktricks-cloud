# Az AD Connect - ハイブリッドアイデンティティ

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でAWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい場合**は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)で**フォロー**する
- 自分のハッキングテクニックを共有するために、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出する

</details>

## 基本情報

**オンプレミスActive Directory（AD）**と**Azure AD**の間の統合は、**Azure AD Connect**によって容易に行われ、**シングルサインオン（SSO）**をサポートするさまざまな方法が提供されています。各方法は有用ですが、クラウドまたはオンプレミス環境を危険にさらす可能性のあるセキュリティ脆弱性が存在します。

- **Pass-Through Authentication (PTA)**:
    - オンプレミスAD上のエージェントが妥協され、Azure接続（オンプレミスからクラウドへ）のユーザーパスワードを検証することが可能になります。
    - 新しい場所で認証を検証するための新しいエージェントを登録する可能性があります（クラウドからオンプレミスへ）。

{% content-ref url="pta-pass-through-authentication.md" %}
[pta-pass-through-authentication.md](pta-pass-through-authentication.md)
{% endcontent-ref %}

- **Password Hash Sync (PHS)**:
    - ADから特権ユーザーのクリアテキストパスワード、高特権の自動生成されたAzureADユーザーの資格情報を抽出する可能性があります。

{% content-ref url="phs-password-hash-sync.md" %}
[phs-password-hash-sync.md](phs-password-hash-sync.md)
{% endcontent-ref %}

- **Federation**:
    - SAML署名に使用されるプライベートキーの盗難により、オンプレミスおよびクラウドのアイデンティティをなりすますことができます。

{% content-ref url="federation.md" %}
[federation.md](federation.md)
{% endcontent-ref %}

- **Seamless SSO:**
    - Kerberosシルバーチケットに署名するために使用される`AZUREADSSOACC`ユーザーのパスワードが盗まれると、任意のクラウドユーザーをなりすますことができます。

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

- **Cloud Kerberos Trust**:
    - AzureADユーザーのユーザー名とSIDを操作し、AzureADからTGTを要求することで、グローバル管理者からオンプレミスドメイン管理者に昇格する可能性があります。

{% content-ref url="az-cloud-kerberos-trust.md" %}
[az-cloud-kerberos-trust.md](az-cloud-kerberos-trust.md)
{% endcontent-ref %}

- **デフォルトアプリケーション**:
    - アプリケーション管理者アカウントまたはオンプレミス同期アカウントを妥協すると、ディレクトリ設定、グループメンバーシップ、ユーザーアカウント、SharePointサイト、OneDriveファイルを変更できます。

{% content-ref url="az-default-applications.md" %}
[az-default-applications.md](az-default-applications.md)
{% endcontent-ref %}

各統合方法では、ユーザー同期が実行され、オンプレミスADに`MSOL_<installationidentifier>`アカウントが作成されます。特に、**PHS**および**PTA**方法は**Seamless SSO**を可能にし、オンプレミスドメインに参加したAzure ADコンピューターに自動サインインを許可します。

**Azure AD Connect**のインストールを確認するために、次のPowerShellコマンドを使用できます。これは、**Azure AD Connect**とデフォルトでインストールされる**AzureADConnectHealthSync**モジュールを利用しています。
```powershell
Get-ADSyncConnector
```
<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でAWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)コレクションを見つける
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)を**フォロー**する
* **ハッキングトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください**

</details>
