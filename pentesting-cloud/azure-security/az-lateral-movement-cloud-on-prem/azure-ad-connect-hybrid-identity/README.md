# Az AD Connect - Υβριδική Ταυτότητα

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Βασικές Πληροφορίες

Η ενσωμάτωση μεταξύ του **On-premises Active Directory (AD)** και του **Azure AD** διευκολύνεται από το **Azure AD Connect**, προσφέροντας διάφορες μεθόδους που υποστηρίζουν το **Single Sign-on (SSO)**. Κάθε μέθοδος, ενώ είναι χρήσιμη, παρουσιάζει δυνητικά κενά ασφαλείας που μπορούν να εκμεταλλευτούν για να διακυβευτούν περιβάλλοντα στο cloud ή on-premises:

* **Pass-Through Authentication (PTA)**:
- Πιθανή διάρρηξη του πράκτορα στο on-prem AD, επιτρέποντας την επαλήθευση των κωδικών πρόσβασης των χρηστών για συνδέσεις Azure (on-prem στο Cloud).
- Εφικτότητα εγγραφής ενός νέου πράκτορα για την επαλήθευση των ταυτοποιήσεων σε νέα τοποθεσία (Cloud στο on-prem).

{% content-ref url="pta-pass-through-authentication.md" %}
[pta-pass-through-authentication.md](pta-pass-through-authentication.md)
{% endcontent-ref %}

* **Password Hash Sync (PHS)**:
- Πιθανή εξαγωγή καθαρού κειμένου κωδικών πρόσβασης προνομιούχων χρηστών από το AD, συμπεριλαμβανομένων των διαπιστευτηρίων ενός χρήστη AzureAD που δημιουργείται αυτόματα με υψηλά προνόμια.

{% content-ref url="phs-password-hash-sync.md" %}
[phs-password-hash-sync.md](phs-password-hash-sync.md)
{% endcontent-ref %}

* **Federation**:
- Κλοπή του ιδιωτικού κλειδιού που χρησιμοποιείται για την υπογραφή SAML, επιτρέποντας την παραπλάνηση ταυτοτήτων on-prem και cloud.

{% content-ref url="federation.md" %}
[federation.md](federation.md)
{% endcontent-ref %}

* **Seamless SSO:**
- Κλοπή του κωδικού πρόσβασης του χρήστη `AZUREADSSOACC`, που χρησιμοποιείται για την υπογραφή των ασημένιων εισιτηρίων Kerberos, επιτρέποντας την παραπλάνηση οποιουδήποτε χρήστη του cloud.

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

* **Cloud Kerberos Trust**:
- Δυνατότητα ανόδου από τον Global Admin σε on-prem Domain Admin με την παραπλάνηση των ονομάτων χρηστών και των SIDs των χρηστών AzureAD και την αίτηση TGTs από το AzureAD.

{% content-ref url="az-cloud-kerberos-trust.md" %}
[az-cloud-kerberos-trust.md](az-cloud-kerberos-trust.md)
{% endcontent-ref %}

* **Default Applications**:
- Η διάρρηξη ενός λογαριασμού Διαχειριστή Εφαρμογής ή του λογαριασμού συγχρονισμού on-premise επιτρέπει την τροποποίηση των ρυθμίσεων καταλόγου, την ένταξη σε ομάδες, τη δημιουργία χρηστών, τη δημιουργία ιστότοπων SharePoint και την τροποποίηση αρχείων OneDrive.

{% content-ref url="az-default-applications.md" %}
[az-default-applications.md](az-default-applications.md)
{% endcontent-ref %}

Για κάθε μέθοδο ενσωμάτωσης, γίνεται συγχρονισμός των χρηστών και δημιουργείται ένας λογαριασμός `MSOL_<installationidentifier>` στο on-prem AD. Είναι σημαντικό να σημειωθεί ότι και οι δύο μέθοδοι **PHS** και **PTA** διευκολύνουν το **Seamless SSO**, επιτρέποντας την αυτόματη σύνδεση για υπολογιστές Azure AD που είναι ενταγμένοι στο on-prem domain.

Για να επαληθεύσετε την εγκατάσταση του **Azure AD Connect**, μπορείτε να χρησιμοποιήσετε την παρακάτω εντολή PowerShell, χρησιμοποιώντας το **AzureADConnectHealthSync** module (που εγκαθίσταται από προεπιλογή με το Azure AD Connect):
```powershell
Get-ADSyncConnector
```
<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
