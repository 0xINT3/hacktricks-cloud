# Az AD Connect - ハイブリッドアイデンティティ

<details>

<summary><strong>AWSのハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をご覧ください！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをご覧ください
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローしてください。**
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有してください。

</details>

## 基本情報

**オンプレミスAD**は、以下の**方法**を使用してAzure ADと**統合**され、**オンプレミスADからクラウドへ、またはその逆（**または両方）の侵害に悪用される可能性があります。各方法はシングルサインオン(SSO)をサポートしています：

* **Password Hash Sync (PHS)**: ADから特権ユーザーのパスワードをクリアテキストで抽出することが可能で、AzureAD上で高い権限を持つ自動生成されたユーザーの資格情報も含まれます。

{% content-ref url="phs-password-hash-sync.md" %}
[phs-password-hash-sync.md](phs-password-hash-sync.md)
{% endcontent-ref %}

* **Pass-Through Authentication (PTA)**: オンプレミスADで実行されているエージェントを**侵害**し、Azureに接続しようとするユーザーのすべてのパスワードを**検証**することが可能で、新しい場所で認証を検証するために**新しいエージェントを登録**することも可能です（クラウド -> オンプレミス）。

{% content-ref url="pta-pass-through-authentication.md" %}
[pta-pass-through-authentication.md](pta-pass-through-authentication.md)
{% endcontent-ref %}

* **Federation**: SAMLに署名するために使用される**秘密鍵**を盗み、オンプレミスとクラウドのアイデンティティになりすますことができます。

{% content-ref url="federation.md" %}
[federation.md](federation.md)
{% endcontent-ref %}

* **Seamless SSO:** 自動生成されたユーザー**AZUREADSSOACC**のパスワードを盗み、AzureADへのアクセスに使用されるkerberos silver tcketsに署名し、クラウド内の任意のユーザーになりすます。

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

* **Cloud Kerberos Trust**: AzureAD内のユーザーのユーザー名とSIDを変更し、TGTをAzureADに要求することで、**Global AdminからオンプレミスのDomain Admin**になりすます。

{% content-ref url="az-cloud-kerberos-trust.md" %}
[az-cloud-kerberos-trust.md](az-cloud-kerberos-trust.md)
{% endcontent-ref %}

* **Default Applications**: **Application Administrator**アカウントまたは**オンプレミスSyncアカウント**を侵害すると、ディレクトリ設定、グループメンバーシップ、ユーザーアカウント、SharePointサイト、OneDriveファイルの読み取りと**変更**が可能です。

{% content-ref url="az-default-applications.md" %}
[az-default-applications.md](az-default-applications.md)
{% endcontent-ref %}

各方法について、少なくとも**ユーザー同期が行われ**、**オンプレミスAD**に**`MSOL_<installationidentifier>`**という名前のアカウントが作成されます。

さらに、**PHS**と**PTA**は、**オンプレミスドメインに参加しているAzure AD**コンピューターで自動的に**サインインする**ための**Seamless SSO**を**サポート**しています。

**Azure AD Connect**がインストールされているかどうかは、**Azure AD Connect**のインストール時に**デフォルトでインストールされる**AzureADConnectHealthSyncモジュールからこのコマンドで確認できます：
```powershell
Get-ADSyncConnector
```
<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい場合**、または**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローする**。
* **HackTricks**の[**GitHubリポジトリ**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出して、あなたのハッキングのコツを共有する。

</details>
