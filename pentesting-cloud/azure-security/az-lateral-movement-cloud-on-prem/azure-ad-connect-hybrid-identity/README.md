# Az AD Connect - Identit√† ibrida

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informazioni di base

L'integrazione tra **Active Directory (AD) in locale** e **Azure AD** √® facilitata da **Azure AD Connect**, che offre vari metodi che supportano **Single Sign-on (SSO)**. Ogni metodo, sebbene utile, presenta potenziali vulnerabilit√† di sicurezza che potrebbero essere sfruttate per compromettere ambienti cloud o in locale:

* **Pass-Through Authentication (PTA)**:
- Possibile compromissione dell'agente sull'AD in locale, consentendo la convalida delle password degli utenti per le connessioni Azure (in locale al Cloud).
- Possibilit√† di registrare un nuovo agente per convalidare le autenticazioni in una nuova posizione (Cloud all'in locale).

{% content-ref url="pta-pass-through-authentication.md" %}
[pta-pass-through-authentication.md](pta-pass-through-authentication.md)
{% endcontent-ref %}

* **Password Hash Sync (PHS)**:
- Possibile estrazione delle password in chiaro degli utenti privilegiati dall'AD, inclusa la credenziale di un utente AzureAD generato automaticamente con privilegi elevati.

{% content-ref url="phs-password-hash-sync.md" %}
[phs-password-hash-sync.md](phs-password-hash-sync.md)
{% endcontent-ref %}

* **Federazione**:
- Furto della chiave privata utilizzata per la firma SAML, consentendo l'usurpazione delle identit√† in locale e nel cloud.

{% content-ref url="federation.md" %}
[federation.md](federation.md)
{% endcontent-ref %}

* **Seamless SSO:**
- Furto della password dell'utente `AZUREADSSOACC`, utilizzata per la firma dei biglietti Kerberos silver, consentendo l'usurpazione di qualsiasi utente cloud.

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

* **Cloud Kerberos Trust**:
- Possibilit√† di scalare da Global Admin a on-prem Domain Admin manipolando i nomi utente e gli SIDs degli utenti AzureAD e richiedendo TGT da AzureAD.

{% content-ref url="az-cloud-kerberos-trust.md" %}
[az-cloud-kerberos-trust.md](az-cloud-kerberos-trust.md)
{% endcontent-ref %}

* **Applicazioni predefinite**:
- Compromissione di un account amministratore dell'applicazione o dell'account di sincronizzazione in locale consente la modifica delle impostazioni della directory, l'appartenenza ai gruppi, gli account utente, i siti SharePoint e i file di OneDrive.

{% content-ref url="az-default-applications.md" %}
[az-default-applications.md](az-default-applications.md)
{% endcontent-ref %}

Per ogni metodo di integrazione, viene eseguita la sincronizzazione degli utenti e viene creato un account `MSOL_<installationidentifier>` nell'AD in locale. In particolare, sia i metodi **PHS** che **PTA** facilitano **Seamless SSO**, consentendo l'accesso automatico per i computer di Azure AD associati al dominio in locale.

Per verificare l'installazione di **Azure AD Connect**, √® possibile utilizzare il seguente comando PowerShell, utilizzando il modulo **AzureADConnectHealthSync** (installato per impostazione predefinita con Azure AD Connect):
```powershell
Get-ADSyncConnector
```
<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) su GitHub.

</details>
