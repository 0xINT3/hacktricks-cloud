# Az AD Connect - Karma Kimlik

<details>

<summary><strong>AWS hackleme becerilerini sıfırdan kahraman seviyesine öğrenmek için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>'ı öğrenin!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına **PR göndererek paylaşın**.

</details>

## Temel Bilgiler

**Yerel Active Directory (AD)** ile **Azure AD** arasındaki entegrasyon, **Azure AD Connect** tarafından sağlanır ve **Tek Oturum Açma (SSO)**'yı destekleyen çeşitli yöntemler sunar. Her bir yöntem, kullanışlı olmasına rağmen, bulut veya yerel ortamları tehlikeye atabilecek potansiyel güvenlik açıklarını sunar:

* **Pass-Through Authentication (PTA)**:
- Yerel AD'deki ajanın ele geçirilmesiyle, Azure bağlantıları için kullanıcı parolalarının doğrulanmasına izin verilir (yerelden buluta).
- Yeni bir ajanın kaydedilerek doğrulamaların yeni bir konumda yapılabilmesi (Buluttan yerele).

{% content-ref url="pta-pass-through-authentication.md" %}
[pta-pass-through-authentication.md](pta-pass-through-authentication.md)
{% endcontent-ref %}

* **Password Hash Sync (PHS)**:
- AD'deki ayrıcalıklı kullanıcıların açık metin parolalarının, yüksek ayrıcalıklı, otomatik oluşturulan bir AzureAD kullanıcısının kimlik bilgileri dahil olmak üzere çıkarılması potansiyeli.

{% content-ref url="phs-password-hash-sync.md" %}
[phs-password-hash-sync.md](phs-password-hash-sync.md)
{% endcontent-ref %}

* **Federasyon**:
- SAML imzalama için kullanılan özel anahtarın çalınmasıyla, yerel ve bulut kimliklerinin taklit edilmesi sağlanır.

{% content-ref url="federation.md" %}
[federation.md](federation.md)
{% endcontent-ref %}

* **Seamless SSO:**
- `AZUREADSSOACC` kullanıcısının parolasının çalınmasıyla, Kerberos gümüş biletlerini imzalamak için kullanılan ve herhangi bir bulut kullanıcısının taklit edilmesine izin veren bir kullanıcı.

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

* **Cloud Kerberos Trust**:
- AzureAD'den TGT talep ederek, AzureAD kullanıcı adlarını ve SIDs'lerini manipüle ederek Global Admin'den yerel Domain Admin'e yükseltme olasılığı.

{% content-ref url="az-cloud-kerberos-trust.md" %}
[az-cloud-kerberos-trust.md](az-cloud-kerberos-trust.md)
{% endcontent-ref %}

* **Varsayılan Uygulamalar**:
- Bir Uygulama Yönetici hesabının veya yerel Senkronizasyon Hesabının ele geçirilmesi, dizin ayarlarının, grup üyeliklerinin, kullanıcı hesaplarının, SharePoint sitelerinin ve OneDrive dosyalarının değiştirilmesine olanak sağlar.

{% content-ref url="az-default-applications.md" %}
[az-default-applications.md](az-default-applications.md)
{% endcontent-ref %}

Her entegrasyon yöntemi için kullanıcı senkronizasyonu gerçekleştirilir ve on-prem AD'de bir `MSOL_<installationidentifier>` hesabı oluşturulur. Özellikle, **PHS** ve **PTA** yöntemleri, on-prem etki alanına katılan Azure AD bilgisayarları için otomatik oturum açmayı sağlayan **Seamless SSO**'yu kolaylaştırır.

**Azure AD Connect**'in kurulumunu doğrulamak için aşağıdaki PowerShell komutu, varsayılan olarak Azure AD Connect ile birlikte yüklenen **AzureADConnectHealthSync** modülünü kullanabilirsiniz:
```powershell
Get-ADSyncConnector
```
<details>

<summary><strong>AWS hackleme becerilerini sıfırdan kahraman seviyesine öğrenmek için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>'ı öğrenin!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek isterseniz** veya **HackTricks'i PDF olarak indirmek isterseniz** [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'ı takip edin.**
* **Hacking hilelerinizi paylaşarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR göndererek katkıda bulunun.

</details>
