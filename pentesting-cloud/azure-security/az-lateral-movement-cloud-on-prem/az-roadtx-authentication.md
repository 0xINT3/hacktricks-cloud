# Az - Roadtx - рдкреНрд░рдорд╛рдгреАрдХрд░рдг

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

**рдкреЛрд╕реНрдЯ рдХреЙрдкреА рдХреА рдЧрдИ** [**https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/**](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

ROADtools Token eXchange (roadtx) Azure AD рджреНрд╡рд╛рд░рд╛ рдЬрд╛рд░реА рдХрд┐рдП рдЧрдП рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдЯреЛрдХрдиреЛрдВ рдХреЛ **рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ**ред рдпрд╣ рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣реЛрдВ, рдбрд┐рд╡рд╛рдЗрд╕ рдкрдВрдЬреАрдХрд░рдг рдФрд░ PRT рд╕рдВрдмрдВрдзрд┐рдд рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред

рдпрд╣ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдп рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

* Azure AD рдореЗрдВ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рдирд╛ рдФрд░ рдЬреЛрдбрд╝рдирд╛ред
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдпрд╛ рдЕрдиреНрдп рдорд╛рдиреНрдп рдЯреЛрдХрдиреЛрдВ рд╕реЗ рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдирд╛ред
* рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛, рдЬреИрд╕реЗ рдХрд┐ Windows рдореЗрдВ Web Account Manager (WAM) рдХрд░рддрд╛ рд╣реИред
* рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ Oauth2 рдЯреЛрдХрди рд░рд┐рдбреЗрдореНрдкрд╢рди рдкреНрд░рд╡рд╛рд╣реЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рди рдХрд░рдирд╛ред
* рдмреНрд░рд╛рдЙрдЬрд╝рд░ SSO рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд▓реЙрдЧрд┐рди рдХрд░рдирд╛, рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣ рдореЗрдВ рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдХреЗред
* Windows 10 рдЦрд╛рддреЛрдВ рдкреНрд▓рдЧрдЗрди рдФрд░ рдПрдХ рдХрд╕реНрдЯрдо browsercore рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ Chrome рдореЗрдВ SSO рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ред
* Selenium рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Azure AD рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд╛рдЗрди-рдЗрди, MFA рдФрд░ рдЯреЛрдХрди рдЕрдиреБрд░реЛрдз рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдирд╛ред
* рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкреНрд░рд╡рд╛рд╣реЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП KeePass рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдФрд░ MFA TOTP рдмреАрдЬреЛрдВ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ред

## рдбрд┐рд╡рд╛рдЗрд╕ рдкрдВрдЬреАрдХрд░рдг

roadtx рдХреЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдореЙрдбреНрдпреВрд▓ рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдФрд░ рдбрд┐рд╡рд╛рдЗрд╕ рдкрд╣рдЪрд╛рдиреЛрдВ рдХреЗ рдЖрд╕рдкрд╛рд╕ рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдП рдЧрдП рд╣реИрдВред **PRT рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдкрд╣рд▓реЗ Azure AD рдореЗрдВ рдПрдХ рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛**ред\
рдбрд┐рд╡рд╛рдЗрд╕ рдкрдВрдЬреАрдХрд░рдг рдХреЗ рд▓рд┐рдП **рдЖрд╡рд╢реНрдпрдХ рд╣реИ** рдПрдХ **рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди** рдбрд┐рд╡рд╛рдЗрд╕ рдкрдВрдЬреАрдХрд░рдг рд╕реЗрд╡рд╛ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд▓рд┐рдПред рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдПрдХ **рдбрд┐рд╡рд╛рдЗрд╕ рджрд╛рд╡реЗ рдХреЗ рдмрд┐рдирд╛ рдЯреЛрдХрди** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП рдЖрдк рдПрдХрд▓ рд╕рд╛рдЗрди-рдСрди рдпрд╛ рдореМрдЬреВрджрд╛ PRT рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдХрд╛ рдЕрдиреБрд░реЛрдз рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред roadtx рдХреЗ рд╕рд╛рде рдРрд╕рд╛ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ **рдХреБрдЫ рддрд░реАрдХреЗ рд╣реИрдВ**, рдЬрд╣рд╛рдВ рдХреБрдЫ рд╡рд┐рдзрд┐рдпрд╛рдВ MFA рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреА рд╣реИрдВ рдФрд░ рдХреБрдЫ рдирд╣реАрдВ рдХрд░рддреА рд╣реИрдВред\
**рдЯреЗрдиреЗрдВрдЯ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдбрд┐рд╡рд╛рдЗрд╕ рдкрдВрдЬреАрдХрд░рдг рдХреЗ рд▓рд┐рдП MFA рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ**ред рдпрджрд┐ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдк рдХреЗрд╡рд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рдбрд┐рд╡рд╛рдЗрд╕ рдкрдВрдЬреАрдХрд░рдг рд╕реЗрд╡рд╛ (рдпрд╣рд╛рдВ _devicereg_ рдЙрдкрдирд╛рдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ) рдХреЗ рд▓рд┐рдП рдПрдХ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
roadtx gettokens -u myuser@mytenant.com -p password -r devicereg
```
рдпрджрд┐ MFA рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рддреЛ рдЖрдк **рдХрд╣реАрдВ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╡рд┐рдВрдбреЛ** рд╕реЗ рдЯреЛрдХрдиреНрд╕ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рд╡рд╛рдЗрд╕ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
roadtx gettokens --device-auth -r devicereg
```
рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ, рд╣рдо **MFA рдХреЗ рд▓рд┐рдП Selenium рдЖрдзрд╛рд░рд┐рдд рд╡рд┐рдВрдбреЛ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬрдмрдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо + рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рд╕реНрд╡рдд: рднрд░рддреЗ рд╣реИрдВ:
```bash
roadtx interactiveauth -u myuser@mytenant.com -p password -r devicereg
```
рдЙрдкрд░реЛрдХреНрдд рдХреЛрдИ рднреА рдХрдорд╛рдВрдб **`.roadtools_auth` рдлрд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рд╕рд╣реЗрдЬреЗрдЧрд╛**ред рдбрд┐рд╡рд╛рдЗрд╕ рдкрдВрдЬреАрдХрд░рдг рдХрдорд╛рдВрдб рдЗрд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЗрд╕ рдлрд╛рдЗрд▓ рд╕реЗ рд▓реЛрдб рдХрд░реЗрдЧрд╛ред рдЖрдк `roadtx device` рдореЙрдбреНрдпреВрд▓ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдХрдорд╛рдВрдбрд▓рд╛рдЗрди рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреЗ рд╕рд╛рде рдбрд┐рд╡рд╛рдЗрд╕ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдЕрдкрдиреА рдкрд╕рдВрдж рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../../../.gitbook/assets/image (4) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

рд╣рдо тАЬblogdeviceтАЭ рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ Azure AD рдЬреБрдбрд╝реА рдбрд┐рд╡рд╛рдЗрд╕ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рддреЗ рд╣реИрдВ:
```bash
roadtx device -n blogdevice
Saving private key to blogdevice.key
Registering device
Device ID: 5f138d8b-6416-448d-89ef-9b279c419943
Saved device certificate to blogdevice.pem
```
рд╣рдореЗрдВ рдЕрдкрдиреЗ рдбрд┐рд╡рд╛рдЗрд╕ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рджреЛ рдбреЗрдЯрд╛ рдорд┐рд▓рддреЗ рд╣реИрдВ: рдкрд╣рд▓рд╛ рд╣реИ **рдбрд┐рд╡рд╛рдЗрд╕ рдкреНрд░рдорд╛рдгрдкрддреНрд░** рдЬреЛ `blogdevice.pem` рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕реЗ Azure AD рджреНрд╡рд╛рд░рд╛ рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ **рд╣рдорд╛рд░реЗ рдбрд┐рд╡рд╛рдЗрд╕ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ**ред рджреВрд╕рд░рд╛ рднрд╛рдЧ `blogdevice.key` рдлрд╝рд╛рдЗрд▓ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА **рдирд┐рдЬреА рдХреБрдВрдЬреА** рд╣реЛрддреА рд╣реИ рдФрд░ рдпрд╣ рдкрд░рд┐рд╡рд╣рди рдХреБрдВрдЬреА рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИред рдЕрдм рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдбрд┐рд╡рд╛рдЗрд╕ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╣реИ, рд╣рдо **рдЙрди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдирдХреЗ рд▓рд┐рдП рдбрд┐рд╡рд╛рдЗрд╕ рдХреА рдкрд╣рдЪрд╛рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ**ред рд╕рдмрд╕реЗ рдЙрдкрдпреЛрдЧреА **рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдирд╛** рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рд╕реЗ рд╣рдореЗрдВ рдЕрдкрдиреЗ (рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рдпрд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд) рдЯреЛрдХрди рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рд╕рд┐рдВрдЧрд▓ рд╕рд╛рдЗрди рдСрди рдХреНрд╖рдорддрд╛рдПрдВ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реЗрдЧреАред

## рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз <a href="#requesting-a-primary-refresh-token" id="requesting-a-primary-refresh-token"></a>

рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдЕрдХреНрд╕рд░ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЬрдм рдЖрдк рдЕрдкрдиреЗ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб** рдХреЗ рд╕рд╛рде Azure AD рдореЗрдВ рдЬреБрдбрд╝реЗ рдпрд╛ рд╣рд╛рдЗрдмреНрд░рд┐рдб рдЬреБрдбрд╝реЗ рд╡рд░реНрдХрд╕реНрдЯреЗрд╢рди рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░рддреЗ рд╣реИрдВ, рд╡рд┐рдВрдбреЛрдЬ рддреБрд░рдВрдд Azure AD рд╕реЗ **PRT рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ**ред рдореИрдВрдиреЗ рдЗрд╕ рдкреНрд░рд╡рд╛рд╣ рдХреЗ рдкреАрдЫреЗ рдХреА рддрдХрдиреАрдХреА рдмрд╛рддреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдореЗрд░реЗ Troopers рдФрд░ Romhack [рд╡рд╛рд░реНрддрд╛](https://dirkjanm.io/talks/) рдореЗрдВ рдкрд╣рд▓реЗ рдЪрд░реНрдЪрд╛ рдХреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдк рддрдХрдиреАрдХреА рдмрд╛рддреЛрдВ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ рддреЛ рдЙрди рд╕реНрд▓рд╛рдЗрдбреНрд╕ рдХреЛ рдкрдврд╝реЗрдВред **roadtx рдХреЗ рд╕рд╛рде PRT рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, `roadtx prt` рдХрдорд╛рдВрдб рдЪрд▓рд╛рдПрдВ**, рдбрд┐рд╡рд╛рдЗрд╕ рд╕рд░реНрдЯ/рдХреА рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо + рдкрд╛рд╕рд╡рд░реНрдб рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ, рдФрд░ рдЖрдкрдХреЛ PRT рдорд┐рд▓ рдЬрд╛рдПрдЧрд╛:

{% code overflow="wrap" %}
```bash
roadtx prt -u myuser@mytenant.com -p password --key-pem blogdevice.key --cert-pem blogdevice.pem
```
```
рдпрд╣ рдХрдорд╛рдВрдб рд╣рдореЗрдВ рдПрдХ **PRT** (рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдЯреЛрдХрди рдХреЗ рд░реВрдк рдореЗрдВ), рдФрд░ рдПрдХ **рд╕реЗрд╢рди рдХреА** рджреЗрдЧрд╛ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдореЗрдВ PRT рдХреЗ рд╕рд╛рде рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред PRT рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `roadtx.prt` рдореЗрдВ рд╕реЗрд╡ рд╣реЛрддрд╛ рд╣реИ, рдЬрд╣рд╛рдБ рд╕реЗ рдЕрдиреНрдп roadtx рдореЙрдбреНрдпреВрд▓реНрд╕ рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

PRT рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ 90 рджрд┐рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдп рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕реЗ рдХрд┐рд╕реА рднреА рд╕рдордп **рдирд╡реАрдиреАрдХреГрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рддрд╛рдХрд┐ рдЗрд╕рдХреА рд╡реИрдзрддрд╛ рдХреЛ рдЕрдиреНрдп 90 рджрд┐рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдмрдврд╝рд╛ рд╕рдХреЗрдВ `renew` рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде:
```
```bash
roadtx prt -a renew
Renewing PRT
Saved PRT to roadtx.prt
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣рд╛рдБ рд╣рдордиреЗ рдЬреЛ PRT рдорд╛рдВрдЧрд╛ рд╣реИ рд╡рд╣ рдХреЗрд╡рд▓ рдкрд╛рд╕рд╡рд░реНрдб рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ, рдЗрд╕рд▓рд┐рдП **рдХреЛрдИ рднреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЬрд┐рд╕рдореЗрдВ MFA рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рд╡рд╣ рдЕрд╕рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ рднрд▓реЗ рд╣реА рд╣рдо PRT рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**ред рд╣рдо PRT рдХреЛ MFA рджрд╛рд╡реЗ рдХреЗ рд╕рд╛рде рднреА рдЙрдиреНрдирдд рдпрд╛ "рд╕рдореГрджреНрдз" рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рдЕрдЧрд▓реЗ рдЦрдВрдб рдореЗрдВ Selenium рдЖрдзрд╛рд░рд┐рдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкрд░ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред

## рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдкрд░ рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ <a href="#using-primary-refresh-tokens-on-the-command-line" id="using-primary-refresh-tokens-on-the-command-line"></a>

рдПрдХ рдмрд╛рд░ рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ PRT рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **Azure AD рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдореЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк рдпрд╣ рдХрд╛рдо **`roadtx gettokens`** рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдкрд░ PRT рдФрд░ рд╕рддреНрд░ рдХреБрдВрдЬреА **рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдпрд╛ **`roadtx prtauth`** рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрди рджреЛрдиреЛрдВ рдХреЗ рдмреАрдЪ рдХрд╛ рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ **`gettokens`** рдХрдорд╛рдВрдб рдЙрд╕ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ рдЬреЛ **рдХреНрд░реЛрдо рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рд╕рд┐рдВрдЧрд▓ рд╕рд╛рдЗрди рдСрди рдХреИрд╕реЗ рдХрд░рддрд╛ рд╣реИ** рдЙрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рдзрд┐ рдереЛрдбрд╝реА рд╣реИрдХреА рд╣реИ рдФрд░ рдЕрдЧрд░ рдпрд╣ рдЕрд╕рдлрд▓ рд╣реЛрддреА рд╣реИ рддреЛ рдЖрдкрдХреЛ рдХреЛрдИ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдирд╣реАрдВ рджреЗрдЧреАред

**`prtauth`** рдореЙрдбреНрдпреВрд▓ рдХреЗ рдмрдЬрд╛рдп **Windows рдХреЗ Web Account Manager (WAM)** рдХреА рдирдХрд▓ рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдк рдХрд┐рд╕реА рдРрдк рдпрд╛ рдиреЗрдЯрд┐рд╡ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдорд╛рдВрдЧрддреЗ рд╕рдордп рдХрд░рддреЗ рд╣реИрдВред WAM рдПрдХ рдЯреЛрдХрди рдмреНрд░реЛрдХрд░ рдХреА рддрд░рд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЕрдиреНрдп рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдХреА рдУрд░ рд╕реЗ рдЯреЛрдХрди рдХреА рдорд╛рдВрдЧ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╕рд╛рдЗрди рдХрд┐рдП рдЧрдП рдЕрдиреБрд░реЛрдзреЛрдВ рдФрд░ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рд╕рдВрдпреЛрдЬрди рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЯреЛрдХрди рдХреЛ рдЯреНрд░рд╛рдВрдЬрд┐рдЯ рдореЗрдВ рдЙрдЬрд╛рдЧрд░ рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдпрд╣ рд╕рдм PRT рд╕рддреНрд░ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, `roadtx prtauth` рдореЙрдбреНрдпреВрд▓ **Azure AD PowerShell Module client ID** рдФрд░ Azure AD рдЧреНрд░рд╛рдл рдХреЛ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛, рд▓реЗрдХрд┐рди рдЖрдк рдХрд┐рд╕реА рдЕрдиреНрдп рдХреНрд▓рд╛рдЗрдВрдЯ ID рдпрд╛ рд╕рдВрд╕рд╛рдзрди URL рдХреЛ рдЙрд╕рдХреЗ рдкреВрд░реНрдг рднрд╛рдЧ рдпрд╛ рдПрдХ рдЙрдкрдирд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЬрд┐рд╕реЗ `roadtx listaliases` рдХреЗ рд╕рд╛рде рд╕реВрдЪреАрдмрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ):
```bash
roadtx prtauth
Tokens were written to .roadtools_auth
```
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП Azure CLI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдХреНрд▓рд╛рдЗрдВрдЯ ID рдФрд░ Azure Resource Manager рдХреЗ рд▓рд┐рдП рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдирд╛:
```bash
roadtx prtauth -c azcli -r azrm
Tokens were written to .roadtools_auth
```
рдЖрдк рдЕрдиреНрдп рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдпрд╛ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рдРрдк рдХреЗ рд▓рд┐рдП рд╕рд╣реА рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ URL рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рд╡рд┐рдХрд▓реНрдк рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Selenium рдЖрдзрд╛рд░рд┐рдд Azure AD рдкреНрд░рдорд╛рдгреАрдХрд░рдг <a href="#selenium-based-azure-a-d-authentication" id="selenium-based-azure-a-d-authentication"></a>

рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдЖрдзрд╛рд░рд┐рдд рдЯреЛрдХрди рдЕрдиреБрд░реЛрдз рдФрд░ рдЙрдкрдпреЛрдЧ рдЕрдЪреНрдЫреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдХреНрд╕рд░ рдЖрдкрдХреЛ рдХреБрдЫ рдРрд╕реЗ рдкреНрд░рд╡рд╛рд╣ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝реЗрдЧрд╛ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╡рд┐рдВрдбреЛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддрд╛рдХрд┐ Multi Factor Authentication рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдпрд╛ рдЖрдк рд╕рд┐рд░реНрдл рдЕрдкрдиреЗ PRT рдХрд╛ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рддрд░реАрдХреЗ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ Azure Portal рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░рдирд╛ рдпрд╛ рдЕрдкрдирд╛ рдореЗрд▓ рдкрдврд╝рдирд╛ рдЪреЛрд░реА рдХрд┐рдП рдЧрдП PRT рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред

Selenium рдЖрдзрд╛рд░рд┐рдд рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рд╕рд┐рджреНрдзрд╛рдВрдд roadtx рдореЗрдВ рд╕рд░рд▓ рд╣реИ: **рдпрд╣ рдПрдХ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╡рд┐рдВрдбреЛ рд▓реЙрдиреНрдЪ рдХрд░рддрд╛ рд╣реИ, рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдХрдорд╛рдВрдб рдореЗрдВ рджреА рдЧрдИ рдХрд┐рд╕реА рднреА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЛ рдСрдЯреЛрдлрд┐рд▓ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЖрдкрдХреЛ рдмрд╛рдХреА рд╣рд╛рде рд╕реЗ рднрд░рдиреЗ рджреЗрддрд╛ рд╣реИ**ред рдпрджрд┐ рдЖрдкрдХреЗ рдЦрд╛рддреЗ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╕реЗрдЯ рдЕрдк рд╣реИрдВ, рддреЛ рдпрд╣ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХрд░реЗрдЧрд╛ред

### рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рдкреНрд░рдорд╛рдгреАрдХрд░рдг <a href="#interactive-authentication" id="interactive-authentication"></a>

рд╕рдмрд╕реЗ рд╕рд░рд▓ рд░реВрдк рдореЗрдВ, roadtx рдЖрдкрдХреЗ рд▓рд┐рдП рдПрдХ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд▓реЙрдиреНрдЪ рдХрд░реЗрдЧрд╛, рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕реЗрд╡рд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдЧрд╛, рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рд╕реА рднреА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдХреЛ рднрд░реЗрдЧрд╛, рдФрд░ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг:
```bash
roadtx interactiveauth -u myuser@mytenant.com -p password
```
### KeePass рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд┐рднрд┐рдиреНрди рдЦрд╛рддреЛрдВ рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП <a href="#keepass-credentials-based-authentication" id="keepass-credentials-based-authentication"></a>

**`roadtx`** **kdbx рдлрд╝рд╛рдЗрд▓** (KeePass рдлрд╝рд╛рдЗрд▓) рдпрд╛ KeePass XML рдирд┐рд░реНрдпрд╛рдд рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рд╛рдЦ рдФрд░ TOTP рдЖрдзрд╛рд░рд┐рдд MFA рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рд╕реНрд░реЛрдд рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, **`roadtx keepassauth`** рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдпрд╣ **KeePass** рдлрд╝рд╛рдЗрд▓ рдХреЛ **`-kp`** рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдпрджрд┐ рдЖрдк рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ рддреЛ рдпрд╣ рд╡рд░реНрддрдорд╛рди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗ `roadtx.kdbx` рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИред KeePass рдлрд╝рд╛рдЗрд▓ рдХрд╛ **рдкрд╛рд╕рд╡рд░реНрдб** **`-kpp`** рдХреЗ рд╕рд╛рде рдпрд╛ `KPPASS` рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдПрдХрдорд╛рддреНрд░ **рдЖрд╡рд╢реНрдпрдХ** рдкреИрд░рд╛рдореАрдЯрд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рд╣реИ, рдЬрд┐рд╕реЗ рдпрд╣ KeePass рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЦреЛрдЬреЗрдЧрд╛ред рдпрд╣ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рд╕реНрд╡рддрдГ рднрд░ рджреЗрдЧрд╛ рдФрд░ рдпрджрд┐ рдЦрд╛рддреЗ рдкрд░ "рдореЛрдмрд╛рдЗрд▓ рдРрдк OTP" MFA рд╡рд┐рдзрд┐ рд╕рдХреНрд╖рдо рд╣реИ рддреЛ OTP рдХреЛрдб рднреАред рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ TOTP рдмреАрдЬ рдХреЛ KeePass рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкрд╣рдЪрд╛рди рдХреЗ `otp` рдЕрддрд┐рд░рд┐рдХреНрдд рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рдПред KeePass рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдФрд░ рдХреБрдЫ рд╕рд╛рд╡рдзрд╛рдирд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП, [roadtx wiki](https://github.com/dirkjanm/ROADtools/wiki/ROADtools-Token-eXchange-\(roadtx\)) рджреЗрдЦреЗрдВред

[**рд╡реАрдбрд┐рдпреЛ рдбреЗрдореЛ**](https://dirkjanm.io/assets/video/selenium\_kpautofill.mp4) рджреЗрдЦреЗрдВред

рд╕реАрдзреЗ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдк рдЗрд╕реЗ рд╕реНрд╡рддрдГ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╕рд╛рде рдПрдХ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╡рд┐рдВрдбреЛ рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ URL рдореИрдиреНрдпреБрдЕрд▓реА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ рдЬреЛ рдЖрдкрдХреЛ Microsoft рд╕рд╛рдЗрди-рдЗрди рдкреЗрдЬ рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░реЗрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `-url https://myaccount.microsoft.com` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдПрдХ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЦреБрд▓реЗрдЧрд╛, рдЖрдкрдХреЛ рдкреНрд░рдорд╛рдгреАрдХреГрдд рдХрд░реЗрдЧрд╛, рдФрд░ "рдореЗрд░рд╛ рдЦрд╛рддрд╛" рдкреЗрдЬ рдкрд░ рдЬрд╛рдПрдЧрд╛ред рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рдмрд╛рдж рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╡рд┐рдВрдбреЛ рдХреЛ рдЦреБрд▓рд╛ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП `--keep-open` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдЬрд┐рд╕рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХреГрдд рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рдЕрдиреНрдп рдкреГрд╖реНрдареЛрдВ рдкрд░ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг:

{% code overflow="wrap" %}
```bash
roadtx keepassauth -url https://myaccount.microsoft.com --keep-open -u myuser@mytenant.com -kp accounts.kdbx -kpp keepassfilepassword
```
{% endcode %}

### рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ PRT рдкреНрд░рдорд╛рдгреАрдХрд░рдг <a href="#primary-refresh-token-authentication-in-browser" id="primary-refresh-token-authentication-in-browser"></a>

рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рдкрд░рд┐рджреГрд╢реНрдп рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк рдПрдХ рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдЬрд┐рд╕реЗ рдЖрдкрдиреЗ рдпрд╛ рддреЛ рд╕реНрд╡рдпрдВ рдкрдВрдЬреАрдХреГрдд рдХрд┐рдпрд╛ рд╣реИ рдпрд╛ рдЬрд┐рд╕реЗ рдЖрдкрдиреЗ рдПрдХ рд╡реИрдз рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реЗ [рдЪреБрд░рд╛рдпрд╛ рд╣реИ](https://dirkjanm.io/digging-further-into-the-primary-refresh-token/) рдПрдХ рд░реЗрдб рдЯреАрдо рдХреЗ рджреМрд░рд╛рди рдПрдХ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЕрдиреБрднрд╡ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдПред рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдордиреЗ **Mimikatz рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдПрдВрдбрдкреЙрдЗрдВрдЯ рд╕реЗ PRT рдФрд░ рд╕рддреНрд░ рдХреБрдВрдЬреА рдбрдВрдк рдХреА рд╣реИ** (рдпрд╣ рдХреЗрд╡рд▓ рддрднреА рд╕рдВрднрд╡ рд╣реИ рдЬрдм рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдЯреНрд░рд╕реНрдЯреЗрдб рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдореЙрдбреНрдпреВрд▓ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ)ред рд╣рдо рдЗрд╕ PRT рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдкрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рд╣рдо рдЗрд╕реЗ рдЕрдкрдиреЗ Selenium рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕рддреНрд░ рдореЗрдВ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред roadtx рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдЦреБрдж рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░реЙрдХреНрд╕реА рдХрд░рдХреЗ рдФрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдмрд┐рдВрджреБрдУрдВ рдкрд░ PRT рдХреБрдХреА рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдХреЗ рдпрд╣ рдХрд░рддрд╛ рд╣реИред рдкреАрдбрд╝рд┐рдд рдПрдВрдбрдкреЙрдЗрдВрдЯ рдкрд░, рд╣рдо Mimikatz рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ PRT рдФрд░ рд╕рддреНрд░ рдХреБрдВрдЬреА рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк **рдХрдорд╛рдВрдбреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** PRT рдФрд░ рд╕рддреНрд░ рдХреБрдВрдЬреА рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдлрд┐рд░ **`roadtx`** рдХреЗ рд╕рд╛рде рдорд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ [**рдорд┐рдорд┐рдХрд╛рдЯреНрдЬрд╝ рдореЗрдердб рдХреЗ рдСрдкреНрд╢рди 2 рдореЗрдВ PRT рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**](pass-the-prt.md#attack-mimikatz)**ред**

### рдЕрдиреНрдп рдЦрд╛рддреЛрдВ рдХреЗ рд╕рд╛рде PRT рдХрд╛ рдЙрдкрдпреЛрдЧ <a href="#primary-refresh-token-usage-with-other-accounts" id="primary-refresh-token-usage-with-other-accounts"></a>

рдЪреБрд░рд╛рдП рдЧрдП рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХреЗ рд▓рд┐рдП рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рдЙрдкрдпреЛрдЧ рдХрд╛ рдорд╛рдорд▓рд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рдЕрдиреНрдп рдЦрд╛рддреЛрдВ рдХреЗ рд▓рд┐рдП рднреА **рдбрд┐рд╡рд╛рдЗрд╕ рджрд╛рд╡реЛрдВ рдХреЛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЕрдЧрд░ рдХреЛрдИ рдХрдВрдбреАрд╢рдирд▓ рдПрдХреНрд╕реЗрд╕ рдкреЙрд▓рд┐рд╕реА рд╣реИ рдЬреЛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдиреБрдкрд╛рд▓рди рдпрд╛ рд╣рд╛рдЗрдмреНрд░рд┐рдб рдЬреЙрдЗрдВрдб рдХреЙрд░реНрдкреЛрд░реЗрдЯ рдбрд┐рд╡рд╛рдЗрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рддреЛ рдбрд┐рд╡рд╛рдЗрд╕ рджрд╛рд╡рд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рджреМрд░рд╛рди рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдкреНрд░рд╛рдЗрдорд░реА рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рд╕реЗ рдЖрддрд╛ рд╣реИред рдпрд╣ рджрд╛рд╡рд╛ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рддреЛ рдЕрдЧрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ `tpmtest@iminyour.cloud` рдХреЗ рд▓рд┐рдП рдПрдХ **рдЪреБрд░рд╛рдпрд╛ рд╣реБрдЖ PRT рд╣реИ рдЬреЛ рдПрдХ рдЕрдиреБрдкрд╛рд▓рди рдбрд┐рд╡рд╛рдЗрд╕ рд╕реЗ рд╣реИ**, рддреЛ рдореИрдВ рдЗрд╕ **PRT рдХрд╛ рдЙрдкрдпреЛрдЧ `newlowpriv@iminyour.cloud` рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд╕рд╛рде** рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ рдФрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкрд░реАрдХреНрд╖рдг рдкрд╛рд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБред

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднреА рднреА `tpmtest@iminyour.cloud` рд╕реЗ рдЪреБрд░рд╛рдпрд╛ рдЧрдпрд╛ PRT рд╣реИ рдЬрд┐рд╕реЗ рдКрдкрд░ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдФрд░ рдЗрд╕реЗ `roadtx.prt` рдХреЗ рд░реВрдк рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЧрдпрд╛ рд╣реИред рдореИрдВ рдЗрд╕ **PRT рдХрд╛ рдЙрдкрдпреЛрдЧ `newlowpriv` рдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд╕рд╛рде** рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ рдЬреЛ рдореЗрд░реА KeePass рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВ, Microsoft Teams рдореЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░рдиреЗ рдФрд░ рд╡рд╣рд╛рдВ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП `roadtx browserprtinject` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБред
```bash
roadtx browserprtinject -u newlowpriv@iminyour.cloud -r msgraph -c msteams
```
рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди `deviceid` рджрд╛рд╡реЗ рдХреЛ рд╕рдорд╛рд╣рд┐рдд рдХрд░реЗрдЧрд╛, рдЬреЛ рд╡рд╣ рдбрд┐рд╡рд╛рдЗрд╕ рд╣реИ рдЬрд┐рд╕рд╕реЗ рд╣рдордиреЗ PRT рдЪреБрд░рд╛рдпрд╛ рдерд╛ред рдЪреВрдВрдХрд┐ рдпрд╣ рдбрд┐рд╡рд╛рдЗрд╕ Intune рдкреНрд░рдмрдВрдзрд┐рдд рдФрд░ рдЕрдиреБрдкрд╛рд▓рди рд╣реИ, рдпрд╣ рдЕрдиреБрдкрд╛рд▓рди рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рдкрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### рдореМрдЬреВрджрд╛ PRT рдореЗрдВ MFA рджрд╛рд╡реЗ рдЬреЛрдбрд╝рдирд╛ <a href="#adding-mfa-claims-to-an-existing-prt" id="adding-mfa-claims-to-an-existing-prt"></a>

рд╣рдо рдЪреБрд░рд╛рдП рдЧрдП PRTs рд╕реЗ рд╡рд╛рдкрд╕ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдкрд╣рд▓реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо + рдкрд╛рд╕рд╡рд░реНрдб рд╕рдВрдпреЛрдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрдВрдЬреАрдХреГрдд рдХрд┐рдП рдЧрдП PRT рдкрд░ рд╡рд╛рдкрд╕ рдЖрддреЗ рд╣реИрдВред рдпрджрд┐ рд╣рдо рдПрдХ **PRT рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ MFA рджрд╛рд╡рд╛ рд╣реЛ, рддреЛ рд╣рдореЗрдВ рдПрдХ рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╕рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛** рдЬреЛ Azure AD рд╕реЗ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдЧрд╛ тАЬрд╣рдорд╛рд░реЗ PRT рдХреЛ рд╕рдореГрджреНрдз рдХрд░рдиреЗтАЭ рдХреЗ рд▓рд┐рдПред рдЗрд╕рдХреЗ рд▓рд┐рдП рдХрдорд╛рдВрдб рд╣реИ **`roadtx prtenrich`**, рдЬреЛ рдкрд┐рдЫрд▓реЗ рдХрдорд╛рдВрдбреЛрдВ рдХреА рддрд░рд╣ рдПрдХ KeePass рдлрд╛рдЗрд▓ рдореЗрдВ рдкрд╣рдЪрд╛рди рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ MFA рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рд╕реНрд╡рдд: рднрд░рд╛ рдЬрд╛ рд╕рдХреЗ, рдпрд╛ рдЖрдк рдпрд╣ рд╣рд╛рде рд╕реЗ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
roadtx prtenrich -u newlowpriv@iminyour.cloud
Got refresh token. Can be used to request prt with roadtx prt -r <refreshtoken>
```
рдкрд░рд┐рдгрд╛рдо рдПрдХ рд╡рд┐рд╢реЗрд╖ рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдирдпрд╛ PRT рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдо `roadtx prt` рдореЙрдбреНрдпреВрд▓ рдореЗрдВ рд╡рд╛рдкрд╕ рдЬрд╛рддреЗ рд╣реИрдВ:
```bash
roadtx prt -r <refreshtoken> -c blogdevice.pem -k blogdevice.key
```
рдирдпрд╛ PRT рдбрд┐рд╕реНрдХ рдкрд░ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЬрдм рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЯреЛрдХрди рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдХрд░рддреЗ рд╣реИрдВ рддреЛ рд╣рдореЗрдВ MFA рджрд╛рд╡рд╛ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (4) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

рд╣рдо рдЗрд╕ PRT рдХрд╛ рдЙрдкрдпреЛрдЧ MFA рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╡рд╛рд▓реЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрд░реЛрдХреНрдд рдХрд┐рд╕реА рднреА рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### Chrome рдФрд░ рдХрд╕реНрдЯрдо browsercore рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ SSO <a href="#single-sign-on-in-windows-using-chrome-and-a-custom-browsercore" id="single-sign-on-in-windows-using-chrome-and-a-custom-browsercore"></a>

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдореЗрдВ рдЖрдкрдХреЛ рдЬрд╛рдирдХрд╛рд░реА рд╣реИ рдХрд┐ Google Chrome **`browsercore.exe`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ SSO рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреИрд╕реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рддрд╛ рд╣реИ:

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

**`roadtx`** рдореЗрдВ `browsercore.py` рд╣реИ, рдЖрдк **`roadtx`** рд╕реЗ PTR (рдпрд╛ рдЬреЛ рдЖрдкрдиреЗ рдХрд╣реАрдВ рдФрд░ рд╕реЗ рдЪреБрд░рд╛рдпрд╛ рд╣реИ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЛрд╕реНрдЯ рдкрд░ Chrome рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдкрдХреЛ Selenium рд╡рд┐рдВрдбреЛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдк рд╕реАрдзреЗ PRT рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рдЖрдк рдкреАрдбрд╝рд┐рдд рдХреА рдорд╢реАрди рдкрд░ рдПрдХ рд╡реИрдз рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рд╣реЛрдВред

рдХрд╕реНрдЯрдо SSO рд╕реЗрдЯрдЕрдк рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЪрд░рдгреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ:

* рдЖрдкрдХреЛ `browsercore.py` рдФрд░ `manifest.json` [рдлрд╛рдЗрд▓реЗрдВ](https://github.com/dirkjanm/ROADtools/tree/master/browsercore) рдХреЛ рдбрд┐рд╕реНрдХ рдкрд░ рдХрд┐рд╕реА рд╕реНрдерд╛рди рдкрд░ рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `C:\browsercore\` рдореЗрдВред
* roadtx рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ рдФрд░ рдПрдХ `roadtx.prt` рдлрд╛рдЗрд▓ рдХреЛ рдЙрд╕реА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд░рдЦреЗрдВред
* `HKEY_CURRENT_USER\Software\Google\Chrome\NativeMessagingHosts\com.microsoft.browsercore` рдХреЛ `C:\browsercore\manifest.json` рдХреА рдУрд░ рд╕рдВрдХреЗрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВред
* `bctest.py` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рд╕рдм рдХреБрдЫ рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред
* Chrome рдореЗрдВ `login.microsoftonline.com` рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рднреА рдореМрдЬреВрджрд╛ рдХреБрдХреАрдЬрд╝ рдХреЛ рд╕рд╛рдл рдХрд░реЗрдВред

рдкреВрд░реНрдг рд╕реНрдерд╛рдкрдирд╛ рдирд┐рд░реНрджреЗрд╢ [ROADtools wiki](https://github.com/dirkjanm/ROADtools/wiki/Setting-up-BrowserCore.py) рдкрд░ рд╣реИрдВред рд╕реЗрдЯрдЕрдк рдХреЗ рдмрд╛рдж, Chrome рдХреЛ рд╕рд╛рдЗрди рдЗрди рдХреЗ рджреМрд░рд╛рди рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ PRT рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдкрд╣рд▓реА рдмрд╛рд░ рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдХреЗрдд рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рдареАрдХ рд╕реЗ рдХрд╛рдо рдХрд░реЗред

рдЗрд╕ рд╕реЗрдЯрдЕрдк рдХреЗ рд╕рд╛рде рдЖрдк SSO рдФрд░ PRT рд╕реЗ рдкреНрд░рд╛рдкреНрдд рджрд╛рд╡реЛрдВ рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА Azure AD рд╕реЗ рдЬреБрдбрд╝реЗ рд╕рдВрд╕рд╛рдзрди рдХреЛ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдбрд┐рд╡рд╛рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдФрд░ рдХреИрд╢реНрдб MFA рдЬрд╛рдирдХрд╛рд░реА рд╢рд╛рдорд┐рд▓ рд╣реИред

## рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрд┐рддрд╛рдПрдБ <a href="#other-utilities" id="other-utilities"></a>

roadtx рдореЗрдВ рдХреБрдЫ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрд┐рддрд╛рдПрдБ рд╣реИрдВ, рдЬреНрдпрд╛рджрд╛рддрд░ рдореЗрд░реЗ рдЕрдкрдиреЗ рд╢реЛрдз рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП:

* `roadtx decrypt` PRT рд╕рддреНрд░ рдХреБрдВрдЬреА рдпрд╛ рдбрд┐рд╡рд╛рдЗрд╕ рдкрд░рд┐рд╡рд╣рди рдХреБрдВрдЬреА рджрд┐рдП рдЧрдП рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* `roadtx getotp` рдПрдХ рдмреАрдЬ рдпрд╛ KeePass рдлрд╛рдЗрд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд otp рд╕рдВрдкрддреНрддрд┐ рд╕реЗ OTP рдХреЛрдб рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдпрджрд┐ рдЖрдкрдХреЛ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП MFA рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ)ред
* `roadtx codeauth` рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдФрд░ рдЧреЛрдкрдиреАрдп рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рд▓рд┐рдП OAuth2 рдХреЛрдб рдкреНрд░рддрд┐рдкреВрд░реНрддрд┐ рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* `roadtx listaliases` рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдФрд░ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерд┐рдд рд╕рднреА рдЙрдкрдирд╛рдореЛрдВ рдХреА рд╕реВрдЪреА рдмрдирд╛рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдирд╛рдореЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рдирдХрд╛ рдЖрдк рдЕрдХреНрд╕рд░ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХреГрдкрдпрд╛ рдПрдХ рдореБрджреНрджрд╛ рдЦреЛрд▓реЗрдВ рдпрд╛ рдореБрдЭреЗ рд╕рдВрджреЗрд╢ рднреЗрдЬреЗрдВред

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>!</strong></a></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
