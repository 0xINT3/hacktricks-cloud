# Az - Keyvault

<details>

<summary><strong>ハックトリックをサポートして特典を得る！</strong></summary>

* **HackTricksで会社の広告を見たい**場合や、**最新バージョンのPEASSをダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)をフォローする。
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

## 基本情報

Azure Key Vaultは、**安全にシークレットを保存およびアクセスする**ためのクラウドサービスです。シークレットとは、APIキー、パスワード、証明書、または暗号キーなど、**アクセスを厳密に制御したいもの**です。Key Vaultサービスは、2つのタイプのコンテナをサポートしています：VaultとManaged Hardware Security Module（HSM）Pools。Vaultは、ソフトウェアおよびHSMバックドキー、シークレット、および証明書の保存をサポートしています。Managed HSM Poolsは、HSMバックドキーのみをサポートしています。詳細については、[Azure Key Vault REST APIの概要](https://learn.microsoft.com/en-us/azure/key-vault/general/about-keys-secrets-certificates)を参照してください。

**URLの形式**は `https://{vault-name}.vault.azure.net/{object-type}/{object-name}/{object-version}` です。ここで：

* `vault-name`は、キーボールトのグローバルに**一意の**名前です。
* `object-type`は、"keys"、"secrets"、または"certificates"のいずれかです。
* `object-name`は、キーボールト内のオブジェクトの**一意の**名前です。
* `object-version`は、システムによって生成され、オブジェクトの**一意のバージョン**を指定するためにオプションで使用されます。

キーボールトに保存されたシークレットにアクセスするためには、2つのアクセス許可モデルが使用されます：

* **Vaultアクセスポリシー**
* **Azure RBAC**

### アクセス管理

キーボールトへのアクセスは、**2つの**プレーンを通じて制御されます：

* **管理プレーン：** キーボールトと**アクセスポリシー**の管理。Azureロールベースのアクセス制御（RBAC）のみがサポートされています。
* **データプレーン：** キーボールト内の**データ**（キー、シークレット、証明書）の管理。これには、キーボールトのアクセスポリシーまたはAzure RBACがサポートされています。

アクセスポリシーの管理に必要な権限を持つ**Contributor**のような役割は、アクセスポリシーを変更することでシークレットにアクセスできます。

## 列挙
```powershell
# Get keyvault token
curl "$IDENTITY_ENDPOINT?resource=https://vault.azure.net&api-version=2017-09-01" -H secret:$IDENTITY_HEADER

# Connect with PS AzureAD
## $token from management API
Connect-AzAccount -AccessToken $token -AccountId 2e91a4fea0f2-46ee-8214-fa2ff6aa9abc -KeyVaultAccessToken $keyvaulttoken

# List vaults
Get-AzKeyVault
# Get secrets names from the vault
Get-AzKeyVaultSecret -VaultName <vault_name>
# Get secret values
Get-AzKeyVaultSecret -VaultName <vault_name> -Name <secret_name> –AsPlainText
```
<details>

<summary><strong>Support HackTricksと特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**最新バージョンのPEASSにアクセスしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見する
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に**参加**し、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**をフォロー**する。
* **ハッキングのトリックを共有するには、**[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出**してください。

</details>
