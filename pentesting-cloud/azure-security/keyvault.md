# Az - Key Vault

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## рдореМрд▓рд┐рдХ рдЬрд╛рдирдХрд╛рд░реА

[рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕реЗ:](https://learn.microsoft.com/en-us/azure/key-vault/general/basic-concepts) Azure Key Vault рдПрдХ рдХреНрд▓рд╛рдЙрдб рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ **рдЧреБрдкреНрдд рд░реВрдк рд╕реЗ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рд╕реНрдЯреЛрд░ рдФрд░ рдПрдХреНрд╕реЗрд╕** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред рдПрдХ рд╕реАрдХреНрд░реЗрдЯ рдХреБрдЫ рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк **рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рд┐рдд рд░рдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**, рдЬреИрд╕реЗ API рдХреБрдВрдЬреА, рдкрд╛рд╕рд╡рд░реНрдб, рдкреНрд░рдорд╛рдгрдкрддреНрд░, рдпрд╛ рдпрд╛рдВрддреНрд░рд┐рдХреА рдХреБрдВрдЬреАред Key Vault рд╕реЗрд╡рд╛ рджреЛ рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрдВрдЯреЗрдирд░ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреА рд╣реИ: рд╡реЙрд▓реНрдЯреНрд╕ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓ (HSM) рдкреВрд▓ред рд╡реЙрд▓реНрдЯреНрд╕ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдФрд░ HSM рд╕рдорд░реНрдерд┐рдд рдХреБрдВрдЬреА, рд╕реАрдХреНрд░реЗрдЯреНрд╕, рдФрд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВред рдкреНрд░рдмрдВрдзрд┐рдд HSM рдкреВрд▓ рдХреЗрд╡рд▓ HSM рд╕рдорд░реНрдерд┐рдд рдХреБрдВрдЬреА рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВред рдкреВрд░реНрдг рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП [Azure Key Vault REST API рдЕрд╡рд▓реЛрдХрди](https://learn.microsoft.com/en-us/azure/key-vault/general/about-keys-secrets-certificates) рджреЗрдЦреЗрдВред

**URL рдкреНрд░рд╛рд░реВрдк** рд╣реИ `https://{vault-name}.vault.azure.net/{object-type}/{object-name}/{object-version}` рдЬрд╣рд╛рдБ:

* `vault-name` рдХреБрдВрдЬреА рд╡реЙрд▓реНрдЯ рдХрд╛ рд╡реИрд╢реНрд╡рд┐рдХ рд░реВрдк рд╕реЗ **рдЕрджреНрд╡рд┐рддреАрдп** рдирд╛рдо рд╣реИ
* `object-type` "keys", "secrets" рдпрд╛ "certificates" рд╣реЛ рд╕рдХрддрд╛ рд╣реИ
* `object-name` рдХреБрдВрдЬреА рд╡реЙрд▓реНрдЯ рдХреЗ рднреАрддрд░ рд╡рд╕реНрддреБ рдХрд╛ **рдЕрджреНрд╡рд┐рддреАрдп** рдирд╛рдо рд╣реИ
* `object-version` рд╕рд┐рд╕реНрдЯрдо рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ рдПрдХ рд╡рд╕реНрддреБ рдХреЗ **рдЕрджреНрд╡рд┐рддреАрдп рд╕рдВрд╕реНрдХрд░рдг** рдХреЛ рдкрддрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рд╡реЙрд▓реНрдЯ рдореЗрдВ рд╕реНрдЯреЛрд░ рдХрд┐рдП рдЧрдП рд╕реАрдХреНрд░реЗрдЯреНрд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рджреЛ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* **рд╡реЙрд▓реНрдЯ рдПрдХреНрд╕реЗрд╕ рдиреАрддрд┐**
* **Azure RBAC**

### рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг <a href="#access-control" id="access-control"></a>

Key Vault рд╕рдВрд╕рд╛рдзрди рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рджреЛ рд╡рд┐рдорд╛рдиреЛрдВ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:

* **рдкреНрд░рдмрдВрдзрди рд╡рд┐рдорд╛рди**, рдЬрд┐рд╕рдХрд╛ рд▓рдХреНрд╖реНрдп рд╣реИ [management.azure.com](http://management.azure.com/)ред&#x20;
* рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреБрдВрдЬреА рд╡реЙрд▓реНрдЯ рдФрд░ **рдПрдХреНрд╕реЗрд╕ рдиреАрддрд┐рдпреЛрдВ** рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдХреЗрд╡рд▓ Azure рд░реЛрд▓ рдЖрдзрд╛рд░рд┐рдд рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг (**RBAC**) рдХрд╛ рд╕рдорд░реНрдерди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* **рдбреЗрдЯрд╛ рд╡рд┐рдорд╛рди**, рдЬрд┐рд╕рдХрд╛ рд▓рдХреНрд╖реНрдп рд╣реИ **`<vault-name>.vault.azure.com`**ред&#x20;
* рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреБрдВрдЬреА рд╡реЙрд▓реНрдЯ рдореЗрдВ рдбреЗрдЯрд╛ (рдХреБрдВрдЬреА, рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдФрд░ рдкреНрд░рдорд╛рдгрдкрддреНрд░) рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдФрд░ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ **рдХреБрдВрдЬреА рд╡реЙрд▓реНрдЯ рдПрдХреНрд╕реЗрд╕ рдиреАрдд
```bash
az keyvault show --name name-vault --query networkAcls
```
## рдЬрд╛рдВрдЪ

{% tabs %}
{% tab title="Az Powershell" %}
```powershell
# Get keyvault token
curl "$IDENTITY_ENDPOINT?resource=https://vault.azure.net&api-version=2017-09-01" -H secret:$IDENTITY_HEADER

# Connect with PS AzureAD
## $token from management API
Connect-AzAccount -AccessToken $token -AccountId 1937ea5938eb-10eb-a365-10abede52387 -KeyVaultAccessToken $keyvaulttoken

# List vaults
Get-AzKeyVault
# Get secrets names from the vault
Get-AzKeyVaultSecret -VaultName <vault_name>
# Get secret values
Get-AzKeyVaultSecret -VaultName <vault_name> -Name <secret_name> тАУAsPlainText
```
{% endcode %}
{% endtab %}

{% tab title="az" %}
```bash
#!/bin/bash

# Dump all keyvaults from the subscription

# Define Azure subscription ID
AZ_SUBSCRIPTION_ID="your-subscription-id"

# Specify the filename for output
CSV_OUTPUT="vault-names-list.csv"

# Login to Azure account
az login

# Select the desired subscription
az account set --subscription $AZ_SUBSCRIPTION_ID

# Retrieve all resource groups within the subscription
AZ_RESOURCE_GROUPS=$(az group list --query "[].name" -o tsv)

# Initialize the CSV file with headers
echo "Vault Name,Associated Resource Group" > $CSV_OUTPUT

# Iterate over each resource group
for GROUP in $AZ_RESOURCE_GROUPS
do
# Fetch key vaults within the current resource group
VAULT_LIST=$(az keyvault list --resource-group $GROUP --query "[].name" -o tsv)

# Process each key vault
for VAULT in $VAULT_LIST
do
# Extract the key vault's name
VAULT_NAME=$(az keyvault show --name $VAULT --resource-group $GROUP --query "name" -o tsv)

# Append the key vault name and its resource group to the file
echo "$VAULT_NAME,$GROUP" >> $CSV_OUTPUT
done
done
```
<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

рджреВрд╕рд░реЗ рддрд░реАрдХреЗ HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
