# Az - Privesc dinamiƒçnih grupa

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

**Dinamiƒçne grupe** su grupe koje imaju skup **pravila** konfigurisanih i svi **korisnici ili ureƒëaji** koji se podudaraju sa pravilima se dodaju grupi. Svaki put kada se **promeni atribut** korisnika ili ureƒëaja, dinamiƒçka pravila se **ponovo proveravaju**. Kada se **kreira novo pravilo**, svi ureƒëaji i korisnici se **proveravaju**.

Dinamiƒçkim grupama mogu se dodeliti **Azure RBAC uloge**, ali nije moguƒáe dodati **AzureAD uloge** dinamiƒçkim grupama.

Ova funkcionalnost zahteva Azure AD premium P1 licencu.

## Privesc

Imajte na umu da podrazumevano svaki korisnik mo≈æe pozvati goste u Azure AD, pa ako dinamiƒçno pravilo grupe daje **dozvole** korisnicima na osnovu **atributa** koji se mogu **postaviti** kod novog **gosta**, moguƒáe je **kreirati gosta** sa ovim atributima i **poveƒáati privilegije**. Takoƒëe, gost mo≈æe upravljati svojim profilom i menjati ove atribute.

Dobijanje grupa koje dozvoljavaju dinamiƒçko ƒçlanstvo: `Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### Primer

* **Primer pravila**: `(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **Opis pravila**: Svaki gost korisnik sa sekundarnim emailom koji sadr≈æi string 'tester' ƒáe biti dodat u grupu

1. Idite na **Azure Active Directory** -> **Korisnici** i **kliknite** na `Want to switch back to the legacy users list experience? Click here to leave the preview`
2. Kliknite na **`New guest user`** i **pozovite** email
3. **Profil korisnika** ƒáe biti **dodat** u Azure AD ƒçim se poziv po≈°alje. Otvorite profil korisnika i **kliknite na (manage) ispod Invitation accepted**.
* ![](<../../../.gitbook/assets/image (87) (1).png>)
4. Promenite **`Resend invite?`** na **Yes** i dobiƒáete URL poziva:
* ![](<../../../.gitbook/assets/image (11) (1) (2) (1).png>)
5. Kopirajte **URL** i **otvorite** ga, **ulogujte se** kao pozvani korisnik i **prihvatite** poziv
6. **Ulogujte se** u CLI kao korisnik i postavite sekundarni email

{% code overflow="wrap" %}
```powershell
# Ulogujte se
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# Promenite OtherMails pode≈°avanje
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
{% endcode %}



## Reference

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
