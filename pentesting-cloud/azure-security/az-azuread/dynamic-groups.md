# Az - Dinamiƒçke grupe Privesc

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

**Dinamiƒçke grupe** su grupe koje imaju skup **pravila** konfigurisanih i svi **korisnici ili ureƒëaji** koji se podudaraju sa pravilima se dodaju u grupu. Svaki put kada se **atribut** korisnika ili ureƒëaja **promeni**, dinamiƒçka pravila se **ponovo proveravaju**. I kada se **kreira novo pravilo**, svi ureƒëaji i korisnici se **proveravaju**.

Dinamiƒçke grupe mogu imati dodeljene **Azure RBAC uloge**, ali nije **moguƒáe** dodati **AzureAD uloge** dinamiƒçkim grupama.

Ova funkcija zahteva Azure AD premium P1 licencu.

## Privesc

Imajte na umu da podrazumevano svaki korisnik mo≈æe pozvati goste u Azure AD, tako da, ako dinamiƒçna grupa **pravilo** daje **dozvole** korisnicima na osnovu **atributa** koji mogu biti **postavljeni** u novom **gostu**, moguƒáe je **kreirati gosta** sa ovim atributima i **dodeliti privilegije**. Takoƒëe je moguƒáe da gost upravlja svojim profilom i promeni ove atribute.

Dobijanje grupa koje dozvoljavaju Dinamiƒçko ƒçlanstvo: `Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### Primer

* **Primer pravila**: `(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **Opis pravila**: Svaki gost korisnik sa sekundarnim emailom sa stringom 'tester' ƒáe biti dodat u grupu

1. Idite na **Azure Active Directory** -> **Korisnici** i **kliknite** na `≈Ωelite li da se vratite na iskustvo starog korisniƒçkog spiska? Kliknite ovde da napustite pregled`
2. Kliknite na **`Novi gost korisnik`** i **pozovite** email
3. **Korisniƒçki profil** ƒáe biti **dodat** u Azure AD ƒçim se po≈°alje pozivnica. Otvorite korisniƒçki profil i **kliknite na (upravljaj) ispod Prihvaƒáena pozivnica**.
* ![](<../../../.gitbook/assets/image (281).png>)
4. Promenite **`Ponovo po≈°alji pozivnicu?`** na **Da** i dobiƒáete URL pozivnice:
* ![](<../../../.gitbook/assets/image (205).png>)
5. Kopirajte **URL** i **otvorite** ga, **prijavite se** kao pozvani korisnik i **prihvatite** pozivnicu
6.  **Prijavite se** u CLI kao korisnik i postavite sekundarni email

{% code overflow="wrap" %}
```powershell
# Prijavite se
$password = ConvertTo-SecureString 'lozinka' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# Promenite OtherMails postavku
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <KorisniƒçkoIme>@<IME_TENANTA>.onmicrosoft.com -Verbose
```
{% endcode %}

## Reference

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)
