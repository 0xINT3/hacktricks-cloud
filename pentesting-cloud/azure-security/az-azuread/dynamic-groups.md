# Az - 动态组提权

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 基本信息

**动态组**是具有一组**规则**配置的组，所有符合规则的**用户或设备**都将添加到该组中。每当用户或设备的**属性**发生**更改**时，动态规则都会**重新检查**。当**创建新规则**时，所有设备和用户都将被**检查**。

动态组可以分配**Azure RBAC角色**，但**无法**向动态组添加**AzureAD角色**。

此功能需要Azure AD高级P1许可证。

## 提权

请注意，默认情况下，任何用户都可以在Azure AD中邀请访客，因此，如果动态组的**规则**根据可以在新**访客**中**设置**的**属性**授予用户**权限**，则可以使用具有这些属性的访客**创建访客**并**提升权限**。访客还可以管理自己的个人资料并更改这些属性。

获取允许动态成员身份的组：`Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### 示例

* **规则示例**：`(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **规则描述**：具有包含字符串'tester'的辅助电子邮件的任何访客用户将被添加到该组

1. 转到**Azure活动目录** -> **用户**，然后单击`想要切换回传统用户列表体验吗？单击此处离开预览`
2. 单击**`新访客用户`**并**邀请**一个电子邮件
3. 一旦发送邀请，用户的个人资料将被添加到Azure AD。打开用户的个人资料，然后单击**邀请已接受**下的**(管理)**。
* ![](<../../../.gitbook/assets/image (281).png>)
4. 将**`重新发送邀请？`**更改为**是**，然后您将获得一个邀请URL：
* ![](<../../../.gitbook/assets/image (205).png>)
5. 复制**URL**，**打开**它，以被邀请的用户身份**登录**并**接受**邀请
6. 以该用户身份**登录**到cli，并设置辅助电子邮件

{% code overflow="wrap" %}
```powershell
# 登录
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# 更改OtherMails设置
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
{% endcode %}

## 参考

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏
* **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>
