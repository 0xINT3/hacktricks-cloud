# Azure Pentesting

<details>

<summary><strong>Lernen Sie das Hacken von AWS von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks in PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## ICH BAUE IMMER NOCH AN DER AZURE-METHODOLOGIE

## Grundlegende Informationen

{% content-ref url="az-basic-information.md" %}
[az-basic-information.md](az-basic-information.md)
{% endcontent-ref %}

## Azure Pentester/Red-Team-Methodik

Um eine AZURE-Umgebung zu √ºberpr√ºfen, ist es sehr wichtig zu wissen: welche **Dienste verwendet werden**, was **offengelegt wird**, wer auf was **Zugriff hat** und wie interne Azure-Dienste und **externe Dienste** verbunden sind.

Aus der Sicht eines Red Teams ist der **erste Schritt zur Kompromittierung einer Azure-Umgebung**, einige **Anmeldeinformationen f√ºr Azure AD zu erhalten**. Hier sind einige Ideen, wie Sie das erreichen k√∂nnen:

* **Lecks** in GitHub (oder √§hnlich) - OSINT
* **Social** Engineering
* **Passwort**-Wiederverwendung (Passwortlecks)
* Schwachstellen in Azure-gehosteten Anwendungen
* [**Serverseitige Anfragenf√§lschung**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) mit Zugriff auf Metadaten-Endpunkt
* **Lokales Dateilesen**
* `/home/USERNAME/.azure`
* `C:\Users\USERNAME\.azure`
* Die Datei **`accessTokens.json`** in `az cli` vor 2.30 - Jan2022 - speicherte **Zugriffstoken im Klartext**
* Die Datei **`azureProfile.json`** enth√§lt **Informationen** √ºber den angemeldeten Benutzer.
* **`az logout`** entfernt das Token.
* √Ñltere Versionen von **`Az PowerShell`** speicherten **Zugriffstoken** im **Klartext in `TokenCache.dat`**. Es speichert auch **ServicePrincipalSecret** im **Klartext in `AzureRmContext.json`**. Das Cmdlet **`Save-AzContext`** kann verwendet werden, um **Token** zu **speichern**.\
Verwenden Sie `Disconnect-AzAccount`, um sie zu entfernen.
* Von 3. Parteien **kompromittiert**
* **Interne** Mitarbeiter
* [**G√§ngiges Phishing**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (Anmeldeinformationen oder Oauth-App)
* [Phishing mit Ger√§tecode-Authentifizierung](az-unauthenticated-enum-and-initial-entry/az-device-code-authentication-phishing.md)
* [Azure **Passwort-Spraying**](az-unauthenticated-enum-and-initial-entry/az-password-spraying.md)

Auch wenn Sie **keinen Benutzer innerhalb** des von Ihnen angegriffenen Azure-Mandanten kompromittiert haben, k√∂nnen Sie dennoch **Informationen daraus sammeln**:

{% content-ref url="az-unauthenticated-enum-and-initial-entry/" %}
[az-unauthenticated-enum-and-initial-entry](az-unauthenticated-enum-and-initial-entry/)
{% endcontent-ref %}

{% hint style="info" %}
Nachdem Sie es geschafft haben, Anmeldeinformationen zu erhalten, m√ºssen Sie wissen, **wem diese Anmeldeinformationen geh√∂ren**, und **wor√ºber sie Zugriff haben**, daher m√ºssen Sie eine grundlegende Aufz√§hlung durchf√ºhren:
{% endhint %}

## Grundlegende Aufz√§hlung

{% hint style="info" %}
Denken Sie daran, dass der **lauteste** Teil der Aufz√§hlung der **Anmeldevorgang** ist, nicht die Aufz√§hlung selbst.
{% endhint %}

### SSRF

Wenn Sie einen SSRF in einer Maschine innerhalb von Azure gefunden haben, √ºberpr√ºfen Sie diese Seite auf Tricks:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Umgehung von Anmeldebedingungen

<figure><img src="../../.gitbook/assets/image (1) (2) (2).png" alt=""><figcaption></figcaption></figure>

In F√§llen, in denen Sie g√ºltige Anmeldeinformationen haben, sich jedoch nicht anmelden k√∂nnen, k√∂nnten diese g√§ngigen Schutzma√ünahmen vorhanden sein:

* **IP-Whitelisting** -- Sie m√ºssen eine g√ºltige IP kompromittieren
* **Geo-Beschr√§nkungen** -- Finden Sie heraus, wo der Benutzer lebt oder wo sich die B√ºros des Unternehmens befinden, und erhalten Sie eine IP aus derselben Stadt (oder zumindest demselben Land)
* **Browser** -- M√∂glicherweise ist nur ein Browser aus einem bestimmten Betriebssystem (Windows, Linux, Mac, Android, iOS) zul√§ssig. Finden Sie heraus, welches Betriebssystem das Opfer/Unternehmen verwendet.
* Sie k√∂nnen auch versuchen, **Service Principal-Anmeldeinformationen zu kompromittieren**, da sie normalerweise weniger eingeschr√§nkt sind und deren Anmeldung weniger √ºberpr√ºft wird

Nachdem Sie es umgangen haben, k√∂nnten Sie zu Ihrer urspr√ºnglichen Konfiguration zur√ºckkehren und immer noch Zugriff haben.

### Subdomain Takeover

* [https://godiego.co/posts/STO-Azure/](https://godiego.co/posts/STO-Azure/)

### Wer bin ich

{% hint style="danger" %}
Erfahren Sie, **wie Sie** az cli, AzureAD und Az PowerShell in der [**Az - AzureAD**](az-azuread/) Sektion installieren.
{% endhint %}

Eine der ersten Dinge, die Sie wissen m√ºssen, ist, **wer Sie sind** (in welcher Umgebung Sie sich befinden):

{% tabs %}
{% tab title="az cli" %}
```bash
az account list
az account tenant list # Current tenant info
az account subscription list # Current subscription info
az ad signed-in-user show # Current signed-in user
az ad signed-in-user list-owned-objects # Get owned objects by current user
az account management-group list #Not allowed by default
```
{% endtab %}

{% tab title="AzureAD" %} 

### AzureAD

#### Enumeration

- **User Enumeration**: You can use the Graph API to enumerate users. You can use the `user.read` permission to list all users in the tenant.
- **Group Enumeration**: You can use the Graph API to enumerate groups. You can use the `group.read.all` permission to list all groups in the tenant.
- **Application Enumeration**: You can use the Graph API to enumerate applications. You can use the `application.read.all` permission to list all applications in the tenant.

#### Privilege Escalation

- **Application Permissions**: If you have the `application.read.all` permission, you can read the application's manifest and look for sensitive information such as secrets or certificates.
- **User Impersonation**: If you have the `user.read` permission, you can impersonate users and perform actions on their behalf.

#### Persistence

- **App Registrations**: Check for any malicious app registrations that may have been created to maintain access to the Azure AD environment.

#### Lateral Movement

- **OAuth Token**: If you have an OAuth token with the necessary permissions, you can move laterally within the Azure AD environment.

#### Exfiltration

- **Export Data**: Use the Graph API to export data such as user information, group information, or application information.

#### Impact

- **Data Theft**: An attacker could steal sensitive data such as user information, group information, or application information from the Azure AD environment.

{% endtab %}
```powershell
#Get the current session state
Get-AzureADCurrentSessionInfo
#Get details of the current tenant
Get-AzureADTenantDetail
```
{% endtab %}

{% tab title="Az PowerShell" %} 

### Azure Security

#### Azure Security Center

- **Enable ASC Standard Tier**: `az security pricing create --name 'Default' --tier 'Standard'`
- **Get ASC Recommendations**: `az security recommendation list`
- **Get ASC Alerts**: `az security alert list`
- **Get ASC Secure Score**: `az security secure-score list`
- **Get ASC Secure Score Control Definitions**: `az security secure-score control-definition list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control-result list`
- **Get ASC Secure Score Control Results**: `az security secure-score control
```powershell
# Get the information about the current context (Account, Tenant, Subscription etc.)
Get-AzContext
# List all available contexts
Get-AzContext -ListAvailable
# Enumerate subscriptions accessible by the current user
Get-AzSubscription
#Get Resource group
Get-AzResourceGroup
# Enumerate all resources visible to the current user
Get-AzResource
# Enumerate all Azure RBAC role assignments
Get-AzRoleAssignment # For all users
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com # For current user
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Einer der wichtigsten Befehle zur Auflistung von Azure ist **`Get-AzResource`** von Az PowerShell, da er es Ihnen erm√∂glicht, **die Ressourcen zu kennen, die Ihr aktueller Benutzer sehen kann**.

Sie k√∂nnen dieselben Informationen auch in der **Webkonsole** erhalten, indem Sie zu [https://portal.azure.com/#view/HubsExtension/BrowseAll](https://portal.azure.com/#view/HubsExtension/BrowseAll) gehen oder nach "Alle Ressourcen" suchen.
{% endhint %}

### AzureAD Enumeration

Standardm√§√üig sollte jeder Benutzer **ausreichende Berechtigungen haben, um** Dinge wie Benutzer, Gruppen, Rollen, Dienstprinzipale usw. aufzulisten (√ºberpr√ºfen Sie [Standardberechtigungen von AzureAD](az-basic-information.md#default-user-permissions)).\
Hier finden Sie eine Anleitung:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

{% hint style="info" %}
Nun, da Sie **einige Informationen zu Ihren Anmeldeinformationen haben** (und wenn Sie ein Red-Team sind, hoffentlich **nicht entdeckt wurden**), ist es an der Zeit herauszufinden, welche Dienste in der Umgebung verwendet werden.\
Im folgenden Abschnitt k√∂nnen Sie einige M√∂glichkeiten finden, um **einige g√§ngige Dienste aufzulisten**.
{% endhint %}

## Service Principal und Zugriffsrichtlinie

Ein Azure-Dienst kann eine Systemidentit√§t (des Dienstes selbst) haben oder eine benutzerzugewiesene verwaltete Identit√§t verwenden. Diese Identit√§t kann eine Zugriffsrichtlinie haben, um beispielsweise auf einen KeyVault zuzugreifen, um Geheimnisse zu lesen. Diese Zugriffsrichtlinien sollten eingeschr√§nkt sein (Prinzip des minimalen Rechts), k√∂nnten jedoch mehr Berechtigungen haben als erforderlich. Typischerweise w√ºrde ein App-Dienst KeyVault verwenden, um Geheimnisse und Zertifikate abzurufen.

Daher ist es n√ºtzlich, diese Identit√§ten zu erkunden.

## App Service SCM

Kudu-Konsole, um sich am App-Dienst-'Container' anzumelden.

## Webshell

Verwenden Sie portal.azure.com und w√§hlen Sie die Shell aus oder verwenden Sie shell.azure.com f√ºr eine Bash- oder Powershell. Die 'Festplatte' dieser Shell wird als Bilddatei in einem Speicherkonto gespeichert.

## Azure DevOps

Azure DevOps ist separat von Azure. Es verf√ºgt √ºber Repositories, Pipelines (YAML oder Release), Boards, Wiki und mehr. Variable Gruppen werden verwendet, um Variablenwerte und Geheimnisse zu speichern.

## Automatisierte Rekonnaissancetools

### [**ROADRecon**](https://github.com/dirkjanm/ROADtools)
```powershell
cd ROADTools
pipenv shell
roadrecon auth -u test@corp.onmicrosoft.com -p "Welcome2022!"
roadrecon gather
roadrecon gui
```
### [Monkey365](https://github.com/silverhack/monkey365)

{% code overflow="wrap" %}
```powershell
Import-Module monkey365
Get-Help Invoke-Monkey365
Get-Help Invoke-Monkey365 -Detailed
Invoke-Monkey365 -IncludeAzureActiveDirectory -ExportTo HTML -Verbose -Debug -InformationAction Continue
Invoke-Monkey365 - Instance Azure -Analysis All -ExportTo HTML
```
{% endcode %}

### [**Stormspotter**](https://github.com/Azure/Stormspotter)
```powershell
# Start Backend
cd stormspotter\backend\
pipenv shell
python ssbackend.pyz

# Start Front-end
cd stormspotter\frontend\dist\spa\
quasar.cmd serve -p 9091 --history

# Run Stormcollector
cd stormspotter\stormcollector\
pipenv shell
az login -u test@corp.onmicrosoft.com -p Welcome2022!
python stormspotter\stormcollector\sscollector.pyz cli
# This will generate a .zip file to upload in the frontend (127.0.0.1:9091)
```
### [**AzureHound**](https://github.com/BloodHoundAD/AzureHound)
```powershell
# You need to use the Az PowerShell and Azure AD modules:
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@corp.onmicrosoft.com", $passwd)
Connect-AzAccount -Credential $creds

Import-Module AzureAD\AzureAD.psd1
Connect-AzureAD -Credential $creds

# Launch AzureHound
. AzureHound\AzureHound.ps1
Invoke-AzureHound -Verbose

# Simple queries
## All Azure Users
MATCH (n:AZUser) return n.name
## All Azure Applications
MATCH (n:AZApp) return n.objectid
## All Azure Devices
MATCH (n:AZDevice) return n.name
## All Azure Groups
MATCH (n:AZGroup) return n.name
## All Azure Key Vaults
MATCH (n:AZKeyVault) return n.name
## All Azure Resource Groups
MATCH (n:AZResourceGroup) return n.name
## All Azure Service Principals
MATCH (n:AZServicePrincipal) return n.objectid
## All Azure Virtual Machines
MATCH (n:AZVM) return n.name
## All Principals with the ‚ÄòContributor‚Äô role
MATCH p = (n)-[r:AZContributor]->(g) RETURN p

# Advanced queries
## Get Global Admins
MATCH p =(n)-[r:AZGlobalAdmin*1..]->(m) RETURN p
## Owners of Azure Groups
MATCH p = (n)-[r:AZOwns]->(g:AZGroup) RETURN p
## All Azure Users and their Groups
MATCH p=(m:AZUser)-[r:MemberOf]->(n) WHERE NOT m.objectid CONTAINS 'S-1-5' RETURN p
## Privileged Service Principals
MATCH p = (g:AZServicePrincipal)-[r]->(n) RETURN p
## Owners of Azure Applications
MATCH p = (n)-[r:AZOwns]->(g:AZApp) RETURN p
## Paths to VMs
MATCH p = (n)-[r]->(g: AZVM) RETURN p
## Paths to KeyVault
MATCH p = (n)-[r]->(g:AZKeyVault) RETURN p
## Paths to Azure Resource Group
MATCH p = (n)-[r]->(g:AZResourceGroup) RETURN p
## On-Prem users with edges to Azure
MATCH  p=(m:User)-[r:AZResetPassword|AZOwns|AZUserAccessAdministrator|AZContributor|AZAddMembers|AZGlobalAdmin|AZVMContributor|AZOwnsAZAvereContributor]->(n) WHERE m.objectid CONTAINS 'S-1-5-21' RETURN p
## All Azure AD Groups that are synchronized with On-Premise AD
MATCH (n:Group) WHERE n.objectid CONTAINS 'S-1-5' AND n.azsyncid IS NOT NULL RETURN n
```
### [Azucar](https://github.com/nccgroup/azucar)  

Azucar ist ein Tool, das entwickelt wurde, um Azure-Instanzen zu erkunden und zu kompromittieren. Es kann verwendet werden, um Informationen √ºber Azure-Ressourcen zu sammeln, Schwachstellen zu identifizieren und Angriffe auf Azure-Instanzen durchzuf√ºhren.
```bash
# You should use an account with at least read-permission on the assets you want to access
git clone https://github.com/nccgroup/azucar.git
PS> Get-ChildItem -Recurse c:\Azucar_V10 | Unblock-File

PS> .\Azucar.ps1 -AuthMode UseCachedCredentials -Verbose -WriteLog -Debug -ExportTo PRINT
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -CertFilePassword MySuperP@ssw0rd! -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000

# resolve the TenantID for an specific username
PS> .\Azucar.ps1 -ResolveTenantUserName user@company.com
```
### [**MicroBurst**](https://github.com/NetSPI/MicroBurst)
```
Import-Module .\MicroBurst.psm1
Import-Module .\Get-AzureDomainInfo.ps1
Get-AzureDomainInfo -folder MicroBurst -Verbose
```
### [**PowerZure**](https://github.com/hausec/PowerZure)
```powershell
Connect-AzAccount
ipmo C:\Path\To\Powerzure.psd1
Get-AzureTarget

# Reader
$ Get-Runbook, Get-AllUsers, Get-Apps, Get-Resources, Get-WebApps, Get-WebAppDetails

# Contributor
$ Execute-Command -OS Windows -VM Win10Test -ResourceGroup Test-RG -Command "whoami"
$ Execute-MSBuild -VM Win10Test  -ResourceGroup Test-RG -File "build.xml"
$ Get-AllSecrets # AllAppSecrets, AllKeyVaultContents
$ Get-AvailableVMDisks, Get-VMDisk # Download a virtual machine's disk

# Owner
$ Set-Role -Role Contributor -User test@contoso.com -Resource Win10VMTest

# Administrator
$ Create-Backdoor, Execute-Backdoor
```
<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
