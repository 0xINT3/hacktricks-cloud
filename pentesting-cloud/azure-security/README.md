# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Azure

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>

## –Ø –©–ï –ë–£–î–£–Æ –ú–ï–¢–û–î–û–õ–û–ì–Ü–Æ AZURE

## –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

{% content-ref url="az-basic-information.md" %}
[az-basic-information.md](az-basic-information.md)
{% endcontent-ref %}

## –ú–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è Azure Pentester/Red Team

–î–ª—è –∞—É–¥–∏—Ç—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ AZURE –¥—É–∂–µ –≤–∞–∂–ª–∏–≤–æ –∑–Ω–∞—Ç–∏: —è–∫—ñ **—Å–µ—Ä–≤—ñ—Å–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è**, —â–æ **–≤–∏–∫–ª–∞–¥–µ–Ω–æ**, —Ö—Ç–æ –º–∞—î **–¥–æ—Å—Ç—É–ø** –¥–æ —á–æ–≥–æ, —ñ —è–∫ –ø—ñ–¥–∫–ª—é—á–µ–Ω—ñ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ Azure —Å–µ—Ä–≤—ñ—Å–∏ —Ç–∞ **–∑–æ–≤–Ω—ñ—à–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏**.

–ó —Ç–æ—á–∫–∏ –∑–æ—Ä—É Red Team, **–ø–µ—Ä—à–∏–º –∫—Ä–æ–∫–æ–º –¥–ª—è –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ Azure** —î –∑–¥—ñ–π—Å–Ω–µ–Ω–Ω—è —Å–ø—Ä–æ–±–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ—è–∫—ñ **–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è** –¥–ª—è Azure AD. –û—Å—å –¥–µ—è–∫—ñ —ñ–¥–µ—ó, —è–∫ —Ü–µ –∑—Ä–æ–±–∏—Ç–∏:

* **–í–∏—Ç–æ–∫–∏** –≤ github (–∞–±–æ –ø–æ–¥—ñ–±–Ω—ñ) - OSINT
* **–°–æ—Ü—ñ–∞–ª—å–Ω–∞** —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—è
* **–ü–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è (–≤–∏—Ç–æ–∫–∏ –ø–∞—Ä–æ–ª—ñ–≤)**
* –í—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤ Azure-—Ö–æ—Å—Ç–æ–≤–∞–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫–∞—Ö
* [**–ü—ñ–¥—Ä–æ–±–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º—É –±–æ—Ü—ñ**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) –∑ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö
* **–ß–∏—Ç–∞–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª—É**
* `/home/USERNAME/.azure`
* `C:\Users\USERNAME\.azure`
* –§–∞–π–ª **`accessTokens.json`** –≤ `az cli` –¥–æ 2.30 - Jan2022 - –∑–±–µ—Ä—ñ–≥–∞–≤ **–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É —É –≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É –≤–∏–≥–ª—è–¥—ñ**
* –§–∞–π–ª **`azureProfile.json`** –º—ñ—Å—Ç–∏—Ç—å **—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é** –ø—Ä–æ —É–≤—ñ–π—à–æ–≤—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
* **`az logout`** –≤–∏–¥–∞–ª—è—î —Ç–æ–∫–µ–Ω.
* –°—Ç–∞—Ä—ñ –≤–µ—Ä—Å—ñ—ó **`Az PowerShell`** –∑–±–µ—Ä—ñ–≥–∞–ª–∏ **–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É** —É **–≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É** –≤–∏–≥–ª—è–¥—ñ –≤ **`TokenCache.dat`**. –¢–∞–∫–æ–∂ –∑–±–µ—Ä—ñ–≥–∞—î **ServicePrincipalSecret** —É **–≤—ñ–¥–∫—Ä–∏—Ç–æ–º—É** –≤–∏–≥–ª—è–¥—ñ –≤ **`AzureRmContext.json`**. –ö–æ–º–∞–Ω–¥–ª–µ—Ç **`Save-AzContext`** –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è **–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è** **—Ç–æ–∫–µ–Ω—ñ–≤**.\
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `Disconnect-AzAccount` –¥–ª—è —ó—Ö –≤–∏–¥–∞–ª–µ–Ω–Ω—è.
* 3-—Ç—ñ —Å—Ç–æ—Ä–æ–Ω–∏ **–ø–æ—Ä—É—à–µ–Ω—ñ**
* **–í–Ω—É—Ç—Ä—ñ—à–Ω—ñ** —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏
* [**–ó–∞–≥–∞–ª—å–Ω–∏–π –§—ñ—à–∏–Ω–≥**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∞–±–æ Oauth App)
* [–§—ñ—à–∏–Ω–≥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑–∞ –∫–æ–¥–æ–º –ø—Ä–∏—Å—Ç—Ä–æ—é Azure](az-unauthenticated-enum-and-initial-entry/az-device-code-authentication-phishing.md)
* [Azure **–ü–æ—à—É–∫ –ø–æ –ø–∞—Ä–æ–ª—è—Ö**](az-unauthenticated-enum-and-initial-entry/az-password-spraying.md)

–ù–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ **–Ω–µ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞–ª–∏ –∂–æ–¥–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∞—Ç–∞–∫–æ–≤–∞–Ω–æ–≥–æ –≤–∞–º–∏ Azure tenant, –≤–∏ –º–æ–∂–µ—Ç–µ **–∑—ñ–±—Ä–∞—Ç–∏ –¥–µ—è–∫—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é** –∑ –Ω—å–æ–≥–æ:

{% content-ref url="az-unauthenticated-enum-and-initial-entry/" %}
[az-unauthenticated-enum-and-initial-entry](az-unauthenticated-enum-and-initial-entry/)
{% endcontent-ref %}

{% hint style="info" %}
–ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –≤–∏ –∑–º–æ–≥–ª–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏, **–∫–æ–º—É –Ω–∞–ª–µ–∂–∞—Ç—å —Ü—ñ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è**, —ñ **–¥–æ —á–æ–≥–æ –≤–æ–Ω–∏ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø**, —Ç–æ–º—É –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–µ—è–∫—É –±–∞–∑–æ–≤—É –ø–µ—Ä–µ–ª—ñ–∫:
{% endhint %}

## –ë–∞–∑–æ–≤–∏–π –ø–µ—Ä–µ–ª—ñ–∫

{% hint style="info" %}
–ü–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ **–Ω–∞–π—à—É–º–Ω—ñ—à–æ—é** —á–∞—Å—Ç–∏–Ω–æ—é –ø–µ—Ä–µ–ª—ñ–∫—É —î **–≤—Ö—ñ–¥**, –∞ –Ω–µ —Å–∞–º –ø–µ—Ä–µ–ª—ñ–∫.
{% endhint %}

### SSRF

–Ø–∫—â–æ –≤–∏ –∑–Ω–∞–π—à–ª–∏ SSRF –Ω–∞ –º–∞—à–∏–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Azure, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è —Ö–∏—Ç—Ä–æ—â—ñ–≤:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### –û–±—Ö—ñ–¥ —É–º–æ–≤ –≤—Ö–æ–¥—É

<figure><img src="../../.gitbook/assets/image (1) (2) (2).png" alt=""><figcaption></figcaption></figure>

–£ –≤–∏–ø–∞–¥–∫–∞—Ö, –∫–æ–ª–∏ —É –≤–∞—Å —î –¥–µ—è–∫—ñ –¥—ñ–π—Å–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, –∞–ª–µ –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ —É–≤—ñ–π—Ç–∏, —Ü–µ –¥–µ—è–∫—ñ –∑–∞–≥–∞–ª—å–Ω—ñ –∑–∞—Ö–æ–¥–∏ –∑–∞—Ö–∏—Å—Ç—É, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –Ω–∞ –º—ñ—Å—Ü—ñ:

* **–ë—ñ–ª—ñ—Å—Ç–∏–Ω–≥ IP** -- –í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ –¥—ñ–π—Å–Ω—É IP-–∞–¥—Ä–µ—Å—É
* **–ì–µ–æ-–æ–±–º–µ–∂–µ–Ω–Ω—è** -- –ó–Ω–∞–π–¥—ñ—Ç—å, –¥–µ –∂–∏–≤–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–±–æ –¥–µ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –æ—Ñ—ñ—Å–∏ –∫–æ–º–ø–∞–Ω—ñ—ó —Ç–∞ –æ—Ç—Ä–∏–º–∞–π—Ç–µ IP –∑ —Ç–æ–≥–æ –∂ –º—ñ—Å—Ç–∞ (–∞–±–æ –∫—Ä–∞—ó–Ω–∏, –ø—Ä–∏–Ω–∞–π–º–Ω—ñ)
* **–ë—Ä–∞—É–∑–µ—Ä** -- –ú–æ–∂–ª–∏–≤–æ, –¥–æ–∑–≤–æ–ª–µ–Ω–∏–π –ª–∏—à–µ –±—Ä–∞—É–∑–µ—Ä –ø–µ–≤–Ω–æ—ó –û–° (Windows, Linux, Mac, Android, iOS). –î—ñ–∑–Ω–∞–π—Ç–µ—Å—è, —è–∫—É –û–° –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∂–µ—Ä—Ç–≤–∞/–∫–æ–º–ø–∞–Ω—ñ—è.
* –í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **—Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —Å–ª—É–∂–±–æ–≤–æ–≥–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª—É**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –∑–∞–∑–≤–∏—á–∞–π –º–µ–Ω—à–µ –æ–±–º–µ–∂–µ–Ω—ñ, —ñ —ó—Ö –≤—Ö—ñ–¥ —Ä—ñ–¥—à–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è

–ü—ñ—Å–ª—è –æ–±—Ö–æ–¥—É —Ü—å–æ–≥–æ, –≤–∏, –º–æ–∂–ª–∏–≤–æ, –∑–º–æ–∂–µ—Ç–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –≤–∞—à–æ–≥–æ –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, —ñ –≤–∏ –≤—Å–µ —â–µ –º–∞—Ç–∏–º–µ—Ç–µ –¥–æ—Å—Ç—É–ø.

### –ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –ø—ñ–¥–¥–æ–º–µ–Ω—É

* [https://godiego.co/posts/STO-Azure/](https://godiego.co/posts/STO-Azure/)

### –•—Ç–æ —è

{% hint style="danger" %}
–î—ñ–∑–Ω–∞–π—Ç–µ—Å—è, **—è–∫ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏** az cli, AzureAD —Ç–∞ Az PowerShell –≤ —Ä–æ–∑–¥—ñ–ª—ñ [**Az - AzureAD**](az-azuread/).
{% endhint %}

–û–¥–Ω–µ –∑ –ø–µ—Ä—à–∏—Ö, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏, - **—Ö—Ç–æ –≤–∏** (–≤ —è–∫–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –≤–∏ –∑–Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å):

{% tabs %}
{% tab title="az cli" %}
```bash
az account list
az account tenant list # Current tenant info
az account subscription list # Current subscription info
az ad signed-in-user show # Current signed-in user
az ad signed-in-user list-owned-objects # Get owned objects by current user
az account management-group list #Not allowed by default
```
{% endtab %}

{% tab title="AzureAD" %}**AzureAD** - –¶–µ —Å–ª—É–∂–±–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º –≤ **Azure**. –¶–µ –º–æ–∂–µ –±—É—Ç–∏ –æ–¥–Ω–∏–º –∑ –ø–µ—Ä—à–∏—Ö –º—ñ—Å—Ü—å, –¥–µ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **PowerShell** –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ **AzureAD**. –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ –∫—ñ–ª—å–∫–∞ –∫–æ—Ä–∏—Å–Ω–∏—Ö –∫–æ–º–∞–Ω–¥. 

```bash
#Install the module
Install-Module -Name AzureAD

#Connect to AzureAD
Connect-AzureAD

#Get all users
Get-AzureADUser

#Get all groups
Get-AzureADGroup

#Get all applications
Get-AzureADApplication
```
```powershell
#Get the current session state
Get-AzureADCurrentSessionInfo
#Get details of the current tenant
Get-AzureADTenantDetail
```
{% endtab %}

{% tab title="Az PowerShell" %} 
### –ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ Azure AD

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –º–æ–¥—É–ª—å Az —Ç–∞ –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ –≤–∞—à–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É Azure:
    ```bash
    Install-Module -Name Az -AllowClobber -Scope CurrentUser
    Connect-AzAccount
    ```

2. –û—Ç—Ä–∏–º–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ —Ç–æ–∫–µ–Ω—ñ–≤ Azure AD:
    ```bash
    $context = Get-AzContext
    $token = [Microsoft.Azure.Commands.Common.Authentication.Abstractions.AzureRmProfileProvider]::Instance.Profile.DefaultContext.TokenCache.ReadItems() | Where-Object { $_.TenantId -eq $context.Tenant.TenantId }
    $token.AccessToken
    ```

3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ—Ç—Ä–∏–º–∞–Ω–∏–π —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ Azure. 
{% endtab %}
```powershell
# Get the information about the current context (Account, Tenant, Subscription etc.)
Get-AzContext
# List all available contexts
Get-AzContext -ListAvailable
# Enumerate subscriptions accessible by the current user
Get-AzSubscription
#Get Resource group
Get-AzResourceGroup
# Enumerate all resources visible to the current user
Get-AzResource
# Enumerate all Azure RBAC role assignments
Get-AzRoleAssignment # For all users
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com # For current user
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
–û–¥–∏–Ω –∑ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏—Ö –∫–æ–º–∞–Ω–¥ –¥–ª—è –ø–µ—Ä–µ–ª—ñ–∫—É Azure - **`Get-AzResource`** –∑ Az PowerShell, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º **–∑–Ω–∞—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏, —è–∫—ñ –≤–∞—à –ø–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –±–∞—á–∏—Ç–∏**.

–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ç—É –∂ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤ **–≤–µ–±-–∫–æ–Ω—Å–æ–ª—ñ**, –ø–µ—Ä–µ–π—à–æ–≤—à–∏ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º [https://portal.azure.com/#view/HubsExtension/BrowseAll](https://portal.azure.com/#view/HubsExtension/BrowseAll) –∞–±–æ —à—É–∫–∞—é—á–∏ "–£—Å—ñ —Ä–µ—Å—É—Ä—Å–∏"
{% endhint %}

### –ü–µ—Ä–µ–ª—ñ–∫ AzureAD

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –±—É–¥—å-—è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ–≤–∏–Ω–µ–Ω –º–∞—Ç–∏ **–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–æ–∑–≤–æ–ª—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–ª—ñ–∫—É** —Ç–∞–∫–∏—Ö —Ä–µ—á–µ–π, —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, –≥—Ä—É–ø–∏, —Ä–æ–ª—ñ, —Å–ª—É–∂–±–æ–≤—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–∏... (–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ AzureAD](az-basic-information.md#default-user-permissions)).\
–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –ø–æ—Å—ñ–±–Ω–∏–∫:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

{% hint style="info" %}
–¢–µ–ø–µ—Ä, –∫–æ–ª–∏ —É –≤–∞—Å **—î –¥–µ—è–∫–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤–∞—à—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ** (—ñ —è–∫—â–æ –≤–∏ - —á–µ—Ä–≤–æ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞, —Å–ø–æ–¥—ñ–≤–∞—î–º–æ—Å—è, —â–æ –≤–∞—Å **–Ω–µ –≤–∏—è–≤–∏–ª–∏**). –ß–∞—Å –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —è–∫—ñ —Å–ª—É–∂–±–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ.\
–£ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–µ—è–∫—ñ —Å–ø–æ—Å–æ–±–∏ **–ø–µ—Ä–µ–ª—ñ–∫—É –¥–µ—è–∫–∏—Ö –∑–∞–≥–∞–ª—å–Ω–∏—Ö —Å–ª—É–∂–±.**
{% endhint %}

## –°–ª—É–∂–±–æ–≤–∏–π –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª —Ç–∞ –ø–æ–ª—ñ—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø—É

Azure-—Å–ª—É–∂–±–∞ –º–æ–∂–µ –º–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä (—Å–∞–º–æ—ó —Å–ª—É–∂–±–∏) –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º –∫–µ—Ä–æ–≤–∞–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä. –¶–µ–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –º–æ–∂–µ –º–∞—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫—É –¥–æ—Å—Ç—É–ø—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–æ KeyVault –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤. –¶—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø—É –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –æ–±–º–µ–∂–µ–Ω—ñ (–ø—Ä–∏–Ω—Ü–∏–ø –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤), –∞–ª–µ –º–æ–∂—É—Ç—å –º–∞—Ç–∏ –±—ñ–ª—å—à–µ –¥–æ–∑–≤–æ–ª—ñ–≤, –Ω—ñ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–æ. –ó–∞–∑–≤–∏—á–∞–π —Å–ª—É–∂–±–∞ –¥–æ–¥–∞—Ç–∫—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ KeyVault –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤ —Ç–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—ñ–≤.

–¢–æ–º—É –∫–æ—Ä–∏—Å–Ω–æ –¥–æ—Å–ª—ñ–¥–∂—É–≤–∞—Ç–∏ —Ü—ñ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏.

## –°–ª—É–∂–±–∞ –¥–æ–¥–∞—Ç–∫—ñ–≤ SCM

–ö–æ–Ω—Å–æ–ª—å Kudu –¥–ª—è –≤—Ö–æ–¥—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ª—É–∂–±–∏ –¥–æ–¥–∞—Ç–∫—ñ–≤.

## –í–µ–±-–æ–±–æ–ª–æ–Ω–∫–∞

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ portal.azure.com —Ç–∞ –≤–∏–±–µ—Ä—ñ—Ç—å –æ–±–æ–ª–æ–Ω–∫—É –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ shell.azure.com –¥–ª—è bash –∞–±–æ powershell. '–î–∏—Å–∫' —Ü—ñ—î—ó –æ–±–æ–ª–æ–Ω–∫–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —è–∫ —Ñ–∞–π–ª –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ —Å—Ö–æ–≤–∏—â–∞.

## Azure DevOps

Azure DevOps —î –æ–∫—Ä–µ–º–∏–º –≤—ñ–¥ Azure. –í –Ω—å–æ–º—É —î —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó, –∫–æ–Ω–≤–µ—î—Ä–∏ (yaml –∞–±–æ —Ä–µ–ª—ñ–∑), –¥–æ—à–∫–∏, –≤—ñ–∫—ñ —Ç–∞ —ñ–Ω—à–µ. –ì—Ä—É–ø–∏ –∑–º—ñ–Ω–Ω–∏—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∑–Ω–∞—á–µ–Ω—å –∑–º—ñ–Ω–Ω–∏—Ö —Ç–∞ —Å–µ–∫—Ä–µ—Ç—ñ–≤.

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—ñ –∑–∞—Å–æ–±–∏ —Ä–µ–∫–æ–Ω–Ω–µ—Å–∞–Ω—Å—É

### [**ROADRecon**](https://github.com/dirkjanm/ROADtools)
```powershell
cd ROADTools
pipenv shell
roadrecon auth -u test@corp.onmicrosoft.com -p "Welcome2022!"
roadrecon gather
roadrecon gui
```
### [Monkey365](https://github.com/silverhack/monkey365)

{% code overflow="wrap" %}
```powershell
Import-Module monkey365
Get-Help Invoke-Monkey365
Get-Help Invoke-Monkey365 -Detailed
Invoke-Monkey365 -IncludeAzureActiveDirectory -ExportTo HTML -Verbose -Debug -InformationAction Continue
Invoke-Monkey365 - Instance Azure -Analysis All -ExportTo HTML
```
{% endcode %}

### [**Stormspotter**](https://github.com/Azure/Stormspotter)
```powershell
# Start Backend
cd stormspotter\backend\
pipenv shell
python ssbackend.pyz

# Start Front-end
cd stormspotter\frontend\dist\spa\
quasar.cmd serve -p 9091 --history

# Run Stormcollector
cd stormspotter\stormcollector\
pipenv shell
az login -u test@corp.onmicrosoft.com -p Welcome2022!
python stormspotter\stormcollector\sscollector.pyz cli
# This will generate a .zip file to upload in the frontend (127.0.0.1:9091)
```
### [**AzureHound**](https://github.com/BloodHoundAD/AzureHound)
```powershell
# You need to use the Az PowerShell and Azure AD modules:
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@corp.onmicrosoft.com", $passwd)
Connect-AzAccount -Credential $creds

Import-Module AzureAD\AzureAD.psd1
Connect-AzureAD -Credential $creds

# Launch AzureHound
. AzureHound\AzureHound.ps1
Invoke-AzureHound -Verbose

# Simple queries
## All Azure Users
MATCH (n:AZUser) return n.name
## All Azure Applications
MATCH (n:AZApp) return n.objectid
## All Azure Devices
MATCH (n:AZDevice) return n.name
## All Azure Groups
MATCH (n:AZGroup) return n.name
## All Azure Key Vaults
MATCH (n:AZKeyVault) return n.name
## All Azure Resource Groups
MATCH (n:AZResourceGroup) return n.name
## All Azure Service Principals
MATCH (n:AZServicePrincipal) return n.objectid
## All Azure Virtual Machines
MATCH (n:AZVM) return n.name
## All Principals with the ‚ÄòContributor‚Äô role
MATCH p = (n)-[r:AZContributor]->(g) RETURN p

# Advanced queries
## Get Global Admins
MATCH p =(n)-[r:AZGlobalAdmin*1..]->(m) RETURN p
## Owners of Azure Groups
MATCH p = (n)-[r:AZOwns]->(g:AZGroup) RETURN p
## All Azure Users and their Groups
MATCH p=(m:AZUser)-[r:MemberOf]->(n) WHERE NOT m.objectid CONTAINS 'S-1-5' RETURN p
## Privileged Service Principals
MATCH p = (g:AZServicePrincipal)-[r]->(n) RETURN p
## Owners of Azure Applications
MATCH p = (n)-[r:AZOwns]->(g:AZApp) RETURN p
## Paths to VMs
MATCH p = (n)-[r]->(g: AZVM) RETURN p
## Paths to KeyVault
MATCH p = (n)-[r]->(g:AZKeyVault) RETURN p
## Paths to Azure Resource Group
MATCH p = (n)-[r]->(g:AZResourceGroup) RETURN p
## On-Prem users with edges to Azure
MATCH  p=(m:User)-[r:AZResetPassword|AZOwns|AZUserAccessAdministrator|AZContributor|AZAddMembers|AZGlobalAdmin|AZVMContributor|AZOwnsAZAvereContributor]->(n) WHERE m.objectid CONTAINS 'S-1-5-21' RETURN p
## All Azure AD Groups that are synchronized with On-Premise AD
MATCH (n:Group) WHERE n.objectid CONTAINS 'S-1-5' AND n.azsyncid IS NOT NULL RETURN n
```
### [Azucar](https://github.com/nccgroup/azucar)
```bash
# You should use an account with at least read-permission on the assets you want to access
git clone https://github.com/nccgroup/azucar.git
PS> Get-ChildItem -Recurse c:\Azucar_V10 | Unblock-File

PS> .\Azucar.ps1 -AuthMode UseCachedCredentials -Verbose -WriteLog -Debug -ExportTo PRINT
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -CertFilePassword MySuperP@ssw0rd! -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000

# resolve the TenantID for an specific username
PS> .\Azucar.ps1 -ResolveTenantUserName user@company.com
```
### [**MicroBurst**](https://github.com/NetSPI/MicroBurst)
```
Import-Module .\MicroBurst.psm1
Import-Module .\Get-AzureDomainInfo.ps1
Get-AzureDomainInfo -folder MicroBurst -Verbose
```
### [**PowerZure**](https://github.com/hausec/PowerZure)
```powershell
Connect-AzAccount
ipmo C:\Path\To\Powerzure.psd1
Get-AzureTarget

# Reader
$ Get-Runbook, Get-AllUsers, Get-Apps, Get-Resources, Get-WebApps, Get-WebAppDetails

# Contributor
$ Execute-Command -OS Windows -VM Win10Test -ResourceGroup Test-RG -Command "whoami"
$ Execute-MSBuild -VM Win10Test  -ResourceGroup Test-RG -File "build.xml"
$ Get-AllSecrets # AllAppSecrets, AllKeyVaultContents
$ Get-AvailableVMDisks, Get-VMDisk # Download a virtual machine's disk

# Owner
$ Set-Role -Role Contributor -User test@contoso.com -Resource Win10VMTest

# Administrator
$ Create-Backdoor, Execute-Backdoor
```
<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>
